# Issue 9368: sage_fortran ignores SAGE64 except on Solaris/OpenSolaris

archive/issues_009368.json:
```json
{
    "body": "#9346 which corrects a problem with the variable SAGE64 has a problem, because SAGE64 is ignored on any platform other than Solaris/OpenSolaris. The flag is useful on OS X too and potentially on other platforms like HP-UX.  \n\nThis needs correcting urgently as it will mess up peoples OS X builds. \n\nDave \n\n**Assignee:** GeorgSWeber\n\n**CC:**  justin @qed777 @jhpalmieri\n\n**Author:** David Kirkby, William Stein\n\n**Reviewer:** Robert Miller\n\n**Merged:** sage-4.5.rc2\n\nIssue created by migration from https://trac.sagemath.org/ticket/9368\n\n",
    "closed_at": "2010-07-15T13:18:58Z",
    "created_at": "2010-06-28T23:25:39Z",
    "labels": [
        "component: build",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.5",
    "title": "sage_fortran ignores SAGE64 except on Solaris/OpenSolaris",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/9368",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```
#9346 which corrects a problem with the variable SAGE64 has a problem, because SAGE64 is ignored on any platform other than Solaris/OpenSolaris. The flag is useful on OS X too and potentially on other platforms like HP-UX.  

This needs correcting urgently as it will mess up peoples OS X builds. 

Dave 

**Assignee:** GeorgSWeber

**CC:**  justin @qed777 @jhpalmieri

**Author:** David Kirkby, William Stein

**Reviewer:** Robert Miller

**Merged:** sage-4.5.rc2

Issue created by migration from https://trac.sagemath.org/ticket/9368





---

archive/issue_comments_081682.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n-#9346 which corrects a problem with the variable has a problem, because SAGE64 is ignored on any plaform other than OS X. \n+#9346 which corrects a problem with the variable has a problem, because SAGE64 is ignored on any platform other than Solaris/OpenSolaris. The flag is useful on OS X too and potentially on other platforms like HP-UX.  \n \n-This needs correcting urgently. \n+This needs correcting urgently as it will mess up peoples OS X builds. \n \n Dave \n``````\n",
    "created_at": "2010-06-28T23:27:14Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81682",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
-#9346 which corrects a problem with the variable has a problem, because SAGE64 is ignored on any plaform other than OS X. 
+#9346 which corrects a problem with the variable has a problem, because SAGE64 is ignored on any platform other than Solaris/OpenSolaris. The flag is useful on OS X too and potentially on other platforms like HP-UX.  
 
-This needs correcting urgently. 
+This needs correcting urgently as it will mess up peoples OS X builds. 
 
 Dave 
``````




---

archive/issue_comments_081683.json:
```json
{
    "body": "Mercurial patch which hopefully finally fixes this fortran issue. (Long-term, it would be good to get rid of files like sage_fortran)",
    "created_at": "2010-06-28T23:44:22Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81683",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Mercurial patch which hopefully finally fixes this fortran issue. (Long-term, it would be good to get rid of files like sage_fortran)



---

archive/issue_events_068615.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/drkirkby",
    "created_at": "2010-06-28T23:46:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9368#event-68615"
}
```



---

archive/attachments_012319.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "9368.patch",
    "asset_url": "tarball://root/attachments/ticket9368/9368.patch",
    "created_at": "2010-06-28T23:46:42Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket9368/9368.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```



---

archive/issue_comments_081684.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Attachment:** [9368.patch](https://github.com/sagemath/sage/files/ticket9368/9368.patch)\n\nA new package can be found at \n\nhttp://boxen.math.washington.edu/home/kirkby/patches/fortran-20100629.spkg\n\nNote, this is just a tar file, not a compressed tar file, as compressing the contents, which are already compressed, just makes the package bigger and need more CPU time to process",
    "created_at": "2010-06-28T23:46:42Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81684",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:2'></a>
**Attachment:** [9368.patch](https://github.com/sagemath/sage/files/ticket9368/9368.patch)

A new package can be found at 

http://boxen.math.washington.edu/home/kirkby/patches/fortran-20100629.spkg

Note, this is just a tar file, not a compressed tar file, as compressing the contents, which are already compressed, just makes the package bigger and need more CPU time to process



---

archive/issue_comments_081685.json:
```json
{
    "body": "**Author:** David Kirkby",
    "created_at": "2010-06-28T23:49:01Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81685",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Author:** David Kirkby



---

archive/issue_comments_081686.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-#9346 which corrects a problem with the variable has a problem, because SAGE64 is ignored on any platform other than Solaris/OpenSolaris. The flag is useful on OS X too and potentially on other platforms like HP-UX.  \n+#9346 which corrects a problem with the variable SAGE64 has a problem, because SAGE64 is ignored on any platform other than Solaris/OpenSolaris. The flag is useful on OS X too and potentially on other platforms like HP-UX.  \n \n This needs correcting urgently as it will mess up peoples OS X builds. \n \n``````\n",
    "created_at": "2010-06-28T23:49:38Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81686",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-#9346 which corrects a problem with the variable has a problem, because SAGE64 is ignored on any platform other than Solaris/OpenSolaris. The flag is useful on OS X too and potentially on other platforms like HP-UX.  
+#9346 which corrects a problem with the variable SAGE64 has a problem, because SAGE64 is ignored on any platform other than Solaris/OpenSolaris. The flag is useful on OS X too and potentially on other platforms like HP-UX.  
 
 This needs correcting urgently as it will mess up peoples OS X builds. 
 
``````




---

archive/issue_comments_081687.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe change makes sense to me, but I'm not sure I can referee it properly: I don't have any problem with fortran on my Mac OS X box.  This is OS X 10.6 on a 64-bit machine.  No matter how I set SAGE64, the file sage_fortran always says\n\n```\n#!/bin/bash\ngfortran -m64 \"$@\"\n```\nIn fact, the lines which get changed by the patch occur in the function `install_SAGE_FORTRAN`, which should only get run if the environment variable `SAGE_FORTRAN` is set.  I don't know why anyone on OS X should set this.",
    "created_at": "2010-06-29T15:58:12Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81687",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
The change makes sense to me, but I'm not sure I can referee it properly: I don't have any problem with fortran on my Mac OS X box.  This is OS X 10.6 on a 64-bit machine.  No matter how I set SAGE64, the file sage_fortran always says

```
#!/bin/bash
gfortran -m64 "$@"
```
In fact, the lines which get changed by the patch occur in the function `install_SAGE_FORTRAN`, which should only get run if the environment variable `SAGE_FORTRAN` is set.  I don't know why anyone on OS X should set this.



---

archive/issue_events_068616.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-06-29T16:14:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9368#event-68616"
}
```



---

archive/issue_events_068617.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-06-29T16:14:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9368#event-68617"
}
```



---

archive/issue_comments_081688.json:
```json
{
    "body": "**Reviewer:** Robert Miller",
    "created_at": "2010-06-29T16:14:37Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81688",
    "user": "https://github.com/rlmill"
}
```

**Reviewer:** Robert Miller



---

archive/issue_events_068618.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-06-29T16:15:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9368#event-68618"
}
```



---

archive/issue_events_068619.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-06-29T16:15:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9368#event-68619"
}
```



---

archive/issue_comments_081689.json:
```json
{
    "body": "**Merged:** sage-4.5.alpha1",
    "created_at": "2010-06-29T16:15:07Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81689",
    "user": "https://github.com/rlmill"
}
```

**Merged:** sage-4.5.alpha1



---

archive/issue_comments_081690.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [jhpalmieri](#comment%3A5):\n> The change makes sense to me, but I'm not sure I can referee it properly: I don't have any problem with fortran on my Mac OS X box.  This is OS X 10.6 on a 64-bit machine.  No matter how I set SAGE64, the file sage_fortran always says\n> \n> ```\n> #!/bin/bash\n> gfortran -m64 \"$@\"\n> ```\n> In fact, the lines which get changed by the patch occur in the function `install_SAGE_FORTRAN`, which should only get run if the environment variable `SAGE_FORTRAN` is set.  I don't know why anyone on OS X should set this.\n\nI'm pretty sure I've seen it written that one can do this on OS X if you want to use a different compiler. I guess with Apple shipping 4.0.1, it is not surprising some people are using more recent compilers. \n\nSorry for the mess up!\n\nDave",
    "created_at": "2010-06-29T20:52:51Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81690",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:8'></a>
Replying to [jhpalmieri](#comment%3A5):
> The change makes sense to me, but I'm not sure I can referee it properly: I don't have any problem with fortran on my Mac OS X box.  This is OS X 10.6 on a 64-bit machine.  No matter how I set SAGE64, the file sage_fortran always says
> 
> ```
> #!/bin/bash
> gfortran -m64 "$@"
> ```
> In fact, the lines which get changed by the patch occur in the function `install_SAGE_FORTRAN`, which should only get run if the environment variable `SAGE_FORTRAN` is set.  I don't know why anyone on OS X should set this.

I'm pretty sure I've seen it written that one can do this on OS X if you want to use a different compiler. I guess with Apple shipping 4.0.1, it is not surprising some people are using more recent compilers. 

Sorry for the mess up!

Dave



---

archive/issue_events_068620.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-07-15T12:22:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9368#event-68620"
}
```



---

archive/issue_comments_081691.json:
```json
{
    "body": "<a id='comment:9'></a>\nI'm re-opening this ticket because the fortran-20100629.spkg is broken.  On OS X, it installs g95 now, whereas the previous fortran spkg (the one in sage-4.4.4) installs gfortran.      Somebody was a bit sloppy.  \n\nWhen this package is properly updated for OS X, make sure to type\n\n  ./sage -sh\n   local/bin/sage_fortran.bin --version\n\nand ensure that you've actually got gfortran installed, not g95.  The gfortran binary for OS X is quad-architecture -- it covers 32 and 64-bit on both ppc and intel.",
    "created_at": "2010-07-15T12:22:55Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81691",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:9'></a>
I'm re-opening this ticket because the fortran-20100629.spkg is broken.  On OS X, it installs g95 now, whereas the previous fortran spkg (the one in sage-4.4.4) installs gfortran.      Somebody was a bit sloppy.  

When this package is properly updated for OS X, make sure to type

  ./sage -sh
   local/bin/sage_fortran.bin --version

and ensure that you've actually got gfortran installed, not g95.  The gfortran binary for OS X is quad-architecture -- it covers 32 and 64-bit on both ppc and intel.



---

archive/issue_comments_081692.json:
```json
{
    "body": "<a id='comment:10'></a>\nI'm also moving this to sage-4.5.1, so that the release manager can release sage-4.5.",
    "created_at": "2010-07-15T12:23:18Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81692",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:10'></a>
I'm also moving this to sage-4.5.1, so that the release manager can release sage-4.5.



---

archive/issue_events_068621.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-07-15T12:23:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "milestone": "sage-4.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9368#event-68621"
}
```



---

archive/issue_events_068622.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-07-15T12:23:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "milestone": "sage-4.5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9368#event-68622"
}
```



---

archive/issue_events_068623.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-07-15T12:23:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9368#event-68623"
}
```



---

archive/issue_events_068624.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-07-15T12:23:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9368#event-68624"
}
```



---

archive/issue_comments_081693.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [was](#comment%3A9):\n> I'm re-opening this ticket because the fortran-20100629.spkg is broken.  On OS X, it installs g95 now, whereas the previous fortran spkg (the one in sage-4.4.4) installs gfortran.      Somebody was a bit sloppy.  \n> \n> When this package is properly updated for OS X, make sure to type\n> \n>   ./sage -sh\n>    local/bin/sage_fortran.bin --version\n> \n> and ensure that you've actually got gfortran installed, not g95.  The gfortran binary for OS X is quad-architecture -- it covers 32 and 64-bit on both ppc and intel.    \n\nSince I created it, I guess you are saying I was sloppy. It is hard to know how I can check this any more, given it builds for me on OS X (bsd.math) using \n* My normal environment\n* Your script. \n\nIt also builds for everyone else. There are numerous reports of successful builds on OS X. \n\nWould it be sensible to remove 'g95' from the package, and ensure that the packages assumes 'gfortran' - then the perl script can be removed. \n\nDave",
    "created_at": "2010-07-15T12:38:38Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81693",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:11'></a>
Replying to [was](#comment%3A9):
> I'm re-opening this ticket because the fortran-20100629.spkg is broken.  On OS X, it installs g95 now, whereas the previous fortran spkg (the one in sage-4.4.4) installs gfortran.      Somebody was a bit sloppy.  
> 
> When this package is properly updated for OS X, make sure to type
> 
>   ./sage -sh
>    local/bin/sage_fortran.bin --version
> 
> and ensure that you've actually got gfortran installed, not g95.  The gfortran binary for OS X is quad-architecture -- it covers 32 and 64-bit on both ppc and intel.    

Since I created it, I guess you are saying I was sloppy. It is hard to know how I can check this any more, given it builds for me on OS X (bsd.math) using 
* My normal environment
* Your script. 

It also builds for everyone else. There are numerous reports of successful builds on OS X. 

Would it be sensible to remove 'g95' from the package, and ensure that the packages assumes 'gfortran' - then the perl script can be removed. 

Dave



---

archive/issue_events_068625.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-07-15T12:47:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "milestone": "sage-4.5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9368#event-68625"
}
```



---

archive/issue_events_068626.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-07-15T12:47:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "milestone": "sage-4.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9368#event-68626"
}
```



---

archive/issue_comments_081694.json:
```json
{
    "body": "<a id='comment:12'></a>\n> Since I created it, I guess you are saying I was sloppy. It is hard to know how I can check \n> this any more, given it builds for me on OS X (bsd.math) using\n\nI wrote the spkg and most of the script in the first place, and looking it over, I think now it would be more accurate to conclude that I'm saying that *I* was sloppy.    As penance, I'll move this back to sage-4.5, and try to improve the sloppiness.",
    "created_at": "2010-07-15T12:47:32Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81694",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:12'></a>
> Since I created it, I guess you are saying I was sloppy. It is hard to know how I can check 
> this any more, given it builds for me on OS X (bsd.math) using

I wrote the spkg and most of the script in the first place, and looking it over, I think now it would be more accurate to conclude that I'm saying that *I* was sloppy.    As penance, I'll move this back to sage-4.5, and try to improve the sloppiness.



---

archive/issue_comments_081695.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [was](#comment%3A12):\n> > Since I created it, I guess you are saying I was sloppy. It is hard to know how I can check \n> > this any more, given it builds for me on OS X (bsd.math) using\n\n> \n> I wrote the spkg and most of the script in the first place, and looking it over, I think now it would be more accurate to conclude that I'm saying that *I* was sloppy.    As penance, I'll move this back to sage-4.5, and try to improve the sloppiness.  \n\nThank you. \n\nDave",
    "created_at": "2010-07-15T12:51:24Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81695",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:13'></a>
Replying to [was](#comment%3A12):
> > Since I created it, I guess you are saying I was sloppy. It is hard to know how I can check 
> > this any more, given it builds for me on OS X (bsd.math) using

> 
> I wrote the spkg and most of the script in the first place, and looking it over, I think now it would be more accurate to conclude that I'm saying that *I* was sloppy.    As penance, I'll move this back to sage-4.5, and try to improve the sloppiness.  

Thank you. 

Dave



---

archive/issue_comments_081696.json:
```json
{
    "body": "<a id='comment:14'></a>\nOK, I've found the problem.  The build script is written in Python.  Thus the fortran spkg *depends* on Python.   However, for me, when I built the fortran spkg, it got built before Python, hence some random system-wide wrong python was used, and this broke the build.  This was a problem that could have happened on many different systems in weird ways, so it's very good that Robert Miller and I persisted and tracked this down, instead of brushing it off. \n\nThe fix:  change the deps file, and make sure to include a comment in the deps file explaining this dependency.\n\nOne could also add a check that $SAGE_LOCAL/bin/python exists in this spkg-install script. \n\nAnother good idea, would be to change the sage build system, so that when if spkg-install is a Python script, but Python hasn't been built yet, then an error is immediately raised.  This would keep this problem from ever happening again.  I've opened a ticket: #9507.",
    "created_at": "2010-07-15T13:14:41Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81696",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:14'></a>
OK, I've found the problem.  The build script is written in Python.  Thus the fortran spkg *depends* on Python.   However, for me, when I built the fortran spkg, it got built before Python, hence some random system-wide wrong python was used, and this broke the build.  This was a problem that could have happened on many different systems in weird ways, so it's very good that Robert Miller and I persisted and tracked this down, instead of brushing it off. 

The fix:  change the deps file, and make sure to include a comment in the deps file explaining this dependency.

One could also add a check that $SAGE_LOCAL/bin/python exists in this spkg-install script. 

Another good idea, would be to change the sage build system, so that when if spkg-install is a Python script, but Python hasn't been built yet, then an error is immediately raised.  This would keep this problem from ever happening again.  I've opened a ticket: #9507.



---

archive/issue_events_068627.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-07-15T13:18:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9368#event-68627"
}
```



---

archive/issue_events_068628.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-07-15T13:18:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9368#event-68628"
}
```



---

archive/issue_comments_081697.json:
```json
{
    "body": "<a id='comment:15'></a>\nRe-closing this ticket :)",
    "created_at": "2010-07-15T13:18:58Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81697",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:15'></a>
Re-closing this ticket :)



---

archive/issue_comments_081698.json:
```json
{
    "body": "**Changing author** from \"David Kirkby\" to \"David Kirkby, William Stein\".",
    "created_at": "2010-07-15T13:21:01Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81698",
    "user": "https://github.com/rlmill"
}
```

**Changing author** from "David Kirkby" to "David Kirkby, William Stein".



---

archive/issue_comments_081699.json:
```json
{
    "body": "**Changing merged** from \"sage-4.5.alpha1\" to \"sage-4.5.rc2\".",
    "created_at": "2010-07-15T13:21:01Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81699",
    "user": "https://github.com/rlmill"
}
```

**Changing merged** from "sage-4.5.alpha1" to "sage-4.5.rc2".



---

archive/attachments_012320.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "deps",
    "asset_url": "tarball://root/attachments/ticket9368/deps",
    "created_at": "2010-07-15T13:21:01Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket9368/deps",
    "user": "https://github.com/rlmill"
}
```



---

archive/issue_comments_081700.json:
```json
{
    "body": "<a id='comment:16'></a>\n**Attachment:** [deps](https://github.com/sagemath/sage/files/ticket9368/deps)",
    "created_at": "2010-07-15T13:21:01Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81700",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:16'></a>
**Attachment:** [deps](https://github.com/sagemath/sage/files/ticket9368/deps)



---

archive/issue_comments_081701.json:
```json
{
    "body": "<a id='comment:17'></a>\nLooks good!\n\n```\n471,472c471\n< # Do not remove PYTHON below -- see trac 9368\n< $(INST)/$(FORTRAN): $(BASE)  $(INST)/$(PYTHON)\n---\n> $(INST)/$(FORTRAN): $(BASE)\n```",
    "created_at": "2010-07-15T13:23:31Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81701",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:17'></a>
Looks good!

```
471,472c471
< # Do not remove PYTHON below -- see trac 9368
< $(INST)/$(FORTRAN): $(BASE)  $(INST)/$(PYTHON)
---
> $(INST)/$(FORTRAN): $(BASE)
```



---

archive/issue_comments_081702.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [was](#comment%3A14):\n> OK, I've found the problem.  The build script is written in Python.  Thus the fortran spkg *depends* on Python.   However, for me, when I built the fortran spkg, it got built before Python, hence some random system-wide wrong python was used, and this broke the build.  This was a problem that could have happened on many different systems in weird ways, so it's very good that Robert Miller and I persisted and tracked this down, instead of brushing it off. \n\nI'm afraid to say I don't share your confidence that you and Robert have tracked this down completely, though you have found a serious flaw. \n\nClearly adding this dependency to `$SAGE_ROOT/spkg/standard/deps` is correct - the fortran package uses Python, so Python must be built first. I'm not arguing with that. \n\nHowever, I'm not convinced this was William's problem, as the `$SAGE_LOCAL/bin/sage_fortain` script **must** have been working at one point, otherwise ATLAS, Linpack, Numpy and other things that used Fortran would not have built. As I posted on sage-release, William's `install.log` had in it\n\n```\nsage_fortran -fPIC  -c lsame.f -o lsame.o\nsage_fortran -fPIC  -c lsametst.f -o lsametst.o\nsage_fortran  -o testlsame lsame.o lsametst.o\nsage_fortran -fPIC  -c slamch.f -o slamch.o\nsage_fortran -fPIC  -c slamchtst.f -o slamchtst.o\nsage_fortran  -o testslamch slamch.o lsame.o slamchtst.o \n```\n\nHowever, when I looked at William's $SAGE_LOCAL/bin/sage_fortran, it had only:\n\n```\n#!/bin/sh\n```\n\nin it. There is **no way** that could have been used to compile ATLAS, Linbox, Numpy etc, all of which had built successfully. \n\nHence I believe that something other than the fortran package later modified `$SAGE_LOCAL/bin/sage_fortran`. Unless I'm mistaken, the bug does not reside in the fortran package at all, but rather in something that was built after ATLAS, Numpy and Linbox. \n\nComments? \n\nDave",
    "created_at": "2010-07-15T22:45:24Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81702",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:18'></a>
Replying to [was](#comment%3A14):
> OK, I've found the problem.  The build script is written in Python.  Thus the fortran spkg *depends* on Python.   However, for me, when I built the fortran spkg, it got built before Python, hence some random system-wide wrong python was used, and this broke the build.  This was a problem that could have happened on many different systems in weird ways, so it's very good that Robert Miller and I persisted and tracked this down, instead of brushing it off. 

I'm afraid to say I don't share your confidence that you and Robert have tracked this down completely, though you have found a serious flaw. 

Clearly adding this dependency to `$SAGE_ROOT/spkg/standard/deps` is correct - the fortran package uses Python, so Python must be built first. I'm not arguing with that. 

However, I'm not convinced this was William's problem, as the `$SAGE_LOCAL/bin/sage_fortain` script **must** have been working at one point, otherwise ATLAS, Linpack, Numpy and other things that used Fortran would not have built. As I posted on sage-release, William's `install.log` had in it

```
sage_fortran -fPIC  -c lsame.f -o lsame.o
sage_fortran -fPIC  -c lsametst.f -o lsametst.o
sage_fortran  -o testlsame lsame.o lsametst.o
sage_fortran -fPIC  -c slamch.f -o slamch.o
sage_fortran -fPIC  -c slamchtst.f -o slamchtst.o
sage_fortran  -o testslamch slamch.o lsame.o slamchtst.o 
```

However, when I looked at William's $SAGE_LOCAL/bin/sage_fortran, it had only:

```
#!/bin/sh
```

in it. There is **no way** that could have been used to compile ATLAS, Linbox, Numpy etc, all of which had built successfully. 

Hence I believe that something other than the fortran package later modified `$SAGE_LOCAL/bin/sage_fortran`. Unless I'm mistaken, the bug does not reside in the fortran package at all, but rather in something that was built after ATLAS, Numpy and Linbox. 

Comments? 

Dave



---

archive/issue_comments_081703.json:
```json
{
    "body": "<a id='comment:19'></a>\n> I'm afraid to say I don't share your confidence that you and Robert have tracked this down completely, though you have found a serious flaw. \n\nAs you also say, the change to deps is clearly right, so since this seems to fix the problem, we should leave this ticket closed, but keep an eye on this issue.\n\n(It would have been interesting to know the modification time of sage_fortran.  I can't imagine that anything else would have modified this; it seems more likely that something is broken in the ATLAS build, etc.  The broken build doesn't seem to be around anymore, though.)",
    "created_at": "2010-07-15T22:55:06Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81703",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:19'></a>
> I'm afraid to say I don't share your confidence that you and Robert have tracked this down completely, though you have found a serious flaw. 

As you also say, the change to deps is clearly right, so since this seems to fix the problem, we should leave this ticket closed, but keep an eye on this issue.

(It would have been interesting to know the modification time of sage_fortran.  I can't imagine that anything else would have modified this; it seems more likely that something is broken in the ATLAS build, etc.  The broken build doesn't seem to be around anymore, though.)



---

archive/issue_comments_081704.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [drkirkby](#comment%3A18):\n> I'm afraid to say I don't share your confidence that you and Robert have tracked this down completely, though you have found a serious flaw.\n\nOf course you don't share the same confidence, you didn't trace the bug down to its source like we did. It was the configure script for the R spkg calling a very specific fortran command that made the build eventually fail. It is very easy to imagine that none of the other configure scripts called fortran in this way. In fact, they couldn't have or the build would have failed earlier.\n\n> However, I'm not convinced this was William's problem, as the `$SAGE_LOCAL/bin/sage_fortain` script **must** have been working at one point, otherwise ATLAS, Linpack, Numpy and other things that used Fortran would not have built.\n\nDefine working.\n\n> However, when I looked at William's $SAGE_LOCAL/bin/sage_fortran, it had only:\n> \n> ```\n> #!/bin/sh\n> ```\n\nAs I pointed out earlier, this is just plain wrong!\n\n> Unless I'm mistaken...\n\nYou are!",
    "created_at": "2010-07-15T23:18:09Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81704",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:20'></a>
Replying to [drkirkby](#comment%3A18):
> I'm afraid to say I don't share your confidence that you and Robert have tracked this down completely, though you have found a serious flaw.

Of course you don't share the same confidence, you didn't trace the bug down to its source like we did. It was the configure script for the R spkg calling a very specific fortran command that made the build eventually fail. It is very easy to imagine that none of the other configure scripts called fortran in this way. In fact, they couldn't have or the build would have failed earlier.

> However, I'm not convinced this was William's problem, as the `$SAGE_LOCAL/bin/sage_fortain` script **must** have been working at one point, otherwise ATLAS, Linpack, Numpy and other things that used Fortran would not have built.

Define working.

> However, when I looked at William's $SAGE_LOCAL/bin/sage_fortran, it had only:
> 
> ```
> #!/bin/sh
> ```

As I pointed out earlier, this is just plain wrong!

> Unless I'm mistaken...

You are!



---

archive/issue_comments_081705.json:
```json
{
    "body": "<a id='comment:21'></a>\nI accept R could have called sage_fortran in a different way, which resulted in ATLAS, Linbox and Numpy building, but not R. \n\nBut can you explain how ATLAS, Numpy and Linbox built, when I clearly see the sage_fortran script had in it\n\n```\n#!/bin/sh\n```\n\n? \n\nI'm not wrong about the contents of the file. It **did** have that in it. \n\nDave",
    "created_at": "2010-07-15T23:25:25Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81705",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:21'></a>
I accept R could have called sage_fortran in a different way, which resulted in ATLAS, Linbox and Numpy building, but not R. 

But can you explain how ATLAS, Numpy and Linbox built, when I clearly see the sage_fortran script had in it

```
#!/bin/sh
```

? 

I'm not wrong about the contents of the file. It **did** have that in it. 

Dave



---

archive/issue_comments_081706.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [drkirkby](#comment%3A21):\n\n> But can you explain how ATLAS, Numpy and Linbox built, when I clearly see the sage_fortran script had in it\n> \n> ```\n> #!/bin/sh\n> ```\n> \n> ? \n> \n> I'm not wrong about the contents of the file. It **did** have that in it. \n> \n> Dave \n\nI realise I was mistaken here. Justin is almost certainly right when he says the lack of a new line in the file can fool the eye into believing that the contents of the file are just\n\n```\n#!/bin/sh\n```  \n\nwhen in fact there is more to it. This is how it looks on my screen - it is easy to see that this could be confusing. \n\n```\ndrkirkby@hawk:~/sage-4.5.rc0$ cat local/bin/sage_fortran\n#!/bin/sh \n\n/usr/local/gcc-4.4.4-multilib/bin/gfortran -m64 -fPIC $@drkirkby@hawk:~/sage-4.5.rc0$ \n```\n\n\nI'm glad I was wrong about this. \n\nDave",
    "created_at": "2010-07-16T00:11:27Z",
    "issue": "https://github.com/sagemath/sage/issues/9368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9368#issuecomment-81706",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:22'></a>
Replying to [drkirkby](#comment%3A21):

> But can you explain how ATLAS, Numpy and Linbox built, when I clearly see the sage_fortran script had in it
> 
> ```
> #!/bin/sh
> ```
> 
> ? 
> 
> I'm not wrong about the contents of the file. It **did** have that in it. 
> 
> Dave 

I realise I was mistaken here. Justin is almost certainly right when he says the lack of a new line in the file can fool the eye into believing that the contents of the file are just

```
#!/bin/sh
```  

when in fact there is more to it. This is how it looks on my screen - it is easy to see that this could be confusing. 

```
drkirkby@hawk:~/sage-4.5.rc0$ cat local/bin/sage_fortran
#!/bin/sh 

/usr/local/gcc-4.4.4-multilib/bin/gfortran -m64 -fPIC $@drkirkby@hawk:~/sage-4.5.rc0$ 
```


I'm glad I was wrong about this. 

Dave
