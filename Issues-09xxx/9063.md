# Issue 9063: wrong type for denominator

archive/issues_009063.json:
```json
{
    "assignees": [],
    "body": "If you create a polynomial in one variable over a finite field and ask for the denominator, then the answer you get has the wrong type when the polynomial is the zero polynomial.  Here's an example:\n\n```\nsage: R.<t> = GF(5)['t']\nsage: x = R(0)\nsage: type(x.denominator())\n<type 'int'>\n```\n\nAssignee: **@aghitza**\n\nAuthor: **Luis Felipe Tabera Alonso**\n\nReviewer: **John Cremona, Aly Deines**\n\nMerged: **sage-4.6.2.alpha1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/9063_\n\n",
    "closed_at": "2011-01-19T22:20:03Z",
    "created_at": "2010-05-27T06:51:35Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20algebra",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.6.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "wrong type for denominator",
    "type": "issue",
    "updated_at": "2011-01-19T22:20:03Z",
    "url": "https://github.com/sagemath/sage/issues/9063",
    "user": "https://github.com/sagetrac-cjh"
}
```
If you create a polynomial in one variable over a finite field and ask for the denominator, then the answer you get has the wrong type when the polynomial is the zero polynomial.  Here's an example:

```
sage: R.<t> = GF(5)['t']
sage: x = R(0)
sage: type(x.denominator())
<type 'int'>
```

Assignee: **@aghitza**

Author: **Luis Felipe Tabera Alonso**

Reviewer: **John Cremona, Aly Deines**

Merged: **sage-4.6.2.alpha1**

_Issue created by migration from https://trac.sagemath.org/ticket/9063_





---

archive/issue_events_105136.json:
```json
{
    "actor": "https://github.com/sagetrac-cjh",
    "created_at": "2010-05-27T06:51:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "milestone_number": null,
    "milestone_title": "sage-4.6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105136"
}
```



---

archive/issue_events_105137.json:
```json
{
    "actor": "https://github.com/sagetrac-cjh",
    "created_at": "2010-05-27T06:51:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "component: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105137"
}
```



---

archive/issue_events_105138.json:
```json
{
    "actor": "https://github.com/sagetrac-cjh",
    "created_at": "2010-05-27T06:51:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105138"
}
```



---

archive/issue_events_105139.json:
```json
{
    "actor": "https://github.com/sagetrac-cjh",
    "created_at": "2010-05-27T06:51:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105139"
}
```



---

archive/issue_comments_076823.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nIf the element of the ring is zero or the base_ring does not have a denominator function, the code returned the \"wrong 1\", either int 1 or polynomial 1. The patch correct this.",
    "created_at": "2010-06-23T13:42:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76823",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:1'>Comment 1:</a>
If the element of the ring is zero or the base_ring does not have a denominator function, the code returned the "wrong 1", either int 1 or polynomial 1. The patch correct this.



---

archive/issue_events_105140.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-06-23T13:42:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105140"
}
```



---

archive/issue_comments_076824.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nAttachment: **[trac_9063.patch.gz](https://github.com/sagemath/sage/files/ticket9063/trac_9063.patch.gz)**\n\nCorrected a typo in documentation",
    "created_at": "2010-06-24T11:26:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76824",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:2'>Comment 2:</a>
Attachment: **[trac_9063.patch.gz](https://github.com/sagemath/sage/files/ticket9063/trac_9063.patch.gz)**

Corrected a typo in documentation



---

archive/issue_comments_076825.json:
```json
{
    "body": "Author: **Luis Felipe Tabera Alonso**",
    "created_at": "2010-06-29T16:58:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76825",
    "user": "https://github.com/lftabera"
}
```

Author: **Luis Felipe Tabera Alonso**



---

archive/issue_events_105141.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-08-18T12:26:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105141"
}
```



---

archive/issue_events_105142.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-08-18T12:26:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105142"
}
```



---

archive/issue_comments_076826.json:
```json
{
    "body": "Reviewer: **John Cremona**",
    "created_at": "2010-08-18T12:26:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76826",
    "user": "https://github.com/JohnCremona"
}
```

Reviewer: **John Cremona**



---

archive/issue_comments_076827.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nThis looks good to me.  It applied ok to 4.5.3.alpha1, and all (long) tests pass, except for one:\n\n```\n\nsage -t -long \"sage/matrix/matrix2.pyx\"                     \n**********************************************************************\nFile \"/storage/jec/sage-4.5.3.alpha1/devel/sage-tests/sage/matrix/matrix2.pyx\", line 4665:\n    sage: M.weak_popov_form()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/jec/sage-current/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/jec/sage-current/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/jec/sage-current/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_68[7]>\", line 1, in <module>\n        M.weak_popov_form()###line 4665:\n    sage: M.weak_popov_form()\n      File \"matrix2.pyx\", line 4748, in sage.matrix.matrix2.Matrix.weak_popov_form (sage/matrix/matrix2.c:26417)\n        ::\n      File \"/home/jec/sage-current/local/lib/python/site-packages/sage/matrix/matrix_misc.py\", line 90, in weak_popov_form\n        den = R(lcm([a.denominator() for a in M.list()]))\n      File \"/home/jec/sage-current/local/lib/python/site-packages/sage/rings/arith.py\", line 1527, in lcm\n        return __LCM_sequence(seq)\n      File \"/home/jec/sage-current/local/lib/python/site-packages/sage/rings/arith.py\", line 1583, in __LCM_sequence\n        g = vi.lcm(g)\n      File \"element.pyx\", line 306, in sage.structure.element.Element.__getattr__ (sage/structure/element.c:2632)\n        return getattr_from_other_class(self, self.parent().category().element_class, name)\n      File \"parent.pyx\", line 268, in sage.structure.parent.getattr_from_other_class (sage/structure/parent.c:2835)\n        raise_attribute_error(self, name)\n      File \"parent.pyx\", line 170, in sage.structure.parent.raise_attribute_error (sage/structure/parent.c:2602)\n        raise AttributeError, \"'%s.%s' object has no attribute '%s'\"%(cls.__module__, cls.__name__, name)\n    AttributeError: 'sage.rings.finite_rings.integer_mod.IntegerMod_int' object has no attribute 'lcm'\n**********************************************************************\n1 items had failures:\n```\n\nThe problem is in the function weak_popov_form() in sage/rings/matrix/matrix_misc.py  (which was only merged into Sage receontly -- and I was, by chance, its reviewer).  There one has matrices of polynomials over fields and the code tries to clear denominators, by forming the LCM of the denominators;  and that now fails when those denominators are all equal to 1 in a finite field!\n\nRather than mess with the weakpopov form code, this could be solved if there was an lcm function for finite field elements which always returned 1 (except lcm(0,0)=0, perhaps).",
    "created_at": "2010-08-18T12:26:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76827",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:4'>Comment 4:</a>
This looks good to me.  It applied ok to 4.5.3.alpha1, and all (long) tests pass, except for one:

```

sage -t -long "sage/matrix/matrix2.pyx"                     
**********************************************************************
File "/storage/jec/sage-4.5.3.alpha1/devel/sage-tests/sage/matrix/matrix2.pyx", line 4665:
    sage: M.weak_popov_form()
Exception raised:
    Traceback (most recent call last):
      File "/home/jec/sage-current/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/jec/sage-current/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/jec/sage-current/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_68[7]>", line 1, in <module>
        M.weak_popov_form()###line 4665:
    sage: M.weak_popov_form()
      File "matrix2.pyx", line 4748, in sage.matrix.matrix2.Matrix.weak_popov_form (sage/matrix/matrix2.c:26417)
        ::
      File "/home/jec/sage-current/local/lib/python/site-packages/sage/matrix/matrix_misc.py", line 90, in weak_popov_form
        den = R(lcm([a.denominator() for a in M.list()]))
      File "/home/jec/sage-current/local/lib/python/site-packages/sage/rings/arith.py", line 1527, in lcm
        return __LCM_sequence(seq)
      File "/home/jec/sage-current/local/lib/python/site-packages/sage/rings/arith.py", line 1583, in __LCM_sequence
        g = vi.lcm(g)
      File "element.pyx", line 306, in sage.structure.element.Element.__getattr__ (sage/structure/element.c:2632)
        return getattr_from_other_class(self, self.parent().category().element_class, name)
      File "parent.pyx", line 268, in sage.structure.parent.getattr_from_other_class (sage/structure/parent.c:2835)
        raise_attribute_error(self, name)
      File "parent.pyx", line 170, in sage.structure.parent.raise_attribute_error (sage/structure/parent.c:2602)
        raise AttributeError, "'%s.%s' object has no attribute '%s'"%(cls.__module__, cls.__name__, name)
    AttributeError: 'sage.rings.finite_rings.integer_mod.IntegerMod_int' object has no attribute 'lcm'
**********************************************************************
1 items had failures:
```

The problem is in the function weak_popov_form() in sage/rings/matrix/matrix_misc.py  (which was only merged into Sage receontly -- and I was, by chance, its reviewer).  There one has matrices of polynomials over fields and the code tries to clear denominators, by forming the LCM of the denominators;  and that now fails when those denominators are all equal to 1 in a finite field!

Rather than mess with the weakpopov form code, this could be solved if there was an lcm function for finite field elements which always returned 1 (except lcm(0,0)=0, perhaps).



---

archive/issue_comments_076828.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nWell, \n\nThe issue of adding a lcm function for finite fields has some problems associated:\n\n- Except is degenerate cases, all elements are units, so the lcm being 1 is not nonsense.\n\n- The problem is that currently, sage already does some lcm for finite fields if the elements can be coerced to ZZ.\n\n```\nsage: m = GF(5)\nsage: a= m(4)\nsage: lcm(a,a)\n4\n```\n\nSo this approach will add a backwards incompatibility at least.",
    "created_at": "2010-08-26T09:18:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76828",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:5'>Comment 5:</a>
Well, 

The issue of adding a lcm function for finite fields has some problems associated:

- Except is degenerate cases, all elements are units, so the lcm being 1 is not nonsense.

- The problem is that currently, sage already does some lcm for finite fields if the elements can be coerced to ZZ.

```
sage: m = GF(5)
sage: a= m(4)
sage: lcm(a,a)
4
```

So this approach will add a backwards incompatibility at least.



---

archive/issue_comments_076829.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nReplying to [@lftabera](#comment%3A5):\n> Well, \n> \n> The issue of adding a lcm function for finite fields has some problems associated:\n> \n> - Except is degenerate cases, all elements are units, so the lcm being 1 is not nonsense.\n> \n> - The problem is that currently, sage already does some lcm for finite fields if the elements can be coerced to ZZ.\n> \n> ```\n> sage: m = GF(5)\n> sage: a= m(4)\n> sage: lcm(a,a)\n> 4\n> ```\n> \n> So this approach will add a backwards incompatibility at least.\n\nWell spotted!  I think that this current behavour is a bug:\n\n```\nsage: a = GF(5)(4)\nsage: type(a)\n<type 'sage.rings.finite_rings.integer_mod.IntegerMod_int'>\nsage: lcm(a,a)\n4\nsage: type(lcm(a,a))\n<type 'sage.rings.integer.Integer'>\n```\nsince it makes no mathematical sense at all.  It's the same for gcd:\n\n```\nsage: gcd(a,a)\n4\nsage: type(gcd(a,a))\n<type 'sage.rings.integer.Integer'>\n```\nBoth of these would not happen if finite field elements have gcd and lcm methods, and in my opinion that would be better.\n\nSomeone should try to implement this and do a full test to see if any existing code (tests) is broken.  I hope not -- I cannot imagine anyone relying on this rather crazy behaviour.",
    "created_at": "2010-08-26T09:29:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76829",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:6'>Comment 6:</a>
Replying to [@lftabera](#comment%3A5):
> Well, 
> 
> The issue of adding a lcm function for finite fields has some problems associated:
> 
> - Except is degenerate cases, all elements are units, so the lcm being 1 is not nonsense.
> 
> - The problem is that currently, sage already does some lcm for finite fields if the elements can be coerced to ZZ.
> 
> ```
> sage: m = GF(5)
> sage: a= m(4)
> sage: lcm(a,a)
> 4
> ```
> 
> So this approach will add a backwards incompatibility at least.

Well spotted!  I think that this current behavour is a bug:

```
sage: a = GF(5)(4)
sage: type(a)
<type 'sage.rings.finite_rings.integer_mod.IntegerMod_int'>
sage: lcm(a,a)
4
sage: type(lcm(a,a))
<type 'sage.rings.integer.Integer'>
```
since it makes no mathematical sense at all.  It's the same for gcd:

```
sage: gcd(a,a)
4
sage: type(gcd(a,a))
<type 'sage.rings.integer.Integer'>
```
Both of these would not happen if finite field elements have gcd and lcm methods, and in my opinion that would be better.

Someone should try to implement this and do a full test to see if any existing code (tests) is broken.  I hope not -- I cannot imagine anyone relying on this rather crazy behaviour.



---

archive/issue_comments_076830.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nI have added a new bug dealing with the issue of lcm. So this bug now depends on #9819",
    "created_at": "2010-08-27T10:56:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76830",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:7'>Comment 7:</a>
I have added a new bug dealing with the issue of lcm. So this bug now depends on #9819



---

archive/issue_comments_076831.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nReplying to [@lftabera](#comment%3A7):\n> I have added a new bug dealing with the issue of lcm. So this bug now depends on #9819\n\nI hope you do not mean exactly what you wrote!",
    "created_at": "2010-08-27T11:39:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76831",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:8'>Comment 8:</a>
Replying to [@lftabera](#comment%3A7):
> I have added a new bug dealing with the issue of lcm. So this bug now depends on #9819

I hope you do not mean exactly what you wrote!



---

archive/issue_comments_076832.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@JohnCremona](#comment%3A8):\n> Replying to [@lftabera](#comment%3A7):\n> > I have added a new bug dealing with the issue of lcm. So this bug now depends on #9819\n\n> \n> I hope you do not mean exactly what you wrote!\n\nWhat do you exactly mean? I think this is the correct wayy to go. The problem may be solved by a workaround on weak_popov_form, but surely will appear on other instances of fields or other methods that may be added in the future.",
    "created_at": "2010-09-01T07:53:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76832",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@JohnCremona](#comment%3A8):
> Replying to [@lftabera](#comment%3A7):
> > I have added a new bug dealing with the issue of lcm. So this bug now depends on #9819

> 
> I hope you do not mean exactly what you wrote!

What do you exactly mean? I think this is the correct wayy to go. The problem may be solved by a workaround on weak_popov_form, but surely will appear on other instances of fields or other methods that may be added in the future.



---

archive/issue_comments_076833.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nAttachment: **[weak-popof-form.patch.gz](https://github.com/sagemath/sage/files/ticket9063/weak-popof-form.patch.gz)**\n\nI have attached another patch that solves the problem in weak_popov_form.\n\nI follow the python mantra of 'explicit better than implicit'. The algorithm expects as entries a matrix with rational functions as entries.\n\nIf the entries are polynomials, then the algorithm may fail because the denominators will be elements in a field and currently sage does not consider this case for all fields.\n\nNow, the algorithm first transforms the input matrix to a matrix with rational functions as entries which is the domain the algorithm is expected to work. The denominators will then be polynomials and the algorithm will work as expected.\n\nI have added a doctest to check that the output is the same in the polynomial and rational function case.\n\nAs a side effect, I correct a typo in the documentation of weak_popov_form. The documentation asserts that the output is (W, N, t) where W and N are matrices of rational functions. In fact, N is a matrix of polynomials.\n\nBoth patches can be applied in any order. With this patch bug #9819 does not apply.",
    "created_at": "2010-09-03T11:37:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76833",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:10'>Comment 10:</a>
Attachment: **[weak-popof-form.patch.gz](https://github.com/sagemath/sage/files/ticket9063/weak-popof-form.patch.gz)**

I have attached another patch that solves the problem in weak_popov_form.

I follow the python mantra of 'explicit better than implicit'. The algorithm expects as entries a matrix with rational functions as entries.

If the entries are polynomials, then the algorithm may fail because the denominators will be elements in a field and currently sage does not consider this case for all fields.

Now, the algorithm first transforms the input matrix to a matrix with rational functions as entries which is the domain the algorithm is expected to work. The denominators will then be polynomials and the algorithm will work as expected.

I have added a doctest to check that the output is the same in the polynomial and rational function case.

As a side effect, I correct a typo in the documentation of weak_popov_form. The documentation asserts that the output is (W, N, t) where W and N are matrices of rational functions. In fact, N is a matrix of polynomials.

Both patches can be applied in any order. With this patch bug #9819 does not apply.



---

archive/issue_events_105143.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-09-03T11:37:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105143"
}
```



---

archive/issue_events_105144.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-09-03T11:37:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105144"
}
```



---

archive/issue_events_105145.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-09-25T18:46:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105145"
}
```



---

archive/issue_events_105146.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-09-25T18:46:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105146"
}
```



---

archive/issue_comments_076834.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nAFAICT, the `weak_popov_form` function clears the denominators to work over the polynomial ring instead of the fraction field. When a matrix over the polynomial ring is given, it seems inefficient to first coerce all entries to the fraction field, then find the denominator `1` and go back to the polynomials we were given.\n\nCan't we just avoid clearing the denominators if `R` (in the first line) is a field (and not call `lcm()`)?",
    "created_at": "2010-09-25T18:46:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76834",
    "user": "https://github.com/burcin"
}
```

<a id='comment:11'>Comment 11:</a>
AFAICT, the `weak_popov_form` function clears the denominators to work over the polynomial ring instead of the fraction field. When a matrix over the polynomial ring is given, it seems inefficient to first coerce all entries to the fraction field, then find the denominator `1` and go back to the polynomials we were given.

Can't we just avoid clearing the denominators if `R` (in the first line) is a field (and not call `lcm()`)?



---

archive/issue_comments_076835.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nAttachment: **[weak-popof-form.2.patch.gz](https://github.com/sagemath/sage/files/ticket9063/weak-popof-form.2.patch.gz)**\n\nI have added a new patch to weak_popov_form so it does not perform any cleaning of denominadors when the matrix has polynomial entries.\n\nApply:\n\n\ntrac_9063.patch\n\nweak-popof-form.2.patch\n\nIn any order",
    "created_at": "2010-10-08T16:08:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76835",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:12'>Comment 12:</a>
Attachment: **[weak-popof-form.2.patch.gz](https://github.com/sagemath/sage/files/ticket9063/weak-popof-form.2.patch.gz)**

I have added a new patch to weak_popov_form so it does not perform any cleaning of denominadors when the matrix has polynomial entries.

Apply:


trac_9063.patch

weak-popof-form.2.patch

In any order



---

archive/issue_events_105147.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-10-08T16:15:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105147"
}
```



---

archive/issue_events_105148.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-10-08T16:15:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105148"
}
```



---

archive/issue_comments_076836.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nfailed on coverage for both files \n\n./sage -coverage sage/rings/polynomial/multi_polynomial.pyx\n\n---\nsage/rings/polynomial/multi_polynomial.pyx\nERROR: Please add a `TestSuite(s).run()` doctest.\nSCORE sage/rings/polynomial/multi_polynomial.pyx: 89% (33 of 37)\n\nMissing documentation:\n* is_MPolynomial(x):\n* _polynomial_(self, R):\n* __hash__(self):\n\n\nMissing doctests:\n* truncate(self, var, n):\n\n---\n\n./sage -coverage sage/matrix/matrix2.pyx ----------------------------------------------------------------------\nsage/matrix/matrix2.pyx\nSCORE sage/matrix/matrix2.pyx: 92% (104 of 112)\n\nMissing documentation:\n* _row_ambient_module(self, base_ring=None):\n* _column_ambient_module(self):\n* _decomposition_using_kernels(self, is_diagonalizable=False, dual=False):\n\n\nMissing doctests:\n* _decomposition_spin_generic(self, is_diagonalizable=False):\n* eigenspaces(self, var='a', even_if_inexact=None):\n* _echelon_classical(self):\n* _cholesky_decomposition_(self):\n* cmp_pivots(x,y):\n\n---",
    "created_at": "2011-01-08T02:29:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76836",
    "user": "https://github.com/sagetrac-gagansekhon"
}
```

<a id='comment:14'>Comment 14:</a>
failed on coverage for both files 

./sage -coverage sage/rings/polynomial/multi_polynomial.pyx

---
sage/rings/polynomial/multi_polynomial.pyx
ERROR: Please add a `TestSuite(s).run()` doctest.
SCORE sage/rings/polynomial/multi_polynomial.pyx: 89% (33 of 37)

Missing documentation:
* is_MPolynomial(x):
* _polynomial_(self, R):
* __hash__(self):


Missing doctests:
* truncate(self, var, n):

---

./sage -coverage sage/matrix/matrix2.pyx ----------------------------------------------------------------------
sage/matrix/matrix2.pyx
SCORE sage/matrix/matrix2.pyx: 92% (104 of 112)

Missing documentation:
* _row_ambient_module(self, base_ring=None):
* _column_ambient_module(self):
* _decomposition_using_kernels(self, is_diagonalizable=False, dual=False):


Missing doctests:
* _decomposition_spin_generic(self, is_diagonalizable=False):
* eigenspaces(self, var='a', even_if_inexact=None):
* _echelon_classical(self):
* _cholesky_decomposition_(self):
* cmp_pivots(x,y):

---



---

archive/issue_events_105149.json:
```json
{
    "actor": "https://github.com/sagetrac-gagansekhon",
    "created_at": "2011-01-08T02:29:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105149"
}
```



---

archive/issue_events_105150.json:
```json
{
    "actor": "https://github.com/sagetrac-gagansekhon",
    "created_at": "2011-01-08T02:29:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105150"
}
```



---

archive/issue_events_105151.json:
```json
{
    "actor": "https://github.com/sagetrac-gagansekhon",
    "created_at": "2011-01-08T02:58:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105151"
}
```



---

archive/issue_events_105152.json:
```json
{
    "actor": "https://github.com/sagetrac-gagansekhon",
    "created_at": "2011-01-08T02:58:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105152"
}
```



---

archive/issue_comments_076837.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nSorry, I was following developers guide, which stated if coverage is less than 100% than it needs work. However, given the functions that you changed are not the ones where coverage failed, I put it back to needs_review. I will be running other test now",
    "created_at": "2011-01-08T02:58:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76837",
    "user": "https://github.com/sagetrac-gagansekhon"
}
```

<a id='comment:15'>Comment 15:</a>
Sorry, I was following developers guide, which stated if coverage is less than 100% than it needs work. However, given the functions that you changed are not the ones where coverage failed, I put it back to needs_review. I will be running other test now



---

archive/issue_events_105153.json:
```json
{
    "actor": "https://github.com/adeines",
    "created_at": "2011-01-10T20:00:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105153"
}
```



---

archive/issue_events_105154.json:
```json
{
    "actor": "https://github.com/adeines",
    "created_at": "2011-01-10T20:00:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105154"
}
```



---

archive/issue_comments_076838.json:
```json
{
    "body": "Changed reviewer from **John Cremona** to **John Cremona, Aly Deines**",
    "created_at": "2011-01-10T20:00:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76838",
    "user": "https://github.com/adeines"
}
```

Changed reviewer from **John Cremona** to **John Cremona, Aly Deines**



---

archive/issue_comments_076839.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nLooks good to me.",
    "created_at": "2011-01-10T20:00:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76839",
    "user": "https://github.com/adeines"
}
```

<a id='comment:16'>Comment 16:</a>
Looks good to me.



---

archive/issue_events_105155.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-10T21:10:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "milestone_number": null,
    "milestone_title": "sage-4.6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105155"
}
```



---

archive/issue_events_105156.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-10T21:10:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "milestone_number": null,
    "milestone_title": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105156"
}
```



---

archive/issue_comments_076840.json:
```json
{
    "body": "Changed reviewer from **John Cremona, Aly Deines** to **John Cremona, Alyson Deines**",
    "created_at": "2011-01-13T05:35:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76840",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **John Cremona, Aly Deines** to **John Cremona, Alyson Deines**



---

archive/issue_comments_076841.json:
```json
{
    "body": "Changed reviewer from **John Cremona, Alyson Deines** to **John Cremona, Aly Deines**",
    "created_at": "2011-01-13T06:40:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76841",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **John Cremona, Alyson Deines** to **John Cremona, Aly Deines**



---

archive/issue_comments_076842.json:
```json
{
    "body": "Merged: **sage-4.6.2.alpha1**",
    "created_at": "2011-01-19T22:20:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9063#issuecomment-76842",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.6.2.alpha1**



---

archive/issue_events_105157.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-19T22:20:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105157"
}
```



---

archive/issue_events_105158.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-19T22:20:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9063",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9063#event-105158"
}
```
