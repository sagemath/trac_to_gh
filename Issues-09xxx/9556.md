# Issue 9556: Dynamic attributes for symbolic expressions

archive/issues_009556.json:
```json
{
    "assignees": [],
    "body": "Let `e` be a symbolic expression. It may happen that `e.operator()` has a certain callable attribute, say, `foo`, that is not a method of `Function`. In this situation, one would like to use `e.foo()`, which is supposed to return `e.operator().foo(*e.operands())` - apparently this is useful for working with hypergeometric functions (#2516).\n\n**__Example__**\n\n```\n       sage: from sage.symbolic.function import BuiltinFunction\n        sage: class TFunc(BuiltinFunction):\n        ....:     def __init__(self):\n        ....:         BuiltinFunction.__init__(self, 'tfunc', nargs=1)\n        ....:\n        ....:     class EvaluationMethods:\n        ....:         def argp1(self, x):\n        ....:             '''\n        ....:             Some documentation about a bogus function.\n        ....:             '''\n        ....:             return x+1\n        ....:\n        ....:         @property\n        ....:         def foo(self):\n        ....:             return 5\n        ....:\n        sage: tfunc = TFunc()\n        sage: e = tfunc(x); e\n        tfunc(x)\n        sage: type(e)\n        <class '__main__.Expression_with_dynamic_methods'>\n        sage: e.argp1()\n        x + 1\n        sage: e.foo\n        5\n        sage: x.argp1()\n        Traceback (most recent call last):\n        ...\n        AttributeError: 'sage.symbolic.expression.Expression' object has no\n        attribute 'argp1'\n        sage: t = (e + 1).op[0]; t\n        tfunc(x)\n        sage: t\n        tfunc(x)\n        sage: type(t)\n        <class '__main__.Expression_with_dynamic_methods'>\n        sage: t.argp1()\n        x + 1\n        sage: import sagenb.misc.support as s\n        sage: s.completions('t.argp', globals(), system='python')\n        ['t.argp1']\n        sage: t.argp1.__doc__.strip()\n        'Some documentation about a bogus function.'\n```\n\nApply: [attachment: trac_9556-dynamic_class_everywhere.patch](https://github.com/sagemath/sage/files/ticket9556/trac_9556-dynamic_class_everywhere.patch.gz)\n\nCC:  @burcin @kcrisman @vbraun @eviatarbach\n\nComponent: **symbolics**\n\nKeywords: **symbolic expression dynamic attribute sd48**\n\nAuthor: **Burcin Erocal, Simon King, Mike Hansen**\n\nReviewer: **Volker Braun**\n\nMerged: **sage-5.11.beta3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/9556_\n\n",
    "closed_at": "2013-06-20T21:33:53Z",
    "created_at": "2010-07-20T12:21:13Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.11",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Dynamic attributes for symbolic expressions",
    "type": "issue",
    "updated_at": "2016-06-14T14:36:48Z",
    "url": "https://github.com/sagemath/sage/issues/9556",
    "user": "https://github.com/simon-king-jena"
}
```
Let `e` be a symbolic expression. It may happen that `e.operator()` has a certain callable attribute, say, `foo`, that is not a method of `Function`. In this situation, one would like to use `e.foo()`, which is supposed to return `e.operator().foo(*e.operands())` - apparently this is useful for working with hypergeometric functions (#2516).

**__Example__**

```
       sage: from sage.symbolic.function import BuiltinFunction
        sage: class TFunc(BuiltinFunction):
        ....:     def __init__(self):
        ....:         BuiltinFunction.__init__(self, 'tfunc', nargs=1)
        ....:
        ....:     class EvaluationMethods:
        ....:         def argp1(self, x):
        ....:             '''
        ....:             Some documentation about a bogus function.
        ....:             '''
        ....:             return x+1
        ....:
        ....:         @property
        ....:         def foo(self):
        ....:             return 5
        ....:
        sage: tfunc = TFunc()
        sage: e = tfunc(x); e
        tfunc(x)
        sage: type(e)
        <class '__main__.Expression_with_dynamic_methods'>
        sage: e.argp1()
        x + 1
        sage: e.foo
        5
        sage: x.argp1()
        Traceback (most recent call last):
        ...
        AttributeError: 'sage.symbolic.expression.Expression' object has no
        attribute 'argp1'
        sage: t = (e + 1).op[0]; t
        tfunc(x)
        sage: t
        tfunc(x)
        sage: type(t)
        <class '__main__.Expression_with_dynamic_methods'>
        sage: t.argp1()
        x + 1
        sage: import sagenb.misc.support as s
        sage: s.completions('t.argp', globals(), system='python')
        ['t.argp1']
        sage: t.argp1.__doc__.strip()
        'Some documentation about a bogus function.'
```

Apply: [attachment: trac_9556-dynamic_class_everywhere.patch](https://github.com/sagemath/sage/files/ticket9556/trac_9556-dynamic_class_everywhere.patch.gz)

CC:  @burcin @kcrisman @vbraun @eviatarbach

Component: **symbolics**

Keywords: **symbolic expression dynamic attribute sd48**

Author: **Burcin Erocal, Simon King, Mike Hansen**

Reviewer: **Volker Braun**

Merged: **sage-5.11.beta3**

_Issue created by migration from https://trac.sagemath.org/ticket/9556_





---

archive/issue_events_121912.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-07-20T12:21:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9556#event-121912"
}
```



---

archive/issue_events_121913.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-07-20T12:21:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9556#event-121913"
}
```



---

archive/issue_events_121914.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-07-20T12:21:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9556#event-121914"
}
```



---

archive/issue_events_121915.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-07-20T12:21:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9556#event-121915"
}
```



---

archive/issue_comments_082870.json:
```json
{
    "body": "The patch implements dynamic attributes, but some doctests segfault",
    "created_at": "2010-07-20T12:26:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82870",
    "user": "https://github.com/simon-king-jena"
}
```

The patch implements dynamic attributes, but some doctests segfault



---

archive/issue_comments_082871.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[trac-9556_dynamic_attributes_symbolics.patch.gz](https://github.com/sagemath/sage/files/ticket9556/trac-9556_dynamic_attributes_symbolics.patch.gz)**",
    "created_at": "2010-07-20T12:26:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82871",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[trac-9556_dynamic_attributes_symbolics.patch.gz](https://github.com/sagemath/sage/files/ticket9556/trac-9556_dynamic_attributes_symbolics.patch.gz)**



---

archive/issue_comments_082872.json:
```json
{
    "body": "Work Issues: **segfaulting doctests**",
    "created_at": "2010-07-20T12:30:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82872",
    "user": "https://github.com/simon-king-jena"
}
```

Work Issues: **segfaulting doctests**



---

archive/issue_events_121916.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-07-20T12:30:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9556#event-121916"
}
```



---

archive/issue_comments_082873.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nSorry, accidentally I inserted the work issue \"segfaulting doctests\" into the owner field.\n\nIt would be nice to have a segfaulting example that works interactively.",
    "created_at": "2010-07-20T12:30:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82873",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:2" align="right">comment:2</div>

Sorry, accidentally I inserted the work issue "segfaulting doctests" into the owner field.

It would be nice to have a segfaulting example that works interactively.



---

archive/issue_comments_082874.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nWhat is the typical use case for this?  Are you just looking for a place to put the functions for evaluated function?  Or do you really want the function to appear on both the function and its evaluations?  It seems like the first case is what you really want.\n\nWe currently have all of the machinery to do this and it's used for the category code.  Using this, you would have something like the following:\n\n```\nclass ExampleBuiltin(BuiltinFunction):\n    def __init__(self):\n        BuiltinFunction.__init__(self, 'ex_func', nargs=0) #arbitrary no of args\n \n    class EvaluationMethods:\n        def some_function_name(self):\n            return len(self.operands())\n```",
    "created_at": "2010-07-20T13:01:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82874",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:3" align="right">comment:3</div>

What is the typical use case for this?  Are you just looking for a place to put the functions for evaluated function?  Or do you really want the function to appear on both the function and its evaluations?  It seems like the first case is what you really want.

We currently have all of the machinery to do this and it's used for the category code.  Using this, you would have something like the following:

```
class ExampleBuiltin(BuiltinFunction):
    def __init__(self):
        BuiltinFunction.__init__(self, 'ex_func', nargs=0) #arbitrary no of args
 
    class EvaluationMethods:
        def some_function_name(self):
            return len(self.operands())
```



---

archive/issue_comments_082875.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI did a little mockup using this idea.\n\n```\n\nsage: from sage.symbolic.function import BuiltinFunction\nsage: class ExampleBuiltin(BuiltinFunction):\n....:         def __init__(self):\n....:             BuiltinFunction.__init__(self, 'ex_func', nargs=0) #arbitrary no of args\n....:     class EvaluationMethods:\n....:             def some_function_name(self):\n....:                 return len(self.operands())\n....: \nsage: ex_func = ExampleBuiltin()\nsage: f = ex_func(x, x+1, x+2)\nsage: f.some_function_name()\n3\nsage: abs(f)\nabs(ex_func(x, x + 1, x + 2))\n```",
    "created_at": "2010-07-20T13:45:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82875",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:4" align="right">comment:4</div>

I did a little mockup using this idea.

```

sage: from sage.symbolic.function import BuiltinFunction
sage: class ExampleBuiltin(BuiltinFunction):
....:         def __init__(self):
....:             BuiltinFunction.__init__(self, 'ex_func', nargs=0) #arbitrary no of args
....:     class EvaluationMethods:
....:             def some_function_name(self):
....:                 return len(self.operands())
....: 
sage: ex_func = ExampleBuiltin()
sage: f = ex_func(x, x+1, x+2)
sage: f.some_function_name()
3
sage: abs(f)
abs(ex_func(x, x + 1, x + 2))
```



---

archive/issue_comments_082876.json:
```json
{
    "body": "Attachment: **[trac_9556-dynamic_class.patch.gz](https://github.com/sagemath/sage/files/ticket9556/trac_9556-dynamic_class.patch.gz)**",
    "created_at": "2010-07-20T14:22:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82876",
    "user": "https://github.com/mwhansen"
}
```

Attachment: **[trac_9556-dynamic_class.patch.gz](https://github.com/sagemath/sage/files/ticket9556/trac_9556-dynamic_class.patch.gz)**



---

archive/issue_comments_082877.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nNote that pickling also works:\n\n```\nsage: loads(dumps(ceil(x))).foo_bar()\n4\n```\n\nOne issue is that in order to get the dynamic features, you have to go through the `__call__` method of the function.  Thus, you'd have to change Expression.__abs__\n\n```\n        return new_Expression_from_GEx(self._parent, g_abs(self._gobj))\n```\n\nto return the dynamic class version.  Similarly, unpickling old objects will just return an Expression object.",
    "created_at": "2010-07-20T14:27:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82877",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:5" align="right">comment:5</div>

Note that pickling also works:

```
sage: loads(dumps(ceil(x))).foo_bar()
4
```

One issue is that in order to get the dynamic features, you have to go through the `__call__` method of the function.  Thus, you'd have to change Expression.__abs__

```
        return new_Expression_from_GEx(self._parent, g_abs(self._gobj))
```

to return the dynamic class version.  Similarly, unpickling old objects will just return an Expression object.



---

archive/issue_comments_082878.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAlso, all tests pass with this.",
    "created_at": "2010-07-20T14:27:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82878",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:6" align="right">comment:6</div>

Also, all tests pass with this.



---

archive/issue_comments_082879.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@mwhansen](#comment%3A3):\n> What is the typical use case for this?  Are you just looking for a place to put the functions for evaluated function?  Or do you really want the function to appear on both the function and its evaluations? \n\nSorry that I was absent for some hours. \n\nUnfortunately I don't know what the real use case is. It was a suggestion of Burcin, and I merely tried to implement what he suggested. \n\nBurcin, could you comment on what is really expected?",
    "created_at": "2010-07-20T19:32:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82879",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@mwhansen](#comment%3A3):
> What is the typical use case for this?  Are you just looking for a place to put the functions for evaluated function?  Or do you really want the function to appear on both the function and its evaluations? 

Sorry that I was absent for some hours. 

Unfortunately I don't know what the real use case is. It was a suggestion of Burcin, and I merely tried to implement what he suggested. 

Burcin, could you comment on what is really expected?



---

archive/issue_comments_082880.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@mwhansen](#comment%3A4):\n> I did a little mockup using this idea.\n> \n> sage: f = ex_func(x, x+1, x+2)\n> sage: f.some_function_name()\n> 3\n> sage: abs(f)\n> abs(ex_func(x, x + 1, x + 2))\n\n... which seems like the correct answer to me. So, the fact that `ex_func` has an `_abs_` method helps to get the right answer for `f`.",
    "created_at": "2010-07-20T19:35:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82880",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@mwhansen](#comment%3A4):
> I did a little mockup using this idea.
> 
> sage: f = ex_func(x, x+1, x+2)
> sage: f.some_function_name()
> 3
> sage: abs(f)
> abs(ex_func(x, x + 1, x + 2))

... which seems like the correct answer to me. So, the fact that `ex_func` has an `_abs_` method helps to get the right answer for `f`.



---

archive/issue_comments_082881.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI uploaded a new patch that uses Mike's dynamic class idea, but applies to all code paths that might generate symbolic expressions with minimal speed penalty. Please review.\n\nPatchbot, apply only [attachment: trac_9556-dynamic_class_everywhere.patch](https://github.com/sagemath/sage/files/ticket9556/trac_9556-dynamic_class_everywhere.patch.gz).",
    "created_at": "2013-06-19T18:05:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82881",
    "user": "https://github.com/burcin"
}
```

<div id="comment:10" align="right">comment:10</div>

I uploaded a new patch that uses Mike's dynamic class idea, but applies to all code paths that might generate symbolic expressions with minimal speed penalty. Please review.

Patchbot, apply only [attachment: trac_9556-dynamic_class_everywhere.patch](https://github.com/sagemath/sage/files/ticket9556/trac_9556-dynamic_class_everywhere.patch.gz).



---

archive/issue_events_121917.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2013-06-19T18:05:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9556#event-121917"
}
```



---

archive/issue_events_121918.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2013-06-19T18:05:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9556#event-121918"
}
```



---

archive/issue_comments_082882.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,78 +1,51 @@\n-Let `e` be a symbolic expression. It may happen that `e.operator()` has a certain callable attribute, say, `foo`, that is not a method of `Function`. In this situation, one would like to use `e.foo()`, which is supposed to return `e.operator().foo(*e.operands())` - apparently this is useful for working with hypergeometric functions.\n+Let `e` be a symbolic expression. It may happen that `e.operator()` has a certain callable attribute, say, `foo`, that is not a method of `Function`. In this situation, one would like to use `e.foo()`, which is supposed to return `e.operator().foo(*e.operands())` - apparently this is useful for working with hypergeometric functions (#2516).\n \n **__Example__**\n \n ```\n-sage: from sage.symbolic.function import BuiltinFunction\n-sage: class ExampleBuiltin(BuiltinFunction):\n-...     def __init__(self):\n-...         BuiltinFunction.__init__(self, 'ex_func', nargs=0) #arbitrary no of args\n-...     def some_function_name(self, *args):\n-...         return len(args)\n-...\n-sage: ex_func = ExampleBuiltin()\n-sage: ex_func\n-ex_func\n+       sage: from sage.symbolic.function import BuiltinFunction\n+        sage: class TFunc(BuiltinFunction):\n+        ....:     def __init__(self):\n+        ....:         BuiltinFunction.__init__(self, 'tfunc', nargs=1)\n+        ....:\n+        ....:     class EvaluationMethods:\n+        ....:         def argp1(self, x):\n+        ....:             '''\n+        ....:             Some documentation about a bogus function.\n+        ....:             '''\n+        ....:             return x+1\n+        ....:\n+        ....:         @property\n+        ....:         def foo(self):\n+        ....:             return 5\n+        ....:\n+        sage: tfunc = TFunc()\n+        sage: e = tfunc(x); e\n+        tfunc(x)\n+        sage: type(e)\n+        <class '__main__.Expression_with_dynamic_methods'>\n+        sage: e.argp1()\n+        x + 1\n+        sage: e.foo\n+        5\n+        sage: x.argp1()\n+        Traceback (most recent call last):\n+        ...\n+        AttributeError: 'sage.symbolic.expression.Expression' object has no\n+        attribute 'argp1'\n+        sage: t = (e + 1).op[0]; t\n+        tfunc(x)\n+        sage: t\n+        tfunc(x)\n+        sage: type(t)\n+        <class '__main__.Expression_with_dynamic_methods'>\n+        sage: t.argp1()\n+        x + 1\n+        sage: import sagenb.misc.support as s\n+        sage: s.completions('t.argp', globals(), system='python')\n+        ['t.argp1']\n+        sage: t.argp1.__doc__.strip()\n+        'Some documentation about a bogus function.'\n ```\n \n-We obtain a symbolic expression by calling `ex_func`:\n-\n-```\n-sage: e = ex_func(x,x+1, x+2)\n-sage: type(e)\n-<type 'sage.symbolic.expression.Expression'>\n-```\n-\n-We add a callable and a non-callable attribute to `ex_func`:\n-\n-```\n-sage: def some_function(slf, *L): print slf,'called with',L\n-...\n-sage: ex_func.foo_bar = some_function\n-sage: ex_func.bar_foo = 4\n-```\n-\n-Now, both the new method and the callable attribute `foo_bar` of\n-`ex_func` are available from `e`, but not the non-callable:\n-\n-```\n-sage: e.some_function_name()\n-3\n-sage: e.foo_bar()\n-ex_func called with (x, x + 1, x + 2)\n-sage: e.bar_foo\n-Traceback (most recent call last):\n-...\n-AttributeError: <type 'sage.symbolic.expression.Expression'> has no attribute 'bar_foo'\n-```\n-\n-Tab completion  and introspection work:\n-\n-```\n-sage: 'foo_bar' in dir(e)     # indirect doctest\n-True\n-sage: 'some_function_name' in dir(e)\n-True\n-sage: 'bar_foo' in dir(e)\n-False\n-sage: import sagenb.misc.support as s\n-sage: s.completions('e.some', globals(), system='python')\n-['e.some_function_name']\n-```\n-\n-**__Problems__**\n-\n-When I ran `sage -testall`, several doctests segfaulted:\n-\n-```\n-        sage -t  -verbose \"devel/sage/sage/functions/hyperbolic.py\"\n-        sage -t  -verbose \"devel/sage/sage/games/hexad.py\"\n-        sage -t  -verbose \"devel/sage/sage/matrix/tests.py\"\n-        sage -t  -verbose \"devel/sage/sage/misc/sage_eval.py\"\n-        sage -t  -verbose \"devel/sage/sage/plot/animate.py\"\n-        sage -t  -verbose \"devel/sage/sage/quadratic_forms/quadratic_form__mass__Conway_Sloane_masses.py\"\n-        sage -t  -verbose \"devel/sage/sage/rings/polynomial/polynomial_element.pyx\"\n-```\n-\n-I tried (using `sage -t -verbose`) to find out what exactly fails. When I ran some of these failing examples in an interactive session, no segfault occured. So, is there a nasty side effect?\n-\n+Apply: [attachment: trac_9556-dynamic_class_everywhere.patch](https://github.com/sagemath/sage/files/ticket9556/trac_9556-dynamic_class_everywhere.patch.gz)\n``````\n",
    "created_at": "2013-06-19T18:05:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82882",
    "user": "https://github.com/burcin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,78 +1,51 @@
-Let `e` be a symbolic expression. It may happen that `e.operator()` has a certain callable attribute, say, `foo`, that is not a method of `Function`. In this situation, one would like to use `e.foo()`, which is supposed to return `e.operator().foo(*e.operands())` - apparently this is useful for working with hypergeometric functions.
+Let `e` be a symbolic expression. It may happen that `e.operator()` has a certain callable attribute, say, `foo`, that is not a method of `Function`. In this situation, one would like to use `e.foo()`, which is supposed to return `e.operator().foo(*e.operands())` - apparently this is useful for working with hypergeometric functions (#2516).
 
 **__Example__**
 
 ```
-sage: from sage.symbolic.function import BuiltinFunction
-sage: class ExampleBuiltin(BuiltinFunction):
-...     def __init__(self):
-...         BuiltinFunction.__init__(self, 'ex_func', nargs=0) #arbitrary no of args
-...     def some_function_name(self, *args):
-...         return len(args)
-...
-sage: ex_func = ExampleBuiltin()
-sage: ex_func
-ex_func
+       sage: from sage.symbolic.function import BuiltinFunction
+        sage: class TFunc(BuiltinFunction):
+        ....:     def __init__(self):
+        ....:         BuiltinFunction.__init__(self, 'tfunc', nargs=1)
+        ....:
+        ....:     class EvaluationMethods:
+        ....:         def argp1(self, x):
+        ....:             '''
+        ....:             Some documentation about a bogus function.
+        ....:             '''
+        ....:             return x+1
+        ....:
+        ....:         @property
+        ....:         def foo(self):
+        ....:             return 5
+        ....:
+        sage: tfunc = TFunc()
+        sage: e = tfunc(x); e
+        tfunc(x)
+        sage: type(e)
+        <class '__main__.Expression_with_dynamic_methods'>
+        sage: e.argp1()
+        x + 1
+        sage: e.foo
+        5
+        sage: x.argp1()
+        Traceback (most recent call last):
+        ...
+        AttributeError: 'sage.symbolic.expression.Expression' object has no
+        attribute 'argp1'
+        sage: t = (e + 1).op[0]; t
+        tfunc(x)
+        sage: t
+        tfunc(x)
+        sage: type(t)
+        <class '__main__.Expression_with_dynamic_methods'>
+        sage: t.argp1()
+        x + 1
+        sage: import sagenb.misc.support as s
+        sage: s.completions('t.argp', globals(), system='python')
+        ['t.argp1']
+        sage: t.argp1.__doc__.strip()
+        'Some documentation about a bogus function.'
 ```
 
-We obtain a symbolic expression by calling `ex_func`:
-
-```
-sage: e = ex_func(x,x+1, x+2)
-sage: type(e)
-<type 'sage.symbolic.expression.Expression'>
-```
-
-We add a callable and a non-callable attribute to `ex_func`:
-
-```
-sage: def some_function(slf, *L): print slf,'called with',L
-...
-sage: ex_func.foo_bar = some_function
-sage: ex_func.bar_foo = 4
-```
-
-Now, both the new method and the callable attribute `foo_bar` of
-`ex_func` are available from `e`, but not the non-callable:
-
-```
-sage: e.some_function_name()
-3
-sage: e.foo_bar()
-ex_func called with (x, x + 1, x + 2)
-sage: e.bar_foo
-Traceback (most recent call last):
-...
-AttributeError: <type 'sage.symbolic.expression.Expression'> has no attribute 'bar_foo'
-```
-
-Tab completion  and introspection work:
-
-```
-sage: 'foo_bar' in dir(e)     # indirect doctest
-True
-sage: 'some_function_name' in dir(e)
-True
-sage: 'bar_foo' in dir(e)
-False
-sage: import sagenb.misc.support as s
-sage: s.completions('e.some', globals(), system='python')
-['e.some_function_name']
-```
-
-**__Problems__**
-
-When I ran `sage -testall`, several doctests segfaulted:
-
-```
-        sage -t  -verbose "devel/sage/sage/functions/hyperbolic.py"
-        sage -t  -verbose "devel/sage/sage/games/hexad.py"
-        sage -t  -verbose "devel/sage/sage/matrix/tests.py"
-        sage -t  -verbose "devel/sage/sage/misc/sage_eval.py"
-        sage -t  -verbose "devel/sage/sage/plot/animate.py"
-        sage -t  -verbose "devel/sage/sage/quadratic_forms/quadratic_form__mass__Conway_Sloane_masses.py"
-        sage -t  -verbose "devel/sage/sage/rings/polynomial/polynomial_element.pyx"
-```
-
-I tried (using `sage -t -verbose`) to find out what exactly fails. When I ran some of these failing examples in an interactive session, no segfault occured. So, is there a nasty side effect?
-
+Apply: [attachment: trac_9556-dynamic_class_everywhere.patch](https://github.com/sagemath/sage/files/ticket9556/trac_9556-dynamic_class_everywhere.patch.gz)
``````




---

archive/issue_comments_082883.json:
```json
{
    "body": "Author: **Burcin Erocal, Simon King, Mike Hansen**",
    "created_at": "2013-06-19T18:05:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82883",
    "user": "https://github.com/burcin"
}
```

Author: **Burcin Erocal, Simon King, Mike Hansen**



---

archive/issue_comments_082884.json:
```json
{
    "body": "Changed keywords from **symbolic expression dynamic attribute** to **symbolic expression dynamic attribute sd48**",
    "created_at": "2013-06-19T21:36:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82884",
    "user": "https://github.com/eviatarbach"
}
```

Changed keywords from **symbolic expression dynamic attribute** to **symbolic expression dynamic attribute sd48**



---

archive/issue_comments_082885.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\npatchbot apply trac_9556-dynamic_class_everywhere.patch",
    "created_at": "2013-06-19T21:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82885",
    "user": "https://github.com/burcin"
}
```

<div id="comment:12" align="right">comment:12</div>

patchbot apply trac_9556-dynamic_class_everywhere.patch



---

archive/issue_events_121919.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-06-19T22:56:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9556#event-121919"
}
```



---

archive/issue_events_121920.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-06-19T22:56:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9556#event-121920"
}
```



---

archive/issue_comments_082886.json:
```json
{
    "body": "Reviewer: **Volker Braun**",
    "created_at": "2013-06-19T22:56:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82886",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **Volker Braun**



---

archive/issue_comments_082887.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nLooks good to me",
    "created_at": "2013-06-19T22:56:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82887",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:13" align="right">comment:13</div>

Looks good to me



---

archive/issue_comments_082888.json:
```json
{
    "body": "Changed work issues from **segfaulting doctests** to none",
    "created_at": "2013-06-19T22:56:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82888",
    "user": "https://github.com/vbraun"
}
```

Changed work issues from **segfaulting doctests** to none



---

archive/issue_comments_082889.json:
```json
{
    "body": "Attachment: **[trac_9556-dynamic_class_everywhere.patch.gz](https://github.com/sagemath/sage/files/ticket9556/trac_9556-dynamic_class_everywhere.patch.gz)**",
    "created_at": "2013-06-19T22:58:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82889",
    "user": "https://github.com/burcin"
}
```

Attachment: **[trac_9556-dynamic_class_everywhere.patch.gz](https://github.com/sagemath/sage/files/ticket9556/trac_9556-dynamic_class_everywhere.patch.gz)**



---

archive/issue_events_121921.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-20T21:33:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9556#event-121921"
}
```



---

archive/issue_events_121922.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-20T21:33:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9556#event-121922"
}
```



---

archive/issue_comments_082890.json:
```json
{
    "body": "Merged: **sage-5.11.beta3**",
    "created_at": "2013-06-20T21:33:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82890",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.11.beta3**



---

archive/issue_comments_082891.json:
```json
{
    "body": "Attachment: **[trac_9556-dynamic_class_everywhere.part2.patch.gz](https://github.com/sagemath/sage/files/ticket9556/trac_9556-dynamic_class_everywhere.part2.patch.gz)**",
    "created_at": "2013-06-20T23:29:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82891",
    "user": "https://github.com/burcin"
}
```

Attachment: **[trac_9556-dynamic_class_everywhere.part2.patch.gz](https://github.com/sagemath/sage/files/ticket9556/trac_9556-dynamic_class_everywhere.part2.patch.gz)**



---

archive/issue_comments_082892.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nAs discussed with Burcin, patch needs to move to a different ticket.\n\nAlso, unpacking goes too far and doesn't let me preserve SR objects. This leads to funny behavior for constant functions etc::\n\n```\nsage: o = (SR(1), x)\nsage: map(type, o)\n[sage.symbolic.expression.Expression, sage.symbolic.expression.Expression]\nsage: o = SR._force_pyobject(o)._unpack_operands()\nsage: map(type, o)\n[sage.rings.integer.Integer, sage.symbolic.expression.Expression]\n```",
    "created_at": "2013-06-21T19:46:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82892",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:15" align="right">comment:15</div>

As discussed with Burcin, patch needs to move to a different ticket.

Also, unpacking goes too far and doesn't let me preserve SR objects. This leads to funny behavior for constant functions etc::

```
sage: o = (SR(1), x)
sage: map(type, o)
[sage.symbolic.expression.Expression, sage.symbolic.expression.Expression]
sage: o = SR._force_pyobject(o)._unpack_operands()
sage: map(type, o)
[sage.rings.integer.Integer, sage.symbolic.expression.Expression]
```



---

archive/issue_comments_082893.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nFor future historians: The part2 was moved to #14802",
    "created_at": "2013-06-23T15:51:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82893",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:16" align="right">comment:16</div>

For future historians: The part2 was moved to #14802



---

archive/issue_comments_082894.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThese `EvaluationMethods` should be a new-style class: #20825.",
    "created_at": "2016-06-14T14:36:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9556#issuecomment-82894",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

These `EvaluationMethods` should be a new-style class: #20825.
