# Issue 9372: implement regulator function for elliptic curves over number fields

archive/issues_009372.json:
```json
{
    "assignees": [
        "https://github.com/JohnCremona"
    ],
    "body": "Now that we have canonical heights over number fields, the regulator_of_points code can be moved up from ell_rational_field to ell_number_field.\n\nCC:  @robertwb\n\nComponent: **elliptic curves**\n\nAuthor: **John Cremona**\n\nReviewer: **David Loeffler, Robert Bradshaw**\n\nMerged: **sage-4.5.2.alpha0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/9372_\n\n",
    "closed_at": "2010-07-20T07:17:21Z",
    "created_at": "2010-06-29T04:58:30Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.5.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "implement regulator function for elliptic curves over number fields",
    "type": "issue",
    "updated_at": "2010-07-20T07:17:21Z",
    "url": "https://github.com/sagemath/sage/issues/9372",
    "user": "https://github.com/JohnCremona"
}
```
Now that we have canonical heights over number fields, the regulator_of_points code can be moved up from ell_rational_field to ell_number_field.

CC:  @robertwb

Component: **elliptic curves**

Author: **John Cremona**

Reviewer: **David Loeffler, Robert Bradshaw**

Merged: **sage-4.5.2.alpha0**

_Issue created by migration from https://trac.sagemath.org/ticket/9372_





---

archive/issue_events_120104.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-06-29T04:58:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "milestone_number": null,
    "milestone_title": "sage-4.5.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9372#event-120104"
}
```



---

archive/issue_events_120105.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-06-29T04:58:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "c: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9372#event-120105"
}
```



---

archive/issue_events_120106.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-06-29T04:58:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9372#event-120106"
}
```



---

archive/issue_events_120107.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-06-29T04:58:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9372#event-120107"
}
```



---

archive/issue_events_120108.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2010-06-29T04:58:30Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "subject": "https://github.com/JohnCremona",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9372#event-120108"
}
```



---

archive/issue_events_120109.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-06-29T04:58:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "c: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9372#event-120109"
}
```



---

archive/issue_events_120110.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-06-29T04:58:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
    "label_color": "0000ff",
    "label_name": "c: elliptic curves",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9372#event-120110"
}
```



---

archive/issue_events_120111.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2010-06-29T04:58:48Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "subject": "https://github.com/JohnCremona",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9372#event-120111"
}
```



---

archive/issue_events_120112.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-06-29T04:58:48Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "subject": "https://github.com/JohnCremona",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9372#event-120112"
}
```



---

archive/issue_comments_079922.json:
```json
{
    "body": "Applies to 4.4.4",
    "created_at": "2010-06-29T05:54:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9372#issuecomment-79922",
    "user": "https://github.com/JohnCremona"
}
```

Applies to 4.4.4



---

archive/issue_comments_079923.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAttachment: **[trac_9372-regulator.patch.gz](https://github.com/sagemath/sage/files/ticket9372/trac_9372-regulator.patch.gz)**\n\nThe patch moves the two functions height_pairing_matrix and regulator_of_points, and adds doctests over number fields.",
    "created_at": "2010-06-29T05:56:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9372#issuecomment-79923",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:2" align="right">comment:2</div>

Attachment: **[trac_9372-regulator.patch.gz](https://github.com/sagemath/sage/files/ticket9372/trac_9372-regulator.patch.gz)**

The patch moves the two functions height_pairing_matrix and regulator_of_points, and adds doctests over number fields.



---

archive/issue_comments_079924.json:
```json
{
    "body": "Author: **John Cremona**",
    "created_at": "2010-06-29T05:56:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9372#issuecomment-79924",
    "user": "https://github.com/JohnCremona"
}
```

Author: **John Cremona**



---

archive/issue_events_120113.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-06-29T05:56:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9372#event-120113"
}
```



---

archive/issue_comments_079925.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI'm getting a couple of doctest failures -- something is off by a sign in the `height_pairing_matrix` code:\n\n```\nsage -t -long ell_number_field.py\n**********************************************************************\nFile \"/storage/masiao/sage-4.4.4/devel/sage-reviewing/sage/schemes/elliptic_curves/ell_number_field.py\", line 308:\n    sage: E.height_pairing_matrix([P,Q])\nExpected:\n    [ 0.686667083305587 -0.268478098806726]\n    [-0.268478098806726  0.327000773651605]\nGot:\n    [0.686667083305587 0.268478098806726]\n    [0.268478098806726 0.327000773651605]\n**********************************************************************\nFile \"/storage/masiao/sage-4.4.4/devel/sage-reviewing/sage/schemes/elliptic_curves/ell_number_field.py\", line 317:\n    sage: EK.height_pairing_matrix([EK(P),EK(Q)])\nExpected:\n    [ 0.686667083305586 -0.268478098806726]\n    [-0.268478098806726  0.327000773651605]\nGot:\n    [0.686667083305586 0.268478098806726]\n    [0.268478098806726 0.327000773651605]\n**********************************************************************\n1 items had failures:\n   2 of  23 in __main__.example_4\n***Test Failed*** 2 failures.\n```\n\nAlso, a very tiny quibble: the second argument \"precision\" to `height_pairing_matrix` is missing its bullet point in the docstring.",
    "created_at": "2010-06-29T13:03:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9372#issuecomment-79925",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:3" align="right">comment:3</div>

I'm getting a couple of doctest failures -- something is off by a sign in the `height_pairing_matrix` code:

```
sage -t -long ell_number_field.py
**********************************************************************
File "/storage/masiao/sage-4.4.4/devel/sage-reviewing/sage/schemes/elliptic_curves/ell_number_field.py", line 308:
    sage: E.height_pairing_matrix([P,Q])
Expected:
    [ 0.686667083305587 -0.268478098806726]
    [-0.268478098806726  0.327000773651605]
Got:
    [0.686667083305587 0.268478098806726]
    [0.268478098806726 0.327000773651605]
**********************************************************************
File "/storage/masiao/sage-4.4.4/devel/sage-reviewing/sage/schemes/elliptic_curves/ell_number_field.py", line 317:
    sage: EK.height_pairing_matrix([EK(P),EK(Q)])
Expected:
    [ 0.686667083305586 -0.268478098806726]
    [-0.268478098806726  0.327000773651605]
Got:
    [0.686667083305586 0.268478098806726]
    [0.268478098806726 0.327000773651605]
**********************************************************************
1 items had failures:
   2 of  23 in __main__.example_4
***Test Failed*** 2 failures.
```

Also, a very tiny quibble: the second argument "precision" to `height_pairing_matrix` is missing its bullet point in the docstring.



---

archive/issue_events_120114.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2010-06-29T13:03:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9372#event-120114"
}
```



---

archive/issue_events_120115.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2010-06-29T13:03:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9372#event-120115"
}
```



---

archive/issue_comments_079926.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nProbably I used E.gens() which is a bad idea in odctests, better to enter the points manually.\n\nNo time to fix now, about to leave SD22 for home.... but thanks all the same!  Put this patch up from a coffee shop last night just before it closed (about a dozen Sagers being chased out!)",
    "created_at": "2010-06-29T14:38:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9372#issuecomment-79926",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:4" align="right">comment:4</div>

Probably I used E.gens() which is a bad idea in odctests, better to enter the points manually.

No time to fix now, about to leave SD22 for home.... but thanks all the same!  Put this patch up from a coffee shop last night just before it closed (about a dozen Sagers being chased out!)



---

archive/issue_comments_079927.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\n@JohnCremona: You did you E.gens().  I get:\n\n```\nsage: E = EllipticCurve('389a1')\nsage: E.gens()\n[(-1 : 1 : 1), (0 : -1 : 1)]\n```\n\nShould I change the doc test to the following?\n\n```\nsage: E = EllipticCurve('389a1')\nsage: P,Q = E.point([-1,1,1]),E.point([0,-1,1])\nsage: E.height_pairing_matrix([P,Q])\n[0.686667083305587 0.268478098806726]\n[0.268478098806726 0.327000773651605]\n```\n\n}}}",
    "created_at": "2010-06-29T23:42:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9372#issuecomment-79927",
    "user": "https://github.com/adeines"
}
```

<div id="comment:5" align="right">comment:5</div>

@JohnCremona: You did you E.gens().  I get:

```
sage: E = EllipticCurve('389a1')
sage: E.gens()
[(-1 : 1 : 1), (0 : -1 : 1)]
```

Should I change the doc test to the following?

```
sage: E = EllipticCurve('389a1')
sage: P,Q = E.point([-1,1,1]),E.point([0,-1,1])
sage: E.height_pairing_matrix([P,Q])
[0.686667083305587 0.268478098806726]
[0.268478098806726 0.327000773651605]
```

}}}



---

archive/issue_comments_079928.json:
```json
{
    "body": "doctest fixed -- replaces previous patch",
    "created_at": "2010-06-30T03:34:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9372#issuecomment-79928",
    "user": "https://github.com/adeines"
}
```

doctest fixed -- replaces previous patch



---

archive/issue_events_120116.json:
```json
{
    "actor": "https://github.com/adeines",
    "created_at": "2010-06-30T03:35:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9372#event-120116"
}
```



---

archive/issue_events_120117.json:
```json
{
    "actor": "https://github.com/adeines",
    "created_at": "2010-06-30T03:35:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9372#event-120117"
}
```



---

archive/issue_comments_079929.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAttachment: **[trac_9372-regulator.2.patch.gz](https://github.com/sagemath/sage/files/ticket9372/trac_9372-regulator.2.patch.gz)**\n\nIf the only problem was that the doctest called E.gens(), this fixes those doctests and you can give this a positive review.",
    "created_at": "2010-06-30T03:35:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9372#issuecomment-79929",
    "user": "https://github.com/adeines"
}
```

<div id="comment:6" align="right">comment:6</div>

Attachment: **[trac_9372-regulator.2.patch.gz](https://github.com/sagemath/sage/files/ticket9372/trac_9372-regulator.2.patch.gz)**

If the only problem was that the doctest called E.gens(), this fixes those doctests and you can give this a positive review.



---

archive/issue_events_120118.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-06-30T07:25:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9372#event-120118"
}
```



---

archive/issue_events_120119.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-06-30T07:25:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9372#event-120119"
}
```



---

archive/issue_comments_079930.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThanks to all for sorting that out.  I should have known better.  Even for curves in the database, it is not safe to use gens() since unless you have the larger database installed the gens are computed on the fly and are not unique.  (And doctests definitely should not assume an optional spkg is installed!).",
    "created_at": "2010-06-30T11:43:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9372#issuecomment-79930",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:8" align="right">comment:8</div>

Thanks to all for sorting that out.  I should have known better.  Even for curves in the database, it is not safe to use gens() since unless you have the larger database installed the gens are computed on the fly and are not unique.  (And doctests definitely should not assume an optional spkg is installed!).



---

archive/issue_comments_079931.json:
```json
{
    "body": "Reviewer: **David Loeffler, Robert Bradshaw**",
    "created_at": "2010-07-20T07:17:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9372#issuecomment-79931",
    "user": "https://github.com/qed777"
}
```

Reviewer: **David Loeffler, Robert Bradshaw**



---

archive/issue_comments_079932.json:
```json
{
    "body": "Merged: **sage-4.5.2.alpha0**",
    "created_at": "2010-07-20T07:17:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9372#issuecomment-79932",
    "user": "https://github.com/qed777"
}
```

Merged: **sage-4.5.2.alpha0**



---

archive/issue_comments_079933.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI'm updating the Reviewer(s) field.  Please correct me if I'm wrong.",
    "created_at": "2010-07-20T07:17:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9372#issuecomment-79933",
    "user": "https://github.com/qed777"
}
```

<div id="comment:9" align="right">comment:9</div>

I'm updating the Reviewer(s) field.  Please correct me if I'm wrong.



---

archive/issue_events_120120.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-07-20T07:17:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9372#event-120120"
}
```



---

archive/issue_events_120121.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-07-20T07:17:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9372",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9372#event-120121"
}
```
