# Issue 9493: Remove extra baggage from the ECL spkg

archive/issues_009493.json:
```json
{
    "assignees": [],
    "body": "Remove GMP subdir.\n\nUse tarball at:\n* http://boxen.math.washington.edu/home/jpflori/upstream/ecl-12.12.1.20140409.tar.bz2\n\nCC:  @sagetrac-drkirkby @kcrisman\n\nKeywords: **ecl gmp cygwin spkg**\n\nBranch/Commit: **[bec6426](https://github.com/sagemath/sagetrac-mirror/commit/bec64268f80d6a4eb9c89bdbe83452459d665e7c)**\n\nUpstream: **Reported upstream. No feedback yet.**\n\nReviewer: **Peter Bruin**\n\nAuthor: **Leif Leonhardy, Jean-Pierre Flori**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/9493_\n\n",
    "closed_at": "2014-05-21T15:33:43Z",
    "created_at": "2010-07-13T23:19:35Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Remove extra baggage from the ECL spkg",
    "type": "issue",
    "updated_at": "2014-05-21T15:33:43Z",
    "url": "https://github.com/sagemath/sage/issues/9493",
    "user": "https://github.com/nexttime"
}
```
Remove GMP subdir.

Use tarball at:
* http://boxen.math.washington.edu/home/jpflori/upstream/ecl-12.12.1.20140409.tar.bz2

CC:  @sagetrac-drkirkby @kcrisman

Keywords: **ecl gmp cygwin spkg**

Branch/Commit: **[bec6426](https://github.com/sagemath/sagetrac-mirror/commit/bec64268f80d6a4eb9c89bdbe83452459d665e7c)**

Upstream: **Reported upstream. No feedback yet.**

Reviewer: **Peter Bruin**

Author: **Leif Leonhardy, Jean-Pierre Flori**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/9493_





---

archive/issue_events_122152.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-07-13T23:19:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9493#event-122152"
}
```



---

archive/issue_events_122153.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-07-13T23:19:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9493#event-122153"
}
```



---

archive/issue_events_122154.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-07-13T23:19:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9493#event-122154"
}
```



---

archive/issue_comments_081938.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nMinimal patch to `configure` to allow `rm -r src/src/gmp`:\n\n```patch\n--- src/src/configure\t2010-02-13 20:04:32.000000000 +0100\n+++ patches/src.src.configure\t2010-07-14 01:29:39.000000000 +0200\n@@ -1987,7 +1987,7 @@\n \n \n ac_aux_dir=\n-for ac_dir in ${srcdir}/gmp \"$srcdir\"/${srcdir}/gmp; do\n+for ac_dir in ${srcdir}/gmp \"$srcdir\"/${srcdir}/gmp ${srcdir}/gc; do\n   if test -f \"$ac_dir/install-sh\"; then\n     ac_aux_dir=$ac_dir\n     ac_install_sh=\"$ac_aux_dir/install-sh -c\"\n```\n(Tested with 4.5.rc0 on a 32-bit Linux, with `--with-gmp-prefix=$SAGE_LOCAL` added to `./configure` in `spkg-install`, but *should* work as fine without that.)\n\nThough we should in mid-term remove (Boehm) gc as well, because Sage ships with its own copy of it. (ECL's boehm_gc is only used on MacOS X, and just because ECL unconditionally thinks an already installed version there can only be Fink's broken one.) But this is worth another ticket.\n\nAnother simple solution is just leaving `install-sh` in `src/src/gmp` (untested) or just copying it to `${srcdir} ` and adding *that* directory to the `for` list.",
    "created_at": "2010-07-14T00:01:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81938",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:1" align="right">comment:1</div>

Minimal patch to `configure` to allow `rm -r src/src/gmp`:

```patch
--- src/src/configure	2010-02-13 20:04:32.000000000 +0100
+++ patches/src.src.configure	2010-07-14 01:29:39.000000000 +0200
@@ -1987,7 +1987,7 @@
 
 
 ac_aux_dir=
-for ac_dir in ${srcdir}/gmp "$srcdir"/${srcdir}/gmp; do
+for ac_dir in ${srcdir}/gmp "$srcdir"/${srcdir}/gmp ${srcdir}/gc; do
   if test -f "$ac_dir/install-sh"; then
     ac_aux_dir=$ac_dir
     ac_install_sh="$ac_aux_dir/install-sh -c"
```
(Tested with 4.5.rc0 on a 32-bit Linux, with `--with-gmp-prefix=$SAGE_LOCAL` added to `./configure` in `spkg-install`, but *should* work as fine without that.)

Though we should in mid-term remove (Boehm) gc as well, because Sage ships with its own copy of it. (ECL's boehm_gc is only used on MacOS X, and just because ECL unconditionally thinks an already installed version there can only be Fink's broken one.) But this is worth another ticket.

Another simple solution is just leaving `install-sh` in `src/src/gmp` (untested) or just copying it to `${srcdir} ` and adding *that* directory to the `for` list.



---

archive/issue_comments_081939.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nModified `spkg-install` to allow removal of GMP (suggestion):\n\n```patch\n--- ecl-stripped-v1/ecl-10.2.1.p2/spkg-install\t2010-07-12 05:22:11.000000000 +0200\n+++ ecl-stripped-v2/ecl-10.2.1.p2/spkg-install\t2010-07-14 02:21:22.000000000 +0200\n@@ -154,6 +154,15 @@\n # We clear MAKEFLAGS to fix building multiple spkgs in parallel on OS X.\n export MAKEFLAGS=\n \n+if [ -d patches ] && [ `ls patches` != \"\" ]; then\n+  echo \"Applying patches...\"\n+\n+    test -f patches/src.src.configure && cp -pv patches/src.src.configure src/src/configure\n+\n+  echo \"Finished applying patches.\"\n+  echo \" \"\n+fi\n+\n set +e\n \n cd src\n@@ -165,9 +174,9 @@\n    # 1) OpenSolaris (SunOS 5.11)\n    # 2) Intel or AMD CPU \n    # 3) 64-bit build\n-   ./configure --prefix=$SAGE_LOCAL --with-dffi=no\n+   ./configure --prefix=$SAGE_LOCAL --with-dffi=no --with-gmp-prefix=$SAGE_LOCAL\n else\n-   ./configure --prefix=$SAGE_LOCAL \n+   ./configure --prefix=$SAGE_LOCAL --with-gmp-prefix=$SAGE_LOCAL\n fi\n \n if [ $? -ne 0 ]; then\n```\n(v1's `spkg-install` is unchanged w.r.t. ECL 10.2.1.p1.)",
    "created_at": "2010-07-14T00:28:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81939",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:2" align="right">comment:2</div>

Modified `spkg-install` to allow removal of GMP (suggestion):

```patch
--- ecl-stripped-v1/ecl-10.2.1.p2/spkg-install	2010-07-12 05:22:11.000000000 +0200
+++ ecl-stripped-v2/ecl-10.2.1.p2/spkg-install	2010-07-14 02:21:22.000000000 +0200
@@ -154,6 +154,15 @@
 # We clear MAKEFLAGS to fix building multiple spkgs in parallel on OS X.
 export MAKEFLAGS=
 
+if [ -d patches ] && [ `ls patches` != "" ]; then
+  echo "Applying patches..."
+
+    test -f patches/src.src.configure && cp -pv patches/src.src.configure src/src/configure
+
+  echo "Finished applying patches."
+  echo " "
+fi
+
 set +e
 
 cd src
@@ -165,9 +174,9 @@
    # 1) OpenSolaris (SunOS 5.11)
    # 2) Intel or AMD CPU 
    # 3) 64-bit build
-   ./configure --prefix=$SAGE_LOCAL --with-dffi=no
+   ./configure --prefix=$SAGE_LOCAL --with-dffi=no --with-gmp-prefix=$SAGE_LOCAL
 else
-   ./configure --prefix=$SAGE_LOCAL 
+   ./configure --prefix=$SAGE_LOCAL --with-gmp-prefix=$SAGE_LOCAL
 fi
 
 if [ $? -ne 0 ]; then
```
(v1's `spkg-install` is unchanged w.r.t. ECL 10.2.1.p1.)



---

archive/issue_comments_081940.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nGet rid of the '-v' option to 'cp'. It's not a POSIX option\n\nhttp://www.opengroup.org/onlinepubs/009695399/utilities/cp.html\n\nand will certainly fail on Solaris or OpenSolaris\n\nDave",
    "created_at": "2010-07-14T01:17:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81940",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:3" align="right">comment:3</div>

Get rid of the '-v' option to 'cp'. It's not a POSIX option

http://www.opengroup.org/onlinepubs/009695399/utilities/cp.html

and will certainly fail on Solaris or OpenSolaris

Dave



---

archive/issue_comments_081941.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nWhat about\n\n```sh\ncopy-patch()\n{\n  if [ -f patches/$1 ] ; then\n    echo \"  Patching \"$2\n    cp -p patches/$1 $2\n  fi\n}\n```\nand (e.g.)\n\n```sh\nif [ -d patches ] && [ `ls patches` != \"\" ]; then\n  echo \"Applying patches...\" \n\n  copy-patch \"src.src.configure\" \"src/src/configure\"\n\n  echo \"Finished applying patches.\" \n  echo \" \" \nfi      \n```\n?",
    "created_at": "2010-07-14T02:09:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81941",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:4" align="right">comment:4</div>

What about

```sh
copy-patch()
{
  if [ -f patches/$1 ] ; then
    echo "  Patching "$2
    cp -p patches/$1 $2
  fi
}
```
and (e.g.)

```sh
if [ -d patches ] && [ `ls patches` != "" ]; then
  echo "Applying patches..." 

  copy-patch "src.src.configure" "src/src/configure"

  echo "Finished applying patches." 
  echo " " 
fi      
```
?



---

archive/issue_comments_081942.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI don't think \n\n```\nif [ -d patches ] && [ `ls patches` != \"\" ]; then\n```\n\nis safe. I don't think the order is guaranteed, so the second part could be evaluated before the first. Testing on \"\" is bad practice. \n\nDave",
    "created_at": "2010-10-29T13:52:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81942",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:5" align="right">comment:5</div>

I don't think 

```
if [ -d patches ] && [ `ls patches` != "" ]; then
```

is safe. I don't think the order is guaranteed, so the second part could be evaluated before the first. Testing on "" is bad practice. 

Dave



---

archive/issue_comments_081943.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@sagetrac-drkirkby](#comment:5):\n> I don't think \n> \n\n```\nif [ -d patches ] && [ `ls patches` != \"\" ]; then\n```\n> \n> is safe. I don't think the order is guaranteed, so the second part could be evaluated before the first.\n\n(Even if it was, it doesn't make a difference, but...)\n\nLike in C, the second expression is only evaluated if needed (same for `||`), such that\n\n```sh\nfoo && bar || baz\n``` \nis equivalent to\n\n```sh\nif foo; then\n    bar\nelse\n    baz\nfi\n```\n\n\nHowever, the <code>[ \\`ls patches\\` != \"\" ]</code> is suboptimal. The whole line could be\n\n```sh\nif ls patches/* >/dev/null 2>/dev/null; then\n```\n\n(One could substitute `ls` by e.g. `cat`, too.)  It was just one suggestion anyway.",
    "created_at": "2010-10-29T23:18:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81943",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@sagetrac-drkirkby](#comment:5):
> I don't think 
> 

```
if [ -d patches ] && [ `ls patches` != "" ]; then
```
> 
> is safe. I don't think the order is guaranteed, so the second part could be evaluated before the first.

(Even if it was, it doesn't make a difference, but...)

Like in C, the second expression is only evaluated if needed (same for `||`), such that

```sh
foo && bar || baz
``` 
is equivalent to

```sh
if foo; then
    bar
else
    baz
fi
```


However, the <code>[ \`ls patches\` != "" ]</code> is suboptimal. The whole line could be

```sh
if ls patches/* >/dev/null 2>/dev/null; then
```

(One could substitute `ls` by e.g. `cat`, too.)  It was just one suggestion anyway.



---

archive/issue_comments_081944.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@sagetrac-drkirkby](#comment:5):\n> I don't think the order is guaranteed, so the second part could be evaluated before the first. Testing on \"\" is bad practice. \n\nThe order of evaluation and the shortcutting is guaranteed by POSIX:\n\nhttp://www.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_09_03",
    "created_at": "2010-10-29T23:21:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81944",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@sagetrac-drkirkby](#comment:5):
> I don't think the order is guaranteed, so the second part could be evaluated before the first. Testing on "" is bad practice. 

The order of evaluation and the shortcutting is guaranteed by POSIX:

http://www.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_09_03



---

archive/issue_comments_081945.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI believe this should be closed, and if further cleanups are required, a new ticket is opened. \n\nECL will be updated in Sage 4.6.1 to 10.4.1 in #10187. Most of the changes on this ticket are incorporated into #10187 anyway. \n\nDave",
    "created_at": "2010-12-03T00:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81945",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:8" align="right">comment:8</div>

I believe this should be closed, and if further cleanups are required, a new ticket is opened. 

ECL will be updated in Sage 4.6.1 to 10.4.1 in #10187. Most of the changes on this ticket are incorporated into #10187 anyway. 

Dave



---

archive/issue_comments_081946.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@sagetrac-drkirkby](#comment:8):\n> I believe this should be closed, and if further cleanups are required, a new ticket is opened. \n> \n> ECL will be updated in Sage 4.6.1 to 10.4.1 in #10187. Most of the changes on this ticket are incorporated into #10187 anyway. \n\nNothing of the TODOs mentioned in the description have been done on #10187; removing the other parts was just the correction of a regression.\n\nSo IMHO this ticket should be kept open.",
    "created_at": "2010-12-03T00:50:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81946",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@sagetrac-drkirkby](#comment:8):
> I believe this should be closed, and if further cleanups are required, a new ticket is opened. 
> 
> ECL will be updated in Sage 4.6.1 to 10.4.1 in #10187. Most of the changes on this ticket are incorporated into #10187 anyway. 

Nothing of the TODOs mentioned in the description have been done on #10187; removing the other parts was just the correction of a regression.

So IMHO this ticket should be kept open.



---

archive/issue_events_122155.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-12-03T00:54:59Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "title_is": "Remove extra baggage from the ECL spkg",
    "title_was": "Remove extra baggage from ECL 10.2.1.p1 (again)",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9493#event-122155"
}
```



---

archive/issue_comments_081947.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@nexttime](#comment:1):\n> Minimal patch to `configure` to allow `rm -r src/src/gmp`:\n> \n> ```patch\n> --- src/src/configure\t2010-02-13 20:04:32.000000000 +0100\n> +++ patches/src.src.configure\t2010-07-14 01:29:39.000000000 +0200\n> @@ -1987,7 +1987,7 @@\n>  \n>  \n>  ac_aux_dir=\n> -for ac_dir in ${srcdir}/gmp \"$srcdir\"/${srcdir}/gmp; do\n> +for ac_dir in ${srcdir}/gmp \"$srcdir\"/${srcdir}/gmp ${srcdir}/gc; do\n>    if test -f \"$ac_dir/install-sh\"; then\n>      ac_aux_dir=$ac_dir\n>      ac_install_sh=\"$ac_aux_dir/install-sh -c\"\n> ```\n\nNo idea whether that's at all still necessary (when removing the unused GMP source tree) -- we're meanwhile at ECL 12.12.1...\n\n> Another simple solution is just leaving `install-sh` in `src/src/gmp` (untested) or just copying it to `${srcdir} ` and adding *that* directory to the `for` list.",
    "created_at": "2013-06-21T20:02:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81947",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@nexttime](#comment:1):
> Minimal patch to `configure` to allow `rm -r src/src/gmp`:
> 
> ```patch
> --- src/src/configure	2010-02-13 20:04:32.000000000 +0100
> +++ patches/src.src.configure	2010-07-14 01:29:39.000000000 +0200
> @@ -1987,7 +1987,7 @@
>  
>  
>  ac_aux_dir=
> -for ac_dir in ${srcdir}/gmp "$srcdir"/${srcdir}/gmp; do
> +for ac_dir in ${srcdir}/gmp "$srcdir"/${srcdir}/gmp ${srcdir}/gc; do
>    if test -f "$ac_dir/install-sh"; then
>      ac_aux_dir=$ac_dir
>      ac_install_sh="$ac_aux_dir/install-sh -c"
> ```

No idea whether that's at all still necessary (when removing the unused GMP source tree) -- we're meanwhile at ECL 12.12.1...

> Another simple solution is just leaving `install-sh` in `src/src/gmp` (untested) or just copying it to `${srcdir} ` and adding *that* directory to the `for` list.



---

archive/issue_comments_081948.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nOoops, just noticed:\n\n```sh\n$ tar tvjf spkg/standard/ecl-* | grep gmp\ntar: Record size = 8 blocks\ndrwxr-xr-x jdemeyer/jdemeyer      0 2013-04-08 13:05 ecl-12.12.1.p4/src/src/gmp/\n-rwxr-xr-x jdemeyer/jdemeyer   4105 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/config.sub\n-rwxr-xr-x jdemeyer/jdemeyer  31164 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/configfsf.sub\n-rwxr-xr-x jdemeyer/jdemeyer  23041 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/config.guess\n-rwxr-xr-x jdemeyer/jdemeyer   9505 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/install-sh\n-rwxr-xr-x jdemeyer/jdemeyer  43636 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/configfsf.guess\n-rw-r--r-- jdemeyer/jdemeyer  15353 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/config.in\n```\n\nSo there's meanwhile not much of GMP left (in our spkg), but its `config*` files still disturb: #14648\n\nHence the `install-sh` fix above should still be valid (and useful) ...",
    "created_at": "2013-06-21T20:18:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81948",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:13" align="right">comment:13</div>

Ooops, just noticed:

```sh
$ tar tvjf spkg/standard/ecl-* | grep gmp
tar: Record size = 8 blocks
drwxr-xr-x jdemeyer/jdemeyer      0 2013-04-08 13:05 ecl-12.12.1.p4/src/src/gmp/
-rwxr-xr-x jdemeyer/jdemeyer   4105 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/config.sub
-rwxr-xr-x jdemeyer/jdemeyer  31164 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/configfsf.sub
-rwxr-xr-x jdemeyer/jdemeyer  23041 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/config.guess
-rwxr-xr-x jdemeyer/jdemeyer   9505 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/install-sh
-rwxr-xr-x jdemeyer/jdemeyer  43636 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/configfsf.guess
-rw-r--r-- jdemeyer/jdemeyer  15353 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/config.in
```

So there's meanwhile not much of GMP left (in our spkg), but its `config*` files still disturb: #14648

Hence the `install-sh` fix above should still be valid (and useful) ...



---

archive/issue_events_122156.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9493#event-122156"
}
```



---

archive/issue_events_122157.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9493#event-122157"
}
```



---

archive/issue_events_122158.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9493#event-122158"
}
```



---

archive/issue_events_122159.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9493#event-122159"
}
```



---

archive/issue_comments_081949.json:
```json
{
    "body": "Branch: **[u/jpflori/ticket/9493](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/9493)**",
    "created_at": "2014-04-13T19:27:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81949",
    "user": "https://github.com/jpflori"
}
```

Branch: **[u/jpflori/ticket/9493](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/9493)**



---

archive/issue_comments_081950.json:
```json
{
    "body": "Changed author from **Leif Leonhardy** to **Leif Leonhardy, Jean-Pierre Flori**",
    "created_at": "2014-04-13T19:27:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81950",
    "user": "https://github.com/jpflori"
}
```

Changed author from **Leif Leonhardy** to **Leif Leonhardy, Jean-Pierre Flori**



---

archive/issue_comments_081951.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nLet's get rid of the gmp subdirectory.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ad497e751543fc52941a8b6affe0a9de55d55043\">ad497e7</a></td><td><code>Strip GMP out of ECL and use up to date config.* scripts.</code></td></tr></table>\n",
    "created_at": "2014-04-13T19:27:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81951",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:16" align="right">comment:16</div>

Let's get rid of the gmp subdirectory.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ad497e751543fc52941a8b6affe0a9de55d55043">ad497e7</a></td><td><code>Strip GMP out of ECL and use up to date config.* scripts.</code></td></tr></table>




---

archive/issue_events_122160.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2014-04-13T19:27:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9493#event-122160"
}
```



---

archive/issue_comments_081952.json:
```json
{
    "body": "Changed keywords from none to **ecl gmp cygwin spkg**",
    "created_at": "2014-04-13T19:27:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81952",
    "user": "https://github.com/jpflori"
}
```

Changed keywords from none to **ecl gmp cygwin spkg**



---

archive/issue_comments_081953.json:
```json
{
    "body": "Commit: **[ad497e7](https://github.com/sagemath/sagetrac-mirror/commit/ad497e751543fc52941a8b6affe0a9de55d55043)**",
    "created_at": "2014-04-13T19:27:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81953",
    "user": "https://github.com/jpflori"
}
```

Commit: **[ad497e7](https://github.com/sagemath/sagetrac-mirror/commit/ad497e751543fc52941a8b6affe0a9de55d55043)**



---

archive/issue_comments_081954.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI think the previously rmoved encoding stuff is actually planned to be used, so I did not change its inclusion.",
    "created_at": "2014-04-13T19:28:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81954",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:17" align="right">comment:17</div>

I think the previously rmoved encoding stuff is actually planned to be used, so I did not change its inclusion.



---

archive/issue_comments_081955.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,38 +1,4 @@\n-Snippet from (my new) `SPKG.txt`:\n+Remove GMP subdir.\n \n-```\n-== Dependencies ==\n-\n- * mpir\n- * boehm_gc\n-\n-== Special Update/Build Instructions ==\n- * Delete the src/msvc directory\n- * Delete the src/contrib/encodings directory.  So, do not build with\n-   --enable-unicode: See https://github.com/sagemath/sage/issues/7732\n- * TODO: Delete the src/src/gmp directory (13MB!), as we use MPIR\n-     - perhaps add --with-gmp-prefix=$SAGE_LOCAL to configure\n-       to make sure we use Sage's one (MPIR); this is independent\n-       of the deletion of src/src/gmp\n-     - needs copying src/src/gmp/install-sh to somewhere else or\n-       patching configure to use e.g. that one in src/src/gc\n- * TODO: Make ECL use Sage's Boehm GC on MacOS X as well (but perhaps\n-   put some changes from ECL's into Sage's Boehm GC), then remove\n-   the src/src/gc directory, too\n-\n-== Changelog ==\n-\n-=== ecl-10.2.1.p2 (Leif Leonhardy, 13th July 2010) ===\n-  * Removed src/msvc and src/contrib/encodings directories again.\n-  * Updated build/update instructions above.\n-```\n-(See also [this comment](https://github.com/sagemath/sage/issues/9187#comment:29) ff. at #9187)\n-\n-More worth is removing the GMP source tree, too:\n-\n-```\n-$ ls -l ecl-stripped-v?/*.spkg\n--rw-r--r-- 1 leif64 leif64 3976609 Jul 14 00:42 ecl-stripped-v1/ecl-10.2.1.p2.spkg\n--rw-r--r-- 1 leif64 leif64 2379135 Jul 14 00:02 ecl-stripped-v2/ecl-10.2.1.p2.spkg\n-```\n-(v2 with in addition GMP removed is less than half the size!)\n+Use tarball at:\n+* http://boxen.math.washington.edu/home/jpflori/upstream/ecl-12.12.1.20140409.tar.bz2\n``````\n",
    "created_at": "2014-04-13T19:28:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81955",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,38 +1,4 @@
-Snippet from (my new) `SPKG.txt`:
+Remove GMP subdir.
 
-```
-== Dependencies ==
-
- * mpir
- * boehm_gc
-
-== Special Update/Build Instructions ==
- * Delete the src/msvc directory
- * Delete the src/contrib/encodings directory.  So, do not build with
-   --enable-unicode: See https://github.com/sagemath/sage/issues/7732
- * TODO: Delete the src/src/gmp directory (13MB!), as we use MPIR
-     - perhaps add --with-gmp-prefix=$SAGE_LOCAL to configure
-       to make sure we use Sage's one (MPIR); this is independent
-       of the deletion of src/src/gmp
-     - needs copying src/src/gmp/install-sh to somewhere else or
-       patching configure to use e.g. that one in src/src/gc
- * TODO: Make ECL use Sage's Boehm GC on MacOS X as well (but perhaps
-   put some changes from ECL's into Sage's Boehm GC), then remove
-   the src/src/gc directory, too
-
-== Changelog ==
-
-=== ecl-10.2.1.p2 (Leif Leonhardy, 13th July 2010) ===
-  * Removed src/msvc and src/contrib/encodings directories again.
-  * Updated build/update instructions above.
-```
-(See also [this comment](https://github.com/sagemath/sage/issues/9187#comment:29) ff. at #9187)
-
-More worth is removing the GMP source tree, too:
-
-```
-$ ls -l ecl-stripped-v?/*.spkg
--rw-r--r-- 1 leif64 leif64 3976609 Jul 14 00:42 ecl-stripped-v1/ecl-10.2.1.p2.spkg
--rw-r--r-- 1 leif64 leif64 2379135 Jul 14 00:02 ecl-stripped-v2/ecl-10.2.1.p2.spkg
-```
-(v2 with in addition GMP removed is less than half the size!)
+Use tarball at:
+* http://boxen.math.washington.edu/home/jpflori/upstream/ecl-12.12.1.20140409.tar.bz2
``````




---

archive/issue_comments_081956.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bec64268f80d6a4eb9c89bdbe83452459d665e7c\">bec6426</a></td><td><code>Check that FSF config.* scripts are correctly copied from SAGE_ROOT/config.</code></td></tr></table>\n",
    "created_at": "2014-04-14T09:47:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81956",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bec64268f80d6a4eb9c89bdbe83452459d665e7c">bec6426</a></td><td><code>Check that FSF config.* scripts are correctly copied from SAGE_ROOT/config.</code></td></tr></table>




---

archive/issue_comments_081957.json:
```json
{
    "body": "Changed commit from **[ad497e7](https://github.com/sagemath/sagetrac-mirror/commit/ad497e751543fc52941a8b6affe0a9de55d55043)** to **[bec6426](https://github.com/sagemath/sagetrac-mirror/commit/bec64268f80d6a4eb9c89bdbe83452459d665e7c)**",
    "created_at": "2014-04-14T09:47:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81957",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ad497e7](https://github.com/sagemath/sagetrac-mirror/commit/ad497e751543fc52941a8b6affe0a9de55d55043)** to **[bec6426](https://github.com/sagemath/sagetrac-mirror/commit/bec64268f80d6a4eb9c89bdbe83452459d665e7c)**



---

archive/issue_comments_081958.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nIMHO if we already make our own tarball then we should just regenerate auto-files.",
    "created_at": "2014-04-14T22:34:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81958",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:19" align="right">comment:19</div>

IMHO if we already make our own tarball then we should just regenerate auto-files.



---

archive/issue_comments_081959.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI'm not sure that will much cleaner as we patch the auto-files as well, so `spkg-src` should first patch then regenerate vs copy two files and then patch...\n\nI don't have strong feeling though.",
    "created_at": "2014-04-15T08:47:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81959",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:20" align="right">comment:20</div>

I'm not sure that will much cleaner as we patch the auto-files as well, so `spkg-src` should first patch then regenerate vs copy two files and then patch...

I don't have strong feeling though.



---

archive/issue_comments_081960.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nUgh, once again somebody went the extra mile to show that you can't reasonably build shared libraries without libtool. \n\nSince ECL seems to have a maintainer again, did you try to push the `implib.patch` upstream?",
    "created_at": "2014-04-15T10:06:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81960",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:21" align="right">comment:21</div>

Ugh, once again somebody went the extra mile to show that you can't reasonably build shared libraries without libtool. 

Since ECL seems to have a maintainer again, did you try to push the `implib.patch` upstream?



---

archive/issue_comments_081961.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nYes, see http://sourceforge.net/p/ecls/feature-requests/15/",
    "created_at": "2014-04-15T12:20:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81961",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:22" align="right">comment:22</div>

Yes, see http://sourceforge.net/p/ecls/feature-requests/15/



---

archive/issue_comments_081962.json:
```json
{
    "body": "Upstream: **Reported upstream. No feedback yet.**",
    "created_at": "2014-04-15T16:47:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81962",
    "user": "https://github.com/vbraun"
}
```

Upstream: **Reported upstream. No feedback yet.**



---

archive/issue_comments_081963.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nNote that the implib patch is not part of this ticket.\nBut for what it's worth note that I used to communicate with the ECL dev and got a bunch of patches into ECL but not that one and now he's no longer maintaining ECL.\nNot sure if anyone is actually actively maintaining ECL anymore...\nOnce there is someone clearly identified we could just bump the request to get that in as at least from my point of view it perfectly makes sense to build shared lib this way on Cygwin.",
    "created_at": "2014-04-15T16:50:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81963",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:24" align="right">comment:24</div>

Note that the implib patch is not part of this ticket.
But for what it's worth note that I used to communicate with the ECL dev and got a bunch of patches into ECL but not that one and now he's no longer maintaining ECL.
Not sure if anyone is actually actively maintaining ECL anymore...
Once there is someone clearly identified we could just bump the request to get that in as at least from my point of view it perfectly makes sense to build shared lib this way on Cygwin.



---

archive/issue_events_122161.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9493#event-122161"
}
```



---

archive/issue_events_122162.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9493#event-122162"
}
```



---

archive/issue_events_122163.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-15T22:28:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9493#event-122163"
}
```



---

archive/issue_events_122164.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-15T22:28:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9493#event-122164"
}
```



---

archive/issue_comments_081964.json:
```json
{
    "body": "Reviewer: **Peter Bruin**",
    "created_at": "2014-05-15T22:28:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81964",
    "user": "https://github.com/pjbruin"
}
```

Reviewer: **Peter Bruin**



---

archive/issue_comments_081965.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nThe changes look good to me, and the new version of the package built without problems.  After reinstalling Maxima (I did not use `SAGE_UPGRADING`), all doctests passed.",
    "created_at": "2014-05-15T22:28:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81965",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:26" align="right">comment:26</div>

The changes look good to me, and the new version of the package built without problems.  After reinstalling Maxima (I did not use `SAGE_UPGRADING`), all doctests passed.



---

archive/issue_events_122165.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-21T15:33:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9493#event-122165"
}
```



---

archive/issue_events_122166.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "efb52a0ecf94a2f8e4363940a96ff7ca3df4b113",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-05-21T15:33:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9493#event-122166"
}
```



---

archive/issue_comments_081966.json:
```json
{
    "body": "Changed branch from **[u/jpflori/ticket/9493](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/9493)** to **[bec6426](https://github.com/sagemath/sagetrac-mirror/commit/bec64268f80d6a4eb9c89bdbe83452459d665e7c)**",
    "created_at": "2014-05-21T15:33:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9493#issuecomment-81966",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jpflori/ticket/9493](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/9493)** to **[bec6426](https://github.com/sagemath/sagetrac-mirror/commit/bec64268f80d6a4eb9c89bdbe83452459d665e7c)**
