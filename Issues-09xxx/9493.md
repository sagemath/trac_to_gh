# Issue 9493: Remove extra baggage from the ECL spkg

archive/issues_009493.json:
```json
{
    "body": "Remove GMP subdir.\n\nUse tarball at:\n* http://boxen.math.washington.edu/home/jpflori/upstream/ecl-12.12.1.20140409.tar.bz2\n\n**CC:**  drkirkby @kcrisman\n\n**Keywords:** ecl gmp cygwin spkg\n\n**Branch/Commit:** [bec64268f80d6a4eb9c89bdbe83452459d665e7c](https://github.com/sagemath/sagetrac-mirror/commit/bec64268f80d6a4eb9c89bdbe83452459d665e7c)\n\n**Upstream:** Reported upstream. No feedback yet.\n\n**Reviewer:** Peter Bruin\n\n**Author:** Leif Leonhardy, Jean-Pierre Flori\n\nIssue created by migration from https://trac.sagemath.org/ticket/9493\n\n",
    "closed_at": "2014-05-21T15:33:43Z",
    "created_at": "2010-07-13T23:19:35Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Remove extra baggage from the ECL spkg",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9493",
    "user": "https://github.com/nexttime"
}
```
Remove GMP subdir.

Use tarball at:
* http://boxen.math.washington.edu/home/jpflori/upstream/ecl-12.12.1.20140409.tar.bz2

**CC:**  drkirkby @kcrisman

**Keywords:** ecl gmp cygwin spkg

**Branch/Commit:** [bec64268f80d6a4eb9c89bdbe83452459d665e7c](https://github.com/sagemath/sagetrac-mirror/commit/bec64268f80d6a4eb9c89bdbe83452459d665e7c)

**Upstream:** Reported upstream. No feedback yet.

**Reviewer:** Peter Bruin

**Author:** Leif Leonhardy, Jean-Pierre Flori

Issue created by migration from https://trac.sagemath.org/ticket/9493





---

archive/issue_comments_105422.json:
```json
{
    "body": "<a id='comment:1'></a>\nMinimal patch to `configure` to allow `rm -r src/src/gmp`:\n\n```patch\n--- src/src/configure\t2010-02-13 20:04:32.000000000 +0100\n+++ patches/src.src.configure\t2010-07-14 01:29:39.000000000 +0200\n@@ -1987,7 +1987,7 @@\n \n \n ac_aux_dir=\n-for ac_dir in ${srcdir}/gmp \"$srcdir\"/${srcdir}/gmp; do\n+for ac_dir in ${srcdir}/gmp \"$srcdir\"/${srcdir}/gmp ${srcdir}/gc; do\n   if test -f \"$ac_dir/install-sh\"; then\n     ac_aux_dir=$ac_dir\n     ac_install_sh=\"$ac_aux_dir/install-sh -c\"\n```\n(Tested with 4.5.rc0 on a 32-bit Linux, with `--with-gmp-prefix=$SAGE_LOCAL` added to `./configure` in `spkg-install`, but *should* work as fine without that.)\n\nThough we should in mid-term remove (Boehm) gc as well, because Sage ships with its own copy of it. (ECL's boehm_gc is only used on MacOS X, and just because ECL unconditionally thinks an already installed version there can only be Fink's broken one.) But this is worth another ticket.\n\nAnother simple solution is just leaving `install-sh` in `src/src/gmp` (untested) or just copying it to `${srcdir} ` and adding *that* directory to the `for` list.",
    "created_at": "2010-07-14T00:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105422",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:1'></a>
Minimal patch to `configure` to allow `rm -r src/src/gmp`:

```patch
--- src/src/configure	2010-02-13 20:04:32.000000000 +0100
+++ patches/src.src.configure	2010-07-14 01:29:39.000000000 +0200
@@ -1987,7 +1987,7 @@
 
 
 ac_aux_dir=
-for ac_dir in ${srcdir}/gmp "$srcdir"/${srcdir}/gmp; do
+for ac_dir in ${srcdir}/gmp "$srcdir"/${srcdir}/gmp ${srcdir}/gc; do
   if test -f "$ac_dir/install-sh"; then
     ac_aux_dir=$ac_dir
     ac_install_sh="$ac_aux_dir/install-sh -c"
```
(Tested with 4.5.rc0 on a 32-bit Linux, with `--with-gmp-prefix=$SAGE_LOCAL` added to `./configure` in `spkg-install`, but *should* work as fine without that.)

Though we should in mid-term remove (Boehm) gc as well, because Sage ships with its own copy of it. (ECL's boehm_gc is only used on MacOS X, and just because ECL unconditionally thinks an already installed version there can only be Fink's broken one.) But this is worth another ticket.

Another simple solution is just leaving `install-sh` in `src/src/gmp` (untested) or just copying it to `${srcdir} ` and adding *that* directory to the `for` list.



---

archive/issue_comments_105423.json:
```json
{
    "body": "<a id='comment:2'></a>\nModified `spkg-install` to allow removal of GMP (suggestion):\n\n```patch\n--- ecl-stripped-v1/ecl-10.2.1.p2/spkg-install\t2010-07-12 05:22:11.000000000 +0200\n+++ ecl-stripped-v2/ecl-10.2.1.p2/spkg-install\t2010-07-14 02:21:22.000000000 +0200\n@@ -154,6 +154,15 @@\n # We clear MAKEFLAGS to fix building multiple spkgs in parallel on OS X.\n export MAKEFLAGS=\n \n+if [ -d patches ] && [ `ls patches` != \"\" ]; then\n+  echo \"Applying patches...\"\n+\n+    test -f patches/src.src.configure && cp -pv patches/src.src.configure src/src/configure\n+\n+  echo \"Finished applying patches.\"\n+  echo \" \"\n+fi\n+\n set +e\n \n cd src\n@@ -165,9 +174,9 @@\n    # 1) OpenSolaris (SunOS 5.11)\n    # 2) Intel or AMD CPU \n    # 3) 64-bit build\n-   ./configure --prefix=$SAGE_LOCAL --with-dffi=no\n+   ./configure --prefix=$SAGE_LOCAL --with-dffi=no --with-gmp-prefix=$SAGE_LOCAL\n else\n-   ./configure --prefix=$SAGE_LOCAL \n+   ./configure --prefix=$SAGE_LOCAL --with-gmp-prefix=$SAGE_LOCAL\n fi\n \n if [ $? -ne 0 ]; then\n```\n(v1's `spkg-install` is unchanged w.r.t. ECL 10.2.1.p1.)",
    "created_at": "2010-07-14T00:28:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105423",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:2'></a>
Modified `spkg-install` to allow removal of GMP (suggestion):

```patch
--- ecl-stripped-v1/ecl-10.2.1.p2/spkg-install	2010-07-12 05:22:11.000000000 +0200
+++ ecl-stripped-v2/ecl-10.2.1.p2/spkg-install	2010-07-14 02:21:22.000000000 +0200
@@ -154,6 +154,15 @@
 # We clear MAKEFLAGS to fix building multiple spkgs in parallel on OS X.
 export MAKEFLAGS=
 
+if [ -d patches ] && [ `ls patches` != "" ]; then
+  echo "Applying patches..."
+
+    test -f patches/src.src.configure && cp -pv patches/src.src.configure src/src/configure
+
+  echo "Finished applying patches."
+  echo " "
+fi
+
 set +e
 
 cd src
@@ -165,9 +174,9 @@
    # 1) OpenSolaris (SunOS 5.11)
    # 2) Intel or AMD CPU 
    # 3) 64-bit build
-   ./configure --prefix=$SAGE_LOCAL --with-dffi=no
+   ./configure --prefix=$SAGE_LOCAL --with-dffi=no --with-gmp-prefix=$SAGE_LOCAL
 else
-   ./configure --prefix=$SAGE_LOCAL 
+   ./configure --prefix=$SAGE_LOCAL --with-gmp-prefix=$SAGE_LOCAL
 fi
 
 if [ $? -ne 0 ]; then
```
(v1's `spkg-install` is unchanged w.r.t. ECL 10.2.1.p1.)



---

archive/issue_comments_105424.json:
```json
{
    "body": "<a id='comment:3'></a>\nGet rid of the '-v' option to 'cp'. It's not a POSIX option\n\nhttp://www.opengroup.org/onlinepubs/009695399/utilities/cp.html\n\nand will certainly fail on Solaris or OpenSolaris\n\nDave",
    "created_at": "2010-07-14T01:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105424",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:3'></a>
Get rid of the '-v' option to 'cp'. It's not a POSIX option

http://www.opengroup.org/onlinepubs/009695399/utilities/cp.html

and will certainly fail on Solaris or OpenSolaris

Dave



---

archive/issue_comments_105425.json:
```json
{
    "body": "<a id='comment:4'></a>\nWhat about\n\n```sh\ncopy-patch()\n{\n  if [ -f patches/$1 ] ; then\n    echo \"  Patching \"$2\n    cp -p patches/$1 $2\n  fi\n}\n```\nand (e.g.)\n\n```sh\nif [ -d patches ] && [ `ls patches` != \"\" ]; then\n  echo \"Applying patches...\" \n\n  copy-patch \"src.src.configure\" \"src/src/configure\"\n\n  echo \"Finished applying patches.\" \n  echo \" \" \nfi      \n```\n?",
    "created_at": "2010-07-14T02:09:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105425",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'></a>
What about

```sh
copy-patch()
{
  if [ -f patches/$1 ] ; then
    echo "  Patching "$2
    cp -p patches/$1 $2
  fi
}
```
and (e.g.)

```sh
if [ -d patches ] && [ `ls patches` != "" ]; then
  echo "Applying patches..." 

  copy-patch "src.src.configure" "src/src/configure"

  echo "Finished applying patches." 
  echo " " 
fi      
```
?



---

archive/issue_comments_105426.json:
```json
{
    "body": "<a id='comment:5'></a>\nI don't think \n\n```\nif [ -d patches ] && [ `ls patches` != \"\" ]; then\n```\n\nis safe. I don't think the order is guaranteed, so the second part could be evaluated before the first. Testing on \"\" is bad practice. \n\nDave",
    "created_at": "2010-10-29T13:52:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105426",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:5'></a>
I don't think 

```
if [ -d patches ] && [ `ls patches` != "" ]; then
```

is safe. I don't think the order is guaranteed, so the second part could be evaluated before the first. Testing on "" is bad practice. 

Dave



---

archive/issue_comments_105427.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [drkirkby](#comment%3A5):\n> I don't think \n> \n\n```\n if [ -d patches ] && [ `ls patches` != \"\" ]; then\n```\n> \n> is safe. I don't think the order is guaranteed, so the second part could be evaluated before the first.\n\n\n(Even if it was, it doesn't make a difference, but...)\n\nLike in C, the second expression is only evaluated if needed (same for `||`), such that\n\n```sh\nfoo && bar || baz\n``` \nis equivalent to\n\n```sh\nif foo; then\n    bar\nelse\n    baz\nfi\n```\n\n\nHowever, the <code>[ \\`ls patches\\` != \"\" ]</code> is suboptimal. The whole line could be\n\n```sh\nif ls patches/* >/dev/null 2>/dev/null; then\n```\n\n(One could substitute `ls` by e.g. `cat`, too.)  It was just one suggestion anyway.",
    "created_at": "2010-10-29T23:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105427",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:6'></a>
Replying to [drkirkby](#comment%3A5):
> I don't think 
> 

```
 if [ -d patches ] && [ `ls patches` != "" ]; then
```
> 
> is safe. I don't think the order is guaranteed, so the second part could be evaluated before the first.


(Even if it was, it doesn't make a difference, but...)

Like in C, the second expression is only evaluated if needed (same for `||`), such that

```sh
foo && bar || baz
``` 
is equivalent to

```sh
if foo; then
    bar
else
    baz
fi
```


However, the <code>[ \`ls patches\` != "" ]</code> is suboptimal. The whole line could be

```sh
if ls patches/* >/dev/null 2>/dev/null; then
```

(One could substitute `ls` by e.g. `cat`, too.)  It was just one suggestion anyway.



---

archive/issue_comments_105428.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [drkirkby](#comment%3A5):\n> I don't think the order is guaranteed, so the second part could be evaluated before the first. Testing on \"\" is bad practice. \n\n\nThe order of evaluation and the shortcutting is guaranteed by POSIX:\n\nhttp://www.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_09_03",
    "created_at": "2010-10-29T23:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105428",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:7'></a>
Replying to [drkirkby](#comment%3A5):
> I don't think the order is guaranteed, so the second part could be evaluated before the first. Testing on "" is bad practice. 


The order of evaluation and the shortcutting is guaranteed by POSIX:

http://www.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_09_03



---

archive/issue_comments_105429.json:
```json
{
    "body": "<a id='comment:8'></a>\nI believe this should be closed, and if further cleanups are required, a new ticket is opened. \n\nECL will be updated in Sage 4.6.1 to 10.4.1 in #10187. Most of the changes on this ticket are incorporated into #10187 anyway. \n\nDave",
    "created_at": "2010-12-03T00:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105429",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:8'></a>
I believe this should be closed, and if further cleanups are required, a new ticket is opened. 

ECL will be updated in Sage 4.6.1 to 10.4.1 in #10187. Most of the changes on this ticket are incorporated into #10187 anyway. 

Dave



---

archive/issue_comments_105430.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [drkirkby](#comment%3A8):\n> I believe this should be closed, and if further cleanups are required, a new ticket is opened. \n> \n> ECL will be updated in Sage 4.6.1 to 10.4.1 in #10187. Most of the changes on this ticket are incorporated into #10187 anyway. \n\n\nNothing of the TODOs mentioned in the description have been done on #10187; removing the other parts was just the correction of a regression.\n\nSo IMHO this ticket should be kept open.",
    "created_at": "2010-12-03T00:50:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105430",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'></a>
Replying to [drkirkby](#comment%3A8):
> I believe this should be closed, and if further cleanups are required, a new ticket is opened. 
> 
> ECL will be updated in Sage 4.6.1 to 10.4.1 in #10187. Most of the changes on this ticket are incorporated into #10187 anyway. 


Nothing of the TODOs mentioned in the description have been done on #10187; removing the other parts was just the correction of a regression.

So IMHO this ticket should be kept open.



---

archive/issue_events_028885.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "rename": {
        "from": "Remove extra baggage from ECL 10.2.1.p1 (again)",
        "to": "Remove extra baggage from the ECL spkg"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9493#event-28885"
}
```



---

archive/issue_comments_105431.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [leif](#comment%3A1):\n> Minimal patch to `configure` to allow `rm -r src/src/gmp`:\n> \n> ```patch\n> --- src/src/configure\t2010-02-13 20:04:32.000000000 +0100\n> +++ patches/src.src.configure\t2010-07-14 01:29:39.000000000 +0200\n> @@ -1987,7 +1987,7 @@\n>  \n>  \n>  ac_aux_dir=\n> -for ac_dir in ${srcdir}/gmp \"$srcdir\"/${srcdir}/gmp; do\n> +for ac_dir in ${srcdir}/gmp \"$srcdir\"/${srcdir}/gmp ${srcdir}/gc; do\n>    if test -f \"$ac_dir/install-sh\"; then\n>      ac_aux_dir=$ac_dir\n>      ac_install_sh=\"$ac_aux_dir/install-sh -c\"\n> ```\n\n\nNo idea whether that's at all still necessary (when removing the unused GMP source tree) -- we're meanwhile at ECL 12.12.1...\n\n> Another simple solution is just leaving `install-sh` in `src/src/gmp` (untested) or just copying it to `${srcdir} ` and adding *that* directory to the `for` list.\n",
    "created_at": "2013-06-21T20:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105431",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:12'></a>
Replying to [leif](#comment%3A1):
> Minimal patch to `configure` to allow `rm -r src/src/gmp`:
> 
> ```patch
> --- src/src/configure	2010-02-13 20:04:32.000000000 +0100
> +++ patches/src.src.configure	2010-07-14 01:29:39.000000000 +0200
> @@ -1987,7 +1987,7 @@
>  
>  
>  ac_aux_dir=
> -for ac_dir in ${srcdir}/gmp "$srcdir"/${srcdir}/gmp; do
> +for ac_dir in ${srcdir}/gmp "$srcdir"/${srcdir}/gmp ${srcdir}/gc; do
>    if test -f "$ac_dir/install-sh"; then
>      ac_aux_dir=$ac_dir
>      ac_install_sh="$ac_aux_dir/install-sh -c"
> ```


No idea whether that's at all still necessary (when removing the unused GMP source tree) -- we're meanwhile at ECL 12.12.1...

> Another simple solution is just leaving `install-sh` in `src/src/gmp` (untested) or just copying it to `${srcdir} ` and adding *that* directory to the `for` list.




---

archive/issue_comments_105432.json:
```json
{
    "body": "<a id='comment:13'></a>\nOoops, just noticed:\n\n```sh\n$ tar tvjf spkg/standard/ecl-* | grep gmp\ntar: Record size = 8 blocks\ndrwxr-xr-x jdemeyer/jdemeyer      0 2013-04-08 13:05 ecl-12.12.1.p4/src/src/gmp/\n-rwxr-xr-x jdemeyer/jdemeyer   4105 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/config.sub\n-rwxr-xr-x jdemeyer/jdemeyer  31164 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/configfsf.sub\n-rwxr-xr-x jdemeyer/jdemeyer  23041 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/config.guess\n-rwxr-xr-x jdemeyer/jdemeyer   9505 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/install-sh\n-rwxr-xr-x jdemeyer/jdemeyer  43636 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/configfsf.guess\n-rw-r--r-- jdemeyer/jdemeyer  15353 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/config.in\n```\n\nSo there's meanwhile not much of GMP left (in our spkg), but its `config*` files still disturb: #14648\n\nHence the `install-sh` fix above should still be valid (and useful) ...",
    "created_at": "2013-06-21T20:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105432",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:13'></a>
Ooops, just noticed:

```sh
$ tar tvjf spkg/standard/ecl-* | grep gmp
tar: Record size = 8 blocks
drwxr-xr-x jdemeyer/jdemeyer      0 2013-04-08 13:05 ecl-12.12.1.p4/src/src/gmp/
-rwxr-xr-x jdemeyer/jdemeyer   4105 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/config.sub
-rwxr-xr-x jdemeyer/jdemeyer  31164 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/configfsf.sub
-rwxr-xr-x jdemeyer/jdemeyer  23041 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/config.guess
-rwxr-xr-x jdemeyer/jdemeyer   9505 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/install-sh
-rwxr-xr-x jdemeyer/jdemeyer  43636 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/configfsf.guess
-rw-r--r-- jdemeyer/jdemeyer  15353 2012-12-07 22:01 ecl-12.12.1.p4/src/src/gmp/config.in
```

So there's meanwhile not much of GMP left (in our spkg), but its `config*` files still disturb: #14648

Hence the `install-sh` fix above should still be valid (and useful) ...



---

archive/issue_events_028886.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9493#event-28886"
}
```



---

archive/issue_events_028887.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9493#event-28887"
}
```



---

archive/issue_events_028888.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9493#event-28888"
}
```



---

archive/issue_comments_105433.json:
```json
{
    "body": "**Branch:** [u/jpflori/ticket/9493](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/9493)",
    "created_at": "2014-04-13T19:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105433",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Branch:** [u/jpflori/ticket/9493](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/9493)



---

archive/issue_comments_105434.json:
```json
{
    "body": "**Changing author** from \"Leif Leonhardy\" to \"Leif Leonhardy, Jean-Pierre Flori\".",
    "created_at": "2014-04-13T19:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105434",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing author** from "Leif Leonhardy" to "Leif Leonhardy, Jean-Pierre Flori".



---

archive/issue_comments_105435.json:
```json
{
    "body": "<a id='comment:16'></a>\nLet's get rid of the gmp subdirectory.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ad497e751543fc52941a8b6affe0a9de55d55043\">ad497e7</a></td><td><code>Strip GMP out of ECL and use up to date config.* scripts.</code></td></tr></table>\n",
    "created_at": "2014-04-13T19:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105435",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:16'></a>
Let's get rid of the gmp subdirectory.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ad497e751543fc52941a8b6affe0a9de55d55043">ad497e7</a></td><td><code>Strip GMP out of ECL and use up to date config.* scripts.</code></td></tr></table>




---

archive/issue_comments_105436.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2014-04-13T19:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105436",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_105437.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"ecl gmp cygwin spkg\".",
    "created_at": "2014-04-13T19:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105437",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing keywords** from "" to "ecl gmp cygwin spkg".



---

archive/issue_comments_105438.json:
```json
{
    "body": "**Commit:** [ad497e751543fc52941a8b6affe0a9de55d55043](https://github.com/sagemath/sagetrac-mirror/commit/ad497e751543fc52941a8b6affe0a9de55d55043)",
    "created_at": "2014-04-13T19:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105438",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Commit:** [ad497e751543fc52941a8b6affe0a9de55d55043](https://github.com/sagemath/sagetrac-mirror/commit/ad497e751543fc52941a8b6affe0a9de55d55043)



---

archive/issue_comments_105439.json:
```json
{
    "body": "<a id='comment:17'></a>\nI think the previously rmoved encoding stuff is actually planned to be used, so I did not change its inclusion.",
    "created_at": "2014-04-13T19:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105439",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:17'></a>
I think the previously rmoved encoding stuff is actually planned to be used, so I did not change its inclusion.



---

archive/issue_comments_105440.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,38 +1,4 @@\n-Snippet from (my new) `SPKG.txt`:\n+Remove GMP subdir.\n \n-```\n-## Dependencies\n-\n- * mpir\n- * boehm_gc\n-\n-## Special Update/Build Instructions\n- * Delete the src/msvc directory\n- * Delete the src/contrib/encodings directory.  So, do not build with\n-   --enable-unicode: See http://trac.sagemath.org/sage_trac/ticket/7732\n- * TODO: Delete the src/src/gmp directory (13MB!), as we use MPIR\n-     - perhaps add --with-gmp-prefix=$SAGE_LOCAL to configure\n-       to make sure we use Sage's one (MPIR); this is independent\n-       of the deletion of src/src/gmp\n-     - needs copying src/src/gmp/install-sh to somewhere else or\n-       patching configure to use e.g. that one in src/src/gc\n- * TODO: Make ECL use Sage's Boehm GC on MacOS X as well (but perhaps\n-   put some changes from ECL's into Sage's Boehm GC), then remove\n-   the src/src/gc directory, too\n-\n-## Changelog\n-\n-### ecl-10.2.1.p2 (Leif Leonhardy, 13th July 2010)\n-  * Removed src/msvc and src/contrib/encodings directories again.\n-  * Updated build/update instructions above.\n-```\n-(See also [this comment](http://trac.sagemath.org/sage_trac/ticket/9187#comment:29) ff. at #9187)\n-\n-More worth is removing the GMP source tree, too:\n-\n-```\n-$ ls -l ecl-stripped-v?/*.spkg\n--rw-r--r-- 1 leif64 leif64 3976609 Jul 14 00:42 ecl-stripped-v1/ecl-10.2.1.p2.spkg\n--rw-r--r-- 1 leif64 leif64 2379135 Jul 14 00:02 ecl-stripped-v2/ecl-10.2.1.p2.spkg\n-```\n-(v2 with in addition GMP removed is less than half the size!)\n+Use tarball at:\n+* http://boxen.math.washington.edu/home/jpflori/upstream/ecl-12.12.1.20140409.tar.bz2\n``````\n",
    "created_at": "2014-04-13T19:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105440",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,38 +1,4 @@
-Snippet from (my new) `SPKG.txt`:
+Remove GMP subdir.
 
-```
-## Dependencies
-
- * mpir
- * boehm_gc
-
-## Special Update/Build Instructions
- * Delete the src/msvc directory
- * Delete the src/contrib/encodings directory.  So, do not build with
-   --enable-unicode: See http://trac.sagemath.org/sage_trac/ticket/7732
- * TODO: Delete the src/src/gmp directory (13MB!), as we use MPIR
-     - perhaps add --with-gmp-prefix=$SAGE_LOCAL to configure
-       to make sure we use Sage's one (MPIR); this is independent
-       of the deletion of src/src/gmp
-     - needs copying src/src/gmp/install-sh to somewhere else or
-       patching configure to use e.g. that one in src/src/gc
- * TODO: Make ECL use Sage's Boehm GC on MacOS X as well (but perhaps
-   put some changes from ECL's into Sage's Boehm GC), then remove
-   the src/src/gc directory, too
-
-## Changelog
-
-### ecl-10.2.1.p2 (Leif Leonhardy, 13th July 2010)
-  * Removed src/msvc and src/contrib/encodings directories again.
-  * Updated build/update instructions above.
-```
-(See also [this comment](http://trac.sagemath.org/sage_trac/ticket/9187#comment:29) ff. at #9187)
-
-More worth is removing the GMP source tree, too:
-
-```
-$ ls -l ecl-stripped-v?/*.spkg
--rw-r--r-- 1 leif64 leif64 3976609 Jul 14 00:42 ecl-stripped-v1/ecl-10.2.1.p2.spkg
--rw-r--r-- 1 leif64 leif64 2379135 Jul 14 00:02 ecl-stripped-v2/ecl-10.2.1.p2.spkg
-```
-(v2 with in addition GMP removed is less than half the size!)
+Use tarball at:
+* http://boxen.math.washington.edu/home/jpflori/upstream/ecl-12.12.1.20140409.tar.bz2
``````




---

archive/issue_comments_105441.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bec64268f80d6a4eb9c89bdbe83452459d665e7c\">bec6426</a></td><td><code>Check that FSF config.* scripts are correctly copied from SAGE_ROOT/config.</code></td></tr></table>\n",
    "created_at": "2014-04-14T09:47:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105441",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bec64268f80d6a4eb9c89bdbe83452459d665e7c">bec6426</a></td><td><code>Check that FSF config.* scripts are correctly copied from SAGE_ROOT/config.</code></td></tr></table>




---

archive/issue_comments_105442.json:
```json
{
    "body": "**Changing commit** from \"[ad497e751543fc52941a8b6affe0a9de55d55043](https://github.com/sagemath/sagetrac-mirror/commit/ad497e751543fc52941a8b6affe0a9de55d55043)\" to \"[bec64268f80d6a4eb9c89bdbe83452459d665e7c](https://github.com/sagemath/sagetrac-mirror/commit/bec64268f80d6a4eb9c89bdbe83452459d665e7c)\".",
    "created_at": "2014-04-14T09:47:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105442",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ad497e751543fc52941a8b6affe0a9de55d55043](https://github.com/sagemath/sagetrac-mirror/commit/ad497e751543fc52941a8b6affe0a9de55d55043)" to "[bec64268f80d6a4eb9c89bdbe83452459d665e7c](https://github.com/sagemath/sagetrac-mirror/commit/bec64268f80d6a4eb9c89bdbe83452459d665e7c)".



---

archive/issue_comments_105443.json:
```json
{
    "body": "<a id='comment:19'></a>\nIMHO if we already make our own tarball then we should just regenerate auto-files.",
    "created_at": "2014-04-14T22:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105443",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>
IMHO if we already make our own tarball then we should just regenerate auto-files.



---

archive/issue_comments_105444.json:
```json
{
    "body": "<a id='comment:20'></a>\nI'm not sure that will much cleaner as we patch the auto-files as well, so `spkg-src` should first patch then regenerate vs copy two files and then patch...\n\nI don't have strong feeling though.",
    "created_at": "2014-04-15T08:47:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105444",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:20'></a>
I'm not sure that will much cleaner as we patch the auto-files as well, so `spkg-src` should first patch then regenerate vs copy two files and then patch...

I don't have strong feeling though.



---

archive/issue_comments_105445.json:
```json
{
    "body": "<a id='comment:21'></a>\nUgh, once again somebody went the extra mile to show that you can't reasonably build shared libraries without libtool. \n\nSince ECL seems to have a maintainer again, did you try to push the `implib.patch` upstream?",
    "created_at": "2014-04-15T10:06:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105445",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:21'></a>
Ugh, once again somebody went the extra mile to show that you can't reasonably build shared libraries without libtool. 

Since ECL seems to have a maintainer again, did you try to push the `implib.patch` upstream?



---

archive/issue_comments_105446.json:
```json
{
    "body": "<a id='comment:22'></a>\nYes, see http://sourceforge.net/p/ecls/feature-requests/15/",
    "created_at": "2014-04-15T12:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105446",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:22'></a>
Yes, see http://sourceforge.net/p/ecls/feature-requests/15/



---

archive/issue_comments_105447.json:
```json
{
    "body": "**Changing upstream** from \"N/A\" to \"Reported upstream. No feedback yet.\".",
    "created_at": "2014-04-15T16:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105447",
    "user": "https://github.com/vbraun"
}
```

**Changing upstream** from "N/A" to "Reported upstream. No feedback yet.".



---

archive/issue_comments_105448.json:
```json
{
    "body": "<a id='comment:24'></a>\nNote that the implib patch is not part of this ticket.\nBut for what it's worth note that I used to communicate with the ECL dev and got a bunch of patches into ECL but not that one and now he's no longer maintaining ECL.\nNot sure if anyone is actually actively maintaining ECL anymore...\nOnce there is someone clearly identified we could just bump the request to get that in as at least from my point of view it perfectly makes sense to build shared lib this way on Cygwin.",
    "created_at": "2014-04-15T16:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105448",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:24'></a>
Note that the implib patch is not part of this ticket.
But for what it's worth note that I used to communicate with the ECL dev and got a bunch of patches into ECL but not that one and now he's no longer maintaining ECL.
Not sure if anyone is actually actively maintaining ECL anymore...
Once there is someone clearly identified we could just bump the request to get that in as at least from my point of view it perfectly makes sense to build shared lib this way on Cygwin.



---

archive/issue_events_028889.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9493#event-28889"
}
```



---

archive/issue_events_028890.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9493#event-28890"
}
```



---

archive/issue_comments_105449.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2014-05-15T22:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105449",
    "user": "https://github.com/pjbruin"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_105450.json:
```json
{
    "body": "**Reviewer:** Peter Bruin",
    "created_at": "2014-05-15T22:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105450",
    "user": "https://github.com/pjbruin"
}
```

**Reviewer:** Peter Bruin



---

archive/issue_comments_105451.json:
```json
{
    "body": "<a id='comment:26'></a>\nThe changes look good to me, and the new version of the package built without problems.  After reinstalling Maxima (I did not use `SAGE_UPGRADING`), all doctests passed.",
    "created_at": "2014-05-15T22:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105451",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:26'></a>
The changes look good to me, and the new version of the package built without problems.  After reinstalling Maxima (I did not use `SAGE_UPGRADING`), all doctests passed.



---

archive/issue_events_028891.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-21T15:33:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9493#event-28891"
}
```



---

archive/issue_comments_105452.json:
```json
{
    "body": "**Changing branch** from \"[u/jpflori/ticket/9493](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/9493)\" to \"[bec64268f80d6a4eb9c89bdbe83452459d665e7c](https://github.com/sagemath/sagetrac-mirror/commit/bec64268f80d6a4eb9c89bdbe83452459d665e7c)\".",
    "created_at": "2014-05-21T15:33:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9493#issuecomment-105452",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jpflori/ticket/9493](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/9493)" to "[bec64268f80d6a4eb9c89bdbe83452459d665e7c](https://github.com/sagemath/sagetrac-mirror/commit/bec64268f80d6a4eb9c89bdbe83452459d665e7c)".
