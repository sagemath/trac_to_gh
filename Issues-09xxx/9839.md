# Issue 9839: Add dual cone computation

archive/issues_009838.json:
```json
{
    "body": "This patch allows computing dual cones, including non-strictly convex and non-full-dimensional cases. \n\nThe actual work is done in `facet_normals` which now works for non-strictly convex cones as well. The method `base_extend` for quotient lattices was added during one of the implementation attempts and I left it for future use as well (the hope was to create cones in quotient lattices, but it does not work yet).\n\nThere is still a dimension 6 limitation stemming from PALP for computing duals and facet normals. This is still our best option for low dimension, but perhaps it would be nice if `facet_normals` caught the exception when PALP does not work and used polyhedra module in this case. Then computing the dual cone and face lattices should work automatically.\n\nSee #9604 for dependencies.\n\nAssignee: mhampton\n\nCC:  @vbraun\n\nResolution: fixed\n\nAuthor: Andrey Novoseltsev\n\nReviewer: Volker Braun\n\nMerged: sage-4.6.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/9839\n\n",
    "closed_at": "2010-09-15T09:57:50Z",
    "created_at": "2010-08-30T05:49:07Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6",
    "title": "Add dual cone computation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9839",
    "user": "https://github.com/novoselt"
}
```
This patch allows computing dual cones, including non-strictly convex and non-full-dimensional cases. 

The actual work is done in `facet_normals` which now works for non-strictly convex cones as well. The method `base_extend` for quotient lattices was added during one of the implementation attempts and I left it for future use as well (the hope was to create cones in quotient lattices, but it does not work yet).

There is still a dimension 6 limitation stemming from PALP for computing duals and facet normals. This is still our best option for low dimension, but perhaps it would be nice if `facet_normals` caught the exception when PALP does not work and used polyhedra module in this case. Then computing the dual cone and face lattices should work automatically.

See #9604 for dependencies.

Assignee: mhampton

CC:  @vbraun

Resolution: fixed

Author: Andrey Novoseltsev

Reviewer: Volker Braun

Merged: sage-4.6.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/9839





---

archive/issue_comments_116302.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,6 +4,8 @@\n \n There is still a dimension 6 limitation stemming from PALP for computing duals and facet normals. This is still our best option for low dimension, but perhaps it would be nice if `facet_normals` caught the exception when PALP does not work and used polyhedra module in this case. Then computing the dual cone and face lattices should work automatically.\n \n+See #9604 for dependencies.\n+\n Issue created by migration from https://trac.sagemath.org/ticket/9839\n \n \n``````\n",
    "created_at": "2010-08-30T05:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9839#issuecomment-116302",
    "user": "https://github.com/novoselt"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,6 +4,8 @@
 
 There is still a dimension 6 limitation stemming from PALP for computing duals and facet normals. This is still our best option for low dimension, but perhaps it would be nice if `facet_normals` caught the exception when PALP does not work and used polyhedra module in this case. Then computing the dual cone and face lattices should work automatically.
 
+See #9604 for dependencies.
+
 Issue created by migration from https://trac.sagemath.org/ticket/9839
 
 
``````




---

archive/issue_comments_116303.json:
```json
{
    "body": "Changing author from \"\" to \"Andrey Novoseltsev\"",
    "created_at": "2010-08-30T05:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9839#issuecomment-116303",
    "user": "https://github.com/novoselt"
}
```

Changing author from "" to "Andrey Novoseltsev"



---

archive/issue_comments_116304.json:
```json
{
    "body": "<a id='comment:1'></a>Attachment [trac_9839_add_dual_cone_computation.patch](tarball://root/attachments/some-uuid/ticket9839/trac_9839_add_dual_cone_computation.patch) by @novoselt created at 2010-08-30 05:53:15",
    "created_at": "2010-08-30T05:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9839#issuecomment-116304",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:1'></a>Attachment [trac_9839_add_dual_cone_computation.patch](tarball://root/attachments/some-uuid/ticket9839/trac_9839_add_dual_cone_computation.patch) by @novoselt created at 2010-08-30 05:53:15



---

archive/issue_comments_116305.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-08-30T05:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9839#issuecomment-116305",
    "user": "https://github.com/novoselt"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_116306.json:
```json
{
    "body": "<a id='comment:2'></a>I don't like that your lattice now needs to have `self.dual()` implemented:\n\n```\nsage: c = Cone([(1,0), [0,1]], lattice = ZZ^2)\nsage: c.facet_normals()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n\n/home/vbraun/opt/sage-4.5.2/devel/sage-main/<ipython console> in <module>()\n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/geometry/cone.pyc in facet_normals(self)\n   1808         \"\"\"\n   1809         if \"_facet_normals\" not in self.__dict__:\n-> 1810             M = self.lattice().dual()\n   1811             P = self.lattice_polytope()\n   1812             rotate_lifts = not self.is_strictly_convex()\n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__getattr__ (sage/structure/parent.c:5311)()\n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.getattr_from_other_class (sage/structure/parent.c:2757)()\n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.raise_attribute_error (sage/structure/parent.c:2629)()\n\nAttributeError: 'FreeModule_ambient_pid_with_category' object has no attribute 'dual'\n```\nThis essentially limits you to `ToricLattice`s now. I think it would be good for `factet_normals()` to use the same lattice otherwise, so `ZZ^n` works as well. \n\nThe rest looks good!",
    "created_at": "2010-08-30T12:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9839#issuecomment-116306",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>I don't like that your lattice now needs to have `self.dual()` implemented:

```
sage: c = Cone([(1,0), [0,1]], lattice = ZZ^2)
sage: c.facet_normals()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

/home/vbraun/opt/sage-4.5.2/devel/sage-main/<ipython console> in <module>()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/geometry/cone.pyc in facet_normals(self)
   1808         """
   1809         if "_facet_normals" not in self.__dict__:
-> 1810             M = self.lattice().dual()
   1811             P = self.lattice_polytope()
   1812             rotate_lifts = not self.is_strictly_convex()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__getattr__ (sage/structure/parent.c:5311)()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.getattr_from_other_class (sage/structure/parent.c:2757)()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.raise_attribute_error (sage/structure/parent.c:2629)()

AttributeError: 'FreeModule_ambient_pid_with_category' object has no attribute 'dual'
```
This essentially limits you to `ToricLattice`s now. I think it would be good for `factet_normals()` to use the same lattice otherwise, so `ZZ^n` works as well. 

The rest looks good!



---

archive/issue_comments_116307.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Volker Braun\"",
    "created_at": "2010-08-30T15:19:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9839#issuecomment-116307",
    "user": "https://github.com/vbraun"
}
```

Changing reviewer from "" to "Volker Braun"



---

archive/issue_comments_116308.json:
```json
{
    "body": "<a id='comment:3'></a>The absence of `dual()` also annoyed me in the divisor class stuff which is built on top of `ZZ^n`... So here is a patch. I added a new `cone.lattice_dual()` method which returns the dual toric lattice (if possible) or the original lattice (if not possible).\n\nI'm fine with the current state of affairs, so feel free to set positive review if its ok with you.",
    "created_at": "2010-08-30T15:19:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9839#issuecomment-116308",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>The absence of `dual()` also annoyed me in the divisor class stuff which is built on top of `ZZ^n`... So here is a patch. I added a new `cone.lattice_dual()` method which returns the dual toric lattice (if possible) or the original lattice (if not possible).

I'm fine with the current state of affairs, so feel free to set positive review if its ok with you.



---

archive/issue_comments_116309.json:
```json
{
    "body": "<a id='comment:4'></a>Great additions for the dual lattice and documentation clarifications!\n\nJust a couple of suggestions: can we\n* name the method `dual_lattice` instead of `lattice_dual` and\n* add to the documentation of this method itself an explanation that \"dual lattice\" is the same as \"just lattice\" if it does not have `dual()` method?",
    "created_at": "2010-08-30T18:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9839#issuecomment-116309",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:4'></a>Great additions for the dual lattice and documentation clarifications!

Just a couple of suggestions: can we
* name the method `dual_lattice` instead of `lattice_dual` and
* add to the documentation of this method itself an explanation that "dual lattice" is the same as "just lattice" if it does not have `dual()` method?



---

archive/issue_comments_116310.json:
```json
{
    "body": "Updated patch",
    "created_at": "2010-08-30T21:01:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9839#issuecomment-116310",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_116311.json:
```json
{
    "body": "<a id='comment:5'></a>Attachment [trac_9839_reviewer.patch](tarball://root/attachments/some-uuid/ticket9839/trac_9839_reviewer.patch) by @vbraun created at 2010-08-30 21:02:18\n\nRenamed to `dual_lattice` and added documentation.",
    "created_at": "2010-08-30T21:02:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9839#issuecomment-116311",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>Attachment [trac_9839_reviewer.patch](tarball://root/attachments/some-uuid/ticket9839/trac_9839_reviewer.patch) by @vbraun created at 2010-08-30 21:02:18

Renamed to `dual_lattice` and added documentation.



---

archive/issue_comments_116312.json:
```json
{
    "body": "Adjusted version",
    "created_at": "2010-08-31T00:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9839#issuecomment-116312",
    "user": "https://github.com/novoselt"
}
```

Adjusted version



---

archive/issue_comments_116313.json:
```json
{
    "body": "<a id='comment:6'></a>Attachment [trac_9839_reviewer.2.patch](tarball://root/attachments/some-uuid/ticket9839/trac_9839_reviewer.2.patch) by @novoselt created at 2010-08-31 00:30:43\n\nThank you! I caught a broken link and changed a little bit documentation in lines 1743-1749 of the new patch. If it looks OK, please switch to positive review!",
    "created_at": "2010-08-31T00:30:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9839#issuecomment-116313",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:6'></a>Attachment [trac_9839_reviewer.2.patch](tarball://root/attachments/some-uuid/ticket9839/trac_9839_reviewer.2.patch) by @novoselt created at 2010-08-31 00:30:43

Thank you! I caught a broken link and changed a little bit documentation in lines 1743-1749 of the new patch. If it looks OK, please switch to positive review!



---

archive/issue_comments_116314.json:
```json
{
    "body": "<a id='comment:7'></a>Looks good. Positive review.\n\nFor the release coordinator: Apply \n\n1. `trac_9839_add_dual_cone_computation.patch`\n2. `trac_9839_reviewer.2.patch`",
    "created_at": "2010-08-31T19:10:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9839#issuecomment-116314",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>Looks good. Positive review.

For the release coordinator: Apply 

1. `trac_9839_add_dual_cone_computation.patch`
2. `trac_9839_reviewer.2.patch`



---

archive/issue_comments_116315.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-08-31T19:10:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9839#issuecomment-116315",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_116316.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-09-15T09:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9839#issuecomment-116316",
    "user": "https://github.com/qed777"
}
```

Resolution: fixed



---

archive/issue_events_024772.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-15T09:57:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9839",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9839#event-24772"
}
```



---

archive/issue_comments_116317.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.6.alpha1\"",
    "created_at": "2010-09-15T09:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9839#issuecomment-116317",
    "user": "https://github.com/qed777"
}
```

Changing merged from "" to "sage-4.6.alpha1"
