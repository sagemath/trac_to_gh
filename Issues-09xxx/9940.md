# Issue 9940: Fix equality/inequality for AdditiveAbelianGroup

archive/issues_009939.json:
```json
{
    "body": "Inequality for the class `AdditiveAbelianGroup` has a bug:\n\n```\nsage: AdditiveAbelianGroup([0,0]) == AdditiveAbelianGroup([0,0]) \nTrue\nsage: AdditiveAbelianGroup([0,0]) != AdditiveAbelianGroup([0,0]) \nTrue\n```\nThis causes doctest failures as reported by mpatel: with the optional CHomP package in 4.5.3 on sage.math, I get some doctest failures.  These vary from run to run:\n\n```python\nsage -t -long -only-optional=chomp \"devel/sage/sage/homology/tests.py\"\n**********************************************************************\nFile \"/mnt/usb1/scratch/mpatel/tmp/sage-4.5.3-chomp/devel/sage/sage/homology/tests.py\", line 10:\n    sage: test_random_chain_complex(trials=20)  # optional - CHomP\nExpected nothing\nGot:\n    Homology in dimension 4 according to CHomP: C11\n    Homology in dimension 4 according to Sage: C11\n    Chain complex: {4: [], 5: 27 x 29 dense matrix over Integer Ring}\n    Random testing has revealed a problem in test_random_chain_complex\n    Please report this bug!  You may be the first\n    person in the world to have seen this problem.\n    Please include this random seed in your bug report:\n    Random seed: 53567958912087940719696565588289296809\n    ValueError()\n**********************************************************************\nFile \"/mnt/usb1/scratch/mpatel/tmp/sage-4.5.3-chomp/devel/sage/sage/homology/tests.py\", line 11:\n    sage: test_random_chain_complex(level=2, trials=20)  # optional - CHomP\nExpected nothing\nGot:\n    Homology in dimension 36 according to CHomP: 0\n    Homology in dimension 36 according to Sage: 0\n    Chain complex: {36: 58 x 37 sparse matrix over Integer Ring, 37: 0 x 58 dense matrix over Integer Ring}   \n    Random testing has revealed a problem in test_random_chain_complex\n    Please report this bug!  You may be the first\n    person in the world to have seen this problem.\n    Please include this random seed in your bug report:\n    Random seed: 194608326129552863405536402610270411271\n    ValueError()\n**********************************************************************\nFile \"/mnt/usb1/scratch/mpatel/tmp/sage-4.5.3-chomp/devel/sage/sage/homology/tests.py\", line 12:\n    sage: test_random_chain_complex(level=4, trials=20)  # long time # optional - CHomP\nExpected nothing\nGot:\n    Homology in dimension 125 according to CHomP: Z^56\n    Homology in dimension 125 according to Sage: Z^56\n    Chain complex: {125: 0 x 173 dense matrix over Integer Ring, 126: 173 x 117 dense matrix over Integer Ring}\n    Random testing has revealed a problem in test_random_chain_complex\n    Please report this bug!  You may be the first\n    person in the world to have seen this problem.\n    Please include this random seed in your bug report:\n    Random seed: 35064267617427002531027772896998931605\n    ValueError()\n**********************************************************************\nFile \"/mnt/usb1/scratch/mpatel/tmp/sage-4.5.3-chomp/devel/sage/sage/homology/tests.py\", line 72:\n    sage: test_random_chain_complex(trials=2)  # optional - CHomP\nExpected nothing\nGot:\n    Homology in dimension -43 according to CHomP: 0\n    Homology in dimension -43 according to Sage: 0\n    Chain complex: {-43: 41 x 0 dense matrix over Integer Ring, -42: []}\n    Random testing has revealed a problem in test_random_chain_complex\n    Please report this bug!  You may be the first\n    person in the world to have seen this problem.\n    Please include this random seed in your bug report:\n    Random seed: 198276055669197070047963781696502632135\n    ValueError()\n```\n\n**Assignee:** joyner\n\n**CC:**  @jhpalmieri @rbeezer @loefflerd @novoselt @vbraun\n\n**Resolution:** fixed\n\n**Author:** John Palmieri\n\n**Reviewer:** Rob Beezer\n\n**Merged:** sage-4.6.1.alpha3\n\nIssue created by migration from https://trac.sagemath.org/ticket/9940\n\n",
    "closed_at": "2010-12-02T16:09:42Z",
    "created_at": "2010-09-18T08:29:30Z",
    "labels": [
        "component: group theory",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.1",
    "title": "Fix equality/inequality for AdditiveAbelianGroup",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9940",
    "user": "https://github.com/qed777"
}
```
Inequality for the class `AdditiveAbelianGroup` has a bug:

```
sage: AdditiveAbelianGroup([0,0]) == AdditiveAbelianGroup([0,0]) 
True
sage: AdditiveAbelianGroup([0,0]) != AdditiveAbelianGroup([0,0]) 
True
```
This causes doctest failures as reported by mpatel: with the optional CHomP package in 4.5.3 on sage.math, I get some doctest failures.  These vary from run to run:

```python
sage -t -long -only-optional=chomp "devel/sage/sage/homology/tests.py"
**********************************************************************
File "/mnt/usb1/scratch/mpatel/tmp/sage-4.5.3-chomp/devel/sage/sage/homology/tests.py", line 10:
    sage: test_random_chain_complex(trials=20)  # optional - CHomP
Expected nothing
Got:
    Homology in dimension 4 according to CHomP: C11
    Homology in dimension 4 according to Sage: C11
    Chain complex: {4: [], 5: 27 x 29 dense matrix over Integer Ring}
    Random testing has revealed a problem in test_random_chain_complex
    Please report this bug!  You may be the first
    person in the world to have seen this problem.
    Please include this random seed in your bug report:
    Random seed: 53567958912087940719696565588289296809
    ValueError()
**********************************************************************
File "/mnt/usb1/scratch/mpatel/tmp/sage-4.5.3-chomp/devel/sage/sage/homology/tests.py", line 11:
    sage: test_random_chain_complex(level=2, trials=20)  # optional - CHomP
Expected nothing
Got:
    Homology in dimension 36 according to CHomP: 0
    Homology in dimension 36 according to Sage: 0
    Chain complex: {36: 58 x 37 sparse matrix over Integer Ring, 37: 0 x 58 dense matrix over Integer Ring}   
    Random testing has revealed a problem in test_random_chain_complex
    Please report this bug!  You may be the first
    person in the world to have seen this problem.
    Please include this random seed in your bug report:
    Random seed: 194608326129552863405536402610270411271
    ValueError()
**********************************************************************
File "/mnt/usb1/scratch/mpatel/tmp/sage-4.5.3-chomp/devel/sage/sage/homology/tests.py", line 12:
    sage: test_random_chain_complex(level=4, trials=20)  # long time # optional - CHomP
Expected nothing
Got:
    Homology in dimension 125 according to CHomP: Z^56
    Homology in dimension 125 according to Sage: Z^56
    Chain complex: {125: 0 x 173 dense matrix over Integer Ring, 126: 173 x 117 dense matrix over Integer Ring}
    Random testing has revealed a problem in test_random_chain_complex
    Please report this bug!  You may be the first
    person in the world to have seen this problem.
    Please include this random seed in your bug report:
    Random seed: 35064267617427002531027772896998931605
    ValueError()
**********************************************************************
File "/mnt/usb1/scratch/mpatel/tmp/sage-4.5.3-chomp/devel/sage/sage/homology/tests.py", line 72:
    sage: test_random_chain_complex(trials=2)  # optional - CHomP
Expected nothing
Got:
    Homology in dimension -43 according to CHomP: 0
    Homology in dimension -43 according to Sage: 0
    Chain complex: {-43: 41 x 0 dense matrix over Integer Ring, -42: []}
    Random testing has revealed a problem in test_random_chain_complex
    Please report this bug!  You may be the first
    person in the world to have seen this problem.
    Please include this random seed in your bug report:
    Random seed: 198276055669197070047963781696502632135
    ValueError()
```

**Assignee:** joyner

**CC:**  @jhpalmieri @rbeezer @loefflerd @novoselt @vbraun

**Resolution:** fixed

**Author:** John Palmieri

**Reviewer:** Rob Beezer

**Merged:** sage-4.6.1.alpha3

Issue created by migration from https://trac.sagemath.org/ticket/9940





---

archive/issue_events_030335.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "rename": {
        "from": "Fix CHomP-related doctest errors",
        "to": "Fix equality/inequality for AdditiveAbelianGroup"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9940#event-30335"
}
```



---

archive/issue_comments_124797.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n-With the optional CHomP package in 4.5.3 on sage.math, I get some doctest failures:\n+Inequality for the class `AdditiveAbelianGroup` has a bug:\n+\n+```\n+sage: AdditiveAbelianGroup([0,0]) == AdditiveAbelianGroup([0,0]) \n+True\n+sage: AdditiveAbelianGroup([0,0]) != AdditiveAbelianGroup([0,0]) \n+True\n+```\n+This causes doctest failures as reported by mpatel: with the optional CHomP package in 4.5.3 on sage.math, I get some doctest failures:\n \n ```python\n sage -t -long -only-optional=chomp \"devel/sage/sage/homology/cell_complex.py\"\n``````\n",
    "created_at": "2010-09-18T17:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124797",
    "user": "https://github.com/jhpalmieri"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,12 @@
-With the optional CHomP package in 4.5.3 on sage.math, I get some doctest failures:
+Inequality for the class `AdditiveAbelianGroup` has a bug:
+
+```
+sage: AdditiveAbelianGroup([0,0]) == AdditiveAbelianGroup([0,0]) 
+True
+sage: AdditiveAbelianGroup([0,0]) != AdditiveAbelianGroup([0,0]) 
+True
+```
+This causes doctest failures as reported by mpatel: with the optional CHomP package in 4.5.3 on sage.math, I get some doctest failures:
 
 ```python
 sage -t -long -only-optional=chomp "devel/sage/sage/homology/cell_complex.py"
``````




---

archive/issue_comments_124798.json:
```json
{
    "body": "<a id='comment:1'></a>\nI think we could fix the doctest failures by changing `A != B` to `not A == B`, because very brief testing suggests that `==` works for these objects, but that wouldn't fix the underlying issue.",
    "created_at": "2010-09-18T17:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124798",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'></a>
I think we could fix the doctest failures by changing `A != B` to `not A == B`, because very brief testing suggests that `==` works for these objects, but that wouldn't fix the underlying issue.



---

archive/issue_comments_124799.json:
```json
{
    "body": "**Changing assignee** from @jhpalmieri to joyner.",
    "created_at": "2010-09-18T17:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124799",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing assignee** from @jhpalmieri to joyner.



---

archive/issue_events_030336.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-09-18T18:03:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "milestone": "sage-4.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9940#event-30336"
}
```



---

archive/issue_comments_124800.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,19 +6,7 @@\n sage: AdditiveAbelianGroup([0,0]) != AdditiveAbelianGroup([0,0]) \n True\n ```\n-This causes doctest failures as reported by mpatel: with the optional CHomP package in 4.5.3 on sage.math, I get some doctest failures:\n-\n-```python\n-sage -t -long -only-optional=chomp \"devel/sage/sage/homology/cell_complex.py\"\n-**********************************************************************\n-File \"/mnt/usb1/scratch/mpatel/tmp/sage-4.5.3-chomp/devel/sage/sage/homology/cell_complex.py\", line 470:\n-    sage: S2.homology(dim=2, generators=True)  # optional - CHomP\n-Expected:\n-    (Z, [(0, 1, 2) - (0, 1, 3) + (0, 2, 3) - (1, 2, 3)])\n-Got:\n-    (Z, [-(0, 1, 2) + (0, 1, 3) - (0, 2, 3) + (1, 2, 3)])\n-```\n-These vary from run to run:\n+This causes doctest failures as reported by mpatel: with the optional CHomP package in 4.5.3 on sage.math, I get some doctest failures.  These vary from run to run:\n \n ```python\n sage -t -long -only-optional=chomp \"devel/sage/sage/homology/tests.py\"\n``````\n",
    "created_at": "2010-09-18T18:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124800",
    "user": "https://github.com/jhpalmieri"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,19 +6,7 @@
 sage: AdditiveAbelianGroup([0,0]) != AdditiveAbelianGroup([0,0]) 
 True
 ```
-This causes doctest failures as reported by mpatel: with the optional CHomP package in 4.5.3 on sage.math, I get some doctest failures:
-
-```python
-sage -t -long -only-optional=chomp "devel/sage/sage/homology/cell_complex.py"
-**********************************************************************
-File "/mnt/usb1/scratch/mpatel/tmp/sage-4.5.3-chomp/devel/sage/sage/homology/cell_complex.py", line 470:
-    sage: S2.homology(dim=2, generators=True)  # optional - CHomP
-Expected:
-    (Z, [(0, 1, 2) - (0, 1, 3) + (0, 2, 3) - (1, 2, 3)])
-Got:
-    (Z, [-(0, 1, 2) + (0, 1, 3) - (0, 2, 3) + (1, 2, 3)])
-```
-These vary from run to run:
+This causes doctest failures as reported by mpatel: with the optional CHomP package in 4.5.3 on sage.math, I get some doctest failures.  These vary from run to run:
 
 ```python
 sage -t -long -only-optional=chomp "devel/sage/sage/homology/tests.py"
``````




---

archive/issue_comments_124801.json:
```json
{
    "body": "<a id='comment:4'></a>\nAdding a couple names of people who know this part well.",
    "created_at": "2010-09-19T01:29:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124801",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:4'></a>
Adding a couple names of people who know this part well.



---

archive/issue_comments_124802.json:
```json
{
    "body": "**Author:** John Palmieri",
    "created_at": "2010-11-19T17:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124802",
    "user": "https://github.com/jhpalmieri"
}
```

**Author:** John Palmieri



---

archive/issue_comments_124803.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2010-11-19T17:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124803",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_124804.json:
```json
{
    "body": "<a id='comment:6'></a>\nHere is a very simple patch.  With this, all doctests pass on sage.math (so this doesn't appear to break anything) and also \n\n```\nsage -t -long -only-optional=chomp \"devel/sage/sage/homology/tests.py\"\n```\npasses.\n\nI don't know enough about the additive abelian group code to know if this is completely safe.  I don't know why it wouldn't be, but could someone who knows what they're doing look at this?",
    "created_at": "2010-11-19T17:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124804",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>
Here is a very simple patch.  With this, all doctests pass on sage.math (so this doesn't appear to break anything) and also 

```
sage -t -long -only-optional=chomp "devel/sage/sage/homology/tests.py"
```
passes.

I don't know enough about the additive abelian group code to know if this is completely safe.  I don't know why it wouldn't be, but could someone who knows what they're doing look at this?



---

archive/issue_comments_124805.json:
```json
{
    "body": "<a id='comment:7'></a>\nIt seems that other comparisons are not working properly either,\n\n```\nsage: G=AdditiveAbelianGroup([0,0])\nsage: H=AdditiveAbelianGroup([0,0])\nsage: G==H\nTrue\nsage: G!=H\nTrue\nsage: G<=H\nTrue\nsage: H<=G\nFalse\n```\n\n`AdditiveAbelianGroup` is implemented as a quotient of finitely-generated modules over ZZ, V/W, and you can get these two modules as follows:\n\n```\nsage: G._V\nAmbient free module of rank 2 over the principal ideal domain Integer Ring\nsage: G._W\nFree module of degree 2 and rank 0 over Integer Ring\nEchelon basis matrix:\n[]\n```\n\nThe equality of G and H is determined by the `__eq__` method in `sage.modules.fg_pid.fgp_module.FGP_Module_class` which does the obvious thing, checking the equality of the V and W modules.\n\nI cannot seem to figure out how the \"non-equality\" comparison is accomplished.  I get the impression this could be the logical negation of the equality comparison, automatically, but inserting print statements various places does not verify that hypothesis.\n\nIf I rebuild the quotient of modules from the relevant pieces of G and H, then equality and non-equality both behave as expected.\n\n```\nsage: X=sage.modules.fg_pid.fgp_module.FGP_Module(G._V, G._W)\nsage: Y=sage.modules.fg_pid.fgp_module.FGP_Module(H._V, H._W)\nsage: X==Y\nTrue\nsage: X!=Y\nFalse\n```\n\nSo I am at a bit of a loss to understand what is broken in the non-equality of G and H.  But still, a suggestion.  Since equality is implemented in the FGP_Module class, maybe the non-equality, as just the logical opposite, should be implemented at the same level?  In other words, use the same logic as in the patch, but place it as\n`sage.modules.fg_pid.fgp_module.FGP_Module_class.__ne__`?  Does that make sense?",
    "created_at": "2010-11-26T23:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124805",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:7'></a>
It seems that other comparisons are not working properly either,

```
sage: G=AdditiveAbelianGroup([0,0])
sage: H=AdditiveAbelianGroup([0,0])
sage: G==H
True
sage: G!=H
True
sage: G<=H
True
sage: H<=G
False
```

`AdditiveAbelianGroup` is implemented as a quotient of finitely-generated modules over ZZ, V/W, and you can get these two modules as follows:

```
sage: G._V
Ambient free module of rank 2 over the principal ideal domain Integer Ring
sage: G._W
Free module of degree 2 and rank 0 over Integer Ring
Echelon basis matrix:
[]
```

The equality of G and H is determined by the `__eq__` method in `sage.modules.fg_pid.fgp_module.FGP_Module_class` which does the obvious thing, checking the equality of the V and W modules.

I cannot seem to figure out how the "non-equality" comparison is accomplished.  I get the impression this could be the logical negation of the equality comparison, automatically, but inserting print statements various places does not verify that hypothesis.

If I rebuild the quotient of modules from the relevant pieces of G and H, then equality and non-equality both behave as expected.

```
sage: X=sage.modules.fg_pid.fgp_module.FGP_Module(G._V, G._W)
sage: Y=sage.modules.fg_pid.fgp_module.FGP_Module(H._V, H._W)
sage: X==Y
True
sage: X!=Y
False
```

So I am at a bit of a loss to understand what is broken in the non-equality of G and H.  But still, a suggestion.  Since equality is implemented in the FGP_Module class, maybe the non-equality, as just the logical opposite, should be implemented at the same level?  In other words, use the same logic as in the patch, but place it as
`sage.modules.fg_pid.fgp_module.FGP_Module_class.__ne__`?  Does that make sense?



---

archive/issue_comments_124806.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [rbeezer](#comment%3A7):\n> So I am at a bit of a loss to understand what is broken in the non-equality of G and H.  \n\n\nMe too.\n\n> But still, a suggestion.  Since equality is implemented in the FGP_Module class, maybe the non-equality, as just the logical opposite, should be implemented at the same level?  In other words, use the same logic as in the patch, but place it as\n> `sage.modules.fg_pid.fgp_module.FGP_Module_class.__ne__`?  Does that make sense?\n\n\nIt sort of makes sense, and it seems to fix the nonequality problem, but since nonequality already works for these modules, it doesn't seem perfect.  It also doesn't affect the problems with < and >:\n\n```\nsage: G=AdditiveAbelianGroup([0,0])\nsage: H=AdditiveAbelianGroup([0,0])\nsage: G < H\nTrue\nsage: H < G\nFalse\n```\nI would really like to understand what's going on here.  I won't be completely happy with a patch until then, I think.",
    "created_at": "2010-11-27T21:04:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124806",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
Replying to [rbeezer](#comment%3A7):
> So I am at a bit of a loss to understand what is broken in the non-equality of G and H.  


Me too.

> But still, a suggestion.  Since equality is implemented in the FGP_Module class, maybe the non-equality, as just the logical opposite, should be implemented at the same level?  In other words, use the same logic as in the patch, but place it as
> `sage.modules.fg_pid.fgp_module.FGP_Module_class.__ne__`?  Does that make sense?


It sort of makes sense, and it seems to fix the nonequality problem, but since nonequality already works for these modules, it doesn't seem perfect.  It also doesn't affect the problems with < and >:

```
sage: G=AdditiveAbelianGroup([0,0])
sage: H=AdditiveAbelianGroup([0,0])
sage: G < H
True
sage: H < G
False
```
I would really like to understand what's going on here.  I won't be completely happy with a patch until then, I think.



---

archive/issue_comments_124807.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [jhpalmieri](#comment%3A8):\n> I would really like to understand what's going on here.  I won't be completely happy with a patch until then, I think.\n\n\nMe too.  I think we see it the same way.  My guess is that I don't totally understand some corner of Python (rather than not understanding Sage).  \n\nShould we appeal to sage-devel for some insight?  I'm happy to compose something, probably after posting some more evidence of my confusion here on the ticket.  Can I use your name too to make a stronger case for this not being a newbie FAQ?  \n\nRob",
    "created_at": "2010-11-27T23:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124807",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:9'></a>
Replying to [jhpalmieri](#comment%3A8):
> I would really like to understand what's going on here.  I won't be completely happy with a patch until then, I think.


Me too.  I think we see it the same way.  My guess is that I don't totally understand some corner of Python (rather than not understanding Sage).  

Should we appeal to sage-devel for some insight?  I'm happy to compose something, probably after posting some more evidence of my confusion here on the ticket.  Can I use your name too to make a stronger case for this not being a newbie FAQ?  

Rob



---

archive/issue_comments_124808.json:
```json
{
    "body": "<a id='comment:10'></a>\nOK, just popped into sage-devel and see its done............  ;-)\n\nRob",
    "created_at": "2010-11-27T23:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124808",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:10'></a>
OK, just popped into sage-devel and see its done............  ;-)

Rob



---

archive/issue_comments_124809.json:
```json
{
    "body": "<a id='comment:11'></a>\nI'm not sure if this helps, but [this documentation about rich comparisons](http://docs.python.org/reference/datamodel.html#object.__ne__) says\n\n  There are no implied relationships among the comparison operators. The truth of `x==y` does not imply that `x!=y` is false. Accordingly, when defining `__eq__()`, one should also define `__ne__()` so that the operators will behave as expected.\n\nThe [entry for __cmp__](http://docs.python.org/reference/datamodel.html#object.__cmp__) says\n\n  If no `__cmp__()`, `__eq__()` or `__ne__()` operation is defined, class instances are compared by object identity (\"address\").\n\nDoes not having defined `sage.modules.fg_pid.fgp_module.FGP_Module_class.__ne__` mean that `G != H` amounts to `id(G) != id(H)`?\n\nIt seems the only other class that derives [directly] from `FGP_Module_class` is `sage.geometry.toric_lattice.ToricLattice_quotient`, which also doesn't define its own `__eq__` and `__ne__`:\n\n```python\nsage: N1 = ToricLattice(3)\nsage: sublattice1 = N1.submodule([(1,1,0), (3,2,1)])\nsage: Q1 = N1/sublattice1\nsage: N2 = ToricLattice(3)\nsage: sublattice2 = N2.submodule([(1,1,0), (3,2,1)])\nsage: Q2 = N2/sublattice2\nsage: Q1 == Q2\nTrue\nsage: Q1 != Q2\nTrue\n```\nIs this expected?",
    "created_at": "2010-11-28T03:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124809",
    "user": "https://github.com/qed777"
}
```

<a id='comment:11'></a>
I'm not sure if this helps, but [this documentation about rich comparisons](http://docs.python.org/reference/datamodel.html#object.__ne__) says

  There are no implied relationships among the comparison operators. The truth of `x==y` does not imply that `x!=y` is false. Accordingly, when defining `__eq__()`, one should also define `__ne__()` so that the operators will behave as expected.

The [entry for __cmp__](http://docs.python.org/reference/datamodel.html#object.__cmp__) says

  If no `__cmp__()`, `__eq__()` or `__ne__()` operation is defined, class instances are compared by object identity ("address").

Does not having defined `sage.modules.fg_pid.fgp_module.FGP_Module_class.__ne__` mean that `G != H` amounts to `id(G) != id(H)`?

It seems the only other class that derives [directly] from `FGP_Module_class` is `sage.geometry.toric_lattice.ToricLattice_quotient`, which also doesn't define its own `__eq__` and `__ne__`:

```python
sage: N1 = ToricLattice(3)
sage: sublattice1 = N1.submodule([(1,1,0), (3,2,1)])
sage: Q1 = N1/sublattice1
sage: N2 = ToricLattice(3)
sage: sublattice2 = N2.submodule([(1,1,0), (3,2,1)])
sage: Q2 = N2/sublattice2
sage: Q1 == Q2
True
sage: Q1 != Q2
True
```
Is this expected?



---

archive/issue_comments_124810.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [mpatel](#comment%3A11):\n> It seems the only other class that derives [directly] from `FGP_Module_class` is `sage.geometry.toric_lattice.ToricLattice_quotient`, which also doesn't define its own `__eq__` and `__ne__`:\n\n\n```python\n sage: N1 = ToricLattice(3)\n sage: sublattice1 = N1.submodule([(1,1,0), (3,2,1)])\n sage: Q1 = N1/sublattice1\n sage: N2 = ToricLattice(3)\n sage: sublattice2 = N2.submodule([(1,1,0), (3,2,1)])\n sage: Q2 = N2/sublattice2\n sage: Q1 == Q2\n True\n sage: Q1 != Q2\n True\n```\n> Is this expected?\n\n\nI think what I find the most confusing is that comparisons work well for finitely generated free modules, but not for the derived classes.  If they behaved badly in all cases, I would know how to fix it, and while adding a `__ne__` method for `FGP_Module_class` (and perhaps `__lt__` and `__gt__` methods, although I'm not sure what they should return: I suppose `self.is_submodule(other) and self != other`) would probably make the comparisons work, I still wouldn't understand why that was the right place to do it.\n\nSo one question is, is the right thing to do to add methods `__ne__`, `__lt__`, and `__gt__`, and perhaps `__ge__` and `__le__`, to `FGP_Module_class`?\n\nI'm marking this as \"needs work\", because we should address comparisons like `H<G` at the same time as `H!=G`.",
    "created_at": "2010-11-28T04:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124810",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
Replying to [mpatel](#comment%3A11):
> It seems the only other class that derives [directly] from `FGP_Module_class` is `sage.geometry.toric_lattice.ToricLattice_quotient`, which also doesn't define its own `__eq__` and `__ne__`:


```python
 sage: N1 = ToricLattice(3)
 sage: sublattice1 = N1.submodule([(1,1,0), (3,2,1)])
 sage: Q1 = N1/sublattice1
 sage: N2 = ToricLattice(3)
 sage: sublattice2 = N2.submodule([(1,1,0), (3,2,1)])
 sage: Q2 = N2/sublattice2
 sage: Q1 == Q2
 True
 sage: Q1 != Q2
 True
```
> Is this expected?


I think what I find the most confusing is that comparisons work well for finitely generated free modules, but not for the derived classes.  If they behaved badly in all cases, I would know how to fix it, and while adding a `__ne__` method for `FGP_Module_class` (and perhaps `__lt__` and `__gt__` methods, although I'm not sure what they should return: I suppose `self.is_submodule(other) and self != other`) would probably make the comparisons work, I still wouldn't understand why that was the right place to do it.

So one question is, is the right thing to do to add methods `__ne__`, `__lt__`, and `__gt__`, and perhaps `__ge__` and `__le__`, to `FGP_Module_class`?

I'm marking this as "needs work", because we should address comparisons like `H<G` at the same time as `H!=G`.



---

archive/issue_comments_124811.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2010-11-28T04:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124811",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_124812.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [mpatel](#comment%3A11):\n> Is this expected?\n\n\nNo, we derived separate classes for toric lattices and related objects to make sure that elements of different lattices of the same dimension don't mix in wrong ways (especially elements of dual lattices). Otherwise the behaviour is left the same as for base classes.",
    "created_at": "2010-11-28T04:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124812",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:13'></a>
Replying to [mpatel](#comment%3A11):
> Is this expected?


No, we derived separate classes for toric lattices and related objects to make sure that elements of different lattices of the same dimension don't mix in wrong ways (especially elements of dual lattices). Otherwise the behaviour is left the same as for base classes.



---

archive/issue_comments_124813.json:
```json
{
    "body": "<a id='comment:14'></a>\nOh, I see: `FGP_Module` is a **function** which returns identical objects (via the `__init__` method of `FGP_Module_class`) if you pass it the same input.  If you do this:\n\n```\nsage: G=AdditiveAbelianGroup([0,0])\nsage: from sage.modules.fg_pid.fgp_module import FGP_Module_class\nsage: M1 = FGP_Module_class(G.V(), G.W())\nsage: M2 = FGP_Module_class(G.V(), G.W())\nsage: M1 == M2\nTrue\nsage: M1 != M2\nTrue\nsage: M1 < M2\nTrue\nsage: M1 > M2\nFalse\n```\nSo adding these comparisons to `FGP_Module_class` might be the right thing to do, to deal with the case when people construct these modules without using the helper function `FGP_Module`, using the class instead.",
    "created_at": "2010-11-28T04:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124813",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>
Oh, I see: `FGP_Module` is a **function** which returns identical objects (via the `__init__` method of `FGP_Module_class`) if you pass it the same input.  If you do this:

```
sage: G=AdditiveAbelianGroup([0,0])
sage: from sage.modules.fg_pid.fgp_module import FGP_Module_class
sage: M1 = FGP_Module_class(G.V(), G.W())
sage: M2 = FGP_Module_class(G.V(), G.W())
sage: M1 == M2
True
sage: M1 != M2
True
sage: M1 < M2
True
sage: M1 > M2
False
```
So adding these comparisons to `FGP_Module_class` might be the right thing to do, to deal with the case when people construct these modules without using the helper function `FGP_Module`, using the class instead.



---

archive/issue_comments_124814.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-11-28T05:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124814",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_124815.json:
```json
{
    "body": "<a id='comment:15'></a>\nHere's a patch.",
    "created_at": "2010-11-28T05:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124815",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>
Here's a patch.



---

archive/issue_comments_124816.json:
```json
{
    "body": "**Reviewer:** Rob Beezer",
    "created_at": "2010-11-28T20:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124816",
    "user": "https://github.com/rbeezer"
}
```

**Reviewer:** Rob Beezer



---

archive/attachments_012886.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_9940-ne.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket9940/trac_9940-ne.patch",
    "created_at": "2010-11-28T20:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_124817.json:
```json
{
    "body": "<a id='comment:16'></a>\nI think implementing less-than, etc as submodule tests is the right way to go as well.\n\nPatch passes all long tests, and with the experimental package `chomp` installed, patched version also passes:\n\n```\nsage -t -long -only-optional=chomp \"devel/sage/sage/homology/tests.py\"\n```\n\nI also installed the (in-progress) patch at #9773 which builds finitely-generated groups on top of this module quotient code.  Limited testing indicates that (a) the current patch behaves as expected, and (b) the comparison methods will apply properly to the subclasses.\n\nDocumentation looks good when previewed in the notebook (since it is not included in the reference manual).\n\nSo: positive review.  Thanks, John, for pursuing this one.\n\nRob",
    "created_at": "2010-11-28T20:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124817",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:16'></a>
I think implementing less-than, etc as submodule tests is the right way to go as well.

Patch passes all long tests, and with the experimental package `chomp` installed, patched version also passes:

```
sage -t -long -only-optional=chomp "devel/sage/sage/homology/tests.py"
```

I also installed the (in-progress) patch at #9773 which builds finitely-generated groups on top of this module quotient code.  Limited testing indicates that (a) the current patch behaves as expected, and (b) the comparison methods will apply properly to the subclasses.

Documentation looks good when previewed in the notebook (since it is not included in the reference manual).

So: positive review.  Thanks, John, for pursuing this one.

Rob



---

archive/issue_comments_124818.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2010-11-28T20:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124818",
    "user": "https://github.com/rbeezer"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_124819.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [rbeezer](#comment%3A16):\n> So: positive review.  Thanks, John, for pursuing this one.\n\n\nWell, I was helped a lot by Mitesh's pointer to the Python docs for `__cmp__`.",
    "created_at": "2010-11-29T04:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124819",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:17'></a>
Replying to [rbeezer](#comment%3A16):
> So: positive review.  Thanks, John, for pursuing this one.


Well, I was helped a lot by Mitesh's pointer to the Python docs for `__cmp__`.



---

archive/issue_comments_124820.json:
```json
{
    "body": "**Merged:** sage-4.6.1.alpha3",
    "created_at": "2010-12-02T16:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124820",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.6.1.alpha3



---

archive/issue_events_030337.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-12-02T16:09:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9940#event-30337"
}
```



---

archive/issue_comments_124821.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2010-12-02T16:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9940#issuecomment-124821",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed
