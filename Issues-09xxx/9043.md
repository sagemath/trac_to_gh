# Issue 9043: lcalc failing to build on OpenSolaris x64.

archive/issues_009043.json:
```json
{
    "body": "## Build environment\n* Sun Ultra 27 3.33 GHz Intel W3580 Xeon. Quad core. 8 threads. 12 GB RAM\n* OpenSolaris 2009.06 snv_134 X86\n* Sage 4.4.2\n* gcc 4.4.4\n\n## How gcc 4.4.4 was configured\nSince the configuration of gcc is fairly critical on OpenSolaris, here's how it was built. \n\n```\ndrkirkby@hawk:~/sage-4.4.2$ gcc -v\nUsing built-in specs.\nTarget: i386-pc-solaris2.11\nConfigured with: ../gcc-4.4.4/configure --prefix=/usr/local/gcc-4.4.4 --with-as=/usr/local/binutils-2.20/bin/as --with-ld=/usr/ccs/bin/ld --with-gmp=/usr/local --with-mpfr=/usr/local\nThread model: posix\ngcc version 4.4.4 (GCC) \n```\n\ngcc 4.3.4 was failing to build iconv. \n\n## How the Sage build was attempted\n* 64-bit build. SAGE64 was set to \"yes\"\n* #9008 update zlib to latest upstream release to allow a 64-bit library to be built. \n* #9009 update mercurial spkg to build 64-bit.\n* #7982 update sage_fortran so it can build 64-bit binaries.\n* Run 'make -k' so the build process continued even though there were some failures. \n\n## The problem with lcalc\n\nThe C++ compiler g++ is being invoked with the option -m64 to build 64-bit objects (as it should be). g++ is then used as a linker and **may** need the -m64 flag again. There is certainly a problem with 32-bit and 64-bit objects being mixed up, as ''wrong ELF class' always indicates such a problem on Solaris or OpenSolaris. \n\nlcalc probably needs LDFLAGS to include -m64, though I've not checked this. It may or may not already have it. \n\n```\ng++  -O3  -m64  -g  -Wall  -O3     -ffast-math -fPIC  -I../include -c Lriemannsiegel_blfi.cc\nIn file included from /usr/local/gcc-4.4.4/lib/gcc/i386-pc-solaris2.11/4.4.4/../../../../include/c++/4.4.4/backward/strstream:47,\n                 from ../include/L.h:34,\n                 from Lriemannsiegel_blfi.cc:16:\n/usr/local/gcc-4.4.4/lib/gcc/i386-pc-solaris2.11/4.4.4/../../../../include/c++/4.4.4/backward/backward_warning.h:28:2: warning: #warning This file includes at least one deprecated or antiquated header which may be removed without further notice at a future date. Please use a non-deprecated interface with equivalent functionality instead. For a listing of replacement headers and interfaces, consult the file backward_warning.h. To disable this warning use -Wno-deprecated.\nIn file included from ../include/L.h:537,\n                 from Lriemannsiegel_blfi.cc:16:\n../include/Lvalue.h:187: warning: ignoring #pragma omp parallel\n../include/Lvalue.h:324: warning: ignoring #pragma omp parallel\n../include/Lvalue.h:329: warning: ignoring #pragma omp parallel\nLriemannsiegel_blfi.cc: In function \u2018Complex blfi_inter(Double, Double, int, int, int, int&)\u2019:\nLriemannsiegel_blfi.cc:388: warning: unused variable \u2018temp10\u2019\nLriemannsiegel_blfi.cc: In function \u2018Complex my_zeta(Double, int&)\u2019:\nLriemannsiegel_blfi.cc:913: warning: unused variable \u2018denom\u2019\nLriemannsiegel_blfi.cc:913: warning: unused variable \u2018temp0\u2019\ng++  -O3  -m64  -g  -Wall  -O3     -ffast-math -fPIC  -I../include -c Ldokchitser.cc\nIn file included from /usr/local/gcc-4.4.4/lib/gcc/i386-pc-solaris2.11/4.4.4/../../../../include/c++/4.4.4/backward/strstream:47,\n                 from ../include/L.h:34,\n                 from Ldokchitser.cc:1:\n/usr/local/gcc-4.4.4/lib/gcc/i386-pc-solaris2.11/4.4.4/../../../../include/c++/4.4.4/backward/backward_warning.h:28:2: warning: #warning This file includes at least one deprecated or antiquated header which may be removed without further notice at a future date. Please use a non-deprecated interface with equivalent functionality instead. For a listing of replacement headers and interfaces, consult the file backward_warning.h. To disable this warning use -Wno-deprecated.\nIn file included from ../include/L.h:537,\n                 from Ldokchitser.cc:1:\n../include/Lvalue.h:187: warning: ignoring #pragma omp parallel\n../include/Lvalue.h:324: warning: ignoring #pragma omp parallel\n../include/Lvalue.h:329: warning: ignoring #pragma omp parallel\ng++ -shared  -o libLfunction.so Lglobals.o Lgamma.o Lriemannsiegel.o Lriemannsiegel_blfi.o Ldokchitser.o\nld: fatal: file Lglobals.o: wrong ELF class: ELFCLASS64\nld: fatal: file processing errors. No output written to libLfunction.so\ncollect2: ld returned 1 exit status\nmake[3]: *** [libLfunction.so] Error 1\nmake[3]: Leaving directory `/export/home/drkirkby/sage-4.4.2/spkg/build/lcalc-20100428-1.23/src/src'\nmake[2]: *** [all] Error 2\nmake[2]: Leaving directory `/export/home/drkirkby/sage-4.4.2/spkg/build/lcalc-20100428-1.23/src/src'\nNow copying over lcalc binary\ncp: cannot access lcalc\n\nreal    0m3.200s\nuser    0m2.855s\nsys     0m0.246s\nsage: An error occurred while installing lcalc-20100428-1.23\n```\n\n## Other problems stopping Sage build on OpenSolaris\nSee #9026 for a list of issues observed on OpenSolaris x64. Some will affect a 64-bit build on other Solaris platforms.\n\nAssignee: drkirkby\n\nCC:  @rishikesha @jaapspies\n\nResolution: fixed\n\nAuthor: David Kirkby\n\nReviewer: Jaap Spies\n\nMerged: sage-4.5.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/9043\n\n",
    "closed_at": "2010-06-25T15:51:39Z",
    "created_at": "2010-05-25T02:11:14Z",
    "labels": [
        "component: porting: solaris",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.5",
    "title": "lcalc failing to build on OpenSolaris x64.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9043",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```
## Build environment
* Sun Ultra 27 3.33 GHz Intel W3580 Xeon. Quad core. 8 threads. 12 GB RAM
* OpenSolaris 2009.06 snv_134 X86
* Sage 4.4.2
* gcc 4.4.4

## How gcc 4.4.4 was configured
Since the configuration of gcc is fairly critical on OpenSolaris, here's how it was built. 

```
drkirkby@hawk:~/sage-4.4.2$ gcc -v
Using built-in specs.
Target: i386-pc-solaris2.11
Configured with: ../gcc-4.4.4/configure --prefix=/usr/local/gcc-4.4.4 --with-as=/usr/local/binutils-2.20/bin/as --with-ld=/usr/ccs/bin/ld --with-gmp=/usr/local --with-mpfr=/usr/local
Thread model: posix
gcc version 4.4.4 (GCC) 
```

gcc 4.3.4 was failing to build iconv. 

## How the Sage build was attempted
* 64-bit build. SAGE64 was set to "yes"
* #9008 update zlib to latest upstream release to allow a 64-bit library to be built. 
* #9009 update mercurial spkg to build 64-bit.
* #7982 update sage_fortran so it can build 64-bit binaries.
* Run 'make -k' so the build process continued even though there were some failures. 

## The problem with lcalc

The C++ compiler g++ is being invoked with the option -m64 to build 64-bit objects (as it should be). g++ is then used as a linker and **may** need the -m64 flag again. There is certainly a problem with 32-bit and 64-bit objects being mixed up, as ''wrong ELF class' always indicates such a problem on Solaris or OpenSolaris. 

lcalc probably needs LDFLAGS to include -m64, though I've not checked this. It may or may not already have it. 

```
g++  -O3  -m64  -g  -Wall  -O3     -ffast-math -fPIC  -I../include -c Lriemannsiegel_blfi.cc
In file included from /usr/local/gcc-4.4.4/lib/gcc/i386-pc-solaris2.11/4.4.4/../../../../include/c++/4.4.4/backward/strstream:47,
                 from ../include/L.h:34,
                 from Lriemannsiegel_blfi.cc:16:
/usr/local/gcc-4.4.4/lib/gcc/i386-pc-solaris2.11/4.4.4/../../../../include/c++/4.4.4/backward/backward_warning.h:28:2: warning: #warning This file includes at least one deprecated or antiquated header which may be removed without further notice at a future date. Please use a non-deprecated interface with equivalent functionality instead. For a listing of replacement headers and interfaces, consult the file backward_warning.h. To disable this warning use -Wno-deprecated.
In file included from ../include/L.h:537,
                 from Lriemannsiegel_blfi.cc:16:
../include/Lvalue.h:187: warning: ignoring #pragma omp parallel
../include/Lvalue.h:324: warning: ignoring #pragma omp parallel
../include/Lvalue.h:329: warning: ignoring #pragma omp parallel
Lriemannsiegel_blfi.cc: In function ‘Complex blfi_inter(Double, Double, int, int, int, int&)’:
Lriemannsiegel_blfi.cc:388: warning: unused variable ‘temp10’
Lriemannsiegel_blfi.cc: In function ‘Complex my_zeta(Double, int&)’:
Lriemannsiegel_blfi.cc:913: warning: unused variable ‘denom’
Lriemannsiegel_blfi.cc:913: warning: unused variable ‘temp0’
g++  -O3  -m64  -g  -Wall  -O3     -ffast-math -fPIC  -I../include -c Ldokchitser.cc
In file included from /usr/local/gcc-4.4.4/lib/gcc/i386-pc-solaris2.11/4.4.4/../../../../include/c++/4.4.4/backward/strstream:47,
                 from ../include/L.h:34,
                 from Ldokchitser.cc:1:
/usr/local/gcc-4.4.4/lib/gcc/i386-pc-solaris2.11/4.4.4/../../../../include/c++/4.4.4/backward/backward_warning.h:28:2: warning: #warning This file includes at least one deprecated or antiquated header which may be removed without further notice at a future date. Please use a non-deprecated interface with equivalent functionality instead. For a listing of replacement headers and interfaces, consult the file backward_warning.h. To disable this warning use -Wno-deprecated.
In file included from ../include/L.h:537,
                 from Ldokchitser.cc:1:
../include/Lvalue.h:187: warning: ignoring #pragma omp parallel
../include/Lvalue.h:324: warning: ignoring #pragma omp parallel
../include/Lvalue.h:329: warning: ignoring #pragma omp parallel
g++ -shared  -o libLfunction.so Lglobals.o Lgamma.o Lriemannsiegel.o Lriemannsiegel_blfi.o Ldokchitser.o
ld: fatal: file Lglobals.o: wrong ELF class: ELFCLASS64
ld: fatal: file processing errors. No output written to libLfunction.so
collect2: ld returned 1 exit status
make[3]: *** [libLfunction.so] Error 1
make[3]: Leaving directory `/export/home/drkirkby/sage-4.4.2/spkg/build/lcalc-20100428-1.23/src/src'
make[2]: *** [all] Error 2
make[2]: Leaving directory `/export/home/drkirkby/sage-4.4.2/spkg/build/lcalc-20100428-1.23/src/src'
Now copying over lcalc binary
cp: cannot access lcalc

real    0m3.200s
user    0m2.855s
sys     0m0.246s
sage: An error occurred while installing lcalc-20100428-1.23
```

## Other problems stopping Sage build on OpenSolaris
See #9026 for a list of issues observed on OpenSolaris x64. Some will affect a 64-bit build on other Solaris platforms.

Assignee: drkirkby

CC:  @rishikesha @jaapspies

Resolution: fixed

Author: David Kirkby

Reviewer: Jaap Spies

Merged: sage-4.5.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/9043





---

archive/issue_comments_083587.json:
```json
{
    "body": "<a id='comment:1'></a>I do not have access to opensolaris machine. I am busy with other things also. Can you make appropriate changes to Makefile.sage in patches directory and see if things work.",
    "created_at": "2010-05-25T14:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9043#issuecomment-83587",
    "user": "https://github.com/rishikesha"
}
```

<a id='comment:1'></a>I do not have access to opensolaris machine. I am busy with other things also. Can you make appropriate changes to Makefile.sage in patches directory and see if things work.



---

archive/issue_comments_083588.json:
```json
{
    "body": "<a id='comment:3'></a>## The cause  and solution\nThe problem was that CXXFLAGS was not being imported properly into patches/Makefile.sage. Although CXX was set correctly in spkg-install, the make file did not honor this properly. \n\nThis was simple to fix, by adding 'CXXFLAG64' to the list of variables imported by patches/Makefile.sage. During a 64-bit build with \"SAGE64=yes\", this is set to -m64 (by default). \n\nAn updated package can be found at\n\nhttp://boxen.math.washington.edu/home/kirkby/patches/lcalc-20100428-1.23.p0.spkg\n\nAlthough there are lots of warnings, these are in the original code, so are not a result of the change makefile. \n\n## Testing of updated 'lcalc' on OpenSolaris x64\nHere's is part of the output from the Sun Ultra 27, which showed the problem when building 'lcalc' as 64-bit. As you can see, it now builds. A check was made that all files installed are 64-bit, and this is indeed the case. \n\n```\ncmdline.c:96: warning: deprecated conversion from string constant to \u2018char*\u2019\ng++  -O3  -m64  -Wall  -O3     -ffast-math -fPIC  -I../include Lglobals.o Lgamma.o Lriemannsiegel.o Lriemannsiegel_blfi.o Ldokchitser.o Lcommandline_globals.o Lcommandline_misc.o Lcommandline_numbertheory.o Lcommandline_values_zeros.o Lcommandline_elliptic.o Lcommandline_twist.o Lcommandline.o cmdline.o -L/export/home/drkirkby/sage-4.4.2/local/lib  -lpari -lmpir -o lcalc \nmake[1]: Leaving directory `/export/home/drkirkby/sage-4.4.2/spkg/build/lcalc-20100428-1.23.p0/src/src'\nmake examples\nmake[1]: Entering directory `/export/home/drkirkby/sage-4.4.2/spkg/build/lcalc-20100428-1.23.p0/src/src'\ng++  -O3  -m64  -Wall  -O3     -ffast-math -fPIC  -I../include example_programs/example.cc libLfunction.so -o example_programs/example \nIn file included from /usr/local/gcc-4.4.4/lib/gcc/i386-pc-solaris2.11/4.4.4/../../../../include/c++/4.4.4/backward/strstream:47,\n                 from ../include/L.h:34,\n                 from example_programs/example.cc:2:\n/usr/local/gcc-4.4.4/lib/gcc/i386-pc-solaris2.11/4.4.4/../../../../include/c++/4.4.4/backward/backward_warning.h:28:2: warning: #warning This file includes at least one deprecated or antiquated header which may be removed without further notice at a future date. Please use a non-deprecated interface with equivalent functionality instead. For a listing of replacement headers and interfaces, consult the file backward_warning.h. To disable this warning use -Wno-deprecated.\nIn file included from ../include/L.h:537,\n                 from example_programs/example.cc:2:\n../include/Lvalue.h:187: warning: ignoring #pragma omp parallel\n../include/Lvalue.h:324: warning: ignoring #pragma omp parallel\n../include/Lvalue.h:329: warning: ignoring #pragma omp parallel\n../include/Lvalue.h: In member function \u2018Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = int]\u2019:\n../include/Lvalue.h:627:   instantiated from \u2018Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = int]\u2019\nexample_programs/example.cc:88:   instantiated from here\n../include/Lvalue.h:502: warning: unused variable \u2018t_0\u2019\n../include/Lvalue.h: In member function \u2018Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = std::complex<double>]\u2019:\n../include/Lvalue.h:627:   instantiated from \u2018Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = std::complex<double>]\u2019\nexample_programs/example.cc:90:   instantiated from here\n../include/Lvalue.h:502: warning: unused variable \u2018t_0\u2019\nIn file included from ../include/L.h:537,\n                 from example_programs/example.cc:2:\n../include/Lvalue.h: In member function \u2018Complex L_function<ttype>::find_delta(Complex, Double) [with ttype = int]\u2019:\n../include/Lvalue.h:517:   instantiated from \u2018Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = int]\u2019\n../include/Lvalue.h:627:   instantiated from \u2018Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = int]\u2019\nexample_programs/example.cc:88:   instantiated from here\n../include/Lvalue.h:37: warning: unused variable \u2018f2\u2019\nIn file included from ../include/L.h:42,\n                 from example_programs/example.cc:2:\n../include/Lgamma.h: In function \u2018Complex gamma_sum(Complex, int, ttype*, int, Double, Complex, Double, Long, Complex, const char*) [with ttype = int]\u2019:\n../include/Lvalue.h:526:   instantiated from \u2018Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = int]\u2019\n../include/Lvalue.h:627:   instantiated from \u2018Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = int]\u2019\nexample_programs/example.cc:88:   instantiated from here\n../include/Lgamma.h:622: warning: unused variable \u2018y\u2019\n../include/Lgamma.h:622: warning: unused variable \u2018y2\u2019\n../include/Lgamma.h:622: warning: unused variable \u2018y3\u2019\nIn file included from ../include/L.h:537,\n                 from example_programs/example.cc:2:\n../include/Lvalue.h: In member function \u2018Complex L_function<ttype>::find_delta(Complex, Double) [with ttype = std::complex<double>]\u2019:\n../include/Lvalue.h:517:   instantiated from \u2018Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = std::complex<double>]\u2019\n../include/Lvalue.h:627:   instantiated from \u2018Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = std::complex<double>]\u2019\nexample_programs/example.cc:90:   instantiated from here\n../include/Lvalue.h:37: warning: unused variable \u2018f2\u2019\nIn file included from ../include/L.h:42,\n                 from example_programs/example.cc:2:\n../include/Lgamma.h: In function \u2018Complex gamma_sum(Complex, int, ttype*, int, Double, Complex, Double, Long, Complex, const char*) [with ttype = std::complex<double>]\u2019:\n../include/Lvalue.h:526:   instantiated from \u2018Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = std::complex<double>]\u2019\n../include/Lvalue.h:627:   instantiated from \u2018Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = std::complex<double>]\u2019\nexample_programs/example.cc:90:   instantiated from here\n../include/Lgamma.h:622: warning: unused variable \u2018y\u2019\n../include/Lgamma.h:622: warning: unused variable \u2018y2\u2019\n../include/Lgamma.h:622: warning: unused variable \u2018y3\u2019\n../include/Lvalue.h: In member function \u2018Complex L_function<ttype>::value_via_Riemann_sum(Complex, const char*) [with ttype = int]\u2019:\n../include/Lvalue.h:489: warning: control reaches end of non-void function\n../include/Lvalue.h: In member function \u2018Complex L_function<ttype>::value_via_Riemann_sum(Complex, const char*) [with ttype = std::complex<double>]\u2019:\n../include/Lvalue.h:489: warning: control reaches end of non-void function\nmake[1]: Leaving directory `/export/home/drkirkby/sage-4.4.2/spkg/build/lcalc-20100428-1.23.p0/src/src'\nNow copying over lcalc binary\nNow copying over lcalc library\n\nreal\t0m23.105s\nuser\t0m22.026s\nsys\t0m0.905s\nSuccessfully installed lcalc-20100428-1.23.p0\n```\n\n## Building the updated lcalc on OS X\nThe updated lcalc package was built on OS X.  \n\n```\nNow copying over lcalc binary\nNow copying over lcalc library\n\nreal\t0m40.999s\nuser\t0m32.921s\nsys\t0m2.457s\nSuccessfully installed lcalc-20100428-1.23.p0\nNow cleaning up tmp files.\nMaking Sage/Python scripts relocatable...\nMaking script relocatable\nFinished installing lcalc-20100428-1.23.p0.spkg\n[kirkby@bsd sage-4.4.2]$ uname -a\nDarwin bsd.local 10.3.0 Darwin Kernel Version 10.3.0: Fri Feb 26 11:58:09 PST 2010; root:xnu-1504.3.12~1/RELEASE_I386 i386 i386 MacPro1,1 Darwin\n```\n\n## Building the updated lcalc on Linux\n\n```\ng++  -O3  -Wall  -O3     -ffast-math -fPIC  -I../include Lglobals.o Lgamma.o Lriemannsiegel.o Lriemannsiegel_blfi.o Ldokchitser.o Lcommandline_globals.o Lcommandline_misc.o Lcommandline_numbertheory.o Lcommandline_values_zeros.o Lcommandline_elliptic.o Lcommandline_twist.o Lcommandline.o cmdline.o -L/home/kirkby/sage-4.4.2/local/lib  -lpari -lmpir -o lcalc \nmake[1]: Leaving directory `/home/kirkby/sage-4.4.2/spkg/build/lcalc-20100428-1.23.p0/src/src'\nmake examples\nmake[1]: Entering directory `/home/kirkby/sage-4.4.2/spkg/build/lcalc-20100428-1.23.p0/src/src'\ng++  -O3  -Wall  -O3     -ffast-math -fPIC  -I../include example_programs/example.cc libLfunction.so -o example_programs/example \nIn file included from /usr/include/c++/4.2/backward/strstream:51,\n                 from ../include/L.h:34,\n                 from example_programs/example.cc:2:\n/usr/include/c++/4.2/backward/backward_warning.h:32:2: warning: #warning This file includes at least one deprecated or antiquated header. Please consider using one of the 32 headers found in section 17.4.1.2 of the C++ standard. Examples include substituting the <X> header for the <X.h> header for C++ includes, or <iostream> instead of the deprecated header <iostream.h>. To disable this warning use -Wno-deprecated.\nIn file included from ../include/L.h:537,\n                 from example_programs/example.cc:2:\n../include/Lvalue.h:187: warning: ignoring #pragma omp parallel\n../include/Lvalue.h:324: warning: ignoring #pragma omp parallel\n../include/Lvalue.h:329: warning: ignoring #pragma omp parallel\n../include/Lvalue.h: In member function \u2018Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = int]\u2019:\n../include/Lvalue.h:627:   instantiated from \u2018Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = int]\u2019\nexample_programs/example.cc:88:   instantiated from here\n../include/Lvalue.h:502: warning: unused variable \u2018t_0\u2019\n../include/Lvalue.h: In member function \u2018Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = std::complex<double>]\u2019:\n../include/Lvalue.h:627:   instantiated from \u2018Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = std::complex<double>]\u2019\nexample_programs/example.cc:90:   instantiated from here\n../include/Lvalue.h:502: warning: unused variable \u2018t_0\u2019\n../include/Lvalue.h: In member function \u2018Complex L_function<ttype>::find_delta(Complex, Double) [with ttype = int]\u2019:\n../include/Lvalue.h:517:   instantiated from \u2018Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = int]\u2019\n../include/Lvalue.h:627:   instantiated from \u2018Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = int]\u2019\nexample_programs/example.cc:88:   instantiated from here\n../include/Lvalue.h:37: warning: unused variable \u2018f2\u2019\n../include/Lgamma.h: In function \u2018Complex gamma_sum(Complex, int, ttype*, int, Double, Complex, Double, Long, Complex, const char*) [with ttype = int]\u2019:\n../include/Lvalue.h:526:   instantiated from \u2018Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = int]\u2019\n../include/Lvalue.h:627:   instantiated from \u2018Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = int]\u2019\nexample_programs/example.cc:88:   instantiated from here\n../include/Lgamma.h:622: warning: unused variable \u2018y\u2019\n../include/Lgamma.h:622: warning: unused variable \u2018y2\u2019\n../include/Lgamma.h:622: warning: unused variable \u2018y3\u2019\n../include/Lvalue.h: In member function \u2018Complex L_function<ttype>::find_delta(Complex, Double) [with ttype = std::complex<double>]\u2019:\n../include/Lvalue.h:517:   instantiated from \u2018Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = std::complex<double>]\u2019\n../include/Lvalue.h:627:   instantiated from \u2018Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = std::complex<double>]\u2019\nexample_programs/example.cc:90:   instantiated from here\n../include/Lvalue.h:37: warning: unused variable \u2018f2\u2019\n../include/Lgamma.h: In function \u2018Complex gamma_sum(Complex, int, ttype*, int, Double, Complex, Double, Long, Complex, const char*) [with ttype = std::complex<double>]\u2019:\n../include/Lvalue.h:526:   instantiated from \u2018Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = std::complex<double>]\u2019\n../include/Lvalue.h:627:   instantiated from \u2018Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = std::complex<double>]\u2019\nexample_programs/example.cc:90:   instantiated from here\n../include/Lgamma.h:622: warning: unused variable \u2018y\u2019\n../include/Lgamma.h:622: warning: unused variable \u2018y2\u2019\n../include/Lgamma.h:622: warning: unused variable \u2018y3\u2019\n../include/Lvalue.h: In member function \u2018Complex L_function<ttype>::value_via_Riemann_sum(Complex, const char*) [with ttype = int]\u2019:\n../include/Lvalue.h:487: warning: control reaches end of non-void function\n../include/Lvalue.h: In member function \u2018Complex L_function<ttype>::value_via_Riemann_sum(Complex, const char*) [with ttype = std::complex<double>]\u2019:\n../include/Lvalue.h:487: warning: control reaches end of non-void function\nmake[1]: Leaving directory `/home/kirkby/sage-4.4.2/spkg/build/lcalc-20100428-1.23.p0/src/src'\nNow copying over lcalc binary\nNow copying over lcalc library\n\nreal\t0m31.703s\nuser\t0m28.860s\nsys\t0m2.480s\nSuccessfully installed lcalc-20100428-1.23.p0\nNow cleaning up tmp files.\nMaking Sage/Python scripts relocatable...\nMaking script relocatable\nFinished installing lcalc-20100428-1.23.p0.spkg\nkirkby@sage:~/sage-4.4.2$ uname -a\nLinux sage.math.washington.edu 2.6.24-26-server #1 SMP Tue Dec 1 18:26:43 UTC 2009 x86_64 GNU/Linux\n\n```",
    "created_at": "2010-05-28T21:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9043#issuecomment-83588",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:3'></a>## The cause  and solution
The problem was that CXXFLAGS was not being imported properly into patches/Makefile.sage. Although CXX was set correctly in spkg-install, the make file did not honor this properly. 

This was simple to fix, by adding 'CXXFLAG64' to the list of variables imported by patches/Makefile.sage. During a 64-bit build with "SAGE64=yes", this is set to -m64 (by default). 

An updated package can be found at

http://boxen.math.washington.edu/home/kirkby/patches/lcalc-20100428-1.23.p0.spkg

Although there are lots of warnings, these are in the original code, so are not a result of the change makefile. 

## Testing of updated 'lcalc' on OpenSolaris x64
Here's is part of the output from the Sun Ultra 27, which showed the problem when building 'lcalc' as 64-bit. As you can see, it now builds. A check was made that all files installed are 64-bit, and this is indeed the case. 

```
cmdline.c:96: warning: deprecated conversion from string constant to ‘char*’
g++  -O3  -m64  -Wall  -O3     -ffast-math -fPIC  -I../include Lglobals.o Lgamma.o Lriemannsiegel.o Lriemannsiegel_blfi.o Ldokchitser.o Lcommandline_globals.o Lcommandline_misc.o Lcommandline_numbertheory.o Lcommandline_values_zeros.o Lcommandline_elliptic.o Lcommandline_twist.o Lcommandline.o cmdline.o -L/export/home/drkirkby/sage-4.4.2/local/lib  -lpari -lmpir -o lcalc 
make[1]: Leaving directory `/export/home/drkirkby/sage-4.4.2/spkg/build/lcalc-20100428-1.23.p0/src/src'
make examples
make[1]: Entering directory `/export/home/drkirkby/sage-4.4.2/spkg/build/lcalc-20100428-1.23.p0/src/src'
g++  -O3  -m64  -Wall  -O3     -ffast-math -fPIC  -I../include example_programs/example.cc libLfunction.so -o example_programs/example 
In file included from /usr/local/gcc-4.4.4/lib/gcc/i386-pc-solaris2.11/4.4.4/../../../../include/c++/4.4.4/backward/strstream:47,
                 from ../include/L.h:34,
                 from example_programs/example.cc:2:
/usr/local/gcc-4.4.4/lib/gcc/i386-pc-solaris2.11/4.4.4/../../../../include/c++/4.4.4/backward/backward_warning.h:28:2: warning: #warning This file includes at least one deprecated or antiquated header which may be removed without further notice at a future date. Please use a non-deprecated interface with equivalent functionality instead. For a listing of replacement headers and interfaces, consult the file backward_warning.h. To disable this warning use -Wno-deprecated.
In file included from ../include/L.h:537,
                 from example_programs/example.cc:2:
../include/Lvalue.h:187: warning: ignoring #pragma omp parallel
../include/Lvalue.h:324: warning: ignoring #pragma omp parallel
../include/Lvalue.h:329: warning: ignoring #pragma omp parallel
../include/Lvalue.h: In member function ‘Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = int]’:
../include/Lvalue.h:627:   instantiated from ‘Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = int]’
example_programs/example.cc:88:   instantiated from here
../include/Lvalue.h:502: warning: unused variable ‘t_0’
../include/Lvalue.h: In member function ‘Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = std::complex<double>]’:
../include/Lvalue.h:627:   instantiated from ‘Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = std::complex<double>]’
example_programs/example.cc:90:   instantiated from here
../include/Lvalue.h:502: warning: unused variable ‘t_0’
In file included from ../include/L.h:537,
                 from example_programs/example.cc:2:
../include/Lvalue.h: In member function ‘Complex L_function<ttype>::find_delta(Complex, Double) [with ttype = int]’:
../include/Lvalue.h:517:   instantiated from ‘Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = int]’
../include/Lvalue.h:627:   instantiated from ‘Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = int]’
example_programs/example.cc:88:   instantiated from here
../include/Lvalue.h:37: warning: unused variable ‘f2’
In file included from ../include/L.h:42,
                 from example_programs/example.cc:2:
../include/Lgamma.h: In function ‘Complex gamma_sum(Complex, int, ttype*, int, Double, Complex, Double, Long, Complex, const char*) [with ttype = int]’:
../include/Lvalue.h:526:   instantiated from ‘Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = int]’
../include/Lvalue.h:627:   instantiated from ‘Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = int]’
example_programs/example.cc:88:   instantiated from here
../include/Lgamma.h:622: warning: unused variable ‘y’
../include/Lgamma.h:622: warning: unused variable ‘y2’
../include/Lgamma.h:622: warning: unused variable ‘y3’
In file included from ../include/L.h:537,
                 from example_programs/example.cc:2:
../include/Lvalue.h: In member function ‘Complex L_function<ttype>::find_delta(Complex, Double) [with ttype = std::complex<double>]’:
../include/Lvalue.h:517:   instantiated from ‘Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = std::complex<double>]’
../include/Lvalue.h:627:   instantiated from ‘Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = std::complex<double>]’
example_programs/example.cc:90:   instantiated from here
../include/Lvalue.h:37: warning: unused variable ‘f2’
In file included from ../include/L.h:42,
                 from example_programs/example.cc:2:
../include/Lgamma.h: In function ‘Complex gamma_sum(Complex, int, ttype*, int, Double, Complex, Double, Long, Complex, const char*) [with ttype = std::complex<double>]’:
../include/Lvalue.h:526:   instantiated from ‘Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = std::complex<double>]’
../include/Lvalue.h:627:   instantiated from ‘Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = std::complex<double>]’
example_programs/example.cc:90:   instantiated from here
../include/Lgamma.h:622: warning: unused variable ‘y’
../include/Lgamma.h:622: warning: unused variable ‘y2’
../include/Lgamma.h:622: warning: unused variable ‘y3’
../include/Lvalue.h: In member function ‘Complex L_function<ttype>::value_via_Riemann_sum(Complex, const char*) [with ttype = int]’:
../include/Lvalue.h:489: warning: control reaches end of non-void function
../include/Lvalue.h: In member function ‘Complex L_function<ttype>::value_via_Riemann_sum(Complex, const char*) [with ttype = std::complex<double>]’:
../include/Lvalue.h:489: warning: control reaches end of non-void function
make[1]: Leaving directory `/export/home/drkirkby/sage-4.4.2/spkg/build/lcalc-20100428-1.23.p0/src/src'
Now copying over lcalc binary
Now copying over lcalc library

real	0m23.105s
user	0m22.026s
sys	0m0.905s
Successfully installed lcalc-20100428-1.23.p0
```

## Building the updated lcalc on OS X
The updated lcalc package was built on OS X.  

```
Now copying over lcalc binary
Now copying over lcalc library

real	0m40.999s
user	0m32.921s
sys	0m2.457s
Successfully installed lcalc-20100428-1.23.p0
Now cleaning up tmp files.
Making Sage/Python scripts relocatable...
Making script relocatable
Finished installing lcalc-20100428-1.23.p0.spkg
[kirkby@bsd sage-4.4.2]$ uname -a
Darwin bsd.local 10.3.0 Darwin Kernel Version 10.3.0: Fri Feb 26 11:58:09 PST 2010; root:xnu-1504.3.12~1/RELEASE_I386 i386 i386 MacPro1,1 Darwin
```

## Building the updated lcalc on Linux

```
g++  -O3  -Wall  -O3     -ffast-math -fPIC  -I../include Lglobals.o Lgamma.o Lriemannsiegel.o Lriemannsiegel_blfi.o Ldokchitser.o Lcommandline_globals.o Lcommandline_misc.o Lcommandline_numbertheory.o Lcommandline_values_zeros.o Lcommandline_elliptic.o Lcommandline_twist.o Lcommandline.o cmdline.o -L/home/kirkby/sage-4.4.2/local/lib  -lpari -lmpir -o lcalc 
make[1]: Leaving directory `/home/kirkby/sage-4.4.2/spkg/build/lcalc-20100428-1.23.p0/src/src'
make examples
make[1]: Entering directory `/home/kirkby/sage-4.4.2/spkg/build/lcalc-20100428-1.23.p0/src/src'
g++  -O3  -Wall  -O3     -ffast-math -fPIC  -I../include example_programs/example.cc libLfunction.so -o example_programs/example 
In file included from /usr/include/c++/4.2/backward/strstream:51,
                 from ../include/L.h:34,
                 from example_programs/example.cc:2:
/usr/include/c++/4.2/backward/backward_warning.h:32:2: warning: #warning This file includes at least one deprecated or antiquated header. Please consider using one of the 32 headers found in section 17.4.1.2 of the C++ standard. Examples include substituting the <X> header for the <X.h> header for C++ includes, or <iostream> instead of the deprecated header <iostream.h>. To disable this warning use -Wno-deprecated.
In file included from ../include/L.h:537,
                 from example_programs/example.cc:2:
../include/Lvalue.h:187: warning: ignoring #pragma omp parallel
../include/Lvalue.h:324: warning: ignoring #pragma omp parallel
../include/Lvalue.h:329: warning: ignoring #pragma omp parallel
../include/Lvalue.h: In member function ‘Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = int]’:
../include/Lvalue.h:627:   instantiated from ‘Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = int]’
example_programs/example.cc:88:   instantiated from here
../include/Lvalue.h:502: warning: unused variable ‘t_0’
../include/Lvalue.h: In member function ‘Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = std::complex<double>]’:
../include/Lvalue.h:627:   instantiated from ‘Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = std::complex<double>]’
example_programs/example.cc:90:   instantiated from here
../include/Lvalue.h:502: warning: unused variable ‘t_0’
../include/Lvalue.h: In member function ‘Complex L_function<ttype>::find_delta(Complex, Double) [with ttype = int]’:
../include/Lvalue.h:517:   instantiated from ‘Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = int]’
../include/Lvalue.h:627:   instantiated from ‘Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = int]’
example_programs/example.cc:88:   instantiated from here
../include/Lvalue.h:37: warning: unused variable ‘f2’
../include/Lgamma.h: In function ‘Complex gamma_sum(Complex, int, ttype*, int, Double, Complex, Double, Long, Complex, const char*) [with ttype = int]’:
../include/Lvalue.h:526:   instantiated from ‘Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = int]’
../include/Lvalue.h:627:   instantiated from ‘Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = int]’
example_programs/example.cc:88:   instantiated from here
../include/Lgamma.h:622: warning: unused variable ‘y’
../include/Lgamma.h:622: warning: unused variable ‘y2’
../include/Lgamma.h:622: warning: unused variable ‘y3’
../include/Lvalue.h: In member function ‘Complex L_function<ttype>::find_delta(Complex, Double) [with ttype = std::complex<double>]’:
../include/Lvalue.h:517:   instantiated from ‘Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = std::complex<double>]’
../include/Lvalue.h:627:   instantiated from ‘Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = std::complex<double>]’
example_programs/example.cc:90:   instantiated from here
../include/Lvalue.h:37: warning: unused variable ‘f2’
../include/Lgamma.h: In function ‘Complex gamma_sum(Complex, int, ttype*, int, Double, Complex, Double, Long, Complex, const char*) [with ttype = std::complex<double>]’:
../include/Lvalue.h:526:   instantiated from ‘Complex L_function<ttype>::value_via_gamma_sum(Complex, const char*) [with ttype = std::complex<double>]’
../include/Lvalue.h:627:   instantiated from ‘Complex L_function<ttype>::value(Complex, int, const char*) [with ttype = std::complex<double>]’
example_programs/example.cc:90:   instantiated from here
../include/Lgamma.h:622: warning: unused variable ‘y’
../include/Lgamma.h:622: warning: unused variable ‘y2’
../include/Lgamma.h:622: warning: unused variable ‘y3’
../include/Lvalue.h: In member function ‘Complex L_function<ttype>::value_via_Riemann_sum(Complex, const char*) [with ttype = int]’:
../include/Lvalue.h:487: warning: control reaches end of non-void function
../include/Lvalue.h: In member function ‘Complex L_function<ttype>::value_via_Riemann_sum(Complex, const char*) [with ttype = std::complex<double>]’:
../include/Lvalue.h:487: warning: control reaches end of non-void function
make[1]: Leaving directory `/home/kirkby/sage-4.4.2/spkg/build/lcalc-20100428-1.23.p0/src/src'
Now copying over lcalc binary
Now copying over lcalc library

real	0m31.703s
user	0m28.860s
sys	0m2.480s
Successfully installed lcalc-20100428-1.23.p0
Now cleaning up tmp files.
Making Sage/Python scripts relocatable...
Making script relocatable
Finished installing lcalc-20100428-1.23.p0.spkg
kirkby@sage:~/sage-4.4.2$ uname -a
Linux sage.math.washington.edu 2.6.24-26-server #1 SMP Tue Dec 1 18:26:43 UTC 2009 x86_64 GNU/Linux

```



---

archive/issue_comments_083589.json:
```json
{
    "body": "Mercurial patch to allow a 64-bit build of 'lcalc' if SAGE64=yes",
    "created_at": "2010-05-28T21:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9043#issuecomment-83589",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Mercurial patch to allow a 64-bit build of 'lcalc' if SAGE64=yes



---

archive/issue_comments_083590.json:
```json
{
    "body": "<a id='comment:4'></a>Attachment [lcalc-64-bit-fix.patch](tarball://root/attachments/some-uuid/ticket9043/lcalc-64-bit-fix.patch) by drkirkby created at 2010-05-28 21:18:46\n\nReplying to [comment:1 rishi]:\n> I do not have access to opensolaris machine. \n\n\nYou can install it as a virtual machine on Windows or Linux if you wanted. \n\n> I am busy with other things also. \n\n\nI understand.\n\n> Can you make appropriate changes to Makefile.sage in patches directory and see if things work.\n\n\nSure, I've done that. The package now builds 64-bit on OpenSolaris when SAGE64 is set to yes. I've also tested this on Linux (sage.math) and OS X (bsd.math). It builds fine on all platforms. \n\nDave",
    "created_at": "2010-05-28T21:18:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9043#issuecomment-83590",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:4'></a>Attachment [lcalc-64-bit-fix.patch](tarball://root/attachments/some-uuid/ticket9043/lcalc-64-bit-fix.patch) by drkirkby created at 2010-05-28 21:18:46

Replying to [comment:1 rishi]:
> I do not have access to opensolaris machine. 


You can install it as a virtual machine on Windows or Linux if you wanted. 

> I am busy with other things also. 


I understand.

> Can you make appropriate changes to Makefile.sage in patches directory and see if things work.


Sure, I've done that. The package now builds 64-bit on OpenSolaris when SAGE64 is set to yes. I've also tested this on Linux (sage.math) and OS X (bsd.math). It builds fine on all platforms. 

Dave



---

archive/issue_comments_083591.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-05-28T21:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9043#issuecomment-83591",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_083592.json:
```json
{
    "body": "<a id='comment:5'></a>I forgot to say, there were a couple of other changes I did at the same time. \n\n1) Removed the following 4 binary files from the source distribution. \n\n```\n   ./src/src/.Makefile.old.swp\n   ./src/src/.Lcommandline.ggo.swp\n   ./src/include/.Lvalue.h.swp\n   ./src/include/.Lexplicit_formula.h.swp\n\n```\n\n2) Test for SAGE64 being \"yes\" and not \"yes\" or \"1\" as before, since other code in Sage will only allow SAGE64 to be \"yes\" or \"no\". The number \"1\" is not a legal value, so there was no point checking for it.",
    "created_at": "2010-05-28T21:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9043#issuecomment-83592",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:5'></a>I forgot to say, there were a couple of other changes I did at the same time. 

1) Removed the following 4 binary files from the source distribution. 

```
   ./src/src/.Makefile.old.swp
   ./src/src/.Lcommandline.ggo.swp
   ./src/include/.Lvalue.h.swp
   ./src/include/.Lexplicit_formula.h.swp

```

2) Test for SAGE64 being "yes" and not "yes" or "1" as before, since other code in Sage will only allow SAGE64 to be "yes" or "no". The number "1" is not a legal value, so there was no point checking for it.



---

archive/issue_comments_083593.json:
```json
{
    "body": "<a id='comment:6'></a>looks good to me. This deserves a positive review.\n\nJaap",
    "created_at": "2010-06-12T16:23:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9043#issuecomment-83593",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:6'></a>looks good to me. This deserves a positive review.

Jaap



---

archive/issue_comments_083594.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-06-12T16:23:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9043#issuecomment-83594",
    "user": "https://github.com/jaapspies"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_022143.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-06-25T15:51:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9043",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9043#event-22143"
}
```



---

archive/issue_comments_083595.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-06-25T15:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9043#issuecomment-83595",
    "user": "https://github.com/rlmill"
}
```

Resolution: fixed
