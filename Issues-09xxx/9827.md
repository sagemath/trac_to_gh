# Issue 9827: Intermittent doctest failure in sage/interfaces/psage.py

archive/issues_009826.json:
```json
{
    "body": "This happens sometimes:\n\n```python\nsage -t --long devel/sage/sage/interfaces/psage.py\n**********************************************************************\nFile \"devel/sage/sage/interfaces/psage.py\", line 37, in sage.interfaces.psage\nFailed example:\n    w       # long time, random output\nException raised:\n    Traceback (most recent call last):\n      File \"/release/buildbot/sage/sage-1/sage_upgrade_4.8/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 466, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/release/buildbot/sage/sage-1/sage_upgrade_4.8/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 825, in execute\n        exec compiled in globs\n      File \"<doctest sage.interfaces.psage[3]>\", line 1, in <module>\n        w       # long time, random output\n      File \"/release/buildbot/sage/sage-1/sage_upgrade_4.8/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/misc/displayhook.py\", line 201, in __call__\n        self.oldhook(obj)\n      File \"/release/buildbot/sage/sage-1/sage_upgrade_4.8/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 880, in __repr__\n        s =  s.replace(self._name, self.__dict__['__custom_name'])\n    KeyError: '__custom_name'\n**********************************************************************\n```\n\nSee [this reply](http://groups.google.com/group/sage-release/browse_thread/thread/b2827cba9319bfed/14beffeda6842d4b#14beffeda6842d4b) (and possible follow-ups) for batch-testing results for `psage.py`.\n\nDistantly related: #1991.\n\nAssignee: @williamstein\n\nBranch/Commit: 019dda08c66a4fd4deea44ff5e87714ac2ba3575\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/9827\n\n",
    "closed_at": "2014-10-23T11:17:01Z",
    "created_at": "2010-08-28T00:15:05Z",
    "labels": [
        "component: interfaces",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Intermittent doctest failure in sage/interfaces/psage.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9827",
    "user": "https://github.com/qed777"
}
```
This happens sometimes:

```python
sage -t --long devel/sage/sage/interfaces/psage.py
**********************************************************************
File "devel/sage/sage/interfaces/psage.py", line 37, in sage.interfaces.psage
Failed example:
    w       # long time, random output
Exception raised:
    Traceback (most recent call last):
      File "/release/buildbot/sage/sage-1/sage_upgrade_4.8/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 466, in _run
        self.execute(example, compiled, test.globs)
      File "/release/buildbot/sage/sage-1/sage_upgrade_4.8/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 825, in execute
        exec compiled in globs
      File "<doctest sage.interfaces.psage[3]>", line 1, in <module>
        w       # long time, random output
      File "/release/buildbot/sage/sage-1/sage_upgrade_4.8/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/misc/displayhook.py", line 201, in __call__
        self.oldhook(obj)
      File "/release/buildbot/sage/sage-1/sage_upgrade_4.8/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 880, in __repr__
        s =  s.replace(self._name, self.__dict__['__custom_name'])
    KeyError: '__custom_name'
**********************************************************************
```

See [this reply](http://groups.google.com/group/sage-release/browse_thread/thread/b2827cba9319bfed/14beffeda6842d4b#14beffeda6842d4b) (and possible follow-ups) for batch-testing results for `psage.py`.

Distantly related: #1991.

Assignee: @williamstein

Branch/Commit: 019dda08c66a4fd4deea44ff5e87714ac2ba3575

Reviewer: Frédéric Chapoton

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/9827





---

archive/issue_comments_101075.json:
```json
{
    "body": "<a id='comment:1'></a>Near the top of `sage/interfaces/psage.py` is a possibly relevant note:\n\n```\nBUG -- currently non-idle PSage subprocesses do not stop when\n\\sage exits.  I would very much like to fix this but don't know how.\n```",
    "created_at": "2010-08-28T00:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9827#issuecomment-101075",
    "user": "https://github.com/qed777"
}
```

<a id='comment:1'></a>Near the top of `sage/interfaces/psage.py` is a possibly relevant note:

```
BUG -- currently non-idle PSage subprocesses do not stop when
\sage exits.  I would very much like to fix this but don't know how.
```



---

archive/issue_comments_101076.json:
```json
{
    "body": "<a id='comment:2'></a>Is this still relevant after #12415?",
    "created_at": "2013-03-14T21:49:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9827#issuecomment-101076",
    "user": "https://github.com/roed314"
}
```

<a id='comment:2'></a>Is this still relevant after #12415?



---

archive/issue_comments_101077.json:
```json
{
    "body": "Changing assignee from mvngu to @williamstein.",
    "created_at": "2013-03-28T22:16:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9827#issuecomment-101077",
    "user": "https://github.com/roed314"
}
```

Changing assignee from mvngu to @williamstein.



---

archive/issue_comments_101078.json:
```json
{
    "body": "<a id='comment:3'></a>I don't think this has to do with doctesting...",
    "created_at": "2013-03-28T22:16:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9827#issuecomment-101078",
    "user": "https://github.com/roed314"
}
```

<a id='comment:3'></a>I don't think this has to do with doctesting...



---

archive/issue_comments_101079.json:
```json
{
    "body": "Changing component from doctest to interfaces.",
    "created_at": "2013-03-28T22:16:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9827#issuecomment-101079",
    "user": "https://github.com/roed314"
}
```

Changing component from doctest to interfaces.



---

archive/issue_comments_101080.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -29,11 +29,9 @@\n      KeyError: '__custom_name' \n \\`\\`\\`\n \n-See [this reply](http://groups.google.com/group/sage-release/browse_thread/thread/b2827cba9319bfed/14beffeda6842d4b#14beffeda6842d4b) (and possible follow-ups) for batch-testing results for \\`psage.py\\`.  The problem may be in \\`SAGE_LOCAL/bin/sage-test\\` and/or \\`sage-doctest\\`.\n+See [this reply](http://groups.google.com/group/sage-release/browse_thread/thread/b2827cba9319bfed/14beffeda6842d4b#14beffeda6842d4b) (and possible follow-ups) for batch-testing results for \\`psage.py\\`.\n \n Distantly related: #1991.\n-\n-Assignee: mvngu\n \n Comment: 1\n \n```\n",
    "created_at": "2013-04-05T13:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9827#issuecomment-101080",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -29,11 +29,9 @@
      KeyError: '__custom_name' 
 \`\`\`
 
-See [this reply](http://groups.google.com/group/sage-release/browse_thread/thread/b2827cba9319bfed/14beffeda6842d4b#14beffeda6842d4b) (and possible follow-ups) for batch-testing results for \`psage.py\`.  The problem may be in \`SAGE_LOCAL/bin/sage-test\` and/or \`sage-doctest\`.
+See [this reply](http://groups.google.com/group/sage-release/browse_thread/thread/b2827cba9319bfed/14beffeda6842d4b#14beffeda6842d4b) (and possible follow-ups) for batch-testing results for \`psage.py\`.
 
 Distantly related: #1991.
-
-Assignee: mvngu
 
 Comment: 1
 
```




---

archive/issue_events_024736.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-05T13:12:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "milestone": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9827#event-24736"
}
```



---

archive/issue_comments_101081.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,30 @@\n+This happens sometimes:\n \n+\\`\\`\\`python\n+sage -t --long devel/sage/sage/interfaces/psage.py\n+**********************************************************************\n+File \"devel/sage/sage/interfaces/psage.py\", line 37, in sage.interfaces.psage\n+Failed example:\n+    w       # long time, random output\n+Exception raised:\n+    Traceback (most recent call last):\n+      File \"/release/buildbot/sage/sage-1/sage_upgrade_4.8/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 466, in _run\n+        self.execute(example, compiled, test.globs)\n+      File \"/release/buildbot/sage/sage-1/sage_upgrade_4.8/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 825, in execute\n+        exec compiled in globs\n+      File \"<doctest sage.interfaces.psage[3]>\", line 1, in <module>\n+        w       # long time, random output\n+      File \"/release/buildbot/sage/sage-1/sage_upgrade_4.8/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/misc/displayhook.py\", line 201, in __call__\n+        self.oldhook(obj)\n+      File \"/release/buildbot/sage/sage-1/sage_upgrade_4.8/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 880, in __repr__\n+        s =  s.replace(self._name, self.__dict__['__custom_name'])\n+    KeyError: '__custom_name'\n+**********************************************************************\n+\\`\\`\\`\n+\n+See [this reply](http://groups.google.com/group/sage-release/browse_thread/thread/b2827cba9319bfed/14beffeda6842d4b#14beffeda6842d4b) (and possible follow-ups) for batch-testing results for \\`psage.py\\`.\n+\n+Distantly related: #1991.\n \n Comment: 1\n \n```\n",
    "created_at": "2013-04-05T13:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9827#issuecomment-101081",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,30 @@
+This happens sometimes:
 
+\`\`\`python
+sage -t --long devel/sage/sage/interfaces/psage.py
+**********************************************************************
+File "devel/sage/sage/interfaces/psage.py", line 37, in sage.interfaces.psage
+Failed example:
+    w       # long time, random output
+Exception raised:
+    Traceback (most recent call last):
+      File "/release/buildbot/sage/sage-1/sage_upgrade_4.8/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 466, in _run
+        self.execute(example, compiled, test.globs)
+      File "/release/buildbot/sage/sage-1/sage_upgrade_4.8/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 825, in execute
+        exec compiled in globs
+      File "<doctest sage.interfaces.psage[3]>", line 1, in <module>
+        w       # long time, random output
+      File "/release/buildbot/sage/sage-1/sage_upgrade_4.8/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/misc/displayhook.py", line 201, in __call__
+        self.oldhook(obj)
+      File "/release/buildbot/sage/sage-1/sage_upgrade_4.8/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 880, in __repr__
+        s =  s.replace(self._name, self.__dict__['__custom_name'])
+    KeyError: '__custom_name'
+**********************************************************************
+\`\`\`
+
+See [this reply](http://groups.google.com/group/sage-release/browse_thread/thread/b2827cba9319bfed/14beffeda6842d4b#14beffeda6842d4b) (and possible follow-ups) for batch-testing results for \`psage.py\`.
+
+Distantly related: #1991.
 
 Comment: 1
 
```




---

archive/issue_comments_101082.json:
```json
{
    "body": "Attachment [9827_custom_name.patch](tarball://root/attachments/some-uuid/ticket9827/9827_custom_name.patch) by @jdemeyer created at 2013-04-05 13:27:11",
    "created_at": "2013-04-05T13:27:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9827#issuecomment-101082",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [9827_custom_name.patch](tarball://root/attachments/some-uuid/ticket9827/9827_custom_name.patch) by @jdemeyer created at 2013-04-05 13:27:11



---

archive/issue_comments_101083.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-04-05T13:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9827#issuecomment-101083",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_events_024737.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "milestone": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9827#event-24737"
}
```



---

archive/issue_events_024738.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9827#event-24738"
}
```



---

archive/issue_events_024739.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9827#event-24739"
}
```



---

archive/issue_events_024740.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9827#event-24740"
}
```



---

archive/issue_events_024741.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9827#event-24741"
}
```



---

archive/issue_events_024742.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9827#event-24742"
}
```



---

archive/issue_comments_101084.json:
```json
{
    "body": "<a id='comment:10'></a>I too ran into intermittent doctest failures in #12061",
    "created_at": "2014-07-20T03:48:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9827#issuecomment-101084",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:10'></a>I too ran into intermittent doctest failures in #12061



---

archive/issue_events_024743.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9827#event-24743"
}
```



---

archive/issue_events_024744.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9827#event-24744"
}
```



---

archive/issue_comments_101085.json:
```json
{
    "body": "<a id='comment:12'></a>New commits:",
    "created_at": "2014-10-21T15:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9827#issuecomment-101085",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>New commits:



---

archive/issue_comments_101086.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-21T15:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9827#issuecomment-101086",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_101087.json:
```json
{
    "body": "<a id='comment:14'></a>Looks good to me.",
    "created_at": "2014-10-22T08:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9827#issuecomment-101087",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>Looks good to me.



---

archive/issue_comments_101088.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-10-22T08:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9827#issuecomment-101088",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_024745.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-10-23T11:17:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9827#event-24745"
}
```



---

archive/issue_comments_101089.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-23T11:17:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9827#issuecomment-101089",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
