# Issue 9094: is_square and sqrt for polynomials and fraction fields

archive/issues_009094.json:
```json
{
    "body": "Implement is_square and sqrt for polynomials and fraction fields.\n\nOnly apply: [attachment:trac_9094-sqrt-mderickx.patch]\n\nAssignee: @aghitza\n\nCC:  @koffie @pjbruin @mstreng minz\n\nResolution: fixed\n\nAuthor: Robert Bradshaw, Maarten Derickx\n\nReviewer: John Cremona, Marco Streng, Robert Bradshaw\n\nMerged: sage-4.7.alpha5\n\nIssue created by migration from https://trac.sagemath.org/ticket/9094\n\n",
    "closed_at": "2011-04-13T07:42:45Z",
    "created_at": "2010-05-30T08:45:39Z",
    "labels": [
        "component: algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7",
    "title": "is_square and sqrt for polynomials and fraction fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9094",
    "user": "https://github.com/robertwb"
}
```
Implement is_square and sqrt for polynomials and fraction fields.

Only apply: [attachment:trac_9094-sqrt-mderickx.patch]

Assignee: @aghitza

CC:  @koffie @pjbruin @mstreng minz

Resolution: fixed

Author: Robert Bradshaw, Maarten Derickx

Reviewer: John Cremona, Marco Streng, Robert Bradshaw

Merged: sage-4.7.alpha5

Issue created by migration from https://trac.sagemath.org/ticket/9094





---

archive/issue_comments_100475.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-05-30T09:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100475",
    "user": "https://github.com/robertwb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_100476.json:
```json
{
    "body": "Attachment [9094-sqrt.patch](tarball://root/attachments/some-uuid/ticket9094/9094-sqrt.patch) by @robertwb created at 2010-05-30 09:28:20",
    "created_at": "2010-05-30T09:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100476",
    "user": "https://github.com/robertwb"
}
```

Attachment [9094-sqrt.patch](tarball://root/attachments/some-uuid/ticket9094/9094-sqrt.patch) by @robertwb created at 2010-05-30 09:28:20



---

archive/issue_comments_100477.json:
```json
{
    "body": "<a id='comment:2'></a>\nLooks good (and useful).  Patch applies fine to 4.4.3.  I tested all sage/rings and had one failure (in a new doctest, on 64-bit ubuntu):\n\n```\nFile \"/storage/jec/sage-4.4.3/devel/sage-tests/sage/rings/polynomial/polynomial_element.pyx\", line 1262:\n    sage: (9 * f^10 * g^4).sqrt() == 3 * f^5 * g^2\nExpected:\n    True\nGot:\n    False\n```\nI have never been happy about doctests using random elements, however deterministic they are supposed to be.\n\nI would have tested for self==0 at the start of the sqrt function, but that case will be caught quickly anyway, so no problem.\n\nI have been working on a patch to add both all= and extend= parameters to the sqrt function for AA and QQbar, having found how awkward it is when the parameters are not uniform across types.  Would it be worth adding an extend= parameter here, even if a NotImplementedError is raised when it is needed (i.e. for sqrt of a non-square when extend=True)?\n\nSo: needs work because of the doctest failure;  up to you whether to do the extend= thing.",
    "created_at": "2010-06-06T19:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100477",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:2'></a>
Looks good (and useful).  Patch applies fine to 4.4.3.  I tested all sage/rings and had one failure (in a new doctest, on 64-bit ubuntu):

```
File "/storage/jec/sage-4.4.3/devel/sage-tests/sage/rings/polynomial/polynomial_element.pyx", line 1262:
    sage: (9 * f^10 * g^4).sqrt() == 3 * f^5 * g^2
Expected:
    True
Got:
    False
```
I have never been happy about doctests using random elements, however deterministic they are supposed to be.

I would have tested for self==0 at the start of the sqrt function, but that case will be caught quickly anyway, so no problem.

I have been working on a patch to add both all= and extend= parameters to the sqrt function for AA and QQbar, having found how awkward it is when the parameters are not uniform across types.  Would it be worth adding an extend= parameter here, even if a NotImplementedError is raised when it is needed (i.e. for sqrt of a non-square when extend=True)?

So: needs work because of the doctest failure;  up to you whether to do the extend= thing.



---

archive/issue_comments_100478.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-06-06T19:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100478",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_100479.json:
```json
{
    "body": "Changing work_issues from \"\" to \"doctest failure\"",
    "created_at": "2010-06-06T19:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100479",
    "user": "https://github.com/JohnCremona"
}
```

Changing work_issues from "" to "doctest failure"



---

archive/issue_comments_100480.json:
```json
{
    "body": "Changing reviewer from \"\" to \"John Cremona\"",
    "created_at": "2010-06-06T19:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100480",
    "user": "https://github.com/JohnCremona"
}
```

Changing reviewer from "" to "John Cremona"



---

archive/issue_comments_100481.json:
```json
{
    "body": "Changing author from \"\" to \"Robert Bradshaw\"",
    "created_at": "2010-06-06T19:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100481",
    "user": "https://github.com/JohnCremona"
}
```

Changing author from "" to "Robert Bradshaw"



---

archive/issue_comments_100482.json:
```json
{
    "body": "<a id='comment:5'></a>\nis_square and sqrt can be done generally for fraction fields, given the corresponding functions for the base ring:\n\n```\nis_square (a / b) = is_square (a * b)\nsqrt (a / b) = sqrt (a * b) / b\n```",
    "created_at": "2010-07-07T09:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100482",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:5'></a>
is_square and sqrt can be done generally for fraction fields, given the corresponding functions for the base ring:

```
is_square (a / b) = is_square (a * b)
sqrt (a / b) = sqrt (a * b) / b
```



---

archive/issue_comments_100483.json:
```json
{
    "body": "<a id='comment:7'></a>\nOn sage days 23 we discussed how to make this faster by avoiding factoring in polynomial rings. We are currently implementing this together with the remark of pbruin. When finnished the patch will be added to 9054 because it also fixes some other bugs on that ticket.",
    "created_at": "2010-07-07T14:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100483",
    "user": "https://github.com/koffie"
}
```

<a id='comment:7'></a>
On sage days 23 we discussed how to make this faster by avoiding factoring in polynomial rings. We are currently implementing this together with the remark of pbruin. When finnished the patch will be added to 9054 because it also fixes some other bugs on that ticket.



---

archive/issue_comments_100484.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Depends on #9093 for correctness.\n+Depends on #9093 and probably also #9129 for correctness.\n``````\n",
    "created_at": "2010-07-08T18:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100484",
    "user": "https://github.com/koffie"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Depends on #9093 for correctness.
+Depends on #9093 and probably also #9129 for correctness.
``````




---

archive/issue_comments_100485.json:
```json
{
    "body": "<a id='comment:9'></a>\nThis patch also leaks memory, probably because of bug #9129\n\n```\nt=get_memory_usage()\nPr.<x>=ZZ[]\nfor i in range(500):\n    C=((x^2+1)*x+1)\n    B=C^2\n    print \"memusage\", get_memory_usage(t)\n    time x=B.sqrt()\n```\nexecuting the above gives:\n\n```\nmemusage 0.0\nTime: CPU 0.00 s, Wall: 0.00 s\nmemusage 0.0\nTime: CPU 0.00 s, Wall: 0.00 s\nmemusage 0.0\nTime: CPU 0.00 s, Wall: 0.00 s\nmemusage 0.0\nTime: CPU 0.00 s, Wall: 0.00 s\nmemusage 0.0\nTime: CPU 0.02 s, Wall: 0.02 s\nmemusage 1.20703125\nTime: CPU 0.18 s, Wall: 0.19 s\nmemusage 23.79296875\nTime: CPU 2.33 s, Wall: 2.36 s\nmemusage 148.12890625\nTime: CPU 31.70 s, Wall: 32.24 s\nmemusage 1534.01171875\n^C\n^C\n```\n\nPs. if you want to check this, please don't let the loop run as long as I did ;). It might make your computer on the edge of crashing",
    "created_at": "2010-07-08T18:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100485",
    "user": "https://github.com/koffie"
}
```

<a id='comment:9'></a>
This patch also leaks memory, probably because of bug #9129

```
t=get_memory_usage()
Pr.<x>=ZZ[]
for i in range(500):
    C=((x^2+1)*x+1)
    B=C^2
    print "memusage", get_memory_usage(t)
    time x=B.sqrt()
```
executing the above gives:

```
memusage 0.0
Time: CPU 0.00 s, Wall: 0.00 s
memusage 0.0
Time: CPU 0.00 s, Wall: 0.00 s
memusage 0.0
Time: CPU 0.00 s, Wall: 0.00 s
memusage 0.0
Time: CPU 0.00 s, Wall: 0.00 s
memusage 0.0
Time: CPU 0.02 s, Wall: 0.02 s
memusage 1.20703125
Time: CPU 0.18 s, Wall: 0.19 s
memusage 23.79296875
Time: CPU 2.33 s, Wall: 2.36 s
memusage 148.12890625
Time: CPU 31.70 s, Wall: 32.24 s
memusage 1534.01171875
^C
^C
```

Ps. if you want to check this, please don't let the loop run as long as I did ;). It might make your computer on the edge of crashing



---

archive/issue_comments_100486.json:
```json
{
    "body": "<a id='comment:10'></a>\nI just added a patch which should fix this also. It does it in a slightly different way. The sqrt() functions just are using the is_square(root=True) functionality (one should not have two square root finding algorithms in parralel). Also the sqrt() function has now the optional parameter extend. The is_square() function now also uses the trick mentioned by Peter the Bruin which is very general as it should be in this general base class.\n\nThe patch should be installed aplied to 4.4.4 instead of the other patch.",
    "created_at": "2010-07-17T10:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100486",
    "user": "https://github.com/koffie"
}
```

<a id='comment:10'></a>
I just added a patch which should fix this also. It does it in a slightly different way. The sqrt() functions just are using the is_square(root=True) functionality (one should not have two square root finding algorithms in parralel). Also the sqrt() function has now the optional parameter extend. The is_square() function now also uses the trick mentioned by Peter the Bruin which is very general as it should be in this general base class.

The patch should be installed aplied to 4.4.4 instead of the other patch.



---

archive/issue_comments_100487.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-07-17T10:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100487",
    "user": "https://github.com/koffie"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_100488.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Depends on #9093 and probably also #9129 for correctness.\n+Implement is_square and sqrt for polynomials and fraction fields.\n``````\n",
    "created_at": "2010-07-17T11:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100488",
    "user": "https://github.com/mstreng"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Depends on #9093 and probably also #9129 for correctness.
+Implement is_square and sqrt for polynomials and fraction fields.
``````




---

archive/issue_comments_100489.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-07-17T11:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100489",
    "user": "https://github.com/mstreng"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_100490.json:
```json
{
    "body": "Changing work_issues from \"doctest failure\" to \"improve documentation, add more tests\"",
    "created_at": "2010-07-17T11:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100490",
    "user": "https://github.com/mstreng"
}
```

Changing work_issues from "doctest failure" to "improve documentation, add more tests"



---

archive/issue_comments_100491.json:
```json
{
    "body": "Changing reviewer from \"John Cremona\" to \"mstreng\"",
    "created_at": "2010-07-17T11:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100491",
    "user": "https://github.com/mstreng"
}
```

Changing reviewer from "John Cremona" to "mstreng"



---

archive/issue_comments_100492.json:
```json
{
    "body": "Changing type from defect to enhancement.",
    "created_at": "2010-07-17T11:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100492",
    "user": "https://github.com/mstreng"
}
```

Changing type from defect to enhancement.



---

archive/issue_comments_100493.json:
```json
{
    "body": "Changing author from \"Robert Bradshaw\" to \"mderickx\"",
    "created_at": "2010-07-17T11:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100493",
    "user": "https://github.com/mstreng"
}
```

Changing author from "Robert Bradshaw" to "mderickx"



---

archive/issue_comments_100494.json:
```json
{
    "body": "<a id='comment:11'></a>\nLooks good. No time for a complete review right now, but here are some remarks:\n\n* Check spelling of your documentation, you probably don't mean \"wether\" (=castrated sheep), but \"whether\" (spell checker doesn't help that much here). \"Requiered\" has one \"e\" too much.\n\n* Illustrate is_square(root = True) for the user by providing a square example and a non-square example.\n\n* The internal variable name ``is_sqrt`` is confusing, remove the \"t\".\n\n* You write \"This code is quite general, it could even be implemented for all integral domains as soon as they have the is_square(root=True) option\", don't you mean \"This code is quite general, it works for all integral domains that have the is_square(root = True) option\"?\n\n* I think sqrt(self, extend = True, all = False, name=None ) should have tests of all combinations of options and squareness, i.e: sq/non-sq, extend True/False, all True/False = 2*2*2 = at least 8 examples. The extend=True for a non-square should also have examples with name=None and name=something.\n\n* Perhaps include examples for more base fields?\n\n* consider adding a few more spaces for readability thougout, e.g. around \"=\"\n\n* \"if root==True:\", why not write \"if root:\"?",
    "created_at": "2010-07-17T11:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100494",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:11'></a>
Looks good. No time for a complete review right now, but here are some remarks:

* Check spelling of your documentation, you probably don't mean "wether" (=castrated sheep), but "whether" (spell checker doesn't help that much here). "Requiered" has one "e" too much.

* Illustrate is_square(root = True) for the user by providing a square example and a non-square example.

* The internal variable name ``is_sqrt`` is confusing, remove the "t".

* You write "This code is quite general, it could even be implemented for all integral domains as soon as they have the is_square(root=True) option", don't you mean "This code is quite general, it works for all integral domains that have the is_square(root = True) option"?

* I think sqrt(self, extend = True, all = False, name=None ) should have tests of all combinations of options and squareness, i.e: sq/non-sq, extend True/False, all True/False = 2*2*2 = at least 8 examples. The extend=True for a non-square should also have examples with name=None and name=something.

* Perhaps include examples for more base fields?

* consider adding a few more spaces for readability thougout, e.g. around "="

* "if root==True:", why not write "if root:"?



---

archive/issue_comments_100495.json:
```json
{
    "body": "<a id='comment:12'></a>\nI changed all you asked for except for \"Perhaps include examples for more base fields?\". Time for another review :)",
    "created_at": "2010-07-17T14:33:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100495",
    "user": "https://github.com/koffie"
}
```

<a id='comment:12'></a>
I changed all you asked for except for "Perhaps include examples for more base fields?". Time for another review :)



---

archive/issue_comments_100496.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-07-17T14:33:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100496",
    "user": "https://github.com/koffie"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_100497.json:
```json
{
    "body": "Changing author from \"mderickx\" to \"Robert Bradshaw, Maarten Derickx\"",
    "created_at": "2010-07-18T09:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100497",
    "user": "https://github.com/mstreng"
}
```

Changing author from "mderickx" to "Robert Bradshaw, Maarten Derickx"



---

archive/issue_comments_100498.json:
```json
{
    "body": "<a id='comment:13'></a>\nfraction_field_element.pyx, line 326 \"_parent\" --> \"parent()\" (don't use a hidden variable, use the function that returns its value)\n\npolynomial_ring_element.pyx, line 1306, \"#This code is quite general, it works for all integral domains that have the is_square(root = True) option\"\n- This comment is confusing: does \"all integral domains that...\" refer to self.parent() or to self.parent().base_ring()? Why not just remove this comment?\n- Are you proposing to move the code to are more general class of ring elements? Then why not just do that? Right now, you have the same code for fraction fields and polynomial rings, but you could just put it in a more general class and add a test if self.parent() is a domain and \"self.is_square()\" exists and has a parameter \"root\". (You don't have to do this to get a positive review, but you can think about it and/or try it)\n\n(for both files:) It is helpful for others if the documentation of sqrt says how square roots are computed, i.e. says \"Calls is_square(root = True) to find the square root\". This can be done in an \"ALGORITHM:\" block. \n\nBuild the documentation using \"sage -docbuild reference html\" to test the following yourself:\n- the input, output, and examples blocks of lines 1260, 1265, and 1269 of sqrt for Polynomial don't indent and don't format nicely. All this needs is an extra empty line after the mentioned lines. See for example the is_square documentation.\n- same for the input and output blocks of sqrt for fraction field elements on lines 336 and 341.",
    "created_at": "2010-07-18T09:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100498",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:13'></a>
fraction_field_element.pyx, line 326 "_parent" --> "parent()" (don't use a hidden variable, use the function that returns its value)

polynomial_ring_element.pyx, line 1306, "#This code is quite general, it works for all integral domains that have the is_square(root = True) option"
- This comment is confusing: does "all integral domains that..." refer to self.parent() or to self.parent().base_ring()? Why not just remove this comment?
- Are you proposing to move the code to are more general class of ring elements? Then why not just do that? Right now, you have the same code for fraction fields and polynomial rings, but you could just put it in a more general class and add a test if self.parent() is a domain and "self.is_square()" exists and has a parameter "root". (You don't have to do this to get a positive review, but you can think about it and/or try it)

(for both files:) It is helpful for others if the documentation of sqrt says how square roots are computed, i.e. says "Calls is_square(root = True) to find the square root". This can be done in an "ALGORITHM:" block. 

Build the documentation using "sage -docbuild reference html" to test the following yourself:
- the input, output, and examples blocks of lines 1260, 1265, and 1269 of sqrt for Polynomial don't indent and don't format nicely. All this needs is an extra empty line after the mentioned lines. See for example the is_square documentation.
- same for the input and output blocks of sqrt for fraction field elements on lines 336 and 341.



---

archive/issue_comments_100499.json:
```json
{
    "body": "Changing reviewer from \"mstreng\" to \"John Cremona, Marco Streng\"",
    "created_at": "2010-07-18T09:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100499",
    "user": "https://github.com/mstreng"
}
```

Changing reviewer from "mstreng" to "John Cremona, Marco Streng"



---

archive/issue_comments_100500.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-07-18T09:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100500",
    "user": "https://github.com/mstreng"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_100501.json:
```json
{
    "body": "Changing work_issues from \"improve documentation, add more tests\" to \"documentation, double code\"",
    "created_at": "2010-07-18T09:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100501",
    "user": "https://github.com/mstreng"
}
```

Changing work_issues from "improve documentation, add more tests" to "documentation, double code"



---

archive/issue_comments_100502.json:
```json
{
    "body": "<a id='comment:14'></a>\nThe \"This code is quite general\" comment did what it had to do. I put it there in the hope that someone would come with a suggestion like you did. I had the feeling that the dubble code could be removed in a nice and general way, but I didn't know how. So by what you say I should just move the code to a more general class and then it will also work for fraction fields and polynomial rings (and possibly even more rings). What would be this more general class and where to find it?\n\nsage/rings/ring_element.py has only one line of code:\n\n```\n\nfrom sage.structure.element import !RingElement, is_RingElement\n\n```\n\nSo should I add it to the\u00a0RingElement\u00a0class thats imported from\u00a0sage.structure.element?",
    "created_at": "2010-07-18T11:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100502",
    "user": "https://github.com/koffie"
}
```

<a id='comment:14'></a>
The "This code is quite general" comment did what it had to do. I put it there in the hope that someone would come with a suggestion like you did. I had the feeling that the dubble code could be removed in a nice and general way, but I didn't know how. So by what you say I should just move the code to a more general class and then it will also work for fraction fields and polynomial rings (and possibly even more rings). What would be this more general class and where to find it?

sage/rings/ring_element.py has only one line of code:

```

from sage.structure.element import !RingElement, is_RingElement

```

So should I add it to the RingElement class thats imported from sage.structure.element?



---

archive/issue_comments_100503.json:
```json
{
    "body": "<a id='comment:15'></a>\nIn the sage reference manual [http://www.sagemath.org/doc/reference/](http://www.sagemath.org/doc/reference/), you can search for a class and then click on its base classes. It appears that the least general common base class is sage.structure.element.CommutativeRingElement, which in turn extends sage.structure.element.RingElement. As your implementation is for domains only, you should put it in CommutativeRingElement.\n\nYou can start your code by checking hasattr(self, 'is_square'). I don't know how to check if the function self.is_square has a keyword argument 'root' other than using try. You should try to catch \"TypeError: is_square() got an unexpected keyword argument 'root'\" and raise NotImplementedError, \"Please implement is_square with option 'root = True' for objects of type %s\" % type(self)\n\nMost importantly, check if there is no subclass of CommutativeRingElement that implements is_square by calling sqrt ;p",
    "created_at": "2010-07-18T13:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100503",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:15'></a>
In the sage reference manual [http://www.sagemath.org/doc/reference/](http://www.sagemath.org/doc/reference/), you can search for a class and then click on its base classes. It appears that the least general common base class is sage.structure.element.CommutativeRingElement, which in turn extends sage.structure.element.RingElement. As your implementation is for domains only, you should put it in CommutativeRingElement.

You can start your code by checking hasattr(self, 'is_square'). I don't know how to check if the function self.is_square has a keyword argument 'root' other than using try. You should try to catch "TypeError: is_square() got an unexpected keyword argument 'root'" and raise NotImplementedError, "Please implement is_square with option 'root = True' for objects of type %s" % type(self)

Most importantly, check if there is no subclass of CommutativeRingElement that implements is_square by calling sqrt ;p



---

archive/issue_comments_100504.json:
```json
{
    "body": "<a id='comment:16'></a>\nactually, instead of CommutativeRingElement, I guess RingElement is fine as well, as long as all = True raises a NotImplementedError",
    "created_at": "2010-07-18T13:51:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100504",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:16'></a>
actually, instead of CommutativeRingElement, I guess RingElement is fine as well, as long as all = True raises a NotImplementedError



---

archive/issue_comments_100505.json:
```json
{
    "body": "<a id='comment:17'></a>\nCatching a specific\u00a0TypeError\u00a0isn't possible apparently.\n\n```\n\ntry:\n\n\u00a0\u00a0 \u00a0raise !TypeError(\"sqrt() got an unexpected keyword argument 'root'\")\n\nexcept !TypeError(\"sqrt() got an unexpected keyword argument 'root'\"):\n\n\u00a0\u00a0 \u00a0print \"lol\"\n\n```\n\ngives as output\n\n```\n\nTraceback (click to the left of this block for traceback)\n...\nTypeError: sqrt() got an unexpected keyword argument 'root'\n` ||\n|| `\n\n\n```\n\nbut a new version is on it's way wich just catches all typeerrors",
    "created_at": "2010-07-18T19:11:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100505",
    "user": "https://github.com/koffie"
}
```

<a id='comment:17'></a>
Catching a specific TypeError isn't possible apparently.

```

try:

    raise !TypeError("sqrt() got an unexpected keyword argument 'root'")

except !TypeError("sqrt() got an unexpected keyword argument 'root'"):

    print "lol"

```

gives as output

```

Traceback (click to the left of this block for traceback)
...
TypeError: sqrt() got an unexpected keyword argument 'root'
` ||
|| `


```

but a new version is on it's way wich just catches all typeerrors



---

archive/issue_comments_100506.json:
```json
{
    "body": "<a id='comment:18'></a>\nYour\u00a0e.blablablah remark worked so I do the catching in that way now.\u00a0\n\nI decided to go for the commutative ring element class and I already implemented it there. If you think general ring elements is nicer you can put it there if you want (shouldn't be to much work, just some extra checking needed I guess). Upload comming in a few minutes.",
    "created_at": "2010-07-18T20:03:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100506",
    "user": "https://github.com/koffie"
}
```

<a id='comment:18'></a>
Your e.blablablah remark worked so I do the catching in that way now. 

I decided to go for the commutative ring element class and I already implemented it there. If you think general ring elements is nicer you can put it there if you want (shouldn't be to much work, just some extra checking needed I guess). Upload comming in a few minutes.



---

archive/issue_comments_100507.json:
```json
{
    "body": "<a id='comment:19'></a>\nHej Marco,\n\nI was already finnished when I read your last comment. Your suggestion last suggestion makes it slightly faster I guess. But I think the code is ok like it is now. I'm leaving for a holliday tomorrow and still got stuff to do, so I hope the patch is ok as it is now and else it will have to wait.",
    "created_at": "2010-07-18T20:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100507",
    "user": "https://github.com/koffie"
}
```

<a id='comment:19'></a>
Hej Marco,

I was already finnished when I read your last comment. Your suggestion last suggestion makes it slightly faster I guess. But I think the code is ok like it is now. I'm leaving for a holliday tomorrow and still got stuff to do, so I hope the patch is ok as it is now and else it will have to wait.



---

archive/issue_comments_100508.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-07-18T20:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100508",
    "user": "https://github.com/koffie"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_100509.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-07-20T23:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100509",
    "user": "https://github.com/mstreng"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_100510.json:
```json
{
    "body": "<a id='comment:21'></a>\nOn line 1903 you check if the message is \"is_square() got an unexpected keyword argument 'root'\", but you should also check for \"is_square() takes no keyword arguments\", which happens for 5.sqrt(root = True). This behaviour should have a good doctest.\n\nAfter catching a ValueError, line 1904 says:\n\nraise NotImplementedError(\"Please implement is_square with option 'root = True' for %s\" % type(self))\n\nThe ValueError may have been raised by another object than self. For example, if self has an is_square(root = True), but calls b.is_square(root = root) of another object b. In that case, this message is misleading: it says that self.is_square(root = True) should be implemented, while it is already well implemented and it is in fact b.is_square(root = True) that should be implemented. You can replace the message by the following:\n\nraise NotImplementedError(\"Please implement sqrt() for objects of type %s\" % type(self))\n\nCan you get examples where these errors are raised and add them to the doctests?\n\nAlternatively, you can either\n\n* make sure \"is_square\" exists for CommutativeRingElement and \"is_square\" has a keyword argument \"root\" for every subclass of CommutativeRingElement (you'll be writing NotImplementedError a lot :) and should check for tickets that implement the root = True behaviour). This seems to be a lot more stable than the current approach.\n\n* or bring back the double-code version with the same sqrt() function in two distinct classes.",
    "created_at": "2010-07-20T23:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100510",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:21'></a>
On line 1903 you check if the message is "is_square() got an unexpected keyword argument 'root'", but you should also check for "is_square() takes no keyword arguments", which happens for 5.sqrt(root = True). This behaviour should have a good doctest.

After catching a ValueError, line 1904 says:

raise NotImplementedError("Please implement is_square with option 'root = True' for %s" % type(self))

The ValueError may have been raised by another object than self. For example, if self has an is_square(root = True), but calls b.is_square(root = root) of another object b. In that case, this message is misleading: it says that self.is_square(root = True) should be implemented, while it is already well implemented and it is in fact b.is_square(root = True) that should be implemented. You can replace the message by the following:

raise NotImplementedError("Please implement sqrt() for objects of type %s" % type(self))

Can you get examples where these errors are raised and add them to the doctests?

Alternatively, you can either

* make sure "is_square" exists for CommutativeRingElement and "is_square" has a keyword argument "root" for every subclass of CommutativeRingElement (you'll be writing NotImplementedError a lot :) and should check for tickets that implement the root = True behaviour). This seems to be a lot more stable than the current approach.

* or bring back the double-code version with the same sqrt() function in two distinct classes.



---

archive/issue_comments_100511.json:
```json
{
    "body": "Changing work_issues from \"documentation, double code\" to \"catching the right errors\"",
    "created_at": "2010-07-20T23:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100511",
    "user": "https://github.com/mstreng"
}
```

Changing work_issues from "documentation, double code" to "catching the right errors"



---

archive/issue_comments_100512.json:
```json
{
    "body": "Changing work_issues from \"catching the right errors\" to \"make general sqrt compatible with lazy reals, or go back to double code\"",
    "created_at": "2010-07-22T12:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100512",
    "user": "https://github.com/mstreng"
}
```

Changing work_issues from "catching the right errors" to "make general sqrt compatible with lazy reals, or go back to double code"



---

archive/issue_comments_100513.json:
```json
{
    "body": "<a id='comment:22'></a>\nAre you sure you did a complete doctest of sage before submitting the patch?\n\n```\nsage: QuadraticField(2, 'a')\nNotImplementedError: Please implement is_square with option 'root = True' for <type 'sage.rings.real_lazy.LazyWrapper'>\n```\nThe problem is in RLF(2).sqrt()\n\n```\nsage: RLF(2).sqrt()\nNotImplementedError: Please implement is_square with option 'root = True' for <type 'sage.rings.real_lazy.LazyWrapper'>\n```\n\nRLF(2) is a LazyWrapper, which doesn't have a sqrt attribute, but simulates one via __getattr__ (line 631 of sage/rings/real_lazy.pyx). But LazyWrapper extends (via some other classes) CommutativeRingElement, so that now it does have an attribute sqrt (your sqrt function), which means the __getattr__ of LazyWrapper doesn't get a chance. Your sqrt function then complains about the non-existence of is_square with root = 'True'.\n\nYou can probably fix this by making a sqrt function for LazyWrapper that calls LazyNamedUnop(self._parent, self, 'sqrt'). Or you can follow your own advice: \"implement is_square with option 'root = True' for ....\". Maybe there is a better way, you can also ask one of the mailing lists. Alternatively, you can always go back to your double code.\n\nAnyway, every time before submitting a patch, do everything that a reviewer would do, including a full doctest of all of Sage:\n[http://www.sagemath.org/doc/developer/walk_through.html#reviewing-a-patch](http://www.sagemath.org/doc/developer/walk_through.html#reviewing-a-patch)\nOn a multi-core machine, you can speed up the doctest by using\n`./sage -tp 4 -long devel/sage-main/`\nwhere 4 is replaced by the number of cores you are willing to use.",
    "created_at": "2010-07-22T12:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100513",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:22'></a>
Are you sure you did a complete doctest of sage before submitting the patch?

```
sage: QuadraticField(2, 'a')
NotImplementedError: Please implement is_square with option 'root = True' for <type 'sage.rings.real_lazy.LazyWrapper'>
```
The problem is in RLF(2).sqrt()

```
sage: RLF(2).sqrt()
NotImplementedError: Please implement is_square with option 'root = True' for <type 'sage.rings.real_lazy.LazyWrapper'>
```

RLF(2) is a LazyWrapper, which doesn't have a sqrt attribute, but simulates one via __getattr__ (line 631 of sage/rings/real_lazy.pyx). But LazyWrapper extends (via some other classes) CommutativeRingElement, so that now it does have an attribute sqrt (your sqrt function), which means the __getattr__ of LazyWrapper doesn't get a chance. Your sqrt function then complains about the non-existence of is_square with root = 'True'.

You can probably fix this by making a sqrt function for LazyWrapper that calls LazyNamedUnop(self._parent, self, 'sqrt'). Or you can follow your own advice: "implement is_square with option 'root = True' for ....". Maybe there is a better way, you can also ask one of the mailing lists. Alternatively, you can always go back to your double code.

Anyway, every time before submitting a patch, do everything that a reviewer would do, including a full doctest of all of Sage:
[http://www.sagemath.org/doc/developer/walk_through.html#reviewing-a-patch](http://www.sagemath.org/doc/developer/walk_through.html#reviewing-a-patch)
On a multi-core machine, you can speed up the doctest by using
`./sage -tp 4 -long devel/sage-main/`
where 4 is replaced by the number of cores you are willing to use.



---

archive/issue_comments_100514.json:
```json
{
    "body": "Attachment [trac_9094-sqrt-mderickx.2.patch](tarball://root/attachments/some-uuid/ticket9094/trac_9094-sqrt-mderickx.2.patch) by @koffie created at 2011-03-22 01:09:54",
    "created_at": "2011-03-22T01:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100514",
    "user": "https://github.com/koffie"
}
```

Attachment [trac_9094-sqrt-mderickx.2.patch](tarball://root/attachments/some-uuid/ticket9094/trac_9094-sqrt-mderickx.2.patch) by @koffie created at 2011-03-22 01:09:54



---

archive/issue_comments_100515.json:
```json
{
    "body": "<a id='comment:23'></a>\nOnly apply: trac_9094-sqrt-mderickx.2.patch",
    "created_at": "2011-03-22T01:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100515",
    "user": "https://github.com/koffie"
}
```

<a id='comment:23'></a>
Only apply: trac_9094-sqrt-mderickx.2.patch



---

archive/issue_comments_100516.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n Implement is_square and sqrt for polynomials and fraction fields.\n+\n+Only apply: trac_9094-sqrt-mderickx.2.patch\n``````\n",
    "created_at": "2011-03-22T01:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100516",
    "user": "https://github.com/koffie"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 Implement is_square and sqrt for polynomials and fraction fields.
+
+Only apply: trac_9094-sqrt-mderickx.2.patch
``````




---

archive/issue_comments_100517.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-03-22T01:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100517",
    "user": "https://github.com/koffie"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_100518.json:
```json
{
    "body": "<a id='comment:25'></a>\nSince you told me you're going to rewrite the patch, I'm holding off on doctesting. Three short comments:\n\nin structure/element.pyx\n\n\n1) Line 1920 (): true --> True\n\n\n2) Line 2002 (): all=False = all=True\n\n3) The memory leak (from comment [#9](http://trac.sagemath.org/sage_trac/ticket/9094#comment:9)) is no leak after all. Note that you replace x in each iteration by C. If one doesn't do that, memory usage in each iteration is 0.0. :)",
    "created_at": "2011-03-22T05:15:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100518",
    "user": "https://trac.sagemath.org/admin/accounts/users/minz"
}
```

<a id='comment:25'></a>
Since you told me you're going to rewrite the patch, I'm holding off on doctesting. Three short comments:

in structure/element.pyx


1) Line 1920 (): true --> True


2) Line 2002 (): all=False = all=True

3) The memory leak (from comment [#9](http://trac.sagemath.org/sage_trac/ticket/9094#comment:9)) is no leak after all. Note that you replace x in each iteration by C. If one doesn't do that, memory usage in each iteration is 0.0. :)



---

archive/issue_comments_100519.json:
```json
{
    "body": "Changing assignee from @aghitza to minz.",
    "created_at": "2011-03-22T05:15:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100519",
    "user": "https://trac.sagemath.org/admin/accounts/users/minz"
}
```

Changing assignee from @aghitza to minz.



---

archive/issue_comments_100520.json:
```json
{
    "body": "Changing assignee from minz to @aghitza.",
    "created_at": "2011-03-22T05:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100520",
    "user": "https://trac.sagemath.org/admin/accounts/users/minz"
}
```

Changing assignee from minz to @aghitza.



---

archive/issue_comments_100521.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-03-22T05:56:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100521",
    "user": "https://github.com/robertwb"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_100522.json:
```json
{
    "body": "<a id='comment:27'></a>\n* is_square for fraction field elements now always computes a root, even if it's not needed. This can be quite expensive. \n\n  * Why are you writing boilerplate wrappers for all of LazyNamedUnop? Just do is_square and sqrt if need be. \n\n  * Using _parent is just fine, especially for subclasses. No need to incur the extra expense of a method call.",
    "created_at": "2011-03-22T05:56:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100522",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:27'></a>
* is_square for fraction field elements now always computes a root, even if it's not needed. This can be quite expensive. 

  * Why are you writing boilerplate wrappers for all of LazyNamedUnop? Just do is_square and sqrt if need be. 

  * Using _parent is just fine, especially for subclasses. No need to incur the extra expense of a method call.



---

archive/issue_comments_100523.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [robertwb](#comment%3A27):\n>  * is_square for fraction field elements now always computes a root, even if it's not needed. This can be quite expensive. \n\n\nIndeed, it should use `root=root` instead of `root=True`\n\n> \n> * Why are you writing boilerplate wrappers for all of LazyNamedUnop? Just do is_square and sqrt if need be. \n\n\nHi Robert,\n\nI can answer this question. This was [a discussion on sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/441948aa73d1c49f). 4 options were discussed for dealing with these unitary operators for lazy numbers.\n\nA) leaving them as they were\n\nB) hard-coding them (as Maarten just did)\n\nC) \"fixing LazyNamedUnop to preserve documentation\"\n\nD) \"populating these methods at class creation time\n(rather than attribute lookup time, perhaps dynamically creating a\ndocstring for them)\"\n\nOption A was discarded: it lacks tab completion, and (as we saw in this ticket) leads to a big mess and a lot of confusion when a base class such as RingElement gets a default implementation for one of these unitary operators.\n\nOptions C and D were suggested by you, but you seemed to be the only one in the discussion who knew how to do them. Maarten said he was interested in them, and then nothing happened for months.\n\nSo I guess that in the end Maarten implemented the only remaining option, which leads to stable, transparent, understandable code that is unfortunately a bit long.\n\nI think the extra time that Sage developers will need when extending or changing Maarten's long list of similar methods is not too bad if you compare it to the time that Sage developers will need when trying to understand more complicated code and having to debug it if something unforeseen happens. But that's just my opinion.\n\n+1 from me for the way Maarten implemented it.\n\n> \n> * Using _parent is just fine, especially for subclasses. No need to incur the extra expense of a method call. \n\n\nAre there general guidelines for this? I can imagine `_parent` to be faster, but `parent()` to be more stable in case creative implementations are in base classes.",
    "created_at": "2011-03-22T12:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100523",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:28'></a>
Replying to [robertwb](#comment%3A27):
>  * is_square for fraction field elements now always computes a root, even if it's not needed. This can be quite expensive. 


Indeed, it should use `root=root` instead of `root=True`

> 
> * Why are you writing boilerplate wrappers for all of LazyNamedUnop? Just do is_square and sqrt if need be. 


Hi Robert,

I can answer this question. This was [a discussion on sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/441948aa73d1c49f). 4 options were discussed for dealing with these unitary operators for lazy numbers.

A) leaving them as they were

B) hard-coding them (as Maarten just did)

C) "fixing LazyNamedUnop to preserve documentation"

D) "populating these methods at class creation time
(rather than attribute lookup time, perhaps dynamically creating a
docstring for them)"

Option A was discarded: it lacks tab completion, and (as we saw in this ticket) leads to a big mess and a lot of confusion when a base class such as RingElement gets a default implementation for one of these unitary operators.

Options C and D were suggested by you, but you seemed to be the only one in the discussion who knew how to do them. Maarten said he was interested in them, and then nothing happened for months.

So I guess that in the end Maarten implemented the only remaining option, which leads to stable, transparent, understandable code that is unfortunately a bit long.

I think the extra time that Sage developers will need when extending or changing Maarten's long list of similar methods is not too bad if you compare it to the time that Sage developers will need when trying to understand more complicated code and having to debug it if something unforeseen happens. But that's just my opinion.

+1 from me for the way Maarten implemented it.

> 
> * Using _parent is just fine, especially for subclasses. No need to incur the extra expense of a method call. 


Are there general guidelines for this? I can imagine `_parent` to be faster, but `parent()` to be more stable in case creative implementations are in base classes.



---

archive/issue_comments_100524.json:
```json
{
    "body": "<a id='comment:29'></a>\nNew file added Only apply: trac_9094-sqrt-mderickx.patch\n\nIt's RLF is now boiler plate code free, works with tab completion and works with inheritance thanks to Thomas Kluiver here at sage days since he told me how to do it :).\n\nAlso added the other suggestions. Hopefully finally a final version??",
    "created_at": "2011-03-22T16:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100524",
    "user": "https://github.com/koffie"
}
```

<a id='comment:29'></a>
New file added Only apply: trac_9094-sqrt-mderickx.patch

It's RLF is now boiler plate code free, works with tab completion and works with inheritance thanks to Thomas Kluiver here at sage days since he told me how to do it :).

Also added the other suggestions. Hopefully finally a final version??



---

archive/issue_comments_100525.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-03-22T16:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100525",
    "user": "https://github.com/koffie"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_100526.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n Implement is_square and sqrt for polynomials and fraction fields.\n \n-Only apply: trac_9094-sqrt-mderickx.2.patch\n+Only apply: trac_9094-sqrt-mderickx.patch\n``````\n",
    "created_at": "2011-03-22T16:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100526",
    "user": "https://github.com/koffie"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 Implement is_square and sqrt for polynomials and fraction fields.
 
-Only apply: trac_9094-sqrt-mderickx.2.patch
+Only apply: trac_9094-sqrt-mderickx.patch
``````




---

archive/issue_comments_100527.json:
```json
{
    "body": "<a id='comment:30'></a>\nHi Maarten, could you add a doctest to `__dir__` so that doctest coverage goes up instead of down? Just something simple like\n\n```\nsage: \"log\" in RLF(sqrt(8)).__dir__()\nTrue\n```",
    "created_at": "2011-03-22T17:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100527",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:30'></a>
Hi Maarten, could you add a doctest to `__dir__` so that doctest coverage goes up instead of down? Just something simple like

```
sage: "log" in RLF(sqrt(8)).__dir__()
True
```



---

archive/issue_comments_100528.json:
```json
{
    "body": "A patch instead of the other one, which I ofcourse think is better ;)",
    "created_at": "2011-03-22T17:24:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100528",
    "user": "https://github.com/koffie"
}
```

A patch instead of the other one, which I ofcourse think is better ;)



---

archive/issue_comments_100529.json:
```json
{
    "body": "<a id='comment:31'></a>\nAttachment [trac_9094-sqrt-mderickx.patch](tarball://root/attachments/some-uuid/ticket9094/trac_9094-sqrt-mderickx.patch) by @koffie created at 2011-03-22 17:26:53\n\nDone :)",
    "created_at": "2011-03-22T17:26:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100529",
    "user": "https://github.com/koffie"
}
```

<a id='comment:31'></a>
Attachment [trac_9094-sqrt-mderickx.patch](tarball://root/attachments/some-uuid/ticket9094/trac_9094-sqrt-mderickx.patch) by @koffie created at 2011-03-22 17:26:53

Done :)



---

archive/issue_comments_100530.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-03-22T19:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100530",
    "user": "https://github.com/robertwb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_100531.json:
```json
{
    "body": "<a id='comment:32'></a>\nLooks good.",
    "created_at": "2011-03-22T19:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100531",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:32'></a>
Looks good.



---

archive/issue_comments_100532.json:
```json
{
    "body": "Changing reviewer from \"John Cremona, Marco Streng\" to \"John Cremona, Marco Streng, Robert Bradshaw\"",
    "created_at": "2011-03-22T22:37:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100532",
    "user": "https://github.com/mstreng"
}
```

Changing reviewer from "John Cremona, Marco Streng" to "John Cremona, Marco Streng, Robert Bradshaw"



---

archive/issue_comments_100533.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n Implement is_square and sqrt for polynomials and fraction fields.\n \n-Only apply: trac_9094-sqrt-mderickx.patch\n+Only apply: [attachment:trac_9094-sqrt-mderickx.patch]\n``````\n",
    "created_at": "2011-04-12T08:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100533",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 Implement is_square and sqrt for polynomials and fraction fields.
 
-Only apply: trac_9094-sqrt-mderickx.patch
+Only apply: [attachment:trac_9094-sqrt-mderickx.patch]
``````




---

archive/issue_comments_100534.json:
```json
{
    "body": "Changing work_issues from \"make general sqrt compatible with lazy reals, or go back to double code\" to \"\"",
    "created_at": "2011-04-12T08:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100534",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "make general sqrt compatible with lazy reals, or go back to double code" to ""



---

archive/issue_comments_100535.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.7.alpha5\"",
    "created_at": "2011-04-13T07:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100535",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-4.7.alpha5"



---

archive/issue_events_022305.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-13T07:42:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9094#event-22305"
}
```



---

archive/issue_comments_100536.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-04-13T07:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9094#issuecomment-100536",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
