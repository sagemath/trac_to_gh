# Issue 9094: is_square and sqrt for polynomials and fraction fields

archive/issues_009094.json:
```json
{
    "assignees": [
        "https://github.com/aghitza"
    ],
    "body": "Implement is_square and sqrt for polynomials and fraction fields.\n\nOnly apply: [attachment: trac_9094-sqrt-mderickx.patch](https://github.com/sagemath/sage/files/ticket9094/trac_9094-sqrt-mderickx.patch.gz)\n\nCC:  @koffie @pjbruin @mstreng @mminzlaff\n\nComponent: **algebra**\n\nAuthor: **Robert Bradshaw, Maarten Derickx**\n\nReviewer: **John Cremona, Marco Streng, Robert Bradshaw**\n\nMerged: **sage-4.7.alpha5**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/9094_\n\n",
    "closed_at": "2011-04-13T07:42:45Z",
    "created_at": "2010-05-30T08:45:39Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "is_square and sqrt for polynomials and fraction fields",
    "type": "issue",
    "updated_at": "2011-04-13T07:42:45Z",
    "url": "https://github.com/sagemath/sage/issues/9094",
    "user": "https://github.com/robertwb"
}
```
Implement is_square and sqrt for polynomials and fraction fields.

Only apply: [attachment: trac_9094-sqrt-mderickx.patch](https://github.com/sagemath/sage/files/ticket9094/trac_9094-sqrt-mderickx.patch.gz)

CC:  @koffie @pjbruin @mstreng @mminzlaff

Component: **algebra**

Author: **Robert Bradshaw, Maarten Derickx**

Reviewer: **John Cremona, Marco Streng, Robert Bradshaw**

Merged: **sage-4.7.alpha5**

_Issue created by migration from https://trac.sagemath.org/ticket/9094_





---

archive/issue_events_114784.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-05-30T08:45:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "milestone_number": null,
    "milestone_title": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114784"
}
```



---

archive/issue_events_114785.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-05-30T08:45:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "c: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114785"
}
```



---

archive/issue_events_114786.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-05-30T08:45:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114786"
}
```



---

archive/issue_events_114787.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-05-30T08:45:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114787"
}
```



---

archive/issue_events_114788.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2010-05-30T08:45:39Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "subject": "https://github.com/robertwb",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114788"
}
```



---

archive/issue_events_114789.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-05-30T09:27:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114789"
}
```



---

archive/issue_events_114790.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-05-30T09:27:55Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "title_is": "is_square and sqrt for polynomials and fraction fields",
    "title_was": "is_square and sqrt for fraction fields",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114790"
}
```



---

archive/issue_comments_075305.json:
```json
{
    "body": "Attachment: **[9094-sqrt.patch.gz](https://github.com/sagemath/sage/files/ticket9094/9094-sqrt.patch.gz)**",
    "created_at": "2010-05-30T09:28:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75305",
    "user": "https://github.com/robertwb"
}
```

Attachment: **[9094-sqrt.patch.gz](https://github.com/sagemath/sage/files/ticket9094/9094-sqrt.patch.gz)**



---

archive/issue_comments_075306.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nLooks good (and useful).  Patch applies fine to 4.4.3.  I tested all sage/rings and had one failure (in a new doctest, on 64-bit ubuntu):\n\n```\nFile \"/storage/jec/sage-4.4.3/devel/sage-tests/sage/rings/polynomial/polynomial_element.pyx\", line 1262:\n    sage: (9 * f^10 * g^4).sqrt() == 3 * f^5 * g^2\nExpected:\n    True\nGot:\n    False\n```\nI have never been happy about doctests using random elements, however deterministic they are supposed to be.\n\nI would have tested for self==0 at the start of the sqrt function, but that case will be caught quickly anyway, so no problem.\n\nI have been working on a patch to add both all= and extend= parameters to the sqrt function for AA and QQbar, having found how awkward it is when the parameters are not uniform across types.  Would it be worth adding an extend= parameter here, even if a NotImplementedError is raised when it is needed (i.e. for sqrt of a non-square when extend=True)?\n\nSo: needs work because of the doctest failure;  up to you whether to do the extend= thing.",
    "created_at": "2010-06-06T19:57:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75306",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:2" align="right">comment:2</div>

Looks good (and useful).  Patch applies fine to 4.4.3.  I tested all sage/rings and had one failure (in a new doctest, on 64-bit ubuntu):

```
File "/storage/jec/sage-4.4.3/devel/sage-tests/sage/rings/polynomial/polynomial_element.pyx", line 1262:
    sage: (9 * f^10 * g^4).sqrt() == 3 * f^5 * g^2
Expected:
    True
Got:
    False
```
I have never been happy about doctests using random elements, however deterministic they are supposed to be.

I would have tested for self==0 at the start of the sqrt function, but that case will be caught quickly anyway, so no problem.

I have been working on a patch to add both all= and extend= parameters to the sqrt function for AA and QQbar, having found how awkward it is when the parameters are not uniform across types.  Would it be worth adding an extend= parameter here, even if a NotImplementedError is raised when it is needed (i.e. for sqrt of a non-square when extend=True)?

So: needs work because of the doctest failure;  up to you whether to do the extend= thing.



---

archive/issue_events_114791.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-06-06T19:57:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114791"
}
```



---

archive/issue_events_114792.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-06-06T19:57:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114792"
}
```



---

archive/issue_comments_075307.json:
```json
{
    "body": "Work Issues: **doctest failure**",
    "created_at": "2010-06-06T19:57:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75307",
    "user": "https://github.com/JohnCremona"
}
```

Work Issues: **doctest failure**



---

archive/issue_comments_075308.json:
```json
{
    "body": "Reviewer: **John Cremona**",
    "created_at": "2010-06-06T19:57:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75308",
    "user": "https://github.com/JohnCremona"
}
```

Reviewer: **John Cremona**



---

archive/issue_comments_075309.json:
```json
{
    "body": "Author: **Robert Bradshaw**",
    "created_at": "2010-06-06T19:57:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75309",
    "user": "https://github.com/JohnCremona"
}
```

Author: **Robert Bradshaw**



---

archive/issue_comments_075310.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nis_square and sqrt can be done generally for fraction fields, given the corresponding functions for the base ring:\n\n```\nis_square (a / b) = is_square (a * b)\nsqrt (a / b) = sqrt (a * b) / b\n```",
    "created_at": "2010-07-07T09:48:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75310",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:5" align="right">comment:5</div>

is_square and sqrt can be done generally for fraction fields, given the corresponding functions for the base ring:

```
is_square (a / b) = is_square (a * b)
sqrt (a / b) = sqrt (a * b) / b
```



---

archive/issue_comments_075311.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nOn sage days 23 we discussed how to make this faster by avoiding factoring in polynomial rings. We are currently implementing this together with the remark of pbruin. When finnished the patch will be added to 9054 because it also fixes some other bugs on that ticket.",
    "created_at": "2010-07-07T14:34:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75311",
    "user": "https://github.com/koffie"
}
```

<div id="comment:7" align="right">comment:7</div>

On sage days 23 we discussed how to make this faster by avoiding factoring in polynomial rings. We are currently implementing this together with the remark of pbruin. When finnished the patch will be added to 9054 because it also fixes some other bugs on that ticket.



---

archive/issue_comments_075312.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Depends on #9093 for correctness.\n+Depends on #9093 and probably also #9129 for correctness.\n``````\n",
    "created_at": "2010-07-08T18:06:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75312",
    "user": "https://github.com/koffie"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Depends on #9093 for correctness.
+Depends on #9093 and probably also #9129 for correctness.
``````




---

archive/issue_comments_075313.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThis patch also leaks memory, probably because of bug #9129\n\n```\nt=get_memory_usage()\nPr.<x>=ZZ[]\nfor i in range(500):\n    C=((x^2+1)*x+1)\n    B=C^2\n    print \"memusage\", get_memory_usage(t)\n    time x=B.sqrt()\n```\nexecuting the above gives:\n\n```\nmemusage 0.0\nTime: CPU 0.00 s, Wall: 0.00 s\nmemusage 0.0\nTime: CPU 0.00 s, Wall: 0.00 s\nmemusage 0.0\nTime: CPU 0.00 s, Wall: 0.00 s\nmemusage 0.0\nTime: CPU 0.00 s, Wall: 0.00 s\nmemusage 0.0\nTime: CPU 0.02 s, Wall: 0.02 s\nmemusage 1.20703125\nTime: CPU 0.18 s, Wall: 0.19 s\nmemusage 23.79296875\nTime: CPU 2.33 s, Wall: 2.36 s\nmemusage 148.12890625\nTime: CPU 31.70 s, Wall: 32.24 s\nmemusage 1534.01171875\n^C\n^C\n```\n\nPs. if you want to check this, please don't let the loop run as long as I did ;). It might make your computer on the edge of crashing",
    "created_at": "2010-07-08T18:12:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75313",
    "user": "https://github.com/koffie"
}
```

<div id="comment:9" align="right">comment:9</div>

This patch also leaks memory, probably because of bug #9129

```
t=get_memory_usage()
Pr.<x>=ZZ[]
for i in range(500):
    C=((x^2+1)*x+1)
    B=C^2
    print "memusage", get_memory_usage(t)
    time x=B.sqrt()
```
executing the above gives:

```
memusage 0.0
Time: CPU 0.00 s, Wall: 0.00 s
memusage 0.0
Time: CPU 0.00 s, Wall: 0.00 s
memusage 0.0
Time: CPU 0.00 s, Wall: 0.00 s
memusage 0.0
Time: CPU 0.00 s, Wall: 0.00 s
memusage 0.0
Time: CPU 0.02 s, Wall: 0.02 s
memusage 1.20703125
Time: CPU 0.18 s, Wall: 0.19 s
memusage 23.79296875
Time: CPU 2.33 s, Wall: 2.36 s
memusage 148.12890625
Time: CPU 31.70 s, Wall: 32.24 s
memusage 1534.01171875
^C
^C
```

Ps. if you want to check this, please don't let the loop run as long as I did ;). It might make your computer on the edge of crashing



---

archive/issue_comments_075314.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI just added a patch which should fix this also. It does it in a slightly different way. The sqrt() functions just are using the is_square(root=True) functionality (one should not have two square root finding algorithms in parralel). Also the sqrt() function has now the optional parameter extend. The is_square() function now also uses the trick mentioned by Peter the Bruin which is very general as it should be in this general base class.\n\nThe patch should be installed aplied to 4.4.4 instead of the other patch.",
    "created_at": "2010-07-17T10:03:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75314",
    "user": "https://github.com/koffie"
}
```

<div id="comment:10" align="right">comment:10</div>

I just added a patch which should fix this also. It does it in a slightly different way. The sqrt() functions just are using the is_square(root=True) functionality (one should not have two square root finding algorithms in parralel). Also the sqrt() function has now the optional parameter extend. The is_square() function now also uses the trick mentioned by Peter the Bruin which is very general as it should be in this general base class.

The patch should be installed aplied to 4.4.4 instead of the other patch.



---

archive/issue_events_114793.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2010-07-17T10:03:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114793"
}
```



---

archive/issue_events_114794.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2010-07-17T10:03:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114794"
}
```



---

archive/issue_comments_075315.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Depends on #9093 and probably also #9129 for correctness.\n+Implement is_square and sqrt for polynomials and fraction fields.\n``````\n",
    "created_at": "2010-07-17T11:34:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75315",
    "user": "https://github.com/mstreng"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Depends on #9093 and probably also #9129 for correctness.
+Implement is_square and sqrt for polynomials and fraction fields.
``````




---

archive/issue_events_114795.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2010-07-17T11:34:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114795"
}
```



---

archive/issue_events_114796.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2010-07-17T11:34:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114796"
}
```



---

archive/issue_comments_075316.json:
```json
{
    "body": "Changed work issues from **doctest failure** to **improve documentation, add more tests**",
    "created_at": "2010-07-17T11:34:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75316",
    "user": "https://github.com/mstreng"
}
```

Changed work issues from **doctest failure** to **improve documentation, add more tests**



---

archive/issue_comments_075317.json:
```json
{
    "body": "Changed reviewer from **John Cremona** to **mstreng**",
    "created_at": "2010-07-17T11:34:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75317",
    "user": "https://github.com/mstreng"
}
```

Changed reviewer from **John Cremona** to **mstreng**



---

archive/issue_events_114797.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2010-07-17T11:34:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114797"
}
```



---

archive/issue_events_114798.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2010-07-17T11:34:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114798"
}
```



---

archive/issue_comments_075318.json:
```json
{
    "body": "Changed author from **Robert Bradshaw** to **mderickx**",
    "created_at": "2010-07-17T11:34:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75318",
    "user": "https://github.com/mstreng"
}
```

Changed author from **Robert Bradshaw** to **mderickx**



---

archive/issue_comments_075319.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nLooks good. No time for a complete review right now, but here are some remarks:\n\n* Check spelling of your documentation, you probably don't mean \"wether\" (=castrated sheep), but \"whether\" (spell checker doesn't help that much here). \"Requiered\" has one \"e\" too much.\n\n* Illustrate is_square(root = True) for the user by providing a square example and a non-square example.\n\n* The internal variable name ``is_sqrt`` is confusing, remove the \"t\".\n\n* You write \"This code is quite general, it could even be implemented for all integral domains as soon as they have the is_square(root=True) option\", don't you mean \"This code is quite general, it works for all integral domains that have the is_square(root = True) option\"?\n\n* I think sqrt(self, extend = True, all = False, name=None ) should have tests of all combinations of options and squareness, i.e: sq/non-sq, extend True/False, all True/False = 2*2*2 = at least 8 examples. The extend=True for a non-square should also have examples with name=None and name=something.\n\n* Perhaps include examples for more base fields?\n\n* consider adding a few more spaces for readability thougout, e.g. around \"=\"\n\n* \"if root==True:\", why not write \"if root:\"?",
    "created_at": "2010-07-17T11:34:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75319",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:11" align="right">comment:11</div>

Looks good. No time for a complete review right now, but here are some remarks:

* Check spelling of your documentation, you probably don't mean "wether" (=castrated sheep), but "whether" (spell checker doesn't help that much here). "Requiered" has one "e" too much.

* Illustrate is_square(root = True) for the user by providing a square example and a non-square example.

* The internal variable name ``is_sqrt`` is confusing, remove the "t".

* You write "This code is quite general, it could even be implemented for all integral domains as soon as they have the is_square(root=True) option", don't you mean "This code is quite general, it works for all integral domains that have the is_square(root = True) option"?

* I think sqrt(self, extend = True, all = False, name=None ) should have tests of all combinations of options and squareness, i.e: sq/non-sq, extend True/False, all True/False = 2*2*2 = at least 8 examples. The extend=True for a non-square should also have examples with name=None and name=something.

* Perhaps include examples for more base fields?

* consider adding a few more spaces for readability thougout, e.g. around "="

* "if root==True:", why not write "if root:"?



---

archive/issue_comments_075320.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI changed all you asked for except for \"Perhaps include examples for more base fields?\". Time for another review :)",
    "created_at": "2010-07-17T14:33:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75320",
    "user": "https://github.com/koffie"
}
```

<div id="comment:12" align="right">comment:12</div>

I changed all you asked for except for "Perhaps include examples for more base fields?". Time for another review :)



---

archive/issue_events_114799.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2010-07-17T14:33:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114799"
}
```



---

archive/issue_events_114800.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2010-07-17T14:33:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114800"
}
```



---

archive/issue_comments_075321.json:
```json
{
    "body": "Changed author from **mderickx** to **Robert Bradshaw, Maarten Derickx**",
    "created_at": "2010-07-18T09:48:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75321",
    "user": "https://github.com/mstreng"
}
```

Changed author from **mderickx** to **Robert Bradshaw, Maarten Derickx**



---

archive/issue_comments_075322.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nfraction_field_element.pyx, line 326 \"_parent\" --> \"parent()\" (don't use a hidden variable, use the function that returns its value)\n\npolynomial_ring_element.pyx, line 1306, \"#This code is quite general, it works for all integral domains that have the is_square(root = True) option\"\n- This comment is confusing: does \"all integral domains that...\" refer to self.parent() or to self.parent().base_ring()? Why not just remove this comment?\n- Are you proposing to move the code to are more general class of ring elements? Then why not just do that? Right now, you have the same code for fraction fields and polynomial rings, but you could just put it in a more general class and add a test if self.parent() is a domain and \"self.is_square()\" exists and has a parameter \"root\". (You don't have to do this to get a positive review, but you can think about it and/or try it)\n\n(for both files:) It is helpful for others if the documentation of sqrt says how square roots are computed, i.e. says \"Calls is_square(root = True) to find the square root\". This can be done in an \"ALGORITHM:\" block. \n\nBuild the documentation using \"sage -docbuild reference html\" to test the following yourself:\n- the input, output, and examples blocks of lines 1260, 1265, and 1269 of sqrt for Polynomial don't indent and don't format nicely. All this needs is an extra empty line after the mentioned lines. See for example the is_square documentation.\n- same for the input and output blocks of sqrt for fraction field elements on lines 336 and 341.",
    "created_at": "2010-07-18T09:48:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75322",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:13" align="right">comment:13</div>

fraction_field_element.pyx, line 326 "_parent" --> "parent()" (don't use a hidden variable, use the function that returns its value)

polynomial_ring_element.pyx, line 1306, "#This code is quite general, it works for all integral domains that have the is_square(root = True) option"
- This comment is confusing: does "all integral domains that..." refer to self.parent() or to self.parent().base_ring()? Why not just remove this comment?
- Are you proposing to move the code to are more general class of ring elements? Then why not just do that? Right now, you have the same code for fraction fields and polynomial rings, but you could just put it in a more general class and add a test if self.parent() is a domain and "self.is_square()" exists and has a parameter "root". (You don't have to do this to get a positive review, but you can think about it and/or try it)

(for both files:) It is helpful for others if the documentation of sqrt says how square roots are computed, i.e. says "Calls is_square(root = True) to find the square root". This can be done in an "ALGORITHM:" block. 

Build the documentation using "sage -docbuild reference html" to test the following yourself:
- the input, output, and examples blocks of lines 1260, 1265, and 1269 of sqrt for Polynomial don't indent and don't format nicely. All this needs is an extra empty line after the mentioned lines. See for example the is_square documentation.
- same for the input and output blocks of sqrt for fraction field elements on lines 336 and 341.



---

archive/issue_comments_075323.json:
```json
{
    "body": "Changed reviewer from **mstreng** to **John Cremona, Marco Streng**",
    "created_at": "2010-07-18T09:48:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75323",
    "user": "https://github.com/mstreng"
}
```

Changed reviewer from **mstreng** to **John Cremona, Marco Streng**



---

archive/issue_events_114801.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2010-07-18T09:48:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114801"
}
```



---

archive/issue_events_114802.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2010-07-18T09:48:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114802"
}
```



---

archive/issue_comments_075324.json:
```json
{
    "body": "Changed work issues from **improve documentation, add more tests** to **documentation, double code**",
    "created_at": "2010-07-18T09:48:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75324",
    "user": "https://github.com/mstreng"
}
```

Changed work issues from **improve documentation, add more tests** to **documentation, double code**



---

archive/issue_comments_075325.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThe \"This code is quite general\" comment did what it had to do. I put it there in the hope that someone would come with a suggestion like you did. I had the feeling that the dubble code could be removed in a nice and general way, but I didn't know how. So by what you say I should just move the code to a more general class and then it will also work for fraction fields and polynomial rings (and possibly even more rings). What would be this more general class and where to find it?\n\nsage/rings/ring_element.py has only one line of code:\n\n```\n\nfrom sage.structure.element import !RingElement, is_RingElement\n\n```\n\nSo should I add it to the\u00a0RingElement\u00a0class thats imported from\u00a0sage.structure.element?",
    "created_at": "2010-07-18T11:00:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75325",
    "user": "https://github.com/koffie"
}
```

<div id="comment:14" align="right">comment:14</div>

The "This code is quite general" comment did what it had to do. I put it there in the hope that someone would come with a suggestion like you did. I had the feeling that the dubble code could be removed in a nice and general way, but I didn't know how. So by what you say I should just move the code to a more general class and then it will also work for fraction fields and polynomial rings (and possibly even more rings). What would be this more general class and where to find it?

sage/rings/ring_element.py has only one line of code:

```

from sage.structure.element import !RingElement, is_RingElement

```

So should I add it to the RingElement class thats imported from sage.structure.element?



---

archive/issue_comments_075326.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nIn the sage reference manual [http://www.sagemath.org/doc/reference/](http://www.sagemath.org/doc/reference/), you can search for a class and then click on its base classes. It appears that the least general common base class is sage.structure.element.CommutativeRingElement, which in turn extends sage.structure.element.RingElement. As your implementation is for domains only, you should put it in CommutativeRingElement.\n\nYou can start your code by checking hasattr(self, 'is_square'). I don't know how to check if the function self.is_square has a keyword argument 'root' other than using try. You should try to catch \"TypeError: is_square() got an unexpected keyword argument 'root'\" and raise NotImplementedError, \"Please implement is_square with option 'root = True' for objects of type %s\" % type(self)\n\nMost importantly, check if there is no subclass of CommutativeRingElement that implements is_square by calling sqrt ;p",
    "created_at": "2010-07-18T13:20:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75326",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:15" align="right">comment:15</div>

In the sage reference manual [http://www.sagemath.org/doc/reference/](http://www.sagemath.org/doc/reference/), you can search for a class and then click on its base classes. It appears that the least general common base class is sage.structure.element.CommutativeRingElement, which in turn extends sage.structure.element.RingElement. As your implementation is for domains only, you should put it in CommutativeRingElement.

You can start your code by checking hasattr(self, 'is_square'). I don't know how to check if the function self.is_square has a keyword argument 'root' other than using try. You should try to catch "TypeError: is_square() got an unexpected keyword argument 'root'" and raise NotImplementedError, "Please implement is_square with option 'root = True' for objects of type %s" % type(self)

Most importantly, check if there is no subclass of CommutativeRingElement that implements is_square by calling sqrt ;p



---

archive/issue_comments_075327.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nactually, instead of CommutativeRingElement, I guess RingElement is fine as well, as long as all = True raises a NotImplementedError",
    "created_at": "2010-07-18T13:51:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75327",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:16" align="right">comment:16</div>

actually, instead of CommutativeRingElement, I guess RingElement is fine as well, as long as all = True raises a NotImplementedError



---

archive/issue_comments_075328.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nCatching a specific\u00a0TypeError\u00a0isn't possible apparently.\n\n```\n\ntry:\n\n\u00a0\u00a0 \u00a0raise !TypeError(\"sqrt() got an unexpected keyword argument 'root'\")\n\nexcept !TypeError(\"sqrt() got an unexpected keyword argument 'root'\"):\n\n\u00a0\u00a0 \u00a0print \"lol\"\n\n```\n\ngives as output\n\n```\n\n|| {{{\nTraceback (click to the left of this block for traceback)\n...\nTypeError: sqrt() got an unexpected keyword argument 'root'\n}}} ||\n\n\n```\n\nbut a new version is on it's way wich just catches all typeerrors",
    "created_at": "2010-07-18T19:11:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75328",
    "user": "https://github.com/koffie"
}
```

<div id="comment:17" align="right">comment:17</div>

Catching a specific TypeError isn't possible apparently.

```

try:

    raise !TypeError("sqrt() got an unexpected keyword argument 'root'")

except !TypeError("sqrt() got an unexpected keyword argument 'root'"):

    print "lol"

```

gives as output

```

|| {{{
Traceback (click to the left of this block for traceback)
...
TypeError: sqrt() got an unexpected keyword argument 'root'
}}} ||


```

but a new version is on it's way wich just catches all typeerrors



---

archive/issue_comments_075329.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nYour\u00a0e.blablablah remark worked so I do the catching in that way now.\u00a0\n\nI decided to go for the commutative ring element class and I already implemented it there. If you think general ring elements is nicer you can put it there if you want (shouldn't be to much work, just some extra checking needed I guess). Upload comming in a few minutes.",
    "created_at": "2010-07-18T20:03:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75329",
    "user": "https://github.com/koffie"
}
```

<div id="comment:18" align="right">comment:18</div>

Your e.blablablah remark worked so I do the catching in that way now. 

I decided to go for the commutative ring element class and I already implemented it there. If you think general ring elements is nicer you can put it there if you want (shouldn't be to much work, just some extra checking needed I guess). Upload comming in a few minutes.



---

archive/issue_comments_075330.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nHej Marco,\n\nI was already finnished when I read your last comment. Your suggestion last suggestion makes it slightly faster I guess. But I think the code is ok like it is now. I'm leaving for a holliday tomorrow and still got stuff to do, so I hope the patch is ok as it is now and else it will have to wait.",
    "created_at": "2010-07-18T20:19:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75330",
    "user": "https://github.com/koffie"
}
```

<div id="comment:19" align="right">comment:19</div>

Hej Marco,

I was already finnished when I read your last comment. Your suggestion last suggestion makes it slightly faster I guess. But I think the code is ok like it is now. I'm leaving for a holliday tomorrow and still got stuff to do, so I hope the patch is ok as it is now and else it will have to wait.



---

archive/issue_events_114803.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2010-07-18T20:59:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114803"
}
```



---

archive/issue_events_114804.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2010-07-18T20:59:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114804"
}
```



---

archive/issue_events_114805.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2010-07-20T23:02:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114805"
}
```



---

archive/issue_events_114806.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2010-07-20T23:02:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114806"
}
```



---

archive/issue_comments_075331.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nOn line 1903 you check if the message is \"is_square() got an unexpected keyword argument 'root'\", but you should also check for \"is_square() takes no keyword arguments\", which happens for 5.sqrt(root = True). This behaviour should have a good doctest.\n\nAfter catching a ValueError, line 1904 says:\n\nraise NotImplementedError(\"Please implement is_square with option 'root = True' for %s\" % type(self))\n\nThe ValueError may have been raised by another object than self. For example, if self has an is_square(root = True), but calls b.is_square(root = root) of another object b. In that case, this message is misleading: it says that self.is_square(root = True) should be implemented, while it is already well implemented and it is in fact b.is_square(root = True) that should be implemented. You can replace the message by the following:\n\nraise NotImplementedError(\"Please implement sqrt() for objects of type %s\" % type(self))\n\nCan you get examples where these errors are raised and add them to the doctests?\n\nAlternatively, you can either\n\n* make sure \"is_square\" exists for CommutativeRingElement and \"is_square\" has a keyword argument \"root\" for every subclass of CommutativeRingElement (you'll be writing NotImplementedError a lot :) and should check for tickets that implement the root = True behaviour). This seems to be a lot more stable than the current approach.\n\n* or bring back the double-code version with the same sqrt() function in two distinct classes.",
    "created_at": "2010-07-20T23:02:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75331",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:21" align="right">comment:21</div>

On line 1903 you check if the message is "is_square() got an unexpected keyword argument 'root'", but you should also check for "is_square() takes no keyword arguments", which happens for 5.sqrt(root = True). This behaviour should have a good doctest.

After catching a ValueError, line 1904 says:

raise NotImplementedError("Please implement is_square with option 'root = True' for %s" % type(self))

The ValueError may have been raised by another object than self. For example, if self has an is_square(root = True), but calls b.is_square(root = root) of another object b. In that case, this message is misleading: it says that self.is_square(root = True) should be implemented, while it is already well implemented and it is in fact b.is_square(root = True) that should be implemented. You can replace the message by the following:

raise NotImplementedError("Please implement sqrt() for objects of type %s" % type(self))

Can you get examples where these errors are raised and add them to the doctests?

Alternatively, you can either

* make sure "is_square" exists for CommutativeRingElement and "is_square" has a keyword argument "root" for every subclass of CommutativeRingElement (you'll be writing NotImplementedError a lot :) and should check for tickets that implement the root = True behaviour). This seems to be a lot more stable than the current approach.

* or bring back the double-code version with the same sqrt() function in two distinct classes.



---

archive/issue_comments_075332.json:
```json
{
    "body": "Changed work issues from **documentation, double code** to **catching the right errors**",
    "created_at": "2010-07-20T23:02:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75332",
    "user": "https://github.com/mstreng"
}
```

Changed work issues from **documentation, double code** to **catching the right errors**



---

archive/issue_comments_075333.json:
```json
{
    "body": "Changed work issues from **catching the right errors** to **make general sqrt compatible with lazy reals, or go back to double code**",
    "created_at": "2010-07-22T12:27:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75333",
    "user": "https://github.com/mstreng"
}
```

Changed work issues from **catching the right errors** to **make general sqrt compatible with lazy reals, or go back to double code**



---

archive/issue_comments_075334.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nAre you sure you did a complete doctest of sage before submitting the patch?\n\n```\nsage: QuadraticField(2, 'a')\nNotImplementedError: Please implement is_square with option 'root = True' for <type 'sage.rings.real_lazy.LazyWrapper'>\n```\nThe problem is in RLF(2).sqrt()\n\n```\nsage: RLF(2).sqrt()\nNotImplementedError: Please implement is_square with option 'root = True' for <type 'sage.rings.real_lazy.LazyWrapper'>\n```\n\nRLF(2) is a LazyWrapper, which doesn't have a sqrt attribute, but simulates one via `__getattr__` (line 631 of sage/rings/real_lazy.pyx). But LazyWrapper extends (via some other classes) CommutativeRingElement, so that now it does have an attribute sqrt (your sqrt function), which means the `__getattr__` of LazyWrapper doesn't get a chance. Your sqrt function then complains about the non-existence of is_square with root = 'True'.\n\nYou can probably fix this by making a sqrt function for LazyWrapper that calls LazyNamedUnop(self._parent, self, 'sqrt'). Or you can follow your own advice: \"implement is_square with option 'root = True' for ....\". Maybe there is a better way, you can also ask one of the mailing lists. Alternatively, you can always go back to your double code.\n\nAnyway, every time before submitting a patch, do everything that a reviewer would do, including a full doctest of all of Sage:\n[http://www.sagemath.org/doc/developer/walk_through.html#reviewing-a-patch](http://www.sagemath.org/doc/developer/walk_through.html#reviewing-a-patch)\nOn a multi-core machine, you can speed up the doctest by using\n`./sage -tp 4 -long devel/sage-main/`\nwhere 4 is replaced by the number of cores you are willing to use.",
    "created_at": "2010-07-22T12:27:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75334",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:22" align="right">comment:22</div>

Are you sure you did a complete doctest of sage before submitting the patch?

```
sage: QuadraticField(2, 'a')
NotImplementedError: Please implement is_square with option 'root = True' for <type 'sage.rings.real_lazy.LazyWrapper'>
```
The problem is in RLF(2).sqrt()

```
sage: RLF(2).sqrt()
NotImplementedError: Please implement is_square with option 'root = True' for <type 'sage.rings.real_lazy.LazyWrapper'>
```

RLF(2) is a LazyWrapper, which doesn't have a sqrt attribute, but simulates one via `__getattr__` (line 631 of sage/rings/real_lazy.pyx). But LazyWrapper extends (via some other classes) CommutativeRingElement, so that now it does have an attribute sqrt (your sqrt function), which means the `__getattr__` of LazyWrapper doesn't get a chance. Your sqrt function then complains about the non-existence of is_square with root = 'True'.

You can probably fix this by making a sqrt function for LazyWrapper that calls LazyNamedUnop(self._parent, self, 'sqrt'). Or you can follow your own advice: "implement is_square with option 'root = True' for ....". Maybe there is a better way, you can also ask one of the mailing lists. Alternatively, you can always go back to your double code.

Anyway, every time before submitting a patch, do everything that a reviewer would do, including a full doctest of all of Sage:
[http://www.sagemath.org/doc/developer/walk_through.html#reviewing-a-patch](http://www.sagemath.org/doc/developer/walk_through.html#reviewing-a-patch)
On a multi-core machine, you can speed up the doctest by using
`./sage -tp 4 -long devel/sage-main/`
where 4 is replaced by the number of cores you are willing to use.



---

archive/issue_comments_075335.json:
```json
{
    "body": "Attachment: **[trac_9094-sqrt-mderickx.2.patch.gz](https://github.com/sagemath/sage/files/ticket9094/trac_9094-sqrt-mderickx.2.patch.gz)**",
    "created_at": "2011-03-22T01:09:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75335",
    "user": "https://github.com/koffie"
}
```

Attachment: **[trac_9094-sqrt-mderickx.2.patch.gz](https://github.com/sagemath/sage/files/ticket9094/trac_9094-sqrt-mderickx.2.patch.gz)**



---

archive/issue_comments_075336.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nOnly apply: trac_9094-sqrt-mderickx.2.patch",
    "created_at": "2011-03-22T01:11:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75336",
    "user": "https://github.com/koffie"
}
```

<div id="comment:23" align="right">comment:23</div>

Only apply: trac_9094-sqrt-mderickx.2.patch



---

archive/issue_comments_075337.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n Implement is_square and sqrt for polynomials and fraction fields.\n+\n+Only apply: trac_9094-sqrt-mderickx.2.patch\n``````\n",
    "created_at": "2011-03-22T01:11:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75337",
    "user": "https://github.com/koffie"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 Implement is_square and sqrt for polynomials and fraction fields.
+
+Only apply: trac_9094-sqrt-mderickx.2.patch
``````




---

archive/issue_events_114807.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-03-22T01:11:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114807"
}
```



---

archive/issue_events_114808.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-03-22T01:11:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114808"
}
```



---

archive/issue_comments_075338.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nSince you told me you're going to rewrite the patch, I'm holding off on doctesting. Three short comments:\n\nin structure/element.pyx\n\n\n1) Line 1920 (): true --> True\n\n\n2) Line 2002 (): all=False = all=True\n\n3) The memory leak (from comment [#9](https://github.com/sagemath/sage/issues/9094#comment:9)) is no leak after all. Note that you replace x in each iteration by C. If one doesn't do that, memory usage in each iteration is 0.0. :)",
    "created_at": "2011-03-22T05:15:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75338",
    "user": "https://github.com/mminzlaff"
}
```

<div id="comment:25" align="right">comment:25</div>

Since you told me you're going to rewrite the patch, I'm holding off on doctesting. Three short comments:

in structure/element.pyx


1) Line 1920 (): true --> True


2) Line 2002 (): all=False = all=True

3) The memory leak (from comment [#9](https://github.com/sagemath/sage/issues/9094#comment:9)) is no leak after all. Note that you replace x in each iteration by C. If one doesn't do that, memory usage in each iteration is 0.0. :)



---

archive/issue_events_114809.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2011-03-22T05:15:26Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "subject": "https://github.com/mminzlaff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114809"
}
```



---

archive/issue_events_114810.json:
```json
{
    "actor": "https://github.com/mminzlaff",
    "created_at": "2011-03-22T05:15:26Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "subject": "https://github.com/mminzlaff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114810"
}
```



---

archive/issue_events_114811.json:
```json
{
    "actor": "https://github.com/mminzlaff",
    "created_at": "2011-03-22T05:22:06Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "subject": "https://github.com/mminzlaff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114811"
}
```



---

archive/issue_events_114812.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2011-03-22T05:22:06Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "subject": "https://github.com/mminzlaff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114812"
}
```



---

archive/issue_events_114813.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-03-22T05:56:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114813"
}
```



---

archive/issue_events_114814.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-03-22T05:56:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114814"
}
```



---

archive/issue_comments_075339.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\n* is_square for fraction field elements now always computes a root, even if it's not needed. This can be quite expensive. \n\n  * Why are you writing boilerplate wrappers for all of LazyNamedUnop? Just do is_square and sqrt if need be. \n\n  * Using _parent is just fine, especially for subclasses. No need to incur the extra expense of a method call.",
    "created_at": "2011-03-22T05:56:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75339",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:27" align="right">comment:27</div>

* is_square for fraction field elements now always computes a root, even if it's not needed. This can be quite expensive. 

  * Why are you writing boilerplate wrappers for all of LazyNamedUnop? Just do is_square and sqrt if need be. 

  * Using _parent is just fine, especially for subclasses. No need to incur the extra expense of a method call.



---

archive/issue_comments_075340.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@robertwb](#comment:27):\n> * is_square for fraction field elements now always computes a root, even if it's not needed. This can be quite expensive. \n\nIndeed, it should use `root=root` instead of `root=True`\n\n> \n> * Why are you writing boilerplate wrappers for all of LazyNamedUnop? Just do is_square and sqrt if need be. \n\nHi Robert,\n\nI can answer this question. This was [a discussion on sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/441948aa73d1c49f). 4 options were discussed for dealing with these unitary operators for lazy numbers.\n\nA) leaving them as they were\n\nB) hard-coding them (as Maarten just did)\n\nC) \"fixing LazyNamedUnop to preserve documentation\"\n\nD) \"populating these methods at class creation time\n(rather than attribute lookup time, perhaps dynamically creating a\ndocstring for them)\"\n\nOption A was discarded: it lacks tab completion, and (as we saw in this ticket) leads to a big mess and a lot of confusion when a base class such as RingElement gets a default implementation for one of these unitary operators.\n\nOptions C and D were suggested by you, but you seemed to be the only one in the discussion who knew how to do them. Maarten said he was interested in them, and then nothing happened for months.\n\nSo I guess that in the end Maarten implemented the only remaining option, which leads to stable, transparent, understandable code that is unfortunately a bit long.\n\nI think the extra time that Sage developers will need when extending or changing Maarten's long list of similar methods is not too bad if you compare it to the time that Sage developers will need when trying to understand more complicated code and having to debug it if something unforeseen happens. But that's just my opinion.\n\n+1 from me for the way Maarten implemented it.\n\n> \n> * Using _parent is just fine, especially for subclasses. No need to incur the extra expense of a method call. \n\nAre there general guidelines for this? I can imagine `_parent` to be faster, but `parent()` to be more stable in case creative implementations are in base classes.",
    "created_at": "2011-03-22T12:27:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75340",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@robertwb](#comment:27):
> * is_square for fraction field elements now always computes a root, even if it's not needed. This can be quite expensive. 

Indeed, it should use `root=root` instead of `root=True`

> 
> * Why are you writing boilerplate wrappers for all of LazyNamedUnop? Just do is_square and sqrt if need be. 

Hi Robert,

I can answer this question. This was [a discussion on sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/441948aa73d1c49f). 4 options were discussed for dealing with these unitary operators for lazy numbers.

A) leaving them as they were

B) hard-coding them (as Maarten just did)

C) "fixing LazyNamedUnop to preserve documentation"

D) "populating these methods at class creation time
(rather than attribute lookup time, perhaps dynamically creating a
docstring for them)"

Option A was discarded: it lacks tab completion, and (as we saw in this ticket) leads to a big mess and a lot of confusion when a base class such as RingElement gets a default implementation for one of these unitary operators.

Options C and D were suggested by you, but you seemed to be the only one in the discussion who knew how to do them. Maarten said he was interested in them, and then nothing happened for months.

So I guess that in the end Maarten implemented the only remaining option, which leads to stable, transparent, understandable code that is unfortunately a bit long.

I think the extra time that Sage developers will need when extending or changing Maarten's long list of similar methods is not too bad if you compare it to the time that Sage developers will need when trying to understand more complicated code and having to debug it if something unforeseen happens. But that's just my opinion.

+1 from me for the way Maarten implemented it.

> 
> * Using _parent is just fine, especially for subclasses. No need to incur the extra expense of a method call. 

Are there general guidelines for this? I can imagine `_parent` to be faster, but `parent()` to be more stable in case creative implementations are in base classes.



---

archive/issue_comments_075341.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nNew file added Only apply: trac_9094-sqrt-mderickx.patch\n\nIt's RLF is now boiler plate code free, works with tab completion and works with inheritance thanks to Thomas Kluiver here at sage days since he told me how to do it :).\n\nAlso added the other suggestions. Hopefully finally a final version??",
    "created_at": "2011-03-22T16:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75341",
    "user": "https://github.com/koffie"
}
```

<div id="comment:29" align="right">comment:29</div>

New file added Only apply: trac_9094-sqrt-mderickx.patch

It's RLF is now boiler plate code free, works with tab completion and works with inheritance thanks to Thomas Kluiver here at sage days since he told me how to do it :).

Also added the other suggestions. Hopefully finally a final version??



---

archive/issue_events_114815.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-03-22T16:29:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114815"
}
```



---

archive/issue_events_114816.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-03-22T16:29:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114816"
}
```



---

archive/issue_comments_075342.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n Implement is_square and sqrt for polynomials and fraction fields.\n \n-Only apply: trac_9094-sqrt-mderickx.2.patch\n+Only apply: trac_9094-sqrt-mderickx.patch\n``````\n",
    "created_at": "2011-03-22T16:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75342",
    "user": "https://github.com/koffie"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 Implement is_square and sqrt for polynomials and fraction fields.
 
-Only apply: trac_9094-sqrt-mderickx.2.patch
+Only apply: trac_9094-sqrt-mderickx.patch
``````




---

archive/issue_comments_075343.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nHi Maarten, could you add a doctest to `__dir__` so that doctest coverage goes up instead of down? Just something simple like\n\n```\nsage: \"log\" in RLF(sqrt(8)).__dir__()\nTrue\n```",
    "created_at": "2011-03-22T17:05:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75343",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:30" align="right">comment:30</div>

Hi Maarten, could you add a doctest to `__dir__` so that doctest coverage goes up instead of down? Just something simple like

```
sage: "log" in RLF(sqrt(8)).__dir__()
True
```



---

archive/issue_comments_075344.json:
```json
{
    "body": "A patch instead of the other one, which I ofcourse think is better ;)",
    "created_at": "2011-03-22T17:24:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75344",
    "user": "https://github.com/koffie"
}
```

A patch instead of the other one, which I ofcourse think is better ;)



---

archive/issue_comments_075345.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nAttachment: **[trac_9094-sqrt-mderickx.patch.gz](https://github.com/sagemath/sage/files/ticket9094/trac_9094-sqrt-mderickx.patch.gz)**\n\nDone :)",
    "created_at": "2011-03-22T17:26:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75345",
    "user": "https://github.com/koffie"
}
```

<div id="comment:31" align="right">comment:31</div>

Attachment: **[trac_9094-sqrt-mderickx.patch.gz](https://github.com/sagemath/sage/files/ticket9094/trac_9094-sqrt-mderickx.patch.gz)**

Done :)



---

archive/issue_events_114817.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-03-22T19:05:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114817"
}
```



---

archive/issue_events_114818.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-03-22T19:05:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114818"
}
```



---

archive/issue_comments_075346.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nLooks good.",
    "created_at": "2011-03-22T19:05:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75346",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:32" align="right">comment:32</div>

Looks good.



---

archive/issue_comments_075347.json:
```json
{
    "body": "Changed reviewer from **John Cremona, Marco Streng** to **John Cremona, Marco Streng, Robert Bradshaw**",
    "created_at": "2011-03-22T22:37:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75347",
    "user": "https://github.com/mstreng"
}
```

Changed reviewer from **John Cremona, Marco Streng** to **John Cremona, Marco Streng, Robert Bradshaw**



---

archive/issue_comments_075348.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n Implement is_square and sqrt for polynomials and fraction fields.\n \n-Only apply: trac_9094-sqrt-mderickx.patch\n+Only apply: [attachment: trac_9094-sqrt-mderickx.patch](https://github.com/sagemath/sage/files/ticket9094/trac_9094-sqrt-mderickx.patch.gz)\n``````\n",
    "created_at": "2011-04-12T08:06:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75348",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 Implement is_square and sqrt for polynomials and fraction fields.
 
-Only apply: trac_9094-sqrt-mderickx.patch
+Only apply: [attachment: trac_9094-sqrt-mderickx.patch](https://github.com/sagemath/sage/files/ticket9094/trac_9094-sqrt-mderickx.patch.gz)
``````




---

archive/issue_comments_075349.json:
```json
{
    "body": "Changed work issues from **make general sqrt compatible with lazy reals, or go back to double code** to none",
    "created_at": "2011-04-12T08:06:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75349",
    "user": "https://github.com/jdemeyer"
}
```

Changed work issues from **make general sqrt compatible with lazy reals, or go back to double code** to none



---

archive/issue_comments_075350.json:
```json
{
    "body": "Merged: **sage-4.7.alpha5**",
    "created_at": "2011-04-13T07:42:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9094#issuecomment-75350",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.7.alpha5**



---

archive/issue_events_114819.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-13T07:42:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114819"
}
```



---

archive/issue_events_114820.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-13T07:42:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9094",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9094#event-114820"
}
```
