# Issue 9674: fix SBox __init__ (again)

archive/issues_009674.json:
```json
{
    "body": "Revision sage/crypto/mq/sbox.py [11673:11b2f556827a:12294:d7533ae4895e] (explacing log_b() by exact_log()) causes the following problems:\n\n* difference_distribution_matrix() (in crypto/mq/sbox.py) crashes when an n-to-m bit S-box does not contain the element 2<sup>m-1</sup> (the wrong calculation of m results in an array index going out of bounds).\n\n* the statement length != int(length) is never executed, because exact_log() always outputs an integer\n\n\nAssignee: @mwhansen\n\nCC:  @malb\n\nResolution: fixed\n\nAuthor: Yann Laigle-Chapuy\n\nReviewer: Martin Albrecht\n\nMerged: sage-4.6.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/9674\n\n",
    "closed_at": "2010-09-15T11:13:27Z",
    "created_at": "2010-08-03T12:17:53Z",
    "labels": [
        "component: cryptography",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6",
    "title": "fix SBox __init__ (again)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9674",
    "user": "https://trac.sagemath.org/admin/accounts/users/nmouha"
}
```
Revision sage/crypto/mq/sbox.py [11673:11b2f556827a:12294:d7533ae4895e] (explacing log_b() by exact_log()) causes the following problems:

* difference_distribution_matrix() (in crypto/mq/sbox.py) crashes when an n-to-m bit S-box does not contain the element 2<sup>m-1</sup> (the wrong calculation of m results in an array index going out of bounds).

* the statement length != int(length) is never executed, because exact_log() always outputs an integer


Assignee: @mwhansen

CC:  @malb

Resolution: fixed

Author: Yann Laigle-Chapuy

Reviewer: Martin Albrecht

Merged: sage-4.6.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/9674





---

archive/issue_comments_093844.json:
```json
{
    "body": "<a id='comment:1'></a>Does ticket #9366 fix your problem?",
    "created_at": "2010-08-07T13:01:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9674#issuecomment-93844",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

<a id='comment:1'></a>Does ticket #9366 fix your problem?



---

archive/issue_comments_093845.json:
```json
{
    "body": "<a id='comment:2'></a>Replying to [comment:1 ylchapuy]:\n> Does ticket #9366 fix your problem?\n\n\nThank you for looking into this. You patch fixes the second bullet point. But the main problem is this line: \"self.n = ZZ(max(S)+1).exact_log(2)\".\n\nTry this, and see what happens:\nS = mq.SBox(5,6,0,3,4,2,1,2);\nS.difference_distribution_matrix();",
    "created_at": "2010-08-07T23:16:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9674#issuecomment-93845",
    "user": "https://trac.sagemath.org/admin/accounts/users/nmouha"
}
```

<a id='comment:2'></a>Replying to [comment:1 ylchapuy]:
> Does ticket #9366 fix your problem?


Thank you for looking into this. You patch fixes the second bullet point. But the main problem is this line: "self.n = ZZ(max(S)+1).exact_log(2)".

Try this, and see what happens:
S = mq.SBox(5,6,0,3,4,2,1,2);
S.difference_distribution_matrix();



---

archive/issue_comments_093846.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-08-08T08:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9674#issuecomment-93846",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

Changing status from new to needs_review.



---

archive/issue_events_024138.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/ylchapuy",
    "created_at": "2010-08-08T08:39:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9674",
    "milestone": "sage-4.5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9674#event-24138"
}
```



---

archive/issue_comments_093847.json:
```json
{
    "body": "<a id='comment:3'></a>You might review the following patch replacing `exact_log` with `nbits`.",
    "created_at": "2010-08-08T08:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9674#issuecomment-93847",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

<a id='comment:3'></a>You might review the following patch replacing `exact_log` with `nbits`.



---

archive/issue_comments_093848.json:
```json
{
    "body": "<a id='comment:4'></a>Your proposed patch fixes the problem. I also think it's a cleaner solution than reversing the patch by mhansen. Thanks for your time.",
    "created_at": "2010-08-08T11:08:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9674#issuecomment-93848",
    "user": "https://trac.sagemath.org/admin/accounts/users/nmouha"
}
```

<a id='comment:4'></a>Your proposed patch fixes the problem. I also think it's a cleaner solution than reversing the patch by mhansen. Thanks for your time.



---

archive/issue_comments_093849.json:
```json
{
    "body": "<a id='comment:5'></a>If you are satisfied with the patch, and checked that all the doctests are still ok, then the procedure is to check the action \"positive review\" (bottom of the ticket page if you are logged in) and add yourself to the reviewers.\nThis allows the release manager to consider the merging of this ticket in the next release.",
    "created_at": "2010-08-09T18:33:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9674#issuecomment-93849",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

<a id='comment:5'></a>If you are satisfied with the patch, and checked that all the doctests are still ok, then the procedure is to check the action "positive review" (bottom of the ticket page if you are logged in) and add yourself to the reviewers.
This allows the release manager to consider the merging of this ticket in the next release.



---

archive/issue_comments_093850.json:
```json
{
    "body": "<a id='comment:6'></a>Maybe Martin will be interrested in reviewing this...",
    "created_at": "2010-08-13T12:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9674#issuecomment-93850",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

<a id='comment:6'></a>Maybe Martin will be interrested in reviewing this...



---

archive/issue_comments_093851.json:
```json
{
    "body": "<a id='comment:7'></a>Patch looks good, doctests pass.",
    "created_at": "2010-08-14T12:58:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9674#issuecomment-93851",
    "user": "https://github.com/malb"
}
```

<a id='comment:7'></a>Patch looks good, doctests pass.



---

archive/issue_comments_093852.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-08-14T12:58:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9674#issuecomment-93852",
    "user": "https://github.com/malb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_093853.json:
```json
{
    "body": "<a id='comment:8'></a>Please put the ticket number in the first line of the patch commit string.",
    "created_at": "2010-08-15T09:01:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9674#issuecomment-93853",
    "user": "https://github.com/qed777"
}
```

<a id='comment:8'></a>Please put the ticket number in the first line of the patch commit string.



---

archive/issue_comments_093854.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2010-08-15T09:01:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9674#issuecomment-93854",
    "user": "https://github.com/qed777"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_093855.json:
```json
{
    "body": "Attachment [trac9674_fix_Sbox_init.patch](tarball://root/attachments/some-uuid/ticket9674/trac9674_fix_Sbox_init.patch) by ylchapuy created at 2010-08-15 11:22:30",
    "created_at": "2010-08-15T11:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9674#issuecomment-93855",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

Attachment [trac9674_fix_Sbox_init.patch](tarball://root/attachments/some-uuid/ticket9674/trac9674_fix_Sbox_init.patch) by ylchapuy created at 2010-08-15 11:22:30



---

archive/issue_comments_093856.json:
```json
{
    "body": "<a id='comment:10'></a>Done, I put it back as positive review directly, I hope it's ok.",
    "created_at": "2010-08-15T11:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9674#issuecomment-93856",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

<a id='comment:10'></a>Done, I put it back as positive review directly, I hope it's ok.



---

archive/issue_comments_093857.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2010-08-15T11:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9674#issuecomment-93857",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_093858.json:
```json
{
    "body": "<a id='comment:11'></a>Sure.  Thanks!",
    "created_at": "2010-08-15T21:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9674#issuecomment-93858",
    "user": "https://github.com/qed777"
}
```

<a id='comment:11'></a>Sure.  Thanks!



---

archive/issue_events_024139.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-15T11:13:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9674",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9674#event-24139"
}
```



---

archive/issue_comments_093859.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-09-15T11:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9674#issuecomment-93859",
    "user": "https://github.com/qed777"
}
```

Resolution: fixed
