# Issue 9508: Fix all ATLAS build problems on Solaris/OpenSolaris

archive/issues_009508.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-drkirkby"
    ],
    "body": "The ATLAS package in Sage (atlas-3.8.3.p12 in sage 4.5.1) has a number of problems on Solaris or OpenSolaris. It only works fully on 32-bit SPARC. These problems range from serious to trivial. \n\nThe `spkg-check` file also failed to be very informative, and would have not exited properly if a test had failed. \n\nFortunately, with the exception of more informative messages from `spkg-check`, all problems can be resolved by putting code inside sections which only get executed on Solaris, so virtually eliminating any risk on non Solaris/OpenSolaris system. \n\nThese Solaris/OpenSolaris problems are:\n* An erroneous, but harmless message printed from `spkg-install-script`\n* Shared libraries were not built properly, and as a result they were deleted. \n* Linker flags were not set correctly on Solaris 10 x86 or OpenSolaris in 32-bit mode. \n \nThese will now be considered in turn. \n## An erroneous, but harmless message from `spkg-install-script`\nThe script `spkg-install-script` would always print:\n\n```\nChange ldflag -melf_x86_64 to -64 as needed for Sun ld\n```\n\nwhen the Sun linker was used on Solaris, which was not true on anything except 64-bit builds on Solaris or OpenSolaris. \n\n## Shared libraries were deleted in `make_correct_shared.sh`\nATLAS's shared libraries are built on Linux, OS X and FreeBSD, but were deleted on Solaris due to the fact they did not work. I suspect the problem was they were never made correctly in the first place, as with the exception of liblapack.so, they appear to work if built correctly. \n\nIf the libraries are built correctly, with the following code, which loops though the libraries libatlas libf77blas and libcblas, the problem is solved. \n\n```\nif [ \"x`uname`\" = xSunOS ]; then\n   cd \"$SAGE_LOCAL/lib\"\n\n   if [ \"x$SAGE64\" = xyes ] ; then \n      # To create a 64-bit shared library, the linker flag\n      # '-64' must be added. Note this is not the same as \n      # the compiler flag '-m64'\n      LINKER_FLAG=-64 \n   fi\n\n   # Build libatlas.so libf77blas.so and libcblas.so\n   # Actually, libatlas.so and libcblas.so gets built from spkg-install, \n   # but this is not working correctly for 64-bit libraries. Hence I simply \n   # remake those two libraries here. This is why 4 libraries are built\n   # in this Solaris section, but only two are shown above for FreeBSD, \n   # OS X and Linux. \n      \n   for ATLAS_LIBRARY in libatlas libf77blas libcblas ; do \n      echo \"Building shared library $ATLAS_LIBRARY.so from the static library $ATLAS_LIBRARY.a\"\n     /usr/ccs/bin/ld $LINKER_FLAG -L\"$SAGE_LOCAL/lib\"  -G -h $ATLAS_LIBRARY.so -o $ATLAS_LIBRARY.so  -zallextract  $ATLAS_LIBRARY.a -zdefaultextract -lc -lm -lgfortran\n      if [ $? -ne 0 ]; then\n         echo \"Failed to build ATLAS library $ATLAS_LIBRARY.so\"\n         exit 1\n      else\n         echo \"$ATLAS_LIBRARY.so has been built on Solaris.\"\n      fi\n   done\n   rm liblapack.so # liblapack.so causes problems with R on Solaris. \nfi\n```\n\nThis has the advantage that linbox can use the libraries - otherwise linbox reports ATLAS is not installed - see #9101. However, liblapack.so still presents problems if built with R, so that is not built. \n\n == Link options not set correctly in spkg-install-script ==\nCode in `spkg-install-script` tried to change the linker option `-melf_x86_64` to `-64`, irrespective of type of Solaris or OpenSolaris system. In fact, this is only appropiate on 64-bit Solaris or OpenSolaris builds. On 32-bit builds, a similar option must just be deleted. On SPARC builds, there is no need to change the options at all, as ATLAS gets it right. \n\nThe following code correctly sets the options. The first parts works on 64-bit code (`SAGE64=yes`) and the second part on 32-bit code, where `SAGE64` is not set to yes. \n\n```\n    if [ \"x$SAGE64\" = xyes ] && [ \"x`uname -m`\" = xi86pc ] ; then\n        # Solaris or OpenSolaris on x86/x64 on a 64-bit build\n        echo \"Change ldflag -melf_x86_64 to -64 as needed for Sun ld\"\n        echo \"on 64-bit builds of ATLAS on x64 hardware\"\n        sed 's/-melf_x86_64/-64/g' Make.inc > makeinc\n        mv makeinc Make.inc\n   fi\n   if [ \"x$SAGE64\" != xyes ] && [ \"x`uname -m`\" = xi86pc ] ; then\n         # Solaris or OpenSolaris on x86/x64 on a 32-bit build\n         echo \"Remove the linker flag -melf_i386 as needed for Sun ld\"\n         echo \"on 32-bit builds of ATLAS on x86/x64 hardware\"\n         sed 's/-melf_i386//g' Make.inc > makeinc\n         mv makeinc Make.inc\n   fi\n```\n\n\nCC:  @jhpalmieri @jaapspies\n\nComponent: **porting: Solaris**\n\nAuthor: **David Kirkby**\n\nReviewer: **John Palmieri**\n\nMerged: **sage-4.5.3.alpha1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/9508_\n\n",
    "closed_at": "2010-08-15T08:04:01Z",
    "created_at": "2010-07-15T14:20:22Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20solaris",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.5.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix all ATLAS build problems on Solaris/OpenSolaris",
    "type": "issue",
    "updated_at": "2010-08-15T08:27:59Z",
    "url": "https://github.com/sagemath/sage/issues/9508",
    "user": "https://github.com/sagetrac-drkirkby"
}
```
The ATLAS package in Sage (atlas-3.8.3.p12 in sage 4.5.1) has a number of problems on Solaris or OpenSolaris. It only works fully on 32-bit SPARC. These problems range from serious to trivial. 

The `spkg-check` file also failed to be very informative, and would have not exited properly if a test had failed. 

Fortunately, with the exception of more informative messages from `spkg-check`, all problems can be resolved by putting code inside sections which only get executed on Solaris, so virtually eliminating any risk on non Solaris/OpenSolaris system. 

These Solaris/OpenSolaris problems are:
* An erroneous, but harmless message printed from `spkg-install-script`
* Shared libraries were not built properly, and as a result they were deleted. 
* Linker flags were not set correctly on Solaris 10 x86 or OpenSolaris in 32-bit mode. 
 
These will now be considered in turn. 
## An erroneous, but harmless message from `spkg-install-script`
The script `spkg-install-script` would always print:

```
Change ldflag -melf_x86_64 to -64 as needed for Sun ld
```

when the Sun linker was used on Solaris, which was not true on anything except 64-bit builds on Solaris or OpenSolaris. 

## Shared libraries were deleted in `make_correct_shared.sh`
ATLAS's shared libraries are built on Linux, OS X and FreeBSD, but were deleted on Solaris due to the fact they did not work. I suspect the problem was they were never made correctly in the first place, as with the exception of liblapack.so, they appear to work if built correctly. 

If the libraries are built correctly, with the following code, which loops though the libraries libatlas libf77blas and libcblas, the problem is solved. 

```
if [ "x`uname`" = xSunOS ]; then
   cd "$SAGE_LOCAL/lib"

   if [ "x$SAGE64" = xyes ] ; then 
      # To create a 64-bit shared library, the linker flag
      # '-64' must be added. Note this is not the same as 
      # the compiler flag '-m64'
      LINKER_FLAG=-64 
   fi

   # Build libatlas.so libf77blas.so and libcblas.so
   # Actually, libatlas.so and libcblas.so gets built from spkg-install, 
   # but this is not working correctly for 64-bit libraries. Hence I simply 
   # remake those two libraries here. This is why 4 libraries are built
   # in this Solaris section, but only two are shown above for FreeBSD, 
   # OS X and Linux. 
      
   for ATLAS_LIBRARY in libatlas libf77blas libcblas ; do 
      echo "Building shared library $ATLAS_LIBRARY.so from the static library $ATLAS_LIBRARY.a"
     /usr/ccs/bin/ld $LINKER_FLAG -L"$SAGE_LOCAL/lib"  -G -h $ATLAS_LIBRARY.so -o $ATLAS_LIBRARY.so  -zallextract  $ATLAS_LIBRARY.a -zdefaultextract -lc -lm -lgfortran
      if [ $? -ne 0 ]; then
         echo "Failed to build ATLAS library $ATLAS_LIBRARY.so"
         exit 1
      else
         echo "$ATLAS_LIBRARY.so has been built on Solaris."
      fi
   done
   rm liblapack.so # liblapack.so causes problems with R on Solaris. 
fi
```

This has the advantage that linbox can use the libraries - otherwise linbox reports ATLAS is not installed - see #9101. However, liblapack.so still presents problems if built with R, so that is not built. 

 == Link options not set correctly in spkg-install-script ==
Code in `spkg-install-script` tried to change the linker option `-melf_x86_64` to `-64`, irrespective of type of Solaris or OpenSolaris system. In fact, this is only appropiate on 64-bit Solaris or OpenSolaris builds. On 32-bit builds, a similar option must just be deleted. On SPARC builds, there is no need to change the options at all, as ATLAS gets it right. 

The following code correctly sets the options. The first parts works on 64-bit code (`SAGE64=yes`) and the second part on 32-bit code, where `SAGE64` is not set to yes. 

```
    if [ "x$SAGE64" = xyes ] && [ "x`uname -m`" = xi86pc ] ; then
        # Solaris or OpenSolaris on x86/x64 on a 64-bit build
        echo "Change ldflag -melf_x86_64 to -64 as needed for Sun ld"
        echo "on 64-bit builds of ATLAS on x64 hardware"
        sed 's/-melf_x86_64/-64/g' Make.inc > makeinc
        mv makeinc Make.inc
   fi
   if [ "x$SAGE64" != xyes ] && [ "x`uname -m`" = xi86pc ] ; then
         # Solaris or OpenSolaris on x86/x64 on a 32-bit build
         echo "Remove the linker flag -melf_i386 as needed for Sun ld"
         echo "on 32-bit builds of ATLAS on x86/x64 hardware"
         sed 's/-melf_i386//g' Make.inc > makeinc
         mv makeinc Make.inc
   fi
```


CC:  @jhpalmieri @jaapspies

Component: **porting: Solaris**

Author: **David Kirkby**

Reviewer: **John Palmieri**

Merged: **sage-4.5.3.alpha1**

_Issue created by migration from https://trac.sagemath.org/ticket/9508_





---

archive/issue_events_122394.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-07-15T14:20:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "milestone_number": null,
    "milestone_title": "sage-4.5.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9508#event-122394"
}
```



---

archive/issue_events_122395.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-07-15T14:20:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20solaris",
    "label_color": "000080",
    "label_name": "c: porting: solaris",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9508#event-122395"
}
```



---

archive/issue_events_122396.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-07-15T14:20:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9508#event-122396"
}
```



---

archive/issue_events_122397.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-07-15T14:20:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9508#event-122397"
}
```



---

archive/issue_events_122398.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-07-15T14:20:22Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "subject": "https://github.com/sagetrac-drkirkby",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9508#event-122398"
}
```



---

archive/issue_events_122399.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-07-29T17:39:48Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "milestone_number": null,
    "milestone_title": "sage-4.5.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9508#event-122399"
}
```



---

archive/issue_events_122400.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-07-29T17:39:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "milestone_number": null,
    "milestone_title": "sage-4.5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9508#event-122400"
}
```



---

archive/issue_comments_082157.json:
```json
{
    "body": "Author: **David Kirkby**",
    "created_at": "2010-07-29T17:39:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82157",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Author: **David Kirkby**



---

archive/issue_events_122401.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-07-29T17:39:48Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "title_is": "Fix all ATLAS build problems on Solaris/OpenSolaris",
    "title_was": "ATLAS is not building shared libraries properly on Solaris 10 and OpenSolaris",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9508#event-122401"
}
```



---

archive/issue_comments_082158.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,26 @@\n-The ATLAS package in Sage (atlas-3.8.3.p12 in sage 4.5.rc1) has a problem in the way shared libraries are built and installed. \n-* libatlas and libcblas never get built as shared libraries on Solaris or OpenSolaris, despite they do get built on Linux, OS X and FreeBSD.\n-*  liblapack gets built, but later gets removed by the following few lines of code in the script `make_correct_shared.sh`, which was probably added in #5024. \n+The ATLAS package in Sage (atlas-3.8.3.p12 in sage 4.5.1) has a number of problems on Solaris or OpenSolaris. It only works fully on 32-bit SPARC. These problems range from serious to trivial. \n+\n+Fortunately, all problems can be resolved by putting code inside sections which only get executed on Solaris, so virtually eliminating any risk on non Solaris/OpenSolaris system. \n+\n+These problems are:\n+* An erroneous, but harmless message printed from `spkg-install-script`\n+* Shared libraries were not built properly, and as a result they were deleted. \n+* Linker flags were not set correctly on Solaris 10 x86 or OpenSolaris in 32-bit mode. \n+ \n+These will now be considered in turn. \n+## An erroneous, but harmless message from `spkg-install-script`\n+The script `spkg-install-script` would always print:\n+\n+```\n+Change ldflag -melf_x86_64 to -64 as needed for Sun ld\n+```\n+\n+when the Sun linker was used on Solaris, which was not true on anything except 64-bit builds on Solaris or OpenSolaris. \n+\n+## Shared libraries were deleted in `make_correct_shared.sh`\n+ATLAS's shared libraries are built on Linux, OS X and FreeBSD, but were deleted on Solaris due to the fact they did not work. I suspect the problem was they were never made correctly in the first place, as they appear to work if built correctly. \n+\n+The original code has this. \n \n  ```\n  # on Solaris a dynamic liblapack.so leads to import errors in numpy, so delete them for now.\n@@ -10,37 +30,71 @@\n      rm -rf liblapack.so*\n  fi\n  ```\n-* On 64-bit builds of Sage, Linbox reports ATLAS is not installed - see #9101. Closer inspection of Linbox's config.log shows that linbox determines the ATLAS libraries are 32-bit, not 64-bit. Since it finds no 64-bit libraries, it considers ATLAS is not installed. \n \n-I suspect the reasons the shared libraries are not currently built in Sage is that they were originally built incorrectly, so rather than fix the problem, they were just deleted. I'm aware  Michael Abshoff was using the GNU linker, despite this has never had a good reputation on Solaris, and even the GCC documentation advises using the Sun linker. Hence I think we should\n-\n-* Build the shared libraries properly, using the Sun linker `/usr/ccs/bin/ld`\n-* Consider deleting the static libraries. I don't think they would perform any useful function if the shared libraries existed. \n-\n-This will have several advantages. \n-\n-* Shared libraries are much smaller than static libraries. \n-* Shared libraries take up far less memory when th\n-* Linbox will hopefully not report ATLAS is not installed. \n-\n-The following command will build a a 32-bit or 64-bit shared library liblapack.so, although it could easily be extended to other libraries too. \n+If the libraries are built correctly, with the following code, which loops though the libraries libatlas liblapack libf77blas and libcblas, the problem is solved. \n \n ```\n-  if [ \"x$SAGE64\" = xyes ] ; then \n+# Build dynamic libraries on Solaris, using the Sun equivalent of the GNU\n+# options above. Rather than call 'ld', the exact path to 'ld' is given\n+# since we know for 100% sure that 'ld' will reside in /usr/ccs/bin\n+# on Solaris - this is true of both Solaris 10 and OpenSolaris\n+# I'm not 100% sure if these options are optimal (there might be some\n+# unnecessary commands, but its the exact equivalent of the GNU\n+# commands above.\n+\n+if [ \"x`uname`\" = xSunOS ]; then\n+   cd \"$SAGE_LOCAL/lib\"\n+\n+   if [ \"x$SAGE64\" = xyes ] ; then\n       # To create a 64-bit shared library, the linker flag\n-      # '-64' must be added. Note this is not the same as \n+      # '-64' must be added. Note this is not the same as\n       # the compiler flag '-m64'\n-      LINKER_BITS=-64 \n-   else\n-      LINKER_BITS=-32 \n+      LINKER_FLAG=-64\n    fi\n \n-   # Build liblapack.so\n-   lapack_command=\"/usr/ccs/bin/ld $LINKER_BITS -L\"$SAGE_LOCAL/lib\"  -G -h liblapack.so -o liblapack.so  -zallextract  liblapack.a -zdefaultextract -\n-lc -lm -lgfortran\"\n-   $lapack_command\n+   # Build libatlas.so liblapack.so libf77blas.so and libcblas.so\n+   # Actually, libatlas.so and libcblas.so gets built from spkg-install,\n+   # but this is not working correctly for 64-bit libraries. Hence I simply\n+   # remake those two libraries here. This is why 4 libraries are built\n+   # in this Solaris section, but only two are shown above for FreeBSD,\n+   # OS X and Linux.\n+\n+   for ATLAS_LIBRARY in libatlas liblapack libf77blas libcblas ; do\n+      echo \"Building shared library $ATLAS_LIBRARY.so from the static library $A\n+TLAS_LIBRARY.a\"\n+     /usr/ccs/bin/ld $LINKER_FLAG -L\"$SAGE_LOCAL/lib\"  -G -h $ATLAS_LIBRARY.so -\n+o $ATLAS_LIBRARY.so  -zallextract  $ATLAS_LIBRARY.a -zdefaultextract -lc -lm -lg\n+fortran\n+      if [ $? -ne 0 ]; then\n+         echo \"Failed to build ATLAS library $ATLAS_LIBRARY.so\"\n+         exit 1\n+      else\n+         echo \"$ATLAS_LIBRARY.so has been built on Solaris.\"\n+      fi\n+   done\n+fi\n ```\n \n-This will need some testing, but at least this will all be specific to Solaris or OpenSolaris, so will not cause any problems on other platforms. \n+there is no need to delete them. This has the advantage that linbox can use the libraries - otherwise linbox reports ATLAS is not installed - see #9101. \n \n-Dave \n+ == Link options not set correctly in spkg-install-script ==\n+Code in `spkg-install-script` tried to change the linker option `-melf_x86_64` to `-64`, irrespective of type of Solaris or OpenSolaris system. In fact, this is only appropiate on 64-bit Solaris or OpenSolaris builds. On 32-bit builds, a similar option must just be deleted. On SPARC builds, there is no need to change the options at all, as ATLAS gets it right. \n+\n+The following code correctly sets the options. The first parts works on 64-bit code (`SAGE64=yes`) and the second part on 32-bit code, where `SAGE64` is not set to yes. \n+\n+```\n+    if [ \"x$SAGE64\" = xyes ] && [ \"x`uname -m`\" = xi86pc ] ; then\n+        # Solaris or OpenSolaris on x86/x64 on a 64-bit build\n+        echo \"Change ldflag -melf_x86_64 to -64 as needed for Sun ld\"\n+        echo \"on 64-bit builds of ATLAS on x64 hardware\"\n+        sed 's/-melf_x86_64/-64/g' Make.inc > makeinc\n+        mv makeinc Make.inc\n+   fi\n+   if [ \"x$SAGE64\" != xyes ] && [ \"x`uname -m`\" = xi86pc ] ; then\n+         # Solaris or OpenSolaris on x86/x64 on a 32-bit build\n+         echo \"Remove the linker flag -melf_i386 as needed for Sun ld\"\n+         echo \"on 32-bit builds of ATLAS on x86/x64 hardware\"\n+         sed 's/-melf_i386//g' Make.inc > makeinc\n+         mv makeinc Make.inc\n+   fi\n+```\n``````\n",
    "created_at": "2010-07-29T17:39:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82158",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,26 @@
-The ATLAS package in Sage (atlas-3.8.3.p12 in sage 4.5.rc1) has a problem in the way shared libraries are built and installed. 
-* libatlas and libcblas never get built as shared libraries on Solaris or OpenSolaris, despite they do get built on Linux, OS X and FreeBSD.
-*  liblapack gets built, but later gets removed by the following few lines of code in the script `make_correct_shared.sh`, which was probably added in #5024. 
+The ATLAS package in Sage (atlas-3.8.3.p12 in sage 4.5.1) has a number of problems on Solaris or OpenSolaris. It only works fully on 32-bit SPARC. These problems range from serious to trivial. 
+
+Fortunately, all problems can be resolved by putting code inside sections which only get executed on Solaris, so virtually eliminating any risk on non Solaris/OpenSolaris system. 
+
+These problems are:
+* An erroneous, but harmless message printed from `spkg-install-script`
+* Shared libraries were not built properly, and as a result they were deleted. 
+* Linker flags were not set correctly on Solaris 10 x86 or OpenSolaris in 32-bit mode. 
+ 
+These will now be considered in turn. 
+## An erroneous, but harmless message from `spkg-install-script`
+The script `spkg-install-script` would always print:
+
+```
+Change ldflag -melf_x86_64 to -64 as needed for Sun ld
+```
+
+when the Sun linker was used on Solaris, which was not true on anything except 64-bit builds on Solaris or OpenSolaris. 
+
+## Shared libraries were deleted in `make_correct_shared.sh`
+ATLAS's shared libraries are built on Linux, OS X and FreeBSD, but were deleted on Solaris due to the fact they did not work. I suspect the problem was they were never made correctly in the first place, as they appear to work if built correctly. 
+
+The original code has this. 
 
  ```
  # on Solaris a dynamic liblapack.so leads to import errors in numpy, so delete them for now.
@@ -10,37 +30,71 @@
      rm -rf liblapack.so*
  fi
  ```
-* On 64-bit builds of Sage, Linbox reports ATLAS is not installed - see #9101. Closer inspection of Linbox's config.log shows that linbox determines the ATLAS libraries are 32-bit, not 64-bit. Since it finds no 64-bit libraries, it considers ATLAS is not installed. 
 
-I suspect the reasons the shared libraries are not currently built in Sage is that they were originally built incorrectly, so rather than fix the problem, they were just deleted. I'm aware  Michael Abshoff was using the GNU linker, despite this has never had a good reputation on Solaris, and even the GCC documentation advises using the Sun linker. Hence I think we should
-
-* Build the shared libraries properly, using the Sun linker `/usr/ccs/bin/ld`
-* Consider deleting the static libraries. I don't think they would perform any useful function if the shared libraries existed. 
-
-This will have several advantages. 
-
-* Shared libraries are much smaller than static libraries. 
-* Shared libraries take up far less memory when th
-* Linbox will hopefully not report ATLAS is not installed. 
-
-The following command will build a a 32-bit or 64-bit shared library liblapack.so, although it could easily be extended to other libraries too. 
+If the libraries are built correctly, with the following code, which loops though the libraries libatlas liblapack libf77blas and libcblas, the problem is solved. 
 
 ```
-  if [ "x$SAGE64" = xyes ] ; then 
+# Build dynamic libraries on Solaris, using the Sun equivalent of the GNU
+# options above. Rather than call 'ld', the exact path to 'ld' is given
+# since we know for 100% sure that 'ld' will reside in /usr/ccs/bin
+# on Solaris - this is true of both Solaris 10 and OpenSolaris
+# I'm not 100% sure if these options are optimal (there might be some
+# unnecessary commands, but its the exact equivalent of the GNU
+# commands above.
+
+if [ "x`uname`" = xSunOS ]; then
+   cd "$SAGE_LOCAL/lib"
+
+   if [ "x$SAGE64" = xyes ] ; then
       # To create a 64-bit shared library, the linker flag
-      # '-64' must be added. Note this is not the same as 
+      # '-64' must be added. Note this is not the same as
       # the compiler flag '-m64'
-      LINKER_BITS=-64 
-   else
-      LINKER_BITS=-32 
+      LINKER_FLAG=-64
    fi
 
-   # Build liblapack.so
-   lapack_command="/usr/ccs/bin/ld $LINKER_BITS -L"$SAGE_LOCAL/lib"  -G -h liblapack.so -o liblapack.so  -zallextract  liblapack.a -zdefaultextract -
-lc -lm -lgfortran"
-   $lapack_command
+   # Build libatlas.so liblapack.so libf77blas.so and libcblas.so
+   # Actually, libatlas.so and libcblas.so gets built from spkg-install,
+   # but this is not working correctly for 64-bit libraries. Hence I simply
+   # remake those two libraries here. This is why 4 libraries are built
+   # in this Solaris section, but only two are shown above for FreeBSD,
+   # OS X and Linux.
+
+   for ATLAS_LIBRARY in libatlas liblapack libf77blas libcblas ; do
+      echo "Building shared library $ATLAS_LIBRARY.so from the static library $A
+TLAS_LIBRARY.a"
+     /usr/ccs/bin/ld $LINKER_FLAG -L"$SAGE_LOCAL/lib"  -G -h $ATLAS_LIBRARY.so -
+o $ATLAS_LIBRARY.so  -zallextract  $ATLAS_LIBRARY.a -zdefaultextract -lc -lm -lg
+fortran
+      if [ $? -ne 0 ]; then
+         echo "Failed to build ATLAS library $ATLAS_LIBRARY.so"
+         exit 1
+      else
+         echo "$ATLAS_LIBRARY.so has been built on Solaris."
+      fi
+   done
+fi
 ```
 
-This will need some testing, but at least this will all be specific to Solaris or OpenSolaris, so will not cause any problems on other platforms. 
+there is no need to delete them. This has the advantage that linbox can use the libraries - otherwise linbox reports ATLAS is not installed - see #9101. 
 
-Dave 
+ == Link options not set correctly in spkg-install-script ==
+Code in `spkg-install-script` tried to change the linker option `-melf_x86_64` to `-64`, irrespective of type of Solaris or OpenSolaris system. In fact, this is only appropiate on 64-bit Solaris or OpenSolaris builds. On 32-bit builds, a similar option must just be deleted. On SPARC builds, there is no need to change the options at all, as ATLAS gets it right. 
+
+The following code correctly sets the options. The first parts works on 64-bit code (`SAGE64=yes`) and the second part on 32-bit code, where `SAGE64` is not set to yes. 
+
+```
+    if [ "x$SAGE64" = xyes ] && [ "x`uname -m`" = xi86pc ] ; then
+        # Solaris or OpenSolaris on x86/x64 on a 64-bit build
+        echo "Change ldflag -melf_x86_64 to -64 as needed for Sun ld"
+        echo "on 64-bit builds of ATLAS on x64 hardware"
+        sed 's/-melf_x86_64/-64/g' Make.inc > makeinc
+        mv makeinc Make.inc
+   fi
+   if [ "x$SAGE64" != xyes ] && [ "x`uname -m`" = xi86pc ] ; then
+         # Solaris or OpenSolaris on x86/x64 on a 32-bit build
+         echo "Remove the linker flag -melf_i386 as needed for Sun ld"
+         echo "on 32-bit builds of ATLAS on x86/x64 hardware"
+         sed 's/-melf_i386//g' Make.inc > makeinc
+         mv makeinc Make.inc
+   fi
+```
``````




---

archive/issue_comments_082159.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAn updated package can be found here\n\nhttp://boxen.math.washington.edu/home/kirkby/patches/atlas-3.8.3.p13.spkg\n\nI need to double check this before marking for review.",
    "created_at": "2010-07-29T17:45:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82159",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:2" align="right">comment:2</div>

An updated package can be found here

http://boxen.math.washington.edu/home/kirkby/patches/atlas-3.8.3.p13.spkg

I need to double check this before marking for review.



---

archive/issue_comments_082160.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,10 @@\n The ATLAS package in Sage (atlas-3.8.3.p12 in sage 4.5.1) has a number of problems on Solaris or OpenSolaris. It only works fully on 32-bit SPARC. These problems range from serious to trivial. \n \n-Fortunately, all problems can be resolved by putting code inside sections which only get executed on Solaris, so virtually eliminating any risk on non Solaris/OpenSolaris system. \n+The `spkg-check` file also failed to be very informative, and would have not exited properly if a test had failed. \n \n-These problems are:\n+Fortunately, with the exception of more informative messages from `spkg-check`, all problems can be resolved by putting code inside sections which only get executed on Solaris, so virtually eliminating any risk on non Solaris/OpenSolaris system. \n+\n+These Solaris/OpenSolaris problems are:\n * An erroneous, but harmless message printed from `spkg-install-script`\n * Shared libraries were not built properly, and as a result they were deleted. \n * Linker flags were not set correctly on Solaris 10 x86 or OpenSolaris in 32-bit mode. \n``````\n",
    "created_at": "2010-07-29T19:26:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82160",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,10 @@
 The ATLAS package in Sage (atlas-3.8.3.p12 in sage 4.5.1) has a number of problems on Solaris or OpenSolaris. It only works fully on 32-bit SPARC. These problems range from serious to trivial. 
 
-Fortunately, all problems can be resolved by putting code inside sections which only get executed on Solaris, so virtually eliminating any risk on non Solaris/OpenSolaris system. 
+The `spkg-check` file also failed to be very informative, and would have not exited properly if a test had failed. 
 
-These problems are:
+Fortunately, with the exception of more informative messages from `spkg-check`, all problems can be resolved by putting code inside sections which only get executed on Solaris, so virtually eliminating any risk on non Solaris/OpenSolaris system. 
+
+These Solaris/OpenSolaris problems are:
 * An erroneous, but harmless message printed from `spkg-install-script`
 * Shared libraries were not built properly, and as a result they were deleted. 
 * Linker flags were not set correctly on Solaris 10 x86 or OpenSolaris in 32-bit mode. 
``````




---

archive/issue_comments_082161.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\n## Testing the updated ATLAS package on OpenSolaris x64 as a 64-bit build\n* [Sun Ultra 27](http://www.sun.com/desktop/workstation/ultra27/)\n* [Intel W3580 Xeon 3.33 GHz](http://ark.intel.com/Product.aspx?id=39723), Quad core. 8 threads.\n* 12 GB RAM\n* [128-bit ZFS](http://en.wikipedia.org/wiki/ZFS) file systems\n* OpenSolaris 2009.06 snv_134 X86\n* Sage sage-4.5.2.alpha.1\n* gcc 4.4.4 configured to use the Sun linker and GNU assembler\n* 64-bit build by exporting SAGE64 to \"yes\"\n* ATLAS's test suite was run, by exporting SAGE_CHECK to \"yes\"\n\nThe ATLAS log is too long to show, but summary information is provided. This includes: \n* The start and end of logfile while ATLAS is building. \n* The end of the logfile whilst ATLAS was being tested. \n* The end of the log file whilst ATLAS was running some timing tests. \n* Confirmation using the `file` command that the shared libraries all exist and are 64-bit\n\n**First the build.**\n\n```\ndrkirkby@hawk:~/sage-4.5.2.alpha1$ ./sage -f atlas-3.8.3.p13\nchmod 0644 /export/home/drkirkby/sage-4.5.2.alpha1/local/lib/libptcblas.a /export/home/drkirkby/sage-4.5.2.alpha1/local/lib/libptf77blas.a\nchmod: WARNING: can't access /export/home/drkirkby/sage-4.5.2.alpha1/local/lib/libptcblas.a\nchmod: WARNING: can't access /export/home/drkirkby/sage-4.5.2.alpha1/local/lib/libptf77blas.a\nmake[1]: [install_lib] Error 2 (ignored)\nmake[1]: Leaving directory `/export/home/drkirkby/sage-4.5.2.alpha1/spkg/build/atlas-3.8.3.p13/ATLAS-build'\nBuilding shared library libatlas.so from the static library libatlas.a\nlibatlas.so has been built on Solaris.\nBuilding shared library liblapack.so from the static library liblapack.a\nliblapack.so has been built on Solaris.\nBuilding shared library libf77blas.so from the static library libf77blas.a\nlibf77blas.so has been built on Solaris.\nBuilding shared library libcblas.so from the static library libcblas.a\nlibcblas.so has been built on Solaris.\n\nreal    8m39.991s\nuser    7m39.319s\nsys     0m50.064s\nSuccessfully installed atlas-3.8.3.p13\nRunning the test suite.\n```\n**Then the test suite is run. A failure of the test suite would have exited with an error message.**\n\n```\nmake[1]: [sanity_test] Error 1 (ignored)\nDONE\nSCOPING FOR FAILURES IN CBLAS TESTS:\nfgrep -e fault -e FAULT -e error -e ERROR -e fail -e FAIL \\\n                interfaces/blas/C/testing/sanity.out | \\\n                fgrep -v PASSED\nmake[1]: [sanity_test] Error 1 (ignored)\nDONE\nSCOPING FOR FAILURES IN F77BLAS TESTS:\nfgrep -e fault -e FAULT -e error -e ERROR -e fail -e FAIL \\\n                interfaces/blas/F77/testing/sanity.out | \\\n                fgrep -v PASSED\nmake[1]: [sanity_test] Error 1 (ignored)\nDONE\nmake[1]: Leaving directory `/export/home/drkirkby/sage-4.5.2.alpha1/spkg/build/atlas-3.8.3.p13/ATLAS-build'\nThe ATLAS self-tests successfully passed\n```\n\n**Finally, the timing tests are run. Had these failed, spkg-check would cause an error message to be generated**\n\n```\nThe times labeled Reference are for ATLAS as installed by the authors.\nNAMING ABBREVIATIONS:\n   kSelMM : selected matmul kernel (may be hand-tuned)\n   kGenMM : generated matmul kernel\n   kMM_NT : worst no-copy kernel\n   kMM_TN : best no-copy kernel\n   BIG_MM : large GEMM timing (usually N=1600); estimate of asymptotic peak\n   kMV_N  : NoTranspose matvec kernel\n   kMV_T  : Transpose matvec kernel\n   kGER   : GER (rank-1 update) kernel\nKernel routines are not called by the user directly, and their\nperformance is often somewhat different than the total\nalgorithm (eg, dGER perf may differ from dkGER)\n\n\nReference clock rate=2672Mhz, new rate=3325Mhz\n   Refrenc : % of clock rate achieved by reference install\n   Present : % of clock rate achieved by present ATLAS install\n\n                    single precision                  double precision\n            ********************************   *******************************\n                  real           complex           real           complex\n            ---------------  ---------------  ---------------  ---------------\nBenchmark   Refrenc Present  Refrenc Present  Refrenc Present  Refrenc Present\n=========   ======= =======  ======= =======  ======= =======  ======= =======\n  kSelMM      636.3   693.9    584.2   643.0    340.4   367.6    338.8   366.6\n  kGenMM      186.2   199.9    186.4   198.1    177.0   191.8    176.9   191.9\n  kMM_NT      166.9   180.6    164.4   180.7    162.0   175.8    157.8   175.6\n  kMM_TN      162.4   173.8    174.7   192.3    160.8   171.3    167.4   185.5\n  BIG_MM      838.0   672.4    832.0   675.6    446.6   359.1    442.8   352.5\n   kMV_N      177.7   196.5    282.9   273.2     86.4    89.9    121.9   121.2\n   kMV_T      109.2   120.2    120.3   126.6     89.6   103.5    105.8   104.7\n    kGER      201.9   234.1    266.6   281.3     77.3    89.7    102.2   111.3\nmake[1]: Leaving directory `/export/home/drkirkby/sage-4.5.2.alpha1/spkg/build/atlas-3.8.3.p13/ATLAS-build'\nThe ATLAS timing data was successfully collected\nNow cleaning up tmp files.\nrm: Cannot remove any directory in the path of the current working directory\n/export/home/drkirkby/sage-4.5.2.alpha1/spkg/build/atlas-3.8.3.p13\nMaking Sage/Python scripts relocatable...\nMaking script relocatable\nFinished installing atlas-3.8.3.p13.spkg\n```\n\nIt can also be seen that the shared libraries are 64-bit, as they should be:\n\n```\ndrkirkby@hawk:~/sage-4.5.2.alpha1/local/lib$ file libcblas.so  libf77blas.so liblapack.so libatlas.so libf77blas.a liblapack.a libcblas.a libatlas.a\nlibcblas.so:\tELF 64-bit LSB dynamic lib AMD64 Version 1, dynamically linked, not stripped, no debugging information available\nlibf77blas.so:\tELF 64-bit LSB dynamic lib AMD64 Version 1, dynamically linked, not stripped, no debugging information available\nliblapack.so:\tELF 64-bit LSB dynamic lib AMD64 Version 1, dynamically linked, not stripped, no debugging information available\nlibatlas.so:\tELF 64-bit LSB dynamic lib AMD64 Version 1, dynamically linked, not stripped, no debugging information available\nlibf77blas.a:\tcurrent ar archive, not a dynamic executable or shared object\nliblapack.a:\tcurrent ar archive, not a dynamic executable or shared object\nlibcblas.a:\tcurrent ar archive, not a dynamic executable or shared object\nlibatlas.a:\tcurrent ar archive, not a dynamic executable or shared object\n```\n\n**Given that other programs like linbox link properly to the ATLAS library, we can assume with a reasonable degree of confidence the libraries are being built correctly on 64-bit OpenSolaris on the x64 platform.**",
    "created_at": "2010-07-29T20:26:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82161",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:4" align="right">comment:4</div>

## Testing the updated ATLAS package on OpenSolaris x64 as a 64-bit build
* [Sun Ultra 27](http://www.sun.com/desktop/workstation/ultra27/)
* [Intel W3580 Xeon 3.33 GHz](http://ark.intel.com/Product.aspx?id=39723), Quad core. 8 threads.
* 12 GB RAM
* [128-bit ZFS](http://en.wikipedia.org/wiki/ZFS) file systems
* OpenSolaris 2009.06 snv_134 X86
* Sage sage-4.5.2.alpha.1
* gcc 4.4.4 configured to use the Sun linker and GNU assembler
* 64-bit build by exporting SAGE64 to "yes"
* ATLAS's test suite was run, by exporting SAGE_CHECK to "yes"

The ATLAS log is too long to show, but summary information is provided. This includes: 
* The start and end of logfile while ATLAS is building. 
* The end of the logfile whilst ATLAS was being tested. 
* The end of the log file whilst ATLAS was running some timing tests. 
* Confirmation using the `file` command that the shared libraries all exist and are 64-bit

**First the build.**

```
drkirkby@hawk:~/sage-4.5.2.alpha1$ ./sage -f atlas-3.8.3.p13
chmod 0644 /export/home/drkirkby/sage-4.5.2.alpha1/local/lib/libptcblas.a /export/home/drkirkby/sage-4.5.2.alpha1/local/lib/libptf77blas.a
chmod: WARNING: can't access /export/home/drkirkby/sage-4.5.2.alpha1/local/lib/libptcblas.a
chmod: WARNING: can't access /export/home/drkirkby/sage-4.5.2.alpha1/local/lib/libptf77blas.a
make[1]: [install_lib] Error 2 (ignored)
make[1]: Leaving directory `/export/home/drkirkby/sage-4.5.2.alpha1/spkg/build/atlas-3.8.3.p13/ATLAS-build'
Building shared library libatlas.so from the static library libatlas.a
libatlas.so has been built on Solaris.
Building shared library liblapack.so from the static library liblapack.a
liblapack.so has been built on Solaris.
Building shared library libf77blas.so from the static library libf77blas.a
libf77blas.so has been built on Solaris.
Building shared library libcblas.so from the static library libcblas.a
libcblas.so has been built on Solaris.

real    8m39.991s
user    7m39.319s
sys     0m50.064s
Successfully installed atlas-3.8.3.p13
Running the test suite.
```
**Then the test suite is run. A failure of the test suite would have exited with an error message.**

```
make[1]: [sanity_test] Error 1 (ignored)
DONE
SCOPING FOR FAILURES IN CBLAS TESTS:
fgrep -e fault -e FAULT -e error -e ERROR -e fail -e FAIL \
                interfaces/blas/C/testing/sanity.out | \
                fgrep -v PASSED
make[1]: [sanity_test] Error 1 (ignored)
DONE
SCOPING FOR FAILURES IN F77BLAS TESTS:
fgrep -e fault -e FAULT -e error -e ERROR -e fail -e FAIL \
                interfaces/blas/F77/testing/sanity.out | \
                fgrep -v PASSED
make[1]: [sanity_test] Error 1 (ignored)
DONE
make[1]: Leaving directory `/export/home/drkirkby/sage-4.5.2.alpha1/spkg/build/atlas-3.8.3.p13/ATLAS-build'
The ATLAS self-tests successfully passed
```

**Finally, the timing tests are run. Had these failed, spkg-check would cause an error message to be generated**

```
The times labeled Reference are for ATLAS as installed by the authors.
NAMING ABBREVIATIONS:
   kSelMM : selected matmul kernel (may be hand-tuned)
   kGenMM : generated matmul kernel
   kMM_NT : worst no-copy kernel
   kMM_TN : best no-copy kernel
   BIG_MM : large GEMM timing (usually N=1600); estimate of asymptotic peak
   kMV_N  : NoTranspose matvec kernel
   kMV_T  : Transpose matvec kernel
   kGER   : GER (rank-1 update) kernel
Kernel routines are not called by the user directly, and their
performance is often somewhat different than the total
algorithm (eg, dGER perf may differ from dkGER)


Reference clock rate=2672Mhz, new rate=3325Mhz
   Refrenc : % of clock rate achieved by reference install
   Present : % of clock rate achieved by present ATLAS install

                    single precision                  double precision
            ********************************   *******************************
                  real           complex           real           complex
            ---------------  ---------------  ---------------  ---------------
Benchmark   Refrenc Present  Refrenc Present  Refrenc Present  Refrenc Present
=========   ======= =======  ======= =======  ======= =======  ======= =======
  kSelMM      636.3   693.9    584.2   643.0    340.4   367.6    338.8   366.6
  kGenMM      186.2   199.9    186.4   198.1    177.0   191.8    176.9   191.9
  kMM_NT      166.9   180.6    164.4   180.7    162.0   175.8    157.8   175.6
  kMM_TN      162.4   173.8    174.7   192.3    160.8   171.3    167.4   185.5
  BIG_MM      838.0   672.4    832.0   675.6    446.6   359.1    442.8   352.5
   kMV_N      177.7   196.5    282.9   273.2     86.4    89.9    121.9   121.2
   kMV_T      109.2   120.2    120.3   126.6     89.6   103.5    105.8   104.7
    kGER      201.9   234.1    266.6   281.3     77.3    89.7    102.2   111.3
make[1]: Leaving directory `/export/home/drkirkby/sage-4.5.2.alpha1/spkg/build/atlas-3.8.3.p13/ATLAS-build'
The ATLAS timing data was successfully collected
Now cleaning up tmp files.
rm: Cannot remove any directory in the path of the current working directory
/export/home/drkirkby/sage-4.5.2.alpha1/spkg/build/atlas-3.8.3.p13
Making Sage/Python scripts relocatable...
Making script relocatable
Finished installing atlas-3.8.3.p13.spkg
```

It can also be seen that the shared libraries are 64-bit, as they should be:

```
drkirkby@hawk:~/sage-4.5.2.alpha1/local/lib$ file libcblas.so  libf77blas.so liblapack.so libatlas.so libf77blas.a liblapack.a libcblas.a libatlas.a
libcblas.so:	ELF 64-bit LSB dynamic lib AMD64 Version 1, dynamically linked, not stripped, no debugging information available
libf77blas.so:	ELF 64-bit LSB dynamic lib AMD64 Version 1, dynamically linked, not stripped, no debugging information available
liblapack.so:	ELF 64-bit LSB dynamic lib AMD64 Version 1, dynamically linked, not stripped, no debugging information available
libatlas.so:	ELF 64-bit LSB dynamic lib AMD64 Version 1, dynamically linked, not stripped, no debugging information available
libf77blas.a:	current ar archive, not a dynamic executable or shared object
liblapack.a:	current ar archive, not a dynamic executable or shared object
libcblas.a:	current ar archive, not a dynamic executable or shared object
libatlas.a:	current ar archive, not a dynamic executable or shared object
```

**Given that other programs like linbox link properly to the ATLAS library, we can assume with a reasonable degree of confidence the libraries are being built correctly on 64-bit OpenSolaris on the x64 platform.**



---

archive/issue_comments_082162.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\n## Testing the updated ATLAS package on Solaris 10 x64 as a 32-bit build\n\n* Dell Inc. OptiPlex 755 (Quad-Core Intel(R) Core(TM)2 Quad Q6600 @ 2.40GHz)\n* 8 GB RAM\n* Solaris 10 x86 update 5 (5/08)\n* 32-bit build - SAGE64 was unset\n* gcc 4.5.0 configured to use the Sun linker and GNU assembler. \n\nOnly the start and end of the build are shown. Had ATLAS failed to build, the tests would not have been run. Had the tests not all past, the timing information would not have been gathered. So this shows that ATLAS has built and passed all the tests, and timing information has been collected. \n\n```\n32 drkirkby@fulvia:[~/fulvia/32/sage-4.5.1] $ ./sage -f atlas-3.8.3.p13\nForce installing atlas-3.8.3.p13\nCalling sage-spkg on atlas-3.8.3.p13\nWarning: Attempted to overwrite SAGE_ROOT environment variable\n\n<snip>\n\nReference clock rate=2394Mhz, new rate=2400Mhz\n   Refrenc : % of clock rate achieved by reference install\n   Present : % of clock rate achieved by present ATLAS install\n\n                    single precision                  double precision\n            ********************************   *******************************\n                  real           complex           real           complex\n            ---------------  ---------------  ---------------  ---------------\nBenchmark   Refrenc Present  Refrenc Present  Refrenc Present  Refrenc Present\n=========   ======= =======  ======= =======  ======= =======  ======= =======\n  kSelMM      567.0   564.1    527.5   521.9    334.0   332.5    321.0   318.3\n  kGenMM      162.8   121.3    164.5   163.1    155.5   143.9    154.4   145.6\n  kMM_NT      135.8   155.0    132.7   158.0    104.6   135.8    115.7   147.5\n  kMM_TN      159.6   115.1    123.4   112.1    123.3   110.7    127.1   114.1\n  BIG_MM      553.1   539.6    554.4   553.0    322.1   321.8    324.2   321.4\n   kMV_N       69.0    66.0    212.3   153.4     54.4    55.9     69.8    65.8\n   kMV_T       87.5    83.1     91.5   113.7     49.9    36.8     74.1    71.4\n    kGER       90.1    87.4    117.4   105.0     28.1    26.9     42.2    45.1\nmake[1]: Leaving directory `/home/drkirkby/fulvia/32/sage-4.5.1/spkg/build/atlas-3.8.3.p13/ATLAS-build'\nThe ATLAS timing data was successfully collected\nNow cleaning up tmp files.\nrm: Cannot remove any directory in the path of the current working directory\n/home/drkirkby/fulvia/32/sage-4.5.1/spkg/build/atlas-3.8.3.p13\nMaking Sage/Python scripts relocatable...\nMaking script relocatable\nFinished installing atlas-3.8.3.p13.spkg\n32 drkirkby@fulvia:[~/fulvia/32/sage-4.5.1] $ \n```",
    "created_at": "2010-07-29T21:50:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82162",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:5" align="right">comment:5</div>

## Testing the updated ATLAS package on Solaris 10 x64 as a 32-bit build

* Dell Inc. OptiPlex 755 (Quad-Core Intel(R) Core(TM)2 Quad Q6600 @ 2.40GHz)
* 8 GB RAM
* Solaris 10 x86 update 5 (5/08)
* 32-bit build - SAGE64 was unset
* gcc 4.5.0 configured to use the Sun linker and GNU assembler. 

Only the start and end of the build are shown. Had ATLAS failed to build, the tests would not have been run. Had the tests not all past, the timing information would not have been gathered. So this shows that ATLAS has built and passed all the tests, and timing information has been collected. 

```
32 drkirkby@fulvia:[~/fulvia/32/sage-4.5.1] $ ./sage -f atlas-3.8.3.p13
Force installing atlas-3.8.3.p13
Calling sage-spkg on atlas-3.8.3.p13
Warning: Attempted to overwrite SAGE_ROOT environment variable

<snip>

Reference clock rate=2394Mhz, new rate=2400Mhz
   Refrenc : % of clock rate achieved by reference install
   Present : % of clock rate achieved by present ATLAS install

                    single precision                  double precision
            ********************************   *******************************
                  real           complex           real           complex
            ---------------  ---------------  ---------------  ---------------
Benchmark   Refrenc Present  Refrenc Present  Refrenc Present  Refrenc Present
=========   ======= =======  ======= =======  ======= =======  ======= =======
  kSelMM      567.0   564.1    527.5   521.9    334.0   332.5    321.0   318.3
  kGenMM      162.8   121.3    164.5   163.1    155.5   143.9    154.4   145.6
  kMM_NT      135.8   155.0    132.7   158.0    104.6   135.8    115.7   147.5
  kMM_TN      159.6   115.1    123.4   112.1    123.3   110.7    127.1   114.1
  BIG_MM      553.1   539.6    554.4   553.0    322.1   321.8    324.2   321.4
   kMV_N       69.0    66.0    212.3   153.4     54.4    55.9     69.8    65.8
   kMV_T       87.5    83.1     91.5   113.7     49.9    36.8     74.1    71.4
    kGER       90.1    87.4    117.4   105.0     28.1    26.9     42.2    45.1
make[1]: Leaving directory `/home/drkirkby/fulvia/32/sage-4.5.1/spkg/build/atlas-3.8.3.p13/ATLAS-build'
The ATLAS timing data was successfully collected
Now cleaning up tmp files.
rm: Cannot remove any directory in the path of the current working directory
/home/drkirkby/fulvia/32/sage-4.5.1/spkg/build/atlas-3.8.3.p13
Making Sage/Python scripts relocatable...
Making script relocatable
Finished installing atlas-3.8.3.p13.spkg
32 drkirkby@fulvia:[~/fulvia/32/sage-4.5.1] $ 
```



---

archive/issue_comments_082163.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n## Testing the updated ATLAS package on Solaris 10 x64 as a 64-bit build\n* Dell Inc. OptiPlex 755 (Quad-Core Intel(R) Core(TM)2 Quad Q6600 @ 2.40GHz)\n* 8 GB RAM\n* Solaris 10 x86 update 5 (5/08)\n* 64-bit build - SAGE64 was exported to \"yes\"\n* gcc 4.5.0 configured to use the Sun linker and GNU assembler. \n\nAgain, the full log is not shown, but the end is . \n\n```\n64 drkirkby@fulvia:[~/fulvia/64/sage-4.5.1] $ ./sage -f atlas-3.8.3.p13\n\n<snip> \n\nReference clock rate=2394Mhz, new rate=2400Mhz\n   Refrenc : % of clock rate achieved by reference install\n   Present : % of clock rate achieved by present ATLAS install\n\n                    single precision                  double precision\n            ********************************   *******************************\n                  real           complex           real           complex\n            ---------------  ---------------  ---------------  ---------------\nBenchmark   Refrenc Present  Refrenc Present  Refrenc Present  Refrenc Present\n=========   ======= =======  ======= =======  ======= =======  ======= =======\n  kSelMM      565.9   571.5    532.9   528.8    365.5   363.9    334.8   351.6\n  kGenMM      177.6   156.5    177.6   171.2    166.1   142.4    162.6   141.5\n  kMM_NT      134.0   129.5    138.9   169.0    119.1   119.7    137.6   157.5\n  kMM_TN      159.3   154.5    165.6   157.5    148.2   138.5    159.0   152.4\n  BIG_MM      558.5   545.5    557.8   549.3    353.8   353.3    346.7   348.1\n   kMV_N      111.0   105.3    211.1   206.1     55.2    57.4     92.8    86.7\n   kMV_T       85.0    88.7     93.1    68.3     45.5    47.3     76.7    64.9\n    kGER      159.0   189.1    119.0   123.8     27.8    29.3     46.5    49.8\nmake[1]: Leaving directory `/home/drkirkby/fulvia/64/sage-4.5.1/spkg/build/atlas-3.8.3.p13/ATLAS-build'\nNow cleaning up tmp files.\nrm: Cannot remove any directory in the path of the current working directory\n/home/drkirkby/fulvia/64/sage-4.5.1/spkg/build/atlas-3.8.3.p13\nMaking Sage/Python scripts relocatable...\nMaking script relocatable\nFinished installing atlas-3.8.3.p13.spkg\n64 drkirkby@fulvia:[~/fulvia/64/sage-4.5.1] \n```\n\nWe can see the libraries are indeed 32-bit:\n\n```\nas.arkirkby@fulvia:[~/fulvia/32/sage-4.5.1/local/lib] $ file libcblas.so libf77blas.so liblapack.so libatlas.so libf77blas.a liblapack.a libcblas.a libatl \nlibcblas.so:\tELF 32-bit LSB dynamic lib 80386 Version 1, dynamically linked, not stripped, no debugging information available\nlibf77blas.so:\tELF 32-bit LSB dynamic lib 80386 Version 1, dynamically linked, not stripped, no debugging information available\nliblapack.so:\tELF 32-bit LSB dynamic lib 80386 Version 1, dynamically linked, not stripped, no debugging information available\nlibatlas.so:\tELF 32-bit LSB dynamic lib 80386 Version 1, dynamically linked, not stripped, no debugging information available\nlibf77blas.a:\tcurrent ar archive, not a dynamic executable or shared object\nliblapack.a:\tcurrent ar archive, not a dynamic executable or shared object\nlibcblas.a:\tcurrent ar archive, not a dynamic executable or shared object\nlibatlas.a:\tcurrent ar archive, not a dynamic executable or shared object\n```",
    "created_at": "2010-07-29T21:56:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82163",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:6" align="right">comment:6</div>

## Testing the updated ATLAS package on Solaris 10 x64 as a 64-bit build
* Dell Inc. OptiPlex 755 (Quad-Core Intel(R) Core(TM)2 Quad Q6600 @ 2.40GHz)
* 8 GB RAM
* Solaris 10 x86 update 5 (5/08)
* 64-bit build - SAGE64 was exported to "yes"
* gcc 4.5.0 configured to use the Sun linker and GNU assembler. 

Again, the full log is not shown, but the end is . 

```
64 drkirkby@fulvia:[~/fulvia/64/sage-4.5.1] $ ./sage -f atlas-3.8.3.p13

<snip> 

Reference clock rate=2394Mhz, new rate=2400Mhz
   Refrenc : % of clock rate achieved by reference install
   Present : % of clock rate achieved by present ATLAS install

                    single precision                  double precision
            ********************************   *******************************
                  real           complex           real           complex
            ---------------  ---------------  ---------------  ---------------
Benchmark   Refrenc Present  Refrenc Present  Refrenc Present  Refrenc Present
=========   ======= =======  ======= =======  ======= =======  ======= =======
  kSelMM      565.9   571.5    532.9   528.8    365.5   363.9    334.8   351.6
  kGenMM      177.6   156.5    177.6   171.2    166.1   142.4    162.6   141.5
  kMM_NT      134.0   129.5    138.9   169.0    119.1   119.7    137.6   157.5
  kMM_TN      159.3   154.5    165.6   157.5    148.2   138.5    159.0   152.4
  BIG_MM      558.5   545.5    557.8   549.3    353.8   353.3    346.7   348.1
   kMV_N      111.0   105.3    211.1   206.1     55.2    57.4     92.8    86.7
   kMV_T       85.0    88.7     93.1    68.3     45.5    47.3     76.7    64.9
    kGER      159.0   189.1    119.0   123.8     27.8    29.3     46.5    49.8
make[1]: Leaving directory `/home/drkirkby/fulvia/64/sage-4.5.1/spkg/build/atlas-3.8.3.p13/ATLAS-build'
Now cleaning up tmp files.
rm: Cannot remove any directory in the path of the current working directory
/home/drkirkby/fulvia/64/sage-4.5.1/spkg/build/atlas-3.8.3.p13
Making Sage/Python scripts relocatable...
Making script relocatable
Finished installing atlas-3.8.3.p13.spkg
64 drkirkby@fulvia:[~/fulvia/64/sage-4.5.1] 
```

We can see the libraries are indeed 32-bit:

```
as.arkirkby@fulvia:[~/fulvia/32/sage-4.5.1/local/lib] $ file libcblas.so libf77blas.so liblapack.so libatlas.so libf77blas.a liblapack.a libcblas.a libatl 
libcblas.so:	ELF 32-bit LSB dynamic lib 80386 Version 1, dynamically linked, not stripped, no debugging information available
libf77blas.so:	ELF 32-bit LSB dynamic lib 80386 Version 1, dynamically linked, not stripped, no debugging information available
liblapack.so:	ELF 32-bit LSB dynamic lib 80386 Version 1, dynamically linked, not stripped, no debugging information available
libatlas.so:	ELF 32-bit LSB dynamic lib 80386 Version 1, dynamically linked, not stripped, no debugging information available
libf77blas.a:	current ar archive, not a dynamic executable or shared object
liblapack.a:	current ar archive, not a dynamic executable or shared object
libcblas.a:	current ar archive, not a dynamic executable or shared object
libatlas.a:	current ar archive, not a dynamic executable or shared object
```



---

archive/issue_comments_082164.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nIs this ready for review?\n\nRegarding the check <code>\"x\\`uname -m\\`\" = xi86pc</code>, does this guarantee Solaris or OpenSolaris somehow?  I can't find a definitive description of the output of \"uname -m\", although I've seen a few places (including the uname man page on Solaris) suggest that you should use \"uname -p\" instead of \"uname -m\"...\n\nWould it be better (or at least easier to read) to use `uname` instead of `uname -m`?\n\nAnyway, this is a minor point. The changes look good and I'm building this on several machines to test it out.  I think if this gets a positive review, then we can close #9356: with this new spkg, ATLAS builds all of the appropriate libraries on Solaris, so we don't need to modify how SAGE_ATLAS_LIB works.",
    "created_at": "2010-08-02T05:04:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82164",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:7" align="right">comment:7</div>

Is this ready for review?

Regarding the check <code>"x\`uname -m\`" = xi86pc</code>, does this guarantee Solaris or OpenSolaris somehow?  I can't find a definitive description of the output of "uname -m", although I've seen a few places (including the uname man page on Solaris) suggest that you should use "uname -p" instead of "uname -m"...

Would it be better (or at least easier to read) to use `uname` instead of `uname -m`?

Anyway, this is a minor point. The changes look good and I'm building this on several machines to test it out.  I think if this gets a positive review, then we can close #9356: with this new spkg, ATLAS builds all of the appropriate libraries on Solaris, so we don't need to modify how SAGE_ATLAS_LIB works.



---

archive/issue_comments_082165.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@jhpalmieri](#comment:7):\n> Is this ready for review?\n\nNo. I think I found an issue on SPARC. I want to make double sure this is OK. My 32-bit SPARC build did not work properly. \n\n> Regarding the check <code>\"x\\`uname -m\\`\" = xi86pc</code>, does this guarantee Solaris or OpenSolaris somehow?  \n\nNo, it guarantees the hardware is x86 based. That includes the 64-bit hardware. You will get the same on both OpenSolaris and Solaris. Note OpenSolaris does run on SPARC hardware too, though that is not very common. I don't have any OpenSolaris SPARC systems running myself and I'm not aware of anywhere where there is one. \n\n> I can't find a definitive description of the output of \"uname -m\", although I've seen a few places (including the uname man page on Solaris) suggest that you should use \"uname -p\" instead of \"uname -m\"...\n\nI have never noticed that in the uname man page. My preference for -m, and not -p, is that -m is defined by POSIX standards:\n\nhttp://www.opengroup.org/onlinepubs/009695399/utilities/uname.html\n\nbut there is no requirement for uname to support the -p option. That causes a problem on systems like HP-UX, where  there is no -p option. So before using uname -p, one should test that the system supports the option. I guess since this is in a Solaris specific part of the file, we could use uname -p, but I'm not over keen on using non-portable options if portable ones exist. \n\nI can't believe Sun could ever possibly remove the -m option, as Solaris would then not be a POSIX compliant operating system - it would drop to be a \"Unix-like\" operating system, as is Linux. I must admit I am puzzled why they recommend you use a non-portable option in preference to a portable one. \n\n> Would it be better (or at least easier to read) to use `uname` instead of `uname -m`?\n\nNo, since `spkg-install-script` does need to know the processor type. Trying to make those substitutions on a SPARC processor would make no sense. However, I can certainly clarify things a bit more with comments, similar to what I have put above. \n \n> Anyway, this is a minor point. The changes look good and I'm building this on several machines to test it out.  I think if this gets a positive review, then we can close #9356: with this new spkg, ATLAS builds all of the appropriate libraries on Solaris, so we don't need to modify how SAGE_ATLAS_LIB works.\n\nLet me know how your build goes. My 32-bit SPARC build did not work, so I'd be interested in how you get on with 32-bit builds on SPARC. \n\nDave",
    "created_at": "2010-08-02T08:59:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82165",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@jhpalmieri](#comment:7):
> Is this ready for review?

No. I think I found an issue on SPARC. I want to make double sure this is OK. My 32-bit SPARC build did not work properly. 

> Regarding the check <code>"x\`uname -m\`" = xi86pc</code>, does this guarantee Solaris or OpenSolaris somehow?  

No, it guarantees the hardware is x86 based. That includes the 64-bit hardware. You will get the same on both OpenSolaris and Solaris. Note OpenSolaris does run on SPARC hardware too, though that is not very common. I don't have any OpenSolaris SPARC systems running myself and I'm not aware of anywhere where there is one. 

> I can't find a definitive description of the output of "uname -m", although I've seen a few places (including the uname man page on Solaris) suggest that you should use "uname -p" instead of "uname -m"...

I have never noticed that in the uname man page. My preference for -m, and not -p, is that -m is defined by POSIX standards:

http://www.opengroup.org/onlinepubs/009695399/utilities/uname.html

but there is no requirement for uname to support the -p option. That causes a problem on systems like HP-UX, where  there is no -p option. So before using uname -p, one should test that the system supports the option. I guess since this is in a Solaris specific part of the file, we could use uname -p, but I'm not over keen on using non-portable options if portable ones exist. 

I can't believe Sun could ever possibly remove the -m option, as Solaris would then not be a POSIX compliant operating system - it would drop to be a "Unix-like" operating system, as is Linux. I must admit I am puzzled why they recommend you use a non-portable option in preference to a portable one. 

> Would it be better (or at least easier to read) to use `uname` instead of `uname -m`?

No, since `spkg-install-script` does need to know the processor type. Trying to make those substitutions on a SPARC processor would make no sense. However, I can certainly clarify things a bit more with comments, similar to what I have put above. 
 
> Anyway, this is a minor point. The changes look good and I'm building this on several machines to test it out.  I think if this gets a positive review, then we can close #9356: with this new spkg, ATLAS builds all of the appropriate libraries on Solaris, so we don't need to modify how SAGE_ATLAS_LIB works.

Let me know how your build goes. My 32-bit SPARC build did not work, so I'd be interested in how you get on with 32-bit builds on SPARC. 

Dave



---

archive/issue_events_122402.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-08-02T08:59:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9508#event-122402"
}
```



---

archive/issue_comments_082166.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\n> Let me know how your build goes. My 32-bit SPARC build did not work, so I'd be interested in how you get on with 32-bit builds on SPARC.\n\nOn mark2, it claims to have built successfully with SAGE_CHECK='yes'.  On the other hand, when building from scratch on mark2, while ATLAS seems to build okay, the R build fails:\n\n```\nWarning in solve.default(rgb) :\n  unable to load shared library '/home/palmieri/mark2/sage-4.5.2.rc0/spkg/build/r-2.10.1.p2/src/modules//lapack.so':\n  ld.so.1: R: fatal: relocation error: file /home/palmieri/mark2/sage-4.5.2.rc0/local/lib//liblapack.so: symbol __powisf2: referenced symbol not found\nError in solve.default(rgb) : lapack routines cannot be loaded\nError: unable to load R code in package 'grDevices'\nExecution halted\n```",
    "created_at": "2010-08-02T14:34:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82166",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:10" align="right">comment:10</div>

> Let me know how your build goes. My 32-bit SPARC build did not work, so I'd be interested in how you get on with 32-bit builds on SPARC.

On mark2, it claims to have built successfully with SAGE_CHECK='yes'.  On the other hand, when building from scratch on mark2, while ATLAS seems to build okay, the R build fails:

```
Warning in solve.default(rgb) :
  unable to load shared library '/home/palmieri/mark2/sage-4.5.2.rc0/spkg/build/r-2.10.1.p2/src/modules//lapack.so':
  ld.so.1: R: fatal: relocation error: file /home/palmieri/mark2/sage-4.5.2.rc0/local/lib//liblapack.so: symbol __powisf2: referenced symbol not found
Error in solve.default(rgb) : lapack routines cannot be loaded
Error: unable to load R code in package 'grDevices'
Execution halted
```



---

archive/issue_comments_082167.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@jhpalmieri](#comment:10):\n> > Let me know how your build goes. My 32-bit SPARC build did not work, so I'd be interested in how you get on with 32-bit builds on SPARC.\n\n> \n> On mark2, it claims to have built successfully with SAGE_CHECK='yes'.  On the other hand, when building from scratch on mark2, while ATLAS seems to build okay, the R build fails:\n> \n> ```\n> Warning in solve.default(rgb) :\n>   unable to load shared library '/home/palmieri/mark2/sage-4.5.2.rc0/spkg/build/r-2.10.1.p2/src/modules//lapack.so':\n>   ld.so.1: R: fatal: relocation error: file /home/palmieri/mark2/sage-4.5.2.rc0/local/lib//liblapack.so: symbol __powisf2: referenced symbol not found\n> Error in solve.default(rgb) : lapack routines cannot be loaded\n> Error: unable to load R code in package 'grDevices'\n> Execution halted\n> ```\n\nYes, I think that was the problem I got. Strange, on a 64-bit SPARC build I was able to get Sage to build completely. I'm not sure if I used that ATLAS package, or just made the libraries manually. \n\nWithout creating the shared libraries, Linbox will not link - complains ATLAS is missing. Inspect of the linbox log file shows it thinks the ATLAS libraries are 32-bit. I need to check that, as potentially linbox is mistaken. \n\nIt's hard to know if this is a Linbox, ATLAS or R problem. The R manual (http://cran.r-project.org/doc/manuals/R-admin.pdf) might have something on this. \n\nAdding an spkg-check file to Linbox might be useful, as we could test the ATLAS library with Linbox. It does have a test suite, but since there is no spkg-check file, it never gets executed. \n\nI created ticket some time back to fix the lack of a test suite in linbox - #9613. I'll create one for that today. It should be easy to review and might help debug this. If linbox passes tests on 64-bit with the ATLAS library, I would tend to suspect R is at fault. Conversely if tests fail, I would tend to suspect ATLAS. \n\nDave",
    "created_at": "2010-08-02T15:37:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82167",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@jhpalmieri](#comment:10):
> > Let me know how your build goes. My 32-bit SPARC build did not work, so I'd be interested in how you get on with 32-bit builds on SPARC.

> 
> On mark2, it claims to have built successfully with SAGE_CHECK='yes'.  On the other hand, when building from scratch on mark2, while ATLAS seems to build okay, the R build fails:
> 
> ```
> Warning in solve.default(rgb) :
>   unable to load shared library '/home/palmieri/mark2/sage-4.5.2.rc0/spkg/build/r-2.10.1.p2/src/modules//lapack.so':
>   ld.so.1: R: fatal: relocation error: file /home/palmieri/mark2/sage-4.5.2.rc0/local/lib//liblapack.so: symbol __powisf2: referenced symbol not found
> Error in solve.default(rgb) : lapack routines cannot be loaded
> Error: unable to load R code in package 'grDevices'
> Execution halted
> ```

Yes, I think that was the problem I got. Strange, on a 64-bit SPARC build I was able to get Sage to build completely. I'm not sure if I used that ATLAS package, or just made the libraries manually. 

Without creating the shared libraries, Linbox will not link - complains ATLAS is missing. Inspect of the linbox log file shows it thinks the ATLAS libraries are 32-bit. I need to check that, as potentially linbox is mistaken. 

It's hard to know if this is a Linbox, ATLAS or R problem. The R manual (http://cran.r-project.org/doc/manuals/R-admin.pdf) might have something on this. 

Adding an spkg-check file to Linbox might be useful, as we could test the ATLAS library with Linbox. It does have a test suite, but since there is no spkg-check file, it never gets executed. 

I created ticket some time back to fix the lack of a test suite in linbox - #9613. I'll create one for that today. It should be easy to review and might help debug this. If linbox passes tests on 64-bit with the ATLAS library, I would tend to suspect R is at fault. Conversely if tests fail, I would tend to suspect ATLAS. 

Dave



---

archive/issue_comments_082168.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\n> > Regarding the check \"x`uname -m`\" = xi86pc, does this guarantee Solaris or OpenSolaris somehow?\n\n> No, it guarantees the hardware is x86 based. That includes the 64-bit hardware. \n\nIgnore my question about guaranteeing Solaris or OpenSolaris; I was confused.  \n\nHowever, on a system like sage.math, uname -m outputs \"x86_64\".  The same happens with many of the other linux skynet machines. I've only seen the output \"i86pc\" on fulvia, an x86 machine running Solaris.  So if you have an x86 machine running Solaris, will it always print \"i86pc\" instead of \"x86_64\", for example?\n\nRegarding the problem on mark2 and elsewhere, maybe we should continue to not build the shared libraries?  If I have the time, I'll try rebuilding on mark2 and then delete the shared library after ATLAS has been installed, to see if R builds successfully after that.  If this works, I'm not sure what it means: is it an ATLAS problem or an R problem or something else?",
    "created_at": "2010-08-02T17:58:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82168",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

> > Regarding the check "x`uname -m`" = xi86pc, does this guarantee Solaris or OpenSolaris somehow?

> No, it guarantees the hardware is x86 based. That includes the 64-bit hardware. 

Ignore my question about guaranteeing Solaris or OpenSolaris; I was confused.  

However, on a system like sage.math, uname -m outputs "x86_64".  The same happens with many of the other linux skynet machines. I've only seen the output "i86pc" on fulvia, an x86 machine running Solaris.  So if you have an x86 machine running Solaris, will it always print "i86pc" instead of "x86_64", for example?

Regarding the problem on mark2 and elsewhere, maybe we should continue to not build the shared libraries?  If I have the time, I'll try rebuilding on mark2 and then delete the shared library after ATLAS has been installed, to see if R builds successfully after that.  If this works, I'm not sure what it means: is it an ATLAS problem or an R problem or something else?



---

archive/issue_comments_082169.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAs I commented on #9600, if on mark I just delete the shared library liblapack.so, then R builds successfully, as do the rest of the spkgs.  Doctesting is ongoing, but no failures yet.",
    "created_at": "2010-08-03T03:19:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82169",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:13" align="right">comment:13</div>

As I commented on #9600, if on mark I just delete the shared library liblapack.so, then R builds successfully, as do the rest of the spkgs.  Doctesting is ongoing, but no failures yet.



---

archive/issue_comments_082170.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nOn fulvia, 32-bit build, the old version of ATLAS fails to build, but this one succeeds.  With the new one, I have the same situation as with mark: R fails to build **unless I delete liblapack.so**. Then it succeeds.  Right now the Sage library is building; I'm curious about how many doctest failures I'll see.\n\nFor the record, I built on fulvia using Sage 4.5.2.rc1 + this ATLAS spkg + the singular 3-1-1-4 spkg from #8059.  Once the Sage library builds (assuming it builds successfully), I'll apply the Sage library patch from #8059 also.",
    "created_at": "2010-08-04T22:27:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82170",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:14" align="right">comment:14</div>

On fulvia, 32-bit build, the old version of ATLAS fails to build, but this one succeeds.  With the new one, I have the same situation as with mark: R fails to build **unless I delete liblapack.so**. Then it succeeds.  Right now the Sage library is building; I'm curious about how many doctest failures I'll see.

For the record, I built on fulvia using Sage 4.5.2.rc1 + this ATLAS spkg + the singular 3-1-1-4 spkg from #8059.  Once the Sage library builds (assuming it builds successfully), I'll apply the Sage library patch from #8059 also.



---

archive/issue_comments_082171.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@jhpalmieri](#comment:14):\n> On fulvia, 32-bit build, the old version of ATLAS fails to build, but this one succeeds.  With the new one, I have the same situation as with mark: R fails to build **unless I delete liblapack.so**. Then it succeeds.  \n\nWe will at some point need to run the R test suite, as there are reports in the R manual that R fails some tests if built with gcc. It's also reported R can't be built on Solaris 64-bit without the Sun compilers. \n\nThe Sage doctests don't really test R. But once we can get a Sage release that builds on fulvia without various hacks, it will be much easier to test. SAGE_CHECK can then be used to test R properly. \n\n> Right now the Sage library is building; I'm curious about how many doctest failures I'll see.\n\nThank you John.\n\nIt would be nice to understand the problem, but if all else fails, a bit of code that deletes `liblapack.so` on Solaris is trivial. \n\nI'd like to know if Linbox or ATLAS is at fault with Linbox believing the ATLAS library is 32-bit\u00a0when building 64-bit. ATLAS is clearly not 32-bit, since if you extract the objects with `ar -x foobar.a` all the object files are 64-bit. But perhaps there is something one needs to code into a static library to make it easier for software to realise the objects are 64-bit. I'll ask on comp.unix.solaris about this. \n\nIt is remotely possible that copying the 64-bit library to `$SAGE_LOCAL/lib/amd64` or `$SAGE_LOCAL/lib/sparcv9` will make Linbox look for the library. On Solaris, all 64-bit libraries should be in a `lib/amd64` or `lib/sparcv9` directory. That allows both 32-bit and 64-bit libraries to be on the same system. If you use the `file` command on the libraries in `/usr/lib`, you will see they are all 32-bit. In `/usr/lib/amd64` on x86 systems, or `/usr/lib/sparcv9` on SPARC system, you will see they are 64-bit. That might be a way of getting Linbox to behave. It might also be a way of getting R to behave, though I don't think the R problem is a 32-bit vs 64-bit issues, whereas the Linobx problem is. \n\n\n> For the record, I built on fulvia using Sage 4.5.2.rc1 + this ATLAS spkg + the singular 3-1-1-4 spkg from #8059.  Once the Sage library builds (assuming it builds successfully), I'll apply the Sage library patch from #8059 also.\n\nGreat. These systems seem to be coming together now. Most of the fixes for one variant of Solaris apply to the others too. I thought the Cygwin port would be completed before the other Solaris ports, but now I'm not so sure. I think its quite possible we could have Sage running 32-bit and 64-bit on both SPARC and x86 in the not too distant future. \n \nDave",
    "created_at": "2010-08-04T23:10:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82171",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@jhpalmieri](#comment:14):
> On fulvia, 32-bit build, the old version of ATLAS fails to build, but this one succeeds.  With the new one, I have the same situation as with mark: R fails to build **unless I delete liblapack.so**. Then it succeeds.  

We will at some point need to run the R test suite, as there are reports in the R manual that R fails some tests if built with gcc. It's also reported R can't be built on Solaris 64-bit without the Sun compilers. 

The Sage doctests don't really test R. But once we can get a Sage release that builds on fulvia without various hacks, it will be much easier to test. SAGE_CHECK can then be used to test R properly. 

> Right now the Sage library is building; I'm curious about how many doctest failures I'll see.

Thank you John.

It would be nice to understand the problem, but if all else fails, a bit of code that deletes `liblapack.so` on Solaris is trivial. 

I'd like to know if Linbox or ATLAS is at fault with Linbox believing the ATLAS library is 32-bit when building 64-bit. ATLAS is clearly not 32-bit, since if you extract the objects with `ar -x foobar.a` all the object files are 64-bit. But perhaps there is something one needs to code into a static library to make it easier for software to realise the objects are 64-bit. I'll ask on comp.unix.solaris about this. 

It is remotely possible that copying the 64-bit library to `$SAGE_LOCAL/lib/amd64` or `$SAGE_LOCAL/lib/sparcv9` will make Linbox look for the library. On Solaris, all 64-bit libraries should be in a `lib/amd64` or `lib/sparcv9` directory. That allows both 32-bit and 64-bit libraries to be on the same system. If you use the `file` command on the libraries in `/usr/lib`, you will see they are all 32-bit. In `/usr/lib/amd64` on x86 systems, or `/usr/lib/sparcv9` on SPARC system, you will see they are 64-bit. That might be a way of getting Linbox to behave. It might also be a way of getting R to behave, though I don't think the R problem is a 32-bit vs 64-bit issues, whereas the Linobx problem is. 


> For the record, I built on fulvia using Sage 4.5.2.rc1 + this ATLAS spkg + the singular 3-1-1-4 spkg from #8059.  Once the Sage library builds (assuming it builds successfully), I'll apply the Sage library patch from #8059 also.

Great. These systems seem to be coming together now. Most of the fixes for one variant of Solaris apply to the others too. I thought the Cygwin port would be completed before the other Solaris ports, but now I'm not so sure. I think its quite possible we could have Sage running 32-bit and 64-bit on both SPARC and x86 in the not too distant future. 
 
Dave



---

archive/issue_comments_082172.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\n> Great. These systems seem to be coming together now.\n\nThe 64-bit builds are causing trouble, but 32-bit Solaris on sparc works, while 32-bit Solaris on x86 seems very close.  As I've said on another ticket, I have no idea about OpenSolaris.",
    "created_at": "2010-08-04T23:16:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82172",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

> Great. These systems seem to be coming together now.

The 64-bit builds are causing trouble, but 32-bit Solaris on sparc works, while 32-bit Solaris on x86 seems very close.  As I've said on another ticket, I have no idea about OpenSolaris.



---

archive/issue_comments_082173.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@jhpalmieri](#comment:16):\n> > Great. These systems seem to be coming together now.\n\n> \n> The 64-bit builds are causing trouble, but 32-bit Solaris on sparc works, while 32-bit Solaris on x86 seems very close.  As I've said on another ticket, I have no idea about OpenSolaris.\n\nI can give you an account on my OpenSolaris box if you want. That's not a problem. It will be a lot faster than fulvia. \n\nI've created a version of ATLAS that does not build liblapack.so. I've **not** overwritten the one in my *patches* subdirectory, but put this in my home directory on boxen. Hence this can be found at \n\nhttp://boxen.math.washington.edu/home/kirkby/atlas-3.8.3.p13.spkg # does NOT build liblapack.so \n\nwhereas the other one, which build liblapack.so is at \n\nhttp://boxen.math.washington.edu/home/kirkby/patches/atlas-3.8.3.p13.spkg # DOES build liblapack.so",
    "created_at": "2010-08-04T23:39:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82173",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@jhpalmieri](#comment:16):
> > Great. These systems seem to be coming together now.

> 
> The 64-bit builds are causing trouble, but 32-bit Solaris on sparc works, while 32-bit Solaris on x86 seems very close.  As I've said on another ticket, I have no idea about OpenSolaris.

I can give you an account on my OpenSolaris box if you want. That's not a problem. It will be a lot faster than fulvia. 

I've created a version of ATLAS that does not build liblapack.so. I've **not** overwritten the one in my *patches* subdirectory, but put this in my home directory on boxen. Hence this can be found at 

http://boxen.math.washington.edu/home/kirkby/atlas-3.8.3.p13.spkg # does NOT build liblapack.so 

whereas the other one, which build liblapack.so is at 

http://boxen.math.washington.edu/home/kirkby/patches/atlas-3.8.3.p13.spkg # DOES build liblapack.so



---

archive/issue_comments_082174.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nSince #9536 system_alias.py fixed problems with SAGE_ATLAS_LIB and was marged as atlas-3.8.3.p13.spkg, I needed to create a atlas-3.8.3.p14.spkg to avoid a name clash. \n\nThe changes made by  #9356 have not been reversed, as it is still necessary to check for liblapack.a, and not liblapack.so, as that's the one library that if built causes problems for R. \n\nThe new package can be found at \n\nhttp://boxen.math.washington.edu/home/kirkby/patches/atlas-3.8.3.p14.spkg\n\nI've leaving this as \"needs_info\" until such time as I have more fully tested this.",
    "created_at": "2010-08-10T11:40:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82174",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:18" align="right">comment:18</div>

Since #9536 system_alias.py fixed problems with SAGE_ATLAS_LIB and was marged as atlas-3.8.3.p13.spkg, I needed to create a atlas-3.8.3.p14.spkg to avoid a name clash. 

The changes made by  #9356 have not been reversed, as it is still necessary to check for liblapack.a, and not liblapack.so, as that's the one library that if built causes problems for R. 

The new package can be found at 

http://boxen.math.washington.edu/home/kirkby/patches/atlas-3.8.3.p14.spkg

I've leaving this as "needs_info" until such time as I have more fully tested this.



---

archive/issue_comments_082175.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -20,53 +20,31 @@\n when the Sun linker was used on Solaris, which was not true on anything except 64-bit builds on Solaris or OpenSolaris. \n \n ## Shared libraries were deleted in `make_correct_shared.sh`\n-ATLAS's shared libraries are built on Linux, OS X and FreeBSD, but were deleted on Solaris due to the fact they did not work. I suspect the problem was they were never made correctly in the first place, as they appear to work if built correctly. \n+ATLAS's shared libraries are built on Linux, OS X and FreeBSD, but were deleted on Solaris due to the fact they did not work. I suspect the problem was they were never made correctly in the first place, as with the exception of liblapack.so, they appear to work if built correctly. \n \n-The original code has this. \n-\n- ```\n- # on Solaris a dynamic liblapack.so leads to import errors in numpy, so delete them for now.\n- if [ `uname` = \"SunOS\" ]; then\n-     echo \"Deleting liblapack.so on Solaris due to bug in numpy/scipy\"\n-     cd \"$SAGE_LOCAL\"/lib\n-     rm -rf liblapack.so*\n- fi\n- ```\n-\n-If the libraries are built correctly, with the following code, which loops though the libraries libatlas liblapack libf77blas and libcblas, the problem is solved. \n+If the libraries are built correctly, with the following code, which loops though the libraries libatlas libf77blas and libcblas, the problem is solved. \n \n ```\n-# Build dynamic libraries on Solaris, using the Sun equivalent of the GNU\n-# options above. Rather than call 'ld', the exact path to 'ld' is given\n-# since we know for 100% sure that 'ld' will reside in /usr/ccs/bin\n-# on Solaris - this is true of both Solaris 10 and OpenSolaris\n-# I'm not 100% sure if these options are optimal (there might be some\n-# unnecessary commands, but its the exact equivalent of the GNU\n-# commands above.\n-\n if [ \"x`uname`\" = xSunOS ]; then\n    cd \"$SAGE_LOCAL/lib\"\n \n-   if [ \"x$SAGE64\" = xyes ] ; then\n+   if [ \"x$SAGE64\" = xyes ] ; then \n       # To create a 64-bit shared library, the linker flag\n-      # '-64' must be added. Note this is not the same as\n+      # '-64' must be added. Note this is not the same as \n       # the compiler flag '-m64'\n-      LINKER_FLAG=-64\n+      LINKER_FLAG=-64 \n    fi\n \n-   # Build libatlas.so liblapack.so libf77blas.so and libcblas.so\n-   # Actually, libatlas.so and libcblas.so gets built from spkg-install,\n-   # but this is not working correctly for 64-bit libraries. Hence I simply\n+   # Build libatlas.so libf77blas.so and libcblas.so\n+   # Actually, libatlas.so and libcblas.so gets built from spkg-install, \n+   # but this is not working correctly for 64-bit libraries. Hence I simply \n    # remake those two libraries here. This is why 4 libraries are built\n-   # in this Solaris section, but only two are shown above for FreeBSD,\n-   # OS X and Linux.\n-\n-   for ATLAS_LIBRARY in libatlas liblapack libf77blas libcblas ; do\n-      echo \"Building shared library $ATLAS_LIBRARY.so from the static library $A\n-TLAS_LIBRARY.a\"\n-     /usr/ccs/bin/ld $LINKER_FLAG -L\"$SAGE_LOCAL/lib\"  -G -h $ATLAS_LIBRARY.so -\n-o $ATLAS_LIBRARY.so  -zallextract  $ATLAS_LIBRARY.a -zdefaultextract -lc -lm -lg\n-fortran\n+   # in this Solaris section, but only two are shown above for FreeBSD, \n+   # OS X and Linux. \n+      \n+   for ATLAS_LIBRARY in libatlas libf77blas libcblas ; do \n+      echo \"Building shared library $ATLAS_LIBRARY.so from the static library $ATLAS_LIBRARY.a\"\n+     /usr/ccs/bin/ld $LINKER_FLAG -L\"$SAGE_LOCAL/lib\"  -G -h $ATLAS_LIBRARY.so -o $ATLAS_LIBRARY.so  -zallextract  $ATLAS_LIBRARY.a -zdefaultextract -lc -lm -lgfortran\n       if [ $? -ne 0 ]; then\n          echo \"Failed to build ATLAS library $ATLAS_LIBRARY.so\"\n          exit 1\n@@ -74,10 +52,11 @@\n          echo \"$ATLAS_LIBRARY.so has been built on Solaris.\"\n       fi\n    done\n+   rm liblapack.so # liblapack.so causes problems with R on Solaris. \n fi\n ```\n \n-there is no need to delete them. This has the advantage that linbox can use the libraries - otherwise linbox reports ATLAS is not installed - see #9101. \n+This has the advantage that linbox can use the libraries - otherwise linbox reports ATLAS is not installed - see #9101. However, liblapack.so still presents problems if built with R, so that is not built. \n \n  == Link options not set correctly in spkg-install-script ==\n Code in `spkg-install-script` tried to change the linker option `-melf_x86_64` to `-64`, irrespective of type of Solaris or OpenSolaris system. In fact, this is only appropiate on 64-bit Solaris or OpenSolaris builds. On 32-bit builds, a similar option must just be deleted. On SPARC builds, there is no need to change the options at all, as ATLAS gets it right. \n@@ -100,3 +79,4 @@\n          mv makeinc Make.inc\n    fi\n ```\n+\n``````\n",
    "created_at": "2010-08-10T11:40:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82175",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -20,53 +20,31 @@
 when the Sun linker was used on Solaris, which was not true on anything except 64-bit builds on Solaris or OpenSolaris. 
 
 ## Shared libraries were deleted in `make_correct_shared.sh`
-ATLAS's shared libraries are built on Linux, OS X and FreeBSD, but were deleted on Solaris due to the fact they did not work. I suspect the problem was they were never made correctly in the first place, as they appear to work if built correctly. 
+ATLAS's shared libraries are built on Linux, OS X and FreeBSD, but were deleted on Solaris due to the fact they did not work. I suspect the problem was they were never made correctly in the first place, as with the exception of liblapack.so, they appear to work if built correctly. 
 
-The original code has this. 
-
- ```
- # on Solaris a dynamic liblapack.so leads to import errors in numpy, so delete them for now.
- if [ `uname` = "SunOS" ]; then
-     echo "Deleting liblapack.so on Solaris due to bug in numpy/scipy"
-     cd "$SAGE_LOCAL"/lib
-     rm -rf liblapack.so*
- fi
- ```
-
-If the libraries are built correctly, with the following code, which loops though the libraries libatlas liblapack libf77blas and libcblas, the problem is solved. 
+If the libraries are built correctly, with the following code, which loops though the libraries libatlas libf77blas and libcblas, the problem is solved. 
 
 ```
-# Build dynamic libraries on Solaris, using the Sun equivalent of the GNU
-# options above. Rather than call 'ld', the exact path to 'ld' is given
-# since we know for 100% sure that 'ld' will reside in /usr/ccs/bin
-# on Solaris - this is true of both Solaris 10 and OpenSolaris
-# I'm not 100% sure if these options are optimal (there might be some
-# unnecessary commands, but its the exact equivalent of the GNU
-# commands above.
-
 if [ "x`uname`" = xSunOS ]; then
    cd "$SAGE_LOCAL/lib"
 
-   if [ "x$SAGE64" = xyes ] ; then
+   if [ "x$SAGE64" = xyes ] ; then 
       # To create a 64-bit shared library, the linker flag
-      # '-64' must be added. Note this is not the same as
+      # '-64' must be added. Note this is not the same as 
       # the compiler flag '-m64'
-      LINKER_FLAG=-64
+      LINKER_FLAG=-64 
    fi
 
-   # Build libatlas.so liblapack.so libf77blas.so and libcblas.so
-   # Actually, libatlas.so and libcblas.so gets built from spkg-install,
-   # but this is not working correctly for 64-bit libraries. Hence I simply
+   # Build libatlas.so libf77blas.so and libcblas.so
+   # Actually, libatlas.so and libcblas.so gets built from spkg-install, 
+   # but this is not working correctly for 64-bit libraries. Hence I simply 
    # remake those two libraries here. This is why 4 libraries are built
-   # in this Solaris section, but only two are shown above for FreeBSD,
-   # OS X and Linux.
-
-   for ATLAS_LIBRARY in libatlas liblapack libf77blas libcblas ; do
-      echo "Building shared library $ATLAS_LIBRARY.so from the static library $A
-TLAS_LIBRARY.a"
-     /usr/ccs/bin/ld $LINKER_FLAG -L"$SAGE_LOCAL/lib"  -G -h $ATLAS_LIBRARY.so -
-o $ATLAS_LIBRARY.so  -zallextract  $ATLAS_LIBRARY.a -zdefaultextract -lc -lm -lg
-fortran
+   # in this Solaris section, but only two are shown above for FreeBSD, 
+   # OS X and Linux. 
+      
+   for ATLAS_LIBRARY in libatlas libf77blas libcblas ; do 
+      echo "Building shared library $ATLAS_LIBRARY.so from the static library $ATLAS_LIBRARY.a"
+     /usr/ccs/bin/ld $LINKER_FLAG -L"$SAGE_LOCAL/lib"  -G -h $ATLAS_LIBRARY.so -o $ATLAS_LIBRARY.so  -zallextract  $ATLAS_LIBRARY.a -zdefaultextract -lc -lm -lgfortran
       if [ $? -ne 0 ]; then
          echo "Failed to build ATLAS library $ATLAS_LIBRARY.so"
          exit 1
@@ -74,10 +52,11 @@
          echo "$ATLAS_LIBRARY.so has been built on Solaris."
       fi
    done
+   rm liblapack.so # liblapack.so causes problems with R on Solaris. 
 fi
 ```
 
-there is no need to delete them. This has the advantage that linbox can use the libraries - otherwise linbox reports ATLAS is not installed - see #9101. 
+This has the advantage that linbox can use the libraries - otherwise linbox reports ATLAS is not installed - see #9101. However, liblapack.so still presents problems if built with R, so that is not built. 
 
  == Link options not set correctly in spkg-install-script ==
 Code in `spkg-install-script` tried to change the linker option `-melf_x86_64` to `-64`, irrespective of type of Solaris or OpenSolaris system. In fact, this is only appropiate on 64-bit Solaris or OpenSolaris builds. On 32-bit builds, a similar option must just be deleted. On SPARC builds, there is no need to change the options at all, as ATLAS gets it right. 
@@ -100,3 +79,4 @@
          mv makeinc Make.inc
    fi
 ```
+
``````




---

archive/issue_comments_082176.json:
```json
{
    "body": "New patched, buased on atlas-3.8.3.p13 created on #9356. I've removed all previous patches, as they are not relevant and just add confusion.",
    "created_at": "2010-08-10T11:42:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82176",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

New patched, buased on atlas-3.8.3.p13 created on #9356. I've removed all previous patches, as they are not relevant and just add confusion.



---

archive/issue_events_122403.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-08-12T15:47:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9508#event-122403"
}
```



---

archive/issue_events_122404.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-08-12T15:47:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9508#event-122404"
}
```



---

archive/issue_comments_082177.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nAttachment: **[9508.patch.gz](https://github.com/sagemath/sage/files/ticket9508/9508.patch.gz)**\n\nI'm happy this ok now. \n\nNeeds review.",
    "created_at": "2010-08-12T15:47:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82177",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:19" align="right">comment:19</div>

Attachment: **[9508.patch.gz](https://github.com/sagemath/sage/files/ticket9508/9508.patch.gz)**

I'm happy this ok now. 

Needs review.



---

archive/issue_comments_082178.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI'm expecting this to be okay, but I'm testing it one last time.  I'm testing on t2 (32- and 64-bit), among other machines, so this will take a while...",
    "created_at": "2010-08-12T17:23:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82178",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:20" align="right">comment:20</div>

I'm expecting this to be okay, but I'm testing it one last time.  I'm testing on t2 (32- and 64-bit), among other machines, so this will take a while...



---

archive/issue_comments_082179.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2010-08-14T02:38:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82179",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri**



---

archive/issue_comments_082180.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nLooks good to me.  Tested on t2 (32 and 64 bit), sage.math, fulvia (32-bit), mark.",
    "created_at": "2010-08-14T02:38:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82180",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:21" align="right">comment:21</div>

Looks good to me.  Tested on t2 (32 and 64 bit), sage.math, fulvia (32-bit), mark.



---

archive/issue_events_122405.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-08-14T02:38:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9508#event-122405"
}
```



---

archive/issue_events_122406.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-08-14T02:38:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9508#event-122406"
}
```



---

archive/issue_events_122407.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-08-15T08:04:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9508#event-122407"
}
```



---

archive/issue_events_122408.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-08-15T08:04:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9508#event-122408"
}
```



---

archive/issue_comments_082181.json:
```json
{
    "body": "Merged: **sage-4.5.3.alpha0**",
    "created_at": "2010-08-15T08:04:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82181",
    "user": "https://github.com/qed777"
}
```

Merged: **sage-4.5.3.alpha0**



---

archive/issue_comments_082182.json:
```json
{
    "body": "Changed merged from **sage-4.5.3.alpha0** to **sage-4.5.3.alpha1**",
    "created_at": "2010-08-15T08:27:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9508#issuecomment-82182",
    "user": "https://github.com/qed777"
}
```

Changed merged from **sage-4.5.3.alpha0** to **sage-4.5.3.alpha1**
