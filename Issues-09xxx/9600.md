# Issue 9600: Fix atlas/liblapack.so linkage on FreeBSD

archive/issues_009600.json:
```json
{
    "body": "liblapack.so includes undefined references to __powidf2 and __powisf2, which are defined in libgcc (no other Sage shared libraries appear to rely on libgcc helper functions). Unfortunately, for reasons I don't fully understand, linking liblapack.so against libgcc.a fails, even when building a normal executable. The symptom is a message like:\n\nusr/local/bin/ld: _configtest: hidden symbol `__powidf2' in /usr/local/lib/gcc45/gcc/x86_64-portbld-freebsd8.1/4.5.1/libgcc.a(_powidf2.o) is referenced by DSO\n/usr/local/bin/ld: final link failed: Nonrepresentable section on output\n\nThe fix is to add a dependency on libgcc_s.so when (re-)building \nliblapack.so in make_correct_shared.sh.\n\nIt's not clear whether this is a defect in atlas or not - the liblapack.so used in Sage is custom-built for Sage and so this particular fix cannot be reported.\n\nAssignee: GeorgSWeber\n\nCC:  @jhpalmieri stephen @dimpase\n\nUpstream: None of the above - read trac for reasoning.\n\nReviewer: Dima Pasechnik\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/9600\n\n",
    "closed_at": "2020-09-27T13:06:22Z",
    "created_at": "2010-07-26T10:56:43Z",
    "labels": [
        "component: porting: bsd",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Fix atlas/liblapack.so linkage on FreeBSD",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9600",
    "user": "https://github.com/peterjeremy"
}
```
liblapack.so includes undefined references to __powidf2 and __powisf2, which are defined in libgcc (no other Sage shared libraries appear to rely on libgcc helper functions). Unfortunately, for reasons I don't fully understand, linking liblapack.so against libgcc.a fails, even when building a normal executable. The symptom is a message like:

usr/local/bin/ld: _configtest: hidden symbol `__powidf2' in /usr/local/lib/gcc45/gcc/x86_64-portbld-freebsd8.1/4.5.1/libgcc.a(_powidf2.o) is referenced by DSO
/usr/local/bin/ld: final link failed: Nonrepresentable section on output

The fix is to add a dependency on libgcc_s.so when (re-)building 
liblapack.so in make_correct_shared.sh.

It's not clear whether this is a defect in atlas or not - the liblapack.so used in Sage is custom-built for Sage and so this particular fix cannot be reported.

Assignee: GeorgSWeber

CC:  @jhpalmieri stephen @dimpase

Upstream: None of the above - read trac for reasoning.

Reviewer: Dima Pasechnik

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/9600





---

archive/issue_comments_109146.json:
```json
{
    "body": "<a id='comment:1'></a>\nAttachment [atlas-3.8.3.p12.patch](tarball://root/attachments/some-uuid/ticket9600/atlas-3.8.3.p12.patch) by @dimpase created at 2010-08-02 12:43:42\n\nThis does not seem to be FreeBSD-specific!\nSee http://groups.google.com/group/sage-devel/browse_thread/thread/4cfaff6722c62c9b",
    "created_at": "2010-08-02T12:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109146",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
Attachment [atlas-3.8.3.p12.patch](tarball://root/attachments/some-uuid/ticket9600/atlas-3.8.3.p12.patch) by @dimpase created at 2010-08-02 12:43:42

This does not seem to be FreeBSD-specific!
See http://groups.google.com/group/sage-devel/browse_thread/thread/4cfaff6722c62c9b



---

archive/issue_comments_109147.json:
```json
{
    "body": "Changing assignee from @peterjeremy to GeorgSWeber.",
    "created_at": "2010-08-02T16:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109147",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing assignee from @peterjeremy to GeorgSWeber.



---

archive/issue_comments_109148.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis could conceivably be related to an issue observed when building R as a 32-bit SPARC binary on 32-bit SPARC. Currently the ATLAS package deletes one shared libraires and does not make several other shared libraries, so there are a lot less libraries then on Linux. That caused an issue with Linbox, with it believing the static library was 32-bit, which it was not. \n\nWhen I tried to build all the libraries on Solaris, it causes a failure to build R on 32-bit SPARC. The error message \n\n```\n  ld.so.1: R: fatal: relocation error: file /home/palmieri/mark2/sage-4.5.2.rc0/local/lib//liblapack.so: symbol __powisf2: referenced symbol not found\n```\nSee about comment number 10 on #9508\n\nThis is not an identical message, but given FreeBSD will use a GNU linker and this uses a Sun linker, I would not rule out there being a connection. \n\nI set this from FreBSD -> Build, as it appears to be at least an issue on Linux too, and just possibly related to a Solaris one. \n\nPS,  Does anyone know how I can provide a link to a specific commitment on another track ticket?",
    "created_at": "2010-08-02T16:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109148",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:2'></a>
This could conceivably be related to an issue observed when building R as a 32-bit SPARC binary on 32-bit SPARC. Currently the ATLAS package deletes one shared libraires and does not make several other shared libraries, so there are a lot less libraries then on Linux. That caused an issue with Linbox, with it believing the static library was 32-bit, which it was not. 

When I tried to build all the libraries on Solaris, it causes a failure to build R on 32-bit SPARC. The error message 

```
  ld.so.1: R: fatal: relocation error: file /home/palmieri/mark2/sage-4.5.2.rc0/local/lib//liblapack.so: symbol __powisf2: referenced symbol not found
```
See about comment number 10 on #9508

This is not an identical message, but given FreeBSD will use a GNU linker and this uses a Sun linker, I would not rule out there being a connection. 

I set this from FreBSD -> Build, as it appears to be at least an issue on Linux too, and just possibly related to a Solaris one. 

PS,  Does anyone know how I can provide a link to a specific commitment on another track ticket?



---

archive/issue_events_036654.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "label": "component: build",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9600#event-36654"
}
```



---

archive/issue_comments_109149.json:
```json
{
    "body": "Changing status from new to needs_work.",
    "created_at": "2010-08-02T22:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109149",
    "user": "https://github.com/wjp"
}
```

Changing status from new to needs_work.



---

archive/issue_comments_109150.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis is very likely not the right way to fix this. I don't have the time to try this properly now, but I think using gcc as the linker to produce `liblapack.so` instead of ld directly should fix this:\n\n```\n[wjp@eno sage-4.5.2.rc0]$ ./sage -python\nPython 2.6.4 (r264:75706, Aug  1 2010, 12:24:29) \n[GCC 4.5.0] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import cvxopt.base\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nImportError: /home/wjp/eno/sage-4.5.2.rc0/local/lib/liblapack.so: undefined symbol: __powidf2\n>>> \n[wjp@eno sage-4.5.2.rc0]$ cd local/lib\n[wjp@eno lib]$ gcc -shared -o liblapack.so -Wl,-soname,liblapack.so -Wl,--whole-archive liblapack.a -Wl,--no-whole-archive\n[wjp@eno lib]$ cd ../..\n[wjp@eno sage-4.5.2.rc0]$ ./sage -python                                        Python 2.6.4 (r264:75706, Aug  1 2010, 12:24:29) \n[GCC 4.5.0] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import cvxopt.base\n>>> \n```\n\n(The gcc line above is adapted from the line in atlas' Make.lib where ld is used to produce `liblapack.so`.)",
    "created_at": "2010-08-02T22:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109150",
    "user": "https://github.com/wjp"
}
```

<a id='comment:3'></a>
This is very likely not the right way to fix this. I don't have the time to try this properly now, but I think using gcc as the linker to produce `liblapack.so` instead of ld directly should fix this:

```
[wjp@eno sage-4.5.2.rc0]$ ./sage -python
Python 2.6.4 (r264:75706, Aug  1 2010, 12:24:29) 
[GCC 4.5.0] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import cvxopt.base
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ImportError: /home/wjp/eno/sage-4.5.2.rc0/local/lib/liblapack.so: undefined symbol: __powidf2
>>> 
[wjp@eno sage-4.5.2.rc0]$ cd local/lib
[wjp@eno lib]$ gcc -shared -o liblapack.so -Wl,-soname,liblapack.so -Wl,--whole-archive liblapack.a -Wl,--no-whole-archive
[wjp@eno lib]$ cd ../..
[wjp@eno sage-4.5.2.rc0]$ ./sage -python                                        Python 2.6.4 (r264:75706, Aug  1 2010, 12:24:29) 
[GCC 4.5.0] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import cvxopt.base
>>> 
```

(The gcc line above is adapted from the line in atlas' Make.lib where ld is used to produce `liblapack.so`.)



---

archive/issue_comments_109151.json:
```json
{
    "body": "<a id='comment:4'></a>\nSorry for the repeated comment, but it looks like the final ld line generating liblapack.so might also be in (the ironically named) `make_correct_shared.sh` in atlas.",
    "created_at": "2010-08-02T22:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109151",
    "user": "https://github.com/wjp"
}
```

<a id='comment:4'></a>
Sorry for the repeated comment, but it looks like the final ld line generating liblapack.so might also be in (the ironically named) `make_correct_shared.sh` in atlas.



---

archive/issue_comments_109152.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [wjp](#comment%3A3):\n> This is very likely not the right way to fix this. I don't have the time to try this properly now, but I think using gcc as the linker to produce `liblapack.so` instead of ld directly should fix this:\n\n\nsing gcc might well be a better solution. It would certainly avoid the issues seen with Solaris, where the linker options have to be changed depending on whether the Sun linker or the GNU linker are used. If one called the compiler directly, rather than the linker, this should be a non-issue, as gcc would know what options to send to the linker. \n\nIn ATLAS, mostly static libraries are built, and then these are converted to dynamic by the linker. I don't know if gcc can then convert a static library to a dynamic library. One might need to do that with the linker. \n\ndave",
    "created_at": "2010-08-02T22:36:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109152",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:5'></a>
Replying to [wjp](#comment%3A3):
> This is very likely not the right way to fix this. I don't have the time to try this properly now, but I think using gcc as the linker to produce `liblapack.so` instead of ld directly should fix this:


sing gcc might well be a better solution. It would certainly avoid the issues seen with Solaris, where the linker options have to be changed depending on whether the Sun linker or the GNU linker are used. If one called the compiler directly, rather than the linker, this should be a non-issue, as gcc would know what options to send to the linker. 

In ATLAS, mostly static libraries are built, and then these are converted to dynamic by the linker. I don't know if gcc can then convert a static library to a dynamic library. One might need to do that with the linker. 

dave



---

archive/issue_comments_109153.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [drkirkby](#comment%3A5):\n> In ATLAS, mostly static libraries are built, and then these are converted to dynamic by the linker. I don't know if gcc can then convert a static library to a dynamic library. One might need to do that with the linker. \n\n\nThe command I used in that quick test above does exactly that by using gcc as a frontend to the GNU linker.\n\n```\ngcc -shared -o liblapack.so -Wl,-soname,liblapack.so -Wl,--whole-archive liblapack.a -Wl,--no-whole-archive\n```\n\n(But I'm not claiming it's the perfect way to do it; it's just a proof of concept, not a well-researched solution.)",
    "created_at": "2010-08-02T22:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109153",
    "user": "https://github.com/wjp"
}
```

<a id='comment:6'></a>
Replying to [drkirkby](#comment%3A5):
> In ATLAS, mostly static libraries are built, and then these are converted to dynamic by the linker. I don't know if gcc can then convert a static library to a dynamic library. One might need to do that with the linker. 


The command I used in that quick test above does exactly that by using gcc as a frontend to the GNU linker.

```
gcc -shared -o liblapack.so -Wl,-soname,liblapack.so -Wl,--whole-archive liblapack.a -Wl,--no-whole-archive
```

(But I'm not claiming it's the perfect way to do it; it's just a proof of concept, not a well-researched solution.)



---

archive/issue_comments_109154.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [wjp](#comment%3A6):\n> Replying to [drkirkby](#comment%3A5):\n> > In ATLAS, mostly static libraries are built, and then these are converted to dynamic by the linker. I don't know if gcc can then convert a static library to a dynamic library. One might need to do that with the linker. \n\n> \n> The command I used in that quick test above does exactly that by using gcc as a frontend to the GNU linker.\n> \n> \n> ```\n> gcc -shared -o liblapack.so -Wl,-soname,liblapack.so -Wl,--whole-archive liblapack.a -Wl,--no-whole-archive\n> ```\n> \n> (But I'm not claiming it's the perfect way to do it; it's just a proof of concept, not a well-researched solution.)\n\n\nBut you are almost directly using the linker here, since you are passing options directly to the linker. Those options are not portable, as they are GNU-specific. Better still if gcc could handle this. \n\nI would actually be surprised if ATLAS does not have the ability to create the shared libraries, without one needing to mess around like this in a separate stage. That would be worth investigating - whether ATLAS can take care of all this.",
    "created_at": "2010-08-02T23:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109154",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:7'></a>
Replying to [wjp](#comment%3A6):
> Replying to [drkirkby](#comment%3A5):
> > In ATLAS, mostly static libraries are built, and then these are converted to dynamic by the linker. I don't know if gcc can then convert a static library to a dynamic library. One might need to do that with the linker. 

> 
> The command I used in that quick test above does exactly that by using gcc as a frontend to the GNU linker.
> 
> 
> ```
> gcc -shared -o liblapack.so -Wl,-soname,liblapack.so -Wl,--whole-archive liblapack.a -Wl,--no-whole-archive
> ```
> 
> (But I'm not claiming it's the perfect way to do it; it's just a proof of concept, not a well-researched solution.)


But you are almost directly using the linker here, since you are passing options directly to the linker. Those options are not portable, as they are GNU-specific. Better still if gcc could handle this. 

I would actually be surprised if ATLAS does not have the ability to create the shared libraries, without one needing to mess around like this in a separate stage. That would be worth investigating - whether ATLAS can take care of all this.



---

archive/issue_comments_109155.json:
```json
{
    "body": "<a id='comment:8'></a>\nThis idea looks better, if it works. Since static libs are just collections of object files, unpack the static library and then use gcc to create the shared library. \n\n```\nar -x mylib.a\ngcc -shared *.o -o mylib.so\n```\n\nI got that from this link\n\n\nhttp://www.tipcache.com/tip/Convert_a_static_library_%28.a%29_to_a_shared_object_%28.so%29_12.html",
    "created_at": "2010-08-02T23:31:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109155",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:8'></a>
This idea looks better, if it works. Since static libs are just collections of object files, unpack the static library and then use gcc to create the shared library. 

```
ar -x mylib.a
gcc -shared *.o -o mylib.so
```

I got that from this link


http://www.tipcache.com/tip/Convert_a_static_library_%28.a%29_to_a_shared_object_%28.so%29_12.html



---

archive/issue_comments_109156.json:
```json
{
    "body": "<a id='comment:9'></a>\nI'm attaching a small script, static2shared.sh, which I wrote, which will make shared libraries from the static ones. To build 64-bit shared libraries, the object files in the static library must be 64-bit ones and SAGE64 must be set to \"yes\". \n\nIt works on the libraries libatlas liblapack libf77blas & libcblas. You could trivially modify it to work with others. \n\nThis is what I get.\n\n```\ndrkirkby@hawk:~/sage-4.5.1/local/lib$ ./static2shared.sh\n\nChange to the directory $SAGE_LOCAL/lib before running this script\nit's only a test for now.\n\n\nBuilding a 64-bit shared library libatlas.so from the static library libatlas.a\nlibatlas.so has been built on SunOS\nlibatlas.so:\tELF 64-bit LSB dynamic lib AMD64 Version 1, dynamically linked, not stripped, no debugging information available\nBuilding a 64-bit shared library liblapack.so from the static library liblapack.a\nliblapack.so has been built on SunOS\nliblapack.so:\tELF 64-bit LSB dynamic lib AMD64 Version 1, dynamically linked, not stripped, no debugging information available\nBuilding a 64-bit shared library libf77blas.so from the static library libf77blas.a\nlibf77blas.so has been built on SunOS\nlibf77blas.so:\tELF 64-bit LSB dynamic lib AMD64 Version 1, dynamically linked, not stripped, no debugging information available\nBuilding a 64-bit shared library libcblas.so from the static library libcblas.a\nlibcblas.so has been built on SunOS\nlibcblas.so:\tELF 64-bit LSB dynamic lib AMD64 Version 1, dynamically linked, not stripped, no debugging information available\n```",
    "created_at": "2010-08-03T01:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109156",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:9'></a>
I'm attaching a small script, static2shared.sh, which I wrote, which will make shared libraries from the static ones. To build 64-bit shared libraries, the object files in the static library must be 64-bit ones and SAGE64 must be set to "yes". 

It works on the libraries libatlas liblapack libf77blas & libcblas. You could trivially modify it to work with others. 

This is what I get.

```
drkirkby@hawk:~/sage-4.5.1/local/lib$ ./static2shared.sh

Change to the directory $SAGE_LOCAL/lib before running this script
it's only a test for now.


Building a 64-bit shared library libatlas.so from the static library libatlas.a
libatlas.so has been built on SunOS
libatlas.so:	ELF 64-bit LSB dynamic lib AMD64 Version 1, dynamically linked, not stripped, no debugging information available
Building a 64-bit shared library liblapack.so from the static library liblapack.a
liblapack.so has been built on SunOS
liblapack.so:	ELF 64-bit LSB dynamic lib AMD64 Version 1, dynamically linked, not stripped, no debugging information available
Building a 64-bit shared library libf77blas.so from the static library libf77blas.a
libf77blas.so has been built on SunOS
libf77blas.so:	ELF 64-bit LSB dynamic lib AMD64 Version 1, dynamically linked, not stripped, no debugging information available
Building a 64-bit shared library libcblas.so from the static library libcblas.a
libcblas.so has been built on SunOS
libcblas.so:	ELF 64-bit LSB dynamic lib AMD64 Version 1, dynamically linked, not stripped, no debugging information available
```



---

archive/issue_comments_109157.json:
```json
{
    "body": "Test script to convert static to shared libs. Run from $SAGE_LOCAL/lib.",
    "created_at": "2010-08-03T01:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109157",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Test script to convert static to shared libs. Run from $SAGE_LOCAL/lib.



---

archive/issue_comments_109158.json:
```json
{
    "body": "<a id='comment:10'></a>\nAttachment [static2shared.sh](tarball://root/attachments/some-uuid/ticket9600/static2shared.sh) by @jhpalmieri created at 2010-08-03 02:21:43\n\nmpatel also [had a suggestion](http://trac.sagemath.org/sage_trac/ticket/9356#comment:7) about creating shared libraries.  I know nothing about this; how do these approaches compare?",
    "created_at": "2010-08-03T02:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109158",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>
Attachment [static2shared.sh](tarball://root/attachments/some-uuid/ticket9600/static2shared.sh) by @jhpalmieri created at 2010-08-03 02:21:43

mpatel also [had a suggestion](http://trac.sagemath.org/sage_trac/ticket/9356#comment:7) about creating shared libraries.  I know nothing about this; how do these approaches compare?



---

archive/issue_comments_109159.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [jhpalmieri](#comment%3A10):\n> mpatel also [had a suggestion](http://trac.sagemath.org/sage_trac/ticket/9356#comment:7) about creating shared libraries.  I know nothing about this; how do these approaches compare?\n\nHis solution again uses a lot of options that are specific to the GNU linker. I don't however know if those flags are optimal. My guess is that Michael wrote that bit of code in Sage now, and if I'm honest I would not be sure he did it right. For pure simplicity, what I put is hard to beat. Whether it works is another matter! \n\nDave",
    "created_at": "2010-08-03T02:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109159",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:11'></a>
Replying to [jhpalmieri](#comment%3A10):
> mpatel also [had a suggestion](http://trac.sagemath.org/sage_trac/ticket/9356#comment:7) about creating shared libraries.  I know nothing about this; how do these approaches compare?

His solution again uses a lot of options that are specific to the GNU linker. I don't however know if those flags are optimal. My guess is that Michael wrote that bit of code in Sage now, and if I'm honest I would not be sure he did it right. For pure simplicity, what I put is hard to beat. Whether it works is another matter! 

Dave



---

archive/issue_comments_109160.json:
```json
{
    "body": "<a id='comment:12'></a>\nThis may be a Solaris-specific comment: on mark (skynet machine, Solaris on sparc), I first built the version of ATLAS from #9508, but R refused to build -- see [my comment there](http://trac.sagemath.org/sage_trac/ticket/9508#comment:10).  I applied the script \"static2shared.sh: and got similar output to the above (`liblapack.so has been built on SunOS`, etc.), but R still doesn't build: same error as before:\n\n```\nWarning in solve.default(rgb) :\n  unable to load shared library '/home/palmieri/mark/sage-4.5.2.rc0-shared-script/spkg/build/r-2.1\\\n0.1.p2/src/modules//lapack.so':\n  ld.so.1: R: fatal: libgcc_s.so.1: open failed: No such file or directory\nError in solve.default(rgb) : lapack routines cannot be loaded\nError: unable to load R code in package 'grDevices'\nExecution halted\nmake[4]: *** [mklazy] Error 1\n```\n\nOn the other hand, if I built the version of ATLAS from #9508 and then just delete liblapack.so, everything seems to work.",
    "created_at": "2010-08-03T03:17:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109160",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
This may be a Solaris-specific comment: on mark (skynet machine, Solaris on sparc), I first built the version of ATLAS from #9508, but R refused to build -- see [my comment there](http://trac.sagemath.org/sage_trac/ticket/9508#comment:10).  I applied the script "static2shared.sh: and got similar output to the above (`liblapack.so has been built on SunOS`, etc.), but R still doesn't build: same error as before:

```
Warning in solve.default(rgb) :
  unable to load shared library '/home/palmieri/mark/sage-4.5.2.rc0-shared-script/spkg/build/r-2.1\
0.1.p2/src/modules//lapack.so':
  ld.so.1: R: fatal: libgcc_s.so.1: open failed: No such file or directory
Error in solve.default(rgb) : lapack routines cannot be loaded
Error: unable to load R code in package 'grDevices'
Execution halted
make[4]: *** [mklazy] Error 1
```

On the other hand, if I built the version of ATLAS from #9508 and then just delete liblapack.so, everything seems to work.



---

archive/issue_comments_109161.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [jhpalmieri](#comment%3A12):\n> This may be a Solaris-specific comment: on mark (skynet machine, Solaris on sparc), I first built the version of ATLAS from #9508, but R refused to build -- see [my comment there](http://trac.sagemath.org/sage_trac/ticket/9508#comment:10).  I applied the script \"static2shared.sh: and got similar output to the above (`liblapack.so has been built on SunOS`, etc.), but R still doesn't build: same error as before:\n> \n> ```\n> Warning in solve.default(rgb) :\n>   unable to load shared library '/home/palmieri/mark/sage-4.5.2.rc0-shared-script/spkg/build/r-2.1\\\n> 0.1.p2/src/modules//lapack.so':\n>   ld.so.1: R: fatal: libgcc_s.so.1: open failed: No such file or directory\n> Error in solve.default(rgb) : lapack routines cannot be loaded\n> Error: unable to load R code in package 'grDevices'\n> Execution halted\n> make[4]: *** [mklazy] Error 1\n> ```\n> \n> On the other hand, if I built the version of ATLAS from #9508 and then just delete liblapack.so, everything seems to work.\n\n\nWhen I used the ATLAS package at #9508 on a 32-bit SPARC build, it failed with this error message, which is remarkably similar to what Peter got on FreeBSD. In particualr, `powisf2` is specifically mentioned in both Peters and my error messages. \n\n```\nmake[6]: Entering directory `/export/home/drkirkby/redstart/32/sage-4.5.1/spkg/build/r-2.10.1.p3/src/src/library/grDevices'\nWarning in solve.default(rgb) :\n  unable to load shared library '/export/home/drkirkby/redstart/32/sage-4.5.1/spkg/build/r-2.10.1.p3/src/modules//lapack.so':\n  ld.so.1: /export/home/drkirkby/redstart/32/sage-4.5.1/spkg/build/r-2.10.1.p3/src/bin/exec/R: fatal: relocation error: file /export/h\nome/drkirkby/redstart/32/sage-4.5.1/local/lib//liblapack.so: symbol __powisf2: referenced symbol not found\nError in solve.default(rgb) : lapack routines cannot be loaded\nError: unable to load R code in package 'grDevices'\nExecution halted\nmake[6]: *** [mklazy] Error 1\n```\n\nWhen I used that script, I get:\n\n```\nMaking Sage/Python scripts relocatable...\nMaking script relocatable\nFinished installing rpy2-2.0.8.spkg\n\nreal    26m14.008s\nuser    22m45.228s\nsys     3m2.236s\nSuccessfully installed r-2.10.1.p3\n```\n\nIn other words, for me that script corrects the problem. I'd be very interested what it does for Peter, as he had the same error message as me. \n\nI've now got 80 packages installed, so are going to leave it running overnight, so the build will have finished when I wake up.",
    "created_at": "2010-08-03T03:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109161",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:13'></a>
Replying to [jhpalmieri](#comment%3A12):
> This may be a Solaris-specific comment: on mark (skynet machine, Solaris on sparc), I first built the version of ATLAS from #9508, but R refused to build -- see [my comment there](http://trac.sagemath.org/sage_trac/ticket/9508#comment:10).  I applied the script "static2shared.sh: and got similar output to the above (`liblapack.so has been built on SunOS`, etc.), but R still doesn't build: same error as before:
> 
> ```
> Warning in solve.default(rgb) :
>   unable to load shared library '/home/palmieri/mark/sage-4.5.2.rc0-shared-script/spkg/build/r-2.1\
> 0.1.p2/src/modules//lapack.so':
>   ld.so.1: R: fatal: libgcc_s.so.1: open failed: No such file or directory
> Error in solve.default(rgb) : lapack routines cannot be loaded
> Error: unable to load R code in package 'grDevices'
> Execution halted
> make[4]: *** [mklazy] Error 1
> ```
> 
> On the other hand, if I built the version of ATLAS from #9508 and then just delete liblapack.so, everything seems to work.


When I used the ATLAS package at #9508 on a 32-bit SPARC build, it failed with this error message, which is remarkably similar to what Peter got on FreeBSD. In particualr, `powisf2` is specifically mentioned in both Peters and my error messages. 

```
make[6]: Entering directory `/export/home/drkirkby/redstart/32/sage-4.5.1/spkg/build/r-2.10.1.p3/src/src/library/grDevices'
Warning in solve.default(rgb) :
  unable to load shared library '/export/home/drkirkby/redstart/32/sage-4.5.1/spkg/build/r-2.10.1.p3/src/modules//lapack.so':
  ld.so.1: /export/home/drkirkby/redstart/32/sage-4.5.1/spkg/build/r-2.10.1.p3/src/bin/exec/R: fatal: relocation error: file /export/h
ome/drkirkby/redstart/32/sage-4.5.1/local/lib//liblapack.so: symbol __powisf2: referenced symbol not found
Error in solve.default(rgb) : lapack routines cannot be loaded
Error: unable to load R code in package 'grDevices'
Execution halted
make[6]: *** [mklazy] Error 1
```

When I used that script, I get:

```
Making Sage/Python scripts relocatable...
Making script relocatable
Finished installing rpy2-2.0.8.spkg

real    26m14.008s
user    22m45.228s
sys     3m2.236s
Successfully installed r-2.10.1.p3
```

In other words, for me that script corrects the problem. I'd be very interested what it does for Peter, as he had the same error message as me. 

I've now got 80 packages installed, so are going to leave it running overnight, so the build will have finished when I wake up.



---

archive/issue_comments_109162.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [drkirkby](#comment%3A9):\n> I'm attaching a small script, static2shared.sh, which I wrote, which will make shared libraries from the static ones. To build 64-bit shared libraries, the object files in the static library must be 64-bit ones and SAGE64 must be set to \"yes\". \n> \n> It works on the libraries libatlas liblapack libf77blas & libcblas. You could trivially modify it to work with others. \n\n\nUnfortunately, I don't believe this works.\n\nThe libraries I already had installed report:\n\n```\nserver% LD_LIBRARY_PATH=/usr/local/lib/gcc45:$PWD ldd lib{atlas,lapack,f77blas,cblas}.so\nlibatlas.so:\n        libc.so.7 => /lib/libc.so.7 (0x800647000)\n        libm.so.5 => /lib/libm.so.5 (0x800877000)\nliblapack.so:\n        libc.so.7 => /lib/libc.so.7 (0x800647000)\n        libm.so.5 => /lib/libm.so.5 (0x800877000)\n        libgfortran.so.3 => /usr/local/lib/gcc45/libgfortran.so.3 (0x8014bd000)\n        libgcc_s.so.1 => /usr/local/lib/gcc45/libgcc_s.so.1 (0x8017a1000)\nlibf77blas.so:\n        libc.so.7 => /lib/libc.so.7 (0x800647000)\n        libm.so.5 => /lib/libm.so.5 (0x800877000)\n        libgfortran.so.3 => /usr/local/lib/gcc45/libgfortran.so.3 (0x800e1e000)\nlibcblas.so:\nserver%\n```\n\nAnd numpy config reports (in part):\n\n```\nC compiler: gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -O3 -Wall -Wstrict-prototypes -I/tank/obj/sage/sage-4.5/local/include -fPIC\n\ncompile options: '-c'\ngcc: _configtest.c\ngcc _configtest.o -L/tank/obj/sage/sage-4.5/local/lib -llapack -lf77blas -lcblas -latlas -o _configtest\nATLAS version 3.8.3 built by peter on Mon 26 Jul 2010 17:37:42 EST:\n   UNAME    : FreeBSD server.vk2pj.dyndns.org 8.1-PRERELEASE FreeBSD 8.1-PRERELEASE #5: Thu Jul 15 05:43:01 EST 2010     root@server.vk2pj.dyndns.org:/var/obj/usr/src/sys/server  amd64\n   INSTFLG  : -1 0 -a 1\n   ARCHDEFS : -DATL_OS_FreeBSD -DATL_ARCH_HAMMER -DATL_SSE3 -DATL_SSE2 -DATL_SSE1 -DATL_3DNow -DATL_USE64BITS -DATL_GAS_x8664\n   F2CDEFS  : -DAdd_ -DF77_INTEGER=int -DStringSunStyle\n   CACHEEDGE: 262144\n   F77      : /tank/obj/sage/sage-4.5/local/bin/sage_fortran, version GNU Fortran (GCC) 4.5.1 20100715 (prerelease)\n   F77FLAGS : -fomit-frame-pointer -mfpmath=387 -O2 -falign-loops=4 -fPIC -m64\n   SMC      : gcc, version gcc (GCC) 4.5.1 20100715 (prerelease)\n   SMCFLAGS : -fomit-frame-pointer -mfpmath=387 -O2 -falign-loops=4 -fPIC -m64\n   SKC      : gcc, version gcc (GCC) 4.5.1 20100715 (prerelease)\n   SKCFLAGS : -fomit-frame-pointer -mfpmath=387 -O2 -falign-loops=4 -fPIC -m64\nsuccess!\nremoving: _configtest.c _configtest.o _configtest\n  FOUND:\n    libraries = ['lapack', 'f77blas', 'cblas', 'atlas']\n    library_dirs = ['/tank/obj/sage/sage-4.5/local/lib']\n    language = f77\n    define_macros = [('ATLAS_INFO', '\"\\\\\"3.8.3\\\\\"\"')]\n    include_dirs = ['/tank/obj/sage/sage-4.5/local/include']\n```\n\nWhereas, after rebuilding the shared libraries with your script, I get:\n\n```\nserver% LD_LIBRARY_PATH=/usr/local/lib/gcc45:$PWD ldd lib{atlas,lapack,f77blas,cblas}.so\nlibatlas.so:\n        libc.so.7 => /lib/libc.so.7 (0x800647000)\nliblapack.so:\n        libc.so.7 => /lib/libc.so.7 (0x800647000)\nlibf77blas.so:\n        libc.so.7 => /lib/libc.so.7 (0x800647000)\nlibcblas.so:\n        libc.so.7 => /lib/libc.so.7 (0x800647000)\nserver%\n```\n\nAnd building numpy reports that it can't decode atlas info:\n\n```\nC compiler: gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -O3 -Wall -Wstrict-prototypes -I/tank/obj/sage/sage-4.5/local/include -fPIC\ncompile options: '-c'\ngcc: _configtest.c\ngcc _configtest.o -L/tank/obj/sage/sage-4.5/local/lib -llapack -lf77blas -lcblas -latlas -o _configtest/local/lib/liblapack.so: undefined reference to `_gfortran_concat_string'age-4.5/local/lib/liblapack.so: undefined reference to `csqrt'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `sqrt'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_st_write_done'age-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_transfer_integer'-4.5/local/lib/liblapack.so: undefined reference to `cabs'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `csqrtf'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `powf'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_cpu_time_4'e/sage-4.5/local/lib/libf77blas.so: undefined reference to `_gfortran_stop_numeric'age-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_pow_i4_i4'ge/sage-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_st_write'age/sage-4.5/local/lib/liblapack.so: undefined reference to `log'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `lroundf'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_compare_string'ge-4.5/local/lib/liblapack.so: undefined reference to `logf'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `cabsf'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `cosf'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `lround'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `pow'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `cexp'\n/tank/obj/sage/sage-4.5/local/lib/libf77blas.so: undefined reference to `_gfortran_transfer_character'5/local/lib/liblapack.so: undefined reference to `cos'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `cexpf'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `log10'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `log10f'\ncollect2: ld returned 1 exit status\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_concat_string'age-4.5/local/lib/liblapack.so: undefined reference to `csqrt'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `sqrt'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_st_write_done'age-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_transfer_integer'-4.5/local/lib/liblapack.so: undefined reference to `cabs'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `csqrtf'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `powf'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `log'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `lroundf'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_compare_string'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `logf'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `cabsf'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `cosf'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `lround'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `pow'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `cexp'\n/tank/obj/sage/sage-4.5/local/lib/libf77blas.so: undefined reference to `_gfortran_transfer_character'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `cos'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `cexpf'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `log10'\n/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `log10f'\ncollect2: ld returned 1 exit status\nfailure.\nremoving: _configtest.c _configtest.o\nStatus: 255\nOutput: \n  FOUND:\n    libraries = ['lapack', 'f77blas', 'cblas', 'atlas']\n    library_dirs = ['/tank/obj/sage/sage-4.5/local/lib']\n    language = f77\n    define_macros = [('NO_ATLAS_INFO', 2)]\n    include_dirs = ['/tank/obj/sage/sage-4.5/local/include']\n```",
    "created_at": "2010-08-03T09:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109162",
    "user": "https://github.com/peterjeremy"
}
```

<a id='comment:14'></a>
Replying to [drkirkby](#comment%3A9):
> I'm attaching a small script, static2shared.sh, which I wrote, which will make shared libraries from the static ones. To build 64-bit shared libraries, the object files in the static library must be 64-bit ones and SAGE64 must be set to "yes". 
> 
> It works on the libraries libatlas liblapack libf77blas & libcblas. You could trivially modify it to work with others. 


Unfortunately, I don't believe this works.

The libraries I already had installed report:

```
server% LD_LIBRARY_PATH=/usr/local/lib/gcc45:$PWD ldd lib{atlas,lapack,f77blas,cblas}.so
libatlas.so:
        libc.so.7 => /lib/libc.so.7 (0x800647000)
        libm.so.5 => /lib/libm.so.5 (0x800877000)
liblapack.so:
        libc.so.7 => /lib/libc.so.7 (0x800647000)
        libm.so.5 => /lib/libm.so.5 (0x800877000)
        libgfortran.so.3 => /usr/local/lib/gcc45/libgfortran.so.3 (0x8014bd000)
        libgcc_s.so.1 => /usr/local/lib/gcc45/libgcc_s.so.1 (0x8017a1000)
libf77blas.so:
        libc.so.7 => /lib/libc.so.7 (0x800647000)
        libm.so.5 => /lib/libm.so.5 (0x800877000)
        libgfortran.so.3 => /usr/local/lib/gcc45/libgfortran.so.3 (0x800e1e000)
libcblas.so:
server%
```

And numpy config reports (in part):

```
C compiler: gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -O3 -Wall -Wstrict-prototypes -I/tank/obj/sage/sage-4.5/local/include -fPIC

compile options: '-c'
gcc: _configtest.c
gcc _configtest.o -L/tank/obj/sage/sage-4.5/local/lib -llapack -lf77blas -lcblas -latlas -o _configtest
ATLAS version 3.8.3 built by peter on Mon 26 Jul 2010 17:37:42 EST:
   UNAME    : FreeBSD server.vk2pj.dyndns.org 8.1-PRERELEASE FreeBSD 8.1-PRERELEASE #5: Thu Jul 15 05:43:01 EST 2010     root@server.vk2pj.dyndns.org:/var/obj/usr/src/sys/server  amd64
   INSTFLG  : -1 0 -a 1
   ARCHDEFS : -DATL_OS_FreeBSD -DATL_ARCH_HAMMER -DATL_SSE3 -DATL_SSE2 -DATL_SSE1 -DATL_3DNow -DATL_USE64BITS -DATL_GAS_x8664
   F2CDEFS  : -DAdd_ -DF77_INTEGER=int -DStringSunStyle
   CACHEEDGE: 262144
   F77      : /tank/obj/sage/sage-4.5/local/bin/sage_fortran, version GNU Fortran (GCC) 4.5.1 20100715 (prerelease)
   F77FLAGS : -fomit-frame-pointer -mfpmath=387 -O2 -falign-loops=4 -fPIC -m64
   SMC      : gcc, version gcc (GCC) 4.5.1 20100715 (prerelease)
   SMCFLAGS : -fomit-frame-pointer -mfpmath=387 -O2 -falign-loops=4 -fPIC -m64
   SKC      : gcc, version gcc (GCC) 4.5.1 20100715 (prerelease)
   SKCFLAGS : -fomit-frame-pointer -mfpmath=387 -O2 -falign-loops=4 -fPIC -m64
success!
removing: _configtest.c _configtest.o _configtest
  FOUND:
    libraries = ['lapack', 'f77blas', 'cblas', 'atlas']
    library_dirs = ['/tank/obj/sage/sage-4.5/local/lib']
    language = f77
    define_macros = [('ATLAS_INFO', '"\\"3.8.3\\""')]
    include_dirs = ['/tank/obj/sage/sage-4.5/local/include']
```

Whereas, after rebuilding the shared libraries with your script, I get:

```
server% LD_LIBRARY_PATH=/usr/local/lib/gcc45:$PWD ldd lib{atlas,lapack,f77blas,cblas}.so
libatlas.so:
        libc.so.7 => /lib/libc.so.7 (0x800647000)
liblapack.so:
        libc.so.7 => /lib/libc.so.7 (0x800647000)
libf77blas.so:
        libc.so.7 => /lib/libc.so.7 (0x800647000)
libcblas.so:
        libc.so.7 => /lib/libc.so.7 (0x800647000)
server%
```

And building numpy reports that it can't decode atlas info:

```
C compiler: gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -O3 -Wall -Wstrict-prototypes -I/tank/obj/sage/sage-4.5/local/include -fPIC
compile options: '-c'
gcc: _configtest.c
gcc _configtest.o -L/tank/obj/sage/sage-4.5/local/lib -llapack -lf77blas -lcblas -latlas -o _configtest/local/lib/liblapack.so: undefined reference to `_gfortran_concat_string'age-4.5/local/lib/liblapack.so: undefined reference to `csqrt'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `sqrt'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_st_write_done'age-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_transfer_integer'-4.5/local/lib/liblapack.so: undefined reference to `cabs'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `csqrtf'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `powf'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_cpu_time_4'e/sage-4.5/local/lib/libf77blas.so: undefined reference to `_gfortran_stop_numeric'age-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_pow_i4_i4'ge/sage-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_st_write'age/sage-4.5/local/lib/liblapack.so: undefined reference to `log'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `lroundf'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_compare_string'ge-4.5/local/lib/liblapack.so: undefined reference to `logf'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `cabsf'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `cosf'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `lround'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `pow'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `cexp'
/tank/obj/sage/sage-4.5/local/lib/libf77blas.so: undefined reference to `_gfortran_transfer_character'5/local/lib/liblapack.so: undefined reference to `cos'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `cexpf'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `log10'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `log10f'
collect2: ld returned 1 exit status
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_concat_string'age-4.5/local/lib/liblapack.so: undefined reference to `csqrt'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `sqrt'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_st_write_done'age-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_transfer_integer'-4.5/local/lib/liblapack.so: undefined reference to `cabs'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `csqrtf'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `powf'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `log'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `lroundf'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `_gfortran_compare_string'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `logf'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `cabsf'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `cosf'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `lround'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `pow'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `cexp'
/tank/obj/sage/sage-4.5/local/lib/libf77blas.so: undefined reference to `_gfortran_transfer_character'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `cos'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `cexpf'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `log10'
/tank/obj/sage/sage-4.5/local/lib/liblapack.so: undefined reference to `log10f'
collect2: ld returned 1 exit status
failure.
removing: _configtest.c _configtest.o
Status: 255
Output: 
  FOUND:
    libraries = ['lapack', 'f77blas', 'cblas', 'atlas']
    library_dirs = ['/tank/obj/sage/sage-4.5/local/lib']
    language = f77
    define_macros = [('NO_ATLAS_INFO', 2)]
    include_dirs = ['/tank/obj/sage/sage-4.5/local/include']
```



---

archive/issue_comments_109163.json:
```json
{
    "body": "Attachment [static2shared-ver2.sh](tarball://root/attachments/some-uuid/ticket9600/static2shared-ver2.sh) by drkirkby created at 2010-08-03 09:53:55\n\nSecond version of script, which links maths and fortran libraries",
    "created_at": "2010-08-03T09:53:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109163",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Attachment [static2shared-ver2.sh](tarball://root/attachments/some-uuid/ticket9600/static2shared-ver2.sh) by drkirkby created at 2010-08-03 09:53:55

Second version of script, which links maths and fortran libraries



---

archive/issue_comments_109164.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [pjeremy](#comment%3A14):\n> Replying to [drkirkby](#comment%3A9):\n> > I'm attaching a small script, static2shared.sh, which I wrote, which will make shared libraries from the static ones. To build 64-bit shared libraries, the object files in the static library must be 64-bit ones and SAGE64 must be set to \"yes\". \n> > \n> > It works on the libraries libatlas liblapack libf77blas & libcblas. You could trivially modify it to work with others. \n\n> \n> Unfortunately, I don't believe this works.\n> And building numpy reports that it can't decode atlas info:\n> \n> ```\n> C compiler: gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -O3 -Wall -Wstrict-prototypes -I/tank/obj/sage/sage-4.5/local/include -fPIC\n> compile options: '-c'\n> gcc: _configtest.c\n> \n\n\nThank you for trying Peter. \n\nSince the failure reports\n{{{ gcc _configtest.o -L/tank/obj/sage/sage-4.5/local/lib -llapack -lf77blas -lcblas -latlas -o _configtest/local/lib/liblapack.so: undefined reference to `_gfortran_concat_string'age-4.5/local/lib/liblapack.so: undefined reference to `csqrt'\n}}}\n\nI thought it might be wise to link in the Fortran and maths libraries. I note this was done in the original code (at least for some libraries), but when I tried to build something with libraries, it worked OK without that, so I did not include them. I've attached a second version. Let me know how that works\n\nDave",
    "created_at": "2010-08-03T09:57:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109164",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:15'></a>
Replying to [pjeremy](#comment%3A14):
> Replying to [drkirkby](#comment%3A9):
> > I'm attaching a small script, static2shared.sh, which I wrote, which will make shared libraries from the static ones. To build 64-bit shared libraries, the object files in the static library must be 64-bit ones and SAGE64 must be set to "yes". 
> > 
> > It works on the libraries libatlas liblapack libf77blas & libcblas. You could trivially modify it to work with others. 

> 
> Unfortunately, I don't believe this works.
> And building numpy reports that it can't decode atlas info:
> 
> ```
> C compiler: gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -O3 -Wall -Wstrict-prototypes -I/tank/obj/sage/sage-4.5/local/include -fPIC
> compile options: '-c'
> gcc: _configtest.c
> 


Thank you for trying Peter. 

Since the failure reports
{{{ gcc _configtest.o -L/tank/obj/sage/sage-4.5/local/lib -llapack -lf77blas -lcblas -latlas -o _configtest/local/lib/liblapack.so: undefined reference to `_gfortran_concat_string'age-4.5/local/lib/liblapack.so: undefined reference to `csqrt'
}}}

I thought it might be wise to link in the Fortran and maths libraries. I note this was done in the original code (at least for some libraries), but when I tried to build something with libraries, it worked OK without that, so I did not include them. I've attached a second version. Let me know how that works

Dave



---

archive/issue_comments_109165.json:
```json
{
    "body": "<a id='comment:16'></a>\nAttachment [make_correct_shared.sh](tarball://root/attachments/some-uuid/ticket9600/make_correct_shared.sh) by @peterjeremy created at 2010-08-03 10:58:43\n\nReplying to [drkirkby](#comment%3A15):\n> I thought it might be wise to link in the Fortran and maths libraries. I note this was done in the original code (at least for some libraries), but when I tried to build something with libraries, it worked OK without that, so I did not include them. I've attached a second version. Let me know how that works\n\n\nAnd attached is my adapted variant of make_correct_shared.sh that basically replicates the shared library dependencies from the original.  I have cleaned up the overall structure but haven't touched the OS-X or Solaris since I don't know the correct OS-X incantation and am not sure whether the Solaris section is still valid (I suspect not).",
    "created_at": "2010-08-03T10:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109165",
    "user": "https://github.com/peterjeremy"
}
```

<a id='comment:16'></a>
Attachment [make_correct_shared.sh](tarball://root/attachments/some-uuid/ticket9600/make_correct_shared.sh) by @peterjeremy created at 2010-08-03 10:58:43

Replying to [drkirkby](#comment%3A15):
> I thought it might be wise to link in the Fortran and maths libraries. I note this was done in the original code (at least for some libraries), but when I tried to build something with libraries, it worked OK without that, so I did not include them. I've attached a second version. Let me know how that works


And attached is my adapted variant of make_correct_shared.sh that basically replicates the shared library dependencies from the original.  I have cleaned up the overall structure but haven't touched the OS-X or Solaris since I don't know the correct OS-X incantation and am not sure whether the Solaris section is still valid (I suspect not).



---

archive/issue_comments_109166.json:
```json
{
    "body": "<a id='comment:17'></a>\nWith static2shared-ver2.sh, I still can't build R on mark.",
    "created_at": "2010-08-03T16:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109166",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:17'></a>
With static2shared-ver2.sh, I still can't build R on mark.



---

archive/issue_comments_109167.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [wjp](#comment%3A6):\n> Replying to [drkirkby](#comment%3A5):\n> > In ATLAS, mostly static libraries are built, and then these are converted to dynamic by the linker. I don't know if gcc can then convert a static library to a dynamic library. One might need to do that with the linker. \n\n> \n> The command I used in that quick test above does exactly that by using gcc as a frontend to the GNU linker.\n> \n\n{{{\n gcc -shared -o liblapack.so -Wl,-soname,liblapack.so -Wl,--whole-archive liblapack.a -Wl,--no-whole-archive\n}}}\n> \n> (But I'm not claiming it's the perfect way to do it; it's just a proof of concept, not a well-researched solution.)\n\n\nI just rebuilt sage 4.5.1 on skynet's taurus, and can reproduce this bug.\nI also figured out why on that machine liblapack.so does not get built.\n\n(it took a while to figure out why:\nIn the part of the log related to Atlas building, the last mentioning of liblapack.so is as follows:\nld -L/home/dima/sage/taurus/sage-4.5.1/local/lib -shared -soname liblapack.so -o liblapack.so --whole-archive liblapack.a --no-whole-archive -lc -lm -lgfortran\nld: skipping incompatible /home/dima/sage/taurus/sage-4.5.1/local/lib/libgfortran.so when searching for -lgfortran\nld: cannot find -lgfortran\nSo this command fails, resulting in liblapack.so not being build.\n\nThe reason is that $SAGELOCAL/lib/libgfortran.so points to a wrong file, to\n/usr/local/gcc-4.5.1/x86_64-Linux-nehalem-fc/lib/libgfortran.so\ninstead of the proper one:\n/usr/local/gcc-4.5.1/x86_64-Linux-nehalem-fc/lib64/libgfortran.so\n\nThis is just a wrong setup of SAGE_FORTRAN_LIB in /usr/local/skynet_bash_profile for this machine. (I posted on this on sage-skynet, and it is now fixed)\n\nI fixed the link manually and  rebuilt the Atlas spkg, getting the liblapack.so)\n\nAs well, Willem Jan's gcc fix above cures the problem, seemingly.",
    "created_at": "2010-08-05T20:37:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109167",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
Replying to [wjp](#comment%3A6):
> Replying to [drkirkby](#comment%3A5):
> > In ATLAS, mostly static libraries are built, and then these are converted to dynamic by the linker. I don't know if gcc can then convert a static library to a dynamic library. One might need to do that with the linker. 

> 
> The command I used in that quick test above does exactly that by using gcc as a frontend to the GNU linker.
> 

{{{
 gcc -shared -o liblapack.so -Wl,-soname,liblapack.so -Wl,--whole-archive liblapack.a -Wl,--no-whole-archive
}}}
> 
> (But I'm not claiming it's the perfect way to do it; it's just a proof of concept, not a well-researched solution.)


I just rebuilt sage 4.5.1 on skynet's taurus, and can reproduce this bug.
I also figured out why on that machine liblapack.so does not get built.

(it took a while to figure out why:
In the part of the log related to Atlas building, the last mentioning of liblapack.so is as follows:
ld -L/home/dima/sage/taurus/sage-4.5.1/local/lib -shared -soname liblapack.so -o liblapack.so --whole-archive liblapack.a --no-whole-archive -lc -lm -lgfortran
ld: skipping incompatible /home/dima/sage/taurus/sage-4.5.1/local/lib/libgfortran.so when searching for -lgfortran
ld: cannot find -lgfortran
So this command fails, resulting in liblapack.so not being build.

The reason is that $SAGELOCAL/lib/libgfortran.so points to a wrong file, to
/usr/local/gcc-4.5.1/x86_64-Linux-nehalem-fc/lib/libgfortran.so
instead of the proper one:
/usr/local/gcc-4.5.1/x86_64-Linux-nehalem-fc/lib64/libgfortran.so

This is just a wrong setup of SAGE_FORTRAN_LIB in /usr/local/skynet_bash_profile for this machine. (I posted on this on sage-skynet, and it is now fixed)

I fixed the link manually and  rebuilt the Atlas spkg, getting the liblapack.so)

As well, Willem Jan's gcc fix above cures the problem, seemingly.



---

archive/issue_comments_109168.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [dimpase](#comment%3A18):\n> Replying to [wjp](#comment%3A6):\n> > Replying to [drkirkby](#comment%3A5):\n> > > In ATLAS, mostly static libraries are built, and then these are converted to dynamic by the linker. I don't know if gcc can then convert a static library to a dynamic library. One might need to do that with the linker. \n\n> > \n> > The command I used in that quick test above does exactly that by using gcc as a frontend to the GNU linker.\n> > \n\n> {{{\n>  gcc -shared -o liblapack.so -Wl,-soname,liblapack.so -Wl,--whole-archive liblapack.a -Wl,--no-whole-archive\n\n> }}}\n> > \n> > (But I'm not claiming it's the perfect way to do it; it's just a proof of concept, not a well-researched solution.)\n\n> \n> I just rebuilt sage 4.5.1 on skynet's taurus, and can reproduce this bug.\n\n\nrebuilt with gcc-4.5.1, that is...",
    "created_at": "2010-08-05T20:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109168",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>
Replying to [dimpase](#comment%3A18):
> Replying to [wjp](#comment%3A6):
> > Replying to [drkirkby](#comment%3A5):
> > > In ATLAS, mostly static libraries are built, and then these are converted to dynamic by the linker. I don't know if gcc can then convert a static library to a dynamic library. One might need to do that with the linker. 

> > 
> > The command I used in that quick test above does exactly that by using gcc as a frontend to the GNU linker.
> > 

> {{{
>  gcc -shared -o liblapack.so -Wl,-soname,liblapack.so -Wl,--whole-archive liblapack.a -Wl,--no-whole-archive

> }}}
> > 
> > (But I'm not claiming it's the perfect way to do it; it's just a proof of concept, not a well-researched solution.)

> 
> I just rebuilt sage 4.5.1 on skynet's taurus, and can reproduce this bug.


rebuilt with gcc-4.5.1, that is...



---

archive/issue_events_036655.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "label": "component: build",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9600#event-36655"
}
```



---

archive/issue_events_036656.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9600#event-36656"
}
```



---

archive/issue_events_036657.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9600#event-36657"
}
```



---

archive/issue_events_036658.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9600#event-36658"
}
```



---

archive/issue_events_036659.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9600#event-36659"
}
```



---

archive/issue_events_036660.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9600#event-36660"
}
```



---

archive/issue_events_036661.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9600#event-36661"
}
```



---

archive/issue_events_036662.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9600#event-36662"
}
```



---

archive/issue_events_036663.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-17T16:38:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9600#event-36663"
}
```



---

archive/issue_events_036664.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-17T16:38:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9600#event-36664"
}
```



---

archive/issue_comments_109169.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-08-17T16:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109169",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_109170.json:
```json
{
    "body": "<a id='comment:25'></a>\nOutdated spkg or build system ticket, should be closed",
    "created_at": "2020-08-17T16:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109170",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
Outdated spkg or build system ticket, should be closed



---

archive/issue_comments_109171.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-27T13:00:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109171",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_109172.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2020-09-27T13:00:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109172",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_events_036665.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-09-27T13:06:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9600#event-36665"
}
```



---

archive/issue_comments_109173.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2020-09-27T13:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9600#issuecomment-109173",
    "user": "https://github.com/fchapoton"
}
```

Resolution: invalid
