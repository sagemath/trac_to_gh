# Issue 9266: bug in global_integral_model for Elliptic Curves over Number Fields

archive/issues_009266.json:
```json
{
    "body": "The following illustrates the bug. It should be easy to fix.\n\n```\nsage: K.<s> = NumberField(x^2-5)\nsage: w = (1+s)/2\nsage: E = EllipticCurve(K,[2,w])\nsage: E.global_integral_model()\n...sage/schemes/elliptic_curves/ell_number_field.pyc in global_integral_model(self)\n    377                    ai = [ai[i]/pi**(e*[1,2,3,4,6][i]) for i in range(5)]\n    378         for z in ai:\n--> 379             assert z.denominator() == 1, \"bug in global_integral_model: %s\" % ai\n    380         return EllipticCurve(list(ai))\n    381\n\nTypeError: not all arguments converted during string formatting\n```\n\nSo there are two problems. One that the string is not correctly formatted, the other that it is raised. The latter, I believe, is just because the wrong thing is tested:\n\n```\nsage: w.denominator()\n2\nsage: w.is_integral()\nTrue\n```\n\n\nAssignee: @JohnCremona\n\nResolution: fixed\n\nAuthor: Chris Wuthrich\n\nReviewer: John Cremona\n\nMerged: sage-4.5.2.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/9266\n\n",
    "closed_at": "2010-07-20T07:17:51Z",
    "created_at": "2010-06-18T13:08:05Z",
    "labels": [
        "component: elliptic curves",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.5.2",
    "title": "bug in global_integral_model for Elliptic Curves over Number Fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9266",
    "user": "https://github.com/categorie"
}
```
The following illustrates the bug. It should be easy to fix.

```
sage: K.<s> = NumberField(x^2-5)
sage: w = (1+s)/2
sage: E = EllipticCurve(K,[2,w])
sage: E.global_integral_model()
...sage/schemes/elliptic_curves/ell_number_field.pyc in global_integral_model(self)
    377                    ai = [ai[i]/pi**(e*[1,2,3,4,6][i]) for i in range(5)]
    378         for z in ai:
--> 379             assert z.denominator() == 1, "bug in global_integral_model: %s" % ai
    380         return EllipticCurve(list(ai))
    381

TypeError: not all arguments converted during string formatting
```

So there are two problems. One that the string is not correctly formatted, the other that it is raised. The latter, I believe, is just because the wrong thing is tested:

```
sage: w.denominator()
2
sage: w.is_integral()
True
```


Assignee: @JohnCremona

Resolution: fixed

Author: Chris Wuthrich

Reviewer: John Cremona

Merged: sage-4.5.2.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/9266





---

archive/issue_comments_090758.json:
```json
{
    "body": "<a id='comment:1'></a>The test would be better written as\n\n```\nif not all([z.denominator()==1 for z in ai]):\n    raise error\n```\n\nThe problem with the string is that it worked when ai was a list, but now it's a tuple.\n\nI don't understand the last part -- what is w here?",
    "created_at": "2010-06-18T15:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9266#issuecomment-90758",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:1'></a>The test would be better written as

```
if not all([z.denominator()==1 for z in ai]):
    raise error
```

The problem with the string is that it worked when ai was a list, but now it's a tuple.

I don't understand the last part -- what is w here?



---

archive/issue_comments_090759.json:
```json
{
    "body": "<a id='comment:2'></a>*w* is the algebraic integer (1+sqrt(5))/2 and it is the coefficient of this integral Weierstrass equation. So this is a global_integral_model. We should not check if the denominator in some basis is 1, but rather if the coefficients are integers.",
    "created_at": "2010-06-18T16:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9266#issuecomment-90759",
    "user": "https://github.com/categorie"
}
```

<a id='comment:2'></a>*w* is the algebraic integer (1+sqrt(5))/2 and it is the coefficient of this integral Weierstrass equation. So this is a global_integral_model. We should not check if the denominator in some basis is 1, but rather if the coefficients are integers.



---

archive/issue_comments_090760.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:2 wuthrich]:\n> *w* is the algebraic integer (1+sqrt(5))/2 and it is the coefficient of this integral Weierstrass equation. So this is a global_integral_model. We should not check if the denominator in some basis is 1, but rather if the coefficients are integers.\n\n\nOK then so we should do \n\n```\nif not all([z.is_integral() for z in ai]):\n```\n\nI'm too busy writing lectures for SD22 to make the patch myself!",
    "created_at": "2010-06-18T16:47:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9266#issuecomment-90760",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'></a>Replying to [comment:2 wuthrich]:
> *w* is the algebraic integer (1+sqrt(5))/2 and it is the coefficient of this integral Weierstrass equation. So this is a global_integral_model. We should not check if the denominator in some basis is 1, but rather if the coefficients are integers.


OK then so we should do 

```
if not all([z.is_integral() for z in ai]):
```

I'm too busy writing lectures for SD22 to make the patch myself!



---

archive/issue_comments_090761.json:
```json
{
    "body": "<a id='comment:4'></a>That holds for me too :)\nWe will do it in California !\n\nSee you soon.",
    "created_at": "2010-06-18T16:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9266#issuecomment-90761",
    "user": "https://github.com/categorie"
}
```

<a id='comment:4'></a>That holds for me too :)
We will do it in California !

See you soon.



---

archive/issue_comments_090762.json:
```json
{
    "body": "Milestone sage-4.4.5 deleted",
    "created_at": "2010-06-22T04:36:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9266#issuecomment-90762",
    "user": "https://github.com/williamstein"
}
```

Milestone sage-4.4.5 deleted



---

archive/issue_events_022834.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-06-22T04:36:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9266",
    "milestone": "sage-4.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9266#event-22834"
}
```



---

archive/issue_comments_090763.json:
```json
{
    "body": "Attachment [trac_9266.patch](tarball://root/attachments/some-uuid/ticket9266/trac_9266.patch) by @categorie created at 2010-06-22 23:19:26\n\nexported against 4.4.4.alpha0",
    "created_at": "2010-06-22T23:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9266#issuecomment-90763",
    "user": "https://github.com/categorie"
}
```

Attachment [trac_9266.patch](tarball://root/attachments/some-uuid/ticket9266/trac_9266.patch) by @categorie created at 2010-06-22 23:19:26

exported against 4.4.4.alpha0



---

archive/issue_comments_090764.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-06-22T23:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9266#issuecomment-90764",
    "user": "https://github.com/categorie"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_090765.json:
```json
{
    "body": "<a id='comment:7'></a>Looks good and tests pass on 4.4.4.alpha0",
    "created_at": "2010-06-23T04:15:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9266#issuecomment-90765",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:7'></a>Looks good and tests pass on 4.4.4.alpha0



---

archive/issue_comments_090766.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-06-23T04:15:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9266#issuecomment-90766",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_022835.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-07-20T07:17:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9266",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9266#event-22835"
}
```



---

archive/issue_comments_090767.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-07-20T07:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9266#issuecomment-90767",
    "user": "https://github.com/qed777"
}
```

Resolution: fixed
