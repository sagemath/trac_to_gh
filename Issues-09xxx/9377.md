# Issue 9377: unable to coerce matrix over finite field into magma

archive/issues_009377.json:
```json
{
    "body": "\n```\nsage: F.<a>=GF(4)\nsage: m=matrix(2,[F(1),2,3,4])\nsage: magma(m) \n---------------------------------------------------------------------------\nTypeError  \n...\nTypeError: unable to coerce element into magma\n```\n\n**Author:** Kwankyu Lee\n\n**Reviewer:** Mariah Lenox\n\n**Merged:** sage-4.5.2.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/9377\n\n",
    "closed_at": "2010-07-22T08:21:35Z",
    "created_at": "2010-06-29T18:16:05Z",
    "labels": [
        "component: interfaces",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.5.2",
    "title": "unable to coerce matrix over finite field into magma",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9377",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

```
sage: F.<a>=GF(4)
sage: m=matrix(2,[F(1),2,3,4])
sage: magma(m) 
---------------------------------------------------------------------------
TypeError  
...
TypeError: unable to coerce element into magma
```

**Author:** Kwankyu Lee

**Reviewer:** Mariah Lenox

**Merged:** sage-4.5.2.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/9377





---

archive/issue_comments_103048.json:
```json
{
    "body": "<a id='comment:1'></a>\nI investigated a little bit. \n\n\nsage: m._magma_init_(Magma()) \n  --------------------------------------------------------------------------- \n AttributeError \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0Traceback (most recent  call \n last) \n... \n AttributeError: 'FiniteField_givaro' object has no attribute \n '_element_poly_repr' \n\n\nThe version of Magma on my system is \"V2.16-6\".",
    "created_at": "2010-06-30T06:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9377#issuecomment-103048",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:1'></a>
I investigated a little bit. 


sage: m._magma_init_(Magma()) 
  --------------------------------------------------------------------------- 
 AttributeError                            Traceback (most recent  call 
 last) 
... 
 AttributeError: 'FiniteField_givaro' object has no attribute 
 '_element_poly_repr' 


The version of Magma on my system is "V2.16-6".



---

archive/attachments_011900.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac#9377.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket9377/trac#9377.patch",
    "created_at": "2010-07-10T03:28:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9377",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/kwankyu"
}
```



---

archive/issue_comments_103049.json:
```json
{
    "body": "",
    "created_at": "2010-07-10T03:28:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9377#issuecomment-103049",
    "user": "https://github.com/kwankyu"
}
```





---

archive/issue_comments_103050.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe problem was with the finite field givaro implementation.",
    "created_at": "2010-07-10T03:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9377#issuecomment-103050",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:2'></a>
The problem was with the finite field givaro implementation.



---

archive/issue_comments_103051.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2010-07-10T03:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9377#issuecomment-103051",
    "user": "https://github.com/kwankyu"
}
```

**Changing status** from new to needs_review.



---

archive/issue_events_028415.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2010-07-10T03:30:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9377",
    "milestone": "sage-4.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9377#event-28415"
}
```



---

archive/issue_comments_103052.json:
```json
{
    "body": "**Changing author** from \"Mariah Lenox\" to \"Kwankyu Lee\".",
    "created_at": "2010-07-10T03:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9377#issuecomment-103052",
    "user": "https://github.com/kwankyu"
}
```

**Changing author** from "Mariah Lenox" to "Kwankyu Lee".



---

archive/issue_comments_103053.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2010-07-12T19:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9377#issuecomment-103053",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_103054.json:
```json
{
    "body": "<a id='comment:3'></a>\n\n```\nUsing magma-2.16-11, I get the following with this patch\n\neno% ./sage\n----------------------------------------------------------------------\n| Sage Version 4.4.4.1, Release Date: 2010-06-28                     |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nsage: F.<a>=GF(4)\nsage: m=matrix(2,[F(1),2,3,4])\nsage: magma(m)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/home/mariah/sage/sage-4.4.4.1-x86_64-Linux-core2-fc-trac9377/<ipython console> in <module>()\n\n/home/mariah/sage/sage-4.4.4.1-x86_64-Linux-core2-fc-trac9377/local/lib/python2.6/site-packages/sage/interfaces/magma.pyc in __call__(self, x, gens)\n    735             pass\n    736         \n--> 737         A = Expect.__call__(self, x)\n    738         if has_cache:\n    739             x._magma_cache[self] = A\n   1034             return self._coerce_from_special_method(x)\n\n/home/mariah/sage/sage-4.4.4.1-x86_64-Linux-core2-fc-trac9377/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc in __init__(self, parent, value, is_name, name)\n   1449             except (TypeError, KeyboardInterrupt, RuntimeError, ValueError), x:\n   1450                 self._session_number = -1\n-> 1451                 raise TypeError, x\n   1452         self._session_number = parent._session_number\n   1453 \n\nTypeError: Error evaluating Magma code.\nIN:_sage_[7]:=_sage_[3]![_sage_[4]!(1),_sage_[4]!(0),_sage_[4]!(1),_sage_[4]!(0)];\nOUT:\n>> _sage_[7]:=_sage_[3]![_sage_[4]!(1),_sage_[4]!(0),_sage_[4]!(1),_sage_[4]!(\n                       ^\nRuntime error in '!': Cannot coerce sequence element 1 into the coefficient ring\n\nsage: \n```",
    "created_at": "2010-07-12T19:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9377#issuecomment-103054",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

<a id='comment:3'></a>

```
Using magma-2.16-11, I get the following with this patch

eno% ./sage
----------------------------------------------------------------------
| Sage Version 4.4.4.1, Release Date: 2010-06-28                     |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
sage: F.<a>=GF(4)
sage: m=matrix(2,[F(1),2,3,4])
sage: magma(m)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/mariah/sage/sage-4.4.4.1-x86_64-Linux-core2-fc-trac9377/<ipython console> in <module>()

/home/mariah/sage/sage-4.4.4.1-x86_64-Linux-core2-fc-trac9377/local/lib/python2.6/site-packages/sage/interfaces/magma.pyc in __call__(self, x, gens)
    735             pass
    736         
--> 737         A = Expect.__call__(self, x)
    738         if has_cache:
    739             x._magma_cache[self] = A
   1034             return self._coerce_from_special_method(x)

/home/mariah/sage/sage-4.4.4.1-x86_64-Linux-core2-fc-trac9377/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc in __init__(self, parent, value, is_name, name)
   1449             except (TypeError, KeyboardInterrupt, RuntimeError, ValueError), x:
   1450                 self._session_number = -1
-> 1451                 raise TypeError, x
   1452         self._session_number = parent._session_number
   1453 

TypeError: Error evaluating Magma code.
IN:_sage_[7]:=_sage_[3]![_sage_[4]!(1),_sage_[4]!(0),_sage_[4]!(1),_sage_[4]!(0)];
OUT:
>> _sage_[7]:=_sage_[3]![_sage_[4]!(1),_sage_[4]!(0),_sage_[4]!(1),_sage_[4]!(
                       ^
Runtime error in '!': Cannot coerce sequence element 1 into the coefficient ring

sage: 
```



---

archive/attachments_011901.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac#9377_revised.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket9377/trac#9377_revised.patch",
    "created_at": "2010-07-13T01:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9377",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/kwankyu"
}
```



---

archive/issue_comments_103055.json:
```json
{
    "body": "contains the previous patch and more",
    "created_at": "2010-07-13T01:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9377#issuecomment-103055",
    "user": "https://github.com/kwankyu"
}
```

contains the previous patch and more



---

archive/issue_comments_103056.json:
```json
{
    "body": "<a id='comment:4'></a>\nSorry for the incomplete patch. The revised patch fixes another bug in Sage that caused the error.",
    "created_at": "2010-07-13T02:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9377#issuecomment-103056",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:4'></a>
Sorry for the incomplete patch. The revised patch fixes another bug in Sage that caused the error.



---

archive/issue_comments_103057.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-07-13T02:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9377#issuecomment-103057",
    "user": "https://github.com/kwankyu"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_103058.json:
```json
{
    "body": "**Reviewer:** Mariah Lenox",
    "created_at": "2010-07-13T19:15:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9377#issuecomment-103058",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

**Reviewer:** Mariah Lenox



---

archive/issue_comments_103059.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe revised patch fixes the reported problem.\n\nsage-4.4.4.1 with the revised patch passes all tests when I do \"make testlong\"\n\nsage-4.4.4.1 with the revised patch and using magma-2.16-11 has\nfewer doctest failures when I do \n\n```\n./sage -t -only_optional=magma devel/sage/sage \n```\nthan without the patch - and no new failures were introduced.\n\nPositive review!",
    "created_at": "2010-07-13T19:15:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9377#issuecomment-103059",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

<a id='comment:5'></a>
The revised patch fixes the reported problem.

sage-4.4.4.1 with the revised patch passes all tests when I do "make testlong"

sage-4.4.4.1 with the revised patch and using magma-2.16-11 has
fewer doctest failures when I do 

```
./sage -t -only_optional=magma devel/sage/sage 
```
than without the patch - and no new failures were introduced.

Positive review!



---

archive/issue_comments_103060.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2010-07-13T19:15:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9377#issuecomment-103060",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_103061.json:
```json
{
    "body": "<a id='comment:6'></a>\nMerged trac#9377_revised.patch in 4.5.2.alpha1.",
    "created_at": "2010-07-22T08:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9377#issuecomment-103061",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:6'></a>
Merged trac#9377_revised.patch in 4.5.2.alpha1.



---

archive/issue_comments_103062.json:
```json
{
    "body": "**Merged:** sage-4.5.2.alpha1",
    "created_at": "2010-07-22T08:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9377#issuecomment-103062",
    "user": "https://github.com/dandrake"
}
```

**Merged:** sage-4.5.2.alpha1



---

archive/issue_events_028416.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2010-07-22T08:21:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9377",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9377#event-28416"
}
```
