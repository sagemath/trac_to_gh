# Issue 9400: modify the NumberField constructor to pass in optional integer B such that all the internal pari routines will replace the discriminant by its gcd with B, making some things massively faster.

archive/issues_009400.json:
```json
{
    "assignees": [],
    "body": "Also:\n   \n* ReSTify residue class fields\n\n* massively optimize reduction modulo a prime (e.g., the first interesting example I tried, I got a speedup of a factor of 500,000!  Yes half a million times faster!). \n\nParts of this patch have been moved to #9764.\n\nApply only `9400_combined.patch` and apply it on top of the patches from #9343.  See also [http://wiki.sagemath.org/NewPARI](http://wiki.sagemath.org/NewPARI).\n\nAssignee: **@jdemeyer**\n\nCC:  @jdemeyer\n\nKeywords: **PARI number field**\n\nAuthor: **William Stein, Jeroen Demeyer**\n\nReviewer: **Jeroen Demeyer, John Cremona**\n\nMerged: **sage-4.6.alpha1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/9400_\n\n",
    "closed_at": "2010-09-15T10:39:38Z",
    "created_at": "2010-07-01T03:43:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "modify the NumberField constructor to pass in optional integer B such that all the internal pari routines will replace the discriminant by its gcd with B, making some things massively faster.",
    "type": "issue",
    "updated_at": "2010-09-19T10:47:26Z",
    "url": "https://github.com/sagemath/sage/issues/9400",
    "user": "https://github.com/williamstein"
}
```
Also:
   
* ReSTify residue class fields

* massively optimize reduction modulo a prime (e.g., the first interesting example I tried, I got a speedup of a factor of 500,000!  Yes half a million times faster!). 

Parts of this patch have been moved to #9764.

Apply only `9400_combined.patch` and apply it on top of the patches from #9343.  See also [http://wiki.sagemath.org/NewPARI](http://wiki.sagemath.org/NewPARI).

Assignee: **@jdemeyer**

CC:  @jdemeyer

Keywords: **PARI number field**

Author: **William Stein, Jeroen Demeyer**

Reviewer: **Jeroen Demeyer, John Cremona**

Merged: **sage-4.6.alpha1**

_Issue created by migration from https://trac.sagemath.org/ticket/9400_





---

archive/issue_events_109848.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-07-01T03:43:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "milestone_number": null,
    "milestone_title": "sage-4.5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9400#event-109848"
}
```



---

archive/issue_events_109849.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-07-01T03:43:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "component: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9400#event-109849"
}
```



---

archive/issue_events_109850.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-07-01T03:43:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9400#event-109850"
}
```



---

archive/issue_events_109851.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-07-01T03:43:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9400#event-109851"
}
```



---

archive/issue_comments_082199.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,7 @@\n+Also:\n+   \n+* ReSTify residue class fields\n \n+* massively optimize reduction modulo a prime (e.g., the first interesting example I tried, I got a speedup of a factor of 500,000!  Yes half a million times faster!). \n+\n+  \n``````\n",
    "created_at": "2010-07-01T05:54:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82199",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,7 @@
+Also:
+   
+* ReSTify residue class fields
 
+* massively optimize reduction modulo a prime (e.g., the first interesting example I tried, I got a speedup of a factor of 500,000!  Yes half a million times faster!). 
+
+  
``````




---

archive/issue_comments_082200.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,4 +4,7 @@\n \n * massively optimize reduction modulo a prime (e.g., the first interesting example I tried, I got a speedup of a factor of 500,000!  Yes half a million times faster!). \n \n+* implement hashing for number field ideals that isn't a stupid string repr, hence vastly faster\n+\n+* make number field ideals *not* print in reduced form; this will look uglier, but is massively faster and more sensible for any real applications, as people learned constantly at sage days 22.\n   \n``````\n",
    "created_at": "2010-07-01T05:56:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82200",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,4 +4,7 @@
 
 * massively optimize reduction modulo a prime (e.g., the first interesting example I tried, I got a speedup of a factor of 500,000!  Yes half a million times faster!). 
 
+* implement hashing for number field ideals that isn't a stupid string repr, hence vastly faster
+
+* make number field ideals *not* print in reduced form; this will look uglier, but is massively faster and more sensible for any real applications, as people learned constantly at sage days 22.
   
``````




---

archive/issue_comments_082201.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nExample of what this makes possible:\n\n```\n~wstein/bin/sagedb\n----------------------------------------------------------------------\n| Sage Version 4.4.4, Release Date: 2010-06-23                       |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nsage: R.<x> = QQ[]\nsage: f = (x^20 - 3*x^19 - 29*x^18 + 91*x^17 + 338*x^16 - 1130*x^15 -\n2023*x^14 +\n....: 7432*x^13 + 6558*x^12 - 28021*x^11 - 10909*x^10 + 61267*x^9 + 6954*x^8 -\n....: 74752*x^7 + 1407*x^6 + 46330*x^5 - 1087*x^4 - 12558*x^3 - 942*x^2 +\n....: 960*x + 148)\nsage: K.<a> = NumberField(f^2+2, maximize_at_primes=[2])\nsage: K.degree()\n40\nsage: time z = K.factor(2)\nCPU times: user 0.59 s, sys: 0.01 s, total: 0.60 s\nWall time: 0.60 s\nsage: time k = z[0][0].residue_field()\nCPU times: user 1.68 s, sys: 0.03 s, total: 1.71 s\nWall time: 1.98 s\nsage: time k(a^3+3)\nCPU times: user 0.01 s, sys: 0.00 s, total: 0.01 s\nWall time: 0.01 s\nabar^3 + 1\n```",
    "created_at": "2010-07-01T06:48:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82201",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:3" align="right">Comment 3</div>

Example of what this makes possible:

```
~wstein/bin/sagedb
----------------------------------------------------------------------
| Sage Version 4.4.4, Release Date: 2010-06-23                       |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
sage: R.<x> = QQ[]
sage: f = (x^20 - 3*x^19 - 29*x^18 + 91*x^17 + 338*x^16 - 1130*x^15 -
2023*x^14 +
....: 7432*x^13 + 6558*x^12 - 28021*x^11 - 10909*x^10 + 61267*x^9 + 6954*x^8 -
....: 74752*x^7 + 1407*x^6 + 46330*x^5 - 1087*x^4 - 12558*x^3 - 942*x^2 +
....: 960*x + 148)
sage: K.<a> = NumberField(f^2+2, maximize_at_primes=[2])
sage: K.degree()
40
sage: time z = K.factor(2)
CPU times: user 0.59 s, sys: 0.01 s, total: 0.60 s
Wall time: 0.60 s
sage: time k = z[0][0].residue_field()
CPU times: user 1.68 s, sys: 0.03 s, total: 1.71 s
Wall time: 1.98 s
sage: time k(a^3+3)
CPU times: user 0.01 s, sys: 0.00 s, total: 0.01 s
Wall time: 0.01 s
abar^3 + 1
```



---

archive/issue_events_109852.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-08-11T22:12:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9400#event-109852"
}
```



---

archive/issue_comments_082202.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nIt is clear from a very first look at the patch that this will massively conflict with #9343 (why did nobody point this out to me earlier???).  Personally, I would prefer to postpone the last two points of the description, i.e.\n\n* implement hashing for number field ideals that isn't a stupid string repr, hence vastly faster \n\n* make number field ideals *not* print in reduced form; this will look uglier, but is massively faster and more sensible for any real applications, as people learned constantly at sage days 22.\n\nand do them after #9343 is merged (I also want to change the hashing of PARI objects, see #9667).  Also, I'm personally not completely convinced about the best way to print NumberFieldIdeals (see also my post at sage-devel).",
    "created_at": "2010-08-12T06:23:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82202",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">Comment 5</div>

It is clear from a very first look at the patch that this will massively conflict with #9343 (why did nobody point this out to me earlier???).  Personally, I would prefer to postpone the last two points of the description, i.e.

* implement hashing for number field ideals that isn't a stupid string repr, hence vastly faster 

* make number field ideals *not* print in reduced form; this will look uglier, but is massively faster and more sensible for any real applications, as people learned constantly at sage days 22.

and do them after #9343 is merged (I also want to change the hashing of PARI objects, see #9667).  Also, I'm personally not completely convinced about the best way to print NumberFieldIdeals (see also my post at sage-devel).



---

archive/issue_comments_082203.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\n> It is clear from a very first look at the patch that this will massively conflict with #9343 (why \n\nI'm sure this will be easy to merge with #9343.  It's probably best to get 9343 in first, since it is much more difficult, then rebase the current patch against it.\n\n> I would prefer to postpone:  hashing, printing\n\nThe current hashing and printing setup is complete and total crap, and needs to be removed ASAP.  It renders number fields completely useless for any nontrivial applications that involve prime ideals. \n\n> Also, I'm personally not completely convinced about the best way to print \n\nI saw that.  I think the best solution is exactly what I implemented in the attached patch.  Hash based on gens (trivial, as a hash should be). Print in reduced form only in small trivial cases (by default), but allow the user to easily up the cutoff if they want, for some reason.",
    "created_at": "2010-08-12T11:15:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82203",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:6" align="right">Comment 6</div>

> It is clear from a very first look at the patch that this will massively conflict with #9343 (why 

I'm sure this will be easy to merge with #9343.  It's probably best to get 9343 in first, since it is much more difficult, then rebase the current patch against it.

> I would prefer to postpone:  hashing, printing

The current hashing and printing setup is complete and total crap, and needs to be removed ASAP.  It renders number fields completely useless for any nontrivial applications that involve prime ideals. 

> Also, I'm personally not completely convinced about the best way to print 

I saw that.  I think the best solution is exactly what I implemented in the attached patch.  Hash based on gens (trivial, as a hash should be). Print in reduced form only in small trivial cases (by default), but allow the user to easily up the cutoff if they want, for some reason.



---

archive/issue_comments_082204.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nReplying to [@williamstein](#comment%3A6):\n> I saw that.  I think the best solution is exactly what I implemented in the attached patch.  Hash based on gens (trivial, as a hash should be).\n\nWhy not hash based on the HNF representation, as I propsed in #9666?  I think this is more canonical than gens() and it is the native PARI format.",
    "created_at": "2010-08-12T17:16:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82204",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">Comment 7</div>

Replying to [@williamstein](#comment%3A6):
> I saw that.  I think the best solution is exactly what I implemented in the attached patch.  Hash based on gens (trivial, as a hash should be).

Why not hash based on the HNF representation, as I propsed in #9666?  I think this is more canonical than gens() and it is the native PARI format.



---

archive/issue_comments_082205.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nReplying to [@jdemeyer](#comment%3A7):\n> Replying to [@williamstein](#comment%3A6):\n> > I saw that.  I think the best solution is exactly what I implemented in the attached patch.  Hash based on gens (trivial, as a hash should be).\n\n> \n> Why not hash based on the HNF representation, as I propsed in #9666?  \n> I think this is more canonical than gens() and it is the native PARI format.\n\nCONS:\nI think number fields will frequently be relative extensions, and we'll also consider ideals both in the maximal order and in suborders.  Pari will likely have almost nothing to do with our general relative extensions (it's only currently used for relative extensions as a miserable crutch), and HNF doesn't apply for ideals in orders.\n\nPROS:\nWhen it works, hashing based on the HNF has the property that if I==J then hash(I) == hash(J).  That's a very good property to have.   With hashing of gens that fails. \n\nThus taken together, I'm OK with your proposal with the caveat that at some future time it has to be revisited for *relative* extensions.",
    "created_at": "2010-08-14T00:39:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82205",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:9" align="right">Comment 9</div>

Replying to [@jdemeyer](#comment%3A7):
> Replying to [@williamstein](#comment%3A6):
> > I saw that.  I think the best solution is exactly what I implemented in the attached patch.  Hash based on gens (trivial, as a hash should be).

> 
> Why not hash based on the HNF representation, as I propsed in #9666?  
> I think this is more canonical than gens() and it is the native PARI format.

CONS:
I think number fields will frequently be relative extensions, and we'll also consider ideals both in the maximal order and in suborders.  Pari will likely have almost nothing to do with our general relative extensions (it's only currently used for relative extensions as a miserable crutch), and HNF doesn't apply for ideals in orders.

PROS:
When it works, hashing based on the HNF has the property that if I==J then hash(I) == hash(J).  That's a very good property to have.   With hashing of gens that fails. 

Thus taken together, I'm OK with your proposal with the caveat that at some future time it has to be revisited for *relative* extensions.



---

archive/issue_comments_082206.json:
```json
{
    "body": "apply only this patch (which also addresses the referees issue with `__hash__`)",
    "created_at": "2010-08-14T00:57:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82206",
    "user": "https://github.com/williamstein"
}
```

apply only this patch (which also addresses the referees issue with `__hash__`)



---

archive/issue_comments_082207.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nAttachment: **[trac_9400.patch.gz](https://github.com/sagemath/sage/files/ticket9400/trac_9400.patch.gz)**\n\nOK, new patch up that changes __hash__.  It passes all doctests on sage.math.",
    "created_at": "2010-08-14T00:58:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82207",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:10" align="right">Comment 10</div>

Attachment: **[trac_9400.patch.gz](https://github.com/sagemath/sage/files/ticket9400/trac_9400.patch.gz)**

OK, new patch up that changes __hash__.  It passes all doctests on sage.math.



---

archive/issue_comments_082208.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nThe patch introduces an inconsistency:\n\n```\nsage: K.<a> = NumberField(x^3-7)\nsage: K.ideal(12*a + 5).factor()\n(Fractional ideal (101, a - 8)) * (Fractional ideal (11, a + 5))^2\n```\n\n```\nsage: K.<b> = NumberField(x^3-10001)\nsage: L.ideal(b+1).factor()\n(Fractional ideal (b + 1, 1667)) * (Fractional ideal (b + 1, 2)) * (Fractional ideal (b + 1, 3))\n```\n\nNote how the integer is printed first in the first case but last in the second case (and personally I find it clearer when the integer is put first).  Maybe the sorting and uniqueing should be done in the NumberFieldIdeal constructor instead of when the ideal is printed?",
    "created_at": "2010-08-14T22:36:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82208",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">Comment 11</div>

The patch introduces an inconsistency:

```
sage: K.<a> = NumberField(x^3-7)
sage: K.ideal(12*a + 5).factor()
(Fractional ideal (101, a - 8)) * (Fractional ideal (11, a + 5))^2
```

```
sage: K.<b> = NumberField(x^3-10001)
sage: L.ideal(b+1).factor()
(Fractional ideal (b + 1, 1667)) * (Fractional ideal (b + 1, 2)) * (Fractional ideal (b + 1, 3))
```

Note how the integer is printed first in the first case but last in the second case (and personally I find it clearer when the integer is put first).  Maybe the sorting and uniqueing should be done in the NumberFieldIdeal constructor instead of when the ideal is printed?



---

archive/issue_comments_082209.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\n> Note how the integer is printed first in the first case but last in the second case (and personally I find it clearer when the integer is put first).  Maybe the sorting and uniqueing should be done in the NumberFieldIdeal constructor instead of when the ideal is printed?\n\nWould that make any difference?  The difference above is that in one case the number field has a very small discriminant (-1323), and in the other it doesn't (-2700540027).   When the discriminant is small, then reduced generators are used for printing.   A solution could be to apply the sorting and \"uniquing\" in both cases before printing -- right now it is only applied in the case of large discriminant.",
    "created_at": "2010-08-15T17:16:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82209",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:12" align="right">Comment 12</div>

> Note how the integer is printed first in the first case but last in the second case (and personally I find it clearer when the integer is put first).  Maybe the sorting and uniqueing should be done in the NumberFieldIdeal constructor instead of when the ideal is printed?

Would that make any difference?  The difference above is that in one case the number field has a very small discriminant (-1323), and in the other it doesn't (-2700540027).   When the discriminant is small, then reduced generators are used for printing.   A solution could be to apply the sorting and "uniquing" in both cases before printing -- right now it is only applied in the case of large discriminant.



---

archive/issue_comments_082210.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nHi,\n\nI retract my comment.  The issue may be that sorting of elements of number fields is now useless.  Observe:\n\n```\nsage: L.<b> = NumberField(x^3-10001)\nsage: b+1 < L(1667)\nFalse\nsage: L(1667) < b + 1\nFalse\n```\nThus it doesn't matter *what* you do with sorting and uniquing the gens before or after -- there's no sensible ordering that will come out of this, unless elements of number fields get a total (non-algebraic) ordering.  I thought they had one. \n\nOh, now I remember -- there is a *major bug* in the way elements of number fields are ordered.  You can see this by looking at the code (I think Joel Mohler) wrote in number_field_element.pyx.  I fixed this a few weeks ago as part of the patch bomb #9541.   \n\nSo my advice is to not worry about sorting issues as part of *this* patch, but keep in mind that it is has to be fixed later.  I've opened ticket #9752 to fix this.",
    "created_at": "2010-08-15T17:46:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82210",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:13" align="right">Comment 13</div>

Hi,

I retract my comment.  The issue may be that sorting of elements of number fields is now useless.  Observe:

```
sage: L.<b> = NumberField(x^3-10001)
sage: b+1 < L(1667)
False
sage: L(1667) < b + 1
False
```
Thus it doesn't matter *what* you do with sorting and uniquing the gens before or after -- there's no sensible ordering that will come out of this, unless elements of number fields get a total (non-algebraic) ordering.  I thought they had one. 

Oh, now I remember -- there is a *major bug* in the way elements of number fields are ordered.  You can see this by looking at the code (I think Joel Mohler) wrote in number_field_element.pyx.  I fixed this a few weeks ago as part of the patch bomb #9541.   

So my advice is to not worry about sorting issues as part of *this* patch, but keep in mind that it is has to be fixed later.  I've opened ticket #9752 to fix this.



---

archive/issue_comments_082211.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nAlways using `gens()` for printing is also silly, because for larger degrees you can get something like:\n\n```\nsage: x=polygen(QQ); K.<a> = NumberField(x^8+x-1);\nsage: J1 = K.ideal(a+1); J2 = K.ideal(a+2); J = J1.intersection(J2)\nsage: J\nFractional ideal (a^2 + 249, -a^7 + 125, a + 2, a^3 + 8, a^4 + 237, -a^7 - a^6 + 189, a^7 + a^6 + a^5 + 96, 253)\n```\n\nIn my opinion, the best way would be to use `idealtwoelt()` for large discriminants instead of simply printing all generators (or alternatively: reduce the generators using `idealtwoelt()` in `__init__`).",
    "created_at": "2010-08-16T20:23:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82211",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">Comment 14</div>

Always using `gens()` for printing is also silly, because for larger degrees you can get something like:

```
sage: x=polygen(QQ); K.<a> = NumberField(x^8+x-1);
sage: J1 = K.ideal(a+1); J2 = K.ideal(a+2); J = J1.intersection(J2)
sage: J
Fractional ideal (a^2 + 249, -a^7 + 125, a + 2, a^3 + 8, a^4 + 237, -a^7 - a^6 + 189, a^7 + a^6 + a^5 + 96, 253)
```

In my opinion, the best way would be to use `idealtwoelt()` for large discriminants instead of simply printing all generators (or alternatively: reduce the generators using `idealtwoelt()` in `__init__`).



---

archive/issue_events_109853.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-08-16T20:23:22Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "milestone_number": null,
    "milestone_title": "sage-4.5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9400#event-109853"
}
```



---

archive/issue_events_109854.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-08-16T20:23:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "milestone_number": null,
    "milestone_title": "sage-4.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9400#event-109854"
}
```



---

archive/issue_comments_082212.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\n\n```\nOn Tue, Aug 17, 2010 at 5:03 PM, Chan-Ho Kim <chanho.math> wrote:\n> Dear William,\n> I think that there is a bug on trac 9400 patch.\n> My current SAGE is (SAGE 4.5.2 + trac 9400 patch only) in VM.\n> When I use `maximize_at_prime,'\n>\n> K.<a> = NumberField(x^6 + 9*x^5 - 8410*x^4 - 88580*x^3 + 18705368*x^2 +\n> 99820416*x - 12230355456, maximize_at_primes=[3]) ; K.primes_above(3)\n> this decomposition in K works as you mentioned.\n>\n> However, in this ``small'' number field\n>\n> F.<a> = NumberField(x^3 - x^2 - 24*x + 32, maximize_at_primes=[3]) ;\n> F.primes_above(3)\n> the low precision error occurs if I add `maximize_at_primes=[3].'\n\nThat's not a bug in maximize_at_primes or finding the primes above 3.   But it *is* an issue with *printing* the ideals out that it finds over 3.   Evidently, when printing is_principal is called on each ideal currently, and this leads to a problem.  This is not surprising, given that deciding whether or not an ideal is principal requires knowing the class group in general, and the equation order of F that you define above is not only deficient at 3.  You need to also maximize at 2.   See:\n\nsage: F.<a> = NumberField(x^3 - x^2 - 24*x + 32, maximize_at_primes=[2,3]) \nsage: F.primes_above(3)\n[Fractional ideal (-1/2*a^2 - 3/2*a + 5), Fractional ideal (-1/2*a^2 + 5/2*a - 1)]\n\nSo in short, this is not a bug.  If you try to compute with number fields and pass in the maximize_at_primes option, certain things can't possibly work.\n\nThat said, I'm not a big fan of how ideals print.  Maybe Jereon's suggestion -- just *always* print with the PARI 2-element representation -- is the way to go.  That might get around this problem. \n\n\n> BTW, I also have one more question:\n> Can I add `maximize_at_prime=[p]' in `hecke_eigenvalue_field()'?\n\nYou'll have to dive in and start hacking at the source code of Sage to do that....\n\n -- William\n```",
    "created_at": "2010-08-18T00:18:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82212",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:15" align="right">Comment 15</div>


```
On Tue, Aug 17, 2010 at 5:03 PM, Chan-Ho Kim <chanho.math> wrote:
> Dear William,
> I think that there is a bug on trac 9400 patch.
> My current SAGE is (SAGE 4.5.2 + trac 9400 patch only) in VM.
> When I use `maximize_at_prime,'
>
> K.<a> = NumberField(x^6 + 9*x^5 - 8410*x^4 - 88580*x^3 + 18705368*x^2 +
> 99820416*x - 12230355456, maximize_at_primes=[3]) ; K.primes_above(3)
> this decomposition in K works as you mentioned.
>
> However, in this ``small'' number field
>
> F.<a> = NumberField(x^3 - x^2 - 24*x + 32, maximize_at_primes=[3]) ;
> F.primes_above(3)
> the low precision error occurs if I add `maximize_at_primes=[3].'

That's not a bug in maximize_at_primes or finding the primes above 3.   But it *is* an issue with *printing* the ideals out that it finds over 3.   Evidently, when printing is_principal is called on each ideal currently, and this leads to a problem.  This is not surprising, given that deciding whether or not an ideal is principal requires knowing the class group in general, and the equation order of F that you define above is not only deficient at 3.  You need to also maximize at 2.   See:

sage: F.<a> = NumberField(x^3 - x^2 - 24*x + 32, maximize_at_primes=[2,3]) 
sage: F.primes_above(3)
[Fractional ideal (-1/2*a^2 - 3/2*a + 5), Fractional ideal (-1/2*a^2 + 5/2*a - 1)]

So in short, this is not a bug.  If you try to compute with number fields and pass in the maximize_at_primes option, certain things can't possibly work.

That said, I'm not a big fan of how ideals print.  Maybe Jereon's suggestion -- just *always* print with the PARI 2-element representation -- is the way to go.  That might get around this problem. 


> BTW, I also have one more question:
> Can I add `maximize_at_prime=[p]' in `hecke_eigenvalue_field()'?

You'll have to dive in and start hacking at the source code of Sage to do that....

 -- William
```



---

archive/issue_comments_082213.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nI am not familiar with `_pari_` and `_pari_init_`, but why does NumberField need `_pari_init_`?  Can't we add instead a `_pari_` method which returns `pari_nf()`?",
    "created_at": "2010-08-18T21:20:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82213",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">Comment 16</div>

I am not familiar with `_pari_` and `_pari_init_`, but why does NumberField need `_pari_init_`?  Can't we add instead a `_pari_` method which returns `pari_nf()`?



---

archive/issue_comments_082214.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nRebasing to #9343 will be easier if we seperate the \"maximize_at_primes part\" from the \"printing and hashing of ideals\" part.  So I will cut this patch in two pieces.",
    "created_at": "2010-08-18T21:26:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82214",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">Comment 17</div>

Rebasing to #9343 will be easier if we seperate the "maximize_at_primes part" from the "printing and hashing of ideals" part.  So I will cut this patch in two pieces.



---

archive/issue_comments_082215.json:
```json
{
    "body": "Patch for the \"maximize at primes\" part, rebased to sage-4.6.prealpha1 (see #9343)",
    "created_at": "2010-08-18T22:02:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82215",
    "user": "https://github.com/jdemeyer"
}
```

Patch for the "maximize at primes" part, rebased to sage-4.6.prealpha1 (see #9343)



---

archive/issue_comments_082216.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nAttachment: **[9400_maximize_at_primes.patch.gz](https://github.com/sagemath/sage/files/ticket9400/9400_maximize_at_primes.patch.gz)**",
    "created_at": "2010-08-18T22:03:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82216",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">Comment 18</div>

Attachment: **[9400_maximize_at_primes.patch.gz](https://github.com/sagemath/sage/files/ticket9400/9400_maximize_at_primes.patch.gz)**



---

archive/issue_comments_082217.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,4 @@\n \n * massively optimize reduction modulo a prime (e.g., the first interesting example I tried, I got a speedup of a factor of 500,000!  Yes half a million times faster!). \n \n-* implement hashing for number field ideals that isn't a stupid string repr, hence vastly faster\n-\n-* make number field ideals *not* print in reduced form; this will look uglier, but is massively faster and more sensible for any real applications, as people learned constantly at sage days 22.\n-  \n+Parts of this patch have been moved to #9764.\n``````\n",
    "created_at": "2010-08-18T22:03:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82217",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,4 @@
 
 * massively optimize reduction modulo a prime (e.g., the first interesting example I tried, I got a speedup of a factor of 500,000!  Yes half a million times faster!). 
 
-* implement hashing for number field ideals that isn't a stupid string repr, hence vastly faster
-
-* make number field ideals *not* print in reduced form; this will look uglier, but is massively faster and more sensible for any real applications, as people learned constantly at sage days 22.
-  
+Parts of this patch have been moved to #9764.
``````




---

archive/issue_comments_082218.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nI attached a big reviewer patch (to be applied on top of 9400_maximize_at_primes.patch) changing:\n* the PARI functions `nfbasis()` and `nfinit()`: document and fix implementation.\n* change `pari_nf()` to always use `integral_basis()` (this means that all the `maximize_at_primes` code can be moved out of `pari_nf()`).\n* rename `_compute_integral_basis` to `_pari_integral_basis` and don't convert from PARI to Sage.\n* make the code for CyclotomicField more analogous to NumberField_generic (such that only `_pari_integral_basis` needs to be specialized, not `integral_basis()`.\n\nSince the purpose of `_pari_init_()` is very unclear to me, I'm not sure what to do with that.",
    "created_at": "2010-08-20T15:48:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82218",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">Comment 19</div>

I attached a big reviewer patch (to be applied on top of 9400_maximize_at_primes.patch) changing:
* the PARI functions `nfbasis()` and `nfinit()`: document and fix implementation.
* change `pari_nf()` to always use `integral_basis()` (this means that all the `maximize_at_primes` code can be moved out of `pari_nf()`).
* rename `_compute_integral_basis` to `_pari_integral_basis` and don't convert from PARI to Sage.
* make the code for CyclotomicField more analogous to NumberField_generic (such that only `_pari_integral_basis` needs to be specialized, not `integral_basis()`.

Since the purpose of `_pari_init_()` is very unclear to me, I'm not sure what to do with that.



---

archive/issue_comments_082219.json:
```json
{
    "body": "Apply on top of 9400_maximize_at_primes.patc",
    "created_at": "2010-08-21T10:31:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82219",
    "user": "https://github.com/jdemeyer"
}
```

Apply on top of 9400_maximize_at_primes.patc



---

archive/issue_comments_082220.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nAttachment: **[9400_jd_review.patch.gz](https://github.com/sagemath/sage/files/ticket9400/9400_jd_review.patch.gz)**",
    "created_at": "2010-08-24T19:34:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82220",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">Comment 20</div>

Attachment: **[9400_jd_review.patch.gz](https://github.com/sagemath/sage/files/ticket9400/9400_jd_review.patch.gz)**



---

archive/issue_comments_082221.json:
```json
{
    "body": "Changed assignee from **@loefflerd** to **@jdemeyer**",
    "created_at": "2010-08-24T19:34:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82221",
    "user": "https://github.com/jdemeyer"
}
```

Changed assignee from **@loefflerd** to **@jdemeyer**



---

archive/issue_comments_082222.json:
```json
{
    "body": "Author: **William Stein, Jeroen Demeyer**",
    "created_at": "2010-08-24T19:34:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82222",
    "user": "https://github.com/jdemeyer"
}
```

Author: **William Stein, Jeroen Demeyer**



---

archive/issue_comments_082223.json:
```json
{
    "body": "Changed keywords from **** to **PARI number field**",
    "created_at": "2010-08-24T19:34:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82223",
    "user": "https://github.com/jdemeyer"
}
```

Changed keywords from **** to **PARI number field**



---

archive/issue_comments_082224.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nSince this ismarked \"needs review\" could the authors clarify which patches are up for review?  I assume it is \n\n```\n9400_maximize_at_primes.patch \nPatch for the \"maximize at primes\" part, rebased to sage-4.6.prealpha1 (see #9343)\n```\nand\n\n```\n9400_jd_review.patch \nApply on top of 9400_maximize_at_primes.patch\n```\nand not the first one.\n\nSecondly, since these patches have been merged into 4.6.prealpha3 which I have successfully built and tested, I reckon that the only (!) remaining task as a reviewer is to look at the code in the patch, with the additional explanations on the ticket, and approve (or otherwise, maybe) of it?\n\nI will try to do this before I go away on Friday for a week.  No promises...",
    "created_at": "2010-08-30T16:09:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82224",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:21" align="right">Comment 21</div>

Since this ismarked "needs review" could the authors clarify which patches are up for review?  I assume it is 

```
9400_maximize_at_primes.patch 
Patch for the "maximize at primes" part, rebased to sage-4.6.prealpha1 (see #9343)
```
and

```
9400_jd_review.patch 
Apply on top of 9400_maximize_at_primes.patch
```
and not the first one.

Secondly, since these patches have been merged into 4.6.prealpha3 which I have successfully built and tested, I reckon that the only (!) remaining task as a reviewer is to look at the code in the patch, with the additional explanations on the ticket, and approve (or otherwise, maybe) of it?

I will try to do this before I go away on Friday for a week.  No promises...



---

archive/issue_events_109855.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-08-30T16:33:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9400#event-109855"
}
```



---

archive/issue_events_109856.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-08-30T16:33:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9400#event-109856"
}
```



---

archive/issue_comments_082225.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer, William Stein, John Cremona**",
    "created_at": "2010-08-30T16:33:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82225",
    "user": "https://github.com/JohnCremona"
}
```

Reviewer: **Jeroen Demeyer, William Stein, John Cremona**



---

archive/issue_comments_082226.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nLooking at the 2nd and 3rd patches (separately) it looks very good to me.  For the benefit of others reading this, the essence of these patches (apart from some ReSTification) is to expose some additional functionality from the pari library to Sage, so that some computations can be mande very much faster (a *lot* faster!).\n\nI spotted a few minor issues in docstrings (numbers refer to the ones I see in the third patch):\n\n\n6451: second 'it' --> 'the'\n\n6466: should have a preceding #, or replace \":\" by \"::\" and insert a blank line after and change the preceding \"TESTS::\" to \"TESTS:\"\n\n6592: change \"TESTS::\" to \"TESTS:\"\n\nand also when I rebuilt the docs after \"sage -ba\"  (using 4.6.prealpha3) I got these ReST warnings:\n\n```\ndocstring of sage.libs.pari.gen:136: (WARNING/2) Literal block expected; none found.\n```\n\n```\ndocstring of sage.libs.pari.gen.gen.nfbasis:8: (WARNING/2) Definition list ends without a blank line; unexpected unindent.\n```\n\n```\ndocstring of sage.libs.pari.gen.gen.nfinit:19: (WARNING/2) Literal block expected; none found.\n```\n\nModulo these, a positive review is on offer.  Hence \"needs work\", but it is only trivial work.",
    "created_at": "2010-08-30T16:33:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82226",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:22" align="right">Comment 22</div>

Looking at the 2nd and 3rd patches (separately) it looks very good to me.  For the benefit of others reading this, the essence of these patches (apart from some ReSTification) is to expose some additional functionality from the pari library to Sage, so that some computations can be mande very much faster (a *lot* faster!).

I spotted a few minor issues in docstrings (numbers refer to the ones I see in the third patch):


6451: second 'it' --> 'the'

6466: should have a preceding #, or replace ":" by "::" and insert a blank line after and change the preceding "TESTS::" to "TESTS:"

6592: change "TESTS::" to "TESTS:"

and also when I rebuilt the docs after "sage -ba"  (using 4.6.prealpha3) I got these ReST warnings:

```
docstring of sage.libs.pari.gen:136: (WARNING/2) Literal block expected; none found.
```

```
docstring of sage.libs.pari.gen.gen.nfbasis:8: (WARNING/2) Definition list ends without a blank line; unexpected unindent.
```

```
docstring of sage.libs.pari.gen.gen.nfinit:19: (WARNING/2) Literal block expected; none found.
```

Modulo these, a positive review is on offer.  Hence "needs work", but it is only trivial work.



---

archive/issue_comments_082227.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nThanks John, I will take care of these issues when I have time.",
    "created_at": "2010-08-30T21:30:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82227",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">Comment 23</div>

Thanks John, I will take care of these issues when I have time.



---

archive/issue_comments_082228.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,3 +5,5 @@\n * massively optimize reduction modulo a prime (e.g., the first interesting example I tried, I got a speedup of a factor of 500,000!  Yes half a million times faster!). \n \n Parts of this patch have been moved to #9764.\n+\n+The patches which should be merged for this ticket are [9400_maximize_at_primes.patch](https://github.com/sagemath/sage/files/ticket9400/9400_maximize_at_primes.patch.gz) and [9400_jd_review.patch](https://github.com/sagemath/sage/files/ticket9400/9400_jd_review.patch.gz)\n``````\n",
    "created_at": "2010-08-30T21:33:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82228",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,3 +5,5 @@
 * massively optimize reduction modulo a prime (e.g., the first interesting example I tried, I got a speedup of a factor of 500,000!  Yes half a million times faster!). 
 
 Parts of this patch have been moved to #9764.
+
+The patches which should be merged for this ticket are [9400_maximize_at_primes.patch](https://github.com/sagemath/sage/files/ticket9400/9400_maximize_at_primes.patch.gz) and [9400_jd_review.patch](https://github.com/sagemath/sage/files/ticket9400/9400_jd_review.patch.gz)
``````




---

archive/issue_comments_082229.json:
```json
{
    "body": "Attachment: **[9400_docfix.patch.gz](https://github.com/sagemath/sage/files/ticket9400/9400_docfix.patch.gz)**\n\nApply on top of previous 2 patches, small documentation fixes",
    "created_at": "2010-09-05T12:41:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82229",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[9400_docfix.patch.gz](https://github.com/sagemath/sage/files/ticket9400/9400_docfix.patch.gz)**

Apply on top of previous 2 patches, small documentation fixes



---

archive/issue_events_109857.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-09-05T13:28:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9400#event-109857"
}
```



---

archive/issue_events_109858.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-09-05T13:28:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9400#event-109858"
}
```



---

archive/issue_comments_082230.json:
```json
{
    "body": "Changed reviewer from **Jeroen Demeyer, William Stein, John Cremona** to **Jeroen Demeyer, John Cremona**",
    "created_at": "2010-09-05T13:28:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82230",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Jeroen Demeyer, William Stein, John Cremona** to **Jeroen Demeyer, John Cremona**



---

archive/issue_comments_082231.json:
```json
{
    "body": "Attachment: **[9400_combined.patch.gz](https://github.com/sagemath/sage/files/ticket9400/9400_combined.patch.gz)**\n\nAll 3 patches combined (apply only this patch)",
    "created_at": "2010-09-05T16:34:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82231",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[9400_combined.patch.gz](https://github.com/sagemath/sage/files/ticket9400/9400_combined.patch.gz)**

All 3 patches combined (apply only this patch)



---

archive/issue_comments_082232.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,5 +5,3 @@\n * massively optimize reduction modulo a prime (e.g., the first interesting example I tried, I got a speedup of a factor of 500,000!  Yes half a million times faster!). \n \n Parts of this patch have been moved to #9764.\n-\n-The patches which should be merged for this ticket are [9400_maximize_at_primes.patch](https://github.com/sagemath/sage/files/ticket9400/9400_maximize_at_primes.patch.gz) and [9400_jd_review.patch](https://github.com/sagemath/sage/files/ticket9400/9400_jd_review.patch.gz)\n``````\n",
    "created_at": "2010-09-05T16:39:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82232",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,5 +5,3 @@
 * massively optimize reduction modulo a prime (e.g., the first interesting example I tried, I got a speedup of a factor of 500,000!  Yes half a million times faster!). 
 
 Parts of this patch have been moved to #9764.
-
-The patches which should be merged for this ticket are [9400_maximize_at_primes.patch](https://github.com/sagemath/sage/files/ticket9400/9400_maximize_at_primes.patch.gz) and [9400_jd_review.patch](https://github.com/sagemath/sage/files/ticket9400/9400_jd_review.patch.gz)
``````




---

archive/issue_comments_082233.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nI did all the changes requested by the reviewer.\n\nReplying to [@JohnCremona](#comment%3A22):\n> \n> ```\n> docstring of sage.libs.pari.gen:136: (WARNING/2) Literal block expected; none found.\n> ```\n\nThis belongs to #9636 and is fixed there.  The other warnings are fixed here.",
    "created_at": "2010-09-05T18:46:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82233",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">Comment 27</div>

I did all the changes requested by the reviewer.

Replying to [@JohnCremona](#comment%3A22):
> 
> ```
> docstring of sage.libs.pari.gen:136: (WARNING/2) Literal block expected; none found.
> ```

This belongs to #9636 and is fixed there.  The other warnings are fixed here.



---

archive/issue_comments_082234.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nHi,\n\nI tried to apply my patch to 4.5.2.rc0 and it works fine:\n\n```\nadding trac_9400.patch to series file\napplying trac_9400.patch\nnow at: trac_9400.patch\n```\n\nI tried to apply your patch (9400_combined.patch) and there are a massive number of rejects:\n\n```\nadding 9400_combined.patch to series file\napplying 9400_combined.patch\npatching file sage/libs/pari/gen.pyx\nHunk #1 succeeded at 6408 with fuzz 2 (offset -32 lines).\nHunk #4 FAILED at 6964\nHunk #5 FAILED at 6991\n2 out of 7 hunks FAILED -- saving rejects to file sage/libs/pari/gen.pyx.rej\npatching file sage/rings/number_field/number_field.py\nHunk #13 FAILED at 2870\nHunk #16 FAILED at 3727\n2 out of 25 hunks FAILED -- saving rejects to file sage/rings/number_field/number_field.py.rej\npatching file sage/rings/number_field/number_field_ideal_rel.py\nHunk #2 FAILED at 592\n1 out of 2 hunks FAILED -- saving rejects to file sage/rings/number_field/number_field_ideal_rel.py.rej\npatching file sage/rings/polynomial/polynomial_quotient_ring.py\nHunk #1 FAILED at 688\nHunk #2 FAILED at 1068\n2 out of 2 hunks FAILED -- saving rejects to file sage/rings/polynomial/polynomial_quotient_ring.py.rej\npatching file sage/rings/residue_field.pyx\nHunk #17 succeeded at 427 with fuzz 2 (offset 0 lines).\nHunk #18 succeeded at 444 with fuzz 2 (offset 0 lines).\nHunk #19 FAILED at 463\nHunk #26 succeeded at 572 with fuzz 1 (offset -1 lines).\nHunk #27 FAILED at 589\n2 out of 48 hunks FAILED -- saving rejects to file sage/rings/residue_field.pyx.rej\npatch failed, unable to continue (try -v)\npatch failed, rejects left in working dir\nerrors during apply, please fix and refresh 9400_combined.patch\n```",
    "created_at": "2010-09-07T16:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82234",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:28" align="right">Comment 28</div>

Hi,

I tried to apply my patch to 4.5.2.rc0 and it works fine:

```
adding trac_9400.patch to series file
applying trac_9400.patch
now at: trac_9400.patch
```

I tried to apply your patch (9400_combined.patch) and there are a massive number of rejects:

```
adding 9400_combined.patch to series file
applying 9400_combined.patch
patching file sage/libs/pari/gen.pyx
Hunk #1 succeeded at 6408 with fuzz 2 (offset -32 lines).
Hunk #4 FAILED at 6964
Hunk #5 FAILED at 6991
2 out of 7 hunks FAILED -- saving rejects to file sage/libs/pari/gen.pyx.rej
patching file sage/rings/number_field/number_field.py
Hunk #13 FAILED at 2870
Hunk #16 FAILED at 3727
2 out of 25 hunks FAILED -- saving rejects to file sage/rings/number_field/number_field.py.rej
patching file sage/rings/number_field/number_field_ideal_rel.py
Hunk #2 FAILED at 592
1 out of 2 hunks FAILED -- saving rejects to file sage/rings/number_field/number_field_ideal_rel.py.rej
patching file sage/rings/polynomial/polynomial_quotient_ring.py
Hunk #1 FAILED at 688
Hunk #2 FAILED at 1068
2 out of 2 hunks FAILED -- saving rejects to file sage/rings/polynomial/polynomial_quotient_ring.py.rej
patching file sage/rings/residue_field.pyx
Hunk #17 succeeded at 427 with fuzz 2 (offset 0 lines).
Hunk #18 succeeded at 444 with fuzz 2 (offset 0 lines).
Hunk #19 FAILED at 463
Hunk #26 succeeded at 572 with fuzz 1 (offset -1 lines).
Hunk #27 FAILED at 589
2 out of 48 hunks FAILED -- saving rejects to file sage/rings/residue_field.pyx.rej
patch failed, unable to continue (try -v)
patch failed, rejects left in working dir
errors during apply, please fix and refresh 9400_combined.patch
```



---

archive/issue_events_109859.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-09-07T16:14:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9400#event-109859"
}
```



---

archive/issue_events_109860.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-09-07T16:14:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9400#event-109860"
}
```



---

archive/issue_events_109861.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-09-07T16:34:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9400#event-109861"
}
```



---

archive/issue_events_109862.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-09-07T16:34:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9400#event-109862"
}
```



---

archive/issue_comments_082235.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,3 +5,5 @@\n * massively optimize reduction modulo a prime (e.g., the first interesting example I tried, I got a speedup of a factor of 500,000!  Yes half a million times faster!). \n \n Parts of this patch have been moved to #9764.\n+\n+Apply only `9400_combined.patch` and apply it on top of the patches from #9343.  See also [http://wiki.sagemath.org/NewPARI](http://wiki.sagemath.org/NewPARI).\n``````\n",
    "created_at": "2010-09-07T16:34:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82235",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,3 +5,5 @@
 * massively optimize reduction modulo a prime (e.g., the first interesting example I tried, I got a speedup of a factor of 500,000!  Yes half a million times faster!). 
 
 Parts of this patch have been moved to #9764.
+
+Apply only `9400_combined.patch` and apply it on top of the patches from #9343.  See also [http://wiki.sagemath.org/NewPARI](http://wiki.sagemath.org/NewPARI).
``````




---

archive/issue_comments_082236.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nReplying to [@williamstein](#comment%3A28):\n> I tried to apply your patch (9400_combined.patch) and there are a massive number of rejects:\n\nIt is meant to be applied after #9343, then it works fine.",
    "created_at": "2010-09-07T16:34:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82236",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">Comment 29</div>

Replying to [@williamstein](#comment%3A28):
> I tried to apply your patch (9400_combined.patch) and there are a massive number of rejects:

It is meant to be applied after #9343, then it works fine.



---

archive/issue_comments_082237.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nJohn, do Jeroen's most recent changes look good to you?",
    "created_at": "2010-09-09T11:12:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82237",
    "user": "https://github.com/qed777"
}
```

<div id="comment:30" align="right">Comment 30</div>

John, do Jeroen's most recent changes look good to you?



---

archive/issue_comments_082238.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nReplying to [@qed777](#comment%3A30):\n> John, do Jeroen's most recent changes look good to you?\n\nSorry for delay -- Jeroen has nudged me on this and I'll look at it as soon as I can, but I'm at a conference this week...",
    "created_at": "2010-09-09T14:39:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82238",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:31" align="right">Comment 31</div>

Replying to [@qed777](#comment%3A30):
> John, do Jeroen's most recent changes look good to you?

Sorry for delay -- Jeroen has nudged me on this and I'll look at it as soon as I can, but I'm at a conference this week...



---

archive/issue_comments_082239.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nReplying to [@qed777](#comment%3A30):\n> John, do Jeroen's most recent changes look good to you?\n\nThe new combined patch does look good.  It applies smoothly to 4.6.alpha0, and the docs (re)build with no warnings.  I am currently doing a full test just to make sure.  Will report back shortly.",
    "created_at": "2010-09-11T16:31:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82239",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:32" align="right">Comment 32</div>

Replying to [@qed777](#comment%3A30):
> John, do Jeroen's most recent changes look good to you?

The new combined patch does look good.  It applies smoothly to 4.6.alpha0, and the docs (re)build with no warnings.  I am currently doing a full test just to make sure.  Will report back shortly.



---

archive/issue_events_109863.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-09-11T16:43:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9400#event-109863"
}
```



---

archive/issue_events_109864.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-09-11T16:43:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9400#event-109864"
}
```



---

archive/issue_comments_082240.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nReplying to [@JohnCremona](#comment%3A32):\n> Replying to [@qed777](#comment%3A30):\n> > John, do Jeroen's most recent changes look good to you?\n\n> \n> The new combined patch does look good.  It applies smoothly to 4.6.alpha0, and the docs (re)build with no warnings.  I am currently doing a full test just to make sure.  Will report back shortly.\n\nAll (long) tests pass -- positive review.",
    "created_at": "2010-09-11T16:43:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82240",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:33" align="right">Comment 33</div>

Replying to [@JohnCremona](#comment%3A32):
> Replying to [@qed777](#comment%3A30):
> > John, do Jeroen's most recent changes look good to you?

> 
> The new combined patch does look good.  It applies smoothly to 4.6.alpha0, and the docs (re)build with no warnings.  I am currently doing a full test just to make sure.  Will report back shortly.

All (long) tests pass -- positive review.



---

archive/issue_events_109865.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-15T10:39:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9400#event-109865"
}
```



---

archive/issue_events_109866.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-15T10:39:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9400#event-109866"
}
```



---

archive/issue_comments_082241.json:
```json
{
    "body": "Merged: **sage-4.6.alpha1**",
    "created_at": "2010-09-15T10:39:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82241",
    "user": "https://github.com/qed777"
}
```

Merged: **sage-4.6.alpha1**



---

archive/issue_comments_082242.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nReplying to [@qed777](#comment%3A34):\n\nNote that I mentioned  in this ticket (and on [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/ff993da70fc9f7ac)) that I do not understand `_pari_init_()`. I don't know if the reviewers do, so I'm a little bit worried about this.",
    "created_at": "2010-09-19T10:47:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9400#issuecomment-82242",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:35" align="right">Comment 35</div>

Replying to [@qed777](#comment%3A34):

Note that I mentioned  in this ticket (and on [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/ff993da70fc9f7ac)) that I do not understand `_pari_init_()`. I don't know if the reviewers do, so I'm a little bit worried about this.
