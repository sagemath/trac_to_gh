# Issue 9798: Accelerate Polyhedron constructor and fix cddlib output ordering

archive/issues_009797.json:
```json
{
    "body": "I've run across some polytopes that can't be constructed in finite time because computing the facet and vertex adjacencies takes forever. Just computing the reduced H/V-representation takes just a few minutes. So I propose to **not** compute the adjacency data in the constructor, but only when needed. This requires patches to the `cddlib` spkg and to `polyhedra.py`\n\nAlso, make `cddlib` produce the same output ordering on all platforms (#9926)\n\nAssignee: mhampton\n\nCC:  mhampton @novoselt @dimpase drkirkby @nexttime\n\nResolution: fixed\n\nAuthor: Volker Braun\n\nReviewer: Dmitrii Pasechnik, Marshall Hampton\n\nMerged: sage-4.6.rc0\n\nIssue created by migration from https://trac.sagemath.org/ticket/9798\n\n",
    "closed_at": "2010-10-22T07:35:55Z",
    "created_at": "2010-08-24T21:18:32Z",
    "labels": [
        "component: geometry",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6",
    "title": "Accelerate Polyhedron constructor and fix cddlib output ordering",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9798",
    "user": "https://github.com/vbraun"
}
```
I've run across some polytopes that can't be constructed in finite time because computing the facet and vertex adjacencies takes forever. Just computing the reduced H/V-representation takes just a few minutes. So I propose to **not** compute the adjacency data in the constructor, but only when needed. This requires patches to the `cddlib` spkg and to `polyhedra.py`

Also, make `cddlib` produce the same output ordering on all platforms (#9926)

Assignee: mhampton

CC:  mhampton @novoselt @dimpase drkirkby @nexttime

Resolution: fixed

Author: Volker Braun

Reviewer: Dmitrii Pasechnik, Marshall Hampton

Merged: sage-4.6.rc0

Issue created by migration from https://trac.sagemath.org/ticket/9798





---

archive/issue_comments_115166.json:
```json
{
    "body": "<a id='comment:1'></a>Updated spkg is here:\n\nhttp://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg\n\nI changed the `cdd_both_reps.c` (whose binary the `sage.geometry.polyhedra` uses) to make the computation of adjacency data optional. I also added more checks to the `spkg-check`. The upstream package comes with tons of more checks, but lots of them are computationally expensive (i.e. take many hours). Some crash the vanilla upstream binaries, for example `allzero.ine`. \n\nTo use the new spkg you need the patch to the polyhedra code, see below.",
    "created_at": "2010-08-24T21:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115166",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:1'></a>Updated spkg is here:

http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg

I changed the `cdd_both_reps.c` (whose binary the `sage.geometry.polyhedra` uses) to make the computation of adjacency data optional. I also added more checks to the `spkg-check`. The upstream package comes with tons of more checks, but lots of them are computationally expensive (i.e. take many hours). Some crash the vanilla upstream binaries, for example `allzero.ine`. 

To use the new spkg you need the patch to the polyhedra code, see below.



---

archive/issue_comments_115167.json:
```json
{
    "body": "Initial patch",
    "created_at": "2010-08-24T21:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115167",
    "user": "https://github.com/vbraun"
}
```

Initial patch



---

archive/issue_comments_115168.json:
```json
{
    "body": "<a id='comment:2'></a>Attachment [trac_9798_accelerate_Polyhedron.patch](tarball://root/attachments/some-uuid/ticket9798/trac_9798_accelerate_Polyhedron.patch) by @vbraun created at 2010-08-24 21:53:01\n\nCurrent patch is on top of `trac_9337_toric_divisor_classes.patch` from #9337.",
    "created_at": "2010-08-24T21:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115168",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>Attachment [trac_9798_accelerate_Polyhedron.patch](tarball://root/attachments/some-uuid/ticket9798/trac_9798_accelerate_Polyhedron.patch) by @vbraun created at 2010-08-24 21:53:01

Current patch is on top of `trac_9337_toric_divisor_classes.patch` from #9337.



---

archive/issue_comments_115169.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-09-21T13:48:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115169",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_115170.json:
```json
{
    "body": "Changing author from \"\" to \"Volker Braun\"",
    "created_at": "2010-09-21T13:48:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115170",
    "user": "https://github.com/vbraun"
}
```

Changing author from "" to "Volker Braun"



---

archive/issue_comments_115171.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n I've run across some polytopes that can't be constructed in finite time because computing the facet and vertex adjacencies takes forever. Just computing the reduced H/V-representation takes just a few minutes. So I propose to **not** compute the adjacency data in the constructor, but only when needed. This requires patches to the `cddlib` spkg and to `polyhedra.py`\n+\n+Also, make `cddlib` produce the same output ordering on all platforms (#9926)\n``````\n",
    "created_at": "2010-09-21T13:48:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115171",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 I've run across some polytopes that can't be constructed in finite time because computing the facet and vertex adjacencies takes forever. Just computing the reduced H/V-representation takes just a few minutes. So I propose to **not** compute the adjacency data in the constructor, but only when needed. This requires patches to the `cddlib` spkg and to `polyhedra.py`
+
+Also, make `cddlib` produce the same output ordering on all platforms (#9926)
``````




---

archive/issue_comments_115172.json:
```json
{
    "body": "<a id='comment:3'></a>I updated the spkg at\n\nhttp://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg\n\nNow it includes a random number generator (taken from GNU libc), so the `cddlib` output ordering should be the same on all platforms.\n\nThe prerequisite patch has been merged into Sage 4.6.alpha0, so now would be a good time to review this ticket :-)",
    "created_at": "2010-09-21T13:48:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115172",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>I updated the spkg at

http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg

Now it includes a random number generator (taken from GNU libc), so the `cddlib` output ordering should be the same on all platforms.

The prerequisite patch has been merged into Sage 4.6.alpha0, so now would be a good time to review this ticket :-)



---

archive/issue_comments_115173.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [vbraun](#comment%3A3):\n> I updated the spkg at\n> \n> http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg\n> \n> Now it includes a random number generator (taken from GNU libc), so the `cddlib` output ordering should be the same on all platforms.\n\n\nWell, I tested on PPC MacOSX, and sure enough I still get \nsage -t -long \"devel/sage/sage/schemes/generic/toric_divisor.py\"\n**********************************************************************\nFile \"/usr/local/src/sage/sage-4.6.alpha1/devel/sage/sage/schemes/generic/toric_divisor.py\", line 1522:\n    sage: supp.Vrepresentation()\nExpected:\n    [A vertex at (-1, 1), A vertex at (0, 2), A vertex at (0, -1), A vertex at (3, -1)]\nGot:\n    [A vertex at (-1, 1), A vertex at (0, 2), A vertex at (3, -1), A vertex at (0, -1)]\n**********************************************************************\n1 items had failures:\n   1 of  10 in __main__.example_35\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /Users/dima/.sage//tmp/.doctest_toric_divisor.py\n\t [102.0 s]\n \n---\nThe following tests failed:\n\n\n\tsage -t -long \"devel/sage/sage/schemes/generic/toric_divisor.py\n\nProbably the GNU rng (in GSL, I suppose, I'd be mighty surprised if there was one in libc!) \nis not endianness-clean, or something like this.\nAnyway, you should rather use Sage's rng facilities, at least they are known to be \nuniform accross all the Sage platforms.\n\n\n> \n> The prerequisite patch has been merged into Sage 4.6.alpha0, so now would be a good time to review this ticket :-)\n\n\nWhile I am at it, I don't get the initial motivation for the ticket - computing vertex adjacencies (given a V-representation, say) ought to be much faster than converting to H-representation, as it's a simple LP to check whether two vertices are adjacent.\n(well, I don't know whether this is in cdd, but I recall Komei mentioning this as implemented, or to be implemented)\n\nDima",
    "created_at": "2010-09-21T14:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115173",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>Replying to [vbraun](#comment%3A3):
> I updated the spkg at
> 
> http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg
> 
> Now it includes a random number generator (taken from GNU libc), so the `cddlib` output ordering should be the same on all platforms.


Well, I tested on PPC MacOSX, and sure enough I still get 
sage -t -long "devel/sage/sage/schemes/generic/toric_divisor.py"
**********************************************************************
File "/usr/local/src/sage/sage-4.6.alpha1/devel/sage/sage/schemes/generic/toric_divisor.py", line 1522:
    sage: supp.Vrepresentation()
Expected:
    [A vertex at (-1, 1), A vertex at (0, 2), A vertex at (0, -1), A vertex at (3, -1)]
Got:
    [A vertex at (-1, 1), A vertex at (0, 2), A vertex at (3, -1), A vertex at (0, -1)]
**********************************************************************
1 items had failures:
   1 of  10 in __main__.example_35
***Test Failed*** 1 failures.
For whitespace errors, see the file /Users/dima/.sage//tmp/.doctest_toric_divisor.py
	 [102.0 s]
 
---
The following tests failed:


	sage -t -long "devel/sage/sage/schemes/generic/toric_divisor.py

Probably the GNU rng (in GSL, I suppose, I'd be mighty surprised if there was one in libc!) 
is not endianness-clean, or something like this.
Anyway, you should rather use Sage's rng facilities, at least they are known to be 
uniform accross all the Sage platforms.


> 
> The prerequisite patch has been merged into Sage 4.6.alpha0, so now would be a good time to review this ticket :-)


While I am at it, I don't get the initial motivation for the ticket - computing vertex adjacencies (given a V-representation, say) ought to be much faster than converting to H-representation, as it's a simple LP to check whether two vertices are adjacent.
(well, I don't know whether this is in cdd, but I recall Komei mentioning this as implemented, or to be implemented)

Dima



---

archive/issue_comments_115174.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2010-09-21T14:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115174",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_115175.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2010-09-21T16:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115175",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_115176.json:
```json
{
    "body": "<a id='comment:5'></a>1. I debugged it some more and apparently the code that uses random numbers ends up not being called in the code path. Which raises the question again, how does cddlib manage to depend on the architecture... I'll change the `polyhedra.py` to sort the cddlib output for now.\n\n   2. According to the (sparse) cdd manual, it exactly does that: solve a LP to get the adjacency data. There is a bit of a combinatorial explosion in high dimension and number of vertices, I guess. \n\nThe other motivation for this ticket is that we can then start and replace `libcdd`s implementation of the dual description with a better one. In particular I'm eying a cythonized version of the Parma Polyhedra Library, but we need at least cython 0.13 for C++.",
    "created_at": "2010-09-21T16:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115176",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>1. I debugged it some more and apparently the code that uses random numbers ends up not being called in the code path. Which raises the question again, how does cddlib manage to depend on the architecture... I'll change the `polyhedra.py` to sort the cddlib output for now.

   2. According to the (sparse) cdd manual, it exactly does that: solve a LP to get the adjacency data. There is a bit of a combinatorial explosion in high dimension and number of vertices, I guess. 

The other motivation for this ticket is that we can then start and replace `libcdd`s implementation of the dual description with a better one. In particular I'm eying a cythonized version of the Parma Polyhedra Library, but we need at least cython 0.13 for C++.



---

archive/issue_comments_115177.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2010-09-21T17:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115177",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_115178.json:
```json
{
    "body": "<a id='comment:6'></a>Oops, I was too quick: In the spkg I had accidentally reverted the change in `cddcore.c` to use the fixed random number generator. A new packaged cddlib is, again, here: \n\nhttp://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg\n\nPlease give this one a try. I added logging for the random numbers generated. If you still find that the output order differs, please save the output of\n\n```\nPolyhedron(vertices=[(0, 1), (1, 1), (0, 1), (-1, 1), (0, 2), (0, -1), (0, 0), (0, 0), (3, -1), (0, 2), (0, -1), (1, -1), (0, 0)], verbose=True)\n```\nto a file and attach it to this ticket.",
    "created_at": "2010-09-21T17:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115178",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>Oops, I was too quick: In the spkg I had accidentally reverted the change in `cddcore.c` to use the fixed random number generator. A new packaged cddlib is, again, here: 

http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg

Please give this one a try. I added logging for the random numbers generated. If you still find that the output order differs, please save the output of

```
Polyhedron(vertices=[(0, 1), (1, 1), (0, 1), (-1, 1), (0, 2), (0, -1), (0, 0), (0, 0), (3, -1), (0, 2), (0, -1), (1, -1), (0, 0)], verbose=True)
```
to a file and attach it to this ticket.



---

archive/issue_comments_115179.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [vbraun](#comment%3A6):\n> Oops, I was too quick: In the spkg I had accidentally reverted the change in `cddcore.c` to use the fixed random number generator. A new packaged cddlib is, again, here: \n> \n> http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg\n> \n> Please give this one a try. I added logging for the random numbers generated. If you still find that the output order differs, please save the output of\n> \n> ```\n> Polyhedron(vertices=[(0, 1), (1, 1), (0, 1), (-1, 1), (0, 2), (0, -1), (0, 0), (0, 0), (3, -1), (0, 2), (0, -1), (1, -1), (0, 0)], verbose=True)\n> ```\n> to a file and attach it to this ticket.\n\n\nOK, it works now.",
    "created_at": "2010-09-21T17:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115179",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>Replying to [vbraun](#comment%3A6):
> Oops, I was too quick: In the spkg I had accidentally reverted the change in `cddcore.c` to use the fixed random number generator. A new packaged cddlib is, again, here: 
> 
> http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg
> 
> Please give this one a try. I added logging for the random numbers generated. If you still find that the output order differs, please save the output of
> 
> ```
> Polyhedron(vertices=[(0, 1), (1, 1), (0, 1), (-1, 1), (0, 2), (0, -1), (0, 0), (0, 0), (3, -1), (0, 2), (0, -1), (1, -1), (0, 0)], verbose=True)
> ```
> to a file and attach it to this ticket.


OK, it works now.



---

archive/issue_comments_115180.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [vbraun](#comment%3A5):\n>   1. I debugged it some more and apparently the code that uses random numbers ends up not being called in the code path. Which raises the question again, how does cddlib manage to depend on the architecture... I'll change the `polyhedra.py` to sort the cddlib output for now.\n  \n> \n>   2. According to the (sparse) cdd manual, it exactly does that: solve a LP to get the adjacency data. There is a bit of a combinatorial explosion in high dimension and number of vertices, I guess. \n\n\nSorry, I don't get it. Computing the dual description is well-known to be much more expensive in general than computing the vertex adjacencies - the latter is polynomial-time, the former is certainly not...\n\n\n> \n> The other motivation for this ticket is that we can then start and replace `libcdd`s implementation of the dual description with a better one. In particular I'm eying a cythonized version of the Parma Polyhedra Library, but we need at least cython 0.13 for C++.",
    "created_at": "2010-09-21T17:54:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115180",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>Replying to [vbraun](#comment%3A5):
>   1. I debugged it some more and apparently the code that uses random numbers ends up not being called in the code path. Which raises the question again, how does cddlib manage to depend on the architecture... I'll change the `polyhedra.py` to sort the cddlib output for now.
  
> 
>   2. According to the (sparse) cdd manual, it exactly does that: solve a LP to get the adjacency data. There is a bit of a combinatorial explosion in high dimension and number of vertices, I guess. 


Sorry, I don't get it. Computing the dual description is well-known to be much more expensive in general than computing the vertex adjacencies - the latter is polynomial-time, the former is certainly not...


> 
> The other motivation for this ticket is that we can then start and replace `libcdd`s implementation of the dual description with a better one. In particular I'm eying a cythonized version of the Parma Polyhedra Library, but we need at least cython 0.13 for C++.



---

archive/issue_comments_115181.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2010-09-21T18:18:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115181",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_events_024593.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2010-09-21T18:18:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "milestone": "sage-4.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9798#event-24593"
}
```



---

archive/issue_comments_115182.json:
```json
{
    "body": "<a id='comment:9'></a>OK good, I've removed the logging and put the (hopefully final) version of the spkg at the usual place\n\nhttp://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg \n\nI agree that, in general, the dual description is the time-consuming part. However I have encountered a special case where it was the other way round. I don't know if its an implementation issue or just a weird case, as far as I remember it was a high-dimensional polytope with few facets but ~1500 vertices.\n\nIn any case, the new spkg seems to fix the OSX problem and, hopefully, someone will step up and review it :-)",
    "created_at": "2010-09-21T18:18:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115182",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>OK good, I've removed the logging and put the (hopefully final) version of the spkg at the usual place

http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg 

I agree that, in general, the dual description is the time-consuming part. However I have encountered a special case where it was the other way round. I don't know if its an implementation issue or just a weird case, as far as I remember it was a high-dimensional polytope with few facets but ~1500 vertices.

In any case, the new spkg seems to fix the OSX problem and, hopefully, someone will step up and review it :-)



---

archive/issue_comments_115183.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [vbraun](#comment%3A9):\n> OK good, I've removed the logging and put the (hopefully final) version of the spkg at the usual place\n> \n> http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg \n> \n> I agree that, in general, the dual description is the time-consuming part. However I have encountered a special case where it was the other way round. I don't know if its an implementation issue or just a weird case, as far as I remember it was a high-dimensional polytope with few facets but ~1500 vertices.\n\n\nHmm, are you saying that computing facets for a polytope with 1500 vertices is faster than computing the vertex adjacencies?\nShouldn't this at least be reported upstream?\n\n> \n> In any case, the new spkg seems to fix the OSX problem and, hopefully, someone will step up and review it :-)",
    "created_at": "2010-09-22T02:27:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115183",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>Replying to [vbraun](#comment%3A9):
> OK good, I've removed the logging and put the (hopefully final) version of the spkg at the usual place
> 
> http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg 
> 
> I agree that, in general, the dual description is the time-consuming part. However I have encountered a special case where it was the other way round. I don't know if its an implementation issue or just a weird case, as far as I remember it was a high-dimensional polytope with few facets but ~1500 vertices.


Hmm, are you saying that computing facets for a polytope with 1500 vertices is faster than computing the vertex adjacencies?
Shouldn't this at least be reported upstream?

> 
> In any case, the new spkg seems to fix the OSX problem and, hopefully, someone will step up and review it :-)



---

archive/issue_comments_115184.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [vbraun](#comment%3A9):\n> OK good, I've removed the logging and put the (hopefully final) version of the spkg at the usual place\n> \n> http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg \n> \n> I agree that, in general, the dual description is the time-consuming part. However I have encountered a special case where it was the other way round. I don't know if its an implementation issue or just a weird case, as far as I remember it was a high-dimensional polytope with few facets but ~1500 vertices.\n> \n> In any case, the new spkg seems to fix the OSX problem and, hopefully, someone will step up and review it :-)\n\n\nI am not sure whether it is kosher to have a rng in an spkg rather than make it call the Sage's rng. Perhaps somebody more versed in this could comment.",
    "created_at": "2010-09-22T02:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115184",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>Replying to [vbraun](#comment%3A9):
> OK good, I've removed the logging and put the (hopefully final) version of the spkg at the usual place
> 
> http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg 
> 
> I agree that, in general, the dual description is the time-consuming part. However I have encountered a special case where it was the other way round. I don't know if its an implementation issue or just a weird case, as far as I remember it was a high-dimensional polytope with few facets but ~1500 vertices.
> 
> In any case, the new spkg seems to fix the OSX problem and, hopefully, someone will step up and review it :-)


I am not sure whether it is kosher to have a rng in an spkg rather than make it call the Sage's rng. Perhaps somebody more versed in this could comment.



---

archive/issue_comments_115185.json:
```json
{
    "body": "<a id='comment:12'></a>The spkg built OK and the output order of \n\n```\nPolyhedron(vertices=[(0, 1), (1, 1), (0, 1), (-1, 1), (0, 2), (0, -1), (0, 0), (0, 0), (3, -1), (0, 2), (0, -1), (1, -1), (0, 0)], verbose=True)\n```\nis as expected on OS X 10.5.  I will try to test on other platforms.",
    "created_at": "2010-09-22T06:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115185",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

<a id='comment:12'></a>The spkg built OK and the output order of 

```
Polyhedron(vertices=[(0, 1), (1, 1), (0, 1), (-1, 1), (0, 2), (0, -1), (0, 0), (0, 0), (3, -1), (0, 2), (0, -1), (1, -1), (0, 0)], verbose=True)
```
is as expected on OS X 10.5.  I will try to test on other platforms.



---

archive/issue_comments_115186.json:
```json
{
    "body": "<a id='comment:13'></a>So random.c is from the GNU C library?  Or somewhere else?  Should there be at least a comment about that?",
    "created_at": "2010-09-22T06:13:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115186",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

<a id='comment:13'></a>So random.c is from the GNU C library?  Or somewhere else?  Should there be at least a comment about that?



---

archive/issue_comments_115187.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [mhampton](#comment%3A13):\n> So random.c is from the GNU C library?  Or somewhere else?  Should there be at least a comment about that?\n\n\nIMHO this is a totally unnecessary code bloat. There is an rng in GSL, and GSL is a part of Sage. I don't have time to look at it now, but I am pretty sure the changes to switch to GSL's rng are pretty minimal (probably even the API is the same!)",
    "created_at": "2010-09-22T06:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115187",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>Replying to [mhampton](#comment%3A13):
> So random.c is from the GNU C library?  Or somewhere else?  Should there be at least a comment about that?


IMHO this is a totally unnecessary code bloat. There is an rng in GSL, and GSL is a part of Sage. I don't have time to look at it now, but I am pretty sure the changes to switch to GSL's rng are pretty minimal (probably even the API is the same!)



---

archive/issue_comments_115188.json:
```json
{
    "body": "<a id='comment:15'></a>* `cddlib` is slow, thats a generally known fact. It basically comes out last in every benchmark I have seen. It was the first implementation, and nobody would have published a competing implementation if it wouldn't have been faster...\n\n  * `random.h` has the GNU C library copyright notice. I've modified the source to cut it down to the essentials, remove other rngs and other libc calls.\n\nI don't mind making `cddlib` depend on `gsl`, but the obvious arguments against would be:\n\n1. `cddlib` doesn't need a high-quality rng.\n\n2. Many projects use `cddlib`, should we really try to push a new dependency upstream?",
    "created_at": "2010-09-22T08:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115188",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>* `cddlib` is slow, thats a generally known fact. It basically comes out last in every benchmark I have seen. It was the first implementation, and nobody would have published a competing implementation if it wouldn't have been faster...

  * `random.h` has the GNU C library copyright notice. I've modified the source to cut it down to the essentials, remove other rngs and other libc calls.

I don't mind making `cddlib` depend on `gsl`, but the obvious arguments against would be:

1. `cddlib` doesn't need a high-quality rng.

2. Many projects use `cddlib`, should we really try to push a new dependency upstream?



---

archive/issue_comments_115189.json:
```json
{
    "body": "<a id='comment:16'></a>I'm OK with the code addition.  These are quite small and clean.  \n\nI don't know how you could say cddlib is always slower if you look at the timings towards the end of [http://arxiv.org/abs/math.MG/0210133](http://arxiv.org/abs/math.MG/0210133).  It really depends on the input.  That's why at some point we need to make at least lrs standard (in my opinion it met the bar a long time ago, I just haven't argued for it enough) and provide it and hopefully others as alternative options for Polyhedron.\n\nI would like to test this a bit more before giving a positive review, I'll try to do that today.",
    "created_at": "2010-09-22T11:28:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115189",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

<a id='comment:16'></a>I'm OK with the code addition.  These are quite small and clean.  

I don't know how you could say cddlib is always slower if you look at the timings towards the end of [http://arxiv.org/abs/math.MG/0210133](http://arxiv.org/abs/math.MG/0210133).  It really depends on the input.  That's why at some point we need to make at least lrs standard (in my opinion it met the bar a long time ago, I just haven't argued for it enough) and provide it and hopefully others as alternative options for Polyhedron.

I would like to test this a bit more before giving a positive review, I'll try to do that today.



---

archive/issue_comments_115190.json:
```json
{
    "body": "<a id='comment:17'></a>I'm getting a lot of doctest errors involving \"dual\" method calls from schemes/generic/toric_* files.  I'm not sure if I had some misapplication of the stuff from #9337 or not - can someone run doctests on those after applying the changes in this ticket?",
    "created_at": "2010-09-22T11:53:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115190",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

<a id='comment:17'></a>I'm getting a lot of doctest errors involving "dual" method calls from schemes/generic/toric_* files.  I'm not sure if I had some misapplication of the stuff from #9337 or not - can someone run doctests on those after applying the changes in this ticket?



---

archive/issue_comments_115191.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-09-22T12:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115191",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_115192.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [mhampton](#comment%3A16):\n> I'm OK with the code addition.  These are quite small and clean.  \n\n\nbut it is an obvious code bloat!\nI have been a user of cdd at some point, published few papers that used it, including\na paper with Komei himself (whom I know for like 20 years, and to whom I could write if you like...)\nSo I am for introducing a dependence of GSL instead of this \"clean\" bloat...\n \n> \n> I don't know how you could say cddlib is always slower if you look at the timings towards the end of [http://arxiv.org/abs/math.MG/0210133](http://arxiv.org/abs/math.MG/0210133).  It really depends on the input.  That's why at some point we need to make at least lrs standard (in my opinion it met the bar a long time ago, I just haven't argued for it enough) and provide it and hopefully others as alternative options for Polyhedron.\n> \n> I would like to test this a bit more before giving a positive review, I'll try to do that today.",
    "created_at": "2010-09-22T12:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115192",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>Replying to [mhampton](#comment%3A16):
> I'm OK with the code addition.  These are quite small and clean.  


but it is an obvious code bloat!
I have been a user of cdd at some point, published few papers that used it, including
a paper with Komei himself (whom I know for like 20 years, and to whom I could write if you like...)
So I am for introducing a dependence of GSL instead of this "clean" bloat...
 
> 
> I don't know how you could say cddlib is always slower if you look at the timings towards the end of [http://arxiv.org/abs/math.MG/0210133](http://arxiv.org/abs/math.MG/0210133).  It really depends on the input.  That's why at some point we need to make at least lrs standard (in my opinion it met the bar a long time ago, I just haven't argued for it enough) and provide it and hopefully others as alternative options for Polyhedron.
> 
> I would like to test this a bit more before giving a positive review, I'll try to do that today.



---

archive/issue_comments_115193.json:
```json
{
    "body": "<a id='comment:19'></a>LRS takes an orthogonal approach, so it can do some problems that the dual description algorithm cannot and vice versa. I should have said that `cddlib` is the slowest implementation of the dual description :-) I think ideally we would race PPL's implementation of the dual description against lrslib's reverse search and take the winner. Or have some heuristic to pick the most suitable algorithm. But I'm definitely in favor of including lrs. In any case, a more useful comparison is in Table 1 of http://arxiv.org/abs/cs/0612085\n\nI don't get any doctest errors in `sage/schemes/generic/`. My patch queue (on top of Sage-4.5.2) is \n\n```\ntrax_9902_fix_base_extension.patch\ntrac_9502_basis_parent_bug_in_FreeModule.2.patch\ntrac_9504_add_support_for_toric_sublattices.patch\ntrac_9504_change_sublattice_repr.patch\ntrac_9504_add_support_for_quotients_of_toric_lattices.patch\ntrac_9504_reviewer_changes.patch\ntrac_9504_last_changes.patch\ntrac_9296_lattice_computations_for_cones.patch\ntrac_9296_reviewer.patch\ntrac_9782_bug_in_computing_star_generators.patch\ntrac_9810_cone_faces_invalidates_facets.patch\ntrac_9812_sorting_bug_in_fan_subdivision.patch\ntrac_9839_add_dual_cone_computation.patch\ntrac_9839_reviewer.2.patch\ntrac_9337_divisor_superclasses_fixes.patch\ntrac_9337_toric_divisors.patch\ntrac_9337_toric_divisors_reviewer.patch\ntrac_9337_toric_divisor_classes.patch\ntrac_9337_line_bundle_cohomology.patch\ntrac_9337_classes_and_cohomology_reviewer.patch\ntrac_9337_final.patch\ntrac_9798_accelerate_Polyhedron.patch\n```\n\nDima: In principle I agree, but in practice its just a few lines. Your computer will spend more time dlinking with gsl for what? Shave off 1kb? The usual arguments in favour of library use, like being able to update the library without the program, don't make any sense here. In fact, I want cddlib to be as static as possible until we can migrate away from it.",
    "created_at": "2010-09-22T12:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115193",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>LRS takes an orthogonal approach, so it can do some problems that the dual description algorithm cannot and vice versa. I should have said that `cddlib` is the slowest implementation of the dual description :-) I think ideally we would race PPL's implementation of the dual description against lrslib's reverse search and take the winner. Or have some heuristic to pick the most suitable algorithm. But I'm definitely in favor of including lrs. In any case, a more useful comparison is in Table 1 of http://arxiv.org/abs/cs/0612085

I don't get any doctest errors in `sage/schemes/generic/`. My patch queue (on top of Sage-4.5.2) is 

```
trax_9902_fix_base_extension.patch
trac_9502_basis_parent_bug_in_FreeModule.2.patch
trac_9504_add_support_for_toric_sublattices.patch
trac_9504_change_sublattice_repr.patch
trac_9504_add_support_for_quotients_of_toric_lattices.patch
trac_9504_reviewer_changes.patch
trac_9504_last_changes.patch
trac_9296_lattice_computations_for_cones.patch
trac_9296_reviewer.patch
trac_9782_bug_in_computing_star_generators.patch
trac_9810_cone_faces_invalidates_facets.patch
trac_9812_sorting_bug_in_fan_subdivision.patch
trac_9839_add_dual_cone_computation.patch
trac_9839_reviewer.2.patch
trac_9337_divisor_superclasses_fixes.patch
trac_9337_toric_divisors.patch
trac_9337_toric_divisors_reviewer.patch
trac_9337_toric_divisor_classes.patch
trac_9337_line_bundle_cohomology.patch
trac_9337_classes_and_cohomology_reviewer.patch
trac_9337_final.patch
trac_9798_accelerate_Polyhedron.patch
```

Dima: In principle I agree, but in practice its just a few lines. Your computer will spend more time dlinking with gsl for what? Shave off 1kb? The usual arguments in favour of library use, like being able to update the library without the program, don't make any sense here. In fact, I want cddlib to be as static as possible until we can migrate away from it.



---

archive/issue_comments_115194.json:
```json
{
    "body": "<a id='comment:20'></a>FWIW, I can see that using GSL in Sage is sensible, since we have it. \n\nBut whether such changes would be accepted upstream is another matter. If I maintained a bit of software that just needed a low-quality source of random numbers, I'd probably implement something like \n\n```\nX_n= seed\nX_n+1 = ( (X_n * A) + B ) mod C\n```\n\nIf you make sure that this can't overflow the type of variable (e.g. long) then there's no hardware dependence. The reason such RNG's can have hardware dependence is when they overflow the register. \n\nI would not want people to have to install GSL just to get a few random numbers. \n\nI can't see why a simple low-quality RNG should take up 4 KB - I could write it in a few hundred bytes. It would help if people attached patches to the ticket, so others can see what changes you have made. \n\nIf the RNG I showed is not good enough, then there's a bit more of an argument for making GSL a dependence upstream.",
    "created_at": "2010-09-23T10:51:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115194",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:20'></a>FWIW, I can see that using GSL in Sage is sensible, since we have it. 

But whether such changes would be accepted upstream is another matter. If I maintained a bit of software that just needed a low-quality source of random numbers, I'd probably implement something like 

```
X_n= seed
X_n+1 = ( (X_n * A) + B ) mod C
```

If you make sure that this can't overflow the type of variable (e.g. long) then there's no hardware dependence. The reason such RNG's can have hardware dependence is when they overflow the register. 

I would not want people to have to install GSL just to get a few random numbers. 

I can't see why a simple low-quality RNG should take up 4 KB - I could write it in a few hundred bytes. It would help if people attached patches to the ticket, so others can see what changes you have made. 

If the RNG I showed is not good enough, then there's a bit more of an argument for making GSL a dependence upstream.



---

archive/issue_comments_115195.json:
```json
{
    "body": "<a id='comment:21'></a>http://www.opengroup.org/onlinepubs/009695399/functions/rand.html\nshows a simple RNG with no hardware depedance: It's nowhere near 4 KB.\n\n```\nstatic unsigned long next = 1;\nint myrand(void)  /* RAND_MAX assumed to be 32767. */\n{\n    next = next * 1103515245 + 12345;\n    return((unsigned)(next/65536) % 32768);\n}\n\n\nvoid mysrand(unsigned seed)\n{\n    next = seed;\n}\n\n```",
    "created_at": "2010-09-23T11:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115195",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:21'></a>http://www.opengroup.org/onlinepubs/009695399/functions/rand.html
shows a simple RNG with no hardware depedance: It's nowhere near 4 KB.

```
static unsigned long next = 1;
int myrand(void)  /* RAND_MAX assumed to be 32767. */
{
    next = next * 1103515245 + 12345;
    return((unsigned)(next/65536) % 32768);
}


void mysrand(unsigned seed)
{
    next = seed;
}

```



---

archive/issue_comments_115196.json:
```json
{
    "body": "<a id='comment:22'></a>I took the implementation from the GNU C library since we then don't need to change any doctests. I'll attach the added source files for reference. I don't think there is any 32-bit overflow problem as nobody complained about doctests failing on Linux/i386. Seems like OSX really has a different implementation of the rng. Also, the GNU C library implementation changed at least once previously, so there is never a guarantee that rand() is reproducible across platforms. Quality of rng's is not a concern for cdd.",
    "created_at": "2010-09-23T11:36:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115196",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>I took the implementation from the GNU C library since we then don't need to change any doctests. I'll attach the added source files for reference. I don't think there is any 32-bit overflow problem as nobody complained about doctests failing on Linux/i386. Seems like OSX really has a different implementation of the rng. Also, the GNU C library implementation changed at least once previously, so there is never a guarantee that rand() is reproducible across platforms. Quality of rng's is not a concern for cdd.



---

archive/issue_comments_115197.json:
```json
{
    "body": "<a id='comment:23'></a>I was trying to use sage-4.6.alpha0 upgraded from the \"prealpha\", but something got messed up.  Now using sage-4.6.alpha1 which has everything from #9337 so its simpler.\n\nI think Volker's arguments are reasonable and its a little silly to worry about the size of his random.c file - its smaller than a single block on most filesystems.  I'm only worried about testing that this all works on a variety of platforms now.",
    "created_at": "2010-09-23T11:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115197",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

<a id='comment:23'></a>I was trying to use sage-4.6.alpha0 upgraded from the "prealpha", but something got messed up.  Now using sage-4.6.alpha1 which has everything from #9337 so its simpler.

I think Volker's arguments are reasonable and its a little silly to worry about the size of his random.c file - its smaller than a single block on most filesystems.  I'm only worried about testing that this all works on a variety of platforms now.



---

archive/issue_comments_115198.json:
```json
{
    "body": "<a id='comment:24'></a>I would certainly comment the code to know where the algorithm came from. \n\nGiven the size of the numbers, and would not at all be surprised if that produced a different set of numbers on different platforms. The best way would probably be to create a standalone C program with a main(), and let people test that. I could test that on a variety of systems were cddlib will probably not build (AIX & HP-UX for example). That would show if there was any hardware dependence. \n\nDave",
    "created_at": "2010-09-23T12:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115198",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:24'></a>I would certainly comment the code to know where the algorithm came from. 

Given the size of the numbers, and would not at all be surprised if that produced a different set of numbers on different platforms. The best way would probably be to create a standalone C program with a main(), and let people test that. I could test that on a variety of systems were cddlib will probably not build (AIX & HP-UX for example). That would show if there was any hardware dependence. 

Dave



---

archive/issue_comments_115199.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [vbraun](#comment%3A15):\n>   * `cddlib` is slow, thats a generally known fact. It basically comes out last in every benchmark I have seen. It was the first implementation, and nobody would have published a competing implementation if it wouldn't have been faster...\n \n> \n>   * `random.h` has the GNU C library copyright notice. I've modified the source to cut it down to the essentials, remove other rngs and other libc calls.\n\n\nI don't know what the GNU C copyright notice looks like, but \"cutting it down to the bare essentials\" would not be a defense if one was breaching that license. I don't think we can change the license just because you have taken a non-trivial subset of the code. \n\nAgain, if there was a proper patch, it would have all this information in it. \n\nDave",
    "created_at": "2010-09-23T12:09:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115199",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:25'></a>Replying to [vbraun](#comment%3A15):
>   * `cddlib` is slow, thats a generally known fact. It basically comes out last in every benchmark I have seen. It was the first implementation, and nobody would have published a competing implementation if it wouldn't have been faster...
 
> 
>   * `random.h` has the GNU C library copyright notice. I've modified the source to cut it down to the essentials, remove other rngs and other libc calls.


I don't know what the GNU C copyright notice looks like, but "cutting it down to the bare essentials" would not be a defense if one was breaching that license. I don't think we can change the license just because you have taken a non-trivial subset of the code. 

Again, if there was a proper patch, it would have all this information in it. 

Dave



---

archive/issue_comments_115200.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [drkirkby](#comment%3A20):\n> FWIW, I can see that using GSL in Sage is sensible, since we have it. \n> \n> But whether such changes would be accepted upstream is another matter.\n\n\nwell, I offered to talk to the upstream (whom I happen to know well, and whom I saw last week at a conference...), but, no, somehow this is not the right way to proceed with this ticket. For some reason people prefer to have fun putting in untested pieces of C code and make everyone run circles testing them on a gazzillion of different platform... Thus I wash my hands, and remove myself from CC:\n(Surely, feel free to add me back if you still need anything from me on this.)\n\n\n> If I maintained a bit of software that just needed a low-quality source of random numbers, I'd probably implement something like \n> \n> \n> ```\n> X_n= seed\n> X_n+1 = ( (X_n * A) + B ) mod C\n> ```\n> \n> If you make sure that this can't overflow the type of variable (e.g. long) then there's no hardware dependence. The reason such RNG's can have hardware dependence is when they overflow the register. \n> \n> I would not want people to have to install GSL just to get a few random numbers. \n> \n> I can't see why a simple low-quality RNG should take up 4 KB - I could write it in a few hundred bytes. It would help if people attached patches to the ticket, so others can see what changes you have made. \n> \n> If the RNG I showed is not good enough, then there's a bit more of an argument for making GSL a dependence upstream.",
    "created_at": "2010-09-23T12:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115200",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'></a>Replying to [drkirkby](#comment%3A20):
> FWIW, I can see that using GSL in Sage is sensible, since we have it. 
> 
> But whether such changes would be accepted upstream is another matter.


well, I offered to talk to the upstream (whom I happen to know well, and whom I saw last week at a conference...), but, no, somehow this is not the right way to proceed with this ticket. For some reason people prefer to have fun putting in untested pieces of C code and make everyone run circles testing them on a gazzillion of different platform... Thus I wash my hands, and remove myself from CC:
(Surely, feel free to add me back if you still need anything from me on this.)


> If I maintained a bit of software that just needed a low-quality source of random numbers, I'd probably implement something like 
> 
> 
> ```
> X_n= seed
> X_n+1 = ( (X_n * A) + B ) mod C
> ```
> 
> If you make sure that this can't overflow the type of variable (e.g. long) then there's no hardware dependence. The reason such RNG's can have hardware dependence is when they overflow the register. 
> 
> I would not want people to have to install GSL just to get a few random numbers. 
> 
> I can't see why a simple low-quality RNG should take up 4 KB - I could write it in a few hundred bytes. It would help if people attached patches to the ticket, so others can see what changes you have made. 
> 
> If the RNG I showed is not good enough, then there's a bit more of an argument for making GSL a dependence upstream.



---

archive/issue_comments_115201.json:
```json
{
    "body": "<a id='comment:27'></a>I've copied the copyright notice to `random.c` as well. \n\nDave: I don't know what kind of patch you want as `patch` is not supposed to be used in spkgs. You can just call the GNU libc if you want to test it on any platform...\n\nDima: This is not \"untested code\", its an excerpt from the GNU C library and has  received more testing on more platforms than you can shake a stick at.\n\nThe only potential issue is that a crufty C compiler might not have `stdint.h`, in which case there is no good way if figuring out which data type is a 32-bit int. But even IBM C for AIX (v6+) should work ;-)",
    "created_at": "2010-09-23T12:37:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115201",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:27'></a>I've copied the copyright notice to `random.c` as well. 

Dave: I don't know what kind of patch you want as `patch` is not supposed to be used in spkgs. You can just call the GNU libc if you want to test it on any platform...

Dima: This is not "untested code", its an excerpt from the GNU C library and has  received more testing on more platforms than you can shake a stick at.

The only potential issue is that a crufty C compiler might not have `stdint.h`, in which case there is no good way if figuring out which data type is a 32-bit int. But even IBM C for AIX (v6+) should work ;-)



---

archive/issue_comments_115202.json:
```json
{
    "body": "simple random number generator",
    "created_at": "2010-09-23T12:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115202",
    "user": "https://github.com/vbraun"
}
```

simple random number generator



---

archive/issue_comments_115203.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-09-23T13:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115203",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_115204.json:
```json
{
    "body": "<a id='comment:28'></a>Attachment [random.c](tarball://root/attachments/some-uuid/ticket9798/random.c) by mhampton created at 2010-09-23 13:02:36\n\nI think it would be good to add a little more detail to the SPKG.txt as well about where the code comes from.  \n\nI've tested this on two macs (10.5 and 10.6) and a linux machine (core i7 860, Ubuntu 9.10).  Passed all tests in schemes, rings, and geometry on those platforms.  If David or someone else can test this on Solaris and its OK then I think I can give it a positive review.\n\nNice documentation changes - I've meant to improve the Polyhedron class docstring for a while but I'm glad you beat me to it.",
    "created_at": "2010-09-23T13:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115204",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

<a id='comment:28'></a>Attachment [random.c](tarball://root/attachments/some-uuid/ticket9798/random.c) by mhampton created at 2010-09-23 13:02:36

I think it would be good to add a little more detail to the SPKG.txt as well about where the code comes from.  

I've tested this on two macs (10.5 and 10.6) and a linux machine (core i7 860, Ubuntu 9.10).  Passed all tests in schemes, rings, and geometry on those platforms.  If David or someone else can test this on Solaris and its OK then I think I can give it a positive review.

Nice documentation changes - I've meant to improve the Polyhedron class docstring for a while but I'm glad you beat me to it.



---

archive/issue_comments_115205.json:
```json
{
    "body": "<a id='comment:29'></a>I've changed the `SPKG.txt` to say:\n\n```\n * Include a simple random number generator (taken from the GNU C\n   library) to ensure the same output ordering on different platforms,\n   see http://trac.sagemath.org/sage_trac/ticket/9926\n```",
    "created_at": "2010-09-23T14:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115205",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:29'></a>I've changed the `SPKG.txt` to say:

```
 * Include a simple random number generator (taken from the GNU C
   library) to ensure the same output ordering on different platforms,
   see http://trac.sagemath.org/sage_trac/ticket/9926
```



---

archive/issue_comments_115206.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [vbraun](#comment%3A27):\n> I've copied the copyright notice to `random.c` as well. \n> \n> Dave: I don't know what kind of patch you want as `patch` is not supposed to be used in spkgs. You can just call the GNU libc if you want to test it on any platform...\n\n\nIt's normal practice to commit the changes to the repository in the .spkg file, then export the patches and add that to the ticket. That makes it easy to review.\n\n$ hg export tip > patch_number_and_some_description.patch\n\nthen attach \"patch_number_and_some_description.patch\"\n\nto the ticket. It makes review of the changes easy then. \n\nThat's what nearly everyone else does. \n\nDave",
    "created_at": "2010-09-23T20:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115206",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:30'></a>Replying to [vbraun](#comment%3A27):
> I've copied the copyright notice to `random.c` as well. 
> 
> Dave: I don't know what kind of patch you want as `patch` is not supposed to be used in spkgs. You can just call the GNU libc if you want to test it on any platform...


It's normal practice to commit the changes to the repository in the .spkg file, then export the patches and add that to the ticket. That makes it easy to review.

$ hg export tip > patch_number_and_some_description.patch

then attach "patch_number_and_some_description.patch"

to the ticket. It makes review of the changes easy then. 

That's what nearly everyone else does. 

Dave



---

archive/issue_comments_115207.json:
```json
{
    "body": "<a id='comment:31'></a>Oh I see what you mean. Though that patch is 700kb because automake scripts changed. I guess we could exclude autogenerated files under `patches/` from the repository. On the other hand we then can't use the mercurial repository to keep track of all patch files. Usually it won't be necessary to redo the automake scripts, so I'll leave it as it is for now.",
    "created_at": "2010-09-23T21:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115207",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:31'></a>Oh I see what you mean. Though that patch is 700kb because automake scripts changed. I guess we could exclude autogenerated files under `patches/` from the repository. On the other hand we then can't use the mercurial repository to keep track of all patch files. Usually it won't be necessary to redo the automake scripts, so I'll leave it as it is for now.



---

archive/issue_comments_115208.json:
```json
{
    "body": "<a id='comment:32'></a>This applies cleanly to the candidate sage-4.6.alpha2 and solves the only doctest failure I get from that on OS X (toric_divisor) - i.e. after applying this ticket sage-4.6.alpha2 passes all doctests on OS X 10.6 and on linux (Ubuntu 9.10 on an Intel i7 860).\n\nIf anyone can verify this is OK on Solaris I will give a positive review; I don't have an up-to-date sage on t2.",
    "created_at": "2010-09-30T20:47:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115208",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

<a id='comment:32'></a>This applies cleanly to the candidate sage-4.6.alpha2 and solves the only doctest failure I get from that on OS X (toric_divisor) - i.e. after applying this ticket sage-4.6.alpha2 passes all doctests on OS X 10.6 and on linux (Ubuntu 9.10 on an Intel i7 860).

If anyone can verify this is OK on Solaris I will give a positive review; I don't have an up-to-date sage on t2.



---

archive/issue_comments_115209.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [mhampton](#comment%3A32):\n> This applies cleanly to the candidate sage-4.6.alpha2 and solves the only doctest failure I get from that on OS X (toric_divisor) - i.e. after applying this ticket sage-4.6.alpha2 passes all doctests on OS X 10.6 and on linux (Ubuntu 9.10 on an Intel i7 860).\n> \n> If anyone can verify this is OK on Solaris I will give a positive review; I don't have an up-to-date sage on t2.\n> \n\nt2 is basically down for ordinary users like me, due to an overhaul of disk.math by William.\nBut skynet has mark and mark2, which are slow, but running.\nHowever, I do not know whether the recent gcc upgrade to 4.5.1 rendered them incapable of building Sage, and \nalso the connection to them is pretty bad: I just started copying Sage-4.6-alpha2 source to my account there, and it is likely to finish in 20 hours or so :-(",
    "created_at": "2010-10-01T03:29:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115209",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:33'></a>Replying to [mhampton](#comment%3A32):
> This applies cleanly to the candidate sage-4.6.alpha2 and solves the only doctest failure I get from that on OS X (toric_divisor) - i.e. after applying this ticket sage-4.6.alpha2 passes all doctests on OS X 10.6 and on linux (Ubuntu 9.10 on an Intel i7 860).
> 
> If anyone can verify this is OK on Solaris I will give a positive review; I don't have an up-to-date sage on t2.
> 

t2 is basically down for ordinary users like me, due to an overhaul of disk.math by William.
But skynet has mark and mark2, which are slow, but running.
However, I do not know whether the recent gcc upgrade to 4.5.1 rendered them incapable of building Sage, and 
also the connection to them is pretty bad: I just started copying Sage-4.6-alpha2 source to my account there, and it is likely to finish in 20 hours or so :-(



---

archive/issue_comments_115210.json:
```json
{
    "body": "<a id='comment:34'></a>I'm running the entire test suite on mark2 right now.  Since it's been going for a few hours already, it should be done within 10 hours :)\n\nAll tests pass for me on a Mac OS X 10.6 Intel machine and also on sage.math.\n\nIf mark2 works, I'll give it a positive review.",
    "created_at": "2010-10-01T22:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115210",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:34'></a>I'm running the entire test suite on mark2 right now.  Since it's been going for a few hours already, it should be done within 10 hours :)

All tests pass for me on a Mac OS X 10.6 Intel machine and also on sage.math.

If mark2 works, I'll give it a positive review.



---

archive/issue_comments_115211.json:
```json
{
    "body": "<a id='comment:35'></a>(Does that mean that we also close #9926?)",
    "created_at": "2010-10-01T22:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115211",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:35'></a>(Does that mean that we also close #9926?)



---

archive/issue_comments_115212.json:
```json
{
    "body": "<a id='comment:36'></a>Yes, this fixes #9926.",
    "created_at": "2010-10-02T00:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115212",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

<a id='comment:36'></a>Yes, this fixes #9926.



---

archive/issue_comments_115213.json:
```json
{
    "body": "<a id='comment:37'></a>mark2 is still testing, but it shows one failure so far:\n\n```\nsage -t  -long devel/sage/sage/rings/polynomial/groebner_fan.py\n**********************************************************************\nFile \"/home/palmieri/mark2/sage-4.6.alpha2/devel/sage-main/sage/rings/polynomial/groebner_fan.py\", line 1043:\n    sage: cone_data = Polyhedron(ieqs = g_cone_ieqs, eqns = [[1,-1,-1,-1,-1]])\nException raised:\n    Traceback (most recent call last):\n      File \"/home/palmieri/mark2/sage-4.6.alpha2/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/palmieri/mark2/sage-4.6.alpha2/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/palmieri/mark2/sage-4.6.alpha2/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_40[7]>\", line 1, in <module>\n        cone_data = Polyhedron(ieqs = g_cone_ieqs, eqns = [[Integer(1),-Integer(1),-Integer(1),-Integer(1),-Integer(1)]])###line 1043:\n    sage: cone_data = Polyhedron(ieqs = g_cone_ieqs, eqns = [[1,-1,-1,-1,-1]])\n      File \"/home/palmieri/mark2/sage-4.6.alpha2/local/lib/python/site-packages/sage/geometry/polyhedra.py\", line 1536, in __init__\n        if self.ambient_dim() < len(Polyhedron._render_method):\n      File \"/home/palmieri/mark2/sage-4.6.alpha2/local/lib/python/site-packages/sage/geometry/polyhedra.py\", line 2629, in ambient_dim\n        return self._ambient_dim\n    AttributeError: 'Polyhedron' object has no attribute '_ambient_dim'\n**********************************************************************\nFile \"/home/palmieri/mark2/sage-4.6.alpha2/devel/sage-main/sage/rings/polynomial/groebner_fan.py\", line 1044:\n    sage: cone_lines = gf._4d_to_3d(cone_data)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/palmieri/mark2/sage-4.6.alpha2/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/palmieri/mark2/sage-4.6.alpha2/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/palmieri/mark2/sage-4.6.alpha2/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_40[8]>\", line 1, in <module>\n        cone_lines = gf._4d_to_3d(cone_data)###line 1044:\n    sage: cone_lines = gf._4d_to_3d(cone_data)\n    NameError: name 'cone_data' is not defined\n**********************************************************************\nFile \"/home/palmieri/mark2/sage-4.6.alpha2/devel/sage-main/sage/rings/polynomial/groebner_fan.py\", line 1045:\n    sage: cone_lines\nException raised:\n    Traceback (most recent call last):\n      File \"/home/palmieri/mark2/sage-4.6.alpha2/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/palmieri/mark2/sage-4.6.alpha2/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/palmieri/mark2/sage-4.6.alpha2/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_40[9]>\", line 1, in <module>\n        cone_lines###line 1045:\n    sage: cone_lines\n    NameError: name 'cone_lines' is not defined\n**********************************************************************\nFile \"/home/palmieri/mark2/sage-4.6.alpha2/devel/sage-main/sage/rings/polynomial/groebner_fan.py\", line 1083:\n    sage: three_d = gf.render3d()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/palmieri/mark2/sage-4.6.alpha2/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/palmieri/mark2/sage-4.6.alpha2/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/palmieri/mark2/sage-4.6.alpha2/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_41[4]>\", line 1, in <module>\n        three_d = gf.render3d()###line 1083:\n    sage: three_d = gf.render3d()\n      File \"/home/palmieri/mark2/sage-4.6.alpha2/local/lib/python/site-packages/sage/rings/polynomial/groebner_fan.py\", line 1106, in render3d\n        cone_info = [Polyhedron(ieqs = q, eqns = [[1,-1,-1,-1,-1]]) for q in g_cones_ieqs]\n      File \"/home/palmieri/mark2/sage-4.6.alpha2/local/lib/python/site-packages/sage/geometry/polyhedra.py\", line 1536, in __init__\n        if self.ambient_dim() < len(Polyhedron._render_method):\n      File \"/home/palmieri/mark2/sage-4.6.alpha2/local/lib/python/site-packages/sage/geometry/polyhedra.py\", line 2629, in ambient_dim\n        return self._ambient_dim\n    AttributeError: 'Polyhedron' object has no attribute '_ambient_dim'\n**********************************************************************\n2 items had failures:\n   3 of  10 in __main__.example_40\n   1 of   7 in __main__.example_41\n***Test Failed*** 4 failures.\n```\nI get the same error on fulvia (Solaris on x86), so it's not something wrong with the build on mark2.\n\n(I installed the new cddlib spkg and also applied the patch here.  Was there anything else I was supposed to do?)",
    "created_at": "2010-10-02T03:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115213",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:37'></a>mark2 is still testing, but it shows one failure so far:

```
sage -t  -long devel/sage/sage/rings/polynomial/groebner_fan.py
**********************************************************************
File "/home/palmieri/mark2/sage-4.6.alpha2/devel/sage-main/sage/rings/polynomial/groebner_fan.py", line 1043:
    sage: cone_data = Polyhedron(ieqs = g_cone_ieqs, eqns = [[1,-1,-1,-1,-1]])
Exception raised:
    Traceback (most recent call last):
      File "/home/palmieri/mark2/sage-4.6.alpha2/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/palmieri/mark2/sage-4.6.alpha2/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/palmieri/mark2/sage-4.6.alpha2/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_40[7]>", line 1, in <module>
        cone_data = Polyhedron(ieqs = g_cone_ieqs, eqns = [[Integer(1),-Integer(1),-Integer(1),-Integer(1),-Integer(1)]])###line 1043:
    sage: cone_data = Polyhedron(ieqs = g_cone_ieqs, eqns = [[1,-1,-1,-1,-1]])
      File "/home/palmieri/mark2/sage-4.6.alpha2/local/lib/python/site-packages/sage/geometry/polyhedra.py", line 1536, in __init__
        if self.ambient_dim() < len(Polyhedron._render_method):
      File "/home/palmieri/mark2/sage-4.6.alpha2/local/lib/python/site-packages/sage/geometry/polyhedra.py", line 2629, in ambient_dim
        return self._ambient_dim
    AttributeError: 'Polyhedron' object has no attribute '_ambient_dim'
**********************************************************************
File "/home/palmieri/mark2/sage-4.6.alpha2/devel/sage-main/sage/rings/polynomial/groebner_fan.py", line 1044:
    sage: cone_lines = gf._4d_to_3d(cone_data)
Exception raised:
    Traceback (most recent call last):
      File "/home/palmieri/mark2/sage-4.6.alpha2/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/palmieri/mark2/sage-4.6.alpha2/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/palmieri/mark2/sage-4.6.alpha2/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_40[8]>", line 1, in <module>
        cone_lines = gf._4d_to_3d(cone_data)###line 1044:
    sage: cone_lines = gf._4d_to_3d(cone_data)
    NameError: name 'cone_data' is not defined
**********************************************************************
File "/home/palmieri/mark2/sage-4.6.alpha2/devel/sage-main/sage/rings/polynomial/groebner_fan.py", line 1045:
    sage: cone_lines
Exception raised:
    Traceback (most recent call last):
      File "/home/palmieri/mark2/sage-4.6.alpha2/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/palmieri/mark2/sage-4.6.alpha2/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/palmieri/mark2/sage-4.6.alpha2/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_40[9]>", line 1, in <module>
        cone_lines###line 1045:
    sage: cone_lines
    NameError: name 'cone_lines' is not defined
**********************************************************************
File "/home/palmieri/mark2/sage-4.6.alpha2/devel/sage-main/sage/rings/polynomial/groebner_fan.py", line 1083:
    sage: three_d = gf.render3d()
Exception raised:
    Traceback (most recent call last):
      File "/home/palmieri/mark2/sage-4.6.alpha2/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/palmieri/mark2/sage-4.6.alpha2/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/palmieri/mark2/sage-4.6.alpha2/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_41[4]>", line 1, in <module>
        three_d = gf.render3d()###line 1083:
    sage: three_d = gf.render3d()
      File "/home/palmieri/mark2/sage-4.6.alpha2/local/lib/python/site-packages/sage/rings/polynomial/groebner_fan.py", line 1106, in render3d
        cone_info = [Polyhedron(ieqs = q, eqns = [[1,-1,-1,-1,-1]]) for q in g_cones_ieqs]
      File "/home/palmieri/mark2/sage-4.6.alpha2/local/lib/python/site-packages/sage/geometry/polyhedra.py", line 1536, in __init__
        if self.ambient_dim() < len(Polyhedron._render_method):
      File "/home/palmieri/mark2/sage-4.6.alpha2/local/lib/python/site-packages/sage/geometry/polyhedra.py", line 2629, in ambient_dim
        return self._ambient_dim
    AttributeError: 'Polyhedron' object has no attribute '_ambient_dim'
**********************************************************************
2 items had failures:
   3 of  10 in __main__.example_40
   1 of   7 in __main__.example_41
***Test Failed*** 4 failures.
```
I get the same error on fulvia (Solaris on x86), so it's not something wrong with the build on mark2.

(I installed the new cddlib spkg and also applied the patch here.  Was there anything else I was supposed to do?)



---

archive/issue_comments_115214.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-10-02T03:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115214",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_115215.json:
```json
{
    "body": "<a id='comment:38'></a>Can I get an account on that machine?  Or could you do:\n\nPolyhedron(ieqs = [[0, 0, 0, 0, 1], [0, 0, 0, 2, -1], [0, 0, 2, -1, 0], [0, 2, -1, 0, 0]], eqns = [This is the Trac macro *1,-1,-1,-1,-1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,-1,-1,-1,-1-macro), verbose = True)\n\nand give the output?\n\nI'm quite puzzled by that error, maybe Volker will have a better idea of what's going on.",
    "created_at": "2010-10-02T04:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115215",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

<a id='comment:38'></a>Can I get an account on that machine?  Or could you do:

Polyhedron(ieqs = [[0, 0, 0, 0, 1], [0, 0, 0, 2, -1], [0, 0, 2, -1, 0], [0, 2, -1, 0, 0]], eqns = [This is the Trac macro *1,-1,-1,-1,-1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,-1,-1,-1,-1-macro), verbose = True)

and give the output?

I'm quite puzzled by that error, maybe Volker will have a better idea of what's going on.



---

archive/issue_comments_115216.json:
```json
{
    "body": "<a id='comment:39'></a>Replying to [mhampton](#comment%3A38):\n> Can I get an account on that machine?  Or could you do:\n> \n> Polyhedron(ieqs = [[0, 0, 0, 0, 1], [0, 0, 0, 2, -1], [0, 0, 2, -1, 0], [0, 2, -1, 0, 0]], eqns = [This is the Trac macro *1,-1,-1,-1,-1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,-1,-1,-1,-1-macro), verbose = True)\n> \n> and give the output?\n> \n> I'm quite puzzled by that error, maybe Volker will have a better idea of what's going on.\n\n\nwrite to William and cc: mariah.lenox [at] gmail.com for an account on skynet (this machine is a part of this network)",
    "created_at": "2010-10-02T04:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115216",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:39'></a>Replying to [mhampton](#comment%3A38):
> Can I get an account on that machine?  Or could you do:
> 
> Polyhedron(ieqs = [[0, 0, 0, 0, 1], [0, 0, 0, 2, -1], [0, 0, 2, -1, 0], [0, 2, -1, 0, 0]], eqns = [This is the Trac macro *1,-1,-1,-1,-1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,-1,-1,-1,-1-macro), verbose = True)
> 
> and give the output?
> 
> I'm quite puzzled by that error, maybe Volker will have a better idea of what's going on.


write to William and cc: mariah.lenox [at] gmail.com for an account on skynet (this machine is a part of this network)



---

archive/issue_comments_115217.json:
```json
{
    "body": "<a id='comment:40'></a>Here's fulvia:\n\n```\nsage: Polyhedron(ieqs = [[0, 0, 0, 0, 1], [0, 0, 0, 2, -1], [0, 0, 2, -1, 0],\n....:  [0, 2, -1, 0, 0]], eqns = [[1,-1,-1,-1,-1]], verbose = True)\nH-representation\nlinearity 1 1\nbegin\n 5 5 rational\n 1 -1 -1 -1 -1\n 0 0 0 0 1\n 0 0 0 2 -1\n 0 0 2 -1 0\n 0 2 -1 0 0\nend\n\n\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n\n/home/palmieri/fulvia/32bit/sage-4.6.alpha2/<ipython console> in <module>()\n\n/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python2.6/site-packages/sage/geometry/polyhedra.pyc in __init__(self, vertices, rays, lines, ieqs, eqns, field, compute_adjacency, verbose)\n   1534 \n   1535         # Only add a show() method if we have one\n-> 1536         if self.ambient_dim() < len(Polyhedron._render_method):\n   1537             render = Polyhedron._render_method[self.ambient_dim()]\n   1538             if render != None:\n\n/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python2.6/site-packages/sage/geometry/polyhedra.pyc in ambient_dim(self)\n   2627             4\n   2628         \"\"\"\n-> 2629         return self._ambient_dim\n   2630 \n   2631             \n\nAttributeError: 'Polyhedron' object has no attribute '_ambient_dim'\n```",
    "created_at": "2010-10-02T05:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115217",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:40'></a>Here's fulvia:

```
sage: Polyhedron(ieqs = [[0, 0, 0, 0, 1], [0, 0, 0, 2, -1], [0, 0, 2, -1, 0],
....:  [0, 2, -1, 0, 0]], eqns = [[1,-1,-1,-1,-1]], verbose = True)
H-representation
linearity 1 1
begin
 5 5 rational
 1 -1 -1 -1 -1
 0 0 0 0 1
 0 0 0 2 -1
 0 0 2 -1 0
 0 2 -1 0 0
end


---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

/home/palmieri/fulvia/32bit/sage-4.6.alpha2/<ipython console> in <module>()

/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python2.6/site-packages/sage/geometry/polyhedra.pyc in __init__(self, vertices, rays, lines, ieqs, eqns, field, compute_adjacency, verbose)
   1534 
   1535         # Only add a show() method if we have one
-> 1536         if self.ambient_dim() < len(Polyhedron._render_method):
   1537             render = Polyhedron._render_method[self.ambient_dim()]
   1538             if render != None:

/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python2.6/site-packages/sage/geometry/polyhedra.pyc in ambient_dim(self)
   2627             4
   2628         """
-> 2629         return self._ambient_dim
   2630 
   2631             

AttributeError: 'Polyhedron' object has no attribute '_ambient_dim'
```



---

archive/issue_comments_115218.json:
```json
{
    "body": "<a id='comment:41'></a>After running all tests, there were lots of failures, as you might imagine:\n\n```\nThe following tests failed:\n\n        sage -t  -long devel/sage/sage/rings/polynomial/groebner_fan.py # 4 doctests failed\n        sage -t  -long devel/sage/sage/rings/polynomial/multi_polynomial.pyx # 4 doctests failed\n        sage -t  -long devel/sage/sage/geometry/fan.py # 139 doctests failed\n        sage -t  -long devel/sage/sage/geometry/cone.py # 409 doctests failed\n        sage -t  -long devel/sage/sage/geometry/polyhedra.py # 733 doctests failed\n        sage -t  -long devel/sage/sage/plot/misc.py # 4 doctests failed\n        sage -t  -long devel/sage/sage/plot/plot.py # 12 doctests failed\n        sage -t  -long devel/sage/sage/schemes/generic/toric_variety.py # 153 doctests failed\n        sage -t  -long devel/sage/sage/schemes/generic/toric_variety_library.py # 99 doctests failed\n        sage -t  -long devel/sage/sage/schemes/generic/toric_divisor_class.pyx # 56 doctests failed\n        sage -t  -long devel/sage/sage/schemes/generic/toric_divisor.py # 312 doctests failed\n        sage -t  -long devel/sage/sage/schemes/generic/fano_toric_variety.py # 7 doctests failed\n```\nMany of these are basically the same as the earlier error.  I'm also seeing this one, as in for example plot/misc.py:\n\n```\nsage -t  -long devel/sage/sage/plot/misc.py\n**********************************************************************\nFile \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/devel/sage-main/sage/plot/misc.py\", line 483:\n    sage: plot(sin(x), (x,0,2*pi), ticks=pi/3, tick_formatter=pi)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_12[2]>\", line 1, in <module>\n        plot(sin(x), (x,Integer(0),Integer(2)*pi), ticks=pi/Integer(3), tick_formatter=pi)###line 483:\n    sage: plot(sin(x), (x,0,2*pi), ticks=pi/3, tick_formatter=pi)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/sage/misc/displayhook.py\", line 174, in displayhook\n        print_obj(sys.stdout, obj)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/sage/misc/displayhook.py\", line 142, in print_obj\n        print >>out_stream, `obj`\n      File \"sage_object.pyx\", line 101, in sage.structure.sage_object.SageObject.__repr__ (sage/structure/sage_object.c:1370)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/sage/plot/plot.py\", line 922, in _repr_\n        self.show()\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/sage/plot/plot.py\", line 1546, in show\n        self.save(DOCTEST_MODE_FILE, **options)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/sage/plot/plot.py\", line 2202, in save\n        figure.savefig(filename,dpi=dpi,bbox_inches='tight',**options)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/figure.py\", line 1032, in savefig\n        self.canvas.print_figure(*args, **kwargs)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/backend_bases.py\", line 1455, in print_figure\n        **kwargs)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/backends/backend_agg.py\", line 358, in print_png\n        FigureCanvasAgg.draw(self)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/backends/backend_agg.py\", line 314, in draw\n        self.figure.draw(self.renderer)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/artist.py\", line 46, in draw_wrapper\n        draw(artist, renderer, *args, **kwargs)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/figure.py\", line 773, in draw\n        for a in self.axes: a.draw(renderer)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/artist.py\", line 46, in draw_wrapper\n        draw(artist, renderer, *args, **kwargs)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/axes.py\", line 1735, in draw\n        a.draw(renderer)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/artist.py\", line 46, in draw_wrapper\n        draw(artist, renderer, *args, **kwargs)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/axis.py\", line 742, in draw\n        tick.draw(renderer)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/artist.py\", line 46, in draw_wrapper\n        draw(artist, renderer, *args, **kwargs)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/axis.py\", line 196, in draw\n        self.label1.draw(renderer)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/text.py\", line 518, in draw\n        bbox, info = self._get_layout(renderer)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/text.py\", line 280, in _get_layout\n        clean_line, self._fontproperties, ismath=ismath)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/backends/backend_agg.py\", line 156, in get_text_width_height_descent\n        self.mathtext_parser.parse(s, self.dpi, prop)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/mathtext.py\", line 2797, in parse\n        font_output = fontset_class(prop, backend)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/mathtext.py\", line 658, in __init__\n        self._stix_fallback = StixFonts(*args, **kwargs)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/mathtext.py\", line 900, in __init__\n        fullpath = findfont(name)\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/font_manager.py\", line 1306, in findfont\n        if not os.path.exists(font):\n      File \"/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python2.6/genericpath.py\", line 18, in exists\n        st = os.stat(path)\n    TypeError: coercing to Unicode: need string or buffer, dict found\n**********************************************************************\n```\nI've put the full test log on-line: [http://sage.math.washington.edu/home/palmieri/misc/fulvia-ptestlong.log](http://sage.math.washington.edu/home/palmieri/misc/fulvia-ptestlong.log).",
    "created_at": "2010-10-02T16:03:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115218",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:41'></a>After running all tests, there were lots of failures, as you might imagine:

```
The following tests failed:

        sage -t  -long devel/sage/sage/rings/polynomial/groebner_fan.py # 4 doctests failed
        sage -t  -long devel/sage/sage/rings/polynomial/multi_polynomial.pyx # 4 doctests failed
        sage -t  -long devel/sage/sage/geometry/fan.py # 139 doctests failed
        sage -t  -long devel/sage/sage/geometry/cone.py # 409 doctests failed
        sage -t  -long devel/sage/sage/geometry/polyhedra.py # 733 doctests failed
        sage -t  -long devel/sage/sage/plot/misc.py # 4 doctests failed
        sage -t  -long devel/sage/sage/plot/plot.py # 12 doctests failed
        sage -t  -long devel/sage/sage/schemes/generic/toric_variety.py # 153 doctests failed
        sage -t  -long devel/sage/sage/schemes/generic/toric_variety_library.py # 99 doctests failed
        sage -t  -long devel/sage/sage/schemes/generic/toric_divisor_class.pyx # 56 doctests failed
        sage -t  -long devel/sage/sage/schemes/generic/toric_divisor.py # 312 doctests failed
        sage -t  -long devel/sage/sage/schemes/generic/fano_toric_variety.py # 7 doctests failed
```
Many of these are basically the same as the earlier error.  I'm also seeing this one, as in for example plot/misc.py:

```
sage -t  -long devel/sage/sage/plot/misc.py
**********************************************************************
File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/devel/sage-main/sage/plot/misc.py", line 483:
    sage: plot(sin(x), (x,0,2*pi), ticks=pi/3, tick_formatter=pi)
Exception raised:
    Traceback (most recent call last):
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_12[2]>", line 1, in <module>
        plot(sin(x), (x,Integer(0),Integer(2)*pi), ticks=pi/Integer(3), tick_formatter=pi)###line 483:
    sage: plot(sin(x), (x,0,2*pi), ticks=pi/3, tick_formatter=pi)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/sage/misc/displayhook.py", line 174, in displayhook
        print_obj(sys.stdout, obj)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/sage/misc/displayhook.py", line 142, in print_obj
        print >>out_stream, `obj`
      File "sage_object.pyx", line 101, in sage.structure.sage_object.SageObject.__repr__ (sage/structure/sage_object.c:1370)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/sage/plot/plot.py", line 922, in _repr_
        self.show()
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/sage/plot/plot.py", line 1546, in show
        self.save(DOCTEST_MODE_FILE, **options)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/sage/plot/plot.py", line 2202, in save
        figure.savefig(filename,dpi=dpi,bbox_inches='tight',**options)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/figure.py", line 1032, in savefig
        self.canvas.print_figure(*args, **kwargs)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/backend_bases.py", line 1455, in print_figure
        **kwargs)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/backends/backend_agg.py", line 358, in print_png
        FigureCanvasAgg.draw(self)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/backends/backend_agg.py", line 314, in draw
        self.figure.draw(self.renderer)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/artist.py", line 46, in draw_wrapper
        draw(artist, renderer, *args, **kwargs)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/figure.py", line 773, in draw
        for a in self.axes: a.draw(renderer)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/artist.py", line 46, in draw_wrapper
        draw(artist, renderer, *args, **kwargs)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/axes.py", line 1735, in draw
        a.draw(renderer)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/artist.py", line 46, in draw_wrapper
        draw(artist, renderer, *args, **kwargs)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/axis.py", line 742, in draw
        tick.draw(renderer)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/artist.py", line 46, in draw_wrapper
        draw(artist, renderer, *args, **kwargs)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/axis.py", line 196, in draw
        self.label1.draw(renderer)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/text.py", line 518, in draw
        bbox, info = self._get_layout(renderer)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/text.py", line 280, in _get_layout
        clean_line, self._fontproperties, ismath=ismath)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/backends/backend_agg.py", line 156, in get_text_width_height_descent
        self.mathtext_parser.parse(s, self.dpi, prop)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/mathtext.py", line 2797, in parse
        font_output = fontset_class(prop, backend)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/mathtext.py", line 658, in __init__
        self._stix_fallback = StixFonts(*args, **kwargs)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/mathtext.py", line 900, in __init__
        fullpath = findfont(name)
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python/site-packages/matplotlib/font_manager.py", line 1306, in findfont
        if not os.path.exists(font):
      File "/home/palmieri/fulvia/32bit/sage-4.6.alpha2/local/lib/python2.6/genericpath.py", line 18, in exists
        st = os.stat(path)
    TypeError: coercing to Unicode: need string or buffer, dict found
**********************************************************************
```
I've put the full test log on-line: [http://sage.math.washington.edu/home/palmieri/misc/fulvia-ptestlong.log](http://sage.math.washington.edu/home/palmieri/misc/fulvia-ptestlong.log).



---

archive/issue_comments_115219.json:
```json
{
    "body": "<a id='comment:42'></a>That means cddlib is failing; it must not be building correctly on that platform.",
    "created_at": "2010-10-02T17:04:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115219",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

<a id='comment:42'></a>That means cddlib is failing; it must not be building correctly on that platform.



---

archive/issue_comments_115220.json:
```json
{
    "body": "<a id='comment:43'></a>You're right.  When I set SAGE_CHECK=yes, I get failures in the installation.  I've put the install log on-line: [http://sage.math.washington.edu/home/palmieri/misc/cddlib-094f.p8.log](http://sage.math.washington.edu/home/palmieri/misc/cddlib-094f.p8.log).",
    "created_at": "2010-10-02T17:43:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115220",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:43'></a>You're right.  When I set SAGE_CHECK=yes, I get failures in the installation.  I've put the install log on-line: [http://sage.math.washington.edu/home/palmieri/misc/cddlib-094f.p8.log](http://sage.math.washington.edu/home/palmieri/misc/cddlib-094f.p8.log).



---

archive/issue_comments_115221.json:
```json
{
    "body": "<a id='comment:44'></a>Did the previous `cddlib-094f.p7.spkg` build on that machine with the same toolchain? Does it link to the right cddlib (`ldd cdd_both_reps_gmp`)? Is this Solaris 10 i386?",
    "created_at": "2010-10-03T12:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115221",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:44'></a>Did the previous `cddlib-094f.p7.spkg` build on that machine with the same toolchain? Does it link to the right cddlib (`ldd cdd_both_reps_gmp`)? Is this Solaris 10 i386?



---

archive/issue_comments_115222.json:
```json
{
    "body": "<a id='comment:45'></a>The log that John showed \n\nhttp://sage.math.washington.edu/home/palmieri/misc/cddlib-094f.p8.log\n\nis for Solaris 10 x86. (That particular machine, *fulvia*, uses Intel Xeons I think). But it is certainly Solaris 10 x86. It will also have been a 32-bit build, as building Sage on Solaris 64-bit is a bit problematic due to issues with R and ECL. (By default executables build 32-bit on Solaris, even though the processors are 64-bit). \n\nDave",
    "created_at": "2010-10-03T14:06:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115222",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:45'></a>The log that John showed 

http://sage.math.washington.edu/home/palmieri/misc/cddlib-094f.p8.log

is for Solaris 10 x86. (That particular machine, *fulvia*, uses Intel Xeons I think). But it is certainly Solaris 10 x86. It will also have been a 32-bit build, as building Sage on Solaris 64-bit is a bit problematic due to issues with R and ECL. (By default executables build 32-bit on Solaris, even though the processors are 64-bit). 

Dave



---

archive/issue_comments_115223.json:
```json
{
    "body": "<a id='comment:46'></a>Here are the logs on mark2 (Solaris on sparc) for the old cddlib spkg and the new one, with SAGE_CHECK=yes, built one right after the other (so they were definitely built with the same settings):\n\n[http://sage.math.washington.edu/home/palmieri/misc/mark2-cddlib-094f.p7.log](http://sage.math.washington.edu/home/palmieri/misc/mark2-cddlib-094f.p7.log)\n[http://sage.math.washington.edu/home/palmieri/misc/mark2-cddlib-094f.p8.log](http://sage.math.washington.edu/home/palmieri/misc/mark2-cddlib-094f.p8.log)\n\nThe test suite for p7 passes, and the test suite for p8 has lots of seg faults.",
    "created_at": "2010-10-03T15:39:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115223",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:46'></a>Here are the logs on mark2 (Solaris on sparc) for the old cddlib spkg and the new one, with SAGE_CHECK=yes, built one right after the other (so they were definitely built with the same settings):

[http://sage.math.washington.edu/home/palmieri/misc/mark2-cddlib-094f.p7.log](http://sage.math.washington.edu/home/palmieri/misc/mark2-cddlib-094f.p7.log)
[http://sage.math.washington.edu/home/palmieri/misc/mark2-cddlib-094f.p8.log](http://sage.math.washington.edu/home/palmieri/misc/mark2-cddlib-094f.p8.log)

The test suite for p7 passes, and the test suite for p8 has lots of seg faults.



---

archive/issue_comments_115224.json:
```json
{
    "body": "<a id='comment:47'></a>FWIW I had a quick look at the code of that so-called *portable random number generator*, and did a few quick checks. Several things are odd about it. None are serious issues, but make me skeptical of the code - especially use of the word \"portable\". \n\nI would certainly **not** trust its statistical properties, given the pretty basic flaws I found in the coding, though I understand that does not matter for this application. \n\nAnyway, this is what I found. \n\n* `portable_srand` is declared as void, but then tries to return 0. That's a pretty basic programming error. Even GCC flags that as a warning. \n* The local variable `type` is declared in `portable_srand` then set to the value `rng_state.rand_type`. However, `type` is never used after being set. So it was pointless declaring `type` and setting it. It's anyone's guess if someone actually intended the algorithm to use `{{{rng_state.rand_type` or not. \n\nGCC can't detect the last problem, but SunStudio detects this programming error. That's one of the advantages of using another SunStudio - it roots out dubious code better than gcc. \n\nI added a `main`, and compared the sequence of numbers generated on several platforms. All these produced the same sequence for the 4 seeds I tried. \n \n* AIX 5.3 on PowerPC 32-bit (Since my RS/6000 7025 F50 is only 32-bit, I could not try 64-bit)\n* Linux on x86 32-bit\n* Linux on x86 64-bit\n* OpenSolaris on x86 32-bit \n* OpenSolaris on x86 64-bit \n* OS X on x86 32-bit \n* OS X on x86 64-bit\n* Solaris 10 on SPARC 32-bit \n* Solaris 10 on SPARC 64-bit \n\nIt will not compile at all on my HP C3600 running HP-UX 11.11B, since the RNG uses `stdint.h`, which is only part of the C99 standard and the older HP-UX 11.11B is not C99 aware. Quite why we need C99 code for a RNG I will never know. I was using portable random number generators well before 1999. \n\nSo I'm not sure one could attach the name \"portable\" to this, as it certainly presents issues on HP-UX. It may do on Cygwin and FreeBSD too. \n\nIn contrast, the GNU Scientific Library builds and passes all tests on HP-UX, FreeBSD and Cygwin, so is more portable. \n\nIt should also be noted this RNG produces the same sequence if the seed is 0 or 1. For at least some other values I tried, the numbers changed as the seed was changed. But for 0 or 1, the output is the same. \n\nI cc'ed Dima on this, as I thought he might find this interesting! \n\nDave",
    "created_at": "2010-10-03T18:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115224",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:47'></a>FWIW I had a quick look at the code of that so-called *portable random number generator*, and did a few quick checks. Several things are odd about it. None are serious issues, but make me skeptical of the code - especially use of the word "portable". 

I would certainly **not** trust its statistical properties, given the pretty basic flaws I found in the coding, though I understand that does not matter for this application. 

Anyway, this is what I found. 

* `portable_srand` is declared as void, but then tries to return 0. That's a pretty basic programming error. Even GCC flags that as a warning. 
* The local variable `type` is declared in `portable_srand` then set to the value `rng_state.rand_type`. However, `type` is never used after being set. So it was pointless declaring `type` and setting it. It's anyone's guess if someone actually intended the algorithm to use `{{{rng_state.rand_type` or not. 

GCC can't detect the last problem, but SunStudio detects this programming error. That's one of the advantages of using another SunStudio - it roots out dubious code better than gcc. 

I added a `main`, and compared the sequence of numbers generated on several platforms. All these produced the same sequence for the 4 seeds I tried. 
 
* AIX 5.3 on PowerPC 32-bit (Since my RS/6000 7025 F50 is only 32-bit, I could not try 64-bit)
* Linux on x86 32-bit
* Linux on x86 64-bit
* OpenSolaris on x86 32-bit 
* OpenSolaris on x86 64-bit 
* OS X on x86 32-bit 
* OS X on x86 64-bit
* Solaris 10 on SPARC 32-bit 
* Solaris 10 on SPARC 64-bit 

It will not compile at all on my HP C3600 running HP-UX 11.11B, since the RNG uses `stdint.h`, which is only part of the C99 standard and the older HP-UX 11.11B is not C99 aware. Quite why we need C99 code for a RNG I will never know. I was using portable random number generators well before 1999. 

So I'm not sure one could attach the name "portable" to this, as it certainly presents issues on HP-UX. It may do on Cygwin and FreeBSD too. 

In contrast, the GNU Scientific Library builds and passes all tests on HP-UX, FreeBSD and Cygwin, so is more portable. 

It should also be noted this RNG produces the same sequence if the seed is 0 or 1. For at least some other values I tried, the numbers changed as the seed was changed. But for 0 or 1, the output is the same. 

I cc'ed Dima on this, as I thought he might find this interesting! 

Dave



---

archive/issue_comments_115225.json:
```json
{
    "body": "<a id='comment:48'></a>* Of course it does not produce good random numbers, duh!\n\n* I'll remove the erroneous \"0\" in the return.\n\n* The GNU libc rng implements other `rng_state.rng_type` random number generators. Those were deleted. I intentionally did not remove this field: save `sizeof(int)` in exchange for more code changes?\n\n* its basically impossible to write portable code without C99. Pick any Sage component and I'll bet you there is a 16-bit machine out there that will break that code :-)\n\n* the \"portable_\" prefix is just to distinguish it from the libc functions.\n\n* The output is indeed the same for `seed=0` and `seed=1`. Same for the GNU libc `seed()` function.",
    "created_at": "2010-10-03T18:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115225",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:48'></a>* Of course it does not produce good random numbers, duh!

* I'll remove the erroneous "0" in the return.

* The GNU libc rng implements other `rng_state.rng_type` random number generators. Those were deleted. I intentionally did not remove this field: save `sizeof(int)` in exchange for more code changes?

* its basically impossible to write portable code without C99. Pick any Sage component and I'll bet you there is a 16-bit machine out there that will break that code :-)

* the "portable_" prefix is just to distinguish it from the libc functions.

* The output is indeed the same for `seed=0` and `seed=1`. Same for the GNU libc `seed()` function.



---

archive/issue_comments_115226.json:
```json
{
    "body": "<a id='comment:49'></a>Replying to [vbraun](#comment%3A48):\n> * Of course it does not produce good random numbers, duh!\n\n\nSo if it produces poor random numbers and is not portable, is is a good choice? I would suggest not. A more trivial bit of code I showed earlier:\n\n```\nstatic unsigned long next = 1;\nint myrand(void)  /* RAND_MAX assumed to be 32767. */\n{\n    next = next * 1103515245 + 12345;\n    return((unsigned)(next/65536) % 32768);\n}\n\n\nvoid mysrand(unsigned seed)\n{\n    next = seed;\n}\n```\n\nwould be more portable. Again the random numbers would not be good, but it would be simpler and more portable. Would that not be a better choice? \n\n> * its basically impossible to write portable code without C99. Pick any Sage component and I'll bet you there is a 16-bit machine out there that will break that code :-)\n\n\n16-bit machines are pretty old, and not worth worrying about. \n\nBut Even the latest FreeBSD is not fully C99 compliant. \n\nIn fact, not even gcc is fully compliant to the C99 standard, as 11 years after the standard was ratified, gcc still does not fully support it. See the latest status at \n\nhttp://gcc.gnu.org/c99status.html\n\nOf course, the gcc developers have been busy in that time adding extensions to gcc, so gcc is able to compile a superset and subset of the C standard. \n\nHence I'd personally try to avoid an unnecessary dependence of C99. Clearly this could be written to not need C99. \n \nNeedless to say SunStudio is fully C99 compliant. \n\n> * the \"portable_\" prefix is just to distinguish it from the libc functions.\n\n\nPerhaps `semi_portable` might have been better !!\n\nAnyway, all jokes aside, it does produce the same sequence of numbers on the platforms I was able to build it on. \n\nDave",
    "created_at": "2010-10-03T19:19:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115226",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:49'></a>Replying to [vbraun](#comment%3A48):
> * Of course it does not produce good random numbers, duh!


So if it produces poor random numbers and is not portable, is is a good choice? I would suggest not. A more trivial bit of code I showed earlier:

```
static unsigned long next = 1;
int myrand(void)  /* RAND_MAX assumed to be 32767. */
{
    next = next * 1103515245 + 12345;
    return((unsigned)(next/65536) % 32768);
}


void mysrand(unsigned seed)
{
    next = seed;
}
```

would be more portable. Again the random numbers would not be good, but it would be simpler and more portable. Would that not be a better choice? 

> * its basically impossible to write portable code without C99. Pick any Sage component and I'll bet you there is a 16-bit machine out there that will break that code :-)


16-bit machines are pretty old, and not worth worrying about. 

But Even the latest FreeBSD is not fully C99 compliant. 

In fact, not even gcc is fully compliant to the C99 standard, as 11 years after the standard was ratified, gcc still does not fully support it. See the latest status at 

http://gcc.gnu.org/c99status.html

Of course, the gcc developers have been busy in that time adding extensions to gcc, so gcc is able to compile a superset and subset of the C standard. 

Hence I'd personally try to avoid an unnecessary dependence of C99. Clearly this could be written to not need C99. 
 
Needless to say SunStudio is fully C99 compliant. 

> * the "portable_" prefix is just to distinguish it from the libc functions.


Perhaps `semi_portable` might have been better !!

Anyway, all jokes aside, it does produce the same sequence of numbers on the platforms I was able to build it on. 

Dave



---

archive/issue_comments_115227.json:
```json
{
    "body": "<a id='comment:50'></a>The downside of your code is, of course, that it will change a lot of existing doctests that were written using the GNU libc rng. If that weren't a concern then I would have used a linear congruential generator myself.\n\n> 16-bit machines are pretty old\n\n\nso is HP-UX 11.11. This December you'll be able to celebrate its 10th birthday ;-)",
    "created_at": "2010-10-03T19:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115227",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:50'></a>The downside of your code is, of course, that it will change a lot of existing doctests that were written using the GNU libc rng. If that weren't a concern then I would have used a linear congruential generator myself.

> 16-bit machines are pretty old


so is HP-UX 11.11. This December you'll be able to celebrate its 10th birthday ;-)



---

archive/issue_comments_115228.json:
```json
{
    "body": "<a id='comment:51'></a>I have removed the offending return statement, now compiles without warnings. As usual, get it at http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg \n\nMaybe someone could try this on Solaris? I don't have any other idea what could cause the segfaults there. But its possible that this was the problem...",
    "created_at": "2010-10-10T21:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115228",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:51'></a>I have removed the offending return statement, now compiles without warnings. As usual, get it at http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg 

Maybe someone could try this on Solaris? I don't have any other idea what could cause the segfaults there. But its possible that this was the problem...



---

archive/issue_comments_115229.json:
```json
{
    "body": "<a id='comment:52'></a>Replying to [vbraun](#comment%3A51):\n> I have removed the offending return statement, now compiles without warnings. As usual, get it at http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg \n> \n> Maybe someone could try this on Solaris? I don't have any other idea what could cause the segfaults there. But its possible that this was the problem...\n\n\n\nI tried on OpenSolaris - it still segfaults. \n\n```\nNumber Type = integer\n./spkg-check: line 11: 24952: Memory fault(coredump)\nd1 35\ncdd_both_reps not working as expected\nTesting sampleh2.ine\nsize = 1 x 4\nNumber Type = integer\n./spkg-check: line 11: 24955: Memory fault(coredump)\nd1 31\n```",
    "created_at": "2010-10-10T22:27:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115229",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:52'></a>Replying to [vbraun](#comment%3A51):
> I have removed the offending return statement, now compiles without warnings. As usual, get it at http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg 
> 
> Maybe someone could try this on Solaris? I don't have any other idea what could cause the segfaults there. But its possible that this was the problem...



I tried on OpenSolaris - it still segfaults. 

```
Number Type = integer
./spkg-check: line 11: 24952: Memory fault(coredump)
d1 35
cdd_both_reps not working as expected
Testing sampleh2.ine
size = 1 x 4
Number Type = integer
./spkg-check: line 11: 24955: Memory fault(coredump)
d1 31
```



---

archive/issue_comments_115230.json:
```json
{
    "body": "<a id='comment:53'></a>OK, I installed `OpenSolaris` 2009.06 in a virtual machine and debugged the problem. The issue is that Solaris sets `RAND_MAX=32767` and cddlib does essentially this (pseudocode)\n\n```\n  r = (double)rand()\n  k = int(sizeof(my_array) * r / RAND_MAX)\n  random_element = my_array[k]\n```\nwhich overflows after replacing rand with the glibc rand (which has RAND_MAX=2147483647).\n\nI've fixed the issue by unconditionally overriding `RAND_MAX` in the new `random.h` instead of checking if it is already #defined.\n\nUpdated spkg is at http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg\n\nI tested it on Fedora 13, `OpenSolaris` 2009.06 i386, and OSX 10.6.4. The testsuite passes on all three.",
    "created_at": "2010-10-18T10:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115230",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:53'></a>OK, I installed `OpenSolaris` 2009.06 in a virtual machine and debugged the problem. The issue is that Solaris sets `RAND_MAX=32767` and cddlib does essentially this (pseudocode)

```
  r = (double)rand()
  k = int(sizeof(my_array) * r / RAND_MAX)
  random_element = my_array[k]
```
which overflows after replacing rand with the glibc rand (which has RAND_MAX=2147483647).

I've fixed the issue by unconditionally overriding `RAND_MAX` in the new `random.h` instead of checking if it is already #defined.

Updated spkg is at http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg

I tested it on Fedora 13, `OpenSolaris` 2009.06 i386, and OSX 10.6.4. The testsuite passes on all three.



---

archive/issue_comments_115231.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-10-18T10:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115231",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_115232.json:
```json
{
    "body": "<a id='comment:54'></a>Replying to [vbraun](#comment%3A53):\n> OK, I installed `OpenSolaris` 2009.06 in a virtual machine and debugged the problem. The issue is that Solaris sets `RAND_MAX=32767` and cddlib does essentially this (pseudocode)\n> \n> ```\n>   r = (double)rand()\n>   k = int(sizeof(my_array) * r / RAND_MAX)\n>   random_element = my_array[k]\n> ```\n> which overflows after replacing rand with the glibc rand (which has RAND_MAX=2147483647).\n> \n> I've fixed the issue by unconditionally overriding `RAND_MAX` in the new `random.h` instead of checking if it is already #defined.\n> \n> Updated spkg is at http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg\n> \n> I tested it on Fedora 13, `OpenSolaris` 2009.06 i386, and OSX 10.6.4. The testsuite passes on all three. \n\n\nI just tested in on a Debian testing x64; let me test on a MacOSX PPC, just to have one non-x86 in the picture.",
    "created_at": "2010-10-18T11:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115232",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:54'></a>Replying to [vbraun](#comment%3A53):
> OK, I installed `OpenSolaris` 2009.06 in a virtual machine and debugged the problem. The issue is that Solaris sets `RAND_MAX=32767` and cddlib does essentially this (pseudocode)
> 
> ```
>   r = (double)rand()
>   k = int(sizeof(my_array) * r / RAND_MAX)
>   random_element = my_array[k]
> ```
> which overflows after replacing rand with the glibc rand (which has RAND_MAX=2147483647).
> 
> I've fixed the issue by unconditionally overriding `RAND_MAX` in the new `random.h` instead of checking if it is already #defined.
> 
> Updated spkg is at http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg
> 
> I tested it on Fedora 13, `OpenSolaris` 2009.06 i386, and OSX 10.6.4. The testsuite passes on all three. 


I just tested in on a Debian testing x64; let me test on a MacOSX PPC, just to have one non-x86 in the picture.



---

archive/issue_comments_115233.json:
```json
{
    "body": "<a id='comment:55'></a>Replying to [vbraun](#comment%3A53):\n\n> Updated spkg is at http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg\n> \n> I tested it on Fedora 13, `OpenSolaris` 2009.06 i386, and OSX 10.6.4. The testsuite passes on all three. \n\n\ntested on MacOSX PPC 10.5 and Debian Linux. Positive!",
    "created_at": "2010-10-18T14:49:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115233",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:55'></a>Replying to [vbraun](#comment%3A53):

> Updated spkg is at http://www.stp.dias.ie/~vbraun/Sage/spkg/cddlib-094f.p8.spkg
> 
> I tested it on Fedora 13, `OpenSolaris` 2009.06 i386, and OSX 10.6.4. The testsuite passes on all three. 


tested on MacOSX PPC 10.5 and Debian Linux. Positive!



---

archive/issue_comments_115234.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-10-18T14:49:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115234",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_115235.json:
```json
{
    "body": "<a id='comment:56'></a>More positive testing: all tests passed on OS X 10.5, 10.6, and 64-bit Ubuntu 10.10.",
    "created_at": "2010-10-18T21:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115235",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

<a id='comment:56'></a>More positive testing: all tests passed on OS X 10.5, 10.6, and 64-bit Ubuntu 10.10.



---

archive/issue_comments_115236.json:
```json
{
    "body": "<a id='comment:57'></a>I get build errors on several Skynet hosts:\n\n* [taurus log](http://build.sagemath.org/sage/builders/taurus%20full/builds/25/steps/shell_1/logs/cddlib) (and similarly on eno, flavius, and sextus).\n\n It seems this stems from a NFS configuration problem on [some of] Skynet's Fedora 13 hosts.  Or is it an auto* problem?  I've had the same problem with GD and MPFI, and I've worked around it by installing these serially and continuing the build.  Installing CDDLIB p8 serially works.  I haven't had any problems with the previous cddlib package.  In particular, I can install p7 successfully in parallel (or serially).\n\n* [iras log](http://build.sagemath.org/sage/builders/iras%20full/builds/33/steps/shell_1/logs/cddlib)\n\n Here, serial and parallel builds of p8 do not work.  But they do work with p7.\n\nSome host system information is [here](http://build.sagemath.org/sage/buildslaves).",
    "created_at": "2010-10-21T07:27:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115236",
    "user": "https://github.com/qed777"
}
```

<a id='comment:57'></a>I get build errors on several Skynet hosts:

* [taurus log](http://build.sagemath.org/sage/builders/taurus%20full/builds/25/steps/shell_1/logs/cddlib) (and similarly on eno, flavius, and sextus).

 It seems this stems from a NFS configuration problem on [some of] Skynet's Fedora 13 hosts.  Or is it an auto* problem?  I've had the same problem with GD and MPFI, and I've worked around it by installing these serially and continuing the build.  Installing CDDLIB p8 serially works.  I haven't had any problems with the previous cddlib package.  In particular, I can install p7 successfully in parallel (or serially).

* [iras log](http://build.sagemath.org/sage/builders/iras%20full/builds/33/steps/shell_1/logs/cddlib)

 Here, serial and parallel builds of p8 do not work.  But they do work with p7.

Some host system information is [here](http://build.sagemath.org/sage/buildslaves).



---

archive/issue_comments_115237.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dmitrii Pasechnik\"",
    "created_at": "2010-10-21T07:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115237",
    "user": "https://github.com/qed777"
}
```

Changing reviewer from "" to "Dmitrii Pasechnik"



---

archive/issue_comments_115238.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2010-10-21T08:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115238",
    "user": "https://github.com/qed777"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_115239.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2010-10-21T08:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115239",
    "user": "https://github.com/qed777"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_115240.json:
```json
{
    "body": "<a id='comment:61'></a>I feel your pain but it seems like autotools can't find a way to lock files on taurus:\n\n```\nautom4te: cannot lock autom4te.cache/requests with mode 2: No locks available\nautom4te: forgo `make -j' or use a file system that supports locks\n```\nand it seems like the system clock is wayyy off on iras:\n\n```\nchecking whether build environment is sane... configure: error: newly created file is older than distributed files!\nCheck your system clock\n```\nIts possible that p7 had less sanity checks because it used slightly older autotools. But I don't see anything issue that can be addressed on the spkg level. You can't safely use parallel make without locking and you can't use make without a reasonable timekeeping device.",
    "created_at": "2010-10-21T09:00:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115240",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:61'></a>I feel your pain but it seems like autotools can't find a way to lock files on taurus:

```
autom4te: cannot lock autom4te.cache/requests with mode 2: No locks available
autom4te: forgo `make -j' or use a file system that supports locks
```
and it seems like the system clock is wayyy off on iras:

```
checking whether build environment is sane... configure: error: newly created file is older than distributed files!
Check your system clock
```
Its possible that p7 had less sanity checks because it used slightly older autotools. But I don't see anything issue that can be addressed on the spkg level. You can't safely use parallel make without locking and you can't use make without a reasonable timekeeping device.



---

archive/issue_comments_115241.json:
```json
{
    "body": "<a id='comment:62'></a>Thanks, Volker.  Running `date` on iras and boxen at about the same time gives `Thu Oct 21 05:14:13 EDT 2010` and `Thu Oct 21 02:14:13 PDT 2010`, respectively.  Or is it deeper than this?\n\nLeif and David, do you have any thoughts about the problems in [comment 57](#comment%3A57)?  The Skynet Fedora machines were recently upgraded from F12 to F13.\n\nIf there's a problem with the GD and MPFI spkgs, we can leave that for a future release.",
    "created_at": "2010-10-21T09:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115241",
    "user": "https://github.com/qed777"
}
```

<a id='comment:62'></a>Thanks, Volker.  Running `date` on iras and boxen at about the same time gives `Thu Oct 21 05:14:13 EDT 2010` and `Thu Oct 21 02:14:13 PDT 2010`, respectively.  Or is it deeper than this?

Leif and David, do you have any thoughts about the problems in [comment 57](#comment%3A57)?  The Skynet Fedora machines were recently upgraded from F12 to F13.

If there's a problem with the GD and MPFI spkgs, we can leave that for a future release.



---

archive/issue_comments_115242.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.6.rc0\"",
    "created_at": "2010-10-21T22:07:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115242",
    "user": "https://github.com/qed777"
}
```

Changing merged from "" to "sage-4.6.rc0"



---

archive/issue_comments_115243.json:
```json
{
    "body": "Changing reviewer from \"Dmitrii Pasechnik\" to \"Dmitrii Pasechnik, Marshall Hampton\"",
    "created_at": "2010-10-21T23:54:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115243",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

Changing reviewer from "Dmitrii Pasechnik" to "Dmitrii Pasechnik, Marshall Hampton"



---

archive/issue_comments_115244.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-10-22T07:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9798#issuecomment-115244",
    "user": "https://github.com/qed777"
}
```

Resolution: fixed



---

archive/issue_events_024594.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-10-22T07:35:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9798",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9798#event-24594"
}
```
