# Issue 9225: New doctesting features

archive/issues_009225.json:
```json
{
    "body": "This is an umbrella ticket for various improvements to the Sage doctesting framework.  For example:\n\n  When we doctest several files in parallel or in sequence, it might be helpful to print stats relating to the test suite's progress, e.g.,\n\n```sh\n$ sage -t monoids/\nsage -t  \"monoids/monoid.py\"\n 1/10    1.9 s / 1.9 s\nsage -t  \"monoids/free_monoid.py\"\n 2/10    2.0 s / 3.9 s\n[...]\n```\n  What other columns would be useful?  Coverage?\n\nPlease see the comments for more ideas.  Suggestions are welcome!\n\nRelated: #838, #4294, #7493, #8385, #9224, #9739, #10458.\n\nAssignee: mvngu\n\nCC:  @wjp @nexttime @rbeezer\n\nReviewer: David Roe, Jeroen Demeyer\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/9225\n\n",
    "closed_at": "2013-03-07T08:18:34Z",
    "created_at": "2010-06-12T10:18:49Z",
    "labels": [
        "component: doctest coverage"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "New doctesting features",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9225",
    "user": "https://github.com/qed777"
}
```
This is an umbrella ticket for various improvements to the Sage doctesting framework.  For example:

  When we doctest several files in parallel or in sequence, it might be helpful to print stats relating to the test suite's progress, e.g.,

```sh
$ sage -t monoids/
sage -t  "monoids/monoid.py"
 1/10    1.9 s / 1.9 s
sage -t  "monoids/free_monoid.py"
 2/10    2.0 s / 3.9 s
[...]
```
  What other columns would be useful?  Coverage?

Please see the comments for more ideas.  Suggestions are welcome!

Related: #838, #4294, #7493, #8385, #9224, #9739, #10458.

Assignee: mvngu

CC:  @wjp @nexttime @rbeezer

Reviewer: David Roe, Jeroen Demeyer

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/9225





---

archive/issue_comments_089958.json:
```json
{
    "body": "<a id='comment:2'></a>If we widen the scope here a bit:  We should use [optparse](http://docs.python.org/library/optparse.html), at least, to handle command-line arguments.",
    "created_at": "2010-07-07T06:47:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9225#issuecomment-89958",
    "user": "https://github.com/qed777"
}
```

<a id='comment:2'></a>If we widen the scope here a bit:  We should use [optparse](http://docs.python.org/library/optparse.html), at least, to handle command-line arguments.



---

archive/issue_comments_089959.json:
```json
{
    "body": "<a id='comment:4'></a>Other possibilities, probably mentioned before and probably for other tickets:\n\n* \"Librarify:\" Make it possible to doctest files and objects from the Sage command-line or notebook, e.g.,\n\n```python\nsage: doctest('file.sage', long=True, optional=['axiom', 'magma'])\nsage: doctest(os.path.join(SAGE_ROOT, 'devel', 'sage', 'sage', 'monoids'), processes=4)\nsage: stats = {}     # Collect errors, counts, timings, etc.\nsage: doctest(['foo.py', 'bar.pyx'], stats=stats)\nsage: def f():\n....:     \"\"\"\n....:     sage: f()\n....:     1\n....:     \"\"\"\n....:     return 1\n....: \nsage: doctest(f)\n```\n\n* Doctest the doctesting framework!  I think we could include [comment:ticket:9449:13 this example], at least.\n\n* An option to run an individual `file.py`'s \"examples\" (i.e., the files `example_*` functions) in parallel.",
    "created_at": "2010-07-09T00:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9225#issuecomment-89959",
    "user": "https://github.com/qed777"
}
```

<a id='comment:4'></a>Other possibilities, probably mentioned before and probably for other tickets:

* "Librarify:" Make it possible to doctest files and objects from the Sage command-line or notebook, e.g.,

```python
sage: doctest('file.sage', long=True, optional=['axiom', 'magma'])
sage: doctest(os.path.join(SAGE_ROOT, 'devel', 'sage', 'sage', 'monoids'), processes=4)
sage: stats = {}     # Collect errors, counts, timings, etc.
sage: doctest(['foo.py', 'bar.pyx'], stats=stats)
sage: def f():
....:     """
....:     sage: f()
....:     1
....:     """
....:     return 1
....: 
sage: doctest(f)
```

* Doctest the doctesting framework!  I think we could include [comment:ticket:9449:13 this example], at least.

* An option to run an individual `file.py`'s "examples" (i.e., the files `example_*` functions) in parallel.



---

archive/issue_comments_089960.json:
```json
{
    "body": "<a id='comment:5'></a>A way to upload anonymized test stats and system information to a remote server?",
    "created_at": "2010-07-15T07:23:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9225#issuecomment-89960",
    "user": "https://github.com/qed777"
}
```

<a id='comment:5'></a>A way to upload anonymized test stats and system information to a remote server?



---

archive/issue_comments_089961.json:
```json
{
    "body": "<a id='comment:6'></a>Also potentially useful: doctesting the same file multiple times in parallel.  I think this is just a matter of generating in `sage-doctest` a unique name, e.g., `.doctest_foo-R3X87S.py` for each run on `foo.py`.",
    "created_at": "2010-08-08T08:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9225#issuecomment-89961",
    "user": "https://github.com/qed777"
}
```

<a id='comment:6'></a>Also potentially useful: doctesting the same file multiple times in parallel.  I think this is just a matter of generating in `sage-doctest` a unique name, e.g., `.doctest_foo-R3X87S.py` for each run on `foo.py`.



---

archive/issue_comments_089962.json:
```json
{
    "body": "<a id='comment:7'></a>I have a suspicion that some doctests fail when the system is under heavy load. It would be good if the one-minute and perhaps 5 minute load average could be recorded with any failures, along with the dates and time as I mentioned before.",
    "created_at": "2010-08-27T11:46:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9225#issuecomment-89962",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:7'></a>I have a suspicion that some doctests fail when the system is under heavy load. It would be good if the one-minute and perhaps 5 minute load average could be recorded with any failures, along with the dates and time as I mentioned before.



---

archive/issue_comments_089963.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:5 mpatel]:\n> A way to upload anonymized test stats and system information to a remote server?\n\nYes, but with the option of giving a name if one wishes to. It will make problems easier to manage if people did give a name + email, but certainly make it optional.",
    "created_at": "2010-08-27T11:48:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9225#issuecomment-89963",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:8'></a>Replying to [comment:5 mpatel]:
> A way to upload anonymized test stats and system information to a remote server?

Yes, but with the option of giving a name if one wishes to. It will make problems easier to manage if people did give a name + email, but certainly make it optional.



---

archive/issue_comments_089964.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:6 mpatel]:\n> Also potentially useful: doctesting the same file multiple times in parallel.  I think this is just a matter of generating in `sage-doctest` a unique name, e.g., `.doctest_foo-R3X87S.py` for each run on `foo.py`.\n\n\nThis is #9739.",
    "created_at": "2010-08-27T22:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9225#issuecomment-89964",
    "user": "https://github.com/qed777"
}
```

<a id='comment:9'></a>Replying to [comment:6 mpatel]:
> Also potentially useful: doctesting the same file multiple times in parallel.  I think this is just a matter of generating in `sage-doctest` a unique name, e.g., `.doctest_foo-R3X87S.py` for each run on `foo.py`.


This is #9739.



---

archive/issue_comments_089965.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n-When we doctest several files in parallel or in sequence, it might be helpful to print stats relating to the test suite's progress, e.g.,\n+This is an umbrella ticket for various improvements to the Sage doctesting framework.  For example:\n+\n+  When we doctest several files in parallel or in sequence, it might be helpful to print stats relating to the test suite's progress, e.g.,\n \n \\`\\`\\`sh\n $ sage -t monoids/\n@@ -8,7 +10,11 @@\n  2/10    2.0 s / 3.9 s\n [...]\n \\`\\`\\`\n-What other columns would be useful?  Coverage?\n+  What other columns would be useful?  Coverage?\n+\n+Please see the comments for more ideas.  Suggestions are welcome!\n+\n+Related: #9224.\n \n Comment: 1\n \n```\n",
    "created_at": "2010-08-27T22:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9225#issuecomment-89965",
    "user": "https://github.com/qed777"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,6 @@
-When we doctest several files in parallel or in sequence, it might be helpful to print stats relating to the test suite's progress, e.g.,
+This is an umbrella ticket for various improvements to the Sage doctesting framework.  For example:
+
+  When we doctest several files in parallel or in sequence, it might be helpful to print stats relating to the test suite's progress, e.g.,
 
 \`\`\`sh
 $ sage -t monoids/
@@ -8,7 +10,11 @@
  2/10    2.0 s / 3.9 s
 [...]
 \`\`\`
-What other columns would be useful?  Coverage?
+  What other columns would be useful?  Coverage?
+
+Please see the comments for more ideas.  Suggestions are welcome!
+
+Related: #9224.
 
 Comment: 1
 
```




---

archive/issue_comments_089966.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:2 mpatel]:\n> If we widen the scope here a bit:  We should use [optparse](http://docs.python.org/library/optparse.html), at least, to handle command-line arguments.\n\nThough if you look at that link, it says its been depreciated in favor of `argparse`. \n\nDave",
    "created_at": "2010-08-27T22:32:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9225#issuecomment-89966",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:11'></a>Replying to [comment:2 mpatel]:
> If we widen the scope here a bit:  We should use [optparse](http://docs.python.org/library/optparse.html), at least, to handle command-line arguments.

Though if you look at that link, it says its been depreciated in favor of `argparse`. 

Dave



---

archive/issue_comments_089967.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 drkirkby]:\n> Replying to [comment:2 mpatel]:\n> > If we widen the scope here a bit:  We should use [optparse](http://docs.python.org/library/optparse.html), at least, to handle command-line arguments.\n\n> Though if you look at that link, it says its been depreciated in favor of `argparse`. \n\nThat's why I inserted \"at least,\" but I should have more specific.  We'll need to upgrade to Python 2.7 to use [argparse](http://docs.python.org/library/argparse.html#module-argparse) readily.  [argparse](http://code.google.com/p/argparse/) used to be an independent project.",
    "created_at": "2010-08-28T00:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9225#issuecomment-89967",
    "user": "https://github.com/qed777"
}
```

<a id='comment:12'></a>Replying to [comment:11 drkirkby]:
> Replying to [comment:2 mpatel]:
> > If we widen the scope here a bit:  We should use [optparse](http://docs.python.org/library/optparse.html), at least, to handle command-line arguments.

> Though if you look at that link, it says its been depreciated in favor of `argparse`. 

That's why I inserted "at least," but I should have more specific.  We'll need to upgrade to Python 2.7 to use [argparse](http://docs.python.org/library/argparse.html#module-argparse) readily.  [argparse](http://code.google.com/p/argparse/) used to be an independent project.



---

archive/issue_comments_089968.json:
```json
{
    "body": "<a id='comment:13'></a>Rob, perhaps you could state your personal wishes here, too.\n\n(E.g. `./sage -testall ...` with an option to specify the number of threads IIRC rather than always doing that serially.)",
    "created_at": "2010-12-16T02:40:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9225#issuecomment-89968",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:13'></a>Rob, perhaps you could state your personal wishes here, too.

(E.g. `./sage -testall ...` with an option to specify the number of threads IIRC rather than always doing that serially.)



---

archive/issue_comments_089969.json:
```json
{
    "body": "<a id='comment:14'></a>#10458 improves cut & paste of doctest code & output from an actual Sage session, in that it allows also \"`....: `\" for line continuations. (Previously, for some reason only \"`...`\" was supported in docstrings; also the confusion with an ellipsis intended to mean arbitrary **output** should be reduced by this ticket.)\n\nAnother problem still has to be addressed: The original (non-preparsed) source code of continuation lines gets \"lost\", i.e. doesn't end up in the end-of-line comments of the generated test files (`.doctest_*`) as it does for ordinary lines, hence also won't be shown on doctest errors or when one doctests in verbose mode.",
    "created_at": "2010-12-16T03:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9225#issuecomment-89969",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>#10458 improves cut & paste of doctest code & output from an actual Sage session, in that it allows also "`....: `" for line continuations. (Previously, for some reason only "`...`" was supported in docstrings; also the confusion with an ellipsis intended to mean arbitrary **output** should be reduced by this ticket.)

Another problem still has to be addressed: The original (non-preparsed) source code of continuation lines gets "lost", i.e. doesn't end up in the end-of-line comments of the generated test files (`.doctest_*`) as it does for ordinary lines, hence also won't be shown on doctest errors or when one doctests in verbose mode.



---

archive/issue_comments_089970.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,20 @@\n+This is an umbrella ticket for various improvements to the Sage doctesting framework.  For example:\n \n+  When we doctest several files in parallel or in sequence, it might be helpful to print stats relating to the test suite's progress, e.g.,\n+\n+\\`\\`\\`sh\n+$ sage -t monoids/\n+sage -t  \"monoids/monoid.py\"\n+ 1/10    1.9 s / 1.9 s\n+sage -t  \"monoids/free_monoid.py\"\n+ 2/10    2.0 s / 3.9 s\n+[...]\n+\\`\\`\\`\n+  What other columns would be useful?  Coverage?\n+\n+Please see the comments for more ideas.  Suggestions are welcome!\n+\n+Related: #9224, #9739, #10458.\n \n Comment: 1\n \n```\n",
    "created_at": "2010-12-16T03:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9225#issuecomment-89970",
    "user": "https://github.com/nexttime"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,20 @@
+This is an umbrella ticket for various improvements to the Sage doctesting framework.  For example:
 
+  When we doctest several files in parallel or in sequence, it might be helpful to print stats relating to the test suite's progress, e.g.,
+
+\`\`\`sh
+$ sage -t monoids/
+sage -t  "monoids/monoid.py"
+ 1/10    1.9 s / 1.9 s
+sage -t  "monoids/free_monoid.py"
+ 2/10    2.0 s / 3.9 s
+[...]
+\`\`\`
+  What other columns would be useful?  Coverage?
+
+Please see the comments for more ideas.  Suggestions are welcome!
+
+Related: #9224, #9739, #10458.
 
 Comment: 1
 
```




---

archive/issue_comments_089971.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,20 @@\n+This is an umbrella ticket for various improvements to the Sage doctesting framework.  For example:\n \n+  When we doctest several files in parallel or in sequence, it might be helpful to print stats relating to the test suite's progress, e.g.,\n+\n+\\`\\`\\`sh\n+$ sage -t monoids/\n+sage -t  \"monoids/monoid.py\"\n+ 1/10    1.9 s / 1.9 s\n+sage -t  \"monoids/free_monoid.py\"\n+ 2/10    2.0 s / 3.9 s\n+[...]\n+\\`\\`\\`\n+  What other columns would be useful?  Coverage?\n+\n+Please see the comments for more ideas.  Suggestions are welcome!\n+\n+Related: #838, #4294, #7493, #8385, #9224, #9739, #10458.\n \n Comment: 1\n \n```\n",
    "created_at": "2012-02-06T05:22:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9225#issuecomment-89971",
    "user": "https://github.com/roed314"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,20 @@
+This is an umbrella ticket for various improvements to the Sage doctesting framework.  For example:
 
+  When we doctest several files in parallel or in sequence, it might be helpful to print stats relating to the test suite's progress, e.g.,
+
+\`\`\`sh
+$ sage -t monoids/
+sage -t  "monoids/monoid.py"
+ 1/10    1.9 s / 1.9 s
+sage -t  "monoids/free_monoid.py"
+ 2/10    2.0 s / 3.9 s
+[...]
+\`\`\`
+  What other columns would be useful?  Coverage?
+
+Please see the comments for more ideas.  Suggestions are welcome!
+
+Related: #838, #4294, #7493, #8385, #9224, #9739, #10458.
 
 Comment: 1
 
```




---

archive/issue_comments_089972.json:
```json
{
    "body": "<a id='comment:16'></a>#12415 will add many of these features.",
    "created_at": "2012-02-06T05:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9225#issuecomment-89972",
    "user": "https://github.com/roed314"
}
```

<a id='comment:16'></a>#12415 will add many of these features.



---

archive/issue_comments_089973.json:
```json
{
    "body": "<a id='comment:17'></a>As David mentioned, there is a lot of work at #12415. And apart from that, this ticket is extremely vague.",
    "created_at": "2013-02-28T16:09:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9225#issuecomment-89973",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>As David mentioned, there is a lot of work at #12415. And apart from that, this ticket is extremely vague.



---

archive/issue_comments_089974.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-02-28T16:09:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9225#issuecomment-89974",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_events_022713.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-28T16:09:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9225#event-22713"
}
```



---

archive/issue_comments_089975.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-02-28T16:10:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9225#issuecomment-89975",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_022714.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-07T08:18:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9225#event-22714"
}
```



---

archive/issue_comments_089976.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2013-03-07T08:18:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9225#issuecomment-89976",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: invalid
