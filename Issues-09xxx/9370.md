# Issue 9370: customize printing of elements in CombinatorialFreeModules

archive/issues_009370.json:
```json
{
    "body": "The attached patch allows customization of printing of elements in the class `CombinatorialFreeModuleElement`.  It also adds documentation to `CombinatorialFreeModule` spelling out these options (and all of the other options, I think).\n\nApply only trac_9370-module-elt-repr-all-in-one.patch.\n\n**Assignee:** sage-combinat\n\n**CC:**  sage-combinat\n\n**Author:** John Palmieri, Christian Stump\n\n**Reviewer:** Franco Saliola, Christian Stump\n\n**Merged:** sage-4.7.alpha4\n\nIssue created by migration from https://trac.sagemath.org/ticket/9370\n\n",
    "closed_at": "2011-04-07T13:49:58Z",
    "created_at": "2010-06-29T04:09:11Z",
    "labels": [
        "component: combinatorics",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7",
    "title": "customize printing of elements in CombinatorialFreeModules",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/9370",
    "user": "https://github.com/jhpalmieri"
}
```
The attached patch allows customization of printing of elements in the class `CombinatorialFreeModuleElement`.  It also adds documentation to `CombinatorialFreeModule` spelling out these options (and all of the other options, I think).

Apply only trac_9370-module-elt-repr-all-in-one.patch.

**Assignee:** sage-combinat

**CC:**  sage-combinat

**Author:** John Palmieri, Christian Stump

**Reviewer:** Franco Saliola, Christian Stump

**Merged:** sage-4.7.alpha4

Issue created by migration from https://trac.sagemath.org/ticket/9370





---

archive/issue_comments_081716.json:
```json
{
    "body": "<a id='comment:1'></a>\nHello John,\n\nI like your ideas. I have a few quick comments for you now.\n\nComments on the docstring for `CombinatorialFreeModule`:\n\n```                                                                             \n    - ``basis_keys`` - list, tuple, family, set, etc. defining the \n      basis of this module\n```\nbasis_keys provides the indexing set for the basis, not the basis itself.\n \n\n```\n    - ``element_class`` - the class of which elements of this module\n      should be instances (optional, default None)\n```\nI understand that the default argument is None, but it would be nice to\nhave a description of the class used in that case since elements are not \ninstances of None.\n \n\n```\n    - ``prefix`` - prefix used for printing elements of this module\n      (optional, default 'B').  With the default, a monomial indexed\n      by 'a' would be printed as ``B['a']``.\n \n    - ``latex_prefix`` - prefix used in the LaTeX representation of\n      elements (optional, default same as 'prefix').  With the \n      default, a monomial indexed by 'a' would be printed as\n      ``B_{a}``.  If this is the empty string, then don't print\n      monomials as subscripts: the monomial indexed by 'a' would be\n      printed as ``a``, or as ``[a]`` if ``latex_bracket`` is True.\n```\nIt doesn't say here, but it seems that prefix and latex_prefix are supposed\nto be strings. Or anything that concatenates with a string (for example, I\nthink any instance of LatexExpr will work).\n \n\n```\n    - ``repr_bracket`` - whether to print a bracket when printing\n      elements (optional, default True).  If it is one of \"[\", \"(\", or\n      \"{\", use it and its partner as brackets.  If this is any other\n      string, use it as both brackets.\n```\nPlease describe what bracket gets used with the default option. Also, the \ncode sets the default to None, not True.\n\nAnd perhaps a method called print_options might be useful (instead of pointing the user to an \"internal\" attribute). With no arguments, it will return _print_options and otherwise it will set the appropriate option. For example,\n\n```\nsage: A.print_options(repr_bracket=\"|\") # to change repr_bracket\n```\nWhat do you think?",
    "created_at": "2010-06-30T14:04:45Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81716",
    "user": "https://github.com/saliola"
}
```

<a id='comment:1'></a>
Hello John,

I like your ideas. I have a few quick comments for you now.

Comments on the docstring for `CombinatorialFreeModule`:

```                                                                             
    - ``basis_keys`` - list, tuple, family, set, etc. defining the 
      basis of this module
```
basis_keys provides the indexing set for the basis, not the basis itself.
 

```
    - ``element_class`` - the class of which elements of this module
      should be instances (optional, default None)
```
I understand that the default argument is None, but it would be nice to
have a description of the class used in that case since elements are not 
instances of None.
 

```
    - ``prefix`` - prefix used for printing elements of this module
      (optional, default 'B').  With the default, a monomial indexed
      by 'a' would be printed as ``B['a']``.
 
    - ``latex_prefix`` - prefix used in the LaTeX representation of
      elements (optional, default same as 'prefix').  With the 
      default, a monomial indexed by 'a' would be printed as
      ``B_{a}``.  If this is the empty string, then don't print
      monomials as subscripts: the monomial indexed by 'a' would be
      printed as ``a``, or as ``[a]`` if ``latex_bracket`` is True.
```
It doesn't say here, but it seems that prefix and latex_prefix are supposed
to be strings. Or anything that concatenates with a string (for example, I
think any instance of LatexExpr will work).
 

```
    - ``repr_bracket`` - whether to print a bracket when printing
      elements (optional, default True).  If it is one of "[", "(", or
      "{", use it and its partner as brackets.  If this is any other
      string, use it as both brackets.
```
Please describe what bracket gets used with the default option. Also, the 
code sets the default to None, not True.

And perhaps a method called print_options might be useful (instead of pointing the user to an "internal" attribute). With no arguments, it will return _print_options and otherwise it will set the appropriate option. For example,

```
sage: A.print_options(repr_bracket="|") # to change repr_bracket
```
What do you think?



---

archive/issue_events_068634.json:
```json
{
    "actor": "https://github.com/saliola",
    "created_at": "2010-06-30T14:04:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9370#event-68634"
}
```



---

archive/issue_comments_081717.json:
```json
{
    "body": "<a id='comment:2'></a>\nReplying to [saliola](#comment%3A1):\n> Hello John,\n\n\nThanks for your comments.\n\n> basis_keys provides the indexing set for the basis, not the basis itself.\n\n\nFixed.\n\n> ``element_class``: I understand that the default argument is None, but it would be nice to\n> have a description of the class used in that case since elements are not \n> instances of None.\n\n\nFixed, I think.\n\n> It doesn't say here, but it seems that prefix and latex_prefix are supposed\n> to be strings. Or anything that concatenates with a string (for example, I\n> think any instance of LatexExpr will work).\n\n\nI've documented that they should be strings.  It's true that a `LatexExpr` will work, but I don't think we need to spell that out.\n\n> ``repr_bracket``: Please describe what bracket gets used with the default option. Also, the \n> code sets the default to None, not True.\n\n\nI've expanded on the explanation here.\n \n> And perhaps a method called print_options might be useful (instead of pointing the user to an \"internal\" attribute). With no arguments, it will return _print_options and otherwise it will set the appropriate option. \n\n\nGood idea, I've implemented this.",
    "created_at": "2010-06-30T16:57:52Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81717",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
Replying to [saliola](#comment%3A1):
> Hello John,


Thanks for your comments.

> basis_keys provides the indexing set for the basis, not the basis itself.


Fixed.

> ``element_class``: I understand that the default argument is None, but it would be nice to
> have a description of the class used in that case since elements are not 
> instances of None.


Fixed, I think.

> It doesn't say here, but it seems that prefix and latex_prefix are supposed
> to be strings. Or anything that concatenates with a string (for example, I
> think any instance of LatexExpr will work).


I've documented that they should be strings.  It's true that a `LatexExpr` will work, but I don't think we need to spell that out.

> ``repr_bracket``: Please describe what bracket gets used with the default option. Also, the 
> code sets the default to None, not True.


I've expanded on the explanation here.
 
> And perhaps a method called print_options might be useful (instead of pointing the user to an "internal" attribute). With no arguments, it will return _print_options and otherwise it will set the appropriate option. 


Good idea, I've implemented this.



---

archive/issue_events_068635.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-06-30T16:57:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9370#event-68635"
}
```



---

archive/issue_events_068636.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-06-30T16:57:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9370#event-68636"
}
```



---

archive/issue_comments_081718.json:
```json
{
    "body": "<a id='comment:3'></a>\nAnother idea would be to allow repr_bracket to be a pair (list or tuple) of strings, one for the left side and one for the right.  It wouldn't be hard to implement, but is it worth doing?  Would the documentation start to get too complicated?",
    "created_at": "2010-06-30T17:08:08Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81718",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>
Another idea would be to allow repr_bracket to be a pair (list or tuple) of strings, one for the left side and one for the right.  It wouldn't be hard to implement, but is it worth doing?  Would the documentation start to get too complicated?



---

archive/issue_comments_081719.json:
```json
{
    "body": "<a id='comment:4'></a>\n> Another idea would be to allow repr_bracket to be a pair (list or tuple) of strings, one for the left side and one for the right. It wouldn't be hard to implement, but is it worth doing? Would the documentation start to get too complicated?\n\n\nHere's a patch which implements this idea.  I think it's probably worth doing: consider\n\n```\nsage: F = CombinatorialFreeModule(QQ, [1,2,3], prefix='x', repr_bracket=[\"_{\", \"}\"])\nsage: e = F.basis()\nsage: e[2] + 5*e[3]\nx_{2} + 5*x_{3}\n```",
    "created_at": "2010-06-30T18:12:59Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81719",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
> Another idea would be to allow repr_bracket to be a pair (list or tuple) of strings, one for the left side and one for the right. It wouldn't be hard to implement, but is it worth doing? Would the documentation start to get too complicated?


Here's a patch which implements this idea.  I think it's probably worth doing: consider

```
sage: F = CombinatorialFreeModule(QQ, [1,2,3], prefix='x', repr_bracket=["_{", "}"])
sage: e = F.basis()
sage: e[2] + 5*e[3]
x_{2} + 5*x_{3}
```



---

archive/issue_comments_081720.json:
```json
{
    "body": "<a id='comment:5'></a>\nNote: these print option interact with unique representation in ways which might be surprising, but this was also true with `F._prefix`.  I've added an example to the documentation illustrating this, starting at line 849.",
    "created_at": "2010-07-01T04:34:26Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81720",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
Note: these print option interact with unique representation in ways which might be surprising, but this was also true with `F._prefix`.  I've added an example to the documentation illustrating this, starting at line 849.



---

archive/issue_comments_081721.json:
```json
{
    "body": "<a id='comment:6'></a>\nping to saliola: what do you think about the changes in response to your comments?",
    "created_at": "2010-09-28T02:41:32Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81721",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:6'></a>
ping to saliola: what do you think about the changes in response to your comments?



---

archive/issue_comments_081722.json:
```json
{
    "body": "<a id='comment:7'></a>\nI forgot about this ticket. Thanks for the ping, Jason.\n\nI like the changes. As long as all the tests pass, it gets a positive review from me. (I don't really have the time this week to upgrade my Sage installation to test this; if someone else can do it beforehand, that would be great!)",
    "created_at": "2010-09-28T05:33:26Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81722",
    "user": "https://github.com/saliola"
}
```

<a id='comment:7'></a>
I forgot about this ticket. Thanks for the ping, Jason.

I like the changes. As long as all the tests pass, it gets a positive review from me. (I don't really have the time this week to upgrade my Sage installation to test this; if someone else can do it beforehand, that would be great!)



---

archive/issue_comments_081723.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [jhpalmieri](#comment%3A4):\n> > Another idea would be to allow repr_bracket to be a pair (list or tuple) of strings, one for the left side and one for the right. It wouldn't be hard to implement, but is it worth doing? Would the documentation start to get too complicated?\n\n> \n> Here's a patch which implements this idea.  I think it's probably worth doing: consider\n> \n> ```\n> sage: F = CombinatorialFreeModule(QQ, [1,2,3], prefix='x', repr_bracket=[\"_{\", \"}\"])\n> sage: e = F.basis()\n> sage: e[2] + 5*e[3]\n> x_{2} + 5*x_{3}\n> ```\n\n\n+1",
    "created_at": "2010-09-30T10:03:40Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81723",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:8'></a>
Replying to [jhpalmieri](#comment%3A4):
> > Another idea would be to allow repr_bracket to be a pair (list or tuple) of strings, one for the left side and one for the right. It wouldn't be hard to implement, but is it worth doing? Would the documentation start to get too complicated?

> 
> Here's a patch which implements this idea.  I think it's probably worth doing: consider
> 
> ```
> sage: F = CombinatorialFreeModule(QQ, [1,2,3], prefix='x', repr_bracket=["_{", "}"])
> sage: e = F.basis()
> sage: e[2] + 5*e[3]
> x_{2} + 5*x_{3}
> ```


+1



---

archive/issue_comments_081724.json:
```json
{
    "body": "<a id='comment:9'></a>\nHi John,\n\nSorry for letting this patch rot ... I like it much though! Thanks! As you, I am bothered by the current interaction between unique representation and printing customization, but don't have a good solution at this point.\n\nI just went briefly through it. Three minor suggestions:\n- The logic in print_options could be factored out using something along:\n\n```\n    for option in ['latex_prefix',...]:\n        if option in kwds: \n            args = True \n \t    self._print_options[option] = kwds[option]\n```\n\n- The documentation of set_print_options duplicates that of the constructor. Could one of them just refer to the other? ``for the options ... see ...``. Actually, maybe the constructor should call set_print_options?\n\n- Could we find something better than _repr_asterix? That is that would refer more explicitly to scalar multiplication? In MuPAD it was timesDot, but it's not great either.",
    "created_at": "2010-09-30T10:17:05Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81724",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:9'></a>
Hi John,

Sorry for letting this patch rot ... I like it much though! Thanks! As you, I am bothered by the current interaction between unique representation and printing customization, but don't have a good solution at this point.

I just went briefly through it. Three minor suggestions:
- The logic in print_options could be factored out using something along:

```
    for option in ['latex_prefix',...]:
        if option in kwds: 
            args = True 
 	    self._print_options[option] = kwds[option]
```

- The documentation of set_print_options duplicates that of the constructor. Could one of them just refer to the other? ``for the options ... see ...``. Actually, maybe the constructor should call set_print_options?

- Could we find something better than _repr_asterix? That is that would refer more explicitly to scalar multiplication? In MuPAD it was timesDot, but it's not great either.



---

archive/issue_events_068637.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2010-09-30T10:17:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9370#event-68637"
}
```



---

archive/issue_events_068638.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2010-09-30T10:17:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9370#event-68638"
}
```



---

archive/issue_comments_081725.json:
```json
{
    "body": "<a id='comment:10'></a>\nHi Nicolas,\n\nThanks for the feedback.  I've changed the code in print_options the way you suggested, and I shortened the docstring there.  I wasn't comfortable having the constructor call print_options, so I didn't change that.\n\nI agree that \"repr_asterisk\" is a bad name, so I rethought the names.  We already had \"prefix\" to which I added \"latex_prefix\".  In parallel with this, I changed \"repr_bracket\" to \"bracket\" (to go with my addition, \"latex_bracket\").  That means that there is no reason for \"repr_asterisk\" to have \"repr\" in its name anymore.  I changed that to \"scalar_mult\".  I think this is better:\n\n```\n    - ``scalar_mult`` - string to use for scalar multiplication in\n      the print representation (optional, default \"*\")\n```\nWhat do you think?",
    "created_at": "2010-09-30T20:19:05Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81725",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>
Hi Nicolas,

Thanks for the feedback.  I've changed the code in print_options the way you suggested, and I shortened the docstring there.  I wasn't comfortable having the constructor call print_options, so I didn't change that.

I agree that "repr_asterisk" is a bad name, so I rethought the names.  We already had "prefix" to which I added "latex_prefix".  In parallel with this, I changed "repr_bracket" to "bracket" (to go with my addition, "latex_bracket").  That means that there is no reason for "repr_asterisk" to have "repr" in its name anymore.  I changed that to "scalar_mult".  I think this is better:

```
    - ``scalar_mult`` - string to use for scalar multiplication in
      the print representation (optional, default "*")
```
What do you think?



---

archive/issue_events_068639.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-09-30T20:19:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9370#event-68639"
}
```



---

archive/issue_events_068640.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-09-30T20:19:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9370#event-68640"
}
```



---

archive/attachments_012322.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_9370-module-elt-repr.patch",
    "asset_url": "tarball://root/attachments/ticket9370/trac_9370-module-elt-repr.patch",
    "created_at": "2011-02-26T00:51:50Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket9370/trac_9370-module-elt-repr.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```



---

archive/issue_comments_081726.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Attachment:** [trac_9370-module-elt-repr.patch](https://github.com/sagemath/sage/files/ticket9370/trac_9370-module-elt-repr.patch)\n\nHi,\n\nI will fold #10852 in here, if that's okay.\n\nI like the multiple options! I gonna have a more detailed look for a review; here are two first comments:\n\n1. Why do you handle the old prefix option extra? Wouldn't it be enough to keep the prefix method and return to print_options()[\\'prefix\\'], rather thank keeping _prefix. A complete doctest provided by the buildbot can then check if _prefix is used anywhere.\n\n2. in lines 155p, multiplication is set to ast. Isn't there a way to give this argument to the repr_lincomb method? Otherwise, we get the following:\n\n```\nsage: A = CombinatorialFreeModule(QQ,['+','*'],scalar_mult='@@')\nsage: A.an_element()\n2@@B['@@'] + 2@@B['+']\n```\n\nBest, Christian",
    "created_at": "2011-02-26T00:51:50Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81726",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

<a id='comment:11'></a>
**Attachment:** [trac_9370-module-elt-repr.patch](https://github.com/sagemath/sage/files/ticket9370/trac_9370-module-elt-repr.patch)

Hi,

I will fold #10852 in here, if that's okay.

I like the multiple options! I gonna have a more detailed look for a review; here are two first comments:

1. Why do you handle the old prefix option extra? Wouldn't it be enough to keep the prefix method and return to print_options()[\'prefix\'], rather thank keeping _prefix. A complete doctest provided by the buildbot can then check if _prefix is used anywhere.

2. in lines 155p, multiplication is set to ast. Isn't there a way to give this argument to the repr_lincomb method? Otherwise, we get the following:

```
sage: A = CombinatorialFreeModule(QQ,['+','*'],scalar_mult='@@')
sage: A.an_element()
2@@B['@@'] + 2@@B['+']
```

Best, Christian



---

archive/issue_comments_081727.json:
```json
{
    "body": "**Reviewer:** Christian Stump",
    "created_at": "2011-02-26T00:51:50Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81727",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

**Reviewer:** Christian Stump



---

archive/issue_comments_081728.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [stumpc5](#comment%3A11):\n> Hi,\n> \n> I will fold #10852 in here, if that's okay.\n> \n> I like the multiple options! I gonna have a more detailed look for a review; here are two first comments:\n> \n> 1. Why do you handle the old prefix option extra? Wouldn't it be enough to keep the prefix method and return to print_options()[\\'prefix\\'], rather thank keeping _prefix. A complete doctest provided by the buildbot can then check if _prefix is used anywhere.\n\n\nI think it was just to preserve backward-compatibility, but if you think it's safe to remove it, please go ahead.\n\n> 2. in lines 155p, multiplication is set to ast. Isn't there a way to give this argument to the repr_lincomb method? Otherwise, we get the following:\n\n\n```\n sage: A = CombinatorialFreeModule(QQ,['+','*'],scalar_mult='@@')\n sage: A.an_element()\n 2@@B['@@'] + 2@@B['+']\n```\n\nPutting it in repr_lincomb would be better, I agree.",
    "created_at": "2011-02-26T02:20:24Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81728",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
Replying to [stumpc5](#comment%3A11):
> Hi,
> 
> I will fold #10852 in here, if that's okay.
> 
> I like the multiple options! I gonna have a more detailed look for a review; here are two first comments:
> 
> 1. Why do you handle the old prefix option extra? Wouldn't it be enough to keep the prefix method and return to print_options()[\'prefix\'], rather thank keeping _prefix. A complete doctest provided by the buildbot can then check if _prefix is used anywhere.


I think it was just to preserve backward-compatibility, but if you think it's safe to remove it, please go ahead.

> 2. in lines 155p, multiplication is set to ast. Isn't there a way to give this argument to the repr_lincomb method? Otherwise, we get the following:


```
 sage: A = CombinatorialFreeModule(QQ,['+','*'],scalar_mult='@@')
 sage: A.an_element()
 2@@B['@@'] + 2@@B['+']
```

Putting it in repr_lincomb would be better, I agree.



---

archive/issue_comments_081729.json:
```json
{
    "body": "<a id='comment:13'></a>\nI added an additional patch containing my two suggested additional features above.\n\nIn there I made quite some changes in sage.misc.repr_lincomb which effects many files. So I want to see what the buildbot returns (as I have a segfault in sage.categories.semigroups._test_associativity, but also without having the patches applied, so I cannot do a complete test).\n\nI also removed _prefix, thus I had to make changes as well in combinat.schubert_polynomial, in combinat.symmetric_group_algebra, and in combiat.combiatorial_algebra. Is that okay, or should I undo those changes and leave _prefix?",
    "created_at": "2011-03-01T21:00:10Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81729",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

<a id='comment:13'></a>
I added an additional patch containing my two suggested additional features above.

In there I made quite some changes in sage.misc.repr_lincomb which effects many files. So I want to see what the buildbot returns (as I have a segfault in sage.categories.semigroups._test_associativity, but also without having the patches applied, so I cannot do a complete test).

I also removed _prefix, thus I had to make changes as well in combinat.schubert_polynomial, in combinat.symmetric_group_algebra, and in combiat.combiatorial_algebra. Is that okay, or should I undo those changes and leave _prefix?



---

archive/issue_comments_081730.json:
```json
{
    "body": "<a id='comment:14'></a>\nMaybe this makes the buildbot testing the ticket again.\n\nFor the buildbot:\n\nApply trac_9370-module-elt-repr.patch, trac_9370-module-elt-repr-suggestions-cs.patch",
    "created_at": "2011-03-02T09:49:40Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81730",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

<a id='comment:14'></a>
Maybe this makes the buildbot testing the ticket again.

For the buildbot:

Apply trac_9370-module-elt-repr.patch, trac_9370-module-elt-repr-suggestions-cs.patch



---

archive/attachments_012323.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_9370-module-elt-repr-suggestions-cs.patch",
    "asset_url": "tarball://root/attachments/ticket9370/trac_9370-module-elt-repr-suggestions-cs.patch",
    "created_at": "2011-03-03T14:17:41Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket9370/trac_9370-module-elt-repr-suggestions-cs.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```



---

archive/issue_comments_081731.json:
```json
{
    "body": "**Attachment:** [trac_9370-module-elt-repr-suggestions-cs.patch](https://github.com/sagemath/sage/files/ticket9370/trac_9370-module-elt-repr-suggestions-cs.patch)",
    "created_at": "2011-03-03T14:17:41Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81731",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

**Attachment:** [trac_9370-module-elt-repr-suggestions-cs.patch](https://github.com/sagemath/sage/files/ticket9370/trac_9370-module-elt-repr-suggestions-cs.patch)



---

archive/issue_comments_081732.json:
```json
{
    "body": "<a id='comment:15'></a>\nI'm happy with the changes except for the following things: first, there are some typos and some ways I would reword things, and I've put up a patch to go on top of \"trac_9370-module-elt-repr-suggestions-cs.patch\" to make those changes.\n\nSecond, the change in the `print_options` method makes the code simpler, but it also modifies the behavior, and I'm not sure I like the change.  If we want to keep the change, then we need to modify the documentation.  The change is this: with my original patch, if you set `prefix` but not `latex_prefix`, then `latex_prefix` would become `prefix` rather than the default value of \"B\".  With your patch, we have this behavior:\n\n```\nsage: A = HeckeAlgebraSymmetricGroupT(QQ, 3)\nsage: A.an_element()\nT[1, 2, 3] + 2*T[1, 3, 2] + 3*T[2, 1, 3] \nsage: latex(A.an_element())\nB_{[1, 2, 3]} + 2B_{[1, 3, 2]} + 3B_{[2, 1, 3]}\n```\nIdeally, everyone would set latex_prefix when they set prefix, but if they don't, I think they should default to being the same.",
    "created_at": "2011-03-07T23:26:10Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81732",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>
I'm happy with the changes except for the following things: first, there are some typos and some ways I would reword things, and I've put up a patch to go on top of "trac_9370-module-elt-repr-suggestions-cs.patch" to make those changes.

Second, the change in the `print_options` method makes the code simpler, but it also modifies the behavior, and I'm not sure I like the change.  If we want to keep the change, then we need to modify the documentation.  The change is this: with my original patch, if you set `prefix` but not `latex_prefix`, then `latex_prefix` would become `prefix` rather than the default value of "B".  With your patch, we have this behavior:

```
sage: A = HeckeAlgebraSymmetricGroupT(QQ, 3)
sage: A.an_element()
T[1, 2, 3] + 2*T[1, 3, 2] + 3*T[2, 1, 3] 
sage: latex(A.an_element())
B_{[1, 2, 3]} + 2B_{[1, 3, 2]} + 3B_{[2, 1, 3]}
```
Ideally, everyone would set latex_prefix when they set prefix, but if they don't, I think they should default to being the same.



---

archive/attachments_012324.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_9370-module-elt-repr-third.patch",
    "asset_url": "tarball://root/attachments/ticket9370/trac_9370-module-elt-repr-third.patch",
    "created_at": "2011-03-07T23:26:38Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket9370/trac_9370-module-elt-repr-third.patch",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_081733.json:
```json
{
    "body": "**Attachment:** [trac_9370-module-elt-repr-third.patch](https://github.com/sagemath/sage/files/ticket9370/trac_9370-module-elt-repr-third.patch)\n\napply on top of other two patches",
    "created_at": "2011-03-07T23:26:38Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81733",
    "user": "https://github.com/jhpalmieri"
}
```

**Attachment:** [trac_9370-module-elt-repr-third.patch](https://github.com/sagemath/sage/files/ticket9370/trac_9370-module-elt-repr-third.patch)

apply on top of other two patches



---

archive/issue_comments_081734.json:
```json
{
    "body": "<a id='comment:16'></a>\nHi Christian, John,\n\nFirst, thanks so much for improving CombinatorialFreeModule's!\n\nReplying to [jhpalmieri](#comment%3A15):\n> The change is this: with my original patch, if you set `prefix` but not `latex_prefix`, then `latex_prefix` would become `prefix` rather than the default value of \"B\".  With your patch, we have this behavior:\n> \n> ```\n> sage: A = HeckeAlgebraSymmetricGroupT(QQ, 3)\n> sage: A.an_element()\n> T[1, 2, 3] + 2*T[1, 3, 2] + 3*T[2, 1, 3] \n> sage: latex(A.an_element())\n> B_{[1, 2, 3]} + 2B_{[1, 3, 2]} + 3B_{[2, 1, 3]}\n> ```\n> Ideally, everyone would set latex_prefix when they set prefix,\n\n\nI would not even try to enforce setting latex_prefix. Whenever the\nprefix does not contains specific math code, it would be an\nunnecessary burden to have to set both latex_prefix and prefix.\n\n> but if they don't, I think they should default to being the same.\n\n\n+1",
    "created_at": "2011-03-10T09:57:59Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81734",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:16'></a>
Hi Christian, John,

First, thanks so much for improving CombinatorialFreeModule's!

Replying to [jhpalmieri](#comment%3A15):
> The change is this: with my original patch, if you set `prefix` but not `latex_prefix`, then `latex_prefix` would become `prefix` rather than the default value of "B".  With your patch, we have this behavior:
> 
> ```
> sage: A = HeckeAlgebraSymmetricGroupT(QQ, 3)
> sage: A.an_element()
> T[1, 2, 3] + 2*T[1, 3, 2] + 3*T[2, 1, 3] 
> sage: latex(A.an_element())
> B_{[1, 2, 3]} + 2B_{[1, 3, 2]} + 3B_{[2, 1, 3]}
> ```
> Ideally, everyone would set latex_prefix when they set prefix,


I would not even try to enforce setting latex_prefix. Whenever the
prefix does not contains specific math code, it would be an
unnecessary burden to have to set both latex_prefix and prefix.

> but if they don't, I think they should default to being the same.


+1



---

archive/issue_comments_081735.json:
```json
{
    "body": "<a id='comment:17'></a>\nHere are two new patches.  The first is a replacement for \"trac_9370-module-elt-repr-third.patch\", and the second is an all-in-one patch incorporating all changes.\n\nThese restore the old behavior of setting prefix vs. latex_prefix.  In fact, now if you set prefix but not latex_prefix, then the latex_prefix option remains set to None, and whenever latex_prefix is used, if it's set to None, it just uses the prefix setting instead.  This makes some of the code cleaner.\n\nThese patches also document tensor_symbol and latex_scalar_mult.",
    "created_at": "2011-03-11T05:51:45Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81735",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:17'></a>
Here are two new patches.  The first is a replacement for "trac_9370-module-elt-repr-third.patch", and the second is an all-in-one patch incorporating all changes.

These restore the old behavior of setting prefix vs. latex_prefix.  In fact, now if you set prefix but not latex_prefix, then the latex_prefix option remains set to None, and whenever latex_prefix is used, if it's set to None, it just uses the prefix setting instead.  This makes some of the code cleaner.

These patches also document tensor_symbol and latex_scalar_mult.



---

archive/issue_comments_081736.json:
```json
{
    "body": "<a id='comment:18'></a>\nJust to be clear, the \"v2\" version of the third patch is for review purposes.\n\nApply only \n\n- trac_9370-module-elt-repr-all-in-one.patch",
    "created_at": "2011-03-11T05:54:04Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81736",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:18'></a>
Just to be clear, the "v2" version of the third patch is for review purposes.

Apply only 

- trac_9370-module-elt-repr-all-in-one.patch



---

archive/issue_comments_081737.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,2 +1,3 @@\n The attached patch allows customization of printing of elements in the class `CombinatorialFreeModuleElement`.  It also adds documentation to `CombinatorialFreeModule` spelling out these options (and all of the other options, I think).\n \n+Apply only trac_9370-module-elt-repr-all-in-one.patch.\n``````\n",
    "created_at": "2011-03-11T05:54:04Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81737",
    "user": "https://github.com/jhpalmieri"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,2 +1,3 @@
 The attached patch allows customization of printing of elements in the class `CombinatorialFreeModuleElement`.  It also adds documentation to `CombinatorialFreeModule` spelling out these options (and all of the other options, I think).
 
+Apply only trac_9370-module-elt-repr-all-in-one.patch.
``````




---

archive/attachments_012325.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_9370-module-elt-repr-third.v2.patch",
    "asset_url": "tarball://root/attachments/ticket9370/trac_9370-module-elt-repr-third.v2.patch",
    "created_at": "2011-03-11T05:56:28Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket9370/trac_9370-module-elt-repr-third.v2.patch",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_081738.json:
```json
{
    "body": "**Attachment:** [trac_9370-module-elt-repr-third.v2.patch](https://github.com/sagemath/sage/files/ticket9370/trac_9370-module-elt-repr-third.v2.patch)\n\napply on top of other two patches instead of ...-third.patch",
    "created_at": "2011-03-11T05:56:28Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81738",
    "user": "https://github.com/jhpalmieri"
}
```

**Attachment:** [trac_9370-module-elt-repr-third.v2.patch](https://github.com/sagemath/sage/files/ticket9370/trac_9370-module-elt-repr-third.v2.patch)

apply on top of other two patches instead of ...-third.patch



---

archive/issue_comments_081739.json:
```json
{
    "body": "<a id='comment:19'></a>\nThe Steenrod algebra code at #10052 revealed a small bug in the `_latex_` method: when replacing a trailing \"* 1\" in latex code via\n\n```\nif x[len(x)-l-1:] == ast_replace+\"1\": \n     return x[:len(x)-l-1] \n```\nif `ast_replace` is the empty string, this will just remove any trailing 1, for example from \"x \\otimes 1\" or from \"31\", etc.  So I'm changing the test to\n\n```\nif l > 0 and x[len(x)-l-1:] == ast_replace+\"1\": \n     return x[:len(x)-l-1] \n```\nso it only does the replacement if the length `l` of `ast_replace` is positive.  (I also find the letter \"l\" hard to distinguish from the number \"1\", so I'm changing it to \"ln\".  Then we can pretend it's the natural log and we're doing calculus instead of algebra.)",
    "created_at": "2011-03-11T22:34:29Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81739",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:19'></a>
The Steenrod algebra code at #10052 revealed a small bug in the `_latex_` method: when replacing a trailing "* 1" in latex code via

```
if x[len(x)-l-1:] == ast_replace+"1": 
     return x[:len(x)-l-1] 
```
if `ast_replace` is the empty string, this will just remove any trailing 1, for example from "x \otimes 1" or from "31", etc.  So I'm changing the test to

```
if l > 0 and x[len(x)-l-1:] == ast_replace+"1": 
     return x[:len(x)-l-1] 
```
so it only does the replacement if the length `l` of `ast_replace` is positive.  (I also find the letter "l" hard to distinguish from the number "1", so I'm changing it to "ln".  Then we can pretend it's the natural log and we're doing calculus instead of algebra.)



---

archive/attachments_012326.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_9370-module-elt-repr-fourth.patch",
    "asset_url": "tarball://root/attachments/ticket9370/trac_9370-module-elt-repr-fourth.patch",
    "created_at": "2011-03-11T22:36:24Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket9370/trac_9370-module-elt-repr-fourth.patch",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_081740.json:
```json
{
    "body": "**Attachment:** [trac_9370-module-elt-repr-fourth.patch](https://github.com/sagemath/sage/files/ticket9370/trac_9370-module-elt-repr-fourth.patch)\n\napply on top of first 3 patches, for review only",
    "created_at": "2011-03-11T22:36:24Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81740",
    "user": "https://github.com/jhpalmieri"
}
```

**Attachment:** [trac_9370-module-elt-repr-fourth.patch](https://github.com/sagemath/sage/files/ticket9370/trac_9370-module-elt-repr-fourth.patch)

apply on top of first 3 patches, for review only



---

archive/attachments_012327.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_9370-module-elt-repr-all-in-one.patch",
    "asset_url": "tarball://root/attachments/ticket9370/trac_9370-module-elt-repr-all-in-one.patch",
    "created_at": "2011-03-11T22:37:08Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket9370/trac_9370-module-elt-repr-all-in-one.patch",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_081741.json:
```json
{
    "body": "**Attachment:** [trac_9370-module-elt-repr-all-in-one.patch](https://github.com/sagemath/sage/files/ticket9370/trac_9370-module-elt-repr-all-in-one.patch)\n\napply only this patch",
    "created_at": "2011-03-11T22:37:08Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81741",
    "user": "https://github.com/jhpalmieri"
}
```

**Attachment:** [trac_9370-module-elt-repr-all-in-one.patch](https://github.com/sagemath/sage/files/ticket9370/trac_9370-module-elt-repr-all-in-one.patch)

apply only this patch



---

archive/issue_events_068641.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/stumpc5",
    "created_at": "2011-03-12T12:23:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9370#event-68641"
}
```



---

archive/issue_events_068642.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/stumpc5",
    "created_at": "2011-03-12T12:23:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9370#event-68642"
}
```



---

archive/issue_comments_081742.json:
```json
{
    "body": "**Changing reviewer** from \"Christian Stump\" to \"Franco Saliola, Christian Stump\".",
    "created_at": "2011-03-12T12:23:11Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81742",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

**Changing reviewer** from "Christian Stump" to "Franco Saliola, Christian Stump".



---

archive/issue_comments_081743.json:
```json
{
    "body": "<a id='comment:20'></a>\nI haven't found any further issues; as all tests pass, so it gets a positive review.\n\nBest, Christian",
    "created_at": "2011-03-12T12:23:11Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81743",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

<a id='comment:20'></a>
I haven't found any further issues; as all tests pass, so it gets a positive review.

Best, Christian



---

archive/issue_comments_081744.json:
```json
{
    "body": "**Changing author** from \"John Palmieri\" to \"John Palmieri, Christian Stump\".",
    "created_at": "2011-03-12T19:15:41Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81744",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing author** from "John Palmieri" to "John Palmieri, Christian Stump".



---

archive/issue_events_068643.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-07T13:49:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9370#event-68643"
}
```



---

archive/issue_events_068644.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-07T13:49:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9370#event-68644"
}
```



---

archive/issue_comments_081745.json:
```json
{
    "body": "**Merged:** sage-4.7.alpha4",
    "created_at": "2011-04-07T13:49:58Z",
    "issue": "https://github.com/sagemath/sage/issues/9370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9370#issuecomment-81745",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.7.alpha4
