# Issue 9475: update M4RI to newest upstream release

archive/issues_009475.json:
```json
{
    "body": "The new version improves elimination to some extent, comes with a cleaner API and has an option to suppress SSE instructions.\n\n---\n\n## Note to the release managers\n\n**Apply only [m4ri_new_version.v2.patch](https://github.com/sagemath/sage/files/ticket9475/m4ri_new_version.v2.patch) to the Sage library** when merging the [new M4RI spkg](http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20100701.p1.spkg).\n\n**CC:**  mariah\n\n**Keywords:** M4RI, spkg-check\n\n**Author:** Martin Albrecht, Leif Leonhardy\n\n**Reviewer:** Leif Leonhardy, David Kirkby, Mariah Lenox\n\n**Upstream:** Not yet reported upstream; Will do shortly.\n\n**Merged:** sage-4.5.3.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/9475\n\n",
    "closed_at": "2010-08-15T08:03:14Z",
    "created_at": "2010-07-11T16:12:22Z",
    "labels": [
        "component: packages: standard",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.5.3",
    "title": "update M4RI to newest upstream release",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/9475",
    "user": "https://github.com/malb"
}
```
The new version improves elimination to some extent, comes with a cleaner API and has an option to suppress SSE instructions.

---

## Note to the release managers

**Apply only [m4ri_new_version.v2.patch](https://github.com/sagemath/sage/files/ticket9475/m4ri_new_version.v2.patch) to the Sage library** when merging the [new M4RI spkg](http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20100701.p1.spkg).

**CC:**  mariah

**Keywords:** M4RI, spkg-check

**Author:** Martin Albrecht, Leif Leonhardy

**Reviewer:** Leif Leonhardy, David Kirkby, Mariah Lenox

**Upstream:** Not yet reported upstream; Will do shortly.

**Merged:** sage-4.5.3.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/9475





---

archive/issue_events_069810.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2010-07-11T16:14:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69810"
}
```



---

archive/issue_comments_083586.json:
```json
{
    "body": "<a id='comment:1'></a>\nI've uploaded an SPKG to\n\n  http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20100701.spkg\n\nThis SPKG also takes care of #9381 (SAGE_FAT_BINARY not being respected) and the M4RI part of #9281 (spkg-check)",
    "created_at": "2010-07-11T16:14:02Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83586",
    "user": "https://github.com/malb"
}
```

<a id='comment:1'></a>
I've uploaded an SPKG to

  http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20100701.spkg

This SPKG also takes care of #9381 (SAGE_FAT_BINARY not being respected) and the M4RI part of #9281 (spkg-check)



---

archive/issue_comments_083587.json:
```json
{
    "body": "<a id='comment:2'></a>\nI've run the M4RI self test (not the Sage test suite) on the following machines:\n\n* x86_64 Linux (Xeon, sage.math and eno);\n\n* x86 OSX (Xeon, bsd);\u00a0\n\n* ia64 Linux (iras); \n\n* UltraSPARC T2 Solaris using GCC (t2.math.washington.edu) \n\n* x86 Linux (VirtualBox);",
    "created_at": "2010-07-11T20:17:42Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83587",
    "user": "https://github.com/malb"
}
```

<a id='comment:2'></a>
I've run the M4RI self test (not the Sage test suite) on the following machines:

* x86_64 Linux (Xeon, sage.math and eno);

* x86 OSX (Xeon, bsd); 

* ia64 Linux (iras); 

* UltraSPARC T2 Solaris using GCC (t2.math.washington.edu) 

* x86 Linux (VirtualBox);



---

archive/issue_comments_083588.json:
```json
{
    "body": "<a id='comment:3'></a>\n1. SPKG.txt under \"Releases\" says latest \nrelease is libm4ri-20100107, do you mean\nlibm4ri-20100701?\n\n2. Since spkg-check exists, in spkg-install \nthe commented out lines:\n\n```\n# $MAKE check\n# if [ $? -ne 0 ]; then\n#     echo \"libm4ri testsuite failed, please report upstream!\"\n#     exit 1\n# fi\n```\n\ncan be removed.\n\n3. In spkg-install, if SAGE_FAT_BINARY is yes, then\nsse2 is disabled.  What about sse3 as was the reported\nproblem in [#9381](http://trac.sagemath.org/sage_trac/ticket/9381)\n\n4. This version of libm4ri does not appear under the\ndownloads on the [m4ri](http://m4ri.sagemath.org) web site,\nthus no way to tell if the source in the spkg corresponds\nto the source under the claimed version.",
    "created_at": "2010-07-13T15:53:13Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83588",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

<a id='comment:3'></a>
1. SPKG.txt under "Releases" says latest 
release is libm4ri-20100107, do you mean
libm4ri-20100701?

2. Since spkg-check exists, in spkg-install 
the commented out lines:

```
# $MAKE check
# if [ $? -ne 0 ]; then
#     echo "libm4ri testsuite failed, please report upstream!"
#     exit 1
# fi
```

can be removed.

3. In spkg-install, if SAGE_FAT_BINARY is yes, then
sse2 is disabled.  What about sse3 as was the reported
problem in [#9381](http://trac.sagemath.org/sage_trac/ticket/9381)

4. This version of libm4ri does not appear under the
downloads on the [m4ri](http://m4ri.sagemath.org) web site,
thus no way to tell if the source in the spkg corresponds
to the source under the claimed version.



---

archive/issue_events_069811.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mariah",
    "created_at": "2010-07-13T15:53:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69811"
}
```



---

archive/issue_events_069812.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mariah",
    "created_at": "2010-07-13T15:53:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69812"
}
```



---

archive/issue_comments_083589.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [mariah](#comment%3A3):\n\n> 1. SPKG.txt under \"Releases\" says latest  release is libm4ri-20100107, do you mean libm4ri-20100701?\n\n\nFixed.\n\n> 2. Since spkg-check exists, in spkg-install\u00a0 the commented out lines: ` # $MAKE check # if [ $? -ne 0 ]; then #     echo \"libm4ri testsuite failed, please report upstream!\" #     exit 1 # fi ` can be removed.\n\n\nFixed.\n\n> 3. In spkg-install, if SAGE_FAT_BINARY is yes, then sse2 is disabled.  What about sse3 as was the reported problem in [#9381](http://trac.sagemath.org/sage_trac/ticket/9381)\n\n\nWe never use SSE3, but yeah all checks for SSEx instructions are suppressed in that case.\n\n> 4. This version of libm4ri does not appear under the downloads on the [m4ri](http://m4ri.sagemath.org) web site, thus no way to tell if the source in the spkg corresponds to the source under the claimed version.\n\n\nThis is because I am upstream and wanted to wait for portability issues before putting the release on the website. I'm putting it online now, if that makes your life easier.",
    "created_at": "2010-07-13T18:22:28Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83589",
    "user": "https://github.com/malb"
}
```

<a id='comment:5'></a>
Replying to [mariah](#comment%3A3):

> 1. SPKG.txt under "Releases" says latest  release is libm4ri-20100107, do you mean libm4ri-20100701?


Fixed.

> 2. Since spkg-check exists, in spkg-install  the commented out lines: ` # $MAKE check # if [ $? -ne 0 ]; then #     echo "libm4ri testsuite failed, please report upstream!" #     exit 1 # fi ` can be removed.


Fixed.

> 3. In spkg-install, if SAGE_FAT_BINARY is yes, then sse2 is disabled.  What about sse3 as was the reported problem in [#9381](http://trac.sagemath.org/sage_trac/ticket/9381)


We never use SSE3, but yeah all checks for SSEx instructions are suppressed in that case.

> 4. This version of libm4ri does not appear under the downloads on the [m4ri](http://m4ri.sagemath.org) web site, thus no way to tell if the source in the spkg corresponds to the source under the claimed version.


This is because I am upstream and wanted to wait for portability issues before putting the release on the website. I'm putting it online now, if that makes your life easier.



---

archive/issue_comments_083590.json:
```json
{
    "body": "<a id='comment:6'></a>\nSee\u00a0\n\nhttp://m4ri.sagemath.org\n\nand\n\nhttp://bitbucket.org/malb/m4ri/wiki/M4RI-20100701\u00a0 \n\nfor the new upstream release.",
    "created_at": "2010-07-13T18:41:20Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83590",
    "user": "https://github.com/malb"
}
```

<a id='comment:6'></a>
See 

http://m4ri.sagemath.org

and

http://bitbucket.org/malb/m4ri/wiki/M4RI-20100701  

for the new upstream release.



---

archive/issue_events_069813.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2010-07-13T18:41:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69813"
}
```



---

archive/issue_events_069814.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2010-07-13T18:41:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69814"
}
```



---

archive/issue_comments_083591.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe changes to `SPKG.txt`, `spkg-install` and `spkg-check` are not checked in.",
    "created_at": "2010-07-14T13:18:40Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83591",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>
The changes to `SPKG.txt`, `spkg-install` and `spkg-check` are not checked in.



---

archive/issue_comments_083592.json:
```json
{
    "body": "<a id='comment:8'></a>\n`SPKG.txt`:\n* *Author* should be *Author**s***\n* Is the given e-mail address still up-to-date?\n* I'd substitute *\"function names match what the function is doing now\"*\n  by *\"function names **now** match ... is doing\"*\n* s/supress/su**p**press/\n* s/SSE2 instruction/SSE2 instruction**s**/\n\n`spkg-install:`\n* Old typo, I guess: s/CLFAGS/CFLAGS/ twice\n* The choice of the variable name `SSE2_SUPPORT` isn't that nice; I'd rather call it `DISABLE_SSE2`, but never mind.\n\n`spkg-check:`\n* Uses `make` rather than `$MAKE` (in contrast to `spkg-install`), but shouldn't be a problem.",
    "created_at": "2010-07-14T14:00:54Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83592",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>
`SPKG.txt`:
* *Author* should be *Author**s***
* Is the given e-mail address still up-to-date?
* I'd substitute *"function names match what the function is doing now"*
  by *"function names **now** match ... is doing"*
* s/supress/su**p**press/
* s/SSE2 instruction/SSE2 instruction**s**/

`spkg-install:`
* Old typo, I guess: s/CLFAGS/CFLAGS/ twice
* The choice of the variable name `SSE2_SUPPORT` isn't that nice; I'd rather call it `DISABLE_SSE2`, but never mind.

`spkg-check:`
* Uses `make` rather than `$MAKE` (in contrast to `spkg-install`), but shouldn't be a problem.



---

archive/issue_events_069815.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-07-14T15:49:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69815"
}
```



---

archive/issue_events_069816.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-07-14T15:49:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69816"
}
```



---

archive/issue_comments_083593.json:
```json
{
    "body": "<a id='comment:9'></a>\nI'd suggest adding the (standard) section *Special Update/Build Instructions* to `SPKG.txt`, with the following:\n* Remove upstream Mercurial repository (directory `src/.hg`, file `src/.hgtags`)\n* Remove directory `src/autom4te.cache`, file `src/m4ri.vcproj`\n\nI've built a p1 spkg with the above mentioned files removed: 392KB vs. 1.2MB\n\nIf there are no dependencies on Sage packages (which is the case here), we don't need to add `$SAGE_LOCAL/include` to the preprocessor search path in `spkg-install` (`CFLAGS` and `CPPFLAGS`).\n\nPerhaps touch `src/configure`, because it has the same time stamp as `configure.*`.\n\nUpstream notes:\n* There is no target `clean`.\n* `src/NEWS` and `src/ChangeLog` are **empty** files. ;-)\n\nTests in progress,\n\nLeif",
    "created_at": "2010-07-14T15:49:57Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83593",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'></a>
I'd suggest adding the (standard) section *Special Update/Build Instructions* to `SPKG.txt`, with the following:
* Remove upstream Mercurial repository (directory `src/.hg`, file `src/.hgtags`)
* Remove directory `src/autom4te.cache`, file `src/m4ri.vcproj`

I've built a p1 spkg with the above mentioned files removed: 392KB vs. 1.2MB

If there are no dependencies on Sage packages (which is the case here), we don't need to add `$SAGE_LOCAL/include` to the preprocessor search path in `spkg-install` (`CFLAGS` and `CPPFLAGS`).

Perhaps touch `src/configure`, because it has the same time stamp as `configure.*`.

Upstream notes:
* There is no target `clean`.
* `src/NEWS` and `src/ChangeLog` are **empty** files. ;-)

Tests in progress,

Leif



---

archive/issue_comments_083594.json:
```json
{
    "body": "<a id='comment:10'></a>\n* Ubuntu 9.04 x86 (P4 Prescott, gcc 4.3.3) Sage 4.5.rc0 (with ECL 10.2.1.p1):\n\n   ptestlong: All tests passed.\n\n  * Ubuntu 9.04 x86_64 (Core2, gcc 4.3.3) Sage 4.5.rc0:\n\n   ptestlong: All tests passed.\n   (with my stripped-down M4RI spkg, see above)\n\nI've only installed the new package (dated July 13th) and applied the patch, i.e. did not build Sage from scratch, and haven't (yet) run the testsuite.",
    "created_at": "2010-07-14T17:50:56Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83594",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:10'></a>
* Ubuntu 9.04 x86 (P4 Prescott, gcc 4.3.3) Sage 4.5.rc0 (with ECL 10.2.1.p1):

   ptestlong: All tests passed.

  * Ubuntu 9.04 x86_64 (Core2, gcc 4.3.3) Sage 4.5.rc0:

   ptestlong: All tests passed.
   (with my stripped-down M4RI spkg, see above)

I've only installed the new package (dated July 13th) and applied the patch, i.e. did not build Sage from scratch, and haven't (yet) run the testsuite.



---

archive/issue_comments_083595.json:
```json
{
    "body": "<a id='comment:11'></a>\nShame on me I missed that one:\n\n```sh\n./spkg-install: line 47: [x: command not found\n```\n\n```sh\nif [\"x$SAGE_FAT_BINARY\" = \"xyes\"]; then\n    SSE2_SUPPORT=\"--disable-sse2\"\nelse\n    SSE2_SUPPORT=\"\"\nfi\n```\nshould be\n\n```sh\nif [ \"x$SAGE_FAT_BINARY\" = \"xyes\" ]; then\n    ...\n```\nNote that `[` is actually a *command* (namely an alias for or link to `test`, depending on the shell), and `]` is its last parameter.\n\n---\n\nOn both of the above systems, the testsuite passed without errors.\n\n(I reinstalled the package(s) with `SAGE_CHECK=\"yes\"`.)",
    "created_at": "2010-07-14T18:53:19Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83595",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:11'></a>
Shame on me I missed that one:

```sh
./spkg-install: line 47: [x: command not found
```

```sh
if ["x$SAGE_FAT_BINARY" = "xyes"]; then
    SSE2_SUPPORT="--disable-sse2"
else
    SSE2_SUPPORT=""
fi
```
should be

```sh
if [ "x$SAGE_FAT_BINARY" = "xyes" ]; then
    ...
```
Note that `[` is actually a *command* (namely an alias for or link to `test`, depending on the shell), and `]` is its last parameter.

---

On both of the above systems, the testsuite passed without errors.

(I reinstalled the package(s) with `SAGE_CHECK="yes"`.)



---

archive/issue_comments_083596.json:
```json
{
    "body": "<a id='comment:12'></a>\nJust let me know if I should provide (a) reviewer patch(es) to the spkg (after a commit to the changes not yet checked in); I cannot upload an updated spkg to sage.math though.\n\nLeif",
    "created_at": "2010-07-14T19:35:43Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83596",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:12'></a>
Just let me know if I should provide (a) reviewer patch(es) to the spkg (after a commit to the changes not yet checked in); I cannot upload an updated spkg to sage.math though.

Leif



---

archive/issue_comments_083597.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [leif](#comment%3A9):\n\n> * Remove upstream Mercurial repository (directory `src/.hg`, file `src/.hgtags`)\n> * Remove directory `src/autom4te.cache`, file `src/m4ri.vcproj`\n> I've built a p1 spkg with the above mentioned files removed: 392KB vs. 1.2MB\n\n\nIt's strange that there was an autom4te.cache, since I rm it in my release script. I'm okay with these changes.",
    "created_at": "2010-07-14T20:39:25Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83597",
    "user": "https://github.com/malb"
}
```

<a id='comment:13'></a>
Replying to [leif](#comment%3A9):

> * Remove upstream Mercurial repository (directory `src/.hg`, file `src/.hgtags`)
> * Remove directory `src/autom4te.cache`, file `src/m4ri.vcproj`
> I've built a p1 spkg with the above mentioned files removed: 392KB vs. 1.2MB


It's strange that there was an autom4te.cache, since I rm it in my release script. I'm okay with these changes.



---

archive/issue_comments_083598.json:
```json
{
    "body": "<a id='comment:14'></a>\nLeif,\n\nI'd appreciate if you could update SPKG according to your suggestions, I'm okay with them all. If you upload the SPKG somewhere or send it my way I can upload it to sage.math.",
    "created_at": "2010-07-14T20:41:14Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83598",
    "user": "https://github.com/malb"
}
```

<a id='comment:14'></a>
Leif,

I'd appreciate if you could update SPKG according to your suggestions, I'm okay with them all. If you upload the SPKG somewhere or send it my way I can upload it to sage.math.



---

archive/issue_comments_083599.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [malb](#comment%3A14):\n> I'd appreciate if you could update SPKG according to your suggestions, I'm okay with them all. If you upload the SPKG somewhere or send it my way I can upload it to sage.math.\u00a0\n\n\nOk, I'll create a cumulative spkg patch and a \"stripped-down\" p1 package in a few hours and then mail you both.\n\n(I assume your .ac.uk e-mail address in SPKG.txt is still appropriate as upstream contact.)\n  \n\nCurrently running stress-test builds of 4.5.rc1... ;-)\n\nLeif",
    "created_at": "2010-07-14T21:00:56Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83599",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:15'></a>
Replying to [malb](#comment%3A14):
> I'd appreciate if you could update SPKG according to your suggestions, I'm okay with them all. If you upload the SPKG somewhere or send it my way I can upload it to sage.math. 


Ok, I'll create a cumulative spkg patch and a "stripped-down" p1 package in a few hours and then mail you both.

(I assume your .ac.uk e-mail address in SPKG.txt is still appropriate as upstream contact.)
  

Currently running stress-test builds of 4.5.rc1... ;-)

Leif



---

archive/issue_comments_083600.json:
```json
{
    "body": "<a id='comment:16'></a>\nYes, that's still current, however martinralbrecht@ googleblablabla might be current for a longer time.\n\nThanks!",
    "created_at": "2010-07-14T21:22:01Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83600",
    "user": "https://github.com/malb"
}
```

<a id='comment:16'></a>
Yes, that's still current, however martinralbrecht@ googleblablabla might be current for a longer time.

Thanks!



---

archive/attachments_012558.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_9475-libm4ri-20100701.p1-based_on_p0.patch",
    "asset_url": "tarball://root/attachments/ticket9475/trac_9475-libm4ri-20100701.p1-based_on_p0.patch",
    "created_at": "2010-07-16T02:12:07Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket9475/trac_9475-libm4ri-20100701.p1-based_on_p0.patch",
    "user": "https://github.com/nexttime"
}
```



---

archive/issue_comments_083601.json:
```json
{
    "body": "**Attachment:** [trac_9475-libm4ri-20100701.p1-based_on_p0.patch](https://github.com/sagemath/sage/files/ticket9475/trac_9475-libm4ri-20100701.p1-based_on_p0.patch)\n\nYou have to commit Martin's changes (\"p0\") first to apply this.",
    "created_at": "2010-07-16T02:12:07Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83601",
    "user": "https://github.com/nexttime"
}
```

**Attachment:** [trac_9475-libm4ri-20100701.p1-based_on_p0.patch](https://github.com/sagemath/sage/files/ticket9475/trac_9475-libm4ri-20100701.p1-based_on_p0.patch)

You have to commit Martin's changes ("p0") first to apply this.



---

archive/issue_comments_083602.json:
```json
{
    "body": "<a id='comment:17'></a>\nPatch for p1 Sage package is up. Remember to commit Martin's changes (of July 13th) first before you apply this patch. (This patch does *not* remove the unnecessary files in `src/` since they are not under *our* version control; they are of course deleted from the p1 spkg.)\n\n(Link to) **New libm4ri-20100701.p1.spkg is on the way.**\n\nTested with both 4.5.rc0 and rc1 (Ubuntu 9.04 x86_64).\n\nSorry for the delay.\n\n-Leif",
    "created_at": "2010-07-16T02:33:07Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83602",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:17'></a>
Patch for p1 Sage package is up. Remember to commit Martin's changes (of July 13th) first before you apply this patch. (This patch does *not* remove the unnecessary files in `src/` since they are not under *our* version control; they are of course deleted from the p1 spkg.)

(Link to) **New libm4ri-20100701.p1.spkg is on the way.**

Tested with both 4.5.rc0 and rc1 (Ubuntu 9.04 x86_64).

Sorry for the delay.

-Leif



---

archive/issue_comments_083603.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,2 @@\n-The new version improves elimination to some extend, comes with a cleaner API and has an option to suppress SSE instructions\n+The new version improves elimination to some extent, comes with a cleaner API and has an option to suppress SSE instructions.\n+\n``````\n",
    "created_at": "2010-07-16T02:33:07Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83603",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,2 @@
-The new version improves elimination to some extend, comes with a cleaner API and has an option to suppress SSE instructions
+The new version improves elimination to some extent, comes with a cleaner API and has an option to suppress SSE instructions.
+
``````




---

archive/issue_events_069817.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-07-16T02:33:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69817"
}
```



---

archive/issue_events_069818.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-07-16T02:33:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69818"
}
```



---

archive/issue_comments_083604.json:
```json
{
    "body": "**Reviewer:** Leif Leonhardy, David Kirkby",
    "created_at": "2010-07-16T09:03:23Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83604",
    "user": "https://github.com/malb"
}
```

**Reviewer:** Leif Leonhardy, David Kirkby



---

archive/issue_events_069819.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2010-07-16T09:03:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69819"
}
```



---

archive/issue_events_069820.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2010-07-16T09:03:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69820"
}
```



---

archive/issue_comments_083605.json:
```json
{
    "body": "<a id='comment:18'></a>\nI uploaded Leif's SPKG to\u00a0\n\n\u00a0http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20100701.p1.spkg\n\nand I give it a positive review.",
    "created_at": "2010-07-16T09:03:23Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83605",
    "user": "https://github.com/malb"
}
```

<a id='comment:18'></a>
I uploaded Leif's SPKG to 

 http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20100701.p1.spkg

and I give it a positive review.



---

archive/issue_comments_083606.json:
```json
{
    "body": "**Changing author** from \"Martin Albrecht\" to \"Martin Albrecht, Leif Leonhardy\".",
    "created_at": "2010-07-16T09:03:23Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83606",
    "user": "https://github.com/malb"
}
```

**Changing author** from "Martin Albrecht" to "Martin Albrecht, Leif Leonhardy".



---

archive/issue_comments_083607.json:
```json
{
    "body": "**Upstream:** Not yet reported upstream; Will do shortly.",
    "created_at": "2010-07-16T09:03:23Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83607",
    "user": "https://github.com/malb"
}
```

**Upstream:** Not yet reported upstream; Will do shortly.



---

archive/issue_comments_083608.json:
```json
{
    "body": "**Changing reviewer** from \"Leif Leonhardy, David Kirkby\" to \"Leif Leonhardy, David Kirkby, Mariah Lenox\".",
    "created_at": "2010-07-16T09:07:52Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83608",
    "user": "https://github.com/malb"
}
```

**Changing reviewer** from "Leif Leonhardy, David Kirkby" to "Leif Leonhardy, David Kirkby, Mariah Lenox".



---

archive/issue_comments_083609.json:
```json
{
    "body": "<a id='comment:20'></a>\nWith a fresh build, sage doesn't start:\n\n```\nTraceback (most recent call last):\n File \"/mnt/usb1/scratch/wstein/build/sage-4.5.1/local/bin/sage-eval\",\nline 4, in <module>\n   from sage.all import *\n File \"/mnt/usb1/scratch/wstein/build/sage-4.5.1/local/lib/python2.6/site-packages/sage/all.py\",\nline 73, in <module>\n   from sage.matrix.all     import *\n File \"/mnt/usb1/scratch/wstein/build/sage-4.5.1/local/lib/python2.6/site-packages/sage/matrix/all.py\",\nline 1, in <module>\n   from matrix_space import MatrixSpace, is_MatrixSpace\n File \"/mnt/usb1/scratch/wstein/build/sage-4.5.1/local/lib/python2.6/site-packages/sage/matrix/matrix_space.py\",\nline 40, in <module>\n   import matrix_mod2_dense\nImportError: /mnt/usb1/scratch/wstein/build/sage-4.5.1/local/lib/python2.6/site-packages/sage/matrix/matrix_mod2_dense.so:\nundefined symbol: mzd_lqup\nSage failed to startup.\n```",
    "created_at": "2010-07-18T20:05:49Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83609",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:20'></a>
With a fresh build, sage doesn't start:

```
Traceback (most recent call last):
 File "/mnt/usb1/scratch/wstein/build/sage-4.5.1/local/bin/sage-eval",
line 4, in <module>
   from sage.all import *
 File "/mnt/usb1/scratch/wstein/build/sage-4.5.1/local/lib/python2.6/site-packages/sage/all.py",
line 73, in <module>
   from sage.matrix.all     import *
 File "/mnt/usb1/scratch/wstein/build/sage-4.5.1/local/lib/python2.6/site-packages/sage/matrix/all.py",
line 1, in <module>
   from matrix_space import MatrixSpace, is_MatrixSpace
 File "/mnt/usb1/scratch/wstein/build/sage-4.5.1/local/lib/python2.6/site-packages/sage/matrix/matrix_space.py",
line 40, in <module>
   import matrix_mod2_dense
ImportError: /mnt/usb1/scratch/wstein/build/sage-4.5.1/local/lib/python2.6/site-packages/sage/matrix/matrix_mod2_dense.so:
undefined symbol: mzd_lqup
Sage failed to startup.
```



---

archive/issue_events_069821.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-07-18T20:05:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69821"
}
```



---

archive/issue_events_069822.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-07-18T20:05:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69822"
}
```



---

archive/issue_comments_083610.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [rlm](#comment%3A20):\n> With a fresh build, sage doesn't start:\n\n\n```\n Traceback (most recent call last):\n  File \"/mnt/usb1/scratch/wstein/build/sage-4.5.1/local/bin/sage-eval\",line 4, in <module>\n    from sage.all import *\n  File \"/mnt/usb1/scratch/wstein/build/sage-4.5.1/local/lib/python2.6/site-packages/sage/all.py\", line 73, in <module>\n    from sage.matrix.all     import *\n  File \"/mnt/usb1/scratch/wstein/build/sage-4.5.1/local/lib/python2.6/site-packages/sage/matrix/all.py\", line 1, in <module>\n    from matrix_space import MatrixSpace, is_MatrixSpace\n  File \"/mnt/usb1/scratch/wstein/build/sage-4.5.1/local/lib/python2.6/site-packages/sage/matrix/matrix_space.py\", line 40, in <module>\n    import matrix_mod2_dense\n ImportError: /mnt/usb1/scratch/wstein/build/sage-4.5.1/local/lib/python2.6/site-packages/sage/matrix/matrix_mod2_dense.so:\n undefined symbol: mzd_lqup\n Sage failed to startup.\n```\n\nLooks as if you haven't applied the Sage library patch (or didn't do `sage -b` after that).",
    "created_at": "2010-07-18T20:14:08Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83610",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:21'></a>
Replying to [rlm](#comment%3A20):
> With a fresh build, sage doesn't start:


```
 Traceback (most recent call last):
  File "/mnt/usb1/scratch/wstein/build/sage-4.5.1/local/bin/sage-eval",line 4, in <module>
    from sage.all import *
  File "/mnt/usb1/scratch/wstein/build/sage-4.5.1/local/lib/python2.6/site-packages/sage/all.py", line 73, in <module>
    from sage.matrix.all     import *
  File "/mnt/usb1/scratch/wstein/build/sage-4.5.1/local/lib/python2.6/site-packages/sage/matrix/all.py", line 1, in <module>
    from matrix_space import MatrixSpace, is_MatrixSpace
  File "/mnt/usb1/scratch/wstein/build/sage-4.5.1/local/lib/python2.6/site-packages/sage/matrix/matrix_space.py", line 40, in <module>
    import matrix_mod2_dense
 ImportError: /mnt/usb1/scratch/wstein/build/sage-4.5.1/local/lib/python2.6/site-packages/sage/matrix/matrix_mod2_dense.so:
 undefined symbol: mzd_lqup
 Sage failed to startup.
```

Looks as if you haven't applied the Sage library patch (or didn't do `sage -b` after that).



---

archive/issue_comments_083611.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [leif](#comment%3A21):\n> \n> Looks as if you haven't applied the Sage library patch (or didn't do `sage -b` after that).\n> \n\n\nI've been pretty bad about this lately... Sorry guys.",
    "created_at": "2010-07-18T20:16:02Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83611",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:22'></a>
Replying to [leif](#comment%3A21):
> 
> Looks as if you haven't applied the Sage library patch (or didn't do `sage -b` after that).
> 


I've been pretty bad about this lately... Sorry guys.



---

archive/issue_events_069823.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-07-18T20:16:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69823"
}
```



---

archive/issue_events_069824.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-07-18T20:16:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69824"
}
```



---

archive/issue_comments_083612.json:
```json
{
    "body": "<a id='comment:23'></a>\n\n```\nsage -t -long \"devel/sage-main/sage/crypto/mq/mpolynomialsystem.py\"\n\n------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\nThis probably occurred because a *compiled* component\nof Sage has a bug in it (typically accessing invalid memory)\nor is not properly wrapped with _sig_on, _sig_off.\nYou might want to run Sage under gdb with 'sage -gdb' to debug this.\nSage will now terminate (sorry).\n------------------------------------------------------------\n```",
    "created_at": "2010-07-18T22:08:38Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83612",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:23'></a>

```
sage -t -long "devel/sage-main/sage/crypto/mq/mpolynomialsystem.py"

------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component
of Sage has a bug in it (typically accessing invalid memory)
or is not properly wrapped with _sig_on, _sig_off.
You might want to run Sage under gdb with 'sage -gdb' to debug this.
Sage will now terminate (sorry).
------------------------------------------------------------
```



---

archive/issue_events_069825.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-07-18T22:08:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69825"
}
```



---

archive/issue_events_069826.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-07-18T22:08:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69826"
}
```



---

archive/issue_comments_083613.json:
```json
{
    "body": "<a id='comment:24'></a>\nI tried to reproduce your segmentation fault, but I can't.\n\n```\nmalb@sage:~/scratch_sage/sage-4.4$ ./sage -t -long devel/sage-main/sage/crypto/mq/mpolynomialsystem.py\nsage -t -long \"devel/sage-main/sage/crypto/mq/mpolynomialsystem.py\"\n         [16.8 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 16.8 seconds\nmalb@sage:~/scratch_sage/sage-4.4$ cd devel/sage\nmalb@sage:~/scratch_sage/sage-4.4/devel/sage$ hg qap\nm4ri_new_version.patch\nsingular-3-1-1-4.patch\n\n```",
    "created_at": "2010-07-18T22:19:49Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83613",
    "user": "https://github.com/malb"
}
```

<a id='comment:24'></a>
I tried to reproduce your segmentation fault, but I can't.

```
malb@sage:~/scratch_sage/sage-4.4$ ./sage -t -long devel/sage-main/sage/crypto/mq/mpolynomialsystem.py
sage -t -long "devel/sage-main/sage/crypto/mq/mpolynomialsystem.py"
         [16.8 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 16.8 seconds
malb@sage:~/scratch_sage/sage-4.4$ cd devel/sage
malb@sage:~/scratch_sage/sage-4.4/devel/sage$ hg qap
m4ri_new_version.patch
singular-3-1-1-4.patch

```



---

archive/issue_comments_083614.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [rlm](#comment%3A23):\n\n```\nsage -t -long \"devel/sage-main/sage/crypto/mq/mpolynomialsystem.py\"\n\n------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\n...\n```\n\nMachine, OS, platform? Parallel test? Whole library or just that single file?",
    "created_at": "2010-07-18T22:33:49Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83614",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:25'></a>
Replying to [rlm](#comment%3A23):

```
sage -t -long "devel/sage-main/sage/crypto/mq/mpolynomialsystem.py"

------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
...
```

Machine, OS, platform? Parallel test? Whole library or just that single file?



---

archive/issue_comments_083615.json:
```json
{
    "body": "<a id='comment:26'></a>\nOn geom.math, with a parallel build, in parallel and serial testing.",
    "created_at": "2010-07-19T07:05:51Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83615",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:26'></a>
On geom.math, with a parallel build, in parallel and serial testing.



---

archive/issue_comments_083616.json:
```json
{
    "body": "<a id='comment:27'></a>\n\n```\nTrying:\n    C = mq.MPolynomialSystem(r2).connected_components(); C###line 76:_sage_    >>> C = mq.MPolynomialSystem(r2).connecte\nd_components(); C\nExpecting:\n    [Polynomial System with 16 Polynomials in 16 Variables,\n     Polynomial System with 16 Polynomials in 16 Variables]\nok\nTrying:\n    C[Integer(0)].groebner_basis()###line 80:_sage_    >>> C[0].groebner_basis()\nExpecting:\n    [x111*x110 + w113*x110 + w113*x112 + w113*x113 + w113*w111 + w113*w112 + x111 + x113 + w110 + w111 + w112,\n... (more output)\nBOOM\n```",
    "created_at": "2010-07-19T08:25:49Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83616",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:27'></a>

```
Trying:
    C = mq.MPolynomialSystem(r2).connected_components(); C###line 76:_sage_    >>> C = mq.MPolynomialSystem(r2).connecte
d_components(); C
Expecting:
    [Polynomial System with 16 Polynomials in 16 Variables,
     Polynomial System with 16 Polynomials in 16 Variables]
ok
Trying:
    C[Integer(0)].groebner_basis()###line 80:_sage_    >>> C[0].groebner_basis()
Expecting:
    [x111*x110 + w113*x110 + w113*x112 + w113*x113 + w113*w111 + w113*w112 + x111 + x113 + w110 + w111 + w112,
... (more output)
BOOM
```



---

archive/issue_comments_083617.json:
```json
{
    "body": "<a id='comment:28'></a>\nI executed these steps\n\n* I got a clean 4.5\n* installed r-2.10.1.p3.spkg #9396\n* installed libm4ri-20100701.p1.spkg #9475\u00a0\n* applied m4ri_new_version.patch to devel/sage-main repo #9475\u00a0\n* merged trac_9507.patch to local/bin repo #9507\u00a0\n* replaced spkg/install with \"install.2\" from the ticket\u00a0#9528\n* ./sage -sdist 4.5.1\n* then extracted the tarball...\n* export SAGE_PARALLEL_SPKG_BUILD=yes\n* export MAKE=make -j20\n* make\n* since somehow libm4ri wasn't updated afterwards, I reinstalled\u00a0libm4ri-20100701.p1.spkg\n\n**Result:**\n\n```\nmalb@geom:~/scratch_sage/SIGSEGV/sage-4.5.1$ ./sage -t -long devel/sage/sage/crypto/mq/mpolynomialsystem.py \nsage -t -long \"devel/sage/sage/crypto/mq/mpolynomialsystem.py\"\n         [17.1 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 17.1 seconds\n\n```",
    "created_at": "2010-07-19T16:25:22Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83617",
    "user": "https://github.com/malb"
}
```

<a id='comment:28'></a>
I executed these steps

* I got a clean 4.5
* installed r-2.10.1.p3.spkg #9396
* installed libm4ri-20100701.p1.spkg #9475 
* applied m4ri_new_version.patch to devel/sage-main repo #9475 
* merged trac_9507.patch to local/bin repo #9507 
* replaced spkg/install with "install.2" from the ticket #9528
* ./sage -sdist 4.5.1
* then extracted the tarball...
* export SAGE_PARALLEL_SPKG_BUILD=yes
* export MAKE=make -j20
* make
* since somehow libm4ri wasn't updated afterwards, I reinstalled libm4ri-20100701.p1.spkg

**Result:**

```
malb@geom:~/scratch_sage/SIGSEGV/sage-4.5.1$ ./sage -t -long devel/sage/sage/crypto/mq/mpolynomialsystem.py 
sage -t -long "devel/sage/sage/crypto/mq/mpolynomialsystem.py"
         [17.1 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 17.1 seconds

```



---

archive/issue_comments_083618.json:
```json
{
    "body": "<a id='comment:29'></a>\nWell then, maybe it was a cosmic ray...",
    "created_at": "2010-07-19T16:33:45Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83618",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:29'></a>
Well then, maybe it was a cosmic ray...



---

archive/issue_events_069827.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-07-19T16:33:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69827"
}
```



---

archive/issue_events_069828.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-07-19T16:33:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69828"
}
```



---

archive/issue_events_069829.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-08-07T02:46:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69829"
}
```



---

archive/issue_events_069830.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-08-07T02:46:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69830"
}
```



---

archive/issue_comments_083619.json:
```json
{
    "body": "<a id='comment:30'></a>\nDo I need to apply \n\n  http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20100701.p1.spkg\n\n*and* [attachment:m4ri_new_version.patch](https://github.com/sagemath/sage/files/ticket9475/m4ri_new_version.patch)?  Can someone put the ticket number in the commit string?",
    "created_at": "2010-08-07T02:46:27Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83619",
    "user": "https://github.com/qed777"
}
```

<a id='comment:30'></a>
Do I need to apply 

  http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20100701.p1.spkg

*and* [attachment:m4ri_new_version.patch](https://github.com/sagemath/sage/files/ticket9475/m4ri_new_version.patch)?  Can someone put the ticket number in the commit string?



---

archive/issue_events_069831.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-08-07T02:47:50Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "milestone": "sage-4.5.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69831"
}
```



---

archive/issue_events_069832.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-08-07T02:47:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "milestone": "sage-4.5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69832"
}
```



---

archive/issue_comments_083620.json:
```json
{
    "body": "<a id='comment:32'></a>\n## Note to the release managers\n\n**Apply only [m4ri_new_version.v2.patch](https://github.com/sagemath/sage/files/ticket9475/m4ri_new_version.v2.patch) to the Sage library** when merging the [new M4RI spkg](http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20100701.p1.spkg); that patch is identical to `m4ri_new_version.patch` except for the commit message. (I don't have the power to replace Martin's attachment.)",
    "created_at": "2010-08-07T07:16:34Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83620",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:32'></a>
## Note to the release managers

**Apply only [m4ri_new_version.v2.patch](https://github.com/sagemath/sage/files/ticket9475/m4ri_new_version.v2.patch) to the Sage library** when merging the [new M4RI spkg](http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20100701.p1.spkg); that patch is identical to `m4ri_new_version.patch` except for the commit message. (I don't have the power to replace Martin's attachment.)



---

archive/issue_comments_083621.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,2 +1,7 @@\n The new version improves elimination to some extent, comes with a cleaner API and has an option to suppress SSE instructions.\n \n+---\n+\n+## Note to the release managers\n+\n+**Apply only [m4ri_new_version.v2.patch](https://github.com/sagemath/sage/files/ticket9475/m4ri_new_version.v2.patch) to the Sage library** when merging the [new M4RI spkg](http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20100701.p1.spkg).\n``````\n",
    "created_at": "2010-08-07T07:16:34Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83621",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,2 +1,7 @@
 The new version improves elimination to some extent, comes with a cleaner API and has an option to suppress SSE instructions.
 
+---
+
+## Note to the release managers
+
+**Apply only [m4ri_new_version.v2.patch](https://github.com/sagemath/sage/files/ticket9475/m4ri_new_version.v2.patch) to the Sage library** when merging the [new M4RI spkg](http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20100701.p1.spkg).
``````




---

archive/issue_events_069833.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-08-07T07:16:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69833"
}
```



---

archive/issue_events_069834.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-08-07T07:16:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69834"
}
```



---

archive/issue_comments_083622.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [mpatel](#comment%3A30):\n> Can someone put the ticket number in the commit string?\n\n\nDone, but now we have yet another attachment since I couldn't replace Martin's.\n\n(I would have thought his patch's comment was sufficient to conclude that the patch has to be applied to the Sage library repository... ;-) )",
    "created_at": "2010-08-07T07:24:16Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83622",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:33'></a>
Replying to [mpatel](#comment%3A30):
> Can someone put the ticket number in the commit string?


Done, but now we have yet another attachment since I couldn't replace Martin's.

(I would have thought his patch's comment was sufficient to conclude that the patch has to be applied to the Sage library repository... ;-) )



---

archive/issue_comments_083623.json:
```json
{
    "body": "<a id='comment:34'></a>\nNote: I haven't merged this ticket into 4.5.3.alpha0, because I noticed some segfaults that appear to stem from the new package and/or patch, when I doctested various trial alpha0s on sage.math.  At the moment, it seems best to put out a 4.5.3.alpha0 with passing doctests and base on this any necessary efforts to merge the new M4RI into alpha1.",
    "created_at": "2010-08-09T23:00:04Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83623",
    "user": "https://github.com/qed777"
}
```

<a id='comment:34'></a>
Note: I haven't merged this ticket into 4.5.3.alpha0, because I noticed some segfaults that appear to stem from the new package and/or patch, when I doctested various trial alpha0s on sage.math.  At the moment, it seems best to put out a 4.5.3.alpha0 with passing doctests and base on this any necessary efforts to merge the new M4RI into alpha1.



---

archive/issue_comments_083624.json:
```json
{
    "body": "<a id='comment:35'></a>\n*Of course*, all long tests now pass (well, there are no reproducible failures) on sage.math with 4.5.3.alpha0 + #9475, so it seems no new efforts are necessary.  I'm checking bsd, redhawk, and t2 now.",
    "created_at": "2010-08-10T04:18:41Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83624",
    "user": "https://github.com/qed777"
}
```

<a id='comment:35'></a>
*Of course*, all long tests now pass (well, there are no reproducible failures) on sage.math with 4.5.3.alpha0 + #9475, so it seems no new efforts are necessary.  I'm checking bsd, redhawk, and t2 now.



---

archive/issue_comments_083625.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [mpatel](#comment%3A35):\n> *Of course*, all long tests now pass (well, there are no reproducible failures) on sage.math with 4.5.3.alpha0 + #9475, so it seems no new efforts are necessary.  I'm checking bsd, redhawk, and t2 now.\n\nThe long doctests also pass on bsd, redhawk, and t2.",
    "created_at": "2010-08-10T05:47:06Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83625",
    "user": "https://github.com/qed777"
}
```

<a id='comment:36'></a>
Replying to [mpatel](#comment%3A35):
> *Of course*, all long tests now pass (well, there are no reproducible failures) on sage.math with 4.5.3.alpha0 + #9475, so it seems no new efforts are necessary.  I'm checking bsd, redhawk, and t2 now.

The long doctests also pass on bsd, redhawk, and t2.



---

archive/issue_comments_083626.json:
```json
{
    "body": "<a id='comment:37'></a>\nThere definitely is a bug in this new M4RI, I do get SIGSEGVs on my new laptop. I'll investigate.",
    "created_at": "2010-08-10T14:02:05Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83626",
    "user": "https://github.com/malb"
}
```

<a id='comment:37'></a>
There definitely is a bug in this new M4RI, I do get SIGSEGVs on my new laptop. I'll investigate.



---

archive/issue_events_069835.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2010-08-10T14:02:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69835"
}
```



---

archive/issue_events_069836.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2010-08-10T14:02:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69836"
}
```



---

archive/issue_comments_083627.json:
```json
{
    "body": "<a id='comment:38'></a>\n\n```\n        while(it!=end){\n            Exponent e=*it; \n                from_term_map_type::const_iterator from_it=eliminated2row_number.find(e);\n                assert(terms_as_exp_step1[row_start[from_it->second]]==e);\n                assert(from_it!=eliminated2row_number.end());\n ===>               int index=from_it->second;//...translate e->line number;\n                mzd_write_bit(mat_step2_factor,i,index,1);\n            it++;\n        }\n\n```\nThis is where pbori.pyx crashes for me. I installed a new GCC today, so maybe that's to blame?",
    "created_at": "2010-08-10T14:42:54Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83627",
    "user": "https://github.com/malb"
}
```

<a id='comment:38'></a>

```
        while(it!=end){
            Exponent e=*it; 
                from_term_map_type::const_iterator from_it=eliminated2row_number.find(e);
                assert(terms_as_exp_step1[row_start[from_it->second]]==e);
                assert(from_it!=eliminated2row_number.end());
 ===>               int index=from_it->second;//...translate e->line number;
                mzd_write_bit(mat_step2_factor,i,index,1);
            it++;
        }

```
This is where pbori.pyx crashes for me. I installed a new GCC today, so maybe that's to blame?



---

archive/issue_events_069837.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2010-08-10T15:01:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69837"
}
```



---

archive/issue_events_069838.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2010-08-10T15:01:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69838"
}
```



---

archive/issue_comments_083628.json:
```json
{
    "body": "<a id='comment:39'></a>\nI think I got it: The[This is the Trac macro *PolyBoRi* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#PolyBoRi-macro) SPKG in 4.5.2 ships its own M4RI (and Boost) which conflicts with this new M4RI SPKG, thus since Leif removed this redundant copy of M4RI in the PolyBoRi, it works in 4.5.3.alpha0 but not before.",
    "created_at": "2010-08-10T15:01:33Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83628",
    "user": "https://github.com/malb"
}
```

<a id='comment:39'></a>
I think I got it: The[This is the Trac macro *PolyBoRi* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#PolyBoRi-macro) SPKG in 4.5.2 ships its own M4RI (and Boost) which conflicts with this new M4RI SPKG, thus since Leif removed this redundant copy of M4RI in the PolyBoRi, it works in 4.5.3.alpha0 but not before.



---

archive/issue_comments_083629.json:
```json
{
    "body": "<a id='comment:40'></a>\nReplying to [malb](#comment%3A39):\n> I think I got it: The PolyBoRi SPKG in 4.5.2 ships its own M4RI (and Boost) which conflicts with this new M4RI SPKG, thus since Leif removed this redundant copy of M4RI in the PolyBoRi, it works in 4.5.3.alpha0 but not before.\n\n\nLOL! (Sometimes little clean-ups make more sense than expected...)",
    "created_at": "2010-08-10T15:14:53Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83629",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:40'></a>
Replying to [malb](#comment%3A39):
> I think I got it: The PolyBoRi SPKG in 4.5.2 ships its own M4RI (and Boost) which conflicts with this new M4RI SPKG, thus since Leif removed this redundant copy of M4RI in the PolyBoRi, it works in 4.5.3.alpha0 but not before.


LOL! (Sometimes little clean-ups make more sense than expected...)



---

archive/issue_comments_083630.json:
```json
{
    "body": "<a id='comment:41'></a>\nIt seems this ticket is incompatible with#9717. On my laptop I always get SIGSEGVs in pbori.pyx",
    "created_at": "2010-08-11T15:50:05Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83630",
    "user": "https://github.com/malb"
}
```

<a id='comment:41'></a>
It seems this ticket is incompatible with#9717. On my laptop I always get SIGSEGVs in pbori.pyx



---

archive/issue_comments_083631.json:
```json
{
    "body": "<a id='comment:42'></a>\nI tracked down the issue. The cause is some assumptions in[This is the Trac macro *PolyBoRi* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#PolyBoRi-macro) about M4RI which are not met anymore. This ticket can go in I say",
    "created_at": "2010-08-11T17:58:07Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83631",
    "user": "https://github.com/malb"
}
```

<a id='comment:42'></a>
I tracked down the issue. The cause is some assumptions in[This is the Trac macro *PolyBoRi* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#PolyBoRi-macro) about M4RI which are not met anymore. This ticket can go in I say



---

archive/issue_comments_083632.json:
```json
{
    "body": "<a id='comment:43'></a>\nActually, this ticket can only go in if a fix for[This is the Trac macro *PolyBoRi* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#PolyBoRi-macro) is also accepted, cf. #9717",
    "created_at": "2010-08-11T18:04:57Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83632",
    "user": "https://github.com/malb"
}
```

<a id='comment:43'></a>
Actually, this ticket can only go in if a fix for[This is the Trac macro *PolyBoRi* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#PolyBoRi-macro) is also accepted, cf. #9717



---

archive/issue_comments_083633.json:
```json
{
    "body": "<a id='comment:44'></a>\nMinor thing: the documentation for rank still says:\n\nOn average 'lqup' should be faster than 'm4ri' and hence it is\n        the default choice.",
    "created_at": "2010-08-12T04:34:15Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83633",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:44'></a>
Minor thing: the documentation for rank still says:

On average 'lqup' should be faster than 'm4ri' and hence it is
        the default choice.



---

archive/issue_comments_083634.json:
```json
{
    "body": "<a id='comment:45'></a>\n#9717 has an updated, fixed[This is the Trac macro *PolyBoRi* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#PolyBoRi-macro) SPKG",
    "created_at": "2010-08-12T18:48:54Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83634",
    "user": "https://github.com/malb"
}
```

<a id='comment:45'></a>
#9717 has an updated, fixed[This is the Trac macro *PolyBoRi* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#PolyBoRi-macro) SPKG



---

archive/issue_comments_083635.json:
```json
{
    "body": "<a id='comment:46'></a>\nThe updated patch only replaces the mention of LQUP with PLS",
    "created_at": "2010-08-12T18:51:34Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83635",
    "user": "https://github.com/malb"
}
```

<a id='comment:46'></a>
The updated patch only replaces the mention of LQUP with PLS



---

archive/issue_comments_083636.json:
```json
{
    "body": "<a id='comment:47'></a>\nShould someone review the latest changes?",
    "created_at": "2010-08-12T20:15:41Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83636",
    "user": "https://github.com/qed777"
}
```

<a id='comment:47'></a>
Should someone review the latest changes?



---

archive/issue_comments_083637.json:
```json
{
    "body": "<a id='comment:48'></a>\nThe only change in the new version compared to the previous version of \u00a0m4ri_new_version.v2.patch is that one mention of LQUP was replaced by PLS in a docstring. That's all, this is why I didn't reset the status.",
    "created_at": "2010-08-12T20:48:50Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83637",
    "user": "https://github.com/malb"
}
```

<a id='comment:48'></a>
The only change in the new version compared to the previous version of  m4ri_new_version.v2.patch is that one mention of LQUP was replaced by PLS in a docstring. That's all, this is why I didn't reset the status.



---

archive/issue_comments_083638.json:
```json
{
    "body": "<a id='comment:49'></a>\nReplying to [malb](#comment%3A48):\n> The only change in the new version compared to the previous version of \u00a0m4ri_new_version.v2.patch is that one mention of LQUP was replaced by PLS in a docstring. That's all, this is why I didn't reset the status.\n\n\nNot 100%:\n\n```patch\n--- m4ri_new_version.v2.patch.orig\t2010-08-07 09:00:21.000000000 +0200\n+++ m4ri_new_version.v2.patch\t2010-08-12 20:50:56.000000000 +0200\n@@ -1,14 +1,14 @@\n # HG changeset patch\n # User Martin Albrecht <malb@informatik.uni-bremen.de>\n # Date 1277764034 -3600\n-# Node ID 3365789479e6d70cb1930b2e97c7874cbd3310db\n-# Parent  ba36200d8a2f844179785580245fd95aa6401a51\n+# Node ID 3b116dd35a84e0b6bd8ea12a732b8fa1fbda796f\n+# Parent  0bb69a98789215c64a81c4602f46a50c0aeca5f0\n #9475 Adapts Sage library interface to new M4RI API (libm4ri-20100701)\n \n-diff -r ba36200d8a2f -r 3365789479e6 module_list.py\n---- a/module_list.py\tFri Jun 25 10:05:59 2010 +0100\n+diff -r 0bb69a987892 -r 3b116dd35a84 module_list.py\n+--- a/module_list.py\tTue Aug 10 13:46:10 2010 +0100\n +++ b/module_list.py\tMon Jun 28 23:27:14 2010 +0100\n-@@ -783,7 +783,7 @@\n+@@ -807,7 +807,7 @@\n      Extension('sage.matrix.matrix_mod2_dense',\n                sources = ['sage/matrix/matrix_mod2_dense.pyx'],\n                libraries = ['gmp','m4ri', 'gd', 'png12', 'z'],\n@@ -17,7 +17,7 @@\n  \n      Extension('sage.matrix.matrix_modn_dense',\n                sources = ['sage/matrix/matrix_modn_dense.pyx'],\n-@@ -971,7 +971,7 @@\n+@@ -995,7 +995,7 @@\n      Extension('sage.modules.vector_mod2_dense',\n                sources = ['sage/modules/vector_mod2_dense.pyx'],\n                libraries = ['gmp','m4ri', 'png12', 'gd'],\n@@ -26,8 +26,8 @@\n      \n      Extension('sage.modules.vector_rational_dense',\n                sources = ['sage/modules/vector_rational_dense.pyx'],\n-diff -r ba36200d8a2f -r 3365789479e6 sage/libs/m4ri.pxd\n---- a/sage/libs/m4ri.pxd\tFri Jun 25 10:05:59 2010 +0100\n+diff -r 0bb69a987892 -r 3b116dd35a84 sage/libs/m4ri.pxd\n+--- a/sage/libs/m4ri.pxd\tTue Aug 10 13:46:10 2010 +0100\n +++ b/sage/libs/m4ri.pxd\tMon Jun 28 23:27:14 2010 +0100\n @@ -141,6 +141,9 @@\n      # reduced row echelon form from upper triangular form\n@@ -60,8 +60,8 @@\n  \n      # reduced row echelon form using PLUQ factorization\n      cdef long mzd_echelonize_pluq(mzd_t *A, int full)\n-diff -r ba36200d8a2f -r 3365789479e6 sage/matrix/matrix_mod2_dense.pyx\n---- a/sage/matrix/matrix_mod2_dense.pyx\tFri Jun 25 10:05:59 2010 +0100\n+diff -r 0bb69a987892 -r 3b116dd35a84 sage/matrix/matrix_mod2_dense.pyx\n+--- a/sage/matrix/matrix_mod2_dense.pyx\tTue Aug 10 13:46:10 2010 +0100\n +++ b/sage/matrix/matrix_mod2_dense.pyx\tMon Jun 28 23:27:14 2010 +0100\n @@ -1010,15 +1010,16 @@\n      #    * Matrix windows -- only if you need strassen for that base\n@@ -116,7 +116,28 @@\n                  k = 0\n  \n              _sig_on\n-@@ -1681,7 +1691,7 @@\n+@@ -1106,6 +1116,20 @@\n+             self.cache('rank', r)\n+             self.cache('pivots', self._pivots())\n+ \n++        elif algorithm == 'top':\n++            \n++            self.check_mutability()\n++            self.clear_cache()        \n++\n++            _sig_on\n++            mzd_top_echelonize_m4ri(self._entries, 0)\n++            r = 0\n++            _sig_off\n++            \n++            self.cache('in_echelon_form',True)\n++            self.cache('rank', r)\n++            self.cache('pivots', self._pivots())\n++\n+         elif algorithm == 'linbox':\n+ \n+             #self._echelonize_linbox()\n+@@ -1681,7 +1705,7 @@\n              sage: float(d)\n              0.63184899999999999\n              sage: A.density(approx=True)\n@@ -125,7 +146,7 @@\n              sage: float(len(A.nonzero_positions())/1000^2)\n              0.63184899999999999\n          \"\"\"\n-@@ -1691,7 +1701,7 @@\n+@@ -1691,18 +1715,18 @@\n          else:\n              return matrix_dense.Matrix_dense.density(self)\n  \n@@ -134,7 +155,11 @@\n          \"\"\"\n          Return the rank of this matrix.\n  \n-@@ -1702,7 +1712,7 @@\n+-        On average 'lqup' should be faster than 'm4ri' and hence it is\n++        On average 'pls' should be faster than 'm4ri' and hence it is\n+         the default choice. However, for small - i.e. quite few\n+         thousand rows & columns - and sparse matrices 'm4ri' might be\n+         a better choice.\n  \n          INPUT:\n  \n@@ -143,7 +168,7 @@\n  \n          EXAMPLE::\n  \n-@@ -1722,10 +1732,10 @@\n+@@ -1722,10 +1746,10 @@\n          cdef mzd_t *A = mzd_copy(NULL, self._entries)\n          cdef mzp_t *P, *Q\n  \n@@ -156,7 +181,7 @@\n              mzp_free(P)\n              mzp_free(Q)\n          elif algorithm == 'm4ri':\n-@@ -2060,9 +2070,9 @@\n+@@ -2060,9 +2084,9 @@\n      mzp_free(q)\n      return B,P,Q\n  \n@@ -168,7 +193,7 @@\n  \n      INPUT:\n          A -- matrix\n-@@ -2074,14 +2084,14 @@\n+@@ -2074,14 +2098,14 @@\n  \n      EXAMPLE::\n  \n@@ -185,7 +210,7 @@\n          sage: LU\n          [1 0 0 1]\n          [1 1 0 0]\n-@@ -2095,7 +2105,7 @@\n+@@ -2095,7 +2119,7 @@\n          [0, 1, 2, 3]\n  \n          sage: A = random_matrix(GF(2),1000,1000)\n@@ -194,7 +219,7 @@\n          True\n      \"\"\"\n      cdef Matrix_mod2_dense B = A.__copy__()\n-@@ -2104,15 +2114,15 @@\n+@@ -2104,15 +2128,15 @@\n  \n      if algorithm == 'standard':\n          _sig_on\n```",
    "created_at": "2010-08-13T03:05:08Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83638",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:49'></a>
Replying to [malb](#comment%3A48):
> The only change in the new version compared to the previous version of  m4ri_new_version.v2.patch is that one mention of LQUP was replaced by PLS in a docstring. That's all, this is why I didn't reset the status.


Not 100%:

```patch
--- m4ri_new_version.v2.patch.orig	2010-08-07 09:00:21.000000000 +0200
+++ m4ri_new_version.v2.patch	2010-08-12 20:50:56.000000000 +0200
@@ -1,14 +1,14 @@
 # HG changeset patch
 # User Martin Albrecht <malb@informatik.uni-bremen.de>
 # Date 1277764034 -3600
-# Node ID 3365789479e6d70cb1930b2e97c7874cbd3310db
-# Parent  ba36200d8a2f844179785580245fd95aa6401a51
+# Node ID 3b116dd35a84e0b6bd8ea12a732b8fa1fbda796f
+# Parent  0bb69a98789215c64a81c4602f46a50c0aeca5f0
 #9475 Adapts Sage library interface to new M4RI API (libm4ri-20100701)
 
-diff -r ba36200d8a2f -r 3365789479e6 module_list.py
---- a/module_list.py	Fri Jun 25 10:05:59 2010 +0100
+diff -r 0bb69a987892 -r 3b116dd35a84 module_list.py
+--- a/module_list.py	Tue Aug 10 13:46:10 2010 +0100
 +++ b/module_list.py	Mon Jun 28 23:27:14 2010 +0100
-@@ -783,7 +783,7 @@
+@@ -807,7 +807,7 @@
      Extension('sage.matrix.matrix_mod2_dense',
                sources = ['sage/matrix/matrix_mod2_dense.pyx'],
                libraries = ['gmp','m4ri', 'gd', 'png12', 'z'],
@@ -17,7 +17,7 @@
  
      Extension('sage.matrix.matrix_modn_dense',
                sources = ['sage/matrix/matrix_modn_dense.pyx'],
-@@ -971,7 +971,7 @@
+@@ -995,7 +995,7 @@
      Extension('sage.modules.vector_mod2_dense',
                sources = ['sage/modules/vector_mod2_dense.pyx'],
                libraries = ['gmp','m4ri', 'png12', 'gd'],
@@ -26,8 +26,8 @@
      
      Extension('sage.modules.vector_rational_dense',
                sources = ['sage/modules/vector_rational_dense.pyx'],
-diff -r ba36200d8a2f -r 3365789479e6 sage/libs/m4ri.pxd
---- a/sage/libs/m4ri.pxd	Fri Jun 25 10:05:59 2010 +0100
+diff -r 0bb69a987892 -r 3b116dd35a84 sage/libs/m4ri.pxd
+--- a/sage/libs/m4ri.pxd	Tue Aug 10 13:46:10 2010 +0100
 +++ b/sage/libs/m4ri.pxd	Mon Jun 28 23:27:14 2010 +0100
 @@ -141,6 +141,9 @@
      # reduced row echelon form from upper triangular form
@@ -60,8 +60,8 @@
  
      # reduced row echelon form using PLUQ factorization
      cdef long mzd_echelonize_pluq(mzd_t *A, int full)
-diff -r ba36200d8a2f -r 3365789479e6 sage/matrix/matrix_mod2_dense.pyx
---- a/sage/matrix/matrix_mod2_dense.pyx	Fri Jun 25 10:05:59 2010 +0100
+diff -r 0bb69a987892 -r 3b116dd35a84 sage/matrix/matrix_mod2_dense.pyx
+--- a/sage/matrix/matrix_mod2_dense.pyx	Tue Aug 10 13:46:10 2010 +0100
 +++ b/sage/matrix/matrix_mod2_dense.pyx	Mon Jun 28 23:27:14 2010 +0100
 @@ -1010,15 +1010,16 @@
      #    * Matrix windows -- only if you need strassen for that base
@@ -116,7 +116,28 @@
                  k = 0
  
              _sig_on
-@@ -1681,7 +1691,7 @@
+@@ -1106,6 +1116,20 @@
+             self.cache('rank', r)
+             self.cache('pivots', self._pivots())
+ 
++        elif algorithm == 'top':
++            
++            self.check_mutability()
++            self.clear_cache()        
++
++            _sig_on
++            mzd_top_echelonize_m4ri(self._entries, 0)
++            r = 0
++            _sig_off
++            
++            self.cache('in_echelon_form',True)
++            self.cache('rank', r)
++            self.cache('pivots', self._pivots())
++
+         elif algorithm == 'linbox':
+ 
+             #self._echelonize_linbox()
+@@ -1681,7 +1705,7 @@
              sage: float(d)
              0.63184899999999999
              sage: A.density(approx=True)
@@ -125,7 +146,7 @@
              sage: float(len(A.nonzero_positions())/1000^2)
              0.63184899999999999
          """
-@@ -1691,7 +1701,7 @@
+@@ -1691,18 +1715,18 @@
          else:
              return matrix_dense.Matrix_dense.density(self)
  
@@ -134,7 +155,11 @@
          """
          Return the rank of this matrix.
  
-@@ -1702,7 +1712,7 @@
+-        On average 'lqup' should be faster than 'm4ri' and hence it is
++        On average 'pls' should be faster than 'm4ri' and hence it is
+         the default choice. However, for small - i.e. quite few
+         thousand rows & columns - and sparse matrices 'm4ri' might be
+         a better choice.
  
          INPUT:
  
@@ -143,7 +168,7 @@
  
          EXAMPLE::
  
-@@ -1722,10 +1732,10 @@
+@@ -1722,10 +1746,10 @@
          cdef mzd_t *A = mzd_copy(NULL, self._entries)
          cdef mzp_t *P, *Q
  
@@ -156,7 +181,7 @@
              mzp_free(P)
              mzp_free(Q)
          elif algorithm == 'm4ri':
-@@ -2060,9 +2070,9 @@
+@@ -2060,9 +2084,9 @@
      mzp_free(q)
      return B,P,Q
  
@@ -168,7 +193,7 @@
  
      INPUT:
          A -- matrix
-@@ -2074,14 +2084,14 @@
+@@ -2074,14 +2098,14 @@
  
      EXAMPLE::
  
@@ -185,7 +210,7 @@
          sage: LU
          [1 0 0 1]
          [1 1 0 0]
-@@ -2095,7 +2105,7 @@
+@@ -2095,7 +2119,7 @@
          [0, 1, 2, 3]
  
          sage: A = random_matrix(GF(2),1000,1000)
@@ -194,7 +219,7 @@
          True
      """
      cdef Matrix_mod2_dense B = A.__copy__()
-@@ -2104,15 +2114,15 @@
+@@ -2104,15 +2128,15 @@
  
      if algorithm == 'standard':
          _sig_on
```



---

archive/issue_comments_083639.json:
```json
{
    "body": "<a id='comment:50'></a>\nArgh, I'm an idiot! I'll update the patch, the 'top' stuff must be removed",
    "created_at": "2010-08-13T08:44:06Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83639",
    "user": "https://github.com/malb"
}
```

<a id='comment:50'></a>
Argh, I'm an idiot! I'll update the patch, the 'top' stuff must be removed



---

archive/issue_comments_083640.json:
```json
{
    "body": "Sage library patch - needed to comply with new M4RI API (libm4ri-20100701). (Contains ticket number; apply only this one.)",
    "created_at": "2010-08-13T08:44:21Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83640",
    "user": "https://github.com/malb"
}
```

Sage library patch - needed to comply with new M4RI API (libm4ri-20100701). (Contains ticket number; apply only this one.)



---

archive/attachments_012559.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "m4ri_new_version.v2.patch",
    "asset_url": "tarball://root/attachments/ticket9475/m4ri_new_version.v2.patch",
    "created_at": "2010-08-13T09:43:20Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket9475/m4ri_new_version.v2.patch",
    "user": "https://github.com/nexttime"
}
```



---

archive/issue_comments_083641.json:
```json
{
    "body": "<a id='comment:51'></a>\n**Attachment:** [m4ri_new_version.v2.patch](https://github.com/sagemath/sage/files/ticket9475/m4ri_new_version.v2.patch)\n\nReplying to [malb](#comment%3A50):\n> Argh, I'm an idiot! I'll update the patch, the 'top' stuff must be removed\n\n\nNevertheless, passed all long tests with Sage 4.5.3.alpha0 and PolyBoRi 0.6.4.p4 from #9717 on Fedora 13 x86 (Pentium 4 Prescott, gcc 4.4.4).\n\nThe newly uploaded patch contains only the desired changes.",
    "created_at": "2010-08-13T09:43:20Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83641",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:51'></a>
**Attachment:** [m4ri_new_version.v2.patch](https://github.com/sagemath/sage/files/ticket9475/m4ri_new_version.v2.patch)

Replying to [malb](#comment%3A50):
> Argh, I'm an idiot! I'll update the patch, the 'top' stuff must be removed


Nevertheless, passed all long tests with Sage 4.5.3.alpha0 and PolyBoRi 0.6.4.p4 from #9717 on Fedora 13 x86 (Pentium 4 Prescott, gcc 4.4.4).

The newly uploaded patch contains only the desired changes.



---

archive/issue_events_069839.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-08-15T08:03:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69839"
}
```



---

archive/issue_events_069840.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-08-15T08:03:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9475#event-69840"
}
```



---

archive/issue_comments_083642.json:
```json
{
    "body": "**Merged:** sage-4.5.3.alpha0",
    "created_at": "2010-08-15T08:03:14Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83642",
    "user": "https://github.com/qed777"
}
```

**Merged:** sage-4.5.3.alpha0



---

archive/issue_comments_083643.json:
```json
{
    "body": "**Changing merged** from \"sage-4.5.3.alpha0\" to \"sage-4.5.3.alpha1\".",
    "created_at": "2010-08-15T08:27:27Z",
    "issue": "https://github.com/sagemath/sage/issues/9475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9475#issuecomment-83643",
    "user": "https://github.com/qed777"
}
```

**Changing merged** from "sage-4.5.3.alpha0" to "sage-4.5.3.alpha1".
