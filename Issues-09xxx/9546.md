# Issue 9546: bounded outdegree orientation

archive/issues_009546.json:
```json
{
    "assignees": [
        "https://github.com/jasongrout",
        "https://github.com/nathanncohen",
        "https://github.com/rlmill"
    ],
    "body": "Given a Graph and a value associating an integer b(v) to each vertex v, this method computes an orientation of G such that each vertex has out_degree at most v, if it exists. \n\nThe method is to use a max flow, which is explained in the patch in several lines.\n\nNathann\n\nCC:  @sagetrac-jthurber\n\nComponent: **graph theory**\n\nAuthor: **Nathann Cohen, Geoffrey Ehrman**\n\nReviewer: **Robert Miller**\n\nMerged: **sage-4.6.2.alpha1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/9546_\n\n",
    "closed_at": "2011-01-19T22:22:07Z",
    "created_at": "2010-07-19T05:48:54Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.6.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "bounded outdegree orientation",
    "type": "issue",
    "updated_at": "2011-01-19T22:22:07Z",
    "url": "https://github.com/sagemath/sage/issues/9546",
    "user": "https://github.com/nathanncohen"
}
```
Given a Graph and a value associating an integer b(v) to each vertex v, this method computes an orientation of G such that each vertex has out_degree at most v, if it exists. 

The method is to use a max flow, which is explained in the patch in several lines.

Nathann

CC:  @sagetrac-jthurber

Component: **graph theory**

Author: **Nathann Cohen, Geoffrey Ehrman**

Reviewer: **Robert Miller**

Merged: **sage-4.6.2.alpha1**

_Issue created by migration from https://trac.sagemath.org/ticket/9546_





---

archive/issue_events_121775.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2010-07-19T05:48:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "milestone_number": null,
    "milestone_title": "sage-4.6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9546#event-121775"
}
```



---

archive/issue_events_121776.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2010-07-19T05:48:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9546#event-121776"
}
```



---

archive/issue_events_121777.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2010-07-19T05:48:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9546#event-121777"
}
```



---

archive/issue_events_121778.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2010-07-19T05:48:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9546#event-121778"
}
```



---

archive/issue_events_121779.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-07-19T05:48:54Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "subject": "https://github.com/nathanncohen",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9546#event-121779"
}
```



---

archive/issue_events_121780.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2010-07-19T05:48:54Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "subject": "https://github.com/nathanncohen",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9546#event-121780"
}
```



---

archive/issue_events_121781.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-07-19T05:48:54Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "subject": "https://github.com/nathanncohen",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9546#event-121781"
}
```



---

archive/issue_events_121782.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2010-07-19T05:49:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9546#event-121782"
}
```



---

archive/issue_comments_082777.json:
```json
{
    "body": "Author: **Nathann Cohen**",
    "created_at": "2011-01-12T03:58:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9546#issuecomment-82777",
    "user": "https://github.com/rlmill"
}
```

Author: **Nathann Cohen**



---

archive/issue_comments_082778.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\n\n```\n----------------------------------------------------------------------\n\nThe following tests failed:\n\n        sage -t -long devel/sage-main/sage/graphs/graph.py # 7 doctests failed\n----------------------------------------------------------------------\n```\n\nThese all seem to be:\n\n```\nNameError: global name 'floor' is not defined\n```",
    "created_at": "2011-01-12T03:58:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9546#issuecomment-82778",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:2" align="right">comment:2</div>


```
----------------------------------------------------------------------

The following tests failed:

        sage -t -long devel/sage-main/sage/graphs/graph.py # 7 doctests failed
----------------------------------------------------------------------
```

These all seem to be:

```
NameError: global name 'floor' is not defined
```



---

archive/issue_comments_082779.json:
```json
{
    "body": "Reviewer: **Robert Miller**",
    "created_at": "2011-01-12T03:58:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9546#issuecomment-82779",
    "user": "https://github.com/rlmill"
}
```

Reviewer: **Robert Miller**



---

archive/issue_events_121783.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2011-01-12T03:58:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9546#event-121783"
}
```



---

archive/issue_events_121784.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2011-01-12T03:58:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9546#event-121784"
}
```



---

archive/issue_events_121785.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2011-01-12T03:58:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "milestone_number": null,
    "milestone_title": "sage-4.6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9546#event-121785"
}
```



---

archive/issue_events_121786.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2011-01-12T03:58:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "milestone_number": null,
    "milestone_title": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9546#event-121786"
}
```



---

archive/issue_comments_082780.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nRight O_o\n\nThe error comes from the ford_fulkerson algorithm. I replaced \"floor(x)\" by \"x // 1\".\n\nI know I wrote this code myself, but when I looked at it I could only think : why on earth is our implementation of flows in Python and not Cython ? O_o\n\nUpdated ! Sorry for the trouble !\n\nNathann",
    "created_at": "2011-01-12T09:23:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9546#issuecomment-82780",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:3" align="right">comment:3</div>

Right O_o

The error comes from the ford_fulkerson algorithm. I replaced "floor(x)" by "x // 1".

I know I wrote this code myself, but when I looked at it I could only think : why on earth is our implementation of flows in Python and not Cython ? O_o

Updated ! Sorry for the trouble !

Nathann



---

archive/issue_events_121787.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2011-01-12T09:23:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9546#event-121787"
}
```



---

archive/issue_events_121788.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2011-01-12T09:23:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9546#event-121788"
}
```



---

archive/issue_comments_082781.json:
```json
{
    "body": "Attachment: **[trac_9546.patch.gz](https://github.com/sagemath/sage/files/ticket9546/trac_9546.patch.gz)**",
    "created_at": "2011-01-12T09:23:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9546#issuecomment-82781",
    "user": "https://github.com/nathanncohen"
}
```

Attachment: **[trac_9546.patch.gz](https://github.com/sagemath/sage/files/ticket9546/trac_9546.patch.gz)**



---

archive/issue_comments_082782.json:
```json
{
    "body": "Changed author from **Nathann Cohen** to **Nathann Cohen, Geoffrey Ehrman**",
    "created_at": "2011-01-12T23:05:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9546#issuecomment-82782",
    "user": "https://github.com/sagetrac-gbe"
}
```

Changed author from **Nathann Cohen** to **Nathann Cohen, Geoffrey Ehrman**



---

archive/issue_comments_082783.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nUsing floor division here might be nice, but I'm concerned about the coercion model:\n\n```\nsage: 1215.151//1\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/home/gbe/sage/dev/devel/sage-main/sage/<ipython console> in <module>()\n\n/usr/local/sage/local/lib/python2.6/site-packages/sage/rings/integer.so in sage.rings.integer.Integer.__floordiv__ (sage/rings/integer.c:11983)()\n\n/usr/local/sage/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.bin_op (sage/structure/element.c:17928)()\n\n/usr/local/sage/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.bin_op (sage/structure/element.c:17841)()\n\n/usr/local/sage/local/lib/python2.6/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6213)()\n\n/usr/local/sage/local/lib/python2.6/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6152)()\n\nTypeError: unsupported operand type(s) for //: 'sage.rings.real_mpfr.RealLiteral' and 'sage.rings.real_mpfr.RealNumber'\n```\n\nAlso, floor division doesn't seem to buy you any speedup:\n\n```\nsage: tests = [float(random()*10**randint(0,10)) for i in range(10)]\nsage: for i in tests:\n....:     timeit('floor(test)')\n\n625 loops, best of 3: 5.14 \u00b5s per loop\n625 loops, best of 3: 5.12 \u00b5s per loop\n625 loops, best of 3: 5.21 \u00b5s per loop\n625 loops, best of 3: 5.12 \u00b5s per loop\n625 loops, best of 3: 5.12 \u00b5s per loop\n625 loops, best of 3: 5.1 \u00b5s per loop\n625 loops, best of 3: 5.07 \u00b5s per loop\n625 loops, best of 3: 5.2 \u00b5s per loop\n625 loops, best of 3: 5.11 \u00b5s per loop\n625 loops, best of 3: 5.13 \u00b5s per loop\n\nsage: for i in tests:\n....:     timeit('test // 1')\n\n625 loops, best of 3: 9.33 \u00b5s per loop\n625 loops, best of 3: 9.47 \u00b5s per loop\n625 loops, best of 3: 9.4 \u00b5s per loop\n625 loops, best of 3: 9.44 \u00b5s per loop\n625 loops, best of 3: 9.4 \u00b5s per loop\n625 loops, best of 3: 9.4 \u00b5s per loop\n625 loops, best of 3: 9.35 \u00b5s per loop\n625 loops, best of 3: 9.31 \u00b5s per loop\n625 loops, best of 3: 9.3 \u00b5s per loop\n625 loops, best of 3: 9.4 \u00b5s per loop\n```\n\nAll in all I think the better solution is to just bring floor(x) into scope from functions/other.py, as I've done in the attached patch.",
    "created_at": "2011-01-12T23:05:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9546#issuecomment-82783",
    "user": "https://github.com/sagetrac-gbe"
}
```

<div id="comment:4" align="right">comment:4</div>

Using floor division here might be nice, but I'm concerned about the coercion model:

```
sage: 1215.151//1
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/gbe/sage/dev/devel/sage-main/sage/<ipython console> in <module>()

/usr/local/sage/local/lib/python2.6/site-packages/sage/rings/integer.so in sage.rings.integer.Integer.__floordiv__ (sage/rings/integer.c:11983)()

/usr/local/sage/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.bin_op (sage/structure/element.c:17928)()

/usr/local/sage/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.bin_op (sage/structure/element.c:17841)()

/usr/local/sage/local/lib/python2.6/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6213)()

/usr/local/sage/local/lib/python2.6/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6152)()

TypeError: unsupported operand type(s) for //: 'sage.rings.real_mpfr.RealLiteral' and 'sage.rings.real_mpfr.RealNumber'
```

Also, floor division doesn't seem to buy you any speedup:

```
sage: tests = [float(random()*10**randint(0,10)) for i in range(10)]
sage: for i in tests:
....:     timeit('floor(test)')

625 loops, best of 3: 5.14 µs per loop
625 loops, best of 3: 5.12 µs per loop
625 loops, best of 3: 5.21 µs per loop
625 loops, best of 3: 5.12 µs per loop
625 loops, best of 3: 5.12 µs per loop
625 loops, best of 3: 5.1 µs per loop
625 loops, best of 3: 5.07 µs per loop
625 loops, best of 3: 5.2 µs per loop
625 loops, best of 3: 5.11 µs per loop
625 loops, best of 3: 5.13 µs per loop

sage: for i in tests:
....:     timeit('test // 1')

625 loops, best of 3: 9.33 µs per loop
625 loops, best of 3: 9.47 µs per loop
625 loops, best of 3: 9.4 µs per loop
625 loops, best of 3: 9.44 µs per loop
625 loops, best of 3: 9.4 µs per loop
625 loops, best of 3: 9.4 µs per loop
625 loops, best of 3: 9.35 µs per loop
625 loops, best of 3: 9.31 µs per loop
625 loops, best of 3: 9.3 µs per loop
625 loops, best of 3: 9.4 µs per loop
```

All in all I think the better solution is to just bring floor(x) into scope from functions/other.py, as I've done in the attached patch.



---

archive/issue_comments_082784.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAttachment: **[9546_scope_fix.patch.gz](https://github.com/sagemath/sage/files/ticket9546/9546_scope_fix.patch.gz)**",
    "created_at": "2011-01-14T21:42:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9546#issuecomment-82784",
    "user": "https://github.com/sagetrac-jthurber"
}
```

<div id="comment:5" align="right">comment:5</div>

Attachment: **[9546_scope_fix.patch.gz](https://github.com/sagemath/sage/files/ticket9546/9546_scope_fix.patch.gz)**



---

archive/issue_events_121789.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2011-01-14T21:49:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9546#event-121789"
}
```



---

archive/issue_events_121790.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2011-01-14T21:49:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9546#event-121790"
}
```



---

archive/issue_comments_082785.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAttachment: **[trac_9546-ref-edit.patch.gz](https://github.com/sagemath/sage/files/ticket9546/trac_9546-ref-edit.patch.gz)**\n\napply all three patches",
    "created_at": "2011-01-14T21:49:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9546#issuecomment-82785",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:6" align="right">comment:6</div>

Attachment: **[trac_9546-ref-edit.patch.gz](https://github.com/sagemath/sage/files/ticket9546/trac_9546-ref-edit.patch.gz)**

apply all three patches



---

archive/issue_comments_082786.json:
```json
{
    "body": "Merged: **sage-4.6.2.alpha1**",
    "created_at": "2011-01-19T22:22:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9546#issuecomment-82786",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.6.2.alpha1**



---

archive/issue_events_121791.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-19T22:22:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9546#event-121791"
}
```



---

archive/issue_events_121792.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-19T22:22:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9546",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9546#event-121792"
}
```
