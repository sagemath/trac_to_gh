# Issue 9546: bounded outdegree orientation

archive/issues_009546.json:
```json
{
    "body": "Given a Graph and a value associating an integer b(v) to each vertex v, this method computes an orientation of G such that each vertex has out_degree at most v, if it exists. \n\nThe method is to use a max flow, which is explained in the patch in several lines.\n\nNathann\n\nAssignee: jason, ncohen, rlm\n\nCC:  jthurber\n\nResolution: fixed\n\nAuthor: Nathann Cohen, Geoffrey Ehrman\n\nReviewer: Robert Miller\n\nMerged: sage-4.6.2.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/9546\n\n",
    "closed_at": "2011-01-19T22:22:07Z",
    "created_at": "2010-07-19T05:48:54Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.2",
    "title": "bounded outdegree orientation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9546",
    "user": "https://github.com/nathanncohen"
}
```
Given a Graph and a value associating an integer b(v) to each vertex v, this method computes an orientation of G such that each vertex has out_degree at most v, if it exists. 

The method is to use a max flow, which is explained in the patch in several lines.

Nathann

Assignee: jason, ncohen, rlm

CC:  jthurber

Resolution: fixed

Author: Nathann Cohen, Geoffrey Ehrman

Reviewer: Robert Miller

Merged: sage-4.6.2.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/9546





---

archive/issue_comments_116188.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-07-19T05:49:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9546#issuecomment-116188",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_116189.json:
```json
{
    "body": "Author: Nathann Cohen",
    "created_at": "2011-01-12T03:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9546#issuecomment-116189",
    "user": "https://github.com/rlmill"
}
```

Author: Nathann Cohen



---

archive/issue_comments_116190.json:
```json
{
    "body": "<a id='comment:2'></a>\n\n```\n----------------------------------------------------------------------\n\nThe following tests failed:\n\n        sage -t -long devel/sage-main/sage/graphs/graph.py # 7 doctests failed\n----------------------------------------------------------------------\n```\n\nThese all seem to be:\n\n```\nNameError: global name 'floor' is not defined\n```",
    "created_at": "2011-01-12T03:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9546#issuecomment-116190",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:2'></a>

```
----------------------------------------------------------------------

The following tests failed:

        sage -t -long devel/sage-main/sage/graphs/graph.py # 7 doctests failed
----------------------------------------------------------------------
```

These all seem to be:

```
NameError: global name 'floor' is not defined
```



---

archive/issue_comments_116191.json:
```json
{
    "body": "Reviewer: Robert Miller",
    "created_at": "2011-01-12T03:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9546#issuecomment-116191",
    "user": "https://github.com/rlmill"
}
```

Reviewer: Robert Miller



---

archive/issue_comments_116192.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-01-12T03:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9546#issuecomment-116192",
    "user": "https://github.com/rlmill"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_028905.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2011-01-12T03:58:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9546",
    "milestone": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9546#event-28905"
}
```



---

archive/issue_comments_116193.json:
```json
{
    "body": "<a id='comment:3'></a>\nRight O_o\n\nThe error comes from the ford_fulkerson algorithm. I replaced \"floor(x)\" by \"x // 1\".\n\nI know I wrote this code myself, but when I looked at it I could only think : why on earth is our implementation of flows in Python and not Cython ? O_o\n\nUpdated ! Sorry for the trouble !\n\nNathann",
    "created_at": "2011-01-12T09:23:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9546#issuecomment-116193",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:3'></a>
Right O_o

The error comes from the ford_fulkerson algorithm. I replaced "floor(x)" by "x // 1".

I know I wrote this code myself, but when I looked at it I could only think : why on earth is our implementation of flows in Python and not Cython ? O_o

Updated ! Sorry for the trouble !

Nathann



---

archive/issue_comments_116194.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-01-12T09:23:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9546#issuecomment-116194",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_116195.json:
```json
{
    "body": "Attachment [trac_9546.patch](tarball://root/attachments/some-uuid/ticket9546/trac_9546.patch) by @nathanncohen created at 2011-01-12 09:23:37",
    "created_at": "2011-01-12T09:23:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9546#issuecomment-116195",
    "user": "https://github.com/nathanncohen"
}
```

Attachment [trac_9546.patch](tarball://root/attachments/some-uuid/ticket9546/trac_9546.patch) by @nathanncohen created at 2011-01-12 09:23:37



---

archive/issue_comments_116196.json:
```json
{
    "body": "Changing author from \"Nathann Cohen\" to \"Nathann Cohen, Geoffrey Ehrman\"",
    "created_at": "2011-01-12T23:05:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9546#issuecomment-116196",
    "user": "https://trac.sagemath.org/admin/accounts/users/gbe"
}
```

Changing author from "Nathann Cohen" to "Nathann Cohen, Geoffrey Ehrman"



---

archive/issue_comments_116197.json:
```json
{
    "body": "<a id='comment:4'></a>\nUsing floor division here might be nice, but I'm concerned about the coercion model:\n\n```\nsage: 1215.151//1\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/home/gbe/sage/dev/devel/sage-main/sage/<ipython console> in <module>()\n\n/usr/local/sage/local/lib/python2.6/site-packages/sage/rings/integer.so in sage.rings.integer.Integer.__floordiv__ (sage/rings/integer.c:11983)()\n\n/usr/local/sage/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.bin_op (sage/structure/element.c:17928)()\n\n/usr/local/sage/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.bin_op (sage/structure/element.c:17841)()\n\n/usr/local/sage/local/lib/python2.6/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6213)()\n\n/usr/local/sage/local/lib/python2.6/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6152)()\n\nTypeError: unsupported operand type(s) for //: 'sage.rings.real_mpfr.RealLiteral' and 'sage.rings.real_mpfr.RealNumber'\n```\n\nAlso, floor division doesn't seem to buy you any speedup:\n\n```\nsage: tests = [float(random()*10**randint(0,10)) for i in range(10)]\nsage: for i in tests:\n....:     timeit('floor(test)')\n\n625 loops, best of 3: 5.14 \u00b5s per loop\n625 loops, best of 3: 5.12 \u00b5s per loop\n625 loops, best of 3: 5.21 \u00b5s per loop\n625 loops, best of 3: 5.12 \u00b5s per loop\n625 loops, best of 3: 5.12 \u00b5s per loop\n625 loops, best of 3: 5.1 \u00b5s per loop\n625 loops, best of 3: 5.07 \u00b5s per loop\n625 loops, best of 3: 5.2 \u00b5s per loop\n625 loops, best of 3: 5.11 \u00b5s per loop\n625 loops, best of 3: 5.13 \u00b5s per loop\n\nsage: for i in tests:\n....:     timeit('test // 1')\n\n625 loops, best of 3: 9.33 \u00b5s per loop\n625 loops, best of 3: 9.47 \u00b5s per loop\n625 loops, best of 3: 9.4 \u00b5s per loop\n625 loops, best of 3: 9.44 \u00b5s per loop\n625 loops, best of 3: 9.4 \u00b5s per loop\n625 loops, best of 3: 9.4 \u00b5s per loop\n625 loops, best of 3: 9.35 \u00b5s per loop\n625 loops, best of 3: 9.31 \u00b5s per loop\n625 loops, best of 3: 9.3 \u00b5s per loop\n625 loops, best of 3: 9.4 \u00b5s per loop\n```\n\nAll in all I think the better solution is to just bring floor(x) into scope from functions/other.py, as I've done in the attached patch.",
    "created_at": "2011-01-12T23:05:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9546#issuecomment-116197",
    "user": "https://trac.sagemath.org/admin/accounts/users/gbe"
}
```

<a id='comment:4'></a>
Using floor division here might be nice, but I'm concerned about the coercion model:

```
sage: 1215.151//1
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/gbe/sage/dev/devel/sage-main/sage/<ipython console> in <module>()

/usr/local/sage/local/lib/python2.6/site-packages/sage/rings/integer.so in sage.rings.integer.Integer.__floordiv__ (sage/rings/integer.c:11983)()

/usr/local/sage/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.bin_op (sage/structure/element.c:17928)()

/usr/local/sage/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.bin_op (sage/structure/element.c:17841)()

/usr/local/sage/local/lib/python2.6/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6213)()

/usr/local/sage/local/lib/python2.6/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6152)()

TypeError: unsupported operand type(s) for //: 'sage.rings.real_mpfr.RealLiteral' and 'sage.rings.real_mpfr.RealNumber'
```

Also, floor division doesn't seem to buy you any speedup:

```
sage: tests = [float(random()*10**randint(0,10)) for i in range(10)]
sage: for i in tests:
....:     timeit('floor(test)')

625 loops, best of 3: 5.14 µs per loop
625 loops, best of 3: 5.12 µs per loop
625 loops, best of 3: 5.21 µs per loop
625 loops, best of 3: 5.12 µs per loop
625 loops, best of 3: 5.12 µs per loop
625 loops, best of 3: 5.1 µs per loop
625 loops, best of 3: 5.07 µs per loop
625 loops, best of 3: 5.2 µs per loop
625 loops, best of 3: 5.11 µs per loop
625 loops, best of 3: 5.13 µs per loop

sage: for i in tests:
....:     timeit('test // 1')

625 loops, best of 3: 9.33 µs per loop
625 loops, best of 3: 9.47 µs per loop
625 loops, best of 3: 9.4 µs per loop
625 loops, best of 3: 9.44 µs per loop
625 loops, best of 3: 9.4 µs per loop
625 loops, best of 3: 9.4 µs per loop
625 loops, best of 3: 9.35 µs per loop
625 loops, best of 3: 9.31 µs per loop
625 loops, best of 3: 9.3 µs per loop
625 loops, best of 3: 9.4 µs per loop
```

All in all I think the better solution is to just bring floor(x) into scope from functions/other.py, as I've done in the attached patch.



---

archive/issue_comments_116198.json:
```json
{
    "body": "<a id='comment:5'></a>\nAttachment [9546_scope_fix.patch](tarball://root/attachments/some-uuid/ticket9546/9546_scope_fix.patch) by jthurber created at 2011-01-14 21:42:19",
    "created_at": "2011-01-14T21:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9546#issuecomment-116198",
    "user": "https://trac.sagemath.org/admin/accounts/users/jthurber"
}
```

<a id='comment:5'></a>
Attachment [9546_scope_fix.patch](tarball://root/attachments/some-uuid/ticket9546/9546_scope_fix.patch) by jthurber created at 2011-01-14 21:42:19



---

archive/issue_comments_116199.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-01-14T21:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9546#issuecomment-116199",
    "user": "https://github.com/rlmill"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_116200.json:
```json
{
    "body": "<a id='comment:6'></a>\nAttachment [trac_9546-ref-edit.patch](tarball://root/attachments/some-uuid/ticket9546/trac_9546-ref-edit.patch) by @rlmill created at 2011-01-14 21:49:51\n\napply all three patches",
    "created_at": "2011-01-14T21:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9546#issuecomment-116200",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:6'></a>
Attachment [trac_9546-ref-edit.patch](tarball://root/attachments/some-uuid/ticket9546/trac_9546-ref-edit.patch) by @rlmill created at 2011-01-14 21:49:51

apply all three patches



---

archive/issue_comments_116201.json:
```json
{
    "body": "Merged: sage-4.6.2.alpha1",
    "created_at": "2011-01-19T22:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9546#issuecomment-116201",
    "user": "https://github.com/jdemeyer"
}
```

Merged: sage-4.6.2.alpha1



---

archive/issue_comments_116202.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-01-19T22:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9546#issuecomment-116202",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_028906.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-19T22:22:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9546",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9546#event-28906"
}
```
