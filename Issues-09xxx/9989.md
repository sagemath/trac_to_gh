# Issue 9989: easier access to operands of a symbolic expression

archive/issues_009988.json:
```json
{
    "body": "Attached patch adds an `op` attribute to symbolic expressions which gives easy access to its operands. We now have:\n\n```\nsage: x,y,z = var('x,y,z')\nsage: e = x + x*y + z^y + 3*y*z; e\nx*y + 3*y*z + z^y + x\nsage: e.op[1]\n3*y*z\nsage: e.op[1,1]\nz\nsage: e.op[-1]\nx\nsage: e.op[1:]\n[3*y*z, z^y, x]\n```\n\nUsing `__getitem__()` directly was not an option since it breaks conversion to numpy.\n\n\nApply [attachment:trac_9989-operands.take4.patch]\n\n**Assignee:** @burcin\n\n**CC:**  jpflori\n\n**Keywords:** sd31\n\n**Resolution:** fixed\n\n**Author:** Burcin Erocal\n\n**Reviewer:** Robert Bradshaw, Karl-Dieter Crisman, Volker Braun\n\n**Merged:** sage-4.7.1.alpha4\n\nIssue created by migration from https://trac.sagemath.org/ticket/9989\n\n",
    "closed_at": "2011-06-15T15:23:46Z",
    "created_at": "2010-09-23T22:07:51Z",
    "labels": [
        "component: symbolics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.1",
    "title": "easier access to operands of a symbolic expression",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9989",
    "user": "https://github.com/burcin"
}
```
Attached patch adds an `op` attribute to symbolic expressions which gives easy access to its operands. We now have:

```
sage: x,y,z = var('x,y,z')
sage: e = x + x*y + z^y + 3*y*z; e
x*y + 3*y*z + z^y + x
sage: e.op[1]
3*y*z
sage: e.op[1,1]
z
sage: e.op[-1]
x
sage: e.op[1:]
[3*y*z, z^y, x]
```

Using `__getitem__()` directly was not an option since it breaks conversion to numpy.


Apply [attachment:trac_9989-operands.take4.patch]

**Assignee:** @burcin

**CC:**  jpflori

**Keywords:** sd31

**Resolution:** fixed

**Author:** Burcin Erocal

**Reviewer:** Robert Bradshaw, Karl-Dieter Crisman, Volker Braun

**Merged:** sage-4.7.1.alpha4

Issue created by migration from https://trac.sagemath.org/ticket/9989





---

archive/issue_comments_126455.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2010-09-23T22:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126455",
    "user": "https://github.com/burcin"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_126456.json:
```json
{
    "body": "<a id='comment:1'></a>\nAttachment [trac_9989-operands.patch](tarball://root/attachments/some-uuid/ticket9989/trac_9989-operands.patch) by @burcin created at 2010-09-23 22:09:59",
    "created_at": "2010-09-23T22:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126456",
    "user": "https://github.com/burcin"
}
```

<a id='comment:1'></a>
Attachment [trac_9989-operands.patch](tarball://root/attachments/some-uuid/ticket9989/trac_9989-operands.patch) by @burcin created at 2010-09-23 22:09:59



---

archive/issue_comments_126457.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis looks like a good addition, after many sage-support queries - great!    I hope to be able to review this eventually, though it will take some time because I am not a Cython expert and would want to be very careful.\n\nWhat is the `property` thing in Python/Cython?  I haven't heard of that before (as opposed to `def` or `cdef` or `class`).\n\nDoes this depend at all on any of the Pynac 0.2.1 tickets' patches?",
    "created_at": "2010-09-24T14:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126457",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:2'></a>
This looks like a good addition, after many sage-support queries - great!    I hope to be able to review this eventually, though it will take some time because I am not a Cython expert and would want to be very careful.

What is the `property` thing in Python/Cython?  I haven't heard of that before (as opposed to `def` or `cdef` or `class`).

Does this depend at all on any of the Pynac 0.2.1 tickets' patches?



---

archive/issue_comments_126458.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [kcrisman](#comment%3A2):\n> What is the `property` thing in Python/Cython?  I haven't heard of that before (as opposed to `def` or `cdef` or `class`).\n\n\nI also found out about it while looking through the Sage library code for a way to make `numpy` work when I define `__getitem__()`:\n\nhttp://docs.cython.org/src/userguide/extension_types.html#properties\n\nThe function defined by `__get__()` is run when you access that property. This makes the syntax look much cleaner. You don't need to put `()` at the end any more, compared to the syntax needed for `.operands()`.\n \n> Does this depend at all on any of the Pynac 0.2.1 tickets' patches?\n\n\nNo, it should be independent. Though I admit that there are a bunch of symbolics patches before this on my queue.",
    "created_at": "2010-09-24T15:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126458",
    "user": "https://github.com/burcin"
}
```

<a id='comment:3'></a>
Replying to [kcrisman](#comment%3A2):
> What is the `property` thing in Python/Cython?  I haven't heard of that before (as opposed to `def` or `cdef` or `class`).


I also found out about it while looking through the Sage library code for a way to make `numpy` work when I define `__getitem__()`:

http://docs.cython.org/src/userguide/extension_types.html#properties

The function defined by `__get__()` is run when you access that property. This makes the syntax look much cleaner. You don't need to put `()` at the end any more, compared to the syntax needed for `.operands()`.
 
> Does this depend at all on any of the Pynac 0.2.1 tickets' patches?


No, it should be independent. Though I admit that there are a bunch of symbolics patches before this on my queue.



---

archive/issue_comments_126459.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2010-12-16T16:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126459",
    "user": "https://github.com/robertwb"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_126460.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe error \"TypeError: cannot index numeric, constant or symbol\" is rather obscure, better to make it something like \"... has no operands.\"\n\nAny reason why expr.op isn't just a plain list?",
    "created_at": "2010-12-16T16:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126460",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:5'></a>
The error "TypeError: cannot index numeric, constant or symbol" is rather obscure, better to make it something like "... has no operands."

Any reason why expr.op isn't just a plain list?



---

archive/issue_comments_126461.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -15,3 +15,6 @@\n ```\n \n Using `__getitem__()` directly was not an option since it breaks conversion to numpy.\n+\n+\n+Apply trac_9989-operands.take2.patch\n``````\n",
    "created_at": "2011-03-23T11:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126461",
    "user": "https://github.com/burcin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -15,3 +15,6 @@
 ```
 
 Using `__getitem__()` directly was not an option since it breaks conversion to numpy.
+
+
+Apply trac_9989-operands.take2.patch
``````




---

archive/issue_comments_126462.json:
```json
{
    "body": "**Reviewer:** Robert Bradshaw",
    "created_at": "2011-03-23T11:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126462",
    "user": "https://github.com/burcin"
}
```

**Reviewer:** Robert Bradshaw



---

archive/issue_comments_126463.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2011-03-23T11:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126463",
    "user": "https://github.com/burcin"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_126464.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [robertwb](#comment%3A5):\n> The error \"TypeError: cannot index numeric, constant or symbol\" is rather obscure, better to make it something like \"... has no operands.\"\n\n\nDone. The new message is: \"expressions containing only a numeric coefficient, constant or symbol have no operands\"\n\n> Any reason why expr.op isn't just a plain list?\n\n\nI wanted to avoid traversing the vector storing the operands and creating a python object for each. A list wouldn't allow nested indexing either:\n\n```\nsage: x,y,z = var('x,y,z')\nsage: e = x + x*y + z^y + 3*y*z; e\nx*y + 3*y*z + z^y + x\nsage: e.op[1]\n3*y*z\nsage: e.op[1,1]\nz\n```\n\nThis syntax was proposed in a discussion at Sage days 24 last summer.\n\n\nApply trac_9989-operands.take2.patch",
    "created_at": "2011-03-23T11:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126464",
    "user": "https://github.com/burcin"
}
```

<a id='comment:6'></a>
Replying to [robertwb](#comment%3A5):
> The error "TypeError: cannot index numeric, constant or symbol" is rather obscure, better to make it something like "... has no operands."


Done. The new message is: "expressions containing only a numeric coefficient, constant or symbol have no operands"

> Any reason why expr.op isn't just a plain list?


I wanted to avoid traversing the vector storing the operands and creating a python object for each. A list wouldn't allow nested indexing either:

```
sage: x,y,z = var('x,y,z')
sage: e = x + x*y + z^y + 3*y*z; e
x*y + 3*y*z + z^y + x
sage: e.op[1]
3*y*z
sage: e.op[1,1]
z
```

This syntax was proposed in a discussion at Sage days 24 last summer.


Apply trac_9989-operands.take2.patch



---

archive/issue_comments_126465.json:
```json
{
    "body": "**Changing status** from needs_review to needs_info.",
    "created_at": "2011-03-23T11:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126465",
    "user": "https://github.com/kcrisman"
}
```

**Changing status** from needs_review to needs_info.



---

archive/issue_comments_126466.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [burcin](#comment%3A6):\n> Replying to [robertwb](#comment%3A5):\n> > The error \"TypeError: cannot index numeric, constant or symbol\" is rather obscure, better to make it something like \"... has no operands.\"\n\n> \n> Done. The new message is: \"expressions containing only a numeric coefficient, constant or symbol have no operands\"\n> \n  \nI think that the part in expression.pyx still has this syntax, and I agree that it is confusing.  Putting 'needs info' just in case that is intentional.",
    "created_at": "2011-03-23T11:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126466",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:7'></a>
Replying to [burcin](#comment%3A6):
> Replying to [robertwb](#comment%3A5):
> > The error "TypeError: cannot index numeric, constant or symbol" is rather obscure, better to make it something like "... has no operands."

> 
> Done. The new message is: "expressions containing only a numeric coefficient, constant or symbol have no operands"
> 
  
I think that the part in expression.pyx still has this syntax, and I agree that it is confusing.  Putting 'needs info' just in case that is intentional.



---

archive/issue_comments_126467.json:
```json
{
    "body": "Attachment [trac_9989-operands.take2.patch](tarball://root/attachments/some-uuid/ticket9989/trac_9989-operands.take2.patch) by @burcin created at 2011-03-23 12:05:07",
    "created_at": "2011-03-23T12:05:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126467",
    "user": "https://github.com/burcin"
}
```

Attachment [trac_9989-operands.take2.patch](tarball://root/attachments/some-uuid/ticket9989/trac_9989-operands.take2.patch) by @burcin created at 2011-03-23 12:05:07



---

archive/issue_comments_126468.json:
```json
{
    "body": "**Changing status** from needs_info to needs_review.",
    "created_at": "2011-03-23T12:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126468",
    "user": "https://github.com/burcin"
}
```

**Changing status** from needs_info to needs_review.



---

archive/issue_comments_126469.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [kcrisman](#comment%3A7):\n> Replying to [burcin](#comment%3A6):\n> > Replying to [robertwb](#comment%3A5):\n> > > The error \"TypeError: cannot index numeric, constant or symbol\" is rather obscure, better to make it something like \"... has no operands.\"\n\n> > \n> > Done. The new message is: \"expressions containing only a numeric coefficient, constant or symbol have no operands\"\n> > \n  \n> I think that the part in expression.pyx still has this syntax, and I agree that it is confusing.  Putting 'needs info' just in case that is intentional.\n\nGood catch! I forgot to change that message. Updated patch attached, with same name.",
    "created_at": "2011-03-23T12:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126469",
    "user": "https://github.com/burcin"
}
```

<a id='comment:8'></a>
Replying to [kcrisman](#comment%3A7):
> Replying to [burcin](#comment%3A6):
> > Replying to [robertwb](#comment%3A5):
> > > The error "TypeError: cannot index numeric, constant or symbol" is rather obscure, better to make it something like "... has no operands."

> > 
> > Done. The new message is: "expressions containing only a numeric coefficient, constant or symbol have no operands"
> > 
  
> I think that the part in expression.pyx still has this syntax, and I agree that it is confusing.  Putting 'needs info' just in case that is intentional.

Good catch! I forgot to change that message. Updated patch attached, with same name.



---

archive/issue_comments_126470.json:
```json
{
    "body": "<a id='comment:9'></a>\nIs the `normalize_index()` business needed because cdef'd things don't accept appropriate negative indices or something?  I get what it does, I don't get why it's necessary.  Maybe because of the potential for multiple indices to get suboperands?\n\nSlowly working my way through it... Cython not being my forte... but looks good so far.",
    "created_at": "2011-03-23T12:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126470",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'></a>
Is the `normalize_index()` business needed because cdef'd things don't accept appropriate negative indices or something?  I get what it does, I don't get why it's necessary.  Maybe because of the potential for multiple indices to get suboperands?

Slowly working my way through it... Cython not being my forte... but looks good so far.



---

archive/issue_comments_126471.json:
```json
{
    "body": "**Changing reviewer** from \"Robert Bradshaw\" to \"Robert Bradshaw, Karl-DIeter Crisman\".",
    "created_at": "2011-03-23T12:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126471",
    "user": "https://github.com/kcrisman"
}
```

**Changing reviewer** from "Robert Bradshaw" to "Robert Bradshaw, Karl-DIeter Crisman".



---

archive/issue_comments_126472.json:
```json
{
    "body": "<a id='comment:10'></a>\nThere is no doctest for\n\n```\nind_err_msg = \"index should either be a slice object, an integer or a list of integers\"\n```\nAnd you might as well just use `ind_err_msg` in line 139 instead of typing it again.",
    "created_at": "2011-03-23T12:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126472",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:10'></a>
There is no doctest for

```
ind_err_msg = "index should either be a slice object, an integer or a list of integers"
```
And you might as well just use `ind_err_msg` in line 139 instead of typing it again.



---

archive/issue_comments_126473.json:
```json
{
    "body": "<a id='comment:11'></a>\nSo far looks good - thanks to [a little help](http://stackoverflow.com/questions/2936863/python-implementing-slicing-in-getitem) and [the Ginac refs](http://www.ginac.de/tutorial/Information-about-expressions.html).  \n\nQuestions, though.\n* Regarding the error message:\n\n```\nsage: f = 3*x^2+2*sin(x)-32*sin(ln(x))\nsage: f.op[3]\n---------------------------------------------------------------------------\nIndexError                                Traceback (most recent call last)\nIndexError: operand index out of range, got 3, expect between -3 and 3\n```\n   Is this really the error message we want?  Here it's the 'exclusive' between, but that could be confusing.  Maybe it should say between -3 and 2 (length ops -1)?  \n\n* Next, I wonder whether the following can be supported:\n\n```\nsage: f.op[2:3,3]\nTypeError: an integer is required\n```\n   since matrices can do this\n\n```\nsage: M = matrix(4,range(16))\nsage: M[2:3]\n[ 8  9 10 11]\nsage: M[2:3,3]\n[11]\n```\n   The current code ends everything if it's a slice; you just get the operands at that level.  But it would be interesting to get the 2nd element of each operand, though perhaps not very useful since you might not know what it is ahead of time.  But perhaps for very regular expressions (Christoffel symbol-type surfeit of indices?) it could be useful.  We might also want something like `sage: M[2:3,3:4]` to be supported, such as `sage: f.op[2,0:1]` instead of having to do \n\n```\nsage: f.op[2].op[0:1]\n[sin(log(x))]\n```\n   But maybe going back and forth between Ginac and Sage in the way you'd have to for that is tricky.\n* Here is something needed for sure:\n\n```\nsage: f = 3*x^2+2*sin(x)-32*sin(ln(x))\nsage: f[1]\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\nTypeError: 'sage.symbolic.expression.Expression' object does not support indexing\nsage: search_src('does not support indexing')\n<no response>\n```\n   We should have at least one doctest *somewhere* that tests this.\n\nBut overall the code is correct for the promised functionality and passes its tests, documented pretty well *if* you know enough about !GEx etc.  So I would say good work, needs work for the last item above and probably the first, and needs info for the second item (matrix-style slices).",
    "created_at": "2011-03-23T15:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126473",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:11'></a>
So far looks good - thanks to [a little help](http://stackoverflow.com/questions/2936863/python-implementing-slicing-in-getitem) and [the Ginac refs](http://www.ginac.de/tutorial/Information-about-expressions.html).  

Questions, though.
* Regarding the error message:

```
sage: f = 3*x^2+2*sin(x)-32*sin(ln(x))
sage: f.op[3]
---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)
IndexError: operand index out of range, got 3, expect between -3 and 3
```
   Is this really the error message we want?  Here it's the 'exclusive' between, but that could be confusing.  Maybe it should say between -3 and 2 (length ops -1)?  

* Next, I wonder whether the following can be supported:

```
sage: f.op[2:3,3]
TypeError: an integer is required
```
   since matrices can do this

```
sage: M = matrix(4,range(16))
sage: M[2:3]
[ 8  9 10 11]
sage: M[2:3,3]
[11]
```
   The current code ends everything if it's a slice; you just get the operands at that level.  But it would be interesting to get the 2nd element of each operand, though perhaps not very useful since you might not know what it is ahead of time.  But perhaps for very regular expressions (Christoffel symbol-type surfeit of indices?) it could be useful.  We might also want something like `sage: M[2:3,3:4]` to be supported, such as `sage: f.op[2,0:1]` instead of having to do 

```
sage: f.op[2].op[0:1]
[sin(log(x))]
```
   But maybe going back and forth between Ginac and Sage in the way you'd have to for that is tricky.
* Here is something needed for sure:

```
sage: f = 3*x^2+2*sin(x)-32*sin(ln(x))
sage: f[1]
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
TypeError: 'sage.symbolic.expression.Expression' object does not support indexing
sage: search_src('does not support indexing')
<no response>
```
   We should have at least one doctest *somewhere* that tests this.

But overall the code is correct for the promised functionality and passes its tests, documented pretty well *if* you know enough about !GEx etc.  So I would say good work, needs work for the last item above and probably the first, and needs info for the second item (matrix-style slices).



---

archive/issue_comments_126474.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2011-03-23T15:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126474",
    "user": "https://github.com/kcrisman"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_126475.json:
```json
{
    "body": "**Changing reviewer** from \"Robert Bradshaw, Karl-DIeter Crisman\" to \"Robert Bradshaw, Karl-Dieter Crisman\".",
    "created_at": "2011-05-31T13:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126475",
    "user": "https://github.com/burcin"
}
```

**Changing reviewer** from "Robert Bradshaw, Karl-DIeter Crisman" to "Robert Bradshaw, Karl-Dieter Crisman".



---

archive/issue_comments_126476.json:
```json
{
    "body": "<a id='comment:12'></a>\nThank you for the thorough reviews. I appreciate the feedback and it's certainly good for someone to look over my changes, since there are often rough edges I fail to see after staring at the code for a while.\n\nReplying to [kcrisman](#comment%3A11):\n\n> Questions, though.\n> * Regarding the error message:\n> \n> ```\n> sage: f = 3*x^2+2*sin(x)-32*sin(ln(x))\n> sage: f.op[3]\n> ---------------------------------------------------------------------------\n> IndexError                                Traceback (most recent call last)\n> IndexError: operand index out of range, got 3, expect between -3 and 3\n> ```\n>    Is this really the error message we want?  Here it's the 'exclusive' between, but that could be confusing.  Maybe it should say between -3 and 2 (length ops -1)?  \n\n\nFixed.\n\n>  * Next, I wonder whether the following can be supported:\n \n> {{{\n> sage: f.op[2:3,3]\n> TypeError: an integer is required\n> }}}\n>    since matrices can do this\n> \n> ```\n> sage: M = matrix(4,range(16))\n> sage: M[2:3]\n> [ 8  9 10 11]\n> sage: M[2:3,3]\n> [11]\n> ```\n>    The current code ends everything if it's a slice; you just get the operands at that level.  But it would be interesting to get the 2nd element of each operand, though perhaps not very useful since you might not know what it is ahead of time.  But perhaps for very regular expressions (Christoffel symbol-type surfeit of indices?) it could be useful.  We might also want something like `sage: M[2:3,3:4]` to be supported, such as `sage: f.op[2,0:1]` instead of having to do \n> \n> ```\n> sage: f.op[2].op[0:1]\n> [sin(log(x))]\n> ```\n>    But maybe going back and forth between Ginac and Sage in the way you'd have to for that is tricky.\n\n\nThe output is a list if the index is a slice. We could pass further indices to the list's `__getitem__()` of course, though I'm not convinced this convenience is really a good feature.\n\n>  * Here is something needed for sure:\n \n> {{{\n> sage: f = 3*x^2+2*sin(x)-32*sin(ln(x))\n> sage: f[1]\n> \n> ---\n> TypeError                                 Traceback (most recent call last)\n> TypeError: 'sage.symbolic.expression.Expression' object does not support indexing\n> sage: search_src('does not support indexing')\n> <no response>\n> }}}\n>    We should have at least one doctest *somewhere* that tests this.\n\n\nI added a test in the docstring for `__get__` in `expression.pyx`.\n\n\nFor patchbot:\n\nApply trac_9989-operands.take3.patch",
    "created_at": "2011-05-31T13:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126476",
    "user": "https://github.com/burcin"
}
```

<a id='comment:12'></a>
Thank you for the thorough reviews. I appreciate the feedback and it's certainly good for someone to look over my changes, since there are often rough edges I fail to see after staring at the code for a while.

Replying to [kcrisman](#comment%3A11):

> Questions, though.
> * Regarding the error message:
> 
> ```
> sage: f = 3*x^2+2*sin(x)-32*sin(ln(x))
> sage: f.op[3]
> ---------------------------------------------------------------------------
> IndexError                                Traceback (most recent call last)
> IndexError: operand index out of range, got 3, expect between -3 and 3
> ```
>    Is this really the error message we want?  Here it's the 'exclusive' between, but that could be confusing.  Maybe it should say between -3 and 2 (length ops -1)?  


Fixed.

>  * Next, I wonder whether the following can be supported:
 
> {{{
> sage: f.op[2:3,3]
> TypeError: an integer is required
> }}}
>    since matrices can do this
> 
> ```
> sage: M = matrix(4,range(16))
> sage: M[2:3]
> [ 8  9 10 11]
> sage: M[2:3,3]
> [11]
> ```
>    The current code ends everything if it's a slice; you just get the operands at that level.  But it would be interesting to get the 2nd element of each operand, though perhaps not very useful since you might not know what it is ahead of time.  But perhaps for very regular expressions (Christoffel symbol-type surfeit of indices?) it could be useful.  We might also want something like `sage: M[2:3,3:4]` to be supported, such as `sage: f.op[2,0:1]` instead of having to do 
> 
> ```
> sage: f.op[2].op[0:1]
> [sin(log(x))]
> ```
>    But maybe going back and forth between Ginac and Sage in the way you'd have to for that is tricky.


The output is a list if the index is a slice. We could pass further indices to the list's `__getitem__()` of course, though I'm not convinced this convenience is really a good feature.

>  * Here is something needed for sure:
 
> {{{
> sage: f = 3*x^2+2*sin(x)-32*sin(ln(x))
> sage: f[1]
> 
> ---
> TypeError                                 Traceback (most recent call last)
> TypeError: 'sage.symbolic.expression.Expression' object does not support indexing
> sage: search_src('does not support indexing')
> <no response>
> }}}
>    We should have at least one doctest *somewhere* that tests this.


I added a test in the docstring for `__get__` in `expression.pyx`.


For patchbot:

Apply trac_9989-operands.take3.patch



---

archive/issue_comments_126477.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2011-05-31T13:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126477",
    "user": "https://github.com/burcin"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_126478.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2011-06-08T20:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126478",
    "user": "https://github.com/kcrisman"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_126479.json:
```json
{
    "body": "<a id='comment:13'></a>\nAttachment [trac_9989-operands.take3.patch](tarball://root/attachments/some-uuid/ticket9989/trac_9989-operands.take3.patch) by @kcrisman created at 2011-06-08 20:28:19\n\n\n```\nHunk #2 succeeded at 2476 with fuzz 1 (offset -32 lines).\n```\n\nI certainly don't have time to reread this whole patch again, so *assuming* that the only changes are the ones mentioned, then tests pass, changes are good, explanation of second point is sufficient, good to go.",
    "created_at": "2011-06-08T20:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126479",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:13'></a>
Attachment [trac_9989-operands.take3.patch](tarball://root/attachments/some-uuid/ticket9989/trac_9989-operands.take3.patch) by @kcrisman created at 2011-06-08 20:28:19


```
Hunk #2 succeeded at 2476 with fuzz 1 (offset -32 lines).
```

I certainly don't have time to reread this whole patch again, so *assuming* that the only changes are the ones mentioned, then tests pass, changes are good, explanation of second point is sufficient, good to go.



---

archive/issue_comments_126480.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -17,4 +17,4 @@\n Using `__getitem__()` directly was not an option since it breaks conversion to numpy.\n \n \n-Apply trac_9989-operands.take2.patch\n+Apply [attachment:trac_9989-operands.take3.patch]\n``````\n",
    "created_at": "2011-06-10T08:48:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126480",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -17,4 +17,4 @@
 Using `__getitem__()` directly was not an option since it breaks conversion to numpy.
 
 
-Apply trac_9989-operands.take2.patch
+Apply [attachment:trac_9989-operands.take3.patch]
``````




---

archive/issue_comments_126481.json:
```json
{
    "body": "<a id='comment:15'></a>\n*cringe* I am ready to write some documentation if that gets people to use SAGE_LOCAL and SAGE_INC and all the other variables defined in module_list.py\n\n```\nnumpy_depends = [SAGE_LOCAL + '/lib/python/site-packages/numpy/core/include/numpy/_numpyconfig.h']\n\nflint_depends = [SAGE_LOCAL + '/include/FLINT/flint.h']\nsingular_depends = [SAGE_LOCAL + '/include/libsingular.h']\nginac_depends = [SAGE_LOCAL + '/include/pynac/ginac.h']\n```\n rather than \n\n```\nSAGE_ROOT + \"/local/include/pynac/ginac.h\"\n```\nand other combinations of SAGE_ROOT + \"/local...\"",
    "created_at": "2011-06-12T23:17:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126481",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>
*cringe* I am ready to write some documentation if that gets people to use SAGE_LOCAL and SAGE_INC and all the other variables defined in module_list.py

```
numpy_depends = [SAGE_LOCAL + '/lib/python/site-packages/numpy/core/include/numpy/_numpyconfig.h']

flint_depends = [SAGE_LOCAL + '/include/FLINT/flint.h']
singular_depends = [SAGE_LOCAL + '/include/libsingular.h']
ginac_depends = [SAGE_LOCAL + '/include/pynac/ginac.h']
```
 rather than 

```
SAGE_ROOT + "/local/include/pynac/ginac.h"
```
and other combinations of SAGE_ROOT + "/local..."



---

archive/issue_comments_126482.json:
```json
{
    "body": "<a id='comment:16'></a>\nGood catch. Thanks, Francois.\n\nI uploaded a new patch that just changes `module_list.py` to use `SAGE_LOCAL` instead of `SAGE_ROOT`.\n\nFrancois, why don't you open a ticket to rename `SAGE_ROOT` in `module_list.py` to something like `SAGE_ROOT_DO_NOT_USE` with a comment above it to point out why `SAGE_LOCAL` is better.",
    "created_at": "2011-06-13T17:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126482",
    "user": "https://github.com/burcin"
}
```

<a id='comment:16'></a>
Good catch. Thanks, Francois.

I uploaded a new patch that just changes `module_list.py` to use `SAGE_LOCAL` instead of `SAGE_ROOT`.

Francois, why don't you open a ticket to rename `SAGE_ROOT` in `module_list.py` to something like `SAGE_ROOT_DO_NOT_USE` with a comment above it to point out why `SAGE_LOCAL` is better.



---

archive/issue_comments_126483.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -17,4 +17,4 @@\n Using `__getitem__()` directly was not an option since it breaks conversion to numpy.\n \n \n-Apply [attachment:trac_9989-operands.take3.patch]\n+Apply [attachment:trac_9989-operands.take4.patch]\n``````\n",
    "created_at": "2011-06-13T17:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126483",
    "user": "https://github.com/burcin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -17,4 +17,4 @@
 Using `__getitem__()` directly was not an option since it breaks conversion to numpy.
 
 
-Apply [attachment:trac_9989-operands.take3.patch]
+Apply [attachment:trac_9989-operands.take4.patch]
``````




---

archive/issue_comments_126484.json:
```json
{
    "body": "<a id='comment:17'></a>\nActually you could have used the ginac_depends variable. But your suggestion is good I can make it a part of #11377. I think I may try to write a little bit about these variables in the manual.",
    "created_at": "2011-06-13T19:04:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126484",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>
Actually you could have used the ginac_depends variable. But your suggestion is good I can make it a part of #11377. I think I may try to write a little bit about these variables in the manual.



---

archive/issue_comments_126485.json:
```json
{
    "body": "<a id='comment:18'></a>\nAttachment [trac_9989-operands.take4.patch](tarball://root/attachments/some-uuid/ticket9989/trac_9989-operands.take4.patch) by @burcin created at 2011-06-14 00:15:44\n\nApply trac_9989-operands.take4.patch",
    "created_at": "2011-06-14T00:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126485",
    "user": "https://github.com/burcin"
}
```

<a id='comment:18'></a>
Attachment [trac_9989-operands.take4.patch](tarball://root/attachments/some-uuid/ticket9989/trac_9989-operands.take4.patch) by @burcin created at 2011-06-14 00:15:44

Apply trac_9989-operands.take4.patch



---

archive/issue_comments_126486.json:
```json
{
    "body": "**Changing reviewer** from \"Robert Bradshaw, Karl-Dieter Crisman\" to \"Robert Bradshaw, Karl-Dieter Crisman, Volker Braun\".",
    "created_at": "2011-06-14T00:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126486",
    "user": "https://github.com/vbraun"
}
```

**Changing reviewer** from "Robert Bradshaw, Karl-Dieter Crisman" to "Robert Bradshaw, Karl-Dieter Crisman, Volker Braun".



---

archive/issue_comments_126487.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sd31\".",
    "created_at": "2011-06-14T00:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126487",
    "user": "https://github.com/vbraun"
}
```

**Changing keywords** from "" to "sd31".



---

archive/issue_comments_126488.json:
```json
{
    "body": "<a id='comment:19'></a>\nBy private communication, I asked Burcin to change the `_repr_()` of the operand wrapper to just `Operands of x^2`. I think its looks great now.",
    "created_at": "2011-06-14T00:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126488",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>
By private communication, I asked Burcin to change the `_repr_()` of the operand wrapper to just `Operands of x^2`. I think its looks great now.



---

archive/issue_comments_126489.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2011-06-14T17:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126489",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_126490.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2011-06-14T17:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126490",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_126491.json:
```json
{
    "body": "<a id='comment:21'></a>\nSomebody should review the new patch... (I am not sure whether Volker's comment \"I think its looks great now.\" means a formal positive_review)",
    "created_at": "2011-06-14T17:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126491",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
Somebody should review the new patch... (I am not sure whether Volker's comment "I think its looks great now." means a formal positive_review)



---

archive/issue_comments_126492.json:
```json
{
    "body": "<a id='comment:22'></a>\nYes, positive review!",
    "created_at": "2011-06-14T17:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126492",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>
Yes, positive review!



---

archive/issue_comments_126493.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2011-06-14T17:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126493",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_030563.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-15T15:23:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9989#event-30563"
}
```



---

archive/issue_comments_126494.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2011-06-15T15:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126494",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed



---

archive/issue_comments_126495.json:
```json
{
    "body": "**Merged:** sage-4.7.1.alpha4",
    "created_at": "2011-06-15T15:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9989#issuecomment-126495",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.7.1.alpha4
