# Issue 9521: Cliquer: Move test commands from spkg-install to spkg-check

archive/issues_009521.json:
```json
{
    "body": "From Cliquer's `spkg-install`:\n\n```sh\nif [ \"$SAGE_CHECK\" = \"yes\" ]; then\n    echo \"Compiling and running the test cases of cliquer...\"\n\n    make testcases\n    if [ $? -ne 0 ]; then\n        echo \"Failed to compile test cases of cliquer... exiting\"\n        exit 1\n    fi\n\n    ./testcases\n    if [ $? -ne 0 ]; then\n        echo \"Failed to run test cases of cliquer... exiting\"\n        exit 1\n    fi\nfi\n```\nWe can move this code (or most of it) to a new `spkg-check`.\n\nSince `SAGE_LOCAL/bin/sage-spkg` contains\n\n```sh\n    cd $BASEDIR\n    if [ \"$SAGE_CHECK\" != \"\" -a -f spkg-check ]; then\n        echo \"Running the test suite.\"\n        chmod +x spkg-check\n        ./spkg-check\n        if [ $? -ne 0 ]; then\n```\nwe don't need to check `SAGE_CHECK` in `spkg-install`.\n\nAssignee: tbd\n\nCC:  @nathanncohen @nexttime\n\nReviewer: Jeroen Demeyer\n\nResolution: duplicate\n\nIssue created by migration from https://trac.sagemath.org/ticket/9521\n\n",
    "closed_at": "2014-01-21T14:28:44Z",
    "created_at": "2010-07-17T01:00:09Z",
    "labels": [
        "component: packages: standard",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Cliquer: Move test commands from spkg-install to spkg-check",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9521",
    "user": "https://github.com/qed777"
}
```
From Cliquer's `spkg-install`:

```sh
if [ "$SAGE_CHECK" = "yes" ]; then
    echo "Compiling and running the test cases of cliquer..."

    make testcases
    if [ $? -ne 0 ]; then
        echo "Failed to compile test cases of cliquer... exiting"
        exit 1
    fi

    ./testcases
    if [ $? -ne 0 ]; then
        echo "Failed to run test cases of cliquer... exiting"
        exit 1
    fi
fi
```
We can move this code (or most of it) to a new `spkg-check`.

Since `SAGE_LOCAL/bin/sage-spkg` contains

```sh
    cd $BASEDIR
    if [ "$SAGE_CHECK" != "" -a -f spkg-check ]; then
        echo "Running the test suite."
        chmod +x spkg-check
        ./spkg-check
        if [ $? -ne 0 ]; then
```
we don't need to check `SAGE_CHECK` in `spkg-install`.

Assignee: tbd

CC:  @nathanncohen @nexttime

Reviewer: Jeroen Demeyer

Resolution: duplicate

Issue created by migration from https://trac.sagemath.org/ticket/9521





---

archive/issue_comments_109321.json:
```json
{
    "body": "<a id='comment:1'></a>See \n\nhttp://groups.google.com/group/sage-devel/browse_thread/thread/88102b4c4eadbba7/0100c924f44cf18c?hl=en\n\nI think in this case, it is better to run the test code in `spkg-install` on every build, as it takes takes very little time - about 5 seconds to do so on my machine. As such, I suggest we \n\n* Remove the code that actually checks for SAGE_CHECK in spkg-install. \n* Run the tests all the time. \n* Make spkg-check just return 0 - there's not much point running it twice. \n\nOne issue here is that `make` exits with 0, even if the test suite fails. I found this after purposely inducing some failures. It makes me wonder how many other test suites do this too! \n\nSee also #9767 and some comments from myself and Leif. \n\nDave",
    "created_at": "2010-09-04T07:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9521#issuecomment-109321",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:1'></a>See 

http://groups.google.com/group/sage-devel/browse_thread/thread/88102b4c4eadbba7/0100c924f44cf18c?hl=en

I think in this case, it is better to run the test code in `spkg-install` on every build, as it takes takes very little time - about 5 seconds to do so on my machine. As such, I suggest we 

* Remove the code that actually checks for SAGE_CHECK in spkg-install. 
* Run the tests all the time. 
* Make spkg-check just return 0 - there's not much point running it twice. 

One issue here is that `make` exits with 0, even if the test suite fails. I found this after purposely inducing some failures. It makes me wonder how many other test suites do this too! 

See also #9767 and some comments from myself and Leif. 

Dave



---

archive/issue_comments_109322.json:
```json
{
    "body": "<a id='comment:2'></a>I've closed #9767 as a duplicate of this one. I've cc'ed Leif, who commented on #9767 and Nathann as the package maintainer. \n\nI need to respond to Leif's comment on #9767 though: \n\n**Dave, be warned: You'll hate me if I should review this (`spkg-install`, `patches/Makefile`).**\n\nI think Leif has unreasonable expectations some times - in particular #9603, (an iconv change), has resulted in a large number of changes, which all took time, which could have been better spent addressing other more serious issues in Sage. The number of changes Leif requested on #9603 was excessive I feel. Six weeks after the ticket was created to just add \n\n`&& [ \"x$UNAME\" != xHP-UX ]` \n\nit is still awaiting a positive review. \n\nI'm not denying the changes Leif requested on #9603 has improved the iconv package - though I think it was one of the better packages to start with. I do however think the time spent on it could have been put to more productive use. \n\nIf tickets to add a very small change are going to result in weeks of iterations, then the changes are not going to be made - at least not by me. \n\nI am happy to attempt to clean up Cliquer, but on the understanding it does not become like #9603. I've no desire to spend so much time on endless small changes. \n\nThe only changes I would make to `patches/Makefile` are Solaris-specific, as the compiler flags are wrong. (Oh, and I might add the necessary change to package so it builds on HP-UX, where shared libraries are .sl and not .so.) But I have no intension of re-writing the whole of the Makefile. \n\nThere's a lot of unnecessary things in `spkg-install` and I'm happy to remove them, but I'm not willing to spend weeks on it. \n\nDave",
    "created_at": "2010-09-04T08:27:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9521#issuecomment-109322",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:2'></a>I've closed #9767 as a duplicate of this one. I've cc'ed Leif, who commented on #9767 and Nathann as the package maintainer. 

I need to respond to Leif's comment on #9767 though: 

**Dave, be warned: You'll hate me if I should review this (`spkg-install`, `patches/Makefile`).**

I think Leif has unreasonable expectations some times - in particular #9603, (an iconv change), has resulted in a large number of changes, which all took time, which could have been better spent addressing other more serious issues in Sage. The number of changes Leif requested on #9603 was excessive I feel. Six weeks after the ticket was created to just add 

`&& [ "x$UNAME" != xHP-UX ]` 

it is still awaiting a positive review. 

I'm not denying the changes Leif requested on #9603 has improved the iconv package - though I think it was one of the better packages to start with. I do however think the time spent on it could have been put to more productive use. 

If tickets to add a very small change are going to result in weeks of iterations, then the changes are not going to be made - at least not by me. 

I am happy to attempt to clean up Cliquer, but on the understanding it does not become like #9603. I've no desire to spend so much time on endless small changes. 

The only changes I would make to `patches/Makefile` are Solaris-specific, as the compiler flags are wrong. (Oh, and I might add the necessary change to package so it builds on HP-UX, where shared libraries are .sl and not .so.) But I have no intension of re-writing the whole of the Makefile. 

There's a lot of unnecessary things in `spkg-install` and I'm happy to remove them, but I'm not willing to spend weeks on it. 

Dave



---

archive/issue_comments_109323.json:
```json
{
    "body": "<a id='comment:3'></a>See: \n* #9871 which updates Cliquer and runs the tests in a better way. \n* #9870 which will clean up Cliquer. \n\nDave",
    "created_at": "2010-09-07T22:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9521#issuecomment-109323",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:3'></a>See: 
* #9871 which updates Cliquer and runs the tests in a better way. 
* #9870 which will clean up Cliquer. 

Dave



---

archive/issue_events_023655.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9521",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9521#event-23655"
}
```



---

archive/issue_comments_109324.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-16T13:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9521#issuecomment-109324",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_109325.json:
```json
{
    "body": "<a id='comment:5'></a>Duplicate of #9870.",
    "created_at": "2014-01-16T13:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9521#issuecomment-109325",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>Duplicate of #9870.



---

archive/issue_events_023656.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-01-16T13:32:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9521",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9521#event-23656"
}
```



---

archive/issue_events_023657.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-01-16T13:32:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9521",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9521#event-23657"
}
```



---

archive/issue_comments_109326.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2014-01-16T13:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9521#issuecomment-109326",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_109327.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-16T13:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9521#issuecomment-109327",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_023658.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-01-21T14:28:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9521",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9521#event-23658"
}
```



---

archive/issue_comments_109328.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2014-01-21T14:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9521#issuecomment-109328",
    "user": "https://github.com/vbraun"
}
```

Resolution: duplicate
