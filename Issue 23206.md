# Issue 23206: More Schubert polynomial shenanigans

archive/issues_023206.json:
```json
{
    "body": "CC:  tscrim sage-combinat aschilling vivianepons\n\nKeywords: schubert, polynomials, divided differences\n\nTitle stolen from Stanley, but this is, alas, a bug, not a determinant conjecture:\n\n```\nsage: X = SchubertPolynomialRing(ZZ)\nsage: X([]).expand()\n1\nsage: X([1]).expand()\n1\nsage: X([]) == X([1])\nFalse\n```\n\n\nNormally, `X(perm)` reduces the permutation `perm` by removing all fixed points attached to its right end (i.e., if a permutation in `S_n` sends `n` to `n`, then it reduces it to a permutation in `S_{n-1}` and so on, until this reduction is no longer possible). And rightfully so, since the Schubert basis is indexed by reduced permutations. However, it fails to reduce `[1]` to `[]`.\n\nCan we just fix it, or does symmetrica break on contact with the empty list? In the latter case, should we reduce `[]` to `[1]` instead?\n\nRelated: #23403.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23443\n\n",
    "created_at": "2017-07-16T12:03:49Z",
    "labels": [
        "combinatorics",
        "major",
        "bug"
    ],
    "title": "More Schubert polynomial shenanigans",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23206",
    "user": "darij"
}
```
CC:  tscrim sage-combinat aschilling vivianepons

Keywords: schubert, polynomials, divided differences

Title stolen from Stanley, but this is, alas, a bug, not a determinant conjecture:

```
sage: X = SchubertPolynomialRing(ZZ)
sage: X([]).expand()
1
sage: X([1]).expand()
1
sage: X([]) == X([1])
False
```


Normally, `X(perm)` reduces the permutation `perm` by removing all fixed points attached to its right end (i.e., if a permutation in `S_n` sends `n` to `n`, then it reduces it to a permutation in `S_{n-1}` and so on, until this reduction is no longer possible). And rightfully so, since the Schubert basis is indexed by reduced permutations. However, it fails to reduce `[1]` to `[]`.

Can we just fix it, or does symmetrica break on contact with the empty list? In the latter case, should we reduce `[]` to `[1]` instead?

Related: #23403.

Issue created by migration from https://trac.sagemath.org/ticket/23443





---

archive/issue_comments_324630.json:
```json
{
    "body": "I've updated the ticket description to better describe where the error is coming from (rather than the symptom).\n\nThere does seem to be some issue with symmetrica and empty lists:\n\n```\nsage: X([]) * X([1])\nfunction: copy code: 4294967295 \npython: : Numerical argument out of domain\nsage: X([]) * X([])\nfunction: copy code: 4294967295 \npython: : Numerical argument out of domain\n```\n\nMore shenanigans:\n\n```\nsage: it = iter(X.basis())\nsage: [it.next() for _ in range(10)]\n[X[],\n X[1],\n X[1, 2],\n X[2, 1],\n X[1, 2, 3],\n X[1, 3, 2],\n X[2, 1, 3],\n X[2, 3, 1],\n X[3, 1, 2],\n X[3, 2, 1]]\n```\n\nSo one of the definite problems is that the indexing set could be considered too big. However, we could also consider `X` as a tower of polynomial rings, so it would make sense to distinguish `X[1, 2]` from `X[1]`, etc. by considering each within a homogeneous component with a fixed number of variables.",
    "created_at": "2017-07-16T13:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324630",
    "user": "tscrim"
}
```

I've updated the ticket description to better describe where the error is coming from (rather than the symptom).

There does seem to be some issue with symmetrica and empty lists:

```
sage: X([]) * X([1])
function: copy code: 4294967295 
python: : Numerical argument out of domain
sage: X([]) * X([])
function: copy code: 4294967295 
python: : Numerical argument out of domain
```

More shenanigans:

```
sage: it = iter(X.basis())
sage: [it.next() for _ in range(10)]
[X[],
 X[1],
 X[1, 2],
 X[2, 1],
 X[1, 2, 3],
 X[1, 3, 2],
 X[2, 1, 3],
 X[2, 3, 1],
 X[3, 1, 2],
 X[3, 2, 1]]
```

So one of the definite problems is that the indexing set could be considered too big. However, we could also consider `X` as a tower of polynomial rings, so it would make sense to distinguish `X[1, 2]` from `X[1]`, etc. by considering each within a homogeneous component with a fixed number of variables.



---

archive/issue_comments_324631.json:
```json
{
    "body": "The way I understand Schubert polynomials, you either deal with them in a fixed number of indeterminates (in which case the basis is indexed by `S_n`), or in infinitely many indeterminates (in which case the basis is indexed by `S_0 \\cup S_1 \\cup S_2 \\cup ...`, and this is an increasing union, not a disjoint union -- i.e., we identify permutations that only differ in trailing fixed points). I have never seen a situation where Schubert polynomials have a basis indexed by the *disjoint* union `S_0 \\sqcup S_1 \\sqcup S_2 \\sqcup ...`; they are not the Malvenuto-Reutenauer Hopf algebra. So I think the `basis` method is wrong here.",
    "created_at": "2017-07-16T13:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324631",
    "user": "darij"
}
```

The way I understand Schubert polynomials, you either deal with them in a fixed number of indeterminates (in which case the basis is indexed by `S_n`), or in infinitely many indeterminates (in which case the basis is indexed by `S_0 \cup S_1 \cup S_2 \cup ...`, and this is an increasing union, not a disjoint union -- i.e., we identify permutations that only differ in trailing fixed points). I have never seen a situation where Schubert polynomials have a basis indexed by the *disjoint* union `S_0 \sqcup S_1 \sqcup S_2 \sqcup ...`; they are not the Malvenuto-Reutenauer Hopf algebra. So I think the `basis` method is wrong here.



---

archive/issue_comments_324632.json:
```json
{
    "body": "By doing the tower approach, you can get a little bit of both worlds: you are considering a fixed number of variables that you can arbitrarily move between different rings (i.e., you do not have to deal with coercions between different parents). I do not have any preference on what approach is taken; I am just stating how I understand the code.\n\nHowever, there are some large inconsistencies between the code parts (and possibly the doc). Those do need to be fixed. We might just be better off changing the entire class to perhaps do some slight adjustments to the permutations when sending them back and forth with symmetrica.",
    "created_at": "2017-07-16T14:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324632",
    "user": "tscrim"
}
```

By doing the tower approach, you can get a little bit of both worlds: you are considering a fixed number of variables that you can arbitrarily move between different rings (i.e., you do not have to deal with coercions between different parents). I do not have any preference on what approach is taken; I am just stating how I understand the code.

However, there are some large inconsistencies between the code parts (and possibly the doc). Those do need to be fixed. We might just be better off changing the entire class to perhaps do some slight adjustments to the permutations when sending them back and forth with symmetrica.



---

archive/issue_comments_324633.json:
```json
{
    "body": "Attachment [schubert-1.diff](tarball://root/attachments/some-uuid/ticket23443/schubert-1.diff) by @darijgr created at 2022-04-16 22:33:36\n\nFixing X([]) misbehaving and X([1]).expand() not properly coercing",
    "created_at": "2022-04-16T22:33:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324633",
    "user": "@darijgr"
}
```

Attachment [schubert-1.diff](tarball://root/attachments/some-uuid/ticket23443/schubert-1.diff) by @darijgr created at 2022-04-16 22:33:36

Fixing X([]) misbehaving and X([1]).expand() not properly coercing



---

archive/issue_comments_324634.json:
```json
{
    "body": "The attached schubert-1.diff file (I can't push for some stupid security reasons) fixes two basic bugs: the X([]) shenanigans (it's X([1]) now) and the problems stemming from X([1]).expand() landing in Z[x] instead of Z[x0] (which led to the product X([1]).expand() * X([1,2]).expand() being undefined).\n\nThe basis() method still needs to be fixed.",
    "created_at": "2022-04-16T22:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324634",
    "user": "@darijgr"
}
```

The attached schubert-1.diff file (I can't push for some stupid security reasons) fixes two basic bugs: the X([]) shenanigans (it's X([1]) now) and the problems stemming from X([1]).expand() landing in Z[x] instead of Z[x0] (which led to the product X([1]).expand() * X([1,2]).expand() being undefined).

The basis() method still needs to be fixed.



---

archive/issue_comments_324635.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-04-25T02:06:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324635",
    "user": "tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_324636.json:
```json
{
    "body": "Is there anything else that is needed for this ticket? If not, then you can set a positive review if I have applied your patch correctly.\n----\nNew commits:",
    "created_at": "2022-04-25T02:06:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324636",
    "user": "tscrim"
}
```

Is there anything else that is needed for this ticket? If not, then you can set a positive review if I have applied your patch correctly.
----
New commits:



---

archive/issue_comments_324637.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-04-27T12:15:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324637",
    "user": "@darijgr"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_324638.json:
```json
{
    "body": "The basis still needs fixing (it has too many elements because it doesn't enforce the \"no unnecessary fixed points at the end\" rule for its permutation). But I'll open a new ticket for that.\n\nThanks for posting and reviewing, Travis!",
    "created_at": "2022-04-27T12:15:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324638",
    "user": "@darijgr"
}
```

The basis still needs fixing (it has too many elements because it doesn't enforce the "no unnecessary fixed points at the end" rule for its permutation). But I'll open a new ticket for that.

Thanks for posting and reviewing, Travis!



---

archive/issue_comments_324639.json:
```json
{
    "body": "Note: one can use something like\n\n```\ngit commit --author=\"Other Person <other.person@example.com>\n```\n\nto properly indicate authorship when committing someone else's code.\n\nOr as an afterthought, `git commit --amend --no-edit --author=...`.",
    "created_at": "2022-04-27T17:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324639",
    "user": "slelievre"
}
```

Note: one can use something like

```
git commit --author="Other Person <other.person@example.com>
```

to properly indicate authorship when committing someone else's code.

Or as an afterthought, `git commit --amend --no-edit --author=...`.



---

archive/issue_comments_324640.json:
```json
{
    "body": "I didn't know that. Thank you. Could you push the revision? I am away from my computer until next week.",
    "created_at": "2022-04-27T22:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324640",
    "user": "tscrim"
}
```

I didn't know that. Thank you. Could you push the revision? I am away from my computer until next week.



---

archive/issue_comments_324641.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2022-04-28T09:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324641",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_324642.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:",
    "created_at": "2022-04-28T09:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324642",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:



---

archive/issue_comments_324643.json:
```json
{
    "body": "Same commit, now with author Darij Grinberg.",
    "created_at": "2022-04-28T09:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324643",
    "user": "slelievre"
}
```

Same commit, now with author Darij Grinberg.



---

archive/issue_comments_324644.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-04-28T09:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324644",
    "user": "slelievre"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_324645.json:
```json
{
    "body": "Thank you! The wrong basis is now #33766, so this ticket can be closed once merged.",
    "created_at": "2022-04-28T12:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324645",
    "user": "@darijgr"
}
```

Thank you! The wrong basis is now #33766, so this ticket can be closed once merged.



---

archive/issue_comments_324646.json:
```json
{
    "body": "Replying to [comment:12 slelievre]:\n> Same commit, now with author Darij Grinberg.\n\nThank you. I appreciate it.",
    "created_at": "2022-04-28T13:19:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324646",
    "user": "tscrim"
}
```

Replying to [comment:12 slelievre]:
> Same commit, now with author Darij Grinberg.

Thank you. I appreciate it.



---

archive/issue_comments_324647.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-05-16T22:24:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324647",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_324648.json:
```json
{
    "body": "\n```\n[sagemath_doc_html-none] [combinat ] The inventory files are in local/share/doc/sage/inventory/en/reference/combinat.\n[sagemath_doc_html-none] Error building the documentation.\n[sagemath_doc_html-none] Traceback (most recent call last):\n[sagemath_doc_html-none]   File \"/home/release/Sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/runpy.py\", line 196, in _run_module_as_main\n[sagemath_doc_html-none]     return _run_code(code, main_globals, None,\n[sagemath_doc_html-none]   File \"/home/release/Sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/runpy.py\", line 86, in _run_code\n[sagemath_doc_html-none]     exec(code, run_globals)\n[sagemath_doc_html-none]   File \"/home/release/Sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage_docbuild/__main__.py\", line 2, in <module>\n[sagemath_doc_html-none]     main()\n[sagemath_doc_html-none]   File \"/home/release/Sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 1762, in main\n[sagemath_doc_html-none]     builder()\n[sagemath_doc_html-none]   File \"/home/release/Sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 801, in _wrapper\n[sagemath_doc_html-none]     getattr(DocBuilder, build_type)(self, *args, **kwds)\n[sagemath_doc_html-none]   File \"/home/release/Sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage_docbuild/__init__.py\", line 145, in f\n[sagemath_doc_html-none]     runsphinx()\n[sagemath_doc_html-none]   File \"/home/release/Sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py\", line 326, in runsphinx\n[sagemath_doc_html-none]     sys.stderr.raise_errors()\n[sagemath_doc_html-none]   File \"/home/release/Sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py\", line 262, in raise_errors\n[sagemath_doc_html-none]     raise OSError(self._error)\n[sagemath_doc_html-none] OSError: /home/release/Sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage/combinat/permutation.py:docstring of sage.combinat.permutation.Permutation.remove_extra_fixed_points:6: ERROR: Unknown interpreted text role \"module\".\n```\n",
    "created_at": "2022-05-16T22:24:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324648",
    "user": "vbraun"
}
```


```
[sagemath_doc_html-none] [combinat ] The inventory files are in local/share/doc/sage/inventory/en/reference/combinat.
[sagemath_doc_html-none] Error building the documentation.
[sagemath_doc_html-none] Traceback (most recent call last):
[sagemath_doc_html-none]   File "/home/release/Sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/runpy.py", line 196, in _run_module_as_main
[sagemath_doc_html-none]     return _run_code(code, main_globals, None,
[sagemath_doc_html-none]   File "/home/release/Sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/runpy.py", line 86, in _run_code
[sagemath_doc_html-none]     exec(code, run_globals)
[sagemath_doc_html-none]   File "/home/release/Sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage_docbuild/__main__.py", line 2, in <module>
[sagemath_doc_html-none]     main()
[sagemath_doc_html-none]   File "/home/release/Sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 1762, in main
[sagemath_doc_html-none]     builder()
[sagemath_doc_html-none]   File "/home/release/Sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 801, in _wrapper
[sagemath_doc_html-none]     getattr(DocBuilder, build_type)(self, *args, **kwds)
[sagemath_doc_html-none]   File "/home/release/Sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage_docbuild/__init__.py", line 145, in f
[sagemath_doc_html-none]     runsphinx()
[sagemath_doc_html-none]   File "/home/release/Sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py", line 326, in runsphinx
[sagemath_doc_html-none]     sys.stderr.raise_errors()
[sagemath_doc_html-none]   File "/home/release/Sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage_docbuild/sphinxbuild.py", line 262, in raise_errors
[sagemath_doc_html-none]     raise OSError(self._error)
[sagemath_doc_html-none] OSError: /home/release/Sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage/combinat/permutation.py:docstring of sage.combinat.permutation.Permutation.remove_extra_fixed_points:6: ERROR: Unknown interpreted text role "module".
```




---

archive/issue_comments_324649.json:
```json
{
    "body": "Ack, `:module:` -> `:mod:`.",
    "created_at": "2022-05-17T01:04:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324649",
    "user": "tscrim"
}
```

Ack, `:module:` -> `:mod:`.



---

archive/issue_comments_324650.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-10T01:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324650",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324651.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-06-10T01:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324651",
    "user": "tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_324652.json:
```json
{
    "body": "I finally was able to fix this. I checked the doc builds. Since the change is trivial, I am allowing myself to reset to a positive review.",
    "created_at": "2022-06-10T01:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324652",
    "user": "tscrim"
}
```

I finally was able to fix this. I checked the doc builds. Since the change is trivial, I am allowing myself to reset to a positive review.



---

archive/issue_comments_324653.json:
```json
{
    "body": "Thank you, Travis!",
    "created_at": "2022-06-10T01:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324653",
    "user": "@darijgr"
}
```

Thank you, Travis!



---

archive/issue_comments_324654.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-06-12T23:08:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23206#issuecomment-324654",
    "user": "vbraun"
}
```

Resolution: fixed
