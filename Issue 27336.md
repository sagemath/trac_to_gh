# Issue 27336: PRESENT Block Cipher

Issue created by migration from https://trac.sagemath.org/ticket/27573

Original creator: @yhxnf

Original creation time: 2019-03-30 15:36:52

CC:  asante

Keywords: PRESENT

Implementation of the ultra-lightweight block cipher PRESENT.



---

Comment by @yhxnf created at 2019-03-30 15:40:33

Changing status from new to needs_review.


---

Comment by git created at 2019-03-30 20:27:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-04-07 17:05:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by asante created at 2019-05-02 13:37:22

I would rename the `doLastLinearLayer` argument to `doFinalRound`, as this will fit/be more consistent, when implementing other block ciphers.

I also reviewed the ticket and it lgtm, but maybe someone else also want to take a look?


---

Comment by git created at 2019-05-03 20:33:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by asante created at 2019-06-16 20:10:52

Changing status from needs_review to positive_review.


---

Comment by asante created at 2019-06-16 20:10:52

I'm setting this to positive review now.


---

Comment by asante created at 2019-06-17 13:39:11

Changing status from positive_review to needs_work.


---

Comment by asante created at 2019-06-17 13:39:11

Actually I realised that I would like to have some design changes.

In principle, so that this is easier to do experiments with, it should be easy to modify the cipher. I have something in mind like the following:


```
sage: cipher = PRESENT(rounds=1, doLastLinearLayer=False)
sage: cipher.sbox = SBox(range(16))
sage: cipher.key_schedule = lambda x: [0, 0]  # return the 0 keys as round keys
sage: cipher.encrypt(plain=0x1234, key=0x0) == 0x1234
True
```


So this would require the implementation to split the encrypt function into a `round` function that uses an `sboxlayer` function and a `linearlayer` function, the `sboxlayer` uses the member variable `sbox`. All these should not be internal functions, but visible and documented, so that the user knows about them and that it is possible to modify them.

I hope this is clear, otherwise I can specify this further.


---

Comment by git created at 2019-06-19 16:22:07

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2019-07-25 07:49:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by asante created at 2019-07-25 08:05:33

OK, LGTM with one last point:

If you do the following import in an example


```
sage: from sage.crypto.block_cipher.present import _convert_to_vector
```


I think the `_convert_to_vector` function should not be hidden by default.


---

Comment by git created at 2019-07-25 11:01:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @yhxnf created at 2019-07-25 11:01:51

Changing status from needs_work to needs_review.


---

Comment by asante created at 2019-08-02 12:04:56

lgtm

However, I have problems building the documentation, it fails with some error in the `categorie` docs -- which should actually not be related to this ticket? Maybe we should merge the latest development branch, for which I am able to build the documentation.


---

Comment by asante created at 2019-08-04 19:08:12

Changing status from needs_review to positive_review.


---

Comment by asante created at 2019-08-04 19:08:12

I just did the rebase on the latest develop branch.

Docs now build correctly.

LGTM
----
New commits:


---

Comment by vbraun created at 2019-08-07 22:15:06

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2019-08-07 22:15:06

The PDF docs don't build

```
[docpdf] ! Package amsmath Error: \begin{aligned} allowed only in math mode.
[docpdf] 
[docpdf] See the amsmath package documentation for explanation.
[docpdf] Type  H <return>  for immediate help.
[docpdf]  ...                                              
[docpdf]                                                   
[docpdf] l.6727 \ 
[docpdf]          [k_{79}k_{78}\dots k_{1}k_{0}] &= [k_{18}k_{17}\dots k_{20}k_{19}] \\
[docpdf] ? 
[docpdf] ! Emergency stop.
[docpdf]  ...                                              
[docpdf]                                                   
[docpdf] l.6727 \ 
[docpdf]          [k_{79}k_{78}\dots k_{1}k_{0}] &= [k_{18}k_{17}\dots k_{20}k_{19}] \\
[docpdf] !  ==> Fatal error occurred, no output PDF file produced!
[docpdf] Transcript written on cryptography.log.
```



---

Comment by @yhxnf created at 2019-08-08 07:12:12

New commits:


---

Comment by @yhxnf created at 2019-08-08 07:13:09

Replying to [comment:19 vbraun]:
> The PDF docs don't build

should be fixed now


---

Comment by @yhxnf created at 2019-08-08 07:14:50

Changing status from needs_work to needs_review.


---

Comment by asante created at 2019-08-20 18:13:07

Changing status from needs_review to positive_review.


---

Comment by asante created at 2019-08-20 18:13:07

LGTM


---

Comment by vbraun created at 2019-08-21 22:27:40

Resolution: fixed


---

Comment by jhpalmieri created at 2019-08-26 02:33:56

This causes a doctest failure with Python 3. Follow up at #28403.


---

Comment by chapoton created at 2019-08-26 06:06:29

I recall that development should now be done with python3. This would prevent this to happen.
