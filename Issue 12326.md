# Issue 12326: Return Integer from GeneralDiscreteDistribution

Issue created by migration from Trac.

Original creator: ppurka

Original creation time: 2012-02-11 16:49:09

Assignee: amhou

Keywords: GeneralDiscreteDistribution import

1. The output of GeneralDiscreteDistribution is not a Sage number per se and hence has no `parent` attribute.

2. The import of sage.rings.real_double seems unnecessary in the file `devel/sage/sage/gsl/probability_distribution.pyx` since all the calls to RDF are made explicitly as `sage.rings.real_double.RDF` in the entire file.

Attaching a patch to fix both the above issues. The patch passes all doctests in `devel/sage/sage/gsl`.


---

Comment by ppurka created at 2012-02-12 00:27:24

All tests pass except for cmdline.py. I checked this test on an unmodified sage-4.8 and it fails exactly similarly on the unmodified sage. The directory `sage-4.8.good` is the unmodified sage below, while the directory `sage-4.8` contains these modifications along with #11080

```
...stallations/sage-4.8.good> ./sage -t  --long -force_lib devel/sage/sage/tests/cmdline.py
sage -t --long -force_lib "devel/sage/sage/tests/cmdline.py"
**********************************************************************
File "/home/punarbasu/Installations/sage-4.8.good/devel/sage/sage/tests/cmdline.py", line 95:
    sage: out.find(version()) >= 0
Expected:
    True
Got:
    False
**********************************************************************
File "/home/punarbasu/Installations/sage-4.8.good/devel/sage/sage/tests/cmdline.py", line 103:
    sage: out.find(version()) >= 0
Expected:
    True
Got:
    False
**********************************************************************
File "/home/punarbasu/Installations/sage-4.8.good/devel/sage/sage/tests/cmdline.py", line 175:
    sage: out.find(version()) >= 0
Expected:
    True
Got:
    False
**********************************************************************
1 items had failures:
   3 of 160 in __main__.example_1
***Test Failed*** 3 failures.
For whitespace errors, see the file /home/punarbasu/.sage//tmp/cmdline_21847.py
	 [67.8 s]
 
----------------------------------------------------------------------
The following tests failed:


	sage -t --long -force_lib "devel/sage/sage/tests/cmdline.py"
Total time for all tests: 68.0 seconds
...ions/sage-4.8.good [128] > ../sage-4.8
~/Installations/sage-4.8> 
~/Installations/sage-4.8> ./sage -t  --long -force_lib devel/sage/sage/tests/cmdline.py
sage -t --long -force_lib "devel/sage/sage/tests/cmdline.py"
**********************************************************************
File "/home/punarbasu/Installations/sage-4.8/devel/sage/sage/tests/cmdline.py", line 95:
    sage: out.find(version()) >= 0
Expected:
    True
Got:
    False
**********************************************************************
File "/home/punarbasu/Installations/sage-4.8/devel/sage/sage/tests/cmdline.py", line 103:
    sage: out.find(version()) >= 0
Expected:
    True
Got:
    False
**********************************************************************
File "/home/punarbasu/Installations/sage-4.8/devel/sage/sage/tests/cmdline.py", line 175:
    sage: out.find(version()) >= 0
Expected:
    True
Got:
    False
**********************************************************************
1 items had failures:
   3 of 160 in __main__.example_1
***Test Failed*** 3 failures.
For whitespace errors, see the file /home/punarbasu/.sage//tmp/cmdline_22200.py
	 [18.9 s]
 
----------------------------------------------------------------------
The following tests failed:


	sage -t --long -force_lib "devel/sage/sage/tests/cmdline.py"
Total time for all tests: 18.9 seconds
```



---

Comment by ppurka created at 2012-02-12 00:27:24

Changing status from new to needs_review.


---

Comment by ppurka created at 2012-02-12 00:33:08

This doctest failure might be related to #12420.


---

Comment by kcrisman created at 2012-02-12 03:29:19

Haven't tried to break this, but I don't see how having it being an Integer as opposed to int would lead to anything _breaking_.  Does `gsl_ran_discrete` always return ints?

The patch _does_ need a better commit message.


---

Comment by ppurka created at 2012-02-12 10:43:10

Replying to [comment:4 kcrisman]:
> Haven't tried to break this, but I don't see how having it being an Integer as opposed to int would lead to anything _breaking_.  Does `gsl_ran_discrete` always return ints?
> 

Yes. I believe `gsl_ran_discrete` always return ints. I ran into a problem with this because in one of my programs I was expecting that since I am always calling Sage commands, I will always get objects which are Sage objects and not python objects. At one point I was testing for the `parent()` of the number and it failed because `get_random_element()` was returning ints.

Additionally, I think it should be Integer also for consistency. For example the other probability distributions return RDF instead of floats.

> The patch _does_ need a better commit message.

It didn't have a commit message! Apparently, I forgot to put one. Updated the patch now.


---

Comment by davidloeffler created at 2012-03-25 15:08:01

This doesn't apply to the current beta, presumably due to a conflict with #9770 (merged in 5.0.beta9).


---

Comment by davidloeffler created at 2012-03-25 15:08:01

Changing status from needs_review to needs_work.


---

Comment by ppurka created at 2012-03-26 09:35:21

Rebased to sage-5.0beta10.


---

Comment by ppurka created at 2012-03-26 09:35:21

Changing status from needs_work to needs_review.


---

Comment by dsm created at 2012-05-25 18:57:41

Works for me against 5.1.beta0.  Commit message seems a little unusual (maybe a bit long)?


---

Comment by ppurka created at 2012-05-25 19:07:33

Replying to [comment:8 dsm]:
> Works for me against 5.1.beta0.  Commit message seems a little unusual (maybe a bit long)?  
Is that good or bad? :)


---

Comment by jdemeyer created at 2012-07-27 20:41:04

Please fill in your real name as Author.


---

Comment by chapoton created at 2013-04-03 19:51:01

You should add (in the doc) a test to check that the output is indeed in ZZ


---

Attachment

Rebased patch to sage-5.0beta10


---

Comment by ppurka created at 2013-04-09 11:18:45

Updated the patch with an example to check that the output is in `ZZ`.

Patchbot apply trac_12498-return-Integer-from-GeneralDiscreteDistribution.2.patch


---

Comment by chapoton created at 2013-04-27 06:46:53

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2013-04-27 06:46:53

ok, looks good.


---

Comment by jdemeyer created at 2013-04-30 09:38:16

Resolution: fixed
