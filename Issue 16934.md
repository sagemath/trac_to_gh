# Issue 16934: Upgrade dot2tex to 2.9.0

Issue created by migration from Trac.

Original creator: tscrim

Original creation time: 2014-10-18 00:33:51

Assignee: sage-combinat

CC:  sage-combinat nthiery aschilling bsalisbury1 jpflori

Keywords: dot2tex

dot2tex 2.9.0 was release in May, 2014. Currently we are at 2.9.0dev, and we should make sure we're at the latest stable release.


---

Comment by tscrim created at 2014-11-08 18:35:00

Changing status from new to needs_review.


---

Comment by tscrim created at 2014-11-08 18:35:00

All of our current patches no longer apply because either they were merged upstream or were changes to the testing framework (which has completely changed from the dev version). However I added a new patch which removes the `test_semicolon` because this is the known, but not yet fixed, [Issue #5](https://github.com/kjellmf/dot2tex/issues/5).
----
New commits:


---

Comment by tscrim created at 2015-05-26 04:58:57

ping


---

Comment by chapoton created at 2015-06-05 14:51:19

with graphviz and this new dot2tex, some trivial doctest failures:

sage -t --optional=sage,dot2tex,graphviz ./graphs/dot2tex_utils.py ./graphs/graph_latex.py ./graphs/generic_graph.py ./categories/crystals.py ./combinat/perfect_matching.py ./combinat/crystals/crystals.py ./combinat/rigged_configurations/kleber_tree.py ./combinat/posets/linear_extensions.py ./combinat/posets/posets.py
----------------------------------------------------------------------
sage -t graphs/generic_graph.py  # 6 doctests failed
sage -t combinat/posets/posets.py  # 1 doctest failed
----------------------------------------------------------------------


---

Comment by chapoton created at 2015-06-05 14:51:19

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-06-06 00:10:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2015-06-06 00:12:05

I fixed the trivially failing doctests (I also made the `view()` example not tested because it opens a separate window). Looks like this will need to rebased on beta3, which I will do tonight.


---

Comment by chapoton created at 2015-06-06 07:25:11

Are you sure that `<BLANKLINE>` is needed ?


---

Comment by git created at 2015-06-06 15:03:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-06 15:13:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2015-06-06 15:16:31

I had done my merge, checking, and was about to push when you did your merge :P.

Turns out the `<BLANKLINE>`'s are not needed.


---

Comment by tscrim created at 2015-06-06 15:16:31

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2015-06-06 16:01:54

I have a failure:

```
sage -t combinat/posets/posets.py
**********************************************************************
File "combinat/posets/posets.py", line 1259, in sage.combinat.posets.posets.FinitePoset._latex_
Failed example:
    print P._latex_() #optional - dot2tex graphviz
Expected:
    \begin{tikzpicture}[>=latex,line join=bevel,]
    %%
    \node (node_1) at (6.0...bp,57.0...bp) [draw,draw=none] {$2$};
      \node (node_0) at (6.0...bp,7.0...bp) [draw,draw=none] {$1$};
      \draw [black,->] (node_0) ..controls (6.0...bp,20.2...bp) and (6.0...bp,30.9...bp)  .. (node_1);
    %
    \end{tikzpicture}
Got:
    <BLANKLINE>
    \begin{tikzpicture}[>=latex,line join=bevel,]
    %%
    \node (node_1) at (6.0bp,57.0bp) [draw,draw=none] {$2$};
      \node (node_0) at (6.0bp,7.0bp) [draw,draw=none] {$1$};
      \draw [black,->] (node_0) ..controls (6.0bp,19.947bp) and (6.0bp,30.897bp)  .. (node_1);
    %
    \end{tikzpicture}
    <BLANKLINE>
```

because of the 19 instead of 20

And moreover, it pops me out 10 pdf pictures in new windows..

I did

```
sage -bt --optional=sage,dot2tex,graphviz ./graphs/__init__.py ./graphs/dot2tex_utils.py ./graphs/graph.py ./graphs/generic_graph.py ./graphs/digraph.py ./graphs/graph_latex.py ./categories/crystals.py ./combinat/perfect_matching.py ./combinat/crystals/crystals.py ./combinat/partition.py ./combinat/posets/posets.py ./combinat/posets/linear_extensions.py ./combinat/rigged_configurations/kleber_tree.py 
```



---

Comment by git created at 2015-06-06 19:28:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2015-06-06 19:31:00

That should make that doctest pass.

For better or worse, that was the current behavior before this ticket. However, do you want me to go through and make similar changes with opening external windows?


---

Comment by jdemeyer created at 2015-06-07 08:02:07

Small detail:

```
# not tested - dot2tex, opens external window
```

should probably be

```
# optional - dot2tex, not tested (opens external window)
```

or something.


---

Comment by chapoton created at 2015-06-07 19:08:29

well, maybe it would be good, if optionals tests are now going to be run more often..


---

Comment by jdemeyer created at 2015-06-07 19:25:31

Replying to [comment:17 chapoton]:
> well, maybe it would be good, if optionals tests are now going to be run more often..
`graphviz` isn't optional (it's experimental), so `graphviz` will not be tested by default.


---

Comment by git created at 2015-06-07 21:40:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2015-06-07 21:41:39

I've marked all applicable optional tests as per Jeroen's suggestion.


---

Comment by jdemeyer created at 2015-06-08 05:42:51

Replace

```
optional - dot2tex, graphviz
```

by

```
optional - dot2tex graphviz
```

(like it was before)


---

Comment by jdemeyer created at 2015-06-08 05:42:51

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2015-06-08 05:58:19

I'm assuming you're refering to

```
# optional - dot2tex, graphviz, not tested (opens external window)
```

Do you want it like

```
# optional - dot2tex graphviz, not tested (opens external window)
```

(which looks somewhat strange) or

```
# optional - dot2tex graphviz not tested (opens external window)
```

(which looks even more strange) or what? I didn't add commas anywhere else that I could see...


---

Comment by jdemeyer created at 2015-06-08 08:02:09

Replying to [comment:22 tscrim]:
> Do you want it like
> {{{
> # optional - dot2tex graphviz, not tested (opens external window)
> }}}

Yes


---

Comment by git created at 2015-06-08 14:59:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2015-06-08 15:00:43

Done.


---

Comment by tscrim created at 2015-06-08 15:00:43

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2015-06-08 15:42:48

Doctests are good now.

Frédéric, can you do the final review?


---

Comment by chapoton created at 2015-06-09 11:35:43

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2015-06-09 11:35:43

ok, looks good, as far as I can tell.


---

Comment by vbraun created at 2015-06-10 23:36:59

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2015-06-10 23:36:59

`src/sage/doctest/sources.py` fails


---

Comment by git created at 2015-06-11 16:57:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2015-06-11 16:59:32

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2015-06-11 16:59:32

Fixed. Trivial failure (and there are similar results that are there).


---

Comment by jdemeyer created at 2015-06-11 17:13:31

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2015-06-11 17:13:31

I missed this the last time, but there should be a comma (or other separator) at the ``@``@``@`` below:

```
view(H, tight_page=True) # optional - dot2tex`@``@``@` not tested (opens external window)
```



---

Comment by git created at 2015-06-11 17:22:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2015-06-11 17:22:32

Fixed.


---

Comment by tscrim created at 2015-06-11 17:22:32

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2015-06-12 18:23:54

Resolution: fixed
