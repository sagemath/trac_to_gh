# Issue 21541: correct refinement in cvxopt sdp backend

Issue created by migration from https://trac.sagemath.org/ticket/21778

Original creator: dimpase

Original creation time: 2016-10-27 21:27:54

CC:  mkoeppe fbissey

on #20506 a weird numerical instability was noticed. It turned out to be a wrongly set solver parameter.


---

Comment by dimpase created at 2016-10-27 21:49:27

Changing status from new to needs_review.


---

Comment by dimpase created at 2016-10-27 21:49:27

New commits:


---

Comment by mkoeppe created at 2016-10-28 04:04:25

On Mac OS X:

```
sage -t --warn-long 77.7 src/sage/numerical/sdp.pyx
**********************************************************************
File "src/sage/numerical/sdp.pyx", line 97, in sage.numerical.sdp
Failed example:
    p.dual_variable(1)  # rel tol 1e-05
Expected:
    [ 85555.0 -85555.0]
    [-85555.0  85555.0]
Got:
    [ 85527.39489238134 -85527.39489234997]
    [-85527.39489234997  85527.39489238121]
Tolerance exceeded in 4 of 4:
    85555.0 vs 85527.39489238134, tolerance 3e-04 > 1e-05
    -85555.0 vs -85527.39489234997, tolerance 3e-04 > 1e-05
    -85555.0 vs -85527.39489234997, tolerance 3e-04 > 1e-05
    85555.0 vs 85527.39489238121, tolerance 3e-04 > 1e-05
**********************************************************************
```



---

Comment by git created at 2016-10-28 05:09:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-10-28 05:10:08

OK, I decreased it...


---

Comment by mkoeppe created at 2016-10-28 21:46:26

Works on Mac OS X now. 

Cc'ing fbissey, who did some testing of this or related testcases on #20506.


---

Comment by dimpase created at 2016-12-02 15:35:28

ping!


---

Comment by fbissey created at 2016-12-02 17:58:29

Sorry, was that the one where I had to raise the tolerance when upgrading `glpk`?


---

Comment by dimpase created at 2016-12-02 20:01:49

No, it is a different issue, with cvxopt interface that was broken and fixed by this patch.


---

Comment by fbissey created at 2016-12-03 20:28:32

OK now that I have the refresher I know what to do. to review this.


---

Comment by fbissey created at 2016-12-03 21:19:40

Changing status from needs_review to needs_work.


---

Comment by fbissey created at 2016-12-03 21:19:40

OK the example of #20506 does work now. But I have a tolerance problem

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/numerical/sdp.pyx
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/numerical/sdp.pyx", line 97, in sage.numerical.sdp
Failed example:
    p.dual_variable(1)  # rel tol 1e-04
Expected:
    [ 85555.0 -85555.0]
    [-85555.0  85555.0]
Got:
    [ 85527.39489238134 -85527.39489234997]
    [-85527.39489234997  85527.39489238121]
Tolerance exceeded in 4 of 4:
    85555.0 vs 85527.39489238134, tolerance 3e-04 > 1e-04
    -85555.0 vs -85527.39489234997, tolerance 3e-04 > 1e-04
    -85555.0 vs -85527.39489234997, tolerance 3e-04 > 1e-04
    85555.0 vs 85527.39489238121, tolerance 3e-04 > 1e-04
**********************************************************************
```



---

Comment by git created at 2016-12-04 11:35:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-12-04 11:37:53

OK, fixed.


---

Comment by dimpase created at 2016-12-04 11:37:53

Changing status from needs_work to needs_review.


---

Comment by fbissey created at 2016-12-04 20:02:49

Should be all good now.


---

Comment by fbissey created at 2016-12-04 20:02:49

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-12-05 22:34:57

Resolution: fixed
