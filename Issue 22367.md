# Issue 22367: autodoc unforking again

archive/issues_022367.json:
```json
{
    "body": "CC:  hivert embray\n\nMove some changes from upstream Sphinx `autodoc.py` to `sage_autodoc.py`\n\nIssue created by migration from https://trac.sagemath.org/ticket/22604\n\n",
    "created_at": "2017-03-15T11:48:14Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "autodoc unforking again",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22367",
    "user": "jdemeyer"
}
```
CC:  hivert embray

Move some changes from upstream Sphinx `autodoc.py` to `sage_autodoc.py`

Issue created by migration from https://trac.sagemath.org/ticket/22604





---

archive/issue_comments_310939.json:
```json
{
    "body": "This isn't perfect but it's a step in the right direction.\n----\nNew commits:",
    "created_at": "2017-03-15T21:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22367#issuecomment-310939",
    "user": "jdemeyer"
}
```

This isn't perfect but it's a step in the right direction.
----
New commits:



---

archive/issue_comments_310940.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-15T21:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22367#issuecomment-310940",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_310941.json:
```json
{
    "body": "I'm not exactly clear on what this is doing.  Is sage_autodoc a copy of the autodoc module from Sphinx with some patches applied?  Is the point here just to re-apply those patches on top of a newer copy of the module?\n\n(I assume the goal is to eventually do away with the copy entirely...?)",
    "created_at": "2018-03-09T13:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22367#issuecomment-310941",
    "user": "embray"
}
```

I'm not exactly clear on what this is doing.  Is sage_autodoc a copy of the autodoc module from Sphinx with some patches applied?  Is the point here just to re-apply those patches on top of a newer copy of the module?

(I assume the goal is to eventually do away with the copy entirely...?)



---

archive/issue_comments_310942.json:
```json
{
    "body": "Replying to [comment:5 embray]:\n> Is sage_autodoc a copy of the autodoc module from Sphinx with some patches applied?\n\nYes.\n\n> Is the point here just to re-apply those patches on top of a newer copy of the module?\n\nNo. The point is to reduce the patching, i.e. reduce the diff between the real autodoc and the Sage autodoc.\n\nIdeally, we should eventually reduce the diff to zero (by fixing Sage and/or Sphinx).",
    "created_at": "2018-03-09T13:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22367#issuecomment-310942",
    "user": "jdemeyer"
}
```

Replying to [comment:5 embray]:
> Is sage_autodoc a copy of the autodoc module from Sphinx with some patches applied?

Yes.

> Is the point here just to re-apply those patches on top of a newer copy of the module?

No. The point is to reduce the patching, i.e. reduce the diff between the real autodoc and the Sage autodoc.

Ideally, we should eventually reduce the diff to zero (by fixing Sage and/or Sphinx).



---

archive/issue_comments_310943.json:
```json
{
    "body": "Well reduce, sure, but it seems like some of both.  That is, you started with the new upstream version, re-applied any patches from Sage, sans patches that are no longer necessary.",
    "created_at": "2018-03-09T13:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22367#issuecomment-310943",
    "user": "embray"
}
```

Well reduce, sure, but it seems like some of both.  That is, you started with the new upstream version, re-applied any patches from Sage, sans patches that are no longer necessary.



---

archive/issue_comments_310944.json:
```json
{
    "body": "It might be nice if there were a comment in the module specifying exactly what version of the upstream code this is based on (e.g. with a link to GitHub at the correct revision).  That way it would be easy enough to compare to the original to see what the differences are.",
    "created_at": "2018-03-09T13:38:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22367#issuecomment-310944",
    "user": "embray"
}
```

It might be nice if there were a comment in the module specifying exactly what version of the upstream code this is based on (e.g. with a link to GitHub at the correct revision).  That way it would be easy enough to compare to the original to see what the differences are.



---

archive/issue_comments_310945.json:
```json
{
    "body": "Replying to [comment:8 embray]:\n> It might be nice if there were a comment in the module specifying exactly what version of the upstream code this is based on\n\nIt all started a very long time ago as a fork of the Sphinx autodoc. Many changes have been made, some upstream changes were merged. It's not meaningful to say that it is a fork of a single upstream commit, it's much messier than that.",
    "created_at": "2018-03-16T16:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22367#issuecomment-310945",
    "user": "jdemeyer"
}
```

Replying to [comment:8 embray]:
> It might be nice if there were a comment in the module specifying exactly what version of the upstream code this is based on

It all started a very long time ago as a fork of the Sphinx autodoc. Many changes have been made, some upstream changes were merged. It's not meaningful to say that it is a fork of a single upstream commit, it's much messier than that.



---

archive/issue_comments_310946.json:
```json
{
    "body": "Replying to [comment:8 embray]:\n> compare to the original to see what the differences are.\n\nWhen I created this ticket, Sage was using Sphinx 1.5.3 so I guess it's best to compare against that: https://github.com/sphinx-doc/sphinx/blob/v1.5.3/sphinx/ext/autodoc.py",
    "created_at": "2018-03-16T16:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22367#issuecomment-310946",
    "user": "jdemeyer"
}
```

Replying to [comment:8 embray]:
> compare to the original to see what the differences are.

When I created this ticket, Sage was using Sphinx 1.5.3 so I guess it's best to compare against that: https://github.com/sphinx-doc/sphinx/blob/v1.5.3/sphinx/ext/autodoc.py



---

archive/issue_comments_310947.json:
```json
{
    "body": "What I mean is to just add such a link in the comments in the source, sort of like I did in the comment near the top of https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/cpython/_py2_random.py?id=3ee11e056d80c4a9163e5a8d1a8c92e12c34f25b\n\nYou can set positive review once that's done so we can move forward on this.",
    "created_at": "2018-03-21T17:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22367#issuecomment-310947",
    "user": "embray"
}
```

What I mean is to just add such a link in the comments in the source, sort of like I did in the comment near the top of https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/cpython/_py2_random.py?id=3ee11e056d80c4a9163e5a8d1a8c92e12c34f25b

You can set positive review once that's done so we can move forward on this.



---

archive/issue_comments_310948.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-22T09:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22367#issuecomment-310948",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_310949.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-22T09:42:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22367#issuecomment-310949",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_310950.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-08T17:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22367",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22367#issuecomment-310950",
    "user": "vbraun"
}
```

Resolution: fixed
