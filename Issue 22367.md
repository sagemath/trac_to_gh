# Issue 22367: autodoc unforking again

Issue created by migration from https://trac.sagemath.org/ticket/22604

Original creator: jdemeyer

Original creation time: 2017-03-15 11:48:14

CC:  hivert embray

Move some changes from upstream Sphinx `autodoc.py` to `sage_autodoc.py`


---

Comment by jdemeyer created at 2017-03-15 21:21:03

This isn't perfect but it's a step in the right direction.
----
New commits:


---

Comment by jdemeyer created at 2017-03-15 21:21:03

Changing status from new to needs_review.


---

Comment by embray created at 2018-03-09 13:17:41

I'm not exactly clear on what this is doing.  Is sage_autodoc a copy of the autodoc module from Sphinx with some patches applied?  Is the point here just to re-apply those patches on top of a newer copy of the module?

(I assume the goal is to eventually do away with the copy entirely...?)


---

Comment by jdemeyer created at 2018-03-09 13:22:05

Replying to [comment:5 embray]:
> Is sage_autodoc a copy of the autodoc module from Sphinx with some patches applied?

Yes.

> Is the point here just to re-apply those patches on top of a newer copy of the module?

No. The point is to reduce the patching, i.e. reduce the diff between the real autodoc and the Sage autodoc.

Ideally, we should eventually reduce the diff to zero (by fixing Sage and/or Sphinx).


---

Comment by embray created at 2018-03-09 13:36:51

Well reduce, sure, but it seems like some of both.  That is, you started with the new upstream version, re-applied any patches from Sage, sans patches that are no longer necessary.


---

Comment by embray created at 2018-03-09 13:38:08

It might be nice if there were a comment in the module specifying exactly what version of the upstream code this is based on (e.g. with a link to GitHub at the correct revision).  That way it would be easy enough to compare to the original to see what the differences are.


---

Comment by jdemeyer created at 2018-03-16 16:01:14

Replying to [comment:8 embray]:
> It might be nice if there were a comment in the module specifying exactly what version of the upstream code this is based on

It all started a very long time ago as a fork of the Sphinx autodoc. Many changes have been made, some upstream changes were merged. It's not meaningful to say that it is a fork of a single upstream commit, it's much messier than that.


---

Comment by jdemeyer created at 2018-03-16 16:04:09

Replying to [comment:8 embray]:
> compare to the original to see what the differences are.

When I created this ticket, Sage was using Sphinx 1.5.3 so I guess it's best to compare against that: https://github.com/sphinx-doc/sphinx/blob/v1.5.3/sphinx/ext/autodoc.py


---

Comment by embray created at 2018-03-21 17:07:52

What I mean is to just add such a link in the comments in the source, sort of like I did in the comment near the top of https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/cpython/_py2_random.py?id=3ee11e056d80c4a9163e5a8d1a8c92e12c34f25b

You can set positive review once that's done so we can move forward on this.


---

Comment by git created at 2018-03-22 09:41:34

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-03-22 09:42:29

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-05-08 17:27:24

Resolution: fixed
