# Issue 23777: Replace $PIP_INSTALL with sdh_pip_install helper function

Issue created by migration from Trac.

Original creator: embray

Original creation time: 2017-10-11 15:42:17

This removes the `$PIP_INSTALL` environment variable in favor of a new `sdh_pip_install` helper function in `sage-dist-helpers`.  This is consistent with the purpose of the library of build helper functions, and is hopefully the last time such a mass change should be made.

(I realize in #21441#comment:36 I argued against making more mass updates to replace `PIP_INSTALL`, but I'm not wild about the environment variable either, and now that the helper functions exist this seems like the best approach for consistency's sake.)

The only change this makes to the `spkg-install` scripts is a bulk `sed`.


---

Comment by embray created at 2017-10-11 15:42:26

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-10-11 19:52:01

Conflicts at least with #23983 and #21083.


---

Comment by jdemeyer created at 2017-10-11 19:52:01

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2017-10-12 07:49:23

I think the easiest solution would be to keep support for `$PIP_INSTALL` for now and simply revert the changes to `dot2tex` and `brial` on this ticket.


---

Comment by embray created at 2017-10-12 08:05:58

This isn't really very high priority so it can wait until those tickets are merged and then do as you said.


---

Comment by git created at 2017-10-12 08:22:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2017-10-12 08:53:44

Replying to [comment:4 embray]:
> This isn't really very high priority so it can wait until those tickets are merged and then do as you said.

The problem with waiting is that there could be new conflicting tickets popping up. But I will leave it to you to decide what to do.


---

Comment by embray created at 2017-10-12 10:03:38

Oh I see what you're saying now--keep `PIP_INSTALL` for now and still use it in brial and dot2tex.  Not exactly a happy thing but it makes sense.

The question is: Should I open a separate ticket for later removal of `PIP_INSTALL` entirely?  I think yes...


---

Comment by embray created at 2017-10-12 10:06:39

Note: This ticket did not change brial because it wasn't using pip to install the python package yet...


---

Comment by git created at 2017-10-12 10:09:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2017-10-12 10:12:06

Okay, put `PIP_INSTALL` back for now.  See #24018


---

Comment by embray created at 2017-10-12 10:12:06

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2017-10-12 10:35:55

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2017-10-12 10:35:55

In `appnope`, you removed the error check:

```diff
-    $PIP_INSTALL . || exit $?
+    sdh_pip_install .
```


Given that you did not add such a check to `sdh_pip_install` (it would make sense to do that though), this is wrong.


---

Comment by embray created at 2017-10-12 10:55:29

Hmm, yes--`sage-pip-install` already has reasonable error messages, but in the context of the `spkg-install` script we still need to handle errors in it.  Notably, `appnope` was the only package that had this error check at all (but in most cases it's the only command run so I guess it wasn't necessary).


---

Comment by git created at 2017-10-12 10:56:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2017-10-12 10:57:01

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2017-10-12 12:06:05

Diff looks good, I'm testing a build from scratch now.


---

Comment by jdemeyer created at 2017-10-12 13:05:02

Changing status from needs_review to positive_review.


---

Comment by embray created at 2017-10-12 13:23:05

Thanks!


---

Comment by vbraun created at 2017-10-20 09:15:03

Resolution: fixed
