# Issue 25729: Upgrade Arb to 2.14.0

Issue created by migration from Trac.

Original creator: fredrik.johansson

Original creation time: 2018-07-28 20:32:23

CC:  @timokau jdemeyer




---

Comment by fredrik.johansson created at 2018-07-28 20:53:45

Changing type from PLEASE CHANGE to enhancement.


---

Comment by fredrik.johansson created at 2018-07-28 20:53:45

New commits:


---

Comment by fredrik.johansson created at 2018-07-28 20:53:45

Changing component from PLEASE CHANGE to packages: standard.


---

Comment by fredrik.johansson created at 2018-07-28 20:53:45

Changing status from new to needs_review.


---

Comment by tscrim created at 2018-07-30 07:28:09

Buildbots ahoy! *cough*authorname*cough*


---

Comment by tscrim created at 2018-07-30 07:28:09

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-08-06 21:42:55

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2018-08-06 21:42:55


```
**********************************************************************
File "src/sage/rings/complex_arb.pyx", line 1029, in sage.rings.complex_arb.ComplexBallField.?
Failed example:
    C.integral(lambda x, _: (x + x.exp()).sin(), 0, 8) # long time
Expected:
    [0.34740017...55347713 +/- 6.72e-598]
Got:
    [0.347400172657247807879512159119893124657456254866180183885492713616748213988785320529685104346604105756813796172006018707302714228197618073704004353678452866627436279471970216410908716043577412909956068587776704710948691279593004567821091508925369957240639547298886452332685264381903039098870525160076005978168808062746564134987731050142119306346307812114504420398584159417131096900798039662018221641127266271301569159908541386062975763888813212164702872661085356464323603726722886936732008463756755254875678750234857309302489895429562039632272592695502596880447563060128384223515181416786355347713 +/- 5.71e-598]
**********************************************************************
1 item had failures:
   1 of  56 in sage.rings.complex_arb.ComplexBallField.?
    [622 tests, 1 failure, 3.69 s]
----------------------------------------------------------------------
sage -t --long src/sage/rings/complex_arb.pyx  # 1 doctest failed
----------------------------------------------------------------------
```



---

Comment by tscrim created at 2018-08-06 22:15:13

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-08-06 22:15:13

I must have done the same thing and not run `--long`. Mea culpa. Fixed.
----
New commits:


---

Comment by fredrik.johansson created at 2018-08-07 02:48:44

Am I allowed to give the positive review to the reviewer's patch? Are we waiting for other reviewing?


---

Comment by tscrim created at 2018-08-07 03:00:09

Replying to [comment:8 fredrik.johansson]:
> Am I allowed to give the positive review to the reviewer's patch?

Yes.

> Are we waiting for other reviewing?

Not that I am aware of.


---

Comment by fredrik.johansson created at 2018-08-07 06:20:54

Unfortunately Sage fails to build for me right now (for unrelated reasons) so I can't verify that the tests pass.


---

Comment by @timokau created at 2018-08-07 09:57:15

Changing status from needs_review to positive_review.


---

Comment by @timokau created at 2018-08-07 09:57:15

Tests pass.


---

Comment by @timokau created at 2018-08-07 10:04:22

In the future it would be preferable to make use of `# abs tol 1e-42` feature to reduce the doctest precision. It would make the doctests less brittle.


---

Comment by vbraun created at 2018-08-09 21:27:50

Resolution: fixed


---

Comment by mmezzarobba created at 2018-08-14 16:57:35

Replying to [comment:12 gh-timokau]:
> In the future it would be preferable to make use of `# abs tol 1e-42` feature to reduce the doctest precision. It would make the doctests less brittle.

See the discussion at #18560. IMO it would be time to switch to using tolerances indeed. Jeroen, did you view of the issue change since that ticket?


---

Comment by fredrik.johansson created at 2018-08-16 14:09:31

Differences when upgrading Arb are not a big issue IMO. In fact, it's helpful (for me) to look at the Sage doctests to see what improved or got worse between two versions. However, divergence between 32-bit and 64-bit results is plausible in the future and tolerances may be the best solution for that.


---

Comment by @timokau created at 2018-08-16 15:06:03

Replying to [comment:15 fredrik.johansson]:
> Differences when upgrading Arb are not a big issue IMO. In fact, it's helpful (for me) to look at the Sage doctests to see what improved or got worse between two versions. However, divergence between 32-bit and 64-bit results is plausible in the future and tolerances may be the best solution for that.

They are an issue when using sage outside of sage-the-distribution. They make it necessary that either the arb version used is the exact arb version sage-the-distribution uses or that patches are applied to sage. With tolerances we could potentially update sage and arb independently. And this is not only an issue for distributions. It could in the long run also allow sage-the-distribution to use the system's arb version (#24919).

In my opinion ideal sage tests should only fail if something is actually broken in sage, upstream projects or packaging. "broken" here may be an actual error or a api change.
