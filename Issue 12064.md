# Issue 12064: random element madness

archive/issues_012064.json:
```json
{
    "body": "Assignee: AlexGhitza\n\nThe following output is generated by the code below using\nsage-4.7.2:\n\n\n```\nR: Univariate Quotient Polynomial Ring in xbar over Ring of integers modulo 2 with modulus x^4 + 1\nS: Quotient of Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x^4 + 1 by the ideal (2)\nNow these two rings are isomorphic, but constructed in different orders, so it is not that surprising that SAGE considers them to be different:\nR == S: False\nAnd random_element on R seems sensible:\n[xbar^3 + xbar + 1, xbar^3 + xbar^2 + 1, xbar^2 + xbar, xbar^2, 1, xbar^2 + xbar, xbar^3, xbar^3, xbar^3 + xbar^2, xbar^2 + xbar + 1]\nBut random_element on S just doesn't make sense on several levels:\n[2, 1, -2, 2, 2, 0, 1, 0, 2, -2]\n1) Why are there no polynomial powers?\n2) Why are the integers not reduced modulo 2?\n```\n\n\nHere is the code:\n\n\n```\ndef print_random_elements(R, num_elts=10):\n    R_elts = [R.random_element() for i in range(num_elts)]\n    print R_elts\n\ndef madness():\n    U.<x> = ZZ[]\n    f = x^4 + 1\n    p = 2\n    num_elts = 10\n\n    S = U.quotient(f).quotient(p)\n\n    #S.<x> = Integers(p)[]\n    #S1 = S.quotient(f)\n    R = (Integers(p)['x']).quotient(f)\n    \n    print 'R:', R\n    print 'S:', S\n    print '''Now these two rings are isomorphic, but constructed in different\norders, so it is not that surprising that SAGE considers them to\nbe different:'''\n\n    print \"R == S:\", R == S\n\n    print 'And random_element on R seems sensible:'\n    print_random_elements(R)\n\n    print \"But random_element on S just doesn't make sense on several levels:\"\n    print_random_elements(S)\n    print \"1) Why are there no polynomial powers?\"\n    print \"2) Why are the integers not reduced modulo %s?\" % p\n\n\nmadness()\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12236\n\n",
    "created_at": "2011-12-30T15:53:15Z",
    "labels": [
        "basic arithmetic",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "random element madness",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12064",
    "user": "mariah"
}
```
Assignee: AlexGhitza

The following output is generated by the code below using
sage-4.7.2:


```
R: Univariate Quotient Polynomial Ring in xbar over Ring of integers modulo 2 with modulus x^4 + 1
S: Quotient of Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x^4 + 1 by the ideal (2)
Now these two rings are isomorphic, but constructed in different orders, so it is not that surprising that SAGE considers them to be different:
R == S: False
And random_element on R seems sensible:
[xbar^3 + xbar + 1, xbar^3 + xbar^2 + 1, xbar^2 + xbar, xbar^2, 1, xbar^2 + xbar, xbar^3, xbar^3, xbar^3 + xbar^2, xbar^2 + xbar + 1]
But random_element on S just doesn't make sense on several levels:
[2, 1, -2, 2, 2, 0, 1, 0, 2, -2]
1) Why are there no polynomial powers?
2) Why are the integers not reduced modulo 2?
```


Here is the code:


```
def print_random_elements(R, num_elts=10):
    R_elts = [R.random_element() for i in range(num_elts)]
    print R_elts

def madness():
    U.<x> = ZZ[]
    f = x^4 + 1
    p = 2
    num_elts = 10

    S = U.quotient(f).quotient(p)

    #S.<x> = Integers(p)[]
    #S1 = S.quotient(f)
    R = (Integers(p)['x']).quotient(f)
    
    print 'R:', R
    print 'S:', S
    print '''Now these two rings are isomorphic, but constructed in different
orders, so it is not that surprising that SAGE considers them to
be different:'''

    print "R == S:", R == S

    print 'And random_element on R seems sensible:'
    print_random_elements(R)

    print "But random_element on S just doesn't make sense on several levels:"
    print_random_elements(S)
    print "1) Why are there no polynomial powers?"
    print "2) Why are the integers not reduced modulo %s?" % p


madness()
```


Issue created by migration from https://trac.sagemath.org/ticket/12236





---

archive/issue_comments_139934.json:
```json
{
    "body": "I have a patch to address some of this that I will post as soon as I can, but there are two issues here, which are identified above.\n\nIssue 1 is a \"feature\" of QuotientRing_generic that I am still getting to the bottom of, but notice, here\n\nThis appears to be related to the following error:\n\n\n```\nsage: ZZ['x'].quotient(2 * ZZ)\n...\nTypeError: polynomial must have unit leading coefficient\n```\n\n\ni.e., polynomial rings seem to expect that, if you mod out by an ideal, it should be a polynomial, which isn't the case if you are trying to mod out by an ideal in the base ring.\n\nThis seems to raise other issues with integer ideals interacting with polynomials rings, e.g.,\n\n\n```\nsage: ZZ['x'].quotient(ZZ['x'].ideal([x^4 + 1, 2])).quotient(2)\nQuotient of Univariate Polynomial Ring in x over Integer Ring by the ideal (2, x^4 + 1, 2)\nsage: ZZ['x'].quotient(ZZ['x'].ideal([x^4 + 1, 2])).quotient(2)(2)\n2\n```\n\n\n:(\n\nIssue 2 raised above has to do with ideal.reduce(): the default implementation is being called, which just gives a pass-through, i.e.,\n\n\n```\nsage: Integers(2).ideal().reduce(2)\n2\n```\n\n\nAt the very least, this should be coercing its argument into its base ring.",
    "created_at": "2012-01-22T03:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12064#issuecomment-139934",
    "user": "swenson"
}
```

I have a patch to address some of this that I will post as soon as I can, but there are two issues here, which are identified above.

Issue 1 is a "feature" of QuotientRing_generic that I am still getting to the bottom of, but notice, here

This appears to be related to the following error:


```
sage: ZZ['x'].quotient(2 * ZZ)
...
TypeError: polynomial must have unit leading coefficient
```


i.e., polynomial rings seem to expect that, if you mod out by an ideal, it should be a polynomial, which isn't the case if you are trying to mod out by an ideal in the base ring.

This seems to raise other issues with integer ideals interacting with polynomials rings, e.g.,


```
sage: ZZ['x'].quotient(ZZ['x'].ideal([x^4 + 1, 2])).quotient(2)
Quotient of Univariate Polynomial Ring in x over Integer Ring by the ideal (2, x^4 + 1, 2)
sage: ZZ['x'].quotient(ZZ['x'].ideal([x^4 + 1, 2])).quotient(2)(2)
2
```


:(

Issue 2 raised above has to do with ideal.reduce(): the default implementation is being called, which just gives a pass-through, i.e.,


```
sage: Integers(2).ideal().reduce(2)
2
```


At the very least, this should be coercing its argument into its base ring.



---

archive/issue_comments_139935.json:
```json
{
    "body": "Changing assignee from AlexGhitza to swenson.",
    "created_at": "2012-01-22T03:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12064#issuecomment-139935",
    "user": "swenson"
}
```

Changing assignee from AlexGhitza to swenson.



---

archive/issue_comments_139936.json:
```json
{
    "body": "Sorry -- didn't mean to steal this from AlexGhitza",
    "created_at": "2012-01-22T04:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12064#issuecomment-139936",
    "user": "swenson"
}
```

Sorry -- didn't mean to steal this from AlexGhitza



---

archive/issue_comments_139937.json:
```json
{
    "body": "Changing assignee from swenson to AlexGhitza.",
    "created_at": "2012-01-22T04:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12064#issuecomment-139937",
    "user": "swenson"
}
```

Changing assignee from swenson to AlexGhitza.



---

archive/issue_comments_139938.json:
```json
{
    "body": "I think that, at least for now, we should just throw an error if you try to quotient out a polynomial ring by an ideal of the base ring since you get a \"broken\" object.",
    "created_at": "2012-05-28T18:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12064#issuecomment-139938",
    "user": "mhansen"
}
```

I think that, at least for now, we should just throw an error if you try to quotient out a polynomial ring by an ideal of the base ring since you get a "broken" object.
