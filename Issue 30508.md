# Issue 30508: homebrew: Errors when homebrew's ntl, flint, or ecl are installed in /usr/local

archive/issues_030508.json:
```json
{
    "body": "CC:  @dimpase @jhpalmieri @vbraun @nbruin @kiwifb\n\n- ntl/flint: https://groups.google.com/d/msg/sage-devel/KXK_zxzfhIQ/0MaSLhvMAAAJ\n- ecl: Reported in https://groups.google.com/d/msg/sage-devel/gFaUNw4v3aw/P-dTJ5IOCgAJ\n\n`/usr/local` is leaking into our build, through wrong orders of include and/or library directives.\n\nBlocker for 9.2 because it affects a major supported platform. We should at least give a configure-time error if these installations are found on homebrew if we cannot fix this.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30745\n\n",
    "created_at": "2020-10-08T16:12:29Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "homebrew: Errors when homebrew's ntl, flint, or ecl are installed in /usr/local",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30508",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @dimpase @jhpalmieri @vbraun @nbruin @kiwifb

- ntl/flint: https://groups.google.com/d/msg/sage-devel/KXK_zxzfhIQ/0MaSLhvMAAAJ
- ecl: Reported in https://groups.google.com/d/msg/sage-devel/gFaUNw4v3aw/P-dTJ5IOCgAJ

`/usr/local` is leaking into our build, through wrong orders of include and/or library directives.

Blocker for 9.2 because it affects a major supported platform. We should at least give a configure-time error if these installations are found on homebrew if we cannot fix this.

Issue created by migration from https://trac.sagemath.org/ticket/30745





---

archive/issue_comments_434991.json:
```json
{
    "body": "upstream ecl is indeed useless, as no known to me distro (gentoo, homebrew) provides sufficiently patched ecl-20.\nSo we can have a spkg-configure.m4 for it, erroring out if it's found, on any distro.\n\n\nperhaps ntl/flint/singular combo on homebrew is good enough for Sage?",
    "created_at": "2020-10-08T16:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-434991",
    "user": "https://github.com/dimpase"
}
```

upstream ecl is indeed useless, as no known to me distro (gentoo, homebrew) provides sufficiently patched ecl-20.
So we can have a spkg-configure.m4 for it, erroring out if it's found, on any distro.


perhaps ntl/flint/singular combo on homebrew is good enough for Sage?



---

archive/issue_comments_434992.json:
```json
{
    "body": "Traditionally build systems are supposed to pick up stuff in /usr/local, so its a bit of a feature. Gentoo doesn't install anything there afaik, it is intended for stuff that users install by hand (i.e. non-portage in Gentoo). I consider it the big homebrew WTF. \n\nRealistically, if you have stuff installed in /usr/local then you don't have a supported platform any more. Sure we should try to accommodate homebrew but imho not a blocker.",
    "created_at": "2020-10-10T23:51:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-434992",
    "user": "https://github.com/vbraun"
}
```

Traditionally build systems are supposed to pick up stuff in /usr/local, so its a bit of a feature. Gentoo doesn't install anything there afaik, it is intended for stuff that users install by hand (i.e. non-portage in Gentoo). I consider it the big homebrew WTF. 

Realistically, if you have stuff installed in /usr/local then you don't have a supported platform any more. Sure we should try to accommodate homebrew but imho not a blocker.



---

archive/issue_comments_434993.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-10-11T01:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-434993",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_434994.json:
```json
{
    "body": "Replying to [comment:3 vbraun]:\n> Realistically, if you have stuff installed in /usr/local then you don't have a supported platform any more. Sure we should try to accommodate homebrew but imho not a blocker.\n\nGiven that since Sage 9.1, we recommend homebrew packages that the user should install, I don't think the view that a system with homebrew installed in `/usr/local` is not a \"supported platform\" has much practical value.\n\nSetting it to \"critical\" rather than \"blocker\" because there is, of course, an easy remedy - just uninstall the useless homebrew packages that cause the problem.",
    "created_at": "2020-10-11T01:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-434994",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:3 vbraun]:
> Realistically, if you have stuff installed in /usr/local then you don't have a supported platform any more. Sure we should try to accommodate homebrew but imho not a blocker.

Given that since Sage 9.1, we recommend homebrew packages that the user should install, I don't think the view that a system with homebrew installed in `/usr/local` is not a "supported platform" has much practical value.

Setting it to "critical" rather than "blocker" because there is, of course, an easy remedy - just uninstall the useless homebrew packages that cause the problem.



---

archive/issue_comments_434995.json:
```json
{
    "body": "Replying to [comment:3 vbraun]:\n> Traditionally build systems are supposed to pick up stuff in /usr/local, so its a bit of a feature. Gentoo doesn't install anything there afaik, it is intended for stuff that users install by hand (i.e. non-portage in Gentoo). I consider it the big homebrew WTF. \n> \n> Realistically, if you have stuff installed in /usr/local then you don't have a supported platform any more. Sure we should try to accommodate homebrew but imho not a blocker.\n\nDespite your personal misgivings about Homebrew, this is a non-starter, Volker, sorry. Homebrew is the  most popular macOS package manager out there, and it goes without saying that we want to support as many packages there as possible, and hopefully have a proper Homebrew Sage package.\n\nAs well, many *BSD systems install their packages in /usr/local, e.g. FreeBSD (where we now have a semi-working native package, with all the deps neatly divided into native packages), OpenBSD, etc.",
    "created_at": "2020-10-11T09:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-434995",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:3 vbraun]:
> Traditionally build systems are supposed to pick up stuff in /usr/local, so its a bit of a feature. Gentoo doesn't install anything there afaik, it is intended for stuff that users install by hand (i.e. non-portage in Gentoo). I consider it the big homebrew WTF. 
> 
> Realistically, if you have stuff installed in /usr/local then you don't have a supported platform any more. Sure we should try to accommodate homebrew but imho not a blocker.

Despite your personal misgivings about Homebrew, this is a non-starter, Volker, sorry. Homebrew is the  most popular macOS package manager out there, and it goes without saying that we want to support as many packages there as possible, and hopefully have a proper Homebrew Sage package.

As well, many *BSD systems install their packages in /usr/local, e.g. FreeBSD (where we now have a semi-working native package, with all the deps neatly divided into native packages), OpenBSD, etc.



---

archive/issue_comments_434996.json:
```json
{
    "body": "Trying this with `tox -e local-homebrew-usrlocal-standard`. Building the ecl extension uses the following command line:\n\n```\ngcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk -I/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/usr/include -I/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/System/Library/Frameworks/Tk.framework/Versions/8.5/Headers -Isage/libs -I./sage/cpython -I/Users/mkoeppe/s/sage/sage-rebasing/.tox/local-homebrew-usrlocal-standard/local/lib/python3.8/site-packages/cysignals -I/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/sagelib/src -I/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/sagelib/src/sage/ext -I/usr/local/Cellar/python@3.8/3.8.6/Frameworks/Python.framework/Versions/3.8/include/python3.8 -I/Users/mkoeppe/s/sage/sage-rebasing/.tox/local-homebrew-usrlocal-standard/local/lib/python3.8/site-packages/numpy/core/include -Ibuild/cythonized -I/usr/local/include -I/usr/local/opt/openssl@1.1/include -I/usr/local/opt/sqlite/include -I/Users/mkoeppe/s/sage/sage-rebasing/.tox/local-homebrew-usrlocal-standard/local/include -I/usr/local/Cellar/python@3.8/3.8.6/Frameworks/Python.framework/Versions/3.8/include/python3.8 -c build/cythonized/sage/libs/ecl.c -o build/temp.macosx-10.15-x86_64-3.8/build/cythonized/sage/libs/ecl.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -std=c99\n```\n\nwhich indeed has `/usr/local/include` in front of `$SAGE_LOCAL/include`. (There is also `CPATH`, which is set to `$SAGE_LOCAL/include`; but `CPATH` is searched \"after any paths given with -I options on the command line\" - https://gcc.gnu.org/onlinedocs/gcc/Environment-Variables.html)",
    "created_at": "2020-10-15T03:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-434996",
    "user": "https://github.com/mkoeppe"
}
```

Trying this with `tox -e local-homebrew-usrlocal-standard`. Building the ecl extension uses the following command line:

```
gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk -I/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/usr/include -I/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/System/Library/Frameworks/Tk.framework/Versions/8.5/Headers -Isage/libs -I./sage/cpython -I/Users/mkoeppe/s/sage/sage-rebasing/.tox/local-homebrew-usrlocal-standard/local/lib/python3.8/site-packages/cysignals -I/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/sagelib/src -I/Users/mkoeppe/s/sage/sage-rebasing/build/pkgs/sagelib/src/sage/ext -I/usr/local/Cellar/python@3.8/3.8.6/Frameworks/Python.framework/Versions/3.8/include/python3.8 -I/Users/mkoeppe/s/sage/sage-rebasing/.tox/local-homebrew-usrlocal-standard/local/lib/python3.8/site-packages/numpy/core/include -Ibuild/cythonized -I/usr/local/include -I/usr/local/opt/openssl@1.1/include -I/usr/local/opt/sqlite/include -I/Users/mkoeppe/s/sage/sage-rebasing/.tox/local-homebrew-usrlocal-standard/local/include -I/usr/local/Cellar/python@3.8/3.8.6/Frameworks/Python.framework/Versions/3.8/include/python3.8 -c build/cythonized/sage/libs/ecl.c -o build/temp.macosx-10.15-x86_64-3.8/build/cythonized/sage/libs/ecl.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -std=c99
```

which indeed has `/usr/local/include` in front of `$SAGE_LOCAL/include`. (There is also `CPATH`, which is set to `$SAGE_LOCAL/include`; but `CPATH` is searched "after any paths given with -I options on the command line" - https://gcc.gnu.org/onlinedocs/gcc/Environment-Variables.html)



---

archive/issue_comments_434997.json:
```json
{
    "body": "A related recent change was made in #29697 (`sage_include_directories`: Do not add another copy of SAGE_INC, SAGE_LOCAL/lib to include dirs, library dirs).",
    "created_at": "2020-10-15T03:16:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-434997",
    "user": "https://github.com/mkoeppe"
}
```

A related recent change was made in #29697 (`sage_include_directories`: Do not add another copy of SAGE_INC, SAGE_LOCAL/lib to include dirs, library dirs).



---

archive/issue_comments_434998.json:
```json
{
    "body": "The correct fix for `ecl` is probably to call `ecl-config` to determine the correct flags. #30770",
    "created_at": "2020-10-15T03:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-434998",
    "user": "https://github.com/mkoeppe"
}
```

The correct fix for `ecl` is probably to call `ecl-config` to determine the correct flags. #30770



---

archive/issue_comments_434999.json:
```json
{
    "body": "arb, ntl, and flint can and should just be enabled on Homebrew. ECL is a different story, as it lacks patches.",
    "created_at": "2020-10-20T15:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-434999",
    "user": "https://github.com/dimpase"
}
```

arb, ntl, and flint can and should just be enabled on Homebrew. ECL is a different story, as it lacks patches.



---

archive/issue_comments_435000.json:
```json
{
    "body": "It's not quite that easy, I am afraid. There are still the threading issues such as #27764",
    "created_at": "2020-10-21T00:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435000",
    "user": "https://github.com/mkoeppe"
}
```

It's not quite that easy, I am afraid. There are still the threading issues such as #27764



---

archive/issue_comments_435001.json:
```json
{
    "body": "Replying to [comment:10 mkoeppe]:\n> It's not quite that easy, I am afraid. There are still the threading issues such as #27764\nthese issues have solved themselves - I am able to build and doctest on macOS 10.15.7 with arb, ntl, flint from Homebrew just fine\n(with #30805 and doctest patches from the Flint 2.6 upgrade ticket).",
    "created_at": "2020-10-21T09:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435001",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:10 mkoeppe]:
> It's not quite that easy, I am afraid. There are still the threading issues such as #27764
these issues have solved themselves - I am able to build and doctest on macOS 10.15.7 with arb, ntl, flint from Homebrew just fine
(with #30805 and doctest patches from the Flint 2.6 upgrade ticket).



---

archive/issue_comments_435002.json:
```json
{
    "body": "more precisely, I see 2 doctests failing in `src/sage/rings/polynomial/plural.pyx` - not sure if this is related. The rest of `make ptest` passes.",
    "created_at": "2020-10-21T10:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435002",
    "user": "https://github.com/dimpase"
}
```

more precisely, I see 2 doctests failing in `src/sage/rings/polynomial/plural.pyx` - not sure if this is related. The rest of `make ptest` passes.



---

archive/issue_comments_435003.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-16T22:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435003",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_435004.json:
```json
{
    "body": "my tests show that we can use Homebrew's NTL, arb, and flint, and with flint 2.6.3 patches in it's time to advertise them.\n\nFor testing, don't forget to ran `make arb-clean ntl-clean flint-clean` after installing them in Homebrew.\n----\nNew commits:",
    "created_at": "2020-11-16T22:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435004",
    "user": "https://github.com/dimpase"
}
```

my tests show that we can use Homebrew's NTL, arb, and flint, and with flint 2.6.3 patches in it's time to advertise them.

For testing, don't forget to ran `make arb-clean ntl-clean flint-clean` after installing them in Homebrew.
----
New commits:



---

archive/issue_comments_435005.json:
```json
{
    "body": "Changing component from build to build: configure.",
    "created_at": "2020-11-16T22:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435005",
    "user": "https://github.com/dimpase"
}
```

Changing component from build to build: configure.



---

archive/issue_comments_435006.json:
```json
{
    "body": "I'm getting some doctest errors, apparently from this. This is on OS X Big Sur with a beta release of Xcode 12.3, Sage 9.3.beta1 built from scratch:\n\n```\nFile \"src/sage/modules/fg_pid/fgp_module.py\", line 130, in sage.modules.fg_pid.fgp_module\nFailed example:\n    y = f.lift(3*M1.0); y\nExpected:\n    (0, 13)\nGot:\n    (1, 0)\n**********************************************************************\nFile \"src/sage/modules/fg_pid/fgp_module.py\", line 1288, in sage.modules.fg_pid.fgp_module.FGP_Module_class.coordinate_vector\nFailed example:\n    Q.coordinate_vector(-x, reduce=False)\nExpected:\n    (0, -4)\nGot:\n    (0, 8)\n**********************************************************************\nFile \"src/sage/modules/fg_pid/fgp_module.py\", line 1417, in sage.modules.fg_pid.fgp_module.FGP_Module_class.optimized\nFailed example:\n    X\nExpected:\n    [0 4 0]\n    [0 1 0]\n    [0 0 1]\nGot:\n    [ 0 -8  0]\n    [ 0  1  0]\n    [ 0  0  1]\n**********************************************************************\n3 items had failures:\n   1 of  45 in sage.modules.fg_pid.fgp_module\n   1 of  23 in sage.modules.fg_pid.fgp_module.FGP_Module_class.coordinate_vector\n   1 of  11 in sage.modules.fg_pid.fgp_module.FGP_Module_class.optimized\n    [396 tests, 3 failures, 9.12 s]\n```\n\nand\n\n```\nsage -t --long --warn-long 198.4 --random-seed=0 src/sage/rings/polynomial/plural.pyx\n**********************************************************************\nFile \"src/sage/rings/polynomial/plural.pyx\", line 401, in sage.rings.polynomial.plural.NCPolynomialRing_plural.__dealloc__\nFailed example:\n    R2 = A2.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2))\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/palmieri/Sage/TESTING/sage-9.3.beta1/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 720, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/palmieri/Sage/TESTING/sage-9.3.beta1/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1145, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.polynomial.plural.NCPolynomialRing_plural.__dealloc__[6]>\", line 1, in <module>\n        R2 = A2.g_algebra({y*x:x*y-z, z*x:x*z+Integer(2)*x, z*y:y*z-Integer(2)*y}, order=TermOrder('degrevlex', Integer(2)))\n      File \"/Users/palmieri/Sage/TESTING/sage-9.3.beta1/local/lib/python3.9/site-packages/sage/algebras/free_algebra.py\", line 873, in g_algebra\n        return g_Algebra(base_ring, cmat, dmat, names = names or self.variable_names(),\n      File \"sage/structure/factory.pyx\", line 369, in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:2258)\n        return self.get_object(version, key, kwds)\n      File \"sage/structure/factory.pyx\", line 412, in sage.structure.factory.UniqueFactory.get_object (build/cythonized/sage/structure/factory.c:2652)\n        obj = self.create_object(version, key, **extra_args)\n      File \"sage/rings/polynomial/plural.pyx\", line 176, in sage.rings.polynomial.plural.G_AlgFactory.create_object (build/cythonized/sage/rings/polynomial/plural.cpp:5470)\n        return NCPolynomialRing_plural(base_ring, names, c, d, order,\n      File \"sage/rings/polynomial/plural.pyx\", line 334, in sage.rings.polynomial.plural.NCPolynomialRing_plural.__init__ (build/cythonized/sage/rings/polynomial/plural.cpp:6549)\n        cdef RingWrap rw = ncalgebra(self._c, self._d, ring = P)\n      File \"sage/libs/singular/function.pyx\", line 1334, in sage.libs.singular.function.SingularFunction.__call__ (build/cythonized/sage/libs/singular/function.cpp:15148)\n        return call_function(self, args, ring, interruptible, attributes)\n      File \"sage/libs/singular/function.pyx\", line 1516, in sage.libs.singular.function.call_function (build/cythonized/sage/libs/singular/function.cpp:16998)\n        with opt_ctx: # we are preserving the global options state here\n      File \"sage/libs/singular/function.pyx\", line 1518, in sage.libs.singular.function.call_function (build/cythonized/sage/libs/singular/function.cpp:16910)\n        sig_on()\n    cysignals.signals.SignalError: Segmentation fault\n```\n\nand\n\n```\nFile \"src/sage/modules/free_module_morphism.py\", line 353, in sage.modules.free_module_morphism.FreeModuleMorphism.lift\nFailed example:\n    f.lift([1/3])\nExpected:\n    (8, -16)\nGot:\n    (20, -48)\n**********************************************************************\nFile \"src/sage/modules/free_module_morphism.py\", line 355, in sage.modules.free_module_morphism.FreeModuleMorphism.lift\nFailed example:\n    f.lift([1/2])\nExpected:\n    (12, -24)\nGot:\n    (30, -72)\n**********************************************************************\nFile \"src/sage/modules/free_module_morphism.py\", line 357, in sage.modules.free_module_morphism.FreeModuleMorphism.lift\nFailed example:\n    f.lift([1/6])\nExpected:\n    (4, -8)\nGot:\n    (10, -24)\n**********************************************************************\n1 item had failures:\n   3 of  22 in sage.modules.free_module_morphism.FreeModuleMorphism.lift\n```\n\nand\n\n```\n**********************************************************************\nFile \"src/doc/en/constructions/algebraic_geometry.rst\", line 145, in doc.en.constructions.algebraic_geometry\nFailed example:\n    print(L)\nExpected:\n    [1]:\n       _[1]=y    \n       _[2]=x    \n    ...\nGot:\n    [1]:\n       _[1]=y^2+y+1\n       _[2]=x+1\n    [2]:\n       _[1]=y^2+y+1\n       _[2]=x+y+1\n    [3]:\n       _[1]=y^2+y+1\n       _[2]=x+y\n    [4]:\n       _[1]=y^2+y+1\n       _[2]=x\n    [5]:\n       _[1]=y+1\n       _[2]=x^2+x+1\n    [6]:\n       _[1]=y+1\n       _[2]=x+1\n    [7]:\n       _[1]=y+1\n       _[2]=x\n    [8]:\n       _[1]=y\n       _[2]=x^2+x+1\n    [9]:\n       _[1]=y\n       _[2]=x+1\n    [10]:\n       _[1]=y\n       _[2]=x\n```\n\nand maybe one or two others.",
    "created_at": "2020-11-17T17:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435006",
    "user": "https://github.com/jhpalmieri"
}
```

I'm getting some doctest errors, apparently from this. This is on OS X Big Sur with a beta release of Xcode 12.3, Sage 9.3.beta1 built from scratch:

```
File "src/sage/modules/fg_pid/fgp_module.py", line 130, in sage.modules.fg_pid.fgp_module
Failed example:
    y = f.lift(3*M1.0); y
Expected:
    (0, 13)
Got:
    (1, 0)
**********************************************************************
File "src/sage/modules/fg_pid/fgp_module.py", line 1288, in sage.modules.fg_pid.fgp_module.FGP_Module_class.coordinate_vector
Failed example:
    Q.coordinate_vector(-x, reduce=False)
Expected:
    (0, -4)
Got:
    (0, 8)
**********************************************************************
File "src/sage/modules/fg_pid/fgp_module.py", line 1417, in sage.modules.fg_pid.fgp_module.FGP_Module_class.optimized
Failed example:
    X
Expected:
    [0 4 0]
    [0 1 0]
    [0 0 1]
Got:
    [ 0 -8  0]
    [ 0  1  0]
    [ 0  0  1]
**********************************************************************
3 items had failures:
   1 of  45 in sage.modules.fg_pid.fgp_module
   1 of  23 in sage.modules.fg_pid.fgp_module.FGP_Module_class.coordinate_vector
   1 of  11 in sage.modules.fg_pid.fgp_module.FGP_Module_class.optimized
    [396 tests, 3 failures, 9.12 s]
```

and

```
sage -t --long --warn-long 198.4 --random-seed=0 src/sage/rings/polynomial/plural.pyx
**********************************************************************
File "src/sage/rings/polynomial/plural.pyx", line 401, in sage.rings.polynomial.plural.NCPolynomialRing_plural.__dealloc__
Failed example:
    R2 = A2.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2))
Exception raised:
    Traceback (most recent call last):
      File "/Users/palmieri/Sage/TESTING/sage-9.3.beta1/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 720, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/palmieri/Sage/TESTING/sage-9.3.beta1/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 1145, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.polynomial.plural.NCPolynomialRing_plural.__dealloc__[6]>", line 1, in <module>
        R2 = A2.g_algebra({y*x:x*y-z, z*x:x*z+Integer(2)*x, z*y:y*z-Integer(2)*y}, order=TermOrder('degrevlex', Integer(2)))
      File "/Users/palmieri/Sage/TESTING/sage-9.3.beta1/local/lib/python3.9/site-packages/sage/algebras/free_algebra.py", line 873, in g_algebra
        return g_Algebra(base_ring, cmat, dmat, names = names or self.variable_names(),
      File "sage/structure/factory.pyx", line 369, in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:2258)
        return self.get_object(version, key, kwds)
      File "sage/structure/factory.pyx", line 412, in sage.structure.factory.UniqueFactory.get_object (build/cythonized/sage/structure/factory.c:2652)
        obj = self.create_object(version, key, **extra_args)
      File "sage/rings/polynomial/plural.pyx", line 176, in sage.rings.polynomial.plural.G_AlgFactory.create_object (build/cythonized/sage/rings/polynomial/plural.cpp:5470)
        return NCPolynomialRing_plural(base_ring, names, c, d, order,
      File "sage/rings/polynomial/plural.pyx", line 334, in sage.rings.polynomial.plural.NCPolynomialRing_plural.__init__ (build/cythonized/sage/rings/polynomial/plural.cpp:6549)
        cdef RingWrap rw = ncalgebra(self._c, self._d, ring = P)
      File "sage/libs/singular/function.pyx", line 1334, in sage.libs.singular.function.SingularFunction.__call__ (build/cythonized/sage/libs/singular/function.cpp:15148)
        return call_function(self, args, ring, interruptible, attributes)
      File "sage/libs/singular/function.pyx", line 1516, in sage.libs.singular.function.call_function (build/cythonized/sage/libs/singular/function.cpp:16998)
        with opt_ctx: # we are preserving the global options state here
      File "sage/libs/singular/function.pyx", line 1518, in sage.libs.singular.function.call_function (build/cythonized/sage/libs/singular/function.cpp:16910)
        sig_on()
    cysignals.signals.SignalError: Segmentation fault
```

and

```
File "src/sage/modules/free_module_morphism.py", line 353, in sage.modules.free_module_morphism.FreeModuleMorphism.lift
Failed example:
    f.lift([1/3])
Expected:
    (8, -16)
Got:
    (20, -48)
**********************************************************************
File "src/sage/modules/free_module_morphism.py", line 355, in sage.modules.free_module_morphism.FreeModuleMorphism.lift
Failed example:
    f.lift([1/2])
Expected:
    (12, -24)
Got:
    (30, -72)
**********************************************************************
File "src/sage/modules/free_module_morphism.py", line 357, in sage.modules.free_module_morphism.FreeModuleMorphism.lift
Failed example:
    f.lift([1/6])
Expected:
    (4, -8)
Got:
    (10, -24)
**********************************************************************
1 item had failures:
   3 of  22 in sage.modules.free_module_morphism.FreeModuleMorphism.lift
```

and

```
**********************************************************************
File "src/doc/en/constructions/algebraic_geometry.rst", line 145, in doc.en.constructions.algebraic_geometry
Failed example:
    print(L)
Expected:
    [1]:
       _[1]=y    
       _[2]=x    
    ...
Got:
    [1]:
       _[1]=y^2+y+1
       _[2]=x+1
    [2]:
       _[1]=y^2+y+1
       _[2]=x+y+1
    [3]:
       _[1]=y^2+y+1
       _[2]=x+y
    [4]:
       _[1]=y^2+y+1
       _[2]=x
    [5]:
       _[1]=y+1
       _[2]=x^2+x+1
    [6]:
       _[1]=y+1
       _[2]=x+1
    [7]:
       _[1]=y+1
       _[2]=x
    [8]:
       _[1]=y
       _[2]=x^2+x+1
    [9]:
       _[1]=y
       _[2]=x+1
    [10]:
       _[1]=y
       _[2]=x
```

and maybe one or two others.



---

archive/issue_comments_435007.json:
```json
{
    "body": "most of these errors look like the things fixed in the branch of #29719 - which is marked as closed, but perhaps it's not in your/this branch yet?",
    "created_at": "2020-11-17T18:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435007",
    "user": "https://github.com/dimpase"
}
```

most of these errors look like the things fixed in the branch of #29719 - which is marked as closed, but perhaps it's not in your/this branch yet?



---

archive/issue_comments_435008.json:
```json
{
    "body": "The branch from #29719 is named `public/packages/flint260` - you can  try merging it and test again.",
    "created_at": "2020-11-17T20:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435008",
    "user": "https://github.com/dimpase"
}
```

The branch from #29719 is named `public/packages/flint260` - you can  try merging it and test again.



---

archive/issue_comments_435009.json:
```json
{
    "body": "I've tried on another computer (running OS X 10.15.7 this time), including the branch from #29719:\n\n```\nsage -t --long --random-seed=0 src/sage/functions/other.py  # 1 doctest failed\nsage -t --long --random-seed=0 src/sage/parallel/decorate.py  # 1 doctest failed\nsage -t --long --random-seed=0 src/sage/repl/preparse.py  # 12 doctests failed\nsage -t --long --random-seed=0 src/sage/rings/polynomial/plural.pyx  # 2 doctests failed\nsage -t --long --random-seed=0 src/sage/data_structures/mutable_poset.py  # 1 doctest failed\nsage -t --long --random-seed=0 src/sage/rings/polynomial/pbori/randompoly.py  # 1 doctest failed\n```\n\nMost of these are due to Python 3.9, but this is new:\n\n```\nsage -t --long --random-seed=0 src/sage/rings/polynomial/plural.pyx\n```\n\n(Details in the previous comment.)\n\nNot only is it new, but I see this error (a) with this branch (merged with #29719), but also (b) with homebrew's flint, ntl, and arb installed but with a standard `develop` branch from 9.3.beta1. If I remove those homebrew packages, the doctests pass. So just the presence of those packages is interfering with Sage's build somehow.",
    "created_at": "2020-11-17T23:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435009",
    "user": "https://github.com/jhpalmieri"
}
```

I've tried on another computer (running OS X 10.15.7 this time), including the branch from #29719:

```
sage -t --long --random-seed=0 src/sage/functions/other.py  # 1 doctest failed
sage -t --long --random-seed=0 src/sage/parallel/decorate.py  # 1 doctest failed
sage -t --long --random-seed=0 src/sage/repl/preparse.py  # 12 doctests failed
sage -t --long --random-seed=0 src/sage/rings/polynomial/plural.pyx  # 2 doctests failed
sage -t --long --random-seed=0 src/sage/data_structures/mutable_poset.py  # 1 doctest failed
sage -t --long --random-seed=0 src/sage/rings/polynomial/pbori/randompoly.py  # 1 doctest failed
```

Most of these are due to Python 3.9, but this is new:

```
sage -t --long --random-seed=0 src/sage/rings/polynomial/plural.pyx
```

(Details in the previous comment.)

Not only is it new, but I see this error (a) with this branch (merged with #29719), but also (b) with homebrew's flint, ntl, and arb installed but with a standard `develop` branch from 9.3.beta1. If I remove those homebrew packages, the doctests pass. So just the presence of those packages is interfering with Sage's build somehow.



---

archive/issue_comments_435010.json:
```json
{
    "body": "yes, I also see the error on `plural.pyx`, only on macOS with arb, ntl, flint from Homebrew.\nThis is very localised (and lighly used). I'd try to reproduce it in Singular directly, but it should not really prevent this branch being merged. \n\nAnyhow, arb has nothing to do with Singular, and I fail to see differences between ntl+flint from Homebrew and ntl+flint 2.6.3 from  #29719.\n\nThat ntl and flint install in Homebrew affect (lib)Singular linked with other instances of ntl and flint is a Singular bug. I'll report it.",
    "created_at": "2020-11-18T09:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435010",
    "user": "https://github.com/dimpase"
}
```

yes, I also see the error on `plural.pyx`, only on macOS with arb, ntl, flint from Homebrew.
This is very localised (and lighly used). I'd try to reproduce it in Singular directly, but it should not really prevent this branch being merged. 

Anyhow, arb has nothing to do with Singular, and I fail to see differences between ntl+flint from Homebrew and ntl+flint 2.6.3 from  #29719.

That ntl and flint install in Homebrew affect (lib)Singular linked with other instances of ntl and flint is a Singular bug. I'll report it.



---

archive/issue_comments_435011.json:
```json
{
    "body": "the `plural.pyx` doctest error iso a Heisenbug. The following, i.e. repeating a part of this test a bit earlier in the  lets the tests there pass for me. Needless to say, it cannot be reproduced in the Sage prompt, either.\n\n\n```diff\n--- a/src/sage/rings/polynomial/plural.pyx\n+++ b/src/sage/rings/polynomial/plural.pyx\n@@ -367,6 +367,8 @@ cdef class NCPolynomialRing_plural(Ring):\n             True\n             sage: H is loads(dumps(H))  # indirect doctest\n             True\n+            sage: A2.<x,y,z> = FreeAlgebra(GF(5), 3)\n+            sage: R2 = A2.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2))\n \n         Check that :trac:`17224` is fixed::\n \n```\n\nIf you like I can add this \"fix\" to the branch.\n\nalternatively, if I just change the order of tests, using `randorder` option, everything works too:\n\n```bash\n./sage -tp --random-seed=0 --randorder=42 --long src/sage/rings/polynomial/plural.pyx\n```\n",
    "created_at": "2020-11-18T11:34:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435011",
    "user": "https://github.com/dimpase"
}
```

the `plural.pyx` doctest error iso a Heisenbug. The following, i.e. repeating a part of this test a bit earlier in the  lets the tests there pass for me. Needless to say, it cannot be reproduced in the Sage prompt, either.


```diff
--- a/src/sage/rings/polynomial/plural.pyx
+++ b/src/sage/rings/polynomial/plural.pyx
@@ -367,6 +367,8 @@ cdef class NCPolynomialRing_plural(Ring):
             True
             sage: H is loads(dumps(H))  # indirect doctest
             True
+            sage: A2.<x,y,z> = FreeAlgebra(GF(5), 3)
+            sage: R2 = A2.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2))
 
         Check that :trac:`17224` is fixed::
 
```

If you like I can add this "fix" to the branch.

alternatively, if I just change the order of tests, using `randorder` option, everything works too:

```bash
./sage -tp --random-seed=0 --randorder=42 --long src/sage/rings/polynomial/plural.pyx
```




---

archive/issue_comments_435012.json:
```json
{
    "body": "That's sweeping things under the rug. Not necessarily the worst thing to do, but I wish there were an actual fix. I guess if we \"fix\" this now and upstream fixes the real bug pretty soon, it's a good approach.",
    "created_at": "2020-11-18T17:32:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435012",
    "user": "https://github.com/jhpalmieri"
}
```

That's sweeping things under the rug. Not necessarily the worst thing to do, but I wish there were an actual fix. I guess if we "fix" this now and upstream fixes the real bug pretty soon, it's a good approach.



---

archive/issue_comments_435013.json:
```json
{
    "body": "Replying to [comment:23 jhpalmieri]:\n> That's sweeping things under the rug. Not necessarily the worst thing to do, but I wish there were an actual fix. I guess if we \"fix\" this now and upstream fixes the real bug pretty soon, it's a good approach.\n\nYes, certainly, what I propose is not a real fix.\n\nJust reproducing the Heisenbug in question outside of the testing framework is a very tall order, leave alone fixing it. By the way, if I run the tests with `./sage -tp 8 src/sage/` then the bug does not show, either. Maybe it's a OS bug, who knows.",
    "created_at": "2020-11-18T17:58:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435013",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:23 jhpalmieri]:
> That's sweeping things under the rug. Not necessarily the worst thing to do, but I wish there were an actual fix. I guess if we "fix" this now and upstream fixes the real bug pretty soon, it's a good approach.

Yes, certainly, what I propose is not a real fix.

Just reproducing the Heisenbug in question outside of the testing framework is a very tall order, leave alone fixing it. By the way, if I run the tests with `./sage -tp 8 src/sage/` then the bug does not show, either. Maybe it's a OS bug, who knows.



---

archive/issue_comments_435014.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-18T19:19:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435014",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_435015.json:
```json
{
    "body": "ready for review",
    "created_at": "2020-11-18T21:04:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435015",
    "user": "https://github.com/dimpase"
}
```

ready for review



---

archive/issue_comments_435016.json:
```json
{
    "body": "This whole thing makes no sense to me. I agree that the problem is there with #29719. If instead of your change, I do this:\n\n```diff\ndiff --git a/src/sage/rings/polynomial/plural.pyx b/src/sage/rings/polynomial/plural.pyx\nindex c2792aec88..500253533a 100644\n--- a/src/sage/rings/polynomial/plural.pyx\n+++ b/src/sage/rings/polynomial/plural.pyx\n@@ -399,6 +399,8 @@ cdef class NCPolynomialRing_plural(Ring):\n             sage: R1 = A1.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2))\n             sage: A2.<x,y,z> = FreeAlgebra(GF(5), 3)\n             sage: R2 = A2.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2))\n+            sage: A2.<x,y,z> = FreeAlgebra(GF(5), 3)\n+            sage: R2 = A2.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2))\n             sage: A3.<x,y,z> = FreeAlgebra(GF(11), 3)\n             sage: R3 = A3.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2))\n             sage: A4.<x,y,z> = FreeAlgebra(GF(13), 3)\n```\n\nthen I get a more detailed segfault:\n\n```\nsage -t --random-seed=0 src/sage/rings/polynomial/plural.pyx\n**********************************************************************\nFile \"src/sage/rings/polynomial/plural.pyx\", line 401, in sage.rings.polynomial.plural.NCPolynomialRing_plural.__dealloc__\nFailed example:\n    R2 = A2.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2))\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta1/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 720, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta1/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1145, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.polynomial.plural.NCPolynomialRing_plural.__dealloc__[6]>\", line 1, in <module>\n        R2 = A2.g_algebra({y*x:x*y-z, z*x:x*z+Integer(2)*x, z*y:y*z-Integer(2)*y}, order=TermOrder('degrevlex', Integer(2)))\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta1/local/lib/python3.9/site-packages/sage/algebras/free_algebra.py\", line 873, in g_algebra\n        return g_Algebra(base_ring, cmat, dmat, names = names or self.variable_names(),\n      File \"sage/structure/factory.pyx\", line 369, in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:2258)\n        return self.get_object(version, key, kwds)\n      File \"sage/structure/factory.pyx\", line 412, in sage.structure.factory.UniqueFactory.get_object (build/cythonized/sage/structure/factory.c:2652)\n        obj = self.create_object(version, key, **extra_args)\n      File \"sage/rings/polynomial/plural.pyx\", line 176, in sage.rings.polynomial.plural.G_AlgFactory.create_object (build/cythonized/sage/rings/polynomial/plural.cpp:5471)\n        return NCPolynomialRing_plural(base_ring, names, c, d, order,\n      File \"sage/rings/polynomial/plural.pyx\", line 334, in sage.rings.polynomial.plural.NCPolynomialRing_plural.__init__ (build/cythonized/sage/rings/polynomial/plural.cpp:6550)\n        cdef RingWrap rw = ncalgebra(self._c, self._d, ring = P)\n      File \"sage/libs/singular/function.pyx\", line 1334, in sage.libs.singular.function.SingularFunction.__call__ (build/cythonized/sage/libs/singular/function.cpp:15149)\n        return call_function(self, args, ring, interruptible, attributes)\n      File \"sage/libs/singular/function.pyx\", line 1516, in sage.libs.singular.function.call_function (build/cythonized/sage/libs/singular/function.cpp:16999)\n        with opt_ctx: # we are preserving the global options state here\n      File \"sage/libs/singular/function.pyx\", line 1518, in sage.libs.singular.function.call_function (build/cythonized/sage/libs/singular/function.cpp:16911)\n        sig_on()\n    cysignals.signals.SignalError: Segmentation fault\n    Killed due to bus error\n**********************************************************************\nTests run before process (pid=40470) failed:\nsage: A.<x,y,z> = FreeAlgebra(QQ, 3) ## line 51 ##\n\n  [snip]\n\nsage: from sage.rings.polynomial.plural import NCPolynomialRing_plural ## line 396 ##\nsage: from sage.algebras.free_algebra import FreeAlgebra ## line 397 ##\nsage: A1.<x,y,z> = FreeAlgebra(QQ, 3) ## line 398 ##\nsage: R1 = A1.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2)) ## line 399 ##\nsage: A2.<x,y,z> = FreeAlgebra(GF(5), 3) ## line 400 ##\nsage: R2 = A2.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2)) ## line 401 ##\nsage: A2.<x,y,z> = FreeAlgebra(GF(5), 3) ## line 402 ##\nsage: R2 = A2.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2)) ## line 403 ##\n------------------------------------------------------------------------\n0   signals.cpython-39-darwin.so        0x0000000103090252 print_backtrace + 66\n1   signals.cpython-39-darwin.so        0x0000000103094167 sigdie + 39\n2   signals.cpython-39-darwin.so        0x0000000103094102 sigdie_for_sig + 290\n3   libsystem_platform.dylib            0x00007fff6e8865fd _sigtramp + 29\n4   Python                              0x00000001014c3eb0 _Py_FalseStruct + 0\n5   multi_polynomial_libsingular.cpytho 0x0000000154c6810b _ZL109__pyx_f_4sage_5rings_10polynomial_28multi_polynomial_libsingular_23MPolynomial_libsingular__new_constant_polyP90__pyx_obj_4sage_5rings_10polynomial_28multi_polynomial_libsingular_MPolynomial_libsingularP7_objectP94__pyx_obj_4sage_5rings_10polynomial_28multi_polynomial_libsingular_MPolynomialRing_libsingulari + 571\n6   multi_polynomial_libsingular.cpytho 0x0000000154c8e1db _ZL111__pyx_pw_4sage_5rings_10polynomial_28multi_polynomial_libsingular_23MPolynomial_libsingular_9_new_constant_polyP7_objectS0_S0_ + 123\n7   Python                              0x0000000101321487 cfunction_call + 122\n8   polynomial_element.cpython-39-darwi 0x00000001514c90bd __pyx_f_4sage_5rings_10polynomial_18polynomial_element_27PolynomialBaseringInjection__call_ + 397\n9   parent.cpython-39-darwin.so         0x00000001030d84b7 __pyx_pw_4sage_9structure_6parent_6Parent_33__call__ + 1207\n10  args.cpython-39-darwin.so           0x0000000152a3b8cd __Pyx_PyObject_CallOneArg + 237\n11  args.cpython-39-darwin.so           0x0000000152a56e8c __pyx_gb_4sage_6matrix_4args_10MatrixArgs_12generator1 + 9996\n12  cachefunc.cpython-39-darwin.so      0x00000001023e8aea __Pyx_Coroutine_SendEx + 122\n13  Python                              0x00000001013086ca list_extend + 246\n14  Python                              0x00000001012df55f PySequence_List + 47\n15  args.cpython-39-darwin.so           0x0000000152a3d10b __pyx_f_4sage_6matrix_4args_10MatrixArgs_list + 363\n16  matrix_generic_dense.cpython-39-dar 0x0000000152a8b758 __pyx_pw_4sage_6matrix_20matrix_generic_dense_20Matrix_generic_dense_1__init__ + 520\n17  Python                              0x000000010133321b type_call + 150\n18  Python                              0x00000001012f0b47 _PyObject_MakeTpCall + 266\n19  Python                              0x0000000101398bd7 call_function + 455\n20  Python                              0x0000000101395d34 _PyEval_EvalFrameDefault + 27452\n21  Python                              0x00000001013996eb _PyEval_EvalCode + 1998\n22  Python                              0x00000001012f117c _PyFunction_Vectorcall + 248\n23  Python                              0x00000001012f09cc _PyObject_FastCallDictTstate + 149\n24  Python                              0x00000001012f1435 _PyObject_Call_Prepend + 139\n25  Python                              0x0000000101338e83 slot_tp_call + 87\n26  matrix0.cpython-39-darwin.so        0x0000000152e16125 __pyx_pw_4sage_6matrix_7matrix0_6Matrix_37change_ring + 2725\n27  plural.cpython-39-darwin.so         0x0000000154e5ca7a _ZL25__Pyx_PyObject_CallOneArgP7_objectS0_ + 138\n28  plural.cpython-39-darwin.so         0x0000000154e8c1f7 _ZL84__pyx_pw_4sage_5rings_10polynomial_6plural_12G_AlgFactory_3create_key_and_extra_argsP7_objectS0_S0_ + 5175\n29  Python                              0x00000001012f0b47 _PyObject_MakeTpCall + 266\n30  Python                              0x00000001012f2e78 method_vectorcall + 205\n31  Python                              0x00000001012f0ec3 PyVectorcall_Call + 146\n32  factory.cpython-39-darwin.so        0x0000000150d3f2ce __pyx_pw_4sage_9structure_7factory_13UniqueFactory_5__call__ + 206\n33  Python                              0x00000001012f0b47 _PyObject_MakeTpCall + 266\n34  Python                              0x0000000101398bd7 call_function + 455\n35  Python                              0x0000000101395e9e _PyEval_EvalFrameDefault + 27814\n36  Python                              0x00000001013996eb _PyEval_EvalCode + 1998\n37  Python                              0x00000001012f117c _PyFunction_Vectorcall + 248\n38  Python                              0x00000001012f2e4f method_vectorcall + 164\n39  Python                              0x0000000101398ba3 call_function + 403\n40  Python                              0x0000000101395e9e _PyEval_EvalFrameDefault + 27814\n41  Python                              0x00000001013996eb _PyEval_EvalCode + 1998\n42  Python                              0x000000010138f11d PyEval_EvalCode + 79\n43  Python                              0x000000010138c457 builtin_exec + 581\n44  Python                              0x0000000101320d43 cfunction_vectorcall_FASTCALL + 203\n45  Python                              0x0000000101398ba3 call_function + 403\n46  Python                              0x0000000101395de0 _PyEval_EvalFrameDefault + 27624\n47  Python                              0x00000001012f11ec function_code_fastcall + 97\n48  Python                              0x0000000101398ba3 call_function + 403\n49  Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424\n50  Python                              0x00000001013996eb _PyEval_EvalCode + 1998\n51  Python                              0x00000001012f117c _PyFunction_Vectorcall + 248\n52  Python                              0x0000000101398ba3 call_function + 403\n53  Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424\n54  Python                              0x00000001013996eb _PyEval_EvalCode + 1998\n55  Python                              0x00000001012f117c _PyFunction_Vectorcall + 248\n56  Python                              0x0000000101398ba3 call_function + 403\n57  Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424\n58  Python                              0x00000001012f11ec function_code_fastcall + 97\n59  Python                              0x0000000101398ba3 call_function + 403\n60  Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424\n61  Python                              0x00000001013996eb _PyEval_EvalCode + 1998\n62  Python                              0x00000001012f117c _PyFunction_Vectorcall + 248\n63  Python                              0x00000001012f0a0b _PyObject_FastCallDictTstate + 212\n64  Python                              0x00000001012f1435 _PyObject_Call_Prepend + 139\n65  Python                              0x0000000101338e83 slot_tp_call + 87\n66  Python                              0x00000001012f0b47 _PyObject_MakeTpCall + 266\n67  Python                              0x0000000101398bd7 call_function + 455\n68  Python                              0x0000000101395de0 _PyEval_EvalFrameDefault + 27624\n69  Python                              0x00000001012f11ec function_code_fastcall + 97\n70  Python                              0x0000000101398ba3 call_function + 403\n71  Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424\n72  Python                              0x00000001013996eb _PyEval_EvalCode + 1998\n73  Python                              0x00000001012f117c _PyFunction_Vectorcall + 248\n74  Python                              0x00000001012f2e4f method_vectorcall + 164\n75  Python                              0x0000000101398ba3 call_function + 403\n76  Python                              0x0000000101395e9e _PyEval_EvalFrameDefault + 27814\n77  Python                              0x00000001012f11ec function_code_fastcall + 97\n78  Python                              0x0000000101398ba3 call_function + 403\n79  Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424\n80  Python                              0x00000001012f11ec function_code_fastcall + 97\n81  Python                              0x00000001012f0a0b _PyObject_FastCallDictTstate + 212\n82  Python                              0x00000001012f1435 _PyObject_Call_Prepend + 139\n83  Python                              0x0000000101339a1e slot_tp_init + 87\n84  Python                              0x000000010133321b type_call + 150\n85  Python                              0x00000001012f0b47 _PyObject_MakeTpCall + 266\n86  Python                              0x0000000101398bd7 call_function + 455\n87  Python                              0x0000000101395de0 _PyEval_EvalFrameDefault + 27624\n88  Python                              0x00000001012f11ec function_code_fastcall + 97\n89  Python                              0x0000000101398ba3 call_function + 403\n90  Python                              0x0000000101395d34 _PyEval_EvalFrameDefault + 27452\n91  Python                              0x00000001012f11ec function_code_fastcall + 97\n92  Python                              0x0000000101398ba3 call_function + 403\n93  Python                              0x0000000101395d34 _PyEval_EvalFrameDefault + 27452\n94  Python                              0x00000001012f11ec function_code_fastcall + 97\n95  Python                              0x00000001012f2e4f method_vectorcall + 164\n96  Python                              0x0000000101398ba3 call_function + 403\n97  Python                              0x0000000101395d34 _PyEval_EvalFrameDefault + 27452\n98  Python                              0x00000001013996eb _PyEval_EvalCode + 1998\n99  Python                              0x00000001012f117c _PyFunction_Vectorcall + 248\n100 Python                              0x0000000101398ba3 call_function + 403\n101 Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424\n102 Python                              0x00000001013996eb _PyEval_EvalCode + 1998\n103 Python                              0x00000001012f117c _PyFunction_Vectorcall + 248\n104 Python                              0x0000000101398ba3 call_function + 403\n105 Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424\n106 Python                              0x00000001012f11ec function_code_fastcall + 97\n107 Python                              0x0000000101398ba3 call_function + 403\n108 Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424\n109 Python                              0x00000001012f11ec function_code_fastcall + 97\n110 Python                              0x0000000101398ba3 call_function + 403\n111 Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424\n112 Python                              0x00000001012f11ec function_code_fastcall + 97\n113 Python                              0x0000000101398ba3 call_function + 403\n114 Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424\n115 Python                              0x00000001013996eb _PyEval_EvalCode + 1998\n116 Python                              0x000000010138f11d PyEval_EvalCode + 79\n117 Python                              0x00000001013ca185 run_eval_code_obj + 110\n118 Python                              0x00000001013c957d run_mod + 103\n119 Python                              0x00000001013c8441 PyRun_FileExFlags + 241\n120 Python                              0x00000001013c7a31 PyRun_SimpleFileExFlags + 271\n121 Python                              0x00000001013df94d Py_RunMain + 1839\n122 Python                              0x00000001013dfc86 pymain_main + 306\n123 Python                              0x00000001013dfcd4 Py_BytesMain + 42\n124 libdyld.dylib                       0x00007fff6e68dcc9 start + 1\n------------------------------------------------------------------------\nUnhandled SIGBUS: A bus error occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n------------------------------------------------------------------------\n\n**********************************************************************\n----------------------------------------------------------------------\nsage -t --random-seed=0 src/sage/rings/polynomial/plural.pyx  # Killed due to bus error\n```\n\nDoes that convey any useful information?",
    "created_at": "2020-11-19T20:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435016",
    "user": "https://github.com/jhpalmieri"
}
```

This whole thing makes no sense to me. I agree that the problem is there with #29719. If instead of your change, I do this:

```diff
diff --git a/src/sage/rings/polynomial/plural.pyx b/src/sage/rings/polynomial/plural.pyx
index c2792aec88..500253533a 100644
--- a/src/sage/rings/polynomial/plural.pyx
+++ b/src/sage/rings/polynomial/plural.pyx
@@ -399,6 +399,8 @@ cdef class NCPolynomialRing_plural(Ring):
             sage: R1 = A1.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2))
             sage: A2.<x,y,z> = FreeAlgebra(GF(5), 3)
             sage: R2 = A2.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2))
+            sage: A2.<x,y,z> = FreeAlgebra(GF(5), 3)
+            sage: R2 = A2.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2))
             sage: A3.<x,y,z> = FreeAlgebra(GF(11), 3)
             sage: R3 = A3.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2))
             sage: A4.<x,y,z> = FreeAlgebra(GF(13), 3)
```

then I get a more detailed segfault:

```
sage -t --random-seed=0 src/sage/rings/polynomial/plural.pyx
**********************************************************************
File "src/sage/rings/polynomial/plural.pyx", line 401, in sage.rings.polynomial.plural.NCPolynomialRing_plural.__dealloc__
Failed example:
    R2 = A2.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2))
Exception raised:
    Traceback (most recent call last):
      File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta1/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 720, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta1/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 1145, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.polynomial.plural.NCPolynomialRing_plural.__dealloc__[6]>", line 1, in <module>
        R2 = A2.g_algebra({y*x:x*y-z, z*x:x*z+Integer(2)*x, z*y:y*z-Integer(2)*y}, order=TermOrder('degrevlex', Integer(2)))
      File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta1/local/lib/python3.9/site-packages/sage/algebras/free_algebra.py", line 873, in g_algebra
        return g_Algebra(base_ring, cmat, dmat, names = names or self.variable_names(),
      File "sage/structure/factory.pyx", line 369, in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:2258)
        return self.get_object(version, key, kwds)
      File "sage/structure/factory.pyx", line 412, in sage.structure.factory.UniqueFactory.get_object (build/cythonized/sage/structure/factory.c:2652)
        obj = self.create_object(version, key, **extra_args)
      File "sage/rings/polynomial/plural.pyx", line 176, in sage.rings.polynomial.plural.G_AlgFactory.create_object (build/cythonized/sage/rings/polynomial/plural.cpp:5471)
        return NCPolynomialRing_plural(base_ring, names, c, d, order,
      File "sage/rings/polynomial/plural.pyx", line 334, in sage.rings.polynomial.plural.NCPolynomialRing_plural.__init__ (build/cythonized/sage/rings/polynomial/plural.cpp:6550)
        cdef RingWrap rw = ncalgebra(self._c, self._d, ring = P)
      File "sage/libs/singular/function.pyx", line 1334, in sage.libs.singular.function.SingularFunction.__call__ (build/cythonized/sage/libs/singular/function.cpp:15149)
        return call_function(self, args, ring, interruptible, attributes)
      File "sage/libs/singular/function.pyx", line 1516, in sage.libs.singular.function.call_function (build/cythonized/sage/libs/singular/function.cpp:16999)
        with opt_ctx: # we are preserving the global options state here
      File "sage/libs/singular/function.pyx", line 1518, in sage.libs.singular.function.call_function (build/cythonized/sage/libs/singular/function.cpp:16911)
        sig_on()
    cysignals.signals.SignalError: Segmentation fault
    Killed due to bus error
**********************************************************************
Tests run before process (pid=40470) failed:
sage: A.<x,y,z> = FreeAlgebra(QQ, 3) ## line 51 ##

  [snip]

sage: from sage.rings.polynomial.plural import NCPolynomialRing_plural ## line 396 ##
sage: from sage.algebras.free_algebra import FreeAlgebra ## line 397 ##
sage: A1.<x,y,z> = FreeAlgebra(QQ, 3) ## line 398 ##
sage: R1 = A1.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2)) ## line 399 ##
sage: A2.<x,y,z> = FreeAlgebra(GF(5), 3) ## line 400 ##
sage: R2 = A2.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2)) ## line 401 ##
sage: A2.<x,y,z> = FreeAlgebra(GF(5), 3) ## line 402 ##
sage: R2 = A2.g_algebra({y*x:x*y-z, z*x:x*z+2*x, z*y:y*z-2*y}, order=TermOrder('degrevlex', 2)) ## line 403 ##
------------------------------------------------------------------------
0   signals.cpython-39-darwin.so        0x0000000103090252 print_backtrace + 66
1   signals.cpython-39-darwin.so        0x0000000103094167 sigdie + 39
2   signals.cpython-39-darwin.so        0x0000000103094102 sigdie_for_sig + 290
3   libsystem_platform.dylib            0x00007fff6e8865fd _sigtramp + 29
4   Python                              0x00000001014c3eb0 _Py_FalseStruct + 0
5   multi_polynomial_libsingular.cpytho 0x0000000154c6810b _ZL109__pyx_f_4sage_5rings_10polynomial_28multi_polynomial_libsingular_23MPolynomial_libsingular__new_constant_polyP90__pyx_obj_4sage_5rings_10polynomial_28multi_polynomial_libsingular_MPolynomial_libsingularP7_objectP94__pyx_obj_4sage_5rings_10polynomial_28multi_polynomial_libsingular_MPolynomialRing_libsingulari + 571
6   multi_polynomial_libsingular.cpytho 0x0000000154c8e1db _ZL111__pyx_pw_4sage_5rings_10polynomial_28multi_polynomial_libsingular_23MPolynomial_libsingular_9_new_constant_polyP7_objectS0_S0_ + 123
7   Python                              0x0000000101321487 cfunction_call + 122
8   polynomial_element.cpython-39-darwi 0x00000001514c90bd __pyx_f_4sage_5rings_10polynomial_18polynomial_element_27PolynomialBaseringInjection__call_ + 397
9   parent.cpython-39-darwin.so         0x00000001030d84b7 __pyx_pw_4sage_9structure_6parent_6Parent_33__call__ + 1207
10  args.cpython-39-darwin.so           0x0000000152a3b8cd __Pyx_PyObject_CallOneArg + 237
11  args.cpython-39-darwin.so           0x0000000152a56e8c __pyx_gb_4sage_6matrix_4args_10MatrixArgs_12generator1 + 9996
12  cachefunc.cpython-39-darwin.so      0x00000001023e8aea __Pyx_Coroutine_SendEx + 122
13  Python                              0x00000001013086ca list_extend + 246
14  Python                              0x00000001012df55f PySequence_List + 47
15  args.cpython-39-darwin.so           0x0000000152a3d10b __pyx_f_4sage_6matrix_4args_10MatrixArgs_list + 363
16  matrix_generic_dense.cpython-39-dar 0x0000000152a8b758 __pyx_pw_4sage_6matrix_20matrix_generic_dense_20Matrix_generic_dense_1__init__ + 520
17  Python                              0x000000010133321b type_call + 150
18  Python                              0x00000001012f0b47 _PyObject_MakeTpCall + 266
19  Python                              0x0000000101398bd7 call_function + 455
20  Python                              0x0000000101395d34 _PyEval_EvalFrameDefault + 27452
21  Python                              0x00000001013996eb _PyEval_EvalCode + 1998
22  Python                              0x00000001012f117c _PyFunction_Vectorcall + 248
23  Python                              0x00000001012f09cc _PyObject_FastCallDictTstate + 149
24  Python                              0x00000001012f1435 _PyObject_Call_Prepend + 139
25  Python                              0x0000000101338e83 slot_tp_call + 87
26  matrix0.cpython-39-darwin.so        0x0000000152e16125 __pyx_pw_4sage_6matrix_7matrix0_6Matrix_37change_ring + 2725
27  plural.cpython-39-darwin.so         0x0000000154e5ca7a _ZL25__Pyx_PyObject_CallOneArgP7_objectS0_ + 138
28  plural.cpython-39-darwin.so         0x0000000154e8c1f7 _ZL84__pyx_pw_4sage_5rings_10polynomial_6plural_12G_AlgFactory_3create_key_and_extra_argsP7_objectS0_S0_ + 5175
29  Python                              0x00000001012f0b47 _PyObject_MakeTpCall + 266
30  Python                              0x00000001012f2e78 method_vectorcall + 205
31  Python                              0x00000001012f0ec3 PyVectorcall_Call + 146
32  factory.cpython-39-darwin.so        0x0000000150d3f2ce __pyx_pw_4sage_9structure_7factory_13UniqueFactory_5__call__ + 206
33  Python                              0x00000001012f0b47 _PyObject_MakeTpCall + 266
34  Python                              0x0000000101398bd7 call_function + 455
35  Python                              0x0000000101395e9e _PyEval_EvalFrameDefault + 27814
36  Python                              0x00000001013996eb _PyEval_EvalCode + 1998
37  Python                              0x00000001012f117c _PyFunction_Vectorcall + 248
38  Python                              0x00000001012f2e4f method_vectorcall + 164
39  Python                              0x0000000101398ba3 call_function + 403
40  Python                              0x0000000101395e9e _PyEval_EvalFrameDefault + 27814
41  Python                              0x00000001013996eb _PyEval_EvalCode + 1998
42  Python                              0x000000010138f11d PyEval_EvalCode + 79
43  Python                              0x000000010138c457 builtin_exec + 581
44  Python                              0x0000000101320d43 cfunction_vectorcall_FASTCALL + 203
45  Python                              0x0000000101398ba3 call_function + 403
46  Python                              0x0000000101395de0 _PyEval_EvalFrameDefault + 27624
47  Python                              0x00000001012f11ec function_code_fastcall + 97
48  Python                              0x0000000101398ba3 call_function + 403
49  Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424
50  Python                              0x00000001013996eb _PyEval_EvalCode + 1998
51  Python                              0x00000001012f117c _PyFunction_Vectorcall + 248
52  Python                              0x0000000101398ba3 call_function + 403
53  Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424
54  Python                              0x00000001013996eb _PyEval_EvalCode + 1998
55  Python                              0x00000001012f117c _PyFunction_Vectorcall + 248
56  Python                              0x0000000101398ba3 call_function + 403
57  Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424
58  Python                              0x00000001012f11ec function_code_fastcall + 97
59  Python                              0x0000000101398ba3 call_function + 403
60  Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424
61  Python                              0x00000001013996eb _PyEval_EvalCode + 1998
62  Python                              0x00000001012f117c _PyFunction_Vectorcall + 248
63  Python                              0x00000001012f0a0b _PyObject_FastCallDictTstate + 212
64  Python                              0x00000001012f1435 _PyObject_Call_Prepend + 139
65  Python                              0x0000000101338e83 slot_tp_call + 87
66  Python                              0x00000001012f0b47 _PyObject_MakeTpCall + 266
67  Python                              0x0000000101398bd7 call_function + 455
68  Python                              0x0000000101395de0 _PyEval_EvalFrameDefault + 27624
69  Python                              0x00000001012f11ec function_code_fastcall + 97
70  Python                              0x0000000101398ba3 call_function + 403
71  Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424
72  Python                              0x00000001013996eb _PyEval_EvalCode + 1998
73  Python                              0x00000001012f117c _PyFunction_Vectorcall + 248
74  Python                              0x00000001012f2e4f method_vectorcall + 164
75  Python                              0x0000000101398ba3 call_function + 403
76  Python                              0x0000000101395e9e _PyEval_EvalFrameDefault + 27814
77  Python                              0x00000001012f11ec function_code_fastcall + 97
78  Python                              0x0000000101398ba3 call_function + 403
79  Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424
80  Python                              0x00000001012f11ec function_code_fastcall + 97
81  Python                              0x00000001012f0a0b _PyObject_FastCallDictTstate + 212
82  Python                              0x00000001012f1435 _PyObject_Call_Prepend + 139
83  Python                              0x0000000101339a1e slot_tp_init + 87
84  Python                              0x000000010133321b type_call + 150
85  Python                              0x00000001012f0b47 _PyObject_MakeTpCall + 266
86  Python                              0x0000000101398bd7 call_function + 455
87  Python                              0x0000000101395de0 _PyEval_EvalFrameDefault + 27624
88  Python                              0x00000001012f11ec function_code_fastcall + 97
89  Python                              0x0000000101398ba3 call_function + 403
90  Python                              0x0000000101395d34 _PyEval_EvalFrameDefault + 27452
91  Python                              0x00000001012f11ec function_code_fastcall + 97
92  Python                              0x0000000101398ba3 call_function + 403
93  Python                              0x0000000101395d34 _PyEval_EvalFrameDefault + 27452
94  Python                              0x00000001012f11ec function_code_fastcall + 97
95  Python                              0x00000001012f2e4f method_vectorcall + 164
96  Python                              0x0000000101398ba3 call_function + 403
97  Python                              0x0000000101395d34 _PyEval_EvalFrameDefault + 27452
98  Python                              0x00000001013996eb _PyEval_EvalCode + 1998
99  Python                              0x00000001012f117c _PyFunction_Vectorcall + 248
100 Python                              0x0000000101398ba3 call_function + 403
101 Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424
102 Python                              0x00000001013996eb _PyEval_EvalCode + 1998
103 Python                              0x00000001012f117c _PyFunction_Vectorcall + 248
104 Python                              0x0000000101398ba3 call_function + 403
105 Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424
106 Python                              0x00000001012f11ec function_code_fastcall + 97
107 Python                              0x0000000101398ba3 call_function + 403
108 Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424
109 Python                              0x00000001012f11ec function_code_fastcall + 97
110 Python                              0x0000000101398ba3 call_function + 403
111 Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424
112 Python                              0x00000001012f11ec function_code_fastcall + 97
113 Python                              0x0000000101398ba3 call_function + 403
114 Python                              0x0000000101395d18 _PyEval_EvalFrameDefault + 27424
115 Python                              0x00000001013996eb _PyEval_EvalCode + 1998
116 Python                              0x000000010138f11d PyEval_EvalCode + 79
117 Python                              0x00000001013ca185 run_eval_code_obj + 110
118 Python                              0x00000001013c957d run_mod + 103
119 Python                              0x00000001013c8441 PyRun_FileExFlags + 241
120 Python                              0x00000001013c7a31 PyRun_SimpleFileExFlags + 271
121 Python                              0x00000001013df94d Py_RunMain + 1839
122 Python                              0x00000001013dfc86 pymain_main + 306
123 Python                              0x00000001013dfcd4 Py_BytesMain + 42
124 libdyld.dylib                       0x00007fff6e68dcc9 start + 1
------------------------------------------------------------------------
Unhandled SIGBUS: A bus error occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------

**********************************************************************
----------------------------------------------------------------------
sage -t --random-seed=0 src/sage/rings/polynomial/plural.pyx  # Killed due to bus error
```

Does that convey any useful information?



---

archive/issue_comments_435017.json:
```json
{
    "body": "The problem is certainly not in flint update, which is modern high quality code, but in Singular's plural package, which is relying on [9-year old C++](https://github.com/Singular/Singular/tree/spielwiese/libpolys/polys/nc), not used much, either, no wonder it misbehaves. \n\nI cc few people who might tell us more about the dump (I can reproduce it, so it's not random).\n\nIt seems that Singular with Clang is not tested much (e.g. Singular built on OpenBSD 6.7 and 6.8 with OpenBSD's clang 10 and 11: standalone Singular crashes on startup).",
    "created_at": "2020-11-20T12:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435017",
    "user": "https://github.com/dimpase"
}
```

The problem is certainly not in flint update, which is modern high quality code, but in Singular's plural package, which is relying on [9-year old C++](https://github.com/Singular/Singular/tree/spielwiese/libpolys/polys/nc), not used much, either, no wonder it misbehaves. 

I cc few people who might tell us more about the dump (I can reproduce it, so it's not random).

It seems that Singular with Clang is not tested much (e.g. Singular built on OpenBSD 6.7 and 6.8 with OpenBSD's clang 10 and 11: standalone Singular crashes on startup).



---

archive/issue_comments_435018.json:
```json
{
    "body": "At first glance, from what I can read, it looks like the system has to be \"primed\" before the error occurs. That suggests memory management issues - which have always been a hard topic in singular :(",
    "created_at": "2020-11-20T19:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435018",
    "user": "https://github.com/kiwifb"
}
```

At first glance, from what I can read, it looks like the system has to be "primed" before the error occurs. That suggests memory management issues - which have always been a hard topic in singular :(



---

archive/issue_comments_435019.json:
```json
{
    "body": "Unfortunately it also seems that the Singular team is uninterested in portability testing - my pull request at https://github.com/Singular/Singular/pull/1018 has been sitting there without even an acknowledgment by the maintainers",
    "created_at": "2020-11-20T19:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435019",
    "user": "https://github.com/mkoeppe"
}
```

Unfortunately it also seems that the Singular team is uninterested in portability testing - my pull request at https://github.com/Singular/Singular/pull/1018 has been sitting there without even an acknowledgment by the maintainers



---

archive/issue_comments_435020.json:
```json
{
    "body": "If this is really a Singular issue, then let's merge the bandaid and move on. Any objections? What is the status with ecl? Does that need a new ticket?",
    "created_at": "2020-11-20T22:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435020",
    "user": "https://github.com/jhpalmieri"
}
```

If this is really a Singular issue, then let's merge the bandaid and move on. Any objections? What is the status with ecl? Does that need a new ticket?



---

archive/issue_comments_435021.json:
```json
{
    "body": "Also note #29528 which is about this Singular bug. As well, in #25993 (upgrade to Singular 4.1.3p2 - the latest)\nthese tests are marked as `# not tested`. I tried the branch of  #25993 with these tests reenabled, and they all work! And this doubling from comment:27 does not give any trouble either. So perhaps the latest Singular and the latest Flint are a winning combo?",
    "created_at": "2020-11-20T23:55:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435021",
    "user": "https://github.com/dimpase"
}
```

Also note #29528 which is about this Singular bug. As well, in #25993 (upgrade to Singular 4.1.3p2 - the latest)
these tests are marked as `# not tested`. I tried the branch of  #25993 with these tests reenabled, and they all work! And this doubling from comment:27 does not give any trouble either. So perhaps the latest Singular and the latest Flint are a winning combo?



---

archive/issue_comments_435022.json:
```json
{
    "body": "Replying to [comment:31 jhpalmieri]:\n> If this is really a Singular issue, then let's merge the bandaid and move on. Any objections? What is the status with ecl? Does that need a new ticket?\n\nyes, let's move on this. And open a new ticket for ecl.",
    "created_at": "2020-11-20T23:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435022",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:31 jhpalmieri]:
> If this is really a Singular issue, then let's merge the bandaid and move on. Any objections? What is the status with ecl? Does that need a new ticket?

yes, let's move on this. And open a new ticket for ecl.



---

archive/issue_comments_435023.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-11-21T18:17:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435023",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_435024.json:
```json
{
    "body": "Since the ECL part is postponed, should we\nupdate this ticket's summary and description?\n\nCould the summary be: \"Allow using arb, flint and ntl from Homebrew\"?\n\nIs the ECL issue part of #29617 or does it need a new ticket?",
    "created_at": "2020-11-23T08:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435024",
    "user": "https://github.com/slel"
}
```

Since the ECL part is postponed, should we
update this ticket's summary and description?

Could the summary be: "Allow using arb, flint and ntl from Homebrew"?

Is the ECL issue part of #29617 or does it need a new ticket?



---

archive/issue_comments_435025.json:
```json
{
    "body": "Changing ticket summary; feel free to improve or revert.",
    "created_at": "2020-11-23T11:58:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435025",
    "user": "https://github.com/slel"
}
```

Changing ticket summary; feel free to improve or revert.



---

archive/issue_comments_435026.json:
```json
{
    "body": "Replying to [comment:36 slelievre]:\n> Since the ECL part is postponed, should we\n> update this ticket's summary and description?\n> \n> Could the summary be: \"Allow using arb, flint and ntl from Homebrew\"?\n> \n> Is the ECL issue part of #29617 or does it need a new ticket?\nyes, #29617 would probably take care of this.\nEven better, we should upsteam to Homebrew \"our\" ECL patches.",
    "created_at": "2020-11-24T21:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435026",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:36 slelievre]:
> Since the ECL part is postponed, should we
> update this ticket's summary and description?
> 
> Could the summary be: "Allow using arb, flint and ntl from Homebrew"?
> 
> Is the ECL issue part of #29617 or does it need a new ticket?
yes, #29617 would probably take care of this.
Even better, we should upsteam to Homebrew "our" ECL patches.



---

archive/issue_comments_435027.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-11-29T11:58:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30508#issuecomment-435027",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_028018.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2020-11-29T11:58:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30508",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30508#event-28018"
}
```
