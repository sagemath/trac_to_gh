# Issue 18433: Use abs() to test for accuracy of roots of complex-valued functions

Issue created by migration from https://trac.sagemath.org/ticket/18670

Original creator: strogdon

Original creation time: 2015-06-11 04:58:02

Doctests may fail in determining accuracy of roots of complex-valued functions unless abs() is use to test for the accuracy. Failures can be corrected as in this [commit](http://git.sagemath.org/sage.git/commit/?id=26eeff1d73aaa2cbfed3e73ac8c60f6910737b1f) for ticket #17238.


---

Comment by strogdon created at 2015-06-11 05:02:58

With sage-6.8.beta3 installed I have the following failure:

```
sage -t --long src/sage/rings/polynomial/polynomial_element.pyx
**********************************************************************
File "src/sage/rings/polynomial/polynomial_element.pyx", line 5577, in sage.rings.polynomial.polynomial_element.Polynomial.roots
Failed example:
    f(f.roots()[0][0])  # abs tol 1e-13
Expected:
    3.3306690738754696e-15 + 1.3704315460216776e-15*I
Got:
    1.1102230246251565e-16*I
**********************************************************************
1 item had failures:
   1 of 177 in sage.rings.polynomial.polynomial_element.Polynomial.roots
    [1752 tests, 1 failure, 17.15 s]
----------------------------------------------------------------------
sage -t --long src/sage/rings/polynomial/polynomial_element.pyx  # 1 doctest failed
----------------------------------------------------------------------
```


There may be similar failures on other architectures. I have

```
uname -a
Linux ledaig 3.6.11-gentoo #6 SMP Mon Aug 25 17:39:25 CDT 2014 x86_64 Dual-Core AMD Opteron(tm) Processor 2218 AuthenticAMD GNU/Linux
```



---

Comment by strogdon created at 2015-06-11 05:08:29

New commits:


---

Comment by strogdon created at 2015-06-11 05:12:16

Changing status from new to needs_review.


---

Comment by strogdon created at 2015-06-25 18:52:41

The `polynomial_element.pyx` doctest still fails for me with 6.8.beta5 in exactly the same way. Although `polynomial_element.pyx` seems to have changed slightly from beta3 -> beta5, the above commit still works.


---

Comment by rws created at 2015-06-26 06:07:42

Changing status from needs_review to positive_review.


---

Comment by rws created at 2015-06-26 06:07:42

Is fine. 1/7 patchbot runs failed but the failure is unrelated. So this is well tested too.


---

Comment by vbraun created at 2015-06-26 20:28:18

Resolution: fixed
