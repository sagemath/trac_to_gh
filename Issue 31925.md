# Issue 31925: get rid of EMBEDDED_MODE

archive/issues_031925.json:
```json
{
    "body": "CC:  @dimpase @mkoeppe @culler @vbraun\n\nthat was used to tell if the user was using sagenb\n\nIssue created by migration from https://trac.sagemath.org/ticket/32162\n\n",
    "created_at": "2021-07-08T12:04:42Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "get rid of EMBEDDED_MODE",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31925",
    "user": "https://github.com/fchapoton"
}
```
CC:  @dimpase @mkoeppe @culler @vbraun

that was used to tell if the user was using sagenb

Issue created by migration from https://trac.sagemath.org/ticket/32162





---

archive/issue_comments_455567.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-08T12:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31925#issuecomment-455567",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_455568.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-07-08T12:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31925#issuecomment-455568",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_455569.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-08T16:23:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31925#issuecomment-455569",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455570.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-08T19:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31925#issuecomment-455570",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455571.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-09T07:06:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31925#issuecomment-455571",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455572.json:
```json
{
    "body": "ok, bot is now morally green, please have a look",
    "created_at": "2021-07-09T09:59:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31925#issuecomment-455572",
    "user": "https://github.com/fchapoton"
}
```

ok, bot is now morally green, please have a look



---

archive/issue_comments_455573.json:
```json
{
    "body": "lgtm",
    "created_at": "2021-07-09T12:29:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31925#issuecomment-455573",
    "user": "https://github.com/dimpase"
}
```

lgtm



---

archive/issue_comments_455574.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-09T12:29:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31925#issuecomment-455574",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_455575.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-24T15:28:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31925#issuecomment-455575",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_455576.json:
```json
{
    "body": "This ticket appears to break \"?\" introspection in the interpreter.  With 9.4.rc0, I get:\n\n```\nsage: ?integral                                                                 \n---------------------------------------------------------------------------\nModuleNotFoundError                       Traceback (most recent call last)\n<ipython-input-1-ebf5f8e4ef8d> in <module>\n----> 1 get_ipython().run_line_magic('pinfo', 'integral')\n\n/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/interactiveshell.py in run_line_magic(self, magic_name, line, _stack_depth)\n   2324                 kwargs['local_ns'] = sys._getframe(stack_depth).f_locals\n   2325             with self.builtin_trap:\n-> 2326                 result = fn(*args, **kwargs)\n   2327             return result\n   2328 \n\n<decorator-gen-75> in pinfo(self, parameter_s, namespaces)\n\n/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/magic.py in <lambda>(f, *a, **k)\n    185     # but it's overkill for just that one bit of state.\n    186     def magic_deco(arg):\n--> 187         call = lambda f, *a, **k: f(*a, **k)\n    188 \n    189         if callable(arg):\n\n/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/magics/namespace.py in pinfo(self, parameter_s, namespaces)\n     56             self.psearch(oname)\n     57         else:\n---> 58             self.shell._inspect('pinfo', oname, detail_level=detail_level,\n     59                                 namespaces=namespaces)\n     60 \n\n/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/interactiveshell.py in _inspect(self, meth, oname, namespaces, **kw)\n   1756                 pmethod(info.obj, oname, formatter)\n   1757             elif meth == 'pinfo':\n-> 1758                 pmethod(info.obj, oname, formatter, info, \n   1759                         enable_html_pager=self.enable_html_pager, **kw)\n   1760             else:\n\n/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/oinspect.py in pinfo(self, obj, oname, formatter, info, detail_level, enable_html_pager)\n    678         - detail_level: if set to 1, more information is given.\n    679         \"\"\"\n--> 680         info = self._get_info(obj, oname, formatter, info, detail_level)\n    681         if not enable_html_pager:\n    682             del info['text/html']\n\n/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/oinspect.py in _get_info(self, obj, oname, formatter, info, detail_level)\n    584         \"\"\"\n    585 \n--> 586         info = self._info(obj, oname=oname, info=info, detail_level=detail_level)\n    587 \n    588         _mime = {\n\n/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/oinspect.py in _info(self, obj, oname, info, detail_level)\n    736                     ds += \"\\nDocstring:\\n\" + obj.__doc__\n    737         else:\n--> 738             ds = getdoc(obj)\n    739             if ds is None:\n    740                 ds = '<no docstring>'\n\n/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/sage/misc/lazy_import.pyx in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:4036)()\n    360             True\n    361         \"\"\"\n--> 362         return self.get_object()(*args, **kwds)\n    363 \n    364     def __repr__(self):\n\n/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/sage/misc/sageinspect.py in sage_getdoc(obj, obj_name, embedded)\n   2014         return ''\n   2015     r = sage_getdoc_original(obj)\n-> 2016     s = sage.misc.sagedoc.format(r, embedded=embedded)\n   2017 \n   2018     # Fix object naming\n\n/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/sage/misc/sagedoc.py in format(s, embedded)\n    705 \n    706     import sage.all\n--> 707     import sage.server.support\n    708     docs = set([])\n    709     if 'noreplace' not in directives:\n\nModuleNotFoundError: No module named 'sage.server.support'\n```\n",
    "created_at": "2021-08-05T18:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31925#issuecomment-455576",
    "user": "https://github.com/NathanDunfield"
}
```

This ticket appears to break "?" introspection in the interpreter.  With 9.4.rc0, I get:

```
sage: ?integral                                                                 
---------------------------------------------------------------------------
ModuleNotFoundError                       Traceback (most recent call last)
<ipython-input-1-ebf5f8e4ef8d> in <module>
----> 1 get_ipython().run_line_magic('pinfo', 'integral')

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/interactiveshell.py in run_line_magic(self, magic_name, line, _stack_depth)
   2324                 kwargs['local_ns'] = sys._getframe(stack_depth).f_locals
   2325             with self.builtin_trap:
-> 2326                 result = fn(*args, **kwargs)
   2327             return result
   2328 

<decorator-gen-75> in pinfo(self, parameter_s, namespaces)

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/magic.py in <lambda>(f, *a, **k)
    185     # but it's overkill for just that one bit of state.
    186     def magic_deco(arg):
--> 187         call = lambda f, *a, **k: f(*a, **k)
    188 
    189         if callable(arg):

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/magics/namespace.py in pinfo(self, parameter_s, namespaces)
     56             self.psearch(oname)
     57         else:
---> 58             self.shell._inspect('pinfo', oname, detail_level=detail_level,
     59                                 namespaces=namespaces)
     60 

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/interactiveshell.py in _inspect(self, meth, oname, namespaces, **kw)
   1756                 pmethod(info.obj, oname, formatter)
   1757             elif meth == 'pinfo':
-> 1758                 pmethod(info.obj, oname, formatter, info, 
   1759                         enable_html_pager=self.enable_html_pager, **kw)
   1760             else:

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/oinspect.py in pinfo(self, obj, oname, formatter, info, detail_level, enable_html_pager)
    678         - detail_level: if set to 1, more information is given.
    679         """
--> 680         info = self._get_info(obj, oname, formatter, info, detail_level)
    681         if not enable_html_pager:
    682             del info['text/html']

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/oinspect.py in _get_info(self, obj, oname, formatter, info, detail_level)
    584         """
    585 
--> 586         info = self._info(obj, oname=oname, info=info, detail_level=detail_level)
    587 
    588         _mime = {

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/oinspect.py in _info(self, obj, oname, info, detail_level)
    736                     ds += "\nDocstring:\n" + obj.__doc__
    737         else:
--> 738             ds = getdoc(obj)
    739             if ds is None:
    740                 ds = '<no docstring>'

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/sage/misc/lazy_import.pyx in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:4036)()
    360             True
    361         """
--> 362         return self.get_object()(*args, **kwds)
    363 
    364     def __repr__(self):

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/sage/misc/sageinspect.py in sage_getdoc(obj, obj_name, embedded)
   2014         return ''
   2015     r = sage_getdoc_original(obj)
-> 2016     s = sage.misc.sagedoc.format(r, embedded=embedded)
   2017 
   2018     # Fix object naming

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/sage/misc/sagedoc.py in format(s, embedded)
    705 
    706     import sage.all
--> 707     import sage.server.support
    708     docs = set([])
    709     if 'noreplace' not in directives:

ModuleNotFoundError: No module named 'sage.server.support'
```




---

archive/issue_comments_455577.json:
```json
{
    "body": "The introspection\n\n```\n?integral\n```\n\nworks fine for me. And I see no line `import sage.server.support` anywhere.",
    "created_at": "2021-08-06T07:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31925#issuecomment-455577",
    "user": "https://github.com/fchapoton"
}
```

The introspection

```
?integral
```

works fine for me. And I see no line `import sage.server.support` anywhere.



---

archive/issue_comments_455578.json:
```json
{
    "body": "This is my fault.\n\nThe macOS app does not include the sage documentation files. That is because the size of the documentation is 30% of the size of the full sage package, and it is all readily available on the web.  There are size limitations on github releases and user patience is also limited.\n\nBecause the documentation is not included in the app bundle, the app uses a\nmodified version of sagedoc.py which opens the online documentation in a\nbrowser, rather than opening a file:/// uri.  The modified version used in the\nmacOS app still had the import statement.",
    "created_at": "2021-08-06T13:26:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31925#issuecomment-455578",
    "user": "https://github.com/culler"
}
```

This is my fault.

The macOS app does not include the sage documentation files. That is because the size of the documentation is 30% of the size of the full sage package, and it is all readily available on the web.  There are size limitations on github releases and user patience is also limited.

Because the documentation is not included in the app bundle, the app uses a
modified version of sagedoc.py which opens the online documentation in a
browser, rather than opening a file:/// uri.  The modified version used in the
macOS app still had the import statement.
