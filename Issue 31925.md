# Issue 31925: get rid of EMBEDDED_MODE

Issue created by migration from https://trac.sagemath.org/ticket/32162

Original creator: chapoton

Original creation time: 2021-07-08 12:04:42

CC:  dimpase mkoeppe culler vbraun

that was used to tell if the user was using sagenb


---

Comment by chapoton created at 2021-07-08 12:05:48

Changing status from new to needs_review.


---

Comment by chapoton created at 2021-07-08 12:05:48

New commits:


---

Comment by git created at 2021-07-08 16:23:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-07-08 19:13:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-07-09 07:06:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2021-07-09 09:59:36

ok, bot is now morally green, please have a look


---

Comment by dimpase created at 2021-07-09 12:29:08

lgtm


---

Comment by dimpase created at 2021-07-09 12:29:08

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-07-24 15:28:04

Resolution: fixed


---

Comment by dunfield created at 2021-08-05 18:35:13

This ticket appears to break "?" introspection in the interpreter.  With 9.4.rc0, I get:

```
sage: ?integral                                                                 
---------------------------------------------------------------------------
ModuleNotFoundError                       Traceback (most recent call last)
<ipython-input-1-ebf5f8e4ef8d> in <module>
----> 1 get_ipython().run_line_magic('pinfo', 'integral')

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/interactiveshell.py in run_line_magic(self, magic_name, line, _stack_depth)
   2324                 kwargs['local_ns'] = sys._getframe(stack_depth).f_locals
   2325             with self.builtin_trap:
-> 2326                 result = fn(*args, **kwargs)
   2327             return result
   2328 

<decorator-gen-75> in pinfo(self, parameter_s, namespaces)

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/magic.py in <lambda>(f, *a, **k)
    185     # but it's overkill for just that one bit of state.
    186     def magic_deco(arg):
--> 187         call = lambda f, *a, **k: f(*a, **k)
    188 
    189         if callable(arg):

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/magics/namespace.py in pinfo(self, parameter_s, namespaces)
     56             self.psearch(oname)
     57         else:
---> 58             self.shell._inspect('pinfo', oname, detail_level=detail_level,
     59                                 namespaces=namespaces)
     60 

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/interactiveshell.py in _inspect(self, meth, oname, namespaces, **kw)
   1756                 pmethod(info.obj, oname, formatter)
   1757             elif meth == 'pinfo':
-> 1758                 pmethod(info.obj, oname, formatter, info, 
   1759                         enable_html_pager=self.enable_html_pager, **kw)
   1760             else:

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/oinspect.py in pinfo(self, obj, oname, formatter, info, detail_level, enable_html_pager)
    678         - detail_level: if set to 1, more information is given.
    679         """
--> 680         info = self._get_info(obj, oname, formatter, info, detail_level)
    681         if not enable_html_pager:
    682             del info['text/html']

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/oinspect.py in _get_info(self, obj, oname, formatter, info, detail_level)
    584         """
    585 
--> 586         info = self._info(obj, oname=oname, info=info, detail_level=detail_level)
    587 
    588         _mime = {

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/IPython/core/oinspect.py in _info(self, obj, oname, info, detail_level)
    736                     ds += "\nDocstring:\n" + obj.__doc__
    737         else:
--> 738             ds = getdoc(obj)
    739             if ds is None:
    740                 ds = '<no docstring>'

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/sage/misc/lazy_import.pyx in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:4036)()
    360             True
    361         """
--> 362         return self.get_object()(*args, **kwds)
    363 
    364     def __repr__(self):

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/sage/misc/sageinspect.py in sage_getdoc(obj, obj_name, embedded)
   2014         return ''
   2015     r = sage_getdoc_original(obj)
-> 2016     s = sage.misc.sagedoc.format(r, embedded=embedded)
   2017 
   2018     # Fix object naming

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/sage/misc/sagedoc.py in format(s, embedded)
    705 
    706     import sage.all
--> 707     import sage.server.support
    708     docs = set([])
    709     if 'noreplace' not in directives:

ModuleNotFoundError: No module named 'sage.server.support'
```



---

Comment by chapoton created at 2021-08-06 07:07:32

The introspection

```
?integral
```

works fine for me. And I see no line `import sage.server.support` anywhere.


---

Comment by culler created at 2021-08-06 13:26:24

This is my fault.

The macOS app does not include the sage documentation files. That is because the size of the documentation is 30% of the size of the full sage package, and it is all readily available on the web.  There are size limitations on github releases and user patience is also limited.

Because the documentation is not included in the app bundle, the app uses a
modified version of sagedoc.py which opens the online documentation in a
browser, rather than opening a file:/// uri.  The modified version used in the
macOS app still had the import statement.
