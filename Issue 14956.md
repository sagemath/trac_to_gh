# Issue 14956: Add _pari_() method to Factorization

Issue created by migration from Trac.

Original creator: pbruin

Original creation time: 2013-09-13 15:27:07

Keywords: pari

Various PARI functions, such as `Zn_issquare` (cf. #13596), accept an integer argument in factored form.  To profit from this, it is convenient to add a method `Factorization._pari_()` to convert a Sage `Factorization` to a PARI matrix.


---

Attachment


---

Comment by pbruin created at 2013-09-13 16:28:57

Changing status from new to needs_review.


---

Comment by mathzeta2 created at 2013-09-27 14:00:50

instead of `reduce` we can use something faster:

```
from itertools import chain
... #line 914:
        entries = init + tuple(chain.from_iterable(self))
```



---

Comment by pbruin created at 2013-09-27 14:28:53

Replying to [comment:2 mathzeta2]:
> instead of `reduce` we can use something faster:
> {{{
> from itertools import chain
> ... #line 914:
>         entries = init + tuple(chain.from_iterable(self))
> }}}
It sounds plausible that this is indeed faster; have you got some timings?


---

Comment by mathzeta2 created at 2013-09-27 14:51:22

Yes, for me it is faster for factorizations with at least (about) 10 factors. Some non-scientific timings:


```
sage: import itertools
sage: A = factor(prod(primes(2)))
sage: %timeit reduce(lambda f, g: f+g, A, ())
1000000 loops, best of 3: 830 ns per loop
sage: %timeit tuple(itertools.chain(*A))     
100000 loops, best of 3: 2.26 us per loop
sage: %timeit tuple(itertools.chain.from_iterable(A))
100000 loops, best of 3: 1.86 us per loop
sage: B = factor(prod(primes(200)))
sage: %timeit reduce(lambda f, g: f+g, B, ())        
10000 loops, best of 3: 33.2 us per loop
sage: %timeit tuple(itertools.chain(*B))             
10000 loops, best of 3: 20.8 us per loop
sage: %timeit tuple(itertools.chain.from_iterable(B))
10000 loops, best of 3: 20.1 us per loop
sage: C = factor(prod(primes(2000)))
sage: %timeit reduce(lambda f, g: f+g, C, ())        
1000 loops, best of 3: 418 us per loop
sage: %timeit tuple(itertools.chain(*C))             
10000 loops, best of 3: 119 us per loop
sage: %timeit tuple(itertools.chain.from_iterable(C))
10000 loops, best of 3: 117 us per loop
sage: len(A), len(B), len(C)
(0, 46, 303)
```



---

Comment by pbruin created at 2013-09-27 15:19:13

Your solution is clearly asymptotically faster in theory and practice, and I find it more elegant.  There is a non-negligible overhead for small cases, unfortunately, but adding a case distinction for this seems overkill.  A new patch is underway.


---

Comment by pbruin created at 2013-09-27 15:19:55

same but using itertools.chain


---

Attachment


---

Comment by jdemeyer created at 2013-10-01 18:38:20

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-10-01 18:38:20

Looks good and useful.


---

Comment by jdemeyer created at 2013-10-04 07:39:49

Resolution: fixed
