# Issue 14956: Add _pari_() method to Factorization

archive/issues_014956.json:
```json
{
    "body": "Keywords: pari\n\nVarious PARI functions, such as `Zn_issquare` (cf. #13596), accept an integer argument in factored form.  To profit from this, it is convenient to add a method `Factorization._pari_()` to convert a Sage `Factorization` to a PARI matrix.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15193\n\n",
    "created_at": "2013-09-13T15:27:07Z",
    "labels": [
        "factorization",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.12",
    "title": "Add _pari_() method to Factorization",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14956",
    "user": "pbruin"
}
```
Keywords: pari

Various PARI functions, such as `Zn_issquare` (cf. #13596), accept an integer argument in factored form.  To profit from this, it is convenient to add a method `Factorization._pari_()` to convert a Sage `Factorization` to a PARI matrix.

Issue created by migration from https://trac.sagemath.org/ticket/15193





---

archive/issue_comments_191044.json:
```json
{
    "body": "Attachment [15193-Factorization-pari.patch](tarball://root/attachments/some-uuid/ticket15193/15193-Factorization-pari.patch) by pbruin created at 2013-09-13 15:28:20",
    "created_at": "2013-09-13T15:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14956#issuecomment-191044",
    "user": "pbruin"
}
```

Attachment [15193-Factorization-pari.patch](tarball://root/attachments/some-uuid/ticket15193/15193-Factorization-pari.patch) by pbruin created at 2013-09-13 15:28:20



---

archive/issue_comments_191045.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-09-13T16:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14956#issuecomment-191045",
    "user": "pbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_191046.json:
```json
{
    "body": "instead of `reduce` we can use something faster:\n\n```\nfrom itertools import chain\n... #line 914:\n        entries = init + tuple(chain.from_iterable(self))\n```\n",
    "created_at": "2013-09-27T14:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14956#issuecomment-191046",
    "user": "mathzeta2"
}
```

instead of `reduce` we can use something faster:

```
from itertools import chain
... #line 914:
        entries = init + tuple(chain.from_iterable(self))
```




---

archive/issue_comments_191047.json:
```json
{
    "body": "Replying to [comment:2 mathzeta2]:\n> instead of `reduce` we can use something faster:\n> {{{\n> from itertools import chain\n> ... #line 914:\n>         entries = init + tuple(chain.from_iterable(self))\n> }}}\nIt sounds plausible that this is indeed faster; have you got some timings?",
    "created_at": "2013-09-27T14:28:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14956#issuecomment-191047",
    "user": "pbruin"
}
```

Replying to [comment:2 mathzeta2]:
> instead of `reduce` we can use something faster:
> {{{
> from itertools import chain
> ... #line 914:
>         entries = init + tuple(chain.from_iterable(self))
> }}}
It sounds plausible that this is indeed faster; have you got some timings?



---

archive/issue_comments_191048.json:
```json
{
    "body": "Yes, for me it is faster for factorizations with at least (about) 10 factors. Some non-scientific timings:\n\n\n```\nsage: import itertools\nsage: A = factor(prod(primes(2)))\nsage: %timeit reduce(lambda f, g: f+g, A, ())\n1000000 loops, best of 3: 830 ns per loop\nsage: %timeit tuple(itertools.chain(*A))     \n100000 loops, best of 3: 2.26 us per loop\nsage: %timeit tuple(itertools.chain.from_iterable(A))\n100000 loops, best of 3: 1.86 us per loop\nsage: B = factor(prod(primes(200)))\nsage: %timeit reduce(lambda f, g: f+g, B, ())        \n10000 loops, best of 3: 33.2 us per loop\nsage: %timeit tuple(itertools.chain(*B))             \n10000 loops, best of 3: 20.8 us per loop\nsage: %timeit tuple(itertools.chain.from_iterable(B))\n10000 loops, best of 3: 20.1 us per loop\nsage: C = factor(prod(primes(2000)))\nsage: %timeit reduce(lambda f, g: f+g, C, ())        \n1000 loops, best of 3: 418 us per loop\nsage: %timeit tuple(itertools.chain(*C))             \n10000 loops, best of 3: 119 us per loop\nsage: %timeit tuple(itertools.chain.from_iterable(C))\n10000 loops, best of 3: 117 us per loop\nsage: len(A), len(B), len(C)\n(0, 46, 303)\n```\n",
    "created_at": "2013-09-27T14:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14956#issuecomment-191048",
    "user": "mathzeta2"
}
```

Yes, for me it is faster for factorizations with at least (about) 10 factors. Some non-scientific timings:


```
sage: import itertools
sage: A = factor(prod(primes(2)))
sage: %timeit reduce(lambda f, g: f+g, A, ())
1000000 loops, best of 3: 830 ns per loop
sage: %timeit tuple(itertools.chain(*A))     
100000 loops, best of 3: 2.26 us per loop
sage: %timeit tuple(itertools.chain.from_iterable(A))
100000 loops, best of 3: 1.86 us per loop
sage: B = factor(prod(primes(200)))
sage: %timeit reduce(lambda f, g: f+g, B, ())        
10000 loops, best of 3: 33.2 us per loop
sage: %timeit tuple(itertools.chain(*B))             
10000 loops, best of 3: 20.8 us per loop
sage: %timeit tuple(itertools.chain.from_iterable(B))
10000 loops, best of 3: 20.1 us per loop
sage: C = factor(prod(primes(2000)))
sage: %timeit reduce(lambda f, g: f+g, C, ())        
1000 loops, best of 3: 418 us per loop
sage: %timeit tuple(itertools.chain(*C))             
10000 loops, best of 3: 119 us per loop
sage: %timeit tuple(itertools.chain.from_iterable(C))
10000 loops, best of 3: 117 us per loop
sage: len(A), len(B), len(C)
(0, 46, 303)
```




---

archive/issue_comments_191049.json:
```json
{
    "body": "Your solution is clearly asymptotically faster in theory and practice, and I find it more elegant.  There is a non-negligible overhead for small cases, unfortunately, but adding a case distinction for this seems overkill.  A new patch is underway.",
    "created_at": "2013-09-27T15:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14956#issuecomment-191049",
    "user": "pbruin"
}
```

Your solution is clearly asymptotically faster in theory and practice, and I find it more elegant.  There is a non-negligible overhead for small cases, unfortunately, but adding a case distinction for this seems overkill.  A new patch is underway.



---

archive/issue_comments_191050.json:
```json
{
    "body": "same but using itertools.chain",
    "created_at": "2013-09-27T15:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14956#issuecomment-191050",
    "user": "pbruin"
}
```

same but using itertools.chain



---

archive/issue_comments_191051.json:
```json
{
    "body": "Attachment [15193-Factorization-pari-chain.patch](tarball://root/attachments/some-uuid/ticket15193/15193-Factorization-pari-chain.patch) by pbruin created at 2013-09-27 15:20:16",
    "created_at": "2013-09-27T15:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14956#issuecomment-191051",
    "user": "pbruin"
}
```

Attachment [15193-Factorization-pari-chain.patch](tarball://root/attachments/some-uuid/ticket15193/15193-Factorization-pari-chain.patch) by pbruin created at 2013-09-27 15:20:16



---

archive/issue_comments_191052.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-10-01T18:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14956#issuecomment-191052",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_191053.json:
```json
{
    "body": "Looks good and useful.",
    "created_at": "2013-10-01T18:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14956#issuecomment-191053",
    "user": "jdemeyer"
}
```

Looks good and useful.



---

archive/issue_comments_191054.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-10-04T07:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14956#issuecomment-191054",
    "user": "jdemeyer"
}
```

Resolution: fixed
