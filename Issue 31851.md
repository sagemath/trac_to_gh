# Issue 31851: gfan testsuite hangs on 32bit

Issue created by migration from https://trac.sagemath.org/ticket/32088

Original creator: mkoeppe

Original creation time: 2021-06-30 00:09:26

CC:  dimpase

For example: `tox -e docker-centos-7-i386-standard gfan` never seems to terminate.

To check, use `tox -e docker-centos-7-i386-standard gfan-build-deps`, then run the built image with Docker.  Then `make gfan` builds the package and hangs in the testsuite after printing:

```
gfan-0.6.2.p1] Running command:"cat <testsuite/0509IntegerGroebnerFan/input|./gfan _overintegers --groebnerFan |grep F_VECTOR>testsuite/0509IntegerGroebnerFan/outputNew"
[gfan-0.6.2.p1] Running command:"cat <testsuite/0510Minkowskisum/input|./gfan _minkowskisum --symmetry | grep -A1 F_VECTOR>testsuite/0510Minkowskisum/outputNew"
[gfan-0.6.2.p1] Running command:"cat <testsuite/0511FanHomology/input|./gfan _fanhomology -i testsuite/0511FanHomology/nonTopHomology.poly>testsuite/0511FanHomology/outputNew"
[gfan-0.6.2.p1] Running command:"cat <testsuite/0600ResultantFan/input|./gfan _resultantfan --vectorinput | grep F_VECTOR -A1>testsuite/0600ResultantFan/outputNew"
[gfan-0.6.2.p1] Running command:"cat <testsuite/0601ResultantFanSpecialised/input|./gfan _resultantfan --vectorinput --special| grep F_VECTOR -A1>testsuite/0601ResultantFanSpecialised/outputNew"
[gfan-0.6.2.p1] Running command:"cat <testsuite/0602ResultantFanProjection/input|./gfan _resultantfan --vectorinput --projection| grep F_VECTOR -A1>testsuite/0602ResultantFanProjection/outputNew"
```





---

Comment by mkoeppe created at 2021-06-30 03:19:22

As a workaround, #31585 disables the gfan testsuite in the Docker workflows.


---

Comment by dimpase created at 2021-07-07 17:18:30

this is not docker-specific, I tried this on a real 32-bit Ubuntu, it gets stuck at the same test.


---

Comment by tmonteil created at 2021-09-30 11:54:02

Changing keywords from "" to "sdl".


---

Comment by tmonteil created at 2021-09-30 11:54:02

I confirm this on 32bit qemu-lated VM.


---

Comment by tmonteil created at 2021-09-30 12:08:10

It might be a problem on our side somehow. I did not run my 32 build machinery for 2 years, and at those times, it seems `gfan` selftests passed without issue.

Also, note that at the beginning of the self-tests, there is some:


```
[gfan-0.6.2.p1] Running the test suite for gfan-0.6.2.p1...
[gfan-0.6.2.p1] ./gfan _test
[gfan-0.6.2.p1] rm: cannot remove 'GfAnTeMpTeStS': No such file or directory
```



---

Comment by tornaria created at 2021-11-21 21:57:26

There's a patch to fix the hang here: https://github.com/void-linux/void-packages/blob/2c5be10e5ede5ff7210c5c7d12fc0ec5bdf04223/srcpkgs/gfan/patches/fix-int64-for-32bit-archs.patch

Also note that testsuite/0009RenderStairCase fails on i686, we had to add '-ffloat-store' to fix that one. I don't know if that's relevant for sage.


---

Comment by tmonteil created at 2022-01-01 10:33:48

`@`tornaria : is your patch reported upstream ?


---

Comment by tornaria created at 2022-01-02 03:36:06

Replying to [comment:8 tmonteil]:
> `@`tornaria : is your patch reported upstream ?

I emailed jensen (email from https://math.au.dk/~jensen/software/gfan/gfan.html) on nov 21 but I never received a reply.

The bug is also fixed in debian https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=974558 and void linux https://github.com/void-linux/void-packages/pull/34182.


---

Comment by chapoton created at 2022-01-29 08:58:50

bump to 9.6


---

Comment by git created at 2022-07-19 18:10:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-07-19 18:55:01

You can re-enable testing it in the CI then, by reverting https://git.sagemath.org/sage.git/commit/?id=eba0a9cc1cca15a9c39d84e7aaac1c762de3591f


---

Comment by tmonteil created at 2022-07-19 19:16:23

I setup a 32bit VM to test that ticket: the patch fixes `0602ResultantFanProjection` but the change in `spkg-install.in` does not fix `0009RenderStairCase`.


---

Comment by mkoeppe created at 2022-07-19 19:19:34

I think you need to set CXXFLAGS


---

Comment by git created at 2022-07-19 19:54:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2022-07-19 19:59:09

Replying to [comment:16 mkoeppe]:
> I think you need to set CXXFLAGS

Indeed, it worked.


---

Comment by tmonteil created at 2022-07-19 19:59:24

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-07-19 20:42:44

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-07-19 20:42:44

Tested with `tox -e docker-debian-buster-i386-standard -- gfan`, looking good


---

Comment by vbraun created at 2022-07-28 19:10:32

Resolution: fixed
