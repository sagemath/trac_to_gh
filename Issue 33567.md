# Issue 33567: bug in conversion from some number fields to SR

archive/issues_033567.json:
```json
{
    "body": "CC:  @slel\n\nAdapted from an example provided by Eric Pichond-Pharabod:\n\n```\nsage: p = x^8 + x^7 - 9*x^6 - 3*x^5 - 6*x^4 + x^3 - 14*x^2 + 2*x + 2\n....: rt = p.roots(AA, multiplicities=False)[1]\n....: K.<a> = NumberField(p, embedding=rt)\n....: SR(a)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-1-0b98edcd8faa> in <module>\n      2 rt = p.roots(AA, multiplicities=False)[Integer(1)]\n      3 K = NumberField(p, embedding=rt, names=('a',)); (a,) = K._first_ngens(1)\n----> 4 SR(a)\n\n~/co/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9450)()\n    895         if mor is not None:\n    896             if no_extra_args:\n--> 897                 return mor._call_(x)\n    898             else:\n    899                 return mor._call_with_args(x, args, kwds)\n\n~/co/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.NamedConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:6154)()\n    285             raise TypeError(\"Cannot coerce {} to {}\".format(x, C))\n    286         cdef Map m\n--> 287         cdef Element e = method(C)\n    288         if e is None:\n    289             raise RuntimeError(\"BUG in coercion model: {} method of {} returned None\".format(self.method_name, type(x)))\n\n~/co/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/rings/number_field/number_field_element.pyx in sage.rings.number_field.number_field_element.NumberFieldElement._symbolic_ (build/cythonized/sage/rings/number_field/number_field_element.cpp:27073)()\n   2953             # Once #17516 gets fixed, the next three lines can be dropped\n   2954             # and the remaining lines be simplified to undo df03633.\n-> 2955             b = embedding.im_gens()[0].radical_expression()\n   2956             if b.parent() == SR:\n   2957                 return self.polynomial()(b)\n\n~/co/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/structure/element.pyx in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4831)()\n    492             AttributeError: 'LeftZeroSemigroup_with_category.element_class' object has no attribute 'blah_blah'\n    493         \"\"\"\n--> 494         return self.getattr_from_category(name)\n    495\n    496     cdef getattr_from_category(self, name):\n\n~/co/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/structure/element.pyx in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4943)()\n    505         else:\n    506             cls = P._abstract_element_class\n--> 507         return getattr_from_other_class(self, cls, name)\n    508\n    509     def __dir__(self):\n\n~/co/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/cpython/getattr.pyx in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2703)()\n    359         dummy_error_message.cls = type(self)\n    360         dummy_error_message.name = name\n--> 361         raise AttributeError(dummy_error_message)\n    362     attribute = <object>attr\n    363     # Check for a descriptor (__get__ in Python)\n\nAttributeError: 'sage.rings.number_field.number_field_morphisms.NumberFieldEmbedding' object has no attribute 'im_gens'\n```\n\nHowever:\n\n```\nsage: K.<a> = NumberField(p, embedding=RR(rt))\n....: SR(a)\n-0.3056815681115094?\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33804\n\n",
    "created_at": "2022-05-05T08:53:15Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "bug in conversion from some number fields to SR",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33567",
    "user": "https://github.com/mezzarobba"
}
```
CC:  @slel

Adapted from an example provided by Eric Pichond-Pharabod:

```
sage: p = x^8 + x^7 - 9*x^6 - 3*x^5 - 6*x^4 + x^3 - 14*x^2 + 2*x + 2
....: rt = p.roots(AA, multiplicities=False)[1]
....: K.<a> = NumberField(p, embedding=rt)
....: SR(a)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-1-0b98edcd8faa> in <module>
      2 rt = p.roots(AA, multiplicities=False)[Integer(1)]
      3 K = NumberField(p, embedding=rt, names=('a',)); (a,) = K._first_ngens(1)
----> 4 SR(a)

~/co/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9450)()
    895         if mor is not None:
    896             if no_extra_args:
--> 897                 return mor._call_(x)
    898             else:
    899                 return mor._call_with_args(x, args, kwds)

~/co/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.NamedConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:6154)()
    285             raise TypeError("Cannot coerce {} to {}".format(x, C))
    286         cdef Map m
--> 287         cdef Element e = method(C)
    288         if e is None:
    289             raise RuntimeError("BUG in coercion model: {} method of {} returned None".format(self.method_name, type(x)))

~/co/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/rings/number_field/number_field_element.pyx in sage.rings.number_field.number_field_element.NumberFieldElement._symbolic_ (build/cythonized/sage/rings/number_field/number_field_element.cpp:27073)()
   2953             # Once #17516 gets fixed, the next three lines can be dropped
   2954             # and the remaining lines be simplified to undo df03633.
-> 2955             b = embedding.im_gens()[0].radical_expression()
   2956             if b.parent() == SR:
   2957                 return self.polynomial()(b)

~/co/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/structure/element.pyx in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4831)()
    492             AttributeError: 'LeftZeroSemigroup_with_category.element_class' object has no attribute 'blah_blah'
    493         """
--> 494         return self.getattr_from_category(name)
    495
    496     cdef getattr_from_category(self, name):

~/co/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/structure/element.pyx in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4943)()
    505         else:
    506             cls = P._abstract_element_class
--> 507         return getattr_from_other_class(self, cls, name)
    508
    509     def __dir__(self):

~/co/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/cpython/getattr.pyx in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2703)()
    359         dummy_error_message.cls = type(self)
    360         dummy_error_message.name = name
--> 361         raise AttributeError(dummy_error_message)
    362     attribute = <object>attr
    363     # Check for a descriptor (__get__ in Python)

AttributeError: 'sage.rings.number_field.number_field_morphisms.NumberFieldEmbedding' object has no attribute 'im_gens'
```

However:

```
sage: K.<a> = NumberField(p, embedding=RR(rt))
....: SR(a)
-0.3056815681115094?
```


Issue created by migration from https://trac.sagemath.org/ticket/33804





---

archive/issue_comments_477164.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-05-05T09:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33567#issuecomment-477164",
    "user": "https://github.com/mezzarobba"
}
```

New commits:



---

archive/issue_comments_477165.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-05-05T09:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33567#issuecomment-477165",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_477166.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-05-16T05:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33567#issuecomment-477166",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_477167.json:
```json
{
    "body": "Changing component from algebra to number fields.",
    "created_at": "2022-05-16T13:16:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33567#issuecomment-477167",
    "user": "https://github.com/slel"
}
```

Changing component from algebra to number fields.



---

archive/issue_comments_477168.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-06-16T20:19:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33567#issuecomment-477168",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_477169.json:
```json
{
    "body": "efficient fix !",
    "created_at": "2022-06-16T20:19:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33567#issuecomment-477169",
    "user": "https://github.com/videlec"
}
```

efficient fix !



---

archive/issue_comments_477170.json:
```json
{
    "body": "Thank you!",
    "created_at": "2022-06-17T06:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33567#issuecomment-477170",
    "user": "https://github.com/mezzarobba"
}
```

Thank you!



---

archive/issue_comments_477171.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-06-19T15:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33567#issuecomment-477171",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_030299.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2022-06-19T15:24:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33567",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33567#event-30299"
}
```
