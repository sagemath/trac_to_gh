# Issue 23060: Use faster Coxeter group for computing in the Iwahori-Hecke algebra

Issue created by migration from Trac.

Original creator: tscrim

Original creation time: 2017-06-21 15:33:18

CC:  sage-combinat salisbury1 andrew.mathas

Using `CoxeterGroup` is much faster than using `WeylGroup` for doing the computations necessary for the Iwahori-Hecke algebra.

Current default:

```
sage: R.<q> = LaurentPolynomialRing(ZZ)
sage: W = WeylGroup('B3')
sage: w0 = [3, 2, 3, 1, 2, 3, 1, 2, 1]
sage: I = IwahoriHeckeAlgebra(W, q^2)
sage: T = I.T()
sage: Cp = I.Cp()
sage: %time x = T(Cp[w0])
```

versus (in a new session):

```
sage: W = CoxeterGroup('B3')
sage: I = IwahoriHeckeAlgebra(W, q^2)
sage: T = I.T()
sage: Cp = I.Cp()
sage: %time x = T(Cp[w0])
CPU times: user 8.8 s, sys: 24 ms, total: 8.82 s
Wall time: 8.81 s
```



---

Comment by tscrim created at 2017-06-21 15:40:08

Ideally I would like to do this for finite Weyl types:

```
sage: W = CoxeterGroup('B3', implementation='permutation')
sage: I = IwahoriHeckeAlgebra(W, q^2)
sage: T = I.T()
sage: Cp = I.Cp()
sage: %time x = T(Cp[w0])
CPU times: user 184 ms, sys: 12 ms, total: 196 ms
Wall time: 357 ms
```

However, there is a bug somewhere and I am not sure where (yet):

```
sage: R.<v> = LaurentPolynomialRing(QQ, 'v')
sage: W = CoxeterGroup('A3', implementation='permutation')
sage: H = IwahoriHeckeAlgebra(W, v**2)
sage: T = H.T()
sage: C = H.C()
sage: KL = KazhdanLusztigPolynomial(W, v)
sage: term = lambda x,y: (-1)^y.length() * v^(-2*y.length()) * KL.P(y, x).substitute(v=v^-2)*T[y]
sage: for x in W:
....:     temp = T(C[x]) - (-v)^x.length()*sum(term(x,y) for y in W)
....:     if temp != 0:
....:         print x.reduced_word()
....:         print temp
....:         print ""
[1, 2, 1, 3]
T[2,1] + T[1,2] - v^2*T[2] - v^2*T[1] + v^4

[1, 2, 3, 2]
T[3,2] + T[2,3] - v^2*T[3] - v^2*T[2] + v^2

[2, 1, 3, 2]
T[2,1] + T[3,2] + T[2,3] + T[1,2] - v^2*T[3] - 2*v^2*T[2] - v^2*T[1] + 2*v^4

[1, 3, 2, 1]
T[2,1] + T[1,2] - v^2*T[2] - v^2*T[1] + v^4

[1, 2, 1, 3, 2]
(v^-1)*T[2,1,3] + (v^-1)*T[2,3,2] + (v^-1)*T[1,2,1] + (v^-1)*T[1,3,2] - v*T[2,1] - v*T[3,2] - v*T[2,3] - v*T[1,3] - v*T[1,2] + v^3*T[3] + (v+v^3)*T[2] + v^3*T[1] - (v^3+v^5)

[1, 2, 3, 2, 1]
(2*v^-1)*T[3,2,1] + (2*v^-1)*T[2,1,3] + (v^-1)*T[2,3,2] + (2*v^-1)*T[1,2,1] + (v^-1)*T[1,3,2] + (v^-1)*T[1,2,3] - (3*v^-1)*T[2,1] - (v^-1+v)*T[3,2] - (v^-1+v)*T[2,3] - (2*v^-1+v)*T[1,3] - (v^-1+v)*T[1,2] + (4*v+v^3)*T[3] + (2*v+v^3)*T[2] + (2*v+v^3)*T[1] - (4*v^3+v^5)

[2, 1, 3, 2, 1]
(2*v^-1)*T[3,2,1] + (v^-1)*T[2,1,3] + (v^-1)*T[2,3,2] + (v^-1)*T[1,2,1] + (v^-1)*T[1,3,2] - (v^-1+v)*T[2,1] - (v^-1+v)*T[3,2] - v*T[2,3] - (v^-1+v)*T[1,3] - v*T[1,2] + (2*v+v^3)*T[3] + (2*v+v^3)*T[2] + (2*v+v^3)*T[1] + (4*v-7*v^3-v^5)

[1, 2, 1, 3, 2, 1]
(v^-2)*T[2,1,3,2] + (2*v^-2)*T[2,3,2,1] + (2*v^-2)*T[1,3,2,1] + (v^-2)*T[1,2,1,3] + (v^-2)*T[1,2,3,2] - (2*v^-2)*T[3,2,1] - (v^-2+1)*T[2,1,3] - (v^-2+1)*T[2,3,2] - (v^-2+1)*T[1,2,1] - (v^-2+1)*T[1,3,2] - T[1,2,3] + v^2*T[2,1] + v^2*T[3,2] + (1+v^2)*T[2,3] + (2+v^2)*T[1,3] + (1+v^2)*T[1,2] - (1+v^2+v^4)*T[3] - (1+v^4)*T[2] - (1+v^2+v^4)*T[1] + (3*v^2+v^4+v^6)
```



---

Comment by tscrim created at 2017-06-21 15:51:24

Changing status from new to needs_review.


---

Comment by tscrim created at 2017-06-21 15:51:24

New commits:


---

Comment by tscrim created at 2017-06-21 16:45:16

The bug in comment:1 is due to #23299. I am hoping get that fixed quickly so we can use the permutation implementation for finite Weyl groups.


---

Comment by git created at 2017-06-21 23:21:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-09-11 08:53:56

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2017-09-11 08:53:56

some failing doctests, see patchbot reports


---

Comment by git created at 2017-12-08 12:46:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-01-12 13:12:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-01-12 13:12:50

still one failing doctest


---

Comment by chapoton created at 2018-01-12 13:13:38

Changing keywords from "" to "coxeter".


---

Comment by git created at 2018-01-12 17:44:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-01-12 17:48:22

Here is a fix that goes at a deeper problem of a lack of coercion and conversion maps between Coxeter group implementations. There is an issue with the conversion into the permutation group implementation of finite Coxeter groups. This comes from the fact that permutation groups implement a custom `__call__` and is a bigger can of worms than we need to tackle here.


---

Comment by tscrim created at 2018-01-12 17:48:22

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-01-12 19:22:19

This triggers another failing doctest.


---

Comment by git created at 2018-01-12 19:44:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-01-12 19:46:13

This will fix it. At some point we probably should also permit relabeled types to convert/coerce in by using the relabeling(s), but that can be a follow-up ticket.


---

Comment by chapoton created at 2018-01-13 16:35:18

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2018-01-13 16:35:18

ok


---

Comment by tscrim created at 2018-01-13 16:36:31

Thank you.


---

Comment by vbraun created at 2018-01-15 22:29:34

Resolution: fixed
