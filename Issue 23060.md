# Issue 23060: Use faster Coxeter group for computing in the Iwahori-Hecke algebra

archive/issues_023060.json:
```json
{
    "body": "CC:  sage-combinat salisbury1 andrew.mathas\n\nUsing `CoxeterGroup` is much faster than using `WeylGroup` for doing the computations necessary for the Iwahori-Hecke algebra.\n\nCurrent default:\n\n```\nsage: R.<q> = LaurentPolynomialRing(ZZ)\nsage: W = WeylGroup('B3')\nsage: w0 = [3, 2, 3, 1, 2, 3, 1, 2, 1]\nsage: I = IwahoriHeckeAlgebra(W, q^2)\nsage: T = I.T()\nsage: Cp = I.Cp()\nsage: %time x = T(Cp[w0])\n```\n\nversus (in a new session):\n\n```\nsage: W = CoxeterGroup('B3')\nsage: I = IwahoriHeckeAlgebra(W, q^2)\nsage: T = I.T()\nsage: Cp = I.Cp()\nsage: %time x = T(Cp[w0])\nCPU times: user 8.8 s, sys: 24 ms, total: 8.82 s\nWall time: 8.81 s\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23297\n\n",
    "created_at": "2017-06-21T15:33:18Z",
    "labels": [
        "algebra",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Use faster Coxeter group for computing in the Iwahori-Hecke algebra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23060",
    "user": "tscrim"
}
```
CC:  sage-combinat salisbury1 andrew.mathas

Using `CoxeterGroup` is much faster than using `WeylGroup` for doing the computations necessary for the Iwahori-Hecke algebra.

Current default:

```
sage: R.<q> = LaurentPolynomialRing(ZZ)
sage: W = WeylGroup('B3')
sage: w0 = [3, 2, 3, 1, 2, 3, 1, 2, 1]
sage: I = IwahoriHeckeAlgebra(W, q^2)
sage: T = I.T()
sage: Cp = I.Cp()
sage: %time x = T(Cp[w0])
```

versus (in a new session):

```
sage: W = CoxeterGroup('B3')
sage: I = IwahoriHeckeAlgebra(W, q^2)
sage: T = I.T()
sage: Cp = I.Cp()
sage: %time x = T(Cp[w0])
CPU times: user 8.8 s, sys: 24 ms, total: 8.82 s
Wall time: 8.81 s
```


Issue created by migration from https://trac.sagemath.org/ticket/23297





---

archive/issue_comments_322413.json:
```json
{
    "body": "Ideally I would like to do this for finite Weyl types:\n\n```\nsage: W = CoxeterGroup('B3', implementation='permutation')\nsage: I = IwahoriHeckeAlgebra(W, q^2)\nsage: T = I.T()\nsage: Cp = I.Cp()\nsage: %time x = T(Cp[w0])\nCPU times: user 184 ms, sys: 12 ms, total: 196 ms\nWall time: 357 ms\n```\n\nHowever, there is a bug somewhere and I am not sure where (yet):\n\n```\nsage: R.<v> = LaurentPolynomialRing(QQ, 'v')\nsage: W = CoxeterGroup('A3', implementation='permutation')\nsage: H = IwahoriHeckeAlgebra(W, v**2)\nsage: T = H.T()\nsage: C = H.C()\nsage: KL = KazhdanLusztigPolynomial(W, v)\nsage: term = lambda x,y: (-1)^y.length() * v^(-2*y.length()) * KL.P(y, x).substitute(v=v^-2)*T[y]\nsage: for x in W:\n....:     temp = T(C[x]) - (-v)^x.length()*sum(term(x,y) for y in W)\n....:     if temp != 0:\n....:         print x.reduced_word()\n....:         print temp\n....:         print \"\"\n[1, 2, 1, 3]\nT[2,1] + T[1,2] - v^2*T[2] - v^2*T[1] + v^4\n\n[1, 2, 3, 2]\nT[3,2] + T[2,3] - v^2*T[3] - v^2*T[2] + v^2\n\n[2, 1, 3, 2]\nT[2,1] + T[3,2] + T[2,3] + T[1,2] - v^2*T[3] - 2*v^2*T[2] - v^2*T[1] + 2*v^4\n\n[1, 3, 2, 1]\nT[2,1] + T[1,2] - v^2*T[2] - v^2*T[1] + v^4\n\n[1, 2, 1, 3, 2]\n(v^-1)*T[2,1,3] + (v^-1)*T[2,3,2] + (v^-1)*T[1,2,1] + (v^-1)*T[1,3,2] - v*T[2,1] - v*T[3,2] - v*T[2,3] - v*T[1,3] - v*T[1,2] + v^3*T[3] + (v+v^3)*T[2] + v^3*T[1] - (v^3+v^5)\n\n[1, 2, 3, 2, 1]\n(2*v^-1)*T[3,2,1] + (2*v^-1)*T[2,1,3] + (v^-1)*T[2,3,2] + (2*v^-1)*T[1,2,1] + (v^-1)*T[1,3,2] + (v^-1)*T[1,2,3] - (3*v^-1)*T[2,1] - (v^-1+v)*T[3,2] - (v^-1+v)*T[2,3] - (2*v^-1+v)*T[1,3] - (v^-1+v)*T[1,2] + (4*v+v^3)*T[3] + (2*v+v^3)*T[2] + (2*v+v^3)*T[1] - (4*v^3+v^5)\n\n[2, 1, 3, 2, 1]\n(2*v^-1)*T[3,2,1] + (v^-1)*T[2,1,3] + (v^-1)*T[2,3,2] + (v^-1)*T[1,2,1] + (v^-1)*T[1,3,2] - (v^-1+v)*T[2,1] - (v^-1+v)*T[3,2] - v*T[2,3] - (v^-1+v)*T[1,3] - v*T[1,2] + (2*v+v^3)*T[3] + (2*v+v^3)*T[2] + (2*v+v^3)*T[1] + (4*v-7*v^3-v^5)\n\n[1, 2, 1, 3, 2, 1]\n(v^-2)*T[2,1,3,2] + (2*v^-2)*T[2,3,2,1] + (2*v^-2)*T[1,3,2,1] + (v^-2)*T[1,2,1,3] + (v^-2)*T[1,2,3,2] - (2*v^-2)*T[3,2,1] - (v^-2+1)*T[2,1,3] - (v^-2+1)*T[2,3,2] - (v^-2+1)*T[1,2,1] - (v^-2+1)*T[1,3,2] - T[1,2,3] + v^2*T[2,1] + v^2*T[3,2] + (1+v^2)*T[2,3] + (2+v^2)*T[1,3] + (1+v^2)*T[1,2] - (1+v^2+v^4)*T[3] - (1+v^4)*T[2] - (1+v^2+v^4)*T[1] + (3*v^2+v^4+v^6)\n```\n",
    "created_at": "2017-06-21T15:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322413",
    "user": "tscrim"
}
```

Ideally I would like to do this for finite Weyl types:

```
sage: W = CoxeterGroup('B3', implementation='permutation')
sage: I = IwahoriHeckeAlgebra(W, q^2)
sage: T = I.T()
sage: Cp = I.Cp()
sage: %time x = T(Cp[w0])
CPU times: user 184 ms, sys: 12 ms, total: 196 ms
Wall time: 357 ms
```

However, there is a bug somewhere and I am not sure where (yet):

```
sage: R.<v> = LaurentPolynomialRing(QQ, 'v')
sage: W = CoxeterGroup('A3', implementation='permutation')
sage: H = IwahoriHeckeAlgebra(W, v**2)
sage: T = H.T()
sage: C = H.C()
sage: KL = KazhdanLusztigPolynomial(W, v)
sage: term = lambda x,y: (-1)^y.length() * v^(-2*y.length()) * KL.P(y, x).substitute(v=v^-2)*T[y]
sage: for x in W:
....:     temp = T(C[x]) - (-v)^x.length()*sum(term(x,y) for y in W)
....:     if temp != 0:
....:         print x.reduced_word()
....:         print temp
....:         print ""
[1, 2, 1, 3]
T[2,1] + T[1,2] - v^2*T[2] - v^2*T[1] + v^4

[1, 2, 3, 2]
T[3,2] + T[2,3] - v^2*T[3] - v^2*T[2] + v^2

[2, 1, 3, 2]
T[2,1] + T[3,2] + T[2,3] + T[1,2] - v^2*T[3] - 2*v^2*T[2] - v^2*T[1] + 2*v^4

[1, 3, 2, 1]
T[2,1] + T[1,2] - v^2*T[2] - v^2*T[1] + v^4

[1, 2, 1, 3, 2]
(v^-1)*T[2,1,3] + (v^-1)*T[2,3,2] + (v^-1)*T[1,2,1] + (v^-1)*T[1,3,2] - v*T[2,1] - v*T[3,2] - v*T[2,3] - v*T[1,3] - v*T[1,2] + v^3*T[3] + (v+v^3)*T[2] + v^3*T[1] - (v^3+v^5)

[1, 2, 3, 2, 1]
(2*v^-1)*T[3,2,1] + (2*v^-1)*T[2,1,3] + (v^-1)*T[2,3,2] + (2*v^-1)*T[1,2,1] + (v^-1)*T[1,3,2] + (v^-1)*T[1,2,3] - (3*v^-1)*T[2,1] - (v^-1+v)*T[3,2] - (v^-1+v)*T[2,3] - (2*v^-1+v)*T[1,3] - (v^-1+v)*T[1,2] + (4*v+v^3)*T[3] + (2*v+v^3)*T[2] + (2*v+v^3)*T[1] - (4*v^3+v^5)

[2, 1, 3, 2, 1]
(2*v^-1)*T[3,2,1] + (v^-1)*T[2,1,3] + (v^-1)*T[2,3,2] + (v^-1)*T[1,2,1] + (v^-1)*T[1,3,2] - (v^-1+v)*T[2,1] - (v^-1+v)*T[3,2] - v*T[2,3] - (v^-1+v)*T[1,3] - v*T[1,2] + (2*v+v^3)*T[3] + (2*v+v^3)*T[2] + (2*v+v^3)*T[1] + (4*v-7*v^3-v^5)

[1, 2, 1, 3, 2, 1]
(v^-2)*T[2,1,3,2] + (2*v^-2)*T[2,3,2,1] + (2*v^-2)*T[1,3,2,1] + (v^-2)*T[1,2,1,3] + (v^-2)*T[1,2,3,2] - (2*v^-2)*T[3,2,1] - (v^-2+1)*T[2,1,3] - (v^-2+1)*T[2,3,2] - (v^-2+1)*T[1,2,1] - (v^-2+1)*T[1,3,2] - T[1,2,3] + v^2*T[2,1] + v^2*T[3,2] + (1+v^2)*T[2,3] + (2+v^2)*T[1,3] + (1+v^2)*T[1,2] - (1+v^2+v^4)*T[3] - (1+v^4)*T[2] - (1+v^2+v^4)*T[1] + (3*v^2+v^4+v^6)
```




---

archive/issue_comments_322414.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-21T15:51:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322414",
    "user": "tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_322415.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-06-21T15:51:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322415",
    "user": "tscrim"
}
```

New commits:



---

archive/issue_comments_322416.json:
```json
{
    "body": "The bug in comment:1 is due to #23299. I am hoping get that fixed quickly so we can use the permutation implementation for finite Weyl groups.",
    "created_at": "2017-06-21T16:45:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322416",
    "user": "tscrim"
}
```

The bug in comment:1 is due to #23299. I am hoping get that fixed quickly so we can use the permutation implementation for finite Weyl groups.



---

archive/issue_comments_322417.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-21T23:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322417",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_322418.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-09-11T08:53:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322418",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_322419.json:
```json
{
    "body": "some failing doctests, see patchbot reports",
    "created_at": "2017-09-11T08:53:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322419",
    "user": "chapoton"
}
```

some failing doctests, see patchbot reports



---

archive/issue_comments_322420.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-08T12:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322420",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_322421.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-12T13:12:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322421",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_322422.json:
```json
{
    "body": "still one failing doctest",
    "created_at": "2018-01-12T13:12:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322422",
    "user": "chapoton"
}
```

still one failing doctest



---

archive/issue_comments_322423.json:
```json
{
    "body": "Changing keywords from \"\" to \"coxeter\".",
    "created_at": "2018-01-12T13:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322423",
    "user": "chapoton"
}
```

Changing keywords from "" to "coxeter".



---

archive/issue_comments_322424.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-12T17:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322424",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_322425.json:
```json
{
    "body": "Here is a fix that goes at a deeper problem of a lack of coercion and conversion maps between Coxeter group implementations. There is an issue with the conversion into the permutation group implementation of finite Coxeter groups. This comes from the fact that permutation groups implement a custom `__call__` and is a bigger can of worms than we need to tackle here.",
    "created_at": "2018-01-12T17:48:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322425",
    "user": "tscrim"
}
```

Here is a fix that goes at a deeper problem of a lack of coercion and conversion maps between Coxeter group implementations. There is an issue with the conversion into the permutation group implementation of finite Coxeter groups. This comes from the fact that permutation groups implement a custom `__call__` and is a bigger can of worms than we need to tackle here.



---

archive/issue_comments_322426.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-12T17:48:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322426",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_322427.json:
```json
{
    "body": "This triggers another failing doctest.",
    "created_at": "2018-01-12T19:22:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322427",
    "user": "chapoton"
}
```

This triggers another failing doctest.



---

archive/issue_comments_322428.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-12T19:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322428",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_322429.json:
```json
{
    "body": "This will fix it. At some point we probably should also permit relabeled types to convert/coerce in by using the relabeling(s), but that can be a follow-up ticket.",
    "created_at": "2018-01-12T19:46:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322429",
    "user": "tscrim"
}
```

This will fix it. At some point we probably should also permit relabeled types to convert/coerce in by using the relabeling(s), but that can be a follow-up ticket.



---

archive/issue_comments_322430.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-01-13T16:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322430",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_322431.json:
```json
{
    "body": "ok",
    "created_at": "2018-01-13T16:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322431",
    "user": "chapoton"
}
```

ok



---

archive/issue_comments_322432.json:
```json
{
    "body": "Thank you.",
    "created_at": "2018-01-13T16:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322432",
    "user": "tscrim"
}
```

Thank you.



---

archive/issue_comments_322433.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-01-15T22:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23060#issuecomment-322433",
    "user": "vbraun"
}
```

Resolution: fixed
