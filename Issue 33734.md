# Issue 33734: Height of a dynamical system is wrong

archive/issues_033734.json:
```json
{
    "body": "CC:  @bhutz @enderwannabe\n\nKeywords: gsoc2022\n\nThe height of a dynamical system is the max of the heights of the polynomials, which is calculated as the max of the heights of the cofficients.\n\nThe following is wrong:\n\n\n```\nP.<x,y>=ProjectiveSpace(QQ,1)\nf=DynamicalSystem([1/25*x^2 + 25/3*x*y+y^2,1*y^2])\nexp(f.global_height())\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33971\n\n",
    "created_at": "2022-06-10T11:45:38Z",
    "labels": [
        "component: dynamics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Height of a dynamical system is wrong",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33734",
    "user": "https://github.com/guojing0"
}
```
CC:  @bhutz @enderwannabe

Keywords: gsoc2022

The height of a dynamical system is the max of the heights of the polynomials, which is calculated as the max of the heights of the cofficients.

The following is wrong:


```
P.<x,y>=ProjectiveSpace(QQ,1)
f=DynamicalSystem([1/25*x^2 + 25/3*x*y+y^2,1*y^2])
exp(f.global_height())
```


Issue created by migration from https://trac.sagemath.org/ticket/33971





---

archive/issue_comments_479199.json:
```json
{
    "body": "Changing type from enhancement to task.",
    "created_at": "2022-06-10T11:46:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479199",
    "user": "https://github.com/guojing0"
}
```

Changing type from enhancement to task.



---

archive/issue_comments_479200.json:
```json
{
    "body": "Changing type from task to defect.",
    "created_at": "2022-06-10T16:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479200",
    "user": "https://github.com/bhutz"
}
```

Changing type from task to defect.



---

archive/issue_comments_479201.json:
```json
{
    "body": "Set assignee to @guojing0.",
    "created_at": "2022-06-16T08:50:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479201",
    "user": "https://github.com/guojing0"
}
```

Set assignee to @guojing0.



---

archive/issue_comments_479202.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-21T14:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479202",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479203.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-22T11:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479203",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479204.json:
```json
{
    "body": "These changes are meant to add a height function for polynomials. As such, they should have their own ticket, as this ticket is meant to address dynamical systems specifically.",
    "created_at": "2022-06-22T17:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479204",
    "user": "https://github.com/EnderWannabe"
}
```

These changes are meant to add a height function for polynomials. As such, they should have their own ticket, as this ticket is meant to address dynamical systems specifically.



---

archive/issue_comments_479205.json:
```json
{
    "body": "As suggested by Alex, a new ticket #34060 is created.",
    "created_at": "2022-06-24T08:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479205",
    "user": "https://github.com/guojing0"
}
```

As suggested by Alex, a new ticket #34060 is created.



---

archive/issue_comments_479206.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-06-28T15:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479206",
    "user": "https://github.com/guojing0"
}
```

New commits:



---

archive/issue_comments_479207.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-29T01:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479207",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479208.json:
```json
{
    "body": "The return values of the examples in the docstring of `global_height` in `projective_morphism.py` are same as before, except for the first one (current result is something like 20.83484...):\n\n\n\n```\nsage: P.<x,y> = ProjectiveSpace(QQ,1)\nsage: H = Hom(P,P)\nsage: f = H([1/1331*x^2+1/4000*y^2, 210*x*y]);\nsage: f.global_height()\n8.29404964010203\n```\n\n\nI also added the example from description to the documentation.",
    "created_at": "2022-06-29T01:46:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479208",
    "user": "https://github.com/guojing0"
}
```

The return values of the examples in the docstring of `global_height` in `projective_morphism.py` are same as before, except for the first one (current result is something like 20.83484...):



```
sage: P.<x,y> = ProjectiveSpace(QQ,1)
sage: H = Hom(P,P)
sage: f = H([1/1331*x^2+1/4000*y^2, 210*x*y]);
sage: f.global_height()
8.29404964010203
```


I also added the example from description to the documentation.



---

archive/issue_comments_479209.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-06-29T05:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479209",
    "user": "https://github.com/guojing0"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_479210.json:
```json
{
    "body": "A couple issues here\n\n- The dimension of the projective space is off by 1. It should be\n\n```\nP = ProjectiveSpace(K, len(coeffs)-1)\n```\n\n\n- I'd suggest having one less variable defined\n\n```\nproj_point = P.point(coeffs)\nreturn proj_point.global_height()\n```\n\nto\n\n```\nreturn P.point(coeffs).global_height()\n```\n\n\n- correct the doc string to describe what this height is actually doing. (i.e., this is the global height of the coefficents as a projective point)\n\n- There seems to be an issue with scaling. The definition of height should be independent of the representative, so these should return the same height. I suggest adding an example for this too. There is an issue somewhere as these are giving different values.\n\n```\nP.<x,y>=ProjectiveSpace(QQ,1)\nf=DynamicalSystem([1/25*x^2 + 25/3*x*y+y^2,1*y^2])\nprint(f.global_height())\nc=10000\nf.scale_by(c)\nf.global_height()\n```\n\n\n- These should be implemented for Affine Dynamical systems too. Careful here that you construct the correct projective point; it may be simplest to homogenize the dynamical system first and then call the projective version (don't forget the case of morphisms between spaces of different dimensions).\n\n- The local_height and local_height_arch seem not to be implemented for affine morphisms at all yet.",
    "created_at": "2022-06-30T13:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479210",
    "user": "https://github.com/bhutz"
}
```

A couple issues here

- The dimension of the projective space is off by 1. It should be

```
P = ProjectiveSpace(K, len(coeffs)-1)
```


- I'd suggest having one less variable defined

```
proj_point = P.point(coeffs)
return proj_point.global_height()
```

to

```
return P.point(coeffs).global_height()
```


- correct the doc string to describe what this height is actually doing. (i.e., this is the global height of the coefficents as a projective point)

- There seems to be an issue with scaling. The definition of height should be independent of the representative, so these should return the same height. I suggest adding an example for this too. There is an issue somewhere as these are giving different values.

```
P.<x,y>=ProjectiveSpace(QQ,1)
f=DynamicalSystem([1/25*x^2 + 25/3*x*y+y^2,1*y^2])
print(f.global_height())
c=10000
f.scale_by(c)
f.global_height()
```


- These should be implemented for Affine Dynamical systems too. Careful here that you construct the correct projective point; it may be simplest to homogenize the dynamical system first and then call the projective version (don't forget the case of morphisms between spaces of different dimensions).

- The local_height and local_height_arch seem not to be implemented for affine morphisms at all yet.



---

archive/issue_comments_479211.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-06-30T13:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479211",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_479212.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-01T05:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479212",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479213.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-01T05:55:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479213",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479214.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-01T07:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479214",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479215.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-02T07:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479215",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479216.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-02T07:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479216",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479217.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-07-02T07:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479217",
    "user": "https://github.com/guojing0"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_479218.json:
```json
{
    "body": "The things in bhutz's reviews are fixed. The three height functions (`global_height`, `local_height`, and `local_height_arch`) for affine morphisms are implemented as well.",
    "created_at": "2022-07-02T07:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479218",
    "user": "https://github.com/guojing0"
}
```

The things in bhutz's reviews are fixed. The three height functions (`global_height`, `local_height`, and `local_height_arch`) for affine morphisms are implemented as well.



---

archive/issue_comments_479219.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-07-05T17:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479219",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_479220.json:
```json
{
    "body": "- add description to the affine one that you are taking the height of the homogenization.\n\n-doc test failures:\n\n```\n1 item had failures:\n   3 of  32 in sage.schemes.projective.projective_morphism.SchemeMorphism_polynomial_projective_space.global_height\n    [612 tests, 3 failures, 4.79 s]\n```\n\nI did not run the full set of doc tests, so be sure to do so.\n\n- docs fail to build\n\n```\nOSError: /home/ben/sage-dev/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage/schemes/projective/projective_morphism.py:docstring of sage.schemes.projective.projective_morphism.SchemeMorphism_polynomial_projective_space.global_height:60: WARNING: Literal block expected; none found.\n```\n",
    "created_at": "2022-07-05T17:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479220",
    "user": "https://github.com/bhutz"
}
```

- add description to the affine one that you are taking the height of the homogenization.

-doc test failures:

```
1 item had failures:
   3 of  32 in sage.schemes.projective.projective_morphism.SchemeMorphism_polynomial_projective_space.global_height
    [612 tests, 3 failures, 4.79 s]
```

I did not run the full set of doc tests, so be sure to do so.

- docs fail to build

```
OSError: /home/ben/sage-dev/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage/schemes/projective/projective_morphism.py:docstring of sage.schemes.projective.projective_morphism.SchemeMorphism_polynomial_projective_space.global_height:60: WARNING: Literal block expected; none found.
```




---

archive/issue_comments_479221.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-06T05:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479221",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479222.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-09T02:25:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479222",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479223.json:
```json
{
    "body": "The status badge says that building documentation is successful. It passed all the tests after I ran `./sage -t affine_morphism.py` and `./sage -t projective_morphism.py`.",
    "created_at": "2022-07-09T04:19:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479223",
    "user": "https://github.com/guojing0"
}
```

The status badge says that building documentation is successful. It passed all the tests after I ran `./sage -t affine_morphism.py` and `./sage -t projective_morphism.py`.



---

archive/issue_comments_479224.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-07-09T04:19:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479224",
    "user": "https://github.com/guojing0"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_479225.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-09T04:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479225",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479226.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-07-11T13:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479226",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_479227.json:
```json
{
    "body": "The functionality works when the domain and codomain have the same dimension, but not when they do not.\n\n\n```\nP.<x,y,z> = ProjectiveSpace(QQ,2)\nA.<z,w>=ProjectiveSpace(QQ,1)\nH = Hom(P,A)\nf = H([1/1331*x^2 + 4000*y*z,y^2])\nf.global_height()\n```\n\n\n\n```\nP.<x,y> = AffineSpace(QQ,2)\nA.<z>=AffineSpace(QQ,1)\nH = Hom(P,A)\nf = H([1/1331*x^2 + 4000*y])\nf.global_height()\n```\n\n\nThis example no longer makes sense since normalization does not have an effect on the height. Delete the text and the second half of the example.\n\n\n```\n        This function does not automatically normalize::\n\n            sage: P.<x,y,z> = ProjectiveSpace(ZZ,2)\n            sage: H = Hom(P,P)\n            sage: f = H([4*x^2 + 100*y^2, 210*x*y, 10000*z^2]);\n            sage: f.global_height()\n            8.51719319141624\n            sage: f.normalize_coordinates()\n            sage: f.global_height()\n            8.51719319141624\n```\n",
    "created_at": "2022-07-11T13:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479227",
    "user": "https://github.com/bhutz"
}
```

The functionality works when the domain and codomain have the same dimension, but not when they do not.


```
P.<x,y,z> = ProjectiveSpace(QQ,2)
A.<z,w>=ProjectiveSpace(QQ,1)
H = Hom(P,A)
f = H([1/1331*x^2 + 4000*y*z,y^2])
f.global_height()
```



```
P.<x,y> = AffineSpace(QQ,2)
A.<z>=AffineSpace(QQ,1)
H = Hom(P,A)
f = H([1/1331*x^2 + 4000*y])
f.global_height()
```


This example no longer makes sense since normalization does not have an effect on the height. Delete the text and the second half of the example.


```
        This function does not automatically normalize::

            sage: P.<x,y,z> = ProjectiveSpace(ZZ,2)
            sage: H = Hom(P,P)
            sage: f = H([4*x^2 + 100*y^2, 210*x*y, 10000*z^2]);
            sage: f.global_height()
            8.51719319141624
            sage: f.normalize_coordinates()
            sage: f.global_height()
            8.51719319141624
```




---

archive/issue_comments_479228.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-12T04:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479228",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479229.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-07-12T04:50:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479229",
    "user": "https://github.com/guojing0"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_479230.json:
```json
{
    "body": "The two examples are added as parts of the `EXAMPLES`.",
    "created_at": "2022-07-12T04:50:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479230",
    "user": "https://github.com/guojing0"
}
```

The two examples are added as parts of the `EXAMPLES`.



---

archive/issue_comments_479231.json:
```json
{
    "body": "This is passing my tests now. I'd like to have the patchbot pick it up before I marked it positive. Let's give it a couple days.",
    "created_at": "2022-07-12T20:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479231",
    "user": "https://github.com/bhutz"
}
```

This is passing my tests now. I'd like to have the patchbot pick it up before I marked it positive. Let's give it a couple days.



---

archive/issue_comments_479232.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-07-14T13:48:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479232",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_479233.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-01T20:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33734#issuecomment-479233",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
