# Issue 33734: Height of a dynamical system is wrong

Issue created by migration from https://trac.sagemath.org/ticket/33971

Original creator: @guojing0

Original creation time: 2022-06-10 11:45:38

CC:  bhutz @enderwannabe

Keywords: gsoc2022

The height of a dynamical system is the max of the heights of the polynomials, which is calculated as the max of the heights of the cofficients.

The following is wrong:


```
P.<x,y>=ProjectiveSpace(QQ,1)
f=DynamicalSystem([1/25*x^2 + 25/3*x*y+y^2,1*y^2])
exp(f.global_height())
```



---

Comment by @guojing0 created at 2022-06-10 11:46:18

Changing type from enhancement to task.


---

Comment by bhutz created at 2022-06-10 16:09:17

Changing type from task to defect.


---

Comment by @guojing0 created at 2022-06-16 08:50:57

Set assignee to @guojing0.


---

Comment by git created at 2022-06-21 14:33:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-06-22 11:52:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @EnderWannabe created at 2022-06-22 17:41:40

These changes are meant to add a height function for polynomials. As such, they should have their own ticket, as this ticket is meant to address dynamical systems specifically.


---

Comment by @guojing0 created at 2022-06-24 08:09:21

As suggested by Alex, a new ticket #34060 is created.


---

Comment by @guojing0 created at 2022-06-28 15:50:04

New commits:


---

Comment by git created at 2022-06-29 01:38:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @guojing0 created at 2022-06-29 01:46:08

The return values of the examples in the docstring of `global_height` in `projective_morphism.py` are same as before, except for the first one (current result is something like 20.83484...):



```
sage: P.<x,y> = ProjectiveSpace(QQ,1)
sage: H = Hom(P,P)
sage: f = H([1/1331*x^2+1/4000*y^2, 210*x*y]);
sage: f.global_height()
8.29404964010203
```


I also added the example from description to the documentation.


---

Comment by @guojing0 created at 2022-06-29 05:06:39

Changing status from new to needs_review.


---

Comment by bhutz created at 2022-06-30 13:38:18

A couple issues here

- The dimension of the projective space is off by 1. It should be

```
P = ProjectiveSpace(K, len(coeffs)-1)
```


- I'd suggest having one less variable defined

```
proj_point = P.point(coeffs)
return proj_point.global_height()
```

to

```
return P.point(coeffs).global_height()
```


- correct the doc string to describe what this height is actually doing. (i.e., this is the global height of the coefficents as a projective point)

- There seems to be an issue with scaling. The definition of height should be independent of the representative, so these should return the same height. I suggest adding an example for this too. There is an issue somewhere as these are giving different values.

```
P.<x,y>=ProjectiveSpace(QQ,1)
f=DynamicalSystem([1/25*x^2 + 25/3*x*y+y^2,1*y^2])
print(f.global_height())
c=10000
f.scale_by(c)
f.global_height()
```


- These should be implemented for Affine Dynamical systems too. Careful here that you construct the correct projective point; it may be simplest to homogenize the dynamical system first and then call the projective version (don't forget the case of morphisms between spaces of different dimensions).

- The local_height and local_height_arch seem not to be implemented for affine morphisms at all yet.


---

Comment by bhutz created at 2022-06-30 13:38:18

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-07-01 05:47:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-01 05:55:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-01 07:07:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-02 07:42:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-02 07:55:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @guojing0 created at 2022-07-02 07:58:09

Changing status from needs_work to needs_review.


---

Comment by @guojing0 created at 2022-07-02 07:58:09

The things in bhutz's reviews are fixed. The three height functions (`global_height`, `local_height`, and `local_height_arch`) for affine morphisms are implemented as well.


---

Comment by bhutz created at 2022-07-05 17:21:56

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2022-07-05 17:21:56

- add description to the affine one that you are taking the height of the homogenization.

-doc test failures:

```
1 item had failures:
   3 of  32 in sage.schemes.projective.projective_morphism.SchemeMorphism_polynomial_projective_space.global_height
    [612 tests, 3 failures, 4.79 s]
```

I did not run the full set of doc tests, so be sure to do so.

- docs fail to build

```
OSError: /home/ben/sage-dev/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage/schemes/projective/projective_morphism.py:docstring of sage.schemes.projective.projective_morphism.SchemeMorphism_polynomial_projective_space.global_height:60: WARNING: Literal block expected; none found.
```



---

Comment by git created at 2022-07-06 05:16:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-09 02:25:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @guojing0 created at 2022-07-09 04:19:01

The status badge says that building documentation is successful. It passed all the tests after I ran `./sage -t affine_morphism.py` and `./sage -t projective_morphism.py`.


---

Comment by @guojing0 created at 2022-07-09 04:19:01

Changing status from needs_work to needs_review.


---

Comment by git created at 2022-07-09 04:45:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2022-07-11 13:47:27

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2022-07-11 13:47:27

The functionality works when the domain and codomain have the same dimension, but not when they do not.


```
P.<x,y,z> = ProjectiveSpace(QQ,2)
A.<z,w>=ProjectiveSpace(QQ,1)
H = Hom(P,A)
f = H([1/1331*x^2 + 4000*y*z,y^2])
f.global_height()
```



```
P.<x,y> = AffineSpace(QQ,2)
A.<z>=AffineSpace(QQ,1)
H = Hom(P,A)
f = H([1/1331*x^2 + 4000*y])
f.global_height()
```


This example no longer makes sense since normalization does not have an effect on the height. Delete the text and the second half of the example.


```
        This function does not automatically normalize::

            sage: P.<x,y,z> = ProjectiveSpace(ZZ,2)
            sage: H = Hom(P,P)
            sage: f = H([4*x^2 + 100*y^2, 210*x*y, 10000*z^2]);
            sage: f.global_height()
            8.51719319141624
            sage: f.normalize_coordinates()
            sage: f.global_height()
            8.51719319141624
```



---

Comment by git created at 2022-07-12 04:47:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @guojing0 created at 2022-07-12 04:50:19

Changing status from needs_work to needs_review.


---

Comment by @guojing0 created at 2022-07-12 04:50:19

The two examples are added as parts of the `EXAMPLES`.


---

Comment by bhutz created at 2022-07-12 20:04:32

This is passing my tests now. I'd like to have the patchbot pick it up before I marked it positive. Let's give it a couple days.


---

Comment by bhutz created at 2022-07-14 13:48:31

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-08-01 20:20:42

Resolution: fixed
