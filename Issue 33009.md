# Issue 33009: canonical_label returns incorrect partite sets

archive/issues_033009.json:
```json
{
    "body": "CC:  dimpase dcoudert\n\n`.canonical_label` on bipartite graph returns a graph with incorrect partite sets. The following code illustrates an example, where the resulting graph `C` has vertices `1` and `9` in the same left partite set and also an edge between them. \n\nThe graph `C` itself seems to be correct, but partition of its vertices into `C.left` and `C.right` is not (they should be `{0,1,2,3,4}` and `{5,6,7,8,9}`).\n\n\n```\nB = BipartiteGraph( [(0, 4), (0, 5), (0, 6), (0, 8), (1, 5), (1, 7), (1, 8), (2, 6), (2, 7), (2, 8), (3, 4), (3, 7), (3, 8), (4, 9), (5, 9), (6, 9), (7, 9)] )\nC = B.canonical_label(partition=(B.left,B.right))\nprint( (1 in C.left) and (9 in C.left) and C.has_edge(1,9) )\n```\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33246\n\n",
    "created_at": "2022-01-30T02:06:58Z",
    "labels": [
        "graph theory",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "canonical_label returns incorrect partite sets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33009",
    "user": "@maxale"
}
```
CC:  dimpase dcoudert

`.canonical_label` on bipartite graph returns a graph with incorrect partite sets. The following code illustrates an example, where the resulting graph `C` has vertices `1` and `9` in the same left partite set and also an edge between them. 

The graph `C` itself seems to be correct, but partition of its vertices into `C.left` and `C.right` is not (they should be `{0,1,2,3,4}` and `{5,6,7,8,9}`).


```
B = BipartiteGraph( [(0, 4), (0, 5), (0, 6), (0, 8), (1, 5), (1, 7), (1, 8), (2, 6), (2, 7), (2, 8), (3, 4), (3, 7), (3, 8), (4, 9), (5, 9), (6, 9), (7, 9)] )
C = B.canonical_label(partition=(B.left,B.right))
print( (1 in C.left) and (9 in C.left) and C.has_edge(1,9) )
```



Issue created by migration from https://trac.sagemath.org/ticket/33246





---

archive/issue_comments_470684.json:
```json
{
    "body": "The `BipartiteGraph` module requires several improvements and bug fix (#1941). This one seems non trivial.",
    "created_at": "2022-01-31T10:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470684",
    "user": "dcoudert"
}
```

The `BipartiteGraph` module requires several improvements and bug fix (#1941). This one seems non trivial.



---

archive/issue_comments_470685.json:
```json
{
    "body": "As a workaround for *connected* graphs, we can recompute the partite sets from just edges of `canonical_label()` - like:\n\n\n```\nC = BipartiteGraph( B.canonical_label(partition=(B.left,B.right)).edges() )\n```\n\n\nIf `B` is not connected, recomputing the partite sets may shuffle them from different connected components inconsistently with the partite set in `B`.",
    "created_at": "2022-01-31T14:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470685",
    "user": "@maxale"
}
```

As a workaround for *connected* graphs, we can recompute the partite sets from just edges of `canonical_label()` - like:


```
C = BipartiteGraph( B.canonical_label(partition=(B.left,B.right)).edges() )
```


If `B` is not connected, recomputing the partite sets may shuffle them from different connected components inconsistently with the partite set in `B`.



---

archive/issue_comments_470686.json:
```json
{
    "body": "Since `canonical_label()` can return a certificate (mapping of the vertices of given graph to the relabeled one), correct partition of vertices can be computed from this certificate. I found the following workaround quite stable:\n\n\n\n```\ndef correct_canonical_label(B):\n    C, cert = B.canonical_label(partition=(B.left,B.right),certificate=True)\n    C.left = { cert[v] for v in B.left }\n    C.right = { cert[v] for v in B.right }\n    return C\n```\n",
    "created_at": "2022-02-01T18:17:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470686",
    "user": "@maxale"
}
```

Since `canonical_label()` can return a certificate (mapping of the vertices of given graph to the relabeled one), correct partition of vertices can be computed from this certificate. I found the following workaround quite stable:



```
def correct_canonical_label(B):
    C, cert = B.canonical_label(partition=(B.left,B.right),certificate=True)
    C.left = { cert[v] for v in B.left }
    C.right = { cert[v] for v in B.right }
    return C
```




---

archive/issue_comments_470687.json:
```json
{
    "body": "Any devs already working on this ticket? I'd like to attempt to fix it :)",
    "created_at": "2022-03-12T10:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470687",
    "user": "@enjeck"
}
```

Any devs already working on this ticket? I'd like to attempt to fix it :)



---

archive/issue_comments_470688.json:
```json
{
    "body": "Feel free to give it a try. Any help is more than welcome.",
    "created_at": "2022-03-12T10:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470688",
    "user": "dcoudert"
}
```

Feel free to give it a try. Any help is more than welcome.



---

archive/issue_comments_470689.json:
```json
{
    "body": "Thanks for the proposal. I have some comments/questions:\n- what's the main difference between this method and `GenericGraph.canonical_label` ? I'm asking beacause you have copy/paste multiple parts of the code, and so it's not obvious to see what makes the difference, why it is working correctly this way\n- when you call a function with several optional parameters, it's better to name them: `partition=partition`, `certificate=certificate`, etc. This way you avoid errors if a new parameter is added.\n- Bipartite graphs are undirected and without loops. So you don't need to check if it is directed or if it has loops\n- the import of `DiGraph` is useful only if you use the fact that you can direct all arc from `left` to `right` to indicate a partition. Otherwise, you can remove it, no ?\n- `{ cert[v] for v in self.left }` -> `{cert[v] for v in self.left}`\n----\nNew commits:",
    "created_at": "2022-03-17T12:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470689",
    "user": "dcoudert"
}
```

Thanks for the proposal. I have some comments/questions:
- what's the main difference between this method and `GenericGraph.canonical_label` ? I'm asking beacause you have copy/paste multiple parts of the code, and so it's not obvious to see what makes the difference, why it is working correctly this way
- when you call a function with several optional parameters, it's better to name them: `partition=partition`, `certificate=certificate`, etc. This way you avoid errors if a new parameter is added.
- Bipartite graphs are undirected and without loops. So you don't need to check if it is directed or if it has loops
- the import of `DiGraph` is useful only if you use the fact that you can direct all arc from `left` to `right` to indicate a partition. Otherwise, you can remove it, no ?
- `{ cert[v] for v in self.left }` -> `{cert[v] for v in self.left}`
----
New commits:



---

archive/issue_comments_470690.json:
```json
{
    "body": "Replying to [comment:7 dcoudert]:\n> Thanks for the proposal. I have some comments/questions:\n> - what's the main difference between this method and `GenericGraph.canonical_label` ? I'm asking beacause you have copy/paste multiple parts of the code, and so it's not obvious to see what makes the difference, why it is working correctly this way\n\nI'm trying to implement the [comment:3 workaround suggested by gh-maxale], using the certificate. Indeed, I did just copy from the main canonical_label function. If the user sets certificate to \"True\", I just call the original function, since it returns a certificate (mapping of the vertices of given graph to the relabeled one) by default. If certificate is not set to \"True\", I then compute the vertices (this part is just copied from the original). There's probably some more elegant way of implementing this, but I couldn't figure it out. \n\n> - when you call a function with several optional parameters, it's better to name them: `partition=partition`, `certificate=certificate`, etc. This way you avoid errors if a new parameter is added.\n\nOkay. I can change that\n\n> - Bipartite graphs are undirected and without loops. So you don't need to check if it is directed or if it has loops\n\nWhoops. That's an oversight on my part. Gotcha!\n> - the import of `DiGraph` is useful only if you use the fact that you can direct all arc from `left` to `right` to indicate a partition. Otherwise, you can remove it, no ?\n\nOkay. I'll need to test this out and see. \n\n\n> - `{ cert[v] for v in self.left }` -> `{cert[v] for v in self.left}`\n\nNoted",
    "created_at": "2022-03-17T13:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470690",
    "user": "@enjeck"
}
```

Replying to [comment:7 dcoudert]:
> Thanks for the proposal. I have some comments/questions:
> - what's the main difference between this method and `GenericGraph.canonical_label` ? I'm asking beacause you have copy/paste multiple parts of the code, and so it's not obvious to see what makes the difference, why it is working correctly this way

I'm trying to implement the [comment:3 workaround suggested by gh-maxale], using the certificate. Indeed, I did just copy from the main canonical_label function. If the user sets certificate to "True", I just call the original function, since it returns a certificate (mapping of the vertices of given graph to the relabeled one) by default. If certificate is not set to "True", I then compute the vertices (this part is just copied from the original). There's probably some more elegant way of implementing this, but I couldn't figure it out. 

> - when you call a function with several optional parameters, it's better to name them: `partition=partition`, `certificate=certificate`, etc. This way you avoid errors if a new parameter is added.

Okay. I can change that

> - Bipartite graphs are undirected and without loops. So you don't need to check if it is directed or if it has loops

Whoops. That's an oversight on my part. Gotcha!
> - the import of `DiGraph` is useful only if you use the fact that you can direct all arc from `left` to `right` to indicate a partition. Otherwise, you can remove it, no ?

Okay. I'll need to test this out and see. 


> - `{ cert[v] for v in self.left }` -> `{cert[v] for v in self.left}`

Noted



---

archive/issue_comments_470691.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-20T12:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470691",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_470692.json:
```json
{
    "body": "`@`dcoudert, I've made changes. What do you think?",
    "created_at": "2022-03-20T12:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470692",
    "user": "@enjeck"
}
```

`@`dcoudert, I've made changes. What do you think?



---

archive/issue_comments_470693.json:
```json
{
    "body": "you need to\n- remove `dig = (self._directed or self.has_loops())`\n- use `dig=False` \n- replace `self_directed` with `False`\n\nAlso, in the example, write like this (not mandatory but nicer):\n\n```diff\n-            sage: B = BipartiteGraph( [(0, 4), (0, 5), (0, 6), (0, 8), (1, 5), (1, 7), (1, 8\n-            ....: ), (2, 6), (2, 7), (2, 8), (3, 4), (3, 7), (3, 8), (4, 9), (5, 9), (6, 9),\n-            ....:  (7, 9)] )\n+            sage: B = BipartiteGraph([(0, 4), (0, 5), (0, 6), (0, 8), (1, 5),\n+            ....:                     (1, 7), (1, 8), (2, 6), (2, 7), (2, 8),\n+            ....:                     (3, 4), (3, 7), (3, 8), (4, 9), (5, 9),\n+            ....:                     (6, 9), (7, 9)])\n```\n\n\nLats, add (small) examples with `certificate=True`, `edge_labels=True` and a bipartite with multiple edges. This is to ensure that the method is working well.",
    "created_at": "2022-03-20T13:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470693",
    "user": "dcoudert"
}
```

you need to
- remove `dig = (self._directed or self.has_loops())`
- use `dig=False` 
- replace `self_directed` with `False`

Also, in the example, write like this (not mandatory but nicer):

```diff
-            sage: B = BipartiteGraph( [(0, 4), (0, 5), (0, 6), (0, 8), (1, 5), (1, 7), (1, 8
-            ....: ), (2, 6), (2, 7), (2, 8), (3, 4), (3, 7), (3, 8), (4, 9), (5, 9), (6, 9),
-            ....:  (7, 9)] )
+            sage: B = BipartiteGraph([(0, 4), (0, 5), (0, 6), (0, 8), (1, 5),
+            ....:                     (1, 7), (1, 8), (2, 6), (2, 7), (2, 8),
+            ....:                     (3, 4), (3, 7), (3, 8), (4, 9), (5, 9),
+            ....:                     (6, 9), (7, 9)])
```


Lats, add (small) examples with `certificate=True`, `edge_labels=True` and a bipartite with multiple edges. This is to ensure that the method is working well.



---

archive/issue_comments_470694.json:
```json
{
    "body": "Also, add your full name to the \"Authors\" field of the ticket\nand set it to \"needs review\".",
    "created_at": "2022-03-21T21:15:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470694",
    "user": "slelievre"
}
```

Also, add your full name to the "Authors" field of the ticket
and set it to "needs review".



---

archive/issue_comments_470695.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-22T04:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470695",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_470696.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-03-22T05:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470696",
    "user": "@enjeck"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_470697.json:
```json
{
    "body": "It's improving, but I still have few remarks\n- remove\n\n```diff\n+                print(G._directed)\n```\n\n- Why do you need `G_directed` in `HB.add_edge(G_to[u], G_to[v], None, G._directed)` ?\n- When `certificate=True`, you must also return the certificate. Currently it's only the graph. Add a docket.\n- For the coding style, we prefer `i, u` and `a, b, c`, so with some spaces\n- Also, comments should be aligned in 80 columns mode",
    "created_at": "2022-03-22T12:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470697",
    "user": "dcoudert"
}
```

It's improving, but I still have few remarks
- remove

```diff
+                print(G._directed)
```

- Why do you need `G_directed` in `HB.add_edge(G_to[u], G_to[v], None, G._directed)` ?
- When `certificate=True`, you must also return the certificate. Currently it's only the graph. Add a docket.
- For the coding style, we prefer `i, u` and `a, b, c`, so with some spaces
- Also, comments should be aligned in 80 columns mode



---

archive/issue_comments_470698.json:
```json
{
    "body": "Whoops! I did intend to remove `G._directed`, reason why I tried to print it out to see what it does. But I somehow forgot to remove it *facepalm*",
    "created_at": "2022-03-22T14:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470698",
    "user": "@enjeck"
}
```

Whoops! I did intend to remove `G._directed`, reason why I tried to print it out to see what it does. But I somehow forgot to remove it *facepalm*



---

archive/issue_comments_470699.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-23T14:00:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470699",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_470700.json:
```json
{
    "body": "The patchbot reports errors:\n\n```\nsage -t --long --warn-long 65.9 --random-seed=139219076014934287513221791550255114412 src/sage/graphs/bipartite_graph.py\n**********************************************************************\nFile \"src/sage/graphs/bipartite_graph.py\", line 2286, in sage.graphs.bipartite_graph.BipartiteGraph.?\nFailed example:\n    C.left\nException raised:\n    Traceback (most recent call last):\n      File \"/home/sagemath/sage/local/var/lib/sage/venv-python3.10.2/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/sagemath/sage/local/var/lib/sage/venv-python3.10.2/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.bipartite_graph.BipartiteGraph.?[6]>\", line 1, in <module>\n        C.left\n    AttributeError: 'tuple' object has no attribute 'left'\n**********************************************************************\nFile \"src/sage/graphs/bipartite_graph.py\", line 2288, in sage.graphs.bipartite_graph.BipartiteGraph.?\nFailed example:\n    C.right\nException raised:\n    Traceback (most recent call last):\n      File \"/home/sagemath/sage/local/var/lib/sage/venv-python3.10.2/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/sagemath/sage/local/var/lib/sage/venv-python3.10.2/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.bipartite_graph.BipartiteGraph.?[7]>\", line 1, in <module>\n        C.right\n    AttributeError: 'tuple' object has no attribute 'right'\n```\n\nIndeed, when `certificate` is `True`, you output 2 objects, and not only the graph.",
    "created_at": "2022-03-24T07:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470700",
    "user": "dcoudert"
}
```

The patchbot reports errors:

```
sage -t --long --warn-long 65.9 --random-seed=139219076014934287513221791550255114412 src/sage/graphs/bipartite_graph.py
**********************************************************************
File "src/sage/graphs/bipartite_graph.py", line 2286, in sage.graphs.bipartite_graph.BipartiteGraph.?
Failed example:
    C.left
Exception raised:
    Traceback (most recent call last):
      File "/home/sagemath/sage/local/var/lib/sage/venv-python3.10.2/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/sagemath/sage/local/var/lib/sage/venv-python3.10.2/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.bipartite_graph.BipartiteGraph.?[6]>", line 1, in <module>
        C.left
    AttributeError: 'tuple' object has no attribute 'left'
**********************************************************************
File "src/sage/graphs/bipartite_graph.py", line 2288, in sage.graphs.bipartite_graph.BipartiteGraph.?
Failed example:
    C.right
Exception raised:
    Traceback (most recent call last):
      File "/home/sagemath/sage/local/var/lib/sage/venv-python3.10.2/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/sagemath/sage/local/var/lib/sage/venv-python3.10.2/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.bipartite_graph.BipartiteGraph.?[7]>", line 1, in <module>
        C.right
    AttributeError: 'tuple' object has no attribute 'right'
```

Indeed, when `certificate` is `True`, you output 2 objects, and not only the graph.



---

archive/issue_comments_470701.json:
```json
{
    "body": "dcoudert, concerning your last comment, I believe I already addressed it in my last commit?",
    "created_at": "2022-03-28T09:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470701",
    "user": "@enjeck"
}
```

dcoudert, concerning your last comment, I believe I already addressed it in my last commit?



---

archive/issue_comments_470702.json:
```json
{
    "body": "yes",
    "created_at": "2022-03-28T09:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470702",
    "user": "dcoudert"
}
```

yes



---

archive/issue_comments_470703.json:
```json
{
    "body": "There might be a misunderstanding: the issue reported in #comment:19 has not been fixed (see the patchbot).",
    "created_at": "2022-04-02T15:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470703",
    "user": "dcoudert"
}
```

There might be a misunderstanding: the issue reported in #comment:19 has not been fixed (see the patchbot).



---

archive/issue_comments_470704.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-04-02T15:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470704",
    "user": "dcoudert"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_470705.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-03T06:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470705",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_470706.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-03T06:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470706",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_470707.json:
```json
{
    "body": "In the doctests, can you add `algorithm='sage'` each time you call `B.canonical_label(...)`. This is to prevent getting different results when you have optional package `bliss` installed (which is my case).\n\nThe canonical label returned by `bliss` is not the same as the one returned when using algorithm `'sage'`, but both labelings are correct.\n\nYou can also remove the doctest `sage: C[1]`. The certificate has already been printed with the line `sage: C`.",
    "created_at": "2022-04-03T12:23:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470707",
    "user": "dcoudert"
}
```

In the doctests, can you add `algorithm='sage'` each time you call `B.canonical_label(...)`. This is to prevent getting different results when you have optional package `bliss` installed (which is my case).

The canonical label returned by `bliss` is not the same as the one returned when using algorithm `'sage'`, but both labelings are correct.

You can also remove the doctest `sage: C[1]`. The certificate has already been printed with the line `sage: C`.



---

archive/issue_comments_470708.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-03T13:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470708",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_470709.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-04-03T13:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470709",
    "user": "@enjeck"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_470710.json:
```json
{
    "body": "- I'm on macOS with sage 9.5.beta7 and I get\n\n```\nsage -t --warn-long 291.0 --random-seed=75080170672752573414336716079288479852 src/sage/graphs/bipartite_graph.py\n**********************************************************************\nFile \"src/sage/graphs/bipartite_graph.py\", line 2289, in sage.graphs.bipartite_graph.BipartiteGraph.?\nFailed example:\n    C\nExpected:\n    (Bipartite graph on 10 vertices,\n     {0: 3, 1: 0, 2: 1, 3: 2, 9: 4, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9})\nGot:\n    (Bipartite graph on 10 vertices,\n     {0: 3, 1: 0, 2: 1, 3: 2, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9, 9: 4})\n**********************************************************************\n```\n\n I'm not sure where the problem comes from. \n\n\n- Concerning the call\n\n```\n            C = GenericGraph.canonical_label(self, partition, certificate, edge_labels, algorithm, return_graph)\n```\n\n May be I'm missing something, but isn't it better to simply do:\n\n```\n            C = self.relabel(perm=cert, inplace=False)\n```\n\n This way you avoid repeating computations you have already done.",
    "created_at": "2022-04-03T13:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470710",
    "user": "dcoudert"
}
```

- I'm on macOS with sage 9.5.beta7 and I get

```
sage -t --warn-long 291.0 --random-seed=75080170672752573414336716079288479852 src/sage/graphs/bipartite_graph.py
**********************************************************************
File "src/sage/graphs/bipartite_graph.py", line 2289, in sage.graphs.bipartite_graph.BipartiteGraph.?
Failed example:
    C
Expected:
    (Bipartite graph on 10 vertices,
     {0: 3, 1: 0, 2: 1, 3: 2, 9: 4, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9})
Got:
    (Bipartite graph on 10 vertices,
     {0: 3, 1: 0, 2: 1, 3: 2, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9, 9: 4})
**********************************************************************
```

 I'm not sure where the problem comes from. 


- Concerning the call

```
            C = GenericGraph.canonical_label(self, partition, certificate, edge_labels, algorithm, return_graph)
```

 May be I'm missing something, but isn't it better to simply do:

```
            C = self.relabel(perm=cert, inplace=False)
```

 This way you avoid repeating computations you have already done.



---

archive/issue_comments_470711.json:
```json
{
    "body": "I'm running the same Sage version, on Ubuntu 20.04.3 and I do get the expected result of ` (Bipartite graph on 10 vertices, {0: 3, 1: 0, 2: 1, 3: 2, 9: 4, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9}) `. I'm also not sure where the inconsistency is coming from.\n\nAnd yes, using ` C = self.relabel(perm=cert, inplace=False) ` works fine",
    "created_at": "2022-04-03T13:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470711",
    "user": "@enjeck"
}
```

I'm running the same Sage version, on Ubuntu 20.04.3 and I do get the expected result of ` (Bipartite graph on 10 vertices, {0: 3, 1: 0, 2: 1, 3: 2, 9: 4, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9}) `. I'm also not sure where the inconsistency is coming from.

And yes, using ` C = self.relabel(perm=cert, inplace=False) ` works fine



---

archive/issue_comments_470712.json:
```json
{
    "body": "I suggest the following change with a more robust test of the certificate:\n\n```diff\n-            sage: C = B.canonical_label(partition=(B.left,B.right), certificate=True, algorithm='sage')\n-            sage: C\n-            (Bipartite graph on 10 vertices,\n-             {0: 3, 1: 0, 2: 1, 3: 2, 9: 4, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9})\n-            sage: C[0].left\n-            {0, 1, 2, 3, 4}\n-            sage: C[0].right\n-            {5, 6, 7, 8, 9}\n+            sage: C, cert = B.canonical_label(partition=(B.left,B.right), certificate=True, algorithm='sage')\n+            sage: C\n+            Bipartite graph on 10 vertices\n+            sage: C.left\n+            {0, 1, 2, 3, 4}\n+            sage: C.right\n+            {5, 6, 7, 8, 9}\n+            sage: cert == {0: 3, 1: 0, 2: 1, 3: 2, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9, 9: 4}\n+            True\n```\n",
    "created_at": "2022-04-03T14:04:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470712",
    "user": "dcoudert"
}
```

I suggest the following change with a more robust test of the certificate:

```diff
-            sage: C = B.canonical_label(partition=(B.left,B.right), certificate=True, algorithm='sage')
-            sage: C
-            (Bipartite graph on 10 vertices,
-             {0: 3, 1: 0, 2: 1, 3: 2, 9: 4, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9})
-            sage: C[0].left
-            {0, 1, 2, 3, 4}
-            sage: C[0].right
-            {5, 6, 7, 8, 9}
+            sage: C, cert = B.canonical_label(partition=(B.left,B.right), certificate=True, algorithm='sage')
+            sage: C
+            Bipartite graph on 10 vertices
+            sage: C.left
+            {0, 1, 2, 3, 4}
+            sage: C.right
+            {5, 6, 7, 8, 9}
+            sage: cert == {0: 3, 1: 0, 2: 1, 3: 2, 4: 5, 5: 7, 6: 6, 7: 8, 8: 9, 9: 4}
+            True
```




---

archive/issue_comments_470713.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-03T14:45:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470713",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_470714.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-04-03T18:50:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470714",
    "user": "dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_470715.json:
```json
{
    "body": "This time I think it's OK. Thanks.",
    "created_at": "2022-04-03T18:50:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470715",
    "user": "dcoudert"
}
```

This time I think it's OK. Thanks.



---

archive/issue_comments_470716.json:
```json
{
    "body": "Merge failure on top of:\n\n216d60bb1b Trac #33633: fix indentation (E111) in pyx files in graphs, libs, proba\n\n39d402cb75 Trac #33629: add negative for continued fractions\n\n4955762701 Trac #33565: Add CODE_OF_CONDUCT.md to the repo\n\n00bc51075d Trac #33560: pytest: ignore cython files\n\na02eec36bf Trac #33582: clean up docstring formatting in schemes/elliptic_curves/\n\n31995b748a Trac #33618: docbuild: typo in arguments check leads to confusing error\n\n94a131cc20 Trac #33612: sage.matrix.matrix_space: Rename a test_... function to _test_... (with deprecation)\n\n823194cfff Trac #33605: cbc: Add system package information for gentoo, nix\n\n6eb1f67d62 Trac #33593: fix W391 in groups/ and algebras/\n\n5ec6108788 Trac #33571: Correct wrong paths in the developer's guide\n\nb886d89536 Trac #33628: Fig bug in graphs.RandomToleranceGraph\n\n5ee8a50e85 Trac #33616: Simplify inventory builder\n\n0a7c8f485c Trac #33615: full cleanup of modules/fp_graded/\n\n97533a71f9 Trac #33589: Gitpod: track remote trac branch\n\nb8d5371aae Trac #33576: Modernize coercion for SpecialHyperellipticQuotientRing\n\n55da3e109e Trac #33572: sage -pytest\n\n2f104e6454 Trac #33533: Update nbconvert to 6.4.x, add optional package pyppeteer\n\n7a5714ac65 Trac #33366: BipartiteGraph() fails to create graph from graph6 string\n\ndfd98a710e Trac #31006: Add more typing information to manifold package\n\n360ee4c168 Trac #30540: Add package phitigra: Graph editor that works with Jupyter\n\n3f93cd0a9c Trac #29640: Create an AUTHORS.md file with links\n\nd8f76fb1bd Trac #33624: doctest unnecessarily assumes SAGE_VENV/bin contains `sage` binary\n\nb438a78918 Trac #33608: Building documentation is broken in Sage 9.6.beta6\n\n88e25dd77b Trac #33631: Github workflow: Fix pyright\n\n78bfb6c7ad Updated [SageMath](SageMath) version to 9.6.beta7\n\n\n\nmerge was not clean: conflicts in src/sage/graphs/bipartite_graph.py",
    "created_at": "2022-04-03T23:15:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470716",
    "user": "vbraun"
}
```

Merge failure on top of:

216d60bb1b Trac #33633: fix indentation (E111) in pyx files in graphs, libs, proba

39d402cb75 Trac #33629: add negative for continued fractions

4955762701 Trac #33565: Add CODE_OF_CONDUCT.md to the repo

00bc51075d Trac #33560: pytest: ignore cython files

a02eec36bf Trac #33582: clean up docstring formatting in schemes/elliptic_curves/

31995b748a Trac #33618: docbuild: typo in arguments check leads to confusing error

94a131cc20 Trac #33612: sage.matrix.matrix_space: Rename a test_... function to _test_... (with deprecation)

823194cfff Trac #33605: cbc: Add system package information for gentoo, nix

6eb1f67d62 Trac #33593: fix W391 in groups/ and algebras/

5ec6108788 Trac #33571: Correct wrong paths in the developer's guide

b886d89536 Trac #33628: Fig bug in graphs.RandomToleranceGraph

5ee8a50e85 Trac #33616: Simplify inventory builder

0a7c8f485c Trac #33615: full cleanup of modules/fp_graded/

97533a71f9 Trac #33589: Gitpod: track remote trac branch

b8d5371aae Trac #33576: Modernize coercion for SpecialHyperellipticQuotientRing

55da3e109e Trac #33572: sage -pytest

2f104e6454 Trac #33533: Update nbconvert to 6.4.x, add optional package pyppeteer

7a5714ac65 Trac #33366: BipartiteGraph() fails to create graph from graph6 string

dfd98a710e Trac #31006: Add more typing information to manifold package

360ee4c168 Trac #30540: Add package phitigra: Graph editor that works with Jupyter

3f93cd0a9c Trac #29640: Create an AUTHORS.md file with links

d8f76fb1bd Trac #33624: doctest unnecessarily assumes SAGE_VENV/bin contains `sage` binary

b438a78918 Trac #33608: Building documentation is broken in Sage 9.6.beta6

88e25dd77b Trac #33631: Github workflow: Fix pyright

78bfb6c7ad Updated [SageMath](SageMath) version to 9.6.beta7



merge was not clean: conflicts in src/sage/graphs/bipartite_graph.py



---

archive/issue_comments_470717.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-04-03T23:15:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470717",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_470718.json:
```json
{
    "body": "should be a conflict with  #33366. Can you try to fix the merge conflict ?",
    "created_at": "2022-04-04T06:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470718",
    "user": "dcoudert"
}
```

should be a conflict with  #33366. Can you try to fix the merge conflict ?



---

archive/issue_comments_470719.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-04T12:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470719",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_470720.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-04-04T12:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470720",
    "user": "@enjeck"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_470721.json:
```json
{
    "body": "Did you have to fix any merge conflict ?",
    "created_at": "2022-04-04T12:30:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470721",
    "user": "dcoudert"
}
```

Did you have to fix any merge conflict ?



---

archive/issue_comments_470722.json:
```json
{
    "body": "Yes. A single conflict with my name in the \"AUTHORS\" list",
    "created_at": "2022-04-04T12:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470722",
    "user": "@enjeck"
}
```

Yes. A single conflict with my name in the "AUTHORS" list



---

archive/issue_comments_470723.json:
```json
{
    "body": "Thanks.",
    "created_at": "2022-04-04T12:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470723",
    "user": "dcoudert"
}
```

Thanks.



---

archive/issue_comments_470724.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-04-04T12:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470724",
    "user": "dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_470725.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-04-10T13:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33009#issuecomment-470725",
    "user": "vbraun"
}
```

Resolution: fixed
