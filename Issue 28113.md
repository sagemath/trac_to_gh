# Issue 28113: Abstract Linear Code No Metric Class

archive/issues_028113.json:
```json
{
    "body": "CC:  dimpase jsrn caruso @adurand8\n\nKeywords: gsoc19\n\nWith the changes in the coding component, the classes `AbstractLinearCode` and `AbstractLinearRankMetricCode` share a lot of the same code. To avoid this and also make creating new linear codes with different metrics easier, we propose to create a new class, `AbstractLinearCodeNoMetric`, which will stand between `AbstractCode` and `AbstractLinearCode`/`AbstractLinearRankMetricCode`. This class will contain all the methods relevant for linear codes, which do not depend on a metric. In practice this is mostly methods related to generator matrix.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28350\n\n",
    "created_at": "2019-08-13T15:43:26Z",
    "labels": [
        "coding theory",
        "major",
        "enhancement"
    ],
    "title": "Abstract Linear Code No Metric Class",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28113",
    "user": "@emes4"
}
```
CC:  dimpase jsrn caruso @adurand8

Keywords: gsoc19

With the changes in the coding component, the classes `AbstractLinearCode` and `AbstractLinearRankMetricCode` share a lot of the same code. To avoid this and also make creating new linear codes with different metrics easier, we propose to create a new class, `AbstractLinearCodeNoMetric`, which will stand between `AbstractCode` and `AbstractLinearCode`/`AbstractLinearRankMetricCode`. This class will contain all the methods relevant for linear codes, which do not depend on a metric. In practice this is mostly methods related to generator matrix.

Issue created by migration from https://trac.sagemath.org/ticket/28350





---

archive/issue_comments_397170.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2019-08-15T14:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397170",
    "user": "@emes4"
}
```

Last 10 new commits:



---

archive/issue_comments_397171.json:
```json
{
    "body": "I created the class `AbstractLinearCodeNoMetric` and moved stuff from `AbstractLinearCode` there, including the category theory set up. I don't understand what the `facade` does, but when I remove it, the test suite test in `LinearCode` is unhappy. \n\nThe only thing I couldn't get to work was the requirement that the dimension of the code is at most the length. The problem is that the dimension requires a generator matrix (unless it's given) and that causes some issues. I kept the check line commented out in `__init__` of `AbstractLinearCodeNoMetric`.\n\nUnlike `AbstractCode`, in `AbstractLinearCodeNoMetric`, it is required that subclasses have default encoders/decoders. This should make sense since we require a generic constructor class.",
    "created_at": "2019-08-15T14:59:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397171",
    "user": "@emes4"
}
```

I created the class `AbstractLinearCodeNoMetric` and moved stuff from `AbstractLinearCode` there, including the category theory set up. I don't understand what the `facade` does, but when I remove it, the test suite test in `LinearCode` is unhappy. 

The only thing I couldn't get to work was the requirement that the dimension of the code is at most the length. The problem is that the dimension requires a generator matrix (unless it's given) and that causes some issues. I kept the check line commented out in `__init__` of `AbstractLinearCodeNoMetric`.

Unlike `AbstractCode`, in `AbstractLinearCodeNoMetric`, it is required that subclasses have default encoders/decoders. This should make sense since we require a generic constructor class.



---

archive/issue_comments_397172.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-08-15T14:59:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397172",
    "user": "@emes4"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_397173.json:
```json
{
    "body": "Set assignee to @emes4.",
    "created_at": "2019-08-15T15:00:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397173",
    "user": "@emes4"
}
```

Set assignee to @emes4.



---

archive/issue_comments_397174.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-19T09:19:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397174",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_397175.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-19T09:21:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397175",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_397176.json:
```json
{
    "body": "Updated Sage.\n\nAdded `linear_code_no_metric.py` to the index of coding module documentation.\n\nMoved `zero` method from `AbstractLinearCode`.\n\nChanged `base_field` check message.",
    "created_at": "2019-08-19T09:23:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397176",
    "user": "@emes4"
}
```

Updated Sage.

Added `linear_code_no_metric.py` to the index of coding module documentation.

Moved `zero` method from `AbstractLinearCode`.

Changed `base_field` check message.



---

archive/issue_comments_397177.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-09-08T14:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397177",
    "user": "dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_397178.json:
```json
{
    "body": "with python3:\n(i.e. doing `./configure --with-python=3` && make)\n\n\n```\nsage -t src/sage/coding/decoder.py\n**********************************************************************\nFile \"src/sage/coding/decoder.py\", line 197, in sage.coding.decoder.Decoder.__hash__\nFailed example:\n    hash(D) #random\nException raised:\n    Traceback (most recent call last):\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.coding.decoder.Decoder.__hash__[3]>\", line 1, in <module>\n        hash(D) #random\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.7/site-packages/sage/coding/linear_code.py\", line 2632, in __hash__\n        return hash((self.code(), self.maximum_error_weight()))\n    TypeError: unhashable type: 'LinearCode_with_category'\n**********************************************************************\n```\n\nthis causes more errors\n\n```\nsage -t src/sage/coding/decoder.py  # 1 doctest failed\nsage -t src/sage/coding/linear_code_no_metric.py  # 2 doctests failed\nsage -t src/sage/coding/linear_code.py  # 1 doctest failed\n```\n",
    "created_at": "2019-09-08T14:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397178",
    "user": "dimpase"
}
```

with python3:
(i.e. doing `./configure --with-python=3` && make)


```
sage -t src/sage/coding/decoder.py
**********************************************************************
File "src/sage/coding/decoder.py", line 197, in sage.coding.decoder.Decoder.__hash__
Failed example:
    hash(D) #random
Exception raised:
    Traceback (most recent call last):
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.coding.decoder.Decoder.__hash__[3]>", line 1, in <module>
        hash(D) #random
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.7/site-packages/sage/coding/linear_code.py", line 2632, in __hash__
        return hash((self.code(), self.maximum_error_weight()))
    TypeError: unhashable type: 'LinearCode_with_category'
**********************************************************************
```

this causes more errors

```
sage -t src/sage/coding/decoder.py  # 1 doctest failed
sage -t src/sage/coding/linear_code_no_metric.py  # 2 doctests failed
sage -t src/sage/coding/linear_code.py  # 1 doctest failed
```




---

archive/issue_comments_397179.json:
```json
{
    "body": "Any chance this could be brought forward - it holds up few more tickets...",
    "created_at": "2019-10-31T21:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397179",
    "user": "dimpase"
}
```

Any chance this could be brought forward - it holds up few more tickets...



---

archive/issue_comments_397180.json:
```json
{
    "body": "I unfortunately don't have any time to move on this currently :-(",
    "created_at": "2019-11-01T10:53:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397180",
    "user": "jsrn"
}
```

I unfortunately don't have any time to move on this currently :-(



---

archive/issue_comments_397181.json:
```json
{
    "body": "I will have a look at it this week!",
    "created_at": "2019-11-03T17:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397181",
    "user": "@emes4"
}
```

I will have a look at it this week!



---

archive/issue_comments_397182.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397182",
    "user": "embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_397183.json:
```json
{
    "body": "Hello,\n\nI'm not really satisfied with the names of the classes.\nInstead, I would propose the following hierarchy:\n\n\n```\nAbstractCode\n  AbstractLinearCode\n    AbstractLinearMetricCode\n      AbstractLinearHammingMetricCode  # if relevant\n      AbstractLinearRankMetricCode\n```\n\n\nAlso, through it is not directly related to this ticket, I don't understand the purpose of the class `LinearCode`...\n----\nNew commits:",
    "created_at": "2020-01-30T10:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397183",
    "user": "caruso"
}
```

Hello,

I'm not really satisfied with the names of the classes.
Instead, I would propose the following hierarchy:


```
AbstractCode
  AbstractLinearCode
    AbstractLinearMetricCode
      AbstractLinearHammingMetricCode  # if relevant
      AbstractLinearRankMetricCode
```


Also, through it is not directly related to this ticket, I don't understand the purpose of the class `LinearCode`...
----
New commits:



---

archive/issue_comments_397184.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-30T10:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397184",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_397185.json:
```json
{
    "body": "Replying to [comment:19 caruso]:\n> I'm not really satisfied with the names of the classes.\n\nI'd propose that we complete this ticket and #28209 (which depends on this ticket) with as few chnages as posssible,\nand then go on with renaming/redesigning.",
    "created_at": "2020-01-30T11:04:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397185",
    "user": "dimpase"
}
```

Replying to [comment:19 caruso]:
> I'm not really satisfied with the names of the classes.

I'd propose that we complete this ticket and #28209 (which depends on this ticket) with as few chnages as posssible,
and then go on with renaming/redesigning.



---

archive/issue_comments_397186.json:
```json
{
    "body": "tests pass now. Is it ready for review?",
    "created_at": "2020-01-30T11:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397186",
    "user": "dimpase"
}
```

tests pass now. Is it ready for review?



---

archive/issue_comments_397187.json:
```json
{
    "body": "Ping?",
    "created_at": "2020-02-13T23:16:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397187",
    "user": "dimpase"
}
```

Ping?



---

archive/issue_comments_397188.json:
```json
{
    "body": "Dima, is there a specific reason you refrain from reviewing yourself? I'm completely swamped right now, so there's no chance I'll do it any time soon, but I remember being fairly happy about the design during GSoC.\n\n`@`caruso: Concerning your proposed naming, I guess your names are better from a completely general point of view. The current naming is for \"historic reasons\" centering on classical \"linear codes over Hamming metric\" being what everyone would expect. So in some sense the names follow the principal of least surprise by specifically pointing out in the name when it differs from the \"expected\". But I think I could easily be talked into going with your hierarchy.\n\nThe purpose of `LinearCode` btw is to act as a thin wrapper around `AbstractLinearCode` for constructing \"unstructured\" codes directly from a generator matrix. That's an essential class for users. The distinction from `AbstractLinearCode` was created as part of the encoder-framework (long story), but is a typical way to construct a class hierarchy in more strongly typed languages: if I could do so in Python, I would specify on a type level that AbstractLinearCode is not supposed to be instantiated directly.",
    "created_at": "2020-02-27T20:38:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397188",
    "user": "jsrn"
}
```

Dima, is there a specific reason you refrain from reviewing yourself? I'm completely swamped right now, so there's no chance I'll do it any time soon, but I remember being fairly happy about the design during GSoC.

`@`caruso: Concerning your proposed naming, I guess your names are better from a completely general point of view. The current naming is for "historic reasons" centering on classical "linear codes over Hamming metric" being what everyone would expect. So in some sense the names follow the principal of least surprise by specifically pointing out in the name when it differs from the "expected". But I think I could easily be talked into going with your hierarchy.

The purpose of `LinearCode` btw is to act as a thin wrapper around `AbstractLinearCode` for constructing "unstructured" codes directly from a generator matrix. That's an essential class for users. The distinction from `AbstractLinearCode` was created as part of the encoder-framework (long story), but is a typical way to construct a class hierarchy in more strongly typed languages: if I could do so in Python, I would specify on a type level that AbstractLinearCode is not supposed to be instantiated directly.



---

archive/issue_comments_397189.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-02-27T20:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397189",
    "user": "dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_397190.json:
```json
{
    "body": "I was not reviewing as the ticket is set to `needs work`. So I've set it to needs review and to positive review now.",
    "created_at": "2020-02-27T20:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397190",
    "user": "dimpase"
}
```

I was not reviewing as the ticket is set to `needs work`. So I've set it to needs review and to positive review now.



---

archive/issue_comments_397191.json:
```json
{
    "body": "Merge conflit",
    "created_at": "2020-02-27T23:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397191",
    "user": "vbraun"
}
```

Merge conflit



---

archive/issue_comments_397192.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-02-27T23:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397192",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_397193.json:
```json
{
    "body": "rebased\n----\nNew commits:",
    "created_at": "2020-03-03T11:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397193",
    "user": "dimpase"
}
```

rebased
----
New commits:



---

archive/issue_comments_397194.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-03-03T11:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397194",
    "user": "dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_397195.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-03-05T23:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28113#issuecomment-397195",
    "user": "vbraun"
}
```

Resolution: fixed
