# Issue 28113: Abstract Linear Code No Metric Class

Issue created by migration from https://trac.sagemath.org/ticket/28350

Original creator: @emes4

Original creation time: 2019-08-13 15:43:26

CC:  dimpase jsrn caruso @adurand8

Keywords: gsoc19

With the changes in the coding component, the classes `AbstractLinearCode` and `AbstractLinearRankMetricCode` share a lot of the same code. To avoid this and also make creating new linear codes with different metrics easier, we propose to create a new class, `AbstractLinearCodeNoMetric`, which will stand between `AbstractCode` and `AbstractLinearCode`/`AbstractLinearRankMetricCode`. This class will contain all the methods relevant for linear codes, which do not depend on a metric. In practice this is mostly methods related to generator matrix.


---

Comment by @emes4 created at 2019-08-15 14:56:56

Last 10 new commits:


---

Comment by @emes4 created at 2019-08-15 14:59:54

I created the class `AbstractLinearCodeNoMetric` and moved stuff from `AbstractLinearCode` there, including the category theory set up. I don't understand what the `facade` does, but when I remove it, the test suite test in `LinearCode` is unhappy. 

The only thing I couldn't get to work was the requirement that the dimension of the code is at most the length. The problem is that the dimension requires a generator matrix (unless it's given) and that causes some issues. I kept the check line commented out in `__init__` of `AbstractLinearCodeNoMetric`.

Unlike `AbstractCode`, in `AbstractLinearCodeNoMetric`, it is required that subclasses have default encoders/decoders. This should make sense since we require a generic constructor class.


---

Comment by @emes4 created at 2019-08-15 14:59:59

Changing status from new to needs_review.


---

Comment by @emes4 created at 2019-08-15 15:00:11

Set assignee to @emes4.


---

Comment by git created at 2019-08-19 09:19:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-08-19 09:21:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @emes4 created at 2019-08-19 09:23:12

Updated Sage.

Added `linear_code_no_metric.py` to the index of coding module documentation.

Moved `zero` method from `AbstractLinearCode`.

Changed `base_field` check message.


---

Comment by dimpase created at 2019-09-08 14:09:32

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2019-09-08 14:09:32

with python3:
(i.e. doing `./configure --with-python=3` && make)


```
sage -t src/sage/coding/decoder.py
**********************************************************************
File "src/sage/coding/decoder.py", line 197, in sage.coding.decoder.Decoder.__hash__
Failed example:
    hash(D) #random
Exception raised:
    Traceback (most recent call last):
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.coding.decoder.Decoder.__hash__[3]>", line 1, in <module>
        hash(D) #random
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.7/site-packages/sage/coding/linear_code.py", line 2632, in __hash__
        return hash((self.code(), self.maximum_error_weight()))
    TypeError: unhashable type: 'LinearCode_with_category'
**********************************************************************
```

this causes more errors

```
sage -t src/sage/coding/decoder.py  # 1 doctest failed
sage -t src/sage/coding/linear_code_no_metric.py  # 2 doctests failed
sage -t src/sage/coding/linear_code.py  # 1 doctest failed
```



---

Comment by dimpase created at 2019-10-31 21:14:26

Any chance this could be brought forward - it holds up few more tickets...


---

Comment by jsrn created at 2019-11-01 10:53:33

I unfortunately don't have any time to move on this currently :-(


---

Comment by @emes4 created at 2019-11-03 17:06:14

I will have a look at it this week!


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by caruso created at 2020-01-30 10:52:40

Hello,

I'm not really satisfied with the names of the classes.
Instead, I would propose the following hierarchy:


```
AbstractCode
  AbstractLinearCode
    AbstractLinearMetricCode
      AbstractLinearHammingMetricCode  # if relevant
      AbstractLinearRankMetricCode
```


Also, through it is not directly related to this ticket, I don't understand the purpose of the class `LinearCode`...
----
New commits:


---

Comment by git created at 2020-01-30 10:54:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-01-30 11:04:41

Replying to [comment:19 caruso]:
> I'm not really satisfied with the names of the classes.

I'd propose that we complete this ticket and #28209 (which depends on this ticket) with as few chnages as posssible,
and then go on with renaming/redesigning.


---

Comment by dimpase created at 2020-01-30 11:26:25

tests pass now. Is it ready for review?


---

Comment by dimpase created at 2020-02-13 23:16:08

Ping?


---

Comment by jsrn created at 2020-02-27 20:38:16

Dima, is there a specific reason you refrain from reviewing yourself? I'm completely swamped right now, so there's no chance I'll do it any time soon, but I remember being fairly happy about the design during GSoC.

`@`caruso: Concerning your proposed naming, I guess your names are better from a completely general point of view. The current naming is for "historic reasons" centering on classical "linear codes over Hamming metric" being what everyone would expect. So in some sense the names follow the principal of least surprise by specifically pointing out in the name when it differs from the "expected". But I think I could easily be talked into going with your hierarchy.

The purpose of `LinearCode` btw is to act as a thin wrapper around `AbstractLinearCode` for constructing "unstructured" codes directly from a generator matrix. That's an essential class for users. The distinction from `AbstractLinearCode` was created as part of the encoder-framework (long story), but is a typical way to construct a class hierarchy in more strongly typed languages: if I could do so in Python, I would specify on a type level that AbstractLinearCode is not supposed to be instantiated directly.


---

Comment by dimpase created at 2020-02-27 20:58:42

Changing status from needs_work to positive_review.


---

Comment by dimpase created at 2020-02-27 20:58:42

I was not reviewing as the ticket is set to `needs work`. So I've set it to needs review and to positive review now.


---

Comment by vbraun created at 2020-02-27 23:15:39

Merge conflit


---

Comment by vbraun created at 2020-02-27 23:15:39

Changing status from positive_review to needs_work.


---

Comment by dimpase created at 2020-03-03 11:47:31

rebased
----
New commits:


---

Comment by dimpase created at 2020-03-03 11:47:31

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2020-03-05 23:23:15

Resolution: fixed
