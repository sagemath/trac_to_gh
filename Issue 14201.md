# Issue 14201: The libncurses hack breaks Python/readline

archive/issues_014201.json:
```json
{
    "body": "Assignee: @jdemeyer\n\nCC:  @jdemeyer jpflori @nexttime\n\n#12725 symlinks libtermcap.a to libncurses.a if it doesn't exist. This workaround allows Sage to compile, but the readline in Python is broken. Installing the ncurses headers from the distribution (yum install ncurses-devel) fixes this, because then the symlink is not created. \n\nExample video:  http://youtu.be/dxp1SIXbIyY\n\nIssue created by migration from https://trac.sagemath.org/ticket/14405\n\n",
    "created_at": "2013-04-03T11:34:58Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.12",
    "title": "The libncurses hack breaks Python/readline",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14201",
    "user": "@vbraun"
}
```
Assignee: @jdemeyer

CC:  @jdemeyer jpflori @nexttime

#12725 symlinks libtermcap.a to libncurses.a if it doesn't exist. This workaround allows Sage to compile, but the readline in Python is broken. Installing the ncurses headers from the distribution (yum install ncurses-devel) fixes this, because then the symlink is not created. 

Example video:  http://youtu.be/dxp1SIXbIyY

Issue created by migration from https://trac.sagemath.org/ticket/14405





---

archive/issue_comments_178464.json:
```json
{
    "body": "Does Python's readline work correctly with the old termcap spkg (http://boxen.math.washington.edu/home/release/sage-5.6/sage-5.6/spkg/standard/termcap-1.3.1.p2.spkg)? Because if it worked neither before #12725, nor after #12725, there is no bug.\n\nIf Python's readline did work before #12725 and #12725 broke it: please attach logs of the Python compilation, before and after (with the same Sage version, serial install).",
    "created_at": "2013-04-03T12:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178464",
    "user": "@jdemeyer"
}
```

Does Python's readline work correctly with the old termcap spkg (http://boxen.math.washington.edu/home/release/sage-5.6/sage-5.6/spkg/standard/termcap-1.3.1.p2.spkg)? Because if it worked neither before #12725, nor after #12725, there is no bug.

If Python's readline did work before #12725 and #12725 broke it: please attach logs of the Python compilation, before and after (with the same Sage version, serial install).



---

archive/issue_comments_178465.json:
```json
{
    "body": "I've tested an old 4.8 install which works fine whereas I found the same problem as Volker on a recent 5.9.beta2.\nThis is on two different Ubuntu 12.04.1 installs where libncurses5 and libncursesw5 packages are installed but no -dev packages are.",
    "created_at": "2013-04-03T12:30:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178465",
    "user": "jpflori"
}
```

I've tested an old 4.8 install which works fine whereas I found the same problem as Volker on a recent 5.9.beta2.
This is on two different Ubuntu 12.04.1 installs where libncurses5 and libncursesw5 packages are installed but no -dev packages are.



---

archive/issue_comments_178466.json:
```json
{
    "body": "Replying to [comment:3 jpflori]:\n> I've tested an old 4.8 install which works fine whereas I found the same problem as Volker on a recent 5.9.beta2.\n> This is on two different Ubuntu 12.04.1 installs where libncurses5 and libncursesw5 packages are installed but no -dev packages are.\n\nOK, then please try the things I asked to Volker: try without #12725 and show the Python logs so we can see what the problem is.",
    "created_at": "2013-04-03T12:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178466",
    "user": "@jdemeyer"
}
```

Replying to [comment:3 jpflori]:
> I've tested an old 4.8 install which works fine whereas I found the same problem as Volker on a recent 5.9.beta2.
> This is on two different Ubuntu 12.04.1 installs where libncurses5 and libncursesw5 packages are installed but no -dev packages are.

OK, then please try the things I asked to Volker: try without #12725 and show the Python logs so we can see what the problem is.



---

archive/issue_comments_178467.json:
```json
{
    "body": "As I already typed that, here is a bit of info:\n* On the 4.8 install, I have the usual \"Python build finished, but the necessary bits to build these modules were not found\" and the modules listed include _curses and _curses_panel.\n* On the 5.9.beta2 install, it only lists the _curses_panel module and I have a new worrying line \"Failed to build these modules\" which only lists _curses. And indeed before in the log, there's an error:\n\n```\nIn file included from .../_cursesmodule.c:114:0:\nInclude/py_curses.h:57:20: erreur fatale: curses.h : Aucun fichier ou dossier de ce type\n```\n",
    "created_at": "2013-04-03T12:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178467",
    "user": "jpflori"
}
```

As I already typed that, here is a bit of info:
* On the 4.8 install, I have the usual "Python build finished, but the necessary bits to build these modules were not found" and the modules listed include _curses and _curses_panel.
* On the 5.9.beta2 install, it only lists the _curses_panel module and I have a new worrying line "Failed to build these modules" which only lists _curses. And indeed before in the log, there's an error:

```
In file included from .../_cursesmodule.c:114:0:
Include/py_curses.h:57:20: erreur fatale: curses.h : Aucun fichier ou dossier de ce type
```




---

archive/issue_comments_178468.json:
```json
{
    "body": "(And installing the latest Python spkg on the 4.8 Sage install gives the same result as the old 2.6.* spkg which it included, i.e. missing bits for _curses and _curses_panel.)",
    "created_at": "2013-04-03T12:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178468",
    "user": "jpflori"
}
```

(And installing the latest Python spkg on the 4.8 Sage install gives the same result as the old 2.6.* spkg which it included, i.e. missing bits for _curses and _curses_panel.)



---

archive/issue_comments_178469.json:
```json
{
    "body": "Replying to [comment:6 jpflori]:\n> (And installing the latest Python spkg on the 4.8 Sage install gives the same result as the old 2.6.* spkg which it included, i.e. missing bits for _curses and _curses_panel.)\nBut the end result is the same: the `_curses` module doesn't build (either due to \"missing bits\" or \"failed to build\"), neither with #12725, nor without. So I still doubt that #12725 is a problem.\n\nWhat happens with other packages using readline, PARI/GP for example? How is the line editing in\n\n```\n$ ./sage --gp\n```\n\nAnd what is the header message when starting GP, it indicates whether or not readline is used.",
    "created_at": "2013-04-03T12:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178469",
    "user": "@jdemeyer"
}
```

Replying to [comment:6 jpflori]:
> (And installing the latest Python spkg on the 4.8 Sage install gives the same result as the old 2.6.* spkg which it included, i.e. missing bits for _curses and _curses_panel.)
But the end result is the same: the `_curses` module doesn't build (either due to "missing bits" or "failed to build"), neither with #12725, nor without. So I still doubt that #12725 is a problem.

What happens with other packages using readline, PARI/GP for example? How is the line editing in

```
$ ./sage --gp
```

And what is the header message when starting GP, it indicates whether or not readline is used.



---

archive/issue_comments_178470.json:
```json
{
    "body": "And after removing the libncurses.a symlink and rebuilding the Python 2.7 spkg on the 5.9.beta2, the log looks similar to the one on the 4.8 install.\nBut Sage command line still seems broken (I've rebuilt ipython and run ./sage -b).\n\nI could not test the new python on the 4.8 install as it does not like it that much and fails to rebuild.\n\nNo such problems on 5.6 and 5.7, so I guess that #12725 is not the culprit for the bug (although the error message about _curses I get shows it may not be that useful).\nMaybe new ipython?",
    "created_at": "2013-04-03T12:57:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178470",
    "user": "jpflori"
}
```

And after removing the libncurses.a symlink and rebuilding the Python 2.7 spkg on the 5.9.beta2, the log looks similar to the one on the 4.8 install.
But Sage command line still seems broken (I've rebuilt ipython and run ./sage -b).

I could not test the new python on the 4.8 install as it does not like it that much and fails to rebuild.

No such problems on 5.6 and 5.7, so I guess that #12725 is not the culprit for the bug (although the error message about _curses I get shows it may not be that useful).
Maybe new ipython?



---

archive/issue_comments_178471.json:
```json
{
    "body": "The standard Fedora install contains `ncurses` and `ncurses-libs` rpms, which install `libncurses.so.5` but no `libncurses.so`. Only the `ncurses-devel` package, which is not installed by default, brings `libncurses.so`.",
    "created_at": "2013-04-03T12:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178471",
    "user": "@vbraun"
}
```

The standard Fedora install contains `ncurses` and `ncurses-libs` rpms, which install `libncurses.so.5` but no `libncurses.so`. Only the `ncurses-devel` package, which is not installed by default, brings `libncurses.so`.



---

archive/issue_comments_178472.json:
```json
{
    "body": "Replying to [comment:8 jpflori]:\n> And after removing the libncurses.a symlink and rebuilding the Python 2.7 spkg on the 5.9.beta2, the log looks similar to the one on the 4.8 install.\n> But Sage command line still seems broken (I've rebuilt ipython and run ./sage -b).\n> \n> I could not test the new python on the 4.8 install as it does not like it that much and fails to rebuild.\n> \n> No such problems on 5.6 and 5.7, so I guess that #12725 is not the culprit for the bug (although the error message about _curses I get shows it may not be that useful).\n> Maybe new ipython?\nIpython was updated in 5.7, so that's not it.",
    "created_at": "2013-04-03T13:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178472",
    "user": "jpflori"
}
```

Replying to [comment:8 jpflori]:
> And after removing the libncurses.a symlink and rebuilding the Python 2.7 spkg on the 5.9.beta2, the log looks similar to the one on the 4.8 install.
> But Sage command line still seems broken (I've rebuilt ipython and run ./sage -b).
> 
> I could not test the new python on the 4.8 install as it does not like it that much and fails to rebuild.
> 
> No such problems on 5.6 and 5.7, so I guess that #12725 is not the culprit for the bug (although the error message about _curses I get shows it may not be that useful).
> Maybe new ipython?
Ipython was updated in 5.7, so that's not it.



---

archive/issue_comments_178473.json:
```json
{
    "body": "I've removed `ncurses-devel` again and compiled sage-5.9.beta2 with the old termcap-1.3.1.p2.spkg. The python command line is still borked in the same way. But no libncurses symlink. So I guess the bug is somewhere else.",
    "created_at": "2013-04-03T13:04:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178473",
    "user": "@vbraun"
}
```

I've removed `ncurses-devel` again and compiled sage-5.9.beta2 with the old termcap-1.3.1.p2.spkg. The python command line is still borked in the same way. But no libncurses symlink. So I guess the bug is somewhere else.



---

archive/issue_comments_178474.json:
```json
{
    "body": "Replying to [comment:7 jdemeyer]:\n> Replying to [comment:6 jpflori]:\n> > (And installing the latest Python spkg on the 4.8 Sage install gives the same result as the old 2.6.* spkg which it included, i.e. missing bits for _curses and _curses_panel.)\n> But the end result is the same: the `_curses` module doesn't build (either due to \"missing bits\" or \"failed to build\"), neither with #12725, nor without. So I still doubt that #12725 is a problem.\n> \n> What happens with other packages using readline, PARI/GP for example? How is the line editing in\n> {{{\n> $ ./sage --gp\n> }}}\n> And what is the header message when starting GP, it indicates whether or not readline is used.\nI've now rebuilt readline, ipython, pari as well, still without the libncurses.a symlink.\n./sage -gp works fine (and shows realine 6.2 is enabled), and sage command line still broken.",
    "created_at": "2013-04-03T13:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178474",
    "user": "jpflori"
}
```

Replying to [comment:7 jdemeyer]:
> Replying to [comment:6 jpflori]:
> > (And installing the latest Python spkg on the 4.8 Sage install gives the same result as the old 2.6.* spkg which it included, i.e. missing bits for _curses and _curses_panel.)
> But the end result is the same: the `_curses` module doesn't build (either due to "missing bits" or "failed to build"), neither with #12725, nor without. So I still doubt that #12725 is a problem.
> 
> What happens with other packages using readline, PARI/GP for example? How is the line editing in
> {{{
> $ ./sage --gp
> }}}
> And what is the header message when starting GP, it indicates whether or not readline is used.
I've now rebuilt readline, ipython, pari as well, still without the libncurses.a symlink.
./sage -gp works fine (and shows realine 6.2 is enabled), and sage command line still broken.



---

archive/issue_comments_178475.json:
```json
{
    "body": "Note the ./sage -python command line is fine, whereas ./sage -ipython is not.",
    "created_at": "2013-04-03T13:07:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178475",
    "user": "jpflori"
}
```

Note the ./sage -python command line is fine, whereas ./sage -ipython is not.



---

archive/issue_comments_178476.json:
```json
{
    "body": "In Sage 5.7, the sage command line is fine whereas the ipython one is already (in color) and broken.",
    "created_at": "2013-04-03T13:08:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178476",
    "user": "jpflori"
}
```

In Sage 5.7, the sage command line is fine whereas the ipython one is already (in color) and broken.



---

archive/issue_comments_178477.json:
```json
{
    "body": "In fact with the old ipython 0.10 from sage 5.6, the command line is already broken.",
    "created_at": "2013-04-03T13:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178477",
    "user": "jpflori"
}
```

In fact with the old ipython 0.10 from sage 5.6, the command line is already broken.



---

archive/issue_comments_178478.json:
```json
{
    "body": "Replying to [comment:9 vbraun]:\n> The standard Fedora install contains `ncurses` and `ncurses-libs` rpms, which install `libncurses.so.5` but no `libncurses.so`. Only the `ncurses-devel` package, which is not installed by default, brings `libncurses.so`.\n\nWhich is pretty correct.  No system should have `foo.so` (nor `foo.a`!) unless `foo.h` (i.e., the related headers) are also present.",
    "created_at": "2013-04-03T13:22:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178478",
    "user": "@nexttime"
}
```

Replying to [comment:9 vbraun]:
> The standard Fedora install contains `ncurses` and `ncurses-libs` rpms, which install `libncurses.so.5` but no `libncurses.so`. Only the `ncurses-devel` package, which is not installed by default, brings `libncurses.so`.

Which is pretty correct.  No system should have `foo.so` (nor `foo.a`!) unless `foo.h` (i.e., the related headers) are also present.



---

archive/issue_comments_178479.json:
```json
{
    "body": "To go from broken -> fixed: Install ncurses-devel, recompile readline, recompile python.",
    "created_at": "2013-04-03T13:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178479",
    "user": "@vbraun"
}
```

To go from broken -> fixed: Install ncurses-devel, recompile readline, recompile python.



---

archive/issue_comments_178480.json:
```json
{
    "body": "The `sage -gp` readline also is different between the working and broken sage commandline. If I compile the working readline, `sage -gp` has correct multi-line readline (input is continued on subsequent lines. With the broken readline, `sage -gp` falls back to single-line readline (input scrolls horizontally if necessary).",
    "created_at": "2013-04-03T13:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178480",
    "user": "@vbraun"
}
```

The `sage -gp` readline also is different between the working and broken sage commandline. If I compile the working readline, `sage -gp` has correct multi-line readline (input is continued on subsequent lines. With the broken readline, `sage -gp` falls back to single-line readline (input scrolls horizontally if necessary).



---

archive/issue_comments_178481.json:
```json
{
    "body": "Curiously, the log file for readline is identical (apart from the timing stats). But it fails to link to tinfo in the broken version\n\n```\n[vbraun@volker-desktop sage-5.9.beta2]$ ldd local/lib/libreadline.so\n\tlinux-vdso.so.1 =>  (0x00007fff365fe000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007f2866ee3000)\n\t/lib64/ld-linux-x86-64.so.2 (0x0000003c14800000)\n```\n\nvs the fixed version:\n\n```\n[vbraun@volker-desktop sage-5.9.beta2]$ ldd local/lib/libreadline.so\n\tlinux-vdso.so.1 =>  (0x00007fffef3fe000)\n\tlibtinfo.so.5 => /lib64/libtinfo.so.5 (0x00007ffb0c10a000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007ffb0bd51000)\n\t/lib64/ld-linux-x86-64.so.2 (0x0000003c14800000)\n[vbraun@volker-desktop sage-5.9.beta2]$ cat /usr/lib64/libncurses.so\nINPUT(libncurses.so.5 -ltinfo)\n```\n",
    "created_at": "2013-04-03T13:39:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178481",
    "user": "@vbraun"
}
```

Curiously, the log file for readline is identical (apart from the timing stats). But it fails to link to tinfo in the broken version

```
[vbraun@volker-desktop sage-5.9.beta2]$ ldd local/lib/libreadline.so
	linux-vdso.so.1 =>  (0x00007fff365fe000)
	libc.so.6 => /lib64/libc.so.6 (0x00007f2866ee3000)
	/lib64/ld-linux-x86-64.so.2 (0x0000003c14800000)
```

vs the fixed version:

```
[vbraun@volker-desktop sage-5.9.beta2]$ ldd local/lib/libreadline.so
	linux-vdso.so.1 =>  (0x00007fffef3fe000)
	libtinfo.so.5 => /lib64/libtinfo.so.5 (0x00007ffb0c10a000)
	libc.so.6 => /lib64/libc.so.6 (0x00007ffb0bd51000)
	/lib64/ld-linux-x86-64.so.2 (0x0000003c14800000)
[vbraun@volker-desktop sage-5.9.beta2]$ cat /usr/lib64/libncurses.so
INPUT(libncurses.so.5 -ltinfo)
```




---

archive/issue_comments_178482.json:
```json
{
    "body": "Attachment [log-python-2.7.3.p5.diff](tarball://root/attachments/some-uuid/ticket14405/log-python-2.7.3.p5.diff) by @vbraun created at 2013-04-03 13:41:56\n\nDiff between broken and fixed python install",
    "created_at": "2013-04-03T13:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178482",
    "user": "@vbraun"
}
```

Attachment [log-python-2.7.3.p5.diff](tarball://root/attachments/some-uuid/ticket14405/log-python-2.7.3.p5.diff) by @vbraun created at 2013-04-03 13:41:56

Diff between broken and fixed python install



---

archive/issue_comments_178483.json:
```json
{
    "body": "Replying to [comment:19 vbraun]:\n> The `sage -gp` readline also is different between the working and broken sage commandline. If I compile the working readline, `sage -gp` has correct multi-line readline (input is continued on subsequent lines. With the broken readline, `sage -gp` falls back to single-line readline (input scrolls horizontally if necessary).\n> \nWith all versions I have, I get horizontla scrolling indeed (but not borken as with the ipython command prompt).",
    "created_at": "2013-04-03T13:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178483",
    "user": "jpflori"
}
```

Replying to [comment:19 vbraun]:
> The `sage -gp` readline also is different between the working and broken sage commandline. If I compile the working readline, `sage -gp` has correct multi-line readline (input is continued on subsequent lines. With the broken readline, `sage -gp` falls back to single-line readline (input scrolls horizontally if necessary).
> 
With all versions I have, I get horizontla scrolling indeed (but not borken as with the ipython command prompt).



---

archive/issue_comments_178484.json:
```json
{
    "body": "Replying to [comment:16 vbraun]:\n> Deleting (renaming) `$SAGE_LOCAL/share` fixes this, even without recompiling.\nSo the issue is IPython configuration then?",
    "created_at": "2013-04-03T13:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178484",
    "user": "@jdemeyer"
}
```

Replying to [comment:16 vbraun]:
> Deleting (renaming) `$SAGE_LOCAL/share` fixes this, even without recompiling.
So the issue is IPython configuration then?



---

archive/issue_comments_178485.json:
```json
{
    "body": "Replying to [comment:18 vbraun]:\n> To go from broken -> fixed: Install ncurses-devel, recompile readline, recompile python.\nBut I guess this \"fixed\" readline links to libncurses, doesn't it?\nWe don't want that...\nWe want to use the libtermcap we provide.",
    "created_at": "2013-04-03T13:47:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178485",
    "user": "jpflori"
}
```

Replying to [comment:18 vbraun]:
> To go from broken -> fixed: Install ncurses-devel, recompile readline, recompile python.
But I guess this "fixed" readline links to libncurses, doesn't it?
We don't want that...
We want to use the libtermcap we provide.



---

archive/issue_comments_178486.json:
```json
{
    "body": "In fact, I don't need to recompile python. Just install ncurses-devel and recompile readline = working. Uninstall ncurses-devel and recompile readline = broken.",
    "created_at": "2013-04-03T13:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178486",
    "user": "@vbraun"
}
```

In fact, I don't need to recompile python. Just install ncurses-devel and recompile readline = working. Uninstall ncurses-devel and recompile readline = broken.



---

archive/issue_comments_178487.json:
```json
{
    "body": "The real reason is libtinfo. In fact I can just `export LD_PRELOAD=/usr/lib64/libtinfo.so.5` and this fixes it.",
    "created_at": "2013-04-03T13:54:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178487",
    "user": "@vbraun"
}
```

The real reason is libtinfo. In fact I can just `export LD_PRELOAD=/usr/lib64/libtinfo.so.5` and this fixes it.



---

archive/issue_comments_178488.json:
```json
{
    "body": "So what should we do, make a tinfo spkg or require ncurses-devel?",
    "created_at": "2013-04-03T13:57:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178488",
    "user": "@vbraun"
}
```

So what should we do, make a tinfo spkg or require ncurses-devel?



---

archive/issue_comments_178489.json:
```json
{
    "body": "Replying to [comment:23 jpflori]:\n> Replying to [comment:18 vbraun]:\n> > To go from broken -> fixed: Install ncurses-devel, recompile readline, recompile python.\n> But I guess this \"fixed\" readline links to libncurses, doesn't it?\n> We don't want that...\n> We want to use the libtermcap we provide.\n\nNot me.  We shouldn't build libtermcap at all on systems that have libncurses / libtinfo [-dev].",
    "created_at": "2013-04-03T13:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178489",
    "user": "@nexttime"
}
```

Replying to [comment:23 jpflori]:
> Replying to [comment:18 vbraun]:
> > To go from broken -> fixed: Install ncurses-devel, recompile readline, recompile python.
> But I guess this "fixed" readline links to libncurses, doesn't it?
> We don't want that...
> We want to use the libtermcap we provide.

Not me.  We shouldn't build libtermcap at all on systems that have libncurses / libtinfo [-dev].



---

archive/issue_comments_178490.json:
```json
{
    "body": "Replying to [comment:27 vbraun]:\n> So what should we do, make a tinfo spkg or require ncurses-devel?\nFix IPython?",
    "created_at": "2013-04-03T14:03:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178490",
    "user": "@jdemeyer"
}
```

Replying to [comment:27 vbraun]:
> So what should we do, make a tinfo spkg or require ncurses-devel?
Fix IPython?



---

archive/issue_comments_178491.json:
```json
{
    "body": "Replying to [comment:28 leif]:\n> Replying to [comment:23 jpflori]:\n> > Replying to [comment:18 vbraun]:\n> > > To go from broken -> fixed: Install ncurses-devel, recompile readline, recompile python.\n> > But I guess this \"fixed\" readline links to libncurses, doesn't it?\n> > We don't want that...\n> > We want to use the libtermcap we provide.\n> \n> Not me.  We shouldn't build libtermcap at all on systems that have libncurses / libtinfo [-dev].\nAnd what about systems not having any -dev packages?",
    "created_at": "2013-04-03T14:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178491",
    "user": "jpflori"
}
```

Replying to [comment:28 leif]:
> Replying to [comment:23 jpflori]:
> > Replying to [comment:18 vbraun]:
> > > To go from broken -> fixed: Install ncurses-devel, recompile readline, recompile python.
> > But I guess this "fixed" readline links to libncurses, doesn't it?
> > We don't want that...
> > We want to use the libtermcap we provide.
> 
> Not me.  We shouldn't build libtermcap at all on systems that have libncurses / libtinfo [-dev].
And what about systems not having any -dev packages?



---

archive/issue_comments_178492.json:
```json
{
    "body": "Replying to [comment:26 vbraun]:\n> The real reason is libtinfo. In fact I can just `export LD_PRELOAD=/usr/lib64/libtinfo.so.5` and this fixes it.\nI don't have libtinfo on my systems :)",
    "created_at": "2013-04-03T14:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178492",
    "user": "jpflori"
}
```

Replying to [comment:26 vbraun]:
> The real reason is libtinfo. In fact I can just `export LD_PRELOAD=/usr/lib64/libtinfo.so.5` and this fixes it.
I don't have libtinfo on my systems :)



---

archive/issue_comments_178493.json:
```json
{
    "body": "I guess Ubuntu packages it inside libncurses: https://bugs.launchpad.net/ubuntu/+source/ncurses/+bug/259139",
    "created_at": "2013-04-03T14:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178493",
    "user": "jpflori"
}
```

I guess Ubuntu packages it inside libncurses: https://bugs.launchpad.net/ubuntu/+source/ncurses/+bug/259139



---

archive/issue_comments_178494.json:
```json
{
    "body": "Fedora packages libtinfo also as part of ncurses.\n\nJeroen, please read my edits on comment:16",
    "created_at": "2013-04-03T14:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178494",
    "user": "@vbraun"
}
```

Fedora packages libtinfo also as part of ncurses.

Jeroen, please read my edits on comment:16



---

archive/issue_comments_178495.json:
```json
{
    "body": "If I run LD_PRELOAD=...libncurses.so.5 ./sage -ipython then long command lines are ok.\nNotice that the same experiment with ./sage -gp still gives me horizontal scrolling.",
    "created_at": "2013-04-03T14:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178495",
    "user": "jpflori"
}
```

If I run LD_PRELOAD=...libncurses.so.5 ./sage -ipython then long command lines are ok.
Notice that the same experiment with ./sage -gp still gives me horizontal scrolling.



---

archive/issue_comments_178496.json:
```json
{
    "body": "Replying to [comment:33 vbraun]:\n> Jeroen, please read my edits on comment:16\nOK, I didn't understand your edit, I just removed the whole comment, which is actually more clear.",
    "created_at": "2013-04-03T14:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178496",
    "user": "@jdemeyer"
}
```

Replying to [comment:33 vbraun]:
> Jeroen, please read my edits on comment:16
OK, I didn't understand your edit, I just removed the whole comment, which is actually more clear.



---

archive/issue_comments_178497.json:
```json
{
    "body": "What's strange is that iPython runs \"import curses\" which fails (whether lincurses is preloaded or not) and so should behave correctly without curses installed.",
    "created_at": "2013-04-03T14:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178497",
    "user": "jpflori"
}
```

What's strange is that iPython runs "import curses" which fails (whether lincurses is preloaded or not) and so should behave correctly without curses installed.



---

archive/issue_comments_178498.json:
```json
{
    "body": "Replying to [comment:34 jpflori]:\n> If I run LD_PRELOAD=...libncurses.so.5 ./sage -ipython then long command lines are ok.\n> Notice that the same experiment with ./sage -gp still gives me horizontal scrolling.\n\nHmm, strange. Works for me: with LD_PRELOAD, `sage -gp` has multi-line readline. Without it, only single-line.",
    "created_at": "2013-04-03T14:38:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178498",
    "user": "@vbraun"
}
```

Replying to [comment:34 jpflori]:
> If I run LD_PRELOAD=...libncurses.so.5 ./sage -ipython then long command lines are ok.
> Notice that the same experiment with ./sage -gp still gives me horizontal scrolling.

Hmm, strange. Works for me: with LD_PRELOAD, `sage -gp` has multi-line readline. Without it, only single-line.



---

archive/issue_comments_178499.json:
```json
{
    "body": "libtinfo is actually part of ncurses (distributed inside the ncurses tarball)",
    "created_at": "2013-04-03T14:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178499",
    "user": "@vbraun"
}
```

libtinfo is actually part of ncurses (distributed inside the ncurses tarball)



---

archive/issue_comments_178500.json:
```json
{
    "body": "Replying to [comment:38 vbraun]:\n> libtinfo is actually part of ncurses (distributed inside the ncurses tarball)\nYup, and on Ubuntu, there is even no separate libtinfo.so file (except for the libncurses-dbg debug package).\nThe functions it should provided are actually provided by libncurses.so directly.",
    "created_at": "2013-04-03T14:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178500",
    "user": "jpflori"
}
```

Replying to [comment:38 vbraun]:
> libtinfo is actually part of ncurses (distributed inside the ncurses tarball)
Yup, and on Ubuntu, there is even no separate libtinfo.so file (except for the libncurses-dbg debug package).
The functions it should provided are actually provided by libncurses.so directly.



---

archive/issue_comments_178501.json:
```json
{
    "body": "Ubuntu 12.04 has /lib/i386-linux-gnu/libtinfo.so.5 and /lib/x86_64-linux-gnu/libtinfo.so.5.",
    "created_at": "2013-04-03T15:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178501",
    "user": "@vbraun"
}
```

Ubuntu 12.04 has /lib/i386-linux-gnu/libtinfo.so.5 and /lib/x86_64-linux-gnu/libtinfo.so.5.



---

archive/issue_comments_178502.json:
```json
{
    "body": "Oh yes it has...\nPlease disregard all my rambling then.",
    "created_at": "2013-04-03T15:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178502",
    "user": "jpflori"
}
```

Oh yes it has...
Please disregard all my rambling then.



---

archive/issue_comments_178503.json:
```json
{
    "body": "Replying to [comment:41 jpflori]:\n> Oh yes it has...\n\nOtherwise\n\n```\nINPUT(libncurses.so.5 -ltinfo)\n```\n\nwouldn't make sense... ;-)\n\n> Please disregard all my rambling then.",
    "created_at": "2013-04-03T15:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178503",
    "user": "@nexttime"
}
```

Replying to [comment:41 jpflori]:
> Oh yes it has...

Otherwise

```
INPUT(libncurses.so.5 -ltinfo)
```

wouldn't make sense... ;-)

> Please disregard all my rambling then.



---

archive/issue_comments_178504.json:
```json
{
    "body": "I made some experimental spkgs for \n\n* Ncurses: http://www.stp.dias.ie/~vbraun/Sage/spkg/ncurses-5.9.spkg\n* Readline (using curses instead of libtermcap): http://www.stp.dias.ie/~vbraun/Sage/spkg/readline-6.2.p4.spkg",
    "created_at": "2013-04-03T16:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178504",
    "user": "@vbraun"
}
```

I made some experimental spkgs for 

* Ncurses: http://www.stp.dias.ie/~vbraun/Sage/spkg/ncurses-5.9.spkg
* Readline (using curses instead of libtermcap): http://www.stp.dias.ie/~vbraun/Sage/spkg/readline-6.2.p4.spkg



---

archive/issue_comments_178505.json:
```json
{
    "body": "Attachment [trac_14405_replace_termcap_with_ncurses.patch](tarball://root/attachments/some-uuid/ticket14405/trac_14405_replace_termcap_with_ncurses.patch) by @vbraun created at 2013-04-04 18:11:23\n\nUpdated patch",
    "created_at": "2013-04-04T18:11:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178505",
    "user": "@vbraun"
}
```

Attachment [trac_14405_replace_termcap_with_ncurses.patch](tarball://root/attachments/some-uuid/ticket14405/trac_14405_replace_termcap_with_ncurses.patch) by @vbraun created at 2013-04-04 18:11:23

Updated patch



---

archive/issue_comments_178506.json:
```json
{
    "body": "for review only",
    "created_at": "2013-04-04T18:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178506",
    "user": "@vbraun"
}
```

for review only



---

archive/issue_comments_178507.json:
```json
{
    "body": "Attachment [readline-p3-to-p4.patch](tarball://root/attachments/some-uuid/ticket14405/readline-p3-to-p4.patch) by @vbraun created at 2013-04-04 18:17:04",
    "created_at": "2013-04-04T18:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178507",
    "user": "@vbraun"
}
```

Attachment [readline-p3-to-p4.patch](tarball://root/attachments/some-uuid/ticket14405/readline-p3-to-p4.patch) by @vbraun created at 2013-04-04 18:17:04



---

archive/issue_comments_178508.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-04-04T18:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178508",
    "user": "@vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_178509.json:
```json
{
    "body": "Just for completeness, I'd like to see if its possible to fix iPython so its not broken when using termcap only.\nI'll have some time tonight or tomorrow hopefully.",
    "created_at": "2013-04-05T09:38:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178509",
    "user": "jpflori"
}
```

Just for completeness, I'd like to see if its possible to fix iPython so its not broken when using termcap only.
I'll have some time tonight or tomorrow hopefully.



---

archive/issue_comments_178510.json:
```json
{
    "body": "Its really readline that breaks, as demonstrated by the fact that it falls back to single-line editing. Ihmo its pointless to improve support for the dead libtermcap, but then its your time ;-)",
    "created_at": "2013-04-05T10:05:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178510",
    "user": "@vbraun"
}
```

Its really readline that breaks, as demonstrated by the fact that it falls back to single-line editing. Ihmo its pointless to improve support for the dead libtermcap, but then its your time ;-)



---

archive/issue_comments_178511.json:
```json
{
    "body": "Replying to [comment:48 vbraun]:\n> Its really readline that breaks, as demonstrated by the fact that it falls back to single-line editing. Ihmo its pointless to improve support for the dead libtermcap, but then its your time ;-)\nCan we consider it is broken because it uses single-line editing mode?\nIsn't that to be expected with termcap?\n(I really have no clue...)\n\nNote that this single-line mode is ok in gp and python, it's only in ipython its broken, so there is a problem with ipython (and its been there since at least 0.10, we just encountered it recently in Sage because the way we use ipython must have changed).\n\nAnyway, I agree that multi-line editing looks nicer so just ignoring this ipython/readline/termcap problem and using ipython/readlines/ncurses is a sensible workaround/fix.",
    "created_at": "2013-04-05T11:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178511",
    "user": "jpflori"
}
```

Replying to [comment:48 vbraun]:
> Its really readline that breaks, as demonstrated by the fact that it falls back to single-line editing. Ihmo its pointless to improve support for the dead libtermcap, but then its your time ;-)
Can we consider it is broken because it uses single-line editing mode?
Isn't that to be expected with termcap?
(I really have no clue...)

Note that this single-line mode is ok in gp and python, it's only in ipython its broken, so there is a problem with ipython (and its been there since at least 0.10, we just encountered it recently in Sage because the way we use ipython must have changed).

Anyway, I agree that multi-line editing looks nicer so just ignoring this ipython/readline/termcap problem and using ipython/readlines/ncurses is a sensible workaround/fix.



---

archive/issue_comments_178512.json:
```json
{
    "body": "I see you disabled static libs, any reason for that except for the fact \"shared libraries are better\" (or \"static ones sucks\" :)).",
    "created_at": "2013-04-05T11:44:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178512",
    "user": "jpflori"
}
```

I see you disabled static libs, any reason for that except for the fact "shared libraries are better" (or "static ones sucks" :)).



---

archive/issue_comments_178513.json:
```json
{
    "body": "Only because static libraries suck.",
    "created_at": "2013-04-05T13:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178513",
    "user": "@vbraun"
}
```

Only because static libraries suck.



---

archive/issue_comments_178514.json:
```json
{
    "body": "About the horizontal-scroll-mode, that just shows that readline couldn't figure out the UP capability. Its pretty clear that this is because we only installed libtermcap, but not an actual termcap data file. So libtermcap used to fall back to `/etc/termcap`, but newer Linux distributions don't include that any more since libtermcap is being phased out in favor of ncurses.",
    "created_at": "2013-04-05T13:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178514",
    "user": "@vbraun"
}
```

About the horizontal-scroll-mode, that just shows that readline couldn't figure out the UP capability. Its pretty clear that this is because we only installed libtermcap, but not an actual termcap data file. So libtermcap used to fall back to `/etc/termcap`, but newer Linux distributions don't include that any more since libtermcap is being phased out in favor of ncurses.



---

archive/issue_comments_178515.json:
```json
{
    "body": "Good point.\nUbuntu 12.04 does not ship /etc/termcap indeed.\nAlthough that does not clearly explain the discrepancy between the behavior of ipython vs. python and gp.",
    "created_at": "2013-04-05T13:39:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178515",
    "user": "jpflori"
}
```

Good point.
Ubuntu 12.04 does not ship /etc/termcap indeed.
Although that does not clearly explain the discrepancy between the behavior of ipython vs. python and gp.



---

archive/issue_comments_178516.json:
```json
{
    "body": "The ncurses spkg fails to build on OS X 10.8.3. [log file here](http://sage.math.washington.edu/home/palmieri/misc/ncurses-5.9.log).",
    "created_at": "2013-04-05T18:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178516",
    "user": "@jhpalmieri"
}
```

The ncurses spkg fails to build on OS X 10.8.3. [log file here](http://sage.math.washington.edu/home/palmieri/misc/ncurses-5.9.log).



---

archive/issue_comments_178517.json:
```json
{
    "body": "Fixed, new spkg at same place. I checked that it compiles on bsd.math.",
    "created_at": "2013-04-05T20:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178517",
    "user": "@vbraun"
}
```

Fixed, new spkg at same place. I checked that it compiles on bsd.math.



---

archive/issue_comments_178518.json:
```json
{
    "body": "Just a reminder for myself: HAVE TO FIX THIS.\nEither find out how ipython breaks with termcap only or be lazy and use Volker spkgs.\n\nThe broken command line edit is just driving me crazy, I cannot understand why the google groups are not flooded by rants about that.\nDoes every one use the notebook?",
    "created_at": "2013-07-04T15:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178518",
    "user": "jpflori"
}
```

Just a reminder for myself: HAVE TO FIX THIS.
Either find out how ipython breaks with termcap only or be lazy and use Volker spkgs.

The broken command line edit is just driving me crazy, I cannot understand why the google groups are not flooded by rants about that.
Does every one use the notebook?



---

archive/issue_comments_178519.json:
```json
{
    "body": "We should switch to ncurses anyways, I don't see a point in adding workarounds for termcap.\n\nI guess most users already have ncurses headers in their OS install, if you install any development packages then its very likely to be pulled in.",
    "created_at": "2013-07-04T15:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178519",
    "user": "@vbraun"
}
```

We should switch to ncurses anyways, I don't see a point in adding workarounds for termcap.

I guess most users already have ncurses headers in their OS install, if you install any development packages then its very likely to be pulled in.



---

archive/issue_comments_178520.json:
```json
{
    "body": "Agreed, I'll try to review it tonight.\n\nIf by any chance there have been upgrades to curses and readline, could you upload new spkgs?",
    "created_at": "2013-07-04T16:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178520",
    "user": "jpflori"
}
```

Agreed, I'll try to review it tonight.

If by any chance there have been upgrades to curses and readline, could you upload new spkgs?



---

archive/issue_comments_178521.json:
```json
{
    "body": "Neither readline nor ncurses has been updated in the last 3 months... neither of them is exactly a moving target ;-)",
    "created_at": "2013-07-04T21:02:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178521",
    "user": "@vbraun"
}
```

Neither readline nor ncurses has been updated in the last 3 months... neither of them is exactly a moving target ;-)



---

archive/issue_comments_178522.json:
```json
{
    "body": "Yup I saw that.\n\nCleaned up spkg are up.\n\nI'm testing them right now.",
    "created_at": "2013-07-04T21:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178522",
    "user": "jpflori"
}
```

Yup I saw that.

Cleaned up spkg are up.

I'm testing them right now.



---

archive/issue_comments_178523.json:
```json
{
    "body": "I've removed obsolete comments, homogenized spkg scripts and so on.\nThe only thing Im not sure about is the LIB_TERMCAP patch which was added in #11970 is needed anymore.\n\nThe only thing you did I changed is to not disable static libs :)\nPlease let keep that change for later and for a more general clean up of spkgs regarding static libs.",
    "created_at": "2013-07-04T21:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178523",
    "user": "jpflori"
}
```

I've removed obsolete comments, homogenized spkg scripts and so on.
The only thing Im not sure about is the LIB_TERMCAP patch which was added in #11970 is needed anymore.

The only thing you did I changed is to not disable static libs :)
Please let keep that change for later and for a more general clean up of spkgs regarding static libs.



---

archive/issue_comments_178524.json:
```json
{
    "body": "Spkgs at:\n* http://boxen.math.washington.edu/home/jpflori/ncurses-5.9.p0.spkg\n* http://boxen.math.washington.edu/home/jpflori/readline-6.4.p5.spkg\ntermcap patch was needed to finish building Sage.\nLooks to be working.\nldd'ing $SAGE_LOCAL/lib shows only ncurses in the same dir.",
    "created_at": "2013-07-04T22:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178524",
    "user": "jpflori"
}
```

Spkgs at:
* http://boxen.math.washington.edu/home/jpflori/ncurses-5.9.p0.spkg
* http://boxen.math.washington.edu/home/jpflori/readline-6.4.p5.spkg
termcap patch was needed to finish building Sage.
Looks to be working.
ldd'ing $SAGE_LOCAL/lib shows only ncurses in the same dir.



---

archive/issue_comments_178525.json:
```json
{
    "body": "spkg urls don't work",
    "created_at": "2013-07-04T23:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178525",
    "user": "@vbraun"
}
```

spkg urls don't work



---

archive/issue_comments_178526.json:
```json
{
    "body": "Fixed:\n* http://boxen.math.washington.edu/home/jpflori/spkg/ncurses-5.9.p0.spkg\n* http://boxen.math.washington.edu/home/jpflori/spkg/readline-6.2.p5.spkg",
    "created_at": "2013-07-05T07:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178526",
    "user": "jpflori"
}
```

Fixed:
* http://boxen.math.washington.edu/home/jpflori/spkg/ncurses-5.9.p0.spkg
* http://boxen.math.washington.edu/home/jpflori/spkg/readline-6.2.p5.spkg



---

archive/issue_comments_178527.json:
```json
{
    "body": "Strange, yesterday the doc failed to build because of not finding some UP stuff in readline, and I thought it was solved by readding the termcap patch.\nBut now on another machine it fails though I used the patch.",
    "created_at": "2013-07-05T14:05:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178527",
    "user": "jpflori"
}
```

Strange, yesterday the doc failed to build because of not finding some UP stuff in readline, and I thought it was solved by readding the termcap patch.
But now on another machine it fails though I used the patch.



---

archive/issue_comments_178528.json:
```json
{
    "body": "Maybe that was because of old termcap libs being around on this setup were I.\nRemoving them and rebuilding everything was fine...",
    "created_at": "2013-07-05T14:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178528",
    "user": "jpflori"
}
```

Maybe that was because of old termcap libs being around on this setup were I.
Removing them and rebuilding everything was fine...



---

archive/issue_comments_178529.json:
```json
{
    "body": "And this is why we shouldn't have static libraries (sorry couldn't resist ;-)",
    "created_at": "2013-07-05T15:28:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178529",
    "user": "@vbraun"
}
```

And this is why we shouldn't have static libraries (sorry couldn't resist ;-)



---

archive/issue_comments_178530.json:
```json
{
    "body": "Whats the point of \n\n```\n    [ -r \"$patch\" ] || continue  # Skip non-existing or non-readable patches\n```\n \nIMHO we should error out if the spkg permissions are not set correctly instead of silently not applying the patch.",
    "created_at": "2013-07-05T17:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178530",
    "user": "@vbraun"
}
```

Whats the point of 

```
    [ -r "$patch" ] || continue  # Skip non-existing or non-readable patches
```
 
IMHO we should error out if the spkg permissions are not set correctly instead of silently not applying the patch.



---

archive/issue_comments_178531.json:
```json
{
    "body": "The rest looks good to me (modulo building static libraries, though I don't mind disabling them globally after we switch to git and the new repo layout)",
    "created_at": "2013-07-05T18:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178531",
    "user": "@vbraun"
}
```

The rest looks good to me (modulo building static libraries, though I don't mind disabling them globally after we switch to git and the new repo layout)



---

archive/issue_comments_178532.json:
```json
{
    "body": "Replying to [comment:69 vbraun]:\n> Whats the point of \n> {{{\n>     [ -r \"$patch\" ] || continue  # Skip non-existing or non-readable patches\n> }}} \n> IMHO we should error out if the spkg permissions are not set correctly instead of silently not applying the patch.\n\nThat's Jeroen's invention, the idea being to be able to (temporarily) \"disable\" a patch by `chmod -r ...` without having to change `spkg-install` (which usually unconditionally applies all [readable] patches in a loop).\n\nAnd if there are no patches at all, `patch` doesn't bail out because the shell doesn't expand `.../*.patch` (where `[ -f ... ]` would be sufficient).",
    "created_at": "2013-07-05T20:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178532",
    "user": "@nexttime"
}
```

Replying to [comment:69 vbraun]:
> Whats the point of 
> {{{
>     [ -r "$patch" ] || continue  # Skip non-existing or non-readable patches
> }}} 
> IMHO we should error out if the spkg permissions are not set correctly instead of silently not applying the patch.

That's Jeroen's invention, the idea being to be able to (temporarily) "disable" a patch by `chmod -r ...` without having to change `spkg-install` (which usually unconditionally applies all [readable] patches in a loop).

And if there are no patches at all, `patch` doesn't bail out because the shell doesn't expand `.../*.patch` (where `[ -f ... ]` would be sufficient).



---

archive/issue_comments_178533.json:
```json
{
    "body": "Replying to [comment:62 jpflori]:\n> The only thing Im not sure about is the LIB_TERMCAP patch which was added in #11970 is needed anymore.\n\nDid you finally remove it?  (Too lazy to look at the spkg now.)\n\nIf so, please make sure R still builds on `$DISTRO`...",
    "created_at": "2013-07-05T20:17:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178533",
    "user": "@nexttime"
}
```

Replying to [comment:62 jpflori]:
> The only thing Im not sure about is the LIB_TERMCAP patch which was added in #11970 is needed anymore.

Did you finally remove it?  (Too lazy to look at the spkg now.)

If so, please make sure R still builds on `$DISTRO`...



---

archive/issue_comments_178534.json:
```json
{
    "body": "I did at first, but in a build from scratch the doc failed to build complaining about UP missing and after rebuilding readline with it, it was ok so I've left it in.\n\nAnother installation of just the two spkg after that on a system where Sage was already installed, with the patch in, also failed with the same error.\nBut it seems it was because a previous libtermcap.a was already in $SAGE_LOCAL/lib when the spkgs were built.\nAt least removing libtermcap.a and rebuilding once more let the doc build.\nNote I've not looked deeply into this and this is mostly experimental.\nBut I seem to remember that in this latter case, the first libreadline.so produced was not linked with libtinfo (that ncurses should now provide, but I did not look to see if it was there during that try) and that the second one was.\nNot completely sure about that though.",
    "created_at": "2013-07-05T20:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178534",
    "user": "jpflori"
}
```

I did at first, but in a build from scratch the doc failed to build complaining about UP missing and after rebuilding readline with it, it was ok so I've left it in.

Another installation of just the two spkg after that on a system where Sage was already installed, with the patch in, also failed with the same error.
But it seems it was because a previous libtermcap.a was already in $SAGE_LOCAL/lib when the spkgs were built.
At least removing libtermcap.a and rebuilding once more let the doc build.
Note I've not looked deeply into this and this is mostly experimental.
But I seem to remember that in this latter case, the first libreadline.so produced was not linked with libtinfo (that ncurses should now provide, but I did not look to see if it was there during that try) and that the second one was.
Not completely sure about that though.



---

archive/issue_comments_178535.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-07-06T14:29:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178535",
    "user": "@vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_178536.json:
```json
{
    "body": "R builds for me, even has working readline in the standalone R binary.",
    "created_at": "2013-07-06T14:29:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178536",
    "user": "@vbraun"
}
```

R builds for me, even has working readline in the standalone R binary.



---

archive/issue_comments_178537.json:
```json
{
    "body": "The spkg needs some trivial work:\n\nIn `SPKG.txt`, the license should be GPL v3+ and the following paragraph needs to be updated:\n\n```\n## Dependencies\n\n * GNU patch\n\n * libtermcap (or libncurses or libtinfo), but not Sage's one,\n   since we only build a static version. I.e., the system has\n   to provide one of these.\n```\n\n\nAlso, the file `src/support/mkinstalldirs` is not user-writable, which is strange.",
    "created_at": "2013-08-02T15:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178537",
    "user": "@jdemeyer"
}
```

The spkg needs some trivial work:

In `SPKG.txt`, the license should be GPL v3+ and the following paragraph needs to be updated:

```
## Dependencies

 * GNU patch

 * libtermcap (or libncurses or libtinfo), but not Sage's one,
   since we only build a static version. I.e., the system has
   to provide one of these.
```


Also, the file `src/support/mkinstalldirs` is not user-writable, which is strange.



---

archive/issue_comments_178538.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-08-02T15:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178538",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_178539.json:
```json
{
    "body": "I've updated the readline spkg documentation.\n\nThe permissions of `mkinstalldirs` are what upstream uses; since its not copied anywhere it doesn't really matter if it is user-writeable or not.",
    "created_at": "2013-08-02T16:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178539",
    "user": "@vbraun"
}
```

I've updated the readline spkg documentation.

The permissions of `mkinstalldirs` are what upstream uses; since its not copied anywhere it doesn't really matter if it is user-writeable or not.



---

archive/issue_comments_178540.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-08-02T16:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178540",
    "user": "@vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_178541.json:
```json
{
    "body": "Some files in `$SAGE_LOCAL/bin` need to be added to `.hgignore`:\n\n```\n? captoinfo\n? clear\n? infocmp\n? infotocap\n? ncurses5-config\n? reset\n? tabs\n? tic\n? toe\n? tput\n? tset\n```\n",
    "created_at": "2013-08-04T16:24:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178541",
    "user": "@jdemeyer"
}
```

Some files in `$SAGE_LOCAL/bin` need to be added to `.hgignore`:

```
? captoinfo
? clear
? infocmp
? infotocap
? ncurses5-config
? reset
? tabs
? tic
? toe
? tput
? tset
```




---

archive/issue_comments_178542.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-08-04T16:24:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178542",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_178543.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-08-05T10:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178543",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_178544.json:
```json
{
    "body": "Attachment [14405_hgignore.patch](tarball://root/attachments/some-uuid/ticket14405/14405_hgignore.patch) by @jdemeyer created at 2013-08-05 10:04:44",
    "created_at": "2013-08-05T10:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178544",
    "user": "@jdemeyer"
}
```

Attachment [14405_hgignore.patch](tarball://root/attachments/some-uuid/ticket14405/14405_hgignore.patch) by @jdemeyer created at 2013-08-05 10:04:44



---

archive/issue_comments_178545.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-08-05T10:11:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178545",
    "user": "@vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_178546.json:
```json
{
    "body": "Thanks!",
    "created_at": "2013-08-05T10:11:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178546",
    "user": "@vbraun"
}
```

Thanks!



---

archive/issue_comments_178547.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-08-14T09:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178547",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_178548.json:
```json
{
    "body": "Buildbot failure on snapperkob (Ubuntu 12.04 x86_64) while building Python:\n\n```\nbuilding 'readline' extension\ngcc -pthread -fPIC -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -I/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/local/include -I. -IInclude -I./Include -I/usr/include/x86_64-linux-gnu -I/usr/local/include -I/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/spkg/build/python-2.7.5.p1/src/Include -I/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/spkg/build/python-2.7.5.p1/src -c /home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/spkg/build/python-2.7.5.p1/src/Modules/readline.c -o build/temp.linux-x86_64-2.7/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/spkg/build/python-2.7.5.p1/src/Modules/readline.o\ngcc -pthread -shared -L/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/local/lib -L/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/local/lib build/temp.linux-x86_64-2.7/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/spkg/build/python-2.7.5.p1/src/Modules/readline.o -L/usr/lib/termcap -L/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/local/lib -L/usr/lib/x86_64-linux-gnu -L/usr/local/lib -L. -lreadline -lncurses -lpython2.7 -o build/lib.linux-x86_64-2.7/readline.so\n*** WARNING: renaming \"readline\" since importing it failed: /home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/local/lib/libreadline.so.6: undefined symbol: UP\n```\n\n\nThis causes in the end\n\n```\nTesting importing of various modules...\nctypes module imported OK\nmath module imported OK\nhashlib module imported OK\ncrypt module imported OK\nTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\nImportError: No module named readline\nreadline module failed to import\nsocket module imported OK\nError: One or more modules failed to import.\n```\n\n* [Python build log](http://build.sagemath.org/sage/builders/AIMS%20snapperkob%20%28Ubuntu%2012.04%20x86_64%29/builds/402/steps/shell_6/logs/python)\n* [readline build log](http://build.sagemath.org/sage/builders/AIMS%20snapperkob%20%28Ubuntu%2012.04%20x86_64%29/builds/402/steps/shell_6/logs/python)\n* [Other logs of that build](http://build.sagemath.org/sage/builders/AIMS%20snapperkob%20%28Ubuntu%2012.04%20x86_64%29/builds/402)",
    "created_at": "2013-08-14T09:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178548",
    "user": "@jdemeyer"
}
```

Buildbot failure on snapperkob (Ubuntu 12.04 x86_64) while building Python:

```
building 'readline' extension
gcc -pthread -fPIC -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -I/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/local/include -I. -IInclude -I./Include -I/usr/include/x86_64-linux-gnu -I/usr/local/include -I/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/spkg/build/python-2.7.5.p1/src/Include -I/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/spkg/build/python-2.7.5.p1/src -c /home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/spkg/build/python-2.7.5.p1/src/Modules/readline.c -o build/temp.linux-x86_64-2.7/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/spkg/build/python-2.7.5.p1/src/Modules/readline.o
gcc -pthread -shared -L/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/local/lib -L/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/local/lib build/temp.linux-x86_64-2.7/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/spkg/build/python-2.7.5.p1/src/Modules/readline.o -L/usr/lib/termcap -L/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/local/lib -L/usr/lib/x86_64-linux-gnu -L/usr/local/lib -L. -lreadline -lncurses -lpython2.7 -o build/lib.linux-x86_64-2.7/readline.so
*** WARNING: renaming "readline" since importing it failed: /home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.12.beta1/local/lib/libreadline.so.6: undefined symbol: UP
```


This causes in the end

```
Testing importing of various modules...
ctypes module imported OK
math module imported OK
hashlib module imported OK
crypt module imported OK
Traceback (most recent call last):
  File "<string>", line 1, in <module>
ImportError: No module named readline
readline module failed to import
socket module imported OK
Error: One or more modules failed to import.
```

* [Python build log](http://build.sagemath.org/sage/builders/AIMS%20snapperkob%20%28Ubuntu%2012.04%20x86_64%29/builds/402/steps/shell_6/logs/python)
* [readline build log](http://build.sagemath.org/sage/builders/AIMS%20snapperkob%20%28Ubuntu%2012.04%20x86_64%29/builds/402/steps/shell_6/logs/python)
* [Other logs of that build](http://build.sagemath.org/sage/builders/AIMS%20snapperkob%20%28Ubuntu%2012.04%20x86_64%29/builds/402)



---

archive/issue_comments_178549.json:
```json
{
    "body": "Exact same failure on `arando` (Ubuntu 13.04 32-bit).",
    "created_at": "2013-08-14T10:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178549",
    "user": "@jdemeyer"
}
```

Exact same failure on `arando` (Ubuntu 13.04 32-bit).



---

archive/issue_comments_178550.json:
```json
{
    "body": "No, the issue that, despite the `-lncurses` in the gcc invocation, Python's `readline.so` does not actually link against `libncurses.so:\n\n```\n(sage-sh) buildbot@arando:src$ ldd build/lib.linux-i686-2.7/readline.so\n        linux-gate.so.1 =>  (0xb778b000)\n        libreadline.so.6 => /var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.12.beta1/local/lib/libreadline.so.6 (0xb7746000)\n        libpython2.7.so.1.0 => /var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.12.beta1/local/lib/libpython2.7.so.1.0 (0xb758e000)\n        libpthread.so.0 => /lib/i386-linux-gnu/libpthread.so.0 (0xb7564000)\n        libc.so.6 => /lib/i386-linux-gnu/libc.so.6 (0xb73b1000)\n        libdl.so.2 => /lib/i386-linux-gnu/libdl.so.2 (0xb73ac000)\n        libutil.so.1 => /lib/i386-linux-gnu/libutil.so.1 (0xb73a8000)\n        libm.so.6 => /lib/i386-linux-gnu/libm.so.6 (0xb7365000)\n        /lib/ld-linux.so.2 (0xb778c000)\n```\n\nSome dynamic linking expert is needed here.\n\nRunning Python with `LD_PRELOAD=\"$SAGE_LOCAL/lib/libncurses.so\"` solves the problem.",
    "created_at": "2013-08-14T10:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178550",
    "user": "@jdemeyer"
}
```

No, the issue that, despite the `-lncurses` in the gcc invocation, Python's `readline.so` does not actually link against `libncurses.so:

```
(sage-sh) buildbot@arando:src$ ldd build/lib.linux-i686-2.7/readline.so
        linux-gate.so.1 =>  (0xb778b000)
        libreadline.so.6 => /var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.12.beta1/local/lib/libreadline.so.6 (0xb7746000)
        libpython2.7.so.1.0 => /var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.12.beta1/local/lib/libpython2.7.so.1.0 (0xb758e000)
        libpthread.so.0 => /lib/i386-linux-gnu/libpthread.so.0 (0xb7564000)
        libc.so.6 => /lib/i386-linux-gnu/libc.so.6 (0xb73b1000)
        libdl.so.2 => /lib/i386-linux-gnu/libdl.so.2 (0xb73ac000)
        libutil.so.1 => /lib/i386-linux-gnu/libutil.so.1 (0xb73a8000)
        libm.so.6 => /lib/i386-linux-gnu/libm.so.6 (0xb7365000)
        /lib/ld-linux.so.2 (0xb778c000)
```

Some dynamic linking expert is needed here.

Running Python with `LD_PRELOAD="$SAGE_LOCAL/lib/libncurses.so"` solves the problem.



---

archive/issue_comments_178551.json:
```json
{
    "body": "The issue is [https://lists.ubuntu.com/archives/ubuntu-devel/2010-November/031991.html](https://lists.ubuntu.com/archives/ubuntu-devel/2010-November/031991.html)\n\nAdding `-Wl,--no-as-needed` to the linker invocation solves the problem.\n\n```\ngcc -pthread -shared -L/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.12.beta1/local/lib -L/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.12.beta1/local/lib build/temp.linux-i686-2.7/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.12.beta1/spkg/build/python-2.7.5.p1/src/Modules/readline.o -L/usr/lib/termcap -L/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.12.beta1/local/lib -L/usr/lib/i386-linux-gnu -L/usr/local/lib -L. -lreadline -Wl,--no-as-needed -lncurses -lpython2.7 -o build/lib.linux-i686-2.7/readline.so\n```\n",
    "created_at": "2013-08-14T10:34:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178551",
    "user": "@jdemeyer"
}
```

The issue is [https://lists.ubuntu.com/archives/ubuntu-devel/2010-November/031991.html](https://lists.ubuntu.com/archives/ubuntu-devel/2010-November/031991.html)

Adding `-Wl,--no-as-needed` to the linker invocation solves the problem.

```
gcc -pthread -shared -L/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.12.beta1/local/lib -L/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.12.beta1/local/lib build/temp.linux-i686-2.7/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.12.beta1/spkg/build/python-2.7.5.p1/src/Modules/readline.o -L/usr/lib/termcap -L/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.12.beta1/local/lib -L/usr/lib/i386-linux-gnu -L/usr/local/lib -L. -lreadline -Wl,--no-as-needed -lncurses -lpython2.7 -o build/lib.linux-i686-2.7/readline.so
```




---

archive/issue_comments_178552.json:
```json
{
    "body": "libcurses is just a symlink to libncurses. I don't have an account on any of those machines. Can you post the ldd output for libncurses.so and libreadline.so? I would guess that the latter is underlinked, and since python readline.so doesn't use UP directly we end up not pulling in ncurses.",
    "created_at": "2013-08-14T11:20:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178552",
    "user": "@vbraun"
}
```

libcurses is just a symlink to libncurses. I don't have an account on any of those machines. Can you post the ldd output for libncurses.so and libreadline.so? I would guess that the latter is underlinked, and since python readline.so doesn't use UP directly we end up not pulling in ncurses.



---

archive/issue_comments_178553.json:
```json
{
    "body": "\n```\n(sage-sh) buildbot@arando:sage$ ldd $SAGE_LOCAL/lib/libncurses.so\n        linux-gate.so.1 =>  (0xb7759000)\n        libc.so.6 => /lib/i386-linux-gnu/libc.so.6 (0xb7573000)\n        libtinfo.so.5 => /var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.12.beta1/local/lib/libtinfo.so.5 (0xb7549000)\n        /lib/ld-linux.so.2 (0xb775a000)\n(sage-sh) buildbot@arando:sage$ ldd $SAGE_LOCAL/lib/libreadline.so\n        linux-gate.so.1 =>  (0xb773a000)\n        libc.so.6 => /lib/i386-linux-gnu/libc.so.6 (0xb753a000)\n        /lib/ld-linux.so.2 (0xb773b000)\n```\n",
    "created_at": "2013-08-14T11:23:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178553",
    "user": "@jdemeyer"
}
```


```
(sage-sh) buildbot@arando:sage$ ldd $SAGE_LOCAL/lib/libncurses.so
        linux-gate.so.1 =>  (0xb7759000)
        libc.so.6 => /lib/i386-linux-gnu/libc.so.6 (0xb7573000)
        libtinfo.so.5 => /var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.12.beta1/local/lib/libtinfo.so.5 (0xb7549000)
        /lib/ld-linux.so.2 (0xb775a000)
(sage-sh) buildbot@arando:sage$ ldd $SAGE_LOCAL/lib/libreadline.so
        linux-gate.so.1 =>  (0xb773a000)
        libc.so.6 => /lib/i386-linux-gnu/libc.so.6 (0xb753a000)
        /lib/ld-linux.so.2 (0xb773b000)
```




---

archive/issue_comments_178554.json:
```json
{
    "body": "Contrast with `boxen.math` (Ubuntu 8.04):\n\n```\n(sage-sh) jdemeyer@boxen:sage-5.12.beta1$ ldd $SAGE_LOCAL/lib/libncurses.so\n        linux-vdso.so.1 =>  (0x00007fff2fffe000)\n        libc.so.6 => /lib/libc.so.6 (0x00007ffc27946000)\n        libtinfo.so.5 => /mazur/release/merger/sage-5.12.beta1/local/lib/libtinfo.so.5 (0x00007ffc27712000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007ffc27ee2000)\n(sage-sh) jdemeyer@boxen:sage-5.12.beta1$ ldd $SAGE_LOCAL/lib/libreadline.so\n        linux-vdso.so.1 =>  (0x00007fff099fe000)\n        libncurses.so.5 => /mazur/release/merger/sage-5.12.beta1/local/lib/libncurses.so.5 (0x00007f8b01386000)\n        libc.so.6 => /lib/libc.so.6 (0x00007f8b0100f000)\n        libtinfo.so.5 => /mazur/release/merger/sage-5.12.beta1/local/lib/libtinfo.so.5 (0x00007f8b00ddc000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007f8b017f0000)\n```\n",
    "created_at": "2013-08-14T11:26:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178554",
    "user": "@jdemeyer"
}
```

Contrast with `boxen.math` (Ubuntu 8.04):

```
(sage-sh) jdemeyer@boxen:sage-5.12.beta1$ ldd $SAGE_LOCAL/lib/libncurses.so
        linux-vdso.so.1 =>  (0x00007fff2fffe000)
        libc.so.6 => /lib/libc.so.6 (0x00007ffc27946000)
        libtinfo.so.5 => /mazur/release/merger/sage-5.12.beta1/local/lib/libtinfo.so.5 (0x00007ffc27712000)
        /lib64/ld-linux-x86-64.so.2 (0x00007ffc27ee2000)
(sage-sh) jdemeyer@boxen:sage-5.12.beta1$ ldd $SAGE_LOCAL/lib/libreadline.so
        linux-vdso.so.1 =>  (0x00007fff099fe000)
        libncurses.so.5 => /mazur/release/merger/sage-5.12.beta1/local/lib/libncurses.so.5 (0x00007f8b01386000)
        libc.so.6 => /lib/libc.so.6 (0x00007f8b0100f000)
        libtinfo.so.5 => /mazur/release/merger/sage-5.12.beta1/local/lib/libtinfo.so.5 (0x00007f8b00ddc000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f8b017f0000)
```




---

archive/issue_comments_178555.json:
```json
{
    "body": "Yes, it is exactly as I suspected: libreadline does not link against libncurses. In fact, the terminal handling stuff is in libtinfo (part of ncurses), this is why the `-lcurses` is a no-op when linking libreadline.\n\nI've updated the readline spkg to link with `-ltinfo`, this is the proper thing to do. While I was at it I removed various old cruft.",
    "created_at": "2013-08-14T12:49:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178555",
    "user": "@vbraun"
}
```

Yes, it is exactly as I suspected: libreadline does not link against libncurses. In fact, the terminal handling stuff is in libtinfo (part of ncurses), this is why the `-lcurses` is a no-op when linking libreadline.

I've updated the readline spkg to link with `-ltinfo`, this is the proper thing to do. While I was at it I removed various old cruft.



---

archive/issue_comments_178556.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-08-14T12:49:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178556",
    "user": "@vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_178557.json:
```json
{
    "body": "for review only",
    "created_at": "2013-08-14T12:56:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178557",
    "user": "@vbraun"
}
```

for review only



---

archive/issue_comments_178558.json:
```json
{
    "body": "Attachment [readline-tinfo.diff](tarball://root/attachments/some-uuid/ticket14405/readline-tinfo.diff) by @jdemeyer created at 2013-08-14 15:43:38\n\nLooks good on first sight, still have to test it though...",
    "created_at": "2013-08-14T15:43:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178558",
    "user": "@jdemeyer"
}
```

Attachment [readline-tinfo.diff](tarball://root/attachments/some-uuid/ticket14405/readline-tinfo.diff) by @jdemeyer created at 2013-08-14 15:43:38

Looks good on first sight, still have to test it though...



---

archive/issue_comments_178559.json:
```json
{
    "body": "`ncurses` always fails its testsuite (`spkg-check`) because of\n\n```\nRunning the test suite for ncurses-5.9...\nmake[3]: *** No rule to make target `check'.\n```\n",
    "created_at": "2013-08-14T16:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178559",
    "user": "@jdemeyer"
}
```

`ncurses` always fails its testsuite (`spkg-check`) because of

```
Running the test suite for ncurses-5.9...
make[3]: *** No rule to make target `check'.
```




---

archive/issue_comments_178560.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-08-14T16:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178560",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_178561.json:
```json
{
    "body": "`ncurses` fails to build on `mark` (Solaris SPARC) because of\n\n```\n/home/buildbot/build/sage/mark-1/mark_full/build/sage-5.12.beta1/local/bin/g++ -I../c++ -I../include -I. -DHAVE_CONFIG_H   -D__EXTENSIONS__ -D_XOPEN_SOURCE=500 -D_FILE_OFFSET_BITS=64  -DNDEBUG -I. -I../include -I/home/buildbot/build/sage/mark-1/mark_full/build/sage-5.12.beta1/local/include  -fPIC -c ../c++/cursesm.cc -o ../obj_s/cursesm.o\n<command-line>:0:0: warning: \"_XOPEN_SOURCE\" redefined [enabled by default]\n../c++/cursesm.cc:1:0: note: this is the location of the previous definition\n<command-line>:0:0: warning: \"_XOPEN_SOURCE\" redefined [enabled by default]\n../c++/cursesf.cc:1:0: note: this is the location of the previous definition\nIn file included from /home/buildbot/build/sage/mark-1/mark_full/build/sage-5.12.beta1/local/lib/gcc/sparc-sun-solaris2.10/4.7.3/include-fixed/iso/stdlib_iso.h:39:0,\n                 from /usr/include/stdlib.h:18,\n                 from ../c++/internal.h:53,\n                 from ../c++/cursesm.cc:34:\n/home/buildbot/build/sage/mark-1/mark_full/build/sage-5.12.beta1/local/lib/gcc/sparc-sun-solaris2.10/4.7.3/include-fixed/sys/feature_tests.h:341:2: error: #error \"Compiler or options invalid for pre-UNIX 03 X/Open applications \tand pre-2001 POSIX applications\"\n```\n",
    "created_at": "2013-08-14T16:08:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178561",
    "user": "@jdemeyer"
}
```

`ncurses` fails to build on `mark` (Solaris SPARC) because of

```
/home/buildbot/build/sage/mark-1/mark_full/build/sage-5.12.beta1/local/bin/g++ -I../c++ -I../include -I. -DHAVE_CONFIG_H   -D__EXTENSIONS__ -D_XOPEN_SOURCE=500 -D_FILE_OFFSET_BITS=64  -DNDEBUG -I. -I../include -I/home/buildbot/build/sage/mark-1/mark_full/build/sage-5.12.beta1/local/include  -fPIC -c ../c++/cursesm.cc -o ../obj_s/cursesm.o
<command-line>:0:0: warning: "_XOPEN_SOURCE" redefined [enabled by default]
../c++/cursesm.cc:1:0: note: this is the location of the previous definition
<command-line>:0:0: warning: "_XOPEN_SOURCE" redefined [enabled by default]
../c++/cursesf.cc:1:0: note: this is the location of the previous definition
In file included from /home/buildbot/build/sage/mark-1/mark_full/build/sage-5.12.beta1/local/lib/gcc/sparc-sun-solaris2.10/4.7.3/include-fixed/iso/stdlib_iso.h:39:0,
                 from /usr/include/stdlib.h:18,
                 from ../c++/internal.h:53,
                 from ../c++/cursesm.cc:34:
/home/buildbot/build/sage/mark-1/mark_full/build/sage-5.12.beta1/local/lib/gcc/sparc-sun-solaris2.10/4.7.3/include-fixed/sys/feature_tests.h:341:2: error: #error "Compiler or options invalid for pre-UNIX 03 X/Open applications 	and pre-2001 POSIX applications"
```




---

archive/issue_comments_178562.json:
```json
{
    "body": "I've deleted spkg-check and added the patch from http://stackoverflow.com/questions/6774738/compiling-ncurses-on-solaris-compiler-or-options-invalid-for-pre-unix-03-x-op\n\nUpdated ncurses spkg at the same place.",
    "created_at": "2013-08-14T17:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178562",
    "user": "@vbraun"
}
```

I've deleted spkg-check and added the patch from http://stackoverflow.com/questions/6774738/compiling-ncurses-on-solaris-compiler-or-options-invalid-for-pre-unix-03-x-op

Updated ncurses spkg at the same place.



---

archive/issue_comments_178563.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-08-14T17:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178563",
    "user": "@vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_178564.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-08-15T08:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178564",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_178565.json:
```json
{
    "body": "Haven't tested all systems yet, but looks good so far.",
    "created_at": "2013-08-15T08:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178565",
    "user": "@jdemeyer"
}
```

Haven't tested all systems yet, but looks good so far.



---

archive/issue_comments_178566.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-08-20T08:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178566",
    "user": "@jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_178567.json:
```json
{
    "body": "Just a random rant on this closed ticket: not building the readline static library makes python fails to build on Cygwin.\nOk this is without doubt because of python build system as it does not manage to find the specially named shared libraries on cygwin (note that when shared and static are installed, gcc will be smart enough to pick the shared one first, so this really is a python issue which fails to detect the shared one...).",
    "created_at": "2013-10-22T17:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178567",
    "user": "jpflori"
}
```

Just a random rant on this closed ticket: not building the readline static library makes python fails to build on Cygwin.
Ok this is without doubt because of python build system as it does not manage to find the specially named shared libraries on cygwin (note that when shared and static are installed, gcc will be smart enough to pick the shared one first, so this really is a python issue which fails to detect the shared one...).



---

archive/issue_comments_178568.json:
```json
{
    "body": "Note for myself: http://bugs.python.org/issue4032",
    "created_at": "2013-10-22T17:08:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14201#issuecomment-178568",
    "user": "jpflori"
}
```

Note for myself: http://bugs.python.org/issue4032
