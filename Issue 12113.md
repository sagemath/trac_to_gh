# Issue 12113: Update darwin_memory_usage.c for Lion header files

Issue created by migration from Trac.

Original creator: ncarter

Original creation time: 2012-01-09 16:38:13

Assignee: GeorgSWeber

Keywords: sd35.5 osx lion

Problem:

I got a pre-built 10.6 Sage from here: [http://www.google.com/url?sa=D&q=http://wstein.org/home/wstein/tmp/sage-4.7.3.alpha1-x86_64-Darwin.dmg&usg=AFQjCNGZr8xE-ECiC8ecV7TPI5nOamLiNQ](http://www.google.com/url?sa=D&q=http://wstein.org/home/wstein/tmp/sage-4.7.3.alpha1-x86_64-Darwin.dmg&usg=AFQjCNGZr8xE-ECiC8ecV7TPI5nOamLiNQ).  Even though I'm on Lion, this installs and runs correctly.
But when I tried `./sage -b`, it fails when compiling `devel/sage/misc/darwin_memory_usage.c`.

Details:

The error is that that file contains the line `#include <mach/task_info.h>`, which, on Lion, assumes that the symbol `vm_extmod_statistics_data_t` has already been defined.

Fix:

To define that symbol, we need to first `#include <mach/vm_statistics.h>`.  It is simple to insert such a line at the beginning of `darwin_memory_usage.c`, right before the first `#include`.  Doing so fixes the problem.  Jason Grout was kind enough to test the same change on his 10.6 machine, and verify that the change doesn't screw up the build there.


---

Attachment

patch making the one-line change described in the ticket


---

Comment by jason created at 2012-01-09 16:54:44

Looks good for OSX 10.6 (since sage -b is successful with this change and then sage starts up).  Someone with 10.7 should probably also review this.


---

Comment by ncarter created at 2012-01-09 16:55:05

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2012-01-09 18:01:26

Is this a duplicate of #11965?  Or at least does the fix in #11965 fix your problem?


---

Comment by ncarter created at 2012-01-09 18:39:04

You are correct, that is a better fix.


---

Comment by ncarter created at 2012-01-09 18:39:04

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-01-12 08:39:31

Resolution: duplicate
