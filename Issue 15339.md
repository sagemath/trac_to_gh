# Issue 15339: Semimonomial transformation groups code is sensitive to Permutations global options

archive/issues_015339.json:
```json
{
    "body": "CC:  tfeulner\n\nKeywords: permutation, semimonomial transformation, groups\n\nAs detailed in #14885, it is not healthy for code to rely on the `__mul__` operation on permutations, since this operation depends on the `Permutations().global_options()['mul']` variable which can change at runtime. It is better to use the `left_action_product` and `right_action_product` methods introduced in #15174 (formerly known as `_left_to_right_multiply_on_left` and `_left_to_right_multiply_on_right`).\n\nMy tests show some dependence on the `__mul__` method in `sage/groups/semimonomial_transformations/semimonomial_transformation.pyx` and `sage/groups/semimonomial_transformations/semimonomial_transformation_group.py`, although it might be that only one of these files depends on it and the other depends on the first file. Unfortunately I don't have time to study this in detail, as I'd first have to read up on the definitions.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15576\n\n",
    "created_at": "2013-12-23T18:52:02Z",
    "labels": [
        "group theory",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "Semimonomial transformation groups code is sensitive to Permutations global options",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15339",
    "user": "@darijgr"
}
```
CC:  tfeulner

Keywords: permutation, semimonomial transformation, groups

As detailed in #14885, it is not healthy for code to rely on the `__mul__` operation on permutations, since this operation depends on the `Permutations().global_options()['mul']` variable which can change at runtime. It is better to use the `left_action_product` and `right_action_product` methods introduced in #15174 (formerly known as `_left_to_right_multiply_on_left` and `_left_to_right_multiply_on_right`).

My tests show some dependence on the `__mul__` method in `sage/groups/semimonomial_transformations/semimonomial_transformation.pyx` and `sage/groups/semimonomial_transformations/semimonomial_transformation_group.py`, although it might be that only one of these files depends on it and the other depends on the first file. Unfortunately I don't have time to study this in detail, as I'd first have to read up on the definitions.

Issue created by migration from https://trac.sagemath.org/ticket/15576





---

archive/issue_comments_197550.json:
```json
{
    "body": "I think there should be only this single occurrence of the `__mul__` method in the file. Maybe you can check this with your tests?\n----\nNew commits:",
    "created_at": "2013-12-27T10:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15339#issuecomment-197550",
    "user": "tfeulner"
}
```

I think there should be only this single occurrence of the `__mul__` method in the file. Maybe you can check this with your tests?
----
New commits:



---

archive/issue_comments_197551.json:
```json
{
    "body": "Thanks for taking care of this. The dependency is gone indeed. Could you maybe also document the choice of multiplication order in the (module) documentation? And while at that:\n\n```\nA semimonomial transformation group over a ring `R` of length `n` is equal to\nthe semidirect product of the monomial transformation group\n(also known as the complete monomial group) and the group of ring automorphisms.\n```\n\neither it should be \"The semimonomial...\", not \"A semimonomial...\", or it should be \"a group of ring automorphisms\", not \"the group of ring automorphisms\". In general, it should be impossible to compute the group of all automorphisms of a ring, so I suspect it's either \"a group\" or you are only considering finite fields?",
    "created_at": "2013-12-27T16:03:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15339#issuecomment-197551",
    "user": "@darijgr"
}
```

Thanks for taking care of this. The dependency is gone indeed. Could you maybe also document the choice of multiplication order in the (module) documentation? And while at that:

```
A semimonomial transformation group over a ring `R` of length `n` is equal to
the semidirect product of the monomial transformation group
(also known as the complete monomial group) and the group of ring automorphisms.
```

either it should be "The semimonomial...", not "A semimonomial...", or it should be "a group of ring automorphisms", not "the group of ring automorphisms". In general, it should be impossible to compute the group of all automorphisms of a ring, so I suspect it's either "a group" or you are only considering finite fields?



---

archive/issue_comments_197552.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-29T09:22:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15339#issuecomment-197552",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_197553.json:
```json
{
    "body": "Thanks for your comments. You are right, up to now it is only possible to construct the semimonomial group over a finite field. My plan for the future is to provide an optional package, which implements finite chain rings and semimonomial groups defined over them.\n\nWhile we are at it, the `Permutation.action` method also depends on the multiplication order. Personally, I do also prefer the multiplication of permutations from right to left. But since I am applying the permutation to a vector, there is no choice.",
    "created_at": "2013-12-29T09:34:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15339#issuecomment-197553",
    "user": "tfeulner"
}
```

Thanks for your comments. You are right, up to now it is only possible to construct the semimonomial group over a finite field. My plan for the future is to provide an optional package, which implements finite chain rings and semimonomial groups defined over them.

While we are at it, the `Permutation.action` method also depends on the multiplication order. Personally, I do also prefer the multiplication of permutations from right to left. But since I am applying the permutation to a vector, there is no choice.



---

archive/issue_comments_197554.json:
```json
{
    "body": "Where does `Permutation.action` depend on the multiplication order? I agree, the function isn't very useful because it's easier to write it oneself than to figure out what exactly it does; but it seems to be self-contained. (It also has significant space for optimization... whoever wrote it seems not to have realized that permutations can be iterated over. I'll fix this in a separate ticket.)\n\nI prefer using `R^{\\times}` instead of `R*` for the multiplicative group of units of `R` (the latter notation could be a dual of `R` and either way seems to be a typographic substitute), but this is probably a judgment call (particularly seeing that you use `*` for multiplication).\n\nIn\n\n```\n        `\\psi^{\\pi, \\alpha} = (\\alpha(\\psi_{\\pi(0)}), \\ldots, \\alpha(\\psi_{\\pi(n-1)}))` \n```\n\nyou are using 0-based indexing of permutations; I'm not sure if this is what you want (it's doc, not code).\n\nYou speak of the semimonomial group over a ring R of either \"length n\" (in the definition) or \"degree n\" (in other parts of the doc). I think it would help to settle upon one notation (or define them both).\n\nOther than this, the code looks fine. Thanks for the quick response, and set this to positive_review once the above issues are fixed!",
    "created_at": "2013-12-31T16:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15339#issuecomment-197554",
    "user": "@darijgr"
}
```

Where does `Permutation.action` depend on the multiplication order? I agree, the function isn't very useful because it's easier to write it oneself than to figure out what exactly it does; but it seems to be self-contained. (It also has significant space for optimization... whoever wrote it seems not to have realized that permutations can be iterated over. I'll fix this in a separate ticket.)

I prefer using `R^{\times}` instead of `R*` for the multiplicative group of units of `R` (the latter notation could be a dual of `R` and either way seems to be a typographic substitute), but this is probably a judgment call (particularly seeing that you use `*` for multiplication).

In

```
        `\psi^{\pi, \alpha} = (\alpha(\psi_{\pi(0)}), \ldots, \alpha(\psi_{\pi(n-1)}))` 
```

you are using 0-based indexing of permutations; I'm not sure if this is what you want (it's doc, not code).

You speak of the semimonomial group over a ring R of either "length n" (in the definition) or "degree n" (in other parts of the doc). I think it would help to settle upon one notation (or define them both).

Other than this, the code looks fine. Thanks for the quick response, and set this to positive_review once the above issues are fixed!



---

archive/issue_comments_197555.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-04T08:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15339#issuecomment-197555",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_197556.json:
```json
{
    "body": "Replying to [comment:6 darij]:\n> Where does `Permutation.action` depend on the multiplication order? I agree, the function isn't very useful because it's easier to write it oneself than to figure out what exactly it does; but it seems to be self-contained. (It also has significant space for optimization... whoever wrote it seems not to have realized that permutations can be iterated over. I'll fix this in a separate ticket.)\n\nWell, what I wanted to say is, that we need two functions to implement the action of the permutation group on list/vectors of length `n`, depending on the multiplication rule used for the definition of the symmetric group. \n\nThe current implementation of `Permutation.action` corresponds to the action from the left and the multiplication defined by `right_action_product`. \n\nUsing `left_action_product` for the multiplication in the group and still acting from the left would force us to define the action method in the following way:\n\n```\npi * (v_1, ..., v_n) := (v_{pi^{-1}(1)}, ... , v_{pi^{-1}(n)})\n```\n\n\nBut this should become the topic of a separate ticket.\n\nThanks for your careful reading, I think I have fixed them all.",
    "created_at": "2014-01-04T09:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15339#issuecomment-197556",
    "user": "tfeulner"
}
```

Replying to [comment:6 darij]:
> Where does `Permutation.action` depend on the multiplication order? I agree, the function isn't very useful because it's easier to write it oneself than to figure out what exactly it does; but it seems to be self-contained. (It also has significant space for optimization... whoever wrote it seems not to have realized that permutations can be iterated over. I'll fix this in a separate ticket.)

Well, what I wanted to say is, that we need two functions to implement the action of the permutation group on list/vectors of length `n`, depending on the multiplication rule used for the definition of the symmetric group. 

The current implementation of `Permutation.action` corresponds to the action from the left and the multiplication defined by `right_action_product`. 

Using `left_action_product` for the multiplication in the group and still acting from the left would force us to define the action method in the following way:

```
pi * (v_1, ..., v_n) := (v_{pi^{-1}(1)}, ... , v_{pi^{-1}(n)})
```


But this should become the topic of a separate ticket.

Thanks for your careful reading, I think I have fixed them all.



---

archive/issue_comments_197557.json:
```json
{
    "body": "Attention: branch change!\n\nI'm a bit surprised that you changed the definite articles back to the indefinites, so I'm suggesting to change them back in my commit. (Also, \"the group of degree n over a ring R\" sounds better than \"the group over a ring R of degree n\" to my ears.)\n\nIf my edits are OK to you, please set this to positive_review. Thanks for your work!\n\nEDIT: I see what you mean by adding new `action` methods, but frankly I don't see much of a point in those methods anyway. At least I can rewrite that functionality faster than I could read through the docstring to tell which of the many possible actions it implements.",
    "created_at": "2014-01-06T14:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15339#issuecomment-197557",
    "user": "@darijgr"
}
```

Attention: branch change!

I'm a bit surprised that you changed the definite articles back to the indefinites, so I'm suggesting to change them back in my commit. (Also, "the group of degree n over a ring R" sounds better than "the group over a ring R of degree n" to my ears.)

If my edits are OK to you, please set this to positive_review. Thanks for your work!

EDIT: I see what you mean by adding new `action` methods, but frankly I don't see much of a point in those methods anyway. At least I can rewrite that functionality faster than I could read through the docstring to tell which of the many possible actions it implements.



---

archive/issue_comments_197558.json:
```json
{
    "body": "Trac is preventing me from changing the branch to public/ticket/15576, so maybe you can just merge this into your branch or write a **big fat warning message on the ticket**.",
    "created_at": "2014-01-06T14:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15339#issuecomment-197558",
    "user": "@darijgr"
}
```

Trac is preventing me from changing the branch to public/ticket/15576, so maybe you can just merge this into your branch or write a **big fat warning message on the ticket**.



---

archive/issue_comments_197559.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-01-06T19:27:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15339#issuecomment-197559",
    "user": "tfeulner"
}
```

New commits:



---

archive/issue_comments_197560.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-06T19:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15339#issuecomment-197560",
    "user": "tfeulner"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_197561.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-06T19:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15339#issuecomment-197561",
    "user": "tfeulner"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_197562.json:
```json
{
    "body": "Thanks for your help, Darij. All your changes look good to me.\n\nOf course, an experienced programmer could write these action methods very quickly. But, by allowing the user to freely decide on the multiplication rule, you also have to think about these dependencies and modifiy the existing code.",
    "created_at": "2014-01-06T19:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15339#issuecomment-197562",
    "user": "tfeulner"
}
```

Thanks for your help, Darij. All your changes look good to me.

Of course, an experienced programmer could write these action methods very quickly. But, by allowing the user to freely decide on the multiplication rule, you also have to think about these dependencies and modifiy the existing code.



---

archive/issue_comments_197563.json:
```json
{
    "body": "Please fill in the author/reviewer fields",
    "created_at": "2014-01-07T04:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15339#issuecomment-197563",
    "user": "@vbraun"
}
```

Please fill in the author/reviewer fields



---

archive/issue_comments_197564.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-08T18:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15339#issuecomment-197564",
    "user": "@vbraun"
}
```

Resolution: fixed
