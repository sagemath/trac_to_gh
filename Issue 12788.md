# Issue 12788: legend not properly set in Graphics().matplotlib()

Issue created by migration from Trac.

Original creator: ppurka

Original creation time: 2012-05-17 07:02:06

Assignee: jason, was

Keywords: legend matplotlib

Bug :) Should be easy to fix.

```
sage: q = plot(x, legend_label='aha')
sage: q.legend(True)                 
sage: qm = q.matplotlib()
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)

/home/punarbasu/Installations/sage-5.0.rc0.11080/devel/sage-main/<ipython console> in <module>()

/home/punarbasu/Installations/sage-5.0.rc0.11080/local/lib/python2.7/site-packages/sage/plot/graphics.pyc in matplotlib(self, filename, xmin, xmax, ymin, ymax, figsize, figure, sub, axes, axes_labels, fontsize, frame, verify, aspect_ratio, gridlines, gridlinesstyle, vgridlinesstyle, hgridlinesstyle, show_legend, legend_options, axes_pad, ticks_integer, tick_formatter, ticks)
   1714             lopts.update(legend_options)
   1715             lopts.update(self._legend_opts)
-> 1716             prop = FontProperties(family=lopts.pop('font_family'), weight=lopts.pop('font_weight'), \
   1717                     size=lopts.pop('font_size'), style=lopts.pop('font_style'), variant=lopts.pop('font_variant'))
   1718             color = lopts.pop('back_color')

KeyError: 'font_family'
sage: 
```



---

Comment by ppurka created at 2012-05-17 07:37:54

Changing status from new to needs_review.


---

Comment by ppurka created at 2012-05-17 07:43:34

Hmm.. the matplotlib arguments are also changed it seems. I will revert that.


---

Attachment

apply to devel/sage


---

Comment by kcrisman created at 2012-05-17 17:43:21

Does this really work?  I'm unclear as to how this would work in the case `show is None`.  Or maybe it's not supposed to then, since it's not being shown... in which case why not just put this in the `matplotlib` definition, which currently has `legend_options={`}?  Or maybe with a ``@`suboptions` decorator like in `show`?  This seems more "Sage-ic".


---

Comment by ppurka created at 2012-05-17 18:28:35

Whoever wrote the legend code probably didn't want unnecessary initializations. I kept it the same, that is the `legend_opts` don't get populated unless it is absolutely required. Otherwise we could just initialize it in `__init__` instead of passing ``@`options` or ``@`suboptions` all over the place.

If `show_legend` is None, then of course, nothing happens. If it is set to True, then something weird can happen. I will check this case.


---

Comment by ppurka created at 2012-05-17 18:28:56

Changing status from needs_review to needs_work.


---

Comment by ppurka created at 2012-05-18 06:16:53

Changing status from needs_work to needs_review.


---

Comment by ppurka created at 2012-05-18 06:16:53

Ok. This is a much better fix since it takes care of all cases, for example if you pass an incomplete set of options in the `legend={}` argument, set `show_legend=True`, etc.


---

Comment by kcrisman created at 2012-05-25 00:58:47

Yes, this makes a lot more sense.  Needs doctests!


---

Comment by kcrisman created at 2012-05-25 00:58:47

Changing keywords from "legend matplotlib" to "legend matplotlib sd40.5".


---

Comment by kcrisman created at 2012-05-25 00:58:47

Changing status from needs_review to needs_work.


---

Attachment

apply to devel/sage


---

Comment by ppurka created at 2012-05-25 05:08:13

Updated the patch with a test.


---

Comment by ppurka created at 2012-05-25 05:08:13

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2012-05-25 14:49:09

Looks great, thanks for the good work!


---

Comment by kcrisman created at 2012-05-25 14:49:09

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-06-02 12:15:46

Resolution: fixed
