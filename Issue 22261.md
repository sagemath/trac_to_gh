# Issue 22261: Add .normal_fan() and .face_fan() methods for rational bounded polyhedra

archive/issues_022261.json:
```json
{
    "body": "CC:  @mo271 @mkoeppe @videlec tmonteil @fchapoton\n\nKeywords: geometry, days84, polytope, fan\n\nThis ticket provides the method constructing the normal fan and face fan of a rational bounded polyhedra via the `sage.geometry.fan.RationalPolyhedralFan` class. \n\nThe normal fan of a polyhedra consists of a set of polyhedral cones indexed by the faces of the polyhedra.\nGiven a face F of a polyhedron, the cone associated to F consists of all the normal vectors of the hyperplanes (linear functions) that are maximal on F. The normal fan has the property that intersections of cones correspond to the intersection of faces.\n\nThe face fan is the \"dual\" construction. Taking a point in the interior of the polytope, the cones of the fan are the positive span of the faces.\n\nAll that is done right now is to wrap the methods from `sage.geometry.fan.RationalPolyhedralFan`. Eventually, one may consider looking how this could be done using the normaliz backend of polyhedra, if it ever makes sense. This could be done in a separated ticket.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22498\n\n",
    "closed_at": "2017-03-27T20:42:12Z",
    "created_at": "2017-03-02T17:44:02Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Add .normal_fan() and .face_fan() methods for rational bounded polyhedra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22261",
    "user": "https://github.com/jplab"
}
```
CC:  @mo271 @mkoeppe @videlec tmonteil @fchapoton

Keywords: geometry, days84, polytope, fan

This ticket provides the method constructing the normal fan and face fan of a rational bounded polyhedra via the `sage.geometry.fan.RationalPolyhedralFan` class. 

The normal fan of a polyhedra consists of a set of polyhedral cones indexed by the faces of the polyhedra.
Given a face F of a polyhedron, the cone associated to F consists of all the normal vectors of the hyperplanes (linear functions) that are maximal on F. The normal fan has the property that intersections of cones correspond to the intersection of faces.

The face fan is the "dual" construction. Taking a point in the interior of the polytope, the cones of the fan are the positive span of the faces.

All that is done right now is to wrap the methods from `sage.geometry.fan.RationalPolyhedralFan`. Eventually, one may consider looking how this could be done using the normaliz backend of polyhedra, if it ever makes sense. This could be done in a separated ticket.

Issue created by migration from https://trac.sagemath.org/ticket/22498





---

archive/issue_comments_308978.json:
```json
{
    "body": "```\nsage: p = polytopes.cube(); p\nA 3-dimensional polyhedron in ZZ^3 defined as the convex hull of 8 vertices\nsage: NormalFan(p)\nRational polyhedral fan in 3-d lattice N\n```",
    "created_at": "2017-03-04T05:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22261#issuecomment-308978",
    "user": "https://github.com/novoselt"
}
```

```
sage: p = polytopes.cube(); p
A 3-dimensional polyhedron in ZZ^3 defined as the convex hull of 8 vertices
sage: NormalFan(p)
Rational polyhedral fan in 3-d lattice N
```



---

archive/issue_comments_308979.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2017-03-04T07:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22261#issuecomment-308979",
    "user": "https://github.com/jplab"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_308980.json:
```json
{
    "body": "> sage: NormalFan(p)\n> Rational polyhedral fan in 3-d lattice N\n> }}}\n\n\nWow! This is great! Thank you for the reply.\n\nOkay, perhaps I should have asked how to do this first. Then, I suggest to modify the description of the ticket to make this feature apparent in the documentation of Polyhedron. Perhaps also to add a wrapper method in the base class of polyhedron? Is that reasonable?",
    "created_at": "2017-03-04T07:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22261#issuecomment-308980",
    "user": "https://github.com/jplab"
}
```

> sage: NormalFan(p)
> Rational polyhedral fan in 3-d lattice N
> }}}


Wow! This is great! Thank you for the reply.

Okay, perhaps I should have asked how to do this first. Then, I suggest to modify the description of the ticket to make this feature apparent in the documentation of Polyhedron. Perhaps also to add a wrapper method in the base class of polyhedron? Is that reasonable?



---

archive/issue_comments_308981.json:
```json
{
    "body": "I think adding a method would be great (perhaps with `.face_fan()` as well):\n- visibility in documentation\n- visibility in TAB-completion\n- more chances to have tests specifically for `Polyhedron`\nOf course, all this method should do is `return NormalFan(self)` for consistency (can be cached if you wish).",
    "created_at": "2017-03-05T05:05:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22261#issuecomment-308981",
    "user": "https://github.com/novoselt"
}
```

I think adding a method would be great (perhaps with `.face_fan()` as well):
- visibility in documentation
- visibility in TAB-completion
- more chances to have tests specifically for `Polyhedron`
Of course, all this method should do is `return NormalFan(self)` for consistency (can be cached if you wish).



---

archive/issue_comments_308982.json:
```json
{
    "body": "> Of course, all this method should do is `return NormalFan(self)` for consistency (can be cached if you wish).\n\n\nYep. Sounds good.\n\nWould it make sense to deprecate `NormalFan` and `FaceFan` from the global name space then? I do not see a reason not to.",
    "created_at": "2017-03-05T08:51:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22261#issuecomment-308982",
    "user": "https://github.com/jplab"
}
```

> Of course, all this method should do is `return NormalFan(self)` for consistency (can be cached if you wish).


Yep. Sounds good.

Would it make sense to deprecate `NormalFan` and `FaceFan` from the global name space then? I do not see a reason not to.



---

archive/issue_comments_308983.json:
```json
{
    "body": "`NormalFan` and `FaceFan` accept other kinds of input as well (in particular `LatticePolytope`), and what's the problem with keeping them there? All functions can be recast as methods, but it is not a reason to stop using them at all ;-)",
    "created_at": "2017-03-05T21:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22261#issuecomment-308983",
    "user": "https://github.com/novoselt"
}
```

`NormalFan` and `FaceFan` accept other kinds of input as well (in particular `LatticePolytope`), and what's the problem with keeping them there? All functions can be recast as methods, but it is not a reason to stop using them at all ;-)



---

archive/issue_comments_308984.json:
```json
{
    "body": "Replying to [comment:5 novoselt]:\n> `NormalFan` and `FaceFan` accept other kinds of input as well (in particular `LatticePolytope`),\n\n\nFair enough. At some point I should learn the subtleties between a general Polyhedron object and a LatticePolytope object... I am currently working on a thematic tutorial and I'd like to know about the differences (I will put you in cc in the ticket once I have something).\n\n> and what's the problem with keeping them there? All functions can be recast as methods, but it is not a reason to stop using them at all ;-)\n\n\nWell, if these functions would have been methods of polyhedron, I would have known about them a bit earlier. hehe! Are there other interesting functions like these that are not wrapped as methods?",
    "created_at": "2017-03-06T09:34:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22261#issuecomment-308984",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:5 novoselt]:
> `NormalFan` and `FaceFan` accept other kinds of input as well (in particular `LatticePolytope`),


Fair enough. At some point I should learn the subtleties between a general Polyhedron object and a LatticePolytope object... I am currently working on a thematic tutorial and I'd like to know about the differences (I will put you in cc in the ticket once I have something).

> and what's the problem with keeping them there? All functions can be recast as methods, but it is not a reason to stop using them at all ;-)


Well, if these functions would have been methods of polyhedron, I would have known about them a bit earlier. hehe! Are there other interesting functions like these that are not wrapped as methods?



---

archive/issue_comments_308985.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-03-06T10:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22261#issuecomment-308985",
    "user": "https://github.com/jplab"
}
```

New commits:



---

archive/issue_comments_308986.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-03-06T10:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22261#issuecomment-308986",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_308987.json:
```json
{
    "body": "There are no examples!!!\n\nAlso, is it really necessary to have full-dimensional polytope for the face fan?",
    "created_at": "2017-03-07T01:10:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22261#issuecomment-308987",
    "user": "https://github.com/novoselt"
}
```

There are no examples!!!

Also, is it really necessary to have full-dimensional polytope for the face fan?



---

archive/issue_comments_308988.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-03-07T01:10:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22261#issuecomment-308988",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_308989.json:
```json
{
    "body": "Replying to [comment:6 jipilab]:\n> Replying to [comment:5 novoselt]:\n> > `NormalFan` and `FaceFan` accept other kinds of input as well (in particular `LatticePolytope`),\n\n> \n> Fair enough. At some point I should learn the subtleties between a general Polyhedron object and a LatticePolytope object... I am currently working on a thematic tutorial and I'd like to know about the differences (I will put you in cc in the ticket once I have something).\n\n\nThe main subtlety is history: 10 years ago cdd was use for Polyhedron with float components and LatticePolytope was using PALP for integer components. Also in terms of focus Polyhedron was for everything while PALP is written with reflexive polytopes in mind and has some sensible hardcoded limitations that are not sensible at all in general setting (like no dimension above 6 and no more than 64 vertices). Both used to rely on file input-output for communication which has huge overhead for small cases, then Cone/Fan started using Volker's PPL library interface and eventually Polyhedron got fast backends as well while LatticePolytope was lagging behind. Over the last few years I made incompatible changes (with deprecation periods mostly) to make it close in spirit to Cone and if my recent tickets get merged it will be as fast as Cone apart from point enumeration (which is sort of not a problem fro cones at all, they usually have infinitely many points).\n> \n> > and what's the problem with keeping them there? All functions can be recast as methods, but it is not a reason to stop using them at all ;-)\n\n> \n> Well, if these functions would have been methods of polyhedron, I would have known about them a bit earlier. hehe! Are there other interesting functions like these that are not wrapped as methods?\n\n\nFair enough and no other interesting functions come to mind ;-)",
    "created_at": "2017-03-07T01:21:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22261#issuecomment-308989",
    "user": "https://github.com/novoselt"
}
```

Replying to [comment:6 jipilab]:
> Replying to [comment:5 novoselt]:
> > `NormalFan` and `FaceFan` accept other kinds of input as well (in particular `LatticePolytope`),

> 
> Fair enough. At some point I should learn the subtleties between a general Polyhedron object and a LatticePolytope object... I am currently working on a thematic tutorial and I'd like to know about the differences (I will put you in cc in the ticket once I have something).


The main subtlety is history: 10 years ago cdd was use for Polyhedron with float components and LatticePolytope was using PALP for integer components. Also in terms of focus Polyhedron was for everything while PALP is written with reflexive polytopes in mind and has some sensible hardcoded limitations that are not sensible at all in general setting (like no dimension above 6 and no more than 64 vertices). Both used to rely on file input-output for communication which has huge overhead for small cases, then Cone/Fan started using Volker's PPL library interface and eventually Polyhedron got fast backends as well while LatticePolytope was lagging behind. Over the last few years I made incompatible changes (with deprecation periods mostly) to make it close in spirit to Cone and if my recent tickets get merged it will be as fast as Cone apart from point enumeration (which is sort of not a problem fro cones at all, they usually have infinitely many points).
> 
> > and what's the problem with keeping them there? All functions can be recast as methods, but it is not a reason to stop using them at all ;-)

> 
> Well, if these functions would have been methods of polyhedron, I would have known about them a bit earlier. hehe! Are there other interesting functions like these that are not wrapped as methods?


Fair enough and no other interesting functions come to mind ;-)



---

archive/issue_comments_308990.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-07T10:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22261#issuecomment-308990",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_308991.json:
```json
{
    "body": "Replying to [comment:9 novoselt]:\n> There are no examples!!!\n> \n\n\nI added examples to both functions and a test for rational coordinates.\n\nIt seems that there is no direct test for unboundedness in face fan:\n\n```\nsage: Q = Polyhedron(rays = [[-1, 1/2], [1, -1/2]])\nsage: Q.face_fan()\nTraceback (most recent call last):\n...\nValueError: face fans are defined only for polytopes containing the origin as an interior point!\nsage: FaceFan(Q)     # The currently implemented function\nTraceback (most recent call last):\n...\nValueError: face fans are defined only for polytopes containing the origin as an interior point!\n```\n\nThat should be treated in a different ticket I guess?\n\n> Also, is it really necessary to have full-dimensional polytope for the face fan?\n\n\nCurrently it seems to work:\n\n```\nsage: S = Polyhedron(vertices = [[-1, 1/2], [1, -1/2]])\nsage: S\nA 1-dimensional polyhedron in QQ^2 defined as the convex hull of 2 vertices\nsage: FaceFan(S)\nRational polyhedral fan in 2-d lattice M\n```",
    "created_at": "2017-03-07T11:02:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22261#issuecomment-308991",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:9 novoselt]:
> There are no examples!!!
> 


I added examples to both functions and a test for rational coordinates.

It seems that there is no direct test for unboundedness in face fan:

```
sage: Q = Polyhedron(rays = [[-1, 1/2], [1, -1/2]])
sage: Q.face_fan()
Traceback (most recent call last):
...
ValueError: face fans are defined only for polytopes containing the origin as an interior point!
sage: FaceFan(Q)     # The currently implemented function
Traceback (most recent call last):
...
ValueError: face fans are defined only for polytopes containing the origin as an interior point!
```

That should be treated in a different ticket I guess?

> Also, is it really necessary to have full-dimensional polytope for the face fan?


Currently it seems to work:

```
sage: S = Polyhedron(vertices = [[-1, 1/2], [1, -1/2]])
sage: S
A 1-dimensional polyhedron in QQ^2 defined as the convex hull of 2 vertices
sage: FaceFan(S)
Rational polyhedral fan in 2-d lattice M
```



---

archive/issue_comments_308992.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-07T11:08:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22261#issuecomment-308992",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_308993.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-07T11:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22261#issuecomment-308993",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_308994.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-18T23:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22261#issuecomment-308994",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_308995.json:
```json
{
    "body": "Great! Thanks!",
    "created_at": "2017-03-19T01:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22261#issuecomment-308995",
    "user": "https://github.com/jplab"
}
```

Great! Thanks!



---

archive/issue_events_058802.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-27T20:42:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22261#event-58802"
}
```



---

archive/issue_comments_308996.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-03-27T20:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22261#issuecomment-308996",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
