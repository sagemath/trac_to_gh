# Issue 22261: Add .normal_fan() method for polyhedra

Issue created by migration from https://trac.sagemath.org/ticket/22498

Original creator: jipilab

Original creation time: 2017-03-02 17:44:02

CC:  moritz mkoeppe vdelecroix tmonteil chapoton

Keywords: geometry, days84, polytope, fan

This ticket provides the method constructing the normal fan of a polyhedra.

The normal fan of a polyhedra consists of a set of polyhedral cones indexed by the faces of the polyhedra.
Given a face F of a polyhedron, the cone associated to F consists of all the normal vectors of the hyperplanes (linear functions) that are maximal on F. The normal fan has the property that intersections of cones correspond to the intersection of faces.


---

Comment by novoselt created at 2017-03-04 05:53:29


```
sage: p = polytopes.cube(); p
A 3-dimensional polyhedron in ZZ^3 defined as the convex hull of 8 vertices
sage: NormalFan(p)
Rational polyhedral fan in 3-d lattice N
```



---

Comment by jipilab created at 2017-03-04 07:37:00

Changing status from new to needs_info.


---

Comment by jipilab created at 2017-03-04 07:37:00

> sage: NormalFan(p)
> Rational polyhedral fan in 3-d lattice N
> }}}

Wow! This is great! Thank you for the reply.

Okay, perhaps I should have asked how to do this first. Then, I suggest to modify the description of the ticket to make this feature apparent in the documentation of Polyhedron. Perhaps also to add a wrapper method in the base class of polyhedron? Is that reasonable?


---

Comment by novoselt created at 2017-03-05 05:05:44

I think adding a method would be great (perhaps with `.face_fan()` as well):
- visibility in documentation
- visibility in TAB-completion
- more chances to have tests specifically for `Polyhedron`
Of course, all this method should do is `return NormalFan(self)` for consistency (can be cached if you wish).


---

Comment by jipilab created at 2017-03-05 08:51:07

> Of course, all this method should do is `return NormalFan(self)` for consistency (can be cached if you wish).

Yep. Sounds good.

Would it make sense to deprecate `NormalFan` and `FaceFan` from the global name space then? I do not see a reason not to.


---

Comment by novoselt created at 2017-03-05 21:51:41

`NormalFan` and `FaceFan` accept other kinds of input as well (in particular `LatticePolytope`), and what's the problem with keeping them there? All functions can be recast as methods, but it is not a reason to stop using them at all ;-)


---

Comment by jipilab created at 2017-03-06 09:34:52

Replying to [comment:5 novoselt]:
> `NormalFan` and `FaceFan` accept other kinds of input as well (in particular `LatticePolytope`),

Fair enough. At some point I should learn the subtleties between a general Polyhedron object and a LatticePolytope object... I am currently working on a thematic tutorial and I'd like to know about the differences (I will put you in cc in the ticket once I have something).

> and what's the problem with keeping them there? All functions can be recast as methods, but it is not a reason to stop using them at all ;-)

Well, if these functions would have been methods of polyhedron, I would have known about them a bit earlier. hehe! Are there other interesting functions like these that are not wrapped as methods?


---

Comment by jipilab created at 2017-03-06 10:13:02

New commits:


---

Comment by jipilab created at 2017-03-06 10:13:02

Changing status from needs_info to needs_review.


---

Comment by novoselt created at 2017-03-07 01:10:35

There are no examples!!!

Also, is it really necessary to have full-dimensional polytope for the face fan?


---

Comment by novoselt created at 2017-03-07 01:10:35

Changing status from needs_review to needs_work.


---

Comment by novoselt created at 2017-03-07 01:21:26

Replying to [comment:6 jipilab]:
> Replying to [comment:5 novoselt]:
> > `NormalFan` and `FaceFan` accept other kinds of input as well (in particular `LatticePolytope`),
> 
> Fair enough. At some point I should learn the subtleties between a general Polyhedron object and a LatticePolytope object... I am currently working on a thematic tutorial and I'd like to know about the differences (I will put you in cc in the ticket once I have something).

The main subtlety is history: 10 years ago cdd was use for Polyhedron with float components and LatticePolytope was using PALP for integer components. Also in terms of focus Polyhedron was for everything while PALP is written with reflexive polytopes in mind and has some sensible hardcoded limitations that are not sensible at all in general setting (like no dimension above 6 and no more than 64 vertices). Both used to rely on file input-output for communication which has huge overhead for small cases, then Cone/Fan started using Volker's PPL library interface and eventually Polyhedron got fast backends as well while LatticePolytope was lagging behind. Over the last few years I made incompatible changes (with deprecation periods mostly) to make it close in spirit to Cone and if my recent tickets get merged it will be as fast as Cone apart from point enumeration (which is sort of not a problem fro cones at all, they usually have infinitely many points).
> 
> > and what's the problem with keeping them there? All functions can be recast as methods, but it is not a reason to stop using them at all ;-)
> 
> Well, if these functions would have been methods of polyhedron, I would have known about them a bit earlier. hehe! Are there other interesting functions like these that are not wrapped as methods?

Fair enough and no other interesting functions come to mind ;-)


---

Comment by git created at 2017-03-07 10:55:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2017-03-07 11:02:13

Replying to [comment:9 novoselt]:
> There are no examples!!!
> 

I added examples to both functions and a test for rational coordinates.

It seems that there is no direct test for unboundedness in face fan:


```
sage: Q = Polyhedron(rays = [[-1, 1/2], [1, -1/2]])
sage: Q.face_fan()
Traceback (most recent call last):
...
ValueError: face fans are defined only for polytopes containing the origin as an interior point!
sage: FaceFan(Q)     # The currently implemented function
Traceback (most recent call last):
...
ValueError: face fans are defined only for polytopes containing the origin as an interior point!
```


That should be treated in a different ticket I guess?

> Also, is it really necessary to have full-dimensional polytope for the face fan?

Currently it seems to work:

```
sage: S = Polyhedron(vertices = [[-1, 1/2], [1, -1/2]])
sage: S
A 1-dimensional polyhedron in QQ^2 defined as the convex hull of 2 vertices
sage: FaceFan(S)
Rational polyhedral fan in 2-d lattice M
```



---

Comment by git created at 2017-03-07 11:08:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2017-03-07 11:09:15

Changing status from needs_work to needs_review.


---

Comment by novoselt created at 2017-03-18 23:37:08

Changing status from needs_review to positive_review.


---

Comment by jipilab created at 2017-03-19 01:52:34

Great! Thanks!


---

Comment by vbraun created at 2017-03-27 20:42:12

Resolution: fixed
