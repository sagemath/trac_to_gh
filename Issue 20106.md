# Issue 20106: Adding sage/misc/tikz_picture.py

archive/issues_020106.json:
```json
{
    "body": "CC:  dkrenn jipilab slelievre chapoton\n\nFrom my optional Sage package [1] slabbe-0.2.spkg.\n\n[1] https://github.com/seblabbe/slabbe\n\nIssue created by migration from https://trac.sagemath.org/ticket/20343\n\n",
    "created_at": "2016-04-01T12:33:17Z",
    "labels": [
        "misc",
        "major",
        "enhancement"
    ],
    "title": "Adding sage/misc/tikz_picture.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20106",
    "user": "slabbe"
}
```
CC:  dkrenn jipilab slelievre chapoton

From my optional Sage package [1] slabbe-0.2.spkg.

[1] https://github.com/seblabbe/slabbe

Issue created by migration from https://trac.sagemath.org/ticket/20343





---

archive/issue_comments_277020.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-04-01T13:32:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277020",
    "user": "slabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_277021.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-04-01T13:32:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277021",
    "user": "slabbe"
}
```

New commits:



---

archive/issue_comments_277022.json:
```json
{
    "body": "A comment:\n\n```\nt = TikzPicture(latex(transducers.GrayCode()))\nt.pdf()\n```\n\ndoes not work as the preamble is not set correctly. However, there is\n\n```\nfrom sage.combinat.finite_state_machine import setup_latex_preamble\nsetup_latex_preamble()\n```\n\n(as well as the corresponding function in `sage.graphs.graph_latex`) to set this correctly, but it seems to be ignored by `TikzPicture`. \n\nIn contrast, \n\n```\nview(transducers.GrayCode())\n```\n\nworks, but I have no idea if `setup_latex_preamble` is called (not needed to be done manually) or if tikz is included anyways.",
    "created_at": "2016-04-04T18:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277022",
    "user": "dkrenn"
}
```

A comment:

```
t = TikzPicture(latex(transducers.GrayCode()))
t.pdf()
```

does not work as the preamble is not set correctly. However, there is

```
from sage.combinat.finite_state_machine import setup_latex_preamble
setup_latex_preamble()
```

(as well as the corresponding function in `sage.graphs.graph_latex`) to set this correctly, but it seems to be ignored by `TikzPicture`. 

In contrast, 

```
view(transducers.GrayCode())
```

works, but I have no idea if `setup_latex_preamble` is called (not needed to be done manually) or if tikz is included anyways.



---

archive/issue_comments_277023.json:
```json
{
    "body": "Replying to [comment:5 dkrenn]:\n> A comment:\n> {{{\n> t = TikzPicture(latex(transducers.GrayCode()))\n> t.pdf()\n> }}}\n> does not work as the preamble is not set correctly.\n\nAs it is now, the user must set the libraries. This should work:\n\n```\nt = TikzPicture(latex(transducers.GrayCode()), tikzlibraries=['automata'])\nt.pdf()\n```\n\n\nI am still not sure about the proper way to choose the arguments for the `__init__` function and their especially their default values. Should the arguments be empty by default? equal to the current sage latex preamble? or full of a big load of libraries?",
    "created_at": "2016-04-04T19:36:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277023",
    "user": "slabbe"
}
```

Replying to [comment:5 dkrenn]:
> A comment:
> {{{
> t = TikzPicture(latex(transducers.GrayCode()))
> t.pdf()
> }}}
> does not work as the preamble is not set correctly.

As it is now, the user must set the libraries. This should work:

```
t = TikzPicture(latex(transducers.GrayCode()), tikzlibraries=['automata'])
t.pdf()
```


I am still not sure about the proper way to choose the arguments for the `__init__` function and their especially their default values. Should the arguments be empty by default? equal to the current sage latex preamble? or full of a big load of libraries?



---

archive/issue_comments_277024.json:
```json
{
    "body": "Replying to [comment:6 slabbe]:\n> Replying to [comment:5 dkrenn]:\n> > A comment:\n> > {{{\n> > t = TikzPicture(latex(transducers.GrayCode()))\n> > t.pdf()\n> > }}}\n> > does not work as the preamble is not set correctly.\n> \n> As it is now, the user must set the libraries. This should work:\n> {{{\n> t = TikzPicture(latex(transducers.GrayCode()), tikzlibraries=['automata'])\n> t.pdf()\n> }}}\n\nWorks, thanks.\n\n> I am still not sure about the proper way to choose the arguments for the `__init__` function and their especially their default values. Should the arguments be empty by default? equal to the current sage latex preamble? or full of a big load of libraries?\n\nWithout much thinking, I vote for: The second, equal to the current sage latex preamble.",
    "created_at": "2016-04-05T08:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277024",
    "user": "dkrenn"
}
```

Replying to [comment:6 slabbe]:
> Replying to [comment:5 dkrenn]:
> > A comment:
> > {{{
> > t = TikzPicture(latex(transducers.GrayCode()))
> > t.pdf()
> > }}}
> > does not work as the preamble is not set correctly.
> 
> As it is now, the user must set the libraries. This should work:
> {{{
> t = TikzPicture(latex(transducers.GrayCode()), tikzlibraries=['automata'])
> t.pdf()
> }}}

Works, thanks.

> I am still not sure about the proper way to choose the arguments for the `__init__` function and their especially their default values. Should the arguments be empty by default? equal to the current sage latex preamble? or full of a big load of libraries?

Without much thinking, I vote for: The second, equal to the current sage latex preamble.



---

archive/issue_comments_277025.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-07T22:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277025",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277026.json:
```json
{
    "body": "My module has evolved in my package slabbe, therefore the branch here is not up to date anymore. Also, I intend to make it more general during the next year allowing any content not only tikzpicture code. Therefore, I deleted the branch posted here.",
    "created_at": "2016-12-09T09:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277026",
    "user": "slabbe"
}
```

My module has evolved in my package slabbe, therefore the branch here is not up to date anymore. Also, I intend to make it more general during the next year allowing any content not only tikzpicture code. Therefore, I deleted the branch posted here.



---

archive/issue_comments_277027.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-12-09T20:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277027",
    "user": "slabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_277028.json:
```json
{
    "body": "Changing status to needs work.",
    "created_at": "2016-12-09T20:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277028",
    "user": "slabbe"
}
```

Changing status to needs work.



---

archive/issue_comments_277029.json:
```json
{
    "body": "As a follow-up ticket to make use of this is #22506.",
    "created_at": "2017-03-10T11:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277029",
    "user": "jipilab"
}
```

As a follow-up ticket to make use of this is #22506.



---

archive/issue_comments_277030.json:
```json
{
    "body": "I'll be happy to revive this ticket.\n----\nNew commits:",
    "created_at": "2021-03-31T13:15:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277030",
    "user": "caruso"
}
```

I'll be happy to revive this ticket.
----
New commits:



---

archive/issue_comments_277031.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-31T13:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277031",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277032.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-31T16:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277032",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277033.json:
```json
{
    "body": "I'm not convinced by all the methods `from_dot_string`, `from_graph`, etc. in the class `TikzPicture`. I would say that this code should instead be in the classes implementing the object we want to display. E.g. it could be a method `_tikz_`, just as `_latex_`, and `TikzPicture` just calls it.\n\nWhat's your opinion?",
    "created_at": "2021-03-31T16:25:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277033",
    "user": "caruso"
}
```

I'm not convinced by all the methods `from_dot_string`, `from_graph`, etc. in the class `TikzPicture`. I would say that this code should instead be in the classes implementing the object we want to display. E.g. it could be a method `_tikz_`, just as `_latex_`, and `TikzPicture` just calls it.

What's your opinion?



---

archive/issue_comments_277034.json:
```json
{
    "body": "There is no class for `dot strings`. Graphs already have a `_latex_` method which returns a tikz picture string. It is what is used with for instance `view(G)`. The `from_graph` class method really is using `dot2tex` + `graphviz` which is not the same layout sometimes. It is true that maybe adding a `_tikz_` would avoid to replace the current behavior of `_latex_`. But then, having two different behaviors will be non pedagogical (how to know there is another one). Also, changing the default behavior will lead to problems...\n\nI think it will be easier to add the new module as is and later on, in other tickets, add such `_tikz_` methods in other parts of sage where it makes sense.",
    "created_at": "2021-04-01T10:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277034",
    "user": "slabbe"
}
```

There is no class for `dot strings`. Graphs already have a `_latex_` method which returns a tikz picture string. It is what is used with for instance `view(G)`. The `from_graph` class method really is using `dot2tex` + `graphviz` which is not the same layout sometimes. It is true that maybe adding a `_tikz_` would avoid to replace the current behavior of `_latex_`. But then, having two different behaviors will be non pedagogical (how to know there is another one). Also, changing the default behavior will lead to problems...

I think it will be easier to add the new module as is and later on, in other tickets, add such `_tikz_` methods in other parts of sage where it makes sense.



---

archive/issue_comments_277035.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-04-01T17:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277035",
    "user": "caruso"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_277036.json:
```json
{
    "body": "OK. Let's keep it for another ticket.",
    "created_at": "2021-04-01T17:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277036",
    "user": "caruso"
}
```

OK. Let's keep it for another ticket.



---

archive/issue_comments_277037.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-04-01T17:17:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277037",
    "user": "caruso"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_277038.json:
```json
{
    "body": "please no \"from future import ...\"\n\nReturns should be Return",
    "created_at": "2021-04-01T19:03:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277038",
    "user": "chapoton"
}
```

please no "from future import ..."

Returns should be Return



---

archive/issue_comments_277039.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-04-01T20:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277039",
    "user": "caruso"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_277040.json:
```json
{
    "body": "Also if pdflatex is not installed on the machine, some doctests fail.\nI don't know if this should be fixed but I think so because otherwise patchbots complain.",
    "created_at": "2021-04-01T20:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277040",
    "user": "caruso"
}
```

Also if pdflatex is not installed on the machine, some doctests fail.
I don't know if this should be fixed but I think so because otherwise patchbots complain.



---

archive/issue_comments_277041.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-04-08T08:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277041",
    "user": "slabbe"
}
```

New commits:



---

archive/issue_comments_277042.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-08T08:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277042",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277043.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-08T08:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277043",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277044.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-04-08T08:42:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277044",
    "user": "slabbe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_277045.json:
```json
{
    "body": "I added a bunch of `#optional latex` and `#optional imagemagick` tags. That should fix most of the issues.\n\nI also added one `# optional pdf2svg` for which I am not sure about. I don't know if the doctest framework know about this tag. I change to needs review to check that on the patchbot.",
    "created_at": "2021-04-08T08:42:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277045",
    "user": "slabbe"
}
```

I added a bunch of `#optional latex` and `#optional imagemagick` tags. That should fix most of the issues.

I also added one `# optional pdf2svg` for which I am not sure about. I don't know if the doctest framework know about this tag. I change to needs review to check that on the patchbot.



---

archive/issue_comments_277046.json:
```json
{
    "body": "Why do you make it part of Sage and not an independent Python module? These could easily be declared as optional/standard packages afterwards.",
    "created_at": "2021-04-08T10:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277046",
    "user": "vdelecroix"
}
```

Why do you make it part of Sage and not an independent Python module? These could easily be declared as optional/standard packages afterwards.



---

archive/issue_comments_277047.json:
```json
{
    "body": "Yes, I agree with that option too. Lately, I was thinking more about this option.\n\nBut, the module also depends on many things that are in Sage which would make this module quite unusable outside of sage as it is currently. For example:\n\nTo check if Graphviz is there:\n\n```\nfrom sage.features.graphviz import Graphviz\n```\n\n\nTo check if pdflatex, convert and other programs are available:\n\n```\nfrom sage.misc.latex import have_pdflatex, have_convert, have_program\n```\n\n\nTo load the latex macros from sage:\n\n```\nfrom sage.misc.latex import _Latex_prefs\nfrom sage.misc.latex_macros import sage_latex_macros\n```\n\n\nTo create a temporary file inside the sage folder of temporary files:\n\n```\nfrom sage.misc.temporary_file import tmp_filename\n```\n\n\nTo open viewers:\n\n```\nfrom sage.misc.viewer import browser\nfrom sage.misc.viewer import pdf_viewer\nfrom sage.misc.viewer import png_viewer\n```\n\n\nTo check whether we are in the JupyterNotebook or not:\n\n```\nfrom sage.repl.rich_output.backend_ipython import BackendIPythonNotebook\nfrom sage.repl.rich_output.buffer import OutputBuffer\n```\n",
    "created_at": "2021-04-08T15:26:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277047",
    "user": "slabbe"
}
```

Yes, I agree with that option too. Lately, I was thinking more about this option.

But, the module also depends on many things that are in Sage which would make this module quite unusable outside of sage as it is currently. For example:

To check if Graphviz is there:

```
from sage.features.graphviz import Graphviz
```


To check if pdflatex, convert and other programs are available:

```
from sage.misc.latex import have_pdflatex, have_convert, have_program
```


To load the latex macros from sage:

```
from sage.misc.latex import _Latex_prefs
from sage.misc.latex_macros import sage_latex_macros
```


To create a temporary file inside the sage folder of temporary files:

```
from sage.misc.temporary_file import tmp_filename
```


To open viewers:

```
from sage.misc.viewer import browser
from sage.misc.viewer import pdf_viewer
from sage.misc.viewer import png_viewer
```


To check whether we are in the JupyterNotebook or not:

```
from sage.repl.rich_output.backend_ipython import BackendIPythonNotebook
from sage.repl.rich_output.buffer import OutputBuffer
```




---

archive/issue_comments_277048.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-08T15:35:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277048",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277049.json:
```json
{
    "body": "Replying to [comment:29 slabbe]:\n> Yes, I agree with that option too. Lately, I was thinking more about this option.\n\nThe main advantage with that option is that the package can change versions independently of sage.\n\n> But, the module also depends on many things that are in Sage which would make this module quite unusable outside of sage as it is currently. For example:\n\nThis would be a Python module that depends on sage. There is nothing bad with that situation. And this is not the only one.",
    "created_at": "2021-06-10T17:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277049",
    "user": "vdelecroix"
}
```

Replying to [comment:29 slabbe]:
> Yes, I agree with that option too. Lately, I was thinking more about this option.

The main advantage with that option is that the package can change versions independently of sage.

> But, the module also depends on many things that are in Sage which would make this module quite unusable outside of sage as it is currently. For example:

This would be a Python module that depends on sage. There is nothing bad with that situation. And this is not the only one.



---

archive/issue_comments_277050.json:
```json
{
    "body": "I am thinking about what to do now, either work on this ticket or create a new package. If I create a sagemath-tikzpicture package that imports many parts of sagemath, I will be responsible for fixing the package each time sagemath changes something that I import. On the other hand, if that modules goes into sagemath, then, it will become the responsability of the person which changes the dependencies to also fix the tikzpicture module. I agree with the idea of modularization, but for the above reason, I would prefer to make it go into sage. What do you think?",
    "created_at": "2021-06-24T08:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277050",
    "user": "slabbe"
}
```

I am thinking about what to do now, either work on this ticket or create a new package. If I create a sagemath-tikzpicture package that imports many parts of sagemath, I will be responsible for fixing the package each time sagemath changes something that I import. On the other hand, if that modules goes into sagemath, then, it will become the responsability of the person which changes the dependencies to also fix the tikzpicture module. I agree with the idea of modularization, but for the above reason, I would prefer to make it go into sage. What do you think?



---

archive/issue_comments_277051.json:
```json
{
    "body": "I prefer to have this directly in sage since I think that there are many other places in sage where it would be great to have a tikz output.",
    "created_at": "2021-07-02T15:24:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277051",
    "user": "caruso"
}
```

I prefer to have this directly in sage since I think that there are many other places in sage where it would be great to have a tikz output.



---

archive/issue_comments_277052.json:
```json
{
    "body": "Because this module does not depend on any external libraries, there is nothing gained in the direction of modularization by making this a separate distribution package. \n\nBut perhaps you can find a better place for it than sage.misc? How about `sage.typeset` or `sage.plot`?",
    "created_at": "2021-07-02T15:51:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277052",
    "user": "mkoeppe"
}
```

Because this module does not depend on any external libraries, there is nothing gained in the direction of modularization by making this a separate distribution package. 

But perhaps you can find a better place for it than sage.misc? How about `sage.typeset` or `sage.plot`?



---

archive/issue_comments_277053.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-15T10:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277053",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277054.json:
```json
{
    "body": "I think we are close to it. The doctests work on my machine:\n\n\n```\nsage -t --optional=sage,optional,external --long --show-skipped tikzpicture.py \n```\n\n\ngives\n\n\n```\nUsing --optional=4ti2,ccache,cryptominisat,debian,dot2tex,e_antic,external,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage_numerical_backends_coin,sage_spkg\nExternal software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,rubiks,scilab\nDoctesting 1 file.\nsage -t --long --random-seed=0 tikzpicture.py\n    19 not tested tests not run\n    1 pdf2svg test not run\n    0 tests not run because we ran out of time\n    [161 tests, 15.43 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 15.6 seconds\n    cpu time: 8.2 seconds\n    cumulative wall time: 15.4 seconds\nExternal software detected for doctesting: imagemagick,latex\n```\n\n\nTODO:\n\n- Let's see what the patchbot says.\n- The doctest tagged with `pdf2svg` is not recognized by the `--optional=external`. Maybe something needs to be done on the detection of external packages.\n- One issue is that the current `_rich_repr_` always uses png instead of svg in the Jupyter Notebook even if I define `'svg'` before `'png'` in the `prefer_vector` tuple. I think that issue can be dealt in a later ticket.\n\nThat's it! Needs review!",
    "created_at": "2021-07-15T10:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277054",
    "user": "slabbe"
}
```

I think we are close to it. The doctests work on my machine:


```
sage -t --optional=sage,optional,external --long --show-skipped tikzpicture.py 
```


gives


```
Using --optional=4ti2,ccache,cryptominisat,debian,dot2tex,e_antic,external,fricas,glucose,latte_int,lidia,normaliz,notedown,pandoc_attributes,pip,pycosat,pynormaliz,rst2ipynb,sage,sage_numerical_backends_coin,sage_spkg
External software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,rubiks,scilab
Doctesting 1 file.
sage -t --long --random-seed=0 tikzpicture.py
    19 not tested tests not run
    1 pdf2svg test not run
    0 tests not run because we ran out of time
    [161 tests, 15.43 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 15.6 seconds
    cpu time: 8.2 seconds
    cumulative wall time: 15.4 seconds
External software detected for doctesting: imagemagick,latex
```


TODO:

- Let's see what the patchbot says.
- The doctest tagged with `pdf2svg` is not recognized by the `--optional=external`. Maybe something needs to be done on the detection of external packages.
- One issue is that the current `_rich_repr_` always uses png instead of svg in the Jupyter Notebook even if I define `'svg'` before `'png'` in the `prefer_vector` tuple. I think that issue can be dealt in a later ticket.

That's it! Needs review!



---

archive/issue_comments_277055.json:
```json
{
    "body": "This ad-hoc system package advice \n\n```\n+        if not have_program('pdf2svg'):\n+            raise RuntimeError(\"pdf2svg does not seem to be installed. \"\n+                    \"Install it for example with ``brew install pdf2svg``\"\n+                    \" or ``apt-get install pdf2svg``.\")\n+\n```\n\nshould be replaced by a `Feature` and an spkg `pdf2svg` with `distros/` information from\nhttps://repology.org/project/pdf2svg/versions",
    "created_at": "2021-07-15T16:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277055",
    "user": "mkoeppe"
}
```

This ad-hoc system package advice 

```
+        if not have_program('pdf2svg'):
+            raise RuntimeError("pdf2svg does not seem to be installed. "
+                    "Install it for example with ``brew install pdf2svg``"
+                    " or ``apt-get install pdf2svg``.")
+
```

should be replaced by a `Feature` and an spkg `pdf2svg` with `distros/` information from
https://repology.org/project/pdf2svg/versions



---

archive/issue_comments_277056.json:
```json
{
    "body": "Ok, I will add a Feature for pdf2svg.\n\nAlso, patchbot says this:\n\n```\nsrc/sage/plot/tikzpicture.py:98:1 'subprocess.CalledProcessError' imported but unused\nfound 1 pyflakes errors in the modified files\n```\n\n\nAnother TODO is to allow to get some verbosity useful when compilation of the picture breaks. I am writting it here not to forget.\n\nI will work on that soon or later.",
    "created_at": "2021-07-15T20:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277056",
    "user": "slabbe"
}
```

Ok, I will add a Feature for pdf2svg.

Also, patchbot says this:

```
src/sage/plot/tikzpicture.py:98:1 'subprocess.CalledProcessError' imported but unused
found 1 pyflakes errors in the modified files
```


Another TODO is to allow to get some verbosity useful when compilation of the picture breaks. I am writting it here not to forget.

I will work on that soon or later.



---

archive/issue_comments_277057.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-07-26T18:08:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277057",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_277058.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-11-04T10:56:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277058",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_277059.json:
```json
{
    "body": "I rebased on top of current #32650.\n\nCurrent TODOS are:\n\n- verbosity when compilation breaks\n- add distro info stuff in pdf2svg (should be done in #32650)\n- improve rich repr to use svg not always png",
    "created_at": "2021-11-04T11:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277059",
    "user": "slabbe"
}
```

I rebased on top of current #32650.

Current TODOS are:

- verbosity when compilation breaks
- add distro info stuff in pdf2svg (should be done in #32650)
- improve rich repr to use svg not always png



---

archive/issue_comments_277060.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-04T14:23:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277060",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277061.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-11-04T22:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277061",
    "user": "slabbe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_277062.json:
```json
{
    "body": "With the recent commit and subsequent work done in #32650, the remainings TODOs are:\n\n- improve rich repr to use svg not always png \n\nand as I suggested before, this one could be dealt in another ticket as it is still functional with png's in the Jupyter notebook.\n\nNeeds review!",
    "created_at": "2021-11-04T22:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277062",
    "user": "slabbe"
}
```

With the recent commit and subsequent work done in #32650, the remainings TODOs are:

- improve rich repr to use svg not always png 

and as I suggested before, this one could be dealt in another ticket as it is still functional with png's in the Jupyter notebook.

Needs review!



---

archive/issue_comments_277063.json:
```json
{
    "body": "In a similar direction as comment:17, I think that the `from_graph...` and `from_poset` class methods should rather be changed to methods of `Graph` and `Poset`.",
    "created_at": "2021-11-25T18:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277063",
    "user": "mkoeppe"
}
```

In a similar direction as comment:17, I think that the `from_graph...` and `from_poset` class methods should rather be changed to methods of `Graph` and `Poset`.



---

archive/issue_comments_277064.json:
```json
{
    "body": "Also https://pypi.org/project/tikzplotlib/ looks interesting",
    "created_at": "2021-11-25T18:20:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277064",
    "user": "mkoeppe"
}
```

Also https://pypi.org/project/tikzplotlib/ looks interesting



---

archive/issue_comments_277065.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-09T10:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277065",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277066.json:
```json
{
    "body": "I added two commits to do few improvements.",
    "created_at": "2021-12-09T10:07:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277066",
    "user": "slabbe"
}
```

I added two commits to do few improvements.



---

archive/issue_comments_277067.json:
```json
{
    "body": "Replying to [comment:54 mkoeppe]:\n> In a similar direction as comment:17, I think that the `from_graph...` and `from_poset` class methods should rather be changed to methods of `Graph` and `Poset`.\n\nIf you want to go in that direction, we need to have a design discussion before spending time changing the graph code. As you know,\n\n\n```\nsage: g = graphs.PetersenGraph()\nsage: hasattr(g, '_latex_')\nTrue\n```\n\n\nwhich returns an object of type:\n\n\n```\nsage: type(latex(g))\n<class 'sage.misc.latex.LatexExpr'>\n```\n\n\nThis latex expression starts with `\\begin{tikzpicture}` and ends with `\\end{tikzpicture}` which also depends on `\\usepackage{tkz-graph}`:\n\n\n```\nsage: latex(g)\n\\begin{tikzpicture}                                                                                    \n\\definecolor{cv0}{rgb}{0.0,0.0,0.0}                                                                    \n\\definecolor{cfv0}{rgb}{1.0,1.0,1.0}                                                                   \n...\n\\Edge[lw=0.1cm,style={color=cv6v9,},](v6)(v9)\n\\Edge[lw=0.1cm,style={color=cv7v9,},](v7)(v9)\n%\n\\end{tikzpicture}\n```\n\n\nNotice that this output can be provided to `TikzPicture` with no problem with `t = TikzPicture(latex(g), usepackage=['tkz-graph'])` and `t.pdf()` works etc.\n\nI don't think here we want to replace the output of `g._latex_` by an object of type `TikzPicture` since a such change would break a lot of code.\n\nAn option is to create a new method `def tikz(self)` instead. I can do something like that. It could return the `TikzPicture(latex(g), usepackage=['tkz-graph'])` by default and if one asks, it could use the graphviz + dot2tex output instead. But, I was thinking of doing this in another ticket as a follow up, as this will open discussions that will just make longer before this ticket can go in.\n\nOr maybe you would rather like to remove the `from_graph` and the `from_poset` methods to avoid to have to maintain them in the future? Well, currently, the `from_graph` also allows to merge the multiple edges which is something that would not go in the `tikz` method of a graph. Also, keeping the `from_graph` would make the passage from this module to sage easier for me because I have been using this method over and over and over in my research code.",
    "created_at": "2021-12-09T10:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277067",
    "user": "slabbe"
}
```

Replying to [comment:54 mkoeppe]:
> In a similar direction as comment:17, I think that the `from_graph...` and `from_poset` class methods should rather be changed to methods of `Graph` and `Poset`.

If you want to go in that direction, we need to have a design discussion before spending time changing the graph code. As you know,


```
sage: g = graphs.PetersenGraph()
sage: hasattr(g, '_latex_')
True
```


which returns an object of type:


```
sage: type(latex(g))
<class 'sage.misc.latex.LatexExpr'>
```


This latex expression starts with `\begin{tikzpicture}` and ends with `\end{tikzpicture}` which also depends on `\usepackage{tkz-graph}`:


```
sage: latex(g)
\begin{tikzpicture}                                                                                    
\definecolor{cv0}{rgb}{0.0,0.0,0.0}                                                                    
\definecolor{cfv0}{rgb}{1.0,1.0,1.0}                                                                   
...
\Edge[lw=0.1cm,style={color=cv6v9,},](v6)(v9)
\Edge[lw=0.1cm,style={color=cv7v9,},](v7)(v9)
%
\end{tikzpicture}
```


Notice that this output can be provided to `TikzPicture` with no problem with `t = TikzPicture(latex(g), usepackage=['tkz-graph'])` and `t.pdf()` works etc.

I don't think here we want to replace the output of `g._latex_` by an object of type `TikzPicture` since a such change would break a lot of code.

An option is to create a new method `def tikz(self)` instead. I can do something like that. It could return the `TikzPicture(latex(g), usepackage=['tkz-graph'])` by default and if one asks, it could use the graphviz + dot2tex output instead. But, I was thinking of doing this in another ticket as a follow up, as this will open discussions that will just make longer before this ticket can go in.

Or maybe you would rather like to remove the `from_graph` and the `from_poset` methods to avoid to have to maintain them in the future? Well, currently, the `from_graph` also allows to merge the multiple edges which is something that would not go in the `tikz` method of a graph. Also, keeping the `from_graph` would make the passage from this module to sage easier for me because I have been using this method over and over and over in my research code.



---

archive/issue_comments_277068.json:
```json
{
    "body": "I created ticket #33002 for the addition of a method to return an object of type `TikzPicture` in graph, posets and polyhedron code.",
    "created_at": "2021-12-09T10:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277068",
    "user": "slabbe"
}
```

I created ticket #33002 for the addition of a method to return an object of type `TikzPicture` in graph, posets and polyhedron code.



---

archive/issue_comments_277069.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-09T10:57:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277069",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277070.json:
```json
{
    "body": "Replying to [comment:50 slabbe]:\n> With the recent commit and subsequent work done in #32650, the remainings TODOs are:\n> \n>  - improve rich repr to use svg not always png \n> \n> and as I suggested before, this one could be dealt in another ticket as it is still functional with png's in the Jupyter notebook.\n\nAlso, I want to say that I believe that the `sage.repl` code is broken with respect to showing svg files.\n\n\n```\n# Jupyter cell 1\ng = graphs.PetersenGraph()\nfrom sage.plot.tikzpicture import TikzPicture\nt = TikzPicture(latex(g), usepackage=['tkz-graph'])\nt # works: it shows a png\n```\n\n\n\n```\n# Jupyter cell 2\nfrom sage.repl.rich_output import get_display_manager\ndm = get_display_manager()\nassert dm.preferences.graphics is None\ndm.preferences.graphics = 'raster'\nt  # works: it shows a png\n```\n\n\n\n\n```\n# Jupyter cell 3\ndm.preferences.graphics = 'vector'\nt   # broken: it does not show anything\n```\n\n\nThe following shows that the Jupyter notebook is able to handle a svg correctly:\n\n\n```\n# Jupyter cell 4\nt.svg('a.svg')\nfrom IPython.core.display import SVG\nSVG(filename='a.svg')\n```\n\n\nI suggest to fix the issue with the showing of svg in another ticket.",
    "created_at": "2021-12-09T11:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277070",
    "user": "slabbe"
}
```

Replying to [comment:50 slabbe]:
> With the recent commit and subsequent work done in #32650, the remainings TODOs are:
> 
>  - improve rich repr to use svg not always png 
> 
> and as I suggested before, this one could be dealt in another ticket as it is still functional with png's in the Jupyter notebook.

Also, I want to say that I believe that the `sage.repl` code is broken with respect to showing svg files.


```
# Jupyter cell 1
g = graphs.PetersenGraph()
from sage.plot.tikzpicture import TikzPicture
t = TikzPicture(latex(g), usepackage=['tkz-graph'])
t # works: it shows a png
```



```
# Jupyter cell 2
from sage.repl.rich_output import get_display_manager
dm = get_display_manager()
assert dm.preferences.graphics is None
dm.preferences.graphics = 'raster'
t  # works: it shows a png
```




```
# Jupyter cell 3
dm.preferences.graphics = 'vector'
t   # broken: it does not show anything
```


The following shows that the Jupyter notebook is able to handle a svg correctly:


```
# Jupyter cell 4
t.svg('a.svg')
from IPython.core.display import SVG
SVG(filename='a.svg')
```


I suggest to fix the issue with the showing of svg in another ticket.



---

archive/issue_comments_277071.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-09T17:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277071",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277072.json:
```json
{
    "body": "Replying to [comment:58 slabbe]:\n> Replying to [comment:54 mkoeppe]:\n> > In a similar direction as comment:17, I think that the `from_graph...` and `from_poset` class methods should rather be changed to methods of `Graph` and `Poset`.\n\n> I don't think here we want to replace the output of `g._latex_` by an object of type `TikzPicture` since a such change would break a lot of code.\n\nI agree\n\n> An option is to create a new method `def tikz(self)` instead. I can do something like that.\n\nYes, this is what I meant",
    "created_at": "2021-12-09T18:44:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277072",
    "user": "mkoeppe"
}
```

Replying to [comment:58 slabbe]:
> Replying to [comment:54 mkoeppe]:
> > In a similar direction as comment:17, I think that the `from_graph...` and `from_poset` class methods should rather be changed to methods of `Graph` and `Poset`.

> I don't think here we want to replace the output of `g._latex_` by an object of type `TikzPicture` since a such change would break a lot of code.

I agree

> An option is to create a new method `def tikz(self)` instead. I can do something like that.

Yes, this is what I meant



---

archive/issue_comments_277073.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-01-04T13:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277073",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_277074.json:
```json
{
    "body": "There was a syntax error in the file due to the previous commit. I fixed that.\n\nI also rebased the branch on top of 9.5.beta9.",
    "created_at": "2022-01-04T13:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277074",
    "user": "slabbe"
}
```

There was a syntax error in the file due to the previous commit. I fixed that.

I also rebased the branch on top of 9.5.beta9.



---

archive/issue_comments_277075.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-04T13:35:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277075",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277076.json:
```json
{
    "body": "I confirm it works on my side:\n\n\n```\n$ sage -t tikzpicture.py \n[...]\nDoctesting 1 file.\nsage -t --random-seed=33963620693510224516081799230454604818 tikzpicture.py\n    [158 tests, 4.59 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nFeatures detected for doctesting: \n```\n\nand\n\n```\n$ sage -t --show-skipped --long --optional=sage,optional,external tikzpicture.py \n[...]\nDoctesting 1 file.\nsage -t --long --random-seed=204572532264437349038334999704478431314 tikzpicture.py\n    24 not tested tests not run\n    2 pdftocairo tests not run\n    0 tests not run because we ran out of time\n    [188 tests, 15.97 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nFeatures detected for doctesting: imagemagick,latex,pdf2svg\n```\n",
    "created_at": "2022-01-04T13:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277076",
    "user": "slabbe"
}
```

I confirm it works on my side:


```
$ sage -t tikzpicture.py 
[...]
Doctesting 1 file.
sage -t --random-seed=33963620693510224516081799230454604818 tikzpicture.py
    [158 tests, 4.59 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Features detected for doctesting: 
```

and

```
$ sage -t --show-skipped --long --optional=sage,optional,external tikzpicture.py 
[...]
Doctesting 1 file.
sage -t --long --random-seed=204572532264437349038334999704478431314 tikzpicture.py
    24 not tested tests not run
    2 pdftocairo tests not run
    0 tests not run because we ran out of time
    [188 tests, 15.97 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Features detected for doctesting: imagemagick,latex,pdf2svg
```




---

archive/issue_comments_277077.json:
```json
{
    "body": "Attachment [tikz-jupyter-demo.png](tarball://root/attachments/some-uuid/ticket20343/tikz-jupyter-demo.png) by slabbe created at 2022-01-04 13:57:12",
    "created_at": "2022-01-04T13:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277077",
    "user": "slabbe"
}
```

Attachment [tikz-jupyter-demo.png](tarball://root/attachments/some-uuid/ticket20343/tikz-jupyter-demo.png) by slabbe created at 2022-01-04 13:57:12



---

archive/issue_comments_277078.json:
```json
{
    "body": "Updating the description: adding a screenshot of the behavior in Jupyter, hoping it motivates someone to review the ticket.",
    "created_at": "2022-01-04T14:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277078",
    "user": "slabbe"
}
```

Updating the description: adding a screenshot of the behavior in Jupyter, hoping it motivates someone to review the ticket.



---

archive/issue_comments_277079.json:
```json
{
    "body": "Why this default `usepackage=['amsmath']`?",
    "created_at": "2022-01-05T16:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277079",
    "user": "vdelecroix"
}
```

Why this default `usepackage=['amsmath']`?



---

archive/issue_comments_277080.json:
```json
{
    "body": "Moreover, you should **never** have a list as a default argument which is plugged as an attribute\n\n```\nsage: class A():\n....:     def __init__(self, a=[]):\n....:         self.a = a\nsage: x = A()\nsage: x.a.append(2)\nsage: y = A()\nsage: y.a\n[2]\n```\n",
    "created_at": "2022-01-05T16:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277080",
    "user": "vdelecroix"
}
```

Moreover, you should **never** have a list as a default argument which is plugged as an attribute

```
sage: class A():
....:     def __init__(self, a=[]):
....:         self.a = a
sage: x = A()
sage: x.a.append(2)
sage: y = A()
sage: y.a
[2]
```




---

archive/issue_comments_277081.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-05T18:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277081",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277082.json:
```json
{
    "body": "You are right. I also avoided the usage of `shell=True` for security reasons, see https://docs.python.org/3/library/subprocess.html#security-considerations\n\nDoing so, the `cmd` needs to be a list and not a string. This is better also because it allows filenames to contain spaces: *\"Providing a sequence of arguments is generally preferred, as it allows the module to take care of any required escaping and quoting of arguments (e.g. to permit spaces in file names)\"*, see https://docs.python.org/3/library/subprocess.html#frequently-used-arguments",
    "created_at": "2022-01-05T18:06:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277082",
    "user": "slabbe"
}
```

You are right. I also avoided the usage of `shell=True` for security reasons, see https://docs.python.org/3/library/subprocess.html#security-considerations

Doing so, the `cmd` needs to be a list and not a string. This is better also because it allows filenames to contain spaces: *"Providing a sequence of arguments is generally preferred, as it allows the module to take care of any required escaping and quoting of arguments (e.g. to permit spaces in file names)"*, see https://docs.python.org/3/library/subprocess.html#frequently-used-arguments



---

archive/issue_comments_277083.json:
```json
{
    "body": "Replying to [comment:77 slabbe]:\n> [...]\n> This is better also because it allows filenames to contain spaces\n> [...]\n\nIf `'m y p i c t u r e.pdf'` is an explicitely supported filename, it would make sense to mention it and test it. If it is an obscure feature, nevermind.",
    "created_at": "2022-01-05T18:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277083",
    "user": "vdelecroix"
}
```

Replying to [comment:77 slabbe]:
> [...]
> This is better also because it allows filenames to contain spaces
> [...]

If `'m y p i c t u r e.pdf'` is an explicitely supported filename, it would make sense to mention it and test it. If it is an obscure feature, nevermind.



---

archive/issue_comments_277084.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-05T20:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277084",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277085.json:
```json
{
    "body": "Replying to [comment:78 vdelecroix]:\n> If `'m y p i c t u r e.pdf'` is an explicitely supported filename, it would make sense to mention it and test it. If it is an obscure feature, nevermind.\n\nYes, why not. I added a doctest confirming it works.\n\nI also added a missing long doctest tag.\n\nNeeds review!",
    "created_at": "2022-01-05T20:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277085",
    "user": "slabbe"
}
```

Replying to [comment:78 vdelecroix]:
> If `'m y p i c t u r e.pdf'` is an explicitely supported filename, it would make sense to mention it and test it. If it is an obscure feature, nevermind.

Yes, why not. I added a doctest confirming it works.

I also added a missing long doctest tag.

Needs review!



---

archive/issue_comments_277086.json:
```json
{
    "body": "There is a time window right now for this ticket to get into sage-9.5 maybe within the first rc.\n\nThe patchbots are green. I will be available in the next days to fix quickly any remaining issues.",
    "created_at": "2022-01-06T11:16:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277086",
    "user": "slabbe"
}
```

There is a time window right now for this ticket to get into sage-9.5 maybe within the first rc.

The patchbots are green. I will be available in the next days to fix quickly any remaining issues.



---

archive/issue_comments_277087.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-01-06T18:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277087",
    "user": "vdelecroix"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_277088.json:
```json
{
    "body": "Thank you!! I was holding by breathe since 6 years!\n\nI will add a nice section in the release notes if it makes it in 9.5.",
    "created_at": "2022-01-06T18:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277088",
    "user": "slabbe"
}
```

Thank you!! I was holding by breathe since 6 years!

I will add a nice section in the release notes if it makes it in 9.5.



---

archive/issue_comments_277089.json:
```json
{
    "body": "\n```\n**********************************************************************\nFile \"src/sage/plot/tikzpicture.py\", line 73, in sage.plot.tikzpicture\nFailed example:\n    _ = t.png(view=False)      # long time (2s) # optional imagemagick\nException raised:\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.plot.tikzpicture[14]>\", line 1, in <module>\n        _ = t.png(view=False)      # long time (2s) # optional imagemagick\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/plot/tikzpicture.py\", line 505, in png\n        _filename_pdf = self.pdf(filename=None, view=False)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/plot/tikzpicture.py\", line 443, in pdf\n        result.check_returncode()\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/subprocess.py\", line 460, in check_returncode\n        raise CalledProcessError(self.returncode, self.args, self.stdout,\n    subprocess.CalledProcessError: Command '['lualatex', '-interaction=nonstopmode', 'tikz_544oxd7o.tex']' returned non-zero exit status 1.\n**********************************************************************\nFile \"src/sage/plot/tikzpicture.py\", line 494, in sage.plot.tikzpicture.StandaloneTex.png\nFailed example:\n    path_to_file = t.png(filename) # long time (2s)   # optional imagemagick\nException raised:\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.plot.tikzpicture.StandaloneTex.png[7]>\", line 1, in <module>\n        path_to_file = t.png(filename) # long time (2s)   # optional imagemagick\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/plot/tikzpicture.py\", line 505, in png\n        _filename_pdf = self.pdf(filename=None, view=False)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/plot/tikzpicture.py\", line 443, in pdf\n        result.check_returncode()\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/subprocess.py\", line 460, in check_returncode\n        raise CalledProcessError(self.returncode, self.args, self.stdout,\n    subprocess.CalledProcessError: Command '['lualatex', '-interaction=nonstopmode', 'tikz_ikxvujw2.tex']' returned non-zero exit status 1.\n**********************************************************************\nFile \"src/sage/plot/tikzpicture.py\", line 495, in sage.plot.tikzpicture.StandaloneTex.png\nFailed example:\n    path_to_file[-4:]              # long time (fast) # optional imagemagick\nException raised:\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.plot.tikzpicture.StandaloneTex.png[8]>\", line 1, in <module>\n        path_to_file[-Integer(4):]              # long time (fast) # optional imagemagick\n    NameError: name 'path_to_file' is not defined\n**********************************************************************\nFile \"src/sage/plot/tikzpicture.py\", line 579, in sage.plot.tikzpicture.StandaloneTex.svg\nFailed example:\n    path_to_file = t.svg(filename, program='pdftocairo') # long time (2s)   # optional pdftocairo\nException raised:\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.plot.tikzpicture.StandaloneTex.svg[7]>\", line 1, in <module>\n        path_to_file = t.svg(filename, program='pdftocairo') # long time (2s)   # optional pdftocairo\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/plot/tikzpicture.py\", line 588, in svg\n        _filename_pdf = self.pdf(filename=None, view=False)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/plot/tikzpicture.py\", line 443, in pdf\n        result.check_returncode()\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/subprocess.py\", line 460, in check_returncode\n        raise CalledProcessError(self.returncode, self.args, self.stdout,\n    subprocess.CalledProcessError: Command '['lualatex', '-interaction=nonstopmode', 'tikz_o2ho82xz.tex']' returned non-zero exit status 1.\n**********************************************************************\nFile \"src/sage/plot/tikzpicture.py\", line 580, in sage.plot.tikzpicture.StandaloneTex.svg\nFailed example:\n    path_to_file[-4:]                                    # long time (fast) # optional pdftocairo\nException raised:\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.plot.tikzpicture.StandaloneTex.svg[8]>\", line 1, in <module>\n        path_to_file[-Integer(4):]                                    # long time (fast) # optional pdftocairo\n    NameError: name 'path_to_file' is not defined\n**********************************************************************\n```\n",
    "created_at": "2022-02-13T00:28:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277089",
    "user": "vbraun"
}
```


```
**********************************************************************
File "src/sage/plot/tikzpicture.py", line 73, in sage.plot.tikzpicture
Failed example:
    _ = t.png(view=False)      # long time (2s) # optional imagemagick
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.plot.tikzpicture[14]>", line 1, in <module>
        _ = t.png(view=False)      # long time (2s) # optional imagemagick
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/plot/tikzpicture.py", line 505, in png
        _filename_pdf = self.pdf(filename=None, view=False)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/plot/tikzpicture.py", line 443, in pdf
        result.check_returncode()
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/subprocess.py", line 460, in check_returncode
        raise CalledProcessError(self.returncode, self.args, self.stdout,
    subprocess.CalledProcessError: Command '['lualatex', '-interaction=nonstopmode', 'tikz_544oxd7o.tex']' returned non-zero exit status 1.
**********************************************************************
File "src/sage/plot/tikzpicture.py", line 494, in sage.plot.tikzpicture.StandaloneTex.png
Failed example:
    path_to_file = t.png(filename) # long time (2s)   # optional imagemagick
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.plot.tikzpicture.StandaloneTex.png[7]>", line 1, in <module>
        path_to_file = t.png(filename) # long time (2s)   # optional imagemagick
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/plot/tikzpicture.py", line 505, in png
        _filename_pdf = self.pdf(filename=None, view=False)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/plot/tikzpicture.py", line 443, in pdf
        result.check_returncode()
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/subprocess.py", line 460, in check_returncode
        raise CalledProcessError(self.returncode, self.args, self.stdout,
    subprocess.CalledProcessError: Command '['lualatex', '-interaction=nonstopmode', 'tikz_ikxvujw2.tex']' returned non-zero exit status 1.
**********************************************************************
File "src/sage/plot/tikzpicture.py", line 495, in sage.plot.tikzpicture.StandaloneTex.png
Failed example:
    path_to_file[-4:]              # long time (fast) # optional imagemagick
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.plot.tikzpicture.StandaloneTex.png[8]>", line 1, in <module>
        path_to_file[-Integer(4):]              # long time (fast) # optional imagemagick
    NameError: name 'path_to_file' is not defined
**********************************************************************
File "src/sage/plot/tikzpicture.py", line 579, in sage.plot.tikzpicture.StandaloneTex.svg
Failed example:
    path_to_file = t.svg(filename, program='pdftocairo') # long time (2s)   # optional pdftocairo
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.plot.tikzpicture.StandaloneTex.svg[7]>", line 1, in <module>
        path_to_file = t.svg(filename, program='pdftocairo') # long time (2s)   # optional pdftocairo
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/plot/tikzpicture.py", line 588, in svg
        _filename_pdf = self.pdf(filename=None, view=False)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/plot/tikzpicture.py", line 443, in pdf
        result.check_returncode()
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/subprocess.py", line 460, in check_returncode
        raise CalledProcessError(self.returncode, self.args, self.stdout,
    subprocess.CalledProcessError: Command '['lualatex', '-interaction=nonstopmode', 'tikz_o2ho82xz.tex']' returned non-zero exit status 1.
**********************************************************************
File "src/sage/plot/tikzpicture.py", line 580, in sage.plot.tikzpicture.StandaloneTex.svg
Failed example:
    path_to_file[-4:]                                    # long time (fast) # optional pdftocairo
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.plot.tikzpicture.StandaloneTex.svg[8]>", line 1, in <module>
        path_to_file[-Integer(4):]                                    # long time (fast) # optional pdftocairo
    NameError: name 'path_to_file' is not defined
**********************************************************************
```




---

archive/issue_comments_277090.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-02-13T00:28:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277090",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_277091.json:
```json
{
    "body": "Indeed, the failures show that when latex is not installed, there are missing optional `latex` tags. Sorry Volker.",
    "created_at": "2022-02-13T17:48:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277091",
    "user": "slabbe"
}
```

Indeed, the failures show that when latex is not installed, there are missing optional `latex` tags. Sorry Volker.



---

archive/issue_comments_277092.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-02-17T09:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277092",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_277093.json:
```json
{
    "body": "Added the missing latex tag. Also rebased on 9.6.beta1.",
    "created_at": "2022-02-17T09:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277093",
    "user": "slabbe"
}
```

Added the missing latex tag. Also rebased on 9.6.beta1.



---

archive/issue_comments_277094.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-02-17T09:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277094",
    "user": "slabbe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_277095.json:
```json
{
    "body": "Why not using `else` here\n\n```\n+        if program == 'pdflatex':\n+            pdflatex().require()\n+        elif program == 'lualatex':\n+            lualatex().require()\n+        elif program not in ['pdflatex','lualatex']:\n+            raise ValueError(\"program(={}) should be pdflatex or lualatex\".format(program))\n```\n",
    "created_at": "2022-02-19T09:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277095",
    "user": "vdelecroix"
}
```

Why not using `else` here

```
+        if program == 'pdflatex':
+            pdflatex().require()
+        elif program == 'lualatex':
+            lualatex().require()
+        elif program not in ['pdflatex','lualatex']:
+            raise ValueError("program(={}) should be pdflatex or lualatex".format(program))
```




---

archive/issue_comments_277096.json:
```json
{
    "body": "Why do you prefix `filename_png`, `filename_pdf`, etc with an additional underscore, ie `_filename_png`, `_filename_pdf`?",
    "created_at": "2022-02-19T09:17:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277096",
    "user": "vdelecroix"
}
```

Why do you prefix `filename_png`, `filename_pdf`, etc with an additional underscore, ie `_filename_png`, `_filename_pdf`?



---

archive/issue_comments_277097.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-22T08:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277097",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277098.json:
```json
{
    "body": "Replying to [comment:90 vdelecroix]:\n> Why not using `else` here\n\nYou are right. I don't know why I did not use else. I added a commit to fix that.",
    "created_at": "2022-02-22T08:47:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277098",
    "user": "slabbe"
}
```

Replying to [comment:90 vdelecroix]:
> Why not using `else` here

You are right. I don't know why I did not use else. I added a commit to fix that.



---

archive/issue_comments_277099.json:
```json
{
    "body": "Replying to [comment:91 vdelecroix]:\n> Why do you prefix `filename_png`, `filename_pdf`, etc with an additional underscore, ie `_filename_png`, `_filename_pdf`?\n\nThe reason is to distinguish the variable `filename` (input given from the user) from the variable `_filename` (name of a temporary file created by the method). See the code of the method `svg` where both `filename` and `_filename` are used. For consistency, the same principle is used in all methods.\n\nNeeds review!",
    "created_at": "2022-02-22T08:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277099",
    "user": "slabbe"
}
```

Replying to [comment:91 vdelecroix]:
> Why do you prefix `filename_png`, `filename_pdf`, etc with an additional underscore, ie `_filename_png`, `_filename_pdf`?

The reason is to distinguish the variable `filename` (input given from the user) from the variable `_filename` (name of a temporary file created by the method). See the code of the method `svg` where both `filename` and `_filename` are used. For consistency, the same principle is used in all methods.

Needs review!



---

archive/issue_comments_277100.json:
```json
{
    "body": "Replying to [comment:94 slabbe]:\n> Replying to [comment:91 vdelecroix]:\n> > Why do you prefix `filename_png`, `filename_pdf`, etc with an additional underscore, ie `_filename_png`, `_filename_pdf`?\n> \n> The reason is to distinguish the variable `filename` (input given from the user) from the variable `_filename` (name of a temporary file created by the method). See the code of the method `svg` where both `filename` and `_filename` are used. For consistency, the same principle is used in all methods.\n> \n> Needs review!\n\nInstead of the very unconventional `_filename` variable name you would better use `temporary_filename`, `temporary_filename_tex`, `temporary_filename_pdf`, etc.",
    "created_at": "2022-02-22T09:26:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277100",
    "user": "vdelecroix"
}
```

Replying to [comment:94 slabbe]:
> Replying to [comment:91 vdelecroix]:
> > Why do you prefix `filename_png`, `filename_pdf`, etc with an additional underscore, ie `_filename_png`, `_filename_pdf`?
> 
> The reason is to distinguish the variable `filename` (input given from the user) from the variable `_filename` (name of a temporary file created by the method). See the code of the method `svg` where both `filename` and `_filename` are used. For consistency, the same principle is used in all methods.
> 
> Needs review!

Instead of the very unconventional `_filename` variable name you would better use `temporary_filename`, `temporary_filename_tex`, `temporary_filename_pdf`, etc.



---

archive/issue_comments_277101.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-22T14:15:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277101",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277102.json:
```json
{
    "body": "Replying to [comment:95 vdelecroix]:\n> Instead of the very unconventional `_filename` variable name you would better use `temporary_filename`, `temporary_filename_tex`, `temporary_filename_pdf`, etc.\n\nOk, I renamed it as `s/_filename/temp_filename/g`.\n\nNeeds review!",
    "created_at": "2022-02-22T14:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277102",
    "user": "slabbe"
}
```

Replying to [comment:95 vdelecroix]:
> Instead of the very unconventional `_filename` variable name you would better use `temporary_filename`, `temporary_filename_tex`, `temporary_filename_pdf`, etc.

Ok, I renamed it as `s/_filename/temp_filename/g`.

Needs review!



---

archive/issue_comments_277103.json:
```json
{
    "body": "Instead of `from_graph`, `from_poset`, ... wouldn't it make more sense to have `Graph.tikz()`, `Poset.tikz()`, etc? In the former design the `TikzPicture` code would end up with a ton of methods dealing with various specific objects.",
    "created_at": "2022-02-22T14:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277103",
    "user": "vdelecroix"
}
```

Instead of `from_graph`, `from_poset`, ... wouldn't it make more sense to have `Graph.tikz()`, `Poset.tikz()`, etc? In the former design the `TikzPicture` code would end up with a ton of methods dealing with various specific objects.



---

archive/issue_comments_277104.json:
```json
{
    "body": "Or alternatively: `__tikz__()` if you want to hide it.",
    "created_at": "2022-02-22T14:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277104",
    "user": "vdelecroix"
}
```

Or alternatively: `__tikz__()` if you want to hide it.



---

archive/issue_comments_277105.json:
```json
{
    "body": "See comment:17 :-)",
    "created_at": "2022-02-22T14:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277105",
    "user": "caruso"
}
```

See comment:17 :-)



---

archive/issue_comments_277106.json:
```json
{
    "body": "I agree with Xavier ! The current branch proposes to make `TikzPicture.from_XXX` the default conversion function. If the design is wrong, better to change it now than in a hypothetical future.",
    "created_at": "2022-02-22T14:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277106",
    "user": "vdelecroix"
}
```

I agree with Xavier ! The current branch proposes to make `TikzPicture.from_XXX` the default conversion function. If the design is wrong, better to change it now than in a hypothetical future.



---

archive/issue_comments_277107.json:
```json
{
    "body": "Replying to [comment:101 vdelecroix]:\n> I agree with Xavier ! The current branch proposes to make `TikzPicture.from_XXX` the default conversion function. If the design is wrong, better to change it now than in a hypothetical future.\n\nSee also comment:54 from mkoeppe who suggested the same thing.\n\nThen, please read follow-up comment:58, and answer to my answer in comment:58.",
    "created_at": "2022-02-22T14:48:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277107",
    "user": "slabbe"
}
```

Replying to [comment:101 vdelecroix]:
> I agree with Xavier ! The current branch proposes to make `TikzPicture.from_XXX` the default conversion function. If the design is wrong, better to change it now than in a hypothetical future.

See also comment:54 from mkoeppe who suggested the same thing.

Then, please read follow-up comment:58, and answer to my answer in comment:58.



---

archive/issue_comments_277108.json:
```json
{
    "body": "Ideally, `TikzPicture` should inherit from `LatexExpr` so that returning a `TikzPicture` from a `_latex_` method would not be a breaking change.\n\nFor the purpose of merging this ticket quickly, the simplest way out is to move the `from_XXX` as private standalone functions `def _from_XXX` and stating explicitely that these are just demo functions that will be removed in the future.",
    "created_at": "2022-02-22T14:54:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277108",
    "user": "vdelecroix"
}
```

Ideally, `TikzPicture` should inherit from `LatexExpr` so that returning a `TikzPicture` from a `_latex_` method would not be a breaking change.

For the purpose of merging this ticket quickly, the simplest way out is to move the `from_XXX` as private standalone functions `def _from_XXX` and stating explicitely that these are just demo functions that will be removed in the future.



---

archive/issue_comments_277109.json:
```json
{
    "body": "Replying to [comment:103 vdelecroix]:\n> Ideally, `TikzPicture` should inherit from `LatexExpr` so that returning a `TikzPicture` from a `_latex_` method would not be a breaking change.\n\nWell, `LatexExpr` already inherits from the Python class `str` which makes it full of methods that, as a user, I don't want to see in the list of methods seen with tab-completion on an object of type `TikzPicture`.\n\n> For the purpose of merging this ticket quickly, the simplest way out is to move the `from_XXX` as private standalone functions `def _from_XXX` and stating explicitely that these are just demo functions that will be removed in the future.\n\nOk, let me think about that again, maybe this Thursday at Bordeaux Sage Thursdays, we can discuss this and converge to choices on how this is done for graphs (`tkz-berge` vs graphviz + dot2tex) and for polytopes (the actual `tikz()` method vs a new `tikz()` or `__tikz__()` method).",
    "created_at": "2022-02-22T15:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277109",
    "user": "slabbe"
}
```

Replying to [comment:103 vdelecroix]:
> Ideally, `TikzPicture` should inherit from `LatexExpr` so that returning a `TikzPicture` from a `_latex_` method would not be a breaking change.

Well, `LatexExpr` already inherits from the Python class `str` which makes it full of methods that, as a user, I don't want to see in the list of methods seen with tab-completion on an object of type `TikzPicture`.

> For the purpose of merging this ticket quickly, the simplest way out is to move the `from_XXX` as private standalone functions `def _from_XXX` and stating explicitely that these are just demo functions that will be removed in the future.

Ok, let me think about that again, maybe this Thursday at Bordeaux Sage Thursdays, we can discuss this and converge to choices on how this is done for graphs (`tkz-berge` vs graphviz + dot2tex) and for polytopes (the actual `tikz()` method vs a new `tikz()` or `__tikz__()` method).



---

archive/issue_comments_277110.json:
```json
{
    "body": "Replying to [comment:103 vdelecroix]:\n> For the purpose of merging this ticket quickly, the simplest way out is to move the `from_XXX` as private standalone functions `def _from_XXX` and stating explicitely that these are just demo functions that will be removed in the future.\n\nThere are four such methods right now:\n\n```\n    def from_dot_string(cls, dotdata, prog='dot'):\n    def from_graph(cls, graph, merge_multiedges=True,\n    def from_graph_with_pos(cls, graph, scale=1, merge_multiedges=True,\n    def from_poset(cls, poset, **kwds):\n```\n\n\nAs you suggest, I can change those taking a graph or a poset sage object into a private method:\n\n```\n    def from_dot_string(cls, dotdata, prog='dot'):\n    def _from_graph(cls, graph, merge_multiedges=True,\n    def _from_graph_with_pos(cls, graph, scale=1, merge_multiedges=True,\n    def _from_poset(cls, poset, **kwds):\n```\n\n\nBut, there is no sage object for a dot string. So, do I keep `from_dot_string` as it is or do you want me to make it private as well?",
    "created_at": "2022-02-22T16:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277110",
    "user": "slabbe"
}
```

Replying to [comment:103 vdelecroix]:
> For the purpose of merging this ticket quickly, the simplest way out is to move the `from_XXX` as private standalone functions `def _from_XXX` and stating explicitely that these are just demo functions that will be removed in the future.

There are four such methods right now:

```
    def from_dot_string(cls, dotdata, prog='dot'):
    def from_graph(cls, graph, merge_multiedges=True,
    def from_graph_with_pos(cls, graph, scale=1, merge_multiedges=True,
    def from_poset(cls, poset, **kwds):
```


As you suggest, I can change those taking a graph or a poset sage object into a private method:

```
    def from_dot_string(cls, dotdata, prog='dot'):
    def _from_graph(cls, graph, merge_multiedges=True,
    def _from_graph_with_pos(cls, graph, scale=1, merge_multiedges=True,
    def _from_poset(cls, poset, **kwds):
```


But, there is no sage object for a dot string. So, do I keep `from_dot_string` as it is or do you want me to make it private as well?



---

archive/issue_comments_277111.json:
```json
{
    "body": "Replying to [comment:105 slabbe]:\n> Replying to [comment:103 vdelecroix]:\n> > For the purpose of merging this ticket quickly, the simplest way out is to move the `from_XXX` as private standalone functions `def _from_XXX` and stating explicitely that these are just demo functions that will be removed in the future.\n> \n> There are four such methods right now:\n> {{{\n>     def from_dot_string(cls, dotdata, prog='dot'):\n>     def from_graph(cls, graph, merge_multiedges=True,\n>     def from_graph_with_pos(cls, graph, scale=1, merge_multiedges=True,\n>     def from_poset(cls, poset, **kwds):\n> }}}\n> \n> As you suggest, I can change those taking a graph or a poset sage object into a private method:\n> {{{\n>     def from_dot_string(cls, dotdata, prog='dot'):\n>     def _from_graph(cls, graph, merge_multiedges=True,\n>     def _from_graph_with_pos(cls, graph, scale=1, merge_multiedges=True,\n>     def _from_poset(cls, poset, **kwds):\n> }}}\n> \n> But, there is no sage object for a dot string. So, do I keep `from_dot_string` as it is or do you want me to make it private as well?\n\nIt should be fine to keep `from_dot_string`.\n\nThe only reason to make the three others private is to avoid that sage users rely on them. They will be changed without notice.",
    "created_at": "2022-02-22T16:40:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277111",
    "user": "vdelecroix"
}
```

Replying to [comment:105 slabbe]:
> Replying to [comment:103 vdelecroix]:
> > For the purpose of merging this ticket quickly, the simplest way out is to move the `from_XXX` as private standalone functions `def _from_XXX` and stating explicitely that these are just demo functions that will be removed in the future.
> 
> There are four such methods right now:
> {{{
>     def from_dot_string(cls, dotdata, prog='dot'):
>     def from_graph(cls, graph, merge_multiedges=True,
>     def from_graph_with_pos(cls, graph, scale=1, merge_multiedges=True,
>     def from_poset(cls, poset, **kwds):
> }}}
> 
> As you suggest, I can change those taking a graph or a poset sage object into a private method:
> {{{
>     def from_dot_string(cls, dotdata, prog='dot'):
>     def _from_graph(cls, graph, merge_multiedges=True,
>     def _from_graph_with_pos(cls, graph, scale=1, merge_multiedges=True,
>     def _from_poset(cls, poset, **kwds):
> }}}
> 
> But, there is no sage object for a dot string. So, do I keep `from_dot_string` as it is or do you want me to make it private as well?

It should be fine to keep `from_dot_string`.

The only reason to make the three others private is to avoid that sage users rely on them. They will be changed without notice.



---

archive/issue_comments_277112.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-23T20:31:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277112",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277113.json:
```json
{
    "body": "Replying to [comment:106 vdelecroix]:\n> It should be fine to keep `from_dot_string`.\n> \n> The only reason to make the three others private is to avoid that sage users rely on them. They will be changed without notice.\n\nOk, I did that. Needs review.",
    "created_at": "2022-02-23T20:32:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277113",
    "user": "slabbe"
}
```

Replying to [comment:106 vdelecroix]:
> It should be fine to keep `from_dot_string`.
> 
> The only reason to make the three others private is to avoid that sage users rely on them. They will be changed without notice.

Ok, I did that. Needs review.



---

archive/issue_comments_277114.json:
```json
{
    "body": "It would be better not to advertize them in the module docstring\n\n```diff\n- If dot2tex Sage optional package and graphviz are installed, then the following\n- one liner works allowing to create a nice tikzpicture from a graph with\n- vertices and edges placed according to graphviz::\n-\n-    sage: t = TikzPicture._from_graph(g)  # optional: dot2tex # long time (3s)\n-\n```\n\n\nAnd you can add a sentence explaining the transducer example that comes after.",
    "created_at": "2022-02-24T06:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277114",
    "user": "vdelecroix"
}
```

It would be better not to advertize them in the module docstring

```diff
- If dot2tex Sage optional package and graphviz are installed, then the following
- one liner works allowing to create a nice tikzpicture from a graph with
- vertices and edges placed according to graphviz::
-
-    sage: t = TikzPicture._from_graph(g)  # optional: dot2tex # long time (3s)
-
```


And you can add a sentence explaining the transducer example that comes after.



---

archive/issue_comments_277115.json:
```json
{
    "body": "I would also add a sentence somewhere in the module docstring about the fact that tikz is a latex package (called `pgf-tikz` by the way) and a reference to the page https://www.ctan.org/pkg/pgf. You sort of assume that everybody knows tikz which is not a reasonable assumption.",
    "created_at": "2022-02-24T06:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277115",
    "user": "vdelecroix"
}
```

I would also add a sentence somewhere in the module docstring about the fact that tikz is a latex package (called `pgf-tikz` by the way) and a reference to the page https://www.ctan.org/pkg/pgf. You sort of assume that everybody knows tikz which is not a reasonable assumption.



---

archive/issue_comments_277116.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-02-24T10:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277116",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_277117.json:
```json
{
    "body": "I rebased the branch on 9.6.beta2. No new commit for now.",
    "created_at": "2022-02-24T10:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277117",
    "user": "slabbe"
}
```

I rebased the branch on 9.6.beta2. No new commit for now.



---

archive/issue_comments_277118.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-24T10:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277118",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277119.json:
```json
{
    "body": "The following reference will not work `:mod:`sage.misc.latex.py`` (you need to remove the `.py`).",
    "created_at": "2022-02-24T10:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277119",
    "user": "vdelecroix"
}
```

The following reference will not work `:mod:`sage.misc.latex.py`` (you need to remove the `.py`).



---

archive/issue_comments_277120.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-24T10:30:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277120",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277121.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-24T10:31:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277121",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277122.json:
```json
{
    "body": "Needs review!",
    "created_at": "2022-02-24T10:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277122",
    "user": "slabbe"
}
```

Needs review!



---

archive/issue_comments_277123.json:
```json
{
    "body": "pycodestyle is broken as it does not detect the prefix `r` in front of the string...\n\n```\nsrc/sage/plot/tikzpicture.py:258:34: W605 invalid escape sequence '\\d'\nsrc/sage/plot/tikzpicture.py:259:34: W605 invalid escape sequence '\\e'\n```\n",
    "created_at": "2022-02-24T14:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277123",
    "user": "vdelecroix"
}
```

pycodestyle is broken as it does not detect the prefix `r` in front of the string...

```
src/sage/plot/tikzpicture.py:258:34: W605 invalid escape sequence '\d'
src/sage/plot/tikzpicture.py:259:34: W605 invalid escape sequence '\e'
```




---

archive/issue_comments_277124.json:
```json
{
    "body": "Your module does not seem to be included in the reference manual. You have to add an entry to `src/doc/en/reference/misc/index.rst`.",
    "created_at": "2022-02-24T14:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277124",
    "user": "vdelecroix"
}
```

Your module does not seem to be included in the reference manual. You have to add an entry to `src/doc/en/reference/misc/index.rst`.



---

archive/issue_comments_277125.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-02-24T14:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277125",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_277126.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-24T17:49:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277126",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277127.json:
```json
{
    "body": "Needs review!",
    "created_at": "2022-02-24T17:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277127",
    "user": "slabbe"
}
```

Needs review!



---

archive/issue_comments_277128.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-02-24T17:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277128",
    "user": "slabbe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_277129.json:
```json
{
    "body": "I did not notice before but why did you put your module in `sage/plot` rather than `sage/misc` (where all the current latex code is)?",
    "created_at": "2022-02-24T20:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277129",
    "user": "vdelecroix"
}
```

I did not notice before but why did you put your module in `sage/plot` rather than `sage/misc` (where all the current latex code is)?



---

archive/issue_comments_277130.json:
```json
{
    "body": "Replying to [comment:122 vdelecroix]:\n> I did not notice before but why did you put your module in `sage/plot` rather than `sage/misc` (where all the current latex code is)?\n\nThis was suggested in comment:34 by mkoeppe, to which I agree. The goal of the module is about drawing stuff, so it is natural to put it in `sage/plot`.\n\nIt is not true that all latex code is in misc. You also have `graph_latex.py` file in `sage/graphs`.\n\nAlso, to my opinion, `sage/misc/latex.py` is not soooo well-written (I repeat, this is an opinion). It is a module on which it is tough to build on top / reuse. You may want to look at the code which implements `view` to get an example. Who really wants to use this? I think the future will be more active if the features present in that module are re-thought and re-written else where and eventually it gets just replaced. The deprecation of the `have_latex` and friends methods done in #32650 is one of the many steps towards that. The creation of a module to deal with tikzpicture is another step towards that.",
    "created_at": "2022-02-24T21:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277130",
    "user": "slabbe"
}
```

Replying to [comment:122 vdelecroix]:
> I did not notice before but why did you put your module in `sage/plot` rather than `sage/misc` (where all the current latex code is)?

This was suggested in comment:34 by mkoeppe, to which I agree. The goal of the module is about drawing stuff, so it is natural to put it in `sage/plot`.

It is not true that all latex code is in misc. You also have `graph_latex.py` file in `sage/graphs`.

Also, to my opinion, `sage/misc/latex.py` is not soooo well-written (I repeat, this is an opinion). It is a module on which it is tough to build on top / reuse. You may want to look at the code which implements `view` to get an example. Who really wants to use this? I think the future will be more active if the features present in that module are re-thought and re-written else where and eventually it gets just replaced. The deprecation of the `have_latex` and friends methods done in #32650 is one of the many steps towards that. The creation of a module to deal with tikzpicture is another step towards that.



---

archive/issue_comments_277131.json:
```json
{
    "body": "Replying to [comment:123 slabbe]:\n> This was suggested in comment:34 by mkoeppe, to which I agree.\n\nNot sure if I still agree with myself ;)",
    "created_at": "2022-02-24T21:44:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277131",
    "user": "mkoeppe"
}
```

Replying to [comment:123 slabbe]:
> This was suggested in comment:34 by mkoeppe, to which I agree.

Not sure if I still agree with myself ;)



---

archive/issue_comments_277132.json:
```json
{
    "body": "It might be true that `sage.misc.latex` is a mess. But given that\n1. `tikzpicture.py` shares some functionalities with `sage.misc.latex` (including code duplication)\n2. `sage.misc.latex` is widely used\n3. you claim that `StandaloneTex`/`TikzPicture` is part of the future of `sage.misc.latex`\nI would like to\n1. have an idea of what is the future of `sage.misc.latex` (you said that a *step forward* but there is no destination)\n2. have the tools that will replace `sage.misc.latex` close to it in the sage source code or at the very least a mention of them in its documentation\n\nWhat I want to avoid is that this ticket only adds a module `n+1` to sagemath which does a small variation of module `1`, module `2` and module `n` independently of all of them.",
    "created_at": "2022-02-25T09:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277132",
    "user": "vdelecroix"
}
```

It might be true that `sage.misc.latex` is a mess. But given that
1. `tikzpicture.py` shares some functionalities with `sage.misc.latex` (including code duplication)
2. `sage.misc.latex` is widely used
3. you claim that `StandaloneTex`/`TikzPicture` is part of the future of `sage.misc.latex`
I would like to
1. have an idea of what is the future of `sage.misc.latex` (you said that a *step forward* but there is no destination)
2. have the tools that will replace `sage.misc.latex` close to it in the sage source code or at the very least a mention of them in its documentation

What I want to avoid is that this ticket only adds a module `n+1` to sagemath which does a small variation of module `1`, module `2` and module `n` independently of all of them.



---

archive/issue_comments_277133.json:
```json
{
    "body": "Ok, let me do more changes (next week).",
    "created_at": "2022-02-25T17:04:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277133",
    "user": "slabbe"
}
```

Ok, let me do more changes (next week).



---

archive/issue_comments_277134.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-02-25T17:04:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277134",
    "user": "slabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_277135.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-04T17:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277135",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277136.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-04T18:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277136",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277137.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-10T11:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277137",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277138.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-03-10T11:13:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277138",
    "user": "slabbe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_277139.json:
```json
{
    "body": "Gave more importance to the `Standalone` class. Updated and improved the documentation.\n\nNeeds review!",
    "created_at": "2022-03-10T11:13:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277139",
    "user": "slabbe"
}
```

Gave more importance to the `Standalone` class. Updated and improved the documentation.

Needs review!



---

archive/issue_comments_277140.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-03-17T16:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277140",
    "user": "slabbe"
}
```

New commits:



---

archive/issue_comments_277141.json:
```json
{
    "body": "Needs review!",
    "created_at": "2022-03-17T16:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277141",
    "user": "slabbe"
}
```

Needs review!



---

archive/issue_comments_277142.json:
```json
{
    "body": "\n```\n+Loading few latex packages::\n```\n\n-> \"a\" few",
    "created_at": "2022-03-17T17:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277142",
    "user": "mkoeppe"
}
```


```
+Loading few latex packages::
```

-> "a" few



---

archive/issue_comments_277143.json:
```json
{
    "body": "\n```\n+#*****************************************************************************\n+#       Copyright (C) 2015-2022 S\u00e9bastien Labb\u00e9 <slabqc@gmail.com>\n+#\n+#  Distributed under the terms of the GNU General Public License version 2 (GPLv2)\n+#\n+#  The full text of the GPLv2 is available at:\n+#\n+#                  http://www.gnu.org/licenses/\n```\n\nThis is not our standard license header; are you sure you want to mark it as \"v2 only\"?\nOther files say \"Distributed under the terms of the GNU General Public License (GPL); either version 2 of the License, or (at your option) any later version.\"",
    "created_at": "2022-03-17T17:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277143",
    "user": "mkoeppe"
}
```


```
+#*****************************************************************************
+#       Copyright (C) 2015-2022 Sébastien Labbé <slabqc@gmail.com>
+#
+#  Distributed under the terms of the GNU General Public License version 2 (GPLv2)
+#
+#  The full text of the GPLv2 is available at:
+#
+#                  http://www.gnu.org/licenses/
```

This is not our standard license header; are you sure you want to mark it as "v2 only"?
Other files say "Distributed under the terms of the GNU General Public License (GPL); either version 2 of the License, or (at your option) any later version."



---

archive/issue_comments_277144.json:
```json
{
    "body": "\n```\n+Adding a border in the options avoids croping the vertices of a graph::\n```\n\n-> cropping",
    "created_at": "2022-03-17T17:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277144",
    "user": "mkoeppe"
}
```


```
+Adding a border in the options avoids croping the vertices of a graph::
```

-> cropping



---

archive/issue_comments_277145.json:
```json
{
    "body": "\n```\n+        sage: t = TikzPicture(s, standalone_config=[\"border=4mm\"], usepackage=['tkz-graph']) # optional latex\n+        sage: _ = t.pdf(view=False)             # long time (2s) # optional latex\n```\n\nThis should also be marked `# optional - latex_package_tkz_graph`\n(occurs several times)",
    "created_at": "2022-03-17T17:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277145",
    "user": "mkoeppe"
}
```


```
+        sage: t = TikzPicture(s, standalone_config=["border=4mm"], usepackage=['tkz-graph']) # optional latex
+        sage: _ = t.pdf(view=False)             # long time (2s) # optional latex
```

This should also be marked `# optional - latex_package_tkz_graph`
(occurs several times)



---

archive/issue_comments_277146.json:
```json
{
    "body": "\n```\n+            sage: dotdata = G.graphviz_string()\n+            sage: tikz = TikzPicture.from_dot_string(dotdata) # optional dot2tex # long time (3s)\n```\n\nthis should probably also be marked as `# optional - graphviz`",
    "created_at": "2022-03-17T17:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277146",
    "user": "mkoeppe"
}
```


```
+            sage: dotdata = G.graphviz_string()
+            sage: tikz = TikzPicture.from_dot_string(dotdata) # optional dot2tex # long time (3s)
```

this should probably also be marked as `# optional - graphviz`



---

archive/issue_comments_277147.json:
```json
{
    "body": "Also, could you please mark the doctests using graphs as `# optional - sage.graphs` and the doctests using posets as `# optional - sage.combinat`?",
    "created_at": "2022-03-17T17:39:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277147",
    "user": "mkoeppe"
}
```

Also, could you please mark the doctests using graphs as `# optional - sage.graphs` and the doctests using posets as `# optional - sage.combinat`?



---

archive/issue_comments_277148.json:
```json
{
    "body": "Overall looking great!",
    "created_at": "2022-03-17T17:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277148",
    "user": "mkoeppe"
}
```

Overall looking great!



---

archive/issue_comments_277149.json:
```json
{
    "body": "Thanks for your review! I will improve the code accordingly.",
    "created_at": "2022-03-19T09:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277149",
    "user": "slabbe"
}
```

Thanks for your review! I will improve the code accordingly.



---

archive/issue_comments_277150.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-19T09:37:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277150",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277151.json:
```json
{
    "body": "It remains to fix the doctests tags. I will do this later.",
    "created_at": "2022-03-19T09:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277151",
    "user": "slabbe"
}
```

It remains to fix the doctests tags. I will do this later.



---

archive/issue_comments_277152.json:
```json
{
    "body": "Replying to [comment:137 mkoeppe]:\n> {{{\n> +        sage: t = TikzPicture(s, standalone_config=[\"border=4mm\"], usepackage=['tkz-graph']) # optional latex\n> +        sage: _ = t.pdf(view=False)             # long time (2s) # optional latex\n> }}}\n> This should also be marked `# optional - latex_package_tkz_graph`\n> (occurs several times)\n\nOnly the line `t.pdf()` really needs the `latex_package_tkz_graph` optional tag. So I added this tag where necessary. Creating a Python string containing `'\\usetikzlibrary{tkz-graph}'` by itself does not depend on the latex package. So, I did not added the optional tag everywhere.",
    "created_at": "2022-03-21T13:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277152",
    "user": "slabbe"
}
```

Replying to [comment:137 mkoeppe]:
> {{{
> +        sage: t = TikzPicture(s, standalone_config=["border=4mm"], usepackage=['tkz-graph']) # optional latex
> +        sage: _ = t.pdf(view=False)             # long time (2s) # optional latex
> }}}
> This should also be marked `# optional - latex_package_tkz_graph`
> (occurs several times)

Only the line `t.pdf()` really needs the `latex_package_tkz_graph` optional tag. So I added this tag where necessary. Creating a Python string containing `'\usetikzlibrary{tkz-graph}'` by itself does not depend on the latex package. So, I did not added the optional tag everywhere.



---

archive/issue_comments_277153.json:
```json
{
    "body": "Replying to [comment:138 mkoeppe]:\n> {{{\n> +            sage: dotdata = G.graphviz_string()\n> +            sage: tikz = TikzPicture.from_dot_string(dotdata) # optional dot2tex # long time (3s)\n> }}}\n> this should probably also be marked as `# optional - graphviz`\n\nAt some point in time, it was changed that the installation of `dot2tex` fails if `graphviz` is not installed. But, whatever, maybe it is better to add `graphviz` optional tag as well, which I did (commits to be pushed soonafter).",
    "created_at": "2022-03-21T13:30:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277153",
    "user": "slabbe"
}
```

Replying to [comment:138 mkoeppe]:
> {{{
> +            sage: dotdata = G.graphviz_string()
> +            sage: tikz = TikzPicture.from_dot_string(dotdata) # optional dot2tex # long time (3s)
> }}}
> this should probably also be marked as `# optional - graphviz`

At some point in time, it was changed that the installation of `dot2tex` fails if `graphviz` is not installed. But, whatever, maybe it is better to add `graphviz` optional tag as well, which I did (commits to be pushed soonafter).



---

archive/issue_comments_277154.json:
```json
{
    "body": "Replying to [comment:139 mkoeppe]:\n> Also, could you please mark the doctests using graphs as `# optional - sage.graphs` and the doctests using posets as `# optional - sage.combinat`?\n\nOk, done.",
    "created_at": "2022-03-21T13:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277154",
    "user": "slabbe"
}
```

Replying to [comment:139 mkoeppe]:
> Also, could you please mark the doctests using graphs as `# optional - sage.graphs` and the doctests using posets as `# optional - sage.combinat`?

Ok, done.



---

archive/issue_comments_277155.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-21T13:31:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277155",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277156.json:
```json
{
    "body": "Replying to [comment:139 mkoeppe]:\n> Also, could you please mark the doctests using graphs as `# optional - sage.graphs` and the doctests using posets as `# optional - sage.combinat`?\n\nAlso I could make the doctests less dependent on graphs stuff.",
    "created_at": "2022-03-21T13:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277156",
    "user": "slabbe"
}
```

Replying to [comment:139 mkoeppe]:
> Also, could you please mark the doctests using graphs as `# optional - sage.graphs` and the doctests using posets as `# optional - sage.combinat`?

Also I could make the doctests less dependent on graphs stuff.



---

archive/issue_comments_277157.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-21T14:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277157",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277158.json:
```json
{
    "body": "Needs review!",
    "created_at": "2022-03-21T14:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277158",
    "user": "slabbe"
}
```

Needs review!



---

archive/issue_comments_277159.json:
```json
{
    "body": "Looking great.\n\nThese lines and what depends on them should be marked `# optional - sage.symbolic` (for #32432, #32601)\n\n```\n+            sage: f(x) = -1 / x\n+            sage: g(x) = 1 / (x + 1)\n```\n\n\nOther than that, from my side it's positive review.",
    "created_at": "2022-03-21T17:50:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277159",
    "user": "mkoeppe"
}
```

Looking great.

These lines and what depends on them should be marked `# optional - sage.symbolic` (for #32432, #32601)

```
+            sage: f(x) = -1 / x
+            sage: g(x) = 1 / (x + 1)
```


Other than that, from my side it's positive review.



---

archive/issue_comments_277160.json:
```json
{
    "body": "Replying to [comment:151 mkoeppe]:\n> These lines and what depends on them should be marked `# optional - sage.symbolic` (for #32432, #32601)\n> {{{\n> +            sage: f(x) = -1 / x\n> +            sage: g(x) = 1 / (x + 1)\n> }}}\n> \n> Other than that, from my side it's positive review.\n\nAlternatively, use lambda functions instead of symbolic ones:\n\n```diff\n-            sage: f(x) = -1 / x\n-            sage: g(x) = 1 / (x + 1)\n+            sage: f = lambda x: -1 / x\n+            sage: g = lambda x: 1 / (x + 1)\n```\n",
    "created_at": "2022-03-21T22:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277160",
    "user": "slelievre"
}
```

Replying to [comment:151 mkoeppe]:
> These lines and what depends on them should be marked `# optional - sage.symbolic` (for #32432, #32601)
> {{{
> +            sage: f(x) = -1 / x
> +            sage: g(x) = 1 / (x + 1)
> }}}
> 
> Other than that, from my side it's positive review.

Alternatively, use lambda functions instead of symbolic ones:

```diff
-            sage: f(x) = -1 / x
-            sage: g(x) = 1 / (x + 1)
+            sage: f = lambda x: -1 / x
+            sage: g = lambda x: 1 / (x + 1)
```




---

archive/issue_comments_277161.json:
```json
{
    "body": "No, they wouldn't show up well in the plots.",
    "created_at": "2022-03-21T22:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277161",
    "user": "mkoeppe"
}
```

No, they wouldn't show up well in the plots.



---

archive/issue_comments_277162.json:
```json
{
    "body": "Great! I think it is time to give a positive review to this ticket!",
    "created_at": "2022-03-22T15:29:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277162",
    "user": "caruso"
}
```

Great! I think it is time to give a positive review to this ticket!



---

archive/issue_comments_277163.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-22T15:29:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277163",
    "user": "caruso"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_277164.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2022-03-22T19:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277164",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_277165.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2022-03-22T19:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277165",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_277166.json:
```json
{
    "body": "Replying to [comment:154 caruso]:\n> Great! I think it is time to give a positive review to this ticket!\n\nI added the doctests tags `sage.symbolic` to answer the latest comment. Needs review again. Sorry.\n\nI also updated the title of the ticket.",
    "created_at": "2022-03-22T19:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277166",
    "user": "slabbe"
}
```

Replying to [comment:154 caruso]:
> Great! I think it is time to give a positive review to this ticket!

I added the doctests tags `sage.symbolic` to answer the latest comment. Needs review again. Sorry.

I also updated the title of the ticket.



---

archive/issue_comments_277167.json:
```json
{
    "body": "Patchbot is green. We can change the status to positive review.\n\nBut, maybe before, we could check if all tests pass on a machine with no latex installed, because Volker is using such a computer to test tickets, see comment:85. Do someone has a machine with no latex? Or is there an easy way to mimic its absence?",
    "created_at": "2022-03-23T12:47:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277167",
    "user": "slabbe"
}
```

Patchbot is green. We can change the status to positive review.

But, maybe before, we could check if all tests pass on a machine with no latex installed, because Volker is using such a computer to test tickets, see comment:85. Do someone has a machine with no latex? Or is there an easy way to mimic its absence?



---

archive/issue_comments_277168.json:
```json
{
    "body": "There must be a way to use tox for that...",
    "created_at": "2022-03-23T16:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277168",
    "user": "slelievre"
}
```

There must be a way to use tox for that...



---

archive/issue_comments_277169.json:
```json
{
    "body": "I found a computer with no latex and no imagemagick:\n\n\n```\n$ pdflatex -v\n\nLa commande \u00ab pdflatex \u00bb n'a pas \u00e9t\u00e9 trouv\u00e9e, mais peut \u00eatre install\u00e9e avec :\n\nsudo apt install texlive-latex-base\n```\n\n\n\n```\n$ lualatex -v\n\nLa commande \u00ab lualatex \u00bb n'a pas \u00e9t\u00e9 trouv\u00e9e, mais peut \u00eatre install\u00e9e avec :\n\nsudo apt install texlive-latex-base\n```\n\n\n\n```\n$ convert -v\n\nLa commande \u00ab convert \u00bb n'a pas \u00e9t\u00e9 trouv\u00e9e, mais peut \u00eatre install\u00e9e avec :\n\nsudo apt install graphicsmagick-imagemagick-compat  # version 1.4+really1.3.35-1, or\nsudo apt install imagemagick-6.q16                  # version 8:6.9.10.23+dfsg-2.1ubuntu11.4\nsudo apt install imagemagick-6.q16hdri              # version 8:6.9.10.23+dfsg-2.1ubuntu11.4\n```\n\non which I installed sage:\n\n```\n$ ./sage -version\nSageMath version 9.6.beta5, Release Date: 2022-03-12\n```\n\n\non which I merged this ticket, I confirm the doctests work:\n\n\n```\n./sage -t src/sage/misc/latex_standalone.py \nno stored timings available\nRunning doctests with ID 2022-03-24-11-08-32-82df3068.\nGit branch: 20343\nUsing --optional=debian,pip,sage,sage_spkg\nFeatures to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,graphviz,imagemagick,jupymake,kenzo,latte_int,lrslib,mcqd,meataxe,nauty,palp,pandoc,pdf2svg,pdftocairo,plantri,polytopes_db,polytopes_db_4d,pynormaliz,python_igraph,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.groups,sage.plot,sage.rings.number_field,sage.rings.padics,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,sagemath_doc_html,sphinx,tdlib\nDoctesting 1 file.\nsage -t --random-seed=224621707555152601217192014946498015018 src/sage/misc/latex_standalone.py\n    [216 tests, 0.29 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 0.3 seconds\n    cpu time: 0.3 seconds\n    cumulative wall time: 0.3 seconds\nFeatures detected for doctesting: graphviz,sage.combinat,sage.graphs,sage.symbolic\nPytest is not installed, skip checking tests that rely on it.\n```\n\n\n\n```\n$ ./sage -t --optional=sage,optional,external --long src/sage/misc/latex_standalone.py \ntoo few successful tests, not using stored timings\nRunning doctests with ID 2022-03-24-11-08-54-06354475.\nGit branch: 20343\nUsing --optional=debian,external,pip,sage,sage_spkg\nFeatures to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,cplex,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,gurobi,imagemagick,internet,jupymake,kenzo,latex,latex_package_tkz_graph,latte_int,lrslib,lualatex,macaulay2,magma,maple,mathematica,matlab,mcqd,meataxe,nauty,octave,palp,pandoc,pdf2svg,pdflatex,pdftocairo,plantri,polytopes_db,polytopes_db_4d,pynormaliz,python_igraph,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.groups,sage.plot,sage.rings.number_field,sage.rings.padics,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,sagemath_doc_html,scilab,sphinx,tdlib,xelatex\nDoctesting 1 file.\nsage -t --long --random-seed=318237908393715923968305484155979250546 src/sage/misc/latex_standalone.py\n    [216 tests, 0.29 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 0.4 seconds\n    cpu time: 0.3 seconds\n    cumulative wall time: 0.3 seconds\nFeatures detected for doctesting: graphviz,pdftocairo,sage.combinat,sage.graphs,sage.symbolic\nPytest is not installed, skip checking tests that rely on it.\n```\n",
    "created_at": "2022-03-24T10:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277169",
    "user": "slabbe"
}
```

I found a computer with no latex and no imagemagick:


```
$ pdflatex -v

La commande « pdflatex » n'a pas été trouvée, mais peut être installée avec :

sudo apt install texlive-latex-base
```



```
$ lualatex -v

La commande « lualatex » n'a pas été trouvée, mais peut être installée avec :

sudo apt install texlive-latex-base
```



```
$ convert -v

La commande « convert » n'a pas été trouvée, mais peut être installée avec :

sudo apt install graphicsmagick-imagemagick-compat  # version 1.4+really1.3.35-1, or
sudo apt install imagemagick-6.q16                  # version 8:6.9.10.23+dfsg-2.1ubuntu11.4
sudo apt install imagemagick-6.q16hdri              # version 8:6.9.10.23+dfsg-2.1ubuntu11.4
```

on which I installed sage:

```
$ ./sage -version
SageMath version 9.6.beta5, Release Date: 2022-03-12
```


on which I merged this ticket, I confirm the doctests work:


```
./sage -t src/sage/misc/latex_standalone.py 
no stored timings available
Running doctests with ID 2022-03-24-11-08-32-82df3068.
Git branch: 20343
Using --optional=debian,pip,sage,sage_spkg
Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,graphviz,imagemagick,jupymake,kenzo,latte_int,lrslib,mcqd,meataxe,nauty,palp,pandoc,pdf2svg,pdftocairo,plantri,polytopes_db,polytopes_db_4d,pynormaliz,python_igraph,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.groups,sage.plot,sage.rings.number_field,sage.rings.padics,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,sagemath_doc_html,sphinx,tdlib
Doctesting 1 file.
sage -t --random-seed=224621707555152601217192014946498015018 src/sage/misc/latex_standalone.py
    [216 tests, 0.29 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 0.3 seconds
    cpu time: 0.3 seconds
    cumulative wall time: 0.3 seconds
Features detected for doctesting: graphviz,sage.combinat,sage.graphs,sage.symbolic
Pytest is not installed, skip checking tests that rely on it.
```



```
$ ./sage -t --optional=sage,optional,external --long src/sage/misc/latex_standalone.py 
too few successful tests, not using stored timings
Running doctests with ID 2022-03-24-11-08-54-06354475.
Git branch: 20343
Using --optional=debian,external,pip,sage,sage_spkg
Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,cplex,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,gurobi,imagemagick,internet,jupymake,kenzo,latex,latex_package_tkz_graph,latte_int,lrslib,lualatex,macaulay2,magma,maple,mathematica,matlab,mcqd,meataxe,nauty,octave,palp,pandoc,pdf2svg,pdflatex,pdftocairo,plantri,polytopes_db,polytopes_db_4d,pynormaliz,python_igraph,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.groups,sage.plot,sage.rings.number_field,sage.rings.padics,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,sagemath_doc_html,scilab,sphinx,tdlib,xelatex
Doctesting 1 file.
sage -t --long --random-seed=318237908393715923968305484155979250546 src/sage/misc/latex_standalone.py
    [216 tests, 0.29 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 0.4 seconds
    cpu time: 0.3 seconds
    cumulative wall time: 0.3 seconds
Features detected for doctesting: graphviz,pdftocairo,sage.combinat,sage.graphs,sage.symbolic
Pytest is not installed, skip checking tests that rely on it.
```




---

archive/issue_comments_277170.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-24T10:21:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277170",
    "user": "caruso"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_277171.json:
```json
{
    "body": "Nice! I give back a positive review to this ticket.",
    "created_at": "2022-03-24T10:21:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277171",
    "user": "caruso"
}
```

Nice! I give back a positive review to this ticket.



---

archive/issue_comments_277172.json:
```json
{
    "body": "Super!",
    "created_at": "2022-03-24T13:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277172",
    "user": "slabbe"
}
```

Super!



---

archive/issue_comments_277173.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-03-30T22:33:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277173",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_277174.json:
```json
{
    "body": "this has introduced wrong indentation\n\n```\nsrc/sage/misc/latex_standalone.py:688:12: E111 indentation is not a multiple of four\nsrc/sage/misc/latex_standalone.py:689:16: E111 indentation is not a multiple of four\nsrc/sage/misc/latex_standalone.py:690:12: E111 indentation is not a multiple of four\nsrc/sage/misc/latex_standalone.py:691:16: E111 indentation is not a multiple of four\n```\n",
    "created_at": "2022-04-02T20:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277174",
    "user": "chapoton"
}
```

this has introduced wrong indentation

```
src/sage/misc/latex_standalone.py:688:12: E111 indentation is not a multiple of four
src/sage/misc/latex_standalone.py:689:16: E111 indentation is not a multiple of four
src/sage/misc/latex_standalone.py:690:12: E111 indentation is not a multiple of four
src/sage/misc/latex_standalone.py:691:16: E111 indentation is not a multiple of four
```




---

archive/issue_comments_277175.json:
```json
{
    "body": "so please swiftly review #33635",
    "created_at": "2022-04-03T08:10:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277175",
    "user": "chapoton"
}
```

so please swiftly review #33635



---

archive/issue_comments_277176.json:
```json
{
    "body": "Could this possibly be leading to the bad LaTeX that's causing the problem with  `view(crystals.Tableaux(\"A3\",shape=[2,1]))` \u2014 see https://groups.google.com/g/sage-support/c/1u4m-Osz6jY/m/PAM-1C40AwAJ?",
    "created_at": "2022-06-02T17:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277176",
    "user": "jhpalmieri"
}
```

Could this possibly be leading to the bad LaTeX that's causing the problem with  `view(crystals.Tableaux("A3",shape=[2,1]))` — see https://groups.google.com/g/sage-support/c/1u4m-Osz6jY/m/PAM-1C40AwAJ?



---

archive/issue_comments_277177.json:
```json
{
    "body": "In case this is relevant to the `view(crystals....)` failure, that is now #33947.",
    "created_at": "2022-06-02T23:07:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277177",
    "user": "jhpalmieri"
}
```

In case this is relevant to the `view(crystals....)` failure, that is now #33947.



---

archive/issue_comments_277178.json:
```json
{
    "body": "Replying to [comment:169 jhpalmieri]:\n> Could this possibly be leading to the bad LaTeX that's causing the problem with  `view(crystals.Tableaux(\"A3\",shape=[2,1]))` \u2014 see https://groups.google.com/g/sage-support/c/1u4m-Osz6jY/m/PAM-1C40AwAJ?\n\nNo. The problem reported on sage-support is with respect to Sage 9.3. The `TikzPicture` code went into sage in 9.6. Also, for now, no other file is using the new `TikzPicture` module.",
    "created_at": "2022-06-03T07:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20106#issuecomment-277178",
    "user": "slabbe"
}
```

Replying to [comment:169 jhpalmieri]:
> Could this possibly be leading to the bad LaTeX that's causing the problem with  `view(crystals.Tableaux("A3",shape=[2,1]))` — see https://groups.google.com/g/sage-support/c/1u4m-Osz6jY/m/PAM-1C40AwAJ?

No. The problem reported on sage-support is with respect to Sage 9.3. The `TikzPicture` code went into sage in 9.6. Also, for now, no other file is using the new `TikzPicture` module.
