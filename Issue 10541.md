# Issue 10541: Upgrade to mercurial 1.7.3

archive/issues_010541.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  @jasongrout @williamstein @nexttime\n\nKeywords: mercurial\n\nUpgraded mercurial spkg to mercurial 1.7.3\n\nhttp://sage.math.washington.edu/home/rgrout/mercurial-1.7.3.spkg\n\nIssue created by migration from https://trac.sagemath.org/ticket/10594\n\n",
    "created_at": "2011-01-11T22:29:44Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "Upgrade to mercurial 1.7.3",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10541",
    "user": "https://trac.sagemath.org/admin/accounts/users/ryan"
}
```
Assignee: tbd

CC:  @jasongrout @williamstein @nexttime

Keywords: mercurial

Upgraded mercurial spkg to mercurial 1.7.3

http://sage.math.washington.edu/home/rgrout/mercurial-1.7.3.spkg

Issue created by migration from https://trac.sagemath.org/ticket/10594





---

archive/issue_comments_109923.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-01-11T22:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109923",
    "user": "https://trac.sagemath.org/admin/accounts/users/ryan"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_109924.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2011-01-12T00:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109924",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_109925.json:
```json
{
    "body": "it seems to work for me, but how does one really test it?",
    "created_at": "2011-01-12T00:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109925",
    "user": "https://github.com/dimpase"
}
```

it seems to work for me, but how does one really test it?



---

archive/issue_comments_109926.json:
```json
{
    "body": "Replying to [comment:3 dimpase]:\n> it seems to work for me, but how does one really test it?\n\nIn a Sage shell (\"sage -sh\"), unpack the spkg and go into the `src` directory. There, you can build the package (just do `make all`) and then run Mercurial's built-in tests: `make tests`.\n\nInterestingly, on a regular Ubuntu machine (on which Mercurial works perfectly fine) some of the tests don't pass; it seems like their tests want to have the `unzip` utility available.\n\nThe .spkg installs fine in Linux, and on t2.math. I'm going to take a look at OS X. Mercurial is very well tested and cross-platform, so I would be very surprised if we have any problems.",
    "created_at": "2011-01-19T07:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109926",
    "user": "https://github.com/dandrake"
}
```

Replying to [comment:3 dimpase]:
> it seems to work for me, but how does one really test it?

In a Sage shell ("sage -sh"), unpack the spkg and go into the `src` directory. There, you can build the package (just do `make all`) and then run Mercurial's built-in tests: `make tests`.

Interestingly, on a regular Ubuntu machine (on which Mercurial works perfectly fine) some of the tests don't pass; it seems like their tests want to have the `unzip` utility available.

The .spkg installs fine in Linux, and on t2.math. I'm going to take a look at OS X. Mercurial is very well tested and cross-platform, so I would be very surprised if we have any problems.



---

archive/issue_comments_109927.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2011-01-19T07:03:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109927",
    "user": "https://github.com/dandrake"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_109928.json:
```json
{
    "body": "Replying to [comment:4 ddrake]:\n> Replying to [comment:3 dimpase]:\n> > it seems to work for me, but how does one really test it?\n> \n> In a Sage shell (\"sage -sh\"), unpack the spkg and go into the `src` directory. There, you can build the package (just do `make all`) and then run Mercurial's built-in tests: `make tests`.\n> \n> Interestingly, on a regular Ubuntu machine (on which Mercurial works perfectly fine) some of the tests don't pass; it seems like their tests want to have the `unzip` utility available.\n> \n> The .spkg installs fine in Linux, and on t2.math. I'm going to take a look at OS X. Mercurial is very well tested and cross-platform, so I would be very surprised if we have any problems.\n\none should at least test that the combinat stuff works. This is one of the most immediate and tricky uses of hg in Sage.",
    "created_at": "2011-01-19T09:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109928",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:4 ddrake]:
> Replying to [comment:3 dimpase]:
> > it seems to work for me, but how does one really test it?
> 
> In a Sage shell ("sage -sh"), unpack the spkg and go into the `src` directory. There, you can build the package (just do `make all`) and then run Mercurial's built-in tests: `make tests`.
> 
> Interestingly, on a regular Ubuntu machine (on which Mercurial works perfectly fine) some of the tests don't pass; it seems like their tests want to have the `unzip` utility available.
> 
> The .spkg installs fine in Linux, and on t2.math. I'm going to take a look at OS X. Mercurial is very well tested and cross-platform, so I would be very surprised if we have any problems.

one should at least test that the combinat stuff works. This is one of the most immediate and tricky uses of hg in Sage.



---

archive/issue_comments_109929.json:
```json
{
    "body": "The spkg builds and installs on t2.math and bsd.math. I ran tests on those two machines and on an Ubuntu machine, and I got some failures on all three...but the failures seem to be the same as what we got with 1.6.4.\n\nI tried the combinat patch queue, and it works the same as it does in 4.6.1.rc1 with Mercurial 1.6.4. The [upgrade notes](http://mercurial.selenic.com/wiki/UpgradeNotes) don't mention anything that affects our use of Mercurial, so positive review.",
    "created_at": "2011-01-20T02:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109929",
    "user": "https://github.com/dandrake"
}
```

The spkg builds and installs on t2.math and bsd.math. I ran tests on those two machines and on an Ubuntu machine, and I got some failures on all three...but the failures seem to be the same as what we got with 1.6.4.

I tried the combinat patch queue, and it works the same as it does in 4.6.1.rc1 with Mercurial 1.6.4. The [upgrade notes](http://mercurial.selenic.com/wiki/UpgradeNotes) don't mention anything that affects our use of Mercurial, so positive review.



---

archive/issue_comments_109930.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-01-20T02:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109930",
    "user": "https://github.com/dandrake"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_109931.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-01-25T08:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109931",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_109932.json:
```json
{
    "body": "After some issues on #9433, I wonder if this should be reopened.  There are some incompatibilities between Mercurial 1.7.3 and earlier versions; see [this web page](http://mercurial.selenic.com/wiki/UpgradingMercurial#Upgrading_and_downgrading_repository_formats).  I think the issues is this: \n\n- any new repositories created with 1.7.3 (without including a flag like `--config format.dotencode=False`) will not be usable by versions before 1.7.\n\nI think a reasonable argument could be made for merging 1.7.3 anyway: when dealing with Sage, it's not a huge requirement to ask people to use the Mercurial distributed with Sage instead of some older version installed elsewhere on their machine.\n\nBut perhaps a reasonable argument could be made on the other side: why create repositories which can't be read by Mercurial 1.6.4 or earlier?  Should we back out 1.7.3 altogether?\n\nWe could also keep 1.7.3 but require all repos to be created with the flag `--config format.dotencode=False`.  I personally think that this is unwieldy.\n\nAny opinions?",
    "created_at": "2011-02-18T19:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109932",
    "user": "https://github.com/jhpalmieri"
}
```

After some issues on #9433, I wonder if this should be reopened.  There are some incompatibilities between Mercurial 1.7.3 and earlier versions; see [this web page](http://mercurial.selenic.com/wiki/UpgradingMercurial#Upgrading_and_downgrading_repository_formats).  I think the issues is this: 

- any new repositories created with 1.7.3 (without including a flag like `--config format.dotencode=False`) will not be usable by versions before 1.7.

I think a reasonable argument could be made for merging 1.7.3 anyway: when dealing with Sage, it's not a huge requirement to ask people to use the Mercurial distributed with Sage instead of some older version installed elsewhere on their machine.

But perhaps a reasonable argument could be made on the other side: why create repositories which can't be read by Mercurial 1.6.4 or earlier?  Should we back out 1.7.3 altogether?

We could also keep 1.7.3 but require all repos to be created with the flag `--config format.dotencode=False`.  I personally think that this is unwieldy.

Any opinions?



---

archive/issue_comments_109933.json:
```json
{
    "body": "Just to reiterate my point from #9433, I think we should keep the new version. Current distributions (e.g. Fedora 14) have already mercurial 1.7+. If you have a way old mercurial install, on the other extreme, then you are probably forced to use Sage's mercurial already. This is precisely why mercurial is included in Sage.",
    "created_at": "2011-02-18T20:57:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109933",
    "user": "https://github.com/vbraun"
}
```

Just to reiterate my point from #9433, I think we should keep the new version. Current distributions (e.g. Fedora 14) have already mercurial 1.7+. If you have a way old mercurial install, on the other extreme, then you are probably forced to use Sage's mercurial already. This is precisely why mercurial is included in Sage.



---

archive/issue_comments_109934.json:
```json
{
    "body": "Volker, I see your point but I have a small preference for *delaying* this new version of Mercurial until it's more widespread.  I also don't see a compelling reason for including Mercurial 1.7.3 (as opposed to 1.6.4).",
    "created_at": "2011-02-19T11:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109934",
    "user": "https://github.com/jdemeyer"
}
```

Volker, I see your point but I have a small preference for *delaying* this new version of Mercurial until it's more widespread.  I also don't see a compelling reason for including Mercurial 1.7.3 (as opposed to 1.6.4).



---

archive/issue_comments_109935.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2011-02-20T17:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109935",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from closed to new.



---

archive/issue_comments_109936.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2011-02-20T17:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109936",
    "user": "https://github.com/jdemeyer"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_109937.json:
```json
{
    "body": "Changing type from task to enhancement.",
    "created_at": "2011-02-20T17:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109937",
    "user": "https://github.com/jdemeyer"
}
```

Changing type from task to enhancement.



---

archive/issue_comments_109938.json:
```json
{
    "body": "hg repositories made with 1.7.3 cannot be manipulated using versions of mercurial <1.7.  Because of this backwards incompatible change and because I see no compelling reason to upgrade Mercurial, I want to be on the safe side and unmerge #10594 (i.e. revert to Mercurial version 1.6.4) in the sage-4.6.2 release.\n\nIn some later Sage release, we can still decide to upgrade Mercurial.",
    "created_at": "2011-02-20T17:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109938",
    "user": "https://github.com/jdemeyer"
}
```

hg repositories made with 1.7.3 cannot be manipulated using versions of mercurial <1.7.  Because of this backwards incompatible change and because I see no compelling reason to upgrade Mercurial, I want to be on the safe side and unmerge #10594 (i.e. revert to Mercurial version 1.6.4) in the sage-4.6.2 release.

In some later Sage release, we can still decide to upgrade Mercurial.



---

archive/issue_comments_109939.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-02-20T17:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109939",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_109940.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-02-20T17:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109940",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_109941.json:
```json
{
    "body": "Changing keywords from \"mercurial\" to \"mercurial, upgrade\".",
    "created_at": "2011-06-14T02:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109941",
    "user": "https://github.com/kini"
}
```

Changing keywords from "mercurial" to "mercurial, upgrade".



---

archive/issue_comments_109942.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-06-14T02:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109942",
    "user": "https://github.com/kini"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_109943.json:
```json
{
    "body": "Can we upgrade yet, Jeroen? What is probably the final version of Mercurial 1.8.x, i.e. 1.8.4, is already out. Soon we will be three versions behind the latest version. Do we really need a compelling reason to upgrade packages we ship, when possible? As Volker said, anyone who is having trouble keeping up with Mercurial versions is probably using `sage -hg` anyway.\n\nI'm working on an SPKG which will upgrade Mercurial to 1.8.4 and resolve #11120 and #11121 as well. Since 1.7.3 is already old, I hope you don't mind if I change around the ticket description...",
    "created_at": "2011-06-14T02:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109943",
    "user": "https://github.com/kini"
}
```

Can we upgrade yet, Jeroen? What is probably the final version of Mercurial 1.8.x, i.e. 1.8.4, is already out. Soon we will be three versions behind the latest version. Do we really need a compelling reason to upgrade packages we ship, when possible? As Volker said, anyone who is having trouble keeping up with Mercurial versions is probably using `sage -hg` anyway.

I'm working on an SPKG which will upgrade Mercurial to 1.8.4 and resolve #11120 and #11121 as well. Since 1.7.3 is already old, I hope you don't mind if I change around the ticket description...



---

archive/issue_comments_109944.json:
```json
{
    "body": "Changing keywords from \"mercurial, upgrade\" to \"mercurial upgrade sd31\".",
    "created_at": "2011-06-14T06:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109944",
    "user": "https://github.com/kini"
}
```

Changing keywords from "mercurial, upgrade" to "mercurial upgrade sd31".



---

archive/issue_comments_109945.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-14T06:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109945",
    "user": "https://github.com/kini"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_109946.json:
```json
{
    "body": "The spkg is available [here](http://sage.math.washington.edu/home/keshav/files/mercurial-1.8.4.spkg). It also fixes #11120 and #11121, as mentioned. I'm CCing William since we talked about this in person and I don't see him on this ticket.",
    "created_at": "2011-06-14T06:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109946",
    "user": "https://github.com/kini"
}
```

The spkg is available [here](http://sage.math.washington.edu/home/keshav/files/mercurial-1.8.4.spkg). It also fixes #11120 and #11121, as mentioned. I'm CCing William since we talked about this in person and I don't see him on this ticket.



---

archive/issue_comments_109947.json:
```json
{
    "body": "Replying to [comment:17 kini]:\n> Do we really need a compelling reason to upgrade packages we ship, when possible?\n\nI think we do, I don't think we should simply upgrade packages for the sake of upgrading.  I think the incompatibility with older versions of Mercurial is a negative point for upgrading Mercurial.  Only if there is a particular feature of Mercurial 1.8.4 which is really useful, then I think we should upgrade.",
    "created_at": "2011-06-14T17:45:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109947",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:17 kini]:
> Do we really need a compelling reason to upgrade packages we ship, when possible?

I think we do, I don't think we should simply upgrade packages for the sake of upgrading.  I think the incompatibility with older versions of Mercurial is a negative point for upgrading Mercurial.  Only if there is a particular feature of Mercurial 1.8.4 which is really useful, then I think we should upgrade.



---

archive/issue_comments_109948.json:
```json
{
    "body": "On first glance, this looks okay.  There are a few extraneous files in the spkg:\n\n```\n$ hg status\n? .SPKG.txt.swp\n? .SPKG.txt.un~\n? .spkg-install.un~\n```\n\nSo of course they should be cleaned up.\n\nIf someone upgrades from an earlier version of mercurial on OS X, should we check for and delete the old file SAGE/local/bin/hgmerge?",
    "created_at": "2011-06-14T18:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109948",
    "user": "https://github.com/jhpalmieri"
}
```

On first glance, this looks okay.  There are a few extraneous files in the spkg:

```
$ hg status
? .SPKG.txt.swp
? .SPKG.txt.un~
? .spkg-install.un~
```

So of course they should be cleaned up.

If someone upgrades from an earlier version of mercurial on OS X, should we check for and delete the old file SAGE/local/bin/hgmerge?



---

archive/issue_comments_109949.json:
```json
{
    "body": "Replying to [comment:19 jdemeyer]:\n> Replying to [comment:17 kini]:\n> > Do we really need a compelling reason to upgrade packages we ship, when possible?\n> \n> I think we do, I don't think we should simply upgrade packages for the sake of upgrading.  I think the incompatibility with older versions of Mercurial is a negative point for upgrading Mercurial.  Only if there is a particular feature of Mercurial 1.8.4 which is really useful, then I think we should upgrade.\n\nThis is not a backwards-incompatible change in 1.7 -- it is a forward-incompatibility in 1.6.x. In the current state of affairs, the sage scripts cannot properly handle packages created by the user's system Mercurial, for many users whose system Mercurial is \"too new\" for Sage (and this proportion will only increase with time). If we upgrade Mercurial in Sage, the user's system Mercurial may not be able to handle packages created by the sage scripts, but this is not a problem because in those cases the user can do `echo alias hg=\"sage -hg\" >> ~/.bashrc` and go on with their life. The proportion of users for which this will be a problem will only decrease with time. Also, rather than being an inconvenience, this will actually improve the user's life, since they have access to a newer version of Mercurial than they would otherwise. If we *don't* upgrade, we run into situations where you need to clone an entire repository with `--config format.dotencode=False` before you can run Sage's packaging tools on it, because they all use Sage's Mercurial. The proportion of users who encounter this problem will only *increase* with time, and I suspect that developers (i.e. the usual users of Mercurial) number in this population with more likelihood than average users.\n\nSo upgrading Mercurial would help more than it would hurt. But even if it helped exactly as much as it hurt in terms of this repository format issue, software isn't perfect. Newer versions fix bugs that existed in older versions. While newer versions may include new bugs, those too will be fixed in the future. Sitting tight on an old version of software is not safer than following the latest stable releases. I'm not advocating updating to bleeding-edge nightly builds or anything; 1.8.4 was released on June 1 and will be the final bugfix release before the feature release 1.9 (which will be released on July 1, according to Mercurial's release schedule). This makes it as stable as one could like, I think.\n\n**edit**: yikes, let me clean out that junk from the spkg, hang on...",
    "created_at": "2011-06-14T18:19:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109949",
    "user": "https://github.com/kini"
}
```

Replying to [comment:19 jdemeyer]:
> Replying to [comment:17 kini]:
> > Do we really need a compelling reason to upgrade packages we ship, when possible?
> 
> I think we do, I don't think we should simply upgrade packages for the sake of upgrading.  I think the incompatibility with older versions of Mercurial is a negative point for upgrading Mercurial.  Only if there is a particular feature of Mercurial 1.8.4 which is really useful, then I think we should upgrade.

This is not a backwards-incompatible change in 1.7 -- it is a forward-incompatibility in 1.6.x. In the current state of affairs, the sage scripts cannot properly handle packages created by the user's system Mercurial, for many users whose system Mercurial is "too new" for Sage (and this proportion will only increase with time). If we upgrade Mercurial in Sage, the user's system Mercurial may not be able to handle packages created by the sage scripts, but this is not a problem because in those cases the user can do `echo alias hg="sage -hg" >> ~/.bashrc` and go on with their life. The proportion of users for which this will be a problem will only decrease with time. Also, rather than being an inconvenience, this will actually improve the user's life, since they have access to a newer version of Mercurial than they would otherwise. If we *don't* upgrade, we run into situations where you need to clone an entire repository with `--config format.dotencode=False` before you can run Sage's packaging tools on it, because they all use Sage's Mercurial. The proportion of users who encounter this problem will only *increase* with time, and I suspect that developers (i.e. the usual users of Mercurial) number in this population with more likelihood than average users.

So upgrading Mercurial would help more than it would hurt. But even if it helped exactly as much as it hurt in terms of this repository format issue, software isn't perfect. Newer versions fix bugs that existed in older versions. While newer versions may include new bugs, those too will be fixed in the future. Sitting tight on an old version of software is not safer than following the latest stable releases. I'm not advocating updating to bleeding-edge nightly builds or anything; 1.8.4 was released on June 1 and will be the final bugfix release before the feature release 1.9 (which will be released on July 1, according to Mercurial's release schedule). This makes it as stable as one could like, I think.

**edit**: yikes, let me clean out that junk from the spkg, hang on...



---

archive/issue_comments_109950.json:
```json
{
    "body": "OK, should be fixed. Sorry about that, that was some vim detritus...",
    "created_at": "2011-06-14T18:23:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109950",
    "user": "https://github.com/kini"
}
```

OK, should be fixed. Sorry about that, that was some vim detritus...



---

archive/issue_comments_109951.json:
```json
{
    "body": "Reviewing....\nIf anyone else wnats to test this package, by all means help review.",
    "created_at": "2011-06-16T23:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109951",
    "user": "https://trac.sagemath.org/admin/accounts/users/ryan"
}
```

Reviewing....
If anyone else wnats to test this package, by all means help review.



---

archive/issue_comments_109952.json:
```json
{
    "body": "The package install fine and none of the hg self-tests fail.  Positive review",
    "created_at": "2011-06-17T00:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109952",
    "user": "https://trac.sagemath.org/admin/accounts/users/ryan"
}
```

The package install fine and none of the hg self-tests fail.  Positive review



---

archive/issue_comments_109953.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-06-17T00:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109953",
    "user": "https://trac.sagemath.org/admin/accounts/users/ryan"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_109954.json:
```json
{
    "body": "A full review of this spkg should probably include a runthrough of `sage -bdist`, `sage -sdist`, and friends. I can easily believe that hg's self-tests are successful and that Mercurial builds properly from my spkg; what is less clear is whether the newer version of Mercurial breaks any of Sage's various shell scripts that currently use it to do various mysterious things during release management and other such activities. It looks like Jeroen has the spkg in 4.7.1.alpha4 as of right now, though, so I'm guessing he's testing these things at the moment.",
    "created_at": "2011-06-17T01:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109954",
    "user": "https://github.com/kini"
}
```

A full review of this spkg should probably include a runthrough of `sage -bdist`, `sage -sdist`, and friends. I can easily believe that hg's self-tests are successful and that Mercurial builds properly from my spkg; what is less clear is whether the newer version of Mercurial breaks any of Sage's various shell scripts that currently use it to do various mysterious things during release management and other such activities. It looks like Jeroen has the spkg in 4.7.1.alpha4 as of right now, though, so I'm guessing he's testing these things at the moment.



---

archive/issue_comments_109955.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-06-17T01:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109955",
    "user": "https://trac.sagemath.org/admin/accounts/users/ryan"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_109956.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-17T04:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109956",
    "user": "https://trac.sagemath.org/admin/accounts/users/ryan"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_109957.json:
```json
{
    "body": "setting back to needs review.  If jdemeyer is reviewing this, he can set it back to positive review when he is finished.\n\nAs I was testing this, my sage installation got corrupted (not related to this review).  So I wasn't able finish testing -bdist and -sdist",
    "created_at": "2011-06-17T04:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109957",
    "user": "https://trac.sagemath.org/admin/accounts/users/ryan"
}
```

setting back to needs review.  If jdemeyer is reviewing this, he can set it back to positive review when he is finished.

As I was testing this, my sage installation got corrupted (not related to this review).  So I wasn't able finish testing -bdist and -sdist



---

archive/issue_comments_109958.json:
```json
{
    "body": "Replying to [comment:28 ryan]:\n> As I was testing this, my sage installation got corrupted (not related to this review).  So I wasn't able finish testing -bdist and -sdist\n\nWhy not do it on sage.math with a cleanly unpacked tarball? :)",
    "created_at": "2011-06-17T05:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109958",
    "user": "https://github.com/kini"
}
```

Replying to [comment:28 ryan]:
> As I was testing this, my sage installation got corrupted (not related to this review).  So I wasn't able finish testing -bdist and -sdist

Why not do it on sage.math with a cleanly unpacked tarball? :)



---

archive/issue_comments_109959.json:
```json
{
    "body": "Replying to [comment:29 kini]:\n> Replying to [comment:28 ryan]:\n> > As I was testing this, my sage installation got corrupted (not related to this review).  So I wasn't able finish testing -bdist and -sdist\n> \n> Why not do it on sage.math with a cleanly unpacked tarball? :)\n\nGood idea!  I will tomorrow :)",
    "created_at": "2011-06-17T05:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109959",
    "user": "https://trac.sagemath.org/admin/accounts/users/ryan"
}
```

Replying to [comment:29 kini]:
> Replying to [comment:28 ryan]:
> > As I was testing this, my sage installation got corrupted (not related to this review).  So I wasn't able finish testing -bdist and -sdist
> 
> Why not do it on sage.math with a cleanly unpacked tarball? :)

Good idea!  I will tomorrow :)



---

archive/issue_comments_109960.json:
```json
{
    "body": "Replying to [comment:28 ryan]:\n> setting back to needs review.  If jdemeyer is reviewing this, he can set it back to positive review when he is finished.\n\nI don't plan to formally review this.",
    "created_at": "2011-06-17T12:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109960",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:28 ryan]:
> setting back to needs review.  If jdemeyer is reviewing this, he can set it back to positive review when he is finished.

I don't plan to formally review this.



---

archive/issue_comments_109961.json:
```json
{
    "body": "-bdist and -sdist both run without errors on my machine with the updated spkg.\n\nAny other tests that should be run?",
    "created_at": "2011-06-18T22:13:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109961",
    "user": "https://trac.sagemath.org/admin/accounts/users/ryan"
}
```

-bdist and -sdist both run without errors on my machine with the updated spkg.

Any other tests that should be run?



---

archive/issue_comments_109962.json:
```json
{
    "body": "Other than those, maybe `-merge` and `-combinat` if you're familiar with them. Also, this spkg resolves #11121 and #11120 as well, so those need to be reviewed as well...",
    "created_at": "2011-06-19T00:31:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109962",
    "user": "https://github.com/kini"
}
```

Other than those, maybe `-merge` and `-combinat` if you're familiar with them. Also, this spkg resolves #11121 and #11120 as well, so those need to be reviewed as well...



---

archive/issue_comments_109963.json:
```json
{
    "body": "This seems to work, from scratch and in an upgrade, although I've asked some questions on #11120 and #11121.",
    "created_at": "2011-06-22T00:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109963",
    "user": "https://github.com/jhpalmieri"
}
```

This seems to work, from scratch and in an upgrade, although I've asked some questions on #11120 and #11121.



---

archive/issue_comments_109964.json:
```json
{
    "body": "I'm happy with this, so I'm setting it to \"positive review\".",
    "created_at": "2011-07-01T18:20:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109964",
    "user": "https://github.com/jhpalmieri"
}
```

I'm happy with this, so I'm setting it to "positive review".



---

archive/issue_comments_109965.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-07-01T18:20:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109965",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_109966.json:
```json
{
    "body": "By the way, I just had the opposite issue to that raised in [comment:13 comment 13]: someone prepared an spkg for Sage using their system version of mercurial, and I couldn't check the repo with the version in Sage because the one in Sage is too old.  I don't know enough about Mercurial to give instructions about how to repair their repo, so I could only check it by installing the spkg on this ticket.\n\nSo I think we should merge this in 4.7.2, not delay it further.",
    "created_at": "2011-07-19T17:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109966",
    "user": "https://github.com/jhpalmieri"
}
```

By the way, I just had the opposite issue to that raised in [comment:13 comment 13]: someone prepared an spkg for Sage using their system version of mercurial, and I couldn't check the repo with the version in Sage because the one in Sage is too old.  I don't know enough about Mercurial to give instructions about how to repair their repo, so I could only check it by installing the spkg on this ticket.

So I think we should merge this in 4.7.2, not delay it further.



---

archive/issue_comments_109967.json:
```json
{
    "body": "Replying to [comment:38 jhpalmieri]:\n> So I think we should merge this in 4.7.2, not delay it further.\n\nSure!",
    "created_at": "2011-07-19T17:54:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109967",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:38 jhpalmieri]:
> So I think we should merge this in 4.7.2, not delay it further.

Sure!



---

archive/issue_comments_109968.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-07-22T12:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109968",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_109969.json:
```json
{
    "body": "> In a Sage shell (\"sage -sh\"), unpack the spkg and go into the `src` directory. There, you can build the package (just do `make all`) and then run Mercurial's built-in tests: `make tests`.\n\nThere is currently no spkg-check here.  If they have tests, we might as well add one.  This is #11701.",
    "created_at": "2011-08-18T15:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109969",
    "user": "https://github.com/kcrisman"
}
```

> In a Sage shell ("sage -sh"), unpack the spkg and go into the `src` directory. There, you can build the package (just do `make all`) and then run Mercurial's built-in tests: `make tests`.

There is currently no spkg-check here.  If they have tests, we might as well add one.  This is #11701.



---

archive/issue_comments_109970.json:
```json
{
    "body": "Could any of the authors here please have a look at #12058: Mercurial should not enable pager by default.",
    "created_at": "2011-11-19T22:09:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10541#issuecomment-109970",
    "user": "https://github.com/jdemeyer"
}
```

Could any of the authors here please have a look at #12058: Mercurial should not enable pager by default.
