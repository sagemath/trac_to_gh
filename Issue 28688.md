# Issue 28688: Modify clean_stale_files to support modularization of sagelib by namespace packages

archive/issues_028688.json:
```json
{
    "body": "CC:  isuruf embray jdemeyer dimpase dcoudert vdelecroix vbraun @tobiasdiez fbissey\n\nAs discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of namespace packages - See \u200bhttps://packaging.python.org/guides/packaging-namespace-packages/\n\nOne obstacle to using namespace packages is that `src/setup.py` (`clean_stale_files`) deletes unknown files in the installation tree (`$SAGE_LIB/sage` = `..../site-packages/sage`). This would remove installed namespace packages within the `sage` package.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28925\n\n",
    "created_at": "2019-12-30T01:31:06Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Modify clean_stale_files to support modularization of sagelib by namespace packages",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28688",
    "user": "mkoeppe"
}
```
CC:  isuruf embray jdemeyer dimpase dcoudert vdelecroix vbraun @tobiasdiez fbissey

As discussed in #28175 and https://github.com/mkoeppe/sage-numerical-backends-coin/pull/4, it may be useful to modularize sage by the use of namespace packages - See â€‹https://packaging.python.org/guides/packaging-namespace-packages/

One obstacle to using namespace packages is that `src/setup.py` (`clean_stale_files`) deletes unknown files in the installation tree (`$SAGE_LIB/sage` = `..../site-packages/sage`). This would remove installed namespace packages within the `sage` package.

Issue created by migration from https://trac.sagemath.org/ticket/28925





---

archive/issue_comments_405174.json:
```json
{
    "body": "pushing these forward to 9.2",
    "created_at": "2020-04-14T06:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405174",
    "user": "mkoeppe"
}
```

pushing these forward to 9.2



---

archive/issue_comments_405175.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-05-20T04:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405175",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_405176.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-20T05:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405176",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405177.json:
```json
{
    "body": "Next steps: adjust the cleaner, find Cython sources",
    "created_at": "2020-05-20T05:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405177",
    "user": "mkoeppe"
}
```

Next steps: adjust the cleaner, find Cython sources



---

archive/issue_comments_405178.json:
```json
{
    "body": "The Cython source finder could perhaps also parse a new directive that controls `OptionalExtension` behavior (until we get rid of `OptionalExtension` altogether in #29701) so that we can get rid of `module_list.py` completely (see #29706)",
    "created_at": "2020-05-20T05:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405178",
    "user": "mkoeppe"
}
```

The Cython source finder could perhaps also parse a new directive that controls `OptionalExtension` behavior (until we get rid of `OptionalExtension` altogether in #29701) so that we can get rid of `module_list.py` completely (see #29706)



---

archive/issue_comments_405179.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-20T22:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405179",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405180.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-21T04:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405180",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405181.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-02T00:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405181",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405182.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-02T00:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405182",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_405183.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-02T02:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405183",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405184.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-02T02:01:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405184",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405185.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-02T02:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405185",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405186.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2020-06-02T07:07:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405186",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_405187.json:
```json
{
    "body": "Next: Fix `find_extra_files` so that it finds the `.pxd` files in `sage.numerical.backends`",
    "created_at": "2020-06-02T07:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405187",
    "user": "mkoeppe"
}
```

Next: Fix `find_extra_files` so that it finds the `.pxd` files in `sage.numerical.backends`



---

archive/issue_comments_405188.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-03T01:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405188",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_405189.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-03T02:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405189",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405190.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-03T02:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405190",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405191.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-03T03:07:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405191",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405192.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-03T03:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405192",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405193.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-03T03:49:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405193",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405194.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-06-10T02:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405194",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_405195.json:
```json
{
    "body": "Squashed some commits",
    "created_at": "2020-06-10T02:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405195",
    "user": "mkoeppe"
}
```

Squashed some commits



---

archive/issue_comments_405196.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-10T02:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405196",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_405197.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-06-10T03:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405197",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_405198.json:
```json
{
    "body": "Rebased on top of #29701",
    "created_at": "2020-06-10T03:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405198",
    "user": "mkoeppe"
}
```

Rebased on top of #29701



---

archive/issue_comments_405199.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-16T20:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405199",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405200.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-08-18T02:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405200",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_405201.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-08-18T02:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405201",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_405202.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-18T04:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405202",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405203.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-09-09T01:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405203",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_405204.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-10-16T22:39:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405204",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_405205.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-10-17T00:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405205",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_405206.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T01:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405206",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405207.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-10-17T01:57:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405207",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_405208.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T02:19:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405208",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405209.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T04:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405209",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405210.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T17:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405210",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405211.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T18:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405211",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405212.json:
```json
{
    "body": "Ready for review",
    "created_at": "2020-10-17T18:23:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405212",
    "user": "mkoeppe"
}
```

Ready for review



---

archive/issue_comments_405213.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T18:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405213",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405214.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T21:54:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405214",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405215.json:
```json
{
    "body": "What's the advantage/reason to introduce the sage-specific namespace/nonamespace convention instead of following PEP 420 and keep the `__init__.py` file as a marker for namespace packages together with `setuptools.find_namespace_packages()`?",
    "created_at": "2020-10-18T09:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405215",
    "user": "@tobiasdiez"
}
```

What's the advantage/reason to introduce the sage-specific namespace/nonamespace convention instead of following PEP 420 and keep the `__init__.py` file as a marker for namespace packages together with `setuptools.find_namespace_packages()`?



---

archive/issue_comments_405216.json:
```json
{
    "body": "Replying to [comment:84 gh-tobiasdiez]:\n> What's the advantage/reason to introduce the sage-specific namespace/nonamespace convention instead of following PEP 420 and keep the `__init__.py` file as a marker for namespace packages together with `setuptools.find_namespace_packages()`?\n\nOne **cannot** keep `__init__.py` for native namespace packages. PEP 420 is quite clear about it. Sub-packages of namespace packages do have `__init__.py`; and also the present ticket keeps them.",
    "created_at": "2020-10-19T21:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405216",
    "user": "mkoeppe"
}
```

Replying to [comment:84 gh-tobiasdiez]:
> What's the advantage/reason to introduce the sage-specific namespace/nonamespace convention instead of following PEP 420 and keep the `__init__.py` file as a marker for namespace packages together with `setuptools.find_namespace_packages()`?

One **cannot** keep `__init__.py` for native namespace packages. PEP 420 is quite clear about it. Sub-packages of namespace packages do have `__init__.py`; and also the present ticket keeps them.



---

archive/issue_comments_405217.json:
```json
{
    "body": "`find_namespace_packages` accepts any directory as a package directory:\n\n```\nclass PEP420PackageFinder(PackageFinder):\n    @staticmethod\n    def _looks_like_package(path):\n        return True\n```\n\n(https://github.com/pypa/setuptools/blob/f991fbb3c9d0e10a0a78ae2b508b3fd99f9cdef2/setuptools/__init__.py#L110)\n\nBut our source tree has some directories that should not be considered package directories. I have marked these with the `nonamespace` file.\n\nHaving both `nonamespace` and `namespace` files results in simpler changes to the existing code.",
    "created_at": "2020-10-19T21:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405217",
    "user": "mkoeppe"
}
```

`find_namespace_packages` accepts any directory as a package directory:

```
class PEP420PackageFinder(PackageFinder):
    @staticmethod
    def _looks_like_package(path):
        return True
```

(https://github.com/pypa/setuptools/blob/f991fbb3c9d0e10a0a78ae2b508b3fd99f9cdef2/setuptools/__init__.py#L110)

But our source tree has some directories that should not be considered package directories. I have marked these with the `nonamespace` file.

Having both `nonamespace` and `namespace` files results in simpler changes to the existing code.



---

archive/issue_comments_405218.json:
```json
{
    "body": "Oh ok, sorry, I've misunderstood the ticket description. You are of course right, implicit namespace packages don't have a `__init__.py` file.\n\nConcerning the package discovery, I would still prefer using `setuptools.find_namespace_packages()`, and then filter out unwanted folders based on a hard-coded list. The `(no)namespace` files just add complexity (especially for new developers). They are also very similar to the explicit declaration of namespace packages proposed by [PEP 382](https://www.python.org/dev/peps/pep-0382/), which was rejected in favor of PEP 420.\n\nIf you do prefer to have these files, I would like to ask you to add documentation to the dev docs.",
    "created_at": "2020-10-19T22:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405218",
    "user": "@tobiasdiez"
}
```

Oh ok, sorry, I've misunderstood the ticket description. You are of course right, implicit namespace packages don't have a `__init__.py` file.

Concerning the package discovery, I would still prefer using `setuptools.find_namespace_packages()`, and then filter out unwanted folders based on a hard-coded list. The `(no)namespace` files just add complexity (especially for new developers). They are also very similar to the explicit declaration of namespace packages proposed by [PEP 382](https://www.python.org/dev/peps/pep-0382/), which was rejected in favor of PEP 420.

If you do prefer to have these files, I would like to ask you to add documentation to the dev docs.



---

archive/issue_comments_405219.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-20T03:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405219",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405220.json:
```json
{
    "body": "Replying to [comment:87 gh-tobiasdiez]:\n> Concerning the package discovery, I would still prefer using `setuptools.find_namespace_packages()`, and then filter out unwanted folders based on a hard-coded list. The `(no)namespace` files just add complexity (especially for new developers). They are also very similar to the explicit declaration of namespace packages proposed by [PEP 382](https://www.python.org/dev/peps/pep-0382/), which was rejected in favor of PEP 420.\n\nThanks for the input and the pointer to PEP 382.\nI'll try out if your suggestion can be implemented without major changes.",
    "created_at": "2020-10-20T03:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405220",
    "user": "mkoeppe"
}
```

Replying to [comment:87 gh-tobiasdiez]:
> Concerning the package discovery, I would still prefer using `setuptools.find_namespace_packages()`, and then filter out unwanted folders based on a hard-coded list. The `(no)namespace` files just add complexity (especially for new developers). They are also very similar to the explicit declaration of namespace packages proposed by [PEP 382](https://www.python.org/dev/peps/pep-0382/), which was rejected in favor of PEP 420.

Thanks for the input and the pointer to PEP 382.
I'll try out if your suggestion can be implemented without major changes.



---

archive/issue_comments_405221.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-10-20T03:20:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405221",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_405222.json:
```json
{
    "body": "TBD: In incremental builds, the cleaner fails to remove previously installed `__init__.py` files:\n\n```\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 343, in sage_setup.find.installed_files_by_module\nFailed example:\n    files_by_module['sage.graphs.graph_decompositions']\nExpected nothing\nGot:\n    {'sage/graphs/graph_decompositions/__init__.py',\n     'sage/graphs/graph_decompositions/__pycache__/__init__.cpython-37.pyc'}\n**********************************************************************\n```\n",
    "created_at": "2020-10-20T03:20:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405222",
    "user": "mkoeppe"
}
```

TBD: In incremental builds, the cleaner fails to remove previously installed `__init__.py` files:

```
**********************************************************************
File "src/sage_setup/find.py", line 343, in sage_setup.find.installed_files_by_module
Failed example:
    files_by_module['sage.graphs.graph_decompositions']
Expected nothing
Got:
    {'sage/graphs/graph_decompositions/__init__.py',
     'sage/graphs/graph_decompositions/__pycache__/__init__.cpython-37.pyc'}
**********************************************************************
```




---

archive/issue_comments_405223.json:
```json
{
    "body": "Note that one annoying thing about `find_namespace_packages` when applied to our source tree is that we have lots of directories that do not contain any python files, leading to output like this from distutils:\n\n```\n[sagelib-9.2.rc2] package init file 'sage/schemes/generic/notes/__init__.py' not found (or not a regular file)\n```\n\nThe branch on this ticket handles such directories specially (no need for `nonamespace` files there). If there is a solution that could silence these notes, the code could be brought closer to `find_namespace_packages` behavior.",
    "created_at": "2020-10-20T04:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405223",
    "user": "mkoeppe"
}
```

Note that one annoying thing about `find_namespace_packages` when applied to our source tree is that we have lots of directories that do not contain any python files, leading to output like this from distutils:

```
[sagelib-9.2.rc2] package init file 'sage/schemes/generic/notes/__init__.py' not found (or not a regular file)
```

The branch on this ticket handles such directories specially (no need for `nonamespace` files there). If there is a solution that could silence these notes, the code could be brought closer to `find_namespace_packages` behavior.



---

archive/issue_comments_405224.json:
```json
{
    "body": "`find_namespace_packages` excepts `include` and `exclude` directories as arguments. So one option would be to get a list of all folders not including any python files, and pass this as `exclude` (or the same approach using a whitelist).",
    "created_at": "2020-10-20T08:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405224",
    "user": "@tobiasdiez"
}
```

`find_namespace_packages` excepts `include` and `exclude` directories as arguments. So one option would be to get a list of all folders not including any python files, and pass this as `exclude` (or the same approach using a whitelist).



---

archive/issue_comments_405225.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd111\".",
    "created_at": "2020-12-06T17:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405225",
    "user": "mkoeppe"
}
```

Changing keywords from "" to "sd111".



---

archive/issue_comments_405226.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-09T05:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405226",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405227.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405227",
    "user": "mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_405228.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405228",
    "user": "mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_405229.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-11-26T23:21:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405229",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_405230.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-11-26T23:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405230",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_405231.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-11-27T22:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405231",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_405232.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-12-11T04:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405232",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_405233.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-11T05:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405233",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405234.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-11T06:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405234",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405235.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-11T06:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405235",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405236.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-16T19:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405236",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405237.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-16T21:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405237",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405238.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-16T22:04:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405238",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405239.json:
```json
{
    "body": "Replying to [comment:89 mkoeppe]:\n> Replying to [comment:87 gh-tobiasdiez]:\n> > Concerning the package discovery, I would still prefer using `setuptools.find_namespace_packages()`, and then filter out unwanted folders based on a hard-coded list. The `(no)namespace` files just add complexity (especially for new developers). They are also very similar to the explicit declaration of namespace packages proposed by [PEP 382](https://www.python.org/dev/peps/pep-0382/), which was rejected in favor of PEP 420.\n> \n> Thanks for the input and the pointer to PEP 382.\n> I'll try out if your suggestion can be implemented without major changes.\n\nDone now via #33033.",
    "created_at": "2021-12-16T22:09:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405239",
    "user": "mkoeppe"
}
```

Replying to [comment:89 mkoeppe]:
> Replying to [comment:87 gh-tobiasdiez]:
> > Concerning the package discovery, I would still prefer using `setuptools.find_namespace_packages()`, and then filter out unwanted folders based on a hard-coded list. The `(no)namespace` files just add complexity (especially for new developers). They are also very similar to the explicit declaration of namespace packages proposed by [PEP 382](https://www.python.org/dev/peps/pep-0382/), which was rejected in favor of PEP 420.
> 
> Thanks for the input and the pointer to PEP 382.
> I'll try out if your suggestion can be implemented without major changes.

Done now via #33033.



---

archive/issue_comments_405240.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-16T23:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405240",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_405241.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-16T23:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405241",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405242.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-12-17T00:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405242",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_405243.json:
```json
{
    "body": "Rebased away from #32927.",
    "created_at": "2021-12-17T00:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405243",
    "user": "mkoeppe"
}
```

Rebased away from #32927.



---

archive/issue_comments_405244.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-17T06:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405244",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405245.json:
```json
{
    "body": "Replying to [comment:115 mkoeppe]:\n> Replying to [comment:89 mkoeppe]:\n> > Replying to [comment:87 gh-tobiasdiez]:\n> > > Concerning the package discovery, I would still prefer using `setuptools.find_namespace_packages()`, and then filter out unwanted folders based on a hard-coded list. The `(no)namespace` files just add complexity (especially for new developers). They are also very similar to the explicit declaration of namespace packages proposed by [PEP 382](https://www.python.org/dev/peps/pep-0382/), which was rejected in favor of PEP 420.\n> > \n> > Thanks for the input and the pointer to PEP 382.\n> > I'll try out if your suggestion can be implemented without major changes.\n> \n> Done now via #33033.\n\nProbably I'm missing something here. The new mechanism seems to still rely on indicator/marker files, just that the are now named `all__`. Except for the different name this seems to be exactly the approach of the rejected PEP 382.\nThe point of my proposal was that only the setup file should know/decide on which packages it want to include and exclude. Then the general helper in #33033 would like\n\n```\nis_namespace_package(dir):\n   return dir in setuptools.find_namespace_packages(include=..., exclude=...)\n```\n\nAnd the setup.cfg would use https://setuptools.pypa.io/en/latest/userguide/package_discovery.html.",
    "created_at": "2021-12-17T12:45:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405245",
    "user": "@tobiasdiez"
}
```

Replying to [comment:115 mkoeppe]:
> Replying to [comment:89 mkoeppe]:
> > Replying to [comment:87 gh-tobiasdiez]:
> > > Concerning the package discovery, I would still prefer using `setuptools.find_namespace_packages()`, and then filter out unwanted folders based on a hard-coded list. The `(no)namespace` files just add complexity (especially for new developers). They are also very similar to the explicit declaration of namespace packages proposed by [PEP 382](https://www.python.org/dev/peps/pep-0382/), which was rejected in favor of PEP 420.
> > 
> > Thanks for the input and the pointer to PEP 382.
> > I'll try out if your suggestion can be implemented without major changes.
> 
> Done now via #33033.

Probably I'm missing something here. The new mechanism seems to still rely on indicator/marker files, just that the are now named `all__`. Except for the different name this seems to be exactly the approach of the rejected PEP 382.
The point of my proposal was that only the setup file should know/decide on which packages it want to include and exclude. Then the general helper in #33033 would like

```
is_namespace_package(dir):
   return dir in setuptools.find_namespace_packages(include=..., exclude=...)
```

And the setup.cfg would use https://setuptools.pypa.io/en/latest/userguide/package_discovery.html.



---

archive/issue_comments_405246.json:
```json
{
    "body": "Replying to [comment:122 gh-tobiasdiez]:\n> The new mechanism seems to still rely on indicator/marker files, just that the are now named `all__`. Except for the different name this seems to be exactly the approach of the rejected PEP 382.\n\nThat's certainly true, but at least the Sage source tree already has these files",
    "created_at": "2021-12-17T16:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405246",
    "user": "mkoeppe"
}
```

Replying to [comment:122 gh-tobiasdiez]:
> The new mechanism seems to still rely on indicator/marker files, just that the are now named `all__`. Except for the different name this seems to be exactly the approach of the rejected PEP 382.

That's certainly true, but at least the Sage source tree already has these files



---

archive/issue_comments_405247.json:
```json
{
    "body": "Replying to [comment:122 gh-tobiasdiez]:\n> The point of my proposal was that only the setup file should know/decide on which packages it want to include and exclude. Then the general helper in #33033 would like\n> {{{\n> is_namespace_package(dir):\n>    return dir in setuptools.find_namespace_packages(include=..., exclude=...)\n> }}}\n\nThe helper function is added in #33033 for runtime use (doctesting). Doctesting needs to be able to work on (a) Sage source trees, (b) installed Sage packages (this is important, for example, for the downstream packagers), (c) arbitrary files. \nHardcoding inclusions and exclusions in the helper function seems a bit unmodular",
    "created_at": "2021-12-17T16:23:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405247",
    "user": "mkoeppe"
}
```

Replying to [comment:122 gh-tobiasdiez]:
> The point of my proposal was that only the setup file should know/decide on which packages it want to include and exclude. Then the general helper in #33033 would like
> {{{
> is_namespace_package(dir):
>    return dir in setuptools.find_namespace_packages(include=..., exclude=...)
> }}}

The helper function is added in #33033 for runtime use (doctesting). Doctesting needs to be able to work on (a) Sage source trees, (b) installed Sage packages (this is important, for example, for the downstream packagers), (c) arbitrary files. 
Hardcoding inclusions and exclusions in the helper function seems a bit unmodular



---

archive/issue_comments_405248.json:
```json
{
    "body": "In the end it comes down to who should have the control:\n- Should the doctest code decide what to test, and the setup.py/cfg file what to distribute and the sage startup script what to expose\n- or should the module/package be responsible to declare that it should be tested, distributed and exposed\n\nCurrently, this ticket (and the related ones) go in the direction of the second approach by using `all.py`. For me, using inversion of control and following the first approach seems more natural and flexible. Since you have a better overview though, I trust your judgement.",
    "created_at": "2021-12-17T17:56:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405248",
    "user": "@tobiasdiez"
}
```

In the end it comes down to who should have the control:
- Should the doctest code decide what to test, and the setup.py/cfg file what to distribute and the sage startup script what to expose
- or should the module/package be responsible to declare that it should be tested, distributed and exposed

Currently, this ticket (and the related ones) go in the direction of the second approach by using `all.py`. For me, using inversion of control and following the first approach seems more natural and flexible. Since you have a better overview though, I trust your judgement.



---

archive/issue_comments_405249.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-23T06:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405249",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405250.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-14T03:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405250",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405251.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-14T04:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405251",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405252.json:
```json
{
    "body": "All dependencies are merged",
    "created_at": "2022-02-14T04:47:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405252",
    "user": "mkoeppe"
}
```

All dependencies are merged



---

archive/issue_comments_405253.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-14T06:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405253",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405254.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2022-02-22T02:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405254",
    "user": "mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_405255.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-13T17:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405255",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405256.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-13T18:04:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405256",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405257.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-29T16:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405257",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405258.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-05T17:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405258",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405259.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-05-05T17:45:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405259",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_405260.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-05-06T16:37:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405260",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_405261.json:
```json
{
    "body": "The failure in `src/sage/interfaces/expect.py` shown by the patchbot is unrelated.\nReady for review",
    "created_at": "2022-05-09T18:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405261",
    "user": "mkoeppe"
}
```

The failure in `src/sage/interfaces/expect.py` shown by the patchbot is unrelated.
Ready for review



---

archive/issue_comments_405262.json:
```json
{
    "body": "should one `exclude` not only *.so, but *.dylib, too?",
    "created_at": "2022-05-10T22:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405262",
    "user": "dimpase"
}
```

should one `exclude` not only *.so, but *.dylib, too?



---

archive/issue_comments_405263.json:
```json
{
    "body": "On macOS, the compiled python modules are also .so, not .dylib.",
    "created_at": "2022-05-10T22:26:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405263",
    "user": "mkoeppe"
}
```

On macOS, the compiled python modules are also .so, not .dylib.



---

archive/issue_comments_405264.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-29T23:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405264",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405265.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-08T06:48:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405265",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405266.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-09T18:54:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405266",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405267.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-12T18:46:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405267",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405268.json:
```json
{
    "body": "Sorry for my ignorance, but I am unable to merge this ticket:\n\n```\n% git clone -c core.symlinks=true --branch develop --tags https://github.com/sagemath/sage.git\n[...]\n% cd sage\n% git-trac-merge 28925\n\n#28925\nremote branch: u/mkoeppe/modify_find_python_sources__clean_stale_files_to_support_modularization_of_sagelib_by_native_namespace_packages__pep_420_\n\nFrom git://trac.sagemath.org/sage\n * branch                  u/mkoeppe/modify_find_python_sources__clean_stale_files_to_support_modularization_of_sagelib_by_native_namespace_packages__pep_420_ -> FETCH_HEAD\n * [new branch]            u/mkoeppe/modify_find_python_sources__clean_stale_files_to_support_modularization_of_sagelib_by_native_namespace_packages__pep_420_ -> trac/u/mkoeppe/modify_find_python_sources__clean_stale_files_to_support_modularization_of_sagelib_by_native_namespace_packages__pep_420_\n\nAuto-merging build/pkgs/sage_setup/dependencies\nCONFLICT (content): Merge conflict in build/pkgs/sage_setup/dependencies\nAutomatic merge failed; fix conflicts and then commit the result.\n% \n```\n",
    "created_at": "2022-06-21T13:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405268",
    "user": "@GMS103"
}
```

Sorry for my ignorance, but I am unable to merge this ticket:

```
% git clone -c core.symlinks=true --branch develop --tags https://github.com/sagemath/sage.git
[...]
% cd sage
% git-trac-merge 28925

#28925
remote branch: u/mkoeppe/modify_find_python_sources__clean_stale_files_to_support_modularization_of_sagelib_by_native_namespace_packages__pep_420_

From git://trac.sagemath.org/sage
 * branch                  u/mkoeppe/modify_find_python_sources__clean_stale_files_to_support_modularization_of_sagelib_by_native_namespace_packages__pep_420_ -> FETCH_HEAD
 * [new branch]            u/mkoeppe/modify_find_python_sources__clean_stale_files_to_support_modularization_of_sagelib_by_native_namespace_packages__pep_420_ -> trac/u/mkoeppe/modify_find_python_sources__clean_stale_files_to_support_modularization_of_sagelib_by_native_namespace_packages__pep_420_

Auto-merging build/pkgs/sage_setup/dependencies
CONFLICT (content): Merge conflict in build/pkgs/sage_setup/dependencies
Automatic merge failed; fix conflicts and then commit the result.
% 
```




---

archive/issue_comments_405269.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-25T18:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405269",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405270.json:
```json
{
    "body": "I've resolved the merge conflict",
    "created_at": "2022-06-25T18:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405270",
    "user": "mkoeppe"
}
```

I've resolved the merge conflict



---

archive/issue_comments_405271.json:
```json
{
    "body": "Not used import?\n\n```diff\ndiff --git a/pkgs/sagemath-objects/setup.py b/pkgs/sagemath-objects/setup.py\nindex 124f0cb218..907cabef83 100644\n--- a/pkgs/sagemath-objects/setup.py\n+++ b/pkgs/sagemath-objects/setup.py\n@@ -42,7 +42,7 @@ if sdist:\n     python_modules = []\n     cython_modules = []\n else:\n-    from sage_setup.find import find_python_sources, is_package_or_namespace_package_dir\n+    from sage_setup.find import find_python_sources\n     python_packages, python_modules, cython_modules = find_python_sources(\n         '.', ['sage'])   # for now, we do the filtering using MANIFEST\n```\n",
    "created_at": "2022-06-30T01:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405271",
    "user": "klee"
}
```

Not used import?

```diff
diff --git a/pkgs/sagemath-objects/setup.py b/pkgs/sagemath-objects/setup.py
index 124f0cb218..907cabef83 100644
--- a/pkgs/sagemath-objects/setup.py
+++ b/pkgs/sagemath-objects/setup.py
@@ -42,7 +42,7 @@ if sdist:
     python_modules = []
     cython_modules = []
 else:
-    from sage_setup.find import find_python_sources, is_package_or_namespace_package_dir
+    from sage_setup.find import find_python_sources
     python_packages, python_modules, cython_modules = find_python_sources(
         '.', ['sage'])   # for now, we do the filtering using MANIFEST
```




---

archive/issue_comments_405272.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-01T00:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405272",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405273.json:
```json
{
    "body": "Thanks!\n\nAnd I have applied the change that left that import unused also to another file.",
    "created_at": "2022-07-01T00:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405273",
    "user": "mkoeppe"
}
```

Thanks!

And I have applied the change that left that import unused also to another file.



---

archive/issue_comments_405274.json:
```json
{
    "body": "Thanks. \n\nAnother comment: `clean_install_dir` and `find_extra_files` have a new argument `distributions`, but the docstrings do not explain it.",
    "created_at": "2022-07-01T01:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405274",
    "user": "klee"
}
```

Thanks. 

Another comment: `clean_install_dir` and `find_extra_files` have a new argument `distributions`, but the docstrings do not explain it.



---

archive/issue_comments_405275.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-01T01:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405275",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405276.json:
```json
{
    "body": "Thank you for the update.\n\nI have been testing (using) this ticket and and the sequel #33011 for a while. They works well. I checked the code as far as I can (not very far), and it looks good to me. \n\nIf we don't have further comments on this ticket, then it would better be tested by more developers in the wild by merging this now, so that we can fix problems before the next release.\n\nI will wait for your (not Matthias) meta comments, and proceed to \"positive review\" in a couple of days.",
    "created_at": "2022-07-04T02:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405276",
    "user": "klee"
}
```

Thank you for the update.

I have been testing (using) this ticket and and the sequel #33011 for a while. They works well. I checked the code as far as I can (not very far), and it looks good to me. 

If we don't have further comments on this ticket, then it would better be tested by more developers in the wild by merging this now, so that we can fix problems before the next release.

I will wait for your (not Matthias) meta comments, and proceed to "positive review" in a couple of days.



---

archive/issue_comments_405277.json:
```json
{
    "body": "Is this\n\n```\n./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'  \n```\n\nbroken? It doesn't work with (and without) this ticket.",
    "created_at": "2022-07-06T06:39:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405277",
    "user": "klee"
}
```

Is this

```
./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'  
```

broken? It doesn't work with (and without) this ticket.



---

archive/issue_comments_405278.json:
```json
{
    "body": "Replying to [comment:158 klee]:\n> Is this\n> {{{\n> ./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'  \n> }}}\n> broken? It doesn't work with (and without) this ticket.\n\nworks for me (after `make build` from a clean state done)",
    "created_at": "2022-07-06T09:00:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405278",
    "user": "dimpase"
}
```

Replying to [comment:158 klee]:
> Is this
> {{{
> ./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'  
> }}}
> broken? It doesn't work with (and without) this ticket.

works for me (after `make build` from a clean state done)



---

archive/issue_comments_405279.json:
```json
{
    "body": "Replying to [comment:159 dimpase]:\n> Replying to [comment:158 klee]:\n> > Is this\n> > {{{\n> > ./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'  \n> > }}}\n> > broken? It doesn't work with (and without) this ticket.\n> \n> works for me (after `make build` from a clean state done)\n\nI did `make distclean; make -j8; ./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'`. So this is clean.\n\nThis is the initial part that goes wrong:\n\n```\nsage -t --random-seed=251639358214975434990568781743714015030 --environment=sage.all__sagemath_categories /Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/structure/coerce_actions.pyx\n**********************************************************************\nFile \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/structure/coerce_actions.pyx\", line 58, in sage.structure.coerce_actions.GenericAction.__init__\nFailed example:\n    M = MatrixSpace(ZZ,2)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.structure.coerce_actions.GenericAction.__init__[0]>\", line 1, in <module>\n        M = MatrixSpace(ZZ,Integer(2))\n    NameError: name 'MatrixSpace' is not defined\n```\n\nAny clue? I am on Mac.",
    "created_at": "2022-07-06T09:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405279",
    "user": "klee"
}
```

Replying to [comment:159 dimpase]:
> Replying to [comment:158 klee]:
> > Is this
> > {{{
> > ./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'  
> > }}}
> > broken? It doesn't work with (and without) this ticket.
> 
> works for me (after `make build` from a clean state done)

I did `make distclean; make -j8; ./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'`. So this is clean.

This is the initial part that goes wrong:

```
sage -t --random-seed=251639358214975434990568781743714015030 --environment=sage.all__sagemath_categories /Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/structure/coerce_actions.pyx
**********************************************************************
File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/structure/coerce_actions.pyx", line 58, in sage.structure.coerce_actions.GenericAction.__init__
Failed example:
    M = MatrixSpace(ZZ,2)
Exception raised:
    Traceback (most recent call last):
      File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.structure.coerce_actions.GenericAction.__init__[0]>", line 1, in <module>
        M = MatrixSpace(ZZ,Integer(2))
    NameError: name 'MatrixSpace' is not defined
```

Any clue? I am on Mac.



---

archive/issue_comments_405280.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-07-06T10:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405280",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_405281.json:
```json
{
    "body": "I start from `git clean -fdx` - which cleans much more.\n\nYou'll probably want to move `upstream/` outside and after `git clean` make a symbolic link to it, otherwise it will re-download things.\n\nSo it's positive review from me.",
    "created_at": "2022-07-06T10:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405281",
    "user": "dimpase"
}
```

I start from `git clean -fdx` - which cleans much more.

You'll probably want to move `upstream/` outside and after `git clean` make a symbolic link to it, otherwise it will re-download things.

So it's positive review from me.



---

archive/issue_comments_405282.json:
```json
{
    "body": "Replying to [comment:161 dimpase]:\n> I start from `git clean -fdx` - which cleans much more.\n\nThanks. But it didn't help. As far as I understand, the doctest failures are expected. The real problem is:\n\n```python\n$ pkgs/sagemath-categories/.tox/py39/bin/python3.9 \nPython 3.9.13 (main, May 24 2022, 21:28:31) \n[Clang 13.1.6 (clang-1316.0.21.2)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> from sage.categories.category import Category\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages/sage/categories/category.py\", line 107, in <module>\n    from sage.misc.c3_controlled import _cmp_key, _cmp_key_named, C3_sorted_merge\n  File \"sage/misc/c3_controlled.pyx\", line 364, in init sage.misc.c3_controlled (build/cythonized/sage/misc/c3_controlled.c:11819)\n  File \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages/sage/structure/__init__.py\", line 2, in <module>\n    import sage.structure.element\n  File \"sage/structure/element.pyx\", line 1, in init sage.structure.element (build/cythonized/sage/structure/element.c:36204)\n  File \"sage/structure/category_object.pyx\", line 60, in init sage.structure.category_object (build/cythonized/sage/structure/category_object.c:9982)\nImportError: cannot import name Category\n```\n\nStrangely this works \n\n```python\nHera:sage-dev$ pkgs/sagemath-categories/.tox/py39/bin/python3.9 \nPython 3.9.13 (main, May 24 2022, 21:28:31) \n[Clang 13.1.6 (clang-1316.0.21.2)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> from sage.structure.sage_object import SageObject\n>>> from sage.categories.category import Category\n>>> \n```\n\n\nAnyway, this is not a problem of this ticket. The situation is the same without this ticket.\n\nHence my positive review to this ticket!",
    "created_at": "2022-07-06T12:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405282",
    "user": "klee"
}
```

Replying to [comment:161 dimpase]:
> I start from `git clean -fdx` - which cleans much more.

Thanks. But it didn't help. As far as I understand, the doctest failures are expected. The real problem is:

```python
$ pkgs/sagemath-categories/.tox/py39/bin/python3.9 
Python 3.9.13 (main, May 24 2022, 21:28:31) 
[Clang 13.1.6 (clang-1316.0.21.2)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> from sage.categories.category import Category
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages/sage/categories/category.py", line 107, in <module>
    from sage.misc.c3_controlled import _cmp_key, _cmp_key_named, C3_sorted_merge
  File "sage/misc/c3_controlled.pyx", line 364, in init sage.misc.c3_controlled (build/cythonized/sage/misc/c3_controlled.c:11819)
  File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages/sage/structure/__init__.py", line 2, in <module>
    import sage.structure.element
  File "sage/structure/element.pyx", line 1, in init sage.structure.element (build/cythonized/sage/structure/element.c:36204)
  File "sage/structure/category_object.pyx", line 60, in init sage.structure.category_object (build/cythonized/sage/structure/category_object.c:9982)
ImportError: cannot import name Category
```

Strangely this works 

```python
Hera:sage-dev$ pkgs/sagemath-categories/.tox/py39/bin/python3.9 
Python 3.9.13 (main, May 24 2022, 21:28:31) 
[Clang 13.1.6 (clang-1316.0.21.2)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> from sage.structure.sage_object import SageObject
>>> from sage.categories.category import Category
>>> 
```


Anyway, this is not a problem of this ticket. The situation is the same without this ticket.

Hence my positive review to this ticket!



---

archive/issue_comments_405283.json:
```json
{
    "body": "hmm, do you have the current directory, i.e. `.`, in your `PATH`? IMHO this might mess things up.",
    "created_at": "2022-07-06T14:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405283",
    "user": "dimpase"
}
```

hmm, do you have the current directory, i.e. `.`, in your `PATH`? IMHO this might mess things up.



---

archive/issue_comments_405284.json:
```json
{
    "body": "Replying to [comment:163 dimpase]:\n> hmm, do you have the current directory, i.e. `.`, in your `PATH`? IMHO this might mess things up.\n\nYes. But even after removing it from the path, it's the same. \n\n`./configure` shows `python3-3.10.3: using system package; SPKG will not be installed`, and\n\n\n```python\n$ pkgs/sagemath-categories/.tox/py39/bin/python3.9 \nPython 3.9.13 (main, May 24 2022, 21:28:31) \n[Clang 13.1.6 (clang-1316.0.21.2)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import sys\n>>> sys.path\n['', '/usr/local/Cellar/python@3.9/3.9.13_1/Frameworks/Python.framework/Versions/3.9/lib/python39.zip', '/usr/local/Cellar/python@3.9/3.9.13_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9', '/usr/local/Cellar/python@3.9/3.9.13_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/lib-dynload', '/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages']\n```\n\n\n```python\n$ pkgs/sagemath-categories/.tox/python/bin/python \nPython 3.10.4 (main, Apr 26 2022, 19:42:59) [Clang 13.1.6 (clang-1316.0.21.2)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import sys\n>>> sys.path\n['', '/usr/local/Cellar/python@3.10/3.10.4/Frameworks/Python.framework/Versions/3.10/lib/python310.zip', '/usr/local/Cellar/python@3.10/3.10.4/Frameworks/Python.framework/Versions/3.10/lib/python3.10', '/usr/local/Cellar/python@3.10/3.10.4/Frameworks/Python.framework/Versions/3.10/lib/python3.10/lib-dynload', '/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages']\n```\n",
    "created_at": "2022-07-06T14:56:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405284",
    "user": "klee"
}
```

Replying to [comment:163 dimpase]:
> hmm, do you have the current directory, i.e. `.`, in your `PATH`? IMHO this might mess things up.

Yes. But even after removing it from the path, it's the same. 

`./configure` shows `python3-3.10.3: using system package; SPKG will not be installed`, and


```python
$ pkgs/sagemath-categories/.tox/py39/bin/python3.9 
Python 3.9.13 (main, May 24 2022, 21:28:31) 
[Clang 13.1.6 (clang-1316.0.21.2)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import sys
>>> sys.path
['', '/usr/local/Cellar/python@3.9/3.9.13_1/Frameworks/Python.framework/Versions/3.9/lib/python39.zip', '/usr/local/Cellar/python@3.9/3.9.13_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9', '/usr/local/Cellar/python@3.9/3.9.13_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/lib-dynload', '/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages']
```


```python
$ pkgs/sagemath-categories/.tox/python/bin/python 
Python 3.10.4 (main, Apr 26 2022, 19:42:59) [Clang 13.1.6 (clang-1316.0.21.2)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import sys
>>> sys.path
['', '/usr/local/Cellar/python@3.10/3.10.4/Frameworks/Python.framework/Versions/3.10/lib/python310.zip', '/usr/local/Cellar/python@3.10/3.10.4/Frameworks/Python.framework/Versions/3.10/lib/python3.10', '/usr/local/Cellar/python@3.10/3.10.4/Frameworks/Python.framework/Versions/3.10/lib/python3.10/lib-dynload', '/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages']
```




---

archive/issue_comments_405285.json:
```json
{
    "body": "Replying to [comment:159 dimpase]:\n> Replying to [comment:158 klee]:\n> > Is this\n> > {{{\n> > ./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'  \n> > }}}\n> > broken? It doesn't work with (and without) this ticket.\n> \n> works for me (after `make build` from a clean state done)\n\nsagemath-categories (in contrast to sagemath-standard) does not need `make build` because all of its build and runtime dependencies can be found on PyPI.",
    "created_at": "2022-07-06T18:04:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405285",
    "user": "mkoeppe"
}
```

Replying to [comment:159 dimpase]:
> Replying to [comment:158 klee]:
> > Is this
> > {{{
> > ./sage -sh -c '(cd pkgs/sagemath-categories && tox -v -v -v)'  
> > }}}
> > broken? It doesn't work with (and without) this ticket.
> 
> works for me (after `make build` from a clean state done)

sagemath-categories (in contrast to sagemath-standard) does not need `make build` because all of its build and runtime dependencies can be found on PyPI.



---

archive/issue_comments_405286.json:
```json
{
    "body": "Replying to [comment:160 klee]:\n> This is the initial part that goes wrong:\n> {{{\n> sage -t --random-seed=251639358214975434990568781743714015030 --environment=sage.all__sagemath_categories /Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/structure/coerce_actions.pyx\n> **********************************************************************\n> File \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/structure/coerce_actions.pyx\", line 58, in sage.structure.coerce_actions.GenericAction.__init__\n> Failed example:\n>     M = MatrixSpace(ZZ,2)\n> Exception raised:\n>     Traceback (most recent call last):\n>       File \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n>         self.compile_and_execute(example, compiler, test.globs)\n>       File \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n>         exec(compiled, globs)\n>       File \"<doctest sage.structure.coerce_actions.GenericAction.__init__[0]>\", line 1, in <module>\n>         M = MatrixSpace(ZZ,Integer(2))\n>     NameError: name 'MatrixSpace' is not defined\n> }}}\n\n**sagemath-categories** as of this ticket does not contain src/sage/matrix/matrix_space.py (see `pkgs/sagemath-categories/MANIFEST.in`), so `MatrixSpace` is not available in `sage.all__sagemath_categories`.\n\nNote that the `tox` run ends with the message \"lots of doctest failures are expected\". This is one of them.",
    "created_at": "2022-07-06T18:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405286",
    "user": "mkoeppe"
}
```

Replying to [comment:160 klee]:
> This is the initial part that goes wrong:
> {{{
> sage -t --random-seed=251639358214975434990568781743714015030 --environment=sage.all__sagemath_categories /Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/structure/coerce_actions.pyx
> **********************************************************************
> File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/structure/coerce_actions.pyx", line 58, in sage.structure.coerce_actions.GenericAction.__init__
> Failed example:
>     M = MatrixSpace(ZZ,2)
> Exception raised:
>     Traceback (most recent call last):
>       File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
>         self.compile_and_execute(example, compiler, test.globs)
>       File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/python/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
>         exec(compiled, globs)
>       File "<doctest sage.structure.coerce_actions.GenericAction.__init__[0]>", line 1, in <module>
>         M = MatrixSpace(ZZ,Integer(2))
>     NameError: name 'MatrixSpace' is not defined
> }}}

**sagemath-categories** as of this ticket does not contain src/sage/matrix/matrix_space.py (see `pkgs/sagemath-categories/MANIFEST.in`), so `MatrixSpace` is not available in `sage.all__sagemath_categories`.

Note that the `tox` run ends with the message "lots of doctest failures are expected". This is one of them.



---

archive/issue_comments_405287.json:
```json
{
    "body": "Replying to [comment:162 klee]:\n> The real problem is:\n> {{{#!python\n> $ pkgs/sagemath-categories/.tox/py39/bin/python3.9 \n> Python 3.9.13 (main, May 24 2022, 21:28:31) \n> [Clang 13.1.6 (clang-1316.0.21.2)] on darwin\n> Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n> >>> from sage.categories.category import Category\n> Traceback (most recent call last):\n>   File \"<stdin>\", line 1, in <module>\n>   File \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages/sage/categories/category.py\", line 107, in <module>\n>     from sage.misc.c3_controlled import _cmp_key, _cmp_key_named, C3_sorted_merge\n>   File \"sage/misc/c3_controlled.pyx\", line 364, in init sage.misc.c3_controlled (build/cythonized/sage/misc/c3_controlled.c:11819)\n>   File \"/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages/sage/structure/__init__.py\", line 2, in <module>\n>     import sage.structure.element\n>   File \"sage/structure/element.pyx\", line 1, in init sage.structure.element (build/cythonized/sage/structure/element.c:36204)\n>   File \"sage/structure/category_object.pyx\", line 60, in init sage.structure.category_object (build/cythonized/sage/structure/category_object.c:9982)\n> ImportError: cannot import name Category\n> }}}\n> Strangely this works \n> {{{#!python\n> Hera:sage-dev$ pkgs/sagemath-categories/.tox/py39/bin/python3.9 \n> Python 3.9.13 (main, May 24 2022, 21:28:31) \n> [Clang 13.1.6 (clang-1316.0.21.2)] on darwin\n> Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n> >>> from sage.structure.sage_object import SageObject\n> >>> from sage.categories.category import Category\n> >>> \n> }}}\n\nThe Sage library contains many cyclic imports. If one starts at the wrong place in an import cycle, one can run into problems with partially initialized modules. See #33580 (Meta-ticket: make all modules importable without sage.all)",
    "created_at": "2022-07-06T18:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405287",
    "user": "mkoeppe"
}
```

Replying to [comment:162 klee]:
> The real problem is:
> {{{#!python
> $ pkgs/sagemath-categories/.tox/py39/bin/python3.9 
> Python 3.9.13 (main, May 24 2022, 21:28:31) 
> [Clang 13.1.6 (clang-1316.0.21.2)] on darwin
> Type "help", "copyright", "credits" or "license" for more information.
> >>> from sage.categories.category import Category
> Traceback (most recent call last):
>   File "<stdin>", line 1, in <module>
>   File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages/sage/categories/category.py", line 107, in <module>
>     from sage.misc.c3_controlled import _cmp_key, _cmp_key_named, C3_sorted_merge
>   File "sage/misc/c3_controlled.pyx", line 364, in init sage.misc.c3_controlled (build/cythonized/sage/misc/c3_controlled.c:11819)
>   File "/Users/kwankyu/GitHub/sage-dev/pkgs/sagemath-categories/.tox/py39/lib/python3.9/site-packages/sage/structure/__init__.py", line 2, in <module>
>     import sage.structure.element
>   File "sage/structure/element.pyx", line 1, in init sage.structure.element (build/cythonized/sage/structure/element.c:36204)
>   File "sage/structure/category_object.pyx", line 60, in init sage.structure.category_object (build/cythonized/sage/structure/category_object.c:9982)
> ImportError: cannot import name Category
> }}}
> Strangely this works 
> {{{#!python
> Hera:sage-dev$ pkgs/sagemath-categories/.tox/py39/bin/python3.9 
> Python 3.9.13 (main, May 24 2022, 21:28:31) 
> [Clang 13.1.6 (clang-1316.0.21.2)] on darwin
> Type "help", "copyright", "credits" or "license" for more information.
> >>> from sage.structure.sage_object import SageObject
> >>> from sage.categories.category import Category
> >>> 
> }}}

The Sage library contains many cyclic imports. If one starts at the wrong place in an import cycle, one can run into problems with partially initialized modules. See #33580 (Meta-ticket: make all modules importable without sage.all)



---

archive/issue_comments_405288.json:
```json
{
    "body": "Thanks both for the review!",
    "created_at": "2022-07-06T18:13:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405288",
    "user": "mkoeppe"
}
```

Thanks both for the review!



---

archive/issue_comments_405289.json:
```json
{
    "body": "Replying to [comment:166 mkoeppe]: \n> Note that the `tox` run ends with the message \"lots of doctest failures are expected\". \n\nYes, it's there. It would perhaps better be colored red or green...",
    "created_at": "2022-07-07T04:45:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405289",
    "user": "klee"
}
```

Replying to [comment:166 mkoeppe]: 
> Note that the `tox` run ends with the message "lots of doctest failures are expected". 

Yes, it's there. It would perhaps better be colored red or green...



---

archive/issue_comments_405290.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-07-08T21:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405290",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_405291.json:
```json
{
    "body": "Merge failure on top of:\n\n843eb03e7e Updated [SageMath](SageMath) version to 9.7.beta4\n\n\n\nmerge was not clean: conflicts in pkgs/sagemath-categories/tox.ini",
    "created_at": "2022-07-08T21:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405291",
    "user": "vbraun"
}
```

Merge failure on top of:

843eb03e7e Updated [SageMath](SageMath) version to 9.7.beta4



merge was not clean: conflicts in pkgs/sagemath-categories/tox.ini



---

archive/issue_comments_405292.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-08T23:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405292",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405293.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-07-08T23:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405293",
    "user": "mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_405294.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-07-10T22:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28688#issuecomment-405294",
    "user": "vbraun"
}
```

Resolution: fixed
