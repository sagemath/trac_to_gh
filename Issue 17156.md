# Issue 17156: Add warning to Expression.simplify_log()

Issue created by migration from https://trac.sagemath.org/ticket/17393

Original creator: mjo

Original creation time: 2014-11-25 02:07:07

The `simplify_log()` function should only be called when the expression is real, and I just noticed this isn't documented. For an example, take:


```
sage: x,y = SR.var('x,y')
sage: f = log(x*y) - (log(x) + log(y))
sage: f(x=-1, y=i)
-2*I*pi
sage: f.simplify_log()
0
```


The documentation does say what it will do, so if you know that the real log identities don't hold over the complex numbers, then it's documented. But I think it's better to warn explicitly.



---

Comment by mjo created at 2014-11-25 03:36:12

I cleaned up a little, too. A detailed description is in the commit message.
----
New commits:


---

Comment by mjo created at 2014-11-25 03:36:12

Changing status from new to needs_review.


---

Comment by rws created at 2014-12-12 15:15:57

Changing status from needs_review to positive_review.


---

Comment by rws created at 2014-12-12 15:15:57

Looks fine in the HTML.


---

Comment by vbraun created at 2014-12-16 00:32:05


```
sage -t --long src/sage/symbolic/expression.pyx
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 8835, in sage.symbolic.expression.Expression.simplify_log
Failed example:
    f.simplify_log('one')
Expected:
    1/2*log(t) + log(x) + 2*log(y)
Got:
    -pi*log(x + 1) + log(x*y)
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 8838, in sage.symbolic.expression.Expression.simplify_log
Failed example:
    f.simplify_log('ratios')
Expected:
    log(sqrt(t)*x*y^2)
Got:
    -pi*log(x + 1) + log(x*y)
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 8841, in sage.symbolic.expression.Expression.simplify_log
Failed example:
    f.simplify_log()
Expected:
    log(x*y^2) + 1/2*log(t)
Got:
    -pi*log(x + 1) + log(x*y)
**********************************************************************
1 item had failures:
   3 of  31 in sage.symbolic.expression.Expression.simplify_log
    [2265 tests, 3 failures, 21.05 s]
----------------------------------------------------------------------
sage -t --long src/sage/symbolic/expression.pyx  # 3 doctests failed
```



---

Comment by vbraun created at 2014-12-16 00:32:05

Changing status from positive_review to needs_work.


---

Comment by git created at 2014-12-16 01:52:28

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mjo created at 2014-12-16 01:54:58

Durr sorry. I must've forgotten to run `sage -b` before doctesting. I moved a block of tests but forgot to redefine the function `f` they were testing.

I rebased my branch on top of `develop`, and added one more line that should fix it.


---

Comment by mjo created at 2014-12-16 01:54:58

Changing status from needs_work to needs_review.


---

Comment by rws created at 2014-12-19 14:59:08

File passes tests. Docs compile, look good.


---

Comment by rws created at 2014-12-19 14:59:08

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-12-21 21:45:21

Resolution: fixed
