# Issue 16656: Free modules over PIDs

archive/issues_016656.json:
```json
{
    "body": "CC:  jakobkroeker\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/16893\n\n",
    "created_at": "2014-08-28T08:17:46Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Free modules over PIDs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16656",
    "user": "@adeines"
}
```
CC:  jakobkroeker



Issue created by migration from https://trac.sagemath.org/ticket/16893





---

archive/issue_comments_219865.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-08-29T14:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219865",
    "user": "@adeines"
}
```

New commits:



---

archive/issue_comments_219866.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2014-08-29T14:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219866",
    "user": "@adeines"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_219867.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to linear algebra.",
    "created_at": "2014-08-29T14:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219867",
    "user": "@adeines"
}
```

Changing component from PLEASE CHANGE to linear algebra.



---

archive/issue_comments_219868.json:
```json
{
    "body": "Changing keywords from \"\" to \"free modules, PID\".",
    "created_at": "2014-08-29T14:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219868",
    "user": "@adeines"
}
```

Changing keywords from "" to "free modules, PID".



---

archive/issue_comments_219869.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-08-29T14:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219869",
    "user": "@adeines"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_219870.json:
```json
{
    "body": "Hi,\n\nThere are (trivial) rebase to do on top of `sage-6.7.beta2`.\n\nApart that, in your commit there are a lot of trailing whitespaces (i.e. space before end of line) and you should get rid of them.\n\nI did not check much about the code yet but I am currently doing it. Would be cool to have this integrated into Sage.\n\nVincent",
    "created_at": "2015-04-26T19:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219870",
    "user": "@videlec"
}
```

Hi,

There are (trivial) rebase to do on top of `sage-6.7.beta2`.

Apart that, in your commit there are a lot of trailing whitespaces (i.e. space before end of line) and you should get rid of them.

I did not check much about the code yet but I am currently doing it. Would be cool to have this integrated into Sage.

Vincent



---

archive/issue_comments_219871.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-26T19:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219871",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_219872.json:
```json
{
    "body": "After a first lecture:\n\n- `self` should not be mentioned in the `INPUT` section.\n\n- in your example `[ideal(ZZ(p)) for p in ...]` you could remove the `ZZ`. The output of `prime_range` are already integers.\n\n- `ValueError(\"gens and ideal_list must have the same lenghth\")` chane `lenghth` into `length`\n\n- it is better to use `ZZ is ZF` rather than `ZZ == ZF`. The reason is that it does not involve Python comparisons (which might be tedious). Similarly, you can safely replace `ideal_list == None` with `ideal_list is None`\n\n- instead of `pari(F)` use `F._pari_()`. Doing that way you can remove `pari` from the imported modules. You can also go from `pari` to `sage` using `.sage()`\n\n```\nsage: m = matrix([[2,1],[1,1]])\nsage: p = m._pari_()\nsage: p\n[2, 1; 1, 1]\nsage: p.sage()\n[2 1]\n[1 1]\n```\n\n  copying the entries one by one will be rather slow (it will not necessarily works well with number field elements).\n\n- you can replace `[F.ideal(1) for id in range(len(self.gens()))]` with `[F.ideal(1)] * len(self.gens())`.\n\nVincent",
    "created_at": "2015-04-26T20:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219872",
    "user": "@videlec"
}
```

After a first lecture:

- `self` should not be mentioned in the `INPUT` section.

- in your example `[ideal(ZZ(p)) for p in ...]` you could remove the `ZZ`. The output of `prime_range` are already integers.

- `ValueError("gens and ideal_list must have the same lenghth")` chane `lenghth` into `length`

- it is better to use `ZZ is ZF` rather than `ZZ == ZF`. The reason is that it does not involve Python comparisons (which might be tedious). Similarly, you can safely replace `ideal_list == None` with `ideal_list is None`

- instead of `pari(F)` use `F._pari_()`. Doing that way you can remove `pari` from the imported modules. You can also go from `pari` to `sage` using `.sage()`

```
sage: m = matrix([[2,1],[1,1]])
sage: p = m._pari_()
sage: p
[2, 1; 1, 1]
sage: p.sage()
[2 1]
[1 1]
```

  copying the entries one by one will be rather slow (it will not necessarily works well with number field elements).

- you can replace `[F.ideal(1) for id in range(len(self.gens()))]` with `[F.ideal(1)] * len(self.gens())`.

Vincent



---

archive/issue_comments_219873.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-22T01:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219873",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_219874.json:
```json
{
    "body": "Cleaned up and rebased.",
    "created_at": "2016-08-22T01:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219874",
    "user": "@adeines"
}
```

Cleaned up and rebased.



---

archive/issue_comments_219875.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-22T01:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219875",
    "user": "@adeines"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_219876.json:
```json
{
    "body": "You should not use `assert` to check a test that may fail. You would better raise a `NotImplementedError`. In other words use the following template\n\n```\nif ZF is sage.rings.integer_ring.ZZ and ideal_list is None:\n    ... case1 ...\nelif ZF is sage.rings.integer_ring.ZZ:\n    ... case2 ...\nelif nf_order.is_NumberFieldOrder(ZF):\n    ... case3 ...\nelse:\n    raise NotImplementedError(\"_pseudo_hermite_matrix not implemented for XYZ\")\n```\n",
    "created_at": "2016-08-22T02:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219876",
    "user": "@videlec"
}
```

You should not use `assert` to check a test that may fail. You would better raise a `NotImplementedError`. In other words use the following template

```
if ZF is sage.rings.integer_ring.ZZ and ideal_list is None:
    ... case1 ...
elif ZF is sage.rings.integer_ring.ZZ:
    ... case2 ...
elif nf_order.is_NumberFieldOrder(ZF):
    ... case3 ...
else:
    raise NotImplementedError("_pseudo_hermite_matrix not implemented for XYZ")
```




---

archive/issue_comments_219877.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-08-22T02:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219877",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_219878.json:
```json
{
    "body": "Doctesting is very good.\n\n1. The docstring should start with a one line description. Then a linebreak. And then an optional longer description. The comment about the genericity of the code would better be in a `NOTE` section (see [developer guide](http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings)).\n\n2. Please fix the spaces in the definition of the function as\n\n```\ndef _pseudo_hermite_matrix(self, ideal_list=None):\n```\n\n and always keep a space after a comma. \n\n3. typo: `pseodo`\n\n4. Would be good to point to a definition of pseudo-Hermite matrix.\n\n5. This\n\n```\n+            #if the ideals are the same, compare the matrices\n+            if Ids == OIds:\n+                return cmp(Mat,Omat)\n+            #otherwise, compare the ideals.\n+            else:\n+                return cmp(Ids,OIds)\n```\n\n  can be replaced with\n\n```\nreturn cmp(Ids, OIds) or cmp(Mat, Omat)\n```\n\n\n6. Why did you move the position of `import sage.misc.latex as latex` in the list of imported modules at the top of the file?",
    "created_at": "2016-08-22T02:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219878",
    "user": "@videlec"
}
```

Doctesting is very good.

1. The docstring should start with a one line description. Then a linebreak. And then an optional longer description. The comment about the genericity of the code would better be in a `NOTE` section (see [developer guide](http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings)).

2. Please fix the spaces in the definition of the function as

```
def _pseudo_hermite_matrix(self, ideal_list=None):
```

 and always keep a space after a comma. 

3. typo: `pseodo`

4. Would be good to point to a definition of pseudo-Hermite matrix.

5. This

```
+            #if the ideals are the same, compare the matrices
+            if Ids == OIds:
+                return cmp(Mat,Omat)
+            #otherwise, compare the ideals.
+            else:
+                return cmp(Ids,OIds)
```

  can be replaced with

```
return cmp(Ids, OIds) or cmp(Mat, Omat)
```


6. Why did you move the position of `import sage.misc.latex as latex` in the list of imported modules at the top of the file?



---

archive/issue_comments_219879.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-22T02:18:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219879",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_219880.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-22T02:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219880",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_219881.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-22T02:37:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219881",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_219882.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-22T02:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219882",
    "user": "@adeines"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_219883.json:
```json
{
    "body": "Thanks!  \n\nAnd the move of `import sage.misc.latex as latex` was a relic of rebasing, but I've moved that back.",
    "created_at": "2016-08-22T02:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219883",
    "user": "@adeines"
}
```

Thanks!  

And the move of `import sage.misc.latex as latex` was a relic of rebasing, but I've moved that back.



---

archive/issue_comments_219884.json:
```json
{
    "body": "One backquote is for latex and two for displaying code. Hence you should change ``ideal_list`` to ```ideal_list```.\n\nThe examples need to be in an `EXAMPLES` section.\n\n`len(self.gens())` -> `self.ngens()`\n\n`len(HM)` -> `HM.nrows()`\n\n`len(HM[0])` -> `HM.ncols()`",
    "created_at": "2016-08-22T13:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219884",
    "user": "@videlec"
}
```

One backquote is for latex and two for displaying code. Hence you should change ``ideal_list`` to ```ideal_list```.

The examples need to be in an `EXAMPLES` section.

`len(self.gens())` -> `self.ngens()`

`len(HM)` -> `HM.nrows()`

`len(HM[0])` -> `HM.ncols()`



---

archive/issue_comments_219885.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-08-22T13:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219885",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_219886.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-22T21:07:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219886",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_219887.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-22T21:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219887",
    "user": "@adeines"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_219888.json:
```json
{
    "body": "Still from [comment:15 comment:15]: the examples should be precedeed with `EXAMPLES:` (in the function `_pseudo_hermite_matrix`).",
    "created_at": "2016-08-22T21:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219888",
    "user": "@videlec"
}
```

Still from [comment:15 comment:15]: the examples should be precedeed with `EXAMPLES:` (in the function `_pseudo_hermite_matrix`).



---

archive/issue_comments_219889.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-22T23:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219889",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_219890.json:
```json
{
    "body": "The equality testing is likely to be broken on other PID too. Isn't it?",
    "created_at": "2016-08-26T23:01:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219890",
    "user": "@videlec"
}
```

The equality testing is likely to be broken on other PID too. Isn't it?



---

archive/issue_comments_219891.json:
```json
{
    "body": "Indeed\n\n```\nsage: R = QQ['x']\nsage: A = matrix(R, 3, [1,0,0,0,1,0,0,0,1])\nsage: B = matrix(R, 3, [1,0,0,0,-1,0,0,0,1])\nsage: (R^3).submodule(A) == (R^3).submodule(B)\nFalse\n```\n\nWould be better to find something to solve other cases (or raise in error in the comparison code if this is hard to implement in general).",
    "created_at": "2016-08-26T23:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219891",
    "user": "@videlec"
}
```

Indeed

```
sage: R = QQ['x']
sage: A = matrix(R, 3, [1,0,0,0,1,0,0,0,1])
sage: B = matrix(R, 3, [1,0,0,0,-1,0,0,0,1])
sage: (R^3).submodule(A) == (R^3).submodule(B)
False
```

Would be better to find something to solve other cases (or raise in error in the comparison code if this is hard to implement in general).



---

archive/issue_comments_219892.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-08-26T23:04:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219892",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_219893.json:
```json
{
    "body": "Be aware of\n- #24031 Coercion between Matrices over orders and over the number field \n- #23978 Rich comparison for Modules \n- #11579 Free module equality, comparisons",
    "created_at": "2017-10-22T16:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16656#issuecomment-219893",
    "user": "@simonbrandhorst"
}
```

Be aware of
- #24031 Coercion between Matrices over orders and over the number field 
- #23978 Rich comparison for Modules 
- #11579 Free module equality, comparisons
