# Issue 28636: Implement ambient volume of polyhedron with normaliz

Issue created by migration from https://trac.sagemath.org/ticket/28873

Original creator: @kliem

Original creation time: 2019-12-12 07:50:39

CC:  jipilab @laisrast

Keywords: polyhedron, normaliz, ambient volume

We implement the ambient volume using backend normaliz.

This is done by return 0 or infinity if the polyhedron is not full-dimensional and not compact respectively.

Otherwise, we take the `induced_lattice` volume and divide by `factorial(self.dim())`.

See section 6.1.1 of the normaliz manual on how `induced_lattice` volume relates to euclidean volume: [https://github.com/Normaliz/Normaliz/blob/master/doc/Normaliz.pdf](https://github.com/Normaliz/Normaliz/blob/master/doc/Normaliz.pdf)

This is much faster than the current method, so we set this to default if backend is normaliz.


```
sage: P = polytopes.dodecahedron(backend='normaliz')
sage: %time P.volume(engine='normaliz')
CPU times: user 3.91 ms, sys: 0 ns, total: 3.91 ms
Wall time: 1.49 ms
-176*sqrt5 + 400
sage: %time P.volume(engine='internal')
CPU times: user 26.5 ms, sys: 332 µs, total: 26.9 ms
Wall time: 27.5 ms
-176*sqrt5 + 400
```



```
sage: P = polytopes.one_hundred_twenty_cell(backend='normaliz')
sage: %time P.volume(engine='normaliz')
CPU times: user 1.5 s, sys: 0 ns, total: 1.5 s
Wall time: 210 ms
120*sqrt5
sage: %time P.volume(engine='internal')
CPU times: user 8.61 s, sys: 14.7 ms, total: 8.63 s
Wall time: 8.63 s
120*sqrt5
```


```
sage: P = polytopes.hypercube(6, backend='normaliz')
sage: %time P.volume(engine='normaliz')
CPU times: user 2.33 ms, sys: 0 ns, total: 2.33 ms
Wall time: 2.34 ms
64
sage: %time P.volume(engine='internal')
CPU times: user 183 ms, sys: 32 µs, total: 183 ms
Wall time: 182 ms
64
```


Follow up:

Once `affine_hull` completely respects the backend, this method will be used to calculate the induced volume by default (automatically).


---

Comment by @kliem created at 2019-12-12 07:51:28

New commits:


---

Comment by @kliem created at 2019-12-12 07:51:28

Changing status from new to needs_review.


---

Comment by git created at 2019-12-12 07:53:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2019-12-26 21:37:19

New commits:


---

Comment by git created at 2019-12-26 21:38:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2019-12-26 21:45:23

It should be noted that the conversion of the normaliz output does not work correctly when computing `Sublattice` for algebraic polyhedra.


---

Comment by embray created at 2020-01-06 14:10:03

Ticket retargeted after milestone closed


---

Comment by @kliem created at 2020-03-27 15:18:58

Rebased.
----
New commits:


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by jipilab created at 2020-04-19 13:40:03

Changing status from needs_review to needs_work.


---

Comment by jipilab created at 2020-04-19 13:40:03

You should add the reference to the manual in the documentation of the function. That would be a good improvement.


---

Comment by @kliem created at 2020-04-19 14:24:27

New commits:


---

Comment by @kliem created at 2020-04-19 14:24:27

Changing status from needs_work to needs_review.


---

Comment by @kliem created at 2020-04-19 14:25:46

It would be nice to have this in 9.1, if possible.


---

Comment by jipilab created at 2020-04-20 09:23:11

Is the following "unimodual" a typo? Is unimodular meant?

```diff
+        One other possibility is to compute the scaled volume where a unimodual
```


There is also


```diff
+        volume of the unimodal simplex (or zero if not full-dimensional)::
```


Unimodular?

Could you check if this occurs in the rest of the file too?

Otherwise, the ticket looks good and the bots are green on 9.1rc0, so you can put this on positive review on my behalf once you considered the above comments.


---

Comment by jipilab created at 2020-04-20 09:23:11

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-04-20 10:28:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2020-04-20 10:29:00

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2020-04-23 22:33:01

Resolution: fixed
