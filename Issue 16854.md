# Issue 16854: Random failure in the git testsuite

Issue created by migration from https://trac.sagemath.org/ticket/17091

Original creator: vbraun

Original creation time: 2014-10-02 17:48:37

CC:  jpflori fbissey

Git sometimes randomly fails in its testsuite, probably a race:

```
ok 76 - extra args: set-url origin newurl oldurl
# passed all 76 test(s)
1..76
not ok 71 - rebase -i --root on linear history is a no-op # TODO known breakage
ok 12 - git rebase -i (fixup without conflict)
ok 13 - git rebase -i (double edit)
# passed all 13 test(s)
1..13
not ok 72 - rebase -p --root on linear history is a no-op # TODO known breakage
ok 73 - rebase  -f --root on linear history causes re-write
ok 74 - rebase -m -f --root on linear history causes re-write
ok 75 - rebase -i -f --root on linear history causes re-write
ok 76 - rebase -p -f --root on linear history causes re-write
# still have 20 known breakage(s)
# passed all remaining 56 test(s)
1..76
make[5]: Leaving directory '/home/vbraun/Sage/git-develop/local/var/tmp/sage/build/git-1.8.4.4.p0/src/t'
Makefile:36: recipe for target 'test' failed
make[4]: *** [test] Error 2
make[4]: Leaving directory '/home/vbraun/Sage/git-develop/local/var/tmp/sage/build/git-1.8.4.4.p0/src/t'
Makefile:2254: recipe for target 'test' failed
make[3]: *** [test] Error 2
make[3]: Leaving directory '/home/vbraun/Sage/git-develop/local/var/tmp/sage/build/git-1.8.4.4.p0/src'
Error running git's test suite.
```

We should probably first upgrade to the latest git before worrying about that.


---

Comment by vbraun created at 2014-10-02 20:26:22

Straightforward update.
----
New commits:


---

Comment by vbraun created at 2014-10-02 20:26:22

Changing status from new to needs_review.


---

Comment by fbissey created at 2014-10-03 00:42:04

I am only at 2.0.4 locally, not that this matter much for a straightforward package. I guess your main problem is that it make the build break with SPKG_CHECK turned on? Otherwise we would care so much about breakages upstream knows about.


---

Comment by jhpalmieri created at 2014-10-03 05:40:09

This fails to build on my OS X 10.9 machine. Compilation ends with

```
In file included from /System/Library/Frameworks/Security.framework/Headers/SecAsn1Types.h:42:0,
                 from /System/Library/Frameworks/Security.framework/Headers/oidsalg.h:29,
                 from /System/Library/Frameworks/Security.framework/Headers/Security.h:44,
                 from compat/apple-common-crypto.h:14,
                 from git-compat-util.h:324,
                 from line-log.c:1:
/System/Library/Frameworks/CoreFoundation.framework/Headers/CFBase.h:535:6: note: expected 'CFTypeRef' but argument is of type 'int'
make: *** [line-range.o] Error 1
make: *** [line-log.o] Error 1
Error building git.
```

Full log at [http://sage.math.washington.edu/home/palmieri/misc/git-2.1.2.log](http://sage.math.washington.edu/home/palmieri/misc/git-2.1.2.log).


---

Comment by git created at 2014-10-03 10:45:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2014-10-03 10:47:10

Reported at http://article.gmane.org/gmane.comp.version-control.git/257836

Since we don't really need SSL we can just disable common crypto. Git is part of xcode on OSX, so its unlikely that anybody would even notice.


---

Comment by jhpalmieri created at 2014-10-03 16:32:12

I think you need a similar change in `spkg-check`; otherwise, the test suite fails immediately with the same error.


---

Comment by git created at 2014-10-03 18:36:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-10-03 21:36:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2014-10-03 21:37:35

Ok this time I checked that the testsuite passes on OSX


---

Comment by jhpalmieri created at 2014-10-04 00:55:50

Passes tests for me, too, on OS X 10.9.


---

Comment by jhpalmieri created at 2014-10-14 20:34:50

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-10-15 15:23:22


```
sage -t --long --warn-long 71.0 src/sage/dev/sagedev.py  # 1 doctest failed
sage -t --long --warn-long 71.0 src/sage/dev/git_interface.py  # 6 doctests failed
```



---

Comment by vbraun created at 2014-10-15 15:23:22

Changing status from positive_review to needs_work.


---

Comment by git created at 2014-10-15 15:46:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2014-10-15 15:46:24

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2014-10-15 19:20:39

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2014-10-15 19:20:39

All long tests pass for me.


---

Comment by vbraun created at 2014-10-16 21:10:24

Resolution: fixed
