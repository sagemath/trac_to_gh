# Issue 33254: fix usage of Matplotlib color maps

Issue created by migration from https://trac.sagemath.org/ticket/33491

Original creator: @mwageringel

Original creation time: 2022-03-11 17:56:28

CC:  tscrim davidlowry

Keywords: matplotlib

Matplotlib used to have a global dictionary of color maps. By now, it is considered internal API and does not contain newer color maps anymore, so some of them cannot be used in Sage:


```
sage: density_plot(x, (-1,1), (-1,1), cmap='turbo')
/usr/lib/python3.10/site-packages/sage/repl/rich_output/display_manager.py:608: RichReprWarning: Exception in _rich_repr_ while displaying object:
Color map turbo not known (type import matplotlib.cm; matplotlib.cm.datad.keys() for valid names)
```




---

Comment by @mwageringel created at 2022-03-11 19:03:56

Changing priority from major to minor.


---

Comment by @mwageringel created at 2022-03-11 19:03:56

Changing status from new to needs_review.


---

Comment by @mwageringel created at 2022-03-11 19:03:56

This branch obtains the colormaps from `matplotlib.colormaps` instead of `matplotlib.cm`.

I have removed the module-wide `cm` variable as I do not see a purpose of it. The code is more than 10 years old, so it is probably not related to modularization. My best guess is that it has to do with lazy imports in Python 2.

In the long run, we can also consider removing Sage's `Colormaps` collection and replace it by Matplotlib functionality, since Matplotlib already has support for registering new color maps.
----
New commits:


---

Comment by tscrim created at 2022-03-12 02:56:11

I agree that there is no reason to nail that in memory. This is a good step towards removing redundancy in Sage that can be achieved elsewhere. LGTM.


---

Comment by tscrim created at 2022-03-12 02:56:11

Changing status from needs_review to positive_review.


---

Comment by @mwageringel created at 2022-03-12 18:31:53

Thank you.


---

Comment by vbraun created at 2022-03-27 15:43:19

Resolution: fixed


---

Comment by @tobiasdiez created at 2022-04-04 11:38:53

On conda, one sees now the following error

```
sage.repl.rich_output.display_manager.RichReprWarning: Exception in _rich_repr_ while displaying object: cannot import name 'colormaps' from 'matplotlib' (/usr/share/miniconda/envs/sage-build/lib/python3.8/site-packages/matplotlib/__init__.py)
```

I think this may be introduced by this ticket, see https://github.com/sagemath/sage/runs/5800737359?check_suite_focus=true. (Not sure if it's only conda-related).


---

Comment by mkoeppe created at 2022-04-04 18:49:01

Sounds like `build/pkgs/matplotlib/install-requires.txt` should have been adjusted?
It says `matplotlib >=3.3.1`


---

Comment by DavidLowry created at 2022-04-04 19:16:50

I think you're right. This seems to require `matplotlib >= 3.5.0` (https://matplotlib.org/stable/users/prev_whats_new/whats_new_3.5.0.html#id13).


---

Comment by mkoeppe created at 2022-04-04 19:18:38

I've opened #33642 for this
