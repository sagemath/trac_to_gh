# Issue 33254: fix usage of Matplotlib color maps

archive/issues_033254.json:
```json
{
    "body": "CC:  @tscrim davidlowry\n\nKeywords: matplotlib\n\nMatplotlib used to have a global dictionary of color maps. By now, it is considered internal API and does not contain newer color maps anymore, so some of them cannot be used in Sage:\n\n```\nsage: density_plot(x, (-1,1), (-1,1), cmap='turbo')\n/usr/lib/python3.10/site-packages/sage/repl/rich_output/display_manager.py:608: RichReprWarning: Exception in _rich_repr_ while displaying object:\nColor map turbo not known (type import matplotlib.cm; matplotlib.cm.datad.keys() for valid names)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33491\n\n",
    "created_at": "2022-03-11T17:56:28Z",
    "labels": [
        "component: graphics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "fix usage of Matplotlib color maps",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33254",
    "user": "https://github.com/mwageringel"
}
```
CC:  @tscrim davidlowry

Keywords: matplotlib

Matplotlib used to have a global dictionary of color maps. By now, it is considered internal API and does not contain newer color maps anymore, so some of them cannot be used in Sage:

```
sage: density_plot(x, (-1,1), (-1,1), cmap='turbo')
/usr/lib/python3.10/site-packages/sage/repl/rich_output/display_manager.py:608: RichReprWarning: Exception in _rich_repr_ while displaying object:
Color map turbo not known (type import matplotlib.cm; matplotlib.cm.datad.keys() for valid names)
```


Issue created by migration from https://trac.sagemath.org/ticket/33491





---

archive/issue_comments_472883.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2022-03-11T19:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33254#issuecomment-472883",
    "user": "https://github.com/mwageringel"
}
```

Changing priority from major to minor.



---

archive/issue_comments_472884.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-03-11T19:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33254#issuecomment-472884",
    "user": "https://github.com/mwageringel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_472885.json:
```json
{
    "body": "This branch obtains the colormaps from `matplotlib.colormaps` instead of `matplotlib.cm`.\n\nI have removed the module-wide `cm` variable as I do not see a purpose of it. The code is more than 10 years old, so it is probably not related to modularization. My best guess is that it has to do with lazy imports in Python 2.\n\nIn the long run, we can also consider removing Sage's `Colormaps` collection and replace it by Matplotlib functionality, since Matplotlib already has support for registering new color maps.\n\n---\nNew commits:",
    "created_at": "2022-03-11T19:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33254#issuecomment-472885",
    "user": "https://github.com/mwageringel"
}
```

This branch obtains the colormaps from `matplotlib.colormaps` instead of `matplotlib.cm`.

I have removed the module-wide `cm` variable as I do not see a purpose of it. The code is more than 10 years old, so it is probably not related to modularization. My best guess is that it has to do with lazy imports in Python 2.

In the long run, we can also consider removing Sage's `Colormaps` collection and replace it by Matplotlib functionality, since Matplotlib already has support for registering new color maps.

---
New commits:



---

archive/issue_comments_472886.json:
```json
{
    "body": "I agree that there is no reason to nail that in memory. This is a good step towards removing redundancy in Sage that can be achieved elsewhere. LGTM.",
    "created_at": "2022-03-12T02:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33254#issuecomment-472886",
    "user": "https://github.com/tscrim"
}
```

I agree that there is no reason to nail that in memory. This is a good step towards removing redundancy in Sage that can be achieved elsewhere. LGTM.



---

archive/issue_comments_472887.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-12T02:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33254#issuecomment-472887",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_472888.json:
```json
{
    "body": "Thank you.",
    "created_at": "2022-03-12T18:31:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33254#issuecomment-472888",
    "user": "https://github.com/mwageringel"
}
```

Thank you.



---

archive/issue_comments_472889.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-03-27T15:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33254#issuecomment-472889",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_088226.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-03-27T15:43:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33254",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33254#event-88226"
}
```



---

archive/issue_comments_472890.json:
```json
{
    "body": "On conda, one sees now the following error\n\n```\nsage.repl.rich_output.display_manager.RichReprWarning: Exception in _rich_repr_ while displaying object: cannot import name 'colormaps' from 'matplotlib' (/usr/share/miniconda/envs/sage-build/lib/python3.8/site-packages/matplotlib/__init__.py)\n```\nI think this may be introduced by this ticket, see https://github.com/sagemath/sage/runs/5800737359?check_suite_focus=true. (Not sure if it's only conda-related).",
    "created_at": "2022-04-04T11:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33254#issuecomment-472890",
    "user": "https://github.com/tobiasdiez"
}
```

On conda, one sees now the following error

```
sage.repl.rich_output.display_manager.RichReprWarning: Exception in _rich_repr_ while displaying object: cannot import name 'colormaps' from 'matplotlib' (/usr/share/miniconda/envs/sage-build/lib/python3.8/site-packages/matplotlib/__init__.py)
```
I think this may be introduced by this ticket, see https://github.com/sagemath/sage/runs/5800737359?check_suite_focus=true. (Not sure if it's only conda-related).



---

archive/issue_comments_472891.json:
```json
{
    "body": "Sounds like `build/pkgs/matplotlib/install-requires.txt` should have been adjusted?\nIt says `matplotlib >=3.3.1`",
    "created_at": "2022-04-04T18:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33254#issuecomment-472891",
    "user": "https://github.com/mkoeppe"
}
```

Sounds like `build/pkgs/matplotlib/install-requires.txt` should have been adjusted?
It says `matplotlib >=3.3.1`



---

archive/issue_comments_472892.json:
```json
{
    "body": "I think you're right. This seems to require `matplotlib >= 3.5.0` (https://matplotlib.org/stable/users/prev_whats_new/whats_new_3.5.0.html#id13).",
    "created_at": "2022-04-04T19:16:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33254#issuecomment-472892",
    "user": "https://github.com/davidlowryduda"
}
```

I think you're right. This seems to require `matplotlib >= 3.5.0` (https://matplotlib.org/stable/users/prev_whats_new/whats_new_3.5.0.html#id13).



---

archive/issue_comments_472893.json:
```json
{
    "body": "I've opened #33642 for this",
    "created_at": "2022-04-04T19:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33254",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33254#issuecomment-472893",
    "user": "https://github.com/mkoeppe"
}
```

I've opened #33642 for this
