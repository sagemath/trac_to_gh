# Issue 33219: Readd pyright check

Issue created by migration from https://trac.sagemath.org/ticket/33456

Original creator: @tobiasdiez

Original creation time: 2022-03-03 17:35:50

CC:  mkoeppe chapoton

Originally added in #30404, then removed in #32491, now it's back: the pyright check via the github actions.

I've changed the pyright config so that some of the errors are demoted to warnings (all of the demoted errors occurred at least 100 times and thus are not fixable in a single ticket). This made it check now pass on the complete sage source code.

Also fixed a handful of errors that pyright reported:
- Missing closed bracket in smallgraphs by removing leading zeros in the numbers (might actually be a bug in pyright)
- Remove global declaration in `latex`, where pyright complained about global appearing before import. If I understand it correctly, then `global` is not needed here (because `sage_configurable_latex_macros` is not a global variable in the latex module)
- Remove duplicate import in `free_module`


---

Comment by @tobiasdiez created at 2022-03-03 17:37:23

Actually, it is not quite working since pyright complains (at least locally) about missing imports like sage.libs.sirocco, database_knotinfo, gambit, igraph. I think these are all related to optional packages. What's the easiest way to install all optional python packages in the build & test workflow?


---

Comment by git created at 2022-03-03 17:43:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-03-20 17:32:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2022-03-20 17:33:34

Changing status from new to needs_review.


---

Comment by @tobiasdiez created at 2022-03-20 17:33:34

Replying to [comment:1 gh-tobiasdiez]:
> Actually, it is not quite working since pyright complains (at least locally) about missing imports like sage.libs.sirocco, database_knotinfo, gambit, igraph. I think these are all related to optional packages. What's the easiest way to install all optional python packages in the build & test workflow?

I've demoted the reportMissingImports error to a warning for now.


---

Comment by git created at 2022-03-20 17:34:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-03-21 01:30:53

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2022-03-21 01:31:10

Rebased


---

Comment by git created at 2022-03-21 01:49:13

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2022-03-21 03:53:12

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-03-21 03:53:12

This works well on GH Actions, but testing locally with #30411 I see lots of strange messages that indicate that the venv is not configured correctly. And from https://github.com/Microsoft/pyright/blob/main/docs/configuration.md#main-pyright-config-options it does not sound like the config options `venvPath`, `venv` are set right. But since it does not break the GH Actions, this can be taken care of in #30411.


---

Comment by @tobiasdiez created at 2022-03-21 09:57:00

Thanks for the review.

I don't have any problems locally with a "normally" installed pyright. So I guess that's an issue with #30411.


---

Comment by vbraun created at 2022-03-27 15:44:05

Resolution: fixed
