# Issue 33219: Readd pyright check

archive/issues_033219.json:
```json
{
    "body": "CC:  @mkoeppe @fchapoton\n\nOriginally added in #30404, then removed in #32491, now it's back: the pyright check via the github actions.\n\nI've changed the pyright config so that some of the errors are demoted to warnings (all of the demoted errors occurred at least 100 times and thus are not fixable in a single ticket). This made it check now pass on the complete sage source code.\n\nAlso fixed a handful of errors that pyright reported:\n- Missing closed bracket in smallgraphs by removing leading zeros in the numbers (might actually be a bug in pyright)\n- Remove global declaration in `latex`, where pyright complained about global appearing before import. If I understand it correctly, then `global` is not needed here (because `sage_configurable_latex_macros` is not a global variable in the latex module)\n- Remove duplicate import in `free_module`\n\nIssue created by migration from https://trac.sagemath.org/ticket/33456\n\n",
    "created_at": "2022-03-03T17:35:50Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Readd pyright check",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33219",
    "user": "@tobiasdiez"
}
```
CC:  @mkoeppe @fchapoton

Originally added in #30404, then removed in #32491, now it's back: the pyright check via the github actions.

I've changed the pyright config so that some of the errors are demoted to warnings (all of the demoted errors occurred at least 100 times and thus are not fixable in a single ticket). This made it check now pass on the complete sage source code.

Also fixed a handful of errors that pyright reported:
- Missing closed bracket in smallgraphs by removing leading zeros in the numbers (might actually be a bug in pyright)
- Remove global declaration in `latex`, where pyright complained about global appearing before import. If I understand it correctly, then `global` is not needed here (because `sage_configurable_latex_macros` is not a global variable in the latex module)
- Remove duplicate import in `free_module`

Issue created by migration from https://trac.sagemath.org/ticket/33456





---

archive/issue_comments_473094.json:
```json
{
    "body": "Actually, it is not quite working since pyright complains (at least locally) about missing imports like sage.libs.sirocco, database_knotinfo, gambit, igraph. I think these are all related to optional packages. What's the easiest way to install all optional python packages in the build & test workflow?",
    "created_at": "2022-03-03T17:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33219#issuecomment-473094",
    "user": "@tobiasdiez"
}
```

Actually, it is not quite working since pyright complains (at least locally) about missing imports like sage.libs.sirocco, database_knotinfo, gambit, igraph. I think these are all related to optional packages. What's the easiest way to install all optional python packages in the build & test workflow?



---

archive/issue_comments_473095.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-03T17:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33219#issuecomment-473095",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_473096.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-20T17:32:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33219#issuecomment-473096",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_473097.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-03-20T17:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33219#issuecomment-473097",
    "user": "@tobiasdiez"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_473098.json:
```json
{
    "body": "Replying to [comment:1 gh-tobiasdiez]:\n> Actually, it is not quite working since pyright complains (at least locally) about missing imports like sage.libs.sirocco, database_knotinfo, gambit, igraph. I think these are all related to optional packages. What's the easiest way to install all optional python packages in the build & test workflow?\n\nI've demoted the reportMissingImports error to a warning for now.",
    "created_at": "2022-03-20T17:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33219#issuecomment-473098",
    "user": "@tobiasdiez"
}
```

Replying to [comment:1 gh-tobiasdiez]:
> Actually, it is not quite working since pyright complains (at least locally) about missing imports like sage.libs.sirocco, database_knotinfo, gambit, igraph. I think these are all related to optional packages. What's the easiest way to install all optional python packages in the build & test workflow?

I've demoted the reportMissingImports error to a warning for now.



---

archive/issue_comments_473099.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-20T17:34:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33219#issuecomment-473099",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_473100.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-03-21T01:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33219#issuecomment-473100",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_473101.json:
```json
{
    "body": "Rebased",
    "created_at": "2022-03-21T01:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33219#issuecomment-473101",
    "user": "@mkoeppe"
}
```

Rebased



---

archive/issue_comments_473102.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-03-21T01:49:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33219#issuecomment-473102",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_473103.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-21T03:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33219#issuecomment-473103",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_473104.json:
```json
{
    "body": "This works well on GH Actions, but testing locally with #30411 I see lots of strange messages that indicate that the venv is not configured correctly. And from https://github.com/Microsoft/pyright/blob/main/docs/configuration.md#main-pyright-config-options it does not sound like the config options `venvPath`, `venv` are set right. But since it does not break the GH Actions, this can be taken care of in #30411.",
    "created_at": "2022-03-21T03:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33219#issuecomment-473104",
    "user": "@mkoeppe"
}
```

This works well on GH Actions, but testing locally with #30411 I see lots of strange messages that indicate that the venv is not configured correctly. And from https://github.com/Microsoft/pyright/blob/main/docs/configuration.md#main-pyright-config-options it does not sound like the config options `venvPath`, `venv` are set right. But since it does not break the GH Actions, this can be taken care of in #30411.



---

archive/issue_comments_473105.json:
```json
{
    "body": "Thanks for the review.\n\nI don't have any problems locally with a \"normally\" installed pyright. So I guess that's an issue with #30411.",
    "created_at": "2022-03-21T09:57:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33219#issuecomment-473105",
    "user": "@tobiasdiez"
}
```

Thanks for the review.

I don't have any problems locally with a "normally" installed pyright. So I guess that's an issue with #30411.



---

archive/issue_comments_473106.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-03-27T15:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33219#issuecomment-473106",
    "user": "@vbraun"
}
```

Resolution: fixed
