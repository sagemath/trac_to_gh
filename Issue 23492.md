# Issue 23492: py3: some care for division in graphs + various improvements

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2017-08-26 18:31:39

CC:  tscrim jdemeyer jhpalmieri

as another step to py3


---

Comment by chapoton created at 2017-08-26 18:32:08

Changing status from new to needs_review.


---

Comment by chapoton created at 2017-08-26 18:32:08

New commits:


---

Comment by tscrim created at 2017-08-27 05:25:54

Why this change?

```diff
-class CoercionException(TypeError):
+class CoercionException(TypeError, BaseException):
```

`TypeError` is a subclass of `BaseException`, so I don't understand why it is needed/wanted.


---

Comment by chapoton created at 2017-08-27 06:10:46

because this line triggers the warning

```
catching classes that don't inherit from BaseException is not allowed in  3.x
```

when the tests are run with "python -3 sage-runtests"

are you sure of what you say ?

```
sage: isinstance(TypeError,Exception)
False
sage: isinstance(TypeError,BaseException)
False
```



---

Comment by tscrim created at 2017-08-27 06:12:47

Your tests are incorrect because `TypeError` is a class, not an instance of a class:

```
sage: type(TypeError)
<type 'type'>
```

Compare with

```
sage: TypeError.__mro__
(<type 'exceptions.TypeError'>,
 <type 'exceptions.StandardError'>,
 <type 'exceptions.Exception'>,
 <type 'exceptions.BaseException'>,
 <type 'object'>)
sage: e = TypeError("foo")
sage: isinstance(e, BaseException)
True
sage: isinstance(e, Exception)
True
```



---

Comment by chapoton created at 2017-08-27 06:14:36

Ok, I stand corrected. But there is a warning:

```
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/categories/pushout.py", line 3992, in pushout
        except CoercionException:
    :
    DeprecationWarning: catching classes that don't inherit from BaseException is not allowed in 3.x
```

So, why ?


---

Comment by chapoton created at 2017-08-27 06:23:34

indeed

```
sage: CoercionException.__mro__

(<class 'sage.structure.coerce_exceptions.CoercionException'>,
 <type 'exceptions.TypeError'>,
 <type 'exceptions.StandardError'>,
 <type 'exceptions.Exception'>,
 <type 'exceptions.BaseException'>,
 <type 'object'>)
```

The only difference is that it is a class and not a type.


---

Comment by git created at 2017-08-27 06:25:34

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2017-08-27 06:26:23

Ah, that is a good observation and is likely the difference. I think they just were not quite smart enough with how they raise the warnings. IIRC, your Python3 branch is not far enough to check that this works in Python3, correct?


---

Comment by chapoton created at 2017-08-27 06:26:59

yes, yes. Anyway, I have undone this modification now.


---

Comment by tscrim created at 2017-08-27 06:28:48

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-08-27 06:28:48

Thanks. LGTM.


---

Comment by vbraun created at 2017-09-10 11:57:23

Resolution: fixed


---

Comment by embray created at 2018-02-23 13:35:30

Changing keywords from "" to "division".
