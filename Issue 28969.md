# Issue 28969: 3d vectors no longer plot correctly (broken from sage-8.9 to sage-9.0)

Issue created by migration from https://trac.sagemath.org/ticket/29206

Original creator: was

Original creation time: 2020-02-15 18:07:44

CC:  paulmasson kcrisman




---

Comment by was created at 2020-02-15 18:10:03

REPORTED BY: Ingo Dahn <ingodahn`@`gmail.com>

The following code prints in sage-9.0 blue lines instead of colored vectors (with tips). In sage-8.9 the presentation is correct:


```
v1=vector([1,2,3])
v2=vector([4,5,6])
p1=plot(v1)
p2=plot(v2,color='red')
p1+p2
```



---

Attachment


---

Comment by kcrisman created at 2020-02-25 03:54:15

For what it's worth viewer="tachyon" continues to seem to be okay, and viewer="jmol" (i.e. jsmol) seems to be slightly better (though still weird) on the Sage cell server.   See [this Sage cell](https://sagecell.sagemath.org/?z=eJxVzkEKwyAQBdB9IHdwN0rdaLsqCL1HCCWYKSbYjEzE0NsntGbR2fzP-5t5TEtGHnxumxFf4inLhBuy62B-UwQtIAdGnNdvHXz40AK9ureNOK4YV9BnYtkZbfW1V9Xtn99OT8alSFkWc4KtYLWnSOyAcYQ6roE2mcwlWV2_-oXaAfZHNKw=&lang=sage&interacts=eJyLjgUAARUAuQ==) to try out all three.


---

Comment by kcrisman created at 2020-02-25 04:02:13

Could this be a bug in the newest threejs we included (r110)?  I'm not suggesting it is, but it would be worth checking out and comparing both versions in all three viewers (or any others I have forgotten existed).


---

Comment by paulmasson created at 2020-02-25 05:05:46

Replying to [comment:5 kcrisman]:
> Could this be a bug in the newest threejs we included (r110)?  I'm not suggesting it is, but it would be worth checking out and comparing both versions in all three viewers (or any others I have forgotten existed).
This is not an issue with Three.js itself. Most objects in Sage do not have a standard JSON representation like surfaces. For points, lines, texts and vector fields I had to choose some other attribute to distinguish their types. Mathematical vectors, as opposed to `arrow3d`, clearly lack the selected attributes. This is likely to occur for other abstract mathematical objects.


---

Comment by kcrisman created at 2020-02-25 13:20:30

> This is not an issue with Three.js itself. Most objects in Sage do not have a standard JSON representation like surfaces.
That makes sense.
> For points, lines, texts and vector fields I had to choose some other attribute to distinguish their types. Mathematical vectors, as opposed to `arrow3d`, clearly lack the selected attributes. 
When you say, "I had to choose", I assume you mean you implemented some of the code for this - can you point to some tickets or code where you think this might have shown up?  Maybe it's just as simple a problem as the move to threejs for plotting?  Thanks for any useful pointers.

William, the images you posted show which version of Sage was involved, but can you tell us whether you can see which "viewer" was involved?  (I can't remember when threejs became a default option for 3d viewing.)


---

Comment by kcrisman created at 2020-02-25 13:24:10

Scratch all that - I have now been able to confirm the problem is threejs, as paulmasson's comment implied.  Changing title appropriately.


---

Comment by kcrisman created at 2020-02-25 13:34:10

What I don't understand is that

```
if plot_type == 'arrow':
    return line3d([start, [(u+v) for u,v in zip(coords, start)]], arrow_head=True, **kwds)
```

is in `sage/src/sage/modules/free_module_element.pyx`.  

Okay, the real problem is that `arrow_head` isn't implemented (apparently).  Try [this](https://sagecell.sagemath.org/?z=eJzLycxLNU7RiI420AHCWB2FaI1S7TJNhbT8IoVSnTKFzDyFqswCjWhDHSMdQ5A0RJ1mLJCdWFSUXx6fkZqYYhtSVJqqU5aZWp5aZKteklGUmppVrK4JAAVMHMA=&lang=sage&interacts=eJyLjgUAARUAuQ==):

```
line3d([[0,0,0], [(u+v) for u,v in zip([1,2,1], [0,0,0])]], arrow_head=True,viewer='threejs')
```


----

If someone can give me a pointer to where `line3d` for threejs is implemented (I haven't been actively developing in the plot code since about when threejs was fairly experimental) I can try to track this down exactly.


---

Comment by paulmasson created at 2020-03-19 21:16:19

Will be fixed by #29227


---

Comment by kcrisman created at 2020-03-19 21:25:32

Changing status from new to needs_review.


---

Comment by kcrisman created at 2020-03-19 21:25:32

> Will be fixed by #29227
Agreed, this is now a dup.  If you agree (as I think you do) then hit the button.


---

Comment by paulmasson created at 2020-03-19 21:28:11

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2020-03-19 21:32:30

Great.  Glad someone worked on it too - that is awesome.  Thank you for building the infrastructure.


---

Comment by chapoton created at 2020-03-21 20:01:31

Resolution: duplicate
