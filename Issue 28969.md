# Issue 28969: 3d vectors no longer plot correctly (broken from sage-8.9 to sage-9.0)

archive/issues_028969.json:
```json
{
    "body": "CC:  @paulmasson @kcrisman\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/29206\n\n",
    "created_at": "2020-02-15T18:07:44Z",
    "labels": [
        "component: graphics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "3d vectors no longer plot correctly (broken from sage-8.9 to sage-9.0)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28969",
    "user": "https://github.com/williamstein"
}
```
CC:  @paulmasson @kcrisman



Issue created by migration from https://trac.sagemath.org/ticket/29206





---

archive/issue_comments_409620.json:
```json
{
    "body": "REPORTED BY: Ingo Dahn <ingodahn`@`gmail.com>\n\nThe following code prints in sage-9.0 blue lines instead of colored vectors (with tips). In sage-8.9 the presentation is correct:\n\n```\nv1=vector([1,2,3])\nv2=vector([4,5,6])\np1=plot(v1)\np2=plot(v2,color='red')\np1+p2\n```",
    "created_at": "2020-02-15T18:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28969#issuecomment-409620",
    "user": "https://github.com/williamstein"
}
```

REPORTED BY: Ingo Dahn <ingodahn`@`gmail.com>

The following code prints in sage-9.0 blue lines instead of colored vectors (with tips). In sage-8.9 the presentation is correct:

```
v1=vector([1,2,3])
v2=vector([4,5,6])
p1=plot(v1)
p2=plot(v2,color='red')
p1+p2
```



---

archive/issue_comments_409621.json:
```json
{
    "body": "Attachment [2020-02-15 10_10_37-.png](tarball://root/attachments/some-uuid/ticket29206/2020-02-15 10_10_37-.png) by @williamstein created at 2020-02-15 18:11:20",
    "created_at": "2020-02-15T18:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28969#issuecomment-409621",
    "user": "https://github.com/williamstein"
}
```

Attachment [2020-02-15 10_10_37-.png](tarball://root/attachments/some-uuid/ticket29206/2020-02-15 10_10_37-.png) by @williamstein created at 2020-02-15 18:11:20



---

archive/issue_comments_409622.json:
```json
{
    "body": "For what it's worth viewer=\"tachyon\" continues to seem to be okay, and viewer=\"jmol\" (i.e. jsmol) seems to be slightly better (though still weird) on the Sage cell server.   See [this Sage cell](https://sagecell.sagemath.org/?z=eJxVzkEKwyAQBdB9IHdwN0rdaLsqCL1HCCWYKSbYjEzE0NsntGbR2fzP-5t5TEtGHnxumxFf4inLhBuy62B-UwQtIAdGnNdvHXz40AK9ureNOK4YV9BnYtkZbfW1V9Xtn99OT8alSFkWc4KtYLWnSOyAcYQ6roE2mcwlWV2_-oXaAfZHNKw=&lang=sage&interacts=eJyLjgUAARUAuQ==) to try out all three.",
    "created_at": "2020-02-25T03:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28969#issuecomment-409622",
    "user": "https://github.com/kcrisman"
}
```

For what it's worth viewer="tachyon" continues to seem to be okay, and viewer="jmol" (i.e. jsmol) seems to be slightly better (though still weird) on the Sage cell server.   See [this Sage cell](https://sagecell.sagemath.org/?z=eJxVzkEKwyAQBdB9IHdwN0rdaLsqCL1HCCWYKSbYjEzE0NsntGbR2fzP-5t5TEtGHnxumxFf4inLhBuy62B-UwQtIAdGnNdvHXz40AK9ureNOK4YV9BnYtkZbfW1V9Xtn99OT8alSFkWc4KtYLWnSOyAcYQ6roE2mcwlWV2_-oXaAfZHNKw=&lang=sage&interacts=eJyLjgUAARUAuQ==) to try out all three.



---

archive/issue_comments_409623.json:
```json
{
    "body": "Could this be a bug in the newest threejs we included (r110)?  I'm not suggesting it is, but it would be worth checking out and comparing both versions in all three viewers (or any others I have forgotten existed).",
    "created_at": "2020-02-25T04:02:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28969#issuecomment-409623",
    "user": "https://github.com/kcrisman"
}
```

Could this be a bug in the newest threejs we included (r110)?  I'm not suggesting it is, but it would be worth checking out and comparing both versions in all three viewers (or any others I have forgotten existed).



---

archive/issue_comments_409624.json:
```json
{
    "body": "Replying to [comment:5 kcrisman]:\n> Could this be a bug in the newest threejs we included (r110)?  I'm not suggesting it is, but it would be worth checking out and comparing both versions in all three viewers (or any others I have forgotten existed).\n\nThis is not an issue with Three.js itself. Most objects in Sage do not have a standard JSON representation like surfaces. For points, lines, texts and vector fields I had to choose some other attribute to distinguish their types. Mathematical vectors, as opposed to `arrow3d`, clearly lack the selected attributes. This is likely to occur for other abstract mathematical objects.",
    "created_at": "2020-02-25T05:05:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28969#issuecomment-409624",
    "user": "https://github.com/paulmasson"
}
```

Replying to [comment:5 kcrisman]:
> Could this be a bug in the newest threejs we included (r110)?  I'm not suggesting it is, but it would be worth checking out and comparing both versions in all three viewers (or any others I have forgotten existed).

This is not an issue with Three.js itself. Most objects in Sage do not have a standard JSON representation like surfaces. For points, lines, texts and vector fields I had to choose some other attribute to distinguish their types. Mathematical vectors, as opposed to `arrow3d`, clearly lack the selected attributes. This is likely to occur for other abstract mathematical objects.



---

archive/issue_comments_409625.json:
```json
{
    "body": "> This is not an issue with Three.js itself. Most objects in Sage do not have a standard JSON representation like surfaces.\n\nThat makes sense.\n> For points, lines, texts and vector fields I had to choose some other attribute to distinguish their types. Mathematical vectors, as opposed to `arrow3d`, clearly lack the selected attributes. \n\nWhen you say, \"I had to choose\", I assume you mean you implemented some of the code for this - can you point to some tickets or code where you think this might have shown up?  Maybe it's just as simple a problem as the move to threejs for plotting?  Thanks for any useful pointers.\n\nWilliam, the images you posted show which version of Sage was involved, but can you tell us whether you can see which \"viewer\" was involved?  (I can't remember when threejs became a default option for 3d viewing.)",
    "created_at": "2020-02-25T13:20:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28969#issuecomment-409625",
    "user": "https://github.com/kcrisman"
}
```

> This is not an issue with Three.js itself. Most objects in Sage do not have a standard JSON representation like surfaces.

That makes sense.
> For points, lines, texts and vector fields I had to choose some other attribute to distinguish their types. Mathematical vectors, as opposed to `arrow3d`, clearly lack the selected attributes. 

When you say, "I had to choose", I assume you mean you implemented some of the code for this - can you point to some tickets or code where you think this might have shown up?  Maybe it's just as simple a problem as the move to threejs for plotting?  Thanks for any useful pointers.

William, the images you posted show which version of Sage was involved, but can you tell us whether you can see which "viewer" was involved?  (I can't remember when threejs became a default option for 3d viewing.)



---

archive/issue_comments_409626.json:
```json
{
    "body": "Scratch all that - I have now been able to confirm the problem is threejs, as paulmasson's comment implied.  Changing title appropriately.",
    "created_at": "2020-02-25T13:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28969#issuecomment-409626",
    "user": "https://github.com/kcrisman"
}
```

Scratch all that - I have now been able to confirm the problem is threejs, as paulmasson's comment implied.  Changing title appropriately.



---

archive/issue_comments_409627.json:
```json
{
    "body": "What I don't understand is that\n\n```\nif plot_type == 'arrow':\n    return line3d([start, [(u+v) for u,v in zip(coords, start)]], arrow_head=True, **kwds)\n```\nis in `sage/src/sage/modules/free_module_element.pyx`.  \n\nOkay, the real problem is that `arrow_head` isn't implemented (apparently).  Try [this](https://sagecell.sagemath.org/?z=eJzLycxLNU7RiI420AHCWB2FaI1S7TJNhbT8IoVSnTKFzDyFqswCjWhDHSMdQ5A0RJ1mLJCdWFSUXx6fkZqYYhtSVJqqU5aZWp5aZKteklGUmppVrK4JAAVMHMA=&lang=sage&interacts=eJyLjgUAARUAuQ==):\n\n```\nline3d([[0,0,0], [(u+v) for u,v in zip([1,2,1], [0,0,0])]], arrow_head=True,viewer='threejs')\n```\n\n---\n\nIf someone can give me a pointer to where `line3d` for threejs is implemented (I haven't been actively developing in the plot code since about when threejs was fairly experimental) I can try to track this down exactly.",
    "created_at": "2020-02-25T13:34:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28969#issuecomment-409627",
    "user": "https://github.com/kcrisman"
}
```

What I don't understand is that

```
if plot_type == 'arrow':
    return line3d([start, [(u+v) for u,v in zip(coords, start)]], arrow_head=True, **kwds)
```
is in `sage/src/sage/modules/free_module_element.pyx`.  

Okay, the real problem is that `arrow_head` isn't implemented (apparently).  Try [this](https://sagecell.sagemath.org/?z=eJzLycxLNU7RiI420AHCWB2FaI1S7TJNhbT8IoVSnTKFzDyFqswCjWhDHSMdQ5A0RJ1mLJCdWFSUXx6fkZqYYhtSVJqqU5aZWp5aZKteklGUmppVrK4JAAVMHMA=&lang=sage&interacts=eJyLjgUAARUAuQ==):

```
line3d([[0,0,0], [(u+v) for u,v in zip([1,2,1], [0,0,0])]], arrow_head=True,viewer='threejs')
```

---

If someone can give me a pointer to where `line3d` for threejs is implemented (I haven't been actively developing in the plot code since about when threejs was fairly experimental) I can try to track this down exactly.



---

archive/issue_comments_409628.json:
```json
{
    "body": "Will be fixed by #29227",
    "created_at": "2020-03-19T21:16:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28969#issuecomment-409628",
    "user": "https://github.com/paulmasson"
}
```

Will be fixed by #29227



---

archive/issue_comments_409629.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-03-19T21:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28969#issuecomment-409629",
    "user": "https://github.com/kcrisman"
}
```

Changing status from new to needs_review.



---

archive/issue_events_074176.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2020-03-19T21:25:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28969",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28969#event-74176"
}
```



---

archive/issue_comments_409630.json:
```json
{
    "body": "> Will be fixed by #29227\n\nAgreed, this is now a dup.  If you agree (as I think you do) then hit the button.",
    "created_at": "2020-03-19T21:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28969#issuecomment-409630",
    "user": "https://github.com/kcrisman"
}
```

> Will be fixed by #29227

Agreed, this is now a dup.  If you agree (as I think you do) then hit the button.



---

archive/issue_comments_409631.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-19T21:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28969#issuecomment-409631",
    "user": "https://github.com/paulmasson"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_409632.json:
```json
{
    "body": "Great.  Glad someone worked on it too - that is awesome.  Thank you for building the infrastructure.",
    "created_at": "2020-03-19T21:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28969#issuecomment-409632",
    "user": "https://github.com/kcrisman"
}
```

Great.  Glad someone worked on it too - that is awesome.  Thank you for building the infrastructure.



---

archive/issue_comments_409633.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2020-03-21T20:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28969#issuecomment-409633",
    "user": "https://github.com/fchapoton"
}
```

Resolution: duplicate



---

archive/issue_events_074177.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-03-21T20:01:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28969",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28969#event-74177"
}
```
