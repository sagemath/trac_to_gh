# Issue 30875: refresh the eta products file

Issue created by migration from https://trac.sagemath.org/ticket/31112

Original creator: chapoton

Original creation time: 2020-12-26 21:12:11

* some flake8 details

* using the category of Groups()

* some typing annotations


---

Comment by chapoton created at 2020-12-26 21:12:31

Changing status from new to needs_review.


---

Comment by git created at 2020-12-26 21:12:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-12-27 04:12:20

Some while-we-are-at-it things (although feel free to say too much for a ticket):

- `.. note::` -> `.. NOTE::`
- Rename the `dict` variables.
- Remove the `:math:` tags.
- Avoid the `*.all` imports (this helps avoid circular imports).
- Lowercase error messages, e.g., `raise ValueError("There are...`.


---

Comment by git created at 2020-12-27 08:39:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-12-27 08:40:34

Thanks, Travis.

All done, and more, in the second commit.

But there is a failure in the `TestSuite` now, and I do not understand why.


---

Comment by tscrim created at 2020-12-27 09:06:13

I don't have the error in front of me, but since you added `UniqueRepresentation` to `EtaGroup_class`, it should not have a `__reduce__` method. (Also, it is better to put the UR first in the MRO.)

Also, instead of `EtaGroupElement` in the `__call__` (which likely should become `_element_constructor_`), you should use `self.element_class`.

I don't understand the purpose of the `EtaProduct` function. Likewise, the corresponding arithmetic functions should just be replaced by `self.parent().element_class(self.parent(), data)`.

Last, why the change to the more generic class:

```diff
-class EtaGroupElement(MultiplicativeGroupElement):
+class EtaGroupElement(Element):
```

I am fine with it, but I was wondering if you had a reason for the change.


---

Comment by git created at 2020-12-27 10:19:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-12-27 10:21:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-12-27 10:24:10

Thanks ! It now works.

Replying to [comment:6 tscrim]:
> I don't have the error in front of me, but since you added `UniqueRepresentation` to `EtaGroup_class`, it should not have a `__reduce__` method. (Also, it is better to put the UR first in the MRO.)

done
 
> Also, instead of `EtaGroupElement` in the `__call__` (which likely should become `_element_constructor_`), you should use `self.element_class`.

done
 
> I don't understand the purpose of the `EtaProduct` function. Likewise, the corresponding arithmetic functions should just be replaced by `self.parent().element_class(self.parent(), data)`.

I do not understand exactly what you say. Maybe one could keep further refactoring for later ?
 
> Last, why the change to the more generic class:
> {{{#!diff
> -class EtaGroupElement(MultiplicativeGroupElement):
> +class EtaGroupElement(Element):
> }}}
> I am fine with it, but I was wondering if you had a reason for the change.

Well, this seems to be duplicated information, as we have fixed the category for the parent now. And `MultiplicativeGroupElement` looks like something from an old Element hierarchy system, which is more or less obsolete, no ?


---

Comment by tscrim created at 2020-12-28 00:09:23

Replying to [comment:9 chapoton]:
> Thanks ! It now works.

Thank you for the fixes.

> > I don't understand the purpose of the `EtaProduct` function. Likewise, the corresponding arithmetic functions should just be replaced by `self.parent().element_class(self.parent(), data)`.
> 
> I do not understand exactly what you say. Maybe one could keep further refactoring for later ?

I made these changes because it is necessary to have the elements returned being the correct class. However, I created #31121 for some additional changes I wanted to make while looking at the file.

> > Last, why the change to the more generic class:
> > {{{#!diff
> > -class EtaGroupElement(MultiplicativeGroupElement):
> > +class EtaGroupElement(Element):
> > }}}
> > I am fine with it, but I was wondering if you had a reason for the change.
> 
> Well, this seems to be duplicated information, as we have fixed the category for the parent now. And `MultiplicativeGroupElement` looks like something from an old Element hierarchy system, which is more or less obsolete, no ?

True, there is nothing really added there.

If my additional changes are good, then positive review. Tests in the folder pass for me.


---

Comment by chapoton created at 2020-12-28 11:03:48

Did you intend to change the branch here ? For the moment, it's still my branch, with no additional changes from you.


---

Comment by tscrim created at 2020-12-28 12:13:30

Yes I did, but forget what branch I pushed to. I will do it next time I am in my office (either tomorrow or Wednesday).


---

Comment by chapoton created at 2020-12-29 07:43:46

New commits:


---

Comment by chapoton created at 2020-12-29 19:16:08

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-12-29 19:16:08

ok, good to go.


---

Comment by tscrim created at 2020-12-29 21:36:10

Thank you for finding it. I was going to see it once I got to my office today.


---

Comment by vbraun created at 2021-01-03 12:15:27

Resolution: fixed
