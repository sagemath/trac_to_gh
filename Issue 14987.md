# Issue 14987: Iterate over the points of a toric variety

Issue created by migration from https://trac.sagemath.org/ticket/15224

Original creator: vbraun

Original creation time: 2013-09-24 13:53:26

CC:  novoselt

Keywords: sd53

Useful to access the set of points on a toric variety over a finite field


---

Comment by git created at 2013-09-24 23:08:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-25 08:42:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-25 14:06:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-25 16:10:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-09-26 13:52:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ursula created at 2013-09-26 15:11:27

I successfully applied this patch.

I think you need to throw an error, or at least produce a warning message, if someone tries to create an iterator over the points in a variety with an infinite base ring.


---

Comment by novoselt created at 2013-09-26 15:30:57

There are infinite iterators in Sage:

```
sage: iter(ZZ).next()
0
```

use case - try to find an element that satisfies certain property, at which point you stop.


---

Comment by vbraun created at 2013-09-26 15:37:10

Though the iterator over the points doesn't handle the infinite case right, it'll just forever hang at creating the list of all rescalings.


---

Comment by git created at 2013-09-26 17:39:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ursula created at 2013-09-26 22:51:52

There are some subtleties involving singular varieties that this code does not take into account.  For example, if you take the normal fan to the standard 2-dimensional simplex (ReflexivePolytope(2,0)), you get a quotient of the projective plane by a diagonal action of a group of order 3.  When the base ring is GF(7), 2 is a 3rd root of unity and [1:2:4] generates the diagonal action, so [1:1:1] and [1:2:4] should be identified.  But they are listed as different points by this iterator!

The obvious fix is to restrict to the case of nonsingular varieties; this behavior would match the existing function for counting points on a toric variety.


---

Comment by git created at 2013-09-28 14:04:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ursula created at 2013-09-28 20:05:19

I think when you included the torsion relations, you lost the non-torsion relations?  The list I get of points in the normal fan to the standard 2-dimensional simplex example now includes [1:1:1], [2:2:2], [3:3:3], etc.


---

Comment by git created at 2013-09-29 11:50:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ursula created at 2013-10-07 20:24:44

Now works as advertised for toric varieties obtained from complete fans!  Does this patch apply to affine fans as well?  (I tried the example of a fan obtained from the first quadrant in the plane, and got an accurate list of points, though the use of colons in that setting is weird.)

We could use this to update #14891, which was only implemented for non-singular toric varieties.


---

Comment by vbraun created at 2013-10-08 15:00:04

Its supposed to give the correct answer for all fans. If it doesn't then its a bug.

I already incorporated it with #14891, for example `X.point_set().cardinality()` will use the formula if the variety is smooth and enumerate the points otherwise.


---

Comment by ursula created at 2013-10-24 18:24:56

We should add a documentation example where the fan is not complete.  The blowup of a point, where the fan has two cones, one from [(1,0),(1,1)] and one from [(0,1),(1,1)] would be a nice choice: in that setting, you can see a projective line when the coordinate corresponding to (1,1) is 0.

This code throws errors when the toric variety has torus factors (that is, when the rays of the fan do not span the vector space associated with N).  For example:

V = ToricVariety(Fan([Cone([(1,0)])]))

VF = V.change_ring(GF(3))

list(VF.point_set())

yields:

ValueError: there must be 2 coordinates! Got only 1: (0,)

This behaviour does not really surprise me.  When a toric variety has torus factors, the choice of homogeneous coordinates is non-canonical.  I assume homogeneous coordinates are not implemented in Sage for such a variety.


---

Comment by vbraun created at 2013-10-24 23:08:13

We have the "virtual rays" of the fan to keep track of an arbitrary (but fixed) choice of coordinates on the torus factor. Its just a matter of hooking them up correctly. 

Adding another example is fine with me, can do that tomorrow.


---

Comment by git created at 2013-10-25 10:44:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-25 11:12:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2013-10-25 11:14:21

This works now:

```
sage: T2 = toric_varieties.torus(2, base_ring=GF(3))
sage: T2.point_set().list()
([1 : 1], [1 : 2], [2 : 1], [2 : 2])
```



---

Comment by ursula created at 2013-10-25 18:02:31

Nice!

I support approving this patch.


---

Comment by vbraun created at 2013-10-25 23:03:53

You can press the "positive review" button and put your full name in the "Reviewer:" field if you want ;-)


---

Comment by ursula created at 2013-10-28 01:35:33

Changing status from new to needs_review.


---

Comment by ursula created at 2013-10-28 01:36:12

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2013-12-18 15:54:35

Resolution: fixed
