# Issue 14987: Iterate over the points of a toric variety

archive/issues_014987.json:
```json
{
    "body": "CC:  @novoselt\n\nKeywords: sd53\n\nUseful to access the set of points on a toric variety over a finite field\n\nIssue created by migration from https://trac.sagemath.org/ticket/15224\n\n",
    "created_at": "2013-09-24T13:53:26Z",
    "labels": [
        "component: algebraic geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "Iterate over the points of a toric variety",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14987",
    "user": "https://github.com/vbraun"
}
```
CC:  @novoselt

Keywords: sd53

Useful to access the set of points on a toric variety over a finite field

Issue created by migration from https://trac.sagemath.org/ticket/15224





---

archive/issue_comments_191243.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-09-24T23:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191243",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191244.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-09-25T08:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191244",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191245.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-09-25T14:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191245",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191246.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-09-25T16:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191246",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191247.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-09-26T13:52:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191247",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191248.json:
```json
{
    "body": "I successfully applied this patch.\n\nI think you need to throw an error, or at least produce a warning message, if someone tries to create an iterator over the points in a variety with an infinite base ring.",
    "created_at": "2013-09-26T15:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191248",
    "user": "https://trac.sagemath.org/admin/accounts/users/ursula"
}
```

I successfully applied this patch.

I think you need to throw an error, or at least produce a warning message, if someone tries to create an iterator over the points in a variety with an infinite base ring.



---

archive/issue_comments_191249.json:
```json
{
    "body": "There are infinite iterators in Sage:\n\n```\nsage: iter(ZZ).next()\n0\n```\n\nuse case - try to find an element that satisfies certain property, at which point you stop.",
    "created_at": "2013-09-26T15:30:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191249",
    "user": "https://github.com/novoselt"
}
```

There are infinite iterators in Sage:

```
sage: iter(ZZ).next()
0
```

use case - try to find an element that satisfies certain property, at which point you stop.



---

archive/issue_comments_191250.json:
```json
{
    "body": "Though the iterator over the points doesn't handle the infinite case right, it'll just forever hang at creating the list of all rescalings.",
    "created_at": "2013-09-26T15:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191250",
    "user": "https://github.com/vbraun"
}
```

Though the iterator over the points doesn't handle the infinite case right, it'll just forever hang at creating the list of all rescalings.



---

archive/issue_comments_191251.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-09-26T17:39:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191251",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191252.json:
```json
{
    "body": "There are some subtleties involving singular varieties that this code does not take into account.  For example, if you take the normal fan to the standard 2-dimensional simplex (ReflexivePolytope(2,0)), you get a quotient of the projective plane by a diagonal action of a group of order 3.  When the base ring is GF(7), 2 is a 3rd root of unity and [1:2:4] generates the diagonal action, so [1:1:1] and [1:2:4] should be identified.  But they are listed as different points by this iterator!\n\nThe obvious fix is to restrict to the case of nonsingular varieties; this behavior would match the existing function for counting points on a toric variety.",
    "created_at": "2013-09-26T22:51:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191252",
    "user": "https://trac.sagemath.org/admin/accounts/users/ursula"
}
```

There are some subtleties involving singular varieties that this code does not take into account.  For example, if you take the normal fan to the standard 2-dimensional simplex (ReflexivePolytope(2,0)), you get a quotient of the projective plane by a diagonal action of a group of order 3.  When the base ring is GF(7), 2 is a 3rd root of unity and [1:2:4] generates the diagonal action, so [1:1:1] and [1:2:4] should be identified.  But they are listed as different points by this iterator!

The obvious fix is to restrict to the case of nonsingular varieties; this behavior would match the existing function for counting points on a toric variety.



---

archive/issue_comments_191253.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-09-28T14:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191253",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191254.json:
```json
{
    "body": "I think when you included the torsion relations, you lost the non-torsion relations?  The list I get of points in the normal fan to the standard 2-dimensional simplex example now includes [1:1:1], [2:2:2], [3:3:3], etc.",
    "created_at": "2013-09-28T20:05:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191254",
    "user": "https://trac.sagemath.org/admin/accounts/users/ursula"
}
```

I think when you included the torsion relations, you lost the non-torsion relations?  The list I get of points in the normal fan to the standard 2-dimensional simplex example now includes [1:1:1], [2:2:2], [3:3:3], etc.



---

archive/issue_comments_191255.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-09-29T11:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191255",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191256.json:
```json
{
    "body": "Now works as advertised for toric varieties obtained from complete fans!  Does this patch apply to affine fans as well?  (I tried the example of a fan obtained from the first quadrant in the plane, and got an accurate list of points, though the use of colons in that setting is weird.)\n\nWe could use this to update #14891, which was only implemented for non-singular toric varieties.",
    "created_at": "2013-10-07T20:24:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191256",
    "user": "https://trac.sagemath.org/admin/accounts/users/ursula"
}
```

Now works as advertised for toric varieties obtained from complete fans!  Does this patch apply to affine fans as well?  (I tried the example of a fan obtained from the first quadrant in the plane, and got an accurate list of points, though the use of colons in that setting is weird.)

We could use this to update #14891, which was only implemented for non-singular toric varieties.



---

archive/issue_comments_191257.json:
```json
{
    "body": "Its supposed to give the correct answer for all fans. If it doesn't then its a bug.\n\nI already incorporated it with #14891, for example `X.point_set().cardinality()` will use the formula if the variety is smooth and enumerate the points otherwise.",
    "created_at": "2013-10-08T15:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191257",
    "user": "https://github.com/vbraun"
}
```

Its supposed to give the correct answer for all fans. If it doesn't then its a bug.

I already incorporated it with #14891, for example `X.point_set().cardinality()` will use the formula if the variety is smooth and enumerate the points otherwise.



---

archive/issue_comments_191258.json:
```json
{
    "body": "We should add a documentation example where the fan is not complete.  The blowup of a point, where the fan has two cones, one from [(1,0),(1,1)] and one from [(0,1),(1,1)] would be a nice choice: in that setting, you can see a projective line when the coordinate corresponding to (1,1) is 0.\n\nThis code throws errors when the toric variety has torus factors (that is, when the rays of the fan do not span the vector space associated with N).  For example:\n\nV = ToricVariety(Fan([Cone([(1,0)])]))\n\nVF = V.change_ring(GF(3))\n\nlist(VF.point_set())\n\nyields:\n\nValueError: there must be 2 coordinates! Got only 1: (0,)\n\nThis behaviour does not really surprise me.  When a toric variety has torus factors, the choice of homogeneous coordinates is non-canonical.  I assume homogeneous coordinates are not implemented in Sage for such a variety.",
    "created_at": "2013-10-24T18:24:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191258",
    "user": "https://trac.sagemath.org/admin/accounts/users/ursula"
}
```

We should add a documentation example where the fan is not complete.  The blowup of a point, where the fan has two cones, one from [(1,0),(1,1)] and one from [(0,1),(1,1)] would be a nice choice: in that setting, you can see a projective line when the coordinate corresponding to (1,1) is 0.

This code throws errors when the toric variety has torus factors (that is, when the rays of the fan do not span the vector space associated with N).  For example:

V = ToricVariety(Fan([Cone([(1,0)])]))

VF = V.change_ring(GF(3))

list(VF.point_set())

yields:

ValueError: there must be 2 coordinates! Got only 1: (0,)

This behaviour does not really surprise me.  When a toric variety has torus factors, the choice of homogeneous coordinates is non-canonical.  I assume homogeneous coordinates are not implemented in Sage for such a variety.



---

archive/issue_comments_191259.json:
```json
{
    "body": "We have the \"virtual rays\" of the fan to keep track of an arbitrary (but fixed) choice of coordinates on the torus factor. Its just a matter of hooking them up correctly. \n\nAdding another example is fine with me, can do that tomorrow.",
    "created_at": "2013-10-24T23:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191259",
    "user": "https://github.com/vbraun"
}
```

We have the "virtual rays" of the fan to keep track of an arbitrary (but fixed) choice of coordinates on the torus factor. Its just a matter of hooking them up correctly. 

Adding another example is fine with me, can do that tomorrow.



---

archive/issue_comments_191260.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-10-25T10:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191260",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191261.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-10-25T11:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191261",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191262.json:
```json
{
    "body": "This works now:\n\n```\nsage: T2 = toric_varieties.torus(2, base_ring=GF(3))\nsage: T2.point_set().list()\n([1 : 1], [1 : 2], [2 : 1], [2 : 2])\n```\n",
    "created_at": "2013-10-25T11:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191262",
    "user": "https://github.com/vbraun"
}
```

This works now:

```
sage: T2 = toric_varieties.torus(2, base_ring=GF(3))
sage: T2.point_set().list()
([1 : 1], [1 : 2], [2 : 1], [2 : 2])
```




---

archive/issue_comments_191263.json:
```json
{
    "body": "Nice!\n\nI support approving this patch.",
    "created_at": "2013-10-25T18:02:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191263",
    "user": "https://trac.sagemath.org/admin/accounts/users/ursula"
}
```

Nice!

I support approving this patch.



---

archive/issue_comments_191264.json:
```json
{
    "body": "You can press the \"positive review\" button and put your full name in the \"Reviewer:\" field if you want ;-)",
    "created_at": "2013-10-25T23:03:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191264",
    "user": "https://github.com/vbraun"
}
```

You can press the "positive review" button and put your full name in the "Reviewer:" field if you want ;-)



---

archive/issue_comments_191265.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-10-28T01:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191265",
    "user": "https://trac.sagemath.org/admin/accounts/users/ursula"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_191266.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-10-28T01:36:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191266",
    "user": "https://trac.sagemath.org/admin/accounts/users/ursula"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_191267.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-12-18T15:54:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14987#issuecomment-191267",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_014685.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-12-18T15:54:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14987",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14987#event-14685"
}
```
