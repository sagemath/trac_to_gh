# Issue 25401: Misc pip upgrades

Issue created by migration from https://trac.sagemath.org/ticket/25638

Original creator: vbraun

Original creation time: 2018-06-23 11:04:23

CC:  embray jdemeyer â€‹slelievre tmonteil vbraun




---

Comment by vbraun created at 2018-06-23 17:09:28

New commits:


---

Comment by vbraun created at 2018-06-23 17:09:28

Changing component from PLEASE CHANGE to packages: standard.


---

Comment by vbraun created at 2018-06-23 17:09:28

Changing type from PLEASE CHANGE to enhancement.


---

Comment by vbraun created at 2018-06-23 17:09:28

Changing status from new to needs_review.


---

Comment by slelievre created at 2018-06-23 18:58:08

Changing keywords from "" to "upgrade, decorator, ipykernel, jupyter_client, notebook, ptyprocess, pyzmq, scandir, send2trash, setuptools, tornado".


---

Comment by jdemeyer created at 2018-06-24 09:05:34

Can we postpone this to 8.4?


---

Comment by slelievre created at 2018-06-24 09:53:20

Any particular reason for postponing?


---

Comment by jdemeyer created at 2018-06-25 07:09:54

Replying to [comment:5 slelievre]:
> Any particular reason for postponing?

These kind of packages might introduce subtle failures in the notebook (both Jupyter and sagenb). Given that the correct functioning of the notebook is not tested well, it's better to have more time to test this.


---

Comment by slelievre created at 2018-06-25 11:04:50

By "have more time to test this", do you mean
"merge such changes earlier in the beta cycle"?

Sure, why not. By the way, these are preliminaries
for making JupyterLab an optional package.


---

Comment by jdemeyer created at 2018-06-25 11:38:22

Replying to [comment:7 slelievre]:
> By "have more time to test this", do you mean
> "merge such changes earlier in the beta cycle"?

Yes.


---

Comment by slelievre created at 2018-07-16 16:32:25

New upgrades since this ticket was opened:

- notebook 5.6
- pyzmq 17.1.0
- setuptools 40.0.0
- tornado 5.1

Note that the notebook 5.6 release includes a security fix, see the
[notebook 5.6 release announcement](https://groups.google.com/d/topic/jupyter/wm00hlNctJg/discussion).
Should we take care of that particular upgrade in another ticket with milestone Sage 8.3?


---

Comment by slelievre created at 2018-07-16 16:32:25

Changing status from needs_review to needs_work.


---

Comment by slelievre created at 2018-07-24 07:29:31

Note: PyZMQ upgrade done in #25906 along with ZeroMQ.


---

Comment by slelievre created at 2018-08-08 14:22:54

New upgrade:

- scandir 1.8


---

Comment by jdemeyer created at 2018-08-08 20:44:07

See #26008 for setuptools.


---

Comment by jdemeyer created at 2018-08-23 13:06:13

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2018-08-23 13:06:13

New commits:


---

Comment by vbraun created at 2018-08-26 09:37:57

Resolution: fixed


---

Comment by vbraun created at 2018-08-26 18:18:16

Changing status from closed to new.


---

Comment by vbraun created at 2018-08-26 18:18:16

This causes various test failures on OSX, presumably due to ptyprocess:

```
**********************************************************************
File "src/sage/interfaces/expect.py", line 357, in sage.interfaces.expect.Expect.pid
Failed example:
    gap.quit()
Exception raised:
    Traceback (most recent call last):
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 650, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1061, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.expect.Expect.pid[3]>", line 1, in <module>
        gap.quit()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 597, in quit
        self._expect.close()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 327, in close
        self.ptyproc.close(force=force)
      File "sage/interfaces/sagespawn.pyx", line 202, in sage.interfaces.sagespawn.SagePtyProcess.close (build/cythonized/sage/interfaces/sagespawn.c:3059)
        self.fileobj.close()
    IOError: [Errno 5] Input/output error
**********************************************************************
[...]
**********************************************************************
File "src/sage/interfaces/expect.py", line 858, in sage.interfaces.expect.Expect._eval_line
Failed example:
    singular._eval_line('def a=3;')
Exception raised:
    Traceback (most recent call last):
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 650, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1061, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.expect.Expect._eval_line[0]>", line 1, in <module>
        singular._eval_line('def a=3;')
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 942, in _eval_line
        self._synchronize()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1284, in _synchronize
        self._sendstr(cmd)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1226, in _sendstr
        self.quit()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 597, in quit
        self._expect.close()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 327, in close
        self.ptyproc.close(force=force)
      File "sage/interfaces/sagespawn.pyx", line 199, in sage.interfaces.sagespawn.SagePtyProcess.close (build/cythonized/sage/interfaces/sagespawn.c:2940)
        self.write(str_to_bytes(self.quit_string))
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.py", line 562, in write
        return self._writeb(s, flush=flush)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.py", line 552, in _writeb
        n = self.fileobj.write(b)
    ValueError: write to closed file
**********************************************************************
[...]
sage -t --long src/sage/interfaces/expect.py  # 29 doctests failed
sage -t --long src/sage/interfaces/gap.py  # 83 doctests failed
sage -t --long src/sage/interfaces/mwrank.py  # 6 doctests failed
sage -t --long src/sage/interfaces/quit.py  # 6 doctests failed
```



---

Comment by vbraun created at 2018-08-26 18:18:16

Resolution changed from fixed to 


---

Comment by jdemeyer created at 2018-08-27 10:11:58

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-08-27 10:11:58

I reverted the `ptyprocess` upgrade.
----
New commits:


---

Comment by jdemeyer created at 2018-08-27 10:12:06

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-08-30 22:24:53

Resolution: fixed
