# Issue 10275: Create a random triangulation (max planar graph)

archive/issues_010275.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  dcoudert\n\nThis is a new graph generator to create a random triangulation, i.e., a random planar graph all of whose faces are triangles (3-cycles). We do this by generation points iid uniformly on the surface of a sphere, finding the convex hull of those points, and returning the 1-skeleton of that polyhedron.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10276\n\n",
    "created_at": "2010-11-15T22:48:07Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Create a random triangulation (max planar graph)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10275",
    "user": "edward.scheinerman"
}
```
Assignee: tbd

CC:  dcoudert

This is a new graph generator to create a random triangulation, i.e., a random planar graph all of whose faces are triangles (3-cycles). We do this by generation points iid uniformly on the surface of a sphere, finding the convex hull of those points, and returning the 1-skeleton of that polyhedron.

Issue created by migration from https://trac.sagemath.org/ticket/10276





---

archive/issue_comments_104871.json:
```json
{
    "body": "Attachment [trac_10276.patch](tarball://root/attachments/some-uuid/ticket10276/trac_10276.patch) by edward.scheinerman created at 2010-11-15 22:50:52",
    "created_at": "2010-11-15T22:50:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104871",
    "user": "edward.scheinerman"
}
```

Attachment [trac_10276.patch](tarball://root/attachments/some-uuid/ticket10276/trac_10276.patch) by edward.scheinerman created at 2010-11-15 22:50:52



---

archive/issue_comments_104872.json:
```json
{
    "body": "Changing assignee from tbd to jason, ncohen, rlm.",
    "created_at": "2010-11-15T22:50:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104872",
    "user": "edward.scheinerman"
}
```

Changing assignee from tbd to jason, ncohen, rlm.



---

archive/issue_comments_104873.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to graph theory.",
    "created_at": "2010-11-15T22:50:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104873",
    "user": "edward.scheinerman"
}
```

Changing component from PLEASE CHANGE to graph theory.



---

archive/issue_comments_104874.json:
```json
{
    "body": "Attachment [trac_10276-random-triangulation-rebase.patch](tarball://root/attachments/some-uuid/ticket10276/trac_10276-random-triangulation-rebase.patch) by rbeezer created at 2012-01-05 09:53:47",
    "created_at": "2012-01-05T09:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104874",
    "user": "rbeezer"
}
```

Attachment [trac_10276-random-triangulation-rebase.patch](tarball://root/attachments/some-uuid/ticket10276/trac_10276-random-triangulation-rebase.patch) by rbeezer created at 2012-01-05 09:53:47



---

archive/issue_comments_104875.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2012-01-05T09:59:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104875",
    "user": "rbeezer"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_104876.json:
```json
{
    "body": "Dear Ed,\n\nNice.  I needed this for a course, so I rebased it against 4.8.alpha6.  Only the author credit was failing, so it was a trivial fix.\n\nHow much work would it be to get layout information from the locations on the sphere?  I would think a projection onto the plane might be better than what a planar layout currently provides and would be simpler computationally.  Could you easily locate the \"largest\" face to be the exterior?\n\nI'll try to stick with this for a review - I'd like to see it in Sage.\n\nThanks,\nRob",
    "created_at": "2012-01-05T09:59:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104876",
    "user": "rbeezer"
}
```

Dear Ed,

Nice.  I needed this for a course, so I rebased it against 4.8.alpha6.  Only the author credit was failing, so it was a trivial fix.

How much work would it be to get layout information from the locations on the sphere?  I would think a projection onto the plane might be better than what a planar layout currently provides and would be simpler computationally.  Could you easily locate the "largest" face to be the exterior?

I'll try to stick with this for a review - I'd like to see it in Sage.

Thanks,
Rob



---

archive/issue_comments_104877.json:
```json
{
    "body": "Hi Rob,\nI wrote this over a year ago, so it's not fresh in my mind. As best I recall, this should create a planar graph in which *all* faces are triangles, so all faces are \"largest\". Is there something I need to do to keep this moving? (Should I click one of the \"action\" buttons?)\nBest, \nEd",
    "created_at": "2012-01-13T01:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104877",
    "user": "edward.scheinerman"
}
```

Hi Rob,
I wrote this over a year ago, so it's not fresh in my mind. As best I recall, this should create a planar graph in which *all* faces are triangles, so all faces are "largest". Is there something I need to do to keep this moving? (Should I click one of the "action" buttons?)
Best, 
Ed



---

archive/issue_comments_104878.json:
```json
{
    "body": "Replying to [comment:3 edward.scheinerman]:\n\nDear Ed,\n\n> Is there something I need to do to keep this moving?\n\nYes, I noticed it had been dormant for a while.  My students here at AIMS have been using this the past few days, so I could probably give it a positive review right now.  But it seems silly not to provide a layout (or a planar embedding) when it seems that all that information could be obtained from what is already computed.  In other words, it should be relatively easy to improve on \n\n\n```\nG = graphs.RandomTriangulation(40)\nG.plot(layout='planar')\n```\n\n\nboth in execution time and visual quality.  Maybe an embedding is already available from the 1-skeleton or something.  I am happy to pursue contributing code for the layout if you are not interested, or I could review something you would add.  Whatever is your pleasure.\n\nSo not really anything official to do to move this along at the moment.  I'm suggesting the improvement of adding a layout (with code from either of us) and would like to work this through to a positive review.\n\nRob",
    "created_at": "2012-01-13T07:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104878",
    "user": "rbeezer"
}
```

Replying to [comment:3 edward.scheinerman]:

Dear Ed,

> Is there something I need to do to keep this moving?

Yes, I noticed it had been dormant for a while.  My students here at AIMS have been using this the past few days, so I could probably give it a positive review right now.  But it seems silly not to provide a layout (or a planar embedding) when it seems that all that information could be obtained from what is already computed.  In other words, it should be relatively easy to improve on 


```
G = graphs.RandomTriangulation(40)
G.plot(layout='planar')
```


both in execution time and visual quality.  Maybe an embedding is already available from the 1-skeleton or something.  I am happy to pursue contributing code for the layout if you are not interested, or I could review something you would add.  Whatever is your pleasure.

So not really anything official to do to move this along at the moment.  I'm suggesting the improvement of adding a layout (with code from either of us) and would like to work this through to a positive review.

Rob



---

archive/issue_comments_104879.json:
```json
{
    "body": "Hi Rob,\n\nI thought about this some more. Your comments make perfect sense. The `RandomTriangulation` method can edited to provide an embedding by stereographically projecting the vertices of the polytope into the plane. But I fear that this would give pictures that are mathematically correct but visually awful. I can sketch out the method offline if you like. \n\nWhat Sage really needs (and I'm not knowledgeable enough to do this) is a really good planar graph layout algorithm. Compare:\n\n```\ng = graphs.DodecahedralGraph()\ng.show()\n```\n\nto\n\n```\ng = graphs.DodecahedralGraph()\ng.plot(layout='planar')\n```\n\n\nIf you think adding the stereographic projection embedding is worthwhile, I'd be happy to have you add it to this method. (I found creating patches and the like to be non-intuitive ... I'm willing to work on the code, but then have you upload it to this site :-)\n\nBest,\nEd",
    "created_at": "2012-01-13T13:38:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104879",
    "user": "edward.scheinerman"
}
```

Hi Rob,

I thought about this some more. Your comments make perfect sense. The `RandomTriangulation` method can edited to provide an embedding by stereographically projecting the vertices of the polytope into the plane. But I fear that this would give pictures that are mathematically correct but visually awful. I can sketch out the method offline if you like. 

What Sage really needs (and I'm not knowledgeable enough to do this) is a really good planar graph layout algorithm. Compare:

```
g = graphs.DodecahedralGraph()
g.show()
```

to

```
g = graphs.DodecahedralGraph()
g.plot(layout='planar')
```


If you think adding the stereographic projection embedding is worthwhile, I'd be happy to have you add it to this method. (I found creating patches and the like to be non-intuitive ... I'm willing to work on the code, but then have you upload it to this site :-)

Best,
Ed



---

archive/issue_comments_104880.json:
```json
{
    "body": "Dear Ed,\n\nThat all sounds good.  I think a graph can carry an embedding, as a logical construction - the neighbors of a vertex as an ordered list, we ought to capture that at a minimum.  (Need to double-check on that.)  Then if a general layout algorithm can utilize that information, the visual appeal might improve in the future.  But I would like to see if the actual coordinates from the stereographic projection are useful as well.  And I may appeal to the sage-devel list for ideas.\n\nSo, please send me any ideas for code off-list at `beezer`@`ups.edu` and I'll see what I can do.  Next two weeks are very hectic - finishing a course in Cape Town and starting new ones at home, so there may be a delay until life settles down.\n\nThanks,\nRob",
    "created_at": "2012-01-13T14:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104880",
    "user": "rbeezer"
}
```

Dear Ed,

That all sounds good.  I think a graph can carry an embedding, as a logical construction - the neighbors of a vertex as an ordered list, we ought to capture that at a minimum.  (Need to double-check on that.)  Then if a general layout algorithm can utilize that information, the visual appeal might improve in the future.  But I would like to see if the actual coordinates from the stereographic projection are useful as well.  And I may appeal to the sage-devel list for ideas.

So, please send me any ideas for code off-list at `beezer`@`ups.edu` and I'll see what I can do.  Next two weeks are very hectic - finishing a course in Cape Town and starting new ones at home, so there may be a delay until life settles down.

Thanks,
Rob



---

archive/issue_comments_104881.json:
```json
{
    "body": "for the patchbot:\n\napply trac_10276-random-triangulation-rebase.patch",
    "created_at": "2013-10-28T20:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104881",
    "user": "chapoton"
}
```

for the patchbot:

apply trac_10276-random-triangulation-rebase.patch



---

archive/issue_comments_104882.json:
```json
{
    "body": "Attachment [trac_10276-random-triangulation-rebase_v2.patch](tarball://root/attachments/some-uuid/ticket10276/trac_10276-random-triangulation-rebase_v2.patch) by chapoton created at 2013-10-28 20:35:56",
    "created_at": "2013-10-28T20:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104882",
    "user": "chapoton"
}
```

Attachment [trac_10276-random-triangulation-rebase_v2.patch](tarball://root/attachments/some-uuid/ticket10276/trac_10276-random-triangulation-rebase_v2.patch) by chapoton created at 2013-10-28 20:35:56



---

archive/issue_comments_104883.json:
```json
{
    "body": "for the patchbot:\n\napply trac_10276-random-triangulation-rebase_v2.patch\n\nI have just rebased the patch..",
    "created_at": "2013-10-28T20:36:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104883",
    "user": "chapoton"
}
```

for the patchbot:

apply trac_10276-random-triangulation-rebase_v2.patch

I have just rebased the patch..



---

archive/issue_comments_104884.json:
```json
{
    "body": "Changing keywords from \"\" to \"random graph\".",
    "created_at": "2013-10-28T20:36:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104884",
    "user": "chapoton"
}
```

Changing keywords from "" to "random graph".



---

archive/issue_comments_104885.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2014-12-28T20:38:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104885",
    "user": "chapoton"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_104886.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-12-28T20:38:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104886",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_104887.json:
```json
{
    "body": "Hello,\n\nI have a random error with your code, not directly caused by your code. From time to time, the following happens:\n\n\n```\nsage: g = graphs.RandomTriangulation(70, embed=True)\nsage: g\nPlanar triangulation on 70 vertices\nsage: g = graphs.RandomTriangulation(70, embed=True)\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\n<ipython-input-44-2d58770e9f2f> in <module>()\n----> 1 get_ipython().magic(u'time g = graphs.RandomTriangulation(70, embed=True)')\n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.pyc in magic(self, arg_s)\n   2203         magic_name, _, magic_arg_s = arg_s.partition(' ')\n   2204         magic_name = magic_name.lstrip(prefilter.ESC_MAGIC)\n-> 2205         return self.run_line_magic(magic_name, magic_arg_s)\n   2206 \n   2207     #-------------------------------------------------------------------------\n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.pyc in run_line_magic(self, magic_name, line)\n   2124                 kwargs['local_ns'] = sys._getframe(stack_depth).f_locals\n   2125             with self.builtin_trap:\n-> 2126                 result = fn(*args,**kwargs)\n   2127             return result\n   2128 \n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/magics/execution.pyc in time(self, line, cell, local_ns)\n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/magic.pyc in <lambda>(f, *a, **k)\n    191     # but it's overkill for just that one bit of state.\n    192     def magic_deco(arg):\n--> 193         call = lambda f, *a, **k: f(*a, **k)\n    194 \n    195         if callable(arg):\n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/magics/execution.pyc in time(self, line, cell, local_ns)\n   1127         else:\n   1128             st = clock2()\n-> 1129             exec(code, glob, local_ns)\n   1130             end = clock2()\n   1131             out = None\n\n<timed exec> in <module>()\n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/generators/random.pyc in RandomTriangulation(n, embed)\n    835 \n    836     # extract the 1-skeleton\n--> 837     g = P.vertex_graph()\n    838     g.rename('Planar triangulation on {} vertices'.format(n))\n    839     if embed:\n\n/Users/dcoudert/sage/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13663)()\n   2207         if self.cache is None:\n   2208             f = self.f\n-> 2209             self.cache = f(self._instance)\n   2210         return self.cache\n   2211 \n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in vertex_graph(self)\n   2933             True\n   2934         \"\"\"\n-> 2935         return Graph(self.vertex_adjacency_matrix(), loops=False)\n   2936 \n   2937     graph = vertex_graph\n\n/Users/dcoudert/sage/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13663)()\n   2207         if self.cache is None:\n   2208             f = self.f\n-> 2209             self.cache = f(self._instance)\n   2210         return self.cache\n   2211 \n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in vertex_adjacency_matrix(self)\n   1638             (0, 0, 1, 1, 0) A vertex at (3, 0)\n   1639         \"\"\"\n-> 1640         return self._vertex_adjacency_matrix()\n   1641 \n   1642     adjacency_matrix = vertex_adjacency_matrix\n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in _vertex_adjacency_matrix(self)\n    286             M[j,i]=1\n    287 \n--> 288         face_lattice = self.face_lattice()\n    289         for face in face_lattice:\n    290             Vrep = face.ambient_Vrepresentation()\n\n/Users/dcoudert/sage/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13663)()\n   2207         if self.cache is None:\n   2208             f = self.f\n-> 2209             self.cache = f(self._instance)\n   2210         return self.cache\n   2211 \n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in face_lattice(self)\n   2815         return Hasse_diagram_from_incidences\\\n   2816             (atoms_incidences, coatoms_incidences,\n-> 2817              face_constructor=face_constructor, required_atoms=atoms_vertices)\n   2818 \n   2819     def faces(self, face_dimension):\n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/geometry/hasse_diagram.pyc in Hasse_diagram_from_incidences(atom_to_coatoms, coatom_to_atoms, face_constructor, required_atoms, key, **kwds)\n    188     # Make sure that coatoms are in the end in proper order\n    189     tail = [faces[atoms, frozenset([coatom])]\n--> 190             for coatom, atoms in enumerate(coatom_to_atoms)]\n    191     tail.append(faces[A, frozenset()])\n    192     new_order = [n for n in new_order if n not in tail] + tail\n\nKeyError: (frozenset([]), frozenset([132]))\n```\n\n\nDavid.",
    "created_at": "2015-01-21T07:44:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104887",
    "user": "dcoudert"
}
```

Hello,

I have a random error with your code, not directly caused by your code. From time to time, the following happens:


```
sage: g = graphs.RandomTriangulation(70, embed=True)
sage: g
Planar triangulation on 70 vertices
sage: g = graphs.RandomTriangulation(70, embed=True)
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
<ipython-input-44-2d58770e9f2f> in <module>()
----> 1 get_ipython().magic(u'time g = graphs.RandomTriangulation(70, embed=True)')

/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.pyc in magic(self, arg_s)
   2203         magic_name, _, magic_arg_s = arg_s.partition(' ')
   2204         magic_name = magic_name.lstrip(prefilter.ESC_MAGIC)
-> 2205         return self.run_line_magic(magic_name, magic_arg_s)
   2206 
   2207     #-------------------------------------------------------------------------

/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.pyc in run_line_magic(self, magic_name, line)
   2124                 kwargs['local_ns'] = sys._getframe(stack_depth).f_locals
   2125             with self.builtin_trap:
-> 2126                 result = fn(*args,**kwargs)
   2127             return result
   2128 

/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/magics/execution.pyc in time(self, line, cell, local_ns)

/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/magic.pyc in <lambda>(f, *a, **k)
    191     # but it's overkill for just that one bit of state.
    192     def magic_deco(arg):
--> 193         call = lambda f, *a, **k: f(*a, **k)
    194 
    195         if callable(arg):

/Users/dcoudert/sage/local/lib/python2.7/site-packages/IPython/core/magics/execution.pyc in time(self, line, cell, local_ns)
   1127         else:
   1128             st = clock2()
-> 1129             exec(code, glob, local_ns)
   1130             end = clock2()
   1131             out = None

<timed exec> in <module>()

/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/generators/random.pyc in RandomTriangulation(n, embed)
    835 
    836     # extract the 1-skeleton
--> 837     g = P.vertex_graph()
    838     g.rename('Planar triangulation on {} vertices'.format(n))
    839     if embed:

/Users/dcoudert/sage/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13663)()
   2207         if self.cache is None:
   2208             f = self.f
-> 2209             self.cache = f(self._instance)
   2210         return self.cache
   2211 

/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in vertex_graph(self)
   2933             True
   2934         """
-> 2935         return Graph(self.vertex_adjacency_matrix(), loops=False)
   2936 
   2937     graph = vertex_graph

/Users/dcoudert/sage/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13663)()
   2207         if self.cache is None:
   2208             f = self.f
-> 2209             self.cache = f(self._instance)
   2210         return self.cache
   2211 

/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in vertex_adjacency_matrix(self)
   1638             (0, 0, 1, 1, 0) A vertex at (3, 0)
   1639         """
-> 1640         return self._vertex_adjacency_matrix()
   1641 
   1642     adjacency_matrix = vertex_adjacency_matrix

/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in _vertex_adjacency_matrix(self)
    286             M[j,i]=1
    287 
--> 288         face_lattice = self.face_lattice()
    289         for face in face_lattice:
    290             Vrep = face.ambient_Vrepresentation()

/Users/dcoudert/sage/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13663)()
   2207         if self.cache is None:
   2208             f = self.f
-> 2209             self.cache = f(self._instance)
   2210         return self.cache
   2211 

/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in face_lattice(self)
   2815         return Hasse_diagram_from_incidences\
   2816             (atoms_incidences, coatoms_incidences,
-> 2817              face_constructor=face_constructor, required_atoms=atoms_vertices)
   2818 
   2819     def faces(self, face_dimension):

/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/geometry/hasse_diagram.pyc in Hasse_diagram_from_incidences(atom_to_coatoms, coatom_to_atoms, face_constructor, required_atoms, key, **kwds)
    188     # Make sure that coatoms are in the end in proper order
    189     tail = [faces[atoms, frozenset([coatom])]
--> 190             for coatom, atoms in enumerate(coatom_to_atoms)]
    191     tail.append(faces[A, frozenset()])
    192     new_order = [n for n in new_order if n not in tail] + tail

KeyError: (frozenset([]), frozenset([132]))
```


David.



---

archive/issue_comments_104888.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-29T07:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104888",
    "user": "ncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_104889.json:
```json
{
    "body": "Hellooooo,\n\nI just looked at this code, and I thank you very very much for reminding me that the normal distribution was invariant by rotation. I had totally forgotten this, and it is soooo elegant to be able to sample sphere point uniformly this easily  `;-)`\n\nI added a small commit at public/10276 which does no non-trivial things. If you do not see anything wrong with it, you can change the ticket's status to `positive_review`.\n\nThankssssss,\n\nNathann",
    "created_at": "2015-06-29T07:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104889",
    "user": "ncohen"
}
```

Hellooooo,

I just looked at this code, and I thank you very very much for reminding me that the normal distribution was invariant by rotation. I had totally forgotten this, and it is soooo elegant to be able to sample sphere point uniformly this easily  `;-)`

I added a small commit at public/10276 which does no non-trivial things. If you do not see anything wrong with it, you can change the ticket's status to `positive_review`.

Thankssssss,

Nathann



---

archive/issue_comments_104890.json:
```json
{
    "body": "The random failure is probably still there..",
    "created_at": "2015-06-29T07:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104890",
    "user": "chapoton"
}
```

The random failure is probably still there..



---

archive/issue_comments_104891.json:
```json
{
    "body": "> The random failure is probably still there..\n\n`needs_work` then?",
    "created_at": "2015-06-29T07:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104891",
    "user": "ncohen"
}
```

> The random failure is probably still there..

`needs_work` then?



---

archive/issue_comments_104892.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-06-29T07:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104892",
    "user": "ncohen"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_104893.json:
```json
{
    "body": "I do not know what to do. Some time ago, I have tried to understand the failure, but did not succeed.",
    "created_at": "2015-06-29T07:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104893",
    "user": "chapoton"
}
```

I do not know what to do. Some time ago, I have tried to understand the failure, but did not succeed.



---

archive/issue_comments_104894.json:
```json
{
    "body": "Well.. Given that it is not caused by your code, can't we still merge this patch? There seems to be a bug alright and it will have to be fixed, but that's not a reason to hold this one back.\n\nNathann",
    "created_at": "2015-06-29T10:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104894",
    "user": "ncohen"
}
```

Well.. Given that it is not caused by your code, can't we still merge this patch? There seems to be a bug alright and it will have to be fixed, but that's not a reason to hold this one back.

Nathann



---

archive/issue_comments_104895.json:
```json
{
    "body": "a deterministic way to get the error",
    "created_at": "2015-06-29T14:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104895",
    "user": "dimpase"
}
```

a deterministic way to get the error



---

archive/issue_comments_104896.json:
```json
{
    "body": "Attachment [x.sage](tarball://root/attachments/some-uuid/ticket10276/x.sage) by dimpase created at 2015-06-29 14:06:32\n\nnow we just fix this (hopefully) :-)",
    "created_at": "2015-06-29T14:06:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104896",
    "user": "dimpase"
}
```

Attachment [x.sage](tarball://root/attachments/some-uuid/ticket10276/x.sage) by dimpase created at 2015-06-29 14:06:32

now we just fix this (hopefully) :-)



---

archive/issue_comments_104897.json:
```json
{
    "body": "ok, then I have no longer any objection against this ticket. Another ticket should be created for the polyhedron problem.",
    "created_at": "2015-06-29T14:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104897",
    "user": "chapoton"
}
```

ok, then I have no longer any objection against this ticket. Another ticket should be created for the polyhedron problem.



---

archive/issue_comments_104898.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-06-29T14:14:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104898",
    "user": "ncohen"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_104899.json:
```json
{
    "body": "Okayyyyyyyyyyyyyyyyyyy!\n\nNathann",
    "created_at": "2015-06-29T14:14:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104899",
    "user": "ncohen"
}
```

Okayyyyyyyyyyyyyyyyyyy!

Nathann



---

archive/issue_comments_104900.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-06-29T14:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104900",
    "user": "ncohen"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_104901.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-29T14:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104901",
    "user": "ncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_104902.json:
```json
{
    "body": "Could you decide what you want to do with my additional commit (see [comment:12])?",
    "created_at": "2015-06-29T14:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104902",
    "user": "ncohen"
}
```

Could you decide what you want to do with my additional commit (see [comment:12])?



---

archive/issue_comments_104903.json:
```json
{
    "body": "No, the bug is here, not elsewhere - it is a loss of precision issue, one cannot handle these points using RDF, you need exact field. I'll post a fix soon.",
    "created_at": "2015-06-29T15:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104903",
    "user": "dimpase"
}
```

No, the bug is here, not elsewhere - it is a loss of precision issue, one cannot handle these points using RDF, you need exact field. I'll post a fix soon.



---

archive/issue_comments_104904.json:
```json
{
    "body": "I added a second commit from Dima at public/10276 (he couldn't push it himself, some git oddity).\n\nNathann",
    "created_at": "2015-06-29T16:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104904",
    "user": "ncohen"
}
```

I added a second commit from Dima at public/10276 (he couldn't push it himself, some git oddity).

Nathann



---

archive/issue_comments_104905.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-29T17:32:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104905",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_104906.json:
```json
{
    "body": "I'm happy with this branch. By the way, the example in the attachment illustrating the bug produces a polytope with 136 trianglular faces, but if the `base_ring=RDF` then one triangle does not contain any vertices (loss of precision happens). With `base_ring=QQ` it's all right, of course.\n----\nNew commits:",
    "created_at": "2015-06-29T17:32:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104906",
    "user": "dimpase"
}
```

I'm happy with this branch. By the way, the example in the attachment illustrating the bug produces a polytope with 136 trianglular faces, but if the `base_ring=RDF` then one triangle does not contain any vertices (loss of precision happens). With `base_ring=QQ` it's all right, of course.
----
New commits:



---

archive/issue_comments_104907.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-06-29T23:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104907",
    "user": "dimpase"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_104908.json:
```json
{
    "body": "docs don't build, as `QQ` is not imported. will fix this now.",
    "created_at": "2015-06-29T23:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104908",
    "user": "dimpase"
}
```

docs don't build, as `QQ` is not imported. will fix this now.



---

archive/issue_comments_104909.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-29T23:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104909",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_104910.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-06-29T23:31:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104910",
    "user": "dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_104911.json:
```json
{
    "body": "PSA: Tickets without a milestone set are not going to be merged. Not sure if its intentional, just trying to get the word out.",
    "created_at": "2015-07-03T07:08:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104911",
    "user": "vbraun"
}
```

PSA: Tickets without a milestone set are not going to be merged. Not sure if its intentional, just trying to get the word out.



---

archive/issue_comments_104912.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-07-03T10:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10275#issuecomment-104912",
    "user": "vbraun"
}
```

Resolution: fixed
