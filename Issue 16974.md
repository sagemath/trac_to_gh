# Issue 16974: m4rie testsuite fails with segfault on OSX 10.10

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2014-10-24 10:33:18

CC:  malb


```
ld: warning: directory not found for option '-L/lib'
libtool: link: gcc -std=gnu99 -I/include -mmmx -msse -msse2 -msse3 -O2 -fPIC -Wall -pedantic -g -I/Users/vbraun/Sage/local/include -I/include -mmmx -msse -msse2 -msse3 -I./tests -O2 -fPIC -Wall -pedantic -g -I/Users/vbraun/Sage/local/include -o .libs/test_ple tests/test_ple-test_ple.o  -L/lib -L/Users/vbraun/Sage/local/lib /Users/vbraun/Sage/local/var/tmp/sage/build/m4rie-20140914/src/.libs/libm4rie.dylib /Users/vbraun/Sage/local/lib/libm4ri.dylib /Users/vbraun/Sage/local/lib/libpng12.dylib -lz -lm
ld: warning: directory not found for option '-L/lib'
make  check-TESTS
./test-driver: line 107: 66461 Segmentation fault: 11  "$`@`" > $log_file 2>&1
FAIL: test_multiplication
PASS: test_elimination
```

There are some scary warnings

```
tests/test_smallops.c:68:2: warning: ISO C does not allow extra ';' outside of a function [-Wpedantic]
 };
  ^
In file included from tests/test_smallops.c:27:0:
tests/testing.h: In function 'mzd_slice_canary_is_alive':
tests/testing.h:115:1: warning: control reaches end of non-void function [-Wreturn-type]
```

Full log attached


---

Comment by vbraun created at 2014-10-24 10:33:38

Compile log


---

Attachment


---

Comment by vbraun created at 2014-10-24 10:34:03

Changing keywords from "" to "yosemite".


---

Comment by jhpalmieri created at 2014-11-02 04:00:40

I see the same failure on OSX 10.9, by the way (with Sage 6.4.rc1, and probably with any version with gcc 4.9.x).


---

Comment by malb created at 2014-11-02 13:25:06

I fixed the SIGSEGV upstream. The bug is in a function which isn't used by Sage (and is not recommended to be called yet), so I'd wait with cutting a new release. If you'd like to clean this up though and close this ticket, I can cut a new release.


---

Comment by vbraun created at 2014-11-02 15:22:52

IMHO it can wait for the next release...


---

Comment by leif created at 2015-05-14 15:40:26

In case someone includes new versions of m4ri and m4rie (there are no new releases yet):

Disabling SSE2 for fat builds is only necessary on x86 (32-bit), not x86_64.


---

Comment by leif created at 2015-05-14 15:55:06

Replying to [comment:7 leif]:
> Disabling SSE2 for fat builds is only necessary on x86 (32-bit), not x86_64.

But there don't seem to be configure options to disable SSE3 or SSSE3; a few early AMD x86_64 processors didn't support SSE3, and SSSE3 is only supported by _recent_ AMD CPUs.


---

Comment by malb created at 2015-05-15 08:49:17

We don't explicitly use SSE3 in M4RI, but the compiler might want to use it. So I agree this should be configurable.


---

Comment by jhpalmieri created at 2015-09-03 19:53:38

This is still a problem, by the way.


---

Comment by malb created at 2015-09-04 10:08:12

Changing status from new to needs_review.


---

Comment by malb created at 2015-09-04 10:08:12

New commits:


---

Comment by git created at 2015-09-04 10:18:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2015-09-04 19:21:52

This fixes the problem for me on OS X. I don't have access to other platforms for testing there.


---

Comment by vbraun created at 2015-09-04 21:58:28

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-09-05 07:42:11

Resolution: fixed
