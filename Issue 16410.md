# Issue 16410: java3d doesn't work.

Issue created by migration from https://trac.sagemath.org/ticket/16647

Original creator: gagern

Original creation time: 2014-07-11 21:09:47

Even after running `./sage -i java3d`, the java3d viewer will fail to load:


```
sage: D=dodecahedron()
sage: D.show(viewer="java3d", verbosity=True)
Exception in thread "main" java.lang.NoClassDefFoundError: javax/media/j3d/Canvas3D
	at org.sagemath.sage3d.ObjectViewerApplet.showView(ObjectViewerApplet.java:49)
	at org.sagemath.sage3d.ObjectViewerApplet.showView(ObjectViewerApplet.java:40)
	at org.sagemath.sage3d.ObjectViewerApp.main(ObjectViewerApp.java:28)
Caused by: java.lang.ClassNotFoundException: javax.media.j3d.Canvas3D
	at java.net.URLClassLoader$1.run(URLClassLoader.java:372)
	at java.net.URLClassLoader$1.run(URLClassLoader.java:361)
	at java.security.AccessController.doPrivileged(Native Method)
	at java.net.URLClassLoader.findClass(URLClassLoader.java:360)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:308)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
	... 3 more
```


Adding a `set -x` to the `sage3d` script I see it executing these commands:


```
++ …/sage/local/bin/sage-pypkg-location sagenb
+ SAGE3D_HOME=…/sage/local/lib/python2.7/site-packages/sagenb-0.10.8.2-py2.7.egg/sagenb/data/sage3d
+ cd …/sage/local/lib/python2.7/site-packages/sagenb-0.10.8.2-py2.7.egg/sagenb/data/sage3d
+ export LD_LIBRARY_PATH=…/sage/local/lib/python2.7/site-packages/sagenb-0.10.8.2-py2.7.egg/sagenb/data/sage3d/lib/amd64
+ LD_LIBRARY_PATH=…/sage/local/lib/python2.7/site-packages/sagenb-0.10.8.2-py2.7.egg/sagenb/data/sage3d/lib/amd64
+ java -classpath lib/sage3d.jar:lib/ext/j3dcore.jar:lib/ext/vecmath.jar:lib/ext/j3dutils.jar org.sagemath.sage3d.ObjectViewerApp …/tmp_ctQ56m.obj
```


That `…/sage3d/lib/amd64` directory mentioned in `LD_LIBRARY_PATH` does not exist. Its parent, the `lib` directory, contains `sage3d.jar` as its sole content. Most things mentioned on the classpath don't exist either. instead, `sage/local/java/sun-libs/` contains several jars related to Java3D.

I also wonder about the version of the spkg, which is given as 20070901. I think there are newer versions around, although they are a bit hard to find. Referencs I found:

* http://forum.jogamp.org/java3d-f3728156.html
* http://gouessej.wordpress.com/2012/08/01/java-3d-est-de-retour-java-3d-is-back/
* http://jogamp.org/deployment/java3d/

I would suggest packaging Java3D 1.6.0-pre10 as a spkg and trying to get it to work. Or dump support for Java3D altogether.


---

Comment by kcrisman created at 2014-07-13 01:54:51

Yeah, dumping it may be the thing.  Or at least to raise a warning that `java3d doesn't currently work well` or something...


---

Comment by was created at 2015-02-24 04:08:19

I vote for dumping java3d "support".  It's not like we are supporting it.  This was just a package/functionality that Robert Bradshaw put together as a sort of herculean challenge at Sage Days 7.


---

Comment by kcrisman created at 2015-02-24 14:56:20

In that event, there would probably be some places in sagenb that would need to change too.  Especially with jsmol working and various other js libraries working in the cell and cloud, this seems okay.


---

Comment by kcrisman created at 2015-04-15 15:11:19

Also note that there is a file plot3d/help (see [comment:5:ticket:18162 this comment]) that should then be removed.


---

Comment by chapoton created at 2015-09-25 12:26:52

Changing keywords from "" to "java3d".


---

Comment by chapoton created at 2015-09-25 12:26:52

Changing status from new to needs_review.


---

Comment by chapoton created at 2015-09-25 12:26:52

Here is a first try, maybe there are still things to do in packages or notebook ?
----
New commits:


---

Comment by vbraun created at 2015-09-26 12:43:07

I tried it a few months ago and java3d works. Note that its a separate install and not part of the standard Java download, so its a bit tricky to install to put it mildly. Though I agree that it is so obscure that it is of no real use.


---

Comment by jdemeyer created at 2015-12-22 14:04:15

SageNB certainly has infrastructure to support `java3d` through a Java package which is called "sage3d". You can find the sources in `./data/sage3d/src/org/sagemath/sage3d/`. I don't really understand what it does.


---

Comment by vbraun created at 2015-12-27 16:51:44

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-12-28 11:08:13

Resolution: fixed
