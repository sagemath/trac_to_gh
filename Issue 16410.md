# Issue 16410: java3d doesn't work.

archive/issues_016410.json:
```json
{
    "body": "Even after running `./sage -i java3d`, the java3d viewer will fail to load:\n\n\n```\nsage: D=dodecahedron()\nsage: D.show(viewer=\"java3d\", verbosity=True)\nException in thread \"main\" java.lang.NoClassDefFoundError: javax/media/j3d/Canvas3D\n\tat org.sagemath.sage3d.ObjectViewerApplet.showView(ObjectViewerApplet.java:49)\n\tat org.sagemath.sage3d.ObjectViewerApplet.showView(ObjectViewerApplet.java:40)\n\tat org.sagemath.sage3d.ObjectViewerApp.main(ObjectViewerApp.java:28)\nCaused by: java.lang.ClassNotFoundException: javax.media.j3d.Canvas3D\n\tat java.net.URLClassLoader$1.run(URLClassLoader.java:372)\n\tat java.net.URLClassLoader$1.run(URLClassLoader.java:361)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:360)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:424)\n\tat sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:308)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:357)\n\t... 3 more\n```\n\n\nAdding a `set -x` to the `sage3d` script I see it executing these commands:\n\n\n```\n++ \u2026/sage/local/bin/sage-pypkg-location sagenb\n+ SAGE3D_HOME=\u2026/sage/local/lib/python2.7/site-packages/sagenb-0.10.8.2-py2.7.egg/sagenb/data/sage3d\n+ cd \u2026/sage/local/lib/python2.7/site-packages/sagenb-0.10.8.2-py2.7.egg/sagenb/data/sage3d\n+ export LD_LIBRARY_PATH=\u2026/sage/local/lib/python2.7/site-packages/sagenb-0.10.8.2-py2.7.egg/sagenb/data/sage3d/lib/amd64\n+ LD_LIBRARY_PATH=\u2026/sage/local/lib/python2.7/site-packages/sagenb-0.10.8.2-py2.7.egg/sagenb/data/sage3d/lib/amd64\n+ java -classpath lib/sage3d.jar:lib/ext/j3dcore.jar:lib/ext/vecmath.jar:lib/ext/j3dutils.jar org.sagemath.sage3d.ObjectViewerApp \u2026/tmp_ctQ56m.obj\n```\n\n\nThat `\u2026/sage3d/lib/amd64` directory mentioned in `LD_LIBRARY_PATH` does not exist. Its parent, the `lib` directory, contains `sage3d.jar` as its sole content. Most things mentioned on the classpath don't exist either. instead, `sage/local/java/sun-libs/` contains several jars related to Java3D.\n\nI also wonder about the version of the spkg, which is given as 20070901. I think there are newer versions around, although they are a bit hard to find. Referencs I found:\n\n* http://forum.jogamp.org/java3d-f3728156.html\n* http://gouessej.wordpress.com/2012/08/01/java-3d-est-de-retour-java-3d-is-back/\n* http://jogamp.org/deployment/java3d/\n\nI would suggest packaging Java3D 1.6.0-pre10 as a spkg and trying to get it to work. Or dump support for Java3D altogether.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16647\n\n",
    "created_at": "2014-07-11T21:09:47Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.0",
    "title": "java3d doesn't work.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16410",
    "user": "https://github.com/gagern"
}
```
Even after running `./sage -i java3d`, the java3d viewer will fail to load:


```
sage: D=dodecahedron()
sage: D.show(viewer="java3d", verbosity=True)
Exception in thread "main" java.lang.NoClassDefFoundError: javax/media/j3d/Canvas3D
	at org.sagemath.sage3d.ObjectViewerApplet.showView(ObjectViewerApplet.java:49)
	at org.sagemath.sage3d.ObjectViewerApplet.showView(ObjectViewerApplet.java:40)
	at org.sagemath.sage3d.ObjectViewerApp.main(ObjectViewerApp.java:28)
Caused by: java.lang.ClassNotFoundException: javax.media.j3d.Canvas3D
	at java.net.URLClassLoader$1.run(URLClassLoader.java:372)
	at java.net.URLClassLoader$1.run(URLClassLoader.java:361)
	at java.security.AccessController.doPrivileged(Native Method)
	at java.net.URLClassLoader.findClass(URLClassLoader.java:360)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:308)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
	... 3 more
```


Adding a `set -x` to the `sage3d` script I see it executing these commands:


```
++ …/sage/local/bin/sage-pypkg-location sagenb
+ SAGE3D_HOME=…/sage/local/lib/python2.7/site-packages/sagenb-0.10.8.2-py2.7.egg/sagenb/data/sage3d
+ cd …/sage/local/lib/python2.7/site-packages/sagenb-0.10.8.2-py2.7.egg/sagenb/data/sage3d
+ export LD_LIBRARY_PATH=…/sage/local/lib/python2.7/site-packages/sagenb-0.10.8.2-py2.7.egg/sagenb/data/sage3d/lib/amd64
+ LD_LIBRARY_PATH=…/sage/local/lib/python2.7/site-packages/sagenb-0.10.8.2-py2.7.egg/sagenb/data/sage3d/lib/amd64
+ java -classpath lib/sage3d.jar:lib/ext/j3dcore.jar:lib/ext/vecmath.jar:lib/ext/j3dutils.jar org.sagemath.sage3d.ObjectViewerApp …/tmp_ctQ56m.obj
```


That `…/sage3d/lib/amd64` directory mentioned in `LD_LIBRARY_PATH` does not exist. Its parent, the `lib` directory, contains `sage3d.jar` as its sole content. Most things mentioned on the classpath don't exist either. instead, `sage/local/java/sun-libs/` contains several jars related to Java3D.

I also wonder about the version of the spkg, which is given as 20070901. I think there are newer versions around, although they are a bit hard to find. Referencs I found:

* http://forum.jogamp.org/java3d-f3728156.html
* http://gouessej.wordpress.com/2012/08/01/java-3d-est-de-retour-java-3d-is-back/
* http://jogamp.org/deployment/java3d/

I would suggest packaging Java3D 1.6.0-pre10 as a spkg and trying to get it to work. Or dump support for Java3D altogether.

Issue created by migration from https://trac.sagemath.org/ticket/16647





---

archive/issue_comments_215295.json:
```json
{
    "body": "Yeah, dumping it may be the thing.  Or at least to raise a warning that `java3d doesn't currently work well` or something...",
    "created_at": "2014-07-13T01:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16410#issuecomment-215295",
    "user": "https://github.com/kcrisman"
}
```

Yeah, dumping it may be the thing.  Or at least to raise a warning that `java3d doesn't currently work well` or something...



---

archive/issue_comments_215296.json:
```json
{
    "body": "I vote for dumping java3d \"support\".  It's not like we are supporting it.  This was just a package/functionality that Robert Bradshaw put together as a sort of herculean challenge at Sage Days 7.",
    "created_at": "2015-02-24T04:08:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16410#issuecomment-215296",
    "user": "https://github.com/williamstein"
}
```

I vote for dumping java3d "support".  It's not like we are supporting it.  This was just a package/functionality that Robert Bradshaw put together as a sort of herculean challenge at Sage Days 7.



---

archive/issue_comments_215297.json:
```json
{
    "body": "In that event, there would probably be some places in sagenb that would need to change too.  Especially with jsmol working and various other js libraries working in the cell and cloud, this seems okay.",
    "created_at": "2015-02-24T14:56:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16410#issuecomment-215297",
    "user": "https://github.com/kcrisman"
}
```

In that event, there would probably be some places in sagenb that would need to change too.  Especially with jsmol working and various other js libraries working in the cell and cloud, this seems okay.



---

archive/issue_comments_215298.json:
```json
{
    "body": "Also note that there is a file plot3d/help (see [comment:5:ticket:18162 this comment]) that should then be removed.",
    "created_at": "2015-04-15T15:11:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16410#issuecomment-215298",
    "user": "https://github.com/kcrisman"
}
```

Also note that there is a file plot3d/help (see [comment:5:ticket:18162 this comment]) that should then be removed.



---

archive/issue_comments_215299.json:
```json
{
    "body": "Changing keywords from \"\" to \"java3d\".",
    "created_at": "2015-09-25T12:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16410#issuecomment-215299",
    "user": "https://github.com/fchapoton"
}
```

Changing keywords from "" to "java3d".



---

archive/issue_comments_215300.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-25T12:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16410#issuecomment-215300",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_215301.json:
```json
{
    "body": "Here is a first try, maybe there are still things to do in packages or notebook ?\n----\nNew commits:",
    "created_at": "2015-09-25T12:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16410#issuecomment-215301",
    "user": "https://github.com/fchapoton"
}
```

Here is a first try, maybe there are still things to do in packages or notebook ?
----
New commits:



---

archive/issue_comments_215302.json:
```json
{
    "body": "I tried it a few months ago and java3d works. Note that its a separate install and not part of the standard Java download, so its a bit tricky to install to put it mildly. Though I agree that it is so obscure that it is of no real use.",
    "created_at": "2015-09-26T12:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16410#issuecomment-215302",
    "user": "https://github.com/vbraun"
}
```

I tried it a few months ago and java3d works. Note that its a separate install and not part of the standard Java download, so its a bit tricky to install to put it mildly. Though I agree that it is so obscure that it is of no real use.



---

archive/issue_comments_215303.json:
```json
{
    "body": "SageNB certainly has infrastructure to support `java3d` through a Java package which is called \"sage3d\". You can find the sources in `./data/sage3d/src/org/sagemath/sage3d/`. I don't really understand what it does.",
    "created_at": "2015-12-22T14:04:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16410#issuecomment-215303",
    "user": "https://github.com/jdemeyer"
}
```

SageNB certainly has infrastructure to support `java3d` through a Java package which is called "sage3d". You can find the sources in `./data/sage3d/src/org/sagemath/sage3d/`. I don't really understand what it does.



---

archive/issue_comments_215304.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-12-27T16:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16410#issuecomment-215304",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_015912.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-12-28T11:08:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16410",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16410#event-15912"
}
```



---

archive/issue_comments_215305.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-12-28T11:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16410#issuecomment-215305",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
