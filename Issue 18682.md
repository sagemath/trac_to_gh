# Issue 18682: random failure in integer.pyx interrupting pari

Issue created by migration from https://trac.sagemath.org/ticket/18919

Original creator: vbraun

Original creation time: 2015-07-18 09:26:40

CC:  jdemeyer

Keywords: random_fail

This fails quite frequently:

```
sage: 0.binomial(1) ## line 6262 ##
0
sage: 0.binomial(-1) ## line 6264 ##
0
sage: 13.binomial(2r) ## line 6266 ##
78
sage: alarm(0.5); (2^100).binomial(2^22, algorithm='mpir') ## line 6271 ##
sage: alarm(0.5); (2^100).binomial(2^22, algorithm='pari') ## line 6275 ##

**********************************************************************
----------------------------------------------------------------------
sage -t --long src/sage/rings/integer.pyx  # Timed out (and interrupt failed)
----------------------------------------------------------------------
```

Possibly consequence of #10476, on the plus side I didn't get the singular failure.

http://build.sagedev.org/release/builders/%20%20slow%20AIMS%20%20%28Debian%208%2064%20bit%29%20incremental/builds/7/steps/shell_4/logs/stdio
http://build.sagedev.org/release/builders/%20%20slow%20AIMS%20bu12_32s02%20%28Ubuntu%2012.04%2032%20bit%29%20incremental/builds/19/steps/shell_4/logs/stdio
http://build.sagedev.org/release/builders/%20%20slow%20AIMS%20bu14_64s02%20%28Ubuntu%2014.04%2064%20bit%29%20incremental/builds/22/steps/shell_4/logs/stdio
http://build.sagedev.org/release/builders/%20%20slow%20AIMS%20bu15_32s02%20%28Ubuntu%2015.04%2032%20bit%29%20incremental/builds/23/steps/shell_4/logs/stdio


---

Comment by jdemeyer created at 2015-07-19 00:41:18

It's the PARI library interface, so #10476 cannot be the cause. My bet would something in PARI itself.


---

Comment by jdemeyer created at 2015-07-20 10:24:11

New commits:


---

Comment by jdemeyer created at 2015-07-20 10:24:11

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2015-08-15 17:11:47

I am infinitely happy that you found out a solution for this annoying interrupt! Though, I do not like the fact that now the interrupt code depends explicitely on pari. In an ideal world, all this interrupt buisness should go in upstream Cython, don't you think? Do you have an idea whether it would be possible to have something modular for the interrupt code?


---

Comment by vdelecroix created at 2015-08-15 17:11:47

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-08-16 11:08:38

Resolution: fixed


---

Comment by jdemeyer created at 2018-04-30 08:11:11

Replying to [comment:7 vdelecroix]:
> Though, I do not like the fact that now the interrupt code depends explicitely on pari.

I understand your sentiment, but at least it fixes a bug which I don't know how to fix otherwise. You should also understand that I never claimed that cysignals is 100% bullet-proof. We try to fix most use cases but now and then something breaks (see #24986 for example).

> In an ideal world, all this interrupt buisness should go in upstream Cython, don't you think?

Moving this to upstream Cython won't magically fix the PARI problem.

Besides, I don't think that there is much reason to push it to Cython now that we have cysignals.
