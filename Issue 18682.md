# Issue 18682: random failure in integer.pyx interrupting pari

archive/issues_018682.json:
```json
{
    "body": "CC:  @jdemeyer\n\nKeywords: random_fail\n\nThis fails quite frequently:\n\n```\nsage: 0.binomial(1) ## line 6262 ##\n0\nsage: 0.binomial(-1) ## line 6264 ##\n0\nsage: 13.binomial(2r) ## line 6266 ##\n78\nsage: alarm(0.5); (2^100).binomial(2^22, algorithm='mpir') ## line 6271 ##\nsage: alarm(0.5); (2^100).binomial(2^22, algorithm='pari') ## line 6275 ##\n\n**********************************************************************\n----------------------------------------------------------------------\nsage -t --long src/sage/rings/integer.pyx  # Timed out (and interrupt failed)\n----------------------------------------------------------------------\n```\n\nPossibly consequence of #10476, on the plus side I didn't get the singular failure.\n\nhttp://build.sagedev.org/release/builders/%20%20slow%20AIMS%20%20%28Debian%208%2064%20bit%29%20incremental/builds/7/steps/shell_4/logs/stdio\nhttp://build.sagedev.org/release/builders/%20%20slow%20AIMS%20bu12_32s02%20%28Ubuntu%2012.04%2032%20bit%29%20incremental/builds/19/steps/shell_4/logs/stdio\nhttp://build.sagedev.org/release/builders/%20%20slow%20AIMS%20bu14_64s02%20%28Ubuntu%2014.04%2064%20bit%29%20incremental/builds/22/steps/shell_4/logs/stdio\nhttp://build.sagedev.org/release/builders/%20%20slow%20AIMS%20bu15_32s02%20%28Ubuntu%2015.04%2032%20bit%29%20incremental/builds/23/steps/shell_4/logs/stdio\n\nIssue created by migration from https://trac.sagemath.org/ticket/18919\n\n",
    "created_at": "2015-07-18T09:26:40Z",
    "labels": [
        "component: interfaces",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "random failure in integer.pyx interrupting pari",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18682",
    "user": "https://github.com/vbraun"
}
```
CC:  @jdemeyer

Keywords: random_fail

This fails quite frequently:

```
sage: 0.binomial(1) ## line 6262 ##
0
sage: 0.binomial(-1) ## line 6264 ##
0
sage: 13.binomial(2r) ## line 6266 ##
78
sage: alarm(0.5); (2^100).binomial(2^22, algorithm='mpir') ## line 6271 ##
sage: alarm(0.5); (2^100).binomial(2^22, algorithm='pari') ## line 6275 ##

**********************************************************************
----------------------------------------------------------------------
sage -t --long src/sage/rings/integer.pyx  # Timed out (and interrupt failed)
----------------------------------------------------------------------
```

Possibly consequence of #10476, on the plus side I didn't get the singular failure.

http://build.sagedev.org/release/builders/%20%20slow%20AIMS%20%20%28Debian%208%2064%20bit%29%20incremental/builds/7/steps/shell_4/logs/stdio
http://build.sagedev.org/release/builders/%20%20slow%20AIMS%20bu12_32s02%20%28Ubuntu%2012.04%2032%20bit%29%20incremental/builds/19/steps/shell_4/logs/stdio
http://build.sagedev.org/release/builders/%20%20slow%20AIMS%20bu14_64s02%20%28Ubuntu%2014.04%2064%20bit%29%20incremental/builds/22/steps/shell_4/logs/stdio
http://build.sagedev.org/release/builders/%20%20slow%20AIMS%20bu15_32s02%20%28Ubuntu%2015.04%2032%20bit%29%20incremental/builds/23/steps/shell_4/logs/stdio

Issue created by migration from https://trac.sagemath.org/ticket/18919





---

archive/issue_comments_254183.json:
```json
{
    "body": "It's the PARI library interface, so #10476 cannot be the cause. My bet would something in PARI itself.",
    "created_at": "2015-07-19T00:41:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18682#issuecomment-254183",
    "user": "https://github.com/jdemeyer"
}
```

It's the PARI library interface, so #10476 cannot be the cause. My bet would something in PARI itself.



---

archive/issue_comments_254184.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-07-20T10:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18682#issuecomment-254184",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_254185.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-07-20T10:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18682#issuecomment-254185",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_254186.json:
```json
{
    "body": "I am infinitely happy that you found out a solution for this annoying interrupt! Though, I do not like the fact that now the interrupt code depends explicitely on pari. In an ideal world, all this interrupt buisness should go in upstream Cython, don't you think? Do you have an idea whether it would be possible to have something modular for the interrupt code?",
    "created_at": "2015-08-15T17:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18682#issuecomment-254186",
    "user": "https://github.com/videlec"
}
```

I am infinitely happy that you found out a solution for this annoying interrupt! Though, I do not like the fact that now the interrupt code depends explicitely on pari. In an ideal world, all this interrupt buisness should go in upstream Cython, don't you think? Do you have an idea whether it would be possible to have something modular for the interrupt code?



---

archive/issue_comments_254187.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-08-15T17:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18682#issuecomment-254187",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_254188.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-08-16T11:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18682#issuecomment-254188",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_017859.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2015-08-16T11:08:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18682",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18682#event-17859"
}
```



---

archive/issue_comments_254189.json:
```json
{
    "body": "Replying to [comment:7 vdelecroix]:\n> Though, I do not like the fact that now the interrupt code depends explicitely on pari.\n\nI understand your sentiment, but at least it fixes a bug which I don't know how to fix otherwise. You should also understand that I never claimed that cysignals is 100% bullet-proof. We try to fix most use cases but now and then something breaks (see #24986 for example).\n\n> In an ideal world, all this interrupt buisness should go in upstream Cython, don't you think?\n\nMoving this to upstream Cython won't magically fix the PARI problem.\n\nBesides, I don't think that there is much reason to push it to Cython now that we have cysignals.",
    "created_at": "2018-04-30T08:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18682#issuecomment-254189",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:7 vdelecroix]:
> Though, I do not like the fact that now the interrupt code depends explicitely on pari.

I understand your sentiment, but at least it fixes a bug which I don't know how to fix otherwise. You should also understand that I never claimed that cysignals is 100% bullet-proof. We try to fix most use cases but now and then something breaks (see #24986 for example).

> In an ideal world, all this interrupt buisness should go in upstream Cython, don't you think?

Moving this to upstream Cython won't magically fix the PARI problem.

Besides, I don't think that there is much reason to push it to Cython now that we have cysignals.
