# Issue 28817: polymake: Make it an error at sage ./configure time if Perl prerequisites are missing

Issue created by migration from https://trac.sagemath.org/ticket/29054

Original creator: mkoeppe

Original creation time: 2020-01-20 15:10:27

CC:  dimpase jhpalmieri jipilab arojas isuruf vdelecroix

We do this by adding a script package `perl_cpan_polymake_prereq` (see #27763) with an `spkg-configure.m4` that checks for the prerequisites and an `spkg-install` that always fails.

Simpler than #27763 and more reliable than depending on users reading `build/pkgs/polymake/SPKG.txt`


---

Comment by jhpalmieri created at 2020-03-24 17:02:00

Is this ready for review? Some comments, in any case: when I use this on OS X, `perl_cpan_polymake_prereq` fails to build, and its log file says:

```
.../sage-9.1.beta7/build/bin/sage-logger: line 91: .../sage-9.1.beta7/build/pkgs/perl_cpan_polymake_prereq/spkg-install: Permission denied
```

A key point is that it doesn't have a line matching the regular expression `^Error`, so I see this:

```
The following package(s) may have failed to build (not necessarily
during this run of 'make polymake'):

It is safe to delete any log files and build directories, but they
contain information that is helpful for debugging build problems.
WARNING: If you now run 'make' again, the build directory of the
same version of the package will, by default, be deleted. Set the
environment variable SAGE_KEEP_BUILT_SPKGS=yes to prevent this.
```

I assume you're going to make `spkg-install` fail with a meaningful error message?
----
New commits:


---

Comment by mkoeppe created at 2020-03-24 17:17:42

Thanks for the feedback. This ticket is not ready for review.

What it is missing (the same applies to the "libnauty" business on #27952) is a way for optional packages to signal configure-time errors ONLY if they are configured to be installed. 

This is trickier than it sounds because optional packages may be dependencies of other optional packages.
(See also #29363	At the end of configure, indicate which optional/experimental packages are configured to be installed)


---

Comment by mkoeppe created at 2020-04-12 21:39:07

See also - #29498	Do not check for system packages of disabled optional packages


---

Comment by git created at 2020-04-14 02:19:20

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2020-04-14 02:28:53

`+# known correct on Fedora 23` is a blast from the past. The names are still the same on Fedora 30.


---

Comment by git created at 2020-04-14 02:46:31

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-04-14 02:51:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-04-14 05:25:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-04-14 05:41:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-04-14 05:42:07

Changing status from new to needs_review.


---

Comment by dimpase created at 2020-04-14 06:22:41

without the description on #27763 it's a bit unclear what this is meant to do.


---

Comment by dimpase created at 2020-04-14 06:38:20

lgtm


---

Comment by dimpase created at 2020-04-14 06:38:20

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-04-14 06:45:18

Thanks!


---

Comment by vbraun created at 2020-04-16 22:33:27

Resolution: fixed
