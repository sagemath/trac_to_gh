# Issue 33994: addition in InfinityRing gives wrong result

archive/issues_033994.json:
```json
{
    "body": "CC:  tscrim\n\nThe following code shows an arithmetic bug in `InfinityRing` and broken commutativity:\n\n\n```\nR = InfinityRing\nprint( R(1) + R(0) )\nprint( R(0) + R(1) )\n```\n\n\nWhile `R(1) + R(0)` evaluates to `A positive finite number` (which is correct!), switching the arguments into `R(0) + R(1)` changes the evaluation to `Zero`, which is wrong.\n\nIssue created by migration from https://trac.sagemath.org/ticket/34231\n\n",
    "created_at": "2022-07-27T15:49:50Z",
    "labels": [
        "algebra",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "addition in InfinityRing gives wrong result",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33994",
    "user": "@maxale"
}
```
CC:  tscrim

The following code shows an arithmetic bug in `InfinityRing` and broken commutativity:


```
R = InfinityRing
print( R(1) + R(0) )
print( R(0) + R(1) )
```


While `R(1) + R(0)` evaluates to `A positive finite number` (which is correct!), switching the arguments into `R(0) + R(1)` changes the evaluation to `Zero`, which is wrong.

Issue created by migration from https://trac.sagemath.org/ticket/34231





---

archive/issue_comments_482601.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2022-07-27T15:53:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33994#issuecomment-482601",
    "user": "@maxale"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_482602.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-07-28T02:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33994#issuecomment-482602",
    "user": "@DaveWitteMorris"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_482603.json:
```json
{
    "body": "Thanks for pointing out the bug. I think this will fix it.\n----\nNew commits:",
    "created_at": "2022-07-28T02:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33994#issuecomment-482603",
    "user": "@DaveWitteMorris"
}
```

Thanks for pointing out the bug. I think this will fix it.
----
New commits:



---

archive/issue_comments_482604.json:
```json
{
    "body": "Looks like `CommutativeAdditiveSemigroups` forgets to provide a test method `_test_additive_commutativity` and `InfinityRing` forgets to do `TestSuite(InfinityRing).run()` in a doctest",
    "created_at": "2022-07-28T06:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33994#issuecomment-482604",
    "user": "mkoeppe"
}
```

Looks like `CommutativeAdditiveSemigroups` forgets to provide a test method `_test_additive_commutativity` and `InfinityRing` forgets to do `TestSuite(InfinityRing).run()` in a doctest



---

archive/issue_comments_482605.json:
```json
{
    "body": "Replying to [comment:5 mkoeppe]:\n> Looks like `CommutativeAdditiveSemigroups` forgets to provide a test method `_test_additive_commutativity` and `InfinityRing` forgets to do `TestSuite(InfinityRing).run()` in a doctest\n\nThis file predates the `TestSuite`, so it is not surprising it is not in there. I am also a bit worried that because addition is only a partially defined operation and it has multiple element classes, the `TestSuite` run would not be guaranteed to work for most of the tests.\n\nThere are probably ways on improving this, but at least for now, this fixes a clear bug and tests against it. So positive review.",
    "created_at": "2022-07-29T02:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33994#issuecomment-482605",
    "user": "tscrim"
}
```

Replying to [comment:5 mkoeppe]:
> Looks like `CommutativeAdditiveSemigroups` forgets to provide a test method `_test_additive_commutativity` and `InfinityRing` forgets to do `TestSuite(InfinityRing).run()` in a doctest

This file predates the `TestSuite`, so it is not surprising it is not in there. I am also a bit worried that because addition is only a partially defined operation and it has multiple element classes, the `TestSuite` run would not be guaranteed to work for most of the tests.

There are probably ways on improving this, but at least for now, this fixes a clear bug and tests against it. So positive review.



---

archive/issue_comments_482606.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-07-29T02:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33994#issuecomment-482606",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_482607.json:
```json
{
    "body": "Thanks!",
    "created_at": "2022-07-29T04:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33994#issuecomment-482607",
    "user": "@DaveWitteMorris"
}
```

Thanks!



---

archive/issue_comments_482608.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-04T22:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33994#issuecomment-482608",
    "user": "vbraun"
}
```

Resolution: fixed
