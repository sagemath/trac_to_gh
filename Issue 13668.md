# Issue 13668: Non-exceptional rigged configuration bijections

Issue created by migration from https://trac.sagemath.org/ticket/13872

Original creator: tscrim

Original creation time: 2012-12-28 04:49:43

Assignee: tscrim

CC:  sage-combinat aschilling

Keywords: rigged configurations bijection crystals

Implements the bijection between rigged configurations and tensor products of Kirillov-Reshetikhin tableaux for the non-exceptional types.


---

Comment by tscrim created at 2013-02-21 17:49:18

Changing status from new to needs_review.


---

Comment by tscrim created at 2013-07-09 11:02:01

New version over changes in #13871.


---

Comment by tscrim created at 2013-08-30 22:45:02

Newer version over changes in #13871 and #13838.


---

Comment by aschilling created at 2013-09-24 12:58:36

Hi Travis,

Thanks for your changes we discussed via email. Next there are problems for D_4^{(2)}

```
sage: for t in KRT:
    rc = t.to_rigged_configuration()
    if not t==rc.to_tensor_product_of_Kirillov_Reshetikhin_tableaux():
        print t
....:
[[[1], [0], [0]], [[1, 2], [2, -2]], [[1, E]]]
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-8-925815db1a74> in <module>()
      1 for t in KRT:
      2     rc = t.to_rigged_configuration()
----> 3     if not t==rc.to_tensor_product_of_Kirillov_Reshetikhin_tableaux():
      4         print t
      5

/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/crystals/tensor_product.pyc in __eq__(self, other)
    146         return self.__class__ is other.__class__ and \
    147                self.parent() == other.parent() and \
--> 148                self._list == other._list
    149
    150     def __ne__(self, other):

/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/crystals/tensor_product.pyc in __eq__(self, other)
    146         return self.__class__ is other.__class__ and \
    147                self.parent() == other.parent() and \
--> 148                self._list == other._list
    149
    150     def __ne__(self, other):

/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/crystals/letters.so in sage.combinat.crystals.letters.Letter.__richcmp__ (sage/combinat/crystals/letters.c:6559)()

/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.Element._richcmp (sage/structure/element.c:8765)()

/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/crystals/letters.so in sage.combinat.crystals.letters.Letter._richcmp_c_impl (sage/combinat/crystals/letters.c:6617)()

TypeError: Cannot convert sage.combinat.crystals.letters.EmptyLetter to sage.combinat.crystals.letters.Letter
```


Best,

Anne


---

Comment by aschilling created at 2013-09-26 23:42:18

Hi Travis,

I am also confused since the cardinalities do not match up in your code:

```
sage: RC = RiggedConfigurations(['D',4,2], [[3,1],[2,2],[1,2]])
sage: RC.cardinality()
403025

sage: K1 = KirillovReshetikhinCrystal(['D',4,2],3,1)
sage: K2 = KirillovReshetikhinCrystal(['D',4,2],2,2)
sage: K3 = KirillovReshetikhinCrystal(['D',4,2],1,2)
sage: T = TensorProductOfCrystals(K1,K2,K3)
sage: T.cardinality()
92120
```


Best,

Anne


---

Comment by aschilling created at 2013-10-30 00:41:43

Changing status from needs_review to needs_work.


---

Comment by aschilling created at 2013-10-30 00:52:14

Hi Travis,

As we discussed, could you please add which bijections are conjectural and which ones are proven? Also, I currently get some doctest failures with the patch in sage-combinat queue:



```
rigged_configurations anne$ sage -t *.py
Running doctests with ID 2013-10-29-17-44-20-1f870a4b.
Doctesting 19 files.
sage -t __init__.py
    [0 tests, 0.00 s]
sage -t all.py
    [0 tests, 0.00 s]
sage -t bij_abstract_class.py
**********************************************************************
File "bij_abstract_class.py", line 358, in sage.combinat.rigged_configurations.bij_abstract_class.RCToKRTBijectionAbstract.run
Failed example:
    RCToKRTBijectionTypeA(RC(partition_list=[[1],[1],[1],[1]])).run()
Expected:
    [[5, 2]]
Got:
    [[2], [5]]
**********************************************************************
1 item had failures:
   1 of   4 in sage.combinat.rigged_configurations.bij_abstract_class.RCToKRTBijectionAbstract.run
    [54 tests, 1 failure, 0.77 s]
sage -t bij_type_A.py
    [19 tests, 0.17 s]
sage -t bij_type_A2_dual.py
    [19 tests, 0.27 s]
sage -t bij_type_A2_even.py
    [19 tests, 0.20 s]
sage -t bij_type_A2_odd.py
    [19 tests, 0.25 s]
sage -t bij_type_B.py
**********************************************************************
File "bij_type_B.py", line 532, in sage.combinat.rigged_configurations.bij_type_B.RCToKRTBijectionTypeB.run
Failed example:
    RCToKRTBijectionTypeB(RC(partition_list=[[1],[1,1],[1]])).run()
Expected:
    [[0, 3]]
Got:
    [[3], [0]]
**********************************************************************
File "bij_type_B.py", line 536, in sage.combinat.rigged_configurations.bij_type_B.RCToKRTBijectionTypeB.run
Failed example:
    RCToKRTBijectionTypeB(RC(partition_list=[[],[1],[1]])).run()
Expected:
    [[-2, 3, 1]]
Got:
    [[1], [3], [-2]]
**********************************************************************
1 item had failures:
   2 of   7 in sage.combinat.rigged_configurations.bij_type_B.RCToKRTBijectionTypeB.run
    [34 tests, 2 failures, 0.27 s]
sage -t bij_type_C.py
    [28 tests, 0.24 s]
sage -t bij_type_D.py
**********************************************************************
File "bij_type_D.py", line 428, in sage.combinat.rigged_configurations.bij_type_D.RCToKRTBijectionTypeD.run
Failed example:
    RCToKRTBijectionTypeD(RC(partition_list=[[1],[1],[1],[1]])).run()
Expected:
    [[-3, 2]]
Got:
    [[2], [-3]]
**********************************************************************
1 item had failures:
   1 of   4 in sage.combinat.rigged_configurations.bij_type_D.RCToKRTBijectionTypeD.run
    [75 tests, 1 failure, 0.21 s]
sage -t bij_type_D_twisted.py
**********************************************************************
File "bij_type_D_twisted.py", line 327, in sage.combinat.rigged_configurations.bij_type_D_twisted.RCToKRTBijectionTypeDTwisted.run
Failed example:
    RCToKRTBijectionTypeDTwisted(RC(partition_list=[[],[1],[1]])).run()
Expected:
    [[-2, 3, 1]]
Got:
    [[1], [3], [-2]]
**********************************************************************
1 item had failures:
   1 of   4 in sage.combinat.rigged_configurations.bij_type_D_twisted.RCToKRTBijectionTypeDTwisted.run
    [25 tests, 1 failure, 0.21 s]
sage -t bijection.py
    [6 tests, 0.16 s]
sage -t kleber_tree.py
    [201 tests, 4.01 s]
sage -t kr_tableaux.py
**********************************************************************
File "kr_tableaux.py", line 1363, in sage.combinat.rigged_configurations.kr_tableaux.KRTableauxWrapper._build_module_generators
Failed example:
    KRT._build_module_generators()
Expected:
    ([(-1, 3)],)
Got:
    ([(1,)],)
**********************************************************************
File "kr_tableaux.py", line 1398, in sage.combinat.rigged_configurations.kr_tableaux.KRTableauxWrapper.Element._repr_diagram
Failed example:
    elt._repr_diagram()
Exception raised:
    Traceback (most recent call last):
      File "/Applications/sage-5.12/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 479, in _run
        self.execute(example, compiled, test.globs)
      File "/Applications/sage-5.12/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 838, in execute
        exec compiled in globs
      File "<doctest sage.combinat.rigged_configurations.kr_tableaux.KRTableauxWrapper.Element._repr_diagram[2]>", line 1, in <module>
        elt._repr_diagram()
      File "/Applications/sage-5.12/local/lib/python2.7/site-packages/sage/combinat/rigged_configurations/kr_tableaux.py", line 1402, in _repr_diagram
        return self.to_tableau()._repr_diagram()
      File "cachefunc.pyx", line 1774, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (sage/misc/cachefunc.c:9546)
      File "/Applications/sage-5.12/local/lib/python2.7/site-packages/sage/combinat/rigged_configurations/kr_tableaux.py", line 1439, in to_tableau
        raise ValueError("cannot convert {} to a tableau".format(self))
    ValueError: cannot convert [(-1, 3)] to a tableau
**********************************************************************
File "kr_tableaux.py", line 1480, in sage.combinat.rigged_configurations.kr_tableaux.KRTableauxWrapper.Element.weight
Failed example:
    KR.module_generators[0].weight()
Exception raised:
    Traceback (most recent call last):
      File "/Applications/sage-5.12/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 479, in _run
        self.execute(example, compiled, test.globs)
      File "/Applications/sage-5.12/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 838, in execute
        exec compiled in globs
      File "<doctest sage.combinat.rigged_configurations.kr_tableaux.KRTableauxWrapper.Element.weight[1]>", line 1, in <module>
        KR.module_generators[Integer(0)].weight()
    NameError: name 'KR' is not defined
**********************************************************************
File "kr_tableaux.py", line 1492, in sage.combinat.rigged_configurations.kr_tableaux.KRTableauxWrapper.Element.e
Failed example:
    KRT.module_generators[0].e(0)
Expected:
    [[-2, 1], [-1, -1]]
Got:
    [(-2, 1)]
**********************************************************************
File "kr_tableaux.py", line 1507, in sage.combinat.rigged_configurations.kr_tableaux.KRTableauxWrapper.Element.f
Failed example:
    KRT.module_generators[0].f(0)
Expected:
    [[1, 1], [2, -1]]
Got:
    <BLANKLINE>
**********************************************************************
5 items had failures:
   1 of   4 in sage.combinat.rigged_configurations.kr_tableaux.KRTableauxWrapper.Element._repr_diagram
   1 of   3 in sage.combinat.rigged_configurations.kr_tableaux.KRTableauxWrapper.Element.e
   1 of   3 in sage.combinat.rigged_configurations.kr_tableaux.KRTableauxWrapper.Element.f
   1 of   3 in sage.combinat.rigged_configurations.kr_tableaux.KRTableauxWrapper.Element.weight
   1 of   3 in sage.combinat.rigged_configurations.kr_tableaux.KRTableauxWrapper._build_module_generators
    [217 tests, 5 failures, 37.97 s]
sage -t rigged_configuration_element.py
    [92 tests, 1.31 s]
sage -t rigged_configurations.py
    [180 tests, 5.29 s]
sage -t rigged_partition.py
    [54 tests, 0.22 s]
sage -t tensor_product_kr_tableaux.py
    [78 tests, 2.19 s]
sage -t tensor_product_kr_tableaux_element.py
    [61 tests, 0.86 s]
----------------------------------------------------------------------
sage -t bij_abstract_class.py  # 1 doctest failed
sage -t bij_type_B.py  # 2 doctests failed
sage -t bij_type_D.py  # 1 doctest failed
sage -t bij_type_D_twisted.py  # 1 doctest failed
sage -t kr_tableaux.py  # 5 doctests failed
----------------------------------------------------------------------
Total time for all tests: 56.2 seconds
    cpu time: 51.8 seconds
    cumulative wall time: 54.6 seconds
```



Best,

Anne


---

Attachment


---

Comment by tscrim created at 2013-11-06 20:00:30

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2013-11-06 20:00:30

New version with all of the fixes.


---

Comment by git created at 2013-11-07 22:53:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-08 00:12:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-08 00:14:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-08 00:30:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-08 02:16:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aschilling created at 2013-11-08 06:57:22

Your current code does not give a bijection

```
sage: T = TensorProductOfKirillovReshetikhinTableaux(['D',4,1],[[2,1],[3,1],[2,2]])
sage: for t in T:
...:    if t.to_rigged_configuration().to_tensor_product_of_kirillov_reshetikhin_tableaux() != t:
....:       print t
....:         
[[[-4], [4]], [[1], [2], [3], [-4]], [[-2, 1], [-1, 2]]]
[[[-4], [4]], [[1], [2], [3], [-4]], [[1, 1], [2, -1]]]
...
```



---

Comment by git created at 2013-11-08 16:45:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-08 18:26:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aschilling created at 2013-11-08 22:56:46

Changing keywords from "rigged configurations bijection crystals" to "rigged configurations bijection crystals, days54".


---

Comment by git created at 2013-11-09 23:25:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-13 22:12:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-14 04:37:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-14 16:58:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-20 22:59:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-22 19:07:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-25 00:31:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aschilling created at 2013-11-25 00:47:43

Hi Travis,

I just pushed some small changes to the documentation. Everything else looks good now. If you agree with the changes, please set a positive review on my behalf!

Anne


---

Comment by tscrim created at 2013-11-25 02:03:27

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2013-11-25 02:03:27

Thank you Anne for your work in reviewing this.


---

Comment by aschilling created at 2013-11-27 23:38:43

Changing status from positive_review to needs_work.


---

Comment by aschilling created at 2013-11-27 23:42:26

Hi Travis,

The implementation of the fermionic sum does not seem correct. As is stated in the documentation, it depends on a weight \lambda whereas the implementation does not take a weight as an input! You can compare against the highest weight terms in

```
sage: K = KirillovReshetikhinCrystal(['A',2,1],1,1)
sage: T = TensorProductOfCrystals(K,K)
sage: T.one_dimensional_configuration_sum()
B[-2*Lambda[1] + 2*Lambda[2]] + (q+1)*B[-Lambda[1]] + (q+1)*B[Lambda[1] - Lambda[2]] + B[2*Lambda[1]] + B[-2*Lambda[2]] + (q+1)*B[Lambda[2]]
```

to check that your result is correct.

Anne


---

Comment by git created at 2013-11-28 20:38:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2013-11-28 20:39:48

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2013-11-28 20:39:48

Fixed. Now it can take a few arguments to change the output behavior as well.


---

Comment by git created at 2013-11-28 22:43:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aschilling created at 2013-12-01 06:22:33

I looked at your latest changes. Why are the changes in crystals/tensor_product.py necessary? Also, the equality between the one-dimensional configuration sums and fermionic formula has been proven in many cases. So the statement that it is conjectural is not quite right. Please add references!

Also, with the new code I get doc test failures

```
sage -t tensor_product.py
**********************************************************************
File "tensor_product.py", line 278, in sage.combinat.crystals.tensor_product.CrystalOfWords.one_dimensional_configuration_sum
Failed example:
    LS.one_dimensional_configuration_sum() == T.one_dimensional_configuration_sum()
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of  14 in sage.combinat.crystals.tensor_product.CrystalOfWords.one_dimensional_configuration_sum
    [361 tests, 1 failure, 48.77 s]
sage -t alcove_path.py
    [220 tests, 41.31 s]
sage -t littelmann_path.py
**********************************************************************
    True
Got:
    False
**********************************************************************
File "littelmann_path.py", line 693, in sage.combinat.crystals.littelmann_path.CrystalOfProjectedLevelZeroLSPaths.one_dimensional_configuration_sum
Failed example:
    T.one_dimensional_configuration_sum() == LS.one_dimensional_configuration_sum()
Expected:
    True
Got:
    False
**********************************************************************
File "littelmann_path.py", line 701, in sage.combinat.crystals.littelmann_path.CrystalOfProjectedLevelZeroLSPaths.one_dimensional_configuration_sum
Failed example:
    T.one_dimensional_configuration_sum() == LS.one_dimensional_configuration_sum()
Expected:
    True
Got:
    False
**********************************************************************
```

It would be good not to change the existing functionality in tensor_products.py!

Anne


---

Comment by aschilling created at 2013-12-01 06:23:14

Changing status from needs_review to needs_work.


---

Comment by git created at 2013-12-01 19:35:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2013-12-01 19:39:46

So the above errors came from the fact that I changed the 1-dim config sum to use `ZZ['t']` instead of `QQ['t']` since this made more sense to me as we are q-counting things. I reverted this back, although I do want to leave in the expanded type checking so 1-dim config sum works for tensors products of KR tableaux. I also added references to `fermionic_formula()` for when this is known to be equal to the 1-dim config sum.


---

Comment by tscrim created at 2013-12-01 19:39:46

Changing status from needs_work to needs_review.


---

Comment by git created at 2013-12-04 00:51:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aschilling created at 2013-12-04 00:52:33

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2013-12-04 16:09:06

Thank you Anne.


---

Comment by git created at 2013-12-11 20:11:13

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. Last 10 new commits:


---

Comment by git created at 2013-12-11 20:11:13

Changing status from positive_review to needs_review.


---

Comment by tscrim created at 2013-12-11 20:12:54

Hmm...somehow I've (erroneously) merged the branch from #15161 into this one. I'll separate shortly.


---

Comment by git created at 2013-12-11 21:02:28

Branch pushed to git repo; I updated commit sha1. This was a forced push. Recent commits:


---

Comment by git created at 2013-12-11 21:07:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2013-12-11 21:08:47

Okay, everything should be fixed now.


---

Comment by aschilling created at 2013-12-12 01:31:28

Replying to [comment:53 tscrim]:
> Okay, everything should be fixed now.

I am not sure. When I did git pull I got

```
d144:rigged_configurations anne$ git pull
Auto-merging src/sage/combinat/rigged_configurations/tensor_product_kr_tableaux.py
CONFLICT (content): Merge conflict in src/sage/combinat/rigged_configurations/tensor_product_kr_tableaux.py
Auto-merging src/sage/combinat/rigged_configurations/rigged_configurations.py
CONFLICT (content): Merge conflict in src/sage/combinat/rigged_configurations/rigged_configurations.py
Auto-merging src/sage/combinat/crystals/letters.pyx
CONFLICT (content): Merge conflict in src/sage/combinat/crystals/letters.pyx
Removing build/pkgs/r/patches/cygwin-logl.patch
Automatic merge failed; fix conflicts and then commit the result.
```

I did not have any local changes, so I am not sure why there is a conflict.


---

Comment by tscrim created at 2013-12-12 04:13:35

(Unfortunately) I had to do some history rewriting, but I thought it would have been fine since it was about the merging of the master branch. I had too many issues trying to run `git revert`. I might have been better off using a `git reset` and then merge in via cherry-picking, but that probably would still result in merge conflicts since the histories wouldn't match. I'd recommend forcing a fetch from the trac branch into your local copy. (Another possible hindsight is we probably could've left this alone since #15161 is positively reviewed...I still have no idea how that got merged into here...)


---

Comment by aschilling created at 2013-12-15 01:57:56

Ok, looks good to me.

Anne


---

Comment by aschilling created at 2013-12-15 01:58:16

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2013-12-21 18:43:47

Resolution: fixed
