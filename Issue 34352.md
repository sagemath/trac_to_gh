# Issue 34352: VectorFieldModule, TensorFieldModule, DiffFormModule: Add methods tensor_product, tensor_power

Issue created by migration from https://trac.sagemath.org/ticket/34589

Original creator: mkoeppe

Original creation time: 2022-09-26 17:14:15

CC:  egourgoulhon tscrim @mjungmath

... as previously done for `FiniteRankFreeModule` etc.


---

Comment by mkoeppe created at 2022-09-26 17:21:45

Probably best to create a class `VectorFieldModule_abstract`
----
Last 10 new commits:


---

Comment by git created at 2022-09-27 02:59:13

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-09-27 21:12:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-28 00:29:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-28 00:50:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-09-28 00:51:47

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-09-29 00:14:58

This new base class is of course not very pretty

```
+class VectorFieldModule_abstract(UniqueRepresentation, Parent):
+    r"""
+    Abstract base class for modules of vector fields.
+    """
+
+    tensor_power = FiniteRankFreeModule_abstract.tensor_power
+
+    tensor_product = FiniteRankFreeModule_abstract.tensor_product
+
+    tensor = FiniteRankFreeModule_abstract.tensor
```


It could be better to have a common base class for `VectorFieldModule_abstract` and `FiniteRankFreeModule_abstract`. 

Perhaps that could be called `ModuleWithDual_abstract`? (see also #13372)


---

Comment by mkoeppe created at 2022-09-29 00:54:51

Algebra question - do we know / do we assume that a `VectorFieldModule` is reflexive?


---

Comment by mkoeppe created at 2022-09-29 01:32:50

(in this case, we could call it `ReflexiveModule_abstract` - for such modules the pair `tensor_type` makes sense.)


---

Comment by egourgoulhon created at 2022-09-29 08:55:21

Replying to [comment:12 Matthias Köppe]:
> Algebra question - do we know / do we assume that a `VectorFieldModule` is reflexive?
I would say that the vector field modules are indeed reflexive for the cases we can treat with Sage, namely those for which the manifold M can be split into a finite number of parallelizable manifolds N_i, i.e. there is a finite open cover of M, (N_i)_{1\leq i \leq p} (p finite), such that for each i, N_i is parallelizable. Let then consider an element f of `X(M)**`, where `X(M)` is the C<sup>oo</sup>(M)-module of vector fields on M. For a in `X(M)*`, f(a) can be reduced to f_i(a_i) on each N_i. Since N_i is parallelizable, X(N_i) is a free module of finite rank and thus reflexive. There exists then a unique v_i in X(N_i) such that f_i(a_i) = a_i(v_i). Then the vector field v in X(M) defined as being equal to v_i on each N_i obeys f(a) = a(v), which shows that the canonical map `X(M) --> X(M)**` is bijective. This is a first quick thought and this should be double checked...


---

Comment by egourgoulhon created at 2022-09-29 12:21:42

Replying to [comment:13 Matthias Köppe]:
> (in this case, we could call it `ReflexiveModule_abstract` - for such modules the pair `tensor_type` makes sense.)
Indeed, if we confirm that the vector field modules are reflexive.


---

Comment by mkoeppe created at 2022-09-29 18:22:29

Replying to [comment:14 Eric Gourgoulhon]:
> I would say that the vector field modules are indeed reflexive for the cases we can treat with Sage, namely those for which the manifold M can be split into a finite number of parallelizable manifolds N_i, i.e. there is a finite open cover of M, (N_i)_{1\leq i \leq p} (p finite), such that for each i, N_i is parallelizable.

Is this splitting into parallelizable manifolds explicitly done somewhere in the code?

I guess a subtlety is that in sage.manifolds a manifold M is thought to be immutable but new submanifolds on it can be declared imperatively. At any point, of course only finitely many submanifolds have been declared in M as a Python object, but it's not clear that M as a mathematical object is really assumed to be covered by only a finite number of parallelizable submanifolds...


---

Comment by egourgoulhon created at 2022-09-29 20:38:07

Replying to [comment:16 Matthias Köppe]:
> Replying to [comment:14 Eric Gourgoulhon]:
> > I would say that the vector field modules are indeed reflexive for the cases we can treat with Sage, namely those for which the manifold M can be split into a finite number of parallelizable manifolds N_i, i.e. there is a finite open cover of M, (N_i)_{1\leq i \leq p} (p finite), such that for each i, N_i is parallelizable.
> 
> Is this splitting into parallelizable manifolds explicitly done somewhere in the code?

Not explicitly, but `DifferentiableManifold`'s have the attribute `_parrelizable_parts`; for instance:

```
sage: M = manifolds.Sphere(2, coordinates='stereographic')
sage: M._parallelizable_parts
{Open subset S^2-{NP,SP} of the 2-sphere S^2 of radius 1 smoothly embedded in the Euclidean space E^3,
 Open subset S^2-{NP} of the 2-sphere S^2 of radius 1 smoothly embedded in the Euclidean space E^3,
 Open subset S^2-{SP} of the 2-sphere S^2 of radius 1 smoothly embedded in the Euclidean space E^3}
sage: M._open_covers
[[2-sphere S^2 of radius 1 smoothly embedded in the Euclidean space E^3],
 [Open subset S^2-{NP} of the 2-sphere S^2 of radius 1 smoothly embedded in the Euclidean space E^3,
  Open subset S^2-{SP} of the 2-sphere S^2 of radius 1 smoothly embedded in the Euclidean space E^3]]
```

Actually the parallelizable parts are declared on the fly, in the same spirit as the charts and other structures on the manifod. Even the parallelizable aspect of the manifold can appear quite late after the manifold instanciation. For example, in this [notebook about S^1](https://nbviewer.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_sphere_S1.ipynb), the manifold is (implicitly) declared parallelizable only in cell no. 21, by declaring a vector frame on it. This action creates the object X(M) as a `VectorFieldFreeModule`. Previously, only the modules X(A) and X(B) had been instanciated.  However, one could imagine to add the keyword argument `parallelizable` to the manifold constructor (with default being `False`).
> 
> I guess a subtlety is that in sage.manifolds a manifold M is thought to be immutable but new submanifolds on it can be declared imperatively. At any point, of course only finitely many submanifolds have been declared in M as a Python object, but it's not clear that M as a mathematical object is really assumed to be covered by only a finite number of parallelizable submanifolds...

You're right, this should be stated in the manifold documentation. The whole idea is described in Sec. 3.2 and 3.3 of this [document](https://ccirm.centre-mersenne.org/item/CCIRM_2018__6_1_A1_0/).
Note that the finite number of parallelizable pieces is not a very severe limitation. For instance this holds for any compact manifold. Actually I don't know any manifold that is not of this type, not that I doubt that some examples can be constructed...


---

Comment by git created at 2022-09-29 23:53:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-09-29 23:57:34

Here's a draft of refactoring along these lines. (Of course src/sage/tensor/modules/reflexive_module.py would still need more documentation.)


---

Comment by git created at 2022-09-29 23:58:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-10-02 06:00:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-10-02 18:30:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-10-02 18:43:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2022-10-03 09:34:26

Looks nice! Thanks.

An entry for the new file `reflexive_module.py` is missing in `src/doc/en/reference/tensor_free_modules/`, so that the documentation is not generated. I would suggest to add it in `src/doc/en/reference/tensor_free_modules/tensors.rst`. Once this is done,

```
sage -docbuild reference/tensor_free_modules html
```

reveals that some `$` signs should be replaced by backticks:

```diff
-    the `R`-module of linear functionals $\phi:\ M \longrightarrow R$.
+    the `R`-module of linear functionals `\phi:\ M \longrightarrow R`.
```



---

Comment by egourgoulhon created at 2022-10-03 09:40:18

Travis, Michael, if you have time (not sure this is the case at the moment...), could you comment on the argument sketched in comment:14 ?


---

Comment by tscrim created at 2022-10-03 10:04:59

I think it is good. I do not quite see how it might break down for more obtuse finite-dimensional examples, but the question is should it? I think no, but I typically think in terms of "nice" objects.


---

Comment by egourgoulhon created at 2022-10-03 10:06:17

Replying to [comment:28 Travis Scrimshaw]:
> I think it is good. I do not quite see how it might break down for more obtuse finite-dimensional examples, but the question is should it? I think no, but I typically think in terms of "nice" objects.
Thank you Travis!


---

Comment by git created at 2022-10-03 11:31:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2022-10-04 09:28:34

I have two questions regarding the inheritance structure:

1/ There is a disymmetry in the MRO between `FiniteRankFreeModule`, `FiniteDualFreeModule` and `TensorFreeModule`: for the first two classes, the inheritance order is `(ReflexiveModule_(base or dual), FiniteRankFreeModule_abstract)`,  while for the third class it is the opposite order: `(FiniteRankFreeModule_abstract, ReflexiveModule_tensor)`. Is this intended?

2/ The class `VectorFieldModule_abstract` has no method at all. Is such a class necessary? The only use I can see is that classes that inherit from it inherit from the pair `(UniqueRepresentation, ReflexiveModule_abstract)`, but it would be more clear to make this explicit in those classes, instead of using `VectorFieldModule_abstract` as a proxy for `(UniqueRepresentation, ReflexiveModule_abstract)`. Also, the name `VectorFieldModule_abstract` could be misleading since for instance `DiffFormModule` inherits from it.


---

Comment by git created at 2022-10-04 18:05:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-10-04 18:05:44

1) Thanks for catching this, fixed.


---

Comment by mkoeppe created at 2022-10-04 18:10:12

2) I guess I was planning to move some methods from `VectorFieldModule` to `VectorField_abstract`. Candidates would be `domain`, `ambient_domain`, and perhaps some others. But I agree that the name `VectorFieldModule_abstract` is misleading... Would you have a suggestion for a better name? It also doesn't have to happen on this ticket -- I can just back it out.


---

Comment by egourgoulhon created at 2022-10-05 06:24:48

Replying to [comment:34 Matthias Köppe]:
> 2) I guess I was planning to move some methods from `VectorFieldModule` to `VectorField_abstract`. Candidates would be `domain`, `ambient_domain`, and perhaps some others. But I agree that the name `VectorFieldModule_abstract` is misleading... Would you have a suggestion for a better name? 

Maybe `FieldModule_abstract`?

> It also doesn't have to happen on this ticket -- I can just back it out.

OK.


---

Comment by egourgoulhon created at 2022-10-31 13:50:02

May I ask what do we choose? Renaming `VectorFieldModule_abstract` to `FieldModule_abstract` (or something similar) or backing it out for this ticket?


---

Comment by mkoeppe created at 2022-11-12 23:02:15

I'll back it out


---

Comment by mkoeppe created at 2022-11-12 23:02:15

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-11-12 23:06:21

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2022-11-12 23:25:27

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2022-11-12 23:25:44

Changing status from needs_work to needs_review.


---

Comment by egourgoulhon created at 2022-11-13 10:39:26

Replying to [comment:37 Matthias Köppe]:
> I'll back it out

Thanks!

One minor last thing: as revealed by the patchbot, `ReflexiveModule_abstract` is imported by unused in `vectorfield_module.py`.


---

Comment by git created at 2022-11-13 18:10:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2022-11-13 20:26:32

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2022-11-13 20:26:32

Thanks!


---

Comment by mkoeppe created at 2022-11-13 23:30:45

Thank you!


---

Comment by vbraun created at 2022-11-15 23:43:08

Resolution: fixed
