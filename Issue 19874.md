# Issue 19874: Cleaning of subword complex code

Issue created by migration from Trac.

Original creator: stumpc5

Original creation time: 2016-02-25 11:58:32

CC:  tscrim chapoton




---

Comment by stumpc5 created at 2016-02-25 12:13:59

Changing status from new to needs_info.


---

Comment by stumpc5 created at 2016-02-25 12:13:59

Using the category framework for subword complexes.

TODO: make subword complex elements instances of its category element class

```
sage: W = CoxeterGroup(['A',2])
sage: w = W.from_reduced_word([1,2,1])
sage: S = SubwordComplex([1,2,1,2,1],w)
sage: F = S.an_element()
sage: isinstance(F,F.parent().category().element_class)
False
sage: type(F)
<class 'sage.combinat.subword_complex.SubwordComplexFacet'>
sage: F.parent().category().element_class
<class 'sage.categories.simplicial_complexes.SimplicialComplexes.Finite.element_class'>
```

----
New commits:


---

Comment by stumpc5 created at 2016-02-25 12:13:59

Changing component from PLEASE CHANGE to combinatorics.


---

Comment by stumpc5 created at 2016-02-25 12:13:59

Changing keywords from "" to "subword complex".


---

Comment by stumpc5 created at 2016-02-25 12:13:59

Changing type from PLEASE CHANGE to enhancement.


---

Comment by stumpc5 created at 2016-02-25 12:19:23

The diff is a pain -- I had to interchange the appearance of the classes `SubwordComplex` and `SubwordComplexFacet` in the file in order to write `Element = SubwordComplexFacet` into the `SubwordComplex` class.

So what did I change:

* the the init of subword complex
* added the `__classcall__` method to make parents unique
* tiny changes to make the input a tuple instead of a list (this also forced changes in multiple other places such as `Q.reverse` or in the function definition of the cython file.

Once the above issue is solved, this is ready for review.


---

Comment by tscrim created at 2016-02-25 17:39:33

Instead of reordering, you could have just added (at the module level) `SubwordComplex.Element = SubwordComplexFacet` (although in some ways I think the reordered way is better, but we can get to that after we decide the color of the bikeshed). As for the issue above, all you should have to do replacements like this:

```diff
-return SubwordComplexFacet(self, F, facet_test=facet_test)
+return self.element_class(self, F, facet_test=facet_test)
```



---

Comment by git created at 2016-02-26 08:35:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by stumpc5 created at 2016-02-26 08:36:14

Thanks, that worked. It's ready for review I guess!


---

Comment by stumpc5 created at 2016-02-26 08:36:14

Changing status from needs_info to needs_review.


---

Comment by tscrim created at 2016-03-03 07:01:57

Some comments:

- Could you add some doctests to `__classcall__` (good tests include checking the uniqueness against different input types)?
- Could you add a `TestSuite(SC).run()` (possibly skipping tests)?
- The `SubwordComplex.__eq__` is redundant (and slower) than that given by `UniqueRepresentation`.
- Instead of `__call__`, you should be able to use `_element_constructor_`. By doing this, it fits into Sage's coercion framework (although I guess that doesn't quite apply here [yet]) and you shouldn't have to do `hasattr(F,"parent") and F.parent() is self`.

I can also work on this over the weekend.


---

Comment by stumpc5 created at 2016-03-05 16:03:41

Replying to [comment:7 tscrim]:
> - Could you add a `TestSuite(SC).run()` (possibly skipping tests)?

This is already done in the tests inside `__init__`. Or do you mean something else?

> - Instead of `__call__`, you should be able to use `_element_constructor_`. By doing this, it fits into Sage's coercion framework (although I guess that doesn't quite apply here [yet]) and you shouldn't have to do `hasattr(F,"parent") and F.parent() is self`.

If I do that, the class inherits the `__call__` from simplicial complexes, which then results `SC([0,1])` to not return an element class element but a list. What is appropriate then here?


---

Comment by git created at 2016-03-05 16:06:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-03-05 23:31:38

Replying to [comment:8 stumpc5]:
> Replying to [comment:7 tscrim]:
> > - Could you add a `TestSuite(SC).run()` (possibly skipping tests)?
> 
> This is already done in the tests inside `__init__`. Or do you mean something else?

Ah, sorry, I missed that.

> > - Instead of `__call__`, you should be able to use `_element_constructor_`. By doing this, it fits into Sage's coercion framework (although I guess that doesn't quite apply here [yet]) and you shouldn't have to do `hasattr(F,"parent") and F.parent() is self`.
> 
> If I do that, the class inherits the `__call__` from simplicial complexes, which then results `SC([0,1])` to not return an element class element but a list. What is appropriate then here?

I guess we can just leave it for now.

I pushed some changes that fix the failing doctests and do a few tweaks to the Cython file. If you agree with my changes, then you can set a positive review.
----
New commits:


---

Comment by stumpc5 created at 2016-03-07 10:04:10

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-03-08 23:31:00

Resolution: fixed
