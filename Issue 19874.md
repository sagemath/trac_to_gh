# Issue 19874: Cleaning of subword complex code

archive/issues_019874.json:
```json
{
    "body": "CC:  tscrim chapoton\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/20111\n\n",
    "created_at": "2016-02-25T11:58:32Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "Cleaning of subword complex code",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19874",
    "user": "stumpc5"
}
```
CC:  tscrim chapoton



Issue created by migration from https://trac.sagemath.org/ticket/20111





---

archive/issue_comments_273359.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2016-02-25T12:13:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19874#issuecomment-273359",
    "user": "stumpc5"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_273360.json:
```json
{
    "body": "Using the category framework for subword complexes.\n\nTODO: make subword complex elements instances of its category element class\n\n```\nsage: W = CoxeterGroup(['A',2])\nsage: w = W.from_reduced_word([1,2,1])\nsage: S = SubwordComplex([1,2,1,2,1],w)\nsage: F = S.an_element()\nsage: isinstance(F,F.parent().category().element_class)\nFalse\nsage: type(F)\n<class 'sage.combinat.subword_complex.SubwordComplexFacet'>\nsage: F.parent().category().element_class\n<class 'sage.categories.simplicial_complexes.SimplicialComplexes.Finite.element_class'>\n```\n\n----\nNew commits:",
    "created_at": "2016-02-25T12:13:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19874#issuecomment-273360",
    "user": "stumpc5"
}
```

Using the category framework for subword complexes.

TODO: make subword complex elements instances of its category element class

```
sage: W = CoxeterGroup(['A',2])
sage: w = W.from_reduced_word([1,2,1])
sage: S = SubwordComplex([1,2,1,2,1],w)
sage: F = S.an_element()
sage: isinstance(F,F.parent().category().element_class)
False
sage: type(F)
<class 'sage.combinat.subword_complex.SubwordComplexFacet'>
sage: F.parent().category().element_class
<class 'sage.categories.simplicial_complexes.SimplicialComplexes.Finite.element_class'>
```

----
New commits:



---

archive/issue_comments_273361.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2016-02-25T12:13:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19874#issuecomment-273361",
    "user": "stumpc5"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_273362.json:
```json
{
    "body": "Changing keywords from \"\" to \"subword complex\".",
    "created_at": "2016-02-25T12:13:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19874#issuecomment-273362",
    "user": "stumpc5"
}
```

Changing keywords from "" to "subword complex".



---

archive/issue_comments_273363.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2016-02-25T12:13:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19874#issuecomment-273363",
    "user": "stumpc5"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_273364.json:
```json
{
    "body": "The diff is a pain -- I had to interchange the appearance of the classes `SubwordComplex` and `SubwordComplexFacet` in the file in order to write `Element = SubwordComplexFacet` into the `SubwordComplex` class.\n\nSo what did I change:\n\n* the the init of subword complex\n* added the `__classcall__` method to make parents unique\n* tiny changes to make the input a tuple instead of a list (this also forced changes in multiple other places such as `Q.reverse` or in the function definition of the cython file.\n\nOnce the above issue is solved, this is ready for review.",
    "created_at": "2016-02-25T12:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19874#issuecomment-273364",
    "user": "stumpc5"
}
```

The diff is a pain -- I had to interchange the appearance of the classes `SubwordComplex` and `SubwordComplexFacet` in the file in order to write `Element = SubwordComplexFacet` into the `SubwordComplex` class.

So what did I change:

* the the init of subword complex
* added the `__classcall__` method to make parents unique
* tiny changes to make the input a tuple instead of a list (this also forced changes in multiple other places such as `Q.reverse` or in the function definition of the cython file.

Once the above issue is solved, this is ready for review.



---

archive/issue_comments_273365.json:
```json
{
    "body": "Instead of reordering, you could have just added (at the module level) `SubwordComplex.Element = SubwordComplexFacet` (although in some ways I think the reordered way is better, but we can get to that after we decide the color of the bikeshed). As for the issue above, all you should have to do replacements like this:\n\n```diff\n-return SubwordComplexFacet(self, F, facet_test=facet_test)\n+return self.element_class(self, F, facet_test=facet_test)\n```\n",
    "created_at": "2016-02-25T17:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19874#issuecomment-273365",
    "user": "tscrim"
}
```

Instead of reordering, you could have just added (at the module level) `SubwordComplex.Element = SubwordComplexFacet` (although in some ways I think the reordered way is better, but we can get to that after we decide the color of the bikeshed). As for the issue above, all you should have to do replacements like this:

```diff
-return SubwordComplexFacet(self, F, facet_test=facet_test)
+return self.element_class(self, F, facet_test=facet_test)
```




---

archive/issue_comments_273366.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-26T08:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19874#issuecomment-273366",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_273367.json:
```json
{
    "body": "Thanks, that worked. It's ready for review I guess!",
    "created_at": "2016-02-26T08:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19874#issuecomment-273367",
    "user": "stumpc5"
}
```

Thanks, that worked. It's ready for review I guess!



---

archive/issue_comments_273368.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-02-26T08:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19874#issuecomment-273368",
    "user": "stumpc5"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_273369.json:
```json
{
    "body": "Some comments:\n\n- Could you add some doctests to `__classcall__` (good tests include checking the uniqueness against different input types)?\n- Could you add a `TestSuite(SC).run()` (possibly skipping tests)?\n- The `SubwordComplex.__eq__` is redundant (and slower) than that given by `UniqueRepresentation`.\n- Instead of `__call__`, you should be able to use `_element_constructor_`. By doing this, it fits into Sage's coercion framework (although I guess that doesn't quite apply here [yet]) and you shouldn't have to do `hasattr(F,\"parent\") and F.parent() is self`.\n\nI can also work on this over the weekend.",
    "created_at": "2016-03-03T07:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19874#issuecomment-273369",
    "user": "tscrim"
}
```

Some comments:

- Could you add some doctests to `__classcall__` (good tests include checking the uniqueness against different input types)?
- Could you add a `TestSuite(SC).run()` (possibly skipping tests)?
- The `SubwordComplex.__eq__` is redundant (and slower) than that given by `UniqueRepresentation`.
- Instead of `__call__`, you should be able to use `_element_constructor_`. By doing this, it fits into Sage's coercion framework (although I guess that doesn't quite apply here [yet]) and you shouldn't have to do `hasattr(F,"parent") and F.parent() is self`.

I can also work on this over the weekend.



---

archive/issue_comments_273370.json:
```json
{
    "body": "Replying to [comment:7 tscrim]:\n> - Could you add a `TestSuite(SC).run()` (possibly skipping tests)?\n\nThis is already done in the tests inside `__init__`. Or do you mean something else?\n\n> - Instead of `__call__`, you should be able to use `_element_constructor_`. By doing this, it fits into Sage's coercion framework (although I guess that doesn't quite apply here [yet]) and you shouldn't have to do `hasattr(F,\"parent\") and F.parent() is self`.\n\nIf I do that, the class inherits the `__call__` from simplicial complexes, which then results `SC([0,1])` to not return an element class element but a list. What is appropriate then here?",
    "created_at": "2016-03-05T16:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19874#issuecomment-273370",
    "user": "stumpc5"
}
```

Replying to [comment:7 tscrim]:
> - Could you add a `TestSuite(SC).run()` (possibly skipping tests)?

This is already done in the tests inside `__init__`. Or do you mean something else?

> - Instead of `__call__`, you should be able to use `_element_constructor_`. By doing this, it fits into Sage's coercion framework (although I guess that doesn't quite apply here [yet]) and you shouldn't have to do `hasattr(F,"parent") and F.parent() is self`.

If I do that, the class inherits the `__call__` from simplicial complexes, which then results `SC([0,1])` to not return an element class element but a list. What is appropriate then here?



---

archive/issue_comments_273371.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-05T16:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19874#issuecomment-273371",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_273372.json:
```json
{
    "body": "Replying to [comment:8 stumpc5]:\n> Replying to [comment:7 tscrim]:\n> > - Could you add a `TestSuite(SC).run()` (possibly skipping tests)?\n> \n> This is already done in the tests inside `__init__`. Or do you mean something else?\n\nAh, sorry, I missed that.\n\n> > - Instead of `__call__`, you should be able to use `_element_constructor_`. By doing this, it fits into Sage's coercion framework (although I guess that doesn't quite apply here [yet]) and you shouldn't have to do `hasattr(F,\"parent\") and F.parent() is self`.\n> \n> If I do that, the class inherits the `__call__` from simplicial complexes, which then results `SC([0,1])` to not return an element class element but a list. What is appropriate then here?\n\nI guess we can just leave it for now.\n\nI pushed some changes that fix the failing doctests and do a few tweaks to the Cython file. If you agree with my changes, then you can set a positive review.\n----\nNew commits:",
    "created_at": "2016-03-05T23:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19874#issuecomment-273372",
    "user": "tscrim"
}
```

Replying to [comment:8 stumpc5]:
> Replying to [comment:7 tscrim]:
> > - Could you add a `TestSuite(SC).run()` (possibly skipping tests)?
> 
> This is already done in the tests inside `__init__`. Or do you mean something else?

Ah, sorry, I missed that.

> > - Instead of `__call__`, you should be able to use `_element_constructor_`. By doing this, it fits into Sage's coercion framework (although I guess that doesn't quite apply here [yet]) and you shouldn't have to do `hasattr(F,"parent") and F.parent() is self`.
> 
> If I do that, the class inherits the `__call__` from simplicial complexes, which then results `SC([0,1])` to not return an element class element but a list. What is appropriate then here?

I guess we can just leave it for now.

I pushed some changes that fix the failing doctests and do a few tweaks to the Cython file. If you agree with my changes, then you can set a positive review.
----
New commits:



---

archive/issue_comments_273373.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-03-07T10:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19874#issuecomment-273373",
    "user": "stumpc5"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_273374.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-08T23:31:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19874#issuecomment-273374",
    "user": "vbraun"
}
```

Resolution: fixed
