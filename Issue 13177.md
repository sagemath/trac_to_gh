# Issue 13177: Deprecate SAGE_FORTRAN

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2012-08-08 13:20:21

Assignee: tbd

CC:  leif jhpalmieri

Thanks to the GCC spkg, most uses of the SAGE_FORTRAN and SAGE_FORTRAN_LIB environment variables are not needed anymore.  So I propose to continue supporting them for now, but deprecate their usage.


---

Comment by jdemeyer created at 2012-08-08 15:18:28

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2012-08-08 15:18:28

Changing component from PLEASE CHANGE to build.


---

Comment by leif created at 2012-08-08 15:53:41

I'd replace _"not every Sage package recognizes this"_ by _"not every Sage package recognizes this *yet*"_.

Not sure whether that's still true; at least all standard spkgs should respect `CC` (and `CXX`) [meanwhile or soon] -- Andrew Ohana and me opened tickets for all spkgs (we were aware of) which didn't a while ago.

I'd also keep the `SAGE_FORTRAN` and `SAGE_FORTRAN_LIB` entries for now, just stating that these are deprecated (or, more precisely, obsolete), and shouldn't be used anymore (with a reference to `FC` and `FCFLAGS`).




Not directly related to this ticket, but `CPP` and `CPPFLAGS` should IMHO be mentioned as well.


---

Comment by leif created at 2012-08-08 16:03:55

Replying to [comment:4 leif]:
> I'd also keep the `SAGE_FORTRAN` and `SAGE_FORTRAN_LIB` entries for now, just stating that these are deprecated (or, more precisely, obsolete), and shouldn't be used anymore (with a reference to `FC` and `FCFLAGS`).

P.S.: In addition.  Although we may sleep for 5 seconds, I frequently hear _"Who reads logs?"_.  And there might even be a few people who actually read the Installation Guide _before_ attempting to build Sage... ;-)


---

Comment by leif created at 2012-08-08 16:14:53

It's not clear to me why you `unset FC` in case Sage's GCC is (or will be) installed; in that case I'd just set it to `gfortran` as well, since `$SAGE_LOCAL/bin/` comes first in the path anyway.


---

Comment by leif created at 2012-08-08 16:17:30

Replying to [comment:6 leif]:
> It's not clear to me why you `unset FC` in case Sage's GCC is (or will be) installed; in that case I'd just set it to `gfortran` as well, since `$SAGE_LOCAL/bin/` comes first in the path anyway.

I mean if you *don't* set `FC` there, some packages _might_ still pick up some other Fortran compiler.


---

Comment by leif created at 2012-08-08 16:19:12

I'd also set (or unset) `F77` likewise.


---

Comment by jdemeyer created at 2012-08-08 19:53:45

Replying to [comment:4 leif]:
> I'd replace _"not every Sage package recognizes this"_ by _"not every Sage package recognizes this *yet*"_.
I don't like that, because it sounds too much like a promise.  If in 2 years, still not all packages support `$CC`, it will look ridiculous. The current sentence is simply an informative statement of fact.

> I'd also keep the `SAGE_FORTRAN` and `SAGE_FORTRAN_LIB` entries for now, just stating that these are deprecated (or, more precisely, obsolete), and shouldn't be used anymore (with a reference to `FC` and `FCFLAGS`).
If they shouldn't be used anymore, what's the point?

> Not directly related to this ticket, but `CPP` and `CPPFLAGS` should IMHO be mentioned as well.
I think we should only mention the most important ones, namely CFLAGS, CXXFLAGS and FCFLAGS. Otherwise, there is an essentially endless list of environment variables...


---

Comment by jdemeyer created at 2012-08-08 19:54:23

Replying to [comment:6 leif]:
> It's not clear to me why you `unset FC` in case Sage's GCC is (or will be) installed; in that case I'd just set it to `gfortran` as well, since `$SAGE_LOCAL/bin/` comes first in the path anyway.
If `FC` is unset, it will default to "gfortran" anyway, see how the `sage_fortran` script is created.


---

Comment by jdemeyer created at 2012-08-09 08:21:30

Replying to [comment:5 leif]:
> P.S.: In addition.  Although we may sleep for 5 seconds, I frequently hear _"Who reads logs?"_.

At least, it will appear at the very start of the build.  Just type "make" and that message will appear immediately, so most users should see it (unless they are building using automated scripts of course...)


---

Comment by leif created at 2012-08-09 16:21:46

Replying to [comment:9 jdemeyer]:
> Replying to [comment:4 leif]:
> > I'd replace _"not every Sage package recognizes this"_ by _"not every Sage package recognizes this *yet*"_.
> I don't like that, because it sounds too much like a promise.  If in 2 years, still not all packages support `$CC`, it will look ridiculous. The current sentence is simply an informative statement of fact.

Well, at least all _standard_ spkgs should -- as mentioned -- meanwhile or soon respect `CC` etc. (So it's IMHO at least a valid promise. ;-) )





> > I'd also keep the `SAGE_FORTRAN` and `SAGE_FORTRAN_LIB` entries for now, just stating that these are deprecated (or, more precisely, obsolete), and shouldn't be used anymore (with a reference to `FC` and `FCFLAGS`).
> If they shouldn't be used anymore, what's the point?

Documentation.  In a couple of years, we can certainly remove it.





> > Not directly related to this ticket, but `CPP` and `CPPFLAGS` should IMHO be mentioned as well.
> I think we should only mention the most important ones, namely CFLAGS, CXXFLAGS and FCFLAGS. Otherwise, there is an essentially endless list of environment variables...

Well, `CPP` and `CPPFLAGS` are closely related, and one or two more entries don't make the list endless.  In addition, there seem to be quite many people confusing `CPP*` with `CXX*`.


---

Comment by leif created at 2012-08-09 16:28:23

Replying to [comment:10 jdemeyer]:
> Replying to [comment:6 leif]:
> > It's not clear to me why you `unset FC` in case Sage's GCC is (or will be) installed; in that case I'd just set it to `gfortran` as well, since `$SAGE_LOCAL/bin/` comes first in the path anyway.
> If `FC` is unset, it will default to "gfortran" anyway, see how the `sage_fortran` script is created.

At least in the long run, we should get rid of the `sage_fortran` script as well.

If a package sees `FC` being set, it'll (hopefully) use that.  If it's unset, it'll try to guess the Fortran compiler, which might yield (Sage's) `gfortran`, but also some other Fortran compiler which happens to be installed on the system.  (Explicitly setting `FC` etc. to `sage_fortran` in every spkg which uses Fortran is a redundant kludge.)


---

Comment by jdemeyer created at 2012-08-09 16:35:12

Replying to [comment:13 leif]:
> At least in the long run, we should get rid of the `sage_fortran` script as well.
Of course we should. I consider this ticket as a first step towards that.


---

Comment by jdemeyer created at 2012-08-12 18:51:16

Replying to [comment:12 leif]:
> > > I'd also keep the `SAGE_FORTRAN` and `SAGE_FORTRAN_LIB` entries for now, just stating that these are deprecated (or, more precisely, obsolete), and shouldn't be used anymore (with a reference to `FC` and `FCFLAGS`).
> > If they shouldn't be used anymore, what's the point?
> 
> Documentation.  In a couple of years, we can certainly remove it.
If it should not be used, why should it be documented?  The message when doing `make` states clearly what should be used _instead_.


---

Comment by jdemeyer created at 2012-08-20 06:31:08

leif, what's the minimum which should be done for this patch to get positive review from you?


---

Attachment


---

Comment by jhpalmieri created at 2012-08-20 21:39:35

I think I agree with Leif that the old variables should still be documented. I can imagine a user finding out about them by searching through sage-devel, for example, and then wondering why they're not documented or whether they were removed. Maybe a sentence or two: "the following variables have been deprecated, as of Sage 5.3. Instead of SAGE_FORTRAN, use FC, and instead of SAGE_FORTRAN_LIB, ..." Users shouldn't have to find out this sort of thing by reading warning messages.

After a few releases, we could also make the deprecation more obvious, by making the user hit RET to continue building after we print the warning message.


---

Attachment

Replying to [comment:18 jhpalmieri]:
> I think I agree with Leif that the old variables should still be documented. I can imagine a user finding out about them by searching through sage-devel, for example, and then wondering why they're not documented or whether they were removed. Maybe a sentence or two: "the following variables have been deprecated, as of Sage 5.3. Instead of SAGE_FORTRAN, use FC, and instead of SAGE_FORTRAN_LIB, ..." Users shouldn't have to find out this sort of thing by reading warning messages.

Done, needs review.


---

Comment by jhpalmieri created at 2012-08-22 17:18:48

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2012-08-22 17:18:48

This all looks okay to me. I haven't thoroughly tested that SAGE_FORTRAN_LIB can usually be omitted (although I've tried that on one or two platforms and it's worked), and I don't know how to test that when it cannot be omitted, using LIBRARY_PATH or LD_LIBRARY_PATH is the right solution. But I'm willing to believe it.

Do we need followup tickets to take care of references to these variables in spkgs, or will that work itself out over the months/years?

- atlas
- cliquer
- lcalc


---

Comment by jdemeyer created at 2012-08-23 09:59:55

Replying to [comment:20 jhpalmieri]:
> I haven't thoroughly tested that SAGE_FORTRAN_LIB can usually be omitted (although I've tried that on one or two platforms and it's worked), and I don't know how to test that when it cannot be omitted, using LIBRARY_PATH or LD_LIBRARY_PATH is the right solution.

Well, I never understood why `SAGE_FORTRAN_LIB` was ever needed, especially because we do not have a corresponding `SAGE_CXX_LIB` for the C++ runtime library. So I'm certainly not surprised that it's simply never needed (even less so with the GCC spkg).


---

Comment by jdemeyer created at 2012-08-23 10:06:23

There are references to `SAGE_FORTRAN` in the following packages:
 1. atlas (only in a "print" statement)
 1. cliquer (which doesn't have Fortran code)
 1. libgcrypt (which doesn't have Fortran code)
 1. lrcalc (which doesn't have Fortran code)
 1. rubiks (which doesn't have Fortran code)
 1. sqlite (which doesn't have Fortran code)

So, as far as I can see, no package actually directly _uses_ the value of `SAGE_FORTRAN`.


---

Comment by jdemeyer created at 2012-08-23 12:47:48

Resolution: fixed


---

Comment by jhpalmieri created at 2012-08-23 17:06:13

Replying to [comment:22 jdemeyer]:
> So, as far as I can see, no package actually directly _uses_ the value of `SAGE_FORTRAN`.

I was mainly concerned about ATLAS, for example, telling people to set `SAGE_FORTRAN` when that variable has been deprecated. It also looks like sqlite might print "annoying messages" if `SAGE_FORTRAN` is unset.


---

Comment by jhpalmieri created at 2012-08-23 17:09:01

I guess sqlite is not a problem.
