# Issue 32475: sage.tensor.modules: remove doctests involving the symbolic ring

Issue created by migration from https://trac.sagemath.org/ticket/32712

Original creator: egourgoulhon

Original creation time: 2021-10-18 20:13:35

CC:  mkoeppe tscrim

After #32415 and #32708, the code in the module `sage.tensor.modules` does no longer contain any dependency on symbolic parts of Sage. There remains however some doctests that invokes `SR`. They have been introduced to check a bug fix performed in #22520. Since this was 5 years ago, it seems pretty safe to remove them for the benefit of Sage modularization. This is performed in this ticket.


---

Comment by egourgoulhon created at 2021-10-18 20:16:25

Changing status from new to needs_review.


---

Comment by egourgoulhon created at 2021-10-18 20:16:25

New commits:


---

Comment by mkoeppe created at 2021-10-18 20:19:43

Instead of removing them, they could be marked as optional using #32614: See #32652 for an example


---

Comment by egourgoulhon created at 2021-10-18 20:26:48

Replying to [comment:2 mkoeppe]:
> Instead of removing them, they could be marked as optional using #32614: See #32652 for an example
Very good. Should the tag be `# optional - sage.symbolic.ring` ?


---

Comment by mkoeppe created at 2021-10-18 20:37:15

see `src/sage/features/sagemath.py` (after merging #32614): just `sage.symbolic`


---

Comment by egourgoulhon created at 2021-10-18 20:39:06

Replying to [comment:4 mkoeppe]:
> see `src/sage/features/sagemath.py` (after merging #32614): just `sage.symbolic`
OK, perfect.


---

Comment by egourgoulhon created at 2021-10-18 20:44:55

New commits:


---

Comment by egourgoulhon created at 2021-10-18 20:45:14

Here we go...


---

Comment by mkoeppe created at 2021-10-19 07:00:44

Tested with #32601:

```
$ ./bootstrap && make sagelib-build-deps && ./sage -sh -c '(cd pkgs/sagemath-standard-no-symbolics && SAGE_NUM_THREADS=16 tox  -v -v -v -e py39-sagewheels-nopypi)'
[...........]
$ pkgs/sagemath-standard-no-symbolics/.tox/py39-sagewheels-nopypi/bin/sage -tp src/sage/tensor
too many failed tests, not using stored timings
Running doctests with ID 2021-10-18-23-57-24-ccafbd20.
Using --optional=argcomplete,build,ccache,dochtml,e_antic,homebrew,normaliz,pip,pynormaliz,sage,sage.rings.real_double,sage_spkg
Sorting sources by runtime so that slower doctests are run first....
Doctesting 19 files using 8 threads.
sage -t --random-seed=0 src/sage/tensor/modules/free_module_morphism.py
    [251 tests, 0.21 s]
sage -t --random-seed=0 src/sage/tensor/modules/free_module_automorphism.py
    [243 tests, 0.20 s]
sage -t --random-seed=0 src/sage/tensor/modules/free_module_alt_form.py
    [170 tests, 0.28 s]
sage -t --random-seed=0 src/sage/tensor/modules/alternating_contr_tensor.py
    [150 tests, 0.32 s]
sage -t --random-seed=0 src/sage/tensor/modules/free_module_linear_group.py
    [112 tests, 0.16 s]
sage -t --random-seed=0 src/sage/tensor/modules/finite_rank_free_module.py
    [523 tests, 0.42 s]
sage -t --random-seed=0 src/sage/tensor/modules/ext_pow_free_module.py
    [187 tests, 0.15 s]
sage -t --random-seed=0 src/sage/tensor/modules/free_module_basis.py
    [166 tests, 0.14 s]
sage -t --random-seed=0 src/sage/tensor/modules/free_module_homset.py
    [97 tests, 0.14 s]
sage -t --random-seed=0 src/sage/tensor/__init__.py
    [0 tests, 0.00 s]
sage -t --random-seed=0 src/sage/tensor/all.py
    [0 tests, 0.00 s]
sage -t --random-seed=0 src/sage/tensor/modules/__init__.py
    [0 tests, 0.00 s]
sage -t --random-seed=0 src/sage/tensor/modules/all.py
    [0 tests, 0.00 s]
sage -t --random-seed=0 src/sage/tensor/modules/format_utilities.py
    [64 tests, 0.04 s]
sage -t --random-seed=0 src/sage/tensor/modules/free_module_element.py
    [62 tests, 0.08 s]
sage -t --random-seed=0 src/sage/tensor/modules/tensor_free_module.py
    [129 tests, 0.14 s]
sage -t --random-seed=0 src/sage/tensor/modules/free_module_tensor.py
    [638 tests, 2.23 s]
sage -t --random-seed=0 src/sage/tensor/modules/comp.py
    [980 tests, 3.14 s]
sage -t --random-seed=0 src/sage/tensor/modules/tensor_with_indices.py
    [233 tests, 4.01 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 4.1 seconds
    cpu time: 11.0 seconds
    cumulative wall time: 11.6 seconds
```



---

Comment by mkoeppe created at 2021-10-19 07:00:44

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2021-10-19 12:42:06

Thank you for the review and the test!


---

Comment by vbraun created at 2021-10-20 23:00:39

Resolution: fixed
