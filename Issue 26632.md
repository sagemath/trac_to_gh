# Issue 26632: py3: improve is_aperiodic to fix doctests

Issue created by migration from Trac.

Original creator: dcoudert

Original creation time: 2018-12-11 01:31:02

CC:  tscrim chapoton mercatp

Keywords: py3, graph

The current implementation of `is_aperiodic` uses networkx and it yields an error in Python3 (certainly not the good version of networkx, could be fixed with a new version).

As we have method `period` that computes the period of a digraph, it suffices to check whether the period is 1 or not. This way, we don't pay the conversion to networkx anymore, and we fix some doctests in `digraph.py` and in `static_sparse_graph.pyx` (calls `is_aperiodic`).


---

Comment by dcoudert created at 2018-12-11 01:37:06

New commits:


---

Comment by dcoudert created at 2018-12-11 01:37:06

Changing status from new to needs_review.


---

Comment by tscrim created at 2018-12-11 08:58:02

How does the timing compare between the two methods? I am inclined to still accept this change, but I am a little curious how things compare.


---

Comment by dcoudert created at 2018-12-11 11:40:45

The example is maybe too small, but without this patch:

```
sage: g = DiGraph({0: [1, 4], 1: [2], 2: [0], 4: [0]})
sage: %timeit g.is_aperiodic()
The slowest run took 7.37 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 56 µs per loop
```

With this patch

```
sage: g = DiGraph({0: [1, 4], 1: [2], 2: [0], 4: [0]})
sage: %timeit g.is_aperiodic()
The slowest run took 4.61 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 31 µs per loop
```

In fact, the `period` is very similar to the one in networkx. So we save the conversion to networkx.


---

Comment by tscrim created at 2018-12-12 02:47:25

That is good enough for me. Thank you.


---

Comment by tscrim created at 2018-12-12 02:47:25

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-12-23 23:40:09

Resolution: fixed


---

Comment by embray created at 2018-12-28 14:06:38

This tickets were closed as fixed after the Sage 8.5 release.
