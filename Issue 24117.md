# Issue 24117: RBF(expr) has the wrong parent

archive/issues_024117.json:
```json
{
    "body": "CC:  slelievre\n\n\n```\nsage: RBF(psi(1,1/3)).parent()\nSymbolic Ring\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24354\n\n",
    "created_at": "2017-12-09T19:45:40Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "RBF(expr) has the wrong parent",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24117",
    "user": "mmezzarobba"
}
```
CC:  slelievre


```
sage: RBF(psi(1,1/3)).parent()
Symbolic Ring
```


Issue created by migration from https://trac.sagemath.org/ticket/24354





---

archive/issue_comments_337872.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-25T15:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24117#issuecomment-337872",
    "user": "mmezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_337873.json:
```json
{
    "body": "Now raises an error (thanks to #28517, I think). That's okay, though it would be even better to have a mechanism that makes this evaluation boil down to something like `RBF(CBF(1/3).psi(1))`.",
    "created_at": "2020-11-25T15:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24117#issuecomment-337873",
    "user": "mmezzarobba"
}
```

Now raises an error (thanks to #28517, I think). That's okay, though it would be even better to have a mechanism that makes this evaluation boil down to something like `RBF(CBF(1/3).psi(1))`.



---

archive/issue_comments_337874.json:
```json
{
    "body": "The generic symbolic evaluation is making at least two mistakes here. The code is at lines 1562-1568 of expression.pyx\n\n```\ntry:\n    res = self.operator()(*[R(a) for a in args])\nexcept (TypeError, ValueError):\n    pass\nelse:\n    if res.parent() is R:\n        return res\n```\n\n\nWith the input provided in the ticket description, it produces\n\n```\nsage: from sage.functions.gamma import psi2\nsage: psi2(RBF(1), RBF(1/3))\npsi(1.000000000000000, [0.3333333333333333 +/- 7.04e-17])\n```\n\nThis is bad since the proper way to make the call should have been `psi(1, RBF(1/3))`.\n\nSecondly, `psi(1, RBF(1/3))` is broken as it should produce a ball\n\n```\nsage: from sage.functions.gamma import psi2\nsage: psi2(1, RBF(1/3))\npsi(1, [0.3333333333333333 +/- 7.04e-17])\n```\n\n\nIs there a ticket to improve the `RBF(expression)`?",
    "created_at": "2021-01-23T16:48:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24117#issuecomment-337874",
    "user": "vdelecroix"
}
```

The generic symbolic evaluation is making at least two mistakes here. The code is at lines 1562-1568 of expression.pyx

```
try:
    res = self.operator()(*[R(a) for a in args])
except (TypeError, ValueError):
    pass
else:
    if res.parent() is R:
        return res
```


With the input provided in the ticket description, it produces

```
sage: from sage.functions.gamma import psi2
sage: psi2(RBF(1), RBF(1/3))
psi(1.000000000000000, [0.3333333333333333 +/- 7.04e-17])
```

This is bad since the proper way to make the call should have been `psi(1, RBF(1/3))`.

Secondly, `psi(1, RBF(1/3))` is broken as it should produce a ball

```
sage: from sage.functions.gamma import psi2
sage: psi2(1, RBF(1/3))
psi(1, [0.3333333333333333 +/- 7.04e-17])
```


Is there a ticket to improve the `RBF(expression)`?



---

archive/issue_comments_337875.json:
```json
{
    "body": "Replying to [comment:2 vdelecroix]:\n> Is there a ticket to improve the `RBF(expression)`?\n\nNone that I know of. (I started fixing the worst issues in #28517 and its dependencies, but didn't have the courage to handle all cases.)",
    "created_at": "2021-01-23T17:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24117#issuecomment-337875",
    "user": "mmezzarobba"
}
```

Replying to [comment:2 vdelecroix]:
> Is there a ticket to improve the `RBF(expression)`?

None that I know of. (I started fixing the worst issues in #28517 and its dependencies, but didn't have the courage to handle all cases.)



---

archive/issue_comments_337876.json:
```json
{
    "body": "Should we close this ticket as invalid\nor repurpose it to improve `RBF(expr)`?",
    "created_at": "2021-08-21T15:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24117#issuecomment-337876",
    "user": "slelievre"
}
```

Should we close this ticket as invalid
or repurpose it to improve `RBF(expr)`?



---

archive/issue_comments_337877.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to numerical.",
    "created_at": "2021-08-21T15:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24117#issuecomment-337877",
    "user": "slelievre"
}
```

Changing component from PLEASE CHANGE to numerical.



---

archive/issue_comments_337878.json:
```json
{
    "body": "Replying to [comment:4 slelievre]:\n> Should we close this ticket as invalid\n> or repurpose it to improve `RBF(expr)`?\n\nClose it, IMO. Improving `RBF(expr)` will take several tickets, and this one provides no clear roadmap.",
    "created_at": "2021-09-18T09:44:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24117#issuecomment-337878",
    "user": "mmezzarobba"
}
```

Replying to [comment:4 slelievre]:
> Should we close this ticket as invalid
> or repurpose it to improve `RBF(expr)`?

Close it, IMO. Improving `RBF(expr)` will take several tickets, and this one provides no clear roadmap.



---

archive/issue_comments_337879.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2022-02-14T19:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24117#issuecomment-337879",
    "user": "chapoton"
}
```

Resolution: invalid



---

archive/issue_comments_337880.json:
```json
{
    "body": "Some comments of this ticket show wrong behaviours, i think specific related tickets should be created before this one is closed or we will lose that information.",
    "created_at": "2022-02-14T20:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24117#issuecomment-337880",
    "user": "tmonteil"
}
```

Some comments of this ticket show wrong behaviours, i think specific related tickets should be created before this one is closed or we will lose that information.



---

archive/issue_comments_337881.json:
```json
{
    "body": "By the way, the following seems to work:\n\n\n```\nsage: RBF(RIF(psi(1,1/3)))\n[10.09559712542709 +/- 4.20e-15]\n```\n",
    "created_at": "2022-02-14T20:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24117#issuecomment-337881",
    "user": "tmonteil"
}
```

By the way, the following seems to work:


```
sage: RBF(RIF(psi(1,1/3)))
[10.09559712542709 +/- 4.20e-15]
```




---

archive/issue_comments_337882.json:
```json
{
    "body": "Replying to [comment:8 tmonteil]:\n> By the way, the following seems to work:\n> \n> {{{\n> sage: RBF(RIF(psi(1,1/3)))\n> [10.09559712542709 +/- 4.20e-15]\n> }}}\n\n...Because it replaces the intervals with points:\n\n```\nsage: RIF(psi(RIF(0.99,1.01),1/3))\n10.095597125427095?\n```\n\n(So the bug is that it works.)",
    "created_at": "2022-02-15T08:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24117#issuecomment-337882",
    "user": "mmezzarobba"
}
```

Replying to [comment:8 tmonteil]:
> By the way, the following seems to work:
> 
> {{{
> sage: RBF(RIF(psi(1,1/3)))
> [10.09559712542709 +/- 4.20e-15]
> }}}

...Because it replaces the intervals with points:

```
sage: RIF(psi(RIF(0.99,1.01),1/3))
10.095597125427095?
```

(So the bug is that it works.)



---

archive/issue_comments_337883.json:
```json
{
    "body": "pouvez re-ouvrir le ticket si vous voulez, hein",
    "created_at": "2022-02-15T09:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24117#issuecomment-337883",
    "user": "chapoton"
}
```

pouvez re-ouvrir le ticket si vous voulez, hein
