# Issue 28409: Use CombinatorialPolyhedron to obtain faces of polyhedra

Issue created by migration from https://trac.sagemath.org/ticket/28646

Original creator: @kliem

Original creation time: 2019-10-23 14:25:39

CC:  jipilab @laisrast

Keywords: polytopes, combinatorial polyhedron

We use `CombinatorialPolyhedron` to obtain the faces of fixed dimensions of a polyhedron.

We add a method `face_generator`, which iterates over all faces (possibly of fixed dimension).

With this ticket we can obtain the faces much faster and without generating the entire face lattice. The iterator is a true iterator in the sense that it has almost constant memory usage and does and no point store a list of all faces.

This ticket changes the order of the output of `faces`.


---

Comment by @kliem created at 2019-10-23 14:28:41

I accidentally pulled #28625 instead of #28621. As #28625 is closed, I don't feel like fixing the branch.
----
New commits:


---

Comment by @kliem created at 2019-10-23 14:28:41

Changing status from new to needs_review.


---

Comment by git created at 2019-10-23 17:45:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2019-10-24 09:19:25

I would vote to change `face_dimension` to simply `dimension`.

The INPUT of `combinatorial_face_to_polyhedral_face` is too verbose to me.

A `Polyhedron`, the polyhedron containing the face
A `CombinatorialFace`

OUTPUT:

A `PolyhedronFace`

is sufficient. If you insist to have the links on the documentation ok... But I would not be too verbose here.


---

Comment by jipilab created at 2019-10-24 09:19:25

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-10-25 10:01:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2019-10-25 10:02:31

Replying to [comment:3 jipilab]:
> I would vote to change `face_dimension` to simply `dimension`.

This is to be consistent with the method `faces``.


---

Comment by @kliem created at 2019-10-25 10:02:37

Changing status from needs_work to needs_review.


---

Comment by @kliem created at 2019-10-25 11:16:51

There will be a conflict with #17215.


---

Comment by @kliem created at 2019-10-28 08:25:28

Rebased
----
New commits:


---

Comment by git created at 2019-10-28 08:33:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-10-28 11:00:37

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @bbryant33 created at 2019-11-18 22:59:46

The tests all pass on my end. face_generator runs for every type of polytope it should run on, and combinatorial_face_to_polyhedral_face runs as it should. The change in order experienced by the various face functions only affected the lists, not the correctness.


---

Comment by @bbryant33 created at 2019-11-18 22:59:46

Changing status from needs_review to positive_review.


---

Comment by @kliem created at 2019-11-19 05:36:09

Removing the dependency.

#17215 will need small changes in the doctests, once it's done.


---

Comment by vbraun created at 2019-11-28 21:17:14

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2019-11-28 21:17:14


```
sage -t --long --warn-long 34.6 src/sage/geometry/polyhedron/base.py  # 9 doctests failed
sage -t --long --warn-long 34.6 src/sage/geometry/polyhedron/face.py  # 4 doctests failed
```

e.g.

```
File "src/sage/geometry/polyhedron/face.py", line 10, in sage.geometry.polyhedron.face
Failed example:
    P.faces(3)
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.polyhedron.face[1]>", line 1, in <module>
        P.faces(Integer(3))
      File "/home/release/Sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py", line 5577, in faces
        return tuple(self.face_generator(face_dimension))
      File "/home/release/Sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py", line 5480, in face_generator
        yield self._make_polyhedron_face(range(self.n_Vrepresentation()), [])
      File "/home/release/Sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base_ZZ.py", line 53, in __getattribute__
        return super(Polyhedron_ZZ, self).__getattribute__(name)
      File "sage/structure/element.pyx", line 487, in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4608)
        return self.getattr_from_category(name)
      File "sage/structure/element.pyx", line 500, in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4717)
        return getattr_from_other_class(self, cls, name)
      File "sage/cpython/getattr.pyx", line 389, in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2547)
        raise AttributeError(dummy_error_message)
    AttributeError: 'Polyhedra_ZZ_ppl_with_category.element_class' object has no attribute '_make_polyhedron_face'
```



---

Comment by @kliem created at 2019-11-28 22:02:02

Changing status from needs_work to needs_review.


---

Comment by @kliem created at 2019-11-28 22:02:02

Should work now.
----
New commits:


---

Comment by @kliem created at 2019-12-17 14:37:30

ping


---

Comment by tscrim created at 2019-12-27 17:00:57

LGTM.


---

Comment by tscrim created at 2019-12-27 17:00:57

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-01-01 21:01:32

9.0 is out


---

Comment by vbraun created at 2020-01-05 15:47:37

Resolution: fixed
