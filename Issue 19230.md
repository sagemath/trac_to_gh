# Issue 19230: Make OSX app package relocatable

archive/issues_019230.json:
```json
{
    "body": "CC:  fbissey yomcat\n\nSince #19370, the build tree is no longer relocatable on OSX due to absolute linker paths.\n\nI wrote a tool to make them all relative: https://github.com/vbraun/ld-vulcanize\n\nAlternative: forbid relocation #19410\n\nIssue created by migration from https://trac.sagemath.org/ticket/19467\n\n",
    "created_at": "2015-10-24T10:30:36Z",
    "labels": [
        "build",
        "major",
        "bug"
    ],
    "title": "Make OSX app package relocatable",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19230",
    "user": "vbraun"
}
```
CC:  fbissey yomcat

Since #19370, the build tree is no longer relocatable on OSX due to absolute linker paths.

I wrote a tool to make them all relative: https://github.com/vbraun/ld-vulcanize

Alternative: forbid relocation #19410

Issue created by migration from https://trac.sagemath.org/ticket/19467





---

archive/issue_comments_263843.json:
```json
{
    "body": "TODO:\n* Rewrite all paths to relative in sage-bdist\n* Get rid of cross-directory hardlinks in our git install",
    "created_at": "2015-10-24T10:31:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263843",
    "user": "vbraun"
}
```

TODO:
* Rewrite all paths to relative in sage-bdist
* Get rid of cross-directory hardlinks in our git install



---

archive/issue_comments_263844.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-10-24T11:20:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263844",
    "user": "fbissey"
}
```

New commits:



---

archive/issue_comments_263845.json:
```json
{
    "body": "This seems to work in principle, but here's one other case where the ``@`executable_path` needs some tweaking:\n\n```\n   RuntimeError: ECL says: LOAD: Could not load file #P\"/Applications/SageMath-6.10.moved/local/lib/ecl-15.3.7/maxima.fas\" (Error: \"dlopen(/Applications/SageMath-6.10.moved/local/lib/ecl-15.3.7/maxima.fas, 10): Library not loaded: @executable_path/../libecl.15.3.7.dylib\n```\n\nFor this binary the path also needs an extra \"../\".",
    "created_at": "2015-10-24T13:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263845",
    "user": "cnassau"
}
```

This seems to work in principle, but here's one other case where the ``@`executable_path` needs some tweaking:

```
   RuntimeError: ECL says: LOAD: Could not load file #P"/Applications/SageMath-6.10.moved/local/lib/ecl-15.3.7/maxima.fas" (Error: "dlopen(/Applications/SageMath-6.10.moved/local/lib/ecl-15.3.7/maxima.fas, 10): Library not loaded: @executable_path/../libecl.15.3.7.dylib
```

For this binary the path also needs an extra "../".



---

archive/issue_comments_263846.json:
```json
{
    "body": "Also, I think the tool needs to run after the installtion of every new package, so maybe sage-location would be a better place for it than sage-bdist.",
    "created_at": "2015-10-24T13:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263846",
    "user": "cnassau"
}
```

Also, I think the tool needs to run after the installtion of every new package, so maybe sage-location would be a better place for it than sage-bdist.



---

archive/issue_comments_263847.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-24T15:36:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263847",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_263848.json:
```json
{
    "body": "* sage-location runs after move, this will not work.\n* I fixed the maxima/ecl problem",
    "created_at": "2015-10-24T16:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263848",
    "user": "vbraun"
}
```

* sage-location runs after move, this will not work.
* I fixed the maxima/ecl problem



---

archive/issue_comments_263849.json:
```json
{
    "body": "Replying to [comment:7 vbraun]:\n> * sage-location runs after move, this will not work.\n\nI believe it also runs the first time that sage is started, before anybody can legitimately move it away. That makes it work then. \n\nThe point is that it also runs whenever somebody installs a new package. But maybe you want to add a sage-post-install hook instead...",
    "created_at": "2015-10-24T16:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263849",
    "user": "cnassau"
}
```

Replying to [comment:7 vbraun]:
> * sage-location runs after move, this will not work.

I believe it also runs the first time that sage is started, before anybody can legitimately move it away. That makes it work then. 

The point is that it also runs whenever somebody installs a new package. But maybe you want to add a sage-post-install hook instead...



---

archive/issue_comments_263850.json:
```json
{
    "body": "It doesn't work because you can't reliably deduce the correct libraries *after* the move; Once the paths are wrong you can't ask ld what the right library is.",
    "created_at": "2015-10-24T20:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263850",
    "user": "vbraun"
}
```

It doesn't work because you can't reliably deduce the correct libraries *after* the move; Once the paths are wrong you can't ask ld what the right library is.



---

archive/issue_comments_263851.json:
```json
{
    "body": "Another issue are Python eggs; they are essentially zip files that may contain shared libraries. Python unpacks them on use into `DOT_SAGE/.python-eggs` but they don't get rewritten to relative paths while inside the egg. This is at least an issue for cvxopt.",
    "created_at": "2015-10-25T14:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263851",
    "user": "vbraun"
}
```

Another issue are Python eggs; they are essentially zip files that may contain shared libraries. Python unpacks them on use into `DOT_SAGE/.python-eggs` but they don't get rewritten to relative paths while inside the egg. This is at least an issue for cvxopt.



---

archive/issue_comments_263852.json:
```json
{
    "body": "cvxopt and Pillow seem to be the only offenders with shared libraries in egg files.",
    "created_at": "2015-10-25T14:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263852",
    "user": "vbraun"
}
```

cvxopt and Pillow seem to be the only offenders with shared libraries in egg files.



---

archive/issue_comments_263853.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-25T14:40:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263853",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_263854.json:
```json
{
    "body": "Changing keywords from \"\" to \"osx\".",
    "created_at": "2015-11-19T16:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263854",
    "user": "vbraun"
}
```

Changing keywords from "" to "osx".



---

archive/issue_comments_263855.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-11-19T16:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263855",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_263856.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-11-23T19:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263856",
    "user": "vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_263857.json:
```json
{
    "body": "This is good enough to get us started. A later ticket should remove unnecessary checks from sage-location.",
    "created_at": "2015-11-23T19:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263857",
    "user": "vbraun"
}
```

This is good enough to get us started. A later ticket should remove unnecessary checks from sage-location.



---

archive/issue_comments_263858.json:
```json
{
    "body": "The `http://files.sagemath.org/osx/intel/sage-6.10.beta4-OSX_10.11.1-x86_64.tar.bz2` seems to work quite well. I get these failures from running `sage -tp5 --long`:\n\n```\n----------------------------------------------------------------------\nsage -t --long --warn-long 50.2 src/sage/numerical/optimize.py  # 6 doctests failed\nsage -t --long --warn-long 50.2 src/sage/numerical/backends/cvxopt_backend.pyx  # Killed due to segmentation fault\nsage -t --long --warn-long 50.2 src/sage/modules/vector_rational_dense.pyx  # 1 doctest failed\n----------------------------------------------------------------------\n```\n\nI suppose for cvxopt something still needs to be fixed... (?)",
    "created_at": "2015-11-24T07:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263858",
    "user": "cnassau"
}
```

The `http://files.sagemath.org/osx/intel/sage-6.10.beta4-OSX_10.11.1-x86_64.tar.bz2` seems to work quite well. I get these failures from running `sage -tp5 --long`:

```
----------------------------------------------------------------------
sage -t --long --warn-long 50.2 src/sage/numerical/optimize.py  # 6 doctests failed
sage -t --long --warn-long 50.2 src/sage/numerical/backends/cvxopt_backend.pyx  # Killed due to segmentation fault
sage -t --long --warn-long 50.2 src/sage/modules/vector_rational_dense.pyx  # 1 doctest failed
----------------------------------------------------------------------
```

I suppose for cvxopt something still needs to be fixed... (?)



---

archive/issue_comments_263859.json:
```json
{
    "body": "Replying to [comment:19 cnassau]: Executing `MixedIntegerLinearProgram(solver = \"cvxopt\", maximization=False)` gives me this backtrace:\n\n```\n     19 from sage.numerical.mip import MIPSolverException\n---> 20 from cvxopt import solvers\n     21 \n     22 cdef class CVXOPTBackend(GenericBackend):\n\nbuild/bdist.macosx-10.9-x86_64/egg/cvxopt/__init__.py in <module>()\n\nbuild/bdist.macosx-10.9-x86_64/egg/cvxopt/base.py in <module>()\n\nbuild/bdist.macosx-10.9-x86_64/egg/cvxopt/base.py in __bootstrap__()\n\nImportError: dlopen(/Users/cn/.sage//.python-eggs/cvxopt-1.1.7-py2.7-macosx-10.9-x86_64.egg-tmp/cvxopt/base.so, 2): Library not loaded: /Users/vbraun/Code/binary-pkg/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391yaj24ng0bmdu/local/lib/libgfortran.3.dylib\n  Referenced from: /Users/cn/.sage//.python-eggs/cvxopt-1.1.7-py2.7-macosx-10.9-x86_64.egg-tmp/cvxopt/base.so\n  Reason: image not found\n```\n",
    "created_at": "2015-11-24T07:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263859",
    "user": "cnassau"
}
```

Replying to [comment:19 cnassau]: Executing `MixedIntegerLinearProgram(solver = "cvxopt", maximization=False)` gives me this backtrace:

```
     19 from sage.numerical.mip import MIPSolverException
---> 20 from cvxopt import solvers
     21 
     22 cdef class CVXOPTBackend(GenericBackend):

build/bdist.macosx-10.9-x86_64/egg/cvxopt/__init__.py in <module>()

build/bdist.macosx-10.9-x86_64/egg/cvxopt/base.py in <module>()

build/bdist.macosx-10.9-x86_64/egg/cvxopt/base.py in __bootstrap__()

ImportError: dlopen(/Users/cn/.sage//.python-eggs/cvxopt-1.1.7-py2.7-macosx-10.9-x86_64.egg-tmp/cvxopt/base.so, 2): Library not loaded: /Users/vbraun/Code/binary-pkg/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391yaj24ng0bmdu/local/lib/libgfortran.3.dylib
  Referenced from: /Users/cn/.sage//.python-eggs/cvxopt-1.1.7-py2.7-macosx-10.9-x86_64.egg-tmp/cvxopt/base.so
  Reason: image not found
```




---

archive/issue_comments_263860.json:
```json
{
    "body": "Oh, yuk. Can you paste the output of `otool -L /Users/cn/.sage//.python-eggs/cvxopt-1.1.7-py2.7-macosx-10.9-x86_64.egg-tmp/cvxopt/base.so`?",
    "created_at": "2015-11-24T07:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263860",
    "user": "fbissey"
}
```

Oh, yuk. Can you paste the output of `otool -L /Users/cn/.sage//.python-eggs/cvxopt-1.1.7-py2.7-macosx-10.9-x86_64.egg-tmp/cvxopt/base.so`?



---

archive/issue_comments_263861.json:
```json
{
    "body": "Replying to [comment:21 fbissey]:\n> Oh, yuk. Can you paste the output of `otool -L /Users/cn/.sage//.python-eggs/cvxopt-1.1.7-py2.7-macosx-10.9-x86_64.egg-tmp/cvxopt/base.so`?\n\nHere you go:\n\n```\nel-capitan:SageMath.moved cn$ otool -L /Users/cn/.sage//.python-eggs/cvxopt-1.1.7-py2.7-macosx-10.9-x86_64.egg-tmp/cvxopt/base.so \n/Users/cn/.sage//.python-eggs/cvxopt-1.1.7-py2.7-macosx-10.9-x86_64.egg-tmp/cvxopt/base.so:\n\t/System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libLAPACK.dylib (compatibility version 1.0.0, current version 1.0.0)\n\t/System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib (compatibility version 1.0.0, current version 1.0.0)\n\t/Users/vbraun/Code/binary-pkg/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391yaj24ng0bmdu/local/lib/libgfortran.3.dylib (compatibility version 4.0.0, current version 4.0.0)\n\t/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1225.1.1)\n\t/Users/vbraun/Code/binary-pkg/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391yaj24ng0bmdu/local/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)\n```\n",
    "created_at": "2015-11-24T07:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263861",
    "user": "cnassau"
}
```

Replying to [comment:21 fbissey]:
> Oh, yuk. Can you paste the output of `otool -L /Users/cn/.sage//.python-eggs/cvxopt-1.1.7-py2.7-macosx-10.9-x86_64.egg-tmp/cvxopt/base.so`?

Here you go:

```
el-capitan:SageMath.moved cn$ otool -L /Users/cn/.sage//.python-eggs/cvxopt-1.1.7-py2.7-macosx-10.9-x86_64.egg-tmp/cvxopt/base.so 
/Users/cn/.sage//.python-eggs/cvxopt-1.1.7-py2.7-macosx-10.9-x86_64.egg-tmp/cvxopt/base.so:
	/System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libLAPACK.dylib (compatibility version 1.0.0, current version 1.0.0)
	/System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib (compatibility version 1.0.0, current version 1.0.0)
	/Users/vbraun/Code/binary-pkg/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391yaj24ng0bmdu/local/lib/libgfortran.3.dylib (compatibility version 4.0.0, current version 4.0.0)
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1225.1.1)
	/Users/vbraun/Code/binary-pkg/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391yaj24ng0bmdu/local/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)
```




---

archive/issue_comments_263862.json:
```json
{
    "body": "You need to force-rebuild cvxopt so that it isn't installed in an egg; You shouldn't have a `/.sage/.python-eggs/cvxopt",
    "created_at": "2015-11-24T09:04:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263862",
    "user": "vbraun"
}
```

You need to force-rebuild cvxopt so that it isn't installed in an egg; You shouldn't have a `/.sage/.python-eggs/cvxopt



---

archive/issue_comments_263863.json:
```json
{
    "body": "PS: The binary tarball built from this branch does pass all tests on OSX 10.11, but I don't want to distribute it as \"official\" since it is unreleased code.",
    "created_at": "2015-11-24T09:06:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263863",
    "user": "vbraun"
}
```

PS: The binary tarball built from this branch does pass all tests on OSX 10.11, but I don't want to distribute it as "official" since it is unreleased code.



---

archive/issue_comments_263864.json:
```json
{
    "body": "Can you explain what the hardlink issue is?",
    "created_at": "2015-11-26T16:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263864",
    "user": "jdemeyer"
}
```

Can you explain what the hardlink issue is?



---

archive/issue_comments_263865.json:
```json
{
    "body": "Its mostly an unnecessary pita; You have to patch the file only once, but with hardlinks it turns into a non-local problem of whether there the same file is linked elsewhere. Its also an unnecessary portability problem. And there is little to no benefit of using hard links in the first place.",
    "created_at": "2015-11-26T16:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263865",
    "user": "vbraun"
}
```

Its mostly an unnecessary pita; You have to patch the file only once, but with hardlinks it turns into a non-local problem of whether there the same file is linked elsewhere. Its also an unnecessary portability problem. And there is little to no benefit of using hard links in the first place.



---

archive/issue_comments_263866.json:
```json
{
    "body": "I don't like this so much:\n\n```\nNote: install.py deletes itself upon successful completion\n```\n\n\nI don't think that `install.py` should do that (on some operating systems, it might even not work). If you really want `install.py` to be deleted, I would put the following in `$SAGE_ROOT/sage`:\n\n```\nif [ -x \"$SAGE_ROOT/install.py\" ]; then\n    \"$SAGE_ROOT/install.py\" && rm -f \"$SAGE_ROOT/install.py\"\nfi\n```\n",
    "created_at": "2015-11-26T16:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263866",
    "user": "jdemeyer"
}
```

I don't like this so much:

```
Note: install.py deletes itself upon successful completion
```


I don't think that `install.py` should do that (on some operating systems, it might even not work). If you really want `install.py` to be deleted, I would put the following in `$SAGE_ROOT/sage`:

```
if [ -x "$SAGE_ROOT/install.py" ]; then
    "$SAGE_ROOT/install.py" && rm -f "$SAGE_ROOT/install.py"
fi
```




---

archive/issue_comments_263867.json:
```json
{
    "body": "Though unlike bash, python loads scripts into memory and then closes the file. Also the user might run install.py manually...",
    "created_at": "2015-11-26T16:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263867",
    "user": "vbraun"
}
```

Though unlike bash, python loads scripts into memory and then closes the file. Also the user might run install.py manually...



---

archive/issue_comments_263868.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-11-26T16:32:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263868",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_263869.json:
```json
{
    "body": "To support upgrading, you need to delete the old eggs when installing a non-egg version. I just checked and the egg version gets priority when doing `import cvxopt` from Python.",
    "created_at": "2015-11-26T16:32:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263869",
    "user": "jdemeyer"
}
```

To support upgrading, you need to delete the old eggs when installing a non-egg version. I just checked and the egg version gets priority when doing `import cvxopt` from Python.



---

archive/issue_comments_263870.json:
```json
{
    "body": "Replying to [comment:26 vbraun]:\n> Its mostly an unnecessary pita; You have to patch the file only once\n\nIs it a problem if it's patched twice? If it's not a problem, I would remove the change to `git/spkg-install` because it's not needed.",
    "created_at": "2015-11-26T16:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263870",
    "user": "jdemeyer"
}
```

Replying to [comment:26 vbraun]:
> Its mostly an unnecessary pita; You have to patch the file only once

Is it a problem if it's patched twice? If it's not a problem, I would remove the change to `git/spkg-install` because it's not needed.



---

archive/issue_comments_263871.json:
```json
{
    "body": "Right now the binary-pkg script will break up hardlinks so its not a problem besides waste of disk space (about 200M). Preserving hardlinks would be tricky for no good reason.\n\nReally upstream already agrees that hardlinks are such a common portability issue that they have a setting for that, we just have to switch it on. E.g. many file systems don't support it. Its not like its an intrusive change.",
    "created_at": "2015-11-26T17:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263871",
    "user": "vbraun"
}
```

Right now the binary-pkg script will break up hardlinks so its not a problem besides waste of disk space (about 200M). Preserving hardlinks would be tricky for no good reason.

Really upstream already agrees that hardlinks are such a common portability issue that they have a setting for that, we just have to switch it on. E.g. many file systems don't support it. Its not like its an intrusive change.



---

archive/issue_comments_263872.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-26T18:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263872",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_263873.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-11-26T18:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263873",
    "user": "vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_263874.json:
```json
{
    "body": "It seems that `git` use symlinks with your branch, which is good enough I guess. I certainly wouldn't like it if there would be over 100 *copies* of the same file, that's just inefficient.",
    "created_at": "2015-11-27T06:43:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263874",
    "user": "jdemeyer"
}
```

It seems that `git` use symlinks with your branch, which is good enough I guess. I certainly wouldn't like it if there would be over 100 *copies* of the same file, that's just inefficient.



---

archive/issue_comments_263875.json:
```json
{
    "body": "Yes, of course.\n\nAnything else?",
    "created_at": "2015-11-27T22:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263875",
    "user": "vbraun"
}
```

Yes, of course.

Anything else?



---

archive/issue_comments_263876.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-11-29T22:05:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263876",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_263877.json:
```json
{
    "body": "Can you use a more descriptive name instead of `install.py`? Like `relocate-once.py` or something?",
    "created_at": "2015-11-29T22:05:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263877",
    "user": "jdemeyer"
}
```

Can you use a more descriptive name instead of `install.py`? Like `relocate-once.py` or something?



---

archive/issue_comments_263878.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-29T22:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263878",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_263879.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-11-29T22:13:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263879",
    "user": "vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_263880.json:
```json
{
    "body": "I haven't checked the actual script to rewrite the install directory, but at least this branch here makes sense.",
    "created_at": "2015-11-29T22:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263880",
    "user": "jdemeyer"
}
```

I haven't checked the actual script to rewrite the install directory, but at least this branch here makes sense.



---

archive/issue_comments_263881.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-11-29T22:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263881",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_263882.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-11-30T23:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19230#issuecomment-263882",
    "user": "vbraun"
}
```

Resolution: fixed
