# Issue 14621: Polynomial representation of a padic number

Issue created by migration from Trac.

Original creator: caruso

Original creation time: 2013-06-26 10:42:23

Assignee: roed

CC:  saraedum

Keywords: polynomial representation

If $K$ is an unramified extension of $Z_p$ whose generator is $a$, this patch implements a method `polynomial` which takes as input an element $x$ in $K$ and outputs a polynomial $P$ with coefficients in $Z_p$ such that $P(a) = x$.


```
sage: K.<a> = Qq(5^3)
sage: a.polynomial()
(1 + O(5^20))*x + (O(5^20))
```



---

Attachment


---

Comment by caruso created at 2013-06-26 10:44:02

Changing status from new to needs_review.


---

Comment by rws created at 2014-05-12 13:39:25

Patch does not merge. Please rebase.


---

Comment by rws created at 2014-05-12 13:39:25

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-06-16 10:11:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2017-06-16 10:15:41

I got a little carried away with some other changes.  In particular, I renamed and deprecated list and teichmuller list.  There are still two failing doctests, but I'm going to be offline for a week or so and wanted to push my changes.


---

Comment by git created at 2017-06-29 02:23:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-06-29 16:55:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-06-30 03:50:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-06-30 04:21:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2017-06-30 04:28:11

Changing status from needs_work to needs_review.


---

Comment by roed created at 2017-06-30 04:29:39

By the way, I ran all tests and they pass.


---

Comment by saraedum created at 2017-07-02 03:03:51

David, feel free to set this to positive review. My only question would be whether `polynomial` should be added to `API.pxi`?
----
New commits:


---

Comment by saraedum created at 2017-07-02 03:06:08

Changing status from needs_review to positive_review.


---

Comment by saraedum created at 2017-07-02 03:06:08

Misunderstood something about polynomial. Never mind.


---

Comment by roed created at 2017-07-21 01:51:32

Changing status from positive_review to needs_review.


---

Comment by roed created at 2017-07-21 01:51:32

New commits:


---

Comment by saraedum created at 2017-07-21 03:57:52

Changing status from needs_review to positive_review.


---

Comment by caruso created at 2017-07-22 05:31:56

Changing status from positive_review to needs_work.


---

Comment by caruso created at 2017-07-22 05:31:56


```
    sage: K.<a> = Qq(7^3,4)
    sage: b = (a+1)/7
    sage: b.polynomial()
    sig_error() without sig_on()
    <BOUM>
```



---

Comment by git created at 2017-08-02 21:32:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-08-03 00:32:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2017-08-03 00:36:40

Changing status from needs_work to needs_review.


---

Comment by roed created at 2017-08-03 00:36:40

I fixed the segfault, and tests pass.


---

Comment by git created at 2017-08-03 01:23:11

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by roed created at 2017-08-03 01:23:54

Adding a dependency for merging purposes.


---

Comment by roed created at 2017-08-03 02:04:08

Diff against 20310


---

Attachment

For ease of reviewing, I've attached a diff against #20310.


---

Comment by saraedum created at 2017-08-04 12:25:37

Changing status from needs_review to needs_info.


---

Comment by saraedum created at 2017-08-04 12:25:37

Ok. Looks good. I fixed a few very minor documentation issues. I also wrote a unit test for expansion and it fails for some instances. This is likely only a error in the documentation:

```
sage: K=Qp(2)
sage: K(2).expansion()
[1]
sage: K(2).expansion(n=0)
0 # should return 1?
sage: K(2).expansion(n=1)
1 # sould return 0?
```

That's at least how I understand the expansion() docstring. Is the current behaviour intended?


---

Comment by saraedum created at 2017-08-04 12:40:23

Here is something that the unit test found that seems to be a bug:

```
sage: ZpCA(2)(2).expansion(lift_mode='teichmuller')
[1 + O(2^19)]
sage: ZpFM(2)(2).expansion(lift_mode='teichmuller')
[1 + O(2^20)]
```



---

Comment by roed created at 2017-08-05 08:23:03

Replying to [comment:30 saraedum]:
> Here is something that the unit test found that seems to be a bug:
> {{{
> sage: ZpCA(2)(2).expansion(lift_mode='teichmuller')
> [1 + O(2^19)]
> sage: ZpFM(2)(2).expansion(lift_mode='teichmuller')
> [1 + O(2^20)]
> }}}

Why is this a bug?
----
New commits:


---

Comment by roed created at 2017-08-05 08:25:38

Replying to [comment:29 saraedum]:
> Ok. Looks good. I fixed a few very minor documentation issues. I also wrote a unit test for expansion and it fails for some instances. This is likely only a error in the documentation:
> {{{
> sage: K=Qp(2)
> sage: K(2).expansion()
> [1]
> sage: K(2).expansion(n=0)
> 0 # should return 1?
> sage: K(2).expansion(n=1)
> 1 # should return 0?
> }}}
> That's at least how I understand the expansion() docstring. Is the current behaviour intended?

Yeah, this is intended.  When you pass in a value for `n` it gives you the coefficient of p<sup>n</sup>, rather than the `n`th term in the list.  I've updated the test (but haven't pushed yet).


---

Comment by roed created at 2017-08-05 08:28:32

So, your test causes `padic_expansion_generic.py` to time out, since it's running with precision cap 10000.  One way to improve the situation might be to change expansion to return an iterator (and then change `_test_expansion` to top out at testing at most 40 terms or something).  This ticket might be a good time to do this, since we're already deprecating list; it's not hard to change the behavior of `expansion` at the same time (which we're in fact doing by adding the `n` keyword).

What do you think?


---

Comment by saraedum created at 2017-08-05 12:05:36

Replying to [comment:35 roed]:
> Replying to [comment:29 saraedum]:
> > Ok. Looks good. I fixed a few very minor documentation issues. I also wrote a unit test for expansion and it fails for some instances. This is likely only a error in the documentation:
> > {{{
> > sage: K=Qp(2)
> > sage: K(2).expansion()
> > [1]
> > sage: K(2).expansion(n=0)
> > 0 # should return 1?
> > sage: K(2).expansion(n=1)
> > 1 # should return 0?
> > }}}
> > That's at least how I understand the expansion() docstring. Is the current behaviour intended?
> 
> Yeah, this is intended.  When you pass in a value for `n` it gives you the coefficient of p<sup>n</sup>, rather than the `n`th term in the list.  I've updated the test (but haven't pushed yet).
Ok. Then the documentation should be more explicit. I thought it's just a shortcut to get the n-th element in the list.
----
New commits:


---

Comment by saraedum created at 2017-08-05 12:07:47

Replying to [comment:36 roed]:
> So, your test causes `padic_expansion_generic.py` to time out, since it's running with precision cap 10000.  One way to improve the situation might be to change expansion to return an iterator (and then change `_test_expansion` to top out at testing at most 40 terms or something).  This ticket might be a good time to do this, since we're already deprecating list; it's not hard to change the behavior of `expansion` at the same time (which we're in fact doing by adding the `n` keyword).
> 
> What do you think?
Sounds good.


---

Comment by saraedum created at 2017-08-05 12:10:40

Replying to [comment:34 roed]:
> Replying to [comment:30 saraedum]:
> > Here is something that the unit test found that seems to be a bug:
> > {{{
> > sage: ZpCA(2)(2).expansion(lift_mode='teichmuller')
> > [1 + O(2^19)]
> > sage: ZpFM(2)(2).expansion(lift_mode='teichmuller')
> > [1 + O(2^20)]
> > }}}
> 
> Why is this a bug?
The docstring says that (since this is not a field) summing these with powers of pi should return the original element, i.e., `(1 + O(2<sup>19))*2</sup>0 == 2`.


---

Comment by git created at 2017-08-21 03:57:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2017-08-25 19:29:06

Changing status from needs_info to needs_work.


---

Comment by roed created at 2017-08-25 19:29:06

Changing keywords from "polynomial representation" to "sd87, days88, polynomial representation".


---

Comment by git created at 2017-09-06 16:44:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-09-08 23:51:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-09-09 03:16:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-09-09 03:27:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2017-09-09 03:30:13

Changing status from needs_work to needs_review.


---

Comment by git created at 2017-09-09 04:49:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2017-09-10 14:17:56

Changing status from needs_review to needs_work.


---

Comment by saraedum created at 2017-09-10 14:39:48

This looks very good. Is there a follow up ticket to implement the new `__getitem__`?


---

Comment by git created at 2017-09-11 07:42:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2017-09-11 07:51:31

Replying to [comment:52 saraedum]:
> This looks very good. Is there a follow up ticket to implement the new `__getitem__`?

Followup is now #23827


---

Comment by roed created at 2017-09-11 17:31:08

Patchbot complains about `.. SEEALSO::`, but I'm confused: this is the correct syntax described both in the developer guide and the [patchbot source code](https://github.com/sagemath/sage-patchbot/blob/master/sage_patchbot/plugins.py)!  Am I missing something?

The doctest errors are the normal glpk issues, which aren't due to this ticket.


---

Comment by roed created at 2017-09-11 17:31:08

Changing status from needs_work to needs_review.


---

Comment by saraedum created at 2017-09-20 15:58:48

New commits:


---

Comment by git created at 2017-09-20 16:01:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-09-20 18:19:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2017-09-22 19:42:22

Changing status from needs_review to positive_review.


---

Comment by roed created at 2017-09-22 19:42:22

I'm happy with Julian's changes, and the patchbot is green.  Positive review!
----
New commits:


---

Comment by vbraun created at 2017-09-24 13:13:37

Resolution: fixed
