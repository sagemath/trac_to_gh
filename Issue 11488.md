# Issue 11488: docutils installs some files not-world-readable

Issue created by migration from https://trac.sagemath.org/ticket/11660

Original creator: jdemeyer

Original creation time: 2011-08-08 12:40:55

Assignee: tbd

The new docutils spkg from #10166 installs some files not-world-readable which causes trouble when running Sage as a different user from the user which compiled Sage.  For example, the following fails from the notebook:

```
sage: EllipticCurve?
IOError: [Errno 13] Permission denied: '/usr/local/sage/sage-4.7.1.rc0/local/lib/python2.6/site-packages/docutils/writers/html4css1/html4css1.css'
```


Here is a list of files which have 0600 permission inside
`SAGE_ROOT/local/lib/python2.6/site-packages/docutils`:

```
-rw------- 1 jdemeyer jdemeyer   666 2005-06-12 22:34 ./parsers/rst/include/README.txt
-rw------- 1 jdemeyer jdemeyer 10925 2005-06-12 18:40 ./parsers/rst/include/isoamsa.txt
-rw------- 1 jdemeyer jdemeyer  7242 2005-06-12 18:40 ./parsers/rst/include/isoamsb.txt
-rw------- 1 jdemeyer jdemeyer  1723 2005-06-12 18:40 ./parsers/rst/include/isoamsc.txt
-rw------- 1 jdemeyer jdemeyer  6721 2005-06-12 18:40 ./parsers/rst/include/isoamsn.txt
-rw------- 1 jdemeyer jdemeyer  3825 2005-06-12 18:40 ./parsers/rst/include/isoamso.txt
-rw------- 1 jdemeyer jdemeyer 11763 2005-06-12 18:40 ./parsers/rst/include/isoamsr.txt
-rw------- 1 jdemeyer jdemeyer  3101 2005-06-12 18:40 ./parsers/rst/include/isobox.txt
-rw------- 1 jdemeyer jdemeyer  4241 2005-06-12 18:40 ./parsers/rst/include/isocyr1.txt
-rw------- 1 jdemeyer jdemeyer  1882 2005-06-12 18:40 ./parsers/rst/include/isocyr2.txt
-rw------- 1 jdemeyer jdemeyer   869 2005-06-12 18:40 ./parsers/rst/include/isodia.txt
-rw------- 1 jdemeyer jdemeyer  3010 2005-06-12 18:40 ./parsers/rst/include/isogrk1.txt
-rw------- 1 jdemeyer jdemeyer  1705 2005-06-12 18:40 ./parsers/rst/include/isogrk2.txt
-rw------- 1 jdemeyer jdemeyer  2880 2005-06-12 18:40 ./parsers/rst/include/isogrk3.txt
-rw------- 1 jdemeyer jdemeyer  3035 2005-06-12 18:40 ./parsers/rst/include/isogrk4-wide.txt
-rw------- 1 jdemeyer jdemeyer   372 2005-06-12 18:40 ./parsers/rst/include/isogrk4.txt
-rw------- 1 jdemeyer jdemeyer  4397 2005-06-12 18:40 ./parsers/rst/include/isolat1.txt
-rw------- 1 jdemeyer jdemeyer  8466 2005-06-12 18:40 ./parsers/rst/include/isolat2.txt
-rw------- 1 jdemeyer jdemeyer  3334 2005-06-12 18:40 ./parsers/rst/include/isomfrk-wide.txt
-rw------- 1 jdemeyer jdemeyer   519 2005-06-12 18:40 ./parsers/rst/include/isomfrk.txt
-rw------- 1 jdemeyer jdemeyer  1931 2005-06-12 18:40 ./parsers/rst/include/isomopf-wide.txt
-rw------- 1 jdemeyer jdemeyer   639 2005-06-12 18:40 ./parsers/rst/include/isomopf.txt
-rw------- 1 jdemeyer jdemeyer  3231 2005-06-12 18:40 ./parsers/rst/include/isomscr-wide.txt
-rw------- 1 jdemeyer jdemeyer   776 2005-06-12 18:40 ./parsers/rst/include/isomscr.txt
-rw------- 1 jdemeyer jdemeyer  4066 2005-06-12 18:40 ./parsers/rst/include/isonum.txt
-rw------- 1 jdemeyer jdemeyer  4613 2005-06-12 18:40 ./parsers/rst/include/isopub.txt
-rw------- 1 jdemeyer jdemeyer  9726 2005-06-12 18:40 ./parsers/rst/include/isotech.txt
-rw------- 1 jdemeyer jdemeyer 45428 2005-06-12 18:40 ./parsers/rst/include/mmlalias.txt
-rw------- 1 jdemeyer jdemeyer  9010 2005-06-12 18:40 ./parsers/rst/include/mmlextra-wide.txt
-rw------- 1 jdemeyer jdemeyer  6800 2005-06-12 18:40 ./parsers/rst/include/mmlextra.txt
-rw------- 1 jdemeyer jdemeyer  1036 2006-02-26 17:16 ./parsers/rst/include/s5defs.txt
-rw------- 1 jdemeyer jdemeyer  6112 2005-06-12 18:40 ./parsers/rst/include/xhtml1-lat1.txt
-rw------- 1 jdemeyer jdemeyer  1945 2005-06-12 18:40 ./parsers/rst/include/xhtml1-special.txt
-rw------- 1 jdemeyer jdemeyer  7028 2005-06-12 18:40 ./parsers/rst/include/xhtml1-symbol.txt
-rw------- 1 jdemeyer jdemeyer  5950 2010-03-02 01:24 ./writers/html4css1/html4css1.css
-rw------- 1 jdemeyer jdemeyer   114 2006-03-31 05:36 ./writers/html4css1/template.txt
-rw------- 1 jdemeyer jdemeyer   461 2009-11-30 09:10 ./writers/latex2e/default.tex
-rw------- 1 jdemeyer jdemeyer   408 2009-11-30 09:10 ./writers/latex2e/titlepage.tex
-rw------- 1 jdemeyer jdemeyer 37732 2006-11-12 23:19 ./writers/newlatex2e/base.tex
-rw------- 1 jdemeyer jdemeyer 11824 2010-05-14 23:40 ./writers/odf_odt/styles.odt
-rw------- 1 jdemeyer jdemeyer  6367 2006-05-21 22:44 ./writers/pep_html/pep.css
-rw------- 1 jdemeyer jdemeyer  1294 2006-03-31 05:36 ./writers/pep_html/template.txt
-rw------- 1 jdemeyer jdemeyer   301 2005-12-08 05:43 ./writers/s5_html/themes/README.txt
-rw------- 1 jdemeyer jdemeyer    38 2007-04-09 17:15 ./writers/s5_html/themes/big-black/__base__
-rw------- 1 jdemeyer jdemeyer   911 2007-04-09 17:15 ./writers/s5_html/themes/big-black/framing.css
-rw------- 1 jdemeyer jdemeyer  3606 2007-04-09 17:15 ./writers/s5_html/themes/big-black/pretty.css
-rw------- 1 jdemeyer jdemeyer   906 2007-04-09 17:15 ./writers/s5_html/themes/big-white/framing.css
-rw------- 1 jdemeyer jdemeyer  3566 2007-04-09 17:15 ./writers/s5_html/themes/big-white/pretty.css
-rw------- 1 jdemeyer jdemeyer    49 2005-12-08 05:43 ./writers/s5_html/themes/default/blank.gif
-rw------- 1 jdemeyer jdemeyer  1003 2005-12-08 05:43 ./writers/s5_html/themes/default/framing.css
-rw------- 1 jdemeyer jdemeyer  1190 2005-12-08 05:43 ./writers/s5_html/themes/default/iepngfix.htc
-rw------- 1 jdemeyer jdemeyer   261 2005-12-08 05:43 ./writers/s5_html/themes/default/opera.css
-rw------- 1 jdemeyer jdemeyer   648 2005-12-13 03:21 ./writers/s5_html/themes/default/outline.css
-rw------- 1 jdemeyer jdemeyer  4384 2005-12-13 01:30 ./writers/s5_html/themes/default/pretty.css
-rw------- 1 jdemeyer jdemeyer   818 2005-12-13 03:21 ./writers/s5_html/themes/default/print.css
-rw------- 1 jdemeyer jdemeyer   451 2005-12-08 05:43 ./writers/s5_html/themes/default/s5-core.css
-rw------- 1 jdemeyer jdemeyer   283 2005-12-08 05:43 ./writers/s5_html/themes/default/slides.css
-rw------- 1 jdemeyer jdemeyer 15800 2006-01-05 13:55 ./writers/s5_html/themes/default/slides.js
-rw------- 1 jdemeyer jdemeyer    41 2007-04-09 17:15 ./writers/s5_html/themes/medium-black/__base__
-rw------- 1 jdemeyer jdemeyer  4031 2007-04-09 17:15 ./writers/s5_html/themes/medium-black/pretty.css
-rw------- 1 jdemeyer jdemeyer   944 2007-04-09 17:15 ./writers/s5_html/themes/medium-white/framing.css
-rw------- 1 jdemeyer jdemeyer  3991 2007-04-09 17:15 ./writers/s5_html/themes/medium-white/pretty.css
-rw------- 1 jdemeyer jdemeyer    40 2007-04-09 17:15 ./writers/s5_html/themes/small-black/__base__
-rw------- 1 jdemeyer jdemeyer  4030 2007-04-09 17:15 ./writers/s5_html/themes/small-black/pretty.css
-rw------- 1 jdemeyer jdemeyer   941 2007-04-09 17:15 ./writers/s5_html/themes/small-white/framing.css
-rw------- 1 jdemeyer jdemeyer  4001 2007-04-09 17:15 ./writers/s5_html/themes/small-white/pretty.css
```



---

Comment by jdemeyer created at 2011-08-08 12:59:29

Changing status from new to needs_review.


---

Comment by leif created at 2011-08-08 13:20:31

Changing status from needs_review to positive_review.


---

Comment by leif created at 2011-08-08 13:20:31

I would have added a note to _Special Update/Build Instructions_ (and tagged the new changeset to `docutils-0.7.p0`) though.


---

Comment by kini created at 2011-08-08 13:23:19

Ideally this should be done with chmod in the setup script. Eventually we will want to transition to a build system where upstream sources remain untouched in the src/ directory (which is why they're not under our revision control).


---

Comment by leif created at 2011-08-08 13:30:13

Replying to [comment:3 kini]:
> Ideally this should be done with chmod in the setup script. Eventually we will want to transition to a build system where upstream sources remain untouched in the src/ directory (which is why they're not under our revision control).

Yep, but it's not always clear if someone just extracted the upstream sources the wrong way.

Jeroen, did you report this upstream? (Apparently only some files had wrong permissions, so I assume they came indeed from upstream.)

P.S.: Feel free to consider #11658 critical or a blocker; #11519 can be closed as a duplicate.


---

Comment by vbraun created at 2011-08-08 14:30:59

+1 for fixing this in the setup script and setting the source files to reasonable values after unpacking. I suggest the following:

```sh
chmod -R u+rwX,go+rX src
```

Note that the capital X sets executable permissions for directories and files with u+x ONLY. To make sure that we don't trip over a posix issue I tested it on skynet/mark2 and it works on solaris, too.


---

Comment by leif created at 2011-08-08 15:21:55

Replying to [comment:5 vbraun]:
> I suggest the following:

```sh
chmod -R u+rwX,go+rX src
```

I guess you meant

```sh
chmod -R u+rw,go+rX src
```

as `u+X` doesn't make much sense (though it could in principle happen that some file has execute permissions for the group or others but not the owner himself, but such should certainly be reported upstream).


---

Comment by jdemeyer created at 2011-08-08 15:50:00

Replying to [comment:5 vbraun]:
> +1 for fixing this in the setup script and setting the source files to reasonable values after unpacking.

The problem with this is that it doesn't allow for special cases. Perhaps there are scenarios where unusual permissions make sense.


---

Comment by vbraun created at 2011-08-08 17:15:35

1. The chmod command will only increase the permissions, so it can't break anything as long as upstream has at least a minimum of sanity
  1. Any makefile that does *not* use `install` (with explicit permissions) to install files is broken, we just haven't triggered the bug yet.


---

Comment by jdemeyer created at 2011-08-08 19:38:47

Replying to [comment:8 vbraun]:
> Any makefile that does *not* use `install` (with explicit permissions) to install files is broken, we just haven't triggered the bug yet.

You are probably right, but unfortunately we cannot fix every spkg to do this :-)


---

Comment by jdemeyer created at 2011-08-09 16:52:50

Resolution: fixed


---

Comment by kini created at 2011-08-10 08:02:51

Replying to [comment:7 jdemeyer]:
> Replying to [comment:5 vbraun]:
> > +1 for fixing this in the setup script and setting the source files to reasonable values after unpacking.
> 
> The problem with this is that it doesn't allow for special cases. Perhaps there are scenarios where unusual permissions make sense. 

Sure. When I said "the setup script" I meant the spkg-install script in an individual SPKG. So those scenarios could be handled on an individual basis.
