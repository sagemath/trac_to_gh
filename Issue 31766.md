# Issue 31766: regression in RealBallField

Issue created by migration from https://trac.sagemath.org/ticket/32003

Original creator: zimmerma

Original creation time: 2021-06-18 07:26:24

CC:  fredrik.johansson vdelecroix mmezzarobba

this used to work in Sage 9.0:

```
sage: RealBallField(2)(abs(exp(1)+I))
[+/- 4.01]
```

but does not work any more in Sage 9.3:

```
sage: RealBallField(2)(abs(exp(1)+I))
...
TypeError: unable to convert abs(e + I) to a RealBall
```



---

Comment by mkoeppe created at 2021-06-18 17:54:32

This might be coming from #18036, see https://wiki.sagemath.org/ReleaseTours/sage-9.3#Symbolic_expressions


---

Comment by @DaveWitteMorris created at 2021-06-18 18:03:43

On CoCalc, this works in 9.1, but not in 9.2.  Since #18036 seems to have been merged in 9.3, I don't think it is the issue.


---

Comment by mmezzarobba created at 2021-06-18 18:16:19

Likely #28517 (or its dependencies) then. If that's indeed the case, it used to work, yes, but for wrong reasons and thanks to code that produced catastrophically wrong results in other cases...


---

Comment by zimmerma created at 2021-06-19 06:07:56

ok so one now has to use `ComplexBallField` for expressions involving `I` now?


---

Comment by mmezzarobba created at 2021-06-19 07:46:56

Replying to [comment:4 zimmerma]:
> ok so one now has to use `ComplexBallField` for expressions involving `I` now?

That would work, yes. And I agree that it would be nice to make `RBF(abs(...))` work too...


---

Comment by mmezzarobba created at 2021-06-19 09:24:50

An attempt to improve the situation...
----
New commits:


---

Comment by mmezzarobba created at 2021-06-19 09:24:50

Changing status from new to needs_review.


---

Comment by mmezzarobba created at 2021-06-19 09:24:50

Changing type from defect to enhancement.


---

Comment by tscrim created at 2021-06-20 23:52:15

This has some doctest failures from the patchbot:

```
sage -t --long --random-seed=0 src/sage/rings/complex_arb.pyx  # 3 doctests failed
sage -t --long --random-seed=0 src/sage/rings/real_arb.pyx  # 3 doctests failed
sage -t --long --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/float_doctest.py  # 2 doctests failed
```

Looks like a change in precision.

Also, minor `.. warning::` -> `.. WARNING::`.


---

Comment by git created at 2021-06-21 08:24:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2021-06-21 08:25:54

Thanks Travis!


---

Comment by slelievre created at 2021-07-24 17:05:54

Feu vert.


---

Comment by slelievre created at 2021-07-24 17:05:54

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-07-25 13:26:52

Resolution: fixed
