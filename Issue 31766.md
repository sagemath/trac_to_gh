# Issue 31766: regression in RealBallField

archive/issues_031766.json:
```json
{
    "body": "CC:  @fredrik-johansson @videlec @mezzarobba\n\nthis used to work in Sage 9.0:\n\n```\nsage: RealBallField(2)(abs(exp(1)+I))\n[+/- 4.01]\n```\n\nbut does not work any more in Sage 9.3:\n\n```\nsage: RealBallField(2)(abs(exp(1)+I))\n...\nTypeError: unable to convert abs(e + I) to a RealBall\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/32003\n\n",
    "created_at": "2021-06-18T07:26:24Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "regression in RealBallField",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31766",
    "user": "https://github.com/zimmermann6"
}
```
CC:  @fredrik-johansson @videlec @mezzarobba

this used to work in Sage 9.0:

```
sage: RealBallField(2)(abs(exp(1)+I))
[+/- 4.01]
```

but does not work any more in Sage 9.3:

```
sage: RealBallField(2)(abs(exp(1)+I))
...
TypeError: unable to convert abs(e + I) to a RealBall
```


Issue created by migration from https://trac.sagemath.org/ticket/32003





---

archive/issue_comments_453385.json:
```json
{
    "body": "This might be coming from #18036, see https://wiki.sagemath.org/ReleaseTours/sage-9.3#Symbolic_expressions",
    "created_at": "2021-06-18T17:54:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31766#issuecomment-453385",
    "user": "https://github.com/mkoeppe"
}
```

This might be coming from #18036, see https://wiki.sagemath.org/ReleaseTours/sage-9.3#Symbolic_expressions



---

archive/issue_comments_453386.json:
```json
{
    "body": "On CoCalc, this works in 9.1, but not in 9.2.  Since #18036 seems to have been merged in 9.3, I don't think it is the issue.",
    "created_at": "2021-06-18T18:03:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31766#issuecomment-453386",
    "user": "https://github.com/DaveWitteMorris"
}
```

On CoCalc, this works in 9.1, but not in 9.2.  Since #18036 seems to have been merged in 9.3, I don't think it is the issue.



---

archive/issue_comments_453387.json:
```json
{
    "body": "Likely #28517 (or its dependencies) then. If that's indeed the case, it used to work, yes, but for wrong reasons and thanks to code that produced catastrophically wrong results in other cases...",
    "created_at": "2021-06-18T18:16:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31766#issuecomment-453387",
    "user": "https://github.com/mezzarobba"
}
```

Likely #28517 (or its dependencies) then. If that's indeed the case, it used to work, yes, but for wrong reasons and thanks to code that produced catastrophically wrong results in other cases...



---

archive/issue_comments_453388.json:
```json
{
    "body": "ok so one now has to use `ComplexBallField` for expressions involving `I` now?",
    "created_at": "2021-06-19T06:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31766#issuecomment-453388",
    "user": "https://github.com/zimmermann6"
}
```

ok so one now has to use `ComplexBallField` for expressions involving `I` now?



---

archive/issue_comments_453389.json:
```json
{
    "body": "Replying to [comment:4 zimmerma]:\n> ok so one now has to use `ComplexBallField` for expressions involving `I` now?\n\nThat would work, yes. And I agree that it would be nice to make `RBF(abs(...))` work too...",
    "created_at": "2021-06-19T07:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31766#issuecomment-453389",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:4 zimmerma]:
> ok so one now has to use `ComplexBallField` for expressions involving `I` now?

That would work, yes. And I agree that it would be nice to make `RBF(abs(...))` work too...



---

archive/issue_comments_453390.json:
```json
{
    "body": "An attempt to improve the situation...\n----\nNew commits:",
    "created_at": "2021-06-19T09:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31766#issuecomment-453390",
    "user": "https://github.com/mezzarobba"
}
```

An attempt to improve the situation...
----
New commits:



---

archive/issue_comments_453391.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-19T09:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31766#issuecomment-453391",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_453392.json:
```json
{
    "body": "Changing type from defect to enhancement.",
    "created_at": "2021-06-19T09:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31766#issuecomment-453392",
    "user": "https://github.com/mezzarobba"
}
```

Changing type from defect to enhancement.



---

archive/issue_comments_453393.json:
```json
{
    "body": "This has some doctest failures from the patchbot:\n\n```\nsage -t --long --random-seed=0 src/sage/rings/complex_arb.pyx  # 3 doctests failed\nsage -t --long --random-seed=0 src/sage/rings/real_arb.pyx  # 3 doctests failed\nsage -t --long --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/float_doctest.py  # 2 doctests failed\n```\n\nLooks like a change in precision.\n\nAlso, minor `.. warning::` -> `.. WARNING::`.",
    "created_at": "2021-06-20T23:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31766#issuecomment-453393",
    "user": "https://github.com/tscrim"
}
```

This has some doctest failures from the patchbot:

```
sage -t --long --random-seed=0 src/sage/rings/complex_arb.pyx  # 3 doctests failed
sage -t --long --random-seed=0 src/sage/rings/real_arb.pyx  # 3 doctests failed
sage -t --long --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/float_doctest.py  # 2 doctests failed
```

Looks like a change in precision.

Also, minor `.. warning::` -> `.. WARNING::`.



---

archive/issue_comments_453394.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-21T08:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31766#issuecomment-453394",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_453395.json:
```json
{
    "body": "Thanks Travis!",
    "created_at": "2021-06-21T08:25:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31766#issuecomment-453395",
    "user": "https://github.com/mezzarobba"
}
```

Thanks Travis!



---

archive/issue_comments_453396.json:
```json
{
    "body": "Feu vert.",
    "created_at": "2021-07-24T17:05:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31766#issuecomment-453396",
    "user": "https://github.com/slel"
}
```

Feu vert.



---

archive/issue_comments_453397.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-24T17:05:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31766#issuecomment-453397",
    "user": "https://github.com/slel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_453398.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-25T13:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31766#issuecomment-453398",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_028927.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2021-07-25T13:26:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31766",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31766#event-28927"
}
```
