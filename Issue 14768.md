# Issue 14768: %edit does not work anymore

Issue created by migration from https://trac.sagemath.org/ticket/15005

Original creator: mmezzarobba

Original creation time: 2013-08-06 09:12:51


```
sage: %edit
IPython will make a temporary file named: /tmp/ipython_edit_QLsRWD.py
Editing...---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-1-107a4967e4b8> in <module>()
----> 1 get_ipython().magic(u'edit')

/home/marc/co/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.pyc in magic(self, arg_s)
   2134         magic_name, _, magic_arg_s = arg_s.partition(' ')
   2135         magic_name = magic_name.lstrip(prefilter.ESC_MAGIC)
-> 2136         return self.run_line_magic(magic_name, magic_arg_s)
   2137 
   2138     #-------------------------------------------------------------------------

/home/marc/co/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.pyc in run_line_magic(self, magic_name, line)
   2060                 args.append(sys._getframe(stack_depth).f_locals)
   2061             with self.builtin_trap:
-> 2062                 result = fn(*args)
   2063             return result
   2064 

/home/marc/co/sage/local/lib/python2.7/site-packages/IPython/core/magics/code.pyc in edit(self, parameter_s, last_call)

/home/marc/co/sage/local/lib/python2.7/site-packages/IPython/core/magic.pyc in <lambda>(f, *a, **k)                                                                                                                                                                
    189     # but it's overkill for just that one bit of state.                                                                                                                    
    190     def magic_deco(arg):                                                                                                                                                   
--> 191         call = lambda f, *a, **k: f(*a, **k)                                                                                                                               
    192                                                                                                                                                                            
    193         if callable(arg):                                                                                                                                                  
                                                                                                                                                                                   
/home/marc/co/sage/local/lib/python2.7/site-packages/IPython/core/magics/code.py                                                                                                   c in edit(self, parameter_s, last_call)                                                                                                                                            
    490             if ' ' in filename:
    491                 filename = "'%s'" % filename
--> 492             self.shell.hooks.editor(filename,lineno)
    493         except TryNext:
    494             warn('Could not open editor')

/home/marc/co/sage/local/lib/python2.7/site-packages/IPython/core/hooks.pyc in __call__(self, *args, **kw)
    136             #print "prio",prio,"cmd",cmd #dbg
    137             try:
--> 138                 return cmd(*args, **kw)
    139             except TryNext as exc:
    140                 last_exc = exc

/home/marc/co/sage/local/lib/python2.7/site-packages/sage/misc/edit_module.pyc in edit_devel(self, filename, linenum)
    302     """
    303     import IPython.core.hooks
--> 304     sageroot = sage.misc.sageinspect.SAGE_ROOT+'/'
    305     runpathpattern = '^'+sageroot+'local/lib/python[^/]*/site-packages'
    306     develbranch = sageroot+'devel/sage'

AttributeError: 'module' object has no attribute 'SAGE_ROOT'
```


This is apparently due to an occurrence of SAGE_ROOT missed by #13432.

The branch linked to this ticket contains a simple patch to fix the issue. I don't know how to test for it automatically (there are already examples that trigger the bug in `sage.misc.edit_module`, but they are all marked `# not tested`), so the patch doesn't add any new test.

Note that `%edit object` still fails in many cases (e.g., when `object` is an instance of a Cython class). A workaround is to use `%edit -n 0`. See also [IPython issue 3920](https://github.com/ipython/ipython/issues/3920).


---

Comment by mmezzarobba created at 2013-08-06 09:21:22

Changing status from new to needs_review.


---

Comment by vbraun created at 2013-11-27 14:46:23

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2013-11-27 14:46:23

lgtm
----
New commits:


---

Comment by vbraun created at 2013-12-21 22:18:32

Resolution: fixed
