# Issue 28893: Add nix package information, extend dockerfile generator to nix

Issue created by migration from https://trac.sagemath.org/ticket/29130

Original creator: mkoeppe

Original creation time: 2020-01-31 23:45:36

CC:  @timokau dimpase @kliem

This extends #29053, where it is done for debian/fedora/conda/arch.


---

Comment by mkoeppe created at 2020-03-10 02:53:57

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-03-10 02:53:57

This defines `docker-nixos-minimal`.

For `docker-nixos-standard`, need to add many package equivalences to `build/pkgs/*/distros/nix.txt`
----
New commits:


---

Comment by @timokau created at 2020-03-10 13:03:11

Regarding the package equivalents: All packages sage needs should be listed at the start of one of those files:

- https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/science/math/sage/env-locations.nix
- https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/science/math/sage/sagedoc.nix
- https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/science/math/sage/sagelib.nix
- https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/science/math/sage/sage-env.nix

One caveat is that if you want to use system python packages, you either need to add them to PYTHONPATH manually or install them as a single python environment. That means instead of installing
`python3`, `numpy`, `scipy`
separately, you'd install the "package" (or environment) `python3.withPackages (ps: with ps; [numpy scipy])`.

I'm happy to help by explaining things, though I won't take the lead on this for now since sage-the-distribution isn't high priority for me right now (I have my hands full keeping the nix package running).


---

Comment by mkoeppe created at 2020-03-17 03:47:51

Replying to [comment:5 gh-timokau]:
> Regarding the package equivalents: All packages sage needs should be listed at the start of one of those files:
> 
> - https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/science/math/sage/env-locations.nix
> - https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/science/math/sage/sagedoc.nix
> - https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/science/math/sage/sagelib.nix
> - https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/science/math/sage/sage-env.nix

Thanks.

> One caveat is that if you want to use system python packages, ...

For now, we are not taking care of any Python packages.


---

Comment by mkoeppe created at 2020-04-14 06:38:06

pushing these forward to 9.2


---

Comment by git created at 2020-06-15 20:57:37

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2020-06-15 20:58:00

Rebased on 9.2.beta1


---

Comment by mkoeppe created at 2020-06-15 20:59:49

Starting points for people who want to help with this:

- ​https://doc.sagemath.org/html/en/developer/portability_testing.html
- ​https://researchseminars.org/talk/SageDays109/7/


---

Comment by mkoeppe created at 2020-07-02 22:31:36

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-08-11 17:56:32

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2020-08-11 18:43:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-08-11 18:56:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-08-11 19:02:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-08-11 19:50:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-08-11 19:51:28

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2020-08-24 17:10:59

Let's get this in please


---

Comment by @kliem created at 2020-08-24 20:31:45

I'm running a few tests here: https://github.com/kliem/sage/pull/24/checks


---

Comment by @kliem created at 2020-08-25 05:06:11

python3 isn't picked up, which isn't very surprising by the above comment. I guess this can be done in a future ticket.

It is not recognized that gcc contains a fortran compiler. But that is maybe also a future ticket.

`libgd` fails to install, which is somewhat unfortunate as we could simply add the package `freetype` to the system, couldn't we?


---

Comment by @kliem created at 2020-08-25 18:57:32

This is pretty much good to go. I think only the last point should be handled here, shouldn't it?


---

Comment by @kliem created at 2020-08-26 06:28:32

I added freetype. If you agree, this is a positive review.
----
New commits:


---

Comment by mkoeppe created at 2020-08-26 15:25:28

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-08-26 15:25:28

Thank you!


---

Comment by vbraun created at 2020-08-30 08:39:20

Resolution: fixed
