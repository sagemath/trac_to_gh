# Issue 22732: Upgrade to Pynac-0.7.7

archive/issues_022732.json:
```json
{
    "body": "Pynac-0.7.7 changes:\n* fix regression in Singular interface (last minute fix of #22838)\n* fix series problems (#22959)\n* fix dilog/polylog numerics (#18386, #19906)\n* avoid Python errors when comparing complex in richcmp\n* general handling of evalf of one-arg functions (obsoletes py_sin etc)\n\nIssue created by migration from https://trac.sagemath.org/ticket/22969\n\n",
    "created_at": "2017-05-10T06:57:29Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Upgrade to Pynac-0.7.7",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22732",
    "user": "rws"
}
```
Pynac-0.7.7 changes:
* fix regression in Singular interface (last minute fix of #22838)
* fix series problems (#22959)
* fix dilog/polylog numerics (#18386, #19906)
* avoid Python errors when comparing complex in richcmp
* general handling of evalf of one-arg functions (obsoletes py_sin etc)

Issue created by migration from https://trac.sagemath.org/ticket/22969





---

archive/issue_comments_317371.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-05-10T07:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317371",
    "user": "rws"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_317372.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-05-10T07:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317372",
    "user": "rws"
}
```

New commits:



---

archive/issue_comments_317373.json:
```json
{
    "body": "LGTM. Off to the buildbots.",
    "created_at": "2017-05-10T13:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317373",
    "user": "tscrim"
}
```

LGTM. Off to the buildbots.



---

archive/issue_comments_317374.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-05-10T13:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317374",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_317375.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-05-14T08:16:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317375",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_317376.json:
```json
{
    "body": "On OSX:\n\n```\nsage -t --long src/sage/functions/log.py\n**********************************************************************\nFile \"src/sage/functions/log.py\", line 434, in sage.functions.log.Function_polylog.__init__\nFailed example:\n    polylog(2, 1.0)\nExpected:\n    NaN\nGot:\n    NaN + NaN*I\n**********************************************************************\nFile \"src/sage/functions/log.py\", line 436, in sage.functions.log.Function_polylog.__init__\nFailed example:\n    polylog(2.0, 1.0)\nExpected:\n    NaN\nGot:\n    NaN + NaN*I\n**********************************************************************\n1 item had failures:\n   2 of  26 in sage.functions.log.Function_polylog.__init__\n    [271 tests, 2 failures, 9.23 s]\n```\n",
    "created_at": "2017-05-14T08:16:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317376",
    "user": "vbraun"
}
```

On OSX:

```
sage -t --long src/sage/functions/log.py
**********************************************************************
File "src/sage/functions/log.py", line 434, in sage.functions.log.Function_polylog.__init__
Failed example:
    polylog(2, 1.0)
Expected:
    NaN
Got:
    NaN + NaN*I
**********************************************************************
File "src/sage/functions/log.py", line 436, in sage.functions.log.Function_polylog.__init__
Failed example:
    polylog(2.0, 1.0)
Expected:
    NaN
Got:
    NaN + NaN*I
**********************************************************************
1 item had failures:
   2 of  26 in sage.functions.log.Function_polylog.__init__
    [271 tests, 2 failures, 9.23 s]
```




---

archive/issue_comments_317377.json:
```json
{
    "body": "The difference may be due to different results from `cmp(RBF(NaN),1)` on OSX (?, Linux gives `1`) but it shows things can be done better in other parts of the computation.",
    "created_at": "2017-05-15T07:37:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317377",
    "user": "rws"
}
```

The difference may be due to different results from `cmp(RBF(NaN),1)` on OSX (?, Linux gives `1`) but it shows things can be done better in other parts of the computation.



---

archive/issue_comments_317378.json:
```json
{
    "body": "There will be a new release, specifically usage of `PyObject_Cmp` will be phased out.\n\nI hope the following is `False` on OSX too, as my attempt to fix the above depends on it:\n\n```\nsage: RBF(NaN)._richcmp_(RBF(1),0)\nFalse\n```\n\nIf this is different then we'll depend on #23001 for a fix.",
    "created_at": "2017-05-15T13:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317378",
    "user": "rws"
}
```

There will be a new release, specifically usage of `PyObject_Cmp` will be phased out.

I hope the following is `False` on OSX too, as my attempt to fix the above depends on it:

```
sage: RBF(NaN)._richcmp_(RBF(1),0)
False
```

If this is different then we'll depend on #23001 for a fix.



---

archive/issue_comments_317379.json:
```json
{
    "body": "> The difference may be due to different results from `cmp(RBF(NaN),1)` on OSX (?, Linux gives `1`) but it shows things can be done better in other parts of the computation.\n\nNo this is not the reason.",
    "created_at": "2017-05-15T13:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317379",
    "user": "rws"
}
```

> The difference may be due to different results from `cmp(RBF(NaN),1)` on OSX (?, Linux gives `1`) but it shows things can be done better in other parts of the computation.

No this is not the reason.



---

archive/issue_comments_317380.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-16T13:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317380",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317381.json:
```json
{
    "body": "OK, no new release, but I added a patch and it all depends on #23001. I'm pretty sure this fixes the issue which was very poor programming---I relied on undefined behaviour to get the right result.",
    "created_at": "2017-05-16T13:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317381",
    "user": "rws"
}
```

OK, no new release, but I added a patch and it all depends on #23001. I'm pretty sure this fixes the issue which was very poor programming---I relied on undefined behaviour to get the right result.



---

archive/issue_comments_317382.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-05-16T13:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317382",
    "user": "rws"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_317383.json:
```json
{
    "body": "Back to the buildbots.",
    "created_at": "2017-05-16T14:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317383",
    "user": "tscrim"
}
```

Back to the buildbots.



---

archive/issue_comments_317384.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-05-16T14:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317384",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_317385.json:
```json
{
    "body": "Doesn't build for me with the added patch\n\n```\nlibtool: compile:  x86_64-pc-linux-gnu-g++ -DHAVE_CONFIG_H -I. -I.. -I/usr/include/python2.7 -DSING_NDEBUG -DOM_NDEBUG -DSING_NDEBUG -DOM_NDEBUG -Wall -Wextra -Wshadow -Wnon-virtual-dtor -Wno-unused-parameter -march=native -O2 -pipe -std=gnu++11 -c numeric.cpp  -fPIC -DPIC -o .libs/libpynac_la-numeric.o\nIn file included from /usr/include/python2.7/Python.h:8:0,\n                 from basic.h:26,\n                 from numeric.h:49,\n                 from numeric.cpp:55:\n/usr/include/python2.7/pyconfig.h:1193:0: warning: \"_POSIX_C_SOURCE\" redefined\n #define _POSIX_C_SOURCE 200112L\n ^\nIn file included from /usr/include/stdlib.h:24:0,\n                 from /usr/include/flint/fmpz.h:37,\n                 from numeric.cpp:52:\n/usr/include/features.h:225:0: note: this is the location of the previous definition\n # define _POSIX_C_SOURCE 200809L\n ^\nIn file included from /usr/include/python2.7/Python.h:8:0,\n                 from basic.h:26,\n                 from numeric.h:49,\n                 from numeric.cpp:55:\n/usr/include/python2.7/pyconfig.h:1215:0: warning: \"_XOPEN_SOURCE\" redefined\n #define _XOPEN_SOURCE 600\n ^\nIn file included from /usr/include/stdlib.h:24:0,\n                 from /usr/include/flint/fmpz.h:37,\n                 from numeric.cpp:52:\n/usr/include/features.h:166:0: note: this is the location of the previous definition\n # define _XOPEN_SOURCE 700\n ^\nnumeric.cpp: In member function \u2018bool GiNaC::numeric::operator<=(const GiNaC::numeric&) const\u2019:\nnumeric.cpp:1996:95: error: \u2018Pynac_PyObj_RichCmp\u2019 was not declared in this scope\n                         return Pynac_PyObj_RichCmp(v._pyobject, right.v._pyobject, Py_LE, \"<=\");\n                                                                                               ^\nnumeric.cpp: In member function \u2018bool GiNaC::numeric::operator>(const GiNaC::numeric&) const\u2019:\nnumeric.cpp:2020:94: error: \u2018Pynac_PyObj_RichCmp\u2019 was not declared in this scope\n                         return Pynac_PyObj_RichCmp(v._pyobject, right.v._pyobject, Py_GT, \">\");\n                                                                                              ^\nnumeric.cpp: In member function \u2018bool GiNaC::numeric::operator>=(const GiNaC::numeric&) const\u2019:\nnumeric.cpp:2044:95: error: \u2018Pynac_PyObj_RichCmp\u2019 was not declared in this scope\n                         return Pynac_PyObj_RichCmp(v._pyobject, right.v._pyobject, Py_GE, \">=\");\n                                                                                               ^\nmake[2]: *** [Makefile:854: libpynac_la-numeric.lo] Error 1\nmake[2]: Leaving directory '/dev/shm/portage/sci-libs/pynac-0.7.7-r1/work/pynac-0.7.7/ginac'\n```\n",
    "created_at": "2017-05-17T00:06:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317385",
    "user": "fbissey"
}
```

Doesn't build for me with the added patch

```
libtool: compile:  x86_64-pc-linux-gnu-g++ -DHAVE_CONFIG_H -I. -I.. -I/usr/include/python2.7 -DSING_NDEBUG -DOM_NDEBUG -DSING_NDEBUG -DOM_NDEBUG -Wall -Wextra -Wshadow -Wnon-virtual-dtor -Wno-unused-parameter -march=native -O2 -pipe -std=gnu++11 -c numeric.cpp  -fPIC -DPIC -o .libs/libpynac_la-numeric.o
In file included from /usr/include/python2.7/Python.h:8:0,
                 from basic.h:26,
                 from numeric.h:49,
                 from numeric.cpp:55:
/usr/include/python2.7/pyconfig.h:1193:0: warning: "_POSIX_C_SOURCE" redefined
 #define _POSIX_C_SOURCE 200112L
 ^
In file included from /usr/include/stdlib.h:24:0,
                 from /usr/include/flint/fmpz.h:37,
                 from numeric.cpp:52:
/usr/include/features.h:225:0: note: this is the location of the previous definition
 # define _POSIX_C_SOURCE 200809L
 ^
In file included from /usr/include/python2.7/Python.h:8:0,
                 from basic.h:26,
                 from numeric.h:49,
                 from numeric.cpp:55:
/usr/include/python2.7/pyconfig.h:1215:0: warning: "_XOPEN_SOURCE" redefined
 #define _XOPEN_SOURCE 600
 ^
In file included from /usr/include/stdlib.h:24:0,
                 from /usr/include/flint/fmpz.h:37,
                 from numeric.cpp:52:
/usr/include/features.h:166:0: note: this is the location of the previous definition
 # define _XOPEN_SOURCE 700
 ^
numeric.cpp: In member function ‘bool GiNaC::numeric::operator<=(const GiNaC::numeric&) const’:
numeric.cpp:1996:95: error: ‘Pynac_PyObj_RichCmp’ was not declared in this scope
                         return Pynac_PyObj_RichCmp(v._pyobject, right.v._pyobject, Py_LE, "<=");
                                                                                               ^
numeric.cpp: In member function ‘bool GiNaC::numeric::operator>(const GiNaC::numeric&) const’:
numeric.cpp:2020:94: error: ‘Pynac_PyObj_RichCmp’ was not declared in this scope
                         return Pynac_PyObj_RichCmp(v._pyobject, right.v._pyobject, Py_GT, ">");
                                                                                              ^
numeric.cpp: In member function ‘bool GiNaC::numeric::operator>=(const GiNaC::numeric&) const’:
numeric.cpp:2044:95: error: ‘Pynac_PyObj_RichCmp’ was not declared in this scope
                         return Pynac_PyObj_RichCmp(v._pyobject, right.v._pyobject, Py_GE, ">=");
                                                                                               ^
make[2]: *** [Makefile:854: libpynac_la-numeric.lo] Error 1
make[2]: Leaving directory '/dev/shm/portage/sci-libs/pynac-0.7.7-r1/work/pynac-0.7.7/ginac'
```




---

archive/issue_comments_317386.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-05-17T01:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317386",
    "user": "fbissey"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_317387.json:
```json
{
    "body": "Yes it looks like you forgot those 3 instances of `Pynac_PyObj_RichCmp` when switching to `PyObject_RichCompareBool`.",
    "created_at": "2017-05-17T01:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317387",
    "user": "fbissey"
}
```

Yes it looks like you forgot those 3 instances of `Pynac_PyObj_RichCmp` when switching to `PyObject_RichCompareBool`.



---

archive/issue_comments_317388.json:
```json
{
    "body": "Somehow I missed part of the patch. Not sure how it happened but it is all there. Sorry for the noise.",
    "created_at": "2017-05-17T02:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317388",
    "user": "fbissey"
}
```

Somehow I missed part of the patch. Not sure how it happened but it is all there. Sorry for the noise.



---

archive/issue_comments_317389.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-05-17T02:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317389",
    "user": "fbissey"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_317390.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-05-21T10:08:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22732#issuecomment-317390",
    "user": "vbraun"
}
```

Resolution: fixed
