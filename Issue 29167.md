# Issue 29167: Fix build failures of pplpy on macos with system python3

Issue created by migration from https://trac.sagemath.org/ticket/29404

Original creator: mkoeppe

Original creation time: 2020-03-25 02:58:16

CC:  dimpase fbissey vdelecroix saraedum isuruf embray

https://github.com/mkoeppe/sage/runs/531095486

pplpy:

```
    g++ -sdk macosx clang -bundle -undefined dynamic_lookup -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -Wl,-rpath,/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/lib -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/include -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/include build/temp.macosx-10.14-x86_64-3.7/ppl/linear_algebra.o build/temp.macosx-10.14-x86_64-3.7/ppl/ppl_shim.o -lgmp -lgmpxx -lppl -lm -o build/lib.macosx-10.14-x86_64-3.7/ppl/linear_algebra.cpython-37m-darwin.so
    clang: error: unknown argument: '-sdk'
    clang: error: no such file or directory: 'macosx'
    clang: error: no such file or directory: 'clang'
    error: command 'g++' failed with exit status 1
    Running setup.py install for pplpy: finished with status 'error'
Cleaning up...
```


pynac:

```
checking whether sage-python23 version is >= 2.7... yes
checking for sage-python23 version... 3.7
checking for sage-python23 platform... darwin
checking for sage-python23 script directory... ${prefix}/lib/python3.7/site-packages
checking for sage-python23 extension module directory... ${exec_prefix}/lib/python3.7/site-packages
checking for style of include used by make... GNU
checking for gcc... gcc
checking whether the C compiler works... yes
checking for C compiler default output file name... a.out
checking for suffix of executables... 
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ISO C89... none needed
checking whether gcc understands -c and -o together... yes
checking dependency style of gcc... none
checking for python3.7... no
configure: error: Cannot find python3.7 in your system path
```



---

Comment by mkoeppe created at 2020-03-25 03:27:46

pynac's python discovery should be fixed, this looks completely broken


---

Comment by dimpase created at 2020-03-25 03:48:50

This should be probably split into two tickets.

pplpy upstream is https://gitlab.com/videlec/pplpy - also in CC:


---

Comment by fbissey created at 2020-03-25 03:51:03

Yes for the split. I am surprised that problem shows now in pynac. I would have expected it to happen much earlier. The AX_PYTHON_DEVEL macro is 5 years old - which probably doesn't help.


---

Comment by fbissey created at 2020-03-25 03:54:16

Note that I don't think the problem is in the macro, but something in there may trigger. I suspect the problem is in `AM_PATH_PYTHON` and that `PYTHON` needs to be defined when calling configure in `spkg-install`.


---

Comment by fbissey created at 2020-03-25 03:58:17

Which is already done. So I am not sure what happens to override it. Access to config.log would be helpful.


---

Comment by mkoeppe created at 2020-03-25 04:02:01

Yes, please go ahead with splitting the ticket.


---

Comment by dimpase created at 2020-03-25 06:22:53

It looks from the log as here could be some mixing up happening between system python3 and Homebrew's python3 (unless Homebrew's python3 is using system's python3 headers by design).


---

Comment by fbissey created at 2020-03-25 06:44:52

Replying to [comment:8 dimpase]:
> It looks from the log as here could be some mixing up happening between system python3 and Homebrew's python3 (unless Homebrew's python3 is using system's python3 headers by design).

Shouldn't happen. We pass `PYTHON=sage-python23` explicitly to configure. That's what should be tested.
https://github.com/sagemath/sage/blob/develop/build/pkgs/pynac/spkg-install.in#L14

My gut feeling is that something funny happened to that line during processing. But I need config.log to establish it.


---

Comment by dimpase created at 2020-03-25 07:05:48

I don't have MacOS machine, but anyone with it may install Homebrew and try.


---

Comment by fbissey created at 2020-03-25 07:23:57

It is more subtle than my implied gut feeling. The macro AX_PYTHON_DEVEL gets the right value for PYTHON and does its stuff based on that. I think `AM_PATH_PYTHON` doesn't like python with exotic names because it looks like it goes through a pre-defined list.


---

Comment by dimpase created at 2020-03-25 07:27:41

isn't the location of Sage's Python exotic enough to choke it, if it were the case?


---

Comment by fbissey created at 2020-03-25 07:43:41

It would be :) 

Code inspection says I have it backwards. `AM_PATH_PYTHON` works and `AX_PYTHON_DEVEL` is the one failing.


---

Comment by fbissey created at 2020-03-25 08:04:22

Toxic. This is with an old sage I have around

```
[pynac-0.7.14] checking whether sage-python23 version is >= 2.7... yes
[pynac-0.7.14] checking for sage-python23 version... 2.7
[pynac-0.7.14] checking for sage-python23 platform... linux2
[pynac-0.7.14] checking for sage-python23 script directory... ${prefix}/lib/python2.7/site-packages
[pynac-0.7.14] checking for sage-python23 extension module directory... ${exec_prefix}/lib/python2.7/site-packages
[pynac-0.7.14] checking for style of include used by make... GNU
[pynac-0.7.14] checking for gcc... gcc
[pynac-0.7.14] checking whether the C compiler works... yes
[pynac-0.7.14] checking for C compiler default output file name... a.out
[pynac-0.7.14] checking for suffix of executables... 
[pynac-0.7.14] checking whether we are cross compiling... no
[pynac-0.7.14] checking for suffix of object files... o
[pynac-0.7.14] checking whether we are using the GNU C compiler... yes
[pynac-0.7.14] checking whether gcc accepts -g... yes
[pynac-0.7.14] checking for gcc option to accept ISO C89... none needed
[pynac-0.7.14] checking whether gcc understands -c and -o together... yes
[pynac-0.7.14] checking dependency style of gcc... gcc3
[pynac-0.7.14] checking for python2.7... /home/fbissey/sagemath/sage/local/bin/python2.7
[pynac-0.7.14] checking for a version of Python >= '2.1.0'... yes
[pynac-0.7.14] checking for the distutils Python package... yes
[pynac-0.7.14] checking for Python include path... -I/home/fbissey/sagemath/sage/local/include/python2.7
[pynac-0.7.14] checking for Python library path... -L/home/fbissey/sagemath/sage/local/lib -lpython2.7
[pynac-0.7.14] checking for Python site-packages path... /home/fbissey/sagemath/sage/local/lib/python2.7/site-packages
```

As you can see, the first test (`AM_PATH_PYTHON`) use `sage-python23` properly. But not the second that goes directly for `pythonX.Y`. Worse, that's by design of the macro.

```
	AC_PATH_PROG([PYTHON],[python[$PYTHON_VERSION]])
	if test -z "$PYTHON"; then
	   AC_MSG_ERROR([Cannot find python$PYTHON_VERSION in your system path])
	   PYTHON_VERSION=""
	fi
```

And for the cherry on the top of the cake, I believe `PYTHON_VERSION` is set by `AM_PATH_PYTHON`. Conclusion `AX_PYTHON_DEVEL` doesn't do exotic python name, and you better have a regular python executable in the PATH. Now, I'd like to know more about that setup that has `sage-python23` in the PATH but not the matching `pythonX.Y`. Did something happen while I wasn't looking?


---

Comment by fbissey created at 2020-03-25 08:07:44

Updating `AX_PYTHON_DEVEL` would still give the same result. There is probably something smarter to do.


---

Comment by fbissey created at 2020-03-25 09:06:27

All the stuff found by `AX_PYTHON_DEVEL` could be found by snipping bits of it and using the results from `AM_PATH_PYTHON`. This is a substantial rewrite of upstream's `configure.ac` that we are looking at. We only need to lift the bits that figure `PYTHON_CPPFLAGS` and `PYTHON_LDFLAGS`  (`PYTHON_LIBS` if lifted from the latest version of `AX_PYTHON_DEVEL`). The rest is provided by `AM_PATH_PYTHON`.


---

Comment by mkoeppe created at 2020-03-25 11:53:42

Replying to [comment:4 fbissey]:
> Yes for the split. I am surprised that problem shows now in pynac. I would have expected it to happen much earlier. The AX_PYTHON_DEVEL macro is 5 years old - which probably doesn't help.
It shows now because this is a test with system python3 (#27824) instead of building sage's own python3. On macOS, there is `/usr/bin/python3` (which is Python 3.7) but no `/usr/bin/python3.7`.


---

Comment by dimpase created at 2020-03-25 14:58:53

would it work with Homebrew's python3 ?
https://formulae.brew.sh/formula/python


Python shipped with MacOS is dodgy, IMHO.


---

Comment by mkoeppe created at 2020-03-25 17:29:01

Replying to [comment:16 fbissey]:
> All the stuff found by `AX_PYTHON_DEVEL` could be found by snipping bits of it and using the results from `AM_PATH_PYTHON`. This is a substantial rewrite of upstream's `configure.ac` that we are looking at. We only need to lift the bits that figure `PYTHON_CPPFLAGS` and `PYTHON_LDFLAGS`  (`PYTHON_LIBS` if lifted from the latest version of `AX_PYTHON_DEVEL`). The rest is provided by `AM_PATH_PYTHON`.

Yes, this sounds like the correct approach.


---

Comment by mkoeppe created at 2020-03-26 02:12:21

Replying to [comment:3 dimpase]:
> This should be probably split into two tickets.
> 
> pplpy upstream is https://gitlab.com/videlec/pplpy - also in CC:

pplpy is now #29408


---

Comment by mkoeppe created at 2020-03-26 02:15:52

Some links for `AX_PYTHON_DEVEL`:
- current version https://github.com/autoconf-archive/autoconf-archive/blob/master/m4/ax_python_devel.m4
- some patch for it https://0xacab.org/schleuder/rpm-gpgme/blob/epel7-schleuder/0001-fix-stupid-ax_python_devel.patch
- replacement using python-config https://trac.macports.org/attachment/ticket/39223/python.m4


---

Comment by dimpase created at 2020-03-26 02:17:31

probably we should try `replacement using python-config`- except that the name should not start with `AC_`...


---

Comment by mkoeppe created at 2020-03-26 02:53:51

... and except that we do not have `sage-python23-config`


---

Comment by fbissey created at 2020-03-26 03:10:33

In the same bag, you could be tempted to use `python-X.Y.pc`, `AM_PATH_PYTHON` identifies the python version correctly. I eliminated it from my solutions yesterday but that may be viable if it is shipped consistently. If not, the `AX_PYTHON_DEVEL` macro just runs python commands to get at sysconfig. It is a fairly valid strategy.


---

Comment by mkoeppe created at 2020-03-26 03:12:24

No python pkgconfig on macOS without homebrew


---

Comment by fbissey created at 2020-03-26 03:14:43

Keep forgetting about that.


---

Comment by fbissey created at 2020-03-26 03:21:01

And on my mac I have python3  but not python-config for it, just python 2.7. So Mac support (without homebrew) needs to probe the python interpreter directly - at the time of writing.


---

Comment by dimpase created at 2020-03-26 03:28:38

let us try with Homebrew Python first. One can always add moar insanity later


---

Comment by fbissey created at 2020-03-26 03:35:28

That's the path of less resistance but I consider `AX_PYTHON_DEVEL` broken (including the latest one) and in need of replacement.


---

Comment by mkoeppe created at 2020-03-26 03:41:26

Replying to [comment:29 dimpase]:
> let us try with Homebrew Python first. One can always add moar insanity later
Nothing try here. We already know precisely how it fails and what needs fixing: the use of that macro.


---

Comment by mkoeppe created at 2020-03-28 04:58:38

I have a first version of a patch for pynac at https://github.com/pynac/pynac/pull/351


---

Comment by mkoeppe created at 2020-03-28 15:12:51

New commits:


---

Comment by mkoeppe created at 2020-03-28 15:16:43

Changing status from new to needs_review.


---

Comment by isuruf created at 2020-03-28 15:30:19

Changing status from needs_review to needs_work.


---

Comment by isuruf created at 2020-03-28 15:30:19

You shouldn't link to the shared python library. If you do, you'll run into https://github.com/pynac/pynac/issues/337


---

Comment by mkoeppe created at 2020-03-28 15:53:37

Help with this is very welcome! I have to work on something else this weekend


---

Comment by git created at 2020-03-29 00:05:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-03-29 00:05:20

Found a moment for this after all


---

Comment by mkoeppe created at 2020-03-29 00:33:52

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2020-03-29 13:47:46

Tests ran at https://github.com/mkoeppe/sage/actions/runs/65556636


---

Comment by mkoeppe created at 2020-03-29 13:51:23

Changing priority from major to critical.


---

Comment by mkoeppe created at 2020-03-29 13:51:23

This seems to work well according to the tests. Needs review!


---

Comment by dimpase created at 2020-03-30 15:22:09

scipy build in macos-homebrew-standard fails with a similar error:

```
2020-03-29T03:07:22.1134510Z     g++ -sdk macosx clang -bundle -undefined dynamic_lookup -bundle -undefined dynamic_lookup -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -Wl,-rpath,/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/lib -D__ACCELERATE__ -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/include -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/include build/temp.macosx-10.14-x86_64-3.7/scipy/interpolate/src/_interpolate.o -Lbuild/temp.macosx-10.14-x86_64-3.7 -o build/lib.macosx-10.14-x86_64-3.7/scipy/interpolate/_interpolate.cpython-37m-darwin.so
2020-03-29T03:07:22.1135020Z     clang: error: unknown argument: '-sdk'
2020-03-29T03:07:22.1135400Z     clang: error: no such file or directory: 'macosx'
2020-03-29T03:07:22.1135790Z     clang: error: no such file or directory: 'clang'
2020-03-29T03:07:22.1137100Z     error: Command "g++ -sdk macosx clang -bundle -undefined dynamic_lookup -bundle -undefined dynamic_lookup -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -Wl,-rpath,/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/lib -D__ACCELERATE__ -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/include -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/include build/temp.macosx-10.14-x86_64-3.7/scipy/interpolate/src/_interpolate.o -Lbuild/temp.macosx-10.14-x86_64-3.7 -o build/lib.macosx-10.14-x86_64-3.7/scipy/interpolate/_interpolate.cpython-37m-darwin.so" failed with exit status 1
2020-03-29T03:07:22.1137680Z     Running setup.py install for scipy: finished with status 'error'
```



---

Comment by dimpase created at 2020-03-30 15:22:09

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2020-03-30 15:41:21

Replying to [comment:44 dimpase]:
> scipy build in macos-homebrew-standard fails with a similar error

Wrong ticket, that's #29408.


---

Comment by mkoeppe created at 2020-03-30 15:41:21

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2020-03-30 15:55:00

what do you mean, wrong ticket? I looked at the test results at comment:42
above (https://github.com/mkoeppe/sage/actions/runs/65556636)


---

Comment by mkoeppe created at 2020-03-30 15:56:43

This ticket is about pynac failing with `configure: error: Cannot find python3.7 in your system path`.


---

Comment by dimpase created at 2020-03-30 16:38:22

OK, this looks good. Sorry for confusion.


---

Comment by dimpase created at 2020-03-30 16:38:22

Changing status from needs_review to positive_review.


---

Comment by isuruf created at 2020-03-30 16:44:14

Changing status from positive_review to needs_work.


---

Comment by isuruf created at 2020-03-30 16:44:14

Thanks for looking into this. This needs more work due to https://github.com/pynac/pynac/pull/351#discussion_r399846249.


---

Comment by mkoeppe created at 2020-03-30 16:46:13

Whether this is good enough for upstream is another question - and one that will not be answered soon.
But the fix works for us.


---

Comment by isuruf created at 2020-03-30 16:47:53

Does it though? I assume that warning gets triggered in osx system python.


---

Comment by mkoeppe created at 2020-03-30 16:49:12

This is using the version with assert, and it's not failing. See logs above.


---

Comment by isuruf created at 2020-03-30 16:56:15

Changing status from needs_work to positive_review.


---

Comment by isuruf created at 2020-03-30 16:56:15

I don't understand how it's going to work, but not going to hold up this ticket.


---

Comment by mkoeppe created at 2020-03-30 17:42:07

Replying to [comment:53 isuruf]:
> I don't understand how it's going to work

Just in case you'd like another look, here's the log from https://github.com/mkoeppe/sage/actions/runs/66127777, logs-commit-3fc71b184bd15f5b10e48334eccb73be63dd3033-tox-local-homebrew-macos-standard.zip .
Note that this is NOT using the change from #29408.

```
pynac-0.7.26.sage-2020-03-28a
====================================================
Setting up build directory for pynac-0.7.26.sage-2020-03-28a
Finished extraction
No patch files found in ../patches
****************************************************
Host system:
Darwin Mac-1306.local 19.3.0 Darwin Kernel Version 19.3.0: Thu Jan  9 20:58:23 PST 2020; root:xnu-6153.81.5~1/RELEASE_X86_64 x86_64
****************************************************
C compiler: x86_64-apple-darwin13.4.0-clang
C compiler version:
clang version 9.0.1 
Target: x86_64-apple-darwin13.4.0
Thread model: posix
InstalledDir: /Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/conda/bin
****************************************************
Package 'pynac' is currently not installed
No legacy uninstaller found for 'pynac'; nothing to do
Starting build...
Running build_pynac...
Configuring pynac-0.7.26.sage-2020-03-28a
...
checking whether sage-python23 version is >= 2.7... yes
checking for sage-python23 version... 3.7
checking for sage-python23 platform... darwin
checking for sage-python23 script directory... ${prefix}/lib/python3.7/site-packages
checking for sage-python23 extension module directory... ${exec_prefix}/lib/python3.7/site-packages
checking for Python preprocessor flags... -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/conda/include/python3.7m -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/conda/include/python3.7m -fno-strict-aliasing -Wsign-compare -Wunreachable-code -DNDEBUG -fwrapv -O3 -Wall -Wstrict-prototypes -march=core2 -mtune=haswell -mssse3 -ftree-vectorize -fPIC -fPIE -fstack-protector-strong -O3 -pipe -fdebug-prefix-map=${SRC_DIR}=/usr/local/src/conda/${PKG_NAME}-${PKG_VERSION} -fdebug-prefix-map=/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/conda=/usr/local/src/conda-prefix -flto -Wl,-export_dynamic -march=core2 -mtune=haswell -mssse3 -ftree-vectorize -fPIC -fPIE -fstack-protector-strong -O3
checking for Python library flags... -bundle -undefined dynamic_lookup -Wl,-pie -Wl,-headerpad_max_install_names -Wl,-dead_strip_dylibs -Wl,-rpath,/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/conda/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/conda/lib -flto -Wl,-export_dynamic -Wl,-pie -Wl,-headerpad_max_install_names -Wl,-dead_strip_dylibs -Wl,-rpath,/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/conda/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/conda/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib -Wl,-rpath,/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib -Wl,-rpath,/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/conda/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/conda/lib -march=core2 -mtune=haswell -mssse3 -ftree-vectorize -fPIC -fPIE -fstack-protector-strong -O2 -pipe -isystem /Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/conda/include -D_FORTIFY_SOURCE=2 -mmacosx-version-min=10.9 -isystem /Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/conda/include
checking build system type... x86_64-apple-darwin19.3.0
```



---

Comment by mkoeppe created at 2020-03-31 14:09:13

Fails on cygwin (https://github.com/mkoeppe/sage/runs/548082943):


```
  [pynac-0.7.26.sage-2020-03-28a]   /cygdrive/d/a/sage/sage/local/var/tmp/sage/build/pynac-0.7.26.sage-2020-03-28a/src/ginac/numeric.cpp:175: undefined reference to `PyErr_Occurred'
  [pynac-0.7.26.sage-2020-03-28a]   /usr/lib/gcc/x86_64-pc-cygwin/9.3.0/../../../../x86_64-pc-cygwin/bin/ld: .libs/libpynac_la-numeric.o:/cygdrive/d/a/sage/sage/local/var/tmp/sage/build/pynac-0.7.26.sage-2020-03-28a/src/ginac/numeric.cpp:502: undefined reference to `PyLong_FromLong'
  [pynac-0.7.26.sage-2020-03-28a]   /usr/lib/gcc/x86_64-pc-cygwin/9.3.0/../../../../x86_64-pc-cygwin/bin/ld: .libs/libpynac_la-numeric.o: in function `__static_initialization_and_destruction_0':
  [pynac-0.7.26.sage-2020-03-28a]   /cygdrive/d/a/sage/sage/local/var/tmp/sage/build/pynac-0.7.26.sage-2020-03-28a/src/ginac/numeric.cpp:503: undefined reference to `PyLong_FromLong'
  [pynac-0.7.26.sage-2020-03-28a]   /usr/lib/gcc/x86_64-pc-cygwin/9.3.0/../../../../x86_64-pc-cygwin/bin/ld: /cygdrive/d/a/sage/sage/local/var/tmp/sage/build/pynac-0.7.26.sage-2020-03-28a/src/ginac/numeric.cpp:504: undefined reference to `PyLong_FromLong'
  [pynac-0.7.26.sage-2020-03-28a]   collect2: error: ld returned 1 exit status
  [pynac-0.7.26.sage-2020-03-28a]   make[6]: *** [Makefile:558: libpynac.la] Error 1
```



---

Comment by mkoeppe created at 2020-03-31 14:14:09

Changing status from positive_review to needs_work.


---

Comment by git created at 2020-04-01 03:10:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-04-01 04:14:19

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2020-04-01 04:14:19

New tests at https://github.com/mkoeppe/sage/runs/550765335 and https://github.com/mkoeppe/sage/actions/runs/67915244


---

Comment by mkoeppe created at 2020-04-03 00:19:11

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-04-03 19:49:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-04-03 20:24:32

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2020-04-03 20:24:32

This fixes the build on cygwin.


---

Comment by dimpase created at 2020-04-04 01:01:47

please squash the commits


---

Comment by git created at 2020-04-04 01:48:00

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2020-04-05 17:18:41

squashed, needs review


---

Comment by mkoeppe created at 2020-04-10 04:27:50

Correct builds can be seen at https://github.com/mkoeppe/sage/actions/runs/74117913


---

Comment by jhpalmieri created at 2020-04-10 18:41:48

It's good on OS X, built with various different Pythons (homebrew, system, Sage).


---

Comment by mkoeppe created at 2020-04-12 00:41:17

Let's get this one into the next beta please


---

Comment by dimpase created at 2020-04-12 00:47:13

looks good.


---

Comment by dimpase created at 2020-04-12 00:47:13

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-04-12 00:55:08

Thanks!


---

Comment by mkoeppe created at 2020-04-15 03:16:34

Changing priority from critical to blocker.


---

Attachment

pynac did not download on Mac OS 10.15.3


---

Comment by @DaveWitteMorris created at 2020-04-15 06:35:06

I apologize if this is noise (I may have messed up my installation somehow), but I thought I should report that I had trouble building pynac in 9.1rc0 on Mac OS 10.15.3, even with this ticket:

```
Attempting to download from https://github.com/mkoeppe/pynac/releases/download/pynac-0.7.26.sage-2020-04-03/pynac-0.7.26.sage-2020-04-03.tar.bz2
[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
ERROR [transfer|run:135]: [Errno socket error] [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1056)
************************************************************************
```

I merged #29408 and this ticket, and ran `make build`, then realized that the description of this ticket has a different make command, so I tried that, too. But pynac did not download. I am attaching the `pynac-0.7.26.sage-2020-04-03.log` log file from the more complicated build command, in case it is of use.

The build went smoothly after I manually downloaded pynac and put it in the upstream directory, so I want to say thanks for these patches! I never would have figured out how to fix the build errors on my own.


---

Comment by dimpase created at 2020-04-15 06:41:56

this might be due to (system) python, more precisely its urllib module, being unable to provide correct certs...

does installing python 3.7 from python.org and also making sure it installs certs (there is a 2nd step in installation, iirc) fixes this?


---

Comment by @DaveWitteMorris created at 2020-04-15 07:53:43

Yes, that solved the problem. After installing python and certifi, pynac downloaded from mkoeppe's directory (and the build succeeded) when I used `make SAGE_SPKG="sage-spkg -o" pynac-clean pynac`. Thanks!


---

Comment by vbraun created at 2020-04-16 22:33:49

Resolution: fixed


---

Comment by mkoeppe created at 2020-06-16 11:41:30

Follow up: #29872
