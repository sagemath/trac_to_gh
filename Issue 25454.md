# Issue 25454: Faster Composition.complement() using naive method

Issue created by migration from https://trac.sagemath.org/ticket/25691

Original creator: mathzeta2

Original creation time: 2018-06-28 15:58:40

Keywords: days94

For compositions of `n` greater than about 55, it seems that the naive method of constructing the complement composition using the difference of sets is faster. This obviously also can affect the conjugate() method.

In the attached branch, I added a "complement_naive" method. Few timings:

```
sage: C = Compositions(20)
sage: A = [C.random_element() for i in range(300)]
sage: %timeit B = [c.complement() for c in A]
100 loops, best of 3: 5.29 ms per loop
sage: %timeit B = [c.complement_naive() for c in A]
100 loops, best of 3: 8.48 ms per loop

sage: C = Compositions(50)
sage: A = [C.random_element() for i in range(300)]
sage: %timeit B = [c.complement() for c in A]
100 loops, best of 3: 10.1 ms per loop
sage: %timeit B = [c.complement_naive() for c in A]
100 loops, best of 3: 10.3 ms per loop

sage: C = Compositions(55)
sage: A = [C.random_element() for i in range(300)]
sage: %timeit B = [c.complement() for c in A]
100 loops, best of 3: 10.9 ms per loop
sage: %timeit B = [c.complement_naive() for c in A]
100 loops, best of 3: 10.5 ms per loop

sage: C = Compositions(100)
sage: A = [C.random_element() for i in range(200)]
sage: %timeit B = [c.complement() for c in A]
100 loops, best of 3: 12.6 ms per loop
sage: %timeit B = [c.complement_naive() for c in A]
100 loops, best of 3: 8.44 ms per loop

sage: C = Compositions(200)
sage: A = [C.random_element() for i in range(300)]
sage: %timeit B = [c.complement() for c in A]
10 loops, best of 3: 39.8 ms per loop
sage: %timeit B = [c.complement_naive() for c in A]
100 loops, best of 3: 17.2 ms per loop

sage: C = Compositions(1000)
sage: A = [C.random_element() for i in range(300)]
sage: %timeit B = [c.complement() for c in A]
1 loop, best of 3: 396 ms per loop
sage: %timeit B = [c.complement_naive() for c in A]
10 loops, best of 3: 59.9 ms per loop
```


This happens probably because a random composition of `n` have "many" small parts


---

Comment by mathzeta2 created at 2018-06-28 16:03:06

Changing status from new to needs_info.


---

Comment by mathzeta2 created at 2018-06-29 13:42:15

Changing status from needs_info to needs_work.
