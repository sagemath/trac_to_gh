# Issue 32307: Meta-ticket: Fix unstable doctests detected after #29935

archive/issues_032307.json:
```json
{
    "body": "- #32543: Mark unstable tests due do #29956.\n\nIssue created by migration from https://trac.sagemath.org/ticket/32544\n\n",
    "created_at": "2021-09-21T06:34:28Z",
    "labels": [
        "doctest framework",
        "major",
        "enhancement"
    ],
    "title": "Meta-ticket: Fix unstable doctests detected after #29935",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32307",
    "user": "@kliem"
}
```
- #32543: Mark unstable tests due do #29956.

Issue created by migration from https://trac.sagemath.org/ticket/32544





---

archive/issue_comments_461196.json:
```json
{
    "body": "I see failures\n\n```\n./sage -t --long --warn-long 101.7 --random-seed=260367842280804525169259077536186393366 src/sage/modular/modform/numerical.py\n```\n\nIn detail\n\n```\nDoctesting 1 file.\nsage -t --long --warn-long 101.7 --random-seed=260367842280804525169259077536186393366 src/sage/modular/modform/numerical.py\n**********************************************************************\nFile \"src/sage/modular/modform/numerical.py\", line 74, in sage.modular.modform.numerical.NumericalEigenforms\nFailed example:\n    n.ap(2)  # rel tol 2e-14\nExpected:\n    [3.0, -1.6180339887498947, 0.6180339887498968]\nGot:\n    [3.0, -1.6180339887498947, 0.6180339887498804]\nTolerance exceeded in 1 of 3:\n    0.6180339887498968 vs 0.6180339887498804, tolerance 3e-14 > 2e-14\n**********************************************************************\nFile \"src/sage/modular/modform/numerical.py\", line 76, in sage.modular.modform.numerical.NumericalEigenforms\nFailed example:\n    n.systems_of_eigenvalues(7)  # rel tol 2e-14\nExpected:\n    [\n    [-1.6180339887498947, 2.2360679774997894, -3.2360679774997894],\n    [0.6180339887498968, -2.236067977499788, 1.2360679774997936],\n    [3.0, 4.0, 6.0]\n    ]\nGot:\n    [\n    [-1.6180339887498947, 2.2360679774997894, -3.2360679774997894],\n    [0.6180339887498804, -2.2360679774998293, 1.2360679774997607],\n    [3.0, 4.0, 6.0]\n    ]\nTolerance exceeded in 2 of 9:\n    0.6180339887498968 vs 0.6180339887498804, tolerance 3e-14 > 2e-14\n    1.2360679774997936 vs 1.2360679774997607, tolerance 3e-14 > 2e-14\n**********************************************************************\nFile \"src/sage/modular/modform/numerical.py\", line 88, in sage.modular.modform.numerical.NumericalEigenforms\nFailed example:\n    n.eigenvalues([2,3,5])  # rel tol 2e-14\nExpected:\n    [[3.0, -1.6180339887498947, 0.6180339887498968],\n     [4.0, 2.2360679774997894, -2.236067977499788],\n     [6.0, -3.2360679774997894, 1.2360679774997936]]\nGot:\n    [[3.0, -1.6180339887498947, 0.6180339887498804],\n     [4.0, 2.2360679774997894, -2.2360679774998293],\n     [6.0, -3.2360679774997894, 1.2360679774997607]]\nTolerance exceeded in 2 of 9:\n    0.6180339887498968 vs 0.6180339887498804, tolerance 3e-14 > 2e-14\n    1.2360679774997936 vs 1.2360679774997607, tolerance 3e-14 > 2e-14\n**********************************************************************\n1 item had failures:\n   3 of   7 in sage.modular.modform.numerical.NumericalEigenforms\n    [46 tests, 3 failures, 0.26 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 101.7 --random-seed=260367842280804525169259077536186393366 src/sage/modular/modform/numerical.py  # 3 doctests failed\n```\n",
    "created_at": "2021-10-24T16:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32307#issuecomment-461196",
    "user": "jhpalmieri"
}
```

I see failures

```
./sage -t --long --warn-long 101.7 --random-seed=260367842280804525169259077536186393366 src/sage/modular/modform/numerical.py
```

In detail

```
Doctesting 1 file.
sage -t --long --warn-long 101.7 --random-seed=260367842280804525169259077536186393366 src/sage/modular/modform/numerical.py
**********************************************************************
File "src/sage/modular/modform/numerical.py", line 74, in sage.modular.modform.numerical.NumericalEigenforms
Failed example:
    n.ap(2)  # rel tol 2e-14
Expected:
    [3.0, -1.6180339887498947, 0.6180339887498968]
Got:
    [3.0, -1.6180339887498947, 0.6180339887498804]
Tolerance exceeded in 1 of 3:
    0.6180339887498968 vs 0.6180339887498804, tolerance 3e-14 > 2e-14
**********************************************************************
File "src/sage/modular/modform/numerical.py", line 76, in sage.modular.modform.numerical.NumericalEigenforms
Failed example:
    n.systems_of_eigenvalues(7)  # rel tol 2e-14
Expected:
    [
    [-1.6180339887498947, 2.2360679774997894, -3.2360679774997894],
    [0.6180339887498968, -2.236067977499788, 1.2360679774997936],
    [3.0, 4.0, 6.0]
    ]
Got:
    [
    [-1.6180339887498947, 2.2360679774997894, -3.2360679774997894],
    [0.6180339887498804, -2.2360679774998293, 1.2360679774997607],
    [3.0, 4.0, 6.0]
    ]
Tolerance exceeded in 2 of 9:
    0.6180339887498968 vs 0.6180339887498804, tolerance 3e-14 > 2e-14
    1.2360679774997936 vs 1.2360679774997607, tolerance 3e-14 > 2e-14
**********************************************************************
File "src/sage/modular/modform/numerical.py", line 88, in sage.modular.modform.numerical.NumericalEigenforms
Failed example:
    n.eigenvalues([2,3,5])  # rel tol 2e-14
Expected:
    [[3.0, -1.6180339887498947, 0.6180339887498968],
     [4.0, 2.2360679774997894, -2.236067977499788],
     [6.0, -3.2360679774997894, 1.2360679774997936]]
Got:
    [[3.0, -1.6180339887498947, 0.6180339887498804],
     [4.0, 2.2360679774997894, -2.2360679774998293],
     [6.0, -3.2360679774997894, 1.2360679774997607]]
Tolerance exceeded in 2 of 9:
    0.6180339887498968 vs 0.6180339887498804, tolerance 3e-14 > 2e-14
    1.2360679774997936 vs 1.2360679774997607, tolerance 3e-14 > 2e-14
**********************************************************************
1 item had failures:
   3 of   7 in sage.modular.modform.numerical.NumericalEigenforms
    [46 tests, 3 failures, 0.26 s]
----------------------------------------------------------------------
sage -t --long --warn-long 101.7 --random-seed=260367842280804525169259077536186393366 src/sage/modular/modform/numerical.py  # 3 doctests failed
```




---

archive/issue_comments_461197.json:
```json
{
    "body": "\n```\nsage -t --long --random-seed=180924489930967511277954046005685261728 src/sage/graphs/base/sparse_graph.pyx\n**********************************************************************\nFile \"src/sage/graphs/base/sparse_graph.pyx\", line 1163, in sage.graphs.base.sparse_graph._test_adjacency_sequence_out\nFailed example:\n    _test_adjacency_sequence_out()  # long time\nException raised:\n    Traceback (most recent call last):\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.base.sparse_graph._test_adjacency_sequence_out[1]>\", line 1, in <module>\n        _test_adjacency_sequence_out()  # long time\n      File \"sage/graphs/base/sparse_graph.pyx\", line 1189, in sage.graphs.base.sparse_graph._test_adjacency_sequence_out (build/cythonized/sage/graphs/base/sparse_graph.c:9302)\n        u = randint(low, n - 1)\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/misc/prandom.py\", line 137, in randint\n        return _pyrand().randint(a, b)\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/cpython/_py2_random.py\", line 220, in randint\n        return self.randrange(a, b+1)\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/cpython/_py2_random.py\", line 195, in randrange\n        raise ValueError(\"empty range for randrange() (%d,%d, %d)\" %\n    ValueError: empty range for randrange() (0,0, 0)\n```\n\n\n```\nsage -t --long --random-seed=180924489930967511277954046005685261728 src/sage/graphs/generators/families.py\n**********************************************************************\nFile \"src/sage/graphs/generators/families.py\", line 1477, in sage.graphs.generators.families.FriendshipGraph\nFailed example:\n    G.diameter()\nExpected:\n    2\nGot:\n    1\n```\n",
    "created_at": "2021-10-26T07:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32307#issuecomment-461197",
    "user": "@kliem"
}
```


```
sage -t --long --random-seed=180924489930967511277954046005685261728 src/sage/graphs/base/sparse_graph.pyx
**********************************************************************
File "src/sage/graphs/base/sparse_graph.pyx", line 1163, in sage.graphs.base.sparse_graph._test_adjacency_sequence_out
Failed example:
    _test_adjacency_sequence_out()  # long time
Exception raised:
    Traceback (most recent call last):
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.base.sparse_graph._test_adjacency_sequence_out[1]>", line 1, in <module>
        _test_adjacency_sequence_out()  # long time
      File "sage/graphs/base/sparse_graph.pyx", line 1189, in sage.graphs.base.sparse_graph._test_adjacency_sequence_out (build/cythonized/sage/graphs/base/sparse_graph.c:9302)
        u = randint(low, n - 1)
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/misc/prandom.py", line 137, in randint
        return _pyrand().randint(a, b)
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/cpython/_py2_random.py", line 220, in randint
        return self.randrange(a, b+1)
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/cpython/_py2_random.py", line 195, in randrange
        raise ValueError("empty range for randrange() (%d,%d, %d)" %
    ValueError: empty range for randrange() (0,0, 0)
```


```
sage -t --long --random-seed=180924489930967511277954046005685261728 src/sage/graphs/generators/families.py
**********************************************************************
File "src/sage/graphs/generators/families.py", line 1477, in sage.graphs.generators.families.FriendshipGraph
Failed example:
    G.diameter()
Expected:
    2
Got:
    1
```




---

archive/issue_comments_461198.json:
```json
{
    "body": "\n```\nsage -t --long --random-seed=23747002002644886606785003174022326205 src/sage/modules/free_module_integer.py\n**********************************************************************\nFile \"src/sage/modules/free_module_integer.py\", line 370, in sage.modules.free_module_integer.FreeModule_submodule_with_basis_integer.LLL\nFailed example:\n    new_min <= old_min\nExpected:\n    True\nGot:\n    False\n\nsage -t --long --random-seed=23747002002644886606785003174022326205 src/sage/schemes/toric/sheaf/klyachko.py\n**********************************************************************\nFile \"src/sage/schemes/toric/sheaf/klyachko.py\", line 951, in sage.schemes.toric.sheaf.klyachko.KlyachkoBundle_class.random_deformation\nFailed example:\n    Vtilde.cohomology(dim=True, weight=(0,))\nExpected:\n    (1, 0)\nGot:\n    (0, 0)\n```\n",
    "created_at": "2021-10-26T07:42:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32307#issuecomment-461198",
    "user": "@kliem"
}
```


```
sage -t --long --random-seed=23747002002644886606785003174022326205 src/sage/modules/free_module_integer.py
**********************************************************************
File "src/sage/modules/free_module_integer.py", line 370, in sage.modules.free_module_integer.FreeModule_submodule_with_basis_integer.LLL
Failed example:
    new_min <= old_min
Expected:
    True
Got:
    False

sage -t --long --random-seed=23747002002644886606785003174022326205 src/sage/schemes/toric/sheaf/klyachko.py
**********************************************************************
File "src/sage/schemes/toric/sheaf/klyachko.py", line 951, in sage.schemes.toric.sheaf.klyachko.KlyachkoBundle_class.random_deformation
Failed example:
    Vtilde.cohomology(dim=True, weight=(0,))
Expected:
    (1, 0)
Got:
    (0, 0)
```




---

archive/issue_comments_461199.json:
```json
{
    "body": "\n```\nsage -t --long --random-seed=77478494819088915365500074763386376542 src/sage/rings/continued_fraction.py\n**********************************************************************\nFile \"src/sage/rings/continued_fraction.py\", line 265, in sage.rings.continued_fraction.rat_interval_cf_list\nFailed example:\n    for prec in range(10,54):\n        R = RealIntervalField(20)\n        for _ in range(100):\n            x = R.random_element() * R.random_element() + R.random_element() / 100\n            l = x.lower().exact_rational()\n            u = x.upper().exact_rational()\n            cf = rat_interval_cf_list(l,u)\n            a = continued_fraction(cf).value()\n            b = continued_fraction(cf+[1]).value()\n            if a > b:\n                a,b = b,a\n            assert a <= l\n            assert b >= u\nException raised:\n    Traceback (most recent call last):\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.continued_fraction.rat_interval_cf_list[2]>\", line 8, in <module>\n        a = continued_fraction(cf).value()\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/rings/continued_fraction.py\", line 2625, in continued_fraction\n        x1, x2 = check_and_reduce_pair(x)\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/rings/continued_fraction.py\", line 2254, in check_and_reduce_pair\n        raise ValueError(\"continued fraction can not represent infinity\")\n    ValueError: continued fraction can not represent infinity\n**********************************************************************\n1 item had failures:\n   1 of   4 in sage.rings.continued_fraction.rat_interval_cf_list\n    [437 tests, 1 failure, 5.09 s]\n-------------------------------------------------------------\n```\n",
    "created_at": "2021-10-26T08:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32307#issuecomment-461199",
    "user": "@kliem"
}
```


```
sage -t --long --random-seed=77478494819088915365500074763386376542 src/sage/rings/continued_fraction.py
**********************************************************************
File "src/sage/rings/continued_fraction.py", line 265, in sage.rings.continued_fraction.rat_interval_cf_list
Failed example:
    for prec in range(10,54):
        R = RealIntervalField(20)
        for _ in range(100):
            x = R.random_element() * R.random_element() + R.random_element() / 100
            l = x.lower().exact_rational()
            u = x.upper().exact_rational()
            cf = rat_interval_cf_list(l,u)
            a = continued_fraction(cf).value()
            b = continued_fraction(cf+[1]).value()
            if a > b:
                a,b = b,a
            assert a <= l
            assert b >= u
Exception raised:
    Traceback (most recent call last):
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.continued_fraction.rat_interval_cf_list[2]>", line 8, in <module>
        a = continued_fraction(cf).value()
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/rings/continued_fraction.py", line 2625, in continued_fraction
        x1, x2 = check_and_reduce_pair(x)
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/rings/continued_fraction.py", line 2254, in check_and_reduce_pair
        raise ValueError("continued fraction can not represent infinity")
    ValueError: continued fraction can not represent infinity
**********************************************************************
1 item had failures:
   1 of   4 in sage.rings.continued_fraction.rat_interval_cf_list
    [437 tests, 1 failure, 5.09 s]
-------------------------------------------------------------
```




---

archive/issue_comments_461200.json:
```json
{
    "body": "Created tickets for reported failures so far.",
    "created_at": "2021-10-26T09:48:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32307#issuecomment-461200",
    "user": "@kliem"
}
```

Created tickets for reported failures so far.



---

archive/issue_comments_461201.json:
```json
{
    "body": "Seen in https://patchbot.sagemath.org/log/32777/Linux/1_SMP_Debian_5.10.70-1_(2021-09-30)/x86_64/5.10.0-9-amd64/tmonteil-lxc1/2021-10-27%2001:20:12\n\n```\nsage -t --long --random-seed=321172385432269463934777057410284981568 src/sage/rings/polynomial/multi_polynomial_ring_base.pyx\n**********************************************************************\nFile \"src/sage/rings/polynomial/multi_polynomial_ring_base.pyx\", line 994, in sage.rings.polynomial.multi_polynomial_ring_base.MPolynomialRing_base.random_element\nFailed example:\n    len(list(f))\nExpected:\n    1\nGot:\n    0\n```\n",
    "created_at": "2021-10-28T05:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32307#issuecomment-461201",
    "user": "mkoeppe"
}
```

Seen in https://patchbot.sagemath.org/log/32777/Linux/1_SMP_Debian_5.10.70-1_(2021-09-30)/x86_64/5.10.0-9-amd64/tmonteil-lxc1/2021-10-27%2001:20:12

```
sage -t --long --random-seed=321172385432269463934777057410284981568 src/sage/rings/polynomial/multi_polynomial_ring_base.pyx
**********************************************************************
File "src/sage/rings/polynomial/multi_polynomial_ring_base.pyx", line 994, in sage.rings.polynomial.multi_polynomial_ring_base.MPolynomialRing_base.random_element
Failed example:
    len(list(f))
Expected:
    1
Got:
    0
```




---

archive/issue_comments_461202.json:
```json
{
    "body": "From https://patchbot.sagemath.org/log/32762/Linux/1_SMP_Debian_5.10.70-1_(2021-09-30)/x86_64/5.10.0-9-amd64/tmonteil-lxc1/2021-10-25%2015:13:58\n\n```\nsage -t --long --random-seed=324642231642420052385517156149041216749 src/sage/dynamics/arithmetic_dynamics/projective_ds.py\n**********************************************************************\nFile \"src/sage/dynamics/arithmetic_dynamics/projective_ds.py\", line 7076, in sage.dynamics.arithmetic_dynamics.projective_ds.?.conjugating_set\nFailed example:\n    D6.conjugating_set(D6)\nExpected:\n    [\n    [1 0]  [0 1]  [0 2]  [4 0]  [2 0]  [0 4]\n    [0 1], [1 0], [1 0], [0 1], [0 1], [1 0]\n    ]\nGot:\n    [\n    [4 0]  [2 0]  [0 4]  [1 0]  [0 1]  [0 2]\n    [0 1], [0 1], [1 0], [0 1], [1 0], [1 0]\n    ]\n```\n",
    "created_at": "2021-10-28T06:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32307#issuecomment-461202",
    "user": "mkoeppe"
}
```

From https://patchbot.sagemath.org/log/32762/Linux/1_SMP_Debian_5.10.70-1_(2021-09-30)/x86_64/5.10.0-9-amd64/tmonteil-lxc1/2021-10-25%2015:13:58

```
sage -t --long --random-seed=324642231642420052385517156149041216749 src/sage/dynamics/arithmetic_dynamics/projective_ds.py
**********************************************************************
File "src/sage/dynamics/arithmetic_dynamics/projective_ds.py", line 7076, in sage.dynamics.arithmetic_dynamics.projective_ds.?.conjugating_set
Failed example:
    D6.conjugating_set(D6)
Expected:
    [
    [1 0]  [0 1]  [0 2]  [4 0]  [2 0]  [0 4]
    [0 1], [1 0], [1 0], [0 1], [0 1], [1 0]
    ]
Got:
    [
    [4 0]  [2 0]  [0 4]  [1 0]  [0 1]  [0 2]
    [0 1], [0 1], [1 0], [0 1], [1 0], [1 0]
    ]
```




---

archive/issue_comments_461203.json:
```json
{
    "body": "Created tickets for reported failures so far.",
    "created_at": "2021-11-03T10:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32307#issuecomment-461203",
    "user": "@kliem"
}
```

Created tickets for reported failures so far.



---

archive/issue_comments_461204.json:
```json
{
    "body": "See also this discussion:\n\n- [sage-devel, 2021-12, What's the plan for random doctests with floating point numbers?](https://groups.google.com/g/sage-devel/c/3G6Y-D4mTaI)",
    "created_at": "2021-12-29T22:55:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32307#issuecomment-461204",
    "user": "slelievre"
}
```

See also this discussion:

- [sage-devel, 2021-12, What's the plan for random doctests with floating point numbers?](https://groups.google.com/g/sage-devel/c/3G6Y-D4mTaI)



---

archive/issue_comments_461205.json:
```json
{
    "body": "bump to 9.6",
    "created_at": "2022-01-29T08:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32307#issuecomment-461205",
    "user": "chapoton"
}
```

bump to 9.6



---

archive/issue_comments_461206.json:
```json
{
    "body": "2 random errors with 9.7.beta5 (both macOS and fedora):\n\n```\nsage -t --long --random-seed=224943010850339078223674527953664126031 src/sage/plot/plot.py\n**********************************************************************\nFile \"src/sage/plot/plot.py\", line 1819, in sage.plot.plot.plot\nFailed example:\n    plot(f, (x, -3.5, 3.5), detect_poles='show', exclude=[-3..3], ymin=-5, ymax=5)\nExpected:\n    Graphics object consisting of 12 graphics primitives\nGot:\n    Graphics object consisting of 13 graphics primitives\n```\n\nand\n\n```\nsage -t --long --random-seed=224943010850339078223674527953664126031 src/sage/schemes/toric/sheaf/klyachko.py\n**********************************************************************\nFile \"src/sage/schemes/toric/sheaf/klyachko.py\", line 951, in sage.schemes.toric.sheaf.klyachko.KlyachkoBundle_class.random_deformation\nFailed example:\n    Vtilde.cohomology(dim=True, weight=(0,))\nExpected:\n    (1, 0)\nGot:\n    (0, 0)\n```\n",
    "created_at": "2022-07-20T11:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32307#issuecomment-461206",
    "user": "dcoudert"
}
```

2 random errors with 9.7.beta5 (both macOS and fedora):

```
sage -t --long --random-seed=224943010850339078223674527953664126031 src/sage/plot/plot.py
**********************************************************************
File "src/sage/plot/plot.py", line 1819, in sage.plot.plot.plot
Failed example:
    plot(f, (x, -3.5, 3.5), detect_poles='show', exclude=[-3..3], ymin=-5, ymax=5)
Expected:
    Graphics object consisting of 12 graphics primitives
Got:
    Graphics object consisting of 13 graphics primitives
```

and

```
sage -t --long --random-seed=224943010850339078223674527953664126031 src/sage/schemes/toric/sheaf/klyachko.py
**********************************************************************
File "src/sage/schemes/toric/sheaf/klyachko.py", line 951, in sage.schemes.toric.sheaf.klyachko.KlyachkoBundle_class.random_deformation
Failed example:
    Vtilde.cohomology(dim=True, weight=(0,))
Expected:
    (1, 0)
Got:
    (0, 0)
```




---

archive/issue_comments_461207.json:
```json
{
    "body": "The failures in comment:29 already have tickets: the plot failure is #33129 and the Vtilde.cohomology failure is #32773 (which is already in the ticket description). So I added #33129 to the ticket description.",
    "created_at": "2022-07-20T17:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32307#issuecomment-461207",
    "user": "@DaveWitteMorris"
}
```

The failures in comment:29 already have tickets: the plot failure is #33129 and the Vtilde.cohomology failure is #32773 (which is already in the ticket description). So I added #33129 to the ticket description.



---

archive/issue_comments_461208.json:
```json
{
    "body": "\n```\nsage -t --random-seed=124699541928353137721504742146487601068 src/sage/graphs/generators/random.py\n**********************************************************************\nFile \"src/sage/graphs/generators/random.py\", line 817, in sage.graphs.generators.random.RandomHolmeKim\nFailed example:\n    G.subgraph_search(C3)\nExpected:\n    Subgraph of (): Graph on 3 vertices\nGot:\n    <BLANKLINE>\n**********************************************************************\n1 item had failures:\n   1 of   6 in sage.graphs.generators.random.RandomHolmeKim\n    [197 tests, 1 failure, 1.92 s]\n```\n",
    "created_at": "2022-09-11T04:22:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32307#issuecomment-461208",
    "user": "mkoeppe"
}
```


```
sage -t --random-seed=124699541928353137721504742146487601068 src/sage/graphs/generators/random.py
**********************************************************************
File "src/sage/graphs/generators/random.py", line 817, in sage.graphs.generators.random.RandomHolmeKim
Failed example:
    G.subgraph_search(C3)
Expected:
    Subgraph of (): Graph on 3 vertices
Got:
    <BLANKLINE>
**********************************************************************
1 item had failures:
   1 of   6 in sage.graphs.generators.random.RandomHolmeKim
    [197 tests, 1 failure, 1.92 s]
```




---

archive/issue_comments_461209.json:
```json
{
    "body": "This doctest checks for the existence of a triangle in `graphs.RandomHolmeKim(8, 2, 0.5)`.  To reduce the probability of getting a triangle free graph, we can go for a larger graph, or simply mark this test as random.",
    "created_at": "2022-09-11T10:56:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32307#issuecomment-461209",
    "user": "dcoudert"
}
```

This doctest checks for the existence of a triangle in `graphs.RandomHolmeKim(8, 2, 0.5)`.  To reduce the probability of getting a triangle free graph, we can go for a larger graph, or simply mark this test as random.



---

archive/issue_comments_461210.json:
```json
{
    "body": "It's fine with me to mark this test as random, but I think it might be better to delete it, because it doesn't seem to be providing a very meaningful test of the Holme-Kim algorithm. (I am -1 on enlarging the graph or increasing the probability of triangle-formation.) Even if 0.5 is changed to 0 (which I think means that the triangle-formation step is being skipped), the graph still has at least one triangle with high probability.\n\n```\nsage: count = sum(graphs.RandomHolmeKim(8, 2, 0).triangles_count() > 0 for _ in range(1000))\nsage: print(f\"{round(count/10,1)}% of the graphs have at least one triangle\")\n99.1% of the graphs have at least one triangle\nsage: [graphs.RandomHolmeKim(8, 2, 0).triangles_count() for _ in range(10)]\n[4, 4, 3, 4, 3, 4, 3, 2, 2, 3]\n```\n\nIdeally, we would have a better test that the algorithm is working correctly, but I don't have any suggestions.",
    "created_at": "2022-09-11T17:37:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32307#issuecomment-461210",
    "user": "@DaveWitteMorris"
}
```

It's fine with me to mark this test as random, but I think it might be better to delete it, because it doesn't seem to be providing a very meaningful test of the Holme-Kim algorithm. (I am -1 on enlarging the graph or increasing the probability of triangle-formation.) Even if 0.5 is changed to 0 (which I think means that the triangle-formation step is being skipped), the graph still has at least one triangle with high probability.

```
sage: count = sum(graphs.RandomHolmeKim(8, 2, 0).triangles_count() > 0 for _ in range(1000))
sage: print(f"{round(count/10,1)}% of the graphs have at least one triangle")
99.1% of the graphs have at least one triangle
sage: [graphs.RandomHolmeKim(8, 2, 0).triangles_count() for _ in range(10)]
[4, 4, 3, 4, 3, 4, 3, 2, 2, 3]
```

Ideally, we would have a better test that the algorithm is working correctly, but I don't have any suggestions.



---

archive/issue_comments_461211.json:
```json
{
    "body": "I opened #34520. I agree that it's better to completely remove the doctest and I don't have better tests in mind yet.",
    "created_at": "2022-09-11T17:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32307#issuecomment-461211",
    "user": "dcoudert"
}
```

I opened #34520. I agree that it's better to completely remove the doctest and I don't have better tests in mind yet.



---

archive/issue_comments_461212.json:
```json
{
    "body": "with sage 9.8.beta3\n\n```\nsage -t --long --warn-long 41.8 --random-seed=133497414867200611466007568756298202280 src/sage/homology/tests.py\n**********************************************************************\nFile \"src/sage/homology/tests.py\", line 50, in sage.homology.tests.random_chain_complex\nFailed example:\n    C\nExpected:\n    Chain complex with at most ... nonzero terms over Integer Ring\nGot:\n    Trivial chain complex over Integer Ring\n**********************************************************************\nFile \"src/sage/homology/tests.py\", line 52, in sage.homology.tests.random_chain_complex\nFailed example:\n    len(C.nonzero_degrees()) in [1, 2]\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n```\n",
    "created_at": "2022-11-19T13:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32307#issuecomment-461212",
    "user": "dcoudert"
}
```

with sage 9.8.beta3

```
sage -t --long --warn-long 41.8 --random-seed=133497414867200611466007568756298202280 src/sage/homology/tests.py
**********************************************************************
File "src/sage/homology/tests.py", line 50, in sage.homology.tests.random_chain_complex
Failed example:
    C
Expected:
    Chain complex with at most ... nonzero terms over Integer Ring
Got:
    Trivial chain complex over Integer Ring
**********************************************************************
File "src/sage/homology/tests.py", line 52, in sage.homology.tests.random_chain_complex
Failed example:
    len(C.nonzero_degrees()) in [1, 2]
Expected:
    True
Got:
    False
**********************************************************************
```




---

archive/issue_comments_461213.json:
```json
{
    "body": "Replying to [comment:36 David Coudert]:\n> with sage 9.8.beta3\n> {{{\n> sage -t --long --warn-long 41.8 --random-seed=133497414867200611466007568756298202280 src/sage/homology/tests.py\n> **********************************************************************\n> File \"src/sage/homology/tests.py\", line 50, in sage.homology.tests.random_chain_complex\n> Failed example:\n>     C\n> Expected:\n>     Chain complex with at most ... nonzero terms over Integer Ring\n> Got:\n>     Trivial chain complex over Integer Ring\n> **********************************************************************\n> File \"src/sage/homology/tests.py\", line 52, in sage.homology.tests.random_chain_complex\n> Failed example:\n>     len(C.nonzero_degrees()) in [1, 2]\n> Expected:\n>     True\n> Got:\n>     False\n> **********************************************************************\n> }}}\n\nI have a fix in #34762.",
    "created_at": "2022-11-19T19:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32307#issuecomment-461213",
    "user": "jhpalmieri"
}
```

Replying to [comment:36 David Coudert]:
> with sage 9.8.beta3
> {{{
> sage -t --long --warn-long 41.8 --random-seed=133497414867200611466007568756298202280 src/sage/homology/tests.py
> **********************************************************************
> File "src/sage/homology/tests.py", line 50, in sage.homology.tests.random_chain_complex
> Failed example:
>     C
> Expected:
>     Chain complex with at most ... nonzero terms over Integer Ring
> Got:
>     Trivial chain complex over Integer Ring
> **********************************************************************
> File "src/sage/homology/tests.py", line 52, in sage.homology.tests.random_chain_complex
> Failed example:
>     len(C.nonzero_degrees()) in [1, 2]
> Expected:
>     True
> Got:
>     False
> **********************************************************************
> }}}

I have a fix in #34762.
