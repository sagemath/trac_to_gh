# Issue 16065: "sage -tp 4 --all --long --optional=sage,internet"  fails with 14 modules

Issue created by migration from Trac.

Original creator: wluebbe

Original creation time: 2014-05-07 11:48:04

CC:  slabbe

Testing with `optional=sage,internet` fails with 14 modules on Sage 6.2 (and before):
The analysis should be documented in the comments.
|   |                    |      |
|---|--------------------|------|
|Nbr|Module and failures |Status|
|1|src/doc/en/bordeaux_2007/modular_forms_and_hecke_operators.rst  # 1 doctest failed |open|
|2|src/doc/en/developer/coding_basics.rst  # 1 doctest failed |open|
|3|src/sage/combinat/sloane_functions.py  # 1 doctest failed |open|
|4|src/sage/combinat/species/library.py  # 4 doctests failed |open|
|5|src/sage/combinat/tutorial.py  # 1 doctest failed |open|
|6|src/sage/combinat/words/paths.py  # 1 doctest failed |open|
|7|src/sage/databases/oeis.py  # 15 doctests failed |#16252|
|8|src/sage/dev/digest_transport.py  # 1 doctest failed |open|
|9|src/sage/dev/patch.py  # 3 doctests failed |open|
|10|src/sage/dev/sagedev.py  # 2 doctests failed |open|
|11|src/sage/dev/trac_interface.py  # 5 doctests failed |open|
|12|src/sage/finance/stock.py  # 11 doctests failed |open|
|13|src/sage/misc/package.py  # 1 doctest failed |open|
|14|src/sage/misc/preparser.py  # 1 doctest failed |open|

Fixes as separate ticket (please reference them in the //status// column) or in this ticket (if appropriate).


---

Comment by wluebbe created at 2014-05-07 12:59:17

Output from the failed doctests


---

Attachment

* <1> Changed `http://oeis.org/` response: a blank was removed.
* <2> `sloane_sequence(60843)` is called. This should be adapted to `DeprecationWarning: The function sloane_sequence is deprecated. Use oeis() instead (2012-01-01). See http://trac.sagemath.org/10358 for details.`. - The module `sloane.py` is no more suitable to illustrate the point in `coding_basics.rst` lines 790 - 810 (2 different optional PKGNAMEs in one module).
* <3> Apparently OEIS A111775 was changed to offset=1 while the Sage function is still initialized with offset=0.
* <4> `TypeError: 'NoneType' object has no attribute '__getitem__'` was raised in all 4 failures (after calling `oeis(seq)[0]`). 
  Testing the examples at a `sage:` prompt is successful while the doctest fails reproducible. Hmm ...?
* <5> Changed `http://oeis.org/` response. Expected response should be adapted.
* <6> The expected response appears pretty printed (just as at the `sage:` prompt!) but the doctest response is a single line! How comes? Should the expected response be changed to a single line?
* <7> is caused by changed `http://oeis.org/` responses that do not match the (old) expected results. This is addressed by #16252.
* <8> The expected response appears pretty printed (just as at the `sage:` prompt!) but the doctest response is a single line! See also <6>.
* <9> 1. failure: Looks somewhat like the pretty print phenomenon. But this time the result at the `sage:` prompt matched the gotten doctest result.
* <9> 2. failure: `URLError: <urlopen error unknown url type: https>` was raised. Apparently the Sage Python was built without ssl. Is that the cause?
* <9> 3. failure: ` TracInternalError: <Fault 404: 'ticket does not exist'>` was raised. 
* <9> I just noticed that all failures happened in `MercurialPatchMixin.download_patch`! Is this still needed ???
* <10> Testing the examples at a `sage:` prompt is successful while the doctest fails reproducible. See also <4>?
* <11> 1. failure: Pretty print is expected (same as from `sage:` prompt).
* <11> 2. & 3. failure: `AttributeError: 'DoctestTicketProxy' object has no attribute 'changeLog'` raised respective `no attribute 'query'`.
* <11> 4. & 5. failure: `TracInternalError: <Fault 404: 'ticket does not exist'>` after calling `dev.trac.attachment_names()`. Testing from `sage:` prompt give the //expected// response.
* <12> Doctesting `stock.py` gives 11 failures; sometimes the response is empty, sometimes the responses differ from the expected. Testing at the `sage:` prompt gives the same results as the doctest. Apparently the requested data is no more available (too old?) from the web service. - Module needs updating.
* <13> The response (also verified with the `sage:` prompt) deviates strongly from the expected `sage.misc.package.install_all_optional_packages(dry_run=True)`.
* <14> `sage.misc.preparser.load('https://github.com/jasongrout/minimum_rank/raw/minimum_rank_1_0_0/minrank.py', globals())` raised `IOError: [Errno url error] unknown url type: 'https'`. Apparently Python has no ssl support.

Comments and help are appreciated :-)


---

Comment by wluebbe created at 2014-05-07 18:00:11

New commits:


---

Comment by wluebbe created at 2014-05-07 18:06:47

These are patches for <1>, <3> and <5>.

Yes, the titles of the commit messages could have been better :-/ 


But look at the full messages ...


---

Comment by kcrisman created at 2016-03-16 02:12:30

See also #20182.


---

Comment by chapoton created at 2019-09-12 11:56:10

obsolete duplicate of #25536 ?


---

Comment by chapoton created at 2019-09-12 11:56:10

Changing status from new to needs_review.


---

Comment by kcrisman created at 2019-09-12 19:08:42

I think you are correct.


---

Comment by chapoton created at 2019-09-14 12:50:22

Resolution: duplicate


---

Comment by chapoton created at 2019-09-14 12:50:22

then I close this as duplicate
