# Issue 21598: Upgrade pip to 9.0.0

Issue created by migration from https://trac.sagemath.org/ticket/21835

Original creator: charpent

Original creation time: 2016-11-07 19:07:32

Keywords: pip

#21812 aims to fix doctest failures due to pip advertising its new version. This creates other build problems.

I propose instead that we integrate pip 9.0.0.

See saga starting [here](https://groups.google.com/d/msg/sage-release/OtYJUXuf2vk/htTvSaQZAQAJ) and comment below (long story).


---

Attachment

Failed parallel build log with pip 8 and #21812.


---

Comment by charpent created at 2016-11-07 19:11:34

ptestlong log with pip 8 and no patch, exhibiting the problem created by pip advertising its new version.


---

Attachment

Log of failed Singular build with pip8, #21812 and parallel building


---

Attachment

ptestlong log with pip 8 and #21812 exhibiting the desired result (no spurious doctest failures)


---

Attachment

ptestlong log with pip 9 (manuallu upgraded), without #21812 : spurios doctest failures caused by "Deprecation" messages from pip.


---

Attachment

ptestlong log obtained with pip9 (manually upgraded) and #21812, showing the spurious doctest failures due to "Deprecation" pip complaints not fixed by #21812.


---

Comment by charpent created at 2016-11-07 19:45:59

Note : All these trials were made with #21782, now necessary on my Debian system using gcc 6.2.0.

The logs show that :
* without #21812, pip 8.x.y (our current version) advertising its new version creates spurious doctest failures.
* with #21812, pip 8.x.x solves this problem. *BUT*
* this log was obtained after a serial build of Sage ; a parallel build fails on Singular.
* Manually upgrading pip to 9.0.0 causes *different* spurious doctest failures, by pip advertising a deprecation of its previous format.
* These pip 9.0.0 deprecation warnings occur whether or not #21812 is installed.

I conclude that #21812
* is only a temporary fix,
* may be troublesome with some configurations.


---

Comment by dimpase created at 2016-11-07 21:29:34

The first question is where Sage's pip is looking for its `pip.conf`.
(to follow the warning to `define a list_format in your pip.conf`)


---

Comment by jdemeyer created at 2016-11-08 10:54:16

The file [attachment:pip8-patch-parallel-install.log.gz] shows a build failure with Singular. That is totally unrelated to `pip`. I believe that there is a problem with building Singular, but that failure has nothing to do with #21812.


---

Comment by thansen created at 2016-12-08 17:55:37

The deprecation warnings can be gotten rid of by patching the same line as in #21812 and adding the option --format=legacy.


---

Comment by jdemeyer created at 2016-12-09 06:32:11

Changing type from defect to enhancement.


---

Comment by dimpase created at 2016-12-11 16:00:00

was the description removed on purpose, or by oversight?


---

Comment by jdemeyer created at 2016-12-11 16:38:45

Replying to [comment:6 dimpase]:
> was the description removed on purpose, or by oversight?

On purpose since it was no longer relevant.


---

Comment by charpent created at 2016-12-11 21:13:09

Replying to [comment:4 thansen]:
> The deprecation warnings can be gotten rid of by patching the same line as in #21812 and adding the option --format=legacy.

I'm afraid that our current policy of "don't upgrade until absolutely necessary", while implementing a well-founded unease with novelty for novelty's sake, leads us to paint ourselves in unmaintainable corners.

In the present case, pip is now a cornerstone of python infrastructure.  Trying to maintain its old format exposes us to the risk of more and more Sage-specific pip-related patches, aggravating its maintenance burden. While not as serious as the python2-python3 divergence, that, IMHO, we considered way too late, the analogy is here.

I'd consider what is currently a booboo as an incentive to *fix* the problem, not to work around it.

Of course, you can also consider that pip, used to add new packages, is not useful for "a majority" of Sage users. You will have as much trouble convincing me that you have tryng to convince me that SSL support can be optional (you didn't succeed yet).

Culd you please consider this bug as a serious warning about our future maintenance burden ?


---

Comment by charpent created at 2016-12-11 21:16:06

Replying to [comment:7 jdemeyer]:
> Replying to [comment:6 dimpase]:
> > was the description removed on purpose, or by oversight?
> 
> On purpose since it was no longer relevant.

In my not so humble opinion, this description is *still* relevant. Removing it is a bit papering up a minor problem, leaving it time to become a major one...

I'd rather restore the original description (with your comments if you think necessary...).


---

Comment by jdemeyer created at 2016-12-11 21:29:18

Replying to [comment:9 charpent]:
> In my not so humble opinion, this description is *still* relevant. Removing it is a bit papering up a minor problem, leaving it time to become a major one...

The original description claimed that there were problems with #21812. That ticket is now merged without the claimed problem appearing. So that claim was simply wrong (as I already pointed out on `sage-devel` and in [comment:3]).

This has nothing to do with being in favour or against this ticket. I just don't want factually incorrect ticket descriptions.


---

Comment by chapoton created at 2017-05-26 09:39:32

New commits:


---

Comment by jdemeyer created at 2017-08-14 12:30:11

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-08-14 12:30:11

Duplicate of #23615.


---

Comment by jdemeyer created at 2017-08-14 12:30:18

Resolution: duplicate
