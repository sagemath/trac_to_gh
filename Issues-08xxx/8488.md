# Issue 8488: Add support for @interact to the Sage library and module for a library of interacts

archive/issues_008488.json:
```json
{
    "body": "See http://groups.google.com/group/sage-devel/browse_frm/thread/240592d465bd4f84#\n\n**Assignee:** @jasongrout\n\n**CC:**  mhampton\n\n**Author:** William Stein, Jason Grout\n\n**Reviewer:** Jason Grout, William Stein, John Palmieri\n\n**Merged:** sage-4.4.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/8488\n\n",
    "closed_at": "2010-04-19T05:22:30Z",
    "created_at": "2010-03-10T13:16:54Z",
    "labels": [
        "component: interact",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.4",
    "title": "Add support for @interact to the Sage library and module for a library of interacts",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8488",
    "user": "https://github.com/williamstein"
}
```
See http://groups.google.com/group/sage-devel/browse_frm/thread/240592d465bd4f84#

**Assignee:** @jasongrout

**CC:**  mhampton

**Author:** William Stein, Jason Grout

**Reviewer:** Jason Grout, William Stein, John Palmieri

**Merged:** sage-4.4.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/8488





---

archive/issue_comments_070908.json:
```json
{
    "body": "**Author:** William Stein, Jason Grout",
    "created_at": "2010-03-10T13:17:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70908",
    "user": "https://github.com/williamstein"
}
```

**Author:** William Stein, Jason Grout



---

archive/issue_events_061511.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-03-10T13:22:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61511"
}
```



---

archive/attachments_010591.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_8488.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8488/trac_8488.patch",
    "created_at": "2010-03-10T13:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/williamstein"
}
```



---

archive/issue_comments_070909.json:
```json
{
    "body": "<a id='comment:2'></a>\n",
    "created_at": "2010-03-10T13:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70909",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:2'></a>




---

archive/issue_events_061512.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-03-10T18:43:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61512"
}
```



---

archive/issue_events_061513.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-03-10T18:43:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61513"
}
```



---

archive/issue_comments_070910.json:
```json
{
    "body": "<a id='comment:3'></a>\nI think it would be better to use the `@`wraps decorator in python, which automatically copies the documentation, etc.  Also, the source inspection probably won't work here (I haven't checked, though).  We should spruce up this decorator to follow the pattern in sage/plot/misc.py (see the `@`options or `@`suboptions decorator classes).",
    "created_at": "2010-03-10T18:43:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70910",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:3'></a>
I think it would be better to use the `@`wraps decorator in python, which automatically copies the documentation, etc.  Also, the source inspection probably won't work here (I haven't checked, though).  We should spruce up this decorator to follow the pattern in sage/plot/misc.py (see the `@`options or `@`suboptions decorator classes).



---

archive/issue_comments_070911.json:
```json
{
    "body": "<a id='comment:4'></a>\nor even better, we should make a `@`wrap_sage decorator which does the same thing as `@`wraps and additionally does:\n\n```\n        from sage.misc.sageinspect import sage_getsource\n        wrapper._sage_src_ = lambda: sage_getsource(func)\n```\n\nlike in the sage/plot/misc.py files.",
    "created_at": "2010-03-10T18:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70911",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:4'></a>
or even better, we should make a `@`wrap_sage decorator which does the same thing as `@`wraps and additionally does:

```
        from sage.misc.sageinspect import sage_getsource
        wrapper._sage_src_ = lambda: sage_getsource(func)
```

like in the sage/plot/misc.py files.



---

archive/issue_comments_070912.json:
```json
{
    "body": "<a id='comment:5'></a>\nI just attached a patch which implements a \"sage_wraps\" decorator which mirrors the functools wraps decorator, but also adds the sage-specific `_sage_src_` attribute, so that `interacts.demo??` works.\n\nThis is still \"needs work\", since the sage_wraps function needs some doctests.\n\nWe can now simplify the code in sage/plot/misc.py and a few other places that call the `@`wraps decorator using `@`sage_wraps.",
    "created_at": "2010-03-10T20:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70912",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:5'></a>
I just attached a patch which implements a "sage_wraps" decorator which mirrors the functools wraps decorator, but also adds the sage-specific `_sage_src_` attribute, so that `interacts.demo??` works.

This is still "needs work", since the sage_wraps function needs some doctests.

We can now simplify the code in sage/plot/misc.py and a few other places that call the `@`wraps decorator using `@`sage_wraps.



---

archive/issue_comments_070913.json:
```json
{
    "body": "<a id='comment:6'></a>\nNote that there is a bug in the ReST formatting.  After applying both patches above, `interacts.demo??` gives output that is all messed up since apparently the formatting engine doesn't deal well with the single newlines that _sage_src_() returns.  I've run out of time to try to track this down and see if it is a bug in the introspection or in the file or what.",
    "created_at": "2010-03-10T20:26:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70913",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:6'></a>
Note that there is a bug in the ReST formatting.  After applying both patches above, `interacts.demo??` gives output that is all messed up since apparently the formatting engine doesn't deal well with the single newlines that _sage_src_() returns.  I've run out of time to try to track this down and see if it is a bug in the introspection or in the file or what.



---

archive/issue_comments_070914.json:
```json
{
    "body": "<a id='comment:7'></a>\nAlso, I don't think we should import library_interact into the interacts namespace.  I think interacts.<tab> should just give a list of interacts (in fact, I think it should be broken down a bit further, so that interacts.calculus.<tab> gives calculus interacts, etc.)  Note that because of wonderful namespaces, the same interact could be imported into interacts.calculus and interacts.linear_algebra, for example.",
    "created_at": "2010-03-10T20:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70914",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:7'></a>
Also, I don't think we should import library_interact into the interacts namespace.  I think interacts.<tab> should just give a list of interacts (in fact, I think it should be broken down a bit further, so that interacts.calculus.<tab> gives calculus interacts, etc.)  Note that because of wonderful namespaces, the same interact could be imported into interacts.calculus and interacts.linear_algebra, for example.



---

archive/issue_events_061514.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-03-11T01:50:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61514"
}
```



---

archive/issue_events_061515.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-03-11T01:50:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61515"
}
```



---

archive/issue_events_061516.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-03-11T01:50:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "milestone": "sage-4.3.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61516"
}
```



---

archive/issue_comments_070915.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+Okay, William or Marshall, the ball's back in your court to review my patch.\n``````\n",
    "created_at": "2010-03-11T01:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70915",
    "user": "https://github.com/jasongrout"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+Okay, William or Marshall, the ball's back in your court to review my patch.
``````




---

archive/issue_comments_070916.json:
```json
{
    "body": "**Changing assignee** from @itolkov to @jasongrout.",
    "created_at": "2010-03-11T01:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70916",
    "user": "https://github.com/jasongrout"
}
```

**Changing assignee** from @itolkov to @jasongrout.



---

archive/issue_comments_070917.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Okay, William or Marshall, the ball's back in your court to review my patch.\n+See http://groups.google.com/group/sage-devel/browse_frm/thread/240592d465bd4f84#\n``````\n",
    "created_at": "2010-03-11T01:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70917",
    "user": "https://github.com/jasongrout"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-Okay, William or Marshall, the ball's back in your court to review my patch.
+See http://groups.google.com/group/sage-devel/browse_frm/thread/240592d465bd4f84#
``````




---

archive/issue_comments_070918.json:
```json
{
    "body": "<a id='comment:9'></a>\nOops, I deleted the title, instead of adding a comment, apparently.\n\nOkay, William or Marshall, the ball's back in your court to review my patch.",
    "created_at": "2010-03-11T01:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70918",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:9'></a>
Oops, I deleted the title, instead of adding a comment, apparently.

Okay, William or Marshall, the ball's back in your court to review my patch.



---

archive/issue_comments_070919.json:
```json
{
    "body": "<a id='comment:11'></a>\nREVIEW:\n\n* very nice using the python wrapping stuff, and making source code introspection work, in theory!\n\n* In practice, source code introspection does not work, though this is due to a lazy assumption *I* made I think when implementing interact in the notebook, namely I think when the notebook server sees \"@interact\" in the output, it does something funny with formatting.  Anyway, if you try:\n\n```\ninteracts.calculus.taylor_polynomial??\n```\nin a cell then shift-enter, you'll see the source is all on one long line, which isn't good.  That said, fixing this shouldn't be part of this patch, since it's a very different issue in the sage notebook itself, and maybe quite tricky to deal with.\n\n* Important. Try this in an input cell:\n\n```\ninteracts.calculus.[tab]\n```\nInstead of getting *one* thing, you get 15.  This *has* to be fixed. \n\n* Otherwise, I'm happy with this patch.",
    "created_at": "2010-03-11T04:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70919",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:11'></a>
REVIEW:

* very nice using the python wrapping stuff, and making source code introspection work, in theory!

* In practice, source code introspection does not work, though this is due to a lazy assumption *I* made I think when implementing interact in the notebook, namely I think when the notebook server sees "@interact" in the output, it does something funny with formatting.  Anyway, if you try:

```
interacts.calculus.taylor_polynomial??
```
in a cell then shift-enter, you'll see the source is all on one long line, which isn't good.  That said, fixing this shouldn't be part of this patch, since it's a very different issue in the sage notebook itself, and maybe quite tricky to deal with.

* Important. Try this in an input cell:

```
interacts.calculus.[tab]
```
Instead of getting *one* thing, you get 15.  This *has* to be fixed. 

* Otherwise, I'm happy with this patch.



---

archive/issue_events_061517.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-03-11T04:54:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61517"
}
```



---

archive/issue_events_061518.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-03-11T04:54:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61518"
}
```



---

archive/issue_events_061519.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-03-11T05:31:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61519"
}
```



---

archive/issue_events_061520.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-03-11T05:31:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61520"
}
```



---

archive/issue_comments_070920.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [was](#comment%3A11):\n\n> REVIEW: * very nice using the python wrapping stuff, and making source code introspection work, in theory! * In practice, source code introspection does not work, though this is due to a lazy assumption *I* made I think when implementing interact in the notebook, namely I think when the notebook server sees \"@interact\" in the output, it does something funny with formatting.  Anyway, if you try: ` interacts.calculus.taylor_polynomial?? ` in a cell then shift-enter, you'll see the source is all on one long line, which isn't good.  That said, fixing this shouldn't be part of this patch, since it's a very different issue in the sage notebook itself, and maybe quite tricky to deal with.\n\n\nAh, that makes sense.  I saw this, and even started writing a ticket for it, but I couldn't reproduce it with anything besides the interact stuff (see my comment above about ReST formatting), and then I ran out of time.\n\nI'm attaching a new patch which takes care of the namespace issue you mentioned.\u00a0 Basically, I lump everything into a library file, and then just import into calculus.py the actual interact. I'm sure there's a fancy object we could make that would nicely categorize everything, but this quick solution takes advantage of the nice namespace framework we already have.",
    "created_at": "2010-03-11T05:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70920",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:12'></a>
Replying to [was](#comment%3A11):

> REVIEW: * very nice using the python wrapping stuff, and making source code introspection work, in theory! * In practice, source code introspection does not work, though this is due to a lazy assumption *I* made I think when implementing interact in the notebook, namely I think when the notebook server sees "@interact" in the output, it does something funny with formatting.  Anyway, if you try: ` interacts.calculus.taylor_polynomial?? ` in a cell then shift-enter, you'll see the source is all on one long line, which isn't good.  That said, fixing this shouldn't be part of this patch, since it's a very different issue in the sage notebook itself, and maybe quite tricky to deal with.


Ah, that makes sense.  I saw this, and even started writing a ticket for it, but I couldn't reproduce it with anything besides the interact stuff (see my comment above about ReST formatting), and then I ran out of time.

I'm attaching a new patch which takes care of the namespace issue you mentioned.Â  Basically, I lump everything into a library file, and then just import into calculus.py the actual interact. I'm sure there's a fancy object we could make that would nicely categorize everything, but this quick solution takes advantage of the nice namespace framework we already have.



---

archive/attachments_010592.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac-8488-sage_wrap_decorator.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8488/trac-8488-sage_wrap_decorator.patch",
    "created_at": "2010-03-11T05:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jasongrout"
}
```



---

archive/issue_comments_070921.json:
```json
{
    "body": "apply on top of previous patch",
    "created_at": "2010-03-11T05:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70921",
    "user": "https://github.com/jasongrout"
}
```

apply on top of previous patch



---

archive/issue_comments_070922.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [was](#comment%3A11):\n\n>    * Otherwise, I'm happy with this patch. \n\n\nFYI, I'm leaving it to you to set \"positive review\" after my last patch, if you're still happy.",
    "created_at": "2010-03-11T15:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70922",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:13'></a>
Replying to [was](#comment%3A11):

>    * Otherwise, I'm happy with this patch. 


FYI, I'm leaving it to you to set "positive review" after my last patch, if you're still happy.



---

archive/issue_events_061521.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-03-27T17:45:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61521"
}
```



---

archive/issue_events_061522.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-03-27T17:45:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61522"
}
```



---

archive/issue_comments_070923.json:
```json
{
    "body": "<a id='comment:15'></a>\nI applied both patches to 4.3.5 and I'm getting doctest failures:\n\n```\nsage -t  devel/sage/sage/interacts/library.py\n**********************************************************************\nFile \"/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/devel/sage-new/sage/interacts/library.py\", line 18:\n    sage: @interacts.decorator.library_interact\n    def f(n=Integer(5)): print n\nException raised:\n    Traceback (most recent call last):\n      File \"/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_1[2]>\", line 1, in <module>\n        @interacts.decorator.library_interact###line 18:\n    sage: @interacts.decorator.library_interact\n    AttributeError: 'module' object has no attribute 'decorator'\n**********************************************************************\nFile \"/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/devel/sage-new/sage/interacts/library.py\", line 21:\n    sage: f()  # an interact appears\nException raised:\n    Traceback (most recent call last):\n      File \"/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_1[3]>\", line 1, in <module>\n        f()  # an interact appears###line 21:\n    sage: f()  # an interact appears\n    NameError: name 'f' is not defined\n**********************************************************************\nFile \"/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/devel/sage-new/sage/interacts/library.py\", line 45:\n    sage: interacts.decorator.demo()\nException raised:\n    Traceback (most recent call last):\n      File \"/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_2[2]>\", line 1, in <module>\n        interacts.decorator.demo()###line 45:\n    sage: interacts.decorator.demo()\n    AttributeError: 'module' object has no attribute 'decorator'\n**********************************************************************\n2 items had failures:\n   2 of   4 in __main__.example_1\n   1 of   3 in __main__.example_2\n***Test Failed*** 3 failures.\n```",
    "created_at": "2010-04-16T19:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70923",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>
I applied both patches to 4.3.5 and I'm getting doctest failures:

```
sage -t  devel/sage/sage/interacts/library.py
**********************************************************************
File "/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/devel/sage-new/sage/interacts/library.py", line 18:
    sage: @interacts.decorator.library_interact
    def f(n=Integer(5)): print n
Exception raised:
    Traceback (most recent call last):
      File "/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_1[2]>", line 1, in <module>
        @interacts.decorator.library_interact###line 18:
    sage: @interacts.decorator.library_interact
    AttributeError: 'module' object has no attribute 'decorator'
**********************************************************************
File "/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/devel/sage-new/sage/interacts/library.py", line 21:
    sage: f()  # an interact appears
Exception raised:
    Traceback (most recent call last):
      File "/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_1[3]>", line 1, in <module>
        f()  # an interact appears###line 21:
    sage: f()  # an interact appears
    NameError: name 'f' is not defined
**********************************************************************
File "/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/devel/sage-new/sage/interacts/library.py", line 45:
    sage: interacts.decorator.demo()
Exception raised:
    Traceback (most recent call last):
      File "/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/mnt/usb1/scratch/palmieri/sage-4.3.5-sage.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_2[2]>", line 1, in <module>
        interacts.decorator.demo()###line 45:
    sage: interacts.decorator.demo()
    AttributeError: 'module' object has no attribute 'decorator'
**********************************************************************
2 items had failures:
   2 of   4 in __main__.example_1
   1 of   3 in __main__.example_2
***Test Failed*** 3 failures.
```



---

archive/issue_events_061523.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-04-16T19:59:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61523"
}
```



---

archive/issue_events_061524.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-04-16T19:59:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61524"
}
```



---

archive/issue_events_061525.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-04-18T00:31:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61525"
}
```



---

archive/issue_events_061526.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-04-18T00:31:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61526"
}
```



---

archive/attachments_010593.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_8488-part3.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8488/trac_8488-part3.patch",
    "created_at": "2010-04-18T00:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/williamstein"
}
```



---

archive/issue_comments_070924.json:
```json
{
    "body": "",
    "created_at": "2010-04-18T00:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70924",
    "user": "https://github.com/williamstein"
}
```





---

archive/issue_events_061527.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-04-18T00:33:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61527"
}
```



---

archive/issue_events_061528.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-04-18T00:33:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61528"
}
```



---

archive/issue_events_061529.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-04-18T18:59:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61529"
}
```



---

archive/issue_events_061530.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-04-18T18:59:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61530"
}
```



---

archive/issue_comments_070925.json:
```json
{
    "body": "<a id='comment:18'></a>\nWhen I apply this, I get a new doctest failure:\n\n```\n**********************************************************************\nFile \"/Applications/sage_builds/sage-4.4.alpha0/devel/sage-new/sage/symbolic/ring.pyx\", line 443:\n    sage: SR.symbol() # temporary variable\nExpected:\n    symbol160\nGot:\n    symbol162\n**********************************************************************\n```\nI don't know why these patches cause this file to file.  Can we just change \"160\" to \"162\"?",
    "created_at": "2010-04-18T18:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70925",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:18'></a>
When I apply this, I get a new doctest failure:

```
**********************************************************************
File "/Applications/sage_builds/sage-4.4.alpha0/devel/sage-new/sage/symbolic/ring.pyx", line 443:
    sage: SR.symbol() # temporary variable
Expected:
    symbol160
Got:
    symbol162
**********************************************************************
```
I don't know why these patches cause this file to file.  Can we just change "160" to "162"?



---

archive/issue_comments_070926.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [jhpalmieri](#comment%3A18):\n> When I apply this, I get a new doctest failure:\n> \n> ```\n> **********************************************************************\n> File \"/Applications/sage_builds/sage-4.4.alpha0/devel/sage-new/sage/symbolic/ring.pyx\", line 443:\n>     sage: SR.symbol() # temporary variable\n> Expected:\n>     symbol160\n> Got:\n>     symbol162\n> **********************************************************************\n> ```\n> I don't know why these patches cause this file to file.  Can we just change \"160\" to \"162\"?\n\n\nYes.  It's just some internal counter.   That's a stupid doctest though, since an unrelated change anywhere else in Sage could break it.  Can you change the output to\n\n   symbol...\n\n?\n\nWilliam",
    "created_at": "2010-04-18T22:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70926",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:19'></a>
Replying to [jhpalmieri](#comment%3A18):
> When I apply this, I get a new doctest failure:
> 
> ```
> **********************************************************************
> File "/Applications/sage_builds/sage-4.4.alpha0/devel/sage-new/sage/symbolic/ring.pyx", line 443:
>     sage: SR.symbol() # temporary variable
> Expected:
>     symbol160
> Got:
>     symbol162
> **********************************************************************
> ```
> I don't know why these patches cause this file to file.  Can we just change "160" to "162"?


Yes.  It's just some internal counter.   That's a stupid doctest though, since an unrelated change anywhere else in Sage could break it.  Can you change the output to

   symbol...

?

William



---

archive/issue_comments_070927.json:
```json
{
    "body": "**Reviewer:** Jason Grout, William Stein, John Palmieri",
    "created_at": "2010-04-19T00:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70927",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** Jason Grout, William Stein, John Palmieri



---

archive/issue_comments_070928.json:
```json
{
    "body": "<a id='comment:20'></a>\nOkay, here's a patch.",
    "created_at": "2010-04-19T00:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70928",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:20'></a>
Okay, here's a patch.



---

archive/issue_events_061531.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-04-19T00:07:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61531"
}
```



---

archive/issue_events_061532.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-04-19T00:07:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61532"
}
```



---

archive/attachments_010594.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_8488-part4.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8488/trac_8488-part4.patch",
    "created_at": "2010-04-19T00:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_070929.json:
```json
{
    "body": "",
    "created_at": "2010-04-19T00:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70929",
    "user": "https://github.com/jhpalmieri"
}
```





---

archive/issue_events_061533.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-04-19T05:09:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61533"
}
```



---

archive/issue_events_061534.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-04-19T05:09:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61534"
}
```



---

archive/issue_comments_070930.json:
```json
{
    "body": "<a id='comment:22'></a>\n(I just got around now to applying the patch and running doctests.)",
    "created_at": "2010-04-19T05:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70930",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:22'></a>
(I just got around now to applying the patch and running doctests.)



---

archive/issue_comments_070931.json:
```json
{
    "body": "<a id='comment:23'></a>\nMerged into 4.4.alpha1:\n- trac_8488.patch\n- trac-8488-sage_wrap_decorator.patch\n- trac_8488-part3.patch\n- trac_8488-part4.patch",
    "created_at": "2010-04-19T05:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70931",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:23'></a>
Merged into 4.4.alpha1:
- trac_8488.patch
- trac-8488-sage_wrap_decorator.patch
- trac_8488-part3.patch
- trac_8488-part4.patch



---

archive/issue_comments_070932.json:
```json
{
    "body": "**Merged:** sage-4.4.alpha1",
    "created_at": "2010-04-19T05:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8488#issuecomment-70932",
    "user": "https://github.com/jhpalmieri"
}
```

**Merged:** sage-4.4.alpha1



---

archive/issue_events_061535.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-04-19T05:22:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61535"
}
```



---

archive/issue_events_061536.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-04-19T05:22:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8488",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8488#event-61536"
}
```
