# Issue 8820: elliptic_exponential broken for curves over number fields

archive/issues_008820.json:
```json
{
    "body": "\n```\nsage: E = EllipticCurve('37a')\nsage: K.<a> = QuadraticField(-5)\nsage: L = E.change_ring(K).period_lattice(K.places()[0])\nsage: L.elliptic_exponential(CDF(.1,.1))\nTraceback (most recent call last):\n  File \"<ipython console>\", line 1, in <module>\n  File \"/usr/local/sage/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/period_lattice.py\", line 1390, in elliptic_exponential\n    pxy = E.pari_curve(prec+5).ellztopoint(w)\n  File \"gen.pyx\", line 9234, in sage.libs.pari.gen._pari_trap (sage/libs/pari/gen.c:44342)\nPariError: bad argument for an elliptic curve related function (43)\n```\n\nPerhaps Pari doesn't support curve not over Q? \n\n**Assignee:** @JohnCremona\n\n**CC:**  @jdemeyer rwb\n\n**Resolution:** fixed\n\n**Author:** John Cremona\n\n**Reviewer:** Chris Wuthrich, Jeroen Demeyer\n\n**Merged:** sage-4.6.alpha3\n\nIssue created by migration from https://trac.sagemath.org/ticket/8820\n\n",
    "closed_at": "2010-10-06T03:17:56Z",
    "created_at": "2010-04-29T09:03:18Z",
    "labels": [
        "component: elliptic curves"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6",
    "title": "elliptic_exponential broken for curves over number fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8820",
    "user": "https://github.com/robertwb"
}
```

```
sage: E = EllipticCurve('37a')
sage: K.<a> = QuadraticField(-5)
sage: L = E.change_ring(K).period_lattice(K.places()[0])
sage: L.elliptic_exponential(CDF(.1,.1))
Traceback (most recent call last):
  File "<ipython console>", line 1, in <module>
  File "/usr/local/sage/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/period_lattice.py", line 1390, in elliptic_exponential
    pxy = E.pari_curve(prec+5).ellztopoint(w)
  File "gen.pyx", line 9234, in sage.libs.pari.gen._pari_trap (sage/libs/pari/gen.c:44342)
PariError: bad argument for an elliptic curve related function (43)
```

Perhaps Pari doesn't support curve not over Q? 

**Assignee:** @JohnCremona

**CC:**  @jdemeyer rwb

**Resolution:** fixed

**Author:** John Cremona

**Reviewer:** Chris Wuthrich, Jeroen Demeyer

**Merged:** sage-4.6.alpha3

Issue created by migration from https://trac.sagemath.org/ticket/8820





---

archive/issue_comments_102309.json:
```json
{
    "body": "<a id='comment:1'></a>\nActually, this makes sense because I'm not giving Pari the embedding to use.",
    "created_at": "2010-04-29T09:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102309",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:1'></a>
Actually, this makes sense because I'm not giving Pari the embedding to use.



---

archive/issue_comments_102310.json:
```json
{
    "body": "<a id='comment:2'></a>\nRats, I thought I had implemented this properly.  The elliptic log does have examples over number fields with complex embeddings!  This should be a lot easier...\n\nThe period lattice has an embedding into CC (or RR) stored with it.  That should be used to create a pari elliptic curve defined over RR or CC, there the pari function would work.\n\nI would much prefer to have our own Weierstrass functions implemented, but that's the situation right now.\n\nNote that this will involve some of the same code as #8815.",
    "created_at": "2010-04-29T09:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102310",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:2'></a>
Rats, I thought I had implemented this properly.  The elliptic log does have examples over number fields with complex embeddings!  This should be a lot easier...

The period lattice has an embedding into CC (or RR) stored with it.  That should be used to create a pari elliptic curve defined over RR or CC, there the pari function would work.

I would much prefer to have our own Weierstrass functions implemented, but that's the situation right now.

Note that this will involve some of the same code as #8815.



---

archive/issue_comments_102311.json:
```json
{
    "body": "<a id='comment:3'></a>\nI am working on this right now.",
    "created_at": "2010-08-27T09:47:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102311",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'></a>
I am working on this right now.



---

archive/issue_comments_102312.json:
```json
{
    "body": "applies to 4.5.3.alpha2",
    "created_at": "2010-08-29T14:35:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102312",
    "user": "https://github.com/JohnCremona"
}
```

applies to 4.5.3.alpha2



---

archive/issue_comments_102313.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2010-08-29T14:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102313",
    "user": "https://github.com/JohnCremona"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_102314.json:
```json
{
    "body": "<a id='comment:4'></a>\nAttachment [trac_8820-elliptic-exp.patch](tarball://root/attachments/some-uuid/ticket8820/trac_8820-elliptic-exp.patch) by @JohnCremona created at 2010-08-29 14:38:36\n\nThe patch implements this.  I left the old code (using ellztopoint) for curves over QQ though the new code (using ellwp) works fine too, since the the output of many doctests would have changed (in insignificant bits), especially in heegner.py.\n\nI also documented a couple of functions in period_lattice.py which were not, so that file now has 100% coverage.",
    "created_at": "2010-08-29T14:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102314",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:4'></a>
Attachment [trac_8820-elliptic-exp.patch](tarball://root/attachments/some-uuid/ticket8820/trac_8820-elliptic-exp.patch) by @JohnCremona created at 2010-08-29 14:38:36

The patch implements this.  I left the old code (using ellztopoint) for curves over QQ though the new code (using ellwp) works fine too, since the the output of many doctests would have changed (in insignificant bits), especially in heegner.py.

I also documented a couple of functions in period_lattice.py which were not, so that file now has 100% coverage.



---

archive/issue_comments_102315.json:
```json
{
    "body": "**Author:** John Cremona",
    "created_at": "2010-08-29T14:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102315",
    "user": "https://github.com/JohnCremona"
}
```

**Author:** John Cremona



---

archive/issue_comments_102316.json:
```json
{
    "body": "<a id='comment:5'></a>\nI get doctest failures, like the typical case below. It should be considered numerical noise, but somehow it is not a very good example then. I think a point (1,1) would give a more convincing example.\n\n```\nFile \"/local/pmzcw/prog/sage-4.5/devel/sage-test/sage/schemes/elliptic_curves/period_lattice.py\", line 1424:\n    sage: Li[0].elliptic_exponential(zi[0])\nExpected:\n    (2.17701177381006e-16 + 2.21973923391111e-16*I : 1.11022302462516e-16 - 2.21990394816407e-16*I : 1.00000000000000)\nGot:\n    (2.17818031662168e-16 + 2.22022549601564e-16*I : 1.11022302462516e-16 - 2.22044604925031e-16*I : 1.00000000000000)\n```\n\nThe lines that fail are 1424, 1426, 1428, 1440, 1450, 1452.",
    "created_at": "2010-09-23T19:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102316",
    "user": "https://github.com/categorie"
}
```

<a id='comment:5'></a>
I get doctest failures, like the typical case below. It should be considered numerical noise, but somehow it is not a very good example then. I think a point (1,1) would give a more convincing example.

```
File "/local/pmzcw/prog/sage-4.5/devel/sage-test/sage/schemes/elliptic_curves/period_lattice.py", line 1424:
    sage: Li[0].elliptic_exponential(zi[0])
Expected:
    (2.17701177381006e-16 + 2.21973923391111e-16*I : 1.11022302462516e-16 - 2.21990394816407e-16*I : 1.00000000000000)
Got:
    (2.17818031662168e-16 + 2.22022549601564e-16*I : 1.11022302462516e-16 - 2.22044604925031e-16*I : 1.00000000000000)
```

The lines that fail are 1424, 1426, 1428, 1440, 1450, 1452.



---

archive/issue_comments_102317.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2010-09-23T19:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102317",
    "user": "https://github.com/categorie"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_102318.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [wuthrich](#comment%3A5):\n> I get doctest failures, like the typical case below. It should be considered numerical noise, but somehow it is not a very good example then. I think a point (1,1) would give a more convincing example.\n> \n> ```\n> File \"/local/pmzcw/prog/sage-4.5/devel/sage-test/sage/schemes/elliptic_curves/period_lattice.py\", line 1424:\n>     sage: Li[0].elliptic_exponential(zi[0])\n> Expected:\n>     (2.17701177381006e-16 + 2.21973923391111e-16*I : 1.11022302462516e-16 - 2.21990394816407e-16*I : 1.00000000000000)\n> Got:\n>     (2.17818031662168e-16 + 2.22022549601564e-16*I : 1.11022302462516e-16 - 2.22044604925031e-16*I : 1.00000000000000)\n> ```\n> \n> The lines that fail are 1424, 1426, 1428, 1440, 1450, 1452.\n\n\nWhich version is that?  The patch says 4.5!",
    "created_at": "2010-09-23T21:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102318",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:6'></a>
Replying to [wuthrich](#comment%3A5):
> I get doctest failures, like the typical case below. It should be considered numerical noise, but somehow it is not a very good example then. I think a point (1,1) would give a more convincing example.
> 
> ```
> File "/local/pmzcw/prog/sage-4.5/devel/sage-test/sage/schemes/elliptic_curves/period_lattice.py", line 1424:
>     sage: Li[0].elliptic_exponential(zi[0])
> Expected:
>     (2.17701177381006e-16 + 2.21973923391111e-16*I : 1.11022302462516e-16 - 2.21990394816407e-16*I : 1.00000000000000)
> Got:
>     (2.17818031662168e-16 + 2.22022549601564e-16*I : 1.11022302462516e-16 - 2.22044604925031e-16*I : 1.00000000000000)
> ```
> 
> The lines that fail are 1424, 1426, 1428, 1440, 1450, 1452.


Which version is that?  The patch says 4.5!



---

archive/issue_comments_102319.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [cremona](#comment%3A6):\n\n\n> Which version is that?  The patch says 4.5!\n\n\nSorry, I meant \"path\".",
    "created_at": "2010-09-23T21:07:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102319",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:7'></a>
Replying to [cremona](#comment%3A6):


> Which version is that?  The patch says 4.5!


Sorry, I meant "path".



---

archive/issue_comments_102320.json:
```json
{
    "body": "<a id='comment:8'></a>\nIt is 4.5.3 on my office computer. \n\nNot that I believe that it matters. It is just numerical noise. Both results are correct with an error 2.e-16. My question is whether we should change it to 2.2.... e-16, while we could take as an example a point (1,1) where 1.000000... would be a better illustration of the computations.\n\nAm I too picky ?\n\nChris.",
    "created_at": "2010-09-24T18:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102320",
    "user": "https://github.com/categorie"
}
```

<a id='comment:8'></a>
It is 4.5.3 on my office computer. 

Not that I believe that it matters. It is just numerical noise. Both results are correct with an error 2.e-16. My question is whether we should change it to 2.2.... e-16, while we could take as an example a point (1,1) where 1.000000... would be a better illustration of the computations.

Am I too picky ?

Chris.



---

archive/issue_comments_102321.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [wuthrich](#comment%3A8):\n> It is 4.5.3 on my office computer. \n> \n> Not that I believe that it matters. It is just numerical noise. Both results are correct with an error 2.e-16. My question is whether we should change it to 2.2.... e-16, while we could take as an example a point (1,1) where 1.000000... would be a better illustration of the computations.\n> \n> Am I too picky ?\n\n\nNo, not at all -- using points which do not have 0 as a coordinate is a good idea!  But I was confused since the test which fails does not appear to exist on my 4.6.alpha1.\n\n> \n> Chris.\n",
    "created_at": "2010-09-24T19:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102321",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:9'></a>
Replying to [wuthrich](#comment%3A8):
> It is 4.5.3 on my office computer. 
> 
> Not that I believe that it matters. It is just numerical noise. Both results are correct with an error 2.e-16. My question is whether we should change it to 2.2.... e-16, while we could take as an example a point (1,1) where 1.000000... would be a better illustration of the computations.
> 
> Am I too picky ?


No, not at all -- using points which do not have 0 as a coordinate is a good idea!  But I was confused since the test which fails does not appear to exist on my 4.6.alpha1.

> 
> Chris.




---

archive/issue_comments_102322.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [cremona](#comment%3A9):\n> Replying to [wuthrich](#comment%3A8):\n> > It is 4.5.3 on my office computer. \n> > \n> > Not that I believe that it matters. It is just numerical noise. Both results are correct with an error 2.e-16. My question is whether we should change it to 2.2.... e-16, while we could take as an example a point (1,1) where 1.000000... would be a better illustration of the computations.\n> > \n> > Am I too picky ?\n\n> \n> No, not at all -- using points which do not have 0 as a coordinate is a good idea!  But I was confused since the test which fails does not appear to exist on my 4.6.alpha1.\n\n\nSorry, I am being completely stupid -- of course the failing test is in the patch and I was looking at unpatched files!  But now I find that the patch does not apply to 4.6.alpha1 so I will have to rebase it.  When I do that I will try to use better examples.\n\n> \n> > \n> > Chris.\n",
    "created_at": "2010-09-24T19:31:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102322",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:10'></a>
Replying to [cremona](#comment%3A9):
> Replying to [wuthrich](#comment%3A8):
> > It is 4.5.3 on my office computer. 
> > 
> > Not that I believe that it matters. It is just numerical noise. Both results are correct with an error 2.e-16. My question is whether we should change it to 2.2.... e-16, while we could take as an example a point (1,1) where 1.000000... would be a better illustration of the computations.
> > 
> > Am I too picky ?

> 
> No, not at all -- using points which do not have 0 as a coordinate is a good idea!  But I was confused since the test which fails does not appear to exist on my 4.6.alpha1.


Sorry, I am being completely stupid -- of course the failing test is in the patch and I was looking at unpatched files!  But now I find that the patch does not apply to 4.6.alpha1 so I will have to rebase it.  When I do that I will try to use better examples.

> 
> > 
> > Chris.




---

archive/issue_comments_102323.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-09-24T20:04:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102323",
    "user": "https://github.com/JohnCremona"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_102324.json:
```json
{
    "body": "<a id='comment:11'></a>\nPlease try the rebased patch.  I changes the point (0,0) to (-1,-1) in the bad example, but that was enough since the approximate imaginary parts were not exactly 0 -- which I got around by taking real parts where necessary.  A little crude, but it avoids the fuzz.",
    "created_at": "2010-09-24T20:04:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102324",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:11'></a>
Please try the rebased patch.  I changes the point (0,0) to (-1,-1) in the bad example, but that was enough since the approximate imaginary parts were not exactly 0 -- which I got around by taking real parts where necessary.  A little crude, but it avoids the fuzz.



---

archive/issue_comments_102325.json:
```json
{
    "body": "<a id='comment:12'></a>\nJohn: I suppose you mean rebased to 4.6.alpha1 unless you have some super-secret pre-release version of sage-4.6.alpha2 :-)\n\nAlso: you should use \"PARI\" instead of \"Pari\".",
    "created_at": "2010-09-25T17:20:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102325",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
John: I suppose you mean rebased to 4.6.alpha1 unless you have some super-secret pre-release version of sage-4.6.alpha2 :-)

Also: you should use "PARI" instead of "Pari".



---

archive/issue_comments_102326.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [jdemeyer](#comment%3A12):\n> John: I suppose you mean rebased to 4.6.alpha1 unless you have some super-secret pre-release version of sage-4.6.alpha2 :-)\n> \n> Also: you should use \"PARI\" instead of \"Pari\".\n\n\nyes, alpha1",
    "created_at": "2010-09-25T17:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102326",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:13'></a>
Replying to [jdemeyer](#comment%3A12):
> John: I suppose you mean rebased to 4.6.alpha1 unless you have some super-secret pre-release version of sage-4.6.alpha2 :-)
> 
> Also: you should use "PARI" instead of "Pari".


yes, alpha1



---

archive/issue_comments_102327.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [cremona](#comment%3A13):\n> Replying to [jdemeyer](#comment%3A12):\n> > John: I suppose you mean rebased to 4.6.alpha1 unless you have some super-secret pre-release version of sage-4.6.alpha2 :-)\n> > \n> > Also: you should use \"PARI\" instead of \"Pari\".\n\n> \n> yes, alpha1\n\n\nI have now fixed all the offending \"Pari\" and \"pari\" in the patch, and all the files in  elliptic_curves!",
    "created_at": "2010-09-26T16:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102327",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:14'></a>
Replying to [cremona](#comment%3A13):
> Replying to [jdemeyer](#comment%3A12):
> > John: I suppose you mean rebased to 4.6.alpha1 unless you have some super-secret pre-release version of sage-4.6.alpha2 :-)
> > 
> > Also: you should use "PARI" instead of "Pari".

> 
> yes, alpha1


I have now fixed all the offending "Pari" and "pari" in the patch, and all the files in  elliptic_curves!



---

archive/issue_comments_102328.json:
```json
{
    "body": "Attachment [trac_8820-elliptic-exp-rebase.patch](tarball://root/attachments/some-uuid/ticket8820/trac_8820-elliptic-exp-rebase.patch) by @JohnCremona created at 2010-09-26 16:46:50\n\napplies to 4.6.alpha1",
    "created_at": "2010-09-26T16:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102328",
    "user": "https://github.com/JohnCremona"
}
```

Attachment [trac_8820-elliptic-exp-rebase.patch](tarball://root/attachments/some-uuid/ticket8820/trac_8820-elliptic-exp-rebase.patch) by @JohnCremona created at 2010-09-26 16:46:50

applies to 4.6.alpha1



---

archive/issue_comments_102329.json:
```json
{
    "body": "<a id='comment:15'></a>\nJohn, I have rebased your patch such that it can be applied after the positively-reviewed #9931 (there were several conflicts).  I also made some very small changes to the docstring of the `cardinality` function in `ell_finite_field.py`",
    "created_at": "2010-09-26T18:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102329",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
John, I have rebased your patch such that it can be applied after the positively-reviewed #9931 (there were several conflicts).  I also made some very small changes to the docstring of the `cardinality` function in `ell_finite_field.py`



---

archive/issue_comments_102330.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [jdemeyer](#comment%3A15):\n> John, I have rebased your patch such that it can be applied after the positively-reviewed #9931 (there were several conflicts).  I also made some very small changes to the docstring of the `cardinality` function in `ell_finite_field.py`\n\n\nOK, I'm not sure what the issues were there but the new patch applies fine after #9931;  I am currently testing it.  Meanwhile:  the latest patch's header is\n\n```\n...\n# User Jeroen Demeyer <jdemeyer@cage.ugent.be>\n...\n[mq]: 8820_rebase_after_9931\n```\nand I think protocol would leave me as author (and have a better one-line description) ;)",
    "created_at": "2010-09-26T20:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102330",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:16'></a>
Replying to [jdemeyer](#comment%3A15):
> John, I have rebased your patch such that it can be applied after the positively-reviewed #9931 (there were several conflicts).  I also made some very small changes to the docstring of the `cardinality` function in `ell_finite_field.py`


OK, I'm not sure what the issues were there but the new patch applies fine after #9931;  I am currently testing it.  Meanwhile:  the latest patch's header is

```
...
# User Jeroen Demeyer <jdemeyer@cage.ugent.be>
...
[mq]: 8820_rebase_after_9931
```
and I think protocol would leave me as author (and have a better one-line description) ;)



---

archive/issue_comments_102331.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2010-09-26T20:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102331",
    "user": "https://github.com/JohnCremona"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_102332.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [cremona](#comment%3A16):\n> # User Jeroen Demeyer <jdemeyer@cage.ugent.be>\n> ...\n> [mq]: 8820_rebase_after_9931\n> }}}\n> and I think protocol would leave me as author (and have a better one-line description) ;)\n\n\nOK, I just copy-pasted the header from your patch.",
    "created_at": "2010-09-26T21:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102332",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Replying to [cremona](#comment%3A16):
> # User Jeroen Demeyer <jdemeyer@cage.ugent.be>
> ...
> [mq]: 8820_rebase_after_9931
> }}}
> and I think protocol would leave me as author (and have a better one-line description) ;)


OK, I just copy-pasted the header from your patch.



---

archive/issue_comments_102333.json:
```json
{
    "body": "John's patch rebased to be applied on top of #9931 (and some small additional changes)",
    "created_at": "2010-09-26T21:12:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102333",
    "user": "https://github.com/jdemeyer"
}
```

John's patch rebased to be applied on top of #9931 (and some small additional changes)



---

archive/issue_comments_102334.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2010-09-26T21:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102334",
    "user": "https://github.com/JohnCremona"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_comments_102335.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2010-09-26T21:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102335",
    "user": "https://github.com/JohnCremona"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_102336.json:
```json
{
    "body": "<a id='comment:18'></a>\nAttachment [8820_rebase_after_9931.patch](tarball://root/attachments/some-uuid/ticket8820/8820_rebase_after_9931.patch) by @JohnCremona created at 2010-09-26 21:42:19\n\nReplying to [jdemeyer](#comment%3A17):\n> Replying to [cremona](#comment%3A16):\n> > # User Jeroen Demeyer <jdemeyer@cage.ugent.be>\n> > ...\n> > [mq]: 8820_rebase_after_9931\n> > }}}\n> > and I think protocol would leave me as author (and have a better one-line description) ;)\n\n> \n> OK, I just copy-pasted the header from your patch.\n\n\nThanks -- I added your name as reviewer and marked the ticket Positive Review.  If you want, you can add your name as author (and mine as reviewer) -- I appreciate your attention to detail.\n\nRelease manager:  apply only the last patch 8820_rebase_after_9931.patch, after the patch at #9931.",
    "created_at": "2010-09-26T21:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102336",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:18'></a>
Attachment [8820_rebase_after_9931.patch](tarball://root/attachments/some-uuid/ticket8820/8820_rebase_after_9931.patch) by @JohnCremona created at 2010-09-26 21:42:19

Replying to [jdemeyer](#comment%3A17):
> Replying to [cremona](#comment%3A16):
> > # User Jeroen Demeyer <jdemeyer@cage.ugent.be>
> > ...
> > [mq]: 8820_rebase_after_9931
> > }}}
> > and I think protocol would leave me as author (and have a better one-line description) ;)

> 
> OK, I just copy-pasted the header from your patch.


Thanks -- I added your name as reviewer and marked the ticket Positive Review.  If you want, you can add your name as author (and mine as reviewer) -- I appreciate your attention to detail.

Release manager:  apply only the last patch 8820_rebase_after_9931.patch, after the patch at #9931.



---

archive/issue_comments_102337.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2010-09-26T22:05:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102337",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_102338.json:
```json
{
    "body": "<a id='comment:19'></a>\nI'm sorry John, but I did not review your patch, I just made a few small comments.  In any case, I think it is strange for the author of a patch to set his ticket to positive_review (no offense though).  I can probably review your patch later (not tonight).",
    "created_at": "2010-09-26T22:05:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102338",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
I'm sorry John, but I did not review your patch, I just made a few small comments.  In any case, I think it is strange for the author of a patch to set his ticket to positive_review (no offense though).  I can probably review your patch later (not tonight).



---

archive/issue_comments_102339.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-09-26T22:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102339",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_102340.json:
```json
{
    "body": "**Changing reviewer** from \"Jeroen Demeyer\" to \"Chris Wuthrich, Jeroen Demeyer\".",
    "created_at": "2010-09-26T22:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102340",
    "user": "https://github.com/JohnCremona"
}
```

**Changing reviewer** from "Jeroen Demeyer" to "Chris Wuthrich, Jeroen Demeyer".



---

archive/issue_comments_102341.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [jdemeyer](#comment%3A19):\n> I'm sorry John, but I did not review your patch, I just made a few small comments.  In any case, I think it is strange for the author of a patch to set his ticket to positive_review (no offense though).  I can probably review your patch later (not tonight).\n\n\nNo problem -- I misunderstood, and also forgot that the original doctest failures were not from you but from Chris Wuthrich.\n\nOf course I would not positively review my own work!  I have now added Chris to the list of reviewers, and hope that he'll be able to take another look at it.  Needs review!",
    "created_at": "2010-09-26T22:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102341",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:21'></a>
Replying to [jdemeyer](#comment%3A19):
> I'm sorry John, but I did not review your patch, I just made a few small comments.  In any case, I think it is strange for the author of a patch to set his ticket to positive_review (no offense though).  I can probably review your patch later (not tonight).


No problem -- I misunderstood, and also forgot that the original doctest failures were not from you but from Chris Wuthrich.

Of course I would not positively review my own work!  I have now added Chris to the list of reviewers, and hope that he'll be able to take another look at it.  Needs review!



---

archive/issue_comments_102342.json:
```json
{
    "body": "<a id='comment:22'></a>\nA few comments:\n\n* I think the help for `elliptic_exponential` (lines 1379--1385) is not so well written.  I would write something like\n\n```\nOUTPUT:\n\n- If ``to_curve`` is False, a 2-tuple of real or complex numbers\nrepresenting the point `(x,y) = (\\wp(z),\\wp'(z))` where `\\wp` denotes the Weierstrass\n`\\wp`-function with respect to this lattice.\n\n- If ``to_curve`` is True, the point `(x-b_2/12,y-(a_1(x-b_2/12)-a_3)/2)`\nas a point in `E(\\RR)` or `E(\\CC)`, with `(x,y) = (\\wp(z),\\wp'(z))` as above.\n\nIf the lattice is real...\n```\n\n* The comment\n\n```\n       # the next lines compute [P(w), P'(w)] when flag=1\n       # or [x:y:1] in E(C) when flag=2\n```\n seems to refer to old code.\n\n* Is there a good reason to distinguish between QQ and general number fields?  The number-field code seems simpler, so you could consider removing the special-case code for QQ.\n\n* lines 1503 and 1530: `C(t.real().python(),t.imag().python())` can be simplified as `C(t)`.\n\n* it doesn't work for the point at infinity (and there should be a doctest for that case anyway):\n\n```\nsage: E = EllipticCurve([1,1,1,-8,6])\nsage: L = E.period_lattice()\nsage: L.elliptic_exponential(0)\n---------------------------------------------------------------------------\nUnboundLocalError                         Traceback (most recent call last)\n\n/usr/local/src/pari/src/<ipython console> in <module>()\n\n/usr/local/src/sage-4.6.alpha1/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/period_lattice.pyc in elliptic_exponential(self, z, to_curve)\n   1476         if self.coordinates(z) == self.coordinates(z, rounding='round'):\n   1477             if to_curve:\n-> 1478                 return E.change_ring(C)(0)\n   1479             return (C('+infinity'),C('+infinity'))\n   1480\n\nUnboundLocalError: local variable 'E' referenced before assignment\n```",
    "created_at": "2010-09-30T09:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102342",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
A few comments:

* I think the help for `elliptic_exponential` (lines 1379--1385) is not so well written.  I would write something like

```
OUTPUT:

- If ``to_curve`` is False, a 2-tuple of real or complex numbers
representing the point `(x,y) = (\wp(z),\wp'(z))` where `\wp` denotes the Weierstrass
`\wp`-function with respect to this lattice.

- If ``to_curve`` is True, the point `(x-b_2/12,y-(a_1(x-b_2/12)-a_3)/2)`
as a point in `E(\RR)` or `E(\CC)`, with `(x,y) = (\wp(z),\wp'(z))` as above.

If the lattice is real...
```

* The comment

```
       # the next lines compute [P(w), P'(w)] when flag=1
       # or [x:y:1] in E(C) when flag=2
```
 seems to refer to old code.

* Is there a good reason to distinguish between QQ and general number fields?  The number-field code seems simpler, so you could consider removing the special-case code for QQ.

* lines 1503 and 1530: `C(t.real().python(),t.imag().python())` can be simplified as `C(t)`.

* it doesn't work for the point at infinity (and there should be a doctest for that case anyway):

```
sage: E = EllipticCurve([1,1,1,-8,6])
sage: L = E.period_lattice()
sage: L.elliptic_exponential(0)
---------------------------------------------------------------------------
UnboundLocalError                         Traceback (most recent call last)

/usr/local/src/pari/src/<ipython console> in <module>()

/usr/local/src/sage-4.6.alpha1/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/period_lattice.pyc in elliptic_exponential(self, z, to_curve)
   1476         if self.coordinates(z) == self.coordinates(z, rounding='round'):
   1477             if to_curve:
-> 1478                 return E.change_ring(C)(0)
   1479             return (C('+infinity'),C('+infinity'))
   1480

UnboundLocalError: local variable 'E' referenced before assignment
```



---

archive/issue_comments_102343.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2010-09-30T09:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102343",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_102344.json:
```json
{
    "body": "<a id='comment:24'></a>\nAlso, there is trouble with points which are very close to the point af infinity:\n\n```\nsage: K.<a> = QuadraticField(-1)\nsage: E = EllipticCurve([0,0,0,a,0])\nsage: L = E.period_lattice(K.complex_embeddings()[0])\nsage: L.elliptic_exponential(1e-100)\n---------------------------------------------------------------------------\nPariError                                 Traceback (most recent call last)\n\n/home/jdemeyer/<ipython console> in <module>()\n\n/usr/local/src/sage-4.6.alpha1/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/period_lattice.pyc in elliptic_exponential(self, z, to_curve)\n   1527         # the same precision as the input.\n   1528\n-> 1529         x,y = pari(self.basis(prec=prec)).ellwp(w,flag=1)\n   1530         x,y = [C(t) for t in (x,y)]\n   1531\n\n/usr/local/src/sage-4.6.alpha1/local/lib/python2.6/site-packages/sage/libs/pari/gen.so in sage.libs.pari.gen._pari_trap (sage/libs/pari/gen.c:45047)()\n\nPariError: division by zero (27)\n```",
    "created_at": "2010-09-30T09:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102344",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
Also, there is trouble with points which are very close to the point af infinity:

```
sage: K.<a> = QuadraticField(-1)
sage: E = EllipticCurve([0,0,0,a,0])
sage: L = E.period_lattice(K.complex_embeddings()[0])
sage: L.elliptic_exponential(1e-100)
---------------------------------------------------------------------------
PariError                                 Traceback (most recent call last)

/home/jdemeyer/<ipython console> in <module>()

/usr/local/src/sage-4.6.alpha1/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/period_lattice.pyc in elliptic_exponential(self, z, to_curve)
   1527         # the same precision as the input.
   1528
-> 1529         x,y = pari(self.basis(prec=prec)).ellwp(w,flag=1)
   1530         x,y = [C(t) for t in (x,y)]
   1531

/usr/local/src/sage-4.6.alpha1/local/lib/python2.6/site-packages/sage/libs/pari/gen.so in sage.libs.pari.gen._pari_trap (sage/libs/pari/gen.c:45047)()

PariError: division by zero (27)
```



---

archive/issue_comments_102345.json:
```json
{
    "body": "<a id='comment:25'></a>\nThanks for the comments, I will revise the patch accordingly.  The very last point (evaluation when z is very small but not zero) will not be easy though.  I think that I left in the special code for QQ since it was faster, but I may be mixing this up with the (harder!) elliptic logarithm.",
    "created_at": "2010-09-30T10:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102345",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:25'></a>
Thanks for the comments, I will revise the patch accordingly.  The very last point (evaluation when z is very small but not zero) will not be easy though.  I think that I left in the special code for QQ since it was faster, but I may be mixing this up with the (harder!) elliptic logarithm.



---

archive/issue_comments_102346.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [cremona](#comment%3A25):\n> Thanks for the comments, I will revise the patch accordingly.  The very last point (evaluation when z is very small but not zero) will not be easy though.\n\n\nYou could use `try:`/`except PariError:` for this.  The only problem is that currently, you cannot easily check in Python whether a PariError is a division by zero or something else.",
    "created_at": "2010-09-30T15:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102346",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
Replying to [cremona](#comment%3A25):
> Thanks for the comments, I will revise the patch accordingly.  The very last point (evaluation when z is very small but not zero) will not be easy though.


You could use `try:`/`except PariError:` for this.  The only problem is that currently, you cannot easily check in Python whether a PariError is a division by zero or something else.



---

archive/issue_comments_102347.json:
```json
{
    "body": "<a id='comment:27'></a>\nIt's ok, I have fixed it and the only reason I have not yet upadted the patch is that I am getting lots of failures in heegner.py -- not for the first time.  Several of the doctests there are not very well designed, so I may complain to Robert Bradshaw if I cannot fix them all!",
    "created_at": "2010-09-30T16:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102347",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:27'></a>
It's ok, I have fixed it and the only reason I have not yet upadted the patch is that I am getting lots of failures in heegner.py -- not for the first time.  Several of the doctests there are not very well designed, so I may complain to Robert Bradshaw if I cannot fix them all!



---

archive/issue_comments_102348.json:
```json
{
    "body": "<a id='comment:28'></a>\n8820_rebase_after_9931-new.patch adresses the doctest failures in heegner.py.  I did this quite carefully (even refining a little the code which does the modular parametrization).  I took account where sensible of Chris's remark that it is better in approximate doctests not to have numbers which are approximately zero;  but when the output is an approximate integral Heegner point one cannot easily change the point.  I hope reviewer(s) do not object to the various ways I found  around this -- with very little use of ... and none (I think) of #random.\n\nNote that these Heegner examples are often going to be problematical since in many cases the point computed is approximately (0:1:0), i.e. the z in CC is approximately a period.  In such examples it might be better just to output E.period_lattice().coordinates(z) rather than E.elliptic_exponential(z).  However, I have adjusted the test for being integral (i.e. for z to b in the period lattice) in a way that I hope is a reasonable compromise:   namely that the coordinates w.r.t. the lattice basis should be approximately integral in the sense that their fractional part is at most `2^(0.8*prec)`.",
    "created_at": "2010-10-03T12:15:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102348",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:28'></a>
8820_rebase_after_9931-new.patch adresses the doctest failures in heegner.py.  I did this quite carefully (even refining a little the code which does the modular parametrization).  I took account where sensible of Chris's remark that it is better in approximate doctests not to have numbers which are approximately zero;  but when the output is an approximate integral Heegner point one cannot easily change the point.  I hope reviewer(s) do not object to the various ways I found  around this -- with very little use of ... and none (I think) of #random.

Note that these Heegner examples are often going to be problematical since in many cases the point computed is approximately (0:1:0), i.e. the z in CC is approximately a period.  In such examples it might be better just to output E.period_lattice().coordinates(z) rather than E.elliptic_exponential(z).  However, I have adjusted the test for being integral (i.e. for z to b in the period lattice) in a way that I hope is a reasonable compromise:   namely that the coordinates w.r.t. the lattice basis should be approximately integral in the sense that their fractional part is at most `2^(0.8*prec)`.



---

archive/issue_comments_102349.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-10-03T12:15:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102349",
    "user": "https://github.com/JohnCremona"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_102350.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [cremona](#comment%3A28):\n> However, I have adjusted the test for being integral (i.e. for z to b in the period lattice) in a way that I hope is a reasonable compromise:   namely that the coordinates w.r.t. the lattice basis should be approximately integral in the sense that their fractional part is at most `2^(0.8*prec)`.\n\n\nI like this solution. The `elliptic_exponential()` code looks fine to me.  However, I would like somebody else to review the heegner stuff.\n\nOne small suggestion: the doctest for `elliptic_exponential()` is quite long, so I would separate it in an `EXAMPLES` part and a `TESTS` part.",
    "created_at": "2010-10-03T15:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102350",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>
Replying to [cremona](#comment%3A28):
> However, I have adjusted the test for being integral (i.e. for z to b in the period lattice) in a way that I hope is a reasonable compromise:   namely that the coordinates w.r.t. the lattice basis should be approximately integral in the sense that their fractional part is at most `2^(0.8*prec)`.


I like this solution. The `elliptic_exponential()` code looks fine to me.  However, I would like somebody else to review the heegner stuff.

One small suggestion: the doctest for `elliptic_exponential()` is quite long, so I would separate it in an `EXAMPLES` part and a `TESTS` part.



---

archive/issue_comments_102351.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [cremona](#comment%3A28):\n> I took account where sensible of Chris's remark that it is better in approximate doctests not to have numbers which are approximately zero\n\n\nWell, my **personal opinion** on this differs a bit.  I think we should remember that doctests not only serve as tests, but also as documentation.  I think it is always a difficult excercise to balance these two.  For me personally, the balance always goes in favour of documentation.  When needed, one can still add true tests in a `TESTS` section of a doctest.",
    "created_at": "2010-10-03T16:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102351",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>
Replying to [cremona](#comment%3A28):
> I took account where sensible of Chris's remark that it is better in approximate doctests not to have numbers which are approximately zero


Well, my **personal opinion** on this differs a bit.  I think we should remember that doctests not only serve as tests, but also as documentation.  I think it is always a difficult excercise to balance these two.  For me personally, the balance always goes in favour of documentation.  When needed, one can still add true tests in a `TESTS` section of a doctest.



---

archive/issue_comments_102352.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [jdemeyer](#comment%3A30):\n> Replying to [cremona](#comment%3A28):\n> > I took account where sensible of Chris's remark that it is better in approximate doctests not to have numbers which are approximately zero\n\n> \n> Well, my **personal opinion** on this differs a bit.  I think we should remember that doctests not only serve as tests, but also as documentation.  I think it is always a difficult excercise to balance these two.  For me personally, the balance always goes in favour of documentation.  When needed, one can still add true tests in a `TESTS` section of a doctest.\n\n\nFair enough.  In the heegner file, which I did not write any of, I did not want to re-think documentation/tests from scratch, although that might be a good idea;  I just wanted to get things to work!  (And I would not have had to do anything, I think, if I had not followed the suggestion to eliminate the specific QQ code from elliptic_exponential.)",
    "created_at": "2010-10-03T16:19:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102352",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:31'></a>
Replying to [jdemeyer](#comment%3A30):
> Replying to [cremona](#comment%3A28):
> > I took account where sensible of Chris's remark that it is better in approximate doctests not to have numbers which are approximately zero

> 
> Well, my **personal opinion** on this differs a bit.  I think we should remember that doctests not only serve as tests, but also as documentation.  I think it is always a difficult excercise to balance these two.  For me personally, the balance always goes in favour of documentation.  When needed, one can still add true tests in a `TESTS` section of a doctest.


Fair enough.  In the heegner file, which I did not write any of, I did not want to re-think documentation/tests from scratch, although that might be a good idea;  I just wanted to get things to work!  (And I would not have had to do anything, I think, if I had not followed the suggestion to eliminate the specific QQ code from elliptic_exponential.)



---

archive/issue_comments_102353.json:
```json
{
    "body": "<a id='comment:32'></a>\nI give all the changes to heegner.py in the patch \"8820_rebase_after_9931-new.patch\" a positive review.",
    "created_at": "2010-10-04T23:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102353",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:32'></a>
I give all the changes to heegner.py in the patch "8820_rebase_after_9931-new.patch" a positive review.



---

archive/issue_comments_102354.json:
```json
{
    "body": "<a id='comment:33'></a>\nYou beat me to it :). Looks fine by me too.",
    "created_at": "2010-10-05T04:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102354",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:33'></a>
You beat me to it :). Looks fine by me too.



---

archive/issue_comments_102355.json:
```json
{
    "body": "<a id='comment:34'></a>\nThere is a doctest failure on a 32-bit machine:\n\n```\nsage -t -long \"devel/sage/sage/schemes/elliptic_curves/heegner.py\"\n**********************************************************************\nFile \"/Users/jdemeyer/sage-4.6.alpha2/devel/sage/sage/schemes/elliptic_curves/heegner.py\", line 3048:\n    sage: P = E.heegner_point(-19); y = P._trace_numerical_conductor_1(); [c.real() for c in y]\nExpected:\n    [-1.26165722088693e-16, -1.00000000000000, 1.00000000000000]\nGot:\n    [-1.26126537554300e-16, -1.00000000000000, 1.00000000000000]\n**********************************************************************\n```\n\nWhen this is fixed (just write -1.261...), this ticket can finally gets its positive_review.",
    "created_at": "2010-10-05T07:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102355",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'></a>
There is a doctest failure on a 32-bit machine:

```
sage -t -long "devel/sage/sage/schemes/elliptic_curves/heegner.py"
**********************************************************************
File "/Users/jdemeyer/sage-4.6.alpha2/devel/sage/sage/schemes/elliptic_curves/heegner.py", line 3048:
    sage: P = E.heegner_point(-19); y = P._trace_numerical_conductor_1(); [c.real() for c in y]
Expected:
    [-1.26165722088693e-16, -1.00000000000000, 1.00000000000000]
Got:
    [-1.26126537554300e-16, -1.00000000000000, 1.00000000000000]
**********************************************************************
```

When this is fixed (just write -1.261...), this ticket can finally gets its positive_review.



---

archive/issue_comments_102356.json:
```json
{
    "body": "replaces previous",
    "created_at": "2010-10-05T08:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102356",
    "user": "https://github.com/JohnCremona"
}
```

replaces previous



---

archive/issue_comments_102357.json:
```json
{
    "body": "<a id='comment:35'></a>\nAttachment [8820_rebase_after_9931-new.patch](tarball://root/attachments/some-uuid/ticket8820/8820_rebase_after_9931-new.patch) by @JohnCremona created at 2010-10-05 08:30:57\n\nThanks to all, and apologies for missing that one.  I have changed the patch as suggested and just tested it on a 32-bit machine as well as a 64-bit.\n\nThat failing test is exactly the kind of thing it would be nice to avoid altogether in doctests, since the \"true\" value of the x-coordinate is 0, so all nonzero digits, and the sign, are completely spurious.\n\nJeroen, if you are happy with this now could you mark it as \"positive review\"?  Thanks.\n\nRelease manager: only the last patch is to be applied.",
    "created_at": "2010-10-05T08:30:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102357",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:35'></a>
Attachment [8820_rebase_after_9931-new.patch](tarball://root/attachments/some-uuid/ticket8820/8820_rebase_after_9931-new.patch) by @JohnCremona created at 2010-10-05 08:30:57

Thanks to all, and apologies for missing that one.  I have changed the patch as suggested and just tested it on a 32-bit machine as well as a 64-bit.

That failing test is exactly the kind of thing it would be nice to avoid altogether in doctests, since the "true" value of the x-coordinate is 0, so all nonzero digits, and the sign, are completely spurious.

Jeroen, if you are happy with this now could you mark it as "positive review"?  Thanks.

Release manager: only the last patch is to be applied.



---

archive/issue_comments_102358.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2010-10-05T20:41:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102358",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_102359.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2010-10-06T03:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102359",
    "user": "https://github.com/qed777"
}
```

**Resolution:** fixed



---

archive/issue_events_026542.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-10-06T03:17:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8820#event-26542"
}
```



---

archive/issue_comments_102360.json:
```json
{
    "body": "**Merged:** sage-4.6.alpha3",
    "created_at": "2010-10-06T03:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8820#issuecomment-102360",
    "user": "https://github.com/qed777"
}
```

**Merged:** sage-4.6.alpha3
