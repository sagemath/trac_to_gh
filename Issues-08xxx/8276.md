# Issue 8276: Make the one(), identity_matrix() and zero_matrix() cached and immutable

archive/issues_008276.json:
```json
{
    "assignees": [],
    "body": "After I found the following bug, it was decided on sage-devel that in a `MatrixSpace` the methods `.one()`, `.identity_matrix()` and `.zero_matrix()` should returns a cached immutable matrix. I had to update sage's library accordingly. \n\n```\nsage: A = MatrixSpace(ZZ, 3)\nsage: A.one()\n[1 0 0]\n[0 1 0]\n[0 0 1]\nsage: A.one()[1,2] = 1\nsage: A.one()\n[1 0 0]\n[0 1 1]\n[0 0 1]\n```\n\nSo here is now the current behavior:\n\n```\nsage: MM = MatrixSpace(ZZ, 3,3)\nsage: MM(0).is_mutable()\nTrue\nsage: MM.zero_matrix().is_mutable()\nFalse\nsage: MM(1).is_mutable()\nTrue\nsage: MM.identity_matrix().is_mutable()\nFalse\n```\n\nNote that calling `MM(0)` or `MM(1)` was a bad idea:\n\n```\nsage: timeit(\"MM(0)\")\n625 loops, best of 3: 72.4 \u00b5s per loop\nsage: timeit(\"copy(MM.zero_matrix())\")\n625 loops, best of 3: 15.6 \u00b5s per loop\n```\nAnd for identity:\n\n```\nsage: timeit(\"MM(1)\")\n625 loops, best of 3: 67.4 \u00b5s per loop\nsage: timeit(\"copy(MM.identity_matrix())\")\n625 loops, best of 3: 41.1 \u00b5s per loop\n```\nI took the chance to optimize those. The extra cost of calling `MM()` or `M(0)` instead of `copy(MM.zero_matrix())` is now very small. \n\n**Assignee:** @hivert\n\n**CC:**  mraum\n\n**Keywords:** One Zero mutable.\n\n**Author:** Florent Hivert\n\n**Reviewer:** Martin Raum, Ross Kyprianou\n\n**Merged:** sage-4.3.4.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/8276\n\n",
    "closed_at": "2010-03-03T14:30:36Z",
    "created_at": "2010-02-15T20:49:35Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make the one(), identity_matrix() and zero_matrix() cached and immutable",
    "type": "issue",
    "updated_at": "2010-03-03T14:30:36Z",
    "url": "https://github.com/sagemath/sage/issues/8276",
    "user": "https://github.com/hivert"
}
```
After I found the following bug, it was decided on sage-devel that in a `MatrixSpace` the methods `.one()`, `.identity_matrix()` and `.zero_matrix()` should returns a cached immutable matrix. I had to update sage's library accordingly. 

```
sage: A = MatrixSpace(ZZ, 3)
sage: A.one()
[1 0 0]
[0 1 0]
[0 0 1]
sage: A.one()[1,2] = 1
sage: A.one()
[1 0 0]
[0 1 1]
[0 0 1]
```

So here is now the current behavior:

```
sage: MM = MatrixSpace(ZZ, 3,3)
sage: MM(0).is_mutable()
True
sage: MM.zero_matrix().is_mutable()
False
sage: MM(1).is_mutable()
True
sage: MM.identity_matrix().is_mutable()
False
```

Note that calling `MM(0)` or `MM(1)` was a bad idea:

```
sage: timeit("MM(0)")
625 loops, best of 3: 72.4 µs per loop
sage: timeit("copy(MM.zero_matrix())")
625 loops, best of 3: 15.6 µs per loop
```
And for identity:

```
sage: timeit("MM(1)")
625 loops, best of 3: 67.4 µs per loop
sage: timeit("copy(MM.identity_matrix())")
625 loops, best of 3: 41.1 µs per loop
```
I took the chance to optimize those. The extra cost of calling `MM()` or `M(0)` instead of `copy(MM.zero_matrix())` is now very small. 

**Assignee:** @hivert

**CC:**  mraum

**Keywords:** One Zero mutable.

**Author:** Florent Hivert

**Reviewer:** Martin Raum, Ross Kyprianou

**Merged:** sage-4.3.4.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/8276





---

archive/issue_events_057948.json:
```json
{
    "actor": "https://github.com/hivert",
    "created_at": "2010-02-16T22:15:55Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "rename": {
        "from": "The one of MatrixSpace can be changed !",
        "to": "Make the one(), identity_matrix() and zero_matrix() cached and immutable."
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8276#event-57948"
}
```



---

archive/issue_comments_066138.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,4 @@\n+After I found the following bug, it was decided on sage-devel that in a `MatrixSpace` the methods `.one()`, `.identity_matrix()` and `.zero_matrix()` should returns a cached immutable matrix. I had to update sage's library accordingly. \n \n ```\n sage: A = MatrixSpace(ZZ, 3)\n@@ -11,4 +12,3 @@\n [0 1 1]\n [0 0 1]\n ```\n-Indeed it is mutable an cached !\n``````\n",
    "created_at": "2010-02-16T22:15:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66138",
    "user": "https://github.com/hivert"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,4 @@
+After I found the following bug, it was decided on sage-devel that in a `MatrixSpace` the methods `.one()`, `.identity_matrix()` and `.zero_matrix()` should returns a cached immutable matrix. I had to update sage's library accordingly. 
 
 ```
 sage: A = MatrixSpace(ZZ, 3)
@@ -11,4 +12,3 @@
 [0 1 1]
 [0 0 1]
 ```
-Indeed it is mutable an cached !
``````




---

archive/issue_events_057949.json:
```json
{
    "actor": "https://github.com/hivert",
    "created_at": "2010-02-16T23:35:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8276#event-57949"
}
```



---

archive/issue_comments_066139.json:
```json
{
    "body": "<a id='comment:2'></a>\nCorrecting MatrixSpace is easy, however there are a lot of places in sage where people create a matrix from the one or zero and modify it after that. I nearly corrected all these occurences. However, I'm stuck with those three files which are very complicated and depend one of each other:\n\n```\n    sage/modular/quatalg/brandt.py\n    sage/algebras/quatalg/quaternion_algebra.py\n    sage/schemes/elliptic_curves/heegner.py\n```\nThere are a lot of error but I can't find where it's coming from. I really\ncould use the help of a specialist. \n\nApply the patch in the following order:\n\n```\n    trac_8276-MatrixSpace_one-fh.patch\n    trac_8276-fix_sagelib-fh.patch\n```\nThanks for any suggestion.",
    "created_at": "2010-02-16T23:35:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66139",
    "user": "https://github.com/hivert"
}
```

<a id='comment:2'></a>
Correcting MatrixSpace is easy, however there are a lot of places in sage where people create a matrix from the one or zero and modify it after that. I nearly corrected all these occurences. However, I'm stuck with those three files which are very complicated and depend one of each other:

```
    sage/modular/quatalg/brandt.py
    sage/algebras/quatalg/quaternion_algebra.py
    sage/schemes/elliptic_curves/heegner.py
```
There are a lot of error but I can't find where it's coming from. I really
could use the help of a specialist. 

Apply the patch in the following order:

```
    trac_8276-MatrixSpace_one-fh.patch
    trac_8276-fix_sagelib-fh.patch
```
Thanks for any suggestion.



---

archive/issue_comments_066140.json:
```json
{
    "body": "**Attachment:** [trac_8276-fix_sagelib-fh.2.patch.gz](https://github.com/sagemath/sage/files/ticket8276/trac_8276-fix_sagelib-fh.2.patch.gz)",
    "created_at": "2010-02-16T23:54:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66140",
    "user": "https://github.com/hivert"
}
```

**Attachment:** [trac_8276-fix_sagelib-fh.2.patch.gz](https://github.com/sagemath/sage/files/ticket8276/trac_8276-fix_sagelib-fh.2.patch.gz)



---

archive/issue_comments_066141.json:
```json
{
    "body": "<a id='comment:3'></a>\nI finally manage to get those !!! It should be ready for review. Apply\n\n```\n    trac_8276-MatrixSpace_one-fh.patch\n    trac_8276-fix_sagelib-fh.2.patch\n```\n\nFlorent",
    "created_at": "2010-02-16T23:56:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66141",
    "user": "https://github.com/hivert"
}
```

<a id='comment:3'></a>
I finally manage to get those !!! It should be ready for review. Apply

```
    trac_8276-MatrixSpace_one-fh.patch
    trac_8276-fix_sagelib-fh.2.patch
```

Florent



---

archive/issue_events_057950.json:
```json
{
    "actor": "https://github.com/hivert",
    "created_at": "2010-02-16T23:56:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8276#event-57950"
}
```



---

archive/issue_events_057951.json:
```json
{
    "actor": "https://github.com/hivert",
    "created_at": "2010-02-16T23:56:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8276#event-57951"
}
```



---

archive/issue_comments_066142.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -12,3 +12,33 @@\n [0 1 1]\n [0 0 1]\n ```\n+\n+So here is now the current behavior:\n+\n+```\n+sage: MM = MatrixSpace(ZZ, 3,3)\n+sage: MM(0).is_mutable()\n+True\n+sage: MM.zero_matrix().is_mutable()\n+False\n+sage: MM(1).is_mutable()\n+True\n+sage: MM.identity_matrix().is_mutable()\n+False\n+```\n+Note that calling `MM(0)` or `MM(1)` is a bad idea:\n+\n+```\n+sage: timeit(\"MM(0)\")\n+625 loops, best of 3: 72.4 \u00b5s per loop\n+sage: timeit(\"copy(MM.zero_matrix())\")\n+625 loops, best of 3: 15.6 \u00b5s per loop\n+```\n+And for identity:\n+\n+```\n+sage: timeit(\"MM(1)\")\n+625 loops, best of 3: 67.4 \u00b5s per loop\n+sage: timeit(\"copy(MM.identity_matrix())\")\n+625 loops, best of 3: 41.1 \u00b5s per loop\n+```\n``````\n",
    "created_at": "2010-02-17T09:56:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66142",
    "user": "https://github.com/hivert"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -12,3 +12,33 @@
 [0 1 1]
 [0 0 1]
 ```
+
+So here is now the current behavior:
+
+```
+sage: MM = MatrixSpace(ZZ, 3,3)
+sage: MM(0).is_mutable()
+True
+sage: MM.zero_matrix().is_mutable()
+False
+sage: MM(1).is_mutable()
+True
+sage: MM.identity_matrix().is_mutable()
+False
+```
+Note that calling `MM(0)` or `MM(1)` is a bad idea:
+
+```
+sage: timeit("MM(0)")
+625 loops, best of 3: 72.4 µs per loop
+sage: timeit("copy(MM.zero_matrix())")
+625 loops, best of 3: 15.6 µs per loop
+```
+And for identity:
+
+```
+sage: timeit("MM(1)")
+625 loops, best of 3: 67.4 µs per loop
+sage: timeit("copy(MM.identity_matrix())")
+625 loops, best of 3: 41.1 µs per loop
+```
``````




---

archive/issue_comments_066143.json:
```json
{
    "body": "<a id='comment:5'></a>\nI just added a third patch which fixes a non working optimization when creating the zero matrix from `MS(0)` or `MS()`. They are now nearly as fast as calling `copy(MS.zero_matrix())`.\n\nApply this patch after the two others.",
    "created_at": "2010-02-17T10:43:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66143",
    "user": "https://github.com/hivert"
}
```

<a id='comment:5'></a>
I just added a third patch which fixes a non working optimization when creating the zero matrix from `MS(0)` or `MS()`. They are now nearly as fast as calling `copy(MS.zero_matrix())`.

Apply this patch after the two others.



---

archive/issue_events_057952.json:
```json
{
    "actor": "https://github.com/hivert",
    "created_at": "2010-02-17T11:04:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebra",
    "label_color": "08517b",
    "label_name": "component: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8276#event-57952"
}
```



---

archive/issue_events_057953.json:
```json
{
    "actor": "https://github.com/hivert",
    "created_at": "2010-02-17T11:04:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20linear%20algebra",
    "label_color": "08517b",
    "label_name": "component: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8276#event-57953"
}
```



---

archive/issue_events_057954.json:
```json
{
    "actor": "https://github.com/hivert",
    "created_at": "2010-02-17T11:17:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8276#event-57954"
}
```



---

archive/issue_events_057955.json:
```json
{
    "actor": "https://github.com/hivert",
    "created_at": "2010-02-17T11:17:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8276#event-57955"
}
```



---

archive/issue_comments_066144.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe last improvement patch breaks something...",
    "created_at": "2010-02-17T11:17:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66144",
    "user": "https://github.com/hivert"
}
```

<a id='comment:7'></a>
The last improvement patch breaks something...



---

archive/issue_comments_066145.json:
```json
{
    "body": "**Attachment:** [trac_8276-MatrixSpace_one-fh.patch.gz](https://github.com/sagemath/sage/files/ticket8276/trac_8276-MatrixSpace_one-fh.patch.gz)\n\n**Attachment:** [trac_8276-fix_sagelib-fh.patch.gz](https://github.com/sagemath/sage/files/ticket8276/trac_8276-fix_sagelib-fh.patch.gz)",
    "created_at": "2010-02-17T17:54:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66145",
    "user": "https://github.com/hivert"
}
```

**Attachment:** [trac_8276-MatrixSpace_one-fh.patch.gz](https://github.com/sagemath/sage/files/ticket8276/trac_8276-MatrixSpace_one-fh.patch.gz)

**Attachment:** [trac_8276-fix_sagelib-fh.patch.gz](https://github.com/sagemath/sage/files/ticket8276/trac_8276-fix_sagelib-fh.patch.gz)



---

archive/issue_comments_066146.json:
```json
{
    "body": "<a id='comment:8'></a>\nAt last thing should be OK ! Please apply in the following order:\n\n```\ntrac_8276-MatrixSpace_one-fh.patch\ntrac_8276-fix_sagelib-fh.patch\ntrac_8276-fix_zero_matrix_creation-fh.patch\n```\nDepends on #8294\n\nThe first patch makes the matrices immutable, the second one fixes Sage's lib accordingly the thirds patch simplifies and optimizes the creation of the zero matrix.",
    "created_at": "2010-02-17T18:09:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66146",
    "user": "https://github.com/hivert"
}
```

<a id='comment:8'></a>
At last thing should be OK ! Please apply in the following order:

```
trac_8276-MatrixSpace_one-fh.patch
trac_8276-fix_sagelib-fh.patch
trac_8276-fix_zero_matrix_creation-fh.patch
```
Depends on #8294

The first patch makes the matrices immutable, the second one fixes Sage's lib accordingly the thirds patch simplifies and optimizes the creation of the zero matrix.



---

archive/issue_events_057956.json:
```json
{
    "actor": "https://github.com/hivert",
    "created_at": "2010-02-17T18:09:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8276#event-57956"
}
```



---

archive/issue_events_057957.json:
```json
{
    "actor": "https://github.com/hivert",
    "created_at": "2010-02-17T18:09:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8276#event-57957"
}
```



---

archive/issue_comments_066147.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -26,7 +26,8 @@\n sage: MM.identity_matrix().is_mutable()\n False\n ```\n-Note that calling `MM(0)` or `MM(1)` is a bad idea:\n+\n+Note that calling `MM(0)` or `MM(1)` was a bad idea:\n \n ```\n sage: timeit(\"MM(0)\")\n@@ -42,3 +43,4 @@\n sage: timeit(\"copy(MM.identity_matrix())\")\n 625 loops, best of 3: 41.1 \u00b5s per loop\n ```\n+I took the chance to optimize those. The extra cost of calling `MM()` or `M(0)` instead of `copy(MM.zero_matrix())` is now very small. \n``````\n",
    "created_at": "2010-02-17T18:18:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66147",
    "user": "https://github.com/hivert"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -26,7 +26,8 @@
 sage: MM.identity_matrix().is_mutable()
 False
 ```
-Note that calling `MM(0)` or `MM(1)` is a bad idea:
+
+Note that calling `MM(0)` or `MM(1)` was a bad idea:
 
 ```
 sage: timeit("MM(0)")
@@ -42,3 +43,4 @@
 sage: timeit("copy(MM.identity_matrix())")
 625 loops, best of 3: 41.1 µs per loop
 ```
+I took the chance to optimize those. The extra cost of calling `MM()` or `M(0)` instead of `copy(MM.zero_matrix())` is now very small. 
``````




---

archive/issue_comments_066148.json:
```json
{
    "body": "**Attachment:** [trac_8276-fix_zero_matrix_creation-fh.patch.gz](https://github.com/sagemath/sage/files/ticket8276/trac_8276-fix_zero_matrix_creation-fh.patch.gz)",
    "created_at": "2010-02-20T13:55:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66148",
    "user": "https://github.com/hivert"
}
```

**Attachment:** [trac_8276-fix_zero_matrix_creation-fh.patch.gz](https://github.com/sagemath/sage/files/ticket8276/trac_8276-fix_zero_matrix_creation-fh.patch.gz)



---

archive/issue_comments_066149.json:
```json
{
    "body": "<a id='comment:10'></a>\nOups ! I just realize I forgot to reupload `trac_8276-fix_zero_matrix_creation-fh.patch` after a last minor change. Many apologies if you started to review ! For info here is the changelog between the two last version of the patch\n\n```\n    2.31 @@ -85,6 +85,8 @@\n    2.32               []\n    2.33  +            sage: mat.is_mutable()\n    2.34  +            False\n    2.35 ++            sage: MM.zero().is_mutable()\n    2.36 ++            False\n    2.37           \"\"\"\n    2.38  -        try:\n    2.39  -            z = self.__zero_matrix\n    2.40 @@ -98,6 +100,8 @@\n    2.41  +        res.set_immutable()\n    2.42  +        return res\n    2.43  +\n    2.44 ++    zero = zero_matrix\n    2.45 ++\n    2.46       def ngens(self):\n    2.47           \"\"\"\n    2.48           Return the number of generators of this matrix space,\n```\nAgain, sorry for any inconvenience.\n\nFlorent",
    "created_at": "2010-02-20T13:59:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66149",
    "user": "https://github.com/hivert"
}
```

<a id='comment:10'></a>
Oups ! I just realize I forgot to reupload `trac_8276-fix_zero_matrix_creation-fh.patch` after a last minor change. Many apologies if you started to review ! For info here is the changelog between the two last version of the patch

```
    2.31 @@ -85,6 +85,8 @@
    2.32               []
    2.33  +            sage: mat.is_mutable()
    2.34  +            False
    2.35 ++            sage: MM.zero().is_mutable()
    2.36 ++            False
    2.37           """
    2.38  -        try:
    2.39  -            z = self.__zero_matrix
    2.40 @@ -98,6 +100,8 @@
    2.41  +        res.set_immutable()
    2.42  +        return res
    2.43  +
    2.44 ++    zero = zero_matrix
    2.45 ++
    2.46       def ngens(self):
    2.47           """
    2.48           Return the number of generators of this matrix space,
```
Again, sorry for any inconvenience.

Florent



---

archive/issue_comments_066150.json:
```json
{
    "body": "<a id='comment:11'></a>\nMartin Raum: I understand from #8294 that you intend to review this ticket quickly ! I allowed myself to put you in CC of this ticket ! Please make sure that you have the latest version of `trac_8276-fix_zero_matrix_creation-fh.patch`. I forgot to reupload it after a last change (see my previous message). \n\nThanks for your help !",
    "created_at": "2010-02-20T14:06:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66150",
    "user": "https://github.com/hivert"
}
```

<a id='comment:11'></a>
Martin Raum: I understand from #8294 that you intend to review this ticket quickly ! I allowed myself to put you in CC of this ticket ! Please make sure that you have the latest version of `trac_8276-fix_zero_matrix_creation-fh.patch`. I forgot to reupload it after a last change (see my previous message). 

Thanks for your help !



---

archive/issue_comments_066151.json:
```json
{
    "body": "<a id='comment:12'></a>\nApplied the following patches (in the order below).\n\n\ntrac_8276-MatrixSpace_one-fh.patch\n\n\ntrac_8276-fix_sagelib-fh.patch\n\n\ntrac_8276-fix_zero_matrix_creation-fh.patch\n\n\ntrac_8294-matrix_2x2_copy_mutability_fix-fh.patch\n\n\n*Almost* everything seems straightforward and correct but... Seems that MM(0) which has a \"mutable == True\" property/value should be updatable but the example \"MM(0)[1,2] = 3\" doesnt update MM(0) (see example below) Is that right?\n\n\n```\n# prepatch responses\nsage: sage: MM = MatrixSpace(ZZ, 3,3)\nsage: sage: MM(0).is_mutable()\nTrue\nsage: sage: MM.zero_matrix().is_mutable()\nTrue\nsage: sage: MM(1).is_mutable()\nTrue\nsage: sage: MM.identity_matrix().is_mutable()\nTrue\nsage: sage: timeit(\"MM(0)\")\n625 loops, best of 3: 51.1 \u00b5s per loop\nsage: sage: timeit(\"copy(MM.zero_matrix())\")\n625 loops, best of 3: 19.3 \u00b5s per loop\nsage: sage: timeit(\"MM(1)\")\n625 loops, best of 3: 65 \u00b5s per loop\nsage: sage: timeit(\"copy(MM.identity_matrix())\")\n625 loops, best of 3: 60.7 \u00b5s per loop\n\n# postpatch responses\nsage: MM = MatrixSpace(ZZ, 3,3)\nsage: MM(0).is_mutable()\nTrue\nsage: MM.zero_matrix().is_mutable()\nFalse\nsage: MM(1).is_mutable()\nTrue\nsage: MM.identity_matrix().is_mutable()\nFalse\nsage: timeit(\"MM(0)\")\n625 loops, best of 3: 35.9 \u00b5s per loop\nsage: timeit(\"copy(MM.zero_matrix())\")\n625 loops, best of 3: 29.3 \u00b5s per loop\nsage: timeit(\"MM(1)\")\n625 loops, best of 3: 46.1 \u00b5s per loop\nsage: timeit(\"copy(MM.identity_matrix())\")\n625 loops, best of 3: 29.9 \u00b5s per loop\n\nsage: MM(0)\n[0 0 0]\n[0 0 0]\n[0 0 0]\n\nsage: MM(0)[1,2]=3 \n\n# this behavior is the same before and after patches were applied\n# is this right? isnt MM(0) mutable and should be = 3 at row/col=[1,2]? \nsage: MM(0)\n[0 0 0]\n[0 0 0]\n[0 0 0]\n\nsage: MM.zero_matrix()[1,2]=3\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n/mnt/usb1/scratch/rossk/sage-4.3.3.alpha1-sage.math.washington.edu-x86_64-Linux/<ipython console> in <module>()\n/mnt/usb1/scratch/rossk/sage-4.3.3.alpha1-sage.math.washington.edu-x86_64-Linux/local/lib/python2.6/site-packages/sage/matrix/matrix0.so in sage.matrix.matrix0.Matrix.__setitem__ (sage/matrix/matrix0.c:5496)()\n/mnt/usb1/scratch/rossk/sage-4.3.3.alpha1-sage.math.washington.edu-x86_64-Linux/local/lib/python2.6/site-packages/sage/matrix/matrix0.so in sage.matrix.matrix0.Matrix.check_mutability (sage/matrix/matrix0.c:3686)()\nValueError: matrix is immutable; please change a copy instead (i.e., use copy(M) to change a copy of M).\n\n# a copy is mutable\nsage: a=copy(MM.zero_matrix())\nsage: a[1,2]=3\nsage: a\n[0 0 0]\n[0 0 3]\n[0 0 0]\n\n# here, alias_zero is pointing to same object hence it is also immutable and correctly crashes also\nsage: alias_zero = MM.zero_matrix()\nsage: alias_zero[1,2]=3\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n/mnt/usb1/scratch/rossk/sage-4.3.3.alpha1-sage.math.washington.edu-x86_64-Linux/<ipython console> in <module>()\n/mnt/usb1/scratch/rossk/sage-4.3.3.alpha1-sage.math.washington.edu-x86_64-Linux/local/lib/python2.6/site-packages/sage/matrix/matrix0.so in sage.matrix.matrix0.Matrix.__setitem__ (sage/matrix/matrix0.c:5496)()\n/mnt/usb1/scratch/rossk/sage-4.3.3.alpha1-sage.math.washington.edu-x86_64-Linux/local/lib/python2.6/site-packages/sage/matrix/matrix0.so in sage.matrix.matrix0.Matrix.check_mutability (sage/matrix/matrix0.c:3686)()\nValueError: matrix is immutable; please change a copy instead (i.e., use copy(M) to change a copy of M).\n\n```",
    "created_at": "2010-02-20T14:18:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66151",
    "user": "https://github.com/sagetrac-rossk"
}
```

<a id='comment:12'></a>
Applied the following patches (in the order below).


trac_8276-MatrixSpace_one-fh.patch


trac_8276-fix_sagelib-fh.patch


trac_8276-fix_zero_matrix_creation-fh.patch


trac_8294-matrix_2x2_copy_mutability_fix-fh.patch


*Almost* everything seems straightforward and correct but... Seems that MM(0) which has a "mutable == True" property/value should be updatable but the example "MM(0)[1,2] = 3" doesnt update MM(0) (see example below) Is that right?


```
# prepatch responses
sage: sage: MM = MatrixSpace(ZZ, 3,3)
sage: sage: MM(0).is_mutable()
True
sage: sage: MM.zero_matrix().is_mutable()
True
sage: sage: MM(1).is_mutable()
True
sage: sage: MM.identity_matrix().is_mutable()
True
sage: sage: timeit("MM(0)")
625 loops, best of 3: 51.1 µs per loop
sage: sage: timeit("copy(MM.zero_matrix())")
625 loops, best of 3: 19.3 µs per loop
sage: sage: timeit("MM(1)")
625 loops, best of 3: 65 µs per loop
sage: sage: timeit("copy(MM.identity_matrix())")
625 loops, best of 3: 60.7 µs per loop

# postpatch responses
sage: MM = MatrixSpace(ZZ, 3,3)
sage: MM(0).is_mutable()
True
sage: MM.zero_matrix().is_mutable()
False
sage: MM(1).is_mutable()
True
sage: MM.identity_matrix().is_mutable()
False
sage: timeit("MM(0)")
625 loops, best of 3: 35.9 µs per loop
sage: timeit("copy(MM.zero_matrix())")
625 loops, best of 3: 29.3 µs per loop
sage: timeit("MM(1)")
625 loops, best of 3: 46.1 µs per loop
sage: timeit("copy(MM.identity_matrix())")
625 loops, best of 3: 29.9 µs per loop

sage: MM(0)
[0 0 0]
[0 0 0]
[0 0 0]

sage: MM(0)[1,2]=3 

# this behavior is the same before and after patches were applied
# is this right? isnt MM(0) mutable and should be = 3 at row/col=[1,2]? 
sage: MM(0)
[0 0 0]
[0 0 0]
[0 0 0]

sage: MM.zero_matrix()[1,2]=3
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
/mnt/usb1/scratch/rossk/sage-4.3.3.alpha1-sage.math.washington.edu-x86_64-Linux/<ipython console> in <module>()
/mnt/usb1/scratch/rossk/sage-4.3.3.alpha1-sage.math.washington.edu-x86_64-Linux/local/lib/python2.6/site-packages/sage/matrix/matrix0.so in sage.matrix.matrix0.Matrix.__setitem__ (sage/matrix/matrix0.c:5496)()
/mnt/usb1/scratch/rossk/sage-4.3.3.alpha1-sage.math.washington.edu-x86_64-Linux/local/lib/python2.6/site-packages/sage/matrix/matrix0.so in sage.matrix.matrix0.Matrix.check_mutability (sage/matrix/matrix0.c:3686)()
ValueError: matrix is immutable; please change a copy instead (i.e., use copy(M) to change a copy of M).

# a copy is mutable
sage: a=copy(MM.zero_matrix())
sage: a[1,2]=3
sage: a
[0 0 0]
[0 0 3]
[0 0 0]

# here, alias_zero is pointing to same object hence it is also immutable and correctly crashes also
sage: alias_zero = MM.zero_matrix()
sage: alias_zero[1,2]=3
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/mnt/usb1/scratch/rossk/sage-4.3.3.alpha1-sage.math.washington.edu-x86_64-Linux/<ipython console> in <module>()
/mnt/usb1/scratch/rossk/sage-4.3.3.alpha1-sage.math.washington.edu-x86_64-Linux/local/lib/python2.6/site-packages/sage/matrix/matrix0.so in sage.matrix.matrix0.Matrix.__setitem__ (sage/matrix/matrix0.c:5496)()
/mnt/usb1/scratch/rossk/sage-4.3.3.alpha1-sage.math.washington.edu-x86_64-Linux/local/lib/python2.6/site-packages/sage/matrix/matrix0.so in sage.matrix.matrix0.Matrix.check_mutability (sage/matrix/matrix0.c:3686)()
ValueError: matrix is immutable; please change a copy instead (i.e., use copy(M) to change a copy of M).

```



---

archive/issue_comments_066152.json:
```json
{
    "body": "<a id='comment:13'></a>\nJust saw the \"updated patch\" reference. Will include replace old patch with new tomorrow and re-test",
    "created_at": "2010-02-20T14:21:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66152",
    "user": "https://github.com/sagetrac-rossk"
}
```

<a id='comment:13'></a>
Just saw the "updated patch" reference. Will include replace old patch with new tomorrow and re-test



---

archive/issue_comments_066153.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [rossk](#comment%3A12):\n> *Almost* everything seems straightforward and correct but... \n\nSure ! What wasn't straightforward was to correctly find all the places which needed to be patched and to distinguish them from those who doesn't.\n\nNote that the speed regression when calling `copy(MM.zero_matrix())` is due to a missing optimization in cached_method which should be added soon.\n\n> Seems that MM(0) which has a \"mutable == True\" property/value should be updatable but the example \"MM(0)[1,2] = 3\" doesnt update MM(0) (see example below) Is that right?\n\n```\n> sage: MM(0)\n> [0 0 0]\n> [0 0 0]\n> [0 0 0]\n> \n> sage: MM(0)[1,2]=3 \n> \n> # this behavior is the same before and after patches were applied\n> # is this right? isnt MM(0) mutable and should be = 3 at row/col=[1,2]? \n> sage: MM(0)\n> [0 0 0]\n> [0 0 0]\n> [0 0 0]\n```\nThis is perfectly normal. `MM(0)` does not design a particular matrix object. It construct a brand new matrix. So that \n\n```\nsage: MM(0)[1,2]=3\n``` \nConstruct a matrix, modify it and forget about the result so that the next call to\n`MM(0)` gives you a brand new zero matrix. To achieve what you want you should write\n\n```\nsage: MM = MatrixSpace(ZZ, 3,3)\nsage: mat = MM(0); mat[1,2]=3\nsage: mat\n[0 0 0]\n[0 0 3]\n[0 0 0]\n```\n\nFlorent",
    "created_at": "2010-02-20T14:51:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66153",
    "user": "https://github.com/hivert"
}
```

<a id='comment:14'></a>
Replying to [rossk](#comment%3A12):
> *Almost* everything seems straightforward and correct but... 

Sure ! What wasn't straightforward was to correctly find all the places which needed to be patched and to distinguish them from those who doesn't.

Note that the speed regression when calling `copy(MM.zero_matrix())` is due to a missing optimization in cached_method which should be added soon.

> Seems that MM(0) which has a "mutable == True" property/value should be updatable but the example "MM(0)[1,2] = 3" doesnt update MM(0) (see example below) Is that right?

```
> sage: MM(0)
> [0 0 0]
> [0 0 0]
> [0 0 0]
> 
> sage: MM(0)[1,2]=3 
> 
> # this behavior is the same before and after patches were applied
> # is this right? isnt MM(0) mutable and should be = 3 at row/col=[1,2]? 
> sage: MM(0)
> [0 0 0]
> [0 0 0]
> [0 0 0]
```
This is perfectly normal. `MM(0)` does not design a particular matrix object. It construct a brand new matrix. So that 

```
sage: MM(0)[1,2]=3
``` 
Construct a matrix, modify it and forget about the result so that the next call to
`MM(0)` gives you a brand new zero matrix. To achieve what you want you should write

```
sage: MM = MatrixSpace(ZZ, 3,3)
sage: mat = MM(0); mat[1,2]=3
sage: mat
[0 0 0]
[0 0 3]
[0 0 0]
```

Florent



---

archive/issue_comments_066154.json:
```json
{
    "body": "**Attachment:** [trac-8276-MatrixSpace_one-review.patch.gz](https://github.com/sagemath/sage/files/ticket8276/trac-8276-MatrixSpace_one-review.patch.gz)\n\nFirst reviewed patch",
    "created_at": "2010-02-20T15:21:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66154",
    "user": "https://github.com/sagetrac-mraum"
}
```

**Attachment:** [trac-8276-MatrixSpace_one-review.patch.gz](https://github.com/sagemath/sage/files/ticket8276/trac-8276-MatrixSpace_one-review.patch.gz)

First reviewed patch



---

archive/issue_comments_066155.json:
```json
{
    "body": "**Attachment:** [trac-8276-fix_sagelib-review.patch.gz](https://github.com/sagemath/sage/files/ticket8276/trac-8276-fix_sagelib-review.patch.gz)\n\nSeconded reviewed patch.",
    "created_at": "2010-02-20T15:21:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66155",
    "user": "https://github.com/sagetrac-mraum"
}
```

**Attachment:** [trac-8276-fix_sagelib-review.patch.gz](https://github.com/sagemath/sage/files/ticket8276/trac-8276-fix_sagelib-review.patch.gz)

Seconded reviewed patch.



---

archive/issue_comments_066156.json:
```json
{
    "body": "<a id='comment:15'></a>\nUsed the new patches (as well as trac_8294-matrix_2x2_copy_mutability_fix-fh.patch). All were applied and compiled with no errors.\n\n```\nThe following tests failed:\n\tsage -t  devel/sage/sage/groups/abelian_gps/dual_abelian_group_element.py # Segfault\n\tsage -t  devel/sage/sage/matrix/matrix_integer_2x2.pyx # 1 doctests failed\n\tsage -t  devel/sage/doc/fr/tutorial/programming.rst # Segfault\n```\nRe-tested each and got the following for the first 2 (but the 3rd one passed).\n\n```\nA mysterious error (perhaps a memory error?) occurred, which may have crashed doctest.\n```\nI get this \"mysterious error\" a number of times and have seen many tickets mention it. Can anyone give any advice about it? Given its not always reproduceable, should it block a positive review if the tickets functionality proves good?",
    "created_at": "2010-02-21T00:20:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66156",
    "user": "https://github.com/sagetrac-rossk"
}
```

<a id='comment:15'></a>
Used the new patches (as well as trac_8294-matrix_2x2_copy_mutability_fix-fh.patch). All were applied and compiled with no errors.

```
The following tests failed:
	sage -t  devel/sage/sage/groups/abelian_gps/dual_abelian_group_element.py # Segfault
	sage -t  devel/sage/sage/matrix/matrix_integer_2x2.pyx # 1 doctests failed
	sage -t  devel/sage/doc/fr/tutorial/programming.rst # Segfault
```
Re-tested each and got the following for the first 2 (but the 3rd one passed).

```
A mysterious error (perhaps a memory error?) occurred, which may have crashed doctest.
```
I get this "mysterious error" a number of times and have seen many tickets mention it. Can anyone give any advice about it? Given its not always reproduceable, should it block a positive review if the tickets functionality proves good?



---

archive/issue_comments_066157.json:
```json
{
    "body": "<a id='comment:16'></a>\nI just have have a query now that Im looking at the ticket that someone may care to answer.\nI appreciate there may be implementation issues that differentiate the different constructs i.e.  M().zero() vs M(0) etc. But from a language point of view (i.e. not considering constructions vs coercions), why are the different matrices below treated differently i.e. why arent they all immutable)? Im just thinking that, for example, M().zero() and M().zero_matrix() and M(0) etc each return a zero matrix that cant be changed (either theres an error if its immutable or the assignment is ignored). So shouldnt they all be immutable? And why is there a variation in the mutability between the zero and identity matrices. (Apologies if there's something obvious I missed)\n\n```\nsage: MM(0).is_mutable()\nTrue\nsage: MM.zero_matrix().is_mutable()\nFalse\nsage: MM.zero().is_mutable()\nTrue\n\nsage: MM(1).is_mutable()\nTrue\nsage: MM.identity_matrix().is_mutable()\nFalse\nsage: MM.one().is_mutable()\nFalse\n```",
    "created_at": "2010-02-21T02:46:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66157",
    "user": "https://github.com/sagetrac-rossk"
}
```

<a id='comment:16'></a>
I just have have a query now that Im looking at the ticket that someone may care to answer.
I appreciate there may be implementation issues that differentiate the different constructs i.e.  M().zero() vs M(0) etc. But from a language point of view (i.e. not considering constructions vs coercions), why are the different matrices below treated differently i.e. why arent they all immutable)? Im just thinking that, for example, M().zero() and M().zero_matrix() and M(0) etc each return a zero matrix that cant be changed (either theres an error if its immutable or the assignment is ignored). So shouldnt they all be immutable? And why is there a variation in the mutability between the zero and identity matrices. (Apologies if there's something obvious I missed)

```
sage: MM(0).is_mutable()
True
sage: MM.zero_matrix().is_mutable()
False
sage: MM.zero().is_mutable()
True

sage: MM(1).is_mutable()
True
sage: MM.identity_matrix().is_mutable()
False
sage: MM.one().is_mutable()
False
```



---

archive/issue_comments_066158.json:
```json
{
    "body": "**Changing keywords** from \"One mutable.\" to \"One Zero mutable.\".",
    "created_at": "2010-02-21T02:46:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66158",
    "user": "https://github.com/sagetrac-rossk"
}
```

**Changing keywords** from "One mutable." to "One Zero mutable.".



---

archive/issue_comments_066159.json:
```json
{
    "body": "<a id='comment:17'></a>\nThe reason is the categorie framework. MatrixSpaces are vector spaces, so they implement zero(). In my oppinion this should absolutely coinside with MM(0) since everybody will expect it so do so. Hence, it should be mutable.\none() is implemented seperatedly and is just one = identity_matrix. In my oppinion this is a defect, since according to the framework is normally coincides with MM(1). If MatrixSpaces was a ring it would be exactly this.\n\nCould I hear your oppinion? If nobody is opposed I will set this to positive review tomorrow evening and I will open a follow up which sets one = lambda self : self(1) .",
    "created_at": "2010-02-21T14:26:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66159",
    "user": "https://github.com/sagetrac-mraum"
}
```

<a id='comment:17'></a>
The reason is the categorie framework. MatrixSpaces are vector spaces, so they implement zero(). In my oppinion this should absolutely coinside with MM(0) since everybody will expect it so do so. Hence, it should be mutable.
one() is implemented seperatedly and is just one = identity_matrix. In my oppinion this is a defect, since according to the framework is normally coincides with MM(1). If MatrixSpaces was a ring it would be exactly this.

Could I hear your oppinion? If nobody is opposed I will set this to positive review tomorrow evening and I will open a follow up which sets one = lambda self : self(1) .



---

archive/issue_comments_066160.json:
```json
{
    "body": "<a id='comment:18'></a>\n\n```\nsage: MM.zero().is_mutable()\nTrue\n```\nIs corrected by my last patch. It should be False\n\nReplying to [mraum](#comment%3A17):\n> The reason is the categorie framework. MatrixSpaces are vector spaces, so they implement zero(). In my oppinion this should absolutely coinside with MM(0) since everybody will expect it so do so. Hence, it should be mutable.\n\nNo it isn't. See the comment in the doc of `zero` and `one` in their respective category. It has been discussed on sage-devel that `.zero()` and `.one()` should return an *immutable* matrix. The argument of the category framework applies identically to `zero` (vector space) and one (algebra which come actually from monoid).  \n\n> one() is implemented seperatedly and is just one = identity_matrix. In my oppinion this is a defect, since according to the framework is normally coincides with MM(1). If MatrixSpaces was a ring it would be exactly this.\n\nNote that my last version of the patch also implement \n\n```\nzero = zero_matrix\n```\n\n> Could I hear your oppinion? If nobody is opposed I will set this to positive review tomorrow evening and I will open a follow up which sets one = lambda self : self(1) .\n\nMy opinion which coincide with William's and Robert Bradshaw is that one and zero should be immutable. It was not discussed whether `MM(0)` and `MM(1)` should returns something coherent. \nplease see http://groups.google.com/group/sage-devel/browse_frm/thread/1042edd11b3854b2",
    "created_at": "2010-02-21T21:08:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66160",
    "user": "https://github.com/hivert"
}
```

<a id='comment:18'></a>

```
sage: MM.zero().is_mutable()
True
```
Is corrected by my last patch. It should be False

Replying to [mraum](#comment%3A17):
> The reason is the categorie framework. MatrixSpaces are vector spaces, so they implement zero(). In my oppinion this should absolutely coinside with MM(0) since everybody will expect it so do so. Hence, it should be mutable.

No it isn't. See the comment in the doc of `zero` and `one` in their respective category. It has been discussed on sage-devel that `.zero()` and `.one()` should return an *immutable* matrix. The argument of the category framework applies identically to `zero` (vector space) and one (algebra which come actually from monoid).  

> one() is implemented seperatedly and is just one = identity_matrix. In my oppinion this is a defect, since according to the framework is normally coincides with MM(1). If MatrixSpaces was a ring it would be exactly this.

Note that my last version of the patch also implement 

```
zero = zero_matrix
```

> Could I hear your oppinion? If nobody is opposed I will set this to positive review tomorrow evening and I will open a follow up which sets one = lambda self : self(1) .

My opinion which coincide with William's and Robert Bradshaw is that one and zero should be immutable. It was not discussed whether `MM(0)` and `MM(1)` should returns something coherent. 
please see http://groups.google.com/group/sage-devel/browse_frm/thread/1042edd11b3854b2



---

archive/issue_comments_066161.json:
```json
{
    "body": "**Attachment:** [trac-8276-fix_zero_matrix_creation-review.patch.gz](https://github.com/sagemath/sage/files/ticket8276/trac-8276-fix_zero_matrix_creation-review.patch.gz)\n\nReplacing old review; now with zero=zero_matrix",
    "created_at": "2010-02-22T11:16:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66161",
    "user": "https://github.com/sagetrac-mraum"
}
```

**Attachment:** [trac-8276-fix_zero_matrix_creation-review.patch.gz](https://github.com/sagemath/sage/files/ticket8276/trac-8276-fix_zero_matrix_creation-review.patch.gz)

Replacing old review; now with zero=zero_matrix



---

archive/issue_events_057958.json:
```json
{
    "actor": "https://github.com/sagetrac-mraum",
    "created_at": "2010-02-22T11:22:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8276#event-57958"
}
```



---

archive/issue_events_057959.json:
```json
{
    "actor": "https://github.com/sagetrac-mraum",
    "created_at": "2010-02-22T11:22:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8276#event-57959"
}
```



---

archive/issue_comments_066162.json:
```json
{
    "body": "**Reviewer:** Martin Raum, rossk",
    "created_at": "2010-02-22T11:22:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66162",
    "user": "https://github.com/sagetrac-mraum"
}
```

**Reviewer:** Martin Raum, rossk



---

archive/issue_comments_066163.json:
```json
{
    "body": "<a id='comment:19'></a>\nOk, I didn't read this thread this way, but yes, you're right, a majority seems to want exactly this behaviour.\nThe review patches now include also your last change.\n\nI'm personally strongly opposed to this, so I am going to open a brief discussion on sage-devel, just to make sure that this is a general policy towards the categories framework. I hope to read your opinion there, too.\n\nrossk: I guess it's fair to say, that you also contributed to this review, so please expand your name in the review field.",
    "created_at": "2010-02-22T11:22:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66163",
    "user": "https://github.com/sagetrac-mraum"
}
```

<a id='comment:19'></a>
Ok, I didn't read this thread this way, but yes, you're right, a majority seems to want exactly this behaviour.
The review patches now include also your last change.

I'm personally strongly opposed to this, so I am going to open a brief discussion on sage-devel, just to make sure that this is a general policy towards the categories framework. I hope to read your opinion there, too.

rossk: I guess it's fair to say, that you also contributed to this review, so please expand your name in the review field.



---

archive/issue_comments_066164.json:
```json
{
    "body": "**Changing reviewer** from \"Martin Raum, rossk\" to \"Martin Raum, Ross Kyprianou\".",
    "created_at": "2010-02-22T12:53:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66164",
    "user": "https://github.com/sagetrac-rossk"
}
```

**Changing reviewer** from "Martin Raum, rossk" to "Martin Raum, Ross Kyprianou".



---

archive/issue_events_057960.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-03-03T14:30:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8276#event-57960"
}
```



---

archive/issue_events_057961.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-03-03T14:30:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8276#event-57961"
}
```



---

archive/issue_events_057962.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-03-03T14:30:36Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "rename": {
        "from": "Make the one(), identity_matrix() and zero_matrix() cached and immutable.",
        "to": "Make the one(), identity_matrix() and zero_matrix() cached and immutable"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8276#event-57962"
}
```



---

archive/issue_comments_066165.json:
```json
{
    "body": "<a id='comment:21'></a>\nMerged in this order:\n\n1. [trac-8276-MatrixSpace_one-review.patch](https://github.com/sagemath/sage/files/ticket8276/trac-8276-MatrixSpace_one-review.patch.gz)\n2. [trac-8276-fix_sagelib-review.patch](https://github.com/sagemath/sage/files/ticket8276/trac-8276-fix_sagelib-review.patch.gz)\n3. [trac-8276-fix_zero_matrix_creation-review.patch](https://github.com/sagemath/sage/files/ticket8276/trac-8276-fix_zero_matrix_creation-review.patch.gz)",
    "created_at": "2010-03-03T14:30:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66165",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<a id='comment:21'></a>
Merged in this order:

1. [trac-8276-MatrixSpace_one-review.patch](https://github.com/sagemath/sage/files/ticket8276/trac-8276-MatrixSpace_one-review.patch.gz)
2. [trac-8276-fix_sagelib-review.patch](https://github.com/sagemath/sage/files/ticket8276/trac-8276-fix_sagelib-review.patch.gz)
3. [trac-8276-fix_zero_matrix_creation-review.patch](https://github.com/sagemath/sage/files/ticket8276/trac-8276-fix_zero_matrix_creation-review.patch.gz)



---

archive/issue_comments_066166.json:
```json
{
    "body": "**Merged:** sage-4.3.4.alpha0",
    "created_at": "2010-03-03T14:30:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8276#issuecomment-66166",
    "user": "https://github.com/sagetrac-mvngu"
}
```

**Merged:** sage-4.3.4.alpha0
