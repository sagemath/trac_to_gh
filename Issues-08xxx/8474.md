# Issue 8474: Detect whether a program is in the path

archive/issues_008474.json:
```json
{
    "assignees": [],
    "body": "In various places in the Sage library, we test for the existence of programs using code like this:\n\n```\nimport os\nif os.system('which program') == 0:\n    # program exists\nelse:\n    # it doesn't\n```\nOn Solaris, executing \"which program\" seems to return 0 regardless of whether the program actually exists, and so any code like this is broken.  For example, try this on t2.math:\n\n```\nsage: from sage.misc.latex import have_latex\nsage: have_latex()\nTrue\nsage: import os\nsage: os.system('which latex')                                                                    \nno latex in /usr/local/sage-4.3.0.1-Solaris-10-SPARC-sun4u-or-sun4v/local/lib /usr/local/sage-4.3.0.1-Solaris-10-SPARC-sun4u-or-sun4v /usr/local/sage-4.3.0.1-Solaris-10-SPARC-sun4u-or-sun4v/local/bin /usr/local/gcc-4.4.1-sun-linker/bin /usr/local/bin2 /usr/bin /usr/ccs/bin /usr/local/bin /usr/sfw/bin /bin /usr/sbin\n0\n```\n\nSo we should have a function which replaces this, and we should use it in the Sage library.  On IRC, mhansen says\n\n```\n<mhansen> I think you can use \"type\" on Solaris\n```\nThe \"type\" command actually works for me on several different platforms, and so it's what the patch uses.\n\nThis needs testing on lots more different platforms to make sure it's portable.\n\n\nAssignee: **@sagetrac-drkirkby**\n\nCC:  @sagetrac-drkirkby @mwhansen\n\nReviewer: **David Kirkby**\n\nAuthor: **John Palmieri**\n\nMerged: **sage-4.3.4.alpha1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/8474_\n\n",
    "closed_at": "2010-03-08T20:56:14Z",
    "created_at": "2010-03-07T05:15:31Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20porting",
        "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Detect whether a program is in the path",
    "type": "issue",
    "updated_at": "2023-01-08T09:03:51Z",
    "url": "https://github.com/sagemath/sage/issues/8474",
    "user": "https://github.com/jhpalmieri"
}
```
In various places in the Sage library, we test for the existence of programs using code like this:

```
import os
if os.system('which program') == 0:
    # program exists
else:
    # it doesn't
```
On Solaris, executing "which program" seems to return 0 regardless of whether the program actually exists, and so any code like this is broken.  For example, try this on t2.math:

```
sage: from sage.misc.latex import have_latex
sage: have_latex()
True
sage: import os
sage: os.system('which latex')                                                                    
no latex in /usr/local/sage-4.3.0.1-Solaris-10-SPARC-sun4u-or-sun4v/local/lib /usr/local/sage-4.3.0.1-Solaris-10-SPARC-sun4u-or-sun4v /usr/local/sage-4.3.0.1-Solaris-10-SPARC-sun4u-or-sun4v/local/bin /usr/local/gcc-4.4.1-sun-linker/bin /usr/local/bin2 /usr/bin /usr/ccs/bin /usr/local/bin /usr/sfw/bin /bin /usr/sbin
0
```

So we should have a function which replaces this, and we should use it in the Sage library.  On IRC, mhansen says

```
<mhansen> I think you can use "type" on Solaris
```
The "type" command actually works for me on several different platforms, and so it's what the patch uses.

This needs testing on lots more different platforms to make sure it's portable.


Assignee: **@sagetrac-drkirkby**

CC:  @sagetrac-drkirkby @mwhansen

Reviewer: **David Kirkby**

Author: **John Palmieri**

Merged: **sage-4.3.4.alpha1**

_Issue created by migration from https://trac.sagemath.org/ticket/8474_





---

archive/issue_events_096851.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-03-07T05:15:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "milestone_number": null,
    "milestone_title": "sage-4.3.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8474#event-96851"
}
```



---

archive/issue_events_096852.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-03-07T05:15:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20porting",
    "label_color": "000080",
    "label_name": "component: porting",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8474#event-96852"
}
```



---

archive/issue_events_096853.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-03-07T05:15:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8474#event-96853"
}
```



---

archive/issue_events_096854.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-03-07T05:15:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8474#event-96854"
}
```



---

archive/issue_comments_069198.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nThis should also fix the problem at #8463.",
    "created_at": "2010-03-07T05:18:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8474#issuecomment-69198",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:1" align="right">Comment 1</div>

This should also fix the problem at #8463.



---

archive/issue_events_096855.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-03-07T05:18:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8474#event-96855"
}
```



---

archive/issue_events_096856.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-03-07T10:19:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8474#event-96856"
}
```



---

archive/issue_events_096857.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-03-07T10:19:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8474#event-96857"
}
```



---

archive/issue_comments_069199.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nHi, I believe this needs changing a little, as *type* is nothing really like *which*. Here are a few specific points though. \n\n* 'which' is not part of POSIX, so as such I think it is best avoided. It is not portable.\n* 'which' does exist on Solaris, so it should be ok(ish), though it would not be my first choice. However, the documented behavior (in the Solaris man page) of *which* is to exit with an exit status of 0 if the command is found, and an exit status of >0 if the command is not found. So it should be ok for Solaris, even though I have reservations it is not a good command to use due to its non-portability. \n\n  ```\n  drkirkby@hawk:~$ man which\n  \n  User Commands                                            which(1)\n  \n  NAME\n       which - locate a command and display its pathname or alias\n  \n  SYNOPSIS\n       which [name]...\n  <snip>\n  EXIT STATUS\n       The following exit values are returned:\n  \n       0      Successful completion.\n  \n       >0     One or more name operands  were  not  located  or  an\n              error occurred.\n  ```\n\n Although I thought it highly unlikely to be a bug in Sun's implementation 'which', I decided to check. But that is not the problem, as the following code shows:\n\n   ```\n   drkirkby@hawk:~$ cat testit2\n   #!/bin/sh\n   which $1\n   if [ $? -ne 0 ]; then\n       echo \" can't find $1\"\n   else\n     echo \"found $1\"\n   fi\n   ```\n Running that script twice, first with a command one expects to find (ls), then one does not (tokoklklstgjglkjhs), we find it behaves as you expect, and how it is documented to behave.\n\n   ```\n   drkirkby@hawk:~$ ./testit2 ls\n   /usr/bin/ls\n   found ls\n   drkirkby@hawk:~$ ./testit2 tokoklklstgjglkjhs\n   no tokoklklstgjglkjhs in /export/home/drkirkby/bins-for-sage /usr/local/gcc-4.3.4-GNU-assembler-Sun-linker/bin /usr/csw/bin/ /usr/local/bin /usr/bin /usr/X11/bin /usr/openwin/bin\n    can't find tokoklklstgjglkjhs\n   drkirkby@hawk:~$ \n   ```\n\n So 'which' is behaving on Solaris in the way documented in the Solaris man page! It's also as documented in the Linux man page, so I suspect the problem might lie elsewhere. \n\n* I have reservations about the use of *type* too, as the output is nothing like that of *which*, as it does not show the path and only the path. It shows more information, in a more confusing way. \n\nhttp://www.opengroup.org/onlinepubs/9699919799/utilities/type.html\n\n  It will tell you if the command exits or not, but does not give the output in the same way as *which* \n\n  ```\n  drkirkby@hawk:~$ which ls\n  /usr/bin/ls\n  drkirkby@hawk:~$ type ls\n  ls is /usr/bin/ls\n   ```\n* After spending 10-15 minutes reading the POSIX specification, I've come to the conclusion what we should really be using is *command -v* to find if a command exists, and if so its path. \n\n  http://www.opengroup.org/onlinepubs/9699919799/utilities/command.html\n\n  ```\n  NAME\n  \n      command - execute a simple command\n  \n  SYNOPSIS\n  \n      command [-p] command_name [argument...]\n  \n      command [-p][-v|-V] command_name\n  \n  DESCRIPTION\n  \n      The command utility shall cause the shell to treat the arguments as a simple command, suppressing the shell function lookup that is described in Command Search and Execution , item 1b.\n  \n      If the command_name is the same as the name of one of the special built-in utilities, the special properties in the enumerated list at the beginning of Special Built-In Utilities shall not occur. In every other respect, if command_name is not the name of a function, the effect of command (with no options) shall be the same as omitting command.\n  \n      When the -v or -V option is used, the command utility shall provide information concerning how a command name is interpreted by the shell.\n  \n  OPTIONS\n  \n      The command utility shall conform to XBD Utility Syntax Guidelines .\n  \n      The following options shall be supported:\n  \n      -p\n          Perform the command search using a default value for PATH that is guaranteed to find all of the standard utilities.\n      -v\n          Write a string to standard output that indicates the pathname or command that will be used by the shell, in the current shell execution environment (see Shell Execution Environment ), to invoke command_name, but do not invoke command_name. \n  <snip>\n  EXIT STATUS\n  \n      When the -v or -V options are specified, the following exit values shall be returned:\n  \n       0\n          Successful completion.\n      >0\n          The command_name could not be found or an error occurred. \n  ```\n\nSo using *command -v* has many advantages. \n* It is part of POSIX\n* It's output is the same format as the 'which' command. \n* It works on every system I have tried it on - these include\n  * Linux\n  * OS X\n  * Solaris\n  * HP-UX\n  * FreeBSD\n   \nSo, in summary, I believe *command -v* is the most appropriate, but I can't understand why which is not working, as it is documented to work and I've tested it and found it does work. \n\nComments? \n\nDave",
    "created_at": "2010-03-07T10:19:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8474#issuecomment-69199",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:2" align="right">Comment 2</div>

Hi, I believe this needs changing a little, as *type* is nothing really like *which*. Here are a few specific points though. 

* 'which' is not part of POSIX, so as such I think it is best avoided. It is not portable.
* 'which' does exist on Solaris, so it should be ok(ish), though it would not be my first choice. However, the documented behavior (in the Solaris man page) of *which* is to exit with an exit status of 0 if the command is found, and an exit status of >0 if the command is not found. So it should be ok for Solaris, even though I have reservations it is not a good command to use due to its non-portability. 

  ```
  drkirkby@hawk:~$ man which
  
  User Commands                                            which(1)
  
  NAME
       which - locate a command and display its pathname or alias
  
  SYNOPSIS
       which [name]...
  <snip>
  EXIT STATUS
       The following exit values are returned:
  
       0      Successful completion.
  
       >0     One or more name operands  were  not  located  or  an
              error occurred.
  ```

 Although I thought it highly unlikely to be a bug in Sun's implementation 'which', I decided to check. But that is not the problem, as the following code shows:

   ```
   drkirkby@hawk:~$ cat testit2
   #!/bin/sh
   which $1
   if [ $? -ne 0 ]; then
       echo " can't find $1"
   else
     echo "found $1"
   fi
   ```
 Running that script twice, first with a command one expects to find (ls), then one does not (tokoklklstgjglkjhs), we find it behaves as you expect, and how it is documented to behave.

   ```
   drkirkby@hawk:~$ ./testit2 ls
   /usr/bin/ls
   found ls
   drkirkby@hawk:~$ ./testit2 tokoklklstgjglkjhs
   no tokoklklstgjglkjhs in /export/home/drkirkby/bins-for-sage /usr/local/gcc-4.3.4-GNU-assembler-Sun-linker/bin /usr/csw/bin/ /usr/local/bin /usr/bin /usr/X11/bin /usr/openwin/bin
    can't find tokoklklstgjglkjhs
   drkirkby@hawk:~$ 
   ```

 So 'which' is behaving on Solaris in the way documented in the Solaris man page! It's also as documented in the Linux man page, so I suspect the problem might lie elsewhere. 

* I have reservations about the use of *type* too, as the output is nothing like that of *which*, as it does not show the path and only the path. It shows more information, in a more confusing way. 

http://www.opengroup.org/onlinepubs/9699919799/utilities/type.html

  It will tell you if the command exits or not, but does not give the output in the same way as *which* 

  ```
  drkirkby@hawk:~$ which ls
  /usr/bin/ls
  drkirkby@hawk:~$ type ls
  ls is /usr/bin/ls
   ```
* After spending 10-15 minutes reading the POSIX specification, I've come to the conclusion what we should really be using is *command -v* to find if a command exists, and if so its path. 

  http://www.opengroup.org/onlinepubs/9699919799/utilities/command.html

  ```
  NAME
  
      command - execute a simple command
  
  SYNOPSIS
  
      command [-p] command_name [argument...]
  
      command [-p][-v|-V] command_name
  
  DESCRIPTION
  
      The command utility shall cause the shell to treat the arguments as a simple command, suppressing the shell function lookup that is described in Command Search and Execution , item 1b.
  
      If the command_name is the same as the name of one of the special built-in utilities, the special properties in the enumerated list at the beginning of Special Built-In Utilities shall not occur. In every other respect, if command_name is not the name of a function, the effect of command (with no options) shall be the same as omitting command.
  
      When the -v or -V option is used, the command utility shall provide information concerning how a command name is interpreted by the shell.
  
  OPTIONS
  
      The command utility shall conform to XBD Utility Syntax Guidelines .
  
      The following options shall be supported:
  
      -p
          Perform the command search using a default value for PATH that is guaranteed to find all of the standard utilities.
      -v
          Write a string to standard output that indicates the pathname or command that will be used by the shell, in the current shell execution environment (see Shell Execution Environment ), to invoke command_name, but do not invoke command_name. 
  <snip>
  EXIT STATUS
  
      When the -v or -V options are specified, the following exit values shall be returned:
  
       0
          Successful completion.
      >0
          The command_name could not be found or an error occurred. 
  ```

So using *command -v* has many advantages. 
* It is part of POSIX
* It's output is the same format as the 'which' command. 
* It works on every system I have tried it on - these include
  * Linux
  * OS X
  * Solaris
  * HP-UX
  * FreeBSD
   
So, in summary, I believe *command -v* is the most appropriate, but I can't understand why which is not working, as it is documented to work and I've tested it and found it does work. 

Comments? 

Dave



---

archive/issue_comments_069200.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nJust to show you what I mean, here is the output when testing for an existing file, and a non-existing file. Note there is a different response from Solaris 10 (on SPARC) to all the others if the command is not found, but the exit code remains non-zero on Solaris 10 (SPARC).\n\nIf the command is found on Solaris 10, then the output is exactly the same as on every other platform, and exactly the same as 'which'. But I think 'command -v' is preferable, as it is more portable. \n\nOn Solaris 10 (SPARC processor):\n\n```\ndrkirkby@redstart:~$ command -v ls\n/usr/bin/ls\ndrkirkby@redstart:~$ command -v fdsfdgddgt\n-bash: command: fdsfdgddgt: not found\n```\n\nOn HP-UX (PA-RISC processor):\n\n```\n-bash-4.0$ command -v ls                                                \n/usr/bin/ls\n-bash-4.0$ command -v lssdsssdfdf\n-bash-4.0$ \n```\n\nOn OpenSolaris (Intel Xeon processor):\n\n```\ndrkirkby@hawk:~$ command -v ls\n/usr/bin/ls\ndrkirkby@hawk:~$ command -v klsddshfsd\ndrkirkby@hawk:~$ \n```\n\nOn OS X (Intel processor of some sort):\n\n```\n[kirkby@bsd ~]$ command -v ls\n/bin/ls\n[kirkby@bsd ~]$ command -v reererer\n[kirkby@bsd ~]$ \n```\n\nOn Linux (Intel processor of some sort)\n\n```\nkirkby@sage:~$ command -v ls\n/bin/ls\nkirkby@sage:~$ command -v fdlkskld\nkirkby@sage:~$ \n```\n\nOn FreeBSD (VirtualBox virtual machine, running on OpenSolaris host):\n\n```\neagle# command -v ls\n/bin/ls\neagle# command -v sdfdsf\neagle#\n```",
    "created_at": "2010-03-07T15:22:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8474#issuecomment-69200",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:3" align="right">Comment 3</div>

Just to show you what I mean, here is the output when testing for an existing file, and a non-existing file. Note there is a different response from Solaris 10 (on SPARC) to all the others if the command is not found, but the exit code remains non-zero on Solaris 10 (SPARC).

If the command is found on Solaris 10, then the output is exactly the same as on every other platform, and exactly the same as 'which'. But I think 'command -v' is preferable, as it is more portable. 

On Solaris 10 (SPARC processor):

```
drkirkby@redstart:~$ command -v ls
/usr/bin/ls
drkirkby@redstart:~$ command -v fdsfdgddgt
-bash: command: fdsfdgddgt: not found
```

On HP-UX (PA-RISC processor):

```
-bash-4.0$ command -v ls                                                
/usr/bin/ls
-bash-4.0$ command -v lssdsssdfdf
-bash-4.0$ 
```

On OpenSolaris (Intel Xeon processor):

```
drkirkby@hawk:~$ command -v ls
/usr/bin/ls
drkirkby@hawk:~$ command -v klsddshfsd
drkirkby@hawk:~$ 
```

On OS X (Intel processor of some sort):

```
[kirkby@bsd ~]$ command -v ls
/bin/ls
[kirkby@bsd ~]$ command -v reererer
[kirkby@bsd ~]$ 
```

On Linux (Intel processor of some sort)

```
kirkby@sage:~$ command -v ls
/bin/ls
kirkby@sage:~$ command -v fdlkskld
kirkby@sage:~$ 
```

On FreeBSD (VirtualBox virtual machine, running on OpenSolaris host):

```
eagle# command -v ls
/bin/ls
eagle# command -v sdfdsf
eagle#
```



---

archive/issue_events_096858.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-03-07T16:44:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8474#event-96858"
}
```



---

archive/issue_events_096859.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-03-07T16:44:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8474#event-96859"
}
```



---

archive/issue_comments_069201.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nHere's a new patch which uses \"command -v\".  On my mac, on sage.math, and on t2.math, \"type\" and \"command -v\" behave essentially the same, more or less like this:\n\n```\nsage: from subprocess import call, PIPE\nsage: call('type ' + 'ls', shell=True, stdout=PIPE, stderr=PIPE)  # note the space in 'type '\n0\nsage: call('type ' + 'lljsdfs', shell=True, stdout=PIPE, stderr=PIPE)       \n1\nsage: call('command -v ' + 'ls', shell=True, stdout=PIPE, stderr=PIPE)      \n0\nsage: call('command -v ' + 'llkjsdfs', shell=True, stdout=PIPE, stderr=PIPE)\n127\n```\nThe only difference on the platforms is the value of the nonzero return code: sometimes it's 1, sometimes is 127, depending on the platform and the command.  It's always nonzero, though, when the program doesn't exist.\n\n(With these arguments, the command \"call\" calls a program by passing to the shell without printing standard output or standard error, and it returns a code which is zero if the program exits correctly, nonzero otherwise, and I think the return codes have something to do with the system return codes, but they're not necessarily the same. See [http://docs.python.org/library/subprocess.html#convenience-functions](http://docs.python.org/library/subprocess.html#convenience-functions).)\n\nNote that I don't care about the output of the functions, so your concern about \"type\" in that regard is not a big deal.  However, if \"command -v\" is Posix standard, we can switch to that, since it seems to behave the same way.\n\nRegardless, I think you'll agree that it would be good to have one portable way to do this, in one place in the Sage library, so functions like \"have_latex\" and \"have_chomp\" will work right on Solaris, linux, Mac, etc.",
    "created_at": "2010-03-07T16:44:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8474#issuecomment-69201",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:4" align="right">Comment 4</div>

Here's a new patch which uses "command -v".  On my mac, on sage.math, and on t2.math, "type" and "command -v" behave essentially the same, more or less like this:

```
sage: from subprocess import call, PIPE
sage: call('type ' + 'ls', shell=True, stdout=PIPE, stderr=PIPE)  # note the space in 'type '
0
sage: call('type ' + 'lljsdfs', shell=True, stdout=PIPE, stderr=PIPE)       
1
sage: call('command -v ' + 'ls', shell=True, stdout=PIPE, stderr=PIPE)      
0
sage: call('command -v ' + 'llkjsdfs', shell=True, stdout=PIPE, stderr=PIPE)
127
```
The only difference on the platforms is the value of the nonzero return code: sometimes it's 1, sometimes is 127, depending on the platform and the command.  It's always nonzero, though, when the program doesn't exist.

(With these arguments, the command "call" calls a program by passing to the shell without printing standard output or standard error, and it returns a code which is zero if the program exits correctly, nonzero otherwise, and I think the return codes have something to do with the system return codes, but they're not necessarily the same. See [http://docs.python.org/library/subprocess.html#convenience-functions](http://docs.python.org/library/subprocess.html#convenience-functions).)

Note that I don't care about the output of the functions, so your concern about "type" in that regard is not a big deal.  However, if "command -v" is Posix standard, we can switch to that, since it seems to behave the same way.

Regardless, I think you'll agree that it would be good to have one portable way to do this, in one place in the Sage library, so functions like "have_latex" and "have_chomp" will work right on Solaris, linux, Mac, etc.



---

archive/issue_comments_069202.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nJust to emphasize: on t2.math, I get this behavior (in contrast to using \"command -v\" or \"type\"):\n\n```\nsage: from subprocess import call, PIPE\nsage: call('which ' + 'ls', shell=True, stdout=PIPE, stderr=PIPE)\n0\nsage: call('which ' + 'lljsdfs', shell=True, stdout=PIPE, stderr=PIPE)\n0\n```\nI don't know why.  The same happens with `os.system('which lljsdfs')`, and this is what is used in the Sage library.  (\"call\" is similar in behavior to \"os.system\", but I think \"call\" is slightly preferred.  It also gives better control of stdin, stdout, and stderr.)  So I do think this is what's wrong with #8463.  As I said in the description of this ticket, the function \"have_latex\" returns True on t2.math, and I would guess that if I could install Sage 4.3.4.alpha0 on t2.math, then the comparable \"have_chomp\" functions would return True as well.  Therefore Sage would try to call chomp when doing homology calculations, and since the program isn't there, it would crash.",
    "created_at": "2010-03-07T16:53:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8474#issuecomment-69202",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:5" align="right">Comment 5</div>

Just to emphasize: on t2.math, I get this behavior (in contrast to using "command -v" or "type"):

```
sage: from subprocess import call, PIPE
sage: call('which ' + 'ls', shell=True, stdout=PIPE, stderr=PIPE)
0
sage: call('which ' + 'lljsdfs', shell=True, stdout=PIPE, stderr=PIPE)
0
```
I don't know why.  The same happens with `os.system('which lljsdfs')`, and this is what is used in the Sage library.  ("call" is similar in behavior to "os.system", but I think "call" is slightly preferred.  It also gives better control of stdin, stdout, and stderr.)  So I do think this is what's wrong with #8463.  As I said in the description of this ticket, the function "have_latex" returns True on t2.math, and I would guess that if I could install Sage 4.3.4.alpha0 on t2.math, then the comparable "have_chomp" functions would return True as well.  Therefore Sage would try to call chomp when doing homology calculations, and since the program isn't there, it would crash.



---

archive/issue_comments_069203.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nNote that on t2 from the command-line\n\n```\nmhansen@t2:~$ which asdfasdfasfdsfsadf\nno asdfasdfasfdsfsadf in /scratch/mhansen/bin /usr/local/gcc-4.4.1-sun-linker/bin /usr/local/bin2 /usr/bin /usr/ccs/bin /usr/local/bin /usr/sfw/bin /bin /usr/sbin\nmhansen@t2:~$ echo $?\n0\n```",
    "created_at": "2010-03-07T18:01:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8474#issuecomment-69203",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:6" align="right">Comment 6</div>

Note that on t2 from the command-line

```
mhansen@t2:~$ which asdfasdfasfdsfsadf
no asdfasdfasfdsfsadf in /scratch/mhansen/bin /usr/local/gcc-4.4.1-sun-linker/bin /usr/local/bin2 /usr/bin /usr/ccs/bin /usr/local/bin /usr/sfw/bin /bin /usr/sbin
mhansen@t2:~$ echo $?
0
```



---

archive/issue_comments_069204.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nI installed Solaris on a virtual machine on my Mac:\n\n```\n$ uname -a\nSunOS unknown 5.10 Generic_141445-09 i86pc i386 i386pc\n```\nand I get the same results that mhansen reported on t2.  Also, the man page for \"which\" doesn't discuss error codes.  It says, among other things\n\n```\nNOTES\n     which is not a shell built-in command; it is the  UNIX  com-\n     mand, /usr/bin/which\n```\nI haven't tried to install Sage on this (for one thing, I don't have gcc installed and I don't know how to get it), but I get similar results in python: running \"call('which lsjdflsjdflkjs', ...)\" returns 0, same as \"call('which ls', ...)\".",
    "created_at": "2010-03-07T18:37:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8474#issuecomment-69204",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:7" align="right">Comment 7</div>

I installed Solaris on a virtual machine on my Mac:

```
$ uname -a
SunOS unknown 5.10 Generic_141445-09 i86pc i386 i386pc
```
and I get the same results that mhansen reported on t2.  Also, the man page for "which" doesn't discuss error codes.  It says, among other things

```
NOTES
     which is not a shell built-in command; it is the  UNIX  com-
     mand, /usr/bin/which
```
I haven't tried to install Sage on this (for one thing, I don't have gcc installed and I don't know how to get it), but I get similar results in python: running "call('which lsjdflsjdflkjs', ...)" returns 0, same as "call('which ls', ...)".



---

archive/issue_events_096860.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-03-07T19:02:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8474#event-96860"
}
```



---

archive/issue_events_096861.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-03-07T19:02:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8474#event-96861"
}
```



---

archive/issue_comments_069205.json:
```json
{
    "body": "Reviewer: **David Kirkby**",
    "created_at": "2010-03-07T19:02:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8474#issuecomment-69205",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Reviewer: **David Kirkby**



---

archive/issue_comments_069206.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nOK, I think I understand this better now. \n\nI just noticed the example above where I showed 'which' behaving as expected was actually on OpenSolaris x64 (hostname hawk). However, I just tried it on Solaris 10 (SPARC), and get the same behavior. i.e. my script works as expected. \n\nI just tried what Mike did, using 'which ffddfdfd' on Solaris 10 (SPARC), Solaris 10 x64 (virtual machine) and OpenSolaris (x64). What I found was\n\n* 'which' has an exit code of 0 on Solaris 10 (SPARC).\n* 'which' has an exit code of 0 on Solaris 10 x86 (virtual machine).\n* 'which' an exit code of 1 on OpenSolaris. \n\nHowever, the man pages on OpenSolaris and Solaris 10 are different. The Solaris 10 man page does not discuss exit codes, but the OpenSolaris man page does. (This is one of the problems of using non-POSIX functions - their behavior is not well defined). \n \nI installed the patch and run the tests. All thse doctests then pass - there are still some other failures. \n\nI'm not a Python guru, but the patch all looks logical to me. So I'm going to give it positive review. \n\nOne very minor niggle - you might want to change the example in the docstring. I think \n\n```\n   sage: have_program('ls') \n   True \n   sage: have_program('there_is_not_a_program_with_this_name') \n   False \n```\n\nwould be a bit preferable to \n\n```\n   sage: have_program('command') \n   True \n   sage: have_program('there_is_not_a_program_with_this_name') \n   False \n```\n\nas far more people will know what 'ls' is. I doubt many will realise there is such a command called 'command'. I thought I knew Unix pretty well, but I was unaware of it until today. But it is a very minor point. \n\nSo positive review from me. Change that docstring if you want, but otherwise leave it unchanged. \n\nI've also noticed a rather annoying message about a lack of *xdg-open* before. It looks like it might have been related - I see you have fixed that too, so hopefully I won't see that any more. \n\nI agree it is more logical to have one library function that works on any system, rather than loads of different implementations which are not portable. \n\nThank you very much John. \n\n**Note to the release manager**\nWhen this is merged, #8463 may be closed. \n\nDave",
    "created_at": "2010-03-07T19:02:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8474#issuecomment-69206",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:8" align="right">Comment 8</div>

OK, I think I understand this better now. 

I just noticed the example above where I showed 'which' behaving as expected was actually on OpenSolaris x64 (hostname hawk). However, I just tried it on Solaris 10 (SPARC), and get the same behavior. i.e. my script works as expected. 

I just tried what Mike did, using 'which ffddfdfd' on Solaris 10 (SPARC), Solaris 10 x64 (virtual machine) and OpenSolaris (x64). What I found was

* 'which' has an exit code of 0 on Solaris 10 (SPARC).
* 'which' has an exit code of 0 on Solaris 10 x86 (virtual machine).
* 'which' an exit code of 1 on OpenSolaris. 

However, the man pages on OpenSolaris and Solaris 10 are different. The Solaris 10 man page does not discuss exit codes, but the OpenSolaris man page does. (This is one of the problems of using non-POSIX functions - their behavior is not well defined). 
 
I installed the patch and run the tests. All thse doctests then pass - there are still some other failures. 

I'm not a Python guru, but the patch all looks logical to me. So I'm going to give it positive review. 

One very minor niggle - you might want to change the example in the docstring. I think 

```
   sage: have_program('ls') 
   True 
   sage: have_program('there_is_not_a_program_with_this_name') 
   False 
```

would be a bit preferable to 

```
   sage: have_program('command') 
   True 
   sage: have_program('there_is_not_a_program_with_this_name') 
   False 
```

as far more people will know what 'ls' is. I doubt many will realise there is such a command called 'command'. I thought I knew Unix pretty well, but I was unaware of it until today. But it is a very minor point. 

So positive review from me. Change that docstring if you want, but otherwise leave it unchanged. 

I've also noticed a rather annoying message about a lack of *xdg-open* before. It looks like it might have been related - I see you have fixed that too, so hopefully I won't see that any more. 

I agree it is more logical to have one library function that works on any system, rather than loads of different implementations which are not portable. 

Thank you very much John. 

**Note to the release manager**
When this is merged, #8463 may be closed. 

Dave



---

archive/issue_events_096862.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-03-08T20:56:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8474#event-96862"
}
```



---

archive/issue_events_096863.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-03-08T20:56:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8474#event-96863"
}
```



---

archive/issue_comments_069207.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nAttachment: **[trac_8474-have-program.patch.gz](https://github.com/sagemath/sage/files/ticket8474/trac_8474-have-program.patch.gz)**",
    "created_at": "2010-03-08T20:56:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8474#issuecomment-69207",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:9" align="right">Comment 9</div>

Attachment: **[trac_8474-have-program.patch.gz](https://github.com/sagemath/sage/files/ticket8474/trac_8474-have-program.patch.gz)**



---

archive/issue_comments_069208.json:
```json
{
    "body": "Merged: **sage-4.3.4.alpha1**",
    "created_at": "2010-03-08T20:56:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8474",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8474#issuecomment-69208",
    "user": "https://github.com/mwhansen"
}
```

Merged: **sage-4.3.4.alpha1**
