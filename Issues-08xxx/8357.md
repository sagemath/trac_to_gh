# Issue 8357: eclib: suppress / delete files left by doctests and check, fix building in parallel

archive/issues_008357.json:
```json
{
    "assignees": [
        "https://github.com/JohnCremona"
    ],
    "body": "From [John Palmieri](http://groups.google.com/group/sage-devel/browse_thread/thread/976cf8ecb4896e7c):\n\n```\nWhen I run doctests on the file ell_rational_field.py, I end up with a\nsmall file called PRIMES in the current directory. This shouldn't\nhappen: running doctests shouldn't produce files in a non-temporary\ndirectory.\n[...]\n```\n\nThis is a follow-up to #7575.  Please see [comment:ticket:7575:24 comment 24+] for some progress.\n\nA new spkg is available at\n\n* http://sage.math.washington.edu/home/mpatel/trac/8357/eclib-20080310.p10.spkg\n\nIt includes the `PRIMES`, `1`, and `make check` fixes mentioned below and parallel build fixes (cf. #8306). \n\n**Note to release manager:** Merge only the spkg.\n\nComponent: **elliptic curves**\n\nAuthor: **John Cremona, Mitesh Patel**\n\nReviewer: **Minh Van Nguyen**\n\nMerged: **sage-4.3.4.alpha1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/8357_\n\n",
    "closed_at": "2010-03-07T00:23:05Z",
    "created_at": "2010-02-25T06:05:03Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "eclib: suppress / delete files left by doctests and check, fix building in parallel",
    "type": "issue",
    "updated_at": "2010-03-07T00:23:05Z",
    "url": "https://github.com/sagemath/sage/issues/8357",
    "user": "https://github.com/qed777"
}
```
From [John Palmieri](http://groups.google.com/group/sage-devel/browse_thread/thread/976cf8ecb4896e7c):

```
When I run doctests on the file ell_rational_field.py, I end up with a
small file called PRIMES in the current directory. This shouldn't
happen: running doctests shouldn't produce files in a non-temporary
directory.
[...]
```

This is a follow-up to #7575.  Please see [comment:ticket:7575:24 comment 24+] for some progress.

A new spkg is available at

* http://sage.math.washington.edu/home/mpatel/trac/8357/eclib-20080310.p10.spkg

It includes the `PRIMES`, `1`, and `make check` fixes mentioned below and parallel build fixes (cf. #8306). 

**Note to release manager:** Merge only the spkg.

Component: **elliptic curves**

Author: **John Cremona, Mitesh Patel**

Reviewer: **Minh Van Nguyen**

Merged: **sage-4.3.4.alpha1**

_Issue created by migration from https://trac.sagemath.org/ticket/8357_





---

archive/issue_events_103569.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-02-25T06:05:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
    "label_color": "0000ff",
    "label_name": "c: elliptic curves",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8357#event-103569"
}
```



---

archive/issue_events_103570.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-02-25T06:05:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8357#event-103570"
}
```



---

archive/issue_events_103571.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-02-25T06:05:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8357#event-103571"
}
```



---

archive/issue_events_103572.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-02-25T06:05:03Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "subject": "https://github.com/qed777",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8357#event-103572"
}
```



---

archive/issue_comments_065715.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThe quickest quick fix would be just to comment out line 372 in src/procs/marith.cc (in eclib).\n\nAnything else requires thought and testing, which I don't have time for i nthe next several days.",
    "created_at": "2010-02-25T09:22:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65715",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:1" align="right">comment:1</div>

The quickest quick fix would be just to comment out line 372 in src/procs/marith.cc (in eclib).

Anything else requires thought and testing, which I don't have time for i nthe next several days.



---

archive/issue_comments_065716.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,41 +4,19 @@\n When I run doctests on the file ell_rational_field.py, I end up with a\n small file called PRIMES in the current directory. This shouldn't\n happen: running doctests shouldn't produce files in a non-temporary\n-directory.  However, I can't figure out how this file gets there.  In\n-particular, if I delete the following doctests from the rank method,\n-then the file is not produced:\n-\n-{{{\n-diff -r 23241bd151e3 sage/schemes/elliptic_curves/\n-ell_rational_field.py\n---- a/sage/schemes/elliptic_curves/ell_rational_field.py        Thu\n-Feb 18 14:25:25 2010 -0800\n-+++ b/sage/schemes/elliptic_curves/ell_rational_field.py        Wed\n-Feb 24 20:37:09 2010 -0800\n-@@ -1679,14 +1679,6 @@\n-             sage: E.minimal_model().rank()\n-             1\n-\n--        A large example where mwrank doesn't determine the result\n-with certainty::\n--\n--            sage: EllipticCurve([1,0,0,0,37455]).rank(proof=False)\n--            0\n--            sage: EllipticCurve([1,0,0,0,37455]).rank(proof=True)\n--            Traceback (most recent call last):\n--            ...\n--            RuntimeError: Rank not provably correct.\n-         \"\"\"\n-         if proof is None:\n-             from sage.structure.proof.proof import get_flag\n-\n-}}}\n-\n-If I run these by hand from the command line, though, I don't see the\n-file PRIMES anywhere.  Can someone familiar with the elliptic curves\n-code open a ticket, chase this down, and fix it?\n+directory.\n+[...]\n ```\n \n This is a follow-up to #7575.  Please see [comment:ticket:7575:24 comment 24+] for some progress.\n \n+A new spkg is available at\n \n+* http://sage.math.washington.edu/home/mpatel/trac/8357/eclib-20080310.p10.spkg\n+\n+It includes\n+\n+* The quick fix mentioned below [attachment: trac_8357-suppress_PRIMES.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-suppress_PRIMES.patch.gz)\n+* Parallel build fixes from #8306: [attachment: trac_8357-eclib_makefiles.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-eclib_makefiles.patch.gz), [attachment: trac_8357-spkg.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-spkg.patch.gz)\n+\n+**Note to release manager:** Merge only the spkg.\n``````\n",
    "created_at": "2010-02-28T00:24:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65716",
    "user": "https://github.com/qed777"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,41 +4,19 @@
 When I run doctests on the file ell_rational_field.py, I end up with a
 small file called PRIMES in the current directory. This shouldn't
 happen: running doctests shouldn't produce files in a non-temporary
-directory.  However, I can't figure out how this file gets there.  In
-particular, if I delete the following doctests from the rank method,
-then the file is not produced:
-
-{{{
-diff -r 23241bd151e3 sage/schemes/elliptic_curves/
-ell_rational_field.py
---- a/sage/schemes/elliptic_curves/ell_rational_field.py        Thu
-Feb 18 14:25:25 2010 -0800
-+++ b/sage/schemes/elliptic_curves/ell_rational_field.py        Wed
-Feb 24 20:37:09 2010 -0800
-@@ -1679,14 +1679,6 @@
-             sage: E.minimal_model().rank()
-             1
-
--        A large example where mwrank doesn't determine the result
-with certainty::
--
--            sage: EllipticCurve([1,0,0,0,37455]).rank(proof=False)
--            0
--            sage: EllipticCurve([1,0,0,0,37455]).rank(proof=True)
--            Traceback (most recent call last):
--            ...
--            RuntimeError: Rank not provably correct.
-         """
-         if proof is None:
-             from sage.structure.proof.proof import get_flag
-
-}}}
-
-If I run these by hand from the command line, though, I don't see the
-file PRIMES anywhere.  Can someone familiar with the elliptic curves
-code open a ticket, chase this down, and fix it?
+directory.
+[...]
 ```
 
 This is a follow-up to #7575.  Please see [comment:ticket:7575:24 comment 24+] for some progress.
 
+A new spkg is available at
 
+* http://sage.math.washington.edu/home/mpatel/trac/8357/eclib-20080310.p10.spkg
+
+It includes
+
+* The quick fix mentioned below [attachment: trac_8357-suppress_PRIMES.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-suppress_PRIMES.patch.gz)
+* Parallel build fixes from #8306: [attachment: trac_8357-eclib_makefiles.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-eclib_makefiles.patch.gz), [attachment: trac_8357-spkg.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-spkg.patch.gz)
+
+**Note to release manager:** Merge only the spkg.
``````




---

archive/issue_events_103573.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-02-28T00:24:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "milestone_number": null,
    "milestone_title": "sage-4.3.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8357#event-103573"
}
```



---

archive/issue_comments_065717.json:
```json
{
    "body": "Author: **John Cremona, Mitesh Patel**",
    "created_at": "2010-02-28T00:24:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65717",
    "user": "https://github.com/qed777"
}
```

Author: **John Cremona, Mitesh Patel**



---

archive/issue_events_103574.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-02-28T00:24:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8357#event-103574"
}
```



---

archive/issue_events_103575.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-02-28T06:23:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8357#event-103575"
}
```



---

archive/issue_events_103576.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-02-28T06:23:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8357#event-103576"
}
```



---

archive/issue_comments_065718.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThere's still a timing(?) problem ([log](http://sage.math.washington.edu/home/mpatel/trac/8357/eclib-20080310.p10.log)).",
    "created_at": "2010-02-28T06:23:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65718",
    "user": "https://github.com/qed777"
}
```

<div id="comment:3" align="right">comment:3</div>

There's still a timing(?) problem ([log](http://sage.math.washington.edu/home/mpatel/trac/8357/eclib-20080310.p10.log)).



---

archive/issue_comments_065719.json:
```json
{
    "body": "Attachment: **[trac_8357-eclib_makefiles.patch.gz](https://github.com/sagemath/sage/files/ticket8357/trac_8357-eclib_makefiles.patch.gz)**\n\nTweak `MAKEFILE`s for parallel builds.  eclib src repo.",
    "created_at": "2010-02-28T13:29:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65719",
    "user": "https://github.com/qed777"
}
```

Attachment: **[trac_8357-eclib_makefiles.patch.gz](https://github.com/sagemath/sage/files/ticket8357/trac_8357-eclib_makefiles.patch.gz)**

Tweak `MAKEFILE`s for parallel builds.  eclib src repo.



---

archive/issue_comments_065720.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@qed777](#comment:3):\n\n> There's still a timing(?) problem ([log](http://sage.math.washington.edu/home/mpatel/trac/8357/eclib-20080310.p10.log)).\n\nI think the problem is that make sometimes attempts to build a target in `progs` before it's done building a requisite shared library, e.g., `install_so`.  I've updated the \"makefiles\" patch and spkg with a fix that I'm testing now.",
    "created_at": "2010-02-28T13:35:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65720",
    "user": "https://github.com/qed777"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@qed777](#comment:3):

> There's still a timing(?) problem ([log](http://sage.math.washington.edu/home/mpatel/trac/8357/eclib-20080310.p10.log)).

I think the problem is that make sometimes attempts to build a target in `progs` before it's done building a requisite shared library, e.g., `install_so`.  I've updated the "makefiles" patch and spkg with a fix that I'm testing now.



---

archive/issue_comments_065721.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@qed777](#comment:4):\n> Replying to [@qed777](#comment:3):\n> \n> > There's still a timing(?) problem ([log](http://sage.math.washington.edu/home/mpatel/trac/8357/eclib-20080310.p10.log)).\n\n> \n> I think the problem is that make sometimes attempts to build a target in `progs` before it's done building a requisite shared library, e.g., `install_so`.  I've updated the \"makefiles\" patch and spkg with a fix that I'm testing now.\n\nThat sounds likely.  We (I) should probably tidy this up;  there are several useful executables which are built, but the only one actually used by and accessible from Sage after the build is mwrank.  So i should change the targets so that the other progs are only built when doing a make check.",
    "created_at": "2010-02-28T13:45:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65721",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@qed777](#comment:4):
> Replying to [@qed777](#comment:3):
> 
> > There's still a timing(?) problem ([log](http://sage.math.washington.edu/home/mpatel/trac/8357/eclib-20080310.p10.log)).

> 
> I think the problem is that make sometimes attempts to build a target in `progs` before it's done building a requisite shared library, e.g., `install_so`.  I've updated the "makefiles" patch and spkg with a fix that I'm testing now.

That sounds likely.  We (I) should probably tidy this up;  there are several useful executables which are built, but the only one actually used by and accessible from Sage after the build is mwrank.  So i should change the targets so that the other progs are only built when doing a make check.



---

archive/issue_comments_065722.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@qed777](#comment:4):\n> [...] I've updated the \"makefiles\" patch and spkg with a fix that I'm testing now.\n\nIt seems to work and it survives a stress test on sage.math, e.g.,\n\n```sh\nexport MAKE=\"make -j20\"  # And NTL_PREFIX, etc.\nmake veryclean && make && make so && make veryclean && make && make so && [lots of reps] && ls\n```",
    "created_at": "2010-02-28T14:05:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65722",
    "user": "https://github.com/qed777"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@qed777](#comment:4):
> [...] I've updated the "makefiles" patch and spkg with a fix that I'm testing now.

It seems to work and it survives a stress test on sage.math, e.g.,

```sh
export MAKE="make -j20"  # And NTL_PREFIX, etc.
make veryclean && make && make so && make veryclean && make && make so && [lots of reps] && ls
```



---

archive/issue_comments_065723.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nmpatel:  if possible could you make he following additional edits to src/procs/Makefile (in eclib...p10):\n\n```\ndiff -r 809e34b4c146 procs/Makefile\n--- a/procs/Makefile\tSat Feb 27 15:42:31 2010 -0800\n+++ b/procs/Makefile\tSun Feb 28 20:08:44 2010 +0000\n@@ -105,7 +105,7 @@\n \tgzip procs.tar\n \n check: $(TESTS)\n-\trm -f PRIMES t\n+\trm -f PRIMES t 1\n \t./vectest1 < vectest.in >  t && diff t vectest.out\n \t./vectest2 < vectest.in >  t && diff t vectest.out\n \t./mattest1 < mattest.in >  t && diff t mattest.out\n@@ -128,7 +128,7 @@\n \t./rcubic < rcubic.in > t && diff t rcubic.out\n \t./lcubic < lcubic.in > t && diff t lcubic.out\n \t./tp2points < tp2points.in > t && diff t tp2points.out\n-\trm -f PRIMES t\n+\trm -f PRIMES t 1\n```\nIt's another temp file which gets left behind, this time after \"make check\".\n\nIf that's too much hassle I'll do it next time I make changes to the eclib spkg, but it would be convenient to do it now.",
    "created_at": "2010-02-28T20:11:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65723",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:7" align="right">comment:7</div>

mpatel:  if possible could you make he following additional edits to src/procs/Makefile (in eclib...p10):

```
diff -r 809e34b4c146 procs/Makefile
--- a/procs/Makefile	Sat Feb 27 15:42:31 2010 -0800
+++ b/procs/Makefile	Sun Feb 28 20:08:44 2010 +0000
@@ -105,7 +105,7 @@
 	gzip procs.tar
 
 check: $(TESTS)
-	rm -f PRIMES t
+	rm -f PRIMES t 1
 	./vectest1 < vectest.in >  t && diff t vectest.out
 	./vectest2 < vectest.in >  t && diff t vectest.out
 	./mattest1 < mattest.in >  t && diff t mattest.out
@@ -128,7 +128,7 @@
 	./rcubic < rcubic.in > t && diff t rcubic.out
 	./lcubic < lcubic.in > t && diff t lcubic.out
 	./tp2points < tp2points.in > t && diff t tp2points.out
-	rm -f PRIMES t
+	rm -f PRIMES t 1
```
It's another temp file which gets left behind, this time after "make check".

If that's too much hassle I'll do it next time I make changes to the eclib spkg, but it would be convenient to do it now.



---

archive/issue_comments_065724.json:
```json
{
    "body": "Diff of `spkg-install`, `SPKG.txt`.  eclib spkg repo.",
    "created_at": "2010-03-01T00:17:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65724",
    "user": "https://github.com/qed777"
}
```

Diff of `spkg-install`, `SPKG.txt`.  eclib spkg repo.



---

archive/issue_comments_065725.json:
```json
{
    "body": "Attachment: **[trac_8357-spkg.patch.gz](https://github.com/sagemath/sage/files/ticket8357/trac_8357-spkg.patch.gz)**\n\nAttachment: **[trac_8357-suppress_PRIMES.patch.gz](https://github.com/sagemath/sage/files/ticket8357/trac_8357-suppress_PRIMES.patch.gz)**\n\nDon't write `PRIMES`. Delete `1` after check.  eclib src repo",
    "created_at": "2010-03-01T00:18:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65725",
    "user": "https://github.com/qed777"
}
```

Attachment: **[trac_8357-spkg.patch.gz](https://github.com/sagemath/sage/files/ticket8357/trac_8357-spkg.patch.gz)**

Attachment: **[trac_8357-suppress_PRIMES.patch.gz](https://github.com/sagemath/sage/files/ticket8357/trac_8357-suppress_PRIMES.patch.gz)**

Don't write `PRIMES`. Delete `1` after check.  eclib src repo



---

archive/issue_events_103577.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-03-01T00:51:07Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "title_is": "eclib: suppress / delete files left by doctests and check, fix building in parallel",
    "title_was": "Doctesting ell_rational_field.py leaves a file PRIMES in the current directory",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8357#event-103577"
}
```



---

archive/issue_comments_065726.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@JohnCremona](#comment:7):\n> If that's too much hassle I'll do it next time I make changes to the eclib spkg, but it would be convenient to do it now.\n\nDone!  I've updated spkg and two patches.",
    "created_at": "2010-03-01T00:51:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65726",
    "user": "https://github.com/qed777"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@JohnCremona](#comment:7):
> If that's too much hassle I'll do it next time I make changes to the eclib spkg, but it would be convenient to do it now.

Done!  I've updated spkg and two patches.



---

archive/issue_comments_065727.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,7 +16,7 @@\n \n It includes\n \n-* The quick fix mentioned below [attachment: trac_8357-suppress_PRIMES.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-suppress_PRIMES.patch.gz)\n-* Parallel build fixes from #8306: [attachment: trac_8357-eclib_makefiles.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-eclib_makefiles.patch.gz), [attachment: trac_8357-spkg.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-spkg.patch.gz)\n+* `PRIMES` and \"make check\" fixes mentioned below: [attachment: trac_8357-suppress_PRIMES.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-suppress_PRIMES.patch.gz)\n+* Parallel build fixes (cf. #8306): [attachment: trac_8357-eclib_makefiles.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-eclib_makefiles.patch.gz), [attachment: trac_8357-spkg.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-spkg.patch.gz)\n \n **Note to release manager:** Merge only the spkg.\n``````\n",
    "created_at": "2010-03-01T00:51:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65727",
    "user": "https://github.com/qed777"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,7 +16,7 @@
 
 It includes
 
-* The quick fix mentioned below [attachment: trac_8357-suppress_PRIMES.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-suppress_PRIMES.patch.gz)
-* Parallel build fixes from #8306: [attachment: trac_8357-eclib_makefiles.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-eclib_makefiles.patch.gz), [attachment: trac_8357-spkg.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-spkg.patch.gz)
+* `PRIMES` and "make check" fixes mentioned below: [attachment: trac_8357-suppress_PRIMES.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-suppress_PRIMES.patch.gz)
+* Parallel build fixes (cf. #8306): [attachment: trac_8357-eclib_makefiles.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-eclib_makefiles.patch.gz), [attachment: trac_8357-spkg.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-spkg.patch.gz)
 
 **Note to release manager:** Merge only the spkg.
``````




---

archive/issue_events_103578.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-03-01T00:51:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8357#event-103578"
}
```



---

archive/issue_events_103579.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-03-01T00:51:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8357#event-103579"
}
```



---

archive/issue_comments_065728.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI noticed a different problem with `make check` on t2:\n\n```\nmake[3]: Entering directory `/scratch/mpatel/sage-4.3.0.1/spkg/build/eclib-20080310.p10/src/g0n'\nrm -f PRIMES t\n./modtest < modtest.in > t 2>/dev/null && diff t modtest.out \n./homtest < homtest.in > t && diff t homtest.out\n./hecketest < hecketest.in > t 2>/dev/null && diff t hecketest.out \n./mhcount < mhcount.in > t && diff t  mhcount.out\nrm -rf tmp_nf_dir\nmkdir tmp_nf_dir\nexport NF_DIR=tmp_nf_dir && ./tmanin < tmanin.in > t 2>/dev/null && diff t tmanin.out\n/bin/sh: NF_DIR=tmp_nf_dir: is not an identifier\nmake[3]: *** [check] Error 1\nmake[3]: Leaving directory `/scratch/mpatel/sage-4.3.0.1/spkg/build/eclib-20080310.p10/src/g0n'\n```\nI think we can fix this with, e.g.,\n\n```sh\nenv NF_DIR=tmp_nf_dir ./tmanin < tmanin.in > t 2>/dev/null && diff t tmanin.out\n```",
    "created_at": "2010-03-01T04:41:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65728",
    "user": "https://github.com/qed777"
}
```

<div id="comment:9" align="right">comment:9</div>

I noticed a different problem with `make check` on t2:

```
make[3]: Entering directory `/scratch/mpatel/sage-4.3.0.1/spkg/build/eclib-20080310.p10/src/g0n'
rm -f PRIMES t
./modtest < modtest.in > t 2>/dev/null && diff t modtest.out 
./homtest < homtest.in > t && diff t homtest.out
./hecketest < hecketest.in > t 2>/dev/null && diff t hecketest.out 
./mhcount < mhcount.in > t && diff t  mhcount.out
rm -rf tmp_nf_dir
mkdir tmp_nf_dir
export NF_DIR=tmp_nf_dir && ./tmanin < tmanin.in > t 2>/dev/null && diff t tmanin.out
/bin/sh: NF_DIR=tmp_nf_dir: is not an identifier
make[3]: *** [check] Error 1
make[3]: Leaving directory `/scratch/mpatel/sage-4.3.0.1/spkg/build/eclib-20080310.p10/src/g0n'
```
I think we can fix this with, e.g.,

```sh
env NF_DIR=tmp_nf_dir ./tmanin < tmanin.in > t 2>/dev/null && diff t tmanin.out
```



---

archive/issue_comments_065729.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI tested the current version of the spkg.  (This does nto have the suggested changes to the handling of NF_DIR).  All was well.\n\nI did not make new changes (for the NF_DIR thing) since I thought that would be too confusing.  But I'll be happy to check the next version of p10 in due course.",
    "created_at": "2010-03-01T14:27:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65729",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:10" align="right">comment:10</div>

I tested the current version of the spkg.  (This does nto have the suggested changes to the handling of NF_DIR).  All was well.

I did not make new changes (for the NF_DIR thing) since I thought that would be too confusing.  But I'll be happy to check the next version of p10 in due course.



---

archive/issue_comments_065730.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThere is a  simpler solution to the problem with \"export NF_DIR\".  The code uses a default directory name for this, namely \"newforms\",  which can be over-ridden by the use of the environment variable NF_DIR.  For this test therefore we can replace the 2 lines \"rm -rf tmp_nf_dir\" by \"rm -rf newforms\" (strictly only the second one is needed) and remove all the starts of lines of the form \"export NF_DIR=tmp_nf_dir && \".\n(This is in src/g0n/Makefile).\n\nHere's why I did not do this in the first place: by own private copy of this code has a newforms directory which contains 3.4G of data which took many many processor-years to compute.  I do not want a simple \"make check\" to delete that so I put in this temporary (and non-default) tmp_nf_dir thing instead.  But for the Sage distribution that is not needed.\n\nI can attach a replacement Makefile here if that would be convenient, for yet another version of p10.",
    "created_at": "2010-03-01T19:52:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65730",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:11" align="right">comment:11</div>

There is a  simpler solution to the problem with "export NF_DIR".  The code uses a default directory name for this, namely "newforms",  which can be over-ridden by the use of the environment variable NF_DIR.  For this test therefore we can replace the 2 lines "rm -rf tmp_nf_dir" by "rm -rf newforms" (strictly only the second one is needed) and remove all the starts of lines of the form "export NF_DIR=tmp_nf_dir && ".
(This is in src/g0n/Makefile).

Here's why I did not do this in the first place: by own private copy of this code has a newforms directory which contains 3.4G of data which took many many processor-years to compute.  I do not want a simple "make check" to delete that so I put in this temporary (and non-default) tmp_nf_dir thing instead.  But for the Sage distribution that is not needed.

I can attach a replacement Makefile here if that would be convenient, for yet another version of p10.



---

archive/issue_comments_065731.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nSure, that sounds good.",
    "created_at": "2010-03-01T21:11:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65731",
    "user": "https://github.com/qed777"
}
```

<div id="comment:12" align="right">comment:12</div>

Sure, that sounds good.



---

archive/issue_comments_065732.json:
```json
{
    "body": "replacement src/g0n/Makefile",
    "created_at": "2010-03-01T22:03:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65732",
    "user": "https://github.com/JohnCremona"
}
```

replacement src/g0n/Makefile



---

archive/issue_comments_065733.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAttachment: **[Makefile.gz](https://github.com/sagemath/sage/files/ticket8357/Makefile.gz)**\n\nReplying to [@qed777](#comment:12):\n> Sure, that sounds good.\n\nI have attached the replacement Makefile -- could you update the spkg with it?",
    "created_at": "2010-03-01T22:04:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65733",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:13" align="right">comment:13</div>

Attachment: **[Makefile.gz](https://github.com/sagemath/sage/files/ticket8357/Makefile.gz)**

Replying to [@qed777](#comment:12):
> Sure, that sounds good.

I have attached the replacement Makefile -- could you update the spkg with it?



---

archive/issue_comments_065734.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nDone!  The package now builds in parallel and `make check` now works for me on t2 and sage.math.",
    "created_at": "2010-03-02T22:32:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65734",
    "user": "https://github.com/qed777"
}
```

<div id="comment:14" align="right">comment:14</div>

Done!  The package now builds in parallel and `make check` now works for me on t2 and sage.math.



---

archive/issue_comments_065735.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,9 +14,6 @@\n \n * http://sage.math.washington.edu/home/mpatel/trac/8357/eclib-20080310.p10.spkg\n \n-It includes\n-\n-* `PRIMES` and \"make check\" fixes mentioned below: [attachment: trac_8357-suppress_PRIMES.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-suppress_PRIMES.patch.gz)\n-* Parallel build fixes (cf. #8306): [attachment: trac_8357-eclib_makefiles.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-eclib_makefiles.patch.gz), [attachment: trac_8357-spkg.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-spkg.patch.gz)\n+It includes the `PRIMES`, `1`, and `make check` fixes mentioned below and parallel build fixes (cf. #8306). \n \n **Note to release manager:** Merge only the spkg.\n``````\n",
    "created_at": "2010-03-02T22:32:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65735",
    "user": "https://github.com/qed777"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,9 +14,6 @@
 
 * http://sage.math.washington.edu/home/mpatel/trac/8357/eclib-20080310.p10.spkg
 
-It includes
-
-* `PRIMES` and "make check" fixes mentioned below: [attachment: trac_8357-suppress_PRIMES.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-suppress_PRIMES.patch.gz)
-* Parallel build fixes (cf. #8306): [attachment: trac_8357-eclib_makefiles.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-eclib_makefiles.patch.gz), [attachment: trac_8357-spkg.patch](https://github.com/sagemath/sage/files/ticket8357/trac_8357-spkg.patch.gz)
+It includes the `PRIMES`, `1`, and `make check` fixes mentioned below and parallel build fixes (cf. #8306). 
 
 **Note to release manager:** Merge only the spkg.
``````




---

archive/issue_comments_065736.json:
```json
{
    "body": "Attachment: **[trac_8357-newforms_dir.patch.gz](https://github.com/sagemath/sage/files/ticket8357/trac_8357-newforms_dir.patch.gz)**\n\nSimplify `g0n/Makefile`.  eclib src repo.",
    "created_at": "2010-03-02T22:34:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65736",
    "user": "https://github.com/qed777"
}
```

Attachment: **[trac_8357-newforms_dir.patch.gz](https://github.com/sagemath/sage/files/ticket8357/trac_8357-newforms_dir.patch.gz)**

Simplify `g0n/Makefile`.  eclib src repo.



---

archive/issue_events_103580.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-03-06T23:44:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8357#event-103580"
}
```



---

archive/issue_events_103581.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-03-06T23:44:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8357#event-103581"
}
```



---

archive/issue_comments_065737.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThe updated eclib package [eclib-20080310.p10.spkg](http://sage.math.washington.edu/home/mpatel/trac/8357/eclib-20080310.p10.spkg) looks good. It solves the unexpected annoyance introduced by #7575.",
    "created_at": "2010-03-06T23:44:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65737",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:15" align="right">comment:15</div>

The updated eclib package [eclib-20080310.p10.spkg](http://sage.math.washington.edu/home/mpatel/trac/8357/eclib-20080310.p10.spkg) looks good. It solves the unexpected annoyance introduced by #7575.



---

archive/issue_comments_065738.json:
```json
{
    "body": "Reviewer: **Minh Van Nguyen**",
    "created_at": "2010-03-06T23:44:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65738",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Reviewer: **Minh Van Nguyen**



---

archive/issue_events_103582.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-03-07T00:23:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8357#event-103582"
}
```



---

archive/issue_events_103583.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-03-07T00:23:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8357#event-103583"
}
```



---

archive/issue_comments_065739.json:
```json
{
    "body": "Merged: **sage-4.3.4.alpha1**",
    "created_at": "2010-03-07T00:23:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8357#issuecomment-65739",
    "user": "https://github.com/mwhansen"
}
```

Merged: **sage-4.3.4.alpha1**
