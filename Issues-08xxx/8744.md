# Issue 8744: Improve add_edge in BipartiteGraph to make it independent from the current coloring

archive/issues_008744.json:
```json
{
    "assignees": [],
    "body": "The current add_edge method in BipartiteGraph refuses to add an edge between two vertices belonging to the same set. This may seem perfectly fine, but when the two vertices are in distinct connected components, the graph may stay bipartite with a new edge even if the vertices are in the same partition :\n\n```\nsage: g = BipartiteGraph(2*graphs.GridGraph([4,4]))\nsage: g.add_edge(0,30)\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n\n/usr/local/sage/devel/sage-bip/sage/graphs/<ipython console> in <module>()\n\n/usr/local/sage/local/lib/python2.6/site-packages/sage/graphs/bipartite_graph.pyc in add_edge(self, u, v, label)\n    690         # check for endpoints in different partitions\n    691         if self.left.issuperset((u,v)) or self.right.issuperset((u,v)):\n--> 692             raise RuntimeError('Edge vertices must lie in different partitions.')\n    693 \n    694         # add the edge\n\nRuntimeError: Edge vertices must lie in different partitions.\n```\n\nFrom the discussion on #8425 :\n\n//////\nTo be honest, I really would like to be able to deal with Bipartite Graphs without having to specify myself in which set my vertices are... What would you think of setting a vertex to \"left\" if the users does not specify left=True or right=True, and modify a bit add_edge ? This way, the edge could be added immediately if the two vertices at its ends are in different sets, and if they are not the colors could be changed whenever possible to fit the graph with a new edge ?\n\nActually, when a graph is bipartite and split in two sets, you can add an edge in exactly two situations :\n\n- The colors between the endpoints are different\n\n- The colors are the same, but the vertices belong to two different connected components\n\nSo two solutions :\n\n- Add an edge if the colors are different. If they are not, check that there is no path from one vertex to the other, and if it is the case reverse the coloring of one of the two components and add the edge\n\n- Fix a partition for any connected component, and maintain them updated.\n\nThe problem is that the first makes of add_edge a linear-time function. The second way keeps it to O(1), but we would have to update the list of connected components, even if it is not so hard. The truth is I do not know what is best for this class, and I'm eager to learn your advice on it. It is also possible to add a flag like \"allow_set_modifications\" if you want to keep the possibility to refuse an addition in some cases... But anyway this should be mentionned in the docstrings :-) \n///////\n\nIf anybody working on the BipartiteGraph class is willing to give all this a try.... :-)\n\nNathann\n\nAssignee: **@jasongrout, @nathanncohen, @rlmill**\n\nCC:  @rhinton brunellus\n\nBranch/Commit: **[8eb29c8](https://github.com/sagemath/sagetrac-mirror/commit/8eb29c80b559f550a78f4b0c1be8647cc9892483)**\n\nReviewer: **David Coudert**\n\nAuthor: **Bruno Edwards, David Coudert**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/8744_\n\n",
    "closed_at": "2023-01-05T23:16:57Z",
    "created_at": "2010-04-22T08:14:52Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Improve add_edge in BipartiteGraph to make it independent from the current coloring",
    "type": "issue",
    "updated_at": "2023-01-05T23:16:57Z",
    "url": "https://github.com/sagemath/sage/issues/8744",
    "user": "https://github.com/nathanncohen"
}
```
The current add_edge method in BipartiteGraph refuses to add an edge between two vertices belonging to the same set. This may seem perfectly fine, but when the two vertices are in distinct connected components, the graph may stay bipartite with a new edge even if the vertices are in the same partition :

```
sage: g = BipartiteGraph(2*graphs.GridGraph([4,4]))
sage: g.add_edge(0,30)
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)

/usr/local/sage/devel/sage-bip/sage/graphs/<ipython console> in <module>()

/usr/local/sage/local/lib/python2.6/site-packages/sage/graphs/bipartite_graph.pyc in add_edge(self, u, v, label)
    690         # check for endpoints in different partitions
    691         if self.left.issuperset((u,v)) or self.right.issuperset((u,v)):
--> 692             raise RuntimeError('Edge vertices must lie in different partitions.')
    693 
    694         # add the edge

RuntimeError: Edge vertices must lie in different partitions.
```

From the discussion on #8425 :

//////
To be honest, I really would like to be able to deal with Bipartite Graphs without having to specify myself in which set my vertices are... What would you think of setting a vertex to "left" if the users does not specify left=True or right=True, and modify a bit add_edge ? This way, the edge could be added immediately if the two vertices at its ends are in different sets, and if they are not the colors could be changed whenever possible to fit the graph with a new edge ?

Actually, when a graph is bipartite and split in two sets, you can add an edge in exactly two situations :

- The colors between the endpoints are different

- The colors are the same, but the vertices belong to two different connected components

So two solutions :

- Add an edge if the colors are different. If they are not, check that there is no path from one vertex to the other, and if it is the case reverse the coloring of one of the two components and add the edge

- Fix a partition for any connected component, and maintain them updated.

The problem is that the first makes of add_edge a linear-time function. The second way keeps it to O(1), but we would have to update the list of connected components, even if it is not so hard. The truth is I do not know what is best for this class, and I'm eager to learn your advice on it. It is also possible to add a flag like "allow_set_modifications" if you want to keep the possibility to refuse an addition in some cases... But anyway this should be mentionned in the docstrings :-) 
///////

If anybody working on the BipartiteGraph class is willing to give all this a try.... :-)

Nathann

Assignee: **@jasongrout, @nathanncohen, @rlmill**

CC:  @rhinton brunellus

Branch/Commit: **[8eb29c8](https://github.com/sagemath/sagetrac-mirror/commit/8eb29c80b559f550a78f4b0c1be8647cc9892483)**

Reviewer: **David Coudert**

Author: **Bruno Edwards, David Coudert**

_Issue created by migration from https://trac.sagemath.org/ticket/8744_





---

archive/issue_events_100696.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2010-04-22T08:14:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100696"
}
```



---

archive/issue_events_100697.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2010-04-22T08:14:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "component: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100697"
}
```



---

archive/issue_events_100698.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2010-04-22T08:14:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100698"
}
```



---

archive/issue_events_100699.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2010-04-22T08:14:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100699"
}
```



---

archive/issue_events_100700.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100700"
}
```



---

archive/issue_events_100701.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100701"
}
```



---

archive/issue_events_100702.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100702"
}
```



---

archive/issue_events_100703.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100703"
}
```



---

archive/issue_events_100704.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100704"
}
```



---

archive/issue_events_100705.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100705"
}
```



---

archive/issue_events_100706.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100706"
}
```



---

archive/issue_events_100707.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100707"
}
```



---

archive/issue_comments_072795.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nI just tested this out using the example in the description. It worked without any error message. So it's safe to say this has been fixed?",
    "created_at": "2022-03-11T16:35:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72795",
    "user": "https://github.com/enjeck"
}
```

<a id='comment:6'>Comment 6:</a>
I just tested this out using the example in the description. It worked without any error message. So it's safe to say this has been fixed?



---

archive/issue_comments_072796.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -35,7 +35,7 @@\n \n - Fix a partition for any connected component, and maintain them updated.\n \n-The problem is that the first makes of add_edge a linear-time function. The second way keeps it to O(1), but we would have to update the list of connected components, even if it is not so hard. The truth is I do not know what is best for this class, and I'm eager to learn your advice on it. It is also possible to add a flag like \"allow_set_modifications\" if you want to keep the possibility to refuse an addition in somec ases... But anyway this should be mentionned in the docstrings :-) \n+The problem is that the first makes of add_edge a linear-time function. The second way keeps it to O(1), but we would have to update the list of connected components, even if it is not so hard. The truth is I do not know what is best for this class, and I'm eager to learn your advice on it. It is also possible to add a flag like \"allow_set_modifications\" if you want to keep the possibility to refuse an addition in some cases... But anyway this should be mentionned in the docstrings :-) \n ///////\n \n If anybody working on the BipartiteGraph class is willing to give all this a try.... :-)\n``````\n",
    "created_at": "2022-03-12T10:31:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72796",
    "user": "https://github.com/dcoudert"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -35,7 +35,7 @@
 
 - Fix a partition for any connected component, and maintain them updated.
 
-The problem is that the first makes of add_edge a linear-time function. The second way keeps it to O(1), but we would have to update the list of connected components, even if it is not so hard. The truth is I do not know what is best for this class, and I'm eager to learn your advice on it. It is also possible to add a flag like "allow_set_modifications" if you want to keep the possibility to refuse an addition in somec ases... But anyway this should be mentionned in the docstrings :-) 
+The problem is that the first makes of add_edge a linear-time function. The second way keeps it to O(1), but we would have to update the list of connected components, even if it is not so hard. The truth is I do not know what is best for this class, and I'm eager to learn your advice on it. It is also possible to add a flag like "allow_set_modifications" if you want to keep the possibility to refuse an addition in some cases... But anyway this should be mentionned in the docstrings :-) 
 ///////
 
 If anybody working on the BipartiteGraph class is willing to give all this a try.... :-)
``````




---

archive/issue_comments_072797.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nNot fully as this ticket raises the question of the addition of edges between vertices lying in different connected components.\n\nSo far, the order in which edges are added matters.\n\n```\nsage: g = BipartiteGraph()\nsage: g.add_edges([(0, 1), (1, 2), (2, 3)])\nsage: g = BipartiteGraph()\nsage: g.add_edges([(0, 1), (3, 2), (1, 2)])\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-23-fa0c70b30e4b> in <module>\n----> 1 g.add_edges([(Integer(0), Integer(1)), (Integer(3), Integer(2)), (Integer(1), Integer(2))])\n\n~/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/graphs/bipartite_graph.py in add_edges(self, edges, loops)\n    931             # check for endpoints in different partitions\n    932             if self.left.issuperset((u, v)) or self.right.issuperset((u, v)):\n--> 933                 raise RuntimeError(\"edge vertices must lie in different partitions\")\n    934 \n    935             # automatically decide partitions for the newly created vertices\n\nRuntimeError: edge vertices must lie in different partitions\n```\nI have no opinion on the best solution. Regular users of this class should clarify expected behavior.",
    "created_at": "2022-03-12T10:31:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72797",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:7'>Comment 7:</a>
Not fully as this ticket raises the question of the addition of edges between vertices lying in different connected components.

So far, the order in which edges are added matters.

```
sage: g = BipartiteGraph()
sage: g.add_edges([(0, 1), (1, 2), (2, 3)])
sage: g = BipartiteGraph()
sage: g.add_edges([(0, 1), (3, 2), (1, 2)])
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-23-fa0c70b30e4b> in <module>
----> 1 g.add_edges([(Integer(0), Integer(1)), (Integer(3), Integer(2)), (Integer(1), Integer(2))])

~/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/graphs/bipartite_graph.py in add_edges(self, edges, loops)
    931             # check for endpoints in different partitions
    932             if self.left.issuperset((u, v)) or self.right.issuperset((u, v)):
--> 933                 raise RuntimeError("edge vertices must lie in different partitions")
    934 
    935             # automatically decide partitions for the newly created vertices

RuntimeError: edge vertices must lie in different partitions
```
I have no opinion on the best solution. Regular users of this class should clarify expected behavior.



---

archive/issue_events_100708.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2022-04-22T15:26:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100708"
}
```



---

archive/issue_events_100709.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2022-04-22T15:26:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100709"
}
```



---

archive/issue_events_100710.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2022-04-22T15:26:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100710"
}
```



---

archive/issue_events_100711.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100711"
}
```



---

archive/issue_events_100712.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100712"
}
```



---

archive/issue_comments_072798.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nMade a start on this ticket. Seeing as there is already an inherited .connected_components() method, that calculates them on the fly (rather than maintaining an invariant), I'm using that.",
    "created_at": "2022-11-17T16:04:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72798",
    "user": "https://github.com/Bruno-TT"
}
```

<a id='comment:10'>Comment 10:</a>
Made a start on this ticket. Seeing as there is already an inherited .connected_components() method, that calculates them on the fly (rather than maintaining an invariant), I'm using that.



---

archive/issue_comments_072799.json:
```json
{
    "body": "Branch: **[/u/gh-Bruno-TT/improved-add-edge](https://github.com/sagemath/sagetrac-mirror/tree//u/gh-Bruno-TT/improved-add-edge)**",
    "created_at": "2022-11-17T16:05:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72799",
    "user": "https://github.com/Bruno-TT"
}
```

Branch: **[/u/gh-Bruno-TT/improved-add-edge](https://github.com/sagemath/sagetrac-mirror/tree//u/gh-Bruno-TT/improved-add-edge)**



---

archive/issue_comments_072800.json:
```json
{
    "body": "Commit: **[c3028e7](https://github.com/sagemath/sagetrac-mirror/commit/c3028e74d80d7f8473b3e421ba6d54ab95f288f9)**",
    "created_at": "2022-11-17T16:05:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72800",
    "user": "https://github.com/Bruno-TT"
}
```

Commit: **[c3028e7](https://github.com/sagemath/sagetrac-mirror/commit/c3028e74d80d7f8473b3e421ba6d54ab95f288f9)**



---

archive/issue_comments_072801.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nYou should use `self.connected_component_containing_vertex(v, sort=False)`.\n\nFor coding style, prefer `old_left = frozenset(self.left)` with spaces around `=`.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce05306774ecec1fdd0f8a9657e956e6ac8fda1f\">ce05306</a></td><td><code>initial logic / proof of concept</code></td></tr></table>\n",
    "created_at": "2022-11-17T16:22:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72801",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:12'>Comment 12:</a>
You should use `self.connected_component_containing_vertex(v, sort=False)`.

For coding style, prefer `old_left = frozenset(self.left)` with spaces around `=`.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce05306774ecec1fdd0f8a9657e956e6ac8fda1f">ce05306</a></td><td><code>initial logic / proof of concept</code></td></tr></table>




---

archive/issue_comments_072802.json:
```json
{
    "body": "Changed commit from **[c3028e7](https://github.com/sagemath/sagetrac-mirror/commit/c3028e74d80d7f8473b3e421ba6d54ab95f288f9)** to **[ce05306](https://github.com/sagemath/sagetrac-mirror/commit/ce05306774ecec1fdd0f8a9657e956e6ac8fda1f)**",
    "created_at": "2022-11-17T16:22:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72802",
    "user": "https://github.com/dcoudert"
}
```

Changed commit from **[c3028e7](https://github.com/sagemath/sagetrac-mirror/commit/c3028e74d80d7f8473b3e421ba6d54ab95f288f9)** to **[ce05306](https://github.com/sagemath/sagetrac-mirror/commit/ce05306774ecec1fdd0f8a9657e956e6ac8fda1f)**



---

archive/issue_comments_072803.json:
```json
{
    "body": "Changed commit from **[ce05306](https://github.com/sagemath/sagetrac-mirror/commit/ce05306774ecec1fdd0f8a9657e956e6ac8fda1f)** to **[c46e838](https://github.com/sagemath/sagetrac-mirror/commit/c46e83804a3221529c7477dd350662c701540414)**",
    "created_at": "2022-11-18T19:40:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72803",
    "user": "https://github.com/Bruno-TT"
}
```

Changed commit from **[ce05306](https://github.com/sagemath/sagetrac-mirror/commit/ce05306774ecec1fdd0f8a9657e956e6ac8fda1f)** to **[c46e838](https://github.com/sagemath/sagetrac-mirror/commit/c46e83804a3221529c7477dd350662c701540414)**



---

archive/issue_comments_072804.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nReplying to [David Coudert](#comment%3A12):\n> You should use `self.connected_component_containing_vertex(v, sort=False)`.\n\nGood spot, thanks!\n\n> For coding style, prefer `old_left = frozenset(self.left)` with spaces around `=`.\n\nThanks, will do this tomorrow.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c46e83804a3221529c7477dd350662c701540414\">c46e838</a></td><td><code>refactoring + improvements + warning + doctests</code></td></tr></table>\n",
    "created_at": "2022-11-18T19:40:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72804",
    "user": "https://github.com/Bruno-TT"
}
```

<a id='comment:13'>Comment 13:</a>
Replying to [David Coudert](#comment%3A12):
> You should use `self.connected_component_containing_vertex(v, sort=False)`.

Good spot, thanks!

> For coding style, prefer `old_left = frozenset(self.left)` with spaces around `=`.

Thanks, will do this tomorrow.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c46e83804a3221529c7477dd350662c701540414">c46e838</a></td><td><code>refactoring + improvements + warning + doctests</code></td></tr></table>




---

archive/issue_comments_072805.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\n`add_edge`:\n* you don't need to save current left/right\n* the warning is not necessary (we usually don't do that). The behavior of the method should be well documented. \n\nThere is something wrong in the proposed behavior for `add_edges`, and it's true that other `add_edges` methods in the graph module must also be corrected (in other tickets). The issue is that we modify the graph before raising an error. It would be much better to first check if it is possible to add all edges and then to actually add them and update the partition accordingly or raise an error without modifying the graph.",
    "created_at": "2022-11-19T08:55:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72805",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:14'>Comment 14:</a>
`add_edge`:
* you don't need to save current left/right
* the warning is not necessary (we usually don't do that). The behavior of the method should be well documented. 

There is something wrong in the proposed behavior for `add_edges`, and it's true that other `add_edges` methods in the graph module must also be corrected (in other tickets). The issue is that we modify the graph before raising an error. It would be much better to first check if it is possible to add all edges and then to actually add them and update the partition accordingly or raise an error without modifying the graph.



---

archive/issue_comments_072806.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nReplying to [David Coudert](#comment%3A14):\n> `add_edge`:\n> * you don't need to save current left/right\n\nThanks, good spot - removed it.\n\n> * the warning is not necessary (we usually don't do that). The behavior of the method should be well documented. \n\nCool, I've removed the warning and updated the tests + documentation.\n\n> There is something wrong in the proposed behavior for `add_edges`, and it's true that other `add_edges` methods in the graph module must also be corrected (in other tickets). The issue is that we modify the graph before raising an error. It would be much better to first check if it is possible to add all edges and then to actually add them and update the partition accordingly or raise an error without modifying the graph.\n\nGood idea, I didn't think of that. I'll try and implement an algorithm now.",
    "created_at": "2022-11-22T14:53:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72806",
    "user": "https://github.com/Bruno-TT"
}
```

<a id='comment:15'>Comment 15:</a>
Replying to [David Coudert](#comment%3A14):
> `add_edge`:
> * you don't need to save current left/right

Thanks, good spot - removed it.

> * the warning is not necessary (we usually don't do that). The behavior of the method should be well documented. 

Cool, I've removed the warning and updated the tests + documentation.

> There is something wrong in the proposed behavior for `add_edges`, and it's true that other `add_edges` methods in the graph module must also be corrected (in other tickets). The issue is that we modify the graph before raising an error. It would be much better to first check if it is possible to add all edges and then to actually add them and update the partition accordingly or raise an error without modifying the graph.

Good idea, I didn't think of that. I'll try and implement an algorithm now.



---

archive/issue_comments_072807.json:
```json
{
    "body": "Changed commit from **[c46e838](https://github.com/sagemath/sagetrac-mirror/commit/c46e83804a3221529c7477dd350662c701540414)** to **[5cebd58](https://github.com/sagemath/sagetrac-mirror/commit/5cebd5861bcfd8744224949bb5c6d97f837e6b51)**",
    "created_at": "2022-11-24T17:58:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72807",
    "user": "https://github.com/Bruno-TT"
}
```

Changed commit from **[c46e838](https://github.com/sagemath/sagetrac-mirror/commit/c46e83804a3221529c7477dd350662c701540414)** to **[5cebd58](https://github.com/sagemath/sagetrac-mirror/commit/5cebd5861bcfd8744224949bb5c6d97f837e6b51)**



---

archive/issue_comments_072808.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nUpdate: I've implemented the algorithm to check whether adding a set of edges is possible\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7d92dfda14062fc3e81325c76801b129430e907d\">7d92dfd</a></td><td><code>formatting + docs and doctest + removed warning</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5cebd5861bcfd8744224949bb5c6d97f837e6b51\">5cebd58</a></td><td><code>add_edges is now all-or-nothing + tests</code></td></tr></table>\n",
    "created_at": "2022-11-24T17:58:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72808",
    "user": "https://github.com/Bruno-TT"
}
```

<a id='comment:16'>Comment 16:</a>
Update: I've implemented the algorithm to check whether adding a set of edges is possible

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7d92dfda14062fc3e81325c76801b129430e907d">7d92dfd</a></td><td><code>formatting + docs and doctest + removed warning</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5cebd5861bcfd8744224949bb5c6d97f837e6b51">5cebd58</a></td><td><code>add_edges is now all-or-nothing + tests</code></td></tr></table>




---

archive/issue_events_100713.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2022-11-26T15:57:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100713"
}
```



---

archive/issue_events_100714.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2022-11-26T15:57:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100714"
}
```



---

archive/issue_comments_072809.json:
```json
{
    "body": "Changed branch from **[/u/gh-Bruno-TT/improved-add-edge](https://github.com/sagemath/sagetrac-mirror/tree//u/gh-Bruno-TT/improved-add-edge)** to **[public/graphs/8744_add_edge](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/8744_add_edge)**",
    "created_at": "2022-11-26T15:57:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72809",
    "user": "https://github.com/dcoudert"
}
```

Changed branch from **[/u/gh-Bruno-TT/improved-add-edge](https://github.com/sagemath/sagetrac-mirror/tree//u/gh-Bruno-TT/improved-add-edge)** to **[public/graphs/8744_add_edge](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/8744_add_edge)**



---

archive/issue_comments_072810.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nI moved the branch to public and pushed a review ticket (easier than explaining all the details). Let me know if you agree. \n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0db1a7d3906e1dfdb377926674dc8fac13fa6280\">0db1a7d</a></td><td><code>trac #8744: merge with 9.8.beta4</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3dfe5fbbf3f1d7cb8da10887e19e69abbb11bce0\">3dfe5fb</a></td><td><code>trac #8744: review commit</code></td></tr></table>\n",
    "created_at": "2022-11-26T15:57:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72810",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:17'>Comment 17:</a>
I moved the branch to public and pushed a review ticket (easier than explaining all the details). Let me know if you agree. 

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0db1a7d3906e1dfdb377926674dc8fac13fa6280">0db1a7d</a></td><td><code>trac #8744: merge with 9.8.beta4</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3dfe5fbbf3f1d7cb8da10887e19e69abbb11bce0">3dfe5fb</a></td><td><code>trac #8744: review commit</code></td></tr></table>




---

archive/issue_comments_072811.json:
```json
{
    "body": "Reviewer: **David Coudert**",
    "created_at": "2022-11-26T15:57:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72811",
    "user": "https://github.com/dcoudert"
}
```

Reviewer: **David Coudert**



---

archive/issue_comments_072812.json:
```json
{
    "body": "Changed commit from **[5cebd58](https://github.com/sagemath/sagetrac-mirror/commit/5cebd5861bcfd8744224949bb5c6d97f837e6b51)** to **[3dfe5fb](https://github.com/sagemath/sagetrac-mirror/commit/3dfe5fbbf3f1d7cb8da10887e19e69abbb11bce0)**",
    "created_at": "2022-11-26T15:57:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72812",
    "user": "https://github.com/dcoudert"
}
```

Changed commit from **[5cebd58](https://github.com/sagemath/sagetrac-mirror/commit/5cebd5861bcfd8744224949bb5c6d97f837e6b51)** to **[3dfe5fb](https://github.com/sagemath/sagetrac-mirror/commit/3dfe5fbbf3f1d7cb8da10887e19e69abbb11bce0)**



---

archive/issue_comments_072813.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nWhy have you added the statement `# autopep8: off` ?",
    "created_at": "2022-11-26T15:59:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72813",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:18'>Comment 18:</a>
Why have you added the statement `# autopep8: off` ?



---

archive/issue_comments_072814.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nReplying to [David Coudert](#comment%3A17):\n> I moved the branch to public and pushed a review ticket (easier than explaining all the details). Let me know if you agree. \n\nAssuming this is a typo and you mean review commit? If not then I can't find the ticket \n\n|                                                                                                                                                 |                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|\n|[3dfe5fb](https://github.com/sagemath/sagetrac-mirror/commit/3dfe5fbbf3f1d7cb8da10887e19e69abbb11bce0)|`trac #8744: review commit`|\n\nI don't quite understand why you've chosen to remove the\n\n```\nreturn set(left), set(right), vertex_in_left\n...\nself.left, self.right, vertex_in_left = b\n```\n\nand replace it with \n\n\n```\nreturn vertex_in_left\n...\n# If we get here, then we've found a valid bipartition.\n        # We update the bipartition\n        self.left.clear()\n        self.right.clear()\n        for v in vertex_in_left:\n            if vertex_in_left[v]:\n                self.left.add(v)\n            else:\n                self.right.add(v)\n```\n\nI understand that vertex_in_left contains all the info needed to reconstruct the sets, but surely it's more efficient to just return the set objects and replace the references inside the graph, rather than adding another loop to reconstruct them?\n\nOther than that, I like all the changes you made. It was a good idea having one edges_to_add list instead of us,vs,labels.",
    "created_at": "2022-12-10T14:40:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72814",
    "user": "https://github.com/Bruno-TT"
}
```

<a id='comment:19'>Comment 19:</a>
Replying to [David Coudert](#comment%3A17):
> I moved the branch to public and pushed a review ticket (easier than explaining all the details). Let me know if you agree. 

Assuming this is a typo and you mean review commit? If not then I can't find the ticket 

|                                                                                                                                                 |                           |
|-------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|
|[3dfe5fb](https://github.com/sagemath/sagetrac-mirror/commit/3dfe5fbbf3f1d7cb8da10887e19e69abbb11bce0)|`trac #8744: review commit`|

I don't quite understand why you've chosen to remove the

```
return set(left), set(right), vertex_in_left
...
self.left, self.right, vertex_in_left = b
```

and replace it with 


```
return vertex_in_left
...
# If we get here, then we've found a valid bipartition.
        # We update the bipartition
        self.left.clear()
        self.right.clear()
        for v in vertex_in_left:
            if vertex_in_left[v]:
                self.left.add(v)
            else:
                self.right.add(v)
```

I understand that vertex_in_left contains all the info needed to reconstruct the sets, but surely it's more efficient to just return the set objects and replace the references inside the graph, rather than adding another loop to reconstruct them?

Other than that, I like all the changes you made. It was a good idea having one edges_to_add list instead of us,vs,labels.



---

archive/issue_comments_072815.json:
```json
{
    "body": "Changed commit from **[3dfe5fb](https://github.com/sagemath/sagetrac-mirror/commit/3dfe5fbbf3f1d7cb8da10887e19e69abbb11bce0)** to **[8eb29c8](https://github.com/sagemath/sagetrac-mirror/commit/8eb29c80b559f550a78f4b0c1be8647cc9892483)**",
    "created_at": "2022-12-10T16:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72815",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3dfe5fb](https://github.com/sagemath/sagetrac-mirror/commit/3dfe5fbbf3f1d7cb8da10887e19e69abbb11bce0)** to **[8eb29c8](https://github.com/sagemath/sagetrac-mirror/commit/8eb29c80b559f550a78f4b0c1be8647cc9892483)**



---

archive/issue_comments_072816.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8eb29c80b559f550a78f4b0c1be8647cc9892483\">8eb29c8</a></td><td><code>trac #8744: better loop</code></td></tr></table>\n",
    "created_at": "2022-12-10T16:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72816",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:20'>Comment 20:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8eb29c80b559f550a78f4b0c1be8647cc9892483">8eb29c8</a></td><td><code>trac #8744: better loop</code></td></tr></table>




---

archive/issue_comments_072817.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nThe reason for not returning `set(left), set(right), vertex_in_left` is simply that we don't maintain `left` and `right` anymore in `_check_bipartition_for_add_edges`. So we have to rebuild `left` and `right`.",
    "created_at": "2022-12-10T16:49:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72817",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:21'>Comment 21:</a>
The reason for not returning `set(left), set(right), vertex_in_left` is simply that we don't maintain `left` and `right` anymore in `_check_bipartition_for_add_edges`. So we have to rebuild `left` and `right`.



---

archive/issue_comments_072818.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nFor me this ticket is good to go.",
    "created_at": "2022-12-29T14:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72818",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:22'>Comment 22:</a>
For me this ticket is good to go.



---

archive/issue_events_100715.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2022-12-29T14:14:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100715"
}
```



---

archive/issue_events_100716.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2022-12-29T14:14:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100716"
}
```



---

archive/issue_comments_072819.json:
```json
{
    "body": "Author: **Bruno Edwards, David Coudert**",
    "created_at": "2022-12-29T14:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72819",
    "user": "https://github.com/dcoudert"
}
```

Author: **Bruno Edwards, David Coudert**



---

archive/issue_comments_072820.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nReplying to [David Coudert](#comment%3A22):\n> For me this ticket is good to go.\n\nI second that",
    "created_at": "2022-12-29T14:52:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72820",
    "user": "https://github.com/Bruno-TT"
}
```

<a id='comment:23'>Comment 23:</a>
Replying to [David Coudert](#comment%3A22):
> For me this ticket is good to go.

I second that



---

archive/issue_events_100717.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2023-01-05T23:16:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100717"
}
```



---

archive/issue_events_100718.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2023-01-05T23:16:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8744#event-100718"
}
```



---

archive/issue_comments_072821.json:
```json
{
    "body": "Changed branch from **[public/graphs/8744_add_edge](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/8744_add_edge)** to **[8eb29c8](https://github.com/sagemath/sagetrac-mirror/commit/8eb29c80b559f550a78f4b0c1be8647cc9892483)**",
    "created_at": "2023-01-05T23:16:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8744#issuecomment-72821",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/graphs/8744_add_edge](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/8744_add_edge)** to **[8eb29c8](https://github.com/sagemath/sagetrac-mirror/commit/8eb29c80b559f550a78f4b0c1be8647cc9892483)**
