# Issue 8095: is_primitive of WordMorphism is broken

archive/issues_008095.json:
```json
{
    "assignees": [],
    "body": "Let us define the following morphism over 3 letters:\n\n```\nsage: substitution=WordMorphism('a->b,b->ac,c->a')\n```\nThen we get\n\n```\nsage: substitution.is_primitive()\nFalse\n```\nbut also\n\n```\nsage: (substitution^2).is_primitive()\nTrue\n```\n\n---\n\nexpected behaviour:\n\nSee the description of \".is_primitive()\":\nReturns True if self is primitive.\nA morphism \u03d5 is primitive if there exists an positive integer k such\nthat for all \u03b1\u2208\u03a3, \u03d5k(\u03b1) contains all the letters of \u03a3.\n\nSo, if a morphism is primitive, so are all its powers. And if there is\na power which is primitive, so is the morphism itself. In the example\nabove, both outputs should be \"True\".\n\nThis was reported here (via 'Report a problem'):\n\nhttp://groups.google.com/group/sage-combinat-devel/browse_thread/thread/5ed1186c229e7343?hl=en\n\nAssignee: **@seblabbe**\n\nCC:  abmasse\n\nAuthor: **S\u00e9bastien Labb\u00e9**\n\nReviewer: **Alexandre Blondin Mass\u00e9**\n\nMerged: **sage-4.3.2.alpha1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/8095_\n\n",
    "closed_at": "2010-01-30T23:41:54Z",
    "created_at": "2010-01-27T13:59:46Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "is_primitive of WordMorphism is broken",
    "type": "issue",
    "updated_at": "2010-01-30T23:41:54Z",
    "url": "https://github.com/sagemath/sage/issues/8095",
    "user": "https://github.com/seblabbe"
}
```
Let us define the following morphism over 3 letters:

```
sage: substitution=WordMorphism('a->b,b->ac,c->a')
```
Then we get

```
sage: substitution.is_primitive()
False
```
but also

```
sage: (substitution^2).is_primitive()
True
```

---

expected behaviour:

See the description of ".is_primitive()":
Returns True if self is primitive.
A morphism ϕ is primitive if there exists an positive integer k such
that for all α∈Σ, ϕk(α) contains all the letters of Σ.

So, if a morphism is primitive, so are all its powers. And if there is
a power which is primitive, so is the morphism itself. In the example
above, both outputs should be "True".

This was reported here (via 'Report a problem'):

http://groups.google.com/group/sage-combinat-devel/browse_thread/thread/5ed1186c229e7343?hl=en

Assignee: **@seblabbe**

CC:  abmasse

Author: **Sébastien Labbé**

Reviewer: **Alexandre Blondin Massé**

Merged: **sage-4.3.2.alpha1**

_Issue created by migration from https://trac.sagemath.org/ticket/8095_





---

archive/issue_events_088797.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2010-01-27T13:59:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "milestone_number": null,
    "milestone_title": "sage-4.3.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8095#event-88797"
}
```



---

archive/issue_events_088798.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2010-01-27T13:59:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "component: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8095#event-88798"
}
```



---

archive/issue_events_088799.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2010-01-27T13:59:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8095#event-88799"
}
```



---

archive/issue_events_088800.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2010-01-27T13:59:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8095#event-88800"
}
```



---

archive/issue_comments_063974.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -28,3 +28,7 @@\n So, if a morphism is primitive, so are all its powers. And if there is\n a power which is primitive, so is the morphism itself. In the example\n above, both outputs should be \"True\".\n+\n+This was reported here (via 'Report a problem'):\n+\n+http://groups.google.com/group/sage-combinat-devel/browse_thread/thread/5ed1186c229e7343?hl=en\n``````\n",
    "created_at": "2010-01-27T14:29:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8095#issuecomment-63974",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -28,3 +28,7 @@
 So, if a morphism is primitive, so are all its powers. And if there is
 a power which is primitive, so is the morphism itself. In the example
 above, both outputs should be "True".
+
+This was reported here (via 'Report a problem'):
+
+http://groups.google.com/group/sage-combinat-devel/browse_thread/thread/5ed1186c229e7343?hl=en
``````




---

archive/issue_comments_063975.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nI just posted a patch which solves the described problem. The solution uses the following algorithm:\n\n```\nALGORITHM: \n \n   Let `m` be the incidence matrix of a endomorphism on a monoid  \n   of `d` letters. The endomorphism is primitive if and only if \n   there exists `k` such that `1 \\leq k \\leq (d-1)^2+1` and `m^k`  \n   contains no zero. \n```\n\nAre we sure this is true? Is there a proof of that somewhere?",
    "created_at": "2010-01-27T15:22:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8095#issuecomment-63975",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:2'>Comment 2:</a>
I just posted a patch which solves the described problem. The solution uses the following algorithm:

```
ALGORITHM: 
 
   Let `m` be the incidence matrix of a endomorphism on a monoid  
   of `d` letters. The endomorphism is primitive if and only if 
   there exists `k` such that `1 \leq k \leq (d-1)^2+1` and `m^k`  
   contains no zero. 
```

Are we sure this is true? Is there a proof of that somewhere?



---

archive/issue_events_088801.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2010-01-27T15:22:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8095#event-88801"
}
```



---

archive/issue_events_088802.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2010-01-28T16:41:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8095#event-88802"
}
```



---

archive/issue_events_088803.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2010-01-28T16:41:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8095#event-88803"
}
```



---

archive/issue_comments_063976.json:
```json
{
    "body": "Attachment: **[trac_8095_wordmorph_is_primitive-sl.patch.gz](https://github.com/sagemath/sage/files/ticket8095/trac_8095_wordmorph_is_primitive-sl.patch.gz)**\n\ntested on sage-4.3.1",
    "created_at": "2010-01-29T14:23:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8095#issuecomment-63976",
    "user": "https://github.com/seblabbe"
}
```

Attachment: **[trac_8095_wordmorph_is_primitive-sl.patch.gz](https://github.com/sagemath/sage/files/ticket8095/trac_8095_wordmorph_is_primitive-sl.patch.gz)**

tested on sage-4.3.1



---

archive/issue_events_088804.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2010-01-29T14:24:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8095#event-88804"
}
```



---

archive/issue_events_088805.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2010-01-29T14:24:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8095#event-88805"
}
```



---

archive/issue_comments_063977.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nI found a reference for the above statement (Automatic sequences of Allouche and Shallit).",
    "created_at": "2010-01-29T14:24:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8095#issuecomment-63977",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:4'>Comment 4:</a>
I found a reference for the above statement (Automatic sequences of Allouche and Shallit).



---

archive/issue_comments_063978.json:
```json
{
    "body": "Author: **slabbe**",
    "created_at": "2010-01-29T14:44:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8095#issuecomment-63978",
    "user": "https://github.com/sagetrac-abmasse"
}
```

Author: **slabbe**



---

archive/issue_comments_063979.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nTested on sage-4.3.1 as well and it works.\nIt fixes the reported problem as well.\nAll tests passed when running ``sage -t morphism.py\".\nPositive review.",
    "created_at": "2010-01-29T14:44:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8095#issuecomment-63979",
    "user": "https://github.com/sagetrac-abmasse"
}
```

<a id='comment:5'>Comment 5:</a>
Tested on sage-4.3.1 as well and it works.
It fixes the reported problem as well.
All tests passed when running ``sage -t morphism.py".
Positive review.



---

archive/issue_comments_063980.json:
```json
{
    "body": "Reviewer: **abmasse**",
    "created_at": "2010-01-29T14:44:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8095#issuecomment-63980",
    "user": "https://github.com/sagetrac-abmasse"
}
```

Reviewer: **abmasse**



---

archive/issue_events_088806.json:
```json
{
    "actor": "https://github.com/sagetrac-abmasse",
    "created_at": "2010-01-29T14:44:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8095#event-88806"
}
```



---

archive/issue_events_088807.json:
```json
{
    "actor": "https://github.com/sagetrac-abmasse",
    "created_at": "2010-01-29T14:44:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8095#event-88807"
}
```



---

archive/issue_comments_063981.json:
```json
{
    "body": "Changed reviewer from **abmasse** to **Alexandre Blondin Mass\u00e9**",
    "created_at": "2010-01-30T23:41:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8095#issuecomment-63981",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Changed reviewer from **abmasse** to **Alexandre Blondin Massé**



---

archive/issue_comments_063982.json:
```json
{
    "body": "Changed author from **slabbe** to **S\u00e9bastien Labb\u00e9**",
    "created_at": "2010-01-30T23:41:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8095#issuecomment-63982",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Changed author from **slabbe** to **Sébastien Labbé**



---

archive/issue_events_088808.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-01-30T23:41:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8095#event-88808"
}
```



---

archive/issue_events_088809.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-01-30T23:41:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8095#event-88809"
}
```



---

archive/issue_comments_063983.json:
```json
{
    "body": "Merged: **sage-4.3.2.alpha1**",
    "created_at": "2010-01-30T23:41:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8095#issuecomment-63983",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Merged: **sage-4.3.2.alpha1**
