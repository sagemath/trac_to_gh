# Issue 8116: cython fails to build in Open Solaris x64 as 64 bit if CFLAGS is not set to -m64 globally

archive/issues_008116.json:
```json
{
    "body": "If $SAGE64 = \"yes\" we need CFLAGS=-m64 on Open Solaris.\n\nPatch coming up.\n\nspkg is here:\n[http://boxen.math.washington.edu/home/jsp/ports/cython-0.12.p0.spkg](http://boxen.math.washington.edu/home/jsp/ports/cython-0.12.p0.spkg)\n\n\n\nJaap\n\n\n\nAssignee: drkirkby\n\nCC:  @robertwb\n\nResolution: invalid\n\nAuthor: Jaap Spies\n\nReviewer: David Kirkby\n\nIssue created by migration from https://trac.sagemath.org/ticket/8116\n\n",
    "closed_at": "2010-01-30T12:46:10Z",
    "created_at": "2010-01-29T12:53:27Z",
    "labels": [
        "component: porting",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "cython fails to build in Open Solaris x64 as 64 bit if CFLAGS is not set to -m64 globally",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8116",
    "user": "https://github.com/jaapspies"
}
```
If $SAGE64 = "yes" we need CFLAGS=-m64 on Open Solaris.

Patch coming up.

spkg is here:
[http://boxen.math.washington.edu/home/jsp/ports/cython-0.12.p0.spkg](http://boxen.math.washington.edu/home/jsp/ports/cython-0.12.p0.spkg)



Jaap



Assignee: drkirkby

CC:  @robertwb

Resolution: invalid

Author: Jaap Spies

Reviewer: David Kirkby

Issue created by migration from https://trac.sagemath.org/ticket/8116





---

archive/issue_comments_083503.json:
```json
{
    "body": "Changing author from \"\" to \"Jaap Spies\"",
    "created_at": "2010-01-29T13:23:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8116#issuecomment-83503",
    "user": "https://github.com/jaapspies"
}
```

Changing author from "" to "Jaap Spies"



---

archive/issue_comments_083504.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,6 +2,9 @@\n \n Patch coming up.\n \n+spkg is here:\n+[http://boxen.math.washington.edu/home/jsp/ports/cython-0.12.p0.spkg](http://boxen.math.washington.edu/home/jsp/ports/cython-0.12.p0.spkg)\n+\n Jaap\n \n \n``````\n",
    "created_at": "2010-01-29T13:23:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8116#issuecomment-83504",
    "user": "https://github.com/jaapspies"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,6 +2,9 @@
 
 Patch coming up.
 
+spkg is here:
+[http://boxen.math.washington.edu/home/jsp/ports/cython-0.12.p0.spkg](http://boxen.math.washington.edu/home/jsp/ports/cython-0.12.p0.spkg)
+
 Jaap
 
 
``````




---

archive/issue_comments_083505.json:
```json
{
    "body": "<a id='comment:1'></a>Attachment [cython-0.12.p0.patch](tarball://root/attachments/some-uuid/ticket8116/cython-0.12.p0.patch) by @jaapspies created at 2010-01-29 13:23:27\n\n[http://boxen.math.washington.edu/home/jsp/ports/cython-0.12.p0.spkg](http://boxen.math.washington.edu/home/jsp/ports/cython-0.12.p0.spkg)\n\nThis spkg needs testing on OSX with $SAGE64 = \"yes\"\n\nJaap",
    "created_at": "2010-01-29T13:23:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8116#issuecomment-83505",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:1'></a>Attachment [cython-0.12.p0.patch](tarball://root/attachments/some-uuid/ticket8116/cython-0.12.p0.patch) by @jaapspies created at 2010-01-29 13:23:27

[http://boxen.math.washington.edu/home/jsp/ports/cython-0.12.p0.spkg](http://boxen.math.washington.edu/home/jsp/ports/cython-0.12.p0.spkg)

This spkg needs testing on OSX with $SAGE64 = "yes"

Jaap



---

archive/issue_comments_083506.json:
```json
{
    "body": "Changing assignee from drkirkby to @jaapspies.",
    "created_at": "2010-01-29T13:23:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8116#issuecomment-83506",
    "user": "https://github.com/jaapspies"
}
```

Changing assignee from drkirkby to @jaapspies.



---

archive/issue_comments_083507.json:
```json
{
    "body": "Changing assignee from @jaapspies to drkirkby.",
    "created_at": "2010-01-29T16:41:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8116#issuecomment-83507",
    "user": "https://github.com/jaapspies"
}
```

Changing assignee from @jaapspies to drkirkby.



---

archive/issue_comments_083508.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-01-29T16:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8116#issuecomment-83508",
    "user": "https://github.com/jaapspies"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_083509.json:
```json
{
    "body": "<a id='comment:4'></a>I would not do this. It was setting of CFLAGS in sage-env which caused cython to mis-compile code. This is probably why it was not done in OS X. I do not know how to get cython to build 64-bit, but I do not believe you should set CFLAGS to do so.",
    "created_at": "2010-01-29T18:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8116#issuecomment-83509",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:4'></a>I would not do this. It was setting of CFLAGS in sage-env which caused cython to mis-compile code. This is probably why it was not done in OS X. I do not know how to get cython to build 64-bit, but I do not believe you should set CFLAGS to do so.



---

archive/issue_comments_083510.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-01-29T18:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8116#issuecomment-83510",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_083511.json:
```json
{
    "body": "Changing reviewer from \"\" to \"David Kirkby\"",
    "created_at": "2010-01-29T18:37:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8116#issuecomment-83511",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing reviewer from "" to "David Kirkby"



---

archive/issue_comments_083512.json:
```json
{
    "body": "<a id='comment:6'></a>Cython gets the flags it needs from distutils (which, if I understand correctly, tries to use the flags that Python itself was built with). Just setting CFLAGS directly can mess this up. Can you post the log of running cython -f with this option? Also, Cython won't compile, do you have any luck with all the .pyx files in the Sage library?",
    "created_at": "2010-01-29T19:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8116#issuecomment-83512",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:6'></a>Cython gets the flags it needs from distutils (which, if I understand correctly, tries to use the flags that Python itself was built with). Just setting CFLAGS directly can mess this up. Can you post the log of running cython -f with this option? Also, Cython won't compile, do you have any luck with all the .pyx files in the Sage library?



---

archive/issue_comments_083513.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 robertwb]:\n> Cython gets the flags it needs from distutils (which, if I understand correctly, tries to use the flags that Python itself was built with). Just setting CFLAGS directly can mess this up. Can you post the log of running cython -f with this option? Also, Cython won't compile, do you have any luck with all the .pyx files in the Sage library? \n\n\nSo if I understand you correctly we need a properly installed Python. I have to hack a bit to get a working Python in Open Solaris.\n\nWhy not unset CFLAGS in the Cython spkg-install?\n\nWithout CFLAGS set building cython failes on Open Solaris x64!\n\n*.pyx files? I don't get sage-4.3.1.alpha build :)!\n\nSo let's get Python build correctly on Open Solaris x64!\n\nJaap",
    "created_at": "2010-01-29T20:51:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8116#issuecomment-83513",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:7'></a>Replying to [comment:6 robertwb]:
> Cython gets the flags it needs from distutils (which, if I understand correctly, tries to use the flags that Python itself was built with). Just setting CFLAGS directly can mess this up. Can you post the log of running cython -f with this option? Also, Cython won't compile, do you have any luck with all the .pyx files in the Sage library? 


So if I understand you correctly we need a properly installed Python. I have to hack a bit to get a working Python in Open Solaris.

Why not unset CFLAGS in the Cython spkg-install?

Without CFLAGS set building cython failes on Open Solaris x64!

*.pyx files? I don't get sage-4.3.1.alpha build :)!

So let's get Python build correctly on Open Solaris x64!

Jaap



---

archive/issue_comments_083514.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 jsp]:\n> Replying to [comment:6 robertwb]:\n> > Cython gets the flags it needs from distutils (which, if I understand correctly, tries to use the flags that Python itself was built with). Just setting CFLAGS directly can mess this up. Can you post the log of running cython -f with this option? Also, Cython won't compile, do you have any luck with all the .pyx files in the Sage library? \n\n> \n> So if I understand you correctly we need a properly installed Python. I have to hack a bit to get a working Python in Open Solaris.\n\n\nYes. Worrying about Cython working before Python is set up correctly is probably going to be an exercise in futility. \n\n> Why not unset CFLAGS in the Cython spkg-install?\n\n\nFor fear of breaking things. I am not an expert on distutils or building stuff, so for me the safest path is to not change stuff. \n\n> Without CFLAGS set building cython failes on Open Solaris x64!\n\n\nDo you get a working Cython with CFLAGS set? (If so, it might just be lucky...) What errors do you get otherwise? (I think Cython's supposed to fall back to a pure Python setup if the compile fails, but I could be remembering wrong.)\n\n> *.pyx files? I don't get sage-4.3.1.alpha build :)!\n\n\nYet :)\n\nI'm just pointing out that whatever issues we're running into here, we'll be running into later with the sage library. \n\n> So let's get Python build correctly on Open Solaris x64!\n\n\nSounds like the best course of action.",
    "created_at": "2010-01-29T21:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8116#issuecomment-83514",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:8'></a>Replying to [comment:7 jsp]:
> Replying to [comment:6 robertwb]:
> > Cython gets the flags it needs from distutils (which, if I understand correctly, tries to use the flags that Python itself was built with). Just setting CFLAGS directly can mess this up. Can you post the log of running cython -f with this option? Also, Cython won't compile, do you have any luck with all the .pyx files in the Sage library? 

> 
> So if I understand you correctly we need a properly installed Python. I have to hack a bit to get a working Python in Open Solaris.


Yes. Worrying about Cython working before Python is set up correctly is probably going to be an exercise in futility. 

> Why not unset CFLAGS in the Cython spkg-install?


For fear of breaking things. I am not an expert on distutils or building stuff, so for me the safest path is to not change stuff. 

> Without CFLAGS set building cython failes on Open Solaris x64!


Do you get a working Cython with CFLAGS set? (If so, it might just be lucky...) What errors do you get otherwise? (I think Cython's supposed to fall back to a pure Python setup if the compile fails, but I could be remembering wrong.)

> *.pyx files? I don't get sage-4.3.1.alpha build :)!


Yet :)

I'm just pointing out that whatever issues we're running into here, we'll be running into later with the sage library. 

> So let's get Python build correctly on Open Solaris x64!


Sounds like the best course of action.



---

archive/issue_comments_083515.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 robertwb]:\n> Replying to [comment:7 jsp]:\n> > Replying to [comment:6 robertwb]:\n> > > Cython gets the flags it needs from distutils (which, if I understand correctly, tries to use the flags that Python itself was built with). Just setting CFLAGS directly can mess this up. Can you post the log of running cython -f with this option? Also, Cython won't compile, do you have any luck with all the .pyx files in the Sage library? \n\n> > \n> > So if I understand you correctly we need a properly installed Python. I have to hack a bit to get a working Python in Open Solaris.\n\n> \n> Yes. Worrying about Cython working before Python is set up correctly is probably going to be an exercise in futility. \n  \n>\n\nI do have a working Python! But I don't know it is setup properly :(\n\n```\nPython 2.6.4 (r264:75706, Jan 27 2010, 22:37:41) \n[GCC 4.4.2] on sunos5\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> \n\n```\n\n \n> > Why not unset CFLAGS in the Cython spkg-install?\n\n> \n> For fear of breaking things. I am not an expert on distutils or building stuff, so for me the safest path is to not change stuff. \n> \n\n\nIf you don't accept CFLAGS set globally, why not?\n\n> > Without CFLAGS set building cython failes on Open Solaris x64!\n\n> \n> Do you get a working Cython with CFLAGS set? (If so, it might just be lucky...) What errors do you get otherwise? (I think Cython's supposed to fall back to a pure Python setup if the compile fails, but I could be remembering wrong.)\n> \n\n\nI don't know. It just says it installed successfully :)\n\n\n\n> I'm just pointing out that whatever issues we're running into here, we'll be running into later with the sage library. \n> \n> > So let's get Python build correctly on Open Solaris x64!\n\n> \n> Sounds like the best course of action. \n\n\n\nLet's go for it!\n\nJaap",
    "created_at": "2010-01-29T22:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8116#issuecomment-83515",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:9'></a>Replying to [comment:8 robertwb]:
> Replying to [comment:7 jsp]:
> > Replying to [comment:6 robertwb]:
> > > Cython gets the flags it needs from distutils (which, if I understand correctly, tries to use the flags that Python itself was built with). Just setting CFLAGS directly can mess this up. Can you post the log of running cython -f with this option? Also, Cython won't compile, do you have any luck with all the .pyx files in the Sage library? 

> > 
> > So if I understand you correctly we need a properly installed Python. I have to hack a bit to get a working Python in Open Solaris.

> 
> Yes. Worrying about Cython working before Python is set up correctly is probably going to be an exercise in futility. 
  
>

I do have a working Python! But I don't know it is setup properly :(

```
Python 2.6.4 (r264:75706, Jan 27 2010, 22:37:41) 
[GCC 4.4.2] on sunos5
Type "help", "copyright", "credits" or "license" for more information.
>>> 

```

 
> > Why not unset CFLAGS in the Cython spkg-install?

> 
> For fear of breaking things. I am not an expert on distutils or building stuff, so for me the safest path is to not change stuff. 
> 


If you don't accept CFLAGS set globally, why not?

> > Without CFLAGS set building cython failes on Open Solaris x64!

> 
> Do you get a working Cython with CFLAGS set? (If so, it might just be lucky...) What errors do you get otherwise? (I think Cython's supposed to fall back to a pure Python setup if the compile fails, but I could be remembering wrong.)
> 


I don't know. It just says it installed successfully :)



> I'm just pointing out that whatever issues we're running into here, we'll be running into later with the sage library. 
> 
> > So let's get Python build correctly on Open Solaris x64!

> 
> Sounds like the best course of action. 



Let's go for it!

Jaap



---

archive/issue_comments_083516.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 jsp]:\n> If you don't accept CFLAGS set globally, why not?\n\n\nThis is a distutils question, nothing specific to Cython. Hopefully we can get to the root of the issue, as many packages are \"python setup.py install\"",
    "created_at": "2010-01-29T22:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8116#issuecomment-83516",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:10'></a>Replying to [comment:9 jsp]:
> If you don't accept CFLAGS set globally, why not?


This is a distutils question, nothing specific to Cython. Hopefully we can get to the root of the issue, as many packages are "python setup.py install"



---

archive/issue_comments_083517.json:
```json
{
    "body": "<a id='comment:11'></a>I rebuilt python with in the spkg-install Darwin changed to SunOS.\n\nPython buidls ok now with the right CFLAGS set.\n\nRebuilding cython was ok.\n\nSo in principle problem solved!\n\nI close the ticket as invalid.\n\nJaap",
    "created_at": "2010-01-30T12:46:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8116#issuecomment-83517",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:11'></a>I rebuilt python with in the spkg-install Darwin changed to SunOS.

Python buidls ok now with the right CFLAGS set.

Rebuilding cython was ok.

So in principle problem solved!

I close the ticket as invalid.

Jaap



---

archive/issue_events_019432.json:
```json
{
    "actor": "https://github.com/jaapspies",
    "created_at": "2010-01-30T12:46:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8116",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8116#event-19432"
}
```



---

archive/issue_comments_083518.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,6 +5,8 @@\n spkg is here:\n [http://boxen.math.washington.edu/home/jsp/ports/cython-0.12.p0.spkg](http://boxen.math.washington.edu/home/jsp/ports/cython-0.12.p0.spkg)\n \n+\n+\n Jaap\n \n \n``````\n",
    "created_at": "2010-01-30T12:46:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8116#issuecomment-83518",
    "user": "https://github.com/jaapspies"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,6 +5,8 @@
 spkg is here:
 [http://boxen.math.washington.edu/home/jsp/ports/cython-0.12.p0.spkg](http://boxen.math.washington.edu/home/jsp/ports/cython-0.12.p0.spkg)
 
+
+
 Jaap
 
 
``````




---

archive/issue_comments_083519.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2010-01-30T12:46:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8116#issuecomment-83519",
    "user": "https://github.com/jaapspies"
}
```

Resolution: invalid



---

archive/issue_events_019433.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2010-01-30T15:51:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8116",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8116#event-19433"
}
```
