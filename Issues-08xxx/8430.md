# Issue 8430: doctest failures with Sage 4.3.4.alpha0

archive/issues_008430.json:
```json
{
    "body": "From [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/99b72f5f27858b53):\n\n```\n* The following tests failed on sage.math:\n\nsage -t  -long local/lib/python2.6/site-packages/sagenb-0.7.5.1-py2.6.egg/sagenb/notebook/interact.py # 1 doctests failed\nsage -t  -long local/lib/python2.6/site-packages/sagenb-0.7.5.1-py2.6.egg/sagenb/misc/sageinspect.py # 1 doctests failed\nsage -t  -long devel/sage/sage/categories/finite_semigroups.py # 2 doctests failed\nsage -t  -long devel/sage/sage/categories/examples/finite_semigroups.py # 1 doctests failed \n```\n\nThe doctest\n\n```\nsage -t  -long devel/sage/sage/categories/finite_semigroups.py # 2 doctests failed\n```\nalso failed on SPARC Solaris 10 (the machine t2.math). The failure uncovered another bug relating to kpsewhich. See ticket #8445.\n\nAssignee: @hivert\n\nCC:  sage-combinat\n\nResolution: fixed\n\nAuthor: Florent Hivert\n\nReviewer: Marshall Hampton\n\nMerged: sage-4.3.4.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/8430\n\n",
    "closed_at": "2010-03-09T07:44:51Z",
    "created_at": "2010-03-03T18:42:04Z",
    "labels": [
        "component: doctest coverage",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3.4",
    "title": "doctest failures with Sage 4.3.4.alpha0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8430",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```
From [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/99b72f5f27858b53):

```
* The following tests failed on sage.math:

sage -t  -long local/lib/python2.6/site-packages/sagenb-0.7.5.1-py2.6.egg/sagenb/notebook/interact.py # 1 doctests failed
sage -t  -long local/lib/python2.6/site-packages/sagenb-0.7.5.1-py2.6.egg/sagenb/misc/sageinspect.py # 1 doctests failed
sage -t  -long devel/sage/sage/categories/finite_semigroups.py # 2 doctests failed
sage -t  -long devel/sage/sage/categories/examples/finite_semigroups.py # 1 doctests failed 
```

The doctest

```
sage -t  -long devel/sage/sage/categories/finite_semigroups.py # 2 doctests failed
```
also failed on SPARC Solaris 10 (the machine t2.math). The failure uncovered another bug relating to kpsewhich. See ticket #8445.

Assignee: @hivert

CC:  sage-combinat

Resolution: fixed

Author: Florent Hivert

Reviewer: Marshall Hampton

Merged: sage-4.3.4.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/8430





---

archive/issue_events_032672.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "rename": {
        "from": "three doctest failures with Sage 4.3.4.alpha0",
        "to": "doctest failures with Sage 4.3.4.alpha0"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8430#event-32672"
}
```



---

archive/issue_comments_087309.json:
```json
{
    "body": "<a id='comment:2'></a>\nI've tried to address the problem with sageinspect.py in ticket #8324.",
    "created_at": "2010-03-03T22:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8430#issuecomment-87309",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
I've tried to address the problem with sageinspect.py in ticket #8324.



---

archive/issue_comments_087310.json:
```json
{
    "body": "<a id='comment:3'></a>\nNote that the problem with `sagenb/notebook/interact.py` should be fixed by the sagenb patch at ticket #5601.",
    "created_at": "2010-03-03T22:29:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8430#issuecomment-87310",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>
Note that the problem with `sagenb/notebook/interact.py` should be fixed by the sagenb patch at ticket #5601.



---

archive/issue_comments_087311.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-03-04T10:14:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8430#issuecomment-87311",
    "user": "https://github.com/hivert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_087312.json:
```json
{
    "body": "> * The following tests failed on sage.math:\n \n{{{\nsage -t  -long devel/sage/sage/categories/finite_semigroups.py # 2 doctests failed\nsage -t  -long devel/sage/sage/categories/examples/finite_semigroups.py # 1 doctests failed \n}}}\nThose last two should be fixed by the submitted patch. A better fix together with improvements is being written on sage-combinat but I don't know how long finishing those improvements will take. So please review the patch. \n\nBy the way, should'nt I create a ticket for this patch ? It is certainly orthogonal to the two other one doctest failure.\n\nCheers,\n\nFlorent",
    "created_at": "2010-03-04T10:14:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8430#issuecomment-87312",
    "user": "https://github.com/hivert"
}
```

> * The following tests failed on sage.math:
 
{{{
sage -t  -long devel/sage/sage/categories/finite_semigroups.py # 2 doctests failed
sage -t  -long devel/sage/sage/categories/examples/finite_semigroups.py # 1 doctests failed 
}}}
Those last two should be fixed by the submitted patch. A better fix together with improvements is being written on sage-combinat but I don't know how long finishing those improvements will take. So please review the patch. 

By the way, should'nt I create a ticket for this patch ? It is certainly orthogonal to the two other one doctest failure.

Cheers,

Florent



---

archive/issue_comments_087313.json:
```json
{
    "body": "Changing author from \"\" to \"Florent Hivert\"",
    "created_at": "2010-03-04T10:14:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8430#issuecomment-87313",
    "user": "https://github.com/hivert"
}
```

Changing author from "" to "Florent Hivert"



---

archive/issue_comments_087314.json:
```json
{
    "body": "<a id='comment:5'></a>\nSince the other issues have there own tickets I don't think another one is necessary.\n\nThere is one doctest failure still:\n\n```\nFile \"/Volumes/E/sage-4.3.4.alpha0/devel/sage-t1/sage/categories/finite_semigroups.py\", line 229:\n    sage: sorted(S.j_transversal_of_idempotents())\nExpected:\n    ['a', 'ab', 'ac', 'acb', 'b', 'bc', 'c']\nGot:\n    ['a', 'ab', 'ac', 'acb', 'b', 'c', 'cb']\n*********************************************\n```\n\nwhich is not covered by the patch.  Seems like maybe the expected string is wrong, unless the sorted function has varying behavior.",
    "created_at": "2010-03-04T21:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8430#issuecomment-87314",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

<a id='comment:5'></a>
Since the other issues have there own tickets I don't think another one is necessary.

There is one doctest failure still:

```
File "/Volumes/E/sage-4.3.4.alpha0/devel/sage-t1/sage/categories/finite_semigroups.py", line 229:
    sage: sorted(S.j_transversal_of_idempotents())
Expected:
    ['a', 'ab', 'ac', 'acb', 'b', 'bc', 'c']
Got:
    ['a', 'ab', 'ac', 'acb', 'b', 'c', 'cb']
*********************************************
```

which is not covered by the patch.  Seems like maybe the expected string is wrong, unless the sorted function has varying behavior.



---

archive/issue_comments_087315.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-03-04T21:08:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8430#issuecomment-87315",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_087316.json:
```json
{
    "body": "<a id='comment:7'></a>\nAttachment [trac_8430-semigroup_doctest_fix-fh.patch](tarball://root/attachments/some-uuid/ticket8430/trac_8430-semigroup_doctest_fix-fh.patch) by @hivert created at 2010-03-04 21:41:49\n\nReplying to [mhampton](#comment%3A5):\n\n> There is one doctest failure still:\n\n{{{\nFile \"/Volumes/E/sage-4.3.4.alpha0/devel/sage-t1/sage/categories/finite_semigroups.py\", line 229:\n    sage: sorted(S.j_transversal_of_idempotents())\nExpected:\n    ['a', 'ab', 'ac', 'acb', 'b', 'bc', 'c']\nGot:\n    ['a', 'ab', 'ac', 'acb', 'b', 'c', 'cb']\n*********************************************\n}}} \n> which is not covered by the patch.  Seems like maybe the expected string is wrong, unless the sorted function has varying behavior.\n\n\nI'm not sure to understand:\n- why I missed this one;\n- why the result of sorted changed between 4.3.3 and 4.3.4;\n- why despite of this change it seems to be stable on both version...\nAnyway the newly uploaded patch passed the tests 10 times in a raw on the machine sage. Maybe it could be worth checking of it is also stable on other architectures.\n\nSorry for the mess and please review.",
    "created_at": "2010-03-04T21:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8430#issuecomment-87316",
    "user": "https://github.com/hivert"
}
```

<a id='comment:7'></a>
Attachment [trac_8430-semigroup_doctest_fix-fh.patch](tarball://root/attachments/some-uuid/ticket8430/trac_8430-semigroup_doctest_fix-fh.patch) by @hivert created at 2010-03-04 21:41:49

Replying to [mhampton](#comment%3A5):

> There is one doctest failure still:

{{{
File "/Volumes/E/sage-4.3.4.alpha0/devel/sage-t1/sage/categories/finite_semigroups.py", line 229:
    sage: sorted(S.j_transversal_of_idempotents())
Expected:
    ['a', 'ab', 'ac', 'acb', 'b', 'bc', 'c']
Got:
    ['a', 'ab', 'ac', 'acb', 'b', 'c', 'cb']
*********************************************
}}} 
> which is not covered by the patch.  Seems like maybe the expected string is wrong, unless the sorted function has varying behavior.


I'm not sure to understand:
- why I missed this one;
- why the result of sorted changed between 4.3.3 and 4.3.4;
- why despite of this change it seems to be stable on both version...
Anyway the newly uploaded patch passed the tests 10 times in a raw on the machine sage. Maybe it could be worth checking of it is also stable on other architectures.

Sorry for the mess and please review.



---

archive/issue_comments_087317.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-03-04T21:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8430#issuecomment-87317",
    "user": "https://github.com/hivert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_087318.json:
```json
{
    "body": "Changing assignee from tbd to @hivert.",
    "created_at": "2010-03-04T21:42:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8430#issuecomment-87318",
    "user": "https://github.com/hivert"
}
```

Changing assignee from tbd to @hivert.



---

archive/issue_comments_087319.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-03-04T22:27:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8430#issuecomment-87319",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_087320.json:
```json
{
    "body": "<a id='comment:9'></a>\nAll tests in categories passed on a 10.6 mac and on 64-bit Ubuntu 9.10, so I think I can give this a positive review.",
    "created_at": "2010-03-04T22:27:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8430#issuecomment-87320",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

<a id='comment:9'></a>
All tests in categories passed on a 10.6 mac and on 64-bit Ubuntu 9.10, so I think I can give this a positive review.



---

archive/issue_comments_087321.json:
```json
{
    "body": "<a id='comment:10'></a>\nSageNB 0.7.5.2 includes fixes for the first two failures in the description (see #8435).\n\nAn important note:  It's best to test SageNB files with `-force_lib`, e.g.,\n\n```sh\nsage -t -long -force_lib local/lib/python2.6/site-packages/sagenb-0.7.5.1-py2.6.egg/sagenb/notebook/interact.py\n```\n\nRunning `sage -t -sagenb` or `make test` and its friends will set it implicitly.  If the option is set, `SAGE_LOCAL/bin/sage-doctest` will treat the file(s) as Sage library code, even if it does not live under `SAGE_ROOT/devel`.  In particular, `sage-doctest` will not attempt the equivalent of `from filebase import *`, which can raise false errors or cause segfaults.\n\nI suppose I should have called it `-library_code`, instead.\n\nPlease remember to fillin",
    "created_at": "2010-03-04T23:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8430#issuecomment-87321",
    "user": "https://github.com/qed777"
}
```

<a id='comment:10'></a>
SageNB 0.7.5.2 includes fixes for the first two failures in the description (see #8435).

An important note:  It's best to test SageNB files with `-force_lib`, e.g.,

```sh
sage -t -long -force_lib local/lib/python2.6/site-packages/sagenb-0.7.5.1-py2.6.egg/sagenb/notebook/interact.py
```

Running `sage -t -sagenb` or `make test` and its friends will set it implicitly.  If the option is set, `SAGE_LOCAL/bin/sage-doctest` will treat the file(s) as Sage library code, even if it does not live under `SAGE_ROOT/devel`.  In particular, `sage-doctest` will not attempt the equivalent of `from filebase import *`, which can raise false errors or cause segfaults.

I suppose I should have called it `-library_code`, instead.

Please remember to fillin



---

archive/issue_comments_087322.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Marshall Hampton\"",
    "created_at": "2010-03-04T23:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8430#issuecomment-87322",
    "user": "https://github.com/qed777"
}
```

Changing reviewer from "" to "Marshall Hampton"



---

archive/issue_comments_087323.json:
```json
{
    "body": "<a id='comment:11'></a>\nI'm not at home, and can't very easily start applying patches, but I can confirm I get the same results, based on Sage 4.3.4.alpha0 but with a few Solaris-specific patches on Solaris 10 (SPARC)\n\n```\n**********************************************************************\nFile \"/export/home/drkirkby/32/sage-4.3.4.alpha0/devel/sage/sage/categories/fini\nte_semigroups.py\", line 232:\n    sage: sorted(S.j_transversal_of_idempotents())\nExpected:\n    ['a', 'ab', 'ac', 'acb', 'b', 'bc', 'c']\nGot:\n    ['a', 'ab', 'ac', 'acb', 'b', 'c', 'cb']\n**********************************************************************\nFile \"/export/home/drkirkby/32/sage-4.3.4.alpha0/devel/sage/sage/categories/fini\nte_semigroups.py\", line 198:\n    sage: S.j_classes()\nExpected:\n    [['acb', 'cab', 'bca', 'abc', 'bac', 'cba'], ['ac', 'ca'],\n    ['ab', 'ba'], ['bc', 'cb'], ['a'], ['c'], ['b']]\nGot:\n    [['a'], ['acb', 'cba', 'bca', 'abc', 'bac', 'cab'], ['ac', 'ca'], ['ab', 'ba\n'], ['cb', 'bc'], ['c'], ['b']]\n**********************************************************************\n2 items had failures:\n```\n\n\nSo the problem is occuring on more that one architecuture. I hope to try the patch within the next 12 hours.",
    "created_at": "2010-03-05T14:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8430#issuecomment-87323",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:11'></a>
I'm not at home, and can't very easily start applying patches, but I can confirm I get the same results, based on Sage 4.3.4.alpha0 but with a few Solaris-specific patches on Solaris 10 (SPARC)

```
**********************************************************************
File "/export/home/drkirkby/32/sage-4.3.4.alpha0/devel/sage/sage/categories/fini
te_semigroups.py", line 232:
    sage: sorted(S.j_transversal_of_idempotents())
Expected:
    ['a', 'ab', 'ac', 'acb', 'b', 'bc', 'c']
Got:
    ['a', 'ab', 'ac', 'acb', 'b', 'c', 'cb']
**********************************************************************
File "/export/home/drkirkby/32/sage-4.3.4.alpha0/devel/sage/sage/categories/fini
te_semigroups.py", line 198:
    sage: S.j_classes()
Expected:
    [['acb', 'cab', 'bca', 'abc', 'bac', 'cba'], ['ac', 'ca'],
    ['ab', 'ba'], ['bc', 'cb'], ['a'], ['c'], ['b']]
Got:
    [['a'], ['acb', 'cba', 'bca', 'abc', 'bac', 'cab'], ['ac', 'ca'], ['ab', 'ba
'], ['cb', 'bc'], ['c'], ['b']]
**********************************************************************
2 items had failures:
```


So the problem is occuring on more that one architecuture. I hope to try the patch within the next 12 hours.



---

archive/issue_comments_087324.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,3 +8,10 @@\n sage -t  -long devel/sage/sage/categories/finite_semigroups.py # 2 doctests failed\n sage -t  -long devel/sage/sage/categories/examples/finite_semigroups.py # 1 doctests failed \n ```\n+\n+The doctest\n+\n+```\n+sage -t  -long devel/sage/sage/categories/finite_semigroups.py # 2 doctests failed\n+```\n+also failed on SPARC Solaris 10 (the machine t2.math). The failure uncovered another bug relating to kpsewhich. See ticket #8445.\n``````\n",
    "created_at": "2010-03-05T14:05:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8430#issuecomment-87324",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,3 +8,10 @@
 sage -t  -long devel/sage/sage/categories/finite_semigroups.py # 2 doctests failed
 sage -t  -long devel/sage/sage/categories/examples/finite_semigroups.py # 1 doctests failed 
 ```
+
+The doctest
+
+```
+sage -t  -long devel/sage/sage/categories/finite_semigroups.py # 2 doctests failed
+```
+also failed on SPARC Solaris 10 (the machine t2.math). The failure uncovered another bug relating to kpsewhich. See ticket #8445.
``````




---

archive/issue_comments_087325.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-03-09T07:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8430#issuecomment-87325",
    "user": "https://github.com/mwhansen"
}
```

Resolution: fixed



---

archive/issue_comments_087326.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.3.4.alpha1\"",
    "created_at": "2010-03-09T07:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8430#issuecomment-87326",
    "user": "https://github.com/mwhansen"
}
```

Changing merged from "" to "sage-4.3.4.alpha1"



---

archive/issue_events_032673.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-03-09T07:44:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8430",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8430#event-32673"
}
```
