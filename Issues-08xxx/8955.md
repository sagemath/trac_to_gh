# Issue 8955: random_matrix(GF(2),2,1) always returns all 1 matrix

archive/issues_008955.json:
```json
{
    "body": "Reported by Roberto N\u00f3brega on [sage-devel]:\n\n```\nHello, all!\n\nAfter running\n\nrandom_matrix(GF(2), 2, 1)\n\nI always get the same matrix, [[1][1]].\n\nAlso, the following code\n\nfreq = {}\nfor _ in range(1000):\n    M = random_matrix(GF(2), 2, 2)\n    M.set_immutable()\n    if M not in freq:\n        freq[M] = 1\n    else:\n        freq[M] += 1\nshow(freq)\n\ngives a very different result from the uniform distribution that I was\nexpecting. For example, the all-ones 2x2 matrix is the more probable,\nand matrices with a full-zero-row does not appear, although matrices\nwith a full-zero-column does. In general, I noticed that the more\n\"1's\" the matrix has, the more probable it is.\n\nAm I missing something?\n\nRegards,\nRoberto.\n```\n\nAssignee: jason, was\n\nResolution: fixed\n\nAuthor: Martin Albrecht\n\nReviewer: Yann Laigle-Chapuy\n\nMerged: sage-4.6.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/8955\n\n",
    "closed_at": "2010-09-28T10:57:28Z",
    "created_at": "2010-05-12T10:44:22Z",
    "labels": [
        "component: linear algebra",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6",
    "title": "random_matrix(GF(2),2,1) always returns all 1 matrix",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8955",
    "user": "https://github.com/malb"
}
```
Reported by Roberto Nóbrega on [sage-devel]:

```
Hello, all!

After running

random_matrix(GF(2), 2, 1)

I always get the same matrix, [[1][1]].

Also, the following code

freq = {}
for _ in range(1000):
    M = random_matrix(GF(2), 2, 2)
    M.set_immutable()
    if M not in freq:
        freq[M] = 1
    else:
        freq[M] += 1
show(freq)

gives a very different result from the uniform distribution that I was
expecting. For example, the all-ones 2x2 matrix is the more probable,
and matrices with a full-zero-row does not appear, although matrices
with a full-zero-column does. In general, I noticed that the more
"1's" the matrix has, the more probable it is.

Am I missing something?

Regards,
Roberto.
```

Assignee: jason, was

Resolution: fixed

Author: Martin Albrecht

Reviewer: Yann Laigle-Chapuy

Merged: sage-4.6.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/8955





---

archive/issue_comments_098010.json:
```json
{
    "body": "<a id='comment:1'></a>What is the status of this?",
    "created_at": "2010-08-15T20:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98010",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

<a id='comment:1'></a>What is the status of this?



---

archive/issue_comments_098011.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-08-15T20:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98011",
    "user": "https://github.com/malb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_098012.json:
```json
{
    "body": "<a id='comment:2'></a>I always forget to toggle the right status.",
    "created_at": "2010-08-15T20:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98012",
    "user": "https://github.com/malb"
}
```

<a id='comment:2'></a>I always forget to toggle the right status.



---

archive/issue_comments_098013.json:
```json
{
    "body": "<a id='comment:3'></a>I agree with the proposed solution, but I think there should be some explanations in the docstring about what `density` means exactly.\nSeeing \n\n```\ndef random_matrix(R, nrows, ncols=None, sparse=False, density=None, *args, **kwds):\n    ...\n    - ``density``: Integer (default: 1)\n    ...\n```\nseems strange to me.",
    "created_at": "2010-08-15T20:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98013",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

<a id='comment:3'></a>I agree with the proposed solution, but I think there should be some explanations in the docstring about what `density` means exactly.
Seeing 

```
def random_matrix(R, nrows, ncols=None, sparse=False, density=None, *args, **kwds):
    ...
    - ``density``: Integer (default: 1)
    ...
```
seems strange to me.



---

archive/issue_comments_098014.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-08-15T20:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98014",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_098015.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-08-15T21:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98015",
    "user": "https://github.com/malb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_098016.json:
```json
{
    "body": "<a id='comment:4'></a>I've updated the patch accordingly (and added the ticket number)",
    "created_at": "2010-08-15T21:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98016",
    "user": "https://github.com/malb"
}
```

<a id='comment:4'></a>I've updated the patch accordingly (and added the ticket number)



---

archive/issue_comments_098017.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-08-15T21:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98017",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_098018.json:
```json
{
    "body": "<a id='comment:5'></a>Hum, I don't think it's ok now...\nMy understanding is that:\n\n* we should stare that default is None\n* we should explain that in this case each element is random and **can be 0**\n* if a density is given, it's the rate of **nonzero** element (thus for GF(2) a density of 1 means an all 1 matrix)\n* by the way, density should be float, not Integer, or?",
    "created_at": "2010-08-15T21:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98018",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

<a id='comment:5'></a>Hum, I don't think it's ok now...
My understanding is that:

* we should stare that default is None
* we should explain that in this case each element is random and **can be 0**
* if a density is given, it's the rate of **nonzero** element (thus for GF(2) a density of 1 means an all 1 matrix)
* by the way, density should be float, not Integer, or?



---

archive/issue_comments_098019.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-08-16T14:50:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98019",
    "user": "https://github.com/malb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_098020.json:
```json
{
    "body": "<a id='comment:6'></a>I've updated the attached patch\n\n* fixed the docstring as requested\n* fixed the behaviour of randomize() for dense matrices over GF(2)\u00a0\n* fixed some docstrings on the way\n\nThe patch depends on#9475.",
    "created_at": "2010-08-16T14:50:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98020",
    "user": "https://github.com/malb"
}
```

<a id='comment:6'></a>I've updated the attached patch

* fixed the docstring as requested
* fixed the behaviour of randomize() for dense matrices over GF(2) 
* fixed some docstrings on the way

The patch depends on#9475.



---

archive/issue_comments_098021.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-08-16T15:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98021",
    "user": "https://github.com/malb"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_098022.json:
```json
{
    "body": "<a id='comment:7'></a>There are some doctest failures due to changes of random matrix generation",
    "created_at": "2010-08-16T15:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98022",
    "user": "https://github.com/malb"
}
```

<a id='comment:7'></a>There are some doctest failures due to changes of random matrix generation



---

archive/issue_comments_098023.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-08-16T15:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98023",
    "user": "https://github.com/malb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_098024.json:
```json
{
    "body": "<a id='comment:8'></a>I fixed all known doctest failures. It would be good if this patch was reviewed & applied quickly since it is the kind of patch which will bitrot quickly since it touches quite a few files.",
    "created_at": "2010-08-16T15:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98024",
    "user": "https://github.com/malb"
}
```

<a id='comment:8'></a>I fixed all known doctest failures. It would be good if this patch was reviewed & applied quickly since it is the kind of patch which will bitrot quickly since it touches quite a few files.



---

archive/issue_comments_098025.json:
```json
{
    "body": "<a id='comment:9'></a>I added a minimal reviewer's patch. Otherwise, everything is fine, applies with minimal fuzz to sage4.5.3.alpha1, all doctests pass. Ok for merging.",
    "created_at": "2010-08-18T11:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98025",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

<a id='comment:9'></a>I added a minimal reviewer's patch. Otherwise, everything is fine, applies with minimal fuzz to sage4.5.3.alpha1, all doctests pass. Ok for merging.



---

archive/issue_comments_098026.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Yann Laigle-Chapuy\"",
    "created_at": "2010-08-18T11:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98026",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

Changing reviewer from "" to "Yann Laigle-Chapuy"



---

archive/issue_comments_098027.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-08-18T11:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98027",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_098028.json:
```json
{
    "body": "<a id='comment:10'></a>The reviewer patch is fine by me too.",
    "created_at": "2010-08-18T11:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98028",
    "user": "https://github.com/malb"
}
```

<a id='comment:10'></a>The reviewer patch is fine by me too.



---

archive/issue_comments_098029.json:
```json
{
    "body": "Changing work_issues from \"\" to \"rebase\"",
    "created_at": "2010-09-18T07:45:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98029",
    "user": "https://github.com/qed777"
}
```

Changing work_issues from "" to "rebase"



---

archive/issue_comments_098030.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2010-09-18T07:45:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98030",
    "user": "https://github.com/qed777"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_098031.json:
```json
{
    "body": "<a id='comment:11'></a>Could someone rebase the patch(es) here against 4.6.alpha1 when it's released (soon) and restore the positive review?",
    "created_at": "2010-09-18T07:45:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98031",
    "user": "https://github.com/qed777"
}
```

<a id='comment:11'></a>Could someone rebase the patch(es) here against 4.6.alpha1 when it's released (soon) and restore the positive review?



---

archive/issue_comments_098032.json:
```json
{
    "body": "Attachment [random_matrix.patch](tarball://root/attachments/some-uuid/ticket8955/random_matrix.patch) by @malb created at 2010-09-20 15:52:26",
    "created_at": "2010-09-20T15:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98032",
    "user": "https://github.com/malb"
}
```

Attachment [random_matrix.patch](tarball://root/attachments/some-uuid/ticket8955/random_matrix.patch) by @malb created at 2010-09-20 15:52:26



---

archive/issue_comments_098033.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-09-20T15:53:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98033",
    "user": "https://github.com/malb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_098034.json:
```json
{
    "body": "<a id='comment:12'></a>The updated patch is rebased to 4.6.alpha1. Apply `random_matrix.patch` only.",
    "created_at": "2010-09-20T15:53:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98034",
    "user": "https://github.com/malb"
}
```

<a id='comment:12'></a>The updated patch is rebased to 4.6.alpha1. Apply `random_matrix.patch` only.



---

archive/issue_comments_098035.json:
```json
{
    "body": "<a id='comment:13'></a>malb: based on the comment above, should you restore the positive review?",
    "created_at": "2010-09-23T23:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98035",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:13'></a>malb: based on the comment above, should you restore the positive review?



---

archive/issue_comments_098036.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-09-27T14:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98036",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_098037.json:
```json
{
    "body": "<a id='comment:14'></a>Attachment [8955_review.patch](tarball://root/attachments/some-uuid/ticket8955/8955_review.patch) by ylchapuy created at 2010-09-27 14:28:36\n\nReviewer's patch also updated ;)\nPositive review. (I'm quite sure malb will confirm)",
    "created_at": "2010-09-27T14:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98037",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

<a id='comment:14'></a>Attachment [8955_review.patch](tarball://root/attachments/some-uuid/ticket8955/8955_review.patch) by ylchapuy created at 2010-09-27 14:28:36

Reviewer's patch also updated ;)
Positive review. (I'm quite sure malb will confirm)



---

archive/issue_comments_098038.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.6.alpha2\"",
    "created_at": "2010-09-28T10:57:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98038",
    "user": "https://github.com/qed777"
}
```

Changing merged from "" to "sage-4.6.alpha2"



---

archive/issue_events_021873.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-28T10:57:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8955#event-21873"
}
```



---

archive/issue_comments_098039.json:
```json
{
    "body": "Changing work_issues from \"rebase\" to \"\"",
    "created_at": "2010-09-28T10:57:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98039",
    "user": "https://github.com/qed777"
}
```

Changing work_issues from "rebase" to ""



---

archive/issue_comments_098040.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-09-28T10:57:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-98040",
    "user": "https://github.com/qed777"
}
```

Resolution: fixed
