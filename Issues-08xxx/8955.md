# Issue 8955: random_matrix(GF(2),2,1) always returns all 1 matrix

archive/issues_008955.json:
```json
{
    "body": "Reported by Roberto N\u00f3brega on [sage-devel]:\n\n```\nHello, all!\n\nAfter running\n\nrandom_matrix(GF(2), 2, 1)\n\nI always get the same matrix, [[1][1]].\n\nAlso, the following code\n\nfreq = {}\nfor _ in range(1000):\n    M = random_matrix(GF(2), 2, 2)\n    M.set_immutable()\n    if M not in freq:\n        freq[M] = 1\n    else:\n        freq[M] += 1\nshow(freq)\n\ngives a very different result from the uniform distribution that I was\nexpecting. For example, the all-ones 2x2 matrix is the more probable,\nand matrices with a full-zero-row does not appear, although matrices\nwith a full-zero-column does. In general, I noticed that the more\n\"1's\" the matrix has, the more probable it is.\n\nAm I missing something?\n\nRegards,\nRoberto.\n```\n\n**Assignee:** @jasongrout, @williamstein\n\n**Author:** Martin Albrecht\n\n**Reviewer:** Yann Laigle-Chapuy\n\n**Merged:** sage-4.6.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/8955\n\n",
    "closed_at": "2010-09-28T10:57:28Z",
    "created_at": "2010-05-12T10:44:22Z",
    "labels": [
        "component: linear algebra",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6",
    "title": "random_matrix(GF(2),2,1) always returns all 1 matrix",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8955",
    "user": "https://github.com/malb"
}
```
Reported by Roberto Nóbrega on [sage-devel]:

```
Hello, all!

After running

random_matrix(GF(2), 2, 1)

I always get the same matrix, [[1][1]].

Also, the following code

freq = {}
for _ in range(1000):
    M = random_matrix(GF(2), 2, 2)
    M.set_immutable()
    if M not in freq:
        freq[M] = 1
    else:
        freq[M] += 1
show(freq)

gives a very different result from the uniform distribution that I was
expecting. For example, the all-ones 2x2 matrix is the more probable,
and matrices with a full-zero-row does not appear, although matrices
with a full-zero-column does. In general, I noticed that the more
"1's" the matrix has, the more probable it is.

Am I missing something?

Regards,
Roberto.
```

**Assignee:** @jasongrout, @williamstein

**Author:** Martin Albrecht

**Reviewer:** Yann Laigle-Chapuy

**Merged:** sage-4.6.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/8955





---

archive/issue_comments_095252.json:
```json
{
    "body": "<a id='comment:1'></a>\nWhat is the status of this?",
    "created_at": "2010-08-15T20:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95252",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

<a id='comment:1'></a>
What is the status of this?



---

archive/issue_comments_095253.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2010-08-15T20:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95253",
    "user": "https://github.com/malb"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_095254.json:
```json
{
    "body": "<a id='comment:2'></a>\nI always forget to toggle the right status.",
    "created_at": "2010-08-15T20:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95254",
    "user": "https://github.com/malb"
}
```

<a id='comment:2'></a>
I always forget to toggle the right status.



---

archive/issue_comments_095255.json:
```json
{
    "body": "<a id='comment:3'></a>\nI agree with the proposed solution, but I think there should be some explanations in the docstring about what `density` means exactly.\nSeeing \n\n```\ndef random_matrix(R, nrows, ncols=None, sparse=False, density=None, *args, **kwds):\n    ...\n    - ``density``: Integer (default: 1)\n    ...\n```\nseems strange to me.",
    "created_at": "2010-08-15T20:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95255",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

<a id='comment:3'></a>
I agree with the proposed solution, but I think there should be some explanations in the docstring about what `density` means exactly.
Seeing 

```
def random_matrix(R, nrows, ncols=None, sparse=False, density=None, *args, **kwds):
    ...
    - ``density``: Integer (default: 1)
    ...
```
seems strange to me.



---

archive/issue_comments_095256.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2010-08-15T20:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95256",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_095257.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-08-15T21:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95257",
    "user": "https://github.com/malb"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_095258.json:
```json
{
    "body": "<a id='comment:4'></a>\nI've updated the patch accordingly (and added the ticket number)",
    "created_at": "2010-08-15T21:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95258",
    "user": "https://github.com/malb"
}
```

<a id='comment:4'></a>
I've updated the patch accordingly (and added the ticket number)



---

archive/issue_comments_095259.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2010-08-15T21:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95259",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_095260.json:
```json
{
    "body": "<a id='comment:5'></a>\nHum, I don't think it's ok now...\nMy understanding is that:\n\n* we should stare that default is None\n* we should explain that in this case each element is random and **can be 0**\n* if a density is given, it's the rate of **nonzero** element (thus for GF(2) a density of 1 means an all 1 matrix)\n* by the way, density should be float, not Integer, or?",
    "created_at": "2010-08-15T21:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95260",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

<a id='comment:5'></a>
Hum, I don't think it's ok now...
My understanding is that:

* we should stare that default is None
* we should explain that in this case each element is random and **can be 0**
* if a density is given, it's the rate of **nonzero** element (thus for GF(2) a density of 1 means an all 1 matrix)
* by the way, density should be float, not Integer, or?



---

archive/issue_comments_095261.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-08-16T14:50:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95261",
    "user": "https://github.com/malb"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_095262.json:
```json
{
    "body": "<a id='comment:6'></a>\nI've updated the attached patch\n\n* fixed the docstring as requested\n* fixed the behaviour of randomize() for dense matrices over GF(2)\u00a0\n* fixed some docstrings on the way\n\nThe patch depends on#9475.",
    "created_at": "2010-08-16T14:50:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95262",
    "user": "https://github.com/malb"
}
```

<a id='comment:6'></a>
I've updated the attached patch

* fixed the docstring as requested
* fixed the behaviour of randomize() for dense matrices over GF(2) 
* fixed some docstrings on the way

The patch depends on#9475.



---

archive/issue_comments_095263.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2010-08-16T15:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95263",
    "user": "https://github.com/malb"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_095264.json:
```json
{
    "body": "<a id='comment:7'></a>\nThere are some doctest failures due to changes of random matrix generation",
    "created_at": "2010-08-16T15:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95264",
    "user": "https://github.com/malb"
}
```

<a id='comment:7'></a>
There are some doctest failures due to changes of random matrix generation



---

archive/issue_comments_095265.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-08-16T15:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95265",
    "user": "https://github.com/malb"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_095266.json:
```json
{
    "body": "<a id='comment:8'></a>\nI fixed all known doctest failures. It would be good if this patch was reviewed & applied quickly since it is the kind of patch which will bitrot quickly since it touches quite a few files.",
    "created_at": "2010-08-16T15:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95266",
    "user": "https://github.com/malb"
}
```

<a id='comment:8'></a>
I fixed all known doctest failures. It would be good if this patch was reviewed & applied quickly since it is the kind of patch which will bitrot quickly since it touches quite a few files.



---

archive/issue_comments_095267.json:
```json
{
    "body": "<a id='comment:9'></a>\nI added a minimal reviewer's patch. Otherwise, everything is fine, applies with minimal fuzz to sage4.5.3.alpha1, all doctests pass. Ok for merging.",
    "created_at": "2010-08-18T11:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95267",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

<a id='comment:9'></a>
I added a minimal reviewer's patch. Otherwise, everything is fine, applies with minimal fuzz to sage4.5.3.alpha1, all doctests pass. Ok for merging.



---

archive/issue_comments_095268.json:
```json
{
    "body": "**Reviewer:** Yann Laigle-Chapuy",
    "created_at": "2010-08-18T11:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95268",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

**Reviewer:** Yann Laigle-Chapuy



---

archive/issue_comments_095269.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2010-08-18T11:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95269",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_095270.json:
```json
{
    "body": "<a id='comment:10'></a>\nThe reviewer patch is fine by me too.",
    "created_at": "2010-08-18T11:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95270",
    "user": "https://github.com/malb"
}
```

<a id='comment:10'></a>
The reviewer patch is fine by me too.



---

archive/issue_comments_095271.json:
```json
{
    "body": "**Work_Issues:** rebase",
    "created_at": "2010-09-18T07:45:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95271",
    "user": "https://github.com/qed777"
}
```

**Work_Issues:** rebase



---

archive/issue_comments_095272.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2010-09-18T07:45:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95272",
    "user": "https://github.com/qed777"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_095273.json:
```json
{
    "body": "<a id='comment:11'></a>\nCould someone rebase the patch(es) here against 4.6.alpha1 when it's released (soon) and restore the positive review?",
    "created_at": "2010-09-18T07:45:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95273",
    "user": "https://github.com/qed777"
}
```

<a id='comment:11'></a>
Could someone rebase the patch(es) here against 4.6.alpha1 when it's released (soon) and restore the positive review?



---

archive/attachments_011211.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "random_matrix.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8955/random_matrix.patch",
    "created_at": "2010-09-20T15:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/malb"
}
```



---

archive/issue_comments_095274.json:
```json
{
    "body": "",
    "created_at": "2010-09-20T15:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95274",
    "user": "https://github.com/malb"
}
```





---

archive/issue_comments_095275.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-09-20T15:53:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95275",
    "user": "https://github.com/malb"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_095276.json:
```json
{
    "body": "<a id='comment:12'></a>\nThe updated patch is rebased to 4.6.alpha1. Apply `random_matrix.patch` only.",
    "created_at": "2010-09-20T15:53:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95276",
    "user": "https://github.com/malb"
}
```

<a id='comment:12'></a>
The updated patch is rebased to 4.6.alpha1. Apply `random_matrix.patch` only.



---

archive/issue_comments_095277.json:
```json
{
    "body": "<a id='comment:13'></a>\nmalb: based on the comment above, should you restore the positive review?",
    "created_at": "2010-09-23T23:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95277",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:13'></a>
malb: based on the comment above, should you restore the positive review?



---

archive/issue_comments_095278.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2010-09-27T14:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95278",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

**Changing status** from needs_review to positive_review.



---

archive/attachments_011212.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "8955_review.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8955/8955_review.patch",
    "created_at": "2010-09-27T14:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```



---

archive/issue_comments_095279.json:
```json
{
    "body": "<a id='comment:14'></a>\nReviewer's patch also updated ;)\nPositive review. (I'm quite sure malb will confirm)",
    "created_at": "2010-09-27T14:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95279",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

<a id='comment:14'></a>
Reviewer's patch also updated ;)
Positive review. (I'm quite sure malb will confirm)



---

archive/issue_comments_095280.json:
```json
{
    "body": "**Merged:** sage-4.6.alpha2",
    "created_at": "2010-09-28T10:57:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95280",
    "user": "https://github.com/qed777"
}
```

**Merged:** sage-4.6.alpha2



---

archive/issue_events_027099.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-28T10:57:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8955#event-27099"
}
```



---

archive/issue_comments_095281.json:
```json
{
    "body": "**Changing work_issues** from \"rebase\" to \"\".",
    "created_at": "2010-09-28T10:57:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8955",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8955#issuecomment-95281",
    "user": "https://github.com/qed777"
}
```

**Changing work_issues** from "rebase" to "".
