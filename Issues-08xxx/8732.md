# Issue 8732: bug in new HMM code

archive/issues_008732.json:
```json
{
    "assignees": [],
    "body": "Crap, there is a bug in the new HMM code (#8547) that just went into sage-4.4.alpha0:\n\nTry this:\n\n```\nsage: m = hmm.DiscreteHiddenMarkovModel([[1/3]*3]*3, [ [5]*5 ]*3, [1/3]*3, 'abcde'); m\nsage: v = list('a'*100); v\nsage: m.baum_welch(v)\nsage: m.sample(10)\n['e', 'a', 'e', 'e', 'a', 'c', 'c', 'c', 'c', 'a']\nsage: m\nDiscrete Hidden Markov Model with 3 States and 5 Emissions\nTransition matrix:\n[0.333333333333 0.333333333333 0.333333333333]\n[0.333333333333 0.333333333333 0.333333333333]\n[0.333333333333 0.333333333333 0.333333333333]\nEmission matrix:\n[1.0 0.0 0.0 0.0 0.0]\n[1.0 0.0 0.0 0.0 0.0]\n[1.0 0.0 0.0 0.0 0.0]\nInitial probabilities: [0.3333, 0.3333, 0.3333]\n```\n\nNotice above that it is impossible for the model to emit anything except 'a'.  Yet in the sample it does!  \n\nThis bug wasn't in the previous HMM code, of course.  I'll fix this ASAP for sage-4.4. \n\n\nWilliam\n\nAssignee: **amhou**\n\nCC:  mhampton boothby @jasongrout\n\nAuthor: **William Stein**\n\nReviewer: **Marshall Hampton**\n\nMerged: **sage-4.4.alpha2**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/8732_\n\n",
    "closed_at": "2010-04-23T17:09:04Z",
    "created_at": "2010-04-20T20:48:47Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20statistics",
        "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "bug in new HMM code",
    "type": "issue",
    "updated_at": "2010-04-23T17:09:04Z",
    "url": "https://github.com/sagemath/sage/issues/8732",
    "user": "https://github.com/williamstein"
}
```
Crap, there is a bug in the new HMM code (#8547) that just went into sage-4.4.alpha0:

Try this:

```
sage: m = hmm.DiscreteHiddenMarkovModel([[1/3]*3]*3, [ [5]*5 ]*3, [1/3]*3, 'abcde'); m
sage: v = list('a'*100); v
sage: m.baum_welch(v)
sage: m.sample(10)
['e', 'a', 'e', 'e', 'a', 'c', 'c', 'c', 'c', 'a']
sage: m
Discrete Hidden Markov Model with 3 States and 5 Emissions
Transition matrix:
[0.333333333333 0.333333333333 0.333333333333]
[0.333333333333 0.333333333333 0.333333333333]
[0.333333333333 0.333333333333 0.333333333333]
Emission matrix:
[1.0 0.0 0.0 0.0 0.0]
[1.0 0.0 0.0 0.0 0.0]
[1.0 0.0 0.0 0.0 0.0]
Initial probabilities: [0.3333, 0.3333, 0.3333]
```

Notice above that it is impossible for the model to emit anything except 'a'.  Yet in the sample it does!  

This bug wasn't in the previous HMM code, of course.  I'll fix this ASAP for sage-4.4. 


William

Assignee: **amhou**

CC:  mhampton boothby @jasongrout

Author: **William Stein**

Reviewer: **Marshall Hampton**

Merged: **sage-4.4.alpha2**

_Issue created by migration from https://trac.sagemath.org/ticket/8732_





---

archive/issue_events_097383.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-04-20T20:48:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8732",
    "milestone_number": null,
    "milestone_title": "sage-4.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8732#event-97383"
}
```



---

archive/issue_events_097384.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-04-20T20:48:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8732",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20statistics",
    "label_color": "0000ff",
    "label_name": "component: statistics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8732#event-97384"
}
```



---

archive/issue_events_097385.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-04-20T20:48:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8732",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8732#event-97385"
}
```



---

archive/issue_events_097386.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-04-20T20:48:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8732",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8732#event-97386"
}
```



---

archive/issue_comments_072584.json:
```json
{
    "body": "Attachment: **[trac_8732.patch.gz](https://github.com/sagemath/sage/files/ticket8732/trac_8732.patch.gz)**",
    "created_at": "2010-04-20T21:46:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8732#issuecomment-72584",
    "user": "https://github.com/williamstein"
}
```

Attachment: **[trac_8732.patch.gz](https://github.com/sagemath/sage/files/ticket8732/trac_8732.patch.gz)**



---

archive/issue_comments_072585.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nI had a C array index backwards.",
    "created_at": "2010-04-20T21:46:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8732#issuecomment-72585",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:1'>Comment 1:</a>
I had a C array index backwards.



---

archive/issue_events_097387.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-04-20T21:46:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8732",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8732#event-97387"
}
```



---

archive/issue_comments_072586.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nI'm cc'ing some possible reviewers...",
    "created_at": "2010-04-20T23:01:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8732#issuecomment-72586",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'>Comment 2:</a>
I'm cc'ing some possible reviewers...



---

archive/issue_comments_072587.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nOK, patch looks good.  Passes tests and coverage, change makes sense, and I did some random testing so I am giving this a positive review.",
    "created_at": "2010-04-21T03:11:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8732#issuecomment-72587",
    "user": "https://github.com/sagetrac-mhampton"
}
```

<a id='comment:3'>Comment 3:</a>
OK, patch looks good.  Passes tests and coverage, change makes sense, and I did some random testing so I am giving this a positive review.



---

archive/issue_events_097388.json:
```json
{
    "actor": "https://github.com/sagetrac-mhampton",
    "created_at": "2010-04-21T03:11:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8732",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8732#event-97388"
}
```



---

archive/issue_events_097389.json:
```json
{
    "actor": "https://github.com/sagetrac-mhampton",
    "created_at": "2010-04-21T03:11:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8732",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8732#event-97389"
}
```



---

archive/issue_comments_072588.json:
```json
{
    "body": "Author: **William Stein**",
    "created_at": "2010-04-23T17:09:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8732#issuecomment-72588",
    "user": "https://github.com/jhpalmieri"
}
```

Author: **William Stein**



---

archive/issue_comments_072589.json:
```json
{
    "body": "Reviewer: **Marshall Hampton**",
    "created_at": "2010-04-23T17:09:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8732#issuecomment-72589",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **Marshall Hampton**



---

archive/issue_comments_072590.json:
```json
{
    "body": "Merged: **sage-4.4.alpha2**",
    "created_at": "2010-04-23T17:09:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8732#issuecomment-72590",
    "user": "https://github.com/jhpalmieri"
}
```

Merged: **sage-4.4.alpha2**



---

archive/issue_comments_072591.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nMerged into 4.4.alpha2.",
    "created_at": "2010-04-23T17:09:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8732",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8732#issuecomment-72591",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'>Comment 4:</a>
Merged into 4.4.alpha2.



---

archive/issue_events_097390.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-04-23T17:09:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8732",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8732#event-97390"
}
```



---

archive/issue_events_097391.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-04-23T17:09:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/8732",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8732#event-97391"
}
```
