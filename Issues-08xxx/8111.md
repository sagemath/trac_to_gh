# Issue 8111: gcd of rationals is trouble

archive/issues_008111.json:
```json
{
    "body": "The following was solved along the way. We add a doctest.\n\nThe GCD of rationals is still unclear (see trac 3214), and leads to definite problems with reduce(). \n\n```\nK.<k>= QQ[];\nprint(gcd(64,256))\nprint(gcd(K(64),K(256)))\nprint(gcd(64*k^2+128,64*k^3+256))\nfrac = (64*k^2+128)/(64*k^3+256)\nfrac.reduce()\nprint(frac)\n```\ngives\n\n```\n64\n1\n1\n(64*k^2 + 128)/(64*k^3 + 256)\n```\nThe last line in particular is false, according to me.\n\nAssignee: @aghitza\n\nKeywords: sd109\n\nBranch/Commit: bed3abb1364df5a4e0588953f535b3cc9b563766\n\nStopgaps: todo\n\nReviewer: Matthias Koeppe\n\nAuthor: Jonathan Kliem\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/8111\n\n",
    "closed_at": "2020-07-08T19:32:46Z",
    "created_at": "2010-01-28T15:04:16Z",
    "labels": [
        "component: basic arithmetic",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "gcd of rationals is trouble",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8111",
    "user": "https://trac.sagemath.org/admin/accounts/users/pdehaye"
}
```
The following was solved along the way. We add a doctest.

The GCD of rationals is still unclear (see trac 3214), and leads to definite problems with reduce(). 

```
K.<k>= QQ[];
print(gcd(64,256))
print(gcd(K(64),K(256)))
print(gcd(64*k^2+128,64*k^3+256))
frac = (64*k^2+128)/(64*k^3+256)
frac.reduce()
print(frac)
```
gives

```
64
1
1
(64*k^2 + 128)/(64*k^3 + 256)
```
The last line in particular is false, according to me.

Assignee: @aghitza

Keywords: sd109

Branch/Commit: bed3abb1364df5a4e0588953f535b3cc9b563766

Stopgaps: todo

Reviewer: Matthias Koeppe

Author: Jonathan Kliem

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/8111





---

archive/issue_comments_073629.json:
```json
{
    "body": "<a id='comment:1'></a>I think the trouble here is our generic fraction field code, not how we define the gcd of rational numbers.\n\nFor efficiency, we should represent QQ(x) as Frac(ZZ[x]), and do the necessary normalisation of the denominator (it should be monic) when the user accesses it with `.denominator()`.",
    "created_at": "2010-01-29T15:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8111#issuecomment-73629",
    "user": "https://github.com/burcin"
}
```

<a id='comment:1'></a>I think the trouble here is our generic fraction field code, not how we define the gcd of rational numbers.

For efficiency, we should represent QQ(x) as Frac(ZZ[x]), and do the necessary normalisation of the denominator (it should be monic) when the user accesses it with `.denominator()`.



---

archive/issue_comments_073630.json:
```json
{
    "body": "<a id='comment:2'></a>#10771 is probably related/same thing.",
    "created_at": "2011-02-16T21:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8111#issuecomment-73630",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:2'></a>#10771 is probably related/same thing.



---

archive/issue_comments_073631.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:2 kcrisman]:\n> #10771 is probably related/same thing.\n\n\nIt may be related, but my patch from #10771 does not touch the gcd for `QQ['x']` (perhaps it should?). So far, the two tickets are about different issues.",
    "created_at": "2011-02-17T07:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8111#issuecomment-73631",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:3'></a>Replying to [comment:2 kcrisman]:
> #10771 is probably related/same thing.


It may be related, but my patch from #10771 does not touch the gcd for `QQ['x']` (perhaps it should?). So far, the two tickets are about different issues.



---

archive/issue_comments_073632.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 SimonKing]:\n> Replying to [comment:2 kcrisman]:\n> > #10771 is probably related/same thing.\n\n> \n> It may be related, but my patch from #10771 does not touch the gcd for `QQ['x']` (perhaps it should?). So far, the two tickets are about different issues.\n\n\nPS: It seems to me that for changing gcd for univariate polynomials over the rationals, one has to dive into flint. I'll not do that, it'd be too far off topic for me. BTW, the doc string explicitly states that gcd in `QQ['x']` returns the *monic* gcd.",
    "created_at": "2011-02-17T07:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8111#issuecomment-73632",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:4'></a>Replying to [comment:3 SimonKing]:
> Replying to [comment:2 kcrisman]:
> > #10771 is probably related/same thing.

> 
> It may be related, but my patch from #10771 does not touch the gcd for `QQ['x']` (perhaps it should?). So far, the two tickets are about different issues.


PS: It seems to me that for changing gcd for univariate polynomials over the rationals, one has to dive into flint. I'll not do that, it'd be too far off topic for me. BTW, the doc string explicitly states that gcd in `QQ['x']` returns the *monic* gcd.



---

archive/issue_events_019412.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8111#event-19412"
}
```



---

archive/issue_events_019413.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8111#event-19413"
}
```



---

archive/issue_events_019414.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8111#event-19414"
}
```



---

archive/issue_events_019415.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8111#event-19415"
}
```



---

archive/issue_events_019416.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8111#event-19416"
}
```



---

archive/issue_events_019417.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8111#event-19417"
}
```



---

archive/issue_events_019418.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8111#event-19418"
}
```



---

archive/issue_comments_073633.json:
```json
{
    "body": "<a id='comment:9'></a>Possibly related: [this discussion](https://groups.google.com/forum/#!searchin/sage-devel/xgcd/sage-devel/JV8fCPUqTzo/FTGonGmYyCgJ).",
    "created_at": "2015-02-12T15:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8111#issuecomment-73633",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'></a>Possibly related: [this discussion](https://groups.google.com/forum/#!searchin/sage-devel/xgcd/sage-devel/JV8fCPUqTzo/FTGonGmYyCgJ).



---

archive/issue_comments_073634.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,13 +1,26 @@\n+This appears to be solved by now.\n+\n+The output is now\n+\n+```\n+64\n+1\n+1\n+(k^2 + 2)/(k^3 + 4)\n+```\n+\n+Original description (updated to python3):\n+\n The GCD of rationals is still unclear (see trac 3214), and leads to definite problems with reduce(). \n \n ```\n K.<k>= QQ[];\n-print gcd(64,256)\n-print gcd(K(64),K(256))\n-print gcd(64*k^2+128,64*k^3+256)\n+print(gcd(64,256))\n+print(gcd(K(64),K(256)))\n+print(gcd(64*k^2+128,64*k^3+256))\n frac = (64*k^2+128)/(64*k^3+256)\n frac.reduce()\n-print frac\n+print(frac)\n ```\n gives\n \n```\n",
    "created_at": "2020-05-27T19:04:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8111#issuecomment-73634",
    "user": "https://github.com/kliem"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,13 +1,26 @@
+This appears to be solved by now.
+
+The output is now
+
+```
+64
+1
+1
+(k^2 + 2)/(k^3 + 4)
+```
+
+Original description (updated to python3):
+
 The GCD of rationals is still unclear (see trac 3214), and leads to definite problems with reduce(). 
 
 ```
 K.<k>= QQ[];
-print gcd(64,256)
-print gcd(K(64),K(256))
-print gcd(64*k^2+128,64*k^3+256)
+print(gcd(64,256))
+print(gcd(K(64),K(256)))
+print(gcd(64*k^2+128,64*k^3+256))
 frac = (64*k^2+128)/(64*k^3+256)
 frac.reduce()
-print frac
+print(frac)
 ```
 gives
 
```




---

archive/issue_events_019419.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-05-27T19:04:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8111#event-19419"
}
```



---

archive/issue_events_019420.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-05-27T19:04:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8111#event-19420"
}
```



---

archive/issue_comments_073635.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-05-27T19:04:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8111#issuecomment-73635",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_073636.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd109\".",
    "created_at": "2020-05-27T19:04:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8111#issuecomment-73636",
    "user": "https://github.com/kliem"
}
```

Changing keywords from "" to "sd109".



---

archive/issue_events_019421.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2020-05-27T19:15:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8111#event-19421"
}
```



---

archive/issue_events_019422.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2020-05-27T19:15:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8111#event-19422"
}
```



---

archive/issue_comments_073637.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2020-05-27T19:15:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8111#issuecomment-73637",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_073638.json:
```json
{
    "body": "<a id='comment:12'></a>If this is fixed, we should probably have a doctest then.  Unless it wasn't an error to begin with?  Or it's possible it was fixed elsewhere and doctested, which is fine too.",
    "created_at": "2020-05-27T19:15:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8111#issuecomment-73638",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:12'></a>If this is fixed, we should probably have a doctest then.  Unless it wasn't an error to begin with?  Or it's possible it was fixed elsewhere and doctested, which is fine too.



---

archive/issue_comments_073639.json:
```json
{
    "body": "Changing type from defect to task.",
    "created_at": "2020-05-27T19:15:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8111#issuecomment-73639",
    "user": "https://github.com/kcrisman"
}
```

Changing type from defect to task.



---

archive/issue_comments_073640.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2020-05-27T19:15:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8111#issuecomment-73640",
    "user": "https://github.com/kcrisman"
}
```

Changing priority from major to minor.



---

archive/issue_comments_073641.json:
```json
{
    "body": "<a id='comment:13'></a>New commits:",
    "created_at": "2020-05-27T19:22:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8111#issuecomment-73641",
    "user": "https://github.com/kliem"
}
```

<a id='comment:13'></a>New commits:



---

archive/issue_comments_073642.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,25 @@\n+The following was solved along the way. We add a doctest.\n \n+The GCD of rationals is still unclear (see trac 3214), and leads to definite problems with reduce(). \n+\n+```\n+K.<k>= QQ[];\n+print(gcd(64,256))\n+print(gcd(K(64),K(256)))\n+print(gcd(64*k^2+128,64*k^3+256))\n+frac = (64*k^2+128)/(64*k^3+256)\n+frac.reduce()\n+print(frac)\n+```\n+gives\n+\n+```\n+64\n+1\n+1\n+(64*k^2 + 128)/(64*k^3 + 256)\n+```\n+The last line in particular is false, according to me.\n \n Comment: 1\n \n```\n",
    "created_at": "2020-05-27T19:22:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8111#issuecomment-73642",
    "user": "https://github.com/kliem"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,25 @@
+The following was solved along the way. We add a doctest.
 
+The GCD of rationals is still unclear (see trac 3214), and leads to definite problems with reduce(). 
+
+```
+K.<k>= QQ[];
+print(gcd(64,256))
+print(gcd(K(64),K(256)))
+print(gcd(64*k^2+128,64*k^3+256))
+frac = (64*k^2+128)/(64*k^3+256)
+frac.reduce()
+print(frac)
+```
+gives
+
+```
+64
+1
+1
+(64*k^2 + 128)/(64*k^3 + 256)
+```
+The last line in particular is false, according to me.
 
 Comment: 1
 
```




---

archive/issue_comments_073643.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2020-05-27T19:22:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8111#issuecomment-73643",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_events_019423.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-14T14:14:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8111#event-19423"
}
```



---

archive/issue_events_019424.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-14T14:14:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8111#event-19424"
}
```



---

archive/issue_comments_073644.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-14T14:15:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8111#issuecomment-73644",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_073645.json:
```json
{
    "body": "<a id='comment:16'></a>Thank you.",
    "created_at": "2020-06-14T18:26:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8111#issuecomment-73645",
    "user": "https://github.com/kliem"
}
```

<a id='comment:16'></a>Thank you.



---

archive/issue_events_019425.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-08T19:32:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8111#event-19425"
}
```



---

archive/issue_comments_073646.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-08T19:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8111#issuecomment-73646",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
