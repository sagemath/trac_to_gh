# Issue 8920: Factor code between words's alphabets and sets/enumerated sets/ordered sets

archive/issues_008920.json:
```json
{
    "body": "Create a class `TotallyOrderedFiniteSet` in sage.sets. Delete the different classes for alphabets (in sage.combinat.words.alphabet) and use the one in Sage (included the freshly created `TotallyOrderedFiniteSet`).\n\nAssignee: sage-combinat\n\nCC:  sage-combinat @videlec @staroste\n\nKeywords: Words, Sets, Cernay2012, days45\n\nReviewer: Travis Scrimshaw\n\nAuthor: Vincent Delecroix, \u0160t\u011bp\u00e1n Starosta\n\nMerged: sage-5.8.beta2\n\nDependencies: #13801, #6495\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/8920\n\n",
    "closed_at": "2013-02-28T10:30:47Z",
    "created_at": "2010-05-07T17:04:04Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.8",
    "title": "Factor code between words's alphabets and sets/enumerated sets/ordered sets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8920",
    "user": "https://github.com/hivert"
}
```
Create a class `TotallyOrderedFiniteSet` in sage.sets. Delete the different classes for alphabets (in sage.combinat.words.alphabet) and use the one in Sage (included the freshly created `TotallyOrderedFiniteSet`).

Assignee: sage-combinat

CC:  sage-combinat @videlec @staroste

Keywords: Words, Sets, Cernay2012, days45

Reviewer: Travis Scrimshaw

Author: Vincent Delecroix, Štěpán Starosta

Merged: sage-5.8.beta2

Dependencies: #13801, #6495

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/8920





---

archive/issue_comments_103901.json:
```json
{
    "body": "<a id='comment:1'></a>\nHi Vincent,\n\nYou are currently taking car of this. You may want either to reuse this ticket or to close it as duplicate.\n\nFlorent",
    "created_at": "2012-02-09T01:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103901",
    "user": "https://github.com/hivert"
}
```

<a id='comment:1'></a>
Hi Vincent,

You are currently taking car of this. You may want either to reuse this ticket or to close it as duplicate.

Florent



---

archive/issue_comments_103902.json:
```json
{
    "body": "Changing keywords from \"Words, Sets\" to \"Words, Sets, Cernay2012\".",
    "created_at": "2012-02-09T01:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103902",
    "user": "https://github.com/hivert"
}
```

Changing keywords from "Words, Sets" to "Words, Sets, Cernay2012".



---

archive/issue_comments_103903.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-There is a lot of common code....\n+Delete the different classes for alphabets (in sage.combinat.words.alphabet) and use the code of sets, enumerated sets and ordered sets. The class FiniteEnumeratedSet is slightly modified by the patch.\n``````\n",
    "created_at": "2012-08-16T11:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103903",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-There is a lot of common code....
+Delete the different classes for alphabets (in sage.combinat.words.alphabet) and use the code of sets, enumerated sets and ordered sets. The class FiniteEnumeratedSet is slightly modified by the patch.
``````




---

archive/issue_comments_103904.json:
```json
{
    "body": "<a id='comment:4'></a>\nMany tests currently break because of the following behavior\n\n```\nsage: int(2) in Integers()\nTrue\nsage: int(2) in PositiveIntegers()\nFalse\n```",
    "created_at": "2012-08-16T11:08:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103904",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>
Many tests currently break because of the following behavior

```
sage: int(2) in Integers()
True
sage: int(2) in PositiveIntegers()
False
```



---

archive/issue_comments_103905.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Delete the different classes for alphabets (in sage.combinat.words.alphabet) and use the code of sets, enumerated sets and ordered sets. The class FiniteEnumeratedSet is slightly modified by the patch.\n+Delete the different classes for alphabets (in sage.combinat.words.alphabet) and use the code of sets, enumerated sets and ordered sets. The classes sage.sets.FiniteEnumeratedSet and sage.sets.IntegerRange are slightly modified by the patch.\n``````\n",
    "created_at": "2012-08-17T12:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103905",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Delete the different classes for alphabets (in sage.combinat.words.alphabet) and use the code of sets, enumerated sets and ordered sets. The class FiniteEnumeratedSet is slightly modified by the patch.
+Delete the different classes for alphabets (in sage.combinat.words.alphabet) and use the code of sets, enumerated sets and ordered sets. The classes sage.sets.FiniteEnumeratedSet and sage.sets.IntegerRange are slightly modified by the patch.
``````




---

archive/issue_comments_103906.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-08-17T12:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103906",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_103907.json:
```json
{
    "body": "<a id='comment:7'></a>\nHey Vincent,\n   The patch needs rebasing to 5.5.rc0. Once you upload the rebase, I'll review the patch.\n\nI think the only merged patch which might have caused the conflict is #13677.\n\nThanks,\n\nTravis",
    "created_at": "2012-11-28T00:14:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103907",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
Hey Vincent,
   The patch needs rebasing to 5.5.rc0. Once you upload the rebase, I'll review the patch.

I think the only merged patch which might have caused the conflict is #13677.

Thanks,

Travis



---

archive/issue_comments_103908.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [tscrim](#comment%3A7):\n> Hey Vincent,\n>    The patch needs rebasing to 5.5.rc0. Once you upload the rebase, I'll review the patch.\n> \n> I think the only merged patch which might have caused the conflict is #13677.\n> \n> Thanks,\n\n\n> Travis\n\n\nHi Travis,\n\nI rebased the patch (together with Stepan Starosta) and actually we decided to simplify the FiniteEnumeratedSet (the new version was slower). Everything should apply and work on 5.5.rc0.\n\nBest,\nVincent",
    "created_at": "2012-11-30T16:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103908",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>
Replying to [tscrim](#comment%3A7):
> Hey Vincent,
>    The patch needs rebasing to 5.5.rc0. Once you upload the rebase, I'll review the patch.
> 
> I think the only merged patch which might have caused the conflict is #13677.
> 
> Thanks,


> Travis


Hi Travis,

I rebased the patch (together with Stepan Starosta) and actually we decided to simplify the FiniteEnumeratedSet (the new version was slower). Everything should apply and work on 5.5.rc0.

Best,
Vincent



---

archive/issue_comments_103909.json:
```json
{
    "body": "Changing author from \"\" to \"Vincent Delecroix, Stepan Starosta\"",
    "created_at": "2012-11-30T16:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103909",
    "user": "https://github.com/videlec"
}
```

Changing author from "" to "Vincent Delecroix, Stepan Starosta"



---

archive/issue_comments_103910.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2012-12-02T08:10:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103910",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_103911.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2012-12-02T08:10:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103911",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_103912.json:
```json
{
    "body": "<a id='comment:9'></a>\nHey Vincent and Stepan,\n\nIn `build_alphabet`, the docstring states that this is an ordered alphabet. I get the following:\n\n```\nsage: A = Alphabet([1,3,7,2])\nsage: A(3) < A(7)     \nTrue\nsage: A(3) < A(2)\nFalse\n```\nI expected the last one to return `True` since I expected these to be letters in `A` and the comparison to take place in there (not default back to their natural ordering). I also get this:\n\n```\nsage: B = Alphabet(['a', 'b'])\nsage: B('a')\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: Cannot convert str to sage.structure.element.Element\n```\nand both problems are because the alphabet does not have any element class. These problems were worse before this patch, but I was wondering if you wanted to take care of these here?\n\n`Words` still does proper comparison:\n\n```\nsage: W = Words(A); W\nWords over {1, 3, 7, 2}\nsage: W([2,1]) < W([2,2])\nTrue\nsage: W([2,3]) < W([2,2])\nTrue\nsage: W([2,2]) < W([2,7])\nFalse\n```\n\nAdditionally on `is_endomorphism()` (line 1111 in `morphism.py`), it was changed to test equality of the domain and codomain. What was the reasoning for this?\n\nThis applied cleanly for me on `5.5.rc0`, I'm curious as to why the patchbot defaulted back to `5.4.rc3`...\n\nThanks for you work on this,\n\nTravis",
    "created_at": "2012-12-02T08:10:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103912",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>
Hey Vincent and Stepan,

In `build_alphabet`, the docstring states that this is an ordered alphabet. I get the following:

```
sage: A = Alphabet([1,3,7,2])
sage: A(3) < A(7)     
True
sage: A(3) < A(2)
False
```
I expected the last one to return `True` since I expected these to be letters in `A` and the comparison to take place in there (not default back to their natural ordering). I also get this:

```
sage: B = Alphabet(['a', 'b'])
sage: B('a')
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: Cannot convert str to sage.structure.element.Element
```
and both problems are because the alphabet does not have any element class. These problems were worse before this patch, but I was wondering if you wanted to take care of these here?

`Words` still does proper comparison:

```
sage: W = Words(A); W
Words over {1, 3, 7, 2}
sage: W([2,1]) < W([2,2])
True
sage: W([2,3]) < W([2,2])
True
sage: W([2,2]) < W([2,7])
False
```

Additionally on `is_endomorphism()` (line 1111 in `morphism.py`), it was changed to test equality of the domain and codomain. What was the reasoning for this?

This applied cleanly for me on `5.5.rc0`, I'm curious as to why the patchbot defaulted back to `5.4.rc3`...

Thanks for you work on this,

Travis



---

archive/issue_comments_103913.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#13801\"",
    "created_at": "2012-12-05T16:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103913",
    "user": "https://github.com/staroste"
}
```

Changing dependencies from "" to "#13801"



---

archive/issue_comments_103914.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-12-05T17:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103914",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_103915.json:
```json
{
    "body": "<a id='comment:11'></a>\nHi Travis,\n\nthanks for reviewing the patch and your comments! I uploaded a new version with two major changes\n* a new class TotallyOrderedFiniteSet\n* a dependency on #13801\n\nAll problems are similar to the ones there are currently with Nathann and posets (#13747) : to be or not to be a facade, that is the question. One major difference with the previous patch is that we provide a class TotallyOrderedFiniteSet which has a facade option behavior and may choose the behavior you prefer.\n\n**How do facades behave**\n\nFacade are the default behavior for alphabets. The disadvantage of having a facade is that the elements need to have their order implemented, i.e., we get\n\n```\nsage: A = TotallyOrderedFiniteSet([0,2,1], facade=True)\nsage: A(2) < A(1) \nFalse\n```\nAnother disadvantage of having a facade is that if some elements do not inherit from Element, the constructor raises an error\n\n```\nsage: B = TotallyOrderedFiniteSet(['a','b',3],facade=True)\nsage: B('a')\nTraceback (most recent call last):\n...\nTypeError: Cannot convert str to sage.structure.element.Element\n```\n\n**Not using facade ?**\n\nThe possible workaround for the two above problems is to have a dedicated element class for TotallyOrderedFiniteSet. If the option facade is set to False, it is what you get\n\n```\nsage: C = TotallyOrderedFiniteSet([1, 'a', -4], facade = False)\nsage: C(1) < C(-4)\nTrue\nsage: C('a')\n'a'\n```\n... but\n\n```\nsage: 1 in C\nFalse\nsage: 1 == C(1)\nFalse\nsage: C(1) == 1\nTrue\n```\n\n**Partial conclusion**\n\n we do prefer having facade = True as a default behavior (as Nathann does).\n\n**About endomorphisms**\n\nTwo reason to change is_endomorphism() are: \n  1) the operator <= is not defined on sets\n  2) the test was mathematically inaccurate : an endomorphism is a morphism for which domain = codomain (and not just a subset of codomain)\n\nThanks,\nStepan and Vincent",
    "created_at": "2012-12-05T17:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103915",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>
Hi Travis,

thanks for reviewing the patch and your comments! I uploaded a new version with two major changes
* a new class TotallyOrderedFiniteSet
* a dependency on #13801

All problems are similar to the ones there are currently with Nathann and posets (#13747) : to be or not to be a facade, that is the question. One major difference with the previous patch is that we provide a class TotallyOrderedFiniteSet which has a facade option behavior and may choose the behavior you prefer.

**How do facades behave**

Facade are the default behavior for alphabets. The disadvantage of having a facade is that the elements need to have their order implemented, i.e., we get

```
sage: A = TotallyOrderedFiniteSet([0,2,1], facade=True)
sage: A(2) < A(1) 
False
```
Another disadvantage of having a facade is that if some elements do not inherit from Element, the constructor raises an error

```
sage: B = TotallyOrderedFiniteSet(['a','b',3],facade=True)
sage: B('a')
Traceback (most recent call last):
...
TypeError: Cannot convert str to sage.structure.element.Element
```

**Not using facade ?**

The possible workaround for the two above problems is to have a dedicated element class for TotallyOrderedFiniteSet. If the option facade is set to False, it is what you get

```
sage: C = TotallyOrderedFiniteSet([1, 'a', -4], facade = False)
sage: C(1) < C(-4)
True
sage: C('a')
'a'
```
... but

```
sage: 1 in C
False
sage: 1 == C(1)
False
sage: C(1) == 1
True
```

**Partial conclusion**

 we do prefer having facade = True as a default behavior (as Nathann does).

**About endomorphisms**

Two reason to change is_endomorphism() are: 
  1) the operator <= is not defined on sets
  2) the test was mathematically inaccurate : an endomorphism is a morphism for which domain = codomain (and not just a subset of codomain)

Thanks,
Stepan and Vincent



---

archive/issue_comments_103916.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [vdelecroix](#comment%3A11):\n> Another disadvantage of having a facade is that if some elements do not inherit from Element, the constructor raises an error\n> \n> ```\n> sage: B = TotallyOrderedFiniteSet(['a','b',3],facade=True)\n> sage: B('a')\n> Traceback (most recent call last):\n> ...\n> TypeError: Cannot convert str to sage.structure.element.Element\n> ```\n\n\nYeah, we hit the same problem in Poset, and we worked around it by\nhaving a custom __call__ function. At some point, we should really fix\nit once for all in Parent.__call__.\n\nCheers,\n                              Nicolas",
    "created_at": "2012-12-06T09:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103916",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:12'></a>
Replying to [vdelecroix](#comment%3A11):
> Another disadvantage of having a facade is that if some elements do not inherit from Element, the constructor raises an error
> 
> ```
> sage: B = TotallyOrderedFiniteSet(['a','b',3],facade=True)
> sage: B('a')
> Traceback (most recent call last):
> ...
> TypeError: Cannot convert str to sage.structure.element.Element
> ```


Yeah, we hit the same problem in Poset, and we worked around it by
having a custom __call__ function. At some point, we should really fix
it once for all in Parent.__call__.

Cheers,
                              Nicolas



---

archive/issue_comments_103917.json:
```json
{
    "body": "<a id='comment:13'></a>\nHey Stepan and Vincent,\n\nFew more things:\n\n- I get the same doctest failures as the patchbot; you just need to change the tests' output in `finite_word.py`.\n\n- Would it be possible to just have `Alphabet()` (thus removing/renaming the `build_alphabet()`)?\n\n- Could you issue a deprecation warning for `OrderedAlphabet`?\n\n- The `__new__()` function for `OrderedAlphabet` needs a doctest.\n\n- I would recommend for the documentation of `OrderedAlphabet_backward_compatibility`:\n\n```\nVersions prior to :trac:`8920` uses the ``Alphabet`` classes with an\nargument ``._alphabet()`` instead of ``._elements()`` used in\n:class:`TotallyOrderedFiniteSet`. This class is dedicated to handling this\nproblem which occurs when unpickling :class:`OrderedAlphabet`.\n```\n\n- The operator `<=` for `Alphabet` and `Words` did not behave as I expected:\n\n```\n# Before\nsage: Alphabet('abc') <= Alphabet('12')\nFalse\nsage: Alphabet('abc') >= Alphabet('12')\nFalse\nsage: Alphabet('abcdef') <= Alphabet('12')\nFalse\nsage: Words('a') <= Words('123')           \nFalse\nsage: Words('abcdef') <= Words('123')\nFalse\nsage: Words('abcdef') >= Words('123')\nFalse\n\n# With the patch\nsage: Alphabet('abc') <= Alphabet('12')\nTrue\nsage: Alphabet('abc') >= Alphabet('12')\nFalse\nsage: Alphabet('abcdef') <= Alphabet('12')\nTrue\nsage: Words('a') <= Words('123')     \nTrue\nsage: Words('abcdef') <= Words('123')\nFalse\nsage: Words('abcdef') >= Words('123')\nTrue\n```\n\n- I'm still uncomfortable with the change to `is_endomorphism()` since I would (naively) expect the map `a->a, b->aa, c->aaa` be an endomorphism. The problem is word morphism automatically sets the codomain based on the image. As for the mathematics, yes, if it is a proper subset, it is not an endomorphism, but it naturally extends to one. I believe that having anything that is naturally extendable to an endomorphism should be considered an endomorphism by sage via the coercion model. Also in case you're worried, the above morphism worked with composition.\n\n  If a third party agrees with the changes in the patch, then I would add a warning to `is_endomorphism()` and/or to `WordMorphism` about defining endomorphisms and add the tests\n\n```\nsage: w = WordMorphism('a->a,b->aa,c->aaa', codomain=Words('abc'))\nsage: w.is_endomorphism()\nTrue\nsage: w2 = WordMorphism('a->a,b->aa,c->aaa')                      \nsage: w == w2\nFalse\n```\n  However there is one problem with this, and that is `w == w2` returns `True`. Thus the equality operator will need to be changed to reflect the dependency on the codomain.\n\nThank you,\n\nTravis",
    "created_at": "2012-12-12T20:04:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103917",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>
Hey Stepan and Vincent,

Few more things:

- I get the same doctest failures as the patchbot; you just need to change the tests' output in `finite_word.py`.

- Would it be possible to just have `Alphabet()` (thus removing/renaming the `build_alphabet()`)?

- Could you issue a deprecation warning for `OrderedAlphabet`?

- The `__new__()` function for `OrderedAlphabet` needs a doctest.

- I would recommend for the documentation of `OrderedAlphabet_backward_compatibility`:

```
Versions prior to :trac:`8920` uses the ``Alphabet`` classes with an
argument ``._alphabet()`` instead of ``._elements()`` used in
:class:`TotallyOrderedFiniteSet`. This class is dedicated to handling this
problem which occurs when unpickling :class:`OrderedAlphabet`.
```

- The operator `<=` for `Alphabet` and `Words` did not behave as I expected:

```
# Before
sage: Alphabet('abc') <= Alphabet('12')
False
sage: Alphabet('abc') >= Alphabet('12')
False
sage: Alphabet('abcdef') <= Alphabet('12')
False
sage: Words('a') <= Words('123')           
False
sage: Words('abcdef') <= Words('123')
False
sage: Words('abcdef') >= Words('123')
False

# With the patch
sage: Alphabet('abc') <= Alphabet('12')
True
sage: Alphabet('abc') >= Alphabet('12')
False
sage: Alphabet('abcdef') <= Alphabet('12')
True
sage: Words('a') <= Words('123')     
True
sage: Words('abcdef') <= Words('123')
False
sage: Words('abcdef') >= Words('123')
True
```

- I'm still uncomfortable with the change to `is_endomorphism()` since I would (naively) expect the map `a->a, b->aa, c->aaa` be an endomorphism. The problem is word morphism automatically sets the codomain based on the image. As for the mathematics, yes, if it is a proper subset, it is not an endomorphism, but it naturally extends to one. I believe that having anything that is naturally extendable to an endomorphism should be considered an endomorphism by sage via the coercion model. Also in case you're worried, the above morphism worked with composition.

  If a third party agrees with the changes in the patch, then I would add a warning to `is_endomorphism()` and/or to `WordMorphism` about defining endomorphisms and add the tests

```
sage: w = WordMorphism('a->a,b->aa,c->aaa', codomain=Words('abc'))
sage: w.is_endomorphism()
True
sage: w2 = WordMorphism('a->a,b->aa,c->aaa')                      
sage: w == w2
False
```
  However there is one problem with this, and that is `w == w2` returns `True`. Thus the equality operator will need to be changed to reflect the dependency on the codomain.

Thank you,

Travis



---

archive/issue_comments_103918.json:
```json
{
    "body": "<a id='comment:14'></a>\nHey Stepan and Vincent,\n\nReplying to [tscrim](#comment%3A13):\n> - I'm still uncomfortable with the change to `is_endomorphism()` since I would (naively) expect the map `a->a, b->aa, c->aaa` be an endomorphism. The problem is word morphism automatically sets the codomain based on the image. As for the mathematics, yes, if it is a proper subset, it is not an endomorphism, but it naturally extends to one. I believe that having anything that is naturally extendable to an endomorphism should be considered an endomorphism by sage via the coercion model. Also in case you're worried, the above morphism worked with composition.\n> \n>   If a third party agrees with the changes in the patch, then I would add a warning to `is_endomorphism()` and/or to `WordMorphism` about defining endomorphisms and add the tests\n> \n> ```\n> sage: w = WordMorphism('a->a,b->aa,c->aaa', codomain=Words('abc'))\n> sage: w.is_endomorphism()\n> True\n> sage: w2 = WordMorphism('a->a,b->aa,c->aaa')                      \n> sage: w == w2\n> False\n> ```\n>   However there is one problem with this, and that is `w == w2` returns `True`. Thus the equality operator will need to be changed to reflect the dependency on the codomain.\n\n\nI talked with Nicolas about this, and he agreed with the changes in your patch, but also said we needed to change the `==` operator to check the codomain (in particular, we don't want a map `f` to be surjective and `g` to not be and compare equal because `g` has a larger codomain). This might be a more general problem, and I'll take a look at it today and let you know what I find.\n\nBest,\n\nTravis",
    "created_at": "2013-02-01T12:42:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103918",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>
Hey Stepan and Vincent,

Replying to [tscrim](#comment%3A13):
> - I'm still uncomfortable with the change to `is_endomorphism()` since I would (naively) expect the map `a->a, b->aa, c->aaa` be an endomorphism. The problem is word morphism automatically sets the codomain based on the image. As for the mathematics, yes, if it is a proper subset, it is not an endomorphism, but it naturally extends to one. I believe that having anything that is naturally extendable to an endomorphism should be considered an endomorphism by sage via the coercion model. Also in case you're worried, the above morphism worked with composition.
> 
>   If a third party agrees with the changes in the patch, then I would add a warning to `is_endomorphism()` and/or to `WordMorphism` about defining endomorphisms and add the tests
> 
> ```
> sage: w = WordMorphism('a->a,b->aa,c->aaa', codomain=Words('abc'))
> sage: w.is_endomorphism()
> True
> sage: w2 = WordMorphism('a->a,b->aa,c->aaa')                      
> sage: w == w2
> False
> ```
>   However there is one problem with this, and that is `w == w2` returns `True`. Thus the equality operator will need to be changed to reflect the dependency on the codomain.


I talked with Nicolas about this, and he agreed with the changes in your patch, but also said we needed to change the `==` operator to check the codomain (in particular, we don't want a map `f` to be surjective and `g` to not be and compare equal because `g` has a larger codomain). This might be a more general problem, and I'll take a look at it today and let you know what I find.

Best,

Travis



---

archive/issue_comments_103919.json:
```json
{
    "body": "<a id='comment:15'></a>\nI've attached my review patch which address my comments and the doctests. The set comparisons in [comment:14] are a more general issue for another ticket. If you agree with my changes, you can set this to positive review.\n\nBest,\n\nTravis",
    "created_at": "2013-02-13T16:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103919",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>
I've attached my review patch which address my comments and the doctests. The set comparisons in [comment:14] are a more general issue for another ticket. If you agree with my changes, you can set this to positive review.

Best,

Travis



---

archive/issue_comments_103920.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Delete the different classes for alphabets (in sage.combinat.words.alphabet) and use the code of sets, enumerated sets and ordered sets. The classes sage.sets.FiniteEnumeratedSet and sage.sets.IntegerRange are slightly modified by the patch.\n+Create a class `TotallyOrderedFiniteSet` in sage.sets. Delete the different classes for alphabets (in sage.combinat.words.alphabet) and use the one in Sage (included the freshly created `TotallyOrderedFiniteSet`).\n``````\n",
    "created_at": "2013-02-13T23:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103920",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Delete the different classes for alphabets (in sage.combinat.words.alphabet) and use the code of sets, enumerated sets and ordered sets. The classes sage.sets.FiniteEnumeratedSet and sage.sets.IntegerRange are slightly modified by the patch.
+Create a class `TotallyOrderedFiniteSet` in sage.sets. Delete the different classes for alphabets (in sage.combinat.words.alphabet) and use the one in Sage (included the freshly created `TotallyOrderedFiniteSet`).
``````




---

archive/issue_comments_103921.json:
```json
{
    "body": "<a id='comment:17'></a>\nI modified the comparison of elements of `TotallyOrderedFiniteSet` to make it more coherent.",
    "created_at": "2013-02-14T00:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103921",
    "user": "https://github.com/videlec"
}
```

<a id='comment:17'></a>
I modified the comparison of elements of `TotallyOrderedFiniteSet` to make it more coherent.



---

archive/issue_comments_103922.json:
```json
{
    "body": "<a id='comment:18'></a>\nI added link in the documentation and double quotes where it is needed.",
    "created_at": "2013-02-15T21:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103922",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'></a>
I added link in the documentation and double quotes where it is needed.



---

archive/issue_comments_103923.json:
```json
{
    "body": "Changing keywords from \"Words, Sets, Cernay2012\" to \"Words, Sets, Cernay2012, days45\".",
    "created_at": "2013-02-15T21:34:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103923",
    "user": "https://github.com/tscrim"
}
```

Changing keywords from "Words, Sets, Cernay2012" to "Words, Sets, Cernay2012, days45".



---

archive/issue_comments_103924.json:
```json
{
    "body": "<a id='comment:19'></a>\nLooks good to me now. Thank you.\n\nTravis",
    "created_at": "2013-02-15T21:34:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103924",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>
Looks good to me now. Thank you.

Travis



---

archive/issue_comments_103925.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-02-15T21:34:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103925",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_026837.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-16T11:30:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "milestone": "sage-5.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8920#event-26837"
}
```



---

archive/issue_comments_103926.json:
```json
{
    "body": "<a id='comment:21'></a>\nThis needs to be rebased to #6495 and also this fuzz needs to be fixed:\n\n```\napplying /release/merger/patches/trac_8920-alphabet.patch\nunable to find 'doc/en/reference/structure.rst' for patching\n1 out of 1 hunks FAILED -- saving rejects to file doc/en/reference/structure.rst.rej\npatching file sage/combinat/words/morphism.py\nHunk #1 succeeded at 12 with fuzz 2 (offset 0 lines).\n```",
    "created_at": "2013-02-19T11:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103926",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
This needs to be rebased to #6495 and also this fuzz needs to be fixed:

```
applying /release/merger/patches/trac_8920-alphabet.patch
unable to find 'doc/en/reference/structure.rst' for patching
1 out of 1 hunks FAILED -- saving rejects to file doc/en/reference/structure.rst.rej
patching file sage/combinat/words/morphism.py
Hunk #1 succeeded at 12 with fuzz 2 (offset 0 lines).
```



---

archive/issue_comments_103927.json:
```json
{
    "body": "Changing dependencies from \"#13801\" to \"#13801, #6495\"",
    "created_at": "2013-02-19T11:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103927",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#13801" to "#13801, #6495"



---

archive/issue_comments_103928.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-02-19T11:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103928",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_103929.json:
```json
{
    "body": "<a id='comment:22'></a>\nI rebased the patch for #6495.\n\nVincnet",
    "created_at": "2013-02-19T12:29:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103929",
    "user": "https://github.com/videlec"
}
```

<a id='comment:22'></a>
I rebased the patch for #6495.

Vincnet



---

archive/issue_comments_103930.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-02-19T15:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103930",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_103931.json:
```json
{
    "body": "<a id='comment:24'></a>\nOn OS X:\n\n```\nsage -t  --long -force_lib devel/sage/sage/sets/totally_ordered_finite_set.py\n**********************************************************************\nFile \"/Users/dehayebuildbot/build/sage/dehaye/dehaye_full/build/sage-5.8.beta1/devel/sage-main/sage/sets/totally_ordered_finite_set.py\", line 207:\n    sage: A(1) < 1\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n```",
    "created_at": "2013-02-21T13:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103931",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
On OS X:

```
sage -t  --long -force_lib devel/sage/sage/sets/totally_ordered_finite_set.py
**********************************************************************
File "/Users/dehayebuildbot/build/sage/dehaye/dehaye_full/build/sage-5.8.beta1/devel/sage-main/sage/sets/totally_ordered_finite_set.py", line 207:
    sage: A(1) < 1
Expected:
    True
Got:
    False
**********************************************************************
```



---

archive/issue_comments_103932.json:
```json
{
    "body": "<a id='comment:25'></a>\nOn `arando` (Ubuntu 12.04 Linux i686 32-bit):\n\n```\nsage -t  --long -force_lib devel/sage/sage/combinat/words/words.py\n**********************************************************************\nFile \"/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.8.beta1/devel/sage-main/sage/combinat/words/words.py\", line 851:\n    sage: Words('ab') >= Words('abc')\nExpected:\n    False\nGot:\n    True\n**********************************************************************\nFile \"/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.8.beta1/devel/sage-main/sage/combinat/words/words.py\", line 853:\n    sage: Words('abc') >= Words('ab')\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n```",
    "created_at": "2013-02-21T13:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103932",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
On `arando` (Ubuntu 12.04 Linux i686 32-bit):

```
sage -t  --long -force_lib devel/sage/sage/combinat/words/words.py
**********************************************************************
File "/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.8.beta1/devel/sage-main/sage/combinat/words/words.py", line 851:
    sage: Words('ab') >= Words('abc')
Expected:
    False
Got:
    True
**********************************************************************
File "/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.8.beta1/devel/sage-main/sage/combinat/words/words.py", line 853:
    sage: Words('abc') >= Words('ab')
Expected:
    True
Got:
    False
**********************************************************************
```



---

archive/issue_comments_103933.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-02-21T13:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103933",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_103934.json:
```json
{
    "body": "Attachment [trac_8920-alphabet.patch](tarball://root/attachments/some-uuid/ticket8920/trac_8920-alphabet.patch) by @videlec created at 2013-02-21 14:57:57\n\napply only this one (takes care of changes in the review patch)",
    "created_at": "2013-02-21T14:57:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103934",
    "user": "https://github.com/videlec"
}
```

Attachment [trac_8920-alphabet.patch](tarball://root/attachments/some-uuid/ticket8920/trac_8920-alphabet.patch) by @videlec created at 2013-02-21 14:57:57

apply only this one (takes care of changes in the review patch)



---

archive/issue_comments_103935.json:
```json
{
    "body": "<a id='comment:27'></a>\nI do not understand the first failure on OS X but I made a small modification in `TotallyOrderedFiniteSet.__cmp__` and made more careful testing.\n\nFor the issue about comparisons of \"Words\", I just removed all related methods as they were needed nowhere and rely on comparison of alphabets which is not possible anymore.\n\nVincent",
    "created_at": "2013-02-21T15:00:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103935",
    "user": "https://github.com/videlec"
}
```

<a id='comment:27'></a>
I do not understand the first failure on OS X but I made a small modification in `TotallyOrderedFiniteSet.__cmp__` and made more careful testing.

For the issue about comparisons of "Words", I just removed all related methods as they were needed nowhere and rely on comparison of alphabets which is not possible anymore.

Vincent



---

archive/issue_comments_103936.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-02-21T15:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103936",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_103937.json:
```json
{
    "body": "<a id='comment:29'></a>\nThe long tests pass for me now. I'll try harder to remember to (re)run the long tests in the future.",
    "created_at": "2013-02-26T16:23:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103937",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:29'></a>
The long tests pass for me now. I'll try harder to remember to (re)run the long tests in the future.



---

archive/issue_comments_103938.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-02-26T16:23:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103938",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_103939.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-02-28T10:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103939",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_103940.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.8.beta2\"",
    "created_at": "2013-02-28T10:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103940",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.8.beta2"



---

archive/issue_events_026838.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-28T10:30:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8920#event-26838"
}
```



---

archive/issue_comments_103941.json:
```json
{
    "body": "<a id='comment:31'></a>\nAdvice for the future: don't make needless whitespace changes, like you did here in `morphism.py`. This causes a conflict with #12230 for no good reason.",
    "created_at": "2013-04-05T14:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103941",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'></a>
Advice for the future: don't make needless whitespace changes, like you did here in `morphism.py`. This causes a conflict with #12230 for no good reason.



---

archive/issue_comments_103942.json:
```json
{
    "body": "Changing author from \"Vincent Delecroix, Stepan Starosta\" to \"Vincent Delecroix, \u0160t\u011bp\u00e1n Starosta\"",
    "created_at": "2016-10-31T17:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8920#issuecomment-103942",
    "user": "https://github.com/fchapoton"
}
```

Changing author from "Vincent Delecroix, Stepan Starosta" to "Vincent Delecroix, Štěpán Starosta"
