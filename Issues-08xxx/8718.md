# Issue 8718: Polynomial.apply_map()

archive/issues_008718.json:
```json
{
    "body": "Computing, for instance, the complex conjugate of a polynomial currently requires going through its list or dictionary representation. Polynomials could provide a method similar to Matrix.apply_map() to make this kind of computations easier.\n\n---\n\nApply\n\n1. [attachment:trac_8718.patch]\n2. [attachment:trac_8718_codomain.patch]\n3. [attachment:trac_8718_multivariate_codomain.patch]\n\nto the sage repository.\n\nAssignee: @aghitza\n\nCC:  @dkrenn\n\nKeywords: polynomial, map\n\nResolution: fixed\n\nDependencies: #11981\n\nAuthor: Marc Mezzarobba, Julian Rueth\n\nReviewer: Daniel Krenn\n\nMerged: sage-5.0.beta6\n\nIssue created by migration from https://trac.sagemath.org/ticket/8718\n\n",
    "closed_at": "2012-02-27T11:19:40Z",
    "created_at": "2010-04-19T20:15:46Z",
    "labels": [
        "component: algebra",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Polynomial.apply_map()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8718",
    "user": "https://github.com/mezzarobba"
}
```
Computing, for instance, the complex conjugate of a polynomial currently requires going through its list or dictionary representation. Polynomials could provide a method similar to Matrix.apply_map() to make this kind of computations easier.

---

Apply

1. [attachment:trac_8718.patch]
2. [attachment:trac_8718_codomain.patch]
3. [attachment:trac_8718_multivariate_codomain.patch]

to the sage repository.

Assignee: @aghitza

CC:  @dkrenn

Keywords: polynomial, map

Resolution: fixed

Dependencies: #11981

Author: Marc Mezzarobba, Julian Rueth

Reviewer: Daniel Krenn

Merged: sage-5.0.beta6

Issue created by migration from https://trac.sagemath.org/ticket/8718





---

archive/issue_comments_082517.json:
```json
{
    "body": "Attachment [trac_8718_map_over_polynomial.patch](tarball://root/attachments/some-uuid/ticket8718/trac_8718_map_over_polynomial.patch) by @mezzarobba created at 2010-05-17 19:50:52",
    "created_at": "2010-05-17T19:50:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82517",
    "user": "https://github.com/mezzarobba"
}
```

Attachment [trac_8718_map_over_polynomial.patch](tarball://root/attachments/some-uuid/ticket8718/trac_8718_map_over_polynomial.patch) by @mezzarobba created at 2010-05-17 19:50:52



---

archive/issue_comments_082518.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-05-17T19:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82518",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_082519.json:
```json
{
    "body": "<a id='comment:1'></a>The attached patch adds naive implementations of apply_map() and of a second similar method, map_coefficients(), modeled after that of multivariate polynomials.\n\nNote that I have as good as no experience with Python or Sage development\u2014so sorry for any newbie errors... and please review carefully! :-)",
    "created_at": "2010-05-17T19:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82519",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:1'></a>The attached patch adds naive implementations of apply_map() and of a second similar method, map_coefficients(), modeled after that of multivariate polynomials.

Note that I have as good as no experience with Python or Sage developmentâ€”so sorry for any newbie errors... and please review carefully! :-)



---

archive/issue_comments_082520.json:
```json
{
    "body": "<a id='comment:2'></a>One suggestion---the names of the new functions do not seem to indicate to me that they only operate on the nonzero coefficients, so it would be hard for me to remember what the difference between map_coefficients and apply_map is.\n\nHow about just adding an argument to apply_map:\n\np.apply_map(nonzero_only=True)\n\nor something like that?",
    "created_at": "2010-05-18T02:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82520",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:2'></a>One suggestion---the names of the new functions do not seem to indicate to me that they only operate on the nonzero coefficients, so it would be hard for me to remember what the difference between map_coefficients and apply_map is.

How about just adding an argument to apply_map:

p.apply_map(nonzero_only=True)

or something like that?



---

archive/issue_comments_082521.json:
```json
{
    "body": "<a id='comment:3'></a>The idea was to stay compatible with ``MPolynomial.map_coefficients()``, which operates on nonzero coefficients.  Perhaps we could remove ``apply_map()`` rather that ``map_coefficients()``, and add an option to make ``map_coefficients()`` map over zero coefficients too. (Ignoring them by default seems sensible, since (i) there is really no mathematical difference between zeros below and above the leading coefficient, and (ii) the functions one will typically pass to ``map_coefficients()`` are ring homomorphisms.)\n\nWhat do you think?",
    "created_at": "2010-05-18T07:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82521",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:3'></a>The idea was to stay compatible with ``MPolynomial.map_coefficients()``, which operates on nonzero coefficients.  Perhaps we could remove ``apply_map()`` rather that ``map_coefficients()``, and add an option to make ``map_coefficients()`` map over zero coefficients too. (Ignoring them by default seems sensible, since (i) there is really no mathematical difference between zeros below and above the leading coefficient, and (ii) the functions one will typically pass to ``map_coefficients()`` are ring homomorphisms.)

What do you think?



---

archive/issue_comments_082522.json:
```json
{
    "body": "<a id='comment:4'></a>That sounds cleaner to me.  I'm likely not to use this function very much, so I shouldn't be the last authority on it, though.",
    "created_at": "2010-05-18T15:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82522",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:4'></a>That sounds cleaner to me.  I'm likely not to use this function very much, so I shouldn't be the last authority on it, though.



---

archive/issue_comments_082523.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-09-27T17:58:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82523",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_082524.json:
```json
{
    "body": "<a id='comment:5'></a>Any progress here? I agree with Jason's contention that having both `apply_map` and `map_coefficients` is less than ideal, so I suggest that we put this back to \"needs work\" pending a patch that implements this.",
    "created_at": "2010-09-27T17:58:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82524",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:5'></a>Any progress here? I agree with Jason's contention that having both `apply_map` and `map_coefficients` is less than ideal, so I suggest that we put this back to "needs work" pending a patch that implements this.



---

archive/issue_comments_082525.json:
```json
{
    "body": "<a id='comment:6'></a>I would suggest to map only non-zero coefficients because of the following reason: When mapping all (really all) zeros to a non-zero, the result is not a polynomial any more, so one would have to restrict that. But how should this restriction look like? A good restriction strategy (strategy which coefficients to choose and apply the map on) should be generalizable to the multivariate case. E.g. restriction by degree (i.e. only change the coefficients with indizes 0 to degree) could work in the univariate case, but does not work for multivariate polynomials.\n\nIf one really wants to map 0 to a non-zero, then this should be done somewhere else, i.e., not in `map_coefficients`",
    "created_at": "2011-11-02T16:38:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82525",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:6'></a>I would suggest to map only non-zero coefficients because of the following reason: When mapping all (really all) zeros to a non-zero, the result is not a polynomial any more, so one would have to restrict that. But how should this restriction look like? A good restriction strategy (strategy which coefficients to choose and apply the map on) should be generalizable to the multivariate case. E.g. restriction by degree (i.e. only change the coefficients with indizes 0 to degree) could work in the univariate case, but does not work for multivariate polynomials.

If one really wants to map 0 to a non-zero, then this should be done somewhere else, i.e., not in `map_coefficients`



---

archive/issue_events_021164.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2012-02-06T20:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "milestone": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8718#event-21164"
}
```



---

archive/issue_comments_082526.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-02-06T20:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82526",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_082527.json:
```json
{
    "body": "<a id='comment:7'></a>I agree that mapping 0 to non-zero should not be a part of map_coefficients().\n\nI rewrote the patch to only contain map_coefficients() for polynomial elements.\n\nWas there any reason for distinguishing between polynomial_element and polynomial_element_generic? I removed the distinction and it turned out that this implementation is even faster for the example polynomials.",
    "created_at": "2012-02-06T20:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82527",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:7'></a>I agree that mapping 0 to non-zero should not be a part of map_coefficients().

I rewrote the patch to only contain map_coefficients() for polynomial elements.

Was there any reason for distinguishing between polynomial_element and polynomial_element_generic? I removed the distinction and it turned out that this implementation is even faster for the example polynomials.



---

archive/issue_comments_082528.json:
```json
{
    "body": "adds map_coefficients()",
    "created_at": "2012-02-06T20:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82528",
    "user": "https://github.com/saraedum"
}
```

adds map_coefficients()



---

archive/issue_comments_082529.json:
```json
{
    "body": "<a id='comment:8'></a>Attachment [trac_8718.patch](tarball://root/attachments/some-uuid/ticket8718/trac_8718.patch) by @saraedum created at 2012-02-06 20:52:52\n\napply trac_8718.patch",
    "created_at": "2012-02-06T20:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82529",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:8'></a>Attachment [trac_8718.patch](tarball://root/attachments/some-uuid/ticket8718/trac_8718.patch) by @saraedum created at 2012-02-06 20:52:52

apply trac_8718.patch



---

archive/issue_comments_082530.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n Computing, for instance, the complex conjugate of a polynomial currently requires going through its list or dictionary representation. Polynomials could provide a method similar to Matrix.apply_map() to make this kind of computations easier.\n+\n+---\n+\n+Apply\n+\n+1. [attachment:trac_8718.patch]\n+\n+to the sage repository.\n \n Issue created by migration from https://trac.sagemath.org/ticket/8718\n \n``````\n",
    "created_at": "2012-02-06T20:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82530",
    "user": "https://github.com/saraedum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,12 @@
 Computing, for instance, the complex conjugate of a polynomial currently requires going through its list or dictionary representation. Polynomials could provide a method similar to Matrix.apply_map() to make this kind of computations easier.
+
+---
+
+Apply
+
+1. [attachment:trac_8718.patch]
+
+to the sage repository.
 
 Issue created by migration from https://trac.sagemath.org/ticket/8718
 
``````




---

archive/issue_comments_082531.json:
```json
{
    "body": "<a id='comment:9'></a>Thanks for taking care of that! (And shame on me that I didn't!)\n\nAs for the distinction  between polynomial_element and polynomial_element_generic, it may indeed have been a speed issue, but I can't remember the details. Anyway, if the current version does the job, I'm fine with it.\n\n[I'm not sure what the rules are here: am I allowed to review the new version of the patch though being its initial author?]",
    "created_at": "2012-02-07T08:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82531",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:9'></a>Thanks for taking care of that! (And shame on me that I didn't!)

As for the distinction  between polynomial_element and polynomial_element_generic, it may indeed have been a speed issue, but I can't remember the details. Anyway, if the current version does the job, I'm fine with it.

[I'm not sure what the rules are here: am I allowed to review the new version of the patch though being its initial author?]



---

archive/issue_comments_082532.json:
```json
{
    "body": "<a id='comment:10'></a>> [I'm not sure what the rules are here: am I allowed to review the new version of the patch though being its initial author?]\n\n\nYes, in my experience this is ok and actually happens frequently.",
    "created_at": "2012-02-08T18:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82532",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:10'></a>> [I'm not sure what the rules are here: am I allowed to review the new version of the patch though being its initial author?]


Yes, in my experience this is ok and actually happens frequently.



---

archive/issue_comments_082533.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-02-09T11:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82533",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_082534.json:
```json
{
    "body": "<a id='comment:11'></a>In #11981 the map_coefficients of a multivariate polynomial was adapted to change the base ring of the coefficients. I think we should also do this here for this function, since the two should have the same behavior.",
    "created_at": "2012-02-09T11:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82534",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:11'></a>In #11981 the map_coefficients of a multivariate polynomial was adapted to change the base ring of the coefficients. I think we should also do this here for this function, since the two should have the same behavior.



---

archive/issue_comments_082535.json:
```json
{
    "body": "<a id='comment:12'></a>True. I wanted to push this to a later ticket but we can also talk about this here.\n\nI wonder if this \"new base ring\" should default to the codomain of f (if the function is actually a sage 'Map'). For me this has always been what I wanted. Any opinions on that?",
    "created_at": "2012-02-09T11:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82535",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:12'></a>True. I wanted to push this to a later ticket but we can also talk about this here.

I wonder if this "new base ring" should default to the codomain of f (if the function is actually a sage 'Map'). For me this has always been what I wanted. Any opinions on that?



---

archive/issue_comments_082536.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2012-02-09T11:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82536",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_082537.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 saraedum]:\n> I wonder if this \"new base ring\" should default to the codomain of f (if the function is actually a sage 'Map'). For me this has always been what I wanted. Any opinions on that?\n\n\nThat is a good idea, we should implement that. So the strategy would be the following: If a new base ring is given, then we use it, otherwise, we check if the function knowns its codomain and if yes use it, otherwise we do not change the base ring.",
    "created_at": "2012-02-10T12:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82537",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:13'></a>Replying to [comment:12 saraedum]:
> I wonder if this "new base ring" should default to the codomain of f (if the function is actually a sage 'Map'). For me this has always been what I wanted. Any opinions on that?


That is a good idea, we should implement that. So the strategy would be the following: If a new base ring is given, then we use it, otherwise, we check if the function knowns its codomain and if yes use it, otherwise we do not change the base ring.



---

archive/issue_comments_082538.json:
```json
{
    "body": "<a id='comment:14'></a>Ok. I already have that implemented. Just need to add some more doctests and upload it.",
    "created_at": "2012-02-10T14:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82538",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:14'></a>Ok. I already have that implemented. Just need to add some more doctests and upload it.



---

archive/issue_comments_082539.json:
```json
{
    "body": "consider the codomain in map_coefficients for univariate polynomials",
    "created_at": "2012-02-19T17:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82539",
    "user": "https://github.com/saraedum"
}
```

consider the codomain in map_coefficients for univariate polynomials



---

archive/issue_comments_082540.json:
```json
{
    "body": "Attachment [trac_8718_multivariate_codomain.patch](tarball://root/attachments/some-uuid/ticket8718/trac_8718_multivariate_codomain.patch) by @saraedum created at 2012-02-19 17:43:58\n\nconsider the codomain in map_coefficients for multivariate polynomials",
    "created_at": "2012-02-19T17:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82540",
    "user": "https://github.com/saraedum"
}
```

Attachment [trac_8718_multivariate_codomain.patch](tarball://root/attachments/some-uuid/ticket8718/trac_8718_multivariate_codomain.patch) by @saraedum created at 2012-02-19 17:43:58

consider the codomain in map_coefficients for multivariate polynomials



---

archive/issue_comments_082541.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-02-19T17:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82541",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_082542.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,14 @@\n+Computing, for instance, the complex conjugate of a polynomial currently requires going through its list or dictionary representation. Polynomials could provide a method similar to Matrix.apply_map() to make this kind of computations easier.\n \n+---\n+\n+Apply\n+\n+1. [attachment:trac_8718.patch]\n+2. [attachment:trac_8718_codomain.patch]\n+3. [attachment:trac_8718_multivariate_codomain.patch]\n+\n+to the sage repository.\n \n Issue created by migration from https://trac.sagemath.org/ticket/8718\n \n``````\n",
    "created_at": "2012-02-19T17:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82542",
    "user": "https://github.com/saraedum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,14 @@
+Computing, for instance, the complex conjugate of a polynomial currently requires going through its list or dictionary representation. Polynomials could provide a method similar to Matrix.apply_map() to make this kind of computations easier.
 
+---
+
+Apply
+
+1. [attachment:trac_8718.patch]
+2. [attachment:trac_8718_codomain.patch]
+3. [attachment:trac_8718_multivariate_codomain.patch]
+
+to the sage repository.
 
 Issue created by migration from https://trac.sagemath.org/ticket/8718
 
``````




---

archive/issue_comments_082543.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-20T18:51:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82543",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_082544.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-02-27T11:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8718#issuecomment-82544",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_021165.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-27T11:19:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8718",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8718#event-21165"
}
```
