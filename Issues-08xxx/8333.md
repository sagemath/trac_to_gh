# Issue 8333: Finite fields to new coercion model

archive/issues_008333.json:
```json
{
    "assignees": [
        "https://github.com/aghitza"
    ],
    "body": "Moves finite fields to the new coercion model.  Patches have been moved to #8334, so **do not apply the patches** from this ticket.\n\nDepends on #8218, #8332, #7880 and #7883. Prerequisite for #8334, #8335, #9887.\n\nComponent: **algebra**\n\nAuthor: **David Roe**\n\nReviewer: **David Loeffler**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/8333_\n\n",
    "closed_at": "2010-09-28T11:12:28Z",
    "created_at": "2010-02-23T15:07:26Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20algebra",
        "https://github.com/sagemath/sage/labels/duplicate",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Finite fields to new coercion model",
    "type": "issue",
    "updated_at": "2010-09-28T11:12:28Z",
    "url": "https://github.com/sagemath/sage/issues/8333",
    "user": "https://github.com/roed314"
}
```
Moves finite fields to the new coercion model.  Patches have been moved to #8334, so **do not apply the patches** from this ticket.

Depends on #8218, #8332, #7880 and #7883. Prerequisite for #8334, #8335, #9887.

Component: **algebra**

Author: **David Roe**

Reviewer: **David Loeffler**

_Issue created by migration from https://trac.sagemath.org/ticket/8333_





---

archive/issue_events_104098.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-02-23T15:07:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "milestone_number": null,
    "milestone_title": "sage-4.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104098"
}
```



---

archive/issue_events_104099.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-02-23T15:07:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "c: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104099"
}
```



---

archive/issue_events_104100.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-02-23T15:07:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104100"
}
```



---

archive/issue_events_104101.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-02-23T15:07:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104101"
}
```



---

archive/issue_events_104102.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2010-02-23T15:07:26Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "subject": "https://github.com/roed314",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104102"
}
```



---

archive/issue_comments_065340.json:
```json
{
    "body": "Attachment: **[8333_parent_init.patch.gz](https://github.com/sagemath/sage/files/ticket8333/8333_parent_init.patch.gz)**",
    "created_at": "2010-02-23T15:10:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65340",
    "user": "https://github.com/roed314"
}
```

Attachment: **[8333_parent_init.patch.gz](https://github.com/sagemath/sage/files/ticket8333/8333_parent_init.patch.gz)**



---

archive/issue_comments_065341.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[8333_finite_fields_to_new_coercion.patch.gz](https://github.com/sagemath/sage/files/ticket8333/8333_finite_fields_to_new_coercion.patch.gz)**\n\nThe two patches can be applied in either order.",
    "created_at": "2010-02-23T17:37:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65341",
    "user": "https://github.com/roed314"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[8333_finite_fields_to_new_coercion.patch.gz](https://github.com/sagemath/sage/files/ticket8333/8333_finite_fields_to_new_coercion.patch.gz)**

The two patches can be applied in either order.



---

archive/issue_events_104103.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-02-23T17:37:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104103"
}
```



---

archive/issue_comments_065342.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nPart of a series:\n\n```\n8218 -> 8332 -> 7880 -> 7883 -> 8333 -> 8334 -> 8335\n```\nI tried to make each of these mostly self contained, with doctests passing after every ticket, but I didn't entirely succeed.  If you're reviewing one of these tickets, applying later tickets will hopefully fix doctest failures that you're seeing.",
    "created_at": "2010-02-23T17:37:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65342",
    "user": "https://github.com/roed314"
}
```

<div id="comment:2" align="right">comment:2</div>

Part of a series:

```
8218 -> 8332 -> 7880 -> 7883 -> 8333 -> 8334 -> 8335
```
I tried to make each of these mostly self contained, with doctests passing after every ticket, but I didn't entirely succeed.  If you're reviewing one of these tickets, applying later tickets will hopefully fix doctest failures that you're seeing.



---

archive/issue_comments_065343.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n Moves finite fields to the new coercion model.\n+\n+Depends on 8218, 8332 and probably 7880 and 7883.\n``````\n",
    "created_at": "2010-02-23T17:41:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65343",
    "user": "https://github.com/roed314"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 Moves finite fields to the new coercion model.
+
+Depends on 8218, 8332 and probably 7880 and 7883.
``````




---

archive/issue_comments_065344.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nSome strange things going on here. I installed the patches on 4.3.4.rc0 with the preceding patches in the series applied. \n\n(1) It builds fine, but Sage won't start because the patched `finite_field_prime_modn.py` contains the line\n\n```\nfrom sage.rings.integer_mod_ring import IntegerModRing_generic\n```\nand that file has been removed by #8218.\n\n(2) There is also a problem in `element_ext_pari.py` caused by the line\n\n```\nelif isinstance(value, FreeModuleElement):\n```\nbeing used without FreeModuleElement being imported first. \n\n(3) Next up, there's another issue in `element_ntl_gf2e` caused by trying to import `is_FiniteField` from the wrong place. \n\n(4) I'm getting a bunch of identical errors relating to the Singular library -- it says \n\n```\n File \"/home/masiao/sage-4.3.4.rc0/local/lib/python/site-packages/sage/interfaces/singular.py\", line 672, in has_coerce_map_from_impl\n        raise NotImplementedError\n```\n\n(5) Something weird is going on in sage/modular/dirichlet.py which causes an infinite recursion error when reducing an element of a number field modulo a prime; this may well be dealt with by #8334, I haven't checked. Same in three places in sage/schemes/elliptic_curves/ell_point.py and a bunch of other elliptic curves modules, and in sage/rings/residue_field.py\n\n(6) The patch changes a whole load of doctests in sage/libs/flint/zmod_poly_linkage for no apparent reason, and thus causes them to fail. (Are you running a newer FLINT version on your development machine?)\n\n(7)  Various errors in the rings/finite_rings directory, e.g. this one: \n\n```\nFile \"/home/masiao/sage-4.3.4.rc0/local/lib/python/site-packages/sage/rings/finite_rings/finite_field_ext_pari.py\", line 580, in _coerce_map_from_\n        elif self.degree() % K.degree() == 0:\n    NameError: global name 'K' is not defined\n```\n\n\nMost of these are trivial, but (4) is beyond my ability to fix. I'm sorry, but that's definitely a \"needs work\".",
    "created_at": "2010-03-18T16:44:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65344",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:4" align="right">comment:4</div>

Some strange things going on here. I installed the patches on 4.3.4.rc0 with the preceding patches in the series applied. 

(1) It builds fine, but Sage won't start because the patched `finite_field_prime_modn.py` contains the line

```
from sage.rings.integer_mod_ring import IntegerModRing_generic
```
and that file has been removed by #8218.

(2) There is also a problem in `element_ext_pari.py` caused by the line

```
elif isinstance(value, FreeModuleElement):
```
being used without FreeModuleElement being imported first. 

(3) Next up, there's another issue in `element_ntl_gf2e` caused by trying to import `is_FiniteField` from the wrong place. 

(4) I'm getting a bunch of identical errors relating to the Singular library -- it says 

```
 File "/home/masiao/sage-4.3.4.rc0/local/lib/python/site-packages/sage/interfaces/singular.py", line 672, in has_coerce_map_from_impl
        raise NotImplementedError
```

(5) Something weird is going on in sage/modular/dirichlet.py which causes an infinite recursion error when reducing an element of a number field modulo a prime; this may well be dealt with by #8334, I haven't checked. Same in three places in sage/schemes/elliptic_curves/ell_point.py and a bunch of other elliptic curves modules, and in sage/rings/residue_field.py

(6) The patch changes a whole load of doctests in sage/libs/flint/zmod_poly_linkage for no apparent reason, and thus causes them to fail. (Are you running a newer FLINT version on your development machine?)

(7)  Various errors in the rings/finite_rings directory, e.g. this one: 

```
File "/home/masiao/sage-4.3.4.rc0/local/lib/python/site-packages/sage/rings/finite_rings/finite_field_ext_pari.py", line 580, in _coerce_map_from_
        elif self.degree() % K.degree() == 0:
    NameError: global name 'K' is not defined
```


Most of these are trivial, but (4) is beyond my ability to fix. I'm sorry, but that's definitely a "needs work".



---

archive/issue_events_104104.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2010-03-18T16:44:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104104"
}
```



---

archive/issue_events_104105.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2010-03-18T16:44:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104105"
}
```



---

archive/issue_comments_065345.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAh, I see what's going on. Most of these are fixed by the patch `7585_12_1_fixes.patch` at #8334. But that is dependent on #7883, which needs some substantial work.\n\nDavid, I suggest you do one of the following things:\n\n- Fix #7883 as robertwb and I have suggested; once that has a positive review then we can go on and review this ticket and #8334 together.\n\n- Back-port the fixes from #8334 that belong here, and then I will happily review it independently of #7883 and #8334.\n\nDavid",
    "created_at": "2010-03-18T16:56:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65345",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:5" align="right">comment:5</div>

Ah, I see what's going on. Most of these are fixed by the patch `7585_12_1_fixes.patch` at #8334. But that is dependent on #7883, which needs some substantial work.

David, I suggest you do one of the following things:

- Fix #7883 as robertwb and I have suggested; once that has a positive review then we can go on and review this ticket and #8334 together.

- Back-port the fixes from #8334 that belong here, and then I will happily review it independently of #7883 and #8334.

David



---

archive/issue_events_104106.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-09-19T13:21:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104106"
}
```



---

archive/issue_events_104107.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-09-19T13:21:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104107"
}
```



---

archive/issue_comments_065346.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI've addressed your and Robert's suggestions on #7883 I think.  Apply these two patches after the patches at #7883 and before the patches at #8334.  Doctests won't pass until you apply the patches at #8334.  But all three are ready for review.  Sorry for the delay.",
    "created_at": "2010-09-19T13:21:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65346",
    "user": "https://github.com/roed314"
}
```

<div id="comment:6" align="right">comment:6</div>

I've addressed your and Robert's suggestions on #7883 I think.  Apply these two patches after the patches at #7883 and before the patches at #8334.  Doctests won't pass until you apply the patches at #8334.  But all three are ready for review.  Sorry for the delay.



---

archive/issue_comments_065347.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nroed, which version of sage are you using? I cannot apply 8333_finite_fields_to_new_coercion.patch cleanly to 4.5.3",
    "created_at": "2010-09-19T16:17:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65347",
    "user": "https://github.com/lftabera"
}
```

<div id="comment:7" align="right">comment:7</div>

roed, which version of sage are you using? I cannot apply 8333_finite_fields_to_new_coercion.patch cleanly to 4.5.3



---

archive/issue_comments_065348.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI had been using 4.5.2, but I just upgraded and it still applies cleanly.\n\nDid you apply 8333_parent_init.patch first?",
    "created_at": "2010-09-20T03:38:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65348",
    "user": "https://github.com/roed314"
}
```

<div id="comment:8" align="right">comment:8</div>

I had been using 4.5.2, but I just upgraded and it still applies cleanly.

Did you apply 8333_parent_init.patch first?



---

archive/issue_comments_065349.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAfter applying both patches from #7883 and also 8333_parent_init.patch, I see this in 4.5.3:\n\n```\nsage: hg_sage.import_patch('Downloads/8333_finite_fields_to_new_coercion.patch')\ncd \"/Applications/sage_builds/sage-4.5.3/devel/sage\" && hg status\ncd \"/Applications/sage_builds/sage-4.5.3/devel/sage\" && hg status\ncd \"/Applications/sage_builds/sage-4.5.3/devel/sage\" && hg import   \"/Users/palmieri/Downloads/8333_finite_fields_to_new_coercion.patch\"\napplying /Users/palmieri/Downloads/8333_finite_fields_to_new_coercion.patch\npatching file sage/libs/flint/zmod_poly_linkage.pxi\nHunk #1 FAILED at 455\nHunk #2 FAILED at 470\n2 out of 2 hunks FAILED -- saving rejects to file sage/libs/flint/zmod_poly_linkage.pxi.rej\npatching file sage/rings/finite_rings/finite_field_prime_modn.py\nHunk #1 FAILED at 57\n1 out of 5 hunks FAILED -- saving rejects to file sage/rings/finite_rings/finite_field_prime_modn.py.rej\nabort: patch failed to apply\n```\nIn 4.6.alpha1, I see almost the same message:\n\n```\n\nsage: hg_sage.import_patch('Downloads/8333_finite_fields_to_new_coercion.patch')\ncd \"/Applications/sage/devel/sage\" && hg status\ncd \"/Applications/sage/devel/sage\" && hg status\ncd \"/Applications/sage/devel/sage\" && hg import   \"/Users/palmieri/Downloads/8333_finite_fields_to_new_coercion.patch\"\napplying /Users/palmieri/Downloads/8333_finite_fields_to_new_coercion.patch\npatching file sage/libs/flint/zmod_poly_linkage.pxi\nHunk #1 FAILED at 455\nHunk #2 FAILED at 470\n2 out of 2 hunks FAILED -- saving rejects to file sage/libs/flint/zmod_poly_linkage.pxi.rej\npatching file sage/rings/finite_rings/finite_field_ext_pari.py\nHunk #1 succeeded at 243 with fuzz 2 (offset 6 lines).\npatching file sage/rings/finite_rings/finite_field_prime_modn.py\nHunk #1 FAILED at 57\n1 out of 5 hunks FAILED -- saving rejects to file sage/rings/finite_rings/finite_field_prime_modn.py.rej\nabort: patch failed to apply\n```",
    "created_at": "2010-09-20T05:19:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65349",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:9" align="right">comment:9</div>

After applying both patches from #7883 and also 8333_parent_init.patch, I see this in 4.5.3:

```
sage: hg_sage.import_patch('Downloads/8333_finite_fields_to_new_coercion.patch')
cd "/Applications/sage_builds/sage-4.5.3/devel/sage" && hg status
cd "/Applications/sage_builds/sage-4.5.3/devel/sage" && hg status
cd "/Applications/sage_builds/sage-4.5.3/devel/sage" && hg import   "/Users/palmieri/Downloads/8333_finite_fields_to_new_coercion.patch"
applying /Users/palmieri/Downloads/8333_finite_fields_to_new_coercion.patch
patching file sage/libs/flint/zmod_poly_linkage.pxi
Hunk #1 FAILED at 455
Hunk #2 FAILED at 470
2 out of 2 hunks FAILED -- saving rejects to file sage/libs/flint/zmod_poly_linkage.pxi.rej
patching file sage/rings/finite_rings/finite_field_prime_modn.py
Hunk #1 FAILED at 57
1 out of 5 hunks FAILED -- saving rejects to file sage/rings/finite_rings/finite_field_prime_modn.py.rej
abort: patch failed to apply
```
In 4.6.alpha1, I see almost the same message:

```

sage: hg_sage.import_patch('Downloads/8333_finite_fields_to_new_coercion.patch')
cd "/Applications/sage/devel/sage" && hg status
cd "/Applications/sage/devel/sage" && hg status
cd "/Applications/sage/devel/sage" && hg import   "/Users/palmieri/Downloads/8333_finite_fields_to_new_coercion.patch"
applying /Users/palmieri/Downloads/8333_finite_fields_to_new_coercion.patch
patching file sage/libs/flint/zmod_poly_linkage.pxi
Hunk #1 FAILED at 455
Hunk #2 FAILED at 470
2 out of 2 hunks FAILED -- saving rejects to file sage/libs/flint/zmod_poly_linkage.pxi.rej
patching file sage/rings/finite_rings/finite_field_ext_pari.py
Hunk #1 succeeded at 243 with fuzz 2 (offset 6 lines).
patching file sage/rings/finite_rings/finite_field_prime_modn.py
Hunk #1 FAILED at 57
1 out of 5 hunks FAILED -- saving rejects to file sage/rings/finite_rings/finite_field_prime_modn.py.rej
abort: patch failed to apply
```



---

archive/issue_comments_065350.json:
```json
{
    "body": "Rebased against 4.5.3",
    "created_at": "2010-09-20T05:36:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65350",
    "user": "https://github.com/roed314"
}
```

Rebased against 4.5.3



---

archive/issue_comments_065351.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nAttachment: **[8333_finite_fields_to_new_coercion.2.patch.gz](https://github.com/sagemath/sage/files/ticket8333/8333_finite_fields_to_new_coercion.2.patch.gz)**\n\nOops.  Try this one.",
    "created_at": "2010-09-20T05:37:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65351",
    "user": "https://github.com/roed314"
}
```

<div id="comment:10" align="right">comment:10</div>

Attachment: **[8333_finite_fields_to_new_coercion.2.patch.gz](https://github.com/sagemath/sage/files/ticket8333/8333_finite_fields_to_new_coercion.2.patch.gz)**

Oops.  Try this one.



---

archive/issue_comments_065352.json:
```json
{
    "body": "Work Issues: **Depends on broken #8334**",
    "created_at": "2010-09-23T16:16:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65352",
    "user": "https://github.com/loefflerd"
}
```

Work Issues: **Depends on broken #8334**



---

archive/issue_comments_065353.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI've had a look at this, but with mixed success.\n\nApplying `8333_parent_init.patch` and `8333_finite_fields_to_new_coercion.2.patch` to 4.6.alpha1 on top of the new folded, positively-reviewed patch at #7883, I get one trivial failure (because I backported a hunk of one of these patches to get #7883 to work). This is fine and can happily be ignored. However, it's very broken with just those two patches (Sage won't even start up, because of a broken import statement).\n\nI tried applying all the hunks of `7585_12_1_fixes.2.patch` other than the ones involving residue fields. That almost worked, but not quite: there was still an infinite recursion error occuring in `residue_field.pyx`. \n\nDavid: can you either get this working on its own, or rebase the patches at #8334 so I can review this and #8334 together?",
    "created_at": "2010-09-23T16:16:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65353",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:11" align="right">comment:11</div>

I've had a look at this, but with mixed success.

Applying `8333_parent_init.patch` and `8333_finite_fields_to_new_coercion.2.patch` to 4.6.alpha1 on top of the new folded, positively-reviewed patch at #7883, I get one trivial failure (because I backported a hunk of one of these patches to get #7883 to work). This is fine and can happily be ignored. However, it's very broken with just those two patches (Sage won't even start up, because of a broken import statement).

I tried applying all the hunks of `7585_12_1_fixes.2.patch` other than the ones involving residue fields. That almost worked, but not quite: there was still an infinite recursion error occuring in `residue_field.pyx`. 

David: can you either get this working on its own, or rebase the patches at #8334 so I can review this and #8334 together?



---

archive/issue_events_104108.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2010-09-23T16:16:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104108"
}
```



---

archive/issue_events_104109.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2010-09-23T16:16:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104109"
}
```



---

archive/issue_comments_065354.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI've rebased all the patches against 4.6.alpha1.  Thanks for helping with this!",
    "created_at": "2010-09-23T16:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65354",
    "user": "https://github.com/roed314"
}
```

<div id="comment:12" align="right">comment:12</div>

I've rebased all the patches against 4.6.alpha1.  Thanks for helping with this!



---

archive/issue_events_104110.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-09-23T16:48:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104110"
}
```



---

archive/issue_events_104111.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-09-23T16:48:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104111"
}
```



---

archive/issue_comments_065355.json:
```json
{
    "body": "Attachment: **[trac_8333-finite_fields_coercion_folded.patch.gz](https://github.com/sagemath/sage/files/ticket8333/trac_8333-finite_fields_coercion_folded.patch.gz)**\n\nFolded patch. Apply only this patch. Applies to 4.6.alpha1 + trac_7883-ideals-folded.patch.",
    "created_at": "2010-09-24T14:26:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65355",
    "user": "https://github.com/loefflerd"
}
```

Attachment: **[trac_8333-finite_fields_coercion_folded.patch.gz](https://github.com/sagemath/sage/files/ticket8333/trac_8333-finite_fields_coercion_folded.patch.gz)**

Folded patch. Apply only this patch. Applies to 4.6.alpha1 + trac_7883-ideals-folded.patch.



---

archive/issue_comments_065356.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI've uploaded a folded patch, which should apply cleanly to 4.6.alpha1 on top of the folded patch at #7883. Doctests do not pass if you apply this patch on its own, so **the positive review should be understood to apply to this patch and #8334 together**. See that ticket for precise directions as to which patches to apply.",
    "created_at": "2010-09-24T14:29:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65356",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:13" align="right">comment:13</div>

I've uploaded a folded patch, which should apply cleanly to 4.6.alpha1 on top of the folded patch at #7883. Doctests do not pass if you apply this patch on its own, so **the positive review should be understood to apply to this patch and #8334 together**. See that ticket for precise directions as to which patches to apply.



---

archive/issue_comments_065357.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n Moves finite fields to the new coercion model.\n \n-Depends on 8218, 8332 and probably 7880 and 7883.\n+Depends on #8218, #8332, #7880 and #7883. Prerequisite for #8334, #8335, #9887.\n``````\n",
    "created_at": "2010-09-24T14:29:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65357",
    "user": "https://github.com/loefflerd"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 Moves finite fields to the new coercion model.
 
-Depends on 8218, 8332 and probably 7880 and 7883.
+Depends on #8218, #8332, #7880 and #7883. Prerequisite for #8334, #8335, #9887.
``````




---

archive/issue_comments_065358.json:
```json
{
    "body": "Reviewer: **David Loeffler**",
    "created_at": "2010-09-24T14:29:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65358",
    "user": "https://github.com/loefflerd"
}
```

Reviewer: **David Loeffler**



---

archive/issue_comments_065359.json:
```json
{
    "body": "Changed work issues from **Depends on broken #8334** to none",
    "created_at": "2010-09-24T14:29:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65359",
    "user": "https://github.com/loefflerd"
}
```

Changed work issues from **Depends on broken #8334** to none



---

archive/issue_events_104112.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2010-09-24T14:29:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104112"
}
```



---

archive/issue_events_104113.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2010-09-24T14:29:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104113"
}
```



---

archive/issue_comments_065360.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nRight, so we ended up preparing a single folded patch at #8334, so **don't apply any patches from this ticket** but close it when the patch at #8333 is merged.",
    "created_at": "2010-09-24T15:27:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65360",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:14" align="right">comment:14</div>

Right, so we ended up preparing a single folded patch at #8334, so **don't apply any patches from this ticket** but close it when the patch at #8333 is merged.



---

archive/issue_comments_065361.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-Moves finite fields to the new coercion model.\n+Moves finite fields to the new coercion model.  Patches have been moved to #8334, so **do not apply the patches** from this ticket.\n \n Depends on #8218, #8332, #7880 and #7883. Prerequisite for #8334, #8335, #9887.\n``````\n",
    "created_at": "2010-09-25T10:03:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8333#issuecomment-65361",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-Moves finite fields to the new coercion model.
+Moves finite fields to the new coercion model.  Patches have been moved to #8334, so **do not apply the patches** from this ticket.
 
 Depends on #8218, #8332, #7880 and #7883. Prerequisite for #8334, #8335, #9887.
``````




---

archive/issue_events_104114.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-28T11:12:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104114"
}
```



---

archive/issue_events_104115.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-28T11:12:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "a6a6a6",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104115"
}
```



---

archive/issue_events_104116.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-28T11:12:28Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "milestone_number": null,
    "milestone_title": "sage-4.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104116"
}
```



---

archive/issue_events_104117.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-28T11:12:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104117"
}
```



---

archive/issue_events_104118.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-28T11:12:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/8333",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8333#event-104118"
}
```
