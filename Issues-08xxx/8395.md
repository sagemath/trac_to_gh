# Issue 8395: degree() reports the degree of a self-loop vertex as contributing 1 to total degree

archive/issues_008395.json:
```json
{
    "body": "**Note:** When this ticket is closed, make sure to also close ticket #9809.\n\nFrom [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/42110dbb598d11d2):\n\n```\n[mvngu@sage mvngu]$ sage\n----------------------------------------------------------------------\n| Sage Version 4.3.3, Release Date: 2010-02-21                       |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nsage: G = Graph({1:[1]}); G\nLooped graph on 1 vertex\nsage: sum(G.degree())\n1\nsage: G.size()\n0\nsage: G = Graph({1:[1]}, loops=True); G\nLooped graph on 1 vertex\nsage: sum(G.degree())\n1\nsage: G.size()\n0\nsage: G = Graph({1:[1]}, loops=True, multiedges=True); G\nLooped multi-graph on 1 vertex\nsage: sum(G.degree())\n1\nsage: G.size()\n0\n\nThe size of G is 1 because there is one edge, i.e. the single\nself-loop. As shown by the above session, Sage reports the size of G\nas 0. I believe this is a bug. \n```\n\nSee also the discussion at this [other sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/63b3c775da0421a8) thread. This also happens in the C graph backends for sparse and dense graphs:\n\n```\n[mvngu@sage ~]$ sage\n----------------------------------------------------------------------\n| Sage Version 4.3.5, Release Date: 2010-03-28                       |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nsage: from sage.graphs.base.sparse_graph import SparseGraphBackend\nsage: S = SparseGraphBackend(7)\nsage: S.loops(True)\nsage: S.add_edge(1, 1, None, directed=False)\nsage: S.has_edge(1, 1, None)\nTrue\nsage: list(S.iterator_edges(range(7), None))\n[(1, 1)]\nsage: S.degree(1, directed=False)\n1\nsage: \nsage: reset()\nsage: \nsage: \nsage: from sage.graphs.base.dense_graph import DenseGraphBackend\nsage: D = DenseGraphBackend(78)\nsage: D = DenseGraphBackend(7)\nsage: D.loops(True)\nsage: D.add_edge(1, 1, None, directed=False)\nsage: D.has_edge(1, 1, None)\nTrue\nsage: list(D.iterator_edges(range(7), None))\n[(1, 1)]\nsage: D.degree(1, directed=False)\n1\n```\n\nNotice that `degree()` reports the degree of a self-loop as one, when in fact it should be 2. That's because both `SparseGraphBackend` and `DenseGraphBackend` inherit the same `degree()` function from `CGraphBackend`. I think the implementation of `degree()` in `CGraphBackend` needs to take into account the existence of self-loops.\n\n**Assignee:** @rlmill\n\n**CC:**  @jasongrout @nathanncohen\n\n**Author:** Minh Van Nguyen\n\n**Reviewer:** Robert Miller, Minh Van Nguyen\n\n**Merged:** sage-4.6.2.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/8395\n\n",
    "closed_at": "2011-01-12T06:31:26Z",
    "created_at": "2010-02-28T14:52:11Z",
    "labels": [
        "component: graph theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.2",
    "title": "degree() reports the degree of a self-loop vertex as contributing 1 to total degree",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8395",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```
**Note:** When this ticket is closed, make sure to also close ticket #9809.

From [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/42110dbb598d11d2):

```
[mvngu@sage mvngu]$ sage
----------------------------------------------------------------------
| Sage Version 4.3.3, Release Date: 2010-02-21                       |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
sage: G = Graph({1:[1]}); G
Looped graph on 1 vertex
sage: sum(G.degree())
1
sage: G.size()
0
sage: G = Graph({1:[1]}, loops=True); G
Looped graph on 1 vertex
sage: sum(G.degree())
1
sage: G.size()
0
sage: G = Graph({1:[1]}, loops=True, multiedges=True); G
Looped multi-graph on 1 vertex
sage: sum(G.degree())
1
sage: G.size()
0

The size of G is 1 because there is one edge, i.e. the single
self-loop. As shown by the above session, Sage reports the size of G
as 0. I believe this is a bug. 
```

See also the discussion at this [other sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/63b3c775da0421a8) thread. This also happens in the C graph backends for sparse and dense graphs:

```
[mvngu@sage ~]$ sage
----------------------------------------------------------------------
| Sage Version 4.3.5, Release Date: 2010-03-28                       |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
sage: from sage.graphs.base.sparse_graph import SparseGraphBackend
sage: S = SparseGraphBackend(7)
sage: S.loops(True)
sage: S.add_edge(1, 1, None, directed=False)
sage: S.has_edge(1, 1, None)
True
sage: list(S.iterator_edges(range(7), None))
[(1, 1)]
sage: S.degree(1, directed=False)
1
sage: 
sage: reset()
sage: 
sage: 
sage: from sage.graphs.base.dense_graph import DenseGraphBackend
sage: D = DenseGraphBackend(78)
sage: D = DenseGraphBackend(7)
sage: D.loops(True)
sage: D.add_edge(1, 1, None, directed=False)
sage: D.has_edge(1, 1, None)
True
sage: list(D.iterator_edges(range(7), None))
[(1, 1)]
sage: D.degree(1, directed=False)
1
```

Notice that `degree()` reports the degree of a self-loop as one, when in fact it should be 2. That's because both `SparseGraphBackend` and `DenseGraphBackend` inherit the same `degree()` function from `CGraphBackend`. I think the implementation of `degree()` in `CGraphBackend` needs to take into account the existence of self-loops.

**Assignee:** @rlmill

**CC:**  @jasongrout @nathanncohen

**Author:** Minh Van Nguyen

**Reviewer:** Robert Miller, Minh Van Nguyen

**Merged:** sage-4.6.2.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/8395





---

archive/issue_comments_069635.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -29,3 +29,40 @@\n self-loop. As shown by the above session, Sage reports the size of G\n as 0. I believe this is a bug. \n ```\n+\n+See also the discussion at this [other sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/63b3c775da0421a8) thread. This also happens in the C graph backends for sparse and dense graphs:\n+\n+```\n+[mvngu@sage ~]$ sage\n+----------------------------------------------------------------------\n+| Sage Version 4.3.5, Release Date: 2010-03-28                       |\n+| Type notebook() for the GUI, and license() for information.        |\n+----------------------------------------------------------------------\n+sage: from sage.graphs.base.sparse_graph import SparseGraphBackend\n+sage: S = SparseGraphBackend(7)\n+sage: S.loops(True)\n+sage: S.add_edge(1, 1, None, directed=False)\n+sage: S.has_edge(1, 1, None)\n+True\n+sage: list(S.iterator_edges(range(7), None))\n+[(1, 1)]\n+sage: S.degree(1, directed=False)\n+1\n+sage: \n+sage: reset()\n+sage: \n+sage: \n+sage: from sage.graphs.base.dense_graph import DenseGraphBackend\n+sage: D = DenseGraphBackend(78)\n+sage: D = DenseGraphBackend(7)\n+sage: D.loops(True)\n+sage: D.add_edge(1, 1, None, directed=False)\n+sage: D.has_edge(1, 1, None)\n+True\n+sage: list(D.iterator_edges(range(7), None))\n+[(1, 1)]\n+sage: D.degree(1, directed=False)\n+1\n+```\n+\n+Notice that `degree()` reports the degree of a self-loop as one, when in fact it should be 2. That's because both `SparseGraphBackend` and `DenseGraphBackend` inherit the same `degree()` function from `CGraphBackend`. I think the implementation of `degree()` in `CGraphBackend` needs to take into account the existence of self-loops.\n``````\n",
    "created_at": "2010-04-23T02:15:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8395#issuecomment-69635",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -29,3 +29,40 @@
 self-loop. As shown by the above session, Sage reports the size of G
 as 0. I believe this is a bug. 
 ```
+
+See also the discussion at this [other sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/63b3c775da0421a8) thread. This also happens in the C graph backends for sparse and dense graphs:
+
+```
+[mvngu@sage ~]$ sage
+----------------------------------------------------------------------
+| Sage Version 4.3.5, Release Date: 2010-03-28                       |
+| Type notebook() for the GUI, and license() for information.        |
+----------------------------------------------------------------------
+sage: from sage.graphs.base.sparse_graph import SparseGraphBackend
+sage: S = SparseGraphBackend(7)
+sage: S.loops(True)
+sage: S.add_edge(1, 1, None, directed=False)
+sage: S.has_edge(1, 1, None)
+True
+sage: list(S.iterator_edges(range(7), None))
+[(1, 1)]
+sage: S.degree(1, directed=False)
+1
+sage: 
+sage: reset()
+sage: 
+sage: 
+sage: from sage.graphs.base.dense_graph import DenseGraphBackend
+sage: D = DenseGraphBackend(78)
+sage: D = DenseGraphBackend(7)
+sage: D.loops(True)
+sage: D.add_edge(1, 1, None, directed=False)
+sage: D.has_edge(1, 1, None)
+True
+sage: list(D.iterator_edges(range(7), None))
+[(1, 1)]
+sage: D.degree(1, directed=False)
+1
+```
+
+Notice that `degree()` reports the degree of a self-loop as one, when in fact it should be 2. That's because both `SparseGraphBackend` and `DenseGraphBackend` inherit the same `degree()` function from `CGraphBackend`. I think the implementation of `degree()` in `CGraphBackend` needs to take into account the existence of self-loops.
``````




---

archive/issue_comments_069636.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -66,3 +66,7 @@\n ```\n \n Notice that `degree()` reports the degree of a self-loop as one, when in fact it should be 2. That's because both `SparseGraphBackend` and `DenseGraphBackend` inherit the same `degree()` function from `CGraphBackend`. I think the implementation of `degree()` in `CGraphBackend` needs to take into account the existence of self-loops.\n+\n+Preliminary patches up at\n+\n+https://github.com/mvngu/8395\n``````\n",
    "created_at": "2010-12-03T12:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8395#issuecomment-69636",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -66,3 +66,7 @@
 ```
 
 Notice that `degree()` reports the degree of a self-loop as one, when in fact it should be 2. That's because both `SparseGraphBackend` and `DenseGraphBackend` inherit the same `degree()` function from `CGraphBackend`. I think the implementation of `degree()` in `CGraphBackend` needs to take into account the existence of self-loops.
+
+Preliminary patches up at
+
+https://github.com/mvngu/8395
``````




---

archive/issue_comments_069637.json:
```json
{
    "body": "**Author:** Minh Van Nguyen",
    "created_at": "2010-12-03T13:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8395#issuecomment-69637",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Author:** Minh Van Nguyen



---

archive/issue_comments_069638.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -66,7 +66,3 @@\n ```\n \n Notice that `degree()` reports the degree of a self-loop as one, when in fact it should be 2. That's because both `SparseGraphBackend` and `DenseGraphBackend` inherit the same `degree()` function from `CGraphBackend`. I think the implementation of `degree()` in `CGraphBackend` needs to take into account the existence of self-loops.\n-\n-Preliminary patches up at\n-\n-https://github.com/mvngu/8395\n``````\n",
    "created_at": "2010-12-03T13:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8395#issuecomment-69638",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -66,7 +66,3 @@
 ```
 
 Notice that `degree()` reports the degree of a self-loop as one, when in fact it should be 2. That's because both `SparseGraphBackend` and `DenseGraphBackend` inherit the same `degree()` function from `CGraphBackend`. I think the implementation of `degree()` in `CGraphBackend` needs to take into account the existence of self-loops.
-
-Preliminary patches up at
-
-https://github.com/mvngu/8395
``````




---

archive/attachments_010438.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac-8395_degree.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8395/trac-8395_degree.patch",
    "created_at": "2010-12-03T13:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8395",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```



---

archive/issue_comments_069639.json:
```json
{
    "body": "<a id='comment:3'></a>\n",
    "created_at": "2010-12-03T13:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8395#issuecomment-69639",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:3'></a>




---

archive/issue_events_060567.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2010-12-03T13:59:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8395",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8395#event-60567"
}
```



---

archive/attachments_010439.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_8395-part2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8395/trac_8395-part2.patch",
    "created_at": "2010-12-03T16:26:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8395",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rlmill"
}
```



---

archive/issue_comments_069640.json:
```json
{
    "body": "apply after previous patch",
    "created_at": "2010-12-03T16:26:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8395#issuecomment-69640",
    "user": "https://github.com/rlmill"
}
```

apply after previous patch



---

archive/issue_comments_069641.json:
```json
{
    "body": "<a id='comment:4'></a>\nMinh,\n\nYour patch looks good to me. If you approve of mine, please set this to positive review.\n\nThanks!",
    "created_at": "2010-12-03T16:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8395#issuecomment-69641",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:4'></a>
Minh,

Your patch looks good to me. If you approve of mine, please set this to positive review.

Thanks!



---

archive/issue_events_060568.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2010-12-04T02:53:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8395",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8395#event-60568"
}
```



---

archive/issue_events_060569.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2010-12-04T02:53:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8395",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8395#event-60569"
}
```



---

archive/issue_comments_069642.json:
```json
{
    "body": "**Reviewer:** Robert Miller, Minh Van Nguyen",
    "created_at": "2010-12-04T02:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8395#issuecomment-69642",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Reviewer:** Robert Miller, Minh Van Nguyen



---

archive/issue_comments_069643.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n+**Note:** When this ticket is closed, make sure to also close ticket #9809.\n+\n From [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/42110dbb598d11d2):\n \n ```\n``````\n",
    "created_at": "2010-12-04T13:08:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8395#issuecomment-69643",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
+**Note:** When this ticket is closed, make sure to also close ticket #9809.
+
 From [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/42110dbb598d11d2):
 
 ```
``````




---

archive/issue_events_060570.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-12-05T09:56:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8395",
    "milestone": "sage-4.6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8395#event-60570"
}
```



---

archive/issue_events_060571.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-12-05T09:56:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8395",
    "milestone": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8395#event-60571"
}
```



---

archive/issue_events_060572.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-12T06:31:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8395",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8395#event-60572"
}
```



---

archive/issue_events_060573.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-12T06:31:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8395",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8395#event-60573"
}
```



---

archive/issue_comments_069644.json:
```json
{
    "body": "**Merged:** sage-4.6.2.alpha0",
    "created_at": "2011-01-12T06:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8395#issuecomment-69644",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.6.2.alpha0
