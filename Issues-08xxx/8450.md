# Issue 8450: intermediate complex expression in real functions make many plot functions fail

archive/issues_008450.json:
```json
{
    "body": "All of the following plots fail\n\n```\nx, y = SR.var('x y')\ncontour_plot(abs(x+i*y), (x,-1,1), (y,-1,1))\ndensity_plot(abs(x+i*y), (x,-1,1), (y,-1,1))\nplot3d(abs(x+i*y), (x,-1,1),(y,-1,1))\nstreamline_plot(abs(x+i*y), (x,-1,1),(y,-1,1))\n```\nwith\n\n```\nTypeError: unable to coerce to a real number\n```\nThe culprit is the call to `setup_for_eval_on_grid` (from `sage/plot/misc.py`) that tries to compile the symbolic expression with `fast_float`. But since the expression involves an intermediate complex number the compilation fails. This can be tested with any of the two\n\n```\nfast_float(abs(x + i*y), x, y)\nfast_callable(abs(x + i*y), vars=[x,y])\n```\nThe function compilation succeeds if we ask for a complex function instead\n\n```\nfast_callable(abs(x + i*y), vars=[x,y], domain=complex)\n```\n\nSee also [this question on ask.sagemath.org](https://ask.sagemath.org/question/46275/typeerror-unable-to-coerce-to-a-real-number/).\n\n**Assignee:** @williamstein\n\n**CC:**  @orlitzky @egourgoulhon @jungmath\n\n**Branch:** [65316090c88f18dcaa8a1bc4db7965f806ea119f](https://github.com/sagemath/sagetrac-mirror/commit/65316090c88f18dcaa8a1bc4db7965f806ea119f)\n\n**Reviewer:** Dima Pasechnik\n\n**Author:** Michael Orlitzky\n\nIssue created by migration from https://trac.sagemath.org/ticket/8450\n\n",
    "closed_at": "2022-01-31T23:32:07Z",
    "created_at": "2010-03-05T22:01:42Z",
    "labels": [
        "component: graphics",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.6",
    "title": "intermediate complex expression in real functions make many plot functions fail",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/8450",
    "user": "https://github.com/jasongrout"
}
```
All of the following plots fail

```
x, y = SR.var('x y')
contour_plot(abs(x+i*y), (x,-1,1), (y,-1,1))
density_plot(abs(x+i*y), (x,-1,1), (y,-1,1))
plot3d(abs(x+i*y), (x,-1,1),(y,-1,1))
streamline_plot(abs(x+i*y), (x,-1,1),(y,-1,1))
```
with

```
TypeError: unable to coerce to a real number
```
The culprit is the call to `setup_for_eval_on_grid` (from `sage/plot/misc.py`) that tries to compile the symbolic expression with `fast_float`. But since the expression involves an intermediate complex number the compilation fails. This can be tested with any of the two

```
fast_float(abs(x + i*y), x, y)
fast_callable(abs(x + i*y), vars=[x,y])
```
The function compilation succeeds if we ask for a complex function instead

```
fast_callable(abs(x + i*y), vars=[x,y], domain=complex)
```

See also [this question on ask.sagemath.org](https://ask.sagemath.org/question/46275/typeerror-unable-to-coerce-to-a-real-number/).

**Assignee:** @williamstein

**CC:**  @orlitzky @egourgoulhon @jungmath

**Branch:** [65316090c88f18dcaa8a1bc4db7965f806ea119f](https://github.com/sagemath/sagetrac-mirror/commit/65316090c88f18dcaa8a1bc4db7965f806ea119f)

**Reviewer:** Dima Pasechnik

**Author:** Michael Orlitzky

Issue created by migration from https://trac.sagemath.org/ticket/8450





---

archive/issue_comments_068781.json:
```json
{
    "body": "<a id='comment:1'></a>\n#5572 will help solve this.",
    "created_at": "2010-04-26T11:59:23Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68781",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:1'></a>
#5572 will help solve this.



---

archive/issue_events_059694.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59694"
}
```



---

archive/issue_events_059695.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59695"
}
```



---

archive/issue_events_059696.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59696"
}
```



---

archive/issue_events_059697.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59697"
}
```



---

archive/issue_events_059698.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59698"
}
```



---

archive/issue_events_059699.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59699"
}
```



---

archive/issue_events_059700.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59700"
}
```



---

archive/issue_events_059701.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59701"
}
```



---

archive/issue_events_059702.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2019-04-19T08:57:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59702"
}
```



---

archive/issue_events_059703.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2019-04-19T08:57:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59703"
}
```



---

archive/issue_comments_068782.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -17,3 +17,5 @@\n ```\n contour_plot(imag(log(x+y*I+.001)), (x,-3,3),(y,-3,3),fill=False)\n ```\n+\n+See also [this question on ask.sagemath.org](https://ask.sagemath.org/question/46275/typeerror-unable-to-coerce-to-a-real-number/).\n``````\n",
    "created_at": "2019-04-19T08:57:18Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68782",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -17,3 +17,5 @@
 ```
 contour_plot(imag(log(x+y*I+.001)), (x,-3,3),(y,-3,3),fill=False)
 ```
+
+See also [this question on ask.sagemath.org](https://ask.sagemath.org/question/46275/typeerror-unable-to-coerce-to-a-real-number/).
``````




---

archive/issue_comments_068783.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,21 +1,27 @@\n-This gives an error:\n+All of the following plots fail\n \n ```\n-contour_plot(real_part(log(x+y*I+.001)), (x,-3,3),(y,-3,3),fill=False)\n+x, y = SR.var('x y')\n+contour_plot(abs(x+i*y), (x,-1,1), (y,-1,1))\n+density_plot(abs(x+i*y), (x,-1,1), (y,-1,1))\n+plot3d(abs(x+i*y), (x,-1,1),(y,-1,1))\n+streamline_plot(abs(x+i*y), (x,-1,1),(y,-1,1))\n ```\n-\n-but this works:\n+with\n \n ```\n-a(x,y)=real(log(x+y*I+.001))\n-f=fast_callable(a,domain=CC)\n-contour_plot(f, (x,-3,3),(y,-3,3),fill=False)\n+TypeError: unable to coerce to a real number\n ```\n-\n-and this works:\n+The culprit is the call to `setup_for_eval_on_grid` (from `sage/plot/misc.py`) that tries to compile the symbolic expression with `fast_float`. But since the expression involves an intermediate complex number the compilation fails. This can be tested with any of the two\n \n ```\n-contour_plot(imag(log(x+y*I+.001)), (x,-3,3),(y,-3,3),fill=False)\n+fast_float(abs(x + i*y), x, y)\n+fast_callable(abs(x + i*y), vars=[x,y])\n+```\n+The function compilation succeeds if we ask for a complex function instead\n+\n+```\n+fast_callable(abs(x + i*y), vars=[x,y], domain=CDF)\n ```\n \n See also [this question on ask.sagemath.org](https://ask.sagemath.org/question/46275/typeerror-unable-to-coerce-to-a-real-number/).\n``````\n",
    "created_at": "2019-04-19T09:11:19Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68783",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,21 +1,27 @@
-This gives an error:
+All of the following plots fail
 
 ```
-contour_plot(real_part(log(x+y*I+.001)), (x,-3,3),(y,-3,3),fill=False)
+x, y = SR.var('x y')
+contour_plot(abs(x+i*y), (x,-1,1), (y,-1,1))
+density_plot(abs(x+i*y), (x,-1,1), (y,-1,1))
+plot3d(abs(x+i*y), (x,-1,1),(y,-1,1))
+streamline_plot(abs(x+i*y), (x,-1,1),(y,-1,1))
 ```
-
-but this works:
+with
 
 ```
-a(x,y)=real(log(x+y*I+.001))
-f=fast_callable(a,domain=CC)
-contour_plot(f, (x,-3,3),(y,-3,3),fill=False)
+TypeError: unable to coerce to a real number
 ```
-
-and this works:
+The culprit is the call to `setup_for_eval_on_grid` (from `sage/plot/misc.py`) that tries to compile the symbolic expression with `fast_float`. But since the expression involves an intermediate complex number the compilation fails. This can be tested with any of the two
 
 ```
-contour_plot(imag(log(x+y*I+.001)), (x,-3,3),(y,-3,3),fill=False)
+fast_float(abs(x + i*y), x, y)
+fast_callable(abs(x + i*y), vars=[x,y])
+```
+The function compilation succeeds if we ask for a complex function instead
+
+```
+fast_callable(abs(x + i*y), vars=[x,y], domain=CDF)
 ```
 
 See also [this question on ask.sagemath.org](https://ask.sagemath.org/question/46275/typeerror-unable-to-coerce-to-a-real-number/).
``````




---

archive/issue_events_059704.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2019-04-19T09:11:19Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "rename": {
        "from": "contour_plot chokes on function which involves imaginary numbers",
        "to": "intermediate complex expression in real functions make many plot functions fail"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59704"
}
```



---

archive/issue_comments_068784.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -21,7 +21,7 @@\n The function compilation succeeds if we ask for a complex function instead\n \n ```\n-fast_callable(abs(x + i*y), vars=[x,y], domain=CDF)\n+fast_callable(abs(x + i*y), vars=[x,y], domain=complex)\n ```\n \n See also [this question on ask.sagemath.org](https://ask.sagemath.org/question/46275/typeerror-unable-to-coerce-to-a-real-number/).\n``````\n",
    "created_at": "2019-04-19T09:27:33Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68784",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -21,7 +21,7 @@
 The function compilation succeeds if we ask for a complex function instead
 
 ```
-fast_callable(abs(x + i*y), vars=[x,y], domain=CDF)
+fast_callable(abs(x + i*y), vars=[x,y], domain=complex)
 ```
 
 See also [this question on ask.sagemath.org](https://ask.sagemath.org/question/46275/typeerror-unable-to-coerce-to-a-real-number/).
``````




---

archive/issue_events_059705.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:54:19Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59705"
}
```



---

archive/issue_comments_068785.json:
```json
{
    "body": "<a id='comment:9'></a>\nAs the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:54:19Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68785",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>
As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_events_059706.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-22T00:57:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59706"
}
```



---

archive/issue_events_059707.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-22T00:57:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59707"
}
```



---

archive/issue_comments_068786.json:
```json
{
    "body": "**Dependencies:** #32234",
    "created_at": "2021-07-22T00:57:56Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68786",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #32234



---

archive/issue_comments_068787.json:
```json
{
    "body": "**Author:** Michael Orlitzky",
    "created_at": "2021-07-23T15:13:24Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68787",
    "user": "https://github.com/orlitzky"
}
```

**Author:** Michael Orlitzky



---

archive/issue_comments_068788.json:
```json
{
    "body": "**Branch:** [u/mjo/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/8450)",
    "created_at": "2021-07-23T15:13:24Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68788",
    "user": "https://github.com/orlitzky"
}
```

**Branch:** [u/mjo/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/8450)



---

archive/issue_comments_068789.json:
```json
{
    "body": "**Commit:** [a773fd3919b69e575d94cdf60135c419b5e08f24](https://github.com/sagemath/sagetrac-mirror/commit/a773fd3919b69e575d94cdf60135c419b5e08f24)",
    "created_at": "2021-07-23T15:13:24Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68789",
    "user": "https://github.com/orlitzky"
}
```

**Commit:** [a773fd3919b69e575d94cdf60135c419b5e08f24](https://github.com/sagemath/sagetrac-mirror/commit/a773fd3919b69e575d94cdf60135c419b5e08f24)



---

archive/issue_events_059708.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-07-23T15:13:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59708"
}
```



---

archive/issue_events_059709.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-07-23T15:13:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59709"
}
```



---

archive/issue_comments_068790.json:
```json
{
    "body": "<a id='comment:11'></a>\nThis is an \"easy fix\" but causes a cascade of other issues because removing `domain=float` turns a lot of things that used to be `Nan` into `TypeError`, `ValueError`, `ZeroDivisionError`, etc.\n\nI'm still running a ptestlong on this, but everything under `sage/plot` now passes. Here are some thoughts:\n\n1. Do we really want to support passing (for example) the integer zero as a function to be plotted? We have doctests that check things like `plot(ZZ(0), x, 0, 1)`. Supporting this requires special cases in the code, and IMO just perpetuates confusion about the difference between the integer 0 and the function const0.\n2. We now have \"try to evaluate this as a real number, and return NaN (or skip it) if we can't\" code in at least five places. Should this be made consistent, or (better yet) factored out? I've made it so that the doctests pass, but in some places we catch only e.g. `TypeError`, while in others we check for a nice long list.\n3. This needs a careful review, since it can change the appearance of plots. There was some other (now fixed) bug involved as you can see from the commit list, but for example, this fix accidentally broke `list_plot`.\n4. I don't really like using try/except in fast loops. Is there a better way to fix the doctest failures that the first commit caused and that the later ones fix?",
    "created_at": "2021-07-23T15:13:24Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68790",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:11'></a>
This is an "easy fix" but causes a cascade of other issues because removing `domain=float` turns a lot of things that used to be `Nan` into `TypeError`, `ValueError`, `ZeroDivisionError`, etc.

I'm still running a ptestlong on this, but everything under `sage/plot` now passes. Here are some thoughts:

1. Do we really want to support passing (for example) the integer zero as a function to be plotted? We have doctests that check things like `plot(ZZ(0), x, 0, 1)`. Supporting this requires special cases in the code, and IMO just perpetuates confusion about the difference between the integer 0 and the function const0.
2. We now have "try to evaluate this as a real number, and return NaN (or skip it) if we can't" code in at least five places. Should this be made consistent, or (better yet) factored out? I've made it so that the doctests pass, but in some places we catch only e.g. `TypeError`, while in others we check for a nice long list.
3. This needs a careful review, since it can change the appearance of plots. There was some other (now fixed) bug involved as you can see from the commit list, but for example, this fix accidentally broke `list_plot`.
4. I don't really like using try/except in fast loops. Is there a better way to fix the doctest failures that the first commit caused and that the later ones fix?



---

archive/issue_comments_068791.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [mjo](#comment%3A11):\n> 1. Do we really want to support passing (for example) the integer zero as a function to be plotted? We have doctests that check things like `plot(ZZ(0), x, 0, 1)`. Supporting this requires special cases in the code, and IMO just perpetuates confusion about the difference between the integer 0 and the function const0.\n\nAllowing non-callables as input for `plot` is, I think, important to keep. Convenience for casual use is key. Given that `plot` takes variable names as part of its input, it's clear that there is some implicit construction of a symbolic or numerical function happening.",
    "created_at": "2021-07-23T16:36:19Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68791",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
Replying to [mjo](#comment%3A11):
> 1. Do we really want to support passing (for example) the integer zero as a function to be plotted? We have doctests that check things like `plot(ZZ(0), x, 0, 1)`. Supporting this requires special cases in the code, and IMO just perpetuates confusion about the difference between the integer 0 and the function const0.

Allowing non-callables as input for `plot` is, I think, important to keep. Convenience for casual use is key. Given that `plot` takes variable names as part of its input, it's clear that there is some implicit construction of a symbolic or numerical function happening.



---

archive/issue_comments_068792.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [mjo](#comment%3A11):\n> This is an \"easy fix\" but causes a cascade of other issues because removing `domain=float` turns a lot of things that used to be `Nan` into `TypeError`, `ValueError`, `ZeroDivisionError`, etc.\n\nSorry, where do you remove `domain=float`?",
    "created_at": "2021-07-23T16:41:50Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68792",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
Replying to [mjo](#comment%3A11):
> This is an "easy fix" but causes a cascade of other issues because removing `domain=float` turns a lot of things that used to be `Nan` into `TypeError`, `ValueError`, `ZeroDivisionError`, etc.

Sorry, where do you remove `domain=float`?



---

archive/issue_comments_068793.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [mkoeppe](#comment%3A13):\n> Replying to [mjo](#comment%3A11):\n> > This is an \"easy fix\" but causes a cascade of other issues because removing `domain=float` turns a lot of things that used to be `Nan` into `TypeError`, `ValueError`, `ZeroDivisionError`, etc.\n\n> \n> Sorry, where do you remove `domain=float`?\n\nThe first thing `fast_float()` tries is to use `fast_callable()` with `domain=float`:\n\n```python\ntry:\n    return fast_callable(f, vars=vars, domain=float,\n                         expect_one_var=expect_one_var)\n```\n\nWe're now using `fast_callable()` directly, and omit the `domain`.",
    "created_at": "2021-07-23T16:45:06Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68793",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:14'></a>
Replying to [mkoeppe](#comment%3A13):
> Replying to [mjo](#comment%3A11):
> > This is an "easy fix" but causes a cascade of other issues because removing `domain=float` turns a lot of things that used to be `Nan` into `TypeError`, `ValueError`, `ZeroDivisionError`, etc.

> 
> Sorry, where do you remove `domain=float`?

The first thing `fast_float()` tries is to use `fast_callable()` with `domain=float`:

```python
try:
    return fast_callable(f, vars=vars, domain=float,
                         expect_one_var=expect_one_var)
```

We're now using `fast_callable()` directly, and omit the `domain`.



---

archive/issue_comments_068794.json:
```json
{
    "body": "<a id='comment:15'></a>\nThanks.\n\nI have not looked at the details, nor done any timing. But it seems to me that a better solution may be to try `domain=float` first, then `domain=complex` (or whatever is needed to make `fast_callable` use `interp_cdf`); and only in the end fall back to the general interpreter.\n\n> 2. We now have \"try to evaluate this as a real number, and return NaN (or skip it) if we can't\" code in at least five places. Should this be made consistent, or (better yet) factored out? \n\nYes, I guess there would be value in a version of the general interpreter that catches errors and replaces them by NaN returns",
    "created_at": "2021-07-23T16:59:44Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68794",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
Thanks.

I have not looked at the details, nor done any timing. But it seems to me that a better solution may be to try `domain=float` first, then `domain=complex` (or whatever is needed to make `fast_callable` use `interp_cdf`); and only in the end fall back to the general interpreter.

> 2. We now have "try to evaluate this as a real number, and return NaN (or skip it) if we can't" code in at least five places. Should this be made consistent, or (better yet) factored out? 

Yes, I guess there would be value in a version of the general interpreter that catches errors and replaces them by NaN returns



---

archive/issue_comments_068795.json:
```json
{
    "body": "<a id='comment:16'></a>\nBy the way, I just came across https://github.com/sagemath/sage/files/ticket5572/improve_fast_callable.6.patch, which seems to have done a lot of what we're doing again now...",
    "created_at": "2021-07-23T17:08:46Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68795",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
By the way, I just came across https://github.com/sagemath/sage/files/ticket5572/improve_fast_callable.6.patch, which seems to have done a lot of what we're doing again now...



---

archive/issue_comments_068796.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [mkoeppe](#comment%3A15):\n> Thanks.\n> \n> I have not looked at the details, nor done any timing. But it seems to me that a better solution may be to try `domain=float` first, then `domain=complex` (or whatever is needed to make `fast_callable` use `interp_cdf`); and only in the end fall back to the general interpreter.\n\nThis is tough because there are so many plotting interfaces, and the fast-callables aren't created near the point of failure. In this case, `setup_for_eval_on_grid()` is preprocessing some of the plotting args and returning them to some other function that orchestrates the plotting. Then the failure occurs in *another* function that actually computes the plot points. \n\nSome major refactoring would be needed to do this all more intelligently. (I think we would also need to generate some kind of custom exception to avoid wrapping ten layers of code in one big `except TypeError` block.)",
    "created_at": "2021-07-23T17:31:04Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68796",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:17'></a>
Replying to [mkoeppe](#comment%3A15):
> Thanks.
> 
> I have not looked at the details, nor done any timing. But it seems to me that a better solution may be to try `domain=float` first, then `domain=complex` (or whatever is needed to make `fast_callable` use `interp_cdf`); and only in the end fall back to the general interpreter.

This is tough because there are so many plotting interfaces, and the fast-callables aren't created near the point of failure. In this case, `setup_for_eval_on_grid()` is preprocessing some of the plotting args and returning them to some other function that orchestrates the plotting. Then the failure occurs in *another* function that actually computes the plot points. 

Some major refactoring would be needed to do this all more intelligently. (I think we would also need to generate some kind of custom exception to avoid wrapping ten layers of code in one big `except TypeError` block.)



---

archive/issue_events_059710.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-23T17:35:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "minor",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59710"
}
```



---

archive/issue_comments_068797.json:
```json
{
    "body": "<a id='comment:18'></a>\nOK, thanks for the explanation. Then I would suggest that we declare the issue of this ticket as \"minor\" and set it aside for later consideration.",
    "created_at": "2021-07-23T17:35:16Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68797",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
OK, thanks for the explanation. Then I would suggest that we declare the issue of this ticket as "minor" and set it aside for later consideration.



---

archive/issue_events_059711.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-23T17:35:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59711"
}
```



---

archive/issue_events_059712.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-23T17:35:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59712"
}
```



---

archive/issue_comments_068798.json:
```json
{
    "body": "**Changing commit** from \"[a773fd3919b69e575d94cdf60135c419b5e08f24](https://github.com/sagemath/sagetrac-mirror/commit/a773fd3919b69e575d94cdf60135c419b5e08f24)\" to \"[3168bdc46b2b9cc16bb3bcc9333c95739e0e4791](https://github.com/sagemath/sagetrac-mirror/commit/3168bdc46b2b9cc16bb3bcc9333c95739e0e4791)\".",
    "created_at": "2021-07-26T14:03:41Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68798",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a773fd3919b69e575d94cdf60135c419b5e08f24](https://github.com/sagemath/sagetrac-mirror/commit/a773fd3919b69e575d94cdf60135c419b5e08f24)" to "[3168bdc46b2b9cc16bb3bcc9333c95739e0e4791](https://github.com/sagemath/sagetrac-mirror/commit/3168bdc46b2b9cc16bb3bcc9333c95739e0e4791)".



---

archive/issue_comments_068799.json:
```json
{
    "body": "<a id='comment:19'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/006dd6156b53473e701f1b42de462c7e5657478d\">006dd61</a></td><td><code>Trac #8450: support \"output\" wrapper around fast_callable().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a746166e2dcd11d3e0777bcee2d36e7108165273\">a746166</a></td><td><code>Trac #8450: use fast_callable() in setup_for_eval_on_grid().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3168bdc46b2b9cc16bb3bcc9333c95739e0e4791\">3168bdc</a></td><td><code>Trac #8450: update the output from a few plotting doctests.</code></td></tr></table>\n",
    "created_at": "2021-07-26T14:03:41Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68799",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/006dd6156b53473e701f1b42de462c7e5657478d">006dd61</a></td><td><code>Trac #8450: support "output" wrapper around fast_callable().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a746166e2dcd11d3e0777bcee2d36e7108165273">a746166</a></td><td><code>Trac #8450: use fast_callable() in setup_for_eval_on_grid().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3168bdc46b2b9cc16bb3bcc9333c95739e0e4791">3168bdc</a></td><td><code>Trac #8450: update the output from a few plotting doctests.</code></td></tr></table>




---

archive/issue_events_059713.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-07-26T14:25:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59713"
}
```



---

archive/issue_events_059714.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-07-26T14:25:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59714"
}
```



---

archive/issue_comments_068800.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [mkoeppe](#comment%3A18):\n> OK, thanks for the explanation. Then I would suggest that we declare the issue of this ticket as \"minor\" and set it aside for later consideration. \n\nI actually hold a grudge against this bug from back when I was generating plots programmatically and the random appearance of `0.000000000001*I` would kill the whole thing after an hour, so I haven't given up.\n\nI tried a few more things, described in the first of the recent commit messages, and discovered problems with all of them. I did however eventually find a solution that is both unobtrusive and fast: wrap fast-callable evaluation in a class that can force the result to a specific output type. With ``domain=<something complex>`` and ``output=<something real>``, we return `NaN` unless the imaginary part is trivial, in which case we return the real part. In all other situations we simply try to coerce the output to the given type.\n\nThis allows us to plot over CDF but convert the result to float (possibly NaN) only on the way out, without having to hack that conversion logic into a hundred plotting functions. It's probably as fast as any solution could be; complex (two-float) operations necessarily take longer than plain float computations, but the difference is small in my non-rigorous tests, less than 10%.\n\nAn output wrapper is not used unless it's needed, so this doesn't affect any other uses of `fast_callable()` in the tree.",
    "created_at": "2021-07-26T14:25:51Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68800",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:20'></a>
Replying to [mkoeppe](#comment%3A18):
> OK, thanks for the explanation. Then I would suggest that we declare the issue of this ticket as "minor" and set it aside for later consideration. 

I actually hold a grudge against this bug from back when I was generating plots programmatically and the random appearance of `0.000000000001*I` would kill the whole thing after an hour, so I haven't given up.

I tried a few more things, described in the first of the recent commit messages, and discovered problems with all of them. I did however eventually find a solution that is both unobtrusive and fast: wrap fast-callable evaluation in a class that can force the result to a specific output type. With ``domain=<something complex>`` and ``output=<something real>``, we return `NaN` unless the imaginary part is trivial, in which case we return the real part. In all other situations we simply try to coerce the output to the given type.

This allows us to plot over CDF but convert the result to float (possibly NaN) only on the way out, without having to hack that conversion logic into a hundred plotting functions. It's probably as fast as any solution could be; complex (two-float) operations necessarily take longer than plain float computations, but the difference is small in my non-rigorous tests, less than 10%.

An output wrapper is not used unless it's needed, so this doesn't affect any other uses of `fast_callable()` in the tree.



---

archive/issue_comments_068801.json:
```json
{
    "body": "<a id='comment:22'></a>\nThis looks like a fine approach. I won't have time before mid August to look at it in detail. Just a quick comment:\n\n```\n+        # This tolerance was not chosen for any particular reason.\n+        if abs(ipart) < 1e-8:\n+            return self._output(rpart)\n+        else:\n+            return self._output(\"nan\")\n```\nProbably best to make these tolerances user-configurable (as an optional init argument of OutputWrapper and optional argument of `fast_callable`).",
    "created_at": "2021-07-26T20:13:41Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68801",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
This looks like a fine approach. I won't have time before mid August to look at it in detail. Just a quick comment:

```
+        # This tolerance was not chosen for any particular reason.
+        if abs(ipart) < 1e-8:
+            return self._output(rpart)
+        else:
+            return self._output("nan")
```
Probably best to make these tolerances user-configurable (as an optional init argument of OutputWrapper and optional argument of `fast_callable`).



---

archive/issue_events_059715.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-07-26T23:24:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59715"
}
```



---

archive/issue_events_059716.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-07-26T23:24:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59716"
}
```



---

archive/issue_comments_068802.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [mkoeppe](#comment%3A22):\n> Probably best to make these tolerances user-configurable (as an optional init argument of OutputWrapper and optional argument of `fast_callable`).\n> \n\nI'm glad you brought this up. I swept it under the rug when I had fifteen things on my internal problem stack, but it's a code smell: using a fixed tolerance isn't right, but adding the argument to `fast_callable()` and trying to explain how it will be used exposes too many implementation details.\n\nI think I can simplify things even further.",
    "created_at": "2021-07-26T23:24:05Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68802",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:23'></a>
Replying to [mkoeppe](#comment%3A22):
> Probably best to make these tolerances user-configurable (as an optional init argument of OutputWrapper and optional argument of `fast_callable`).
> 

I'm glad you brought this up. I swept it under the rug when I had fifteen things on my internal problem stack, but it's a code smell: using a fixed tolerance isn't right, but adding the argument to `fast_callable()` and trying to explain how it will be used exposes too many implementation details.

I think I can simplify things even further.



---

archive/issue_comments_068803.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/58fdf1e7967adb8f82f3bc38506191d2d2be36b2\">58fdf1e</a></td><td><code>src/sage/plot/plot3d/parametric_surface.pyx: Remove handling of FastDoubleFunc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec44c61fe547f82735332e51eb987c26e721ea44\">ec44c61</a></td><td><code>src/sage/ext/fast_eval.pyx: Reduce/update documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c93ae0be61c08d98bcadcffdd173c010a6f136b\">4c93ae0</a></td><td><code>Trac #32234: use fast_callable() for symbolic find_root().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/56e9997dd2dd6e5a87b394c68beb1dc32f29126f\">56e9997</a></td><td><code>Trac #32234: don't import fast_callable() from sage.ext.fast_eval.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18593fff12d9d4b7b8b8edb21d67662cefd35f06\">18593ff</a></td><td><code>Trac #32234: replace fast_float_arg() in plot3d.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5fc69cae93c7b8f50800bd43f352ff37758607b4\">5fc69ca</a></td><td><code>Trac #32234: fix symbolic find_local_minimum() docs.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cdef097b77f25f243678bec2f3443068c3982511\">cdef097</a></td><td><code>Trac #32234: use domain=float for fast callables used by numpy.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/95a887fdf3b6ec3807cb90d05c5023a1ddaf196a\">95a887f</a></td><td><code>Trac #8450: new fast-callable output wrapper for plotting.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6966626aa0cd0eee777639d6c8900c6d3a7a949\">f696662</a></td><td><code>Trac #8450: use fast_callable() in setup_for_eval_on_grid().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2b88457367c28b5315e60d8223d0d79aa750f474\">2b88457</a></td><td><code>Trac #8450: update the output from a few plotting doctests.</code></td></tr></table>\n",
    "created_at": "2021-07-27T14:05:23Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68803",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/58fdf1e7967adb8f82f3bc38506191d2d2be36b2">58fdf1e</a></td><td><code>src/sage/plot/plot3d/parametric_surface.pyx: Remove handling of FastDoubleFunc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec44c61fe547f82735332e51eb987c26e721ea44">ec44c61</a></td><td><code>src/sage/ext/fast_eval.pyx: Reduce/update documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c93ae0be61c08d98bcadcffdd173c010a6f136b">4c93ae0</a></td><td><code>Trac #32234: use fast_callable() for symbolic find_root().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/56e9997dd2dd6e5a87b394c68beb1dc32f29126f">56e9997</a></td><td><code>Trac #32234: don't import fast_callable() from sage.ext.fast_eval.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18593fff12d9d4b7b8b8edb21d67662cefd35f06">18593ff</a></td><td><code>Trac #32234: replace fast_float_arg() in plot3d.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5fc69cae93c7b8f50800bd43f352ff37758607b4">5fc69ca</a></td><td><code>Trac #32234: fix symbolic find_local_minimum() docs.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cdef097b77f25f243678bec2f3443068c3982511">cdef097</a></td><td><code>Trac #32234: use domain=float for fast callables used by numpy.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/95a887fdf3b6ec3807cb90d05c5023a1ddaf196a">95a887f</a></td><td><code>Trac #8450: new fast-callable output wrapper for plotting.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6966626aa0cd0eee777639d6c8900c6d3a7a949">f696662</a></td><td><code>Trac #8450: use fast_callable() in setup_for_eval_on_grid().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2b88457367c28b5315e60d8223d0d79aa750f474">2b88457</a></td><td><code>Trac #8450: update the output from a few plotting doctests.</code></td></tr></table>




---

archive/issue_comments_068804.json:
```json
{
    "body": "**Changing commit** from \"[3168bdc46b2b9cc16bb3bcc9333c95739e0e4791](https://github.com/sagemath/sagetrac-mirror/commit/3168bdc46b2b9cc16bb3bcc9333c95739e0e4791)\" to \"[2b88457367c28b5315e60d8223d0d79aa750f474](https://github.com/sagemath/sagetrac-mirror/commit/2b88457367c28b5315e60d8223d0d79aa750f474)\".",
    "created_at": "2021-07-27T14:05:23Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68804",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3168bdc46b2b9cc16bb3bcc9333c95739e0e4791](https://github.com/sagemath/sagetrac-mirror/commit/3168bdc46b2b9cc16bb3bcc9333c95739e0e4791)" to "[2b88457367c28b5315e60d8223d0d79aa750f474](https://github.com/sagemath/sagetrac-mirror/commit/2b88457367c28b5315e60d8223d0d79aa750f474)".



---

archive/issue_comments_068805.json:
```json
{
    "body": "<a id='comment:25'></a>\nMuch better now. There's no need to solve the output-conversion problem more generally; we need it only for plotting, and creating the wrapper under sage.plot.misc eliminates all of the problems with the previous iteration.",
    "created_at": "2021-07-27T14:07:57Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68805",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:25'></a>
Much better now. There's no need to solve the output-conversion problem more generally; we need it only for plotting, and creating the wrapper under sage.plot.misc eliminates all of the problems with the previous iteration.



---

archive/issue_events_059717.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-07-27T14:07:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59717"
}
```



---

archive/issue_events_059718.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-07-27T14:07:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59718"
}
```



---

archive/issue_comments_068806.json:
```json
{
    "body": "<a id='comment:26'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e6f88d62cefd70641c7ad0e9467f622c974a467b\">e6f88d6</a></td><td><code>src/sage/ext/fast_eval.pyx: Reduce/update documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1353bafad48b129bad52ff18f5f6f8ede6253b3b\">1353baf</a></td><td><code>Trac #32234: use fast_callable() for symbolic find_root().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c56fa053a5617c9df785450f624bd6864d9d96fe\">c56fa05</a></td><td><code>Trac #32234: don't import fast_callable() from sage.ext.fast_eval.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0fcec8e1bcdb881daa4610aa81965be6f159224f\">0fcec8e</a></td><td><code>Trac #32234: replace fast_float_arg() in plot3d.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1479666c1fc3500a490faefe19ff3bcadfca0622\">1479666</a></td><td><code>Trac #32234: fix symbolic find_local_minimum() docs.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/19aa975778d411e596e6b72dbdc00b402985dd07\">19aa975</a></td><td><code>Trac #32234: use domain=float for fast callables used by numpy.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df062b30005bf8488fa16124cd7c2b9129e7b396\">df062b3</a></td><td><code>Trac #32234: replace two trivial fast-callables in plot3d().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/411d34de579d03205e0bccfea2bb893ef827486a\">411d34d</a></td><td><code>Trac #8450: new fast-callable output wrapper for plotting.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/660015887c73b1ac55a73260e53ea4ed3036fcdc\">6600158</a></td><td><code>Trac #8450: use fast_callable() in setup_for_eval_on_grid().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d8e79086453876c2f1c43931590ffc94801fcaa1\">d8e7908</a></td><td><code>Trac #8450: update the output from a few plotting doctests.</code></td></tr></table>\n",
    "created_at": "2021-07-27T21:01:03Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68806",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e6f88d62cefd70641c7ad0e9467f622c974a467b">e6f88d6</a></td><td><code>src/sage/ext/fast_eval.pyx: Reduce/update documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1353bafad48b129bad52ff18f5f6f8ede6253b3b">1353baf</a></td><td><code>Trac #32234: use fast_callable() for symbolic find_root().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c56fa053a5617c9df785450f624bd6864d9d96fe">c56fa05</a></td><td><code>Trac #32234: don't import fast_callable() from sage.ext.fast_eval.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0fcec8e1bcdb881daa4610aa81965be6f159224f">0fcec8e</a></td><td><code>Trac #32234: replace fast_float_arg() in plot3d.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1479666c1fc3500a490faefe19ff3bcadfca0622">1479666</a></td><td><code>Trac #32234: fix symbolic find_local_minimum() docs.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/19aa975778d411e596e6b72dbdc00b402985dd07">19aa975</a></td><td><code>Trac #32234: use domain=float for fast callables used by numpy.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df062b30005bf8488fa16124cd7c2b9129e7b396">df062b3</a></td><td><code>Trac #32234: replace two trivial fast-callables in plot3d().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/411d34de579d03205e0bccfea2bb893ef827486a">411d34d</a></td><td><code>Trac #8450: new fast-callable output wrapper for plotting.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/660015887c73b1ac55a73260e53ea4ed3036fcdc">6600158</a></td><td><code>Trac #8450: use fast_callable() in setup_for_eval_on_grid().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d8e79086453876c2f1c43931590ffc94801fcaa1">d8e7908</a></td><td><code>Trac #8450: update the output from a few plotting doctests.</code></td></tr></table>




---

archive/issue_comments_068807.json:
```json
{
    "body": "**Changing commit** from \"[2b88457367c28b5315e60d8223d0d79aa750f474](https://github.com/sagemath/sagetrac-mirror/commit/2b88457367c28b5315e60d8223d0d79aa750f474)\" to \"[d8e79086453876c2f1c43931590ffc94801fcaa1](https://github.com/sagemath/sagetrac-mirror/commit/d8e79086453876c2f1c43931590ffc94801fcaa1)\".",
    "created_at": "2021-07-27T21:01:03Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68807",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[2b88457367c28b5315e60d8223d0d79aa750f474](https://github.com/sagemath/sagetrac-mirror/commit/2b88457367c28b5315e60d8223d0d79aa750f474)" to "[d8e79086453876c2f1c43931590ffc94801fcaa1](https://github.com/sagemath/sagetrac-mirror/commit/d8e79086453876c2f1c43931590ffc94801fcaa1)".



---

archive/issue_comments_068808.json:
```json
{
    "body": "<a id='comment:27'></a>\nThis is looking nice. Similar to what I said in [comment:22](#comment%3A22), I think the imaginary tolerance should be customizable on the level of the plot functions -- in the same way that options such as `detect_poles`, `adaptive_tolerance` are offered.",
    "created_at": "2021-08-15T02:53:25Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68808",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
This is looking nice. Similar to what I said in [comment:22](#comment%3A22), I think the imaginary tolerance should be customizable on the level of the plot functions -- in the same way that options such as `detect_poles`, `adaptive_tolerance` are offered.



---

archive/issue_comments_068809.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [mkoeppe](#comment%3A27):\n> This is looking nice. Similar to what I said in [comment:22](#comment%3A22), I think the imaginary tolerance should be customizable on the level of the plot functions -- in the same way that options such as `detect_poles`, `adaptive_tolerance` are offered.\n\nThose only work for the `plot()` function, and not for anything else that calls `setup_for_eval_on_grid()`. But once #32234 gets reviewed, I guess I wouldn't mind adding `imaginary_tolerance` to `plot.options`. In that case, we should probably go back later and try to make the options to the various plotting functions consistent (in another ticket).",
    "created_at": "2021-08-19T13:37:00Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68809",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:28'></a>
Replying to [mkoeppe](#comment%3A27):
> This is looking nice. Similar to what I said in [comment:22](#comment%3A22), I think the imaginary tolerance should be customizable on the level of the plot functions -- in the same way that options such as `detect_poles`, `adaptive_tolerance` are offered.

Those only work for the `plot()` function, and not for anything else that calls `setup_for_eval_on_grid()`. But once #32234 gets reviewed, I guess I wouldn't mind adding `imaginary_tolerance` to `plot.options`. In that case, we should probably go back later and try to make the options to the various plotting functions consistent (in another ticket).



---

archive/issue_comments_068810.json:
```json
{
    "body": "**Changing branch** from \"[u/mjo/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/8450)\" to \"[u/mkoeppe/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/8450)\".",
    "created_at": "2021-09-13T23:59:11Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68810",
    "user": "https://github.com/mkoeppe"
}
```

**Changing branch** from "[u/mjo/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/8450)" to "[u/mkoeppe/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/8450)".



---

archive/issue_comments_068811.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/8450)\" to \"[u/mjo/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/8450)\".",
    "created_at": "2021-10-21T00:29:30Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68811",
    "user": "https://github.com/orlitzky"
}
```

**Changing branch** from "[u/mkoeppe/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/8450)" to "[u/mjo/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/8450)".



---

archive/issue_comments_068812.json:
```json
{
    "body": "<a id='comment:30'></a>\nHere's a rebase and the `plot.options` interface. I still need to look closer at what's going on with `real_nth_root()` though; what's there is a hack.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86c6cdc8db82ffc8774865b94ce4246d9249ba41\">86c6cdc</a></td><td><code>Trac #8450: new fast-callable output wrapper for plotting.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eca45ddb800c0920c22de401677b23b1ee850162\">eca45dd</a></td><td><code>Trac #8450: use fast_callable() in setup_for_eval_on_grid().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/37955990bb5cff6547dbac4bca5ba6dfcab14e54\">3795599</a></td><td><code>Trac #8450: update the output from a few plotting doctests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/518349ecb0eb4436e8033a988601e584aed10c2b\">518349e</a></td><td><code>Trac #8450: pass imaginary tolerance down through plot.options.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b46a44896ed8299d88127db278ea65e2da1b4a4\">5b46a44</a></td><td><code>Trac #8450: remove imag_tol default from FastCallablePlotWrapper().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b66d2d19b48849a340131dbc7f55ef19df87682a\">b66d2d1</a></td><td><code>Trac #8450: use CDF for symbolic expression fast-callables.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/67a321deb8f536af23a4aaf365f6708de3879358\">67a321d</a></td><td><code>Trac #8450: catch more cases in setup_for_eval_on_grid.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/920db97ca2519dd423f0721ab348dab3496e9a05\">920db97</a></td><td><code>Trac #8450: fix complex type error in real_nth_root().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fbea8c6209bd67ecde413d0d0ab4b51b4f2d1caa\">fbea8c6</a></td><td><code>Trac #8450: add an example using \"imaginary_tolerance\" in plot().</code></td></tr></table>\n",
    "created_at": "2021-10-21T00:29:30Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68812",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:30'></a>
Here's a rebase and the `plot.options` interface. I still need to look closer at what's going on with `real_nth_root()` though; what's there is a hack.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86c6cdc8db82ffc8774865b94ce4246d9249ba41">86c6cdc</a></td><td><code>Trac #8450: new fast-callable output wrapper for plotting.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eca45ddb800c0920c22de401677b23b1ee850162">eca45dd</a></td><td><code>Trac #8450: use fast_callable() in setup_for_eval_on_grid().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/37955990bb5cff6547dbac4bca5ba6dfcab14e54">3795599</a></td><td><code>Trac #8450: update the output from a few plotting doctests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/518349ecb0eb4436e8033a988601e584aed10c2b">518349e</a></td><td><code>Trac #8450: pass imaginary tolerance down through plot.options.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b46a44896ed8299d88127db278ea65e2da1b4a4">5b46a44</a></td><td><code>Trac #8450: remove imag_tol default from FastCallablePlotWrapper().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b66d2d19b48849a340131dbc7f55ef19df87682a">b66d2d1</a></td><td><code>Trac #8450: use CDF for symbolic expression fast-callables.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/67a321deb8f536af23a4aaf365f6708de3879358">67a321d</a></td><td><code>Trac #8450: catch more cases in setup_for_eval_on_grid.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/920db97ca2519dd423f0721ab348dab3496e9a05">920db97</a></td><td><code>Trac #8450: fix complex type error in real_nth_root().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fbea8c6209bd67ecde413d0d0ab4b51b4f2d1caa">fbea8c6</a></td><td><code>Trac #8450: add an example using "imaginary_tolerance" in plot().</code></td></tr></table>




---

archive/issue_comments_068813.json:
```json
{
    "body": "**Changing commit** from \"[d8e79086453876c2f1c43931590ffc94801fcaa1](https://github.com/sagemath/sagetrac-mirror/commit/d8e79086453876c2f1c43931590ffc94801fcaa1)\" to \"[fbea8c6209bd67ecde413d0d0ab4b51b4f2d1caa](https://github.com/sagemath/sagetrac-mirror/commit/fbea8c6209bd67ecde413d0d0ab4b51b4f2d1caa)\".",
    "created_at": "2021-10-21T00:29:30Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68813",
    "user": "https://github.com/orlitzky"
}
```

**Changing commit** from "[d8e79086453876c2f1c43931590ffc94801fcaa1](https://github.com/sagemath/sagetrac-mirror/commit/d8e79086453876c2f1c43931590ffc94801fcaa1)" to "[fbea8c6209bd67ecde413d0d0ab4b51b4f2d1caa](https://github.com/sagemath/sagetrac-mirror/commit/fbea8c6209bd67ecde413d0d0ab4b51b4f2d1caa)".



---

archive/issue_comments_068814.json:
```json
{
    "body": "**Changing dependencies** from \"#32234\" to \"\".",
    "created_at": "2021-10-21T00:29:30Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68814",
    "user": "https://github.com/orlitzky"
}
```

**Changing dependencies** from "#32234" to "".



---

archive/issue_events_059719.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-10-21T00:29:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59719"
}
```



---

archive/issue_events_059720.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-10-21T00:29:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59720"
}
```



---

archive/issue_comments_068815.json:
```json
{
    "body": "**Changing commit** from \"[fbea8c6209bd67ecde413d0d0ab4b51b4f2d1caa](https://github.com/sagemath/sagetrac-mirror/commit/fbea8c6209bd67ecde413d0d0ab4b51b4f2d1caa)\" to \"[5a70ea636d847f134e81c5619411aece0a87c4eb](https://github.com/sagemath/sagetrac-mirror/commit/5a70ea636d847f134e81c5619411aece0a87c4eb)\".",
    "created_at": "2021-11-03T12:31:23Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68815",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[fbea8c6209bd67ecde413d0d0ab4b51b4f2d1caa](https://github.com/sagemath/sagetrac-mirror/commit/fbea8c6209bd67ecde413d0d0ab4b51b4f2d1caa)" to "[5a70ea636d847f134e81c5619411aece0a87c4eb](https://github.com/sagemath/sagetrac-mirror/commit/5a70ea636d847f134e81c5619411aece0a87c4eb)".



---

archive/issue_comments_068816.json:
```json
{
    "body": "<a id='comment:31'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b47adf46d339255507197319788a33a8a8a616fb\">b47adf4</a></td><td><code>Trac #8450: use CDF for symbolic expression fast-callables.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b43bb83fb69fe41f0c3c4ff80026c87b741b57f\">8b43bb8</a></td><td><code>Trac #8450: catch more cases in setup_for_eval_on_grid.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/77ed41cf7d8a2f07ee874a2f05cabffaff83c3df\">77ed41c</a></td><td><code>Trac #8450: fix complex type error in real_nth_root().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5a70ea636d847f134e81c5619411aece0a87c4eb\">5a70ea6</a></td><td><code>Trac #8450: add an example using \"imaginary_tolerance\" in plot().</code></td></tr></table>\n",
    "created_at": "2021-11-03T12:31:23Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68816",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b47adf46d339255507197319788a33a8a8a616fb">b47adf4</a></td><td><code>Trac #8450: use CDF for symbolic expression fast-callables.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b43bb83fb69fe41f0c3c4ff80026c87b741b57f">8b43bb8</a></td><td><code>Trac #8450: catch more cases in setup_for_eval_on_grid.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/77ed41cf7d8a2f07ee874a2f05cabffaff83c3df">77ed41c</a></td><td><code>Trac #8450: fix complex type error in real_nth_root().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5a70ea636d847f134e81c5619411aece0a87c4eb">5a70ea6</a></td><td><code>Trac #8450: add an example using "imaginary_tolerance" in plot().</code></td></tr></table>




---

archive/issue_events_059721.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-11-03T12:39:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59721"
}
```



---

archive/issue_events_059722.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-11-03T12:39:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59722"
}
```



---

archive/issue_comments_068817.json:
```json
{
    "body": "<a id='comment:32'></a>\nThe `real_nth_root()` fix reveals a new issue that may arise in some cases: symbolic functions that are not prepared to receive \"real\" arguments of the form `x + 0*I`. But the fix is not so bad as you can see. And it should be rare, since most sage operations will try to coerce things to the expected domain (and no other doctests fail, of course). The \"mod\" operation in this cases is a bit special in that regard.",
    "created_at": "2021-11-03T12:39:13Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68817",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:32'></a>
The `real_nth_root()` fix reveals a new issue that may arise in some cases: symbolic functions that are not prepared to receive "real" arguments of the form `x + 0*I`. But the fix is not so bad as you can see. And it should be rare, since most sage operations will try to coerce things to the expected domain (and no other doctests fail, of course). The "mod" operation in this cases is a bit special in that regard.



---

archive/issue_comments_068818.json:
```json
{
    "body": "**Changing commit** from \"[5a70ea636d847f134e81c5619411aece0a87c4eb](https://github.com/sagemath/sagetrac-mirror/commit/5a70ea636d847f134e81c5619411aece0a87c4eb)\" to \"[7899e73a761477386be1334b230e1eb8182f4a2a](https://github.com/sagemath/sagetrac-mirror/commit/7899e73a761477386be1334b230e1eb8182f4a2a)\".",
    "created_at": "2021-12-03T10:14:29Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68818",
    "user": "https://github.com/dimpase"
}
```

**Changing commit** from "[5a70ea636d847f134e81c5619411aece0a87c4eb](https://github.com/sagemath/sagetrac-mirror/commit/5a70ea636d847f134e81c5619411aece0a87c4eb)" to "[7899e73a761477386be1334b230e1eb8182f4a2a](https://github.com/sagemath/sagetrac-mirror/commit/7899e73a761477386be1334b230e1eb8182f4a2a)".



---

archive/issue_comments_068819.json:
```json
{
    "body": "**Changing branch** from \"[u/mjo/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/8450)\" to \"[u/dimpase/rebased/mjo/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/rebased/mjo/ticket/8450)\".",
    "created_at": "2021-12-03T10:14:29Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68819",
    "user": "https://github.com/dimpase"
}
```

**Changing branch** from "[u/mjo/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/8450)" to "[u/dimpase/rebased/mjo/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/rebased/mjo/ticket/8450)".



---

archive/issue_comments_068820.json:
```json
{
    "body": "<a id='comment:33'></a>\nrebased branch, with one `\"\"\" -> r\"\"\"` change\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7899e73a761477386be1334b230e1eb8182f4a2a\">7899e73</a></td><td><code>Merge remote-tracking branch 'trac/develop' into u/mjo/ticket/8450</code></td></tr></table>\n",
    "created_at": "2021-12-03T10:14:29Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68820",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:33'></a>
rebased branch, with one `""" -> r"""` change

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7899e73a761477386be1334b230e1eb8182f4a2a">7899e73</a></td><td><code>Merge remote-tracking branch 'trac/develop' into u/mjo/ticket/8450</code></td></tr></table>




---

archive/issue_comments_068821.json:
```json
{
    "body": "<a id='comment:34'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2c086e2db74951d6f13066e30a43aa188e61e8e6\">2c086e2</a></td><td><code>add missing imports</code></td></tr></table>\n",
    "created_at": "2021-12-03T10:33:52Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68821",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2c086e2db74951d6f13066e30a43aa188e61e8e6">2c086e2</a></td><td><code>add missing imports</code></td></tr></table>




---

archive/issue_comments_068822.json:
```json
{
    "body": "**Changing commit** from \"[7899e73a761477386be1334b230e1eb8182f4a2a](https://github.com/sagemath/sagetrac-mirror/commit/7899e73a761477386be1334b230e1eb8182f4a2a)\" to \"[2c086e2db74951d6f13066e30a43aa188e61e8e6](https://github.com/sagemath/sagetrac-mirror/commit/2c086e2db74951d6f13066e30a43aa188e61e8e6)\".",
    "created_at": "2021-12-03T10:33:52Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68822",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7899e73a761477386be1334b230e1eb8182f4a2a](https://github.com/sagemath/sagetrac-mirror/commit/7899e73a761477386be1334b230e1eb8182f4a2a)" to "[2c086e2db74951d6f13066e30a43aa188e61e8e6](https://github.com/sagemath/sagetrac-mirror/commit/2c086e2db74951d6f13066e30a43aa188e61e8e6)".



---

archive/issue_comments_068823.json:
```json
{
    "body": "<a id='comment:35'></a>\nWanna test this more. The new branch works with 9.5.beta7",
    "created_at": "2021-12-03T10:35:46Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68823",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:35'></a>
Wanna test this more. The new branch works with 9.5.beta7



---

archive/issue_comments_068824.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2021-12-03T10:35:46Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68824",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_comments_068825.json:
```json
{
    "body": "<a id='comment:36'></a>\noff to the bots",
    "created_at": "2021-12-03T10:56:18Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68825",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'></a>
off to the bots



---

archive/issue_events_059723.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-12-03T10:56:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59723"
}
```



---

archive/issue_events_059724.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-12-03T10:56:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59724"
}
```



---

archive/issue_comments_068826.json:
```json
{
    "body": "<a id='comment:37'></a>\nDon't patchbots usually give higher priority to\n\"needs review\" than \"positive review\"?",
    "created_at": "2021-12-03T12:59:38Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68826",
    "user": "https://github.com/slel"
}
```

<a id='comment:37'></a>
Don't patchbots usually give higher priority to
"needs review" than "positive review"?



---

archive/issue_comments_068827.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [slelievre](#comment%3A37):\n> Don't patchbots usually give higher priority to\n> \"needs review\" than \"positive review\"?\n\nI meant buildbots",
    "created_at": "2021-12-03T13:06:55Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68827",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:38'></a>
Replying to [slelievre](#comment%3A37):
> Don't patchbots usually give higher priority to
> "needs review" than "positive review"?

I meant buildbots



---

archive/issue_comments_068828.json:
```json
{
    "body": "<a id='comment:39'></a>\nI missed that part of the developer guide.",
    "created_at": "2021-12-03T23:53:21Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68828",
    "user": "https://github.com/slel"
}
```

<a id='comment:39'></a>
I missed that part of the developer guide.



---

archive/issue_events_059725.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-12-27T13:03:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "minor",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59725"
}
```



---

archive/issue_events_059726.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-12-27T13:03:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59726"
}
```



---

archive/issue_events_059727.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-04T22:54:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59727"
}
```



---

archive/issue_events_059728.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-04T22:54:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59728"
}
```



---

archive/issue_comments_068829.json:
```json
{
    "body": "<a id='comment:41'></a>\nOn OSX:\n\n```\n**********************************************************************\nFile \"src/sage/plot/plot.py\", line 3943, in sage.plot.plot.?\nFailed example:\n    generate_plot_points(sin(x).function(x), (-pi, pi), randomize=False)\nExpected:\n    [(-3.141592653589793, -1.2246...e-16), (-2.748893571891069,\n    -0.3826834323650899), (-2.356194490192345, -0.707106781186547...),\n    (-2.1598449493429825, -0.831469612302545...), (-1.9634954084936207,\n    -0.9238795325112867), (-1.7671458676442586, -0.9807852804032304),\n    (-1.5707963267948966, -1.0), (-1.3744467859455345,\n    -0.9807852804032304), (-1.1780972450961724, -0.9238795325112867),\n    (-0.9817477042468103, -0.831469612302545...), (-0.7853981633974483,\n    -0.707106781186547...), (-0.39269908169872414, -0.3826834323650898),\n    (0.0, 0.0), (0.39269908169872414, 0.3826834323650898),\n    (0.7853981633974483, 0.707106781186547...), (0.9817477042468103,\n    0.831469612302545...), (1.1780972450961724, 0.9238795325112867),\n    (1.3744467859455345, 0.9807852804032304), (1.5707963267948966, 1.0),\n    (1.7671458676442586, 0.9807852804032304), (1.9634954084936207,\n    0.9238795325112867), (2.1598449493429825, 0.831469612302545...),\n    (2.356194490192345, 0.707106781186547...), (2.748893571891069,\n    0.3826834323650899), (3.141592653589793, 1.2246...e-16)]\nGot:\n    [(-3.141592653589793, -1.2246467991473532e-16),\n     (-2.748893571891069, -0.38268343236508984),\n     (-2.356194490192345, -0.7071067811865476),\n     (-2.1598449493429825, -0.8314696123025455),\n     (-1.9634954084936207, -0.9238795325112867),\n     (-1.7671458676442586, -0.9807852804032304),\n     (-1.5707963267948966, -1.0),\n     (-1.3744467859455345, -0.9807852804032304),\n     (-1.1780972450961724, -0.9238795325112867),\n     (-0.9817477042468103, -0.8314696123025451),\n     (-0.7853981633974483, -0.7071067811865475),\n     (-0.39269908169872414, -0.3826834323650898),\n     (0.0, 0.0),\n     (0.39269908169872414, 0.3826834323650898),\n     (0.7853981633974483, 0.7071067811865475),\n     (0.9817477042468103, 0.8314696123025451),\n     (1.1780972450961724, 0.9238795325112867),\n     (1.3744467859455345, 0.9807852804032304),\n     (1.5707963267948966, 1.0),\n     (1.7671458676442586, 0.9807852804032304),\n     (1.9634954084936207, 0.9238795325112867),\n     (2.1598449493429825, 0.8314696123025455),\n     (2.356194490192345, 0.7071067811865476),\n     (2.748893571891069, 0.38268343236508984),\n     (3.141592653589793, 1.2246467991473532e-16)]\n**********************************************************************\n1 item had failures:\n   1 of  44 in sage.plot.plot.?\n    [464 tests, 1 failure, 64.40 s]\n----------------------------------------------------------------------\nsage -t --long --random-seed=70775727671966200967886888406969327388 src/sage/plot/plot.py  # 1 doctest failed\n----------------------------------------------------------------------\n```",
    "created_at": "2022-01-04T22:54:33Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68829",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:41'></a>
On OSX:

```
**********************************************************************
File "src/sage/plot/plot.py", line 3943, in sage.plot.plot.?
Failed example:
    generate_plot_points(sin(x).function(x), (-pi, pi), randomize=False)
Expected:
    [(-3.141592653589793, -1.2246...e-16), (-2.748893571891069,
    -0.3826834323650899), (-2.356194490192345, -0.707106781186547...),
    (-2.1598449493429825, -0.831469612302545...), (-1.9634954084936207,
    -0.9238795325112867), (-1.7671458676442586, -0.9807852804032304),
    (-1.5707963267948966, -1.0), (-1.3744467859455345,
    -0.9807852804032304), (-1.1780972450961724, -0.9238795325112867),
    (-0.9817477042468103, -0.831469612302545...), (-0.7853981633974483,
    -0.707106781186547...), (-0.39269908169872414, -0.3826834323650898),
    (0.0, 0.0), (0.39269908169872414, 0.3826834323650898),
    (0.7853981633974483, 0.707106781186547...), (0.9817477042468103,
    0.831469612302545...), (1.1780972450961724, 0.9238795325112867),
    (1.3744467859455345, 0.9807852804032304), (1.5707963267948966, 1.0),
    (1.7671458676442586, 0.9807852804032304), (1.9634954084936207,
    0.9238795325112867), (2.1598449493429825, 0.831469612302545...),
    (2.356194490192345, 0.707106781186547...), (2.748893571891069,
    0.3826834323650899), (3.141592653589793, 1.2246...e-16)]
Got:
    [(-3.141592653589793, -1.2246467991473532e-16),
     (-2.748893571891069, -0.38268343236508984),
     (-2.356194490192345, -0.7071067811865476),
     (-2.1598449493429825, -0.8314696123025455),
     (-1.9634954084936207, -0.9238795325112867),
     (-1.7671458676442586, -0.9807852804032304),
     (-1.5707963267948966, -1.0),
     (-1.3744467859455345, -0.9807852804032304),
     (-1.1780972450961724, -0.9238795325112867),
     (-0.9817477042468103, -0.8314696123025451),
     (-0.7853981633974483, -0.7071067811865475),
     (-0.39269908169872414, -0.3826834323650898),
     (0.0, 0.0),
     (0.39269908169872414, 0.3826834323650898),
     (0.7853981633974483, 0.7071067811865475),
     (0.9817477042468103, 0.8314696123025451),
     (1.1780972450961724, 0.9238795325112867),
     (1.3744467859455345, 0.9807852804032304),
     (1.5707963267948966, 1.0),
     (1.7671458676442586, 0.9807852804032304),
     (1.9634954084936207, 0.9238795325112867),
     (2.1598449493429825, 0.8314696123025455),
     (2.356194490192345, 0.7071067811865476),
     (2.748893571891069, 0.38268343236508984),
     (3.141592653589793, 1.2246467991473532e-16)]
**********************************************************************
1 item had failures:
   1 of  44 in sage.plot.plot.?
    [464 tests, 1 failure, 64.40 s]
----------------------------------------------------------------------
sage -t --long --random-seed=70775727671966200967886888406969327388 src/sage/plot/plot.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

archive/issue_comments_068830.json:
```json
{
    "body": "<a id='comment:42'></a>\nHow about adding `# abs tol 1e-16` or using\nthe following output for the doctest:\n\n```\n    [(-3.141592653589793, -1.2246...e-16),\n     (-2.748893571891069, -0.382683432365089...),\n     (-2.356194490192345, -0.707106781186547...),\n     (-2.1598449493429825, -0.831469612302545...),\n     (-1.9634954084936207, -0.9238795325112867),\n     (-1.7671458676442586, -0.9807852804032304),\n     (-1.5707963267948966, -1.0),\n     (-1.3744467859455345, -0.9807852804032304),\n     (-1.1780972450961724, -0.9238795325112867),\n     (-0.9817477042468103, -0.831469612302545...),\n     (-0.7853981633974483, -0.707106781186547...),\n     (-0.39269908169872414, -0.3826834323650898),\n     (0.0, 0.0),\n     (0.39269908169872414, 0.3826834323650898),\n     (0.7853981633974483, 0.707106781186547...),\n     (0.9817477042468103, 0.831469612302545...),\n     (1.1780972450961724, 0.9238795325112867),\n     (1.3744467859455345, 0.9807852804032304),\n     (1.5707963267948966, 1.0),\n     (1.7671458676442586, 0.9807852804032304),\n     (1.9634954084936207, 0.9238795325112867),\n     (2.1598449493429825, 0.831469612302545...),\n     (2.356194490192345, 0.707106781186547...),\n     (2.748893571891069, 0.382683432365089...),\n     (3.141592653589793, 1.2246...e-16)]\n```",
    "created_at": "2022-01-05T04:59:50Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68830",
    "user": "https://github.com/slel"
}
```

<a id='comment:42'></a>
How about adding `# abs tol 1e-16` or using
the following output for the doctest:

```
    [(-3.141592653589793, -1.2246...e-16),
     (-2.748893571891069, -0.382683432365089...),
     (-2.356194490192345, -0.707106781186547...),
     (-2.1598449493429825, -0.831469612302545...),
     (-1.9634954084936207, -0.9238795325112867),
     (-1.7671458676442586, -0.9807852804032304),
     (-1.5707963267948966, -1.0),
     (-1.3744467859455345, -0.9807852804032304),
     (-1.1780972450961724, -0.9238795325112867),
     (-0.9817477042468103, -0.831469612302545...),
     (-0.7853981633974483, -0.707106781186547...),
     (-0.39269908169872414, -0.3826834323650898),
     (0.0, 0.0),
     (0.39269908169872414, 0.3826834323650898),
     (0.7853981633974483, 0.707106781186547...),
     (0.9817477042468103, 0.831469612302545...),
     (1.1780972450961724, 0.9238795325112867),
     (1.3744467859455345, 0.9807852804032304),
     (1.5707963267948966, 1.0),
     (1.7671458676442586, 0.9807852804032304),
     (1.9634954084936207, 0.9238795325112867),
     (2.1598449493429825, 0.831469612302545...),
     (2.356194490192345, 0.707106781186547...),
     (2.748893571891069, 0.382683432365089...),
     (3.141592653589793, 1.2246...e-16)]
```



---

archive/issue_comments_068831.json:
```json
{
    "body": "<a id='comment:43'></a>\nAlso, the blank line after an example or test block\nis not needed if it ends a docstring.",
    "created_at": "2022-01-05T05:08:44Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68831",
    "user": "https://github.com/slel"
}
```

<a id='comment:43'></a>
Also, the blank line after an example or test block
is not needed if it ends a docstring.



---

archive/issue_comments_068832.json:
```json
{
    "body": "<a id='comment:44'></a>\nI've reworked that doctest to check something useful (and added `abs tol`) instead of a specific blob of digits.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7feed3de81d12e1726e304403597c5a3c485f7a0\">7feed3d</a></td><td><code>Trac #8450: new fast-callable output wrapper for plotting.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82fc41c8c8b786aa09231738cdf323bf42475216\">82fc41c</a></td><td><code>Trac #8450: use fast_callable() in setup_for_eval_on_grid().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1344e0860b811cea7cdda303ff87fdbc07cc496\">f1344e0</a></td><td><code>Trac #8450: update the output from a few plotting doctests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/988abe965883848bda5e180b0b397bb783a88409\">988abe9</a></td><td><code>Trac #8450: pass imaginary tolerance down through plot.options.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/633b3d346abefd46431ea4c1e1c9ea991c82958d\">633b3d3</a></td><td><code>Trac #8450: remove imag_tol default from FastCallablePlotWrapper().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ee9ddfd66177c64e90f7ee095f89b4e1526194a\">3ee9ddf</a></td><td><code>Trac #8450: use CDF for symbolic expression fast-callables.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7b80e0f7ddaf1fd456f3ad392e4f3df4986fc49b\">7b80e0f</a></td><td><code>Trac #8450: catch more cases in setup_for_eval_on_grid.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4d6312c3f7cb6ab7e2f408b5c051c926f76dc48f\">4d6312c</a></td><td><code>Trac #8450: fix complex type error in real_nth_root().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3cbfd72bd8aca04ba8e92968c3d83e829f8cb04\">a3cbfd7</a></td><td><code>Trac #8450: add an example using \"imaginary_tolerance\" in plot().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/25db6da5ba53b396ba40f41c03e36633a83871c4\">25db6da</a></td><td><code>Trac #8450: replace a flaky test.</code></td></tr></table>\n",
    "created_at": "2022-01-05T15:31:11Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68832",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:44'></a>
I've reworked that doctest to check something useful (and added `abs tol`) instead of a specific blob of digits.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7feed3de81d12e1726e304403597c5a3c485f7a0">7feed3d</a></td><td><code>Trac #8450: new fast-callable output wrapper for plotting.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82fc41c8c8b786aa09231738cdf323bf42475216">82fc41c</a></td><td><code>Trac #8450: use fast_callable() in setup_for_eval_on_grid().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1344e0860b811cea7cdda303ff87fdbc07cc496">f1344e0</a></td><td><code>Trac #8450: update the output from a few plotting doctests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/988abe965883848bda5e180b0b397bb783a88409">988abe9</a></td><td><code>Trac #8450: pass imaginary tolerance down through plot.options.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/633b3d346abefd46431ea4c1e1c9ea991c82958d">633b3d3</a></td><td><code>Trac #8450: remove imag_tol default from FastCallablePlotWrapper().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ee9ddfd66177c64e90f7ee095f89b4e1526194a">3ee9ddf</a></td><td><code>Trac #8450: use CDF for symbolic expression fast-callables.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7b80e0f7ddaf1fd456f3ad392e4f3df4986fc49b">7b80e0f</a></td><td><code>Trac #8450: catch more cases in setup_for_eval_on_grid.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4d6312c3f7cb6ab7e2f408b5c051c926f76dc48f">4d6312c</a></td><td><code>Trac #8450: fix complex type error in real_nth_root().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3cbfd72bd8aca04ba8e92968c3d83e829f8cb04">a3cbfd7</a></td><td><code>Trac #8450: add an example using "imaginary_tolerance" in plot().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/25db6da5ba53b396ba40f41c03e36633a83871c4">25db6da</a></td><td><code>Trac #8450: replace a flaky test.</code></td></tr></table>




---

archive/issue_comments_068833.json:
```json
{
    "body": "**Changing commit** from \"[2c086e2db74951d6f13066e30a43aa188e61e8e6](https://github.com/sagemath/sagetrac-mirror/commit/2c086e2db74951d6f13066e30a43aa188e61e8e6)\" to \"[25db6da5ba53b396ba40f41c03e36633a83871c4](https://github.com/sagemath/sagetrac-mirror/commit/25db6da5ba53b396ba40f41c03e36633a83871c4)\".",
    "created_at": "2022-01-05T15:31:11Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68833",
    "user": "https://github.com/orlitzky"
}
```

**Changing commit** from "[2c086e2db74951d6f13066e30a43aa188e61e8e6](https://github.com/sagemath/sagetrac-mirror/commit/2c086e2db74951d6f13066e30a43aa188e61e8e6)" to "[25db6da5ba53b396ba40f41c03e36633a83871c4](https://github.com/sagemath/sagetrac-mirror/commit/25db6da5ba53b396ba40f41c03e36633a83871c4)".



---

archive/issue_events_059729.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-01-05T15:31:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59729"
}
```



---

archive/issue_events_059730.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-01-05T15:31:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59730"
}
```



---

archive/issue_comments_068834.json:
```json
{
    "body": "**Changing branch** from \"[u/dimpase/rebased/mjo/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/rebased/mjo/ticket/8450)\" to \"[u/mjo/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/8450)\".",
    "created_at": "2022-01-05T15:31:11Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68834",
    "user": "https://github.com/orlitzky"
}
```

**Changing branch** from "[u/dimpase/rebased/mjo/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/rebased/mjo/ticket/8450)" to "[u/mjo/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/8450)".



---

archive/issue_events_059731.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-01-06T11:43:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59731"
}
```



---

archive/issue_events_059732.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-01-06T11:43:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59732"
}
```



---

archive/issue_comments_068835.json:
```json
{
    "body": "<a id='comment:45'></a>\nlgtm",
    "created_at": "2022-01-06T11:43:28Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68835",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:45'></a>
lgtm



---

archive/issue_comments_068836.json:
```json
{
    "body": "<a id='comment:46'></a>\nClass `FastCallablePlotWrapper`, method `__call__`,\ntest block needs double-colon:\n\n```diff\n-        Evaluation never fails and always returns a ``float``:\n+        Evaluation never fails and always returns a ``float``::\n```\n\nIt might also be worth checking why all patchbots\nreport pyflakes errors.",
    "created_at": "2022-01-08T06:08:00Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68836",
    "user": "https://github.com/slel"
}
```

<a id='comment:46'></a>
Class `FastCallablePlotWrapper`, method `__call__`,
test block needs double-colon:

```diff
-        Evaluation never fails and always returns a ``float``:
+        Evaluation never fails and always returns a ``float``::
```

It might also be worth checking why all patchbots
report pyflakes errors.



---

archive/issue_comments_068837.json:
```json
{
    "body": "**Changing commit** from \"[25db6da5ba53b396ba40f41c03e36633a83871c4](https://github.com/sagemath/sagetrac-mirror/commit/25db6da5ba53b396ba40f41c03e36633a83871c4)\" to \"[5f4e2fbd6d6c80f59bc833ff3d3a4071bd18dc0d](https://github.com/sagemath/sagetrac-mirror/commit/5f4e2fbd6d6c80f59bc833ff3d3a4071bd18dc0d)\".",
    "created_at": "2022-01-08T13:25:54Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68837",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[25db6da5ba53b396ba40f41c03e36633a83871c4](https://github.com/sagemath/sagetrac-mirror/commit/25db6da5ba53b396ba40f41c03e36633a83871c4)" to "[5f4e2fbd6d6c80f59bc833ff3d3a4071bd18dc0d](https://github.com/sagemath/sagetrac-mirror/commit/5f4e2fbd6d6c80f59bc833ff3d3a4071bd18dc0d)".



---

archive/issue_events_059733.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2022-01-08T13:25:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59733"
}
```



---

archive/issue_events_059734.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2022-01-08T13:25:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59734"
}
```



---

archive/issue_comments_068838.json:
```json
{
    "body": "<a id='comment:47'></a>\n**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f4e2fbd6d6c80f59bc833ff3d3a4071bd18dc0d\">5f4e2fb</a></td><td><code>Trac #8450: add a missing colon to a doctest.</code></td></tr></table>\n",
    "created_at": "2022-01-08T13:25:54Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68838",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:47'></a>
**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f4e2fbd6d6c80f59bc833ff3d3a4071bd18dc0d">5f4e2fb</a></td><td><code>Trac #8450: add a missing colon to a doctest.</code></td></tr></table>




---

archive/issue_comments_068839.json:
```json
{
    "body": "<a id='comment:48'></a>\nThanks, setting back to positive review as the last commit is trivial.\n\nI looked at the pyflakes failures, but the logs all say that everything is OK.",
    "created_at": "2022-01-08T13:27:16Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68839",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:48'></a>
Thanks, setting back to positive review as the last commit is trivial.

I looked at the pyflakes failures, but the logs all say that everything is OK.



---

archive/issue_events_059735.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-01-08T13:27:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59735"
}
```



---

archive/issue_events_059736.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-01-08T13:27:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59736"
}
```



---

archive/issue_comments_068840.json:
```json
{
    "body": "**Changing commit** from \"[5f4e2fbd6d6c80f59bc833ff3d3a4071bd18dc0d](https://github.com/sagemath/sagetrac-mirror/commit/5f4e2fbd6d6c80f59bc833ff3d3a4071bd18dc0d)\" to \"[65316090c88f18dcaa8a1bc4db7965f806ea119f](https://github.com/sagemath/sagetrac-mirror/commit/65316090c88f18dcaa8a1bc4db7965f806ea119f)\".",
    "created_at": "2022-01-08T15:07:33Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68840",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5f4e2fbd6d6c80f59bc833ff3d3a4071bd18dc0d](https://github.com/sagemath/sagetrac-mirror/commit/5f4e2fbd6d6c80f59bc833ff3d3a4071bd18dc0d)" to "[65316090c88f18dcaa8a1bc4db7965f806ea119f](https://github.com/sagemath/sagetrac-mirror/commit/65316090c88f18dcaa8a1bc4db7965f806ea119f)".



---

archive/issue_comments_068841.json:
```json
{
    "body": "<a id='comment:49'></a>\n**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65316090c88f18dcaa8a1bc4db7965f806ea119f\">6531609</a></td><td><code>Trac #8450: drop superfluous set_random_seed() call.</code></td></tr></table>\n",
    "created_at": "2022-01-08T15:07:33Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68841",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>
**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65316090c88f18dcaa8a1bc4db7965f806ea119f">6531609</a></td><td><code>Trac #8450: drop superfluous set_random_seed() call.</code></td></tr></table>




---

archive/issue_events_059737.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2022-01-08T15:07:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59737"
}
```



---

archive/issue_events_059738.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2022-01-08T15:07:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59738"
}
```



---

archive/issue_events_059739.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-01-08T15:08:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59739"
}
```



---

archive/issue_events_059740.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-01-08T15:08:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59740"
}
```



---

archive/issue_comments_068842.json:
```json
{
    "body": "<a id='comment:50'></a>\nAlso deleted a `set_random_seed()` call from a doctest that we don't need to add any more.",
    "created_at": "2022-01-08T15:08:09Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68842",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:50'></a>
Also deleted a `set_random_seed()` call from a doctest that we don't need to add any more.



---

archive/issue_events_059741.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2022-01-30T15:39:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59741"
}
```



---

archive/issue_events_059742.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2022-01-30T15:39:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59742"
}
```



---

archive/issue_comments_068843.json:
```json
{
    "body": "<a id='comment:51'></a>\nSetting milestone to 9.6 now that 9.5 is out.",
    "created_at": "2022-01-30T15:39:13Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68843",
    "user": "https://github.com/slel"
}
```

<a id='comment:51'></a>
Setting milestone to 9.6 now that 9.5 is out.



---

archive/issue_comments_068844.json:
```json
{
    "body": "**Changing branch** from \"[u/mjo/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/8450)\" to \"[65316090c88f18dcaa8a1bc4db7965f806ea119f](https://github.com/sagemath/sagetrac-mirror/commit/65316090c88f18dcaa8a1bc4db7965f806ea119f)\".",
    "created_at": "2022-01-31T23:32:07Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68844",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mjo/ticket/8450](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/8450)" to "[65316090c88f18dcaa8a1bc4db7965f806ea119f](https://github.com/sagemath/sagetrac-mirror/commit/65316090c88f18dcaa8a1bc4db7965f806ea119f)".



---

archive/issue_events_059743.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-31T23:32:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59743"
}
```



---

archive/issue_events_059744.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "0222526fb8646de09e5813efd10ecebe71a21646",
    "created_at": "2022-01-31T23:32:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8450#event-59744"
}
```



---

archive/issue_comments_068845.json:
```json
{
    "body": "**Changing commit** from \"[65316090c88f18dcaa8a1bc4db7965f806ea119f](https://github.com/sagemath/sagetrac-mirror/commit/65316090c88f18dcaa8a1bc4db7965f806ea119f)\" to \"\".",
    "created_at": "2022-02-18T12:52:32Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68845",
    "user": "https://github.com/kcrisman"
}
```

**Changing commit** from "[65316090c88f18dcaa8a1bc4db7965f806ea119f](https://github.com/sagemath/sagetrac-mirror/commit/65316090c88f18dcaa8a1bc4db7965f806ea119f)" to "".



---

archive/issue_comments_068846.json:
```json
{
    "body": "<a id='comment:53'></a>\nThanks for this fix, it will be very helpful!",
    "created_at": "2022-02-18T12:52:32Z",
    "issue": "https://github.com/sagemath/sage/issues/8450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8450#issuecomment-68846",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:53'></a>
Thanks for this fix, it will be very helpful!
