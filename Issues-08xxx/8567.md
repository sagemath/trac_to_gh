# Issue 8567: Change iconv so it builds on Cygwin and Solaris only

archive/issues_008567.json:
```json
{
    "body": "Since iconv was added to Sage (#8432) as a standard package (needed due to Karl-Dieter Crisman updating R in #6532 whilst overlooking the warning message from the configure script and without testing on Solaris), there have been some problems on Fedora and OpenSuse which look to be related to problems building gd when there are two copies of iconv to be found on the system. Since there is an option to gd's configure script specify the location of the iconv that seemed the most logical option. However, that did not work, so changing iconv to only build on Cygwin and Solaris seemed the most logical. \n\nDave \n\n**Assignee:** drkirkby\n\n**CC:**  @kcrisman\n\n**Author:** David Kirkby\n\n**Reviewer:** Jaap Spies, Florent Hivert\n\n**Merged:** sage-4.3.5\n\nIssue created by migration from https://trac.sagemath.org/ticket/8567\n\n",
    "closed_at": "2010-03-29T22:08:20Z",
    "created_at": "2010-03-20T14:21:49Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3.5",
    "title": "Change iconv so it builds on Cygwin and Solaris only",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/8567",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```
Since iconv was added to Sage (#8432) as a standard package (needed due to Karl-Dieter Crisman updating R in #6532 whilst overlooking the warning message from the configure script and without testing on Solaris), there have been some problems on Fedora and OpenSuse which look to be related to problems building gd when there are two copies of iconv to be found on the system. Since there is an option to gd's configure script specify the location of the iconv that seemed the most logical option. However, that did not work, so changing iconv to only build on Cygwin and Solaris seemed the most logical. 

Dave 

**Assignee:** drkirkby

**CC:**  @kcrisman

**Author:** David Kirkby

**Reviewer:** Jaap Spies, Florent Hivert

**Merged:** sage-4.3.5

Issue created by migration from https://trac.sagemath.org/ticket/8567





---

archive/issue_comments_070286.json:
```json
{
    "body": "<a id='comment:1'></a>\n--with-libiconv-prefix=SAGE_LOCAL\n\ndoes not work for me on Fedora 12 64 bit.\n\n\n```\nIt was created by GD configure 2.0.35, which was\ngenerated by GNU Autoconf 2.61.  Invocation command line was\n\n  $ ./configure --prefix=/home/jaap/downloads/sage-4.3.4.rc0/local --without-jpeg --with-libiconv-prefix=/home/jaap/downloads/sage-4.3.4.rc0/local --without-x --with-zlib=/home/jaap/downloads/sage-4.3.4.rc0/local --with-freetype=/home/jaap/downloads/sage-4.3.4.rc0/local --without-xpm\n\n```\n\n```\ngcc -fPIC -g -I/home/jaap/downloads/sage-4.3.4.rc0/local/include -I/home/jaap/downloads/sage-4.3.4.rc0/local/include/freetype2/ -Wl,--rpath -Wl,/home/jaap/downloads/sage-4.3.4.rc0/local/lib -o .libs/annotate annotate.o  -L/home/jaap/downloads/sage-4.3.4.rc0/local/lib ./.libs/libgd.so -lfontconfig /home/jaap/downloads/sage-4.3.4.rc0/local/lib/libfreetype.so /home/jaap/downloads/sage-4.3.4.rc0/local/lib/libpng12.so -lz -lm -Wl,--rpath -Wl,/home/jaap/downloads/sage-4.3.4.rc0/local/lib\n./.libs/libgd.so: undefined reference to `libiconv'\n./.libs/libgd.so: undefined reference to `libiconv_close'\n./.libs/libgd.so: undefined reference to `libiconv_open'\ncollect2: ld returned 1 exit status\n\n```\n\n\nJaap",
    "created_at": "2010-03-20T16:29:22Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70286",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:1'></a>
--with-libiconv-prefix=SAGE_LOCAL

does not work for me on Fedora 12 64 bit.


```
It was created by GD configure 2.0.35, which was
generated by GNU Autoconf 2.61.  Invocation command line was

  $ ./configure --prefix=/home/jaap/downloads/sage-4.3.4.rc0/local --without-jpeg --with-libiconv-prefix=/home/jaap/downloads/sage-4.3.4.rc0/local --without-x --with-zlib=/home/jaap/downloads/sage-4.3.4.rc0/local --with-freetype=/home/jaap/downloads/sage-4.3.4.rc0/local --without-xpm

```

```
gcc -fPIC -g -I/home/jaap/downloads/sage-4.3.4.rc0/local/include -I/home/jaap/downloads/sage-4.3.4.rc0/local/include/freetype2/ -Wl,--rpath -Wl,/home/jaap/downloads/sage-4.3.4.rc0/local/lib -o .libs/annotate annotate.o  -L/home/jaap/downloads/sage-4.3.4.rc0/local/lib ./.libs/libgd.so -lfontconfig /home/jaap/downloads/sage-4.3.4.rc0/local/lib/libfreetype.so /home/jaap/downloads/sage-4.3.4.rc0/local/lib/libpng12.so -lz -lm -Wl,--rpath -Wl,/home/jaap/downloads/sage-4.3.4.rc0/local/lib
./.libs/libgd.so: undefined reference to `libiconv'
./.libs/libgd.so: undefined reference to `libiconv_close'
./.libs/libgd.so: undefined reference to `libiconv_open'
collect2: ld returned 1 exit status

```


Jaap



---

archive/issue_comments_070287.json:
```json
{
    "body": "<a id='comment:2'></a>\nmoving /usr/bin/iconv and /usr/include/iconv.h out of the way made it possible to build\ngd\n\nSo nothing wrong with the libiconv in SAGE_LOCAL\n\nJaap",
    "created_at": "2010-03-20T16:41:07Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70287",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:2'></a>
moving /usr/bin/iconv and /usr/include/iconv.h out of the way made it possible to build
gd

So nothing wrong with the libiconv in SAGE_LOCAL

Jaap



---

archive/issue_comments_070288.json:
```json
{
    "body": "Replying to [ticket:8567 drkirkby]:\n> Since iconv was added to Sage (#8432) as a standard package (needing due to someone updating R without checking it fully), there have been some problems on Fedora and OpenSuse which look to be related to problems building gd when there are two copies of iconv to be found on the system. \n\n\nFirst of all I have the same problem on Gentoo. Ther is also a report of someone having the same problem on Mandriva.\n\nI manage to get it work by the following workaround:\nI replaced\n\n```\n$MAKE\n``` \nby\n\n```\nLIBICONV=\"$SAGE_LOCAL\"/lib/libiconv.so $MAKE\n```\nin spkg-install. I've no idea how robust this workaround is. I posted a spkg with the fix.\n\nFlorent",
    "created_at": "2010-03-20T17:12:02Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70288",
    "user": "https://github.com/hivert"
}
```

Replying to [ticket:8567 drkirkby]:
> Since iconv was added to Sage (#8432) as a standard package (needing due to someone updating R without checking it fully), there have been some problems on Fedora and OpenSuse which look to be related to problems building gd when there are two copies of iconv to be found on the system. 


First of all I have the same problem on Gentoo. Ther is also a report of someone having the same problem on Mandriva.

I manage to get it work by the following workaround:
I replaced

```
$MAKE
``` 
by

```
LIBICONV="$SAGE_LOCAL"/lib/libiconv.so $MAKE
```
in spkg-install. I've no idea how robust this workaround is. I posted a spkg with the fix.

Florent



---

archive/issue_comments_070289.json:
```json
{
    "body": "<a id='comment:4'></a>\nBy the way, in spkg-install, I think it should say \"--with-x=no\" rather than \"--without-x\", and the same for jpeg and xpm.",
    "created_at": "2010-03-20T17:13:58Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70289",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
By the way, in spkg-install, I think it should say "--with-x=no" rather than "--without-x", and the same for jpeg and xpm.



---

archive/issue_comments_070290.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [hivert](#comment%3A3):\n> First of all I have the same problem on Gentoo. Ther is also a report of someone having the same problem on Mandriva.\n> \n> I manage to get it work by the following workaround:\n> I replaced\n> \n> ```\n> $MAKE\n> ``` \n> by\n> \n> ```\n> LIBICONV=\"$SAGE_LOCAL\"/lib/libiconv.so $MAKE\n> ```\n> in spkg-install. I've no idea how robust this workaround is. I posted a spkg with the fix.\n\n\nSorry ! This spkg is completely broken... I'm trying to put a working one.\n\nFlorent",
    "created_at": "2010-03-20T17:34:55Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70290",
    "user": "https://github.com/hivert"
}
```

<a id='comment:5'></a>
Replying to [hivert](#comment%3A3):
> First of all I have the same problem on Gentoo. Ther is also a report of someone having the same problem on Mandriva.
> 
> I manage to get it work by the following workaround:
> I replaced
> 
> ```
> $MAKE
> ``` 
> by
> 
> ```
> LIBICONV="$SAGE_LOCAL"/lib/libiconv.so $MAKE
> ```
> in spkg-install. I've no idea how robust this workaround is. I posted a spkg with the fix.


Sorry ! This spkg is completely broken... I'm trying to put a working one.

Florent



---

archive/issue_comments_070291.json:
```json
{
    "body": "<a id='comment:6'></a>\nDon't put an spkg as attachment! Please give a link to the spkg.\n\nJaap",
    "created_at": "2010-03-20T17:38:46Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70291",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:6'></a>
Don't put an spkg as attachment! Please give a link to the spkg.

Jaap



---

archive/issue_comments_070292.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [jsp](#comment%3A6):\n> Don't put an spkg as attachment! Please give a link to the spkg.\n> \n> Jaap\n\n\nOops sorry ! My workaround does work actually. I find out that python distutils have the same problems much later...",
    "created_at": "2010-03-20T18:15:23Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70292",
    "user": "https://github.com/hivert"
}
```

<a id='comment:7'></a>
Replying to [jsp](#comment%3A6):
> Don't put an spkg as attachment! Please give a link to the spkg.
> 
> Jaap


Oops sorry ! My workaround does work actually. I find out that python distutils have the same problems much later...



---

archive/issue_comments_070293.json:
```json
{
    "body": "<a id='comment:8'></a>\nThis doesn't help on these systems (output from uname -a):\n\n```\nLinux eno 2.6.31.12-174.2.22.fc12.x86_64 #1 SMP Fri Feb 19 18:55:03 UTC 2010 x86_64 x86_64 x86_64 GNU/Linux\nLinux lena 2.6.31.12-174.2.19.fc12.x86_64 #1 SMP Thu Feb 11 07:07:16 UTC 2010 x86_64 x86_64 x86_64 GNU/Linux\n```\nI also don't know why it's about 50% bigger than the previous spkg.",
    "created_at": "2010-03-20T18:22:39Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70293",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
This doesn't help on these systems (output from uname -a):

```
Linux eno 2.6.31.12-174.2.22.fc12.x86_64 #1 SMP Fri Feb 19 18:55:03 UTC 2010 x86_64 x86_64 x86_64 GNU/Linux
Linux lena 2.6.31.12-174.2.19.fc12.x86_64 #1 SMP Thu Feb 11 07:07:16 UTC 2010 x86_64 x86_64 x86_64 GNU/Linux
```
I also don't know why it's about 50% bigger than the previous spkg.



---

archive/issue_comments_070294.json:
```json
{
    "body": "<a id='comment:9'></a>\nIn Fedora 12 x86_64 the installation of libiconv is not complete:\n\n\n```\n[root@vrede jaap]# find /usr/bin -name \"*iconv*\"\n/usr/bin/iconv.bak\n/usr/bin/piconv\n[root@vrede jaap]# find /usr/include -name \"*iconv*\"\n/usr/include/evolution-data-server-2.28/camel/camel-iconv.h\n/usr/include/evolution-data-server-2.28/libedataserver/e-iconv.h\n/usr/include/Qt3Support/q3iconview.h\n/usr/include/c++/4.4.3/gnu/gcj/convert/Output_iconv.h\n/usr/include/c++/4.4.3/gnu/gcj/convert/Input_iconv.h\n/usr/include/gtk-2.0/gtk/gtkiconview.h\n/usr/include/Qt/q3iconview.h\n/usr/include/xulrunner-sdk-1.9.1/system_wrappers_js/iconv.h\n/usr/include/xulrunner-sdk-1.9.1/system_wrappers/iconv.h\n/usr/include/iconv.h.bak\n[root@vrede jaap]# find /usr/lib -name \"*iconv*\"\n/usr/lib/ruby/1.8/xsd/iconvcharset.rb\n[root@vrede jaap]# \n\n```\n\nJaap",
    "created_at": "2010-03-20T19:46:46Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70294",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:9'></a>
In Fedora 12 x86_64 the installation of libiconv is not complete:


```
[root@vrede jaap]# find /usr/bin -name "*iconv*"
/usr/bin/iconv.bak
/usr/bin/piconv
[root@vrede jaap]# find /usr/include -name "*iconv*"
/usr/include/evolution-data-server-2.28/camel/camel-iconv.h
/usr/include/evolution-data-server-2.28/libedataserver/e-iconv.h
/usr/include/Qt3Support/q3iconview.h
/usr/include/c++/4.4.3/gnu/gcj/convert/Output_iconv.h
/usr/include/c++/4.4.3/gnu/gcj/convert/Input_iconv.h
/usr/include/gtk-2.0/gtk/gtkiconview.h
/usr/include/Qt/q3iconview.h
/usr/include/xulrunner-sdk-1.9.1/system_wrappers_js/iconv.h
/usr/include/xulrunner-sdk-1.9.1/system_wrappers/iconv.h
/usr/include/iconv.h.bak
[root@vrede jaap]# find /usr/lib -name "*iconv*"
/usr/lib/ruby/1.8/xsd/iconvcharset.rb
[root@vrede jaap]# 

```

Jaap



---

archive/issue_comments_070295.json:
```json
{
    "body": "<a id='comment:10'></a>\nI maybe manage to have something working by a hack. Could someone try the following spkg:\nhttp://sage.math.washington.edu/home/hivert/spkg/gd-2.0.35.p4.spkg",
    "created_at": "2010-03-20T23:00:57Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70295",
    "user": "https://github.com/hivert"
}
```

<a id='comment:10'></a>
I maybe manage to have something working by a hack. Could someone try the following spkg:
http://sage.math.washington.edu/home/hivert/spkg/gd-2.0.35.p4.spkg



---

archive/issue_comments_070296.json:
```json
{
    "body": "<a id='comment:11'></a>\nThat appears to work on the two systems I mentioned before.  I'll know for sure when a full Sage build is completed...",
    "created_at": "2010-03-20T23:14:35Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70296",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>
That appears to work on the two systems I mentioned before.  I'll know for sure when a full Sage build is completed...



---

archive/issue_comments_070297.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [hivert](#comment%3A3):\n> Replying to [ticket:8567 drkirkby]:\n> > Since iconv was added to Sage (#8432) as a standard package (needing due to someone updating R without checking it fully), there have been some problems on Fedora and OpenSuse which look to be related to problems building gd when there are two copies of iconv to be found on the system. \n\n> \n> First of all I have the same problem on Gentoo. Ther is also a report of someone having the same problem on Mandriva.\n> \n> I manage to get it work by the following workaround:\n> I replaced\n> \n> ```\n> $MAKE\n> ``` \n> by\n> \n> ```\n> LIBICONV=\"$SAGE_LOCAL\"/lib/libiconv.so $MAKE\n> ```\n> in spkg-install. I've no idea how robust this workaround is. I posted a spkg with the fix.\n> \n> Florent\n\n\nI've got no idea if setting LIBICOV shoudl be set, but if it is, the way to do it should be:\n\n```\nLIBICONV=\"$SAGE_LOCAL/lib/libiconv.so\"\n```\n\nand not\n\n```\nLIBICONV=\"$SAGE_LOCAL\"/lib/libiconv.so\n```\n\nDave",
    "created_at": "2010-03-20T23:29:48Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70297",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:12'></a>
Replying to [hivert](#comment%3A3):
> Replying to [ticket:8567 drkirkby]:
> > Since iconv was added to Sage (#8432) as a standard package (needing due to someone updating R without checking it fully), there have been some problems on Fedora and OpenSuse which look to be related to problems building gd when there are two copies of iconv to be found on the system. 

> 
> First of all I have the same problem on Gentoo. Ther is also a report of someone having the same problem on Mandriva.
> 
> I manage to get it work by the following workaround:
> I replaced
> 
> ```
> $MAKE
> ``` 
> by
> 
> ```
> LIBICONV="$SAGE_LOCAL"/lib/libiconv.so $MAKE
> ```
> in spkg-install. I've no idea how robust this workaround is. I posted a spkg with the fix.
> 
> Florent


I've got no idea if setting LIBICOV shoudl be set, but if it is, the way to do it should be:

```
LIBICONV="$SAGE_LOCAL/lib/libiconv.so"
```

and not

```
LIBICONV="$SAGE_LOCAL"/lib/libiconv.so
```

Dave



---

archive/issue_comments_070298.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [jsp](#comment%3A1):\n>   --with-libiconv-prefix=SAGE_LOCAL\n\n> \n> does not work for me on Fedora 12 64 bit.\n\n\n> Jaap\n> \n\n\nJaap, \n\nis that a typo in the trac ticket, or was it in the package? There should be a $ sign in front if SAGE_LOCAL.",
    "created_at": "2010-03-20T23:31:41Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70298",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:13'></a>
Replying to [jsp](#comment%3A1):
>   --with-libiconv-prefix=SAGE_LOCAL

> 
> does not work for me on Fedora 12 64 bit.


> Jaap
> 


Jaap, 

is that a typo in the trac ticket, or was it in the package? There should be a $ sign in front if SAGE_LOCAL.



---

archive/issue_comments_070299.json:
```json
{
    "body": "<a id='comment:14'></a>\nIf this gets too much of a mess, we could consider creating a ticket to get the R package reverted to the older version. I've cc'ed Karl-Dieter Crisman who updated R, whilst ignoring the warning from the configure script and not testing on Solaris. \n\nHopefully iconv can be sorted out, but if it can't be done properly, then reverting the R version is always an option, then iconv will not be needed. We could change iconv's spkg-install to simply exit with an exit code of 0. That would make it relatively easy to do, whilst leaving iconv in Sage to allow it to be sorted out properly prior to updating R. \n\nDave",
    "created_at": "2010-03-21T00:13:42Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70299",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:14'></a>
If this gets too much of a mess, we could consider creating a ticket to get the R package reverted to the older version. I've cc'ed Karl-Dieter Crisman who updated R, whilst ignoring the warning from the configure script and not testing on Solaris. 

Hopefully iconv can be sorted out, but if it can't be done properly, then reverting the R version is always an option, then iconv will not be needed. We could change iconv's spkg-install to simply exit with an exit code of 0. That would make it relatively easy to do, whilst leaving iconv in Sage to allow it to be sorted out properly prior to updating R. 

Dave



---

archive/issue_comments_070300.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-Since iconv was added to Sage (#8432) as a standard package (needing due to someone updating R without checking it fully), there have been some problems on Fedora and OpenSuse which look to be related to problems building gd when there are two copies of iconv to be found on the system. Since there is an option to specify the location of the iconv package in gd's configure script, this is probably worth doing, though it needs checking carefully. \n+Since iconv was added to Sage (#8432) as a standard package (needed due to Karl-Dieter Crisman updating R in #6532 whilst overlooking the warning message from the configure script and without testing on Solaris), there have been some problems on Fedora and OpenSuse which look to be related to problems building gd when there are two copies of iconv to be found on the system. Since there is an option to specify the location of the iconv package in gd's configure script, this is probably worth doing, though it needs checking carefully. \n \n Dave \n``````\n",
    "created_at": "2010-03-21T00:13:42Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70300",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-Since iconv was added to Sage (#8432) as a standard package (needing due to someone updating R without checking it fully), there have been some problems on Fedora and OpenSuse which look to be related to problems building gd when there are two copies of iconv to be found on the system. Since there is an option to specify the location of the iconv package in gd's configure script, this is probably worth doing, though it needs checking carefully. 
+Since iconv was added to Sage (#8432) as a standard package (needed due to Karl-Dieter Crisman updating R in #6532 whilst overlooking the warning message from the configure script and without testing on Solaris), there have been some problems on Fedora and OpenSuse which look to be related to problems building gd when there are two copies of iconv to be found on the system. Since there is an option to specify the location of the iconv package in gd's configure script, this is probably worth doing, though it needs checking carefully. 
 
 Dave 
``````




---

archive/issue_comments_070301.json:
```json
{
    "body": "**Changing assignee** from GeorgSWeber to drkirkby.",
    "created_at": "2010-03-21T00:13:42Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70301",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Changing assignee** from GeorgSWeber to drkirkby.



---

archive/issue_comments_070302.json:
```json
{
    "body": "<a id='comment:15'></a>\nFor me, the Sage build completed, but the documentation won't build because Sage doesn't start successfully:\n\n```\nTraceback (most recent call last):\n  File \"/home/palmieri/lena/sage-4.3.4.alpha1/local/bin/sphinx-build\", line 6, in <module>\n    import sage.all\n  File \"/home/palmieri/lena/sage-4.3.4.alpha1/local/lib/python2.6/site-packages/sage/all.py\", line 73, in <module>\n    from sage.matrix.all     import *\n  File \"/home/palmieri/lena/sage-4.3.4.alpha1/local/lib/python2.6/site-packages/sage/matrix/all.py\", line 1, in <module>\n    from matrix_space import MatrixSpace, is_MatrixSpace\n  File \"/home/palmieri/lena/sage-4.3.4.alpha1/local/lib/python2.6/site-packages/sage/matrix/matrix_space.py\", line 40, in <module>\n    import matrix_mod2_dense\nImportError: /home/palmieri/lena/sage-4.3.4.alpha1/local/lib/libgd.so.2: undefined symbol: libiconv\n```\nRunning\n\n```\nexport LIBICONV=\"$SAGE_LOCAL/lib/libiconv.so\"\n```\nright before running Sage doesn't help.",
    "created_at": "2010-03-21T01:12:09Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70302",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>
For me, the Sage build completed, but the documentation won't build because Sage doesn't start successfully:

```
Traceback (most recent call last):
  File "/home/palmieri/lena/sage-4.3.4.alpha1/local/bin/sphinx-build", line 6, in <module>
    import sage.all
  File "/home/palmieri/lena/sage-4.3.4.alpha1/local/lib/python2.6/site-packages/sage/all.py", line 73, in <module>
    from sage.matrix.all     import *
  File "/home/palmieri/lena/sage-4.3.4.alpha1/local/lib/python2.6/site-packages/sage/matrix/all.py", line 1, in <module>
    from matrix_space import MatrixSpace, is_MatrixSpace
  File "/home/palmieri/lena/sage-4.3.4.alpha1/local/lib/python2.6/site-packages/sage/matrix/matrix_space.py", line 40, in <module>
    import matrix_mod2_dense
ImportError: /home/palmieri/lena/sage-4.3.4.alpha1/local/lib/libgd.so.2: undefined symbol: libiconv
```
Running

```
export LIBICONV="$SAGE_LOCAL/lib/libiconv.so"
```
right before running Sage doesn't help.



---

archive/issue_comments_070303.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [jsp](#comment%3A2):\n> moving /usr/bin/iconv and /usr/include/iconv.h out of the way made it possible to build\n> gd\n> \n> So nothing wrong with the libiconv in SAGE_LOCAL\n> \n> Jaap\n> \n\n\nI had a discussion with a libtool developer about a similar issue once before. He said it is wrong to have two copies of a library, so the problem may be more fundamental. However, it is strange gd ignores the option to look for iconv in $SAGE_LOCAL. \n\nOne disadvantage of reverting R and not installing iconv is that iconv is needed to build gd on Cygwin, and there is effort into porting Sage to Cygwin. \n\nWe could consider only installing iconv on Solaris and Cygwin, though I'm tempted to suggest reverting R and getting the problem solved properly at a later date, rather than a hack now. \n\nDave",
    "created_at": "2010-03-21T02:05:44Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70303",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:16'></a>
Replying to [jsp](#comment%3A2):
> moving /usr/bin/iconv and /usr/include/iconv.h out of the way made it possible to build
> gd
> 
> So nothing wrong with the libiconv in SAGE_LOCAL
> 
> Jaap
> 


I had a discussion with a libtool developer about a similar issue once before. He said it is wrong to have two copies of a library, so the problem may be more fundamental. However, it is strange gd ignores the option to look for iconv in $SAGE_LOCAL. 

One disadvantage of reverting R and not installing iconv is that iconv is needed to build gd on Cygwin, and there is effort into porting Sage to Cygwin. 

We could consider only installing iconv on Solaris and Cygwin, though I'm tempted to suggest reverting R and getting the problem solved properly at a later date, rather than a hack now. 

Dave



---

archive/issue_comments_070304.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [jhpalmieri](#comment%3A15):\n> For me, the Sage build completed, but the documentation won't build because Sage doesn't start successfully:\n\n\nI got the same behavior on openSuSE 11.1 and Gentoo 1.12.9 both x86_64. The build appears to be complete but sage itself is broken.\n\nI don't know what to do and I've no more time to investigate. My vote is to revert R, remove gd and make as soon as possible a fix release until this is sorted out. We can't seriously make a release which is broken on half the distro.",
    "created_at": "2010-03-21T09:39:40Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70304",
    "user": "https://github.com/hivert"
}
```

<a id='comment:17'></a>
Replying to [jhpalmieri](#comment%3A15):
> For me, the Sage build completed, but the documentation won't build because Sage doesn't start successfully:


I got the same behavior on openSuSE 11.1 and Gentoo 1.12.9 both x86_64. The build appears to be complete but sage itself is broken.

I don't know what to do and I've no more time to investigate. My vote is to revert R, remove gd and make as soon as possible a fix release until this is sorted out. We can't seriously make a release which is broken on half the distro.



---

archive/issue_comments_070305.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [drkirkby](#comment%3A16):\n\n> I had a discussion with a libtool developer about a similar issue once before. He said it is wrong to have two copies of a library, so the problem may be more fundamental. However, it is strange gd ignores the option to look for iconv in $SAGE_LOCAL. \n> \n\n\nI'm not so sure anymore I didn't make another typo in spkg-install.\n\nI'll try again.\n\nJaap",
    "created_at": "2010-03-21T10:41:44Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70305",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:18'></a>
Replying to [drkirkby](#comment%3A16):

> I had a discussion with a libtool developer about a similar issue once before. He said it is wrong to have two copies of a library, so the problem may be more fundamental. However, it is strange gd ignores the option to look for iconv in $SAGE_LOCAL. 
> 


I'm not so sure anymore I didn't make another typo in spkg-install.

I'll try again.

Jaap



---

archive/issue_comments_070306.json:
```json
{
    "body": "<a id='comment:19'></a>\nAnother way to solve the fallout from updating R, will probably be to add\n\n```\nif [ \"x$UNAME\" != xSunOS ] && [ \"x$UNAME\" != xCYGWIN ] then ; \n  exit 0\nfi\n```\n\nto the top of the *iconv* spkg-install file. That's probably the simplest hack. This is untested and I don't have time to do this until around 2100 GMT today, so if someone beats me to it, go ahead and try it. **Make sure it is tested on both Solaris and Linux. It should build iconv on Solaris, but not on Linux**\n\nDave",
    "created_at": "2010-03-21T12:26:48Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70306",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:19'></a>
Another way to solve the fallout from updating R, will probably be to add

```
if [ "x$UNAME" != xSunOS ] && [ "x$UNAME" != xCYGWIN ] then ; 
  exit 0
fi
```

to the top of the *iconv* spkg-install file. That's probably the simplest hack. This is untested and I don't have time to do this until around 2100 GMT today, so if someone beats me to it, go ahead and try it. **Make sure it is tested on both Solaris and Linux. It should build iconv on Solaris, but not on Linux**

Dave



---

archive/issue_comments_070307.json:
```json
{
    "body": "<a id='comment:20'></a>\nAbout iconv(): according to the man pages the function is part of glibc\n\n```\nVERSIONS\n       This function is available in glibc since version 2.1.\n\nCONFORMING TO\n       POSIX.1-2001.\n\nSEE ALSO\n       iconv_close(3), iconv_open(3)\n\n\n```\n\nSo for most systems there is no need to have a local libiconv!\nLet's say only Solaris and Cygwin.\n\nJaap",
    "created_at": "2010-03-21T12:31:52Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70307",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:20'></a>
About iconv(): according to the man pages the function is part of glibc

```
VERSIONS
       This function is available in glibc since version 2.1.

CONFORMING TO
       POSIX.1-2001.

SEE ALSO
       iconv_close(3), iconv_open(3)


```

So for most systems there is no need to have a local libiconv!
Let's say only Solaris and Cygwin.

Jaap



---

archive/issue_comments_070308.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [drkirkby](#comment%3A19):\n> Another way to solve the fallout from updating R, will probably be to add\n> \n> ```\n> if [ \"x$UNAME\" != xSunOS ] && [ \"x$UNAME\" != xCYGWIN ] then ; \n>   exit 0\n> fi\n> ```\n> \n\n\nThis probably will cause trouble on Open Solaris.\n\nJaap",
    "created_at": "2010-03-21T12:46:01Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70308",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:21'></a>
Replying to [drkirkby](#comment%3A19):
> Another way to solve the fallout from updating R, will probably be to add
> 
> ```
> if [ "x$UNAME" != xSunOS ] && [ "x$UNAME" != xCYGWIN ] then ; 
>   exit 0
> fi
> ```
> 


This probably will cause trouble on Open Solaris.

Jaap



---

archive/issue_comments_070309.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [drkirkby](#comment%3A19):\n> Another way to solve the fallout from updating R, will probably be to add\n> \n> ```\n> if [ \"x$UNAME\" != xSunOS ] && [ \"x$UNAME\" != xCYGWIN ] then ; \n>   exit 0\n> fi\n> ```\n> \n> to the top of the *iconv* spkg-install file. That's probably the simplest hack. This is untested and I don't have time to do this until around 2100 GMT today, so if someone beats me to it, go ahead and try it. **Make sure it is tested on both Solaris and Linux. It should build iconv on Solaris, but not on Linux**\n> \n> Dave \n\n\nYes, I definitely prefer this way, too. The OpenSolaris topic may be solved later (what does $UNAME give there as output?), and it might be nice to remove any leftovers in \"$SAGE_ROOT/bin/\" from earlier (especially v3.4.3) Sage installs. Which might be tricky in a \"Sage upgrade\" use case. But never mind, the road to go is clear now!\n\nCheers,\nGeorg",
    "created_at": "2010-03-21T13:03:05Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70309",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:22'></a>
Replying to [drkirkby](#comment%3A19):
> Another way to solve the fallout from updating R, will probably be to add
> 
> ```
> if [ "x$UNAME" != xSunOS ] && [ "x$UNAME" != xCYGWIN ] then ; 
>   exit 0
> fi
> ```
> 
> to the top of the *iconv* spkg-install file. That's probably the simplest hack. This is untested and I don't have time to do this until around 2100 GMT today, so if someone beats me to it, go ahead and try it. **Make sure it is tested on both Solaris and Linux. It should build iconv on Solaris, but not on Linux**
> 
> Dave 


Yes, I definitely prefer this way, too. The OpenSolaris topic may be solved later (what does $UNAME give there as output?), and it might be nice to remove any leftovers in "$SAGE_ROOT/bin/" from earlier (especially v3.4.3) Sage installs. Which might be tricky in a "Sage upgrade" use case. But never mind, the road to go is clear now!

Cheers,
Georg



---

archive/issue_comments_070310.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [GeorgSWeber](#comment%3A22):\n> Replying to [drkirkby](#comment%3A19):\n> > Another way to solve the fallout from updating R, will probably be to add\n> > \n> > ```\n> > if [ \"x$UNAME\" != xSunOS ] && [ \"x$UNAME\" != xCYGWIN ] then ; \n> >   exit 0\n> > fi\n> > ```\n> > \n\n\n> \n> Yes, I definitely prefer this way, too. The OpenSolaris topic may be solved later (what does $UNAME give there as output?)\n\n\nSunOS\n\nRemoving local/bin/iconv, local/lib/libiconv.* and local/include/iconv.h made the\ngd spkg work on Fedora 12.\n\nJaap",
    "created_at": "2010-03-21T13:16:16Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70310",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:23'></a>
Replying to [GeorgSWeber](#comment%3A22):
> Replying to [drkirkby](#comment%3A19):
> > Another way to solve the fallout from updating R, will probably be to add
> > 
> > ```
> > if [ "x$UNAME" != xSunOS ] && [ "x$UNAME" != xCYGWIN ] then ; 
> >   exit 0
> > fi
> > ```
> > 


> 
> Yes, I definitely prefer this way, too. The OpenSolaris topic may be solved later (what does $UNAME give there as output?)


SunOS

Removing local/bin/iconv, local/lib/libiconv.* and local/include/iconv.h made the
gd spkg work on Fedora 12.

Jaap



---

archive/issue_comments_070311.json:
```json
{
    "body": "<a id='comment:24'></a>\nJaap, \n\nI don't have time to test it now (really am tied up), but if you can test on OpenSolaris, then make a decision whether iconv needs installing or not. \n\n```\ndrkirkby@kestrel:~$ uname -r\n5.10\n```\n\non Solaris 10, and \n\n```\ndrkirkby@hawk:~$ uname -r\n5.11\n```\n\non OpenSolaris (aka Solaris 11). So just put an additional clause if needed. \n\nThe -r option to uname is POSIX, so we can rely on that. Don't use 'uname -p' since\n\n* The i386 processor is used on Solaris 10 too. \n* -p is not a POSIX option to uname, so can cause hassles on other systems. \n\nAlso worth checking, in preference to this are whether the version of 'gd' in Sage is old and furthermore the 'gd' developers have fixed the bug that prevents '--with-libiconv-prefix' working properly. If so, consider updating gd. \n\nHad R been properly tested, none of this would have been necessary. \n\nWhen I wrote the iconv package, it clears out debris, like libraries and binaries, so there should be no need to do that again - just make sure the cleaning up is done before exiting. \n\nSince Jaap and I are looking to port Sage to OpenSolaris, we are not keen to introduce more problems for the future. Let's sort it out now. \n\nDave",
    "created_at": "2010-03-21T14:18:34Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70311",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:24'></a>
Jaap, 

I don't have time to test it now (really am tied up), but if you can test on OpenSolaris, then make a decision whether iconv needs installing or not. 

```
drkirkby@kestrel:~$ uname -r
5.10
```

on Solaris 10, and 

```
drkirkby@hawk:~$ uname -r
5.11
```

on OpenSolaris (aka Solaris 11). So just put an additional clause if needed. 

The -r option to uname is POSIX, so we can rely on that. Don't use 'uname -p' since

* The i386 processor is used on Solaris 10 too. 
* -p is not a POSIX option to uname, so can cause hassles on other systems. 

Also worth checking, in preference to this are whether the version of 'gd' in Sage is old and furthermore the 'gd' developers have fixed the bug that prevents '--with-libiconv-prefix' working properly. If so, consider updating gd. 

Had R been properly tested, none of this would have been necessary. 

When I wrote the iconv package, it clears out debris, like libraries and binaries, so there should be no need to do that again - just make sure the cleaning up is done before exiting. 

Since Jaap and I are looking to port Sage to OpenSolaris, we are not keen to introduce more problems for the future. Let's sort it out now. 

Dave



---

archive/issue_comments_070312.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [drkirkby](#comment%3A24):\n> Jaap, \n> \n> I don't have time to test it now (really am tied up), but if you can test on OpenSolaris, then make a decision whether iconv needs installing or not. \n> \n\n\nOpensolaris has it's own iconv included in glibc.\n\n\n> on OpenSolaris (aka Solaris 11). So just put an additional clause if needed. \n> \n\n\nYes we should put an extra test in\n\n> The -r option to uname is POSIX, so we can rely on that. Don't use 'uname -p' since\n> \n\n\nOk.\n\n>  * The i386 processor is used on Solaris 10 too. \n>  * -p is not a POSIX option to uname, so can cause hassles on other systems. \n \n> \n> Also worth checking, in preference to this are whether the version of 'gd' in Sage is old and furthermore the 'gd' developers have fixed the bug that prevents '--with-libiconv-prefix' working properly. If so, consider updating gd. \n> \n\n\nLet's go for the proposed option and leave alone the gd package for the moment.\n\n> Had R been properly tested, none of this would have been necessary. \n> \n\n\nYou are repeating your self :-)!\n\nMy proposal is you update the iconv spkg and I and evt. others review it.\n\nI think we can wait some more hours.\n\nJaap",
    "created_at": "2010-03-21T18:06:03Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70312",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:25'></a>
Replying to [drkirkby](#comment%3A24):
> Jaap, 
> 
> I don't have time to test it now (really am tied up), but if you can test on OpenSolaris, then make a decision whether iconv needs installing or not. 
> 


Opensolaris has it's own iconv included in glibc.


> on OpenSolaris (aka Solaris 11). So just put an additional clause if needed. 
> 


Yes we should put an extra test in

> The -r option to uname is POSIX, so we can rely on that. Don't use 'uname -p' since
> 


Ok.

>  * The i386 processor is used on Solaris 10 too. 
>  * -p is not a POSIX option to uname, so can cause hassles on other systems. 
 
> 
> Also worth checking, in preference to this are whether the version of 'gd' in Sage is old and furthermore the 'gd' developers have fixed the bug that prevents '--with-libiconv-prefix' working properly. If so, consider updating gd. 
> 


Let's go for the proposed option and leave alone the gd package for the moment.

> Had R been properly tested, none of this would have been necessary. 
> 


You are repeating your self :-)!

My proposal is you update the iconv spkg and I and evt. others review it.

I think we can wait some more hours.

Jaap



---

archive/issue_comments_070313.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [drkirkby](#comment%3A19):\n> Another way to solve the fallout from updating R, will probably be to add\n> \n\n```\n if [ \"x$UNAME\" != xSunOS ] && [ \"x$UNAME\" != xCYGWIN ] then ; \n   exit 0\n fi\n```\n> \n> to the top of the *iconv* spkg-install file. \n\n\nInformally (that is, I threw together a quick spkg), this works on at least one of the linux boxes I had troubles with before, and it also works on sage.math.  I haven't tested it on Solaris, and I probably won't have time to; I don't have access to a Windows/Cygwin machine.  I would suggest that the spkg-install file actually say \n\n```\nif [ \"x$UNAME\" != xSunOS ] && [ \"x$UNAME\" != xCYGWIN ] ; then\n  echo \"Not installing iconv -- on systems other than Solaris and Cygwin, use the system's iconv\"\n  exit 0\nfi\n```\nOr something like that -- I'm not sure exactly what the message should say.",
    "created_at": "2010-03-21T18:26:01Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70313",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:26'></a>
Replying to [drkirkby](#comment%3A19):
> Another way to solve the fallout from updating R, will probably be to add
> 

```
 if [ "x$UNAME" != xSunOS ] && [ "x$UNAME" != xCYGWIN ] then ; 
   exit 0
 fi
```
> 
> to the top of the *iconv* spkg-install file. 


Informally (that is, I threw together a quick spkg), this works on at least one of the linux boxes I had troubles with before, and it also works on sage.math.  I haven't tested it on Solaris, and I probably won't have time to; I don't have access to a Windows/Cygwin machine.  I would suggest that the spkg-install file actually say 

```
if [ "x$UNAME" != xSunOS ] && [ "x$UNAME" != xCYGWIN ] ; then
  echo "Not installing iconv -- on systems other than Solaris and Cygwin, use the system's iconv"
  exit 0
fi
```
Or something like that -- I'm not sure exactly what the message should say.



---

archive/issue_comments_070314.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [jhpalmieri](#comment%3A26):\n> Replying to [drkirkby](#comment%3A19):\n> > Another way to solve the fallout from updating R, will probably be to add\n> > \n\n```\n if [ \"x$UNAME\" != xSunOS ] && [ \"x$UNAME\" != xCYGWIN ] then ; \n   exit 0\n fi\n```\nThe \";\" should be before \"then\"..\n.\n\n```\nif [ \"x$UNAME\" != xSunOS ] && [ \"x$UNAME\" != xCYGWIN ] ; then\n  echo \"Not installing iconv -- on systems other than Solaris and Cygwin, use the system's iconv\"\n  exit 0\nfi\n```\n> Or something like that -- I'm not sure exactly what the message should say.\n\n\nI'm trying this on gentoo and it seems to work... I'm waiting for the build to finish.\n\nFlorent",
    "created_at": "2010-03-21T18:56:24Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70314",
    "user": "https://github.com/hivert"
}
```

<a id='comment:27'></a>
Replying to [jhpalmieri](#comment%3A26):
> Replying to [drkirkby](#comment%3A19):
> > Another way to solve the fallout from updating R, will probably be to add
> > 

```
 if [ "x$UNAME" != xSunOS ] && [ "x$UNAME" != xCYGWIN ] then ; 
   exit 0
 fi
```
The ";" should be before "then"..
.

```
if [ "x$UNAME" != xSunOS ] && [ "x$UNAME" != xCYGWIN ] ; then
  echo "Not installing iconv -- on systems other than Solaris and Cygwin, use the system's iconv"
  exit 0
fi
```
> Or something like that -- I'm not sure exactly what the message should say.


I'm trying this on gentoo and it seems to work... I'm waiting for the build to finish.

Florent



---

archive/issue_comments_070315.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-Since iconv was added to Sage (#8432) as a standard package (needed due to Karl-Dieter Crisman updating R in #6532 whilst overlooking the warning message from the configure script and without testing on Solaris), there have been some problems on Fedora and OpenSuse which look to be related to problems building gd when there are two copies of iconv to be found on the system. Since there is an option to specify the location of the iconv package in gd's configure script, this is probably worth doing, though it needs checking carefully. \n+Since iconv was added to Sage (#8432) as a standard package (needed due to Karl-Dieter Crisman updating R in #6532 whilst overlooking the warning message from the configure script and without testing on Solaris), there have been some problems on Fedora and OpenSuse which look to be related to problems building gd when there are two copies of iconv to be found on the system. Since there is an option to gd's configure script specify the location of the iconv that seemed the most logical option. However, that did not work, so changing iconv to only build on Cygwin and Solaris seemed the most logical. \n \n Dave \n``````\n",
    "created_at": "2010-03-21T19:07:21Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70315",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-Since iconv was added to Sage (#8432) as a standard package (needed due to Karl-Dieter Crisman updating R in #6532 whilst overlooking the warning message from the configure script and without testing on Solaris), there have been some problems on Fedora and OpenSuse which look to be related to problems building gd when there are two copies of iconv to be found on the system. Since there is an option to specify the location of the iconv package in gd's configure script, this is probably worth doing, though it needs checking carefully. 
+Since iconv was added to Sage (#8432) as a standard package (needed due to Karl-Dieter Crisman updating R in #6532 whilst overlooking the warning message from the configure script and without testing on Solaris), there have been some problems on Fedora and OpenSuse which look to be related to problems building gd when there are two copies of iconv to be found on the system. Since there is an option to gd's configure script specify the location of the iconv that seemed the most logical option. However, that did not work, so changing iconv to only build on Cygwin and Solaris seemed the most logical. 
 
 Dave 
``````




---

archive/issue_comments_070316.json:
```json
{
    "body": "<a id='comment:28'></a>\nI've change the title and description and are in the process of creating a package for others to review.",
    "created_at": "2010-03-21T19:07:21Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70316",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:28'></a>
I've change the title and description and are in the process of creating a package for others to review.



---

archive/issue_events_060952.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/drkirkby",
    "created_at": "2010-03-21T19:07:21Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "rename": {
        "from": "Specify the location of iconv for 'gd'",
        "to": "Change iconv so it builds on Cygwin and Solaris only"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8567#event-60952"
}
```



---

archive/issue_comments_070317.json:
```json
{
    "body": "**Author:** David Kirkby",
    "created_at": "2010-03-21T19:07:21Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70317",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Author:** David Kirkby



---

archive/issue_comments_070318.json:
```json
{
    "body": "<a id='comment:29'></a>\nI've stuck a package here: \n\nhttp://sage.math.washington.edu/home/kirkby/iconv/iconv-1.13.1.p0.spkg",
    "created_at": "2010-03-21T19:38:59Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70318",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:29'></a>
I've stuck a package here: 

http://sage.math.washington.edu/home/kirkby/iconv/iconv-1.13.1.p0.spkg



---

archive/issue_comments_070319.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [drkirkby](#comment%3A29):\n> I've stuck a package here: \n> \n> http://sage.math.washington.edu/home/kirkby/iconv/iconv-1.13.1.p0.spkg\n> \n\n\nI'll try it asap.\n\nJaap",
    "created_at": "2010-03-21T19:41:30Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70319",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:30'></a>
Replying to [drkirkby](#comment%3A29):
> I've stuck a package here: 
> 
> http://sage.math.washington.edu/home/kirkby/iconv/iconv-1.13.1.p0.spkg
> 


I'll try it asap.

Jaap



---

archive/issue_comments_070320.json:
```json
{
    "body": "Mercurial patch to ensure iconv builds on Solaris and Cygwin only",
    "created_at": "2010-03-21T19:44:14Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70320",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Mercurial patch to ensure iconv builds on Solaris and Cygwin only



---

archive/issue_events_060953.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/drkirkby",
    "created_at": "2010-03-21T19:47:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8567#event-60953"
}
```



---

archive/attachments_011103.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "iconv.patch",
    "asset_url": "tarball://root/attachments/ticket8567/iconv.patch",
    "created_at": "2010-03-21T19:47:32Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket8567/iconv.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```



---

archive/issue_comments_070321.json:
```json
{
    "body": "<a id='comment:31'></a>\n**Attachment:** [iconv.patch](https://github.com/sagemath/sage/files/ticket8567/iconv.patch)\n\nI've not tested this extensively, but it builds on Solaris and hopefully does not on Linux. I don't have time to do much testing, so others can. \n\nI don't have a Cygwin system set up.",
    "created_at": "2010-03-21T19:47:32Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70321",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:31'></a>
**Attachment:** [iconv.patch](https://github.com/sagemath/sage/files/ticket8567/iconv.patch)

I've not tested this extensively, but it builds on Solaris and hopefully does not on Linux. I don't have time to do much testing, so others can. 

I don't have a Cygwin system set up.



---

archive/issue_comments_070322.json:
```json
{
    "body": "<a id='comment:32'></a>\n************\nRemoving old iconv files if they exist\niconv will not be installed, as it is only installed on\nSolaris and Cygwin - see:\nhttps://github.com/sagemath/sage/issues/8567\n\nreal\t0m0.078\n\n```\ngcc version 4.4.3 20100127 (Red Hat 4.4.3-4) (GCC) \n****************************************s\nuser\t0m0.008s\nsys\t0m0.015s\nSuccessfully installed iconv-1.13.1.p0\n\n```\n\n\n```\necho \"Removing old iconv files if they exist\"\n# If iconv is updated, please double-check these are still necessary\n# and that there are no extra files added.\n\nrm -f $SAGE_LOCAL/bin/iconv  $SAGE_LOCAL/lib/charset.alias\nrm -f $SAGE_LOCAL/lib/*libiconv*  $SAGE_LOCAL/lib/libcharset*\nrm -f $SAGE_LOCAL/include/iconv.h  $SAGE_LOCAL/include/libcharset.h\nrm -f $SAGE_LOCAL/include/localcharset.h\nrm -rf  $SAGE_LOCAL/share/doc/libiconv\nrm -f $SAGE_LOCAL/share/man/man1/iconv* $SAGE_LOCAL/share/man/man3/iconv*\n\n\n```\n\nThis looks ok for me on Fedora (Linux in general?)\n\nThe Opensolaris issue is not resolved, but I think this deserves a positive review.\n\nJaap",
    "created_at": "2010-03-21T19:57:02Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70322",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:32'></a>
************
Removing old iconv files if they exist
iconv will not be installed, as it is only installed on
Solaris and Cygwin - see:
https://github.com/sagemath/sage/issues/8567

real	0m0.078

```
gcc version 4.4.3 20100127 (Red Hat 4.4.3-4) (GCC) 
****************************************s
user	0m0.008s
sys	0m0.015s
Successfully installed iconv-1.13.1.p0

```


```
echo "Removing old iconv files if they exist"
# If iconv is updated, please double-check these are still necessary
# and that there are no extra files added.

rm -f $SAGE_LOCAL/bin/iconv  $SAGE_LOCAL/lib/charset.alias
rm -f $SAGE_LOCAL/lib/*libiconv*  $SAGE_LOCAL/lib/libcharset*
rm -f $SAGE_LOCAL/include/iconv.h  $SAGE_LOCAL/include/libcharset.h
rm -f $SAGE_LOCAL/include/localcharset.h
rm -rf  $SAGE_LOCAL/share/doc/libiconv
rm -f $SAGE_LOCAL/share/man/man1/iconv* $SAGE_LOCAL/share/man/man3/iconv*


```

This looks ok for me on Fedora (Linux in general?)

The Opensolaris issue is not resolved, but I think this deserves a positive review.

Jaap



---

archive/issue_comments_070323.json:
```json
{
    "body": "**Reviewer:** Jaap Spies",
    "created_at": "2010-03-21T19:58:59Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70323",
    "user": "https://github.com/jaapspies"
}
```

**Reviewer:** Jaap Spies



---

archive/issue_comments_070324.json:
```json
{
    "body": "<a id='comment:34'></a>\nWith the spkg here, from a fresh Sage source:\n- iconv build is successfully skipped,\n- gd is successfully build\non openSuSE 11.1 and Gentoo 1.12.9. I'm waiting the whole build to finish, but it should be ok... I'll then agree with Jaap on positive review.\n\nThanks",
    "created_at": "2010-03-21T20:07:39Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70324",
    "user": "https://github.com/hivert"
}
```

<a id='comment:34'></a>
With the spkg here, from a fresh Sage source:
- iconv build is successfully skipped,
- gd is successfully build
on openSuSE 11.1 and Gentoo 1.12.9. I'm waiting the whole build to finish, but it should be ok... I'll then agree with Jaap on positive review.

Thanks



---

archive/issue_comments_070325.json:
```json
{
    "body": "**Changing reviewer** from \"Jaap Spies\" to \"Jaap Spies, Florent Hivert\".",
    "created_at": "2010-03-21T20:07:39Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70325",
    "user": "https://github.com/hivert"
}
```

**Changing reviewer** from "Jaap Spies" to "Jaap Spies, Florent Hivert".



---

archive/issue_comments_070326.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [hivert](#comment%3A34):\n> With the spkg here, from a fresh Sage source:\n> - iconv build is successfully skipped,\n> - gd is successfully build\n> on openSuSE 11.1 and Gentoo 1.12.9. I'm waiting the whole build to finish, but it should be ok... I'll then agree with Jaap on positive review.\n> \n> Thanks\n\n\nMy build finished successful, so let's do it! I leave it to you to give the positive review.\n\nJaap",
    "created_at": "2010-03-21T20:13:07Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70326",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:35'></a>
Replying to [hivert](#comment%3A34):
> With the spkg here, from a fresh Sage source:
> - iconv build is successfully skipped,
> - gd is successfully build
> on openSuSE 11.1 and Gentoo 1.12.9. I'm waiting the whole build to finish, but it should be ok... I'll then agree with Jaap on positive review.
> 
> Thanks


My build finished successful, so let's do it! I leave it to you to give the positive review.

Jaap



---

archive/issue_comments_070327.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [jsp](#comment%3A35):\n> My build finished successful, so let's do it! I leave it to you to give the positive review.\n\n\nMine too on openSuSE and gentoo. I'm ready to give positive review but should it be tested on Cygwin ? Unfortunately, I've no access to this kind of machine.\n\nCheers,\n\nFlorent",
    "created_at": "2010-03-21T21:42:28Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70327",
    "user": "https://github.com/hivert"
}
```

<a id='comment:36'></a>
Replying to [jsp](#comment%3A35):
> My build finished successful, so let's do it! I leave it to you to give the positive review.


Mine too on openSuSE and gentoo. I'm ready to give positive review but should it be tested on Cygwin ? Unfortunately, I've no access to this kind of machine.

Cheers,

Florent



---

archive/issue_comments_070328.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [hivert](#comment%3A36):\n> Replying to [jsp](#comment%3A35):\n> > My build finished successful, so let's do it! I leave it to you to give the positive review.\n\n> \n> Mine too on openSuSE and gentoo. I'm ready to give positive review but should it be tested on Cygwin ? Unfortunately, I've no access to this kind of machine.\n> \n> Cheers,\n> \n> Florent\n\n\nPlease do! There is no change in SunOS and Cygwin. In both cases iconv spkg will be build as before.\n\nJaap",
    "created_at": "2010-03-21T21:46:07Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70328",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:37'></a>
Replying to [hivert](#comment%3A36):
> Replying to [jsp](#comment%3A35):
> > My build finished successful, so let's do it! I leave it to you to give the positive review.

> 
> Mine too on openSuSE and gentoo. I'm ready to give positive review but should it be tested on Cygwin ? Unfortunately, I've no access to this kind of machine.
> 
> Cheers,
> 
> Florent


Please do! There is no change in SunOS and Cygwin. In both cases iconv spkg will be build as before.

Jaap



---

archive/issue_events_060954.json:
```json
{
    "actor": "https://github.com/hivert",
    "created_at": "2010-03-21T21:50:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8567#event-60954"
}
```



---

archive/issue_events_060955.json:
```json
{
    "actor": "https://github.com/hivert",
    "created_at": "2010-03-21T21:50:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8567#event-60955"
}
```



---

archive/issue_events_060956.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-03-29T22:08:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8567#event-60956"
}
```



---

archive/issue_events_060957.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-03-29T22:08:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8567#event-60957"
}
```



---

archive/issue_comments_070329.json:
```json
{
    "body": "<a id='comment:39'></a>\nMerged into sage-4.3.5.",
    "created_at": "2010-03-29T22:08:20Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70329",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:39'></a>
Merged into sage-4.3.5.



---

archive/issue_comments_070330.json:
```json
{
    "body": "**Merged:** sage-4.3.5",
    "created_at": "2010-03-30T08:40:06Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70330",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Merged:** sage-4.3.5



---

archive/issue_events_060958.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2010-03-30T12:11:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "milestone": "sage-4.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8567#event-60958"
}
```



---

archive/issue_events_060959.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2010-03-30T12:11:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "milestone": "sage-4.3.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8567#event-60959"
}
```



---

archive/issue_comments_070331.json:
```json
{
    "body": "<a id='comment:42'></a>\n[deleted spam]",
    "created_at": "2010-05-26T08:43:15Z",
    "issue": "https://github.com/sagemath/sage/issues/8567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8567#issuecomment-70331",
    "user": "https://trac.sagemath.org/admin/accounts/users/bascorp2"
}
```

<a id='comment:42'></a>
[deleted spam]
