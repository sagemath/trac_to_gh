# Issue 8708: allow doctest script to handle docstrings with triple single quotes

archive/issues_008708.json:
```json
{
    "body": "As the subject says. This is related to #8699. See this [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/54de5b70bc7b18e3) thread for some background information.\n\n---\n\nApply \n\n- [attachment:trac_8708-jhp.v2.patch] to the **scripts repository**\n- [attachment:trac_8708-doctests.patch] to the Sage repository.\n\n\nAssignee: tbd\n\nCC:  ranosch\n\nKeywords: sd41\n\nReviewer: John Palmieri, Burcin Erocal\n\nResolution: duplicate\n\nIssue created by migration from https://trac.sagemath.org/ticket/8708\n\n",
    "closed_at": "2013-03-07T08:17:01Z",
    "created_at": "2010-04-18T00:46:47Z",
    "labels": [
        "component: doctest coverage",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "allow doctest script to handle docstrings with triple single quotes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8708",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```
As the subject says. This is related to #8699. See this [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/54de5b70bc7b18e3) thread for some background information.

---

Apply 

- [attachment:trac_8708-jhp.v2.patch] to the **scripts repository**
- [attachment:trac_8708-doctests.patch] to the Sage repository.


Assignee: tbd

CC:  ranosch

Keywords: sd41

Reviewer: John Palmieri, Burcin Erocal

Resolution: duplicate

Issue created by migration from https://trac.sagemath.org/ticket/8708





---

archive/issue_events_021139.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2011-08-11T08:41:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "milestone": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8708#event-21139"
}
```



---

archive/issue_comments_082372.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-08-11T08:41:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82372",
    "user": "https://github.com/burcin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_082373.json:
```json
{
    "body": "<a id='comment:1'></a>Attachment [trac_8708-doctest_quotes.patch](tarball://root/attachments/some-uuid/ticket8708/trac_8708-doctest_quotes.patch) by @burcin created at 2011-08-11 08:41:37\n\nattachment:trac_8708-doctest_quotes.patch fixes this problem.",
    "created_at": "2011-08-11T08:41:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82373",
    "user": "https://github.com/burcin"
}
```

<a id='comment:1'></a>Attachment [trac_8708-doctest_quotes.patch](tarball://root/attachments/some-uuid/ticket8708/trac_8708-doctest_quotes.patch) by @burcin created at 2011-08-11 08:41:37

attachment:trac_8708-doctest_quotes.patch fixes this problem.



---

archive/issue_comments_082374.json:
```json
{
    "body": "<a id='comment:2'></a>This doesn't work for me: it skips all doctests in a typical file.  The issue is the line\n\n```\nmin_ind = min(dq_ind, sq_ind)\n```\nwhich means that if either (not just both) search fails, then `min_ind` is `-1`, so the loop exits.\n\nI also don't think we need to modify `doc_prefix` and `doc_suffix`, since this is part of the string written to the temporary doctesting file.  Do the triple quotes in that file have to match the original ones, or can they all be `\"\"\"`?\n\nI'm attaching a new patch which uses regular expressions instead, and which doesn't modify `doc_prefix` and `doc_suffix`.  I'm also attaching a small file for testing purposes; testing on this file should produce three failures, and if you add some print statements to the function `extract_doc`, it should extract the correct string.",
    "created_at": "2011-08-15T22:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82374",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>This doesn't work for me: it skips all doctests in a typical file.  The issue is the line

```
min_ind = min(dq_ind, sq_ind)
```
which means that if either (not just both) search fails, then `min_ind` is `-1`, so the loop exits.

I also don't think we need to modify `doc_prefix` and `doc_suffix`, since this is part of the string written to the temporary doctesting file.  Do the triple quotes in that file have to match the original ones, or can they all be `"""`?

I'm attaching a new patch which uses regular expressions instead, and which doesn't modify `doc_prefix` and `doc_suffix`.  I'm also attaching a small file for testing purposes; testing on this file should produce three failures, and if you add some print statements to the function `extract_doc`, it should extract the correct string.



---

archive/issue_comments_082375.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:2 jhpalmieri]:\n> This doesn't work for me: it skips all doctests in a typical file.  The issue is the line\n> \n> ```\n> min_ind = min(dq_ind, sq_ind)\n> ```\n> which means that if either (not just both) search fails, then `min_ind` is `-1`, so the loop exits.\n\n\nGood catch! Thanks for looking into this.\n\n> I also don't think we need to modify `doc_prefix` and `doc_suffix`, since this is part of the string written to the temporary doctesting file.  Do the triple quotes in that file have to match the original ones, or can they all be `\"\"\"`?\n\n\nWhat happens if you have something like:\n\n```\ndef f(arg):\n    '''\n    some text\n        \n    \"\"\"\n    some more text\n    \"\"\"\n\n    '''\n```",
    "created_at": "2011-08-16T09:16:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82375",
    "user": "https://github.com/burcin"
}
```

<a id='comment:3'></a>Replying to [comment:2 jhpalmieri]:
> This doesn't work for me: it skips all doctests in a typical file.  The issue is the line
> 
> ```
> min_ind = min(dq_ind, sq_ind)
> ```
> which means that if either (not just both) search fails, then `min_ind` is `-1`, so the loop exits.


Good catch! Thanks for looking into this.

> I also don't think we need to modify `doc_prefix` and `doc_suffix`, since this is part of the string written to the temporary doctesting file.  Do the triple quotes in that file have to match the original ones, or can they all be `"""`?


What happens if you have something like:

```
def f(arg):
    '''
    some text
        
    """
    some more text
    """

    '''
```



---

archive/issue_comments_082376.json:
```json
{
    "body": "<a id='comment:4'></a>Oh, you're right.  I'm replacing my patch with a new one, the difference being\n\n```diff\ndiff --git a/sage-doctest b/sage-doctest\n--- a/sage-doctest\n+++ b/sage-doctest\n@@ -452,8 +452,10 @@ def change_warning_output(file):\n             tmpfiles.append(os.path.join(SAGE_TESTDIR, name + '.pyc'))\n \n     # Prefix/suffix for all doctests replacing the starting/ending \"\"\"\n-    doc_prefix = 'r\"\"\">>> set_random_seed(0L)\\n\\n>>> change_warning_output(sys.stdout)\\n\\n'\n-    doc_suffix = '\\n>>> sig_on_count()\\n0\\n\"\"\"'\n+    doc_prefix_dq = 'r\"\"\">>> set_random_seed(0L)\\n\\n>>> change_warning_output(sys.stdout)\\n\\n'\n+    doc_prefix_sq = doc_prefix_dq.replace('\"\"\"',\"'''\")\n+    doc_suffix_dq = '\\n>>> sig_on_count()\\n0\\n\"\"\"'\n+    doc_suffix_sq = doc_suffix_dq.replace('\"\"\"',\"'''\")\n \n     n = 0\n     # Now extract the docstring by using a regular expression search\n@@ -499,7 +501,10 @@ def change_warning_output(file):\n             name = \"example\"\n             s += \"def %s_%s():\"%(name,n_str)\n             n += 1\n-            s += \"\\t\"+ doc_prefix + doc + doc_suffix + \"\\n\\n\"\n+            if m.groups()[0].find(\"'\") > -1: # single quotes\n+                s += \"\\t\"+ doc_prefix_sq + doc + doc_suffix_sq + \"\\n\\n\"\n+            else:\n+                s += \"\\t\"+ doc_prefix_dq + doc + doc_suffix_dq + \"\\n\\n\"\n \n     if n == 0:\n         return  ''\n```\nI'll also add an example like this to the testing file.",
    "created_at": "2011-08-16T15:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82376",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>Oh, you're right.  I'm replacing my patch with a new one, the difference being

```diff
diff --git a/sage-doctest b/sage-doctest
--- a/sage-doctest
+++ b/sage-doctest
@@ -452,8 +452,10 @@ def change_warning_output(file):
             tmpfiles.append(os.path.join(SAGE_TESTDIR, name + '.pyc'))
 
     # Prefix/suffix for all doctests replacing the starting/ending """
-    doc_prefix = 'r""">>> set_random_seed(0L)\n\n>>> change_warning_output(sys.stdout)\n\n'
-    doc_suffix = '\n>>> sig_on_count()\n0\n"""'
+    doc_prefix_dq = 'r""">>> set_random_seed(0L)\n\n>>> change_warning_output(sys.stdout)\n\n'
+    doc_prefix_sq = doc_prefix_dq.replace('"""',"'''")
+    doc_suffix_dq = '\n>>> sig_on_count()\n0\n"""'
+    doc_suffix_sq = doc_suffix_dq.replace('"""',"'''")
 
     n = 0
     # Now extract the docstring by using a regular expression search
@@ -499,7 +501,10 @@ def change_warning_output(file):
             name = "example"
             s += "def %s_%s():"%(name,n_str)
             n += 1
-            s += "\t"+ doc_prefix + doc + doc_suffix + "\n\n"
+            if m.groups()[0].find("'") > -1: # single quotes
+                s += "\t"+ doc_prefix_sq + doc + doc_suffix_sq + "\n\n"
+            else:
+                s += "\t"+ doc_prefix_dq + doc + doc_suffix_dq + "\n\n"
 
     if n == 0:
         return  ''
```
I'll also add an example like this to the testing file.



---

archive/issue_comments_082377.json:
```json
{
    "body": "Attachment [trac_8708-jhp.patch](tarball://root/attachments/some-uuid/ticket8708/trac_8708-jhp.patch) by @jhpalmieri created at 2011-08-16 15:17:56\n\napply to scripts repo",
    "created_at": "2011-08-16T15:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82377",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_8708-jhp.patch](tarball://root/attachments/some-uuid/ticket8708/trac_8708-jhp.patch) by @jhpalmieri created at 2011-08-16 15:17:56

apply to scripts repo



---

archive/issue_comments_082378.json:
```json
{
    "body": "Attachment [trac_8708-testing.py](tarball://root/attachments/some-uuid/ticket8708/trac_8708-testing.py) by @jhpalmieri created at 2011-08-16 15:18:08\n\nsmall Python file for testing purposes",
    "created_at": "2011-08-16T15:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82378",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_8708-testing.py](tarball://root/attachments/some-uuid/ticket8708/trac_8708-testing.py) by @jhpalmieri created at 2011-08-16 15:18:08

small Python file for testing purposes



---

archive/issue_comments_082379.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-09-22T00:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82379",
    "user": "https://github.com/burcin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_082380.json:
```json
{
    "body": "<a id='comment:5'></a>Looks good to me. Thanks for looking into this John.",
    "created_at": "2011-09-22T00:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82380",
    "user": "https://github.com/burcin"
}
```

<a id='comment:5'></a>Looks good to me. Thanks for looking into this John.



---

archive/issue_comments_082381.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n As the subject says. This is related to #8699. See this [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/54de5b70bc7b18e3) thread for some background information.\n+\n+---\n+\n+Apply only [attachment:trac_8708-jhp.patch] to the **scripts repository**.\n+\n \n Priority: minor\n \n``````\n",
    "created_at": "2011-09-23T11:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82381",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,9 @@
 As the subject says. This is related to #8699. See this [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/54de5b70bc7b18e3) thread for some background information.
+
+---
+
+Apply only [attachment:trac_8708-jhp.patch] to the **scripts repository**.
+
 
 Priority: minor
 
``````




---

archive/issue_comments_082382.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-09-27T17:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82382",
    "user": "https://github.com/nexttime"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_082383.json:
```json
{
    "body": "<a id='comment:7'></a>This needs to be rebased on #9739, and perhaps also #10952 (both merged into Sage 4.7.2.alpha3).",
    "created_at": "2011-09-27T17:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82383",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>This needs to be rebased on #9739, and perhaps also #10952 (both merged into Sage 4.7.2.alpha3).



---

archive/issue_comments_082384.json:
```json
{
    "body": "Changing priority from minor to blocker.",
    "created_at": "2011-09-27T18:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82384",
    "user": "https://github.com/jhpalmieri"
}
```

Changing priority from minor to blocker.



---

archive/issue_comments_082385.json:
```json
{
    "body": "<a id='comment:8'></a>We missed an or two issue in #9739: with non-library files, first we just had a bug, using \"source\" instead of \"file_name\" or \"root_name\" or something.  Second, in the import statement added to the file,\n\n```\ns += \"from %s import *\\n\\n\" % target_name\n```\nwe need to replace `target_name` with `os.path.basename(target_name)`.\n\nIn the new patch, I've made these two changes and also rebased.  Given that there is actually new content, this needs a new review.  Without the new content, doctesting .py non-library files completely fails, so I'm marking this as a blocker.  Feel free to downgrade if you think it's appropriate.\n\nOh, I also realized that the attached file for testing purposes has a bad name: replace the hyphen with an underscore.\n\nThe part needing review:\n\n```diff\ndiff --git a/sage-doctest b/sage-doctest\n--- a/sage-doctest\n+++ b/sage-doctest\n@@ -510,7 +510,7 @@ def check_with_tolerance(expected, actua\n \n         elif ext in ['.py', '.sage']:\n \n-            target_name = \"%s_%d\" % (file_name, os.getpid()) # like 'name', but\n+            target_name = \"%s_%d\" % (root_name, os.getpid()) # like 'name', but\n             target_base = os.path.join(SAGE_TESTDIR, target_name) # like 'base'\n \n             if ext == '.sage':\n@@ -528,9 +528,9 @@ def check_with_tolerance(expected, actua\n                 # TODO: instead of copying the file, add its source\n                 # directory to PYTHONPATH.  We would also have to\n                 # import from 'name' instead of 'target_name'.\n-                os.system(\"cp '%s' %s.py\" % (source, target_base))\n+                os.system(\"cp '%s' %s.py\" % (file_name, target_base))\n \n-            s += \"from %s import *\\n\\n\" % target_name\n+            s += \"from %s import *\\n\\n\" % os.path.basename(target_name)\n \n             tmpfiles.append(target_base + \".py\") # preparsed or copied original\n             tmpfiles.append(target_base + \".pyc\") # compiled version of it\n```",
    "created_at": "2011-09-27T18:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82385",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>We missed an or two issue in #9739: with non-library files, first we just had a bug, using "source" instead of "file_name" or "root_name" or something.  Second, in the import statement added to the file,

```
s += "from %s import *\n\n" % target_name
```
we need to replace `target_name` with `os.path.basename(target_name)`.

In the new patch, I've made these two changes and also rebased.  Given that there is actually new content, this needs a new review.  Without the new content, doctesting .py non-library files completely fails, so I'm marking this as a blocker.  Feel free to downgrade if you think it's appropriate.

Oh, I also realized that the attached file for testing purposes has a bad name: replace the hyphen with an underscore.

The part needing review:

```diff
diff --git a/sage-doctest b/sage-doctest
--- a/sage-doctest
+++ b/sage-doctest
@@ -510,7 +510,7 @@ def check_with_tolerance(expected, actua
 
         elif ext in ['.py', '.sage']:
 
-            target_name = "%s_%d" % (file_name, os.getpid()) # like 'name', but
+            target_name = "%s_%d" % (root_name, os.getpid()) # like 'name', but
             target_base = os.path.join(SAGE_TESTDIR, target_name) # like 'base'
 
             if ext == '.sage':
@@ -528,9 +528,9 @@ def check_with_tolerance(expected, actua
                 # TODO: instead of copying the file, add its source
                 # directory to PYTHONPATH.  We would also have to
                 # import from 'name' instead of 'target_name'.
-                os.system("cp '%s' %s.py" % (source, target_base))
+                os.system("cp '%s' %s.py" % (file_name, target_base))
 
-            s += "from %s import *\n\n" % target_name
+            s += "from %s import *\n\n" % os.path.basename(target_name)
 
             tmpfiles.append(target_base + ".py") # preparsed or copied original
             tmpfiles.append(target_base + ".pyc") # compiled version of it
```



---

archive/issue_comments_082386.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-09-27T18:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82386",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_082387.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,8 @@\n+As the subject says. This is related to #8699. See this [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/54de5b70bc7b18e3) thread for some background information.\n+\n+---\n+\n+Apply only [attachment:trac_8708-jhp.v2.patch] to the **scripts repository**.\n \n \n Priority: minor\n``````\n",
    "created_at": "2011-09-27T18:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82387",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,8 @@
+As the subject says. This is related to #8699. See this [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/54de5b70bc7b18e3) thread for some background information.
+
+---
+
+Apply only [attachment:trac_8708-jhp.v2.patch] to the **scripts repository**.
 
 
 Priority: minor
``````




---

archive/issue_comments_082388.json:
```json
{
    "body": "<a id='comment:10'></a>Sorry, here's a new version.  The relevant changes:\n\n```diff\ndiff --git a/sage-doctest b/sage-doctest\n--- a/sage-doctest\n+++ b/sage-doctest\n@@ -510,8 +510,9 @@ def check_with_tolerance(expected, actua\n \n         elif ext in ['.py', '.sage']:\n \n-            target_name = \"%s_%d\" % (file_name, os.getpid()) # like 'name', but unique\n-            target_base = os.path.join(SAGE_TESTDIR, target_name) # like 'base', also unique\n+            root_name = os.path.basename(root_name)\n+            target_name = \"%s_%d\" % (root_name, os.getpid()) # like 'root_name', but unique\n+            target_base = os.path.join(SAGE_TESTDIR, target_name) # like 'target_name' but with full path\n \n             if ext == '.sage':\n                 # TODO: preparse \"<file>.sage\" with a Sage library call\n@@ -528,7 +529,7 @@ def check_with_tolerance(expected, actua\n                 # TODO: instead of copying the file, add its source\n                 # directory to PYTHONPATH.  We would also have to\n                 # import from 'name' instead of 'target_name'.\n-                os.system(\"cp '%s' %s.py\" % (source, target_base))\n+                os.system(\"cp '%s' %s.py\" % (file_name, target_base))\n \n             s += \"from %s import *\\n\\n\" % target_name\n```\nChanging \"source\" to \"file_name\" is necessary: doctesting non-library py files fails otherwise.  The other change is to avoid failures if you specify a path name for the file to be tested: `sage -t ./test.py` will fail without this, as compared to `sage -t test.py`.",
    "created_at": "2011-09-27T19:03:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82388",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>Sorry, here's a new version.  The relevant changes:

```diff
diff --git a/sage-doctest b/sage-doctest
--- a/sage-doctest
+++ b/sage-doctest
@@ -510,8 +510,9 @@ def check_with_tolerance(expected, actua
 
         elif ext in ['.py', '.sage']:
 
-            target_name = "%s_%d" % (file_name, os.getpid()) # like 'name', but unique
-            target_base = os.path.join(SAGE_TESTDIR, target_name) # like 'base', also unique
+            root_name = os.path.basename(root_name)
+            target_name = "%s_%d" % (root_name, os.getpid()) # like 'root_name', but unique
+            target_base = os.path.join(SAGE_TESTDIR, target_name) # like 'target_name' but with full path
 
             if ext == '.sage':
                 # TODO: preparse "<file>.sage" with a Sage library call
@@ -528,7 +529,7 @@ def check_with_tolerance(expected, actua
                 # TODO: instead of copying the file, add its source
                 # directory to PYTHONPATH.  We would also have to
                 # import from 'name' instead of 'target_name'.
-                os.system("cp '%s' %s.py" % (source, target_base))
+                os.system("cp '%s' %s.py" % (file_name, target_base))
 
             s += "from %s import *\n\n" % target_name
```
Changing "source" to "file_name" is necessary: doctesting non-library py files fails otherwise.  The other change is to avoid failures if you specify a path name for the file to be tested: `sage -t ./test.py` will fail without this, as compared to `sage -t test.py`.



---

archive/issue_comments_082389.json:
```json
{
    "body": "<a id='comment:11'></a>Well, at *some point* in the evolution of #9739 it worked (or was correct)... ;-)\n\nCan anybody [else] review this [quickly]?\n\n\nSorry, I don't have the time, and I'm actually also not in the mood right now.",
    "created_at": "2011-09-27T19:32:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82389",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:11'></a>Well, at *some point* in the evolution of #9739 it worked (or was correct)... ;-)

Can anybody [else] review this [quickly]?


Sorry, I don't have the time, and I'm actually also not in the mood right now.



---

archive/issue_comments_082390.json:
```json
{
    "body": "<a id='comment:12'></a>Some things to test:\n\n- First apply the patches from #9739 and #10952.\n- Create a file \"test.py\" (not a Sage library file) and test it with \"sage -t test.py\", and also with \"sage -t /path/to/test.py\".  Try before and after applying [attachment:trac_8708-jhp.v2.patch].  You could just use [attachment:trac_8708-testing.py], but rename it so the name doesn't have any hyphens.  This file is supposed to have 3 failures.\n- Do the same with a file \"test.sage\".  (Just renaming your Python file to \"test.sage\" should be good enough.)",
    "created_at": "2011-09-27T19:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82390",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>Some things to test:

- First apply the patches from #9739 and #10952.
- Create a file "test.py" (not a Sage library file) and test it with "sage -t test.py", and also with "sage -t /path/to/test.py".  Try before and after applying [attachment:trac_8708-jhp.v2.patch].  You could just use [attachment:trac_8708-testing.py], but rename it so the name doesn't have any hyphens.  This file is supposed to have 3 failures.
- Do the same with a file "test.sage".  (Just renaming your Python file to "test.sage" should be good enough.)



---

archive/issue_comments_082391.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-09-28T00:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82391",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_082392.json:
```json
{
    "body": "<a id='comment:13'></a>I now get the following doctest failures, certainly due to the triple single quote patch / modification:\n\n```\nThe following tests failed:\n\n\tsage -t  -long -force_lib devel/sagenb-main/sagenb/notebook/worksheet.py # Exception from doctest framework\n\tsage -t  -long -force_lib devel/sage/sage/interacts/library_cython.pyx # 1 doctests failed\n\tsage -t  -long -force_lib devel/sage/sage/misc/sageinspect.py # Exception from doctest framework\n```\n\nWith `-verbose`:\n\n```sh\n$ ./sage -t -long -verbose devel/sagenb-main/sagenb/notebook/worksheet.py\nsage -t -long -verbose \"devel/sagenb-main/sagenb/notebook/worksheet.py\"\nTraceback (most recent call last):\n  File \"/home/leif/.sage//tmp/worksheet_15100.py\", line 3046, in <module>\n    runner=runner)\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/sagedoctest.py\", line 54, in testmod_returning_runner\n    runner=runner)\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 1819, in testmod_returning_runner\n    for test in finder.find(m, name, globs=globs, extraglobs=extraglobs):\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 839, in find\n    self._find(tests, obj, name, module, source_lines, globs, {})\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 893, in _find\n    globs, seen)\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 881, in _find\n    test = self._get_test(obj, name, module, globs, source_lines)\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 965, in _get_test\n    filename, lineno)\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 594, in get_doctest\n    return DocTest(self.get_examples(string, name), globs,\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 608, in get_examples\n    return [x for x in self.parse(string, name)\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 570, in parse\n    self._parse_example(m, name, lineno)\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 640, in _parse_example\n    lineno + len(source_lines))\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 726, in _check_prefix\n    (lineno+i+1, name, line))\nValueError: line 11 of the docstring for __main__.example_109 has inconsistent leading whitespace: '    \"'\nException raised by doctesting framework. Use -verbose for details.\n```\n\n```sh\n$ ./sage -t -long -verbose devel/sage/sage/misc/sageinspect.py\nsage -t -long -verbose \"devel/sage/sage/misc/sageinspect.py\"\nTraceback (most recent call last):\n  File \"/home/leif/.sage//tmp/sageinspect_15131.py\", line 1327, in <module>\n    runner=runner)\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/sagedoctest.py\", line 54, in testmod_returning_runner\n    runner=runner)\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 1819, in testmod_returning_runner\n    for test in finder.find(m, name, globs=globs, extraglobs=extraglobs):\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 839, in find\n    self._find(tests, obj, name, module, source_lines, globs, {})\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 893, in _find\n    globs, seen)\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 881, in _find\n    test = self._get_test(obj, name, module, globs, source_lines)\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 965, in _get_test\n    filename, lineno)\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 594, in get_doctest\n    return DocTest(self.get_examples(string, name), globs,\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 608, in get_examples\n    return [x for x in self.parse(string, name)\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 570, in parse\n    self._parse_example(m, name, lineno)\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 640, in _parse_example\n    lineno + len(source_lines))\n  File \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py\", line 726, in _check_prefix\n    (lineno+i+1, name, line))\nValueError: line 53 of the docstring for __main__.example_28 has inconsistent leading whitespace: '    \"\"\"'\nException raised by doctesting framework. Use -verbose for details.\n```\n\n```sh\n$ ./sage -t -long -verbose devel/sage/sage/interacts/library_cython.pyxsage -t -long -verbose \"devel/sage/sage/interacts/library_cython.pyx\"\n\n...\n\nTrying:\n    from sage.interacts.library_cython import cellular###line 91:_sage_    >>> from sage.interacts.library_cython import cellular\nExpecting nothing\nok\nTrying:\n    rule = [Integer(1), Integer(0), Integer(1), Integer(0), Integer(0), Integer(1), Integer(1), Integer(0)]###line 92:_sage_    >>> rule = [1, 0, 1, 0, 0, 1, 1, 0]\nExpecting nothing\nok\nTrying:\n    N = Integer(3)###line 93:_sage_    >>> N = 3\nExpecting nothing\nok\nTrying:\n    print cellular(rule, Integer(3))###line 94:_sage_    >>> print cellular(rule, 3)\nExpecting nothing\n**********************************************************************\nFile \"/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/devel/sage/sage/interacts/library_cython.pyx\", line ?, in __main__.example_3\nFailed example:\n    print cellular(rule, Integer(3))###line 94:_sage_    >>> print cellular(rule, 3)\nExpected nothing\nGot:\n    [[0 0 0 1 0 0 0]\n     [0 0 0 1 0 0 0]\n     [0 1 0 1 0 1 0]]\nTrying:\n    sig_on_count()\nExpecting:\n    0\nok\n4 items had no tests:\n    __main__\n    __main__.change_warning_output\n    __main__.check_with_tolerance\n    __main__.warning_function\n3 items passed all tests:\n   3 tests in __main__.example_0\n   9 tests in __main__.example_1\n   8 tests in __main__.example_2\n**********************************************************************\n1 items had failures:\n   1 of   7 in __main__.example_3\n27 tests in 8 items.\n26 passed and 1 failed.\n***Test Failed*** 1 failures.\n```",
    "created_at": "2011-09-28T00:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82392",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:13'></a>I now get the following doctest failures, certainly due to the triple single quote patch / modification:

```
The following tests failed:

	sage -t  -long -force_lib devel/sagenb-main/sagenb/notebook/worksheet.py # Exception from doctest framework
	sage -t  -long -force_lib devel/sage/sage/interacts/library_cython.pyx # 1 doctests failed
	sage -t  -long -force_lib devel/sage/sage/misc/sageinspect.py # Exception from doctest framework
```

With `-verbose`:

```sh
$ ./sage -t -long -verbose devel/sagenb-main/sagenb/notebook/worksheet.py
sage -t -long -verbose "devel/sagenb-main/sagenb/notebook/worksheet.py"
Traceback (most recent call last):
  File "/home/leif/.sage//tmp/worksheet_15100.py", line 3046, in <module>
    runner=runner)
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/sagedoctest.py", line 54, in testmod_returning_runner
    runner=runner)
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 1819, in testmod_returning_runner
    for test in finder.find(m, name, globs=globs, extraglobs=extraglobs):
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 839, in find
    self._find(tests, obj, name, module, source_lines, globs, {})
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 893, in _find
    globs, seen)
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 881, in _find
    test = self._get_test(obj, name, module, globs, source_lines)
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 965, in _get_test
    filename, lineno)
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 594, in get_doctest
    return DocTest(self.get_examples(string, name), globs,
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 608, in get_examples
    return [x for x in self.parse(string, name)
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 570, in parse
    self._parse_example(m, name, lineno)
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 640, in _parse_example
    lineno + len(source_lines))
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 726, in _check_prefix
    (lineno+i+1, name, line))
ValueError: line 11 of the docstring for __main__.example_109 has inconsistent leading whitespace: '    "'
Exception raised by doctesting framework. Use -verbose for details.
```

```sh
$ ./sage -t -long -verbose devel/sage/sage/misc/sageinspect.py
sage -t -long -verbose "devel/sage/sage/misc/sageinspect.py"
Traceback (most recent call last):
  File "/home/leif/.sage//tmp/sageinspect_15131.py", line 1327, in <module>
    runner=runner)
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/sagedoctest.py", line 54, in testmod_returning_runner
    runner=runner)
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 1819, in testmod_returning_runner
    for test in finder.find(m, name, globs=globs, extraglobs=extraglobs):
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 839, in find
    self._find(tests, obj, name, module, source_lines, globs, {})
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 893, in _find
    globs, seen)
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 881, in _find
    test = self._get_test(obj, name, module, globs, source_lines)
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 965, in _get_test
    filename, lineno)
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 594, in get_doctest
    return DocTest(self.get_examples(string, name), globs,
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 608, in get_examples
    return [x for x in self.parse(string, name)
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 570, in parse
    self._parse_example(m, name, lineno)
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 640, in _parse_example
    lineno + len(source_lines))
  File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/local/bin/ncadoctest.py", line 726, in _check_prefix
    (lineno+i+1, name, line))
ValueError: line 53 of the docstring for __main__.example_28 has inconsistent leading whitespace: '    """'
Exception raised by doctesting framework. Use -verbose for details.
```

```sh
$ ./sage -t -long -verbose devel/sage/sage/interacts/library_cython.pyxsage -t -long -verbose "devel/sage/sage/interacts/library_cython.pyx"

...

Trying:
    from sage.interacts.library_cython import cellular###line 91:_sage_    >>> from sage.interacts.library_cython import cellular
Expecting nothing
ok
Trying:
    rule = [Integer(1), Integer(0), Integer(1), Integer(0), Integer(0), Integer(1), Integer(1), Integer(0)]###line 92:_sage_    >>> rule = [1, 0, 1, 0, 0, 1, 1, 0]
Expecting nothing
ok
Trying:
    N = Integer(3)###line 93:_sage_    >>> N = 3
Expecting nothing
ok
Trying:
    print cellular(rule, Integer(3))###line 94:_sage_    >>> print cellular(rule, 3)
Expecting nothing
**********************************************************************
File "/home/leif/Sage/sage-4.7.2.alpha3-prerelease3/devel/sage/sage/interacts/library_cython.pyx", line ?, in __main__.example_3
Failed example:
    print cellular(rule, Integer(3))###line 94:_sage_    >>> print cellular(rule, 3)
Expected nothing
Got:
    [[0 0 0 1 0 0 0]
     [0 0 0 1 0 0 0]
     [0 1 0 1 0 1 0]]
Trying:
    sig_on_count()
Expecting:
    0
ok
4 items had no tests:
    __main__
    __main__.change_warning_output
    __main__.check_with_tolerance
    __main__.warning_function
3 items passed all tests:
   3 tests in __main__.example_0
   9 tests in __main__.example_1
   8 tests in __main__.example_2
**********************************************************************
1 items had failures:
   1 of   7 in __main__.example_3
27 tests in 8 items.
26 passed and 1 failed.
***Test Failed*** 1 failures.
```



---

archive/issue_comments_082393.json:
```json
{
    "body": "<a id='comment:14'></a>P.S.:\n\nJohn, could you perhaps separate the fix concerning doctesting non-library files, and attach it to #9739 (not modifying the other patches there, i.e., as a patch to be applied on top of the others)?",
    "created_at": "2011-09-28T00:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82393",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>P.S.:

John, could you perhaps separate the fix concerning doctesting non-library files, and attach it to #9739 (not modifying the other patches there, i.e., as a patch to be applied on top of the others)?



---

archive/issue_comments_082394.json:
```json
{
    "body": "<a id='comment:15'></a>Okay, I've done that now.  I'm also downgrading the priority of this ticket.  (We could also open a new ticket just for the issue now added on to #9739, if you think that would be cleaner.  #9739 is still marked as closed, by the way.  I didn't reopen it.)",
    "created_at": "2011-09-28T00:36:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82394",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>Okay, I've done that now.  I'm also downgrading the priority of this ticket.  (We could also open a new ticket just for the issue now added on to #9739, if you think that would be cleaner.  #9739 is still marked as closed, by the way.  I didn't reopen it.)



---

archive/issue_comments_082395.json:
```json
{
    "body": "Changing priority from blocker to minor.",
    "created_at": "2011-09-28T00:36:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82395",
    "user": "https://github.com/jhpalmieri"
}
```

Changing priority from blocker to minor.



---

archive/issue_comments_082396.json:
```json
{
    "body": "apply to scripts repo",
    "created_at": "2011-09-28T00:39:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82396",
    "user": "https://github.com/jhpalmieri"
}
```

apply to scripts repo



---

archive/issue_comments_082397.json:
```json
{
    "body": "<a id='comment:16'></a>Attachment [trac_8708-jhp.v2.patch](tarball://root/attachments/some-uuid/ticket8708/trac_8708-jhp.v2.patch) by @nexttime created at 2011-09-28 01:05:48\n\nReplying to [comment:15 jhpalmieri]:\n> Okay, I've done that now.\n\n\nThanks; just the commit message there refers to this ticket (and its subject), i.e., is unrelated.\n\n> #9739 is still marked as closed, by the way.  I didn't reopen it.\n\n\nUnless nobody else reopens or closes tickets, or attaches files to / updates files on tickets I've already closed (and I didn't ask him to) I don't really care.\n\nReopening tickets IMHO only makes sense if I'm going to actually back it out.",
    "created_at": "2011-09-28T01:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82397",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:16'></a>Attachment [trac_8708-jhp.v2.patch](tarball://root/attachments/some-uuid/ticket8708/trac_8708-jhp.v2.patch) by @nexttime created at 2011-09-28 01:05:48

Replying to [comment:15 jhpalmieri]:
> Okay, I've done that now.


Thanks; just the commit message there refers to this ticket (and its subject), i.e., is unrelated.

> #9739 is still marked as closed, by the way.  I didn't reopen it.


Unless nobody else reopens or closes tickets, or attaches files to / updates files on tickets I've already closed (and I didn't ask him to) I don't really care.

Reopening tickets IMHO only makes sense if I'm going to actually back it out.



---

archive/issue_comments_082398.json:
```json
{
    "body": "<a id='comment:17'></a>s/nobody/somebody/ or s/unless/as long as/\n\nIt's getting late...",
    "created_at": "2011-09-28T01:10:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82398",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:17'></a>s/nobody/somebody/ or s/unless/as long as/

It's getting late...



---

archive/issue_comments_082399.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,11 @@\n+As the subject says. This is related to #8699. See this [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/54de5b70bc7b18e3) thread for some background information.\n+\n+---\n+\n+Apply \n+\n+- [attachment:trac_8708-jhp.v2.patch] to the **scripts repository**\n+- [attachment:trac_8708-doctests.patch] to the Sage repository.\n \n \n Priority: minor\n``````\n",
    "created_at": "2011-09-28T04:13:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82399",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,11 @@
+As the subject says. This is related to #8699. See this [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/54de5b70bc7b18e3) thread for some background information.
+
+---
+
+Apply 
+
+- [attachment:trac_8708-jhp.v2.patch] to the **scripts repository**
+- [attachment:trac_8708-doctests.patch] to the Sage repository.
 
 
 Priority: minor
``````




---

archive/issue_comments_082400.json:
```json
{
    "body": "<a id='comment:18'></a>The test failure in interacts/libary_cython.pyx is because of a doctest which would have failed in the past, but it was enclosed in triple single quotes, and so was skipped by the doctesting framework.  (There is a line saying `sage: print cellular(rule, 3)` with no output after it.)  We can certainly just stick in the output, but I have no idea if it's right.\n\nI have a fix for sageinspect.py, but I'm not sure about worksheet.py.  I can work on it some more, but we should check whether there are failures in the flask notebook before working too hard on this one: if the file is going to go away soon, it's not worth working too hard fixing it.\n\nI'm attaching a patch for the Sage library fixing the two files there; I'll try to get information about whether the patch to library_cython.pyx is actually the right thing to do.",
    "created_at": "2011-09-28T04:13:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82400",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:18'></a>The test failure in interacts/libary_cython.pyx is because of a doctest which would have failed in the past, but it was enclosed in triple single quotes, and so was skipped by the doctesting framework.  (There is a line saying `sage: print cellular(rule, 3)` with no output after it.)  We can certainly just stick in the output, but I have no idea if it's right.

I have a fix for sageinspect.py, but I'm not sure about worksheet.py.  I can work on it some more, but we should check whether there are failures in the flask notebook before working too hard on this one: if the file is going to go away soon, it's not worth working too hard fixing it.

I'm attaching a patch for the Sage library fixing the two files there; I'll try to get information about whether the patch to library_cython.pyx is actually the right thing to do.



---

archive/issue_comments_082401.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2011-09-28T04:13:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82401",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_082402.json:
```json
{
    "body": "<a id='comment:19'></a>For the sagenb problem, this patch seems to fix things:\n\n```diff\n\ndiff --git a/sagenb/notebook/worksheet.py b/sagenb/notebook/worksheet.py\n--- a/sagenb/notebook/worksheet.py\n+++ b/sagenb/notebook/worksheet.py\n@@ -3881,15 +3881,7 @@ except (KeyError, IOError):\n             C.delete_output()\n \n \n-__internal_test1 = '''\n-def foo(x):\n-    \"\n-    EXAMPLES:\n-        sage: 2+2\n-        4\n-    \"\n-    return x\n-'''.lstrip()\n+__internal_test1 = '\\ndef foo(x):\\n    \"\\n    EXAMPLES:\\n        sage: 2+2\\n        4\\n    \"\\n    return x'.lstrip()\n \n __internal_test2 = '''\n sage: 2 + 2\n```\nI don't know if it's the best approach.  Why does this use single double quotes, anyway?  Shouldn't the EXAMPLES block be surrounded by `\"\"\"`?  Modifying the patch here to use `\"\"\"` still passes doctests.",
    "created_at": "2011-09-28T05:37:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82402",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:19'></a>For the sagenb problem, this patch seems to fix things:

```diff

diff --git a/sagenb/notebook/worksheet.py b/sagenb/notebook/worksheet.py
--- a/sagenb/notebook/worksheet.py
+++ b/sagenb/notebook/worksheet.py
@@ -3881,15 +3881,7 @@ except (KeyError, IOError):
             C.delete_output()
 
 
-__internal_test1 = '''
-def foo(x):
-    "
-    EXAMPLES:
-        sage: 2+2
-        4
-    "
-    return x
-'''.lstrip()
+__internal_test1 = '\ndef foo(x):\n    "\n    EXAMPLES:\n        sage: 2+2\n        4\n    "\n    return x'.lstrip()
 
 __internal_test2 = '''
 sage: 2 + 2
```
I don't know if it's the best approach.  Why does this use single double quotes, anyway?  Shouldn't the EXAMPLES block be surrounded by `"""`?  Modifying the patch here to use `"""` still passes doctests.



---

archive/issue_comments_082403.json:
```json
{
    "body": "<a id='comment:20'></a>The problem with library_cython.pyx should be dealt with at #11871, so I'm making that a dependency.  I'll remove that part of the doctest patch.",
    "created_at": "2011-09-29T18:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82403",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:20'></a>The problem with library_cython.pyx should be dealt with at #11871, so I'm making that a dependency.  I'll remove that part of the doctest patch.



---

archive/issue_comments_082404.json:
```json
{
    "body": "Attachment [trac_8708-doctests.patch](tarball://root/attachments/some-uuid/ticket8708/trac_8708-doctests.patch) by @jhpalmieri created at 2011-09-29 18:55:57\n\nSage repository",
    "created_at": "2011-09-29T18:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82404",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_8708-doctests.patch](tarball://root/attachments/some-uuid/ticket8708/trac_8708-doctests.patch) by @jhpalmieri created at 2011-09-29 18:55:57

Sage repository



---

archive/issue_comments_082405.json:
```json
{
    "body": "<a id='comment:21'></a>I've submitted a patch for the flask notebook to deal with the issue with notebook/worksheet, and that should be merged soon. There is a patch at #11871 for interacts/library_cython.pyx. So I think this is now ready to go.",
    "created_at": "2012-06-12T23:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82405",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:21'></a>I've submitted a patch for the flask notebook to deal with the issue with notebook/worksheet, and that should be merged soon. There is a patch at #11871 for interacts/library_cython.pyx. So I think this is now ready to go.



---

archive/issue_comments_082406.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-06-12T23:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82406",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_082407.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd41\".",
    "created_at": "2012-06-15T23:12:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82407",
    "user": "https://github.com/jhpalmieri"
}
```

Changing keywords from "" to "sd41".



---

archive/issue_comments_082408.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-02-28T16:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82408",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_082409.json:
```json
{
    "body": "<a id='comment:23'></a>Fixed by #12415.",
    "created_at": "2013-02-28T16:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82409",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>Fixed by #12415.



---

archive/issue_events_021140.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-28T16:03:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "milestone": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8708#event-21140"
}
```



---

archive/issue_events_021141.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-28T16:03:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8708#event-21141"
}
```



---

archive/issue_events_021142.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-07T08:17:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8708#event-21142"
}
```



---

archive/issue_comments_082410.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2013-03-07T08:17:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8708#issuecomment-82410",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: duplicate
