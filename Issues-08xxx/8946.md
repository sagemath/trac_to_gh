# Issue 8946: Sage 4.4.2.alpha0: doctest failures in calculus/riemann.pyx due to #8479

archive/issues_008946.json:
```json
{
    "body": "This was reported on [sage-devel](http://groups.google.com/group/sage-devel/msg/e4472856a6b8ec53) and is due to #8479:\n\n```sh\nsage -t  -long devel/sage/sage/calculus/riemann.pyx\n**********************************************************************\nFile \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/devel/sage-main/sage/calculus/riemann.pyx\", line 110:\n    sage: m = Riemann_Map([f, hf], [hf, hfprime], 0.5 + 0.5*I)  # long time (8 sec)\nException raised:\n    Traceback (most recent call last):\n      File \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_1[7]>\", line 1, in <module>\n        m = Riemann_Map([f, hf], [hf, hfprime], RealNumber('0.5') + RealNumber('0.5')*I)  # long time (8 sec)###line 110:\n    sage: m = Riemann_Map([f, hf], [hf, hfprime], 0.5 + 0.5*I)  # long time (8 sec)\n      File \"riemann.pyx\", line 176, in sage.calculus.riemann.Riemann_Map.__init__ (sage/calculus/riemann.c:1757)\n        self.cps[k, i] = np.complex(fs[k](self.tk[i]))\n      File \"expression.pyx\", line 3398, in sage.symbolic.expression.Expression.__call__ (sage/symbolic/expression.cpp:15476)\n      File \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/lib/python/site-packages/sage/symbolic/callable.py\", line 447, in _call_element_\n        raise NotImplementedError(\"Numpy arrays are not supported as arguments for symbolic expressions\")\n    NotImplementedError: Numpy arrays are not supported as arguments for symbolic expressions\n**********************************************************************\nFile \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/devel/sage-main/sage/calculus/riemann.pyx\", line 325:\n    sage: m = Riemann_Map([f, hf], [hf, hfprime], 0.5 + 0.5*I)  # long time (8 sec)\nException raised:\n    Traceback (most recent call last):\n      File \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_5[12]>\", line 1, in <module>\n        m = Riemann_Map([f, hf], [hf, hfprime], RealNumber('0.5') + RealNumber('0.5')*I)  # long time (8 sec)###line 325:\n    sage: m = Riemann_Map([f, hf], [hf, hfprime], 0.5 + 0.5*I)  # long time (8 sec)\n      File \"riemann.pyx\", line 176, in sage.calculus.riemann.Riemann_Map.__init__ (sage/calculus/riemann.c:1757)\n        self.cps[k, i] = np.complex(fs[k](self.tk[i]))\n      File \"expression.pyx\", line 3398, in sage.symbolic.expression.Expression.__call__ (sage/symbolic/expression.cpp:15476)\n      File \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/lib/python/site-packages/sage/symbolic/callable.py\", line 447, in _call_element_\n        raise NotImplementedError(\"Numpy arrays are not supported as arguments for symbolic expressions\")\n    NotImplementedError: Numpy arrays are not supported as arguments for symbolic expressions\n**********************************************************************\nFile \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/devel/sage-main/sage/calculus/riemann.pyx\", line 330:\n    sage: sz1 = m.get_szego(boundary=1)  # long time\nException raised:\n    Traceback (most recent call last):\n      File \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_5[14]>\", line 1, in <module>\n        sz1 = m.get_szego(boundary=Integer(1))  # long time###line 330:\n    sage: sz1 = m.get_szego(boundary=1)  # long time\n      File \"riemann.pyx\", line 348, in sage.calculus.riemann.Riemann_Map.get_szego (sage/calculus/riemann.c:4222)\n        [self.tk, self.szego[boundary]]).tolist()\n    IndexError: index out of bounds\n**********************************************************************\nFile \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/devel/sage-main/sage/calculus/riemann.pyx\", line 392:\n    sage: m = Riemann_Map([f, hf], [hf, hfprime], 0.5 + 0.5*I)  # long time (8 sec)\nException raised:\n    Traceback (most recent call last):\n      File \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_6[11]>\", line 1, in <module>\n        m = Riemann_Map([f, hf], [hf, hfprime], RealNumber('0.5') + RealNumber('0.5')*I)  # long time (8 sec)###line 392:\n    sage: m = Riemann_Map([f, hf], [hf, hfprime], 0.5 + 0.5*I)  # long time (8 sec)\n      File \"riemann.pyx\", line 176, in sage.calculus.riemann.Riemann_Map.__init__ (sage/calculus/riemann.c:1757)\n        self.cps[k, i] = np.complex(fs[k](self.tk[i]))\n      File \"expression.pyx\", line 3398, in sage.symbolic.expression.Expression.__call__ (sage/symbolic/expression.cpp:15476)\n      File \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/lib/python/site-packages/sage/symbolic/callable.py\", line 447, in _call_element_\n        raise NotImplementedError(\"Numpy arrays are not supported as arguments for symbolic expressions\")\n    NotImplementedError: Numpy arrays are not supported as arguments for symbolic expressions\n**********************************************************************\nFile \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/devel/sage-main/sage/calculus/riemann.pyx\", line 397:\n    sage: tp1 = m.get_theta_points(boundary=1)  # long time\nException raised:\n    Traceback (most recent call last):\n      File \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_6[13]>\", line 1, in <module>\n        tp1 = m.get_theta_points(boundary=Integer(1))  # long time###line 397:\n    sage: tp1 = m.get_theta_points(boundary=1)  # long time\n      File \"riemann.pyx\", line 407, in sage.calculus.riemann.Riemann_Map.get_theta_points (sage/calculus/riemann.c:4547)\n        [self.tk2, self.theta_array[boundary]]).tolist()\n    IndexError: index out of bounds\n```\n\nAssignee: tbd\n\nCC:  whuss @burcin\n\nResolution: fixed\n\nAuthor: Wilfried Huss\n\nReviewer: Minh Van Nguyen\n\nMerged: sage-4.4.2.rc0\n\nIssue created by migration from https://trac.sagemath.org/ticket/8946\n\n",
    "closed_at": "2010-05-12T22:51:39Z",
    "created_at": "2010-05-11T03:31:51Z",
    "labels": [
        "component: doctest coverage",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.4.2",
    "title": "Sage 4.4.2.alpha0: doctest failures in calculus/riemann.pyx due to #8479",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8946",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```
This was reported on [sage-devel](http://groups.google.com/group/sage-devel/msg/e4472856a6b8ec53) and is due to #8479:

```sh
sage -t  -long devel/sage/sage/calculus/riemann.pyx
**********************************************************************
File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/devel/sage-main/sage/calculus/riemann.pyx", line 110:
    sage: m = Riemann_Map([f, hf], [hf, hfprime], 0.5 + 0.5*I)  # long time (8 sec)
Exception raised:
    Traceback (most recent call last):
      File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_1[7]>", line 1, in <module>
        m = Riemann_Map([f, hf], [hf, hfprime], RealNumber('0.5') + RealNumber('0.5')*I)  # long time (8 sec)###line 110:
    sage: m = Riemann_Map([f, hf], [hf, hfprime], 0.5 + 0.5*I)  # long time (8 sec)
      File "riemann.pyx", line 176, in sage.calculus.riemann.Riemann_Map.__init__ (sage/calculus/riemann.c:1757)
        self.cps[k, i] = np.complex(fs[k](self.tk[i]))
      File "expression.pyx", line 3398, in sage.symbolic.expression.Expression.__call__ (sage/symbolic/expression.cpp:15476)
      File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/lib/python/site-packages/sage/symbolic/callable.py", line 447, in _call_element_
        raise NotImplementedError("Numpy arrays are not supported as arguments for symbolic expressions")
    NotImplementedError: Numpy arrays are not supported as arguments for symbolic expressions
**********************************************************************
File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/devel/sage-main/sage/calculus/riemann.pyx", line 325:
    sage: m = Riemann_Map([f, hf], [hf, hfprime], 0.5 + 0.5*I)  # long time (8 sec)
Exception raised:
    Traceback (most recent call last):
      File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_5[12]>", line 1, in <module>
        m = Riemann_Map([f, hf], [hf, hfprime], RealNumber('0.5') + RealNumber('0.5')*I)  # long time (8 sec)###line 325:
    sage: m = Riemann_Map([f, hf], [hf, hfprime], 0.5 + 0.5*I)  # long time (8 sec)
      File "riemann.pyx", line 176, in sage.calculus.riemann.Riemann_Map.__init__ (sage/calculus/riemann.c:1757)
        self.cps[k, i] = np.complex(fs[k](self.tk[i]))
      File "expression.pyx", line 3398, in sage.symbolic.expression.Expression.__call__ (sage/symbolic/expression.cpp:15476)
      File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/lib/python/site-packages/sage/symbolic/callable.py", line 447, in _call_element_
        raise NotImplementedError("Numpy arrays are not supported as arguments for symbolic expressions")
    NotImplementedError: Numpy arrays are not supported as arguments for symbolic expressions
**********************************************************************
File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/devel/sage-main/sage/calculus/riemann.pyx", line 330:
    sage: sz1 = m.get_szego(boundary=1)  # long time
Exception raised:
    Traceback (most recent call last):
      File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_5[14]>", line 1, in <module>
        sz1 = m.get_szego(boundary=Integer(1))  # long time###line 330:
    sage: sz1 = m.get_szego(boundary=1)  # long time
      File "riemann.pyx", line 348, in sage.calculus.riemann.Riemann_Map.get_szego (sage/calculus/riemann.c:4222)
        [self.tk, self.szego[boundary]]).tolist()
    IndexError: index out of bounds
**********************************************************************
File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/devel/sage-main/sage/calculus/riemann.pyx", line 392:
    sage: m = Riemann_Map([f, hf], [hf, hfprime], 0.5 + 0.5*I)  # long time (8 sec)
Exception raised:
    Traceback (most recent call last):
      File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_6[11]>", line 1, in <module>
        m = Riemann_Map([f, hf], [hf, hfprime], RealNumber('0.5') + RealNumber('0.5')*I)  # long time (8 sec)###line 392:
    sage: m = Riemann_Map([f, hf], [hf, hfprime], 0.5 + 0.5*I)  # long time (8 sec)
      File "riemann.pyx", line 176, in sage.calculus.riemann.Riemann_Map.__init__ (sage/calculus/riemann.c:1757)
        self.cps[k, i] = np.complex(fs[k](self.tk[i]))
      File "expression.pyx", line 3398, in sage.symbolic.expression.Expression.__call__ (sage/symbolic/expression.cpp:15476)
      File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/lib/python/site-packages/sage/symbolic/callable.py", line 447, in _call_element_
        raise NotImplementedError("Numpy arrays are not supported as arguments for symbolic expressions")
    NotImplementedError: Numpy arrays are not supported as arguments for symbolic expressions
**********************************************************************
File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/devel/sage-main/sage/calculus/riemann.pyx", line 397:
    sage: tp1 = m.get_theta_points(boundary=1)  # long time
Exception raised:
    Traceback (most recent call last):
      File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/dev/shm/mvngu/sandbox/sage-4.4.2.alpha0-7665r/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_6[13]>", line 1, in <module>
        tp1 = m.get_theta_points(boundary=Integer(1))  # long time###line 397:
    sage: tp1 = m.get_theta_points(boundary=1)  # long time
      File "riemann.pyx", line 407, in sage.calculus.riemann.Riemann_Map.get_theta_points (sage/calculus/riemann.c:4547)
        [self.tk2, self.theta_array[boundary]]).tolist()
    IndexError: index out of bounds
```

Assignee: tbd

CC:  whuss @burcin

Resolution: fixed

Author: Wilfried Huss

Reviewer: Minh Van Nguyen

Merged: sage-4.4.2.rc0

Issue created by migration from https://trac.sagemath.org/ticket/8946





---

archive/issue_comments_104183.json:
```json
{
    "body": "Attachment [trac_8946.patch](tarball://root/attachments/some-uuid/ticket8946/trac_8946.patch) by whuss created at 2010-05-11 08:30:23",
    "created_at": "2010-05-11T08:30:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8946#issuecomment-104183",
    "user": "https://trac.sagemath.org/admin/accounts/users/whuss"
}
```

Attachment [trac_8946.patch](tarball://root/attachments/some-uuid/ticket8946/trac_8946.patch) by whuss created at 2010-05-11 08:30:23



---

archive/issue_comments_104184.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-05-11T08:33:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8946#issuecomment-104184",
    "user": "https://trac.sagemath.org/admin/accounts/users/whuss"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_104185.json:
```json
{
    "body": "<a id='comment:1'></a>\nThe attached patch should fix the problem.\n\nBut there is another problem when applying sumbolic functions to numpy types,\nwhich is independent of #8479. See #8949.",
    "created_at": "2010-05-11T08:33:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8946#issuecomment-104185",
    "user": "https://trac.sagemath.org/admin/accounts/users/whuss"
}
```

<a id='comment:1'></a>
The attached patch should fix the problem.

But there is another problem when applying sumbolic functions to numpy types,
which is independent of #8479. See #8949.



---

archive/issue_comments_104186.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.4.2.rc0\"",
    "created_at": "2010-05-12T22:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8946#issuecomment-104186",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Changing merged from "" to "sage-4.4.2.rc0"



---

archive/issue_comments_104187.json:
```json
{
    "body": "Changing author from \"\" to \"Wilfried Huss\"",
    "created_at": "2010-05-12T22:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8946#issuecomment-104187",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Changing author from "" to "Wilfried Huss"



---

archive/issue_comments_104188.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Minh Van Nguyen\"",
    "created_at": "2010-05-12T22:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8946#issuecomment-104188",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Changing reviewer from "" to "Minh Van Nguyen"



---

archive/issue_comments_104189.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-05-12T22:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8946#issuecomment-104189",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Resolution: fixed



---

archive/issue_events_026909.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2010-05-12T22:51:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8946",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8946#event-26909"
}
```
