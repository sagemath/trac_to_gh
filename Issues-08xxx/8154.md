# Issue 8154: Enhancement for crystals

archive/issues_008154.json:
```json
{
    "body": "New features for crystals:\n\n- Started framework for general highest weight crystals in /combinat/crystals/highest_weight.py (with contributions from Nicolas M. Thiery)\n- Implementation of finite dimensional highest weight crystals for type E6 and E7\n- Added new class for direct sums of crystals in /combinat/crystals/direct_sum.py\n- Added a new crystal morphism function for acyclic crystals\n- Added the Demazure operators on crystals\n- Added Demazure characters for finite crystals in the ambient weight lattice\n- Added _test_fast_iter method to compare two different ways of creating list of classical crystals\n\nNew features for Kirillov-Reshetikhin crystals:\n\n- Implementation of Kirillov-Reshetikhin crystals B^{r,s} of type E_6^{(1)} for r=1,2,6\n- Pointer to KirillovReshetikhin crystals given in /combinat/crystals/affine.py (as requested by Dan Bump)\n- Added R-matrix for tensor product of two KR crystals\n\nBug fix:\n\n- Fixed whitespace problems in\n  /combinat/crystals/crystals.py\n  /combinat/crystals/kirillov_reshetikhin.py\n  /combinat/crystals/affine.py\n  /combinat/crystals/spins.py\n  /combinat/crystals/tensor_products.py\n  /combinat/crystals/fast_crystals.py\n  /combinat/crystals/letters.py\n\nDepends on trac ticket #7978 (trac_7978_crystal_cleanup-as.patch)\n\n\n**Assignee:** sage-combinat\n\n**CC:**  sage-combinat\n\n**Keywords:** combinatorics, crystals, KR crystals\n\n**Author:** Anne Schilling\n\n**Reviewer:** Daniel Bump\n\n**Merged:** sage-4.3.3.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/8154\n\n",
    "closed_at": "2010-02-14T14:34:40Z",
    "created_at": "2010-02-02T16:31:40Z",
    "labels": [
        "component: combinatorics",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3.3",
    "title": "Enhancement for crystals",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8154",
    "user": "https://github.com/anneschilling"
}
```
New features for crystals:

- Started framework for general highest weight crystals in /combinat/crystals/highest_weight.py (with contributions from Nicolas M. Thiery)
- Implementation of finite dimensional highest weight crystals for type E6 and E7
- Added new class for direct sums of crystals in /combinat/crystals/direct_sum.py
- Added a new crystal morphism function for acyclic crystals
- Added the Demazure operators on crystals
- Added Demazure characters for finite crystals in the ambient weight lattice
- Added _test_fast_iter method to compare two different ways of creating list of classical crystals

New features for Kirillov-Reshetikhin crystals:

- Implementation of Kirillov-Reshetikhin crystals B^{r,s} of type E_6^{(1)} for r=1,2,6
- Pointer to KirillovReshetikhin crystals given in /combinat/crystals/affine.py (as requested by Dan Bump)
- Added R-matrix for tensor product of two KR crystals

Bug fix:

- Fixed whitespace problems in
  /combinat/crystals/crystals.py
  /combinat/crystals/kirillov_reshetikhin.py
  /combinat/crystals/affine.py
  /combinat/crystals/spins.py
  /combinat/crystals/tensor_products.py
  /combinat/crystals/fast_crystals.py
  /combinat/crystals/letters.py

Depends on trac ticket #7978 (trac_7978_crystal_cleanup-as.patch)


**Assignee:** sage-combinat

**CC:**  sage-combinat

**Keywords:** combinatorics, crystals, KR crystals

**Author:** Anne Schilling

**Reviewer:** Daniel Bump

**Merged:** sage-4.3.3.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/8154





---

archive/issue_comments_066238.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n New features for crystals:\n \n - Started framework for general highest weight crystals in /combinat/crystals/highest_weight.py\n-  - Implementation of finite dimensional highest weight crystals for type E6 and E7\n+- Implementation of finite dimensional highest weight crystals for type E6 and E7\n - Added new class for direct sums of crystals in /combinat/crystals/direct_sum.py\n - Added a new crystal morphism function for acyclic crystals\n - Added the Demazure operators on crystals\n``````\n",
    "created_at": "2010-02-02T16:33:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8154#issuecomment-66238",
    "user": "https://github.com/anneschilling"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 New features for crystals:
 
 - Started framework for general highest weight crystals in /combinat/crystals/highest_weight.py
-  - Implementation of finite dimensional highest weight crystals for type E6 and E7
+- Implementation of finite dimensional highest weight crystals for type E6 and E7
 - Added new class for direct sums of crystals in /combinat/crystals/direct_sum.py
 - Added a new crystal morphism function for acyclic crystals
 - Added the Demazure operators on crystals
``````




---

archive/issue_events_058211.json:
```json
{
    "actor": "https://github.com/anneschilling",
    "created_at": "2010-02-02T16:58:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8154",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8154#event-58211"
}
```



---

archive/issue_comments_066239.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,7 @@\n New features for crystals:\n \n-- Started framework for general highest weight crystals in /combinat/crystals/highest_weight.py\n+- Started framework for general highest weight crystals in /combinat/crystals/highest_weight.py (with contributions from Ni\n+colas M. Thiery)\n - Implementation of finite dimensional highest weight crystals for type E6 and E7\n - Added new class for direct sums of crystals in /combinat/crystals/direct_sum.py\n - Added a new crystal morphism function for acyclic crystals\n@@ -17,13 +18,13 @@\n Bug fix:\n \n - Fixed whitespace problems in\n-/combinat/crystals/crystals.py\n-/combinat/crystals/kirillov_reshetikhin.py\n-/combinat/crystals/affine.py\n-/combinat/crystals/spins.py\n-/combinat/crystals/tensor_products.py\n-/combinat/crystals/fast_crystals.py\n-/combinat/crystals/letters.py\n+  /combinat/crystals/crystals.py\n+  /combinat/crystals/kirillov_reshetikhin.py\n+  /combinat/crystals/affine.py\n+  /combinat/crystals/spins.py\n+  /combinat/crystals/tensor_products.py\n+  /combinat/crystals/fast_crystals.py\n+  /combinat/crystals/letters.py\n \n Depends on trac ticket #7978 (trac_7978_crystal_cleanup-as.patch)\n \n``````\n",
    "created_at": "2010-02-02T22:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8154#issuecomment-66239",
    "user": "https://github.com/anneschilling"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,7 @@
 New features for crystals:
 
-- Started framework for general highest weight crystals in /combinat/crystals/highest_weight.py
+- Started framework for general highest weight crystals in /combinat/crystals/highest_weight.py (with contributions from Ni
+colas M. Thiery)
 - Implementation of finite dimensional highest weight crystals for type E6 and E7
 - Added new class for direct sums of crystals in /combinat/crystals/direct_sum.py
 - Added a new crystal morphism function for acyclic crystals
@@ -17,13 +18,13 @@
 Bug fix:
 
 - Fixed whitespace problems in
-/combinat/crystals/crystals.py
-/combinat/crystals/kirillov_reshetikhin.py
-/combinat/crystals/affine.py
-/combinat/crystals/spins.py
-/combinat/crystals/tensor_products.py
-/combinat/crystals/fast_crystals.py
-/combinat/crystals/letters.py
+  /combinat/crystals/crystals.py
+  /combinat/crystals/kirillov_reshetikhin.py
+  /combinat/crystals/affine.py
+  /combinat/crystals/spins.py
+  /combinat/crystals/tensor_products.py
+  /combinat/crystals/fast_crystals.py
+  /combinat/crystals/letters.py
 
 Depends on trac ticket #7978 (trac_7978_crystal_cleanup-as.patch)
 
``````




---

archive/attachments_010049.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_8154_affine-E-as.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8154/trac_8154_affine-E-as.patch",
    "created_at": "2010-02-02T22:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8154",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/anneschilling"
}
```



---

archive/issue_comments_066240.json:
```json
{
    "body": "",
    "created_at": "2010-02-02T22:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8154#issuecomment-66240",
    "user": "https://github.com/anneschilling"
}
```





---

archive/issue_comments_066241.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,7 +1,6 @@\n New features for crystals:\n \n-- Started framework for general highest weight crystals in /combinat/crystals/highest_weight.py (with contributions from Ni\n-colas M. Thiery)\n+- Started framework for general highest weight crystals in /combinat/crystals/highest_weight.py (with contributions from Nicolas M. Thiery)\n - Implementation of finite dimensional highest weight crystals for type E6 and E7\n - Added new class for direct sums of crystals in /combinat/crystals/direct_sum.py\n - Added a new crystal morphism function for acyclic crystals\n``````\n",
    "created_at": "2010-02-02T22:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8154#issuecomment-66241",
    "user": "https://github.com/anneschilling"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,7 +1,6 @@
 New features for crystals:
 
-- Started framework for general highest weight crystals in /combinat/crystals/highest_weight.py (with contributions from Ni
-colas M. Thiery)
+- Started framework for general highest weight crystals in /combinat/crystals/highest_weight.py (with contributions from Nicolas M. Thiery)
 - Implementation of finite dimensional highest weight crystals for type E6 and E7
 - Added new class for direct sums of crystals in /combinat/crystals/direct_sum.py
 - Added a new crystal morphism function for acyclic crystals
``````




---

archive/issue_events_058212.json:
```json
{
    "actor": "https://github.com/anneschilling",
    "created_at": "2010-02-02T23:08:53Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/8154",
    "rename": {
        "from": "Enhencement for crystals",
        "to": "Enhancement for crystals"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8154#event-58212"
}
```



---

archive/issue_comments_066242.json:
```json
{
    "body": "**Reviewer:** Daniel Bump",
    "created_at": "2010-02-05T00:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8154#issuecomment-66242",
    "user": "https://github.com/dwbump"
}
```

**Reviewer:** Daniel Bump



---

archive/issue_events_058213.json:
```json
{
    "actor": "https://github.com/dwbump",
    "created_at": "2010-02-12T13:05:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8154",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8154#event-58213"
}
```



---

archive/issue_events_058214.json:
```json
{
    "actor": "https://github.com/dwbump",
    "created_at": "2010-02-12T13:05:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8154",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8154#event-58214"
}
```



---

archive/issue_events_058215.json:
```json
{
    "actor": "https://github.com/dwbump",
    "created_at": "2010-02-12T13:05:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8154",
    "milestone": "sage-4.3.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8154#event-58215"
}
```



---

archive/issue_comments_066243.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe patch (which goes on top of #7978) applies cleanly to Sage 4.3.2. It passes sage -testall.\nI also tested various things to my satisfaction.\n\nThe Demazure operators can be described at two different levels: either as difference\noperators on the weight space or (following Littelmann) as operators on the crystal.\nHere they are implemented as operators on the crystal. They seem to work correctly.\nLater it might be useful to implement them independently in \nsage.combinat.root_systems.weyl_characters in the WeightRing.\n\nThe direct sums of crystals are implemented.This is essentially just the disjoint\nunion. One point is that if two component crystals are equal, a \"keepkey\" can be\nused to paint them different colors. Then the disjoint union produces a multiset.\nThis scheme is inherited from the parent class DisjointUnionEnumeratedSets where\nit is noted that it is subject to future change. I suppose this could be improved\nbut that changes must first come in sage.sets.disjoint_union_enumerated_set.py.\n\nThe framework for general highest weight crystals is important. Currently one can\nproduce all finite highest weight crystals for types A,B,C,D and G2, but one must know how to do it.\nFor types A and C, the CrystalOfTableaux is sufficient but for types B and D one has half integral\nweights and crystals with half-integral highest weight must be created by tensoring a spin crystal\nwith a CrystalOfTableaux. The framework in highest_weight.py is a step towards making this easier.\nIt should not be hard to implement this for the finite classical Cartan types.\n\nVarious other enhancements and fixes.\n\nI tested the patch to my satisfaction and recommend merging it.",
    "created_at": "2010-02-12T13:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8154#issuecomment-66243",
    "user": "https://github.com/dwbump"
}
```

<a id='comment:7'></a>
The patch (which goes on top of #7978) applies cleanly to Sage 4.3.2. It passes sage -testall.
I also tested various things to my satisfaction.

The Demazure operators can be described at two different levels: either as difference
operators on the weight space or (following Littelmann) as operators on the crystal.
Here they are implemented as operators on the crystal. They seem to work correctly.
Later it might be useful to implement them independently in 
sage.combinat.root_systems.weyl_characters in the WeightRing.

The direct sums of crystals are implemented.This is essentially just the disjoint
union. One point is that if two component crystals are equal, a "keepkey" can be
used to paint them different colors. Then the disjoint union produces a multiset.
This scheme is inherited from the parent class DisjointUnionEnumeratedSets where
it is noted that it is subject to future change. I suppose this could be improved
but that changes must first come in sage.sets.disjoint_union_enumerated_set.py.

The framework for general highest weight crystals is important. Currently one can
produce all finite highest weight crystals for types A,B,C,D and G2, but one must know how to do it.
For types A and C, the CrystalOfTableaux is sufficient but for types B and D one has half integral
weights and crystals with half-integral highest weight must be created by tensoring a spin crystal
with a CrystalOfTableaux. The framework in highest_weight.py is a step towards making this easier.
It should not be hard to implement this for the finite classical Cartan types.

Various other enhancements and fixes.

I tested the patch to my satisfaction and recommend merging it.



---

archive/issue_comments_066244.json:
```json
{
    "body": "**Merged:** sage-4.3.3.alpha1",
    "created_at": "2010-02-14T14:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8154#issuecomment-66244",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Merged:** sage-4.3.3.alpha1



---

archive/issue_events_058216.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2010-02-14T14:34:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8154",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8154#event-58216"
}
```



---

archive/issue_events_058217.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2010-02-14T14:34:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8154",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8154#event-58217"
}
```
