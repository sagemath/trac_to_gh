# Issue 8568: can not simplify derivative of erf

archive/issues_008568.json:
```json
{
    "assignees": [
        "https://github.com/burcin"
    ],
    "body": "Sometimes sage can differentiate erf, but if there are two variables involved it gets confused in simplification and passes too many arguments to erf in maxima.\n\n```\n----------------------------------------------------------------------\n| Sage Version 4.3.3, Release Date: 2010-02-21                       |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nsage: var('c x')\n(c, x)\nsage: diff(erf(x), x)\nD[0](erf)(x)\nsage: simplify(diff(erf(x), x))\n2*e^(-x^2)/sqrt(pi)\nsage: diff(erf(c * x), x)\nc*D[0](erf)(c*x)\nsage: simplify(diff(erf(c * x), x))\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/.../<ipython console> in <module>()\n\n/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/calculus/functional.pyc\nin simplify(f)\n     49     \"\"\"\n     50     try:\n---> 51         return f.simplify()\n     52     except AttributeError:\n     53         return f\n\n/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/symbolic/expression.so\nin sage.symbolic.expression.Expression.simplify (sage/symbolic/expression.cpp:21495)()\n\n/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/symbolic/expression.so\nin sage.symbolic.expression.Expression._maxima_ (sage/symbolic/expression.cpp:3435)()\n\n/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/structure/sage_object.so\nin sage.structure.sage_object.SageObject._interface_ (sage/structure/sage_object.c:3501)()\n\n/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc\nin __call__(self, x, name)\n   1030             \n   1031         if isinstance(x, basestring):\n-> 1032             return cls(self, x, name=name)\n   1033         try:\n   1034             return self._coerce_from_special_method(x)\n\n/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc\nin __init__(self, parent, value, is_name, name)\n   1449             except (TypeError, KeyboardInterrupt, RuntimeError, ValueError), x:\n   1450                 self._session_number = -1\n-> 1451                 raise TypeError, x\n   1452         self._session_number = parent._session_number\n   1453 \n\nTypeError: Error executing code in Maxima\nCODE:\n        sage4 : (c)*(diff('erf(c, x), c, 1))$\nMaxima ERROR:\n        \nWrong number of arguments to erf\n -- an error. To debug this try: debugmode(true);\n```\n\nCC:  @jasongrout @burcin\n\nComponent: **calculus**\n\nAuthor: **Burcin Erocal, Karl-Dieter Crisman**\n\nReviewer: **Karl-Dieter Crisman, Burcin Erocal**\n\nMerged: **sage-4.6.alpha2**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/8568_\n\n",
    "closed_at": "2010-09-29T08:39:03Z",
    "created_at": "2010-03-21T07:36:42Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20calculus",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "can not simplify derivative of erf",
    "type": "issue",
    "updated_at": "2010-09-29T08:39:03Z",
    "url": "https://github.com/sagemath/sage/issues/8568",
    "user": "https://github.com/sagetrac-gmcmanus"
}
```
Sometimes sage can differentiate erf, but if there are two variables involved it gets confused in simplification and passes too many arguments to erf in maxima.

```
----------------------------------------------------------------------
| Sage Version 4.3.3, Release Date: 2010-02-21                       |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
sage: var('c x')
(c, x)
sage: diff(erf(x), x)
D[0](erf)(x)
sage: simplify(diff(erf(x), x))
2*e^(-x^2)/sqrt(pi)
sage: diff(erf(c * x), x)
c*D[0](erf)(c*x)
sage: simplify(diff(erf(c * x), x))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/.../<ipython console> in <module>()

/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/calculus/functional.pyc
in simplify(f)
     49     """
     50     try:
---> 51         return f.simplify()
     52     except AttributeError:
     53         return f

/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/symbolic/expression.so
in sage.symbolic.expression.Expression.simplify (sage/symbolic/expression.cpp:21495)()

/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/symbolic/expression.so
in sage.symbolic.expression.Expression._maxima_ (sage/symbolic/expression.cpp:3435)()

/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/structure/sage_object.so
in sage.structure.sage_object.SageObject._interface_ (sage/structure/sage_object.c:3501)()

/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc
in __call__(self, x, name)
   1030             
   1031         if isinstance(x, basestring):
-> 1032             return cls(self, x, name=name)
   1033         try:
   1034             return self._coerce_from_special_method(x)

/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc
in __init__(self, parent, value, is_name, name)
   1449             except (TypeError, KeyboardInterrupt, RuntimeError, ValueError), x:
   1450                 self._session_number = -1
-> 1451                 raise TypeError, x
   1452         self._session_number = parent._session_number
   1453 

TypeError: Error executing code in Maxima
CODE:
        sage4 : (c)*(diff('erf(c, x), c, 1))$
Maxima ERROR:
        
Wrong number of arguments to erf
 -- an error. To debug this try: debugmode(true);
```

CC:  @jasongrout @burcin

Component: **calculus**

Author: **Burcin Erocal, Karl-Dieter Crisman**

Reviewer: **Karl-Dieter Crisman, Burcin Erocal**

Merged: **sage-4.6.alpha2**

_Issue created by migration from https://trac.sagemath.org/ticket/8568_





---

archive/issue_events_106848.json:
```json
{
    "actor": "https://github.com/sagetrac-gmcmanus",
    "created_at": "2010-03-21T07:36:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20calculus",
    "label_color": "0000ff",
    "label_name": "c: calculus",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106848"
}
```



---

archive/issue_events_106849.json:
```json
{
    "actor": "https://github.com/sagetrac-gmcmanus",
    "created_at": "2010-03-21T07:36:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106849"
}
```



---

archive/issue_events_106850.json:
```json
{
    "actor": "https://github.com/sagetrac-gmcmanus",
    "created_at": "2010-03-21T07:36:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106850"
}
```



---

archive/issue_events_106851.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-03-21T07:36:42Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "subject": "https://github.com/sagetrac-gmcmanus",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106851"
}
```



---

archive/issue_comments_068535.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\n\n```\nCODE:\n        sage4 : (c)*(diff('erf(c, x), c, 1))$\nMaxima ERROR:\n```\nThis looks suspicious.  Why is it not erf(c*x)?  I will investigate.",
    "created_at": "2010-05-26T20:24:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68535",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:1" align="right">comment:1</div>


```
CODE:
        sage4 : (c)*(diff('erf(c, x), c, 1))$
Maxima ERROR:
```
This looks suspicious.  Why is it not erf(c*x)?  I will investigate.



---

archive/issue_comments_068536.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAnother problem... note that the variable being used in differentiation is c, not x!",
    "created_at": "2010-05-26T21:10:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68536",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:2" align="right">comment:2</div>

Another problem... note that the variable being used in differentiation is c, not x!



---

archive/issue_comments_068537.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nSomehow it must be related to this inconsistency.\n\n```\nsage: a\nc*D[0](erf)(c*x)\nsage: a._maxima_init_()\n\"(c)*(diff('erf(c, x), c, 1))\"\nsage: a.operands()[1].operands()[0]\nc*x\nsage: a.operands()[1].operands()[0]._maxima_init_()\n'(c)*(x)'\n```\nAny ideas?",
    "created_at": "2010-05-26T21:25:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68537",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:3" align="right">comment:3</div>

Somehow it must be related to this inconsistency.

```
sage: a
c*D[0](erf)(c*x)
sage: a._maxima_init_()
"(c)*(diff('erf(c, x), c, 1))"
sage: a.operands()[1].operands()[0]
c*x
sage: a.operands()[1].operands()[0]._maxima_init_()
'(c)*(x)'
```
Any ideas?



---

archive/issue_comments_068538.json:
```json
{
    "body": "Attachment: **[trac_8568-diff_conversion.patch.gz](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff_conversion.patch.gz)**",
    "created_at": "2010-05-27T10:38:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68538",
    "user": "https://github.com/burcin"
}
```

Attachment: **[trac_8568-diff_conversion.patch.gz](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff_conversion.patch.gz)**



---

archive/issue_comments_068539.json:
```json
{
    "body": "Author: **Burcin Erocal**",
    "created_at": "2010-05-27T10:45:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68539",
    "user": "https://github.com/burcin"
}
```

Author: **Burcin Erocal**



---

archive/issue_events_106852.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-05-27T10:45:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "milestone_number": null,
    "milestone_title": "sage-4.4.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106852"
}
```



---

archive/issue_comments_068540.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI attached a patch which fixes the conversion to maxima. This doesn't fix the problem in the title of this ticket, \"cannot simplify derivative of erf\", since we cannot convert derivatives to maxima format if the arguments to the function are not variables.\n\nIn order to fix the problem reported here, we can add a `_derivative_` method to the `Function_erf()` class defined in `sage.functions.other`.",
    "created_at": "2010-05-27T10:45:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68540",
    "user": "https://github.com/burcin"
}
```

<div id="comment:4" align="right">comment:4</div>

I attached a patch which fixes the conversion to maxima. This doesn't fix the problem in the title of this ticket, "cannot simplify derivative of erf", since we cannot convert derivatives to maxima format if the arguments to the function are not variables.

In order to fix the problem reported here, we can add a `_derivative_` method to the `Function_erf()` class defined in `sage.functions.other`.



---

archive/issue_events_106853.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-05-27T10:45:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106853"
}
```



---

archive/issue_comments_068541.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThat sounds like a great idea.  Patch coming up.",
    "created_at": "2010-05-27T15:30:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68541",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:5" align="right">comment:5</div>

That sounds like a great idea.  Patch coming up.



---

archive/issue_comments_068542.json:
```json
{
    "body": "Apply only this.",
    "created_at": "2010-05-27T15:46:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68542",
    "user": "https://github.com/kcrisman"
}
```

Apply only this.



---

archive/issue_comments_068543.json:
```json
{
    "body": "Reviewer: **Karl-Dieter Crisman**",
    "created_at": "2010-05-27T15:48:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68543",
    "user": "https://github.com/kcrisman"
}
```

Reviewer: **Karl-Dieter Crisman**



---

archive/issue_comments_068544.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAttachment: **[trac_8568-diff-conv-and-erf-deriv.patch.gz](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff-conv-and-erf-deriv.patch.gz)**\n\nThis looks like a good change.  I did the other thing, and put the test of the original bug report in that file, since it seemed like it belonged there now that it works :)  Should pass all tests (only failures for me were related to Maxima upgrade).",
    "created_at": "2010-05-27T15:48:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68544",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:6" align="right">comment:6</div>

Attachment: **[trac_8568-diff-conv-and-erf-deriv.patch.gz](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff-conv-and-erf-deriv.patch.gz)**

This looks like a good change.  I did the other thing, and put the test of the original bug report in that file, since it seemed like it belonged there now that it works :)  Should pass all tests (only failures for me were related to Maxima upgrade).



---

archive/issue_events_106854.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2010-05-27T15:48:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106854"
}
```



---

archive/issue_events_106855.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2010-05-27T15:48:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106855"
}
```



---

archive/issue_comments_068545.json:
```json
{
    "body": "Changed author from **Burcin Erocal** to **Burcin Erocal, Karl-Dieter Crisman**",
    "created_at": "2010-05-27T15:48:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68545",
    "user": "https://github.com/kcrisman"
}
```

Changed author from **Burcin Erocal** to **Burcin Erocal, Karl-Dieter Crisman**



---

archive/issue_comments_068546.json:
```json
{
    "body": "Attachment: **[trac_8568-erf-deriv.patch.gz](https://github.com/sagemath/sage/files/ticket8568/trac_8568-erf-deriv.patch.gz)**",
    "created_at": "2010-05-27T16:04:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68546",
    "user": "https://github.com/burcin"
}
```

Attachment: **[trac_8568-erf-deriv.patch.gz](https://github.com/sagemath/sage/files/ticket8568/trac_8568-erf-deriv.patch.gz)**



---

archive/issue_comments_068547.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAttachment: **[trac_8568-diff_conversion.take2.patch.gz](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff_conversion.take2.patch.gz)**\n\nThanks for the quick fix!\n\nYour patch removes my commit message, which I tried hard to make long and explanatory. :) Please submit a separate patch in the future.\n\nI uploaded two new patches, one including your changes to the `erf` function, and the other my fixes for `expression_conversions.py`.\n\nPatches to be applied:\n* [attachment: trac_8568-diff_conversion.take2.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff_conversion.take2.patch.gz)\n* [attachment: trac_8568-erf-deriv.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-erf-deriv.patch.gz)",
    "created_at": "2010-05-27T16:18:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68547",
    "user": "https://github.com/burcin"
}
```

<div id="comment:7" align="right">comment:7</div>

Attachment: **[trac_8568-diff_conversion.take2.patch.gz](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff_conversion.take2.patch.gz)**

Thanks for the quick fix!

Your patch removes my commit message, which I tried hard to make long and explanatory. :) Please submit a separate patch in the future.

I uploaded two new patches, one including your changes to the `erf` function, and the other my fixes for `expression_conversions.py`.

Patches to be applied:
* [attachment: trac_8568-diff_conversion.take2.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff_conversion.take2.patch.gz)
* [attachment: trac_8568-erf-deriv.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-erf-deriv.patch.gz)



---

archive/issue_comments_068548.json:
```json
{
    "body": "Changed reviewer from **Karl-Dieter Crisman** to **Karl-Dieter Crisman, Burcin Erocal**",
    "created_at": "2010-05-27T16:18:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68548",
    "user": "https://github.com/burcin"
}
```

Changed reviewer from **Karl-Dieter Crisman** to **Karl-Dieter Crisman, Burcin Erocal**



---

archive/issue_events_106856.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-05-27T16:18:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106856"
}
```



---

archive/issue_events_106857.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-05-27T16:18:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106857"
}
```



---

archive/issue_comments_068549.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nSorry, Burcin, truthfully I hadn't even noticed that!  I was just trying to make a unified patch, because I hate all these five-patch tickets where they move things around from patch to patch - in this case, the actual test for the fix - since they are very hard for me to read.  But I'll be more careful now :)",
    "created_at": "2010-05-27T16:54:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68549",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:8" align="right">comment:8</div>

Sorry, Burcin, truthfully I hadn't even noticed that!  I was just trying to make a unified patch, because I hate all these five-patch tickets where they move things around from patch to patch - in this case, the actual test for the fix - since they are very hard for me to read.  But I'll be more careful now :)



---

archive/issue_comments_068550.json:
```json
{
    "body": "Merged: **sage-4.4.4.alpha0**",
    "created_at": "2010-06-06T01:27:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68550",
    "user": "https://github.com/mwhansen"
}
```

Merged: **sage-4.4.4.alpha0**



---

archive/issue_events_106858.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-06-06T01:27:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106858"
}
```



---

archive/issue_events_106859.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-06-06T01:27:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106859"
}
```



---

archive/issue_comments_068551.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThis actually causes a failure in sage/interfaces/maxima.py",
    "created_at": "2010-06-07T06:53:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68551",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:10" align="right">comment:10</div>

This actually causes a failure in sage/interfaces/maxima.py



---

archive/issue_events_106860.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-06-07T06:53:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106860"
}
```



---

archive/issue_events_106861.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-06-07T06:53:25Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106861"
}
```



---

archive/issue_comments_068552.json:
```json
{
    "body": "Changed merged from **sage-4.4.4.alpha0** to none",
    "created_at": "2010-06-07T06:53:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68552",
    "user": "https://github.com/mwhansen"
}
```

Changed merged from **sage-4.4.4.alpha0** to none



---

archive/issue_comments_068553.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nHere it is.  I'll try to fix it quickly, hopefully this can still get in 4.4.4.\n\n```\nFile \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/devel/sage/sage/interfaces/maxima.py\", line 2245:\n    sage: latex(maxima(derivative(ceil(x*y*d), d,x,x,y)))\nException raised:\n    Traceback (most recent call last):\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_70[4]>\", line 1, in <module>\n        latex(maxima(derivative(ceil(x*y*d), d,x,x,y)))###line 2245:\n    sage: latex(maxima(derivative(ceil(x*y*d), d,x,x,y)))\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/expect.py\", line 1034, in __call__\n        return self._coerce_from_special_method(x)\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/expect.py\", line 1058, in _coerce_from_special_method\n        return (x.__getattribute__(s))(self)\n      File \"expression.pyx\", line 435, in sage.symbolic.expression.Expression._maxima_ (sage/symbolic/expression.cpp:3420)\n      File \"sage_object.pyx\", line 379, in sage.structure.sage_object.SageObject._interface_ (sage/structure/sage_object.c:3374)\n      File \"sage_object.pyx\", line 468, in sage.structure.sage_object.SageObject._maxima_init_ (sage/structure/sage_object.c:5083)\n      File \"expression.pyx\", line 458, in sage.symbolic.expression.Expression._interface_init_ (sage/symbolic/expression.cpp:3510)\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py\", line 214, in __call__\n        return self.arithmetic(ex, operator)\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py\", line 515, in arithmetic\n        args = [\"(%s)\"%self(op) for op in ex.operands()]\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py\", line 214, in __call__\n        return self.arithmetic(ex, operator)\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py\", line 515, in arithmetic\n        args = [\"(%s)\"%self(op) for op in ex.operands()]\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py\", line 218, in __call__\n        return self.derivative(ex, operator)\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py\", line 495, in derivative\n        raise NotImplementedError, \"arguments must be distinct variables\"\n    NotImplementedError: arguments must be distinct variables\n**********************************************************************\n1 items had failures:\n   1 of   6 in __main__.example_70\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /home/kcrisman/.sage//tmp/.doctest_maxima.py\n\t [14.2 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\tsage -t  \"devel/sage/sage/interfaces/maxima.py\"\n```",
    "created_at": "2010-06-08T01:03:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68553",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:11" align="right">comment:11</div>

Here it is.  I'll try to fix it quickly, hopefully this can still get in 4.4.4.

```
File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/devel/sage/sage/interfaces/maxima.py", line 2245:
    sage: latex(maxima(derivative(ceil(x*y*d), d,x,x,y)))
Exception raised:
    Traceback (most recent call last):
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_70[4]>", line 1, in <module>
        latex(maxima(derivative(ceil(x*y*d), d,x,x,y)))###line 2245:
    sage: latex(maxima(derivative(ceil(x*y*d), d,x,x,y)))
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/expect.py", line 1034, in __call__
        return self._coerce_from_special_method(x)
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/expect.py", line 1058, in _coerce_from_special_method
        return (x.__getattribute__(s))(self)
      File "expression.pyx", line 435, in sage.symbolic.expression.Expression._maxima_ (sage/symbolic/expression.cpp:3420)
      File "sage_object.pyx", line 379, in sage.structure.sage_object.SageObject._interface_ (sage/structure/sage_object.c:3374)
      File "sage_object.pyx", line 468, in sage.structure.sage_object.SageObject._maxima_init_ (sage/structure/sage_object.c:5083)
      File "expression.pyx", line 458, in sage.symbolic.expression.Expression._interface_init_ (sage/symbolic/expression.cpp:3510)
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py", line 214, in __call__
        return self.arithmetic(ex, operator)
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py", line 515, in arithmetic
        args = ["(%s)"%self(op) for op in ex.operands()]
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py", line 214, in __call__
        return self.arithmetic(ex, operator)
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py", line 515, in arithmetic
        args = ["(%s)"%self(op) for op in ex.operands()]
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py", line 218, in __call__
        return self.derivative(ex, operator)
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py", line 495, in derivative
        raise NotImplementedError, "arguments must be distinct variables"
    NotImplementedError: arguments must be distinct variables
**********************************************************************
1 items had failures:
   1 of   6 in __main__.example_70
***Test Failed*** 1 failures.
For whitespace errors, see the file /home/kcrisman/.sage//tmp/.doctest_maxima.py
	 [14.2 s]
 
----------------------------------------------------------------------
The following tests failed:


	sage -t  "devel/sage/sage/interfaces/maxima.py"
```



---

archive/issue_comments_068554.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nOr not.\n\n```\nsage: maxima(derivative(ceil(d),d))\n'diff('ceil(d),d,1)\nsage: maxima(derivative(ceil(x*d),d))\n<same NotImplementedError>\n```\nSo the problem is that Burcin's Maxima conversion change now doesn't work with\n\n```\n    493         if (not all(is_SymbolicVariable(v) for v in args) or\n    494             len(args) != len(set(args))):\n--> 495             raise NotImplementedError, \"arguments must be distinct variables\"\n    496 \n    497         f = operator.function()\n```\nin derivative().  In fact, he even included a doctest for it!\n\n```\nWe can only convert to Maxima derivatives if the corresponding operand of the function is a variable:: \nsage: y = var('y') \nsage: t = f(x*y).diff(x) \nsage: m.derivative(t, t.operator()) \nTraceback (most recent call last): \n... \nNotImplementedError: arguments must be distinct variables \n```\nThis example could be fixed if one fixed\n\n```\nsage: derivative(ceil(x),x)\nD[0](ceil)(x)\n```\nso that there isn't a derivative function defined for ceil.  I'm not sure exactly what would count, though... just the zero function?",
    "created_at": "2010-06-08T01:22:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68554",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:12" align="right">comment:12</div>

Or not.

```
sage: maxima(derivative(ceil(d),d))
'diff('ceil(d),d,1)
sage: maxima(derivative(ceil(x*d),d))
<same NotImplementedError>
```
So the problem is that Burcin's Maxima conversion change now doesn't work with

```
    493         if (not all(is_SymbolicVariable(v) for v in args) or
    494             len(args) != len(set(args))):
--> 495             raise NotImplementedError, "arguments must be distinct variables"
    496 
    497         f = operator.function()
```
in derivative().  In fact, he even included a doctest for it!

```
We can only convert to Maxima derivatives if the corresponding operand of the function is a variable:: 
sage: y = var('y') 
sage: t = f(x*y).diff(x) 
sage: m.derivative(t, t.operator()) 
Traceback (most recent call last): 
... 
NotImplementedError: arguments must be distinct variables 
```
This example could be fixed if one fixed

```
sage: derivative(ceil(x),x)
D[0](ceil)(x)
```
so that there isn't a derivative function defined for ceil.  I'm not sure exactly what would count, though... just the zero function?



---

archive/issue_comments_068555.json:
```json
{
    "body": "Attachment: **[trac_8568-fix_doctests.patch.gz](https://github.com/sagemath/sage/files/ticket8568/trac_8568-fix_doctests.patch.gz)**",
    "created_at": "2010-09-08T11:44:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68555",
    "user": "https://github.com/burcin"
}
```

Attachment: **[trac_8568-fix_doctests.patch.gz](https://github.com/sagemath/sage/files/ticket8568/trac_8568-fix_doctests.patch.gz)**



---

archive/issue_events_106862.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-09-08T11:48:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106862"
}
```



---

archive/issue_events_106863.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-09-08T11:48:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106863"
}
```



---

archive/issue_comments_068556.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI attached a new patch which fixes the doctest failures in `interfaces/maxima.py`. The patch changes the test to use a symbolic function `f` instead of `ceil`, adds the error message that we need distinct arguments to convert to maxima and a test with an expression where the variables are indeed distinct arguments.\n\nAdding a function to represent the derivative of `ceil()` and `floor()` is now #9874.\n\nPatches should be applied in this order:\n\n* [attachment: trac_8568-diff_conversion.take2.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff_conversion.take2.patch.gz)\n* [attachment: trac_8568-erf-deriv.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-erf-deriv.patch.gz)\n* [attachment: trac_8568-fix_doctests.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-fix_doctests.patch.gz)",
    "created_at": "2010-09-08T11:48:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68556",
    "user": "https://github.com/burcin"
}
```

<div id="comment:13" align="right">comment:13</div>

I attached a new patch which fixes the doctest failures in `interfaces/maxima.py`. The patch changes the test to use a symbolic function `f` instead of `ceil`, adds the error message that we need distinct arguments to convert to maxima and a test with an expression where the variables are indeed distinct arguments.

Adding a function to represent the derivative of `ceil()` and `floor()` is now #9874.

Patches should be applied in this order:

* [attachment: trac_8568-diff_conversion.take2.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff_conversion.take2.patch.gz)
* [attachment: trac_8568-erf-deriv.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-erf-deriv.patch.gz)
* [attachment: trac_8568-fix_doctests.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-fix_doctests.patch.gz)



---

archive/issue_comments_068557.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThis all still applies fine to Sage 4.6.alpha1, and all doctests I could think of pass.  Everything else is the same - positive review!\n\nBy the way, thanks for opening that other ticket, Burcin - sometimes I get paralyzed trying to decide what the best course of action is on reviews.",
    "created_at": "2010-09-21T20:01:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68557",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:14" align="right">comment:14</div>

This all still applies fine to Sage 4.6.alpha1, and all doctests I could think of pass.  Everything else is the same - positive review!

By the way, thanks for opening that other ticket, Burcin - sometimes I get paralyzed trying to decide what the best course of action is on reviews.



---

archive/issue_events_106864.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2010-09-21T20:01:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106864"
}
```



---

archive/issue_events_106865.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2010-09-21T20:01:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106865"
}
```



---

archive/issue_events_106866.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-29T08:39:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106866"
}
```



---

archive/issue_events_106867.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-29T08:39:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-106867"
}
```



---

archive/issue_comments_068558.json:
```json
{
    "body": "Merged: **sage-4.6.alpha2**",
    "created_at": "2010-09-29T08:39:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-68558",
    "user": "https://github.com/qed777"
}
```

Merged: **sage-4.6.alpha2**
