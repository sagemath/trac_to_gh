# Issue 8568: can not simplify derivative of erf

archive/issues_008568.json:
```json
{
    "body": "Sometimes sage can differentiate erf, but if there are two variables involved it gets confused in simplification and passes too many arguments to erf in maxima.\n\n```\n----------------------------------------------------------------------\n| Sage Version 4.3.3, Release Date: 2010-02-21                       |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nsage: var('c x')\n(c, x)\nsage: diff(erf(x), x)\nD[0](erf)(x)\nsage: simplify(diff(erf(x), x))\n2*e^(-x^2)/sqrt(pi)\nsage: diff(erf(c * x), x)\nc*D[0](erf)(c*x)\nsage: simplify(diff(erf(c * x), x))\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/.../<ipython console> in <module>()\n\n/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/calculus/functional.pyc\nin simplify(f)\n     49     \"\"\"\n     50     try:\n---> 51         return f.simplify()\n     52     except AttributeError:\n     53         return f\n\n/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/symbolic/expression.so\nin sage.symbolic.expression.Expression.simplify (sage/symbolic/expression.cpp:21495)()\n\n/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/symbolic/expression.so\nin sage.symbolic.expression.Expression._maxima_ (sage/symbolic/expression.cpp:3435)()\n\n/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/structure/sage_object.so\nin sage.structure.sage_object.SageObject._interface_ (sage/structure/sage_object.c:3501)()\n\n/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc\nin __call__(self, x, name)\n   1030             \n   1031         if isinstance(x, basestring):\n-> 1032             return cls(self, x, name=name)\n   1033         try:\n   1034             return self._coerce_from_special_method(x)\n\n/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc\nin __init__(self, parent, value, is_name, name)\n   1449             except (TypeError, KeyboardInterrupt, RuntimeError, ValueError), x:\n   1450                 self._session_number = -1\n-> 1451                 raise TypeError, x\n   1452         self._session_number = parent._session_number\n   1453 \n\nTypeError: Error executing code in Maxima\nCODE:\n        sage4 : (c)*(diff('erf(c, x), c, 1))$\nMaxima ERROR:\n        \nWrong number of arguments to erf\n -- an error. To debug this try: debugmode(true);\n```\n\n**Assignee:** @burcin\n\n**CC:**  @jasongrout @burcin\n\n**Author:** Burcin Erocal, Karl-Dieter Crisman\n\n**Reviewer:** Karl-Dieter Crisman, Burcin Erocal\n\n**Merged:** sage-4.6.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/8568\n\n",
    "closed_at": "2010-09-29T08:39:03Z",
    "created_at": "2010-03-21T07:36:42Z",
    "labels": [
        "component: calculus",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.6",
    "title": "can not simplify derivative of erf",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/8568",
    "user": "https://trac.sagemath.org/admin/accounts/users/gmcmanus"
}
```
Sometimes sage can differentiate erf, but if there are two variables involved it gets confused in simplification and passes too many arguments to erf in maxima.

```
----------------------------------------------------------------------
| Sage Version 4.3.3, Release Date: 2010-02-21                       |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
sage: var('c x')
(c, x)
sage: diff(erf(x), x)
D[0](erf)(x)
sage: simplify(diff(erf(x), x))
2*e^(-x^2)/sqrt(pi)
sage: diff(erf(c * x), x)
c*D[0](erf)(c*x)
sage: simplify(diff(erf(c * x), x))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/.../<ipython console> in <module>()

/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/calculus/functional.pyc
in simplify(f)
     49     """
     50     try:
---> 51         return f.simplify()
     52     except AttributeError:
     53         return f

/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/symbolic/expression.so
in sage.symbolic.expression.Expression.simplify (sage/symbolic/expression.cpp:21495)()

/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/symbolic/expression.so
in sage.symbolic.expression.Expression._maxima_ (sage/symbolic/expression.cpp:3435)()

/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/structure/sage_object.so
in sage.structure.sage_object.SageObject._interface_ (sage/structure/sage_object.c:3501)()

/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc
in __call__(self, x, name)
   1030             
   1031         if isinstance(x, basestring):
-> 1032             return cls(self, x, name=name)
   1033         try:
   1034             return self._coerce_from_special_method(x)

/.../sage-4.3.3-linux-64bit-ubuntu_9.10-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc
in __init__(self, parent, value, is_name, name)
   1449             except (TypeError, KeyboardInterrupt, RuntimeError, ValueError), x:
   1450                 self._session_number = -1
-> 1451                 raise TypeError, x
   1452         self._session_number = parent._session_number
   1453 

TypeError: Error executing code in Maxima
CODE:
        sage4 : (c)*(diff('erf(c, x), c, 1))$
Maxima ERROR:
        
Wrong number of arguments to erf
 -- an error. To debug this try: debugmode(true);
```

**Assignee:** @burcin

**CC:**  @jasongrout @burcin

**Author:** Burcin Erocal, Karl-Dieter Crisman

**Reviewer:** Karl-Dieter Crisman, Burcin Erocal

**Merged:** sage-4.6.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/8568





---

archive/issue_comments_070313.json:
```json
{
    "body": "<a id='comment:1'></a>\n\n```\nCODE:\n        sage4 : (c)*(diff('erf(c, x), c, 1))$\nMaxima ERROR:\n```\nThis looks suspicious.  Why is it not erf(c*x)?  I will investigate.",
    "created_at": "2010-05-26T20:24:41Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70313",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:1'></a>

```
CODE:
        sage4 : (c)*(diff('erf(c, x), c, 1))$
Maxima ERROR:
```
This looks suspicious.  Why is it not erf(c*x)?  I will investigate.



---

archive/issue_comments_070314.json:
```json
{
    "body": "<a id='comment:2'></a>\nAnother problem... note that the variable being used in differentiation is c, not x!",
    "created_at": "2010-05-26T21:10:39Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70314",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:2'></a>
Another problem... note that the variable being used in differentiation is c, not x!



---

archive/issue_comments_070315.json:
```json
{
    "body": "<a id='comment:3'></a>\nSomehow it must be related to this inconsistency.\n\n```\nsage: a\nc*D[0](erf)(c*x)\nsage: a._maxima_init_()\n\"(c)*(diff('erf(c, x), c, 1))\"\nsage: a.operands()[1].operands()[0]\nc*x\nsage: a.operands()[1].operands()[0]._maxima_init_()\n'(c)*(x)'\n```\nAny ideas?",
    "created_at": "2010-05-26T21:25:48Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70315",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:3'></a>
Somehow it must be related to this inconsistency.

```
sage: a
c*D[0](erf)(c*x)
sage: a._maxima_init_()
"(c)*(diff('erf(c, x), c, 1))"
sage: a.operands()[1].operands()[0]
c*x
sage: a.operands()[1].operands()[0]._maxima_init_()
'(c)*(x)'
```
Any ideas?



---

archive/attachments_010707.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_8568-diff_conversion.patch",
    "asset_url": "tarball://root/attachments/ticket8568/trac_8568-diff_conversion.patch",
    "created_at": "2010-05-27T10:38:43Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff_conversion.patch",
    "user": "https://github.com/burcin"
}
```



---

archive/issue_comments_070316.json:
```json
{
    "body": "Attachment [trac_8568-diff_conversion.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff_conversion.patch) by @burcin created at 2010-05-27 10:38:43",
    "created_at": "2010-05-27T10:38:43Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70316",
    "user": "https://github.com/burcin"
}
```

Attachment [trac_8568-diff_conversion.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff_conversion.patch) by @burcin created at 2010-05-27 10:38:43



---

archive/issue_comments_070317.json:
```json
{
    "body": "**Author:** Burcin Erocal",
    "created_at": "2010-05-27T10:45:19Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70317",
    "user": "https://github.com/burcin"
}
```

**Author:** Burcin Erocal



---

archive/issue_events_060960.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-05-27T10:45:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "milestone": "sage-4.4.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-60960"
}
```



---

archive/issue_comments_070318.json:
```json
{
    "body": "<a id='comment:4'></a>\nI attached a patch which fixes the conversion to maxima. This doesn't fix the problem in the title of this ticket, \"cannot simplify derivative of erf\", since we cannot convert derivatives to maxima format if the arguments to the function are not variables.\n\nIn order to fix the problem reported here, we can add a `_derivative_` method to the `Function_erf()` class defined in `sage.functions.other`.",
    "created_at": "2010-05-27T10:45:19Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70318",
    "user": "https://github.com/burcin"
}
```

<a id='comment:4'></a>
I attached a patch which fixes the conversion to maxima. This doesn't fix the problem in the title of this ticket, "cannot simplify derivative of erf", since we cannot convert derivatives to maxima format if the arguments to the function are not variables.

In order to fix the problem reported here, we can add a `_derivative_` method to the `Function_erf()` class defined in `sage.functions.other`.



---

archive/issue_events_060961.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-05-27T10:45:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-60961"
}
```



---

archive/issue_comments_070319.json:
```json
{
    "body": "<a id='comment:5'></a>\nThat sounds like a great idea.  Patch coming up.",
    "created_at": "2010-05-27T15:30:33Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70319",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:5'></a>
That sounds like a great idea.  Patch coming up.



---

archive/issue_comments_070320.json:
```json
{
    "body": "Apply only this.",
    "created_at": "2010-05-27T15:46:35Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70320",
    "user": "https://github.com/kcrisman"
}
```

Apply only this.



---

archive/issue_comments_070321.json:
```json
{
    "body": "**Reviewer:** Karl-Dieter Crisman",
    "created_at": "2010-05-27T15:48:04Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70321",
    "user": "https://github.com/kcrisman"
}
```

**Reviewer:** Karl-Dieter Crisman



---

archive/attachments_010708.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_8568-diff-conv-and-erf-deriv.patch",
    "asset_url": "tarball://root/attachments/ticket8568/trac_8568-diff-conv-and-erf-deriv.patch",
    "created_at": "2010-05-27T15:48:04Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff-conv-and-erf-deriv.patch",
    "user": "https://github.com/kcrisman"
}
```



---

archive/issue_comments_070322.json:
```json
{
    "body": "<a id='comment:6'></a>\nAttachment [trac_8568-diff-conv-and-erf-deriv.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff-conv-and-erf-deriv.patch) by @kcrisman created at 2010-05-27 15:48:04\n\nThis looks like a good change.  I did the other thing, and put the test of the original bug report in that file, since it seemed like it belonged there now that it works :)  Should pass all tests (only failures for me were related to Maxima upgrade).",
    "created_at": "2010-05-27T15:48:04Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70322",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:6'></a>
Attachment [trac_8568-diff-conv-and-erf-deriv.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff-conv-and-erf-deriv.patch) by @kcrisman created at 2010-05-27 15:48:04

This looks like a good change.  I did the other thing, and put the test of the original bug report in that file, since it seemed like it belonged there now that it works :)  Should pass all tests (only failures for me were related to Maxima upgrade).



---

archive/issue_events_060962.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2010-05-27T15:48:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-60962"
}
```



---

archive/issue_events_060963.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2010-05-27T15:48:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-60963"
}
```



---

archive/issue_comments_070323.json:
```json
{
    "body": "**Changing author** from \"Burcin Erocal\" to \"Burcin Erocal, Karl-Dieter Crisman\".",
    "created_at": "2010-05-27T15:48:04Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70323",
    "user": "https://github.com/kcrisman"
}
```

**Changing author** from "Burcin Erocal" to "Burcin Erocal, Karl-Dieter Crisman".



---

archive/attachments_010709.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_8568-erf-deriv.patch",
    "asset_url": "tarball://root/attachments/ticket8568/trac_8568-erf-deriv.patch",
    "created_at": "2010-05-27T16:04:10Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket8568/trac_8568-erf-deriv.patch",
    "user": "https://github.com/burcin"
}
```



---

archive/issue_comments_070324.json:
```json
{
    "body": "Attachment [trac_8568-erf-deriv.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-erf-deriv.patch) by @burcin created at 2010-05-27 16:04:10",
    "created_at": "2010-05-27T16:04:10Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70324",
    "user": "https://github.com/burcin"
}
```

Attachment [trac_8568-erf-deriv.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-erf-deriv.patch) by @burcin created at 2010-05-27 16:04:10



---

archive/attachments_010710.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_8568-diff_conversion.take2.patch",
    "asset_url": "tarball://root/attachments/ticket8568/trac_8568-diff_conversion.take2.patch",
    "created_at": "2010-05-27T16:18:25Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff_conversion.take2.patch",
    "user": "https://github.com/burcin"
}
```



---

archive/issue_comments_070325.json:
```json
{
    "body": "<a id='comment:7'></a>\nAttachment [trac_8568-diff_conversion.take2.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff_conversion.take2.patch) by @burcin created at 2010-05-27 16:18:25\n\nThanks for the quick fix!\n\nYour patch removes my commit message, which I tried hard to make long and explanatory. :) Please submit a separate patch in the future.\n\nI uploaded two new patches, one including your changes to the `erf` function, and the other my fixes for `expression_conversions.py`.\n\nPatches to be applied:\n* [attachment:trac_8568-diff_conversion.take2.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff_conversion.take2.patch)\n* [attachment:trac_8568-erf-deriv.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-erf-deriv.patch)",
    "created_at": "2010-05-27T16:18:25Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70325",
    "user": "https://github.com/burcin"
}
```

<a id='comment:7'></a>
Attachment [trac_8568-diff_conversion.take2.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff_conversion.take2.patch) by @burcin created at 2010-05-27 16:18:25

Thanks for the quick fix!

Your patch removes my commit message, which I tried hard to make long and explanatory. :) Please submit a separate patch in the future.

I uploaded two new patches, one including your changes to the `erf` function, and the other my fixes for `expression_conversions.py`.

Patches to be applied:
* [attachment:trac_8568-diff_conversion.take2.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff_conversion.take2.patch)
* [attachment:trac_8568-erf-deriv.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-erf-deriv.patch)



---

archive/issue_comments_070326.json:
```json
{
    "body": "**Changing reviewer** from \"Karl-Dieter Crisman\" to \"Karl-Dieter Crisman, Burcin Erocal\".",
    "created_at": "2010-05-27T16:18:25Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70326",
    "user": "https://github.com/burcin"
}
```

**Changing reviewer** from "Karl-Dieter Crisman" to "Karl-Dieter Crisman, Burcin Erocal".



---

archive/issue_events_060964.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-05-27T16:18:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-60964"
}
```



---

archive/issue_events_060965.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-05-27T16:18:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-60965"
}
```



---

archive/issue_comments_070327.json:
```json
{
    "body": "<a id='comment:8'></a>\nSorry, Burcin, truthfully I hadn't even noticed that!  I was just trying to make a unified patch, because I hate all these five-patch tickets where they move things around from patch to patch - in this case, the actual test for the fix - since they are very hard for me to read.  But I'll be more careful now :)",
    "created_at": "2010-05-27T16:54:38Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70327",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:8'></a>
Sorry, Burcin, truthfully I hadn't even noticed that!  I was just trying to make a unified patch, because I hate all these five-patch tickets where they move things around from patch to patch - in this case, the actual test for the fix - since they are very hard for me to read.  But I'll be more careful now :)



---

archive/issue_comments_070328.json:
```json
{
    "body": "**Merged:** sage-4.4.4.alpha0",
    "created_at": "2010-06-06T01:27:12Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70328",
    "user": "https://github.com/mwhansen"
}
```

**Merged:** sage-4.4.4.alpha0



---

archive/issue_events_060966.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-06-06T01:27:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-60966"
}
```



---

archive/issue_events_060967.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-06-06T01:27:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-60967"
}
```



---

archive/issue_comments_070329.json:
```json
{
    "body": "<a id='comment:10'></a>\nThis actually causes a failure in sage/interfaces/maxima.py",
    "created_at": "2010-06-07T06:53:25Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70329",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:10'></a>
This actually causes a failure in sage/interfaces/maxima.py



---

archive/issue_events_060968.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-06-07T06:53:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-60968"
}
```



---

archive/issue_comments_070330.json:
```json
{
    "body": "**Changing merged** from \"sage-4.4.4.alpha0\" to \"\".",
    "created_at": "2010-06-07T06:53:25Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70330",
    "user": "https://github.com/mwhansen"
}
```

**Changing merged** from "sage-4.4.4.alpha0" to "".



---

archive/issue_comments_070331.json:
```json
{
    "body": "<a id='comment:11'></a>\nHere it is.  I'll try to fix it quickly, hopefully this can still get in 4.4.4.\n\n```\nFile \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/devel/sage/sage/interfaces/maxima.py\", line 2245:\n    sage: latex(maxima(derivative(ceil(x*y*d), d,x,x,y)))\nException raised:\n    Traceback (most recent call last):\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_70[4]>\", line 1, in <module>\n        latex(maxima(derivative(ceil(x*y*d), d,x,x,y)))###line 2245:\n    sage: latex(maxima(derivative(ceil(x*y*d), d,x,x,y)))\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/expect.py\", line 1034, in __call__\n        return self._coerce_from_special_method(x)\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/expect.py\", line 1058, in _coerce_from_special_method\n        return (x.__getattribute__(s))(self)\n      File \"expression.pyx\", line 435, in sage.symbolic.expression.Expression._maxima_ (sage/symbolic/expression.cpp:3420)\n      File \"sage_object.pyx\", line 379, in sage.structure.sage_object.SageObject._interface_ (sage/structure/sage_object.c:3374)\n      File \"sage_object.pyx\", line 468, in sage.structure.sage_object.SageObject._maxima_init_ (sage/structure/sage_object.c:5083)\n      File \"expression.pyx\", line 458, in sage.symbolic.expression.Expression._interface_init_ (sage/symbolic/expression.cpp:3510)\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py\", line 214, in __call__\n        return self.arithmetic(ex, operator)\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py\", line 515, in arithmetic\n        args = [\"(%s)\"%self(op) for op in ex.operands()]\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py\", line 214, in __call__\n        return self.arithmetic(ex, operator)\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py\", line 515, in arithmetic\n        args = [\"(%s)\"%self(op) for op in ex.operands()]\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py\", line 218, in __call__\n        return self.derivative(ex, operator)\n      File \"/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py\", line 495, in derivative\n        raise NotImplementedError, \"arguments must be distinct variables\"\n    NotImplementedError: arguments must be distinct variables\n**********************************************************************\n1 items had failures:\n   1 of   6 in __main__.example_70\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /home/kcrisman/.sage//tmp/.doctest_maxima.py\n\t [14.2 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\tsage -t  \"devel/sage/sage/interfaces/maxima.py\"\n```",
    "created_at": "2010-06-08T01:03:57Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70331",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:11'></a>
Here it is.  I'll try to fix it quickly, hopefully this can still get in 4.4.4.

```
File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/devel/sage/sage/interfaces/maxima.py", line 2245:
    sage: latex(maxima(derivative(ceil(x*y*d), d,x,x,y)))
Exception raised:
    Traceback (most recent call last):
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_70[4]>", line 1, in <module>
        latex(maxima(derivative(ceil(x*y*d), d,x,x,y)))###line 2245:
    sage: latex(maxima(derivative(ceil(x*y*d), d,x,x,y)))
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/expect.py", line 1034, in __call__
        return self._coerce_from_special_method(x)
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/expect.py", line 1058, in _coerce_from_special_method
        return (x.__getattribute__(s))(self)
      File "expression.pyx", line 435, in sage.symbolic.expression.Expression._maxima_ (sage/symbolic/expression.cpp:3420)
      File "sage_object.pyx", line 379, in sage.structure.sage_object.SageObject._interface_ (sage/structure/sage_object.c:3374)
      File "sage_object.pyx", line 468, in sage.structure.sage_object.SageObject._maxima_init_ (sage/structure/sage_object.c:5083)
      File "expression.pyx", line 458, in sage.symbolic.expression.Expression._interface_init_ (sage/symbolic/expression.cpp:3510)
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py", line 214, in __call__
        return self.arithmetic(ex, operator)
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py", line 515, in arithmetic
        args = ["(%s)"%self(op) for op in ex.operands()]
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py", line 214, in __call__
        return self.arithmetic(ex, operator)
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py", line 515, in arithmetic
        args = ["(%s)"%self(op) for op in ex.operands()]
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py", line 218, in __call__
        return self.derivative(ex, operator)
      File "/mnt/usb1/scratch/kcrisman/sage-4.4.4.alpha0-boxen.math.washington.edu-x86_64-Linux/local/lib/python/site-packages/sage/symbolic/expression_conversions.py", line 495, in derivative
        raise NotImplementedError, "arguments must be distinct variables"
    NotImplementedError: arguments must be distinct variables
**********************************************************************
1 items had failures:
   1 of   6 in __main__.example_70
***Test Failed*** 1 failures.
For whitespace errors, see the file /home/kcrisman/.sage//tmp/.doctest_maxima.py
	 [14.2 s]
 
----------------------------------------------------------------------
The following tests failed:


	sage -t  "devel/sage/sage/interfaces/maxima.py"
```



---

archive/issue_comments_070332.json:
```json
{
    "body": "<a id='comment:12'></a>\nOr not.\n\n```\nsage: maxima(derivative(ceil(d),d))\n'diff('ceil(d),d,1)\nsage: maxima(derivative(ceil(x*d),d))\n<same NotImplementedError>\n```\nSo the problem is that Burcin's Maxima conversion change now doesn't work with\n\n```\n    493         if (not all(is_SymbolicVariable(v) for v in args) or\n    494             len(args) != len(set(args))):\n--> 495             raise NotImplementedError, \"arguments must be distinct variables\"\n    496 \n    497         f = operator.function()\n```\nin derivative().  In fact, he even included a doctest for it!\n\n```\nWe can only convert to Maxima derivatives if the corresponding operand of the function is a variable:: \nsage: y = var('y') \nsage: t = f(x*y).diff(x) \nsage: m.derivative(t, t.operator()) \nTraceback (most recent call last): \n... \nNotImplementedError: arguments must be distinct variables \n```\nThis example could be fixed if one fixed\n\n```\nsage: derivative(ceil(x),x)\nD[0](ceil)(x)\n```\nso that there isn't a derivative function defined for ceil.  I'm not sure exactly what would count, though... just the zero function?",
    "created_at": "2010-06-08T01:22:20Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70332",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:12'></a>
Or not.

```
sage: maxima(derivative(ceil(d),d))
'diff('ceil(d),d,1)
sage: maxima(derivative(ceil(x*d),d))
<same NotImplementedError>
```
So the problem is that Burcin's Maxima conversion change now doesn't work with

```
    493         if (not all(is_SymbolicVariable(v) for v in args) or
    494             len(args) != len(set(args))):
--> 495             raise NotImplementedError, "arguments must be distinct variables"
    496 
    497         f = operator.function()
```
in derivative().  In fact, he even included a doctest for it!

```
We can only convert to Maxima derivatives if the corresponding operand of the function is a variable:: 
sage: y = var('y') 
sage: t = f(x*y).diff(x) 
sage: m.derivative(t, t.operator()) 
Traceback (most recent call last): 
... 
NotImplementedError: arguments must be distinct variables 
```
This example could be fixed if one fixed

```
sage: derivative(ceil(x),x)
D[0](ceil)(x)
```
so that there isn't a derivative function defined for ceil.  I'm not sure exactly what would count, though... just the zero function?



---

archive/attachments_010711.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_8568-fix_doctests.patch",
    "asset_url": "tarball://root/attachments/ticket8568/trac_8568-fix_doctests.patch",
    "created_at": "2010-09-08T11:44:30Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket8568/trac_8568-fix_doctests.patch",
    "user": "https://github.com/burcin"
}
```



---

archive/issue_comments_070333.json:
```json
{
    "body": "Attachment [trac_8568-fix_doctests.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-fix_doctests.patch) by @burcin created at 2010-09-08 11:44:30",
    "created_at": "2010-09-08T11:44:30Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70333",
    "user": "https://github.com/burcin"
}
```

Attachment [trac_8568-fix_doctests.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-fix_doctests.patch) by @burcin created at 2010-09-08 11:44:30



---

archive/issue_events_060969.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-09-08T11:48:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-60969"
}
```



---

archive/issue_events_060970.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-09-08T11:48:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-60970"
}
```



---

archive/issue_comments_070334.json:
```json
{
    "body": "<a id='comment:13'></a>\nI attached a new patch which fixes the doctest failures in `interfaces/maxima.py`. The patch changes the test to use a symbolic function `f` instead of `ceil`, adds the error message that we need distinct arguments to convert to maxima and a test with an expression where the variables are indeed distinct arguments.\n\nAdding a function to represent the derivative of `ceil()` and `floor()` is now #9874.\n\nPatches should be applied in this order:\n\n* [attachment:trac_8568-diff_conversion.take2.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff_conversion.take2.patch)\n* [attachment:trac_8568-erf-deriv.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-erf-deriv.patch)\n* [attachment:trac_8568-fix_doctests.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-fix_doctests.patch)",
    "created_at": "2010-09-08T11:48:48Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70334",
    "user": "https://github.com/burcin"
}
```

<a id='comment:13'></a>
I attached a new patch which fixes the doctest failures in `interfaces/maxima.py`. The patch changes the test to use a symbolic function `f` instead of `ceil`, adds the error message that we need distinct arguments to convert to maxima and a test with an expression where the variables are indeed distinct arguments.

Adding a function to represent the derivative of `ceil()` and `floor()` is now #9874.

Patches should be applied in this order:

* [attachment:trac_8568-diff_conversion.take2.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-diff_conversion.take2.patch)
* [attachment:trac_8568-erf-deriv.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-erf-deriv.patch)
* [attachment:trac_8568-fix_doctests.patch](https://github.com/sagemath/sage/files/ticket8568/trac_8568-fix_doctests.patch)



---

archive/issue_comments_070335.json:
```json
{
    "body": "<a id='comment:14'></a>\nThis all still applies fine to Sage 4.6.alpha1, and all doctests I could think of pass.  Everything else is the same - positive review!\n\nBy the way, thanks for opening that other ticket, Burcin - sometimes I get paralyzed trying to decide what the best course of action is on reviews.",
    "created_at": "2010-09-21T20:01:27Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70335",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:14'></a>
This all still applies fine to Sage 4.6.alpha1, and all doctests I could think of pass.  Everything else is the same - positive review!

By the way, thanks for opening that other ticket, Burcin - sometimes I get paralyzed trying to decide what the best course of action is on reviews.



---

archive/issue_events_060971.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2010-09-21T20:01:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-60971"
}
```



---

archive/issue_events_060972.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2010-09-21T20:01:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-60972"
}
```



---

archive/issue_events_060973.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-29T08:39:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-60973"
}
```



---

archive/issue_events_060974.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-29T08:39:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8568#event-60974"
}
```



---

archive/issue_comments_070336.json:
```json
{
    "body": "**Merged:** sage-4.6.alpha2",
    "created_at": "2010-09-29T08:39:03Z",
    "issue": "https://github.com/sagemath/sage/issues/8568",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8568#issuecomment-70336",
    "user": "https://github.com/qed777"
}
```

**Merged:** sage-4.6.alpha2
