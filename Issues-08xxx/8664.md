# Issue 8664: Upgrade Sage's MPIR spkg to version 2.1.3

archive/issues_008664.json:
```json
{
    "body": "\n```\nHi,\n\nOK, after all this, the build finally completed.  The only changes I made were:\n\n* Updated mpir to rc3\n* patched ecm as explained here:\n    http://lists.gforge.inria.fr/pipermail/ecm-discuss/2009-August/004070.html\n   (Though this had to be slightly modified -- just search for the same command, which moved.)\n\n\nI then ran the long Sage test suite, and some tests fail.  \n\n  http://sage.math.washington.edu/home/wstein/build/mpir2/sage-4.3.5/testlong.log\n\n----------------------------------------------------------------------\nThe following tests failed:\n\n\n        sage -t  -long \"devel/sage/doc/en/tutorial/tour_numtheory.rst\"\n        sage -t  -long \"devel/sage/doc/fr/tutorial/tour_numtheory.rst\"\n        sage -t  -long \"devel/sage/sage/modular/cusps.py\"\n        sage -t  -long \"devel/sage/sage/modular/modsym/boundary.py\"\n        sage -t  -long \"devel/sage/sage/modular/modsym/ambient.py\"\n        sage -t  -long \"devel/sage/sage/libs/pari/gen.pyx\"\n        sage -t  -long \"devel/sage/sage/rings/arith.py\"\n        sage -t  -long \"devel/sage/sage/rings/integer.pyx\"\n        sage -t  -long \"devel/sage/sage/rings/polynomial/multi_polynomial_ideal.py\"\n        sage -t  -long \"devel/sage/sage/tests/book_stein_ent.py\"\n        sage -t  -long \"devel/sage/sage/schemes/elliptic_curves/heegner.py\"\nTotal time for all tests: 7170.6 seconds\n\n--\n\nI looked and it appears that maybe all of these are the result of the XGCD behavior in MPIR changing again.  Has it changed to be like GMP now?  That would be convenient.\n\nwilliam\n```\n\n\n---\n\n**New spkg: [http://sage.math.washington.edu/home/leif/Sage/spkgs/mpir-2.1.3.p4.spkg](http://sage.math.washington.edu/home/leif/Sage/spkgs/mpir-2.1.3.p4.spkg)**\n\n**md5sum:** `197c652a6bdbf20c2e47be9176a8616e  mpir-2.1.3.p4.spkg`\n\n**Apply** [attachment:trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib-rebased_to_4.7.2.alpha2.patch] **to the Sage library** (after installation of the spkgs and a rebuild of dependent packages).\n\n---\n\nSee comment(s) below on how to *\"manually\"* install and test the new packages. (ECM has to be updated, too, package is at #5847.)\n\n---\n\n#9522 can be closed as invalid / duplicate once this ticket has been merged.\n\nAssignee: GeorgSWeber\n\nCC:  @williamstein @nexttime drkirkby @jdemeyer wbhart jpflori\n\nKeywords: sd32, GMP ECM execstack Fedora 14 extension module library dependencies Darwin 11 MacOS X 10.7 Lion\n\nResolution: fixed\n\nDependencies: #5847, #9858, #11896\n\nAuthor: Mike Hansen, Leif Leonhardy\n\nReviewer: Leif Leonhardy, Dmitrii Pasechnik\n\nMerged: sage-4.8.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/8664\n\n",
    "closed_at": "2011-10-14T09:41:13Z",
    "created_at": "2010-04-09T04:10:07Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.8",
    "title": "Upgrade Sage's MPIR spkg to version 2.1.3",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8664",
    "user": "https://github.com/williamstein"
}
```

```
Hi,

OK, after all this, the build finally completed.  The only changes I made were:

* Updated mpir to rc3
* patched ecm as explained here:
    http://lists.gforge.inria.fr/pipermail/ecm-discuss/2009-August/004070.html
   (Though this had to be slightly modified -- just search for the same command, which moved.)


I then ran the long Sage test suite, and some tests fail.  

  http://sage.math.washington.edu/home/wstein/build/mpir2/sage-4.3.5/testlong.log

----------------------------------------------------------------------
The following tests failed:


        sage -t  -long "devel/sage/doc/en/tutorial/tour_numtheory.rst"
        sage -t  -long "devel/sage/doc/fr/tutorial/tour_numtheory.rst"
        sage -t  -long "devel/sage/sage/modular/cusps.py"
        sage -t  -long "devel/sage/sage/modular/modsym/boundary.py"
        sage -t  -long "devel/sage/sage/modular/modsym/ambient.py"
        sage -t  -long "devel/sage/sage/libs/pari/gen.pyx"
        sage -t  -long "devel/sage/sage/rings/arith.py"
        sage -t  -long "devel/sage/sage/rings/integer.pyx"
        sage -t  -long "devel/sage/sage/rings/polynomial/multi_polynomial_ideal.py"
        sage -t  -long "devel/sage/sage/tests/book_stein_ent.py"
        sage -t  -long "devel/sage/sage/schemes/elliptic_curves/heegner.py"
Total time for all tests: 7170.6 seconds

--

I looked and it appears that maybe all of these are the result of the XGCD behavior in MPIR changing again.  Has it changed to be like GMP now?  That would be convenient.

william
```


---

**New spkg: [http://sage.math.washington.edu/home/leif/Sage/spkgs/mpir-2.1.3.p4.spkg](http://sage.math.washington.edu/home/leif/Sage/spkgs/mpir-2.1.3.p4.spkg)**

**md5sum:** `197c652a6bdbf20c2e47be9176a8616e  mpir-2.1.3.p4.spkg`

**Apply** [attachment:trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib-rebased_to_4.7.2.alpha2.patch] **to the Sage library** (after installation of the spkgs and a rebuild of dependent packages).

---

See comment(s) below on how to *"manually"* install and test the new packages. (ECM has to be updated, too, package is at #5847.)

---

#9522 can be closed as invalid / duplicate once this ticket has been merged.

Assignee: GeorgSWeber

CC:  @williamstein @nexttime drkirkby @jdemeyer wbhart jpflori

Keywords: sd32, GMP ECM execstack Fedora 14 extension module library dependencies Darwin 11 MacOS X 10.7 Lion

Resolution: fixed

Dependencies: #5847, #9858, #11896

Author: Mike Hansen, Leif Leonhardy

Reviewer: Leif Leonhardy, Dmitrii Pasechnik

Merged: sage-4.8.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/8664





---

archive/issue_events_033513.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "rename": {
        "from": "upgrade sage's mpir spkg to version 2.0.0",
        "to": "upgrade sage's mpir spkg to version 2.0.1"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33513"
}
```



---

archive/issue_comments_091205.json:
```json
{
    "body": "<a id='comment:1'></a>\nThe XGCD issue needs some work w.r.t. doctests (but not only, see below), maybe David Harvey has something done already in this direction when preparing the optional \"true\" GMP spkg he maintains. (I don't find the thread right now, but I seem to remember he said something in this direction).\n\nSnippet from a private communication by Bill Hart (MPIR upstream):\n\n```\nMPIR 2.0.1 will be required for Sage because it brings the gcdext\nnormalisation in line with GMP's (which is what Pari needs). I think\npeople have skipped MPIR 1.3.0 in favour of waiting for MPIR 2.0.1.\nWe're in the release phase of MPIR 2.0.1 ...\n```\nAlso note that as soon as this ticket here is closed, we should mark #8455 as invalid.",
    "created_at": "2010-05-19T09:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91205",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:1'></a>
The XGCD issue needs some work w.r.t. doctests (but not only, see below), maybe David Harvey has something done already in this direction when preparing the optional "true" GMP spkg he maintains. (I don't find the thread right now, but I seem to remember he said something in this direction).

Snippet from a private communication by Bill Hart (MPIR upstream):

```
MPIR 2.0.1 will be required for Sage because it brings the gcdext
normalisation in line with GMP's (which is what Pari needs). I think
people have skipped MPIR 1.3.0 in favour of waiting for MPIR 2.0.1.
We're in the release phase of MPIR 2.0.1 ...
```
Also note that as soon as this ticket here is closed, we should mark #8455 as invalid.



---

archive/issue_comments_091206.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis needs to be handled with #5847 and should take care of #9522 at the same time.",
    "created_at": "2010-08-17T18:33:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91206",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:2'></a>
This needs to be handled with #5847 and should take care of #9522 at the same time.



---

archive/issue_events_033514.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "rename": {
        "from": "upgrade sage's mpir spkg to version 2.0.1",
        "to": "upgrade sage's mpir spkg to version 2.1.1"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33514"
}
```



---

archive/issue_events_033515.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "rename": {
        "from": "upgrade sage's mpir spkg to version 2.1.1",
        "to": "Upgrade Sage's MPIR spkg to version 2.1.1"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33515"
}
```



---

archive/issue_comments_091207.json:
```json
{
    "body": "<a id='comment:4'></a>\nI've put an spkg at http://sage.math.washington.edu/home/mhansen/mpir-2.1.1.spkg\n\nInterestingly, I did not get any of the failures listed above.",
    "created_at": "2010-08-18T06:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91207",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:4'></a>
I've put an spkg at http://sage.math.washington.edu/home/mhansen/mpir-2.1.1.spkg

Interestingly, I did not get any of the failures listed above.



---

archive/issue_comments_091208.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-08-18T06:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91208",
    "user": "https://github.com/mwhansen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_091209.json:
```json
{
    "body": "Changing author from \"\" to \"Mike Hansen\"",
    "created_at": "2010-08-18T06:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91209",
    "user": "https://github.com/mwhansen"
}
```

Changing author from "" to "Mike Hansen"



---

archive/issue_events_033516.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "label": "component: packages",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33516"
}
```



---

archive/issue_comments_091210.json:
```json
{
    "body": "<a id='comment:7'></a>\nHmmm, `spkg-install` could be cleaned up further, e.g.\n* Dave's comment has somehow been truncated(?) a while ago (*\"... if\"* what?)\n* `s/`uname`/$UNAME/`\n* Especially for parallel builds, it's more convenient to begin *every* error message with `\"Error\"` (or at least the message should contain that word).\n* Simplify the \"fat binary\" section for Linux; it doesn't make sense to call `uname -m` three times, nor does it to compare its result again if it already matched one of the tested. A `case`-`esac` would be appropriate, also merging the identical `i386` and `i686` then-branches. Btw, `uname -m` can also be `i486` or `i586` on 32-bit Linuces.\n* Is the `! [ $? -eq 0 ]` some required Cygwin \"idiom\"?\n\nAlso, `spkg-check` doesn't print any messages, and uses `make` instead of `$MAKE`.\n\nThe dependencies (\"None\") in `SPKG.txt` are wrong; MPIR at least depends on iconv, which Sage ships, though Sage's version is only used/built on some systems. I'm not sure if readline should be added to `spkg/standard/deps`. (MPIR's `configure` looks for much more, but apparently - as currently shipped - doesn't need/use all of that.) The Changelog could perhaps mention further changes, too.\n\nIf nobody else wants to, I could make the changes, i.e. a reviewer patch. Just let me know...\n\nGoing to test the new spkg with Sage 4.5.3.alpha2 and 4.6.prealpha3 (on Linuces only).",
    "created_at": "2010-08-26T22:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91210",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>
Hmmm, `spkg-install` could be cleaned up further, e.g.
* Dave's comment has somehow been truncated(?) a while ago (*"... if"* what?)
* `s/`uname`/$UNAME/`
* Especially for parallel builds, it's more convenient to begin *every* error message with `"Error"` (or at least the message should contain that word).
* Simplify the "fat binary" section for Linux; it doesn't make sense to call `uname -m` three times, nor does it to compare its result again if it already matched one of the tested. A `case`-`esac` would be appropriate, also merging the identical `i386` and `i686` then-branches. Btw, `uname -m` can also be `i486` or `i586` on 32-bit Linuces.
* Is the `! [ $? -eq 0 ]` some required Cygwin "idiom"?

Also, `spkg-check` doesn't print any messages, and uses `make` instead of `$MAKE`.

The dependencies ("None") in `SPKG.txt` are wrong; MPIR at least depends on iconv, which Sage ships, though Sage's version is only used/built on some systems. I'm not sure if readline should be added to `spkg/standard/deps`. (MPIR's `configure` looks for much more, but apparently - as currently shipped - doesn't need/use all of that.) The Changelog could perhaps mention further changes, too.

If nobody else wants to, I could make the changes, i.e. a reviewer patch. Just let me know...

Going to test the new spkg with Sage 4.5.3.alpha2 and 4.6.prealpha3 (on Linuces only).



---

archive/issue_comments_091211.json:
```json
{
    "body": "<a id='comment:8'></a>\nDave, as it seems you're addicted to testing, you could also test *this* new spkg (e.g. on Solaris, OpenSolaris)... ;-)",
    "created_at": "2010-08-26T23:08:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91211",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>
Dave, as it seems you're addicted to testing, you could also test *this* new spkg (e.g. on Solaris, OpenSolaris)... ;-)



---

archive/issue_comments_091212.json:
```json
{
    "body": "<a id='comment:9'></a>\nI guess unless we bump the patch levels of all packages that depend on GMP/MPIR (and ECM), this package breaks upgrading Sage (at least with the current upgrade process), due to interface change (in conjunction with shared library versioning).\n\nThe same applies to testing this package (and/with ECM 6.3 from #5847); one has to either build from scratch or delete `spkg/installed/<package-name>` for all packages that depend on those two.\n\nPerhaps one could simply (conditionally) do the latter in `spkg/install`, which also gets updated during upgrade.",
    "created_at": "2010-08-27T01:41:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91212",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'></a>
I guess unless we bump the patch levels of all packages that depend on GMP/MPIR (and ECM), this package breaks upgrading Sage (at least with the current upgrade process), due to interface change (in conjunction with shared library versioning).

The same applies to testing this package (and/with ECM 6.3 from #5847); one has to either build from scratch or delete `spkg/installed/<package-name>` for all packages that depend on those two.

Perhaps one could simply (conditionally) do the latter in `spkg/install`, which also gets updated during upgrade.



---

archive/issue_comments_091213.json:
```json
{
    "body": "<a id='comment:10'></a>\nDefining `SAGE_SPKG` to `sage-spkg -f` in `spkg/standard/deps` should *in principle* also work, but doesn't... apparently because *not really all* shared libraries that use `libgmpxx.so` get rebuilt, so some still refer to the old, deleted `libgmpxx.so.3`.\n\n---\n\nRebuilding Sage 4.5.3.alpha2 with MPIR 2.1.1 and ECM 6.3 *from scratch* worked on Ubuntu 10.04 x86_64 (parallel build with 32 jobs); `ptestlong` passed all tests.",
    "created_at": "2010-08-27T03:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91213",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:10'></a>
Defining `SAGE_SPKG` to `sage-spkg -f` in `spkg/standard/deps` should *in principle* also work, but doesn't... apparently because *not really all* shared libraries that use `libgmpxx.so` get rebuilt, so some still refer to the old, deleted `libgmpxx.so.3`.

---

Rebuilding Sage 4.5.3.alpha2 with MPIR 2.1.1 and ECM 6.3 *from scratch* worked on Ubuntu 10.04 x86_64 (parallel build with 32 jobs); `ptestlong` passed all tests.



---

archive/issue_comments_091214.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [leif](#comment%3A10):\n> Defining `SAGE_SPKG` to `sage-spkg -f` in `spkg/standard/deps` should *in principle* also work, but doesn't... apparently because *not really all* shared libraries that use `libgmpxx.so` get rebuilt, so some still refer to the old, deleted `libgmpxx.so.3`.\n\n\nI think this could be fixed by making extension modules also depend on (some of) the libraries they use (in `module_list.py`), with the disadvantage that these modules would get rebuilt whenever their libraries \"change\", even if the interfaces stay the same (and even if just the modification time changed due to a rebuild/reinstallation). \n\n---\n \n> Rebuilding Sage 4.5.3.alpha2 with MPIR 2.1.1 and ECM 6.3 *from scratch* worked on Ubuntu 10.04 x86_64 (parallel build with 32 jobs); `ptestlong` passed all tests.\n\n\nSame for Fedora 13 x86 (parallel build with 6 jobs), also `ptestlong`.\n\n---\n\nUnfortunately, there seems to be some incompatibility between the new PARI (2.4.3.svn-12577.p4) or - more precisely - the required changes to Sage's interface to PARI in order to upgrade PARI (Sage 4.6.prealpha3, see #9343 and [the NewPARI Wiki page](http://wiki.sagemath.org/NewPARI)) and MPIR 2.1.1:\n\nOn Ubuntu 10.04 x86_64 (Core2, gcc 4.4.3) exactly two of all doctests (`ptestlong`) **segfault** (in `sage/schemes/elliptic_curves/ell_point.py`).\n\nOn Fedora 13 x86 (Pentium 4 Prescott, gcc 4.4.4) the same two doctests and another one in `ell_rational_field.py` segfault, and in addition one doctest in the latter file raises an unexpected exception (`TypeError`), which seems to be the result of some other failure.\n\nMaybe all are due to memory (or stack) corruption. See http://trac.sagemath.org/sage_trac/ticket/9343#comment:327 ff. for details; we haven't yet opened a separate ticket.\n\n(For testing with Sage 4.6.prealpha3, I copied the MPIR 2.1.1 and ECM 6.3 spkgs to `spkg/standard`, and built Sage from scratch - without problems. I also reinstalled the PARI, MPIR and ECM packages later with `env SAGE_CHECK=yes ./sage -f ...`; all test suites passed.)",
    "created_at": "2010-08-28T01:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91214",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:11'></a>
Replying to [leif](#comment%3A10):
> Defining `SAGE_SPKG` to `sage-spkg -f` in `spkg/standard/deps` should *in principle* also work, but doesn't... apparently because *not really all* shared libraries that use `libgmpxx.so` get rebuilt, so some still refer to the old, deleted `libgmpxx.so.3`.


I think this could be fixed by making extension modules also depend on (some of) the libraries they use (in `module_list.py`), with the disadvantage that these modules would get rebuilt whenever their libraries "change", even if the interfaces stay the same (and even if just the modification time changed due to a rebuild/reinstallation). 

---
 
> Rebuilding Sage 4.5.3.alpha2 with MPIR 2.1.1 and ECM 6.3 *from scratch* worked on Ubuntu 10.04 x86_64 (parallel build with 32 jobs); `ptestlong` passed all tests.


Same for Fedora 13 x86 (parallel build with 6 jobs), also `ptestlong`.

---

Unfortunately, there seems to be some incompatibility between the new PARI (2.4.3.svn-12577.p4) or - more precisely - the required changes to Sage's interface to PARI in order to upgrade PARI (Sage 4.6.prealpha3, see #9343 and [the NewPARI Wiki page](http://wiki.sagemath.org/NewPARI)) and MPIR 2.1.1:

On Ubuntu 10.04 x86_64 (Core2, gcc 4.4.3) exactly two of all doctests (`ptestlong`) **segfault** (in `sage/schemes/elliptic_curves/ell_point.py`).

On Fedora 13 x86 (Pentium 4 Prescott, gcc 4.4.4) the same two doctests and another one in `ell_rational_field.py` segfault, and in addition one doctest in the latter file raises an unexpected exception (`TypeError`), which seems to be the result of some other failure.

Maybe all are due to memory (or stack) corruption. See http://trac.sagemath.org/sage_trac/ticket/9343#comment:327 ff. for details; we haven't yet opened a separate ticket.

(For testing with Sage 4.6.prealpha3, I copied the MPIR 2.1.1 and ECM 6.3 spkgs to `spkg/standard`, and built Sage from scratch - without problems. I also reinstalled the PARI, MPIR and ECM packages later with `env SAGE_CHECK=yes ./sage -f ...`; all test suites passed.)



---

archive/issue_comments_091215.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [leif](#comment%3A11):\n> Unfortunately, there seems to be some incompatibility between the new PARI (2.4.3.svn-12577.p4 / Sage 4.6.prealpha3, see #9343 and [the NewPARI Wiki page](http://wiki.sagemath.org/NewPARI)) and MPIR 2.1.1:\n\n\n> On Ubuntu 10.04 x86_64 (Core2, gcc 4.4.3) exactly two of all doctests (`ptestlong`) **segfault** (in `sage/schemes/elliptic_curves/ell_point.py`).\n\n\n> On Fedora 13 x86 (Pentium 4 Prescott, gcc 4.4.4) the same two doctests and another one in `ell_rational_field.py` segfault, and in addition one doctest in the latter file raises an unexpected exception (`TypeError`), which seems to be the result of some other failure.\n\n\nThis is due to the new PARI using undocumented features of GMP (that MPIR doesn't support). and is now addressed at #9837.",
    "created_at": "2010-08-29T15:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91215",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:12'></a>
Replying to [leif](#comment%3A11):
> Unfortunately, there seems to be some incompatibility between the new PARI (2.4.3.svn-12577.p4 / Sage 4.6.prealpha3, see #9343 and [the NewPARI Wiki page](http://wiki.sagemath.org/NewPARI)) and MPIR 2.1.1:


> On Ubuntu 10.04 x86_64 (Core2, gcc 4.4.3) exactly two of all doctests (`ptestlong`) **segfault** (in `sage/schemes/elliptic_curves/ell_point.py`).


> On Fedora 13 x86 (Pentium 4 Prescott, gcc 4.4.4) the same two doctests and another one in `ell_rational_field.py` segfault, and in addition one doctest in the latter file raises an unexpected exception (`TypeError`), which seems to be the result of some other failure.


This is due to the new PARI using undocumented features of GMP (that MPIR doesn't support). and is now addressed at #9837.



---

archive/issue_comments_091216.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [leif](#comment%3A12):\n> This is due to the new PARI using undocumented features of GMP (that MPIR doesn't support). and is now addressed at #9837.\n\n\nThis is not necessarily the (only) cause. Jeroen has found a definite bug in MPIR 2.1.1 he'll report upstream; see #9837.\n\nLeaving the ticket \"needs review\", though I don't think we should upgrade MPIR until that bug is fixed, in a later release.",
    "created_at": "2010-08-29T18:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91216",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:13'></a>
Replying to [leif](#comment%3A12):
> This is due to the new PARI using undocumented features of GMP (that MPIR doesn't support). and is now addressed at #9837.


This is not necessarily the (only) cause. Jeroen has found a definite bug in MPIR 2.1.1 he'll report upstream; see #9837.

Leaving the ticket "needs review", though I don't think we should upgrade MPIR until that bug is fixed, in a later release.



---

archive/issue_comments_091217.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [leif](#comment%3A13):\n> Leaving the ticket \"needs review\", though I don't think we should upgrade MPIR until that bug is fixed, in a later release.\n\n\nSounds good to me.",
    "created_at": "2010-08-29T18:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91217",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:14'></a>
Replying to [leif](#comment%3A13):
> Leaving the ticket "needs review", though I don't think we should upgrade MPIR until that bug is fixed, in a later release.


Sounds good to me.



---

archive/issue_comments_091218.json:
```json
{
    "body": "<a id='comment:15'></a>\nThe problem of ticket #9837 has been fixed in MPIR svn, it was purely a bug in MPIR 2.1.1.",
    "created_at": "2010-09-04T21:17:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91218",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
The problem of ticket #9837 has been fixed in MPIR svn, it was purely a bug in MPIR 2.1.1.



---

archive/issue_comments_091219.json:
```json
{
    "body": "<a id='comment:16'></a>\nPlease upgrade to MPIR 2.1.2, where #9837 is fixed.",
    "created_at": "2010-09-05T12:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91219",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
Please upgrade to MPIR 2.1.2, where #9837 is fixed.



---

archive/issue_comments_091220.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-09-05T12:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91220",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_091221.json:
```json
{
    "body": "<a id='comment:18'></a>\nApparently [they've released MPIR 2.1.2](http://www.mpir.org/) with just this bug fixed today.\n\nHaven't tested that yet.",
    "created_at": "2010-09-05T17:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91221",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:18'></a>
Apparently [they've released MPIR 2.1.2](http://www.mpir.org/) with just this bug fixed today.

Haven't tested that yet.



---

archive/issue_comments_091222.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [leif](#comment%3A18):\n> Apparently [they've released MPIR 2.1.2](http://www.mpir.org/) with just this bug fixed today.\n> \n> Haven't tested that yet.\n\n\nAt least passes all (long) tests in `sage/schemes/elliptic_curves/` with Sage 4.6.prealpha3 on Fedora 13 x86 (Pentium 4 Prescott, gcc 4.4.4), where previously the segfaults occurred.\n\nThe diff shows they just fixed that single bug, bumped the MPIR version number (patch level) and incremented the revision numbers of both shared libraries. (In addition, they changed *the date of* the documentation without actually changing the docs themselves. The file `src/.gdbinit` in the MPIR 2.1.1 spkg must have been added by Mike or someone else.)",
    "created_at": "2010-09-05T18:55:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91222",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:19'></a>
Replying to [leif](#comment%3A18):
> Apparently [they've released MPIR 2.1.2](http://www.mpir.org/) with just this bug fixed today.
> 
> Haven't tested that yet.


At least passes all (long) tests in `sage/schemes/elliptic_curves/` with Sage 4.6.prealpha3 on Fedora 13 x86 (Pentium 4 Prescott, gcc 4.4.4), where previously the segfaults occurred.

The diff shows they just fixed that single bug, bumped the MPIR version number (patch level) and incremented the revision numbers of both shared libraries. (In addition, they changed *the date of* the documentation without actually changing the docs themselves. The file `src/.gdbinit` in the MPIR 2.1.1 spkg must have been added by Mike or someone else.)



---

archive/issue_events_033517.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-09-05T18:55:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "milestone": "sage-4.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33517"
}
```



---

archive/issue_events_033518.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "rename": {
        "from": "Upgrade Sage's MPIR spkg to version 2.1.1",
        "to": "Upgrade Sage's MPIR spkg to version 2.1.2"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33518"
}
```



---

archive/issue_comments_091223.json:
```json
{
    "body": "<a id='comment:21'></a>\nFLINT also needs to be updated (from 1.5.0[.p5] to 1.5.2) to work with the new MPIR; otherwise the test suite won't build. See #9858.",
    "created_at": "2010-09-06T09:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91223",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:21'></a>
FLINT also needs to be updated (from 1.5.0[.p5] to 1.5.2) to work with the new MPIR; otherwise the test suite won't build. See #9858.



---

archive/issue_comments_091224.json:
```json
{
    "body": "<a id='comment:22'></a>\nBefore the 4.6.alphaX build fails on the ia64 Skynet machines cleo and iras because of a bug in GCC 4.5.1 (see #9863), there's an apparent parallel `make install` failure with MPIR:\n\n```\n[...]\nmake[6]: Entering directory `/home/mpatel/build/cleo/sage-4.6.alpha2/spkg/build/\nmpir-1.2.2.p1/src'\nmake[6]: warning: -jN forced in submake: disabling jobserver mode.\n(cd /home/mpatel/build/cleo/sage-4.6.alpha2/local/include  && rm -f gmp.h   && c\np mpir.h   gmp.h)\n /usr/bin/install -c -m 644 'mpir.h' '/home/mpatel/build/cleo/sage-4.6.alpha2/lo\ncal/include/mpir.h'\ncp: cannot stat `mpir.h': No such file or directory\nmake[6]: *** [install-data-hook] Error 1\nmake[6]: Leaving directory `/home/mpatel/build/cleo/sage-4.6.alpha2/spkg/build/mpir-1.2.2.p1/src'\nmake[5]: *** [install-data-am] Error 2\nmake[5]: *** Waiting for unfinished jobs....\n[...]\n```\nHas anyone else seen this?  The full logs are [here](http://sage.math.washington.edu/home/mpatel/trac/8664/).\n\nI noticed that [MPIR 2.1.3 is out](http://www.mpir.org/) with a fix in `mpf_get_d_2exp`.  But I don't think Sage uses (m)any of the `mpf_*` functions.",
    "created_at": "2010-09-30T10:24:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91224",
    "user": "https://github.com/qed777"
}
```

<a id='comment:22'></a>
Before the 4.6.alphaX build fails on the ia64 Skynet machines cleo and iras because of a bug in GCC 4.5.1 (see #9863), there's an apparent parallel `make install` failure with MPIR:

```
[...]
make[6]: Entering directory `/home/mpatel/build/cleo/sage-4.6.alpha2/spkg/build/
mpir-1.2.2.p1/src'
make[6]: warning: -jN forced in submake: disabling jobserver mode.
(cd /home/mpatel/build/cleo/sage-4.6.alpha2/local/include  && rm -f gmp.h   && c
p mpir.h   gmp.h)
 /usr/bin/install -c -m 644 'mpir.h' '/home/mpatel/build/cleo/sage-4.6.alpha2/lo
cal/include/mpir.h'
cp: cannot stat `mpir.h': No such file or directory
make[6]: *** [install-data-hook] Error 1
make[6]: Leaving directory `/home/mpatel/build/cleo/sage-4.6.alpha2/spkg/build/mpir-1.2.2.p1/src'
make[5]: *** [install-data-am] Error 2
make[5]: *** Waiting for unfinished jobs....
[...]
```
Has anyone else seen this?  The full logs are [here](http://sage.math.washington.edu/home/mpatel/trac/8664/).

I noticed that [MPIR 2.1.3 is out](http://www.mpir.org/) with a fix in `mpf_get_d_2exp`.  But I don't think Sage uses (m)any of the `mpf_*` functions.



---

archive/issue_comments_091225.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [mpatel](#comment%3A22):\n> Before the 4.6.alphaX build fails on the ia64 Skynet machines cleo and iras because of a bug in GCC 4.5.1 (see #9863), there's an apparent parallel `make install` failure with MPIR:\n\n\nI've also [seen this on Skynet's menas](http://build.sagemath.org/sage/builders/menas%20full/builds/39/steps/shell_1/logs/mpir).",
    "created_at": "2010-10-22T01:05:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91225",
    "user": "https://github.com/qed777"
}
```

<a id='comment:23'></a>
Replying to [mpatel](#comment%3A22):
> Before the 4.6.alphaX build fails on the ia64 Skynet machines cleo and iras because of a bug in GCC 4.5.1 (see #9863), there's an apparent parallel `make install` failure with MPIR:


I've also [seen this on Skynet's menas](http://build.sagemath.org/sage/builders/menas%20full/builds/39/steps/shell_1/logs/mpir).



---

archive/issue_comments_091226.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [mpatel](#comment%3A22):\n> Before the 4.6.alphaX build fails on the ia64 Skynet machines cleo and iras because of a bug in GCC 4.5.1 (see #9863), there's an apparent parallel `make install` failure with MPIR:\n\n{{{\n[...]\nmake[6]: Entering directory `/home/mpatel/build/cleo/sage-4.6.alpha2/spkg/build/\nmpir-1.2.2.p1/src'\nmake[6]: warning: -jN forced in submake: disabling jobserver mode.\n(cd /home/mpatel/build/cleo/sage-4.6.alpha2/local/include  && rm -f gmp.h   && cp mpir.h   gmp.h)\n/usr/bin/install -c -m 644 'mpir.h' '/home/mpatel/build/cleo/sage-4.6.alpha2/local/include/mpir.h'\ncp: cannot stat `mpir.h': No such file or directory\nmake[6]: *** [install-data-hook] Error 1\nmake[6]: Leaving directory `/home/mpatel/build/cleo/sage-4.6.alpha2/spkg/build/mpir-1.2.2.p1/src'\nmake[5]: *** [install-data-am] Error 2\nmake[5]: *** Waiting for unfinished jobs....\n[...]\n}}}\n> Has anyone else seen this? \n\n\nSorry for the delay; I frequently see this since a while on Ubuntus (9.04 & 10.04) when building Sage with e.g. 16 or 32 jobs, with the **old** MPIR, too; also reported elsewhere (but incidentally also first saw this with MPIR 2.1.1 and the new PARI).\n\nI cannot find obvious errors in the Makefile though; the relevant parts are identical to those of GMP btw, IIRC.\n\nAs another incident, I ran into this race condition again yesterday when building Sage 4.4.4 (!) from scratch with `MAKE=\"make -j16\"`.",
    "created_at": "2010-10-22T07:34:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91226",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:24'></a>
Replying to [mpatel](#comment%3A22):
> Before the 4.6.alphaX build fails on the ia64 Skynet machines cleo and iras because of a bug in GCC 4.5.1 (see #9863), there's an apparent parallel `make install` failure with MPIR:

{{{
[...]
make[6]: Entering directory `/home/mpatel/build/cleo/sage-4.6.alpha2/spkg/build/
mpir-1.2.2.p1/src'
make[6]: warning: -jN forced in submake: disabling jobserver mode.
(cd /home/mpatel/build/cleo/sage-4.6.alpha2/local/include  && rm -f gmp.h   && cp mpir.h   gmp.h)
/usr/bin/install -c -m 644 'mpir.h' '/home/mpatel/build/cleo/sage-4.6.alpha2/local/include/mpir.h'
cp: cannot stat `mpir.h': No such file or directory
make[6]: *** [install-data-hook] Error 1
make[6]: Leaving directory `/home/mpatel/build/cleo/sage-4.6.alpha2/spkg/build/mpir-1.2.2.p1/src'
make[5]: *** [install-data-am] Error 2
make[5]: *** Waiting for unfinished jobs....
[...]
}}}
> Has anyone else seen this? 


Sorry for the delay; I frequently see this since a while on Ubuntus (9.04 & 10.04) when building Sage with e.g. 16 or 32 jobs, with the **old** MPIR, too; also reported elsewhere (but incidentally also first saw this with MPIR 2.1.1 and the new PARI).

I cannot find obvious errors in the Makefile though; the relevant parts are identical to those of GMP btw, IIRC.

As another incident, I ran into this race condition again yesterday when building Sage 4.4.4 (!) from scratch with `MAKE="make -j16"`.



---

archive/issue_comments_091227.json:
```json
{
    "body": "<a id='comment:25'></a>\nW.r.t. the race condition, cf. http://trac.sagemath.org/sage_trac/ticket/9343#comment:324\n\n(I currently don't recall if I reported this elsewhere, or my results of inspecting the Makefile... :( )",
    "created_at": "2010-10-22T07:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91227",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:25'></a>
W.r.t. the race condition, cf. http://trac.sagemath.org/sage_trac/ticket/9343#comment:324

(I currently don't recall if I reported this elsewhere, or my results of inspecting the Makefile... :( )



---

archive/issue_comments_091228.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [mpatel](#comment%3A22):\n> I noticed that [MPIR 2.1.3 is out](http://www.mpir.org/) with a fix in `mpf_get_d_2exp`.  But I don't think Sage uses (m)any of the `mpf_*` functions.\n\n\nThat last statement is ***wrong***.  Bill Hart corrects me on [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/b40ef1bc8b0b7371/bdb322e7528a06bf#bdb322e7528a06bf):\n\n```\ncddlib, ecl, mpmath, mpfr, singular, sympy all, as far as I can see, make extensive use of mpf functions.\n```\nSorry about my mistake!",
    "created_at": "2010-11-03T22:50:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91228",
    "user": "https://github.com/qed777"
}
```

<a id='comment:26'></a>
Replying to [mpatel](#comment%3A22):
> I noticed that [MPIR 2.1.3 is out](http://www.mpir.org/) with a fix in `mpf_get_d_2exp`.  But I don't think Sage uses (m)any of the `mpf_*` functions.


That last statement is ***wrong***.  Bill Hart corrects me on [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/b40ef1bc8b0b7371/bdb322e7528a06bf#bdb322e7528a06bf):

```
cddlib, ecl, mpmath, mpfr, singular, sympy all, as far as I can see, make extensive use of mpf functions.
```
Sorry about my mistake!



---

archive/issue_events_033519.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "rename": {
        "from": "Upgrade Sage's MPIR spkg to version 2.1.2",
        "to": "Upgrade Sage's MPIR spkg to version 2.1.3 or later"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33519"
}
```



---

archive/issue_comments_091229.json:
```json
{
    "body": "Changing work_issues from \"\" to \"Fix extension module dependencies; upgrade upstream; fix execstack issue.\"",
    "created_at": "2010-11-03T23:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91229",
    "user": "https://github.com/nexttime"
}
```

Changing work_issues from "" to "Fix extension module dependencies; upgrade upstream; fix execstack issue."



---

archive/issue_comments_091230.json:
```json
{
    "body": "<a id='comment:27'></a>\nI would have taken the latest version anyway...\n\n---\n\nA trivial fix for the executable stack issue is to add the following to `spkg-install`:\n\n```sh\ncase \"$UNAME\" in\n    Linux) # implies a GNU linker\n        LDFLAGS=\"$LDFLAGS -Wl,z,noexecstack\"\n        # already exported by sage-env\n        ;;\n    # perhaps other platforms, too\nesac\n```",
    "created_at": "2010-11-03T23:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91230",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:27'></a>
I would have taken the latest version anyway...

---

A trivial fix for the executable stack issue is to add the following to `spkg-install`:

```sh
case "$UNAME" in
    Linux) # implies a GNU linker
        LDFLAGS="$LDFLAGS -Wl,z,noexecstack"
        # already exported by sage-env
        ;;
    # perhaps other platforms, too
esac
```



---

archive/issue_comments_091231.json:
```json
{
    "body": "<a id='comment:28'></a>\nCopy and paste with typos included... It should of course be `-Wl,-z,noexecstack`.",
    "created_at": "2010-11-04T02:08:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91231",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:28'></a>
Copy and paste with typos included... It should of course be `-Wl,-z,noexecstack`.



---

archive/issue_comments_091232.json:
```json
{
    "body": "Changing author from \"Mike Hansen\" to \"Mike Hansen, Leif Leonhardy\"",
    "created_at": "2010-11-04T06:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91232",
    "user": "https://github.com/nexttime"
}
```

Changing author from "Mike Hansen" to "Mike Hansen, Leif Leonhardy"



---

archive/issue_comments_091233.json:
```json
{
    "body": "Changing work_issues from \"Fix extension module dependencies; upgrade upstream; fix execstack issue.\" to \"Fix extension module dependencies\"",
    "created_at": "2010-11-04T06:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91233",
    "user": "https://github.com/nexttime"
}
```

Changing work_issues from "Fix extension module dependencies; upgrade upstream; fix execstack issue." to "Fix extension module dependencies"



---

archive/issue_comments_091234.json:
```json
{
    "body": "Changing keywords from \"\" to \"GMP ECM execstack Fedora 14\".",
    "created_at": "2010-11-04T06:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91234",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "" to "GMP ECM execstack Fedora 14".



---

archive/issue_comments_091235.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-11-04T06:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91235",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_091236.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Leif Leonhardy\"",
    "created_at": "2010-11-04T06:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91236",
    "user": "https://github.com/nexttime"
}
```

Changing reviewer from "" to "Leif Leonhardy"



---

archive/issue_comments_091237.json:
```json
{
    "body": "<a id='comment:29'></a>\n**New spkg: http://spkg-upload.googlecode.com/files/mpir-2.1.3.p0.spkg**\n\n**md5sum:** `f65cbb309ee471d2a64f59e52e592494  mpir-2.1.3.p0.spkg`\n\nNew spkg with updated upstream, \"reviewer\" changes, fix for Fedora 14 (based on Mike's 2.1.1 spkg).\n\nSetting this to needs review though we still need a patch to the Sage library to fix the extension module dependencies. Can be tested \"stand-alone\" (with `SAGE_CHECK=yes`), but should be installed together with the new ECM 6.3 spkg from #5847 (also needing review by a third person), since otherwise ECM doesn't build (i.e., the old version doesn't work with GMP 5.x or MPIR 2.x).\n\nSteps to install:\n* Download the new MPIR spkg and the [ecm-6.3.p0.spkg](http://spkg-upload.googlecode.com/files/ecm-6.3.p0.spkg) from #5847.\n* Copy both files into `$SAGE_ROOT/spkg/standard` (such that 'make' will \"see\" them).\n* Then do:\n\n```sh\n$ export SAGE_CHECK=yes                # optional, but recommended\n$ export SAGE_UPGRADING=yes            # required to rebuild all dependent spkgs, too\n\n$ export SAGE_PARALLEL_SPKG_BUILD=yes  # optional\n$ export MAKE=\"make -jN\"               # optional; N: number of 'make' jobs\n\n$ time make build                      # just rebuild Sage (without the documentation)\n$                                      # (logs go to install.log and spkg/logs/*)\n$ ./sage -ba-force                     # rebuild the whole Sage library, necessary until\n                                       # we fix the dependencies in module_list.py\n$ time make ptestlong NUM_THREADS=N    # Use N threads instead of the default number\n                                       # (also rebuilds the documentation as needed)\n```\n* Report back... ;-)\n\n(I've so far tested both packages with Sage 4.6.1.alpha0 on Ubuntu 9.04 x86 and Ubuntu 10.04 x86_64.)",
    "created_at": "2010-11-04T06:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91237",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:29'></a>
**New spkg: http://spkg-upload.googlecode.com/files/mpir-2.1.3.p0.spkg**

**md5sum:** `f65cbb309ee471d2a64f59e52e592494  mpir-2.1.3.p0.spkg`

New spkg with updated upstream, "reviewer" changes, fix for Fedora 14 (based on Mike's 2.1.1 spkg).

Setting this to needs review though we still need a patch to the Sage library to fix the extension module dependencies. Can be tested "stand-alone" (with `SAGE_CHECK=yes`), but should be installed together with the new ECM 6.3 spkg from #5847 (also needing review by a third person), since otherwise ECM doesn't build (i.e., the old version doesn't work with GMP 5.x or MPIR 2.x).

Steps to install:
* Download the new MPIR spkg and the [ecm-6.3.p0.spkg](http://spkg-upload.googlecode.com/files/ecm-6.3.p0.spkg) from #5847.
* Copy both files into `$SAGE_ROOT/spkg/standard` (such that 'make' will "see" them).
* Then do:

```sh
$ export SAGE_CHECK=yes                # optional, but recommended
$ export SAGE_UPGRADING=yes            # required to rebuild all dependent spkgs, too

$ export SAGE_PARALLEL_SPKG_BUILD=yes  # optional
$ export MAKE="make -jN"               # optional; N: number of 'make' jobs

$ time make build                      # just rebuild Sage (without the documentation)
$                                      # (logs go to install.log and spkg/logs/*)
$ ./sage -ba-force                     # rebuild the whole Sage library, necessary until
                                       # we fix the dependencies in module_list.py
$ time make ptestlong NUM_THREADS=N    # Use N threads instead of the default number
                                       # (also rebuilds the documentation as needed)
```
* Report back... ;-)

(I've so far tested both packages with Sage 4.6.1.alpha0 on Ubuntu 9.04 x86 and Ubuntu 10.04 x86_64.)



---

archive/issue_comments_091238.json:
```json
{
    "body": "Attachment [trac_8664-mpir-2.1.1_vs._2.1.3.p0-spkg.patch](tarball://root/attachments/some-uuid/ticket8664/trac_8664-mpir-2.1.1_vs._2.1.3.p0-spkg.patch) by @nexttime created at 2010-11-04 06:47:36\n\nSPKG patch, based on Mike's 2.1.1. For reference/review.",
    "created_at": "2010-11-04T06:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91238",
    "user": "https://github.com/nexttime"
}
```

Attachment [trac_8664-mpir-2.1.1_vs._2.1.3.p0-spkg.patch](tarball://root/attachments/some-uuid/ticket8664/trac_8664-mpir-2.1.1_vs._2.1.3.p0-spkg.patch) by @nexttime created at 2010-11-04 06:47:36

SPKG patch, based on Mike's 2.1.1. For reference/review.



---

archive/issue_comments_091239.json:
```json
{
    "body": "<a id='comment:30'></a>\nOoops, I just noticed the hint to rerun `make` if the **install** failed is in the wrong place (it is actually shown if the **build** failed), but that's IMHO a minor issue I'll perhaps fix later.",
    "created_at": "2010-11-04T07:05:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91239",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:30'></a>
Ooops, I just noticed the hint to rerun `make` if the **install** failed is in the wrong place (it is actually shown if the **build** failed), but that's IMHO a minor issue I'll perhaps fix later.



---

archive/issue_comments_091240.json:
```json
{
    "body": "<a id='comment:31'></a>\nBuilt and tested on sage.math.washington.edu without problems.",
    "created_at": "2010-11-04T15:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91240",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'></a>
Built and tested on sage.math.washington.edu without problems.



---

archive/issue_comments_091241.json:
```json
{
    "body": "Attachment [trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib.patch](tarball://root/attachments/some-uuid/ticket8664/trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib.patch) by @nexttime created at 2010-11-04 19:58:26\n\nSage library patch. Fixes extension modules not getting rebuilt though depending on MPIR. Based on Sage 4.6.1.alpha0.",
    "created_at": "2010-11-04T19:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91241",
    "user": "https://github.com/nexttime"
}
```

Attachment [trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib.patch](tarball://root/attachments/some-uuid/ticket8664/trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib.patch) by @nexttime created at 2010-11-04 19:58:26

Sage library patch. Fixes extension modules not getting rebuilt though depending on MPIR. Based on Sage 4.6.1.alpha0.



---

archive/issue_comments_091242.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -37,3 +37,8 @@\n \n william\n ```\n+\n+\n+New spkg: [http://spkg-upload.googlecode.com/files/mpir-2.1.3.p0.spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p0.spkg)\n+\n+Testing distribution (including #5847): [http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar](http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar)\n``````\n",
    "created_at": "2010-11-04T20:00:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91242",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -37,3 +37,8 @@
 
 william
 ```
+
+
+New spkg: [http://spkg-upload.googlecode.com/files/mpir-2.1.3.p0.spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p0.spkg)
+
+Testing distribution (including #5847): [http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar](http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar)
``````




---

archive/issue_comments_091243.json:
```json
{
    "body": "Changing keywords from \"GMP ECM execstack Fedora 14\" to \"GMP ECM execstack Fedora 14 extension module library dependencies\".",
    "created_at": "2010-11-04T20:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91243",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "GMP ECM execstack Fedora 14" to "GMP ECM execstack Fedora 14 extension module library dependencies".



---

archive/issue_comments_091244.json:
```json
{
    "body": "Changing work_issues from \"Fix extension module dependencies\" to \"\"",
    "created_at": "2010-11-04T20:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91244",
    "user": "https://github.com/nexttime"
}
```

Changing work_issues from "Fix extension module dependencies" to ""



---

archive/issue_comments_091245.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [leif](#comment%3A29):\n> Setting this to needs review though we still need a patch to the Sage library to fix the extension module dependencies. [...]\n\n\nI've attached a patch that fixes the dependency issue with extension modules of the Sage library.\n\n\n**Updated steps to test / install:**\n* Download the [new MPIR spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p0.spkg) and the [ecm-6.3.p0.spkg](http://spkg-upload.googlecode.com/files/ecm-6.3.p0.spkg) from #5847.\n* Copy both files into `$SAGE_ROOT/spkg/standard` (such that `make` will \"see\" them).\n* Download the [patch to the Sage library](http://trac.sagemath.org/sage_trac/raw-attachment/ticket/8664/trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib.patch). **Do not yet apply the patch.** (We first rebuild / reinstall dependent spkgs, of which the Sage library is one, so the patched version could get overwritten.)\n* Then do:\n\n```sh\n$ export SAGE_CHECK=yes                # optional, but recommended\n$ export SAGE_UPGRADING=yes            # required to rebuild all dependent spkgs, too\n\n$ export SAGE_PARALLEL_SPKG_BUILD=yes  # optional\n$ export MAKE=\"make -jN\"               # optional; N: number of 'make' jobs\n\n$ time make build                      # just rebuild Sage (without the documentation)\n$                                      # (logs go to install.log and spkg/logs/*)\n$ cd devel/sage\n$ hg import /path/to/trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib.patch\n$ cd ../..\n$ ./sage -b                            # rebuild the Sage library; only dependent modules\n\n$ time make ptestlong NUM_THREADS=N    # Use N threads instead of the default number\n                                       # (also rebuilds the documentation as needed)\n```\n* Report back... ;-)",
    "created_at": "2010-11-04T20:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91245",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:33'></a>
Replying to [leif](#comment%3A29):
> Setting this to needs review though we still need a patch to the Sage library to fix the extension module dependencies. [...]


I've attached a patch that fixes the dependency issue with extension modules of the Sage library.


**Updated steps to test / install:**
* Download the [new MPIR spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p0.spkg) and the [ecm-6.3.p0.spkg](http://spkg-upload.googlecode.com/files/ecm-6.3.p0.spkg) from #5847.
* Copy both files into `$SAGE_ROOT/spkg/standard` (such that `make` will "see" them).
* Download the [patch to the Sage library](http://trac.sagemath.org/sage_trac/raw-attachment/ticket/8664/trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib.patch). **Do not yet apply the patch.** (We first rebuild / reinstall dependent spkgs, of which the Sage library is one, so the patched version could get overwritten.)
* Then do:

```sh
$ export SAGE_CHECK=yes                # optional, but recommended
$ export SAGE_UPGRADING=yes            # required to rebuild all dependent spkgs, too

$ export SAGE_PARALLEL_SPKG_BUILD=yes  # optional
$ export MAKE="make -jN"               # optional; N: number of 'make' jobs

$ time make build                      # just rebuild Sage (without the documentation)
$                                      # (logs go to install.log and spkg/logs/*)
$ cd devel/sage
$ hg import /path/to/trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib.patch
$ cd ../..
$ ./sage -b                            # rebuild the Sage library; only dependent modules

$ time make ptestlong NUM_THREADS=N    # Use N threads instead of the default number
                                       # (also rebuilds the documentation as needed)
```
* Report back... ;-)



---

archive/issue_comments_091246.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [jdemeyer](#comment%3A32):\n\nDon't mess with my ticket while I'm posting... ;-)\n\nCan you (or did you) include the patch to the Sage library?",
    "created_at": "2010-11-04T20:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91246",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:34'></a>
Replying to [jdemeyer](#comment%3A32):

Don't mess with my ticket while I'm posting... ;-)

Can you (or did you) include the patch to the Sage library?



---

archive/issue_comments_091247.json:
```json
{
    "body": "<a id='comment:35'></a>\nP.S.: My patch shouldn't conflict with #10094, only the line numbers will change.",
    "created_at": "2010-11-04T20:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91247",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:35'></a>
P.S.: My patch shouldn't conflict with #10094, only the line numbers will change.



---

archive/issue_comments_091248.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [leif](#comment%3A33):\n>  * Download the [patch to the Sage library](http://trac.sagemath.org/sage_trac/raw-attachment/ticket/8664/trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib.patch). **Do not yet apply the patch.** (We first rebuild / reinstall dependent spkgs, of which the Sage library is one, so the patched version could get overwritten.)\n\n\nPlease explain.  When can `setup.py` be overwritten?  This patched-files-being-overwritten-thing has bitten me already several times.",
    "created_at": "2010-11-04T20:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91248",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:36'></a>
Replying to [leif](#comment%3A33):
>  * Download the [patch to the Sage library](http://trac.sagemath.org/sage_trac/raw-attachment/ticket/8664/trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib.patch). **Do not yet apply the patch.** (We first rebuild / reinstall dependent spkgs, of which the Sage library is one, so the patched version could get overwritten.)


Please explain.  When can `setup.py` be overwritten?  This patched-files-being-overwritten-thing has bitten me already several times.



---

archive/issue_comments_091249.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -39,6 +39,14 @@\n ```\n \n \n+---\n+\n New spkg: [http://spkg-upload.googlecode.com/files/mpir-2.1.3.p0.spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p0.spkg)\n \n-Testing distribution (including #5847): [http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar](http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar)\n+Testing distribution (including #5847):\n+[http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar](http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar)\n+\n+\n+---\n+\n+See comment(s) below on how to *\"manually\"* install and test the new packages. (ECM has to be updated, too.)\n``````\n",
    "created_at": "2010-11-04T20:39:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91249",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -39,6 +39,14 @@
 ```
 
 
+---
+
 New spkg: [http://spkg-upload.googlecode.com/files/mpir-2.1.3.p0.spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p0.spkg)
 
-Testing distribution (including #5847): [http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar](http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar)
+Testing distribution (including #5847):
+[http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar](http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar)
+
+
+---
+
+See comment(s) below on how to *"manually"* install and test the new packages. (ECM has to be updated, too.)
``````




---

archive/issue_comments_091250.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [jdemeyer](#comment%3A36):\n> Replying to [leif](#comment%3A33):\n> >  * Download the [patch to the Sage library](http://trac.sagemath.org/sage_trac/raw-attachment/ticket/8664/trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib.patch). **Do not yet apply the patch.** (We first rebuild / reinstall dependent spkgs, of which the Sage library is one, so the patched version could get overwritten.)\n \n> \n> Please explain.  When can `setup.py` be overwritten?  This patched-files-being-overwritten-thing has bitten me already several times.\n\n\nI can only cite from the Sage library's `spkg-install`: ;-)\n\n```python\n...\n    sage -sync-build\n\n    # Pull in changes from the archive just downloaded. \n    hg pull \"$CUR\"\n    hg merge tip\n    hg ci -m \"merge\"\n    # Make the pulled in changes take effect. \n    hg update \n...\n```\n\n`sage -sync-build` calls `local/bin/sage-sync-build.py`.",
    "created_at": "2010-11-04T20:51:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91250",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:38'></a>
Replying to [jdemeyer](#comment%3A36):
> Replying to [leif](#comment%3A33):
> >  * Download the [patch to the Sage library](http://trac.sagemath.org/sage_trac/raw-attachment/ticket/8664/trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib.patch). **Do not yet apply the patch.** (We first rebuild / reinstall dependent spkgs, of which the Sage library is one, so the patched version could get overwritten.)
 
> 
> Please explain.  When can `setup.py` be overwritten?  This patched-files-being-overwritten-thing has bitten me already several times.


I can only cite from the Sage library's `spkg-install`: ;-)

```python
...
    sage -sync-build

    # Pull in changes from the archive just downloaded. 
    hg pull "$CUR"
    hg merge tip
    hg ci -m "merge"
    # Make the pulled in changes take effect. 
    hg update 
...
```

`sage -sync-build` calls `local/bin/sage-sync-build.py`.



---

archive/issue_comments_091251.json:
```json
{
    "body": "<a id='comment:39'></a>\nReplying to [leif](#comment%3A38):\n> I can only cite from the Sage library's `spkg-install`: ;-)\n\n\n*\"In principle\"*<sup>TM</sup>, this shouldn't invalidate newer patches already applied (and committed) to the Sage library.",
    "created_at": "2010-11-04T21:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91251",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:39'></a>
Replying to [leif](#comment%3A38):
> I can only cite from the Sage library's `spkg-install`: ;-)


*"In principle"*<sup>TM</sup>, this shouldn't invalidate newer patches already applied (and committed) to the Sage library.



---

archive/issue_comments_091252.json:
```json
{
    "body": "<a id='comment:40'></a>\nReplying to [leif](#comment%3A34):\n> Can you include the patch to the Sage library?\n\n\nNow it should be also merged, same spkg file.",
    "created_at": "2010-11-04T22:50:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91252",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'></a>
Replying to [leif](#comment%3A34):
> Can you include the patch to the Sage library?


Now it should be also merged, same spkg file.



---

archive/issue_comments_091253.json:
```json
{
    "body": "<a id='comment:41'></a>\nDoes the problem in [comment 22](#comment%3A22) occur during `$MAKE install`?",
    "created_at": "2010-11-04T23:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91253",
    "user": "https://github.com/qed777"
}
```

<a id='comment:41'></a>
Does the problem in [comment 22](#comment%3A22) occur during `$MAKE install`?



---

archive/issue_comments_091254.json:
```json
{
    "body": "<a id='comment:42'></a>\nReplying to [mpatel](#comment%3A41):\n> Does the problem in [comment 22](#comment%3A22) occur during `$MAKE install`?\n\n\nI have not encountered this problem (yet), I've built on `sage.math.washington.edu` without problems.\n\nIf you feel like it, you could put [http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar](http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar) on the buildbots and see what happens...",
    "created_at": "2010-11-04T23:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91254",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:42'></a>
Replying to [mpatel](#comment%3A41):
> Does the problem in [comment 22](#comment%3A22) occur during `$MAKE install`?


I have not encountered this problem (yet), I've built on `sage.math.washington.edu` without problems.

If you feel like it, you could put [http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar](http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar) on the buildbots and see what happens...



---

archive/issue_comments_091255.json:
```json
{
    "body": "<a id='comment:43'></a>\nReplying to [mpatel](#comment%3A41):\n> Does the problem in [comment 22](#comment%3A22) occur during `$MAKE install`?\n\n\n```sh\n(cd /home/mpatel/build/cleo/sage-4.6.alpha2/local/include  && rm -f gmp.h   && cp mpir.h   gmp.h)\n/usr/bin/install -c -m 644 'mpir.h' '/home/mpatel/build/cleo/sage-4.6.alpha2/local/include/mpir.h'\n```\n\nSmells like it does, doesn't it? ;-)\n\nOr did I misunderstand you? (As mentioned in a comment above, the hint to rerun `make` is given in the wrong situation.)\n\n```diff\ndiff --git a/spkg-install b/spkg-install\n--- a/spkg-install\n+++ b/spkg-install\n@@ -123,18 +123,6 @@\n     $MAKE\n     if [ $? -ne 0 ]; then\n         echo \"Error building MPIR.\"\n-        echo \"\"\n-        echo \"If you see a message like:\"\n-        cat <<EOF\n-    cp: cannot stat 'mpir.h': No such file or directory\n-    make[6]: *** [install-data-hook] Error 1\n-    make[6]: Leaving directory ...\n-    make[5]: *** [install-data-am] Error 2\n-    make[5]: *** Waiting for unfinished jobs....\n-EOF\n-        echo \"above, this is just due to a rare race condition.\"\n-        echo \"Please simply rerun 'make' (or 'sage -i ...').\"\n-        echo \"\"\n         exit 1\n     fi \n \n@@ -146,6 +134,18 @@\n     if [ $? -ne 0 ]; then\n         if [ \"$UNAME\" != \"CYGWIN\" ]; then  # On Cygwin an error is not fatal.\n             echo \"Error installing MPIR.\"\n+            echo \"\"\n+            echo \"If you see a message like:\"\n+            cat <<EOF\n+    cp: cannot stat 'mpir.h': No such file or directory\n+    make[6]: *** [install-data-hook] Error 1\n+    make[6]: Leaving directory ...\n+    make[5]: *** [install-data-am] Error 2\n+    make[5]: *** Waiting for unfinished jobs....\n+EOF\n+            echo \"above, this is just due to a rare race condition.\"\n+            echo \"Please simply rerun 'make' (or 'sage -i ...').\"\n+            echo \"\"\n             exit 1\n         fi\n     fi\n```",
    "created_at": "2010-11-05T00:17:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91255",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:43'></a>
Replying to [mpatel](#comment%3A41):
> Does the problem in [comment 22](#comment%3A22) occur during `$MAKE install`?


```sh
(cd /home/mpatel/build/cleo/sage-4.6.alpha2/local/include  && rm -f gmp.h   && cp mpir.h   gmp.h)
/usr/bin/install -c -m 644 'mpir.h' '/home/mpatel/build/cleo/sage-4.6.alpha2/local/include/mpir.h'
```

Smells like it does, doesn't it? ;-)

Or did I misunderstand you? (As mentioned in a comment above, the hint to rerun `make` is given in the wrong situation.)

```diff
diff --git a/spkg-install b/spkg-install
--- a/spkg-install
+++ b/spkg-install
@@ -123,18 +123,6 @@
     $MAKE
     if [ $? -ne 0 ]; then
         echo "Error building MPIR."
-        echo ""
-        echo "If you see a message like:"
-        cat <<EOF
-    cp: cannot stat 'mpir.h': No such file or directory
-    make[6]: *** [install-data-hook] Error 1
-    make[6]: Leaving directory ...
-    make[5]: *** [install-data-am] Error 2
-    make[5]: *** Waiting for unfinished jobs....
-EOF
-        echo "above, this is just due to a rare race condition."
-        echo "Please simply rerun 'make' (or 'sage -i ...')."
-        echo ""
         exit 1
     fi 
 
@@ -146,6 +134,18 @@
     if [ $? -ne 0 ]; then
         if [ "$UNAME" != "CYGWIN" ]; then  # On Cygwin an error is not fatal.
             echo "Error installing MPIR."
+            echo ""
+            echo "If you see a message like:"
+            cat <<EOF
+    cp: cannot stat 'mpir.h': No such file or directory
+    make[6]: *** [install-data-hook] Error 1
+    make[6]: Leaving directory ...
+    make[5]: *** [install-data-am] Error 2
+    make[5]: *** Waiting for unfinished jobs....
+EOF
+            echo "above, this is just due to a rare race condition."
+            echo "Please simply rerun 'make' (or 'sage -i ...')."
+            echo ""
             exit 1
         fi
     fi
```



---

archive/issue_comments_091256.json:
```json
{
    "body": "<a id='comment:44'></a>\nReplying to [leif](#comment%3A43):\n> Replying to [mpatel](#comment%3A41):\n> Or did I misunderstand you? (As mentioned in a comment above, the hint to rerun `make` is given in the wrong situation.)\n\n\nOooops, I missed [your comment](#comment%3A30).  Thanks for pointing it out.",
    "created_at": "2010-11-05T00:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91256",
    "user": "https://github.com/qed777"
}
```

<a id='comment:44'></a>
Replying to [leif](#comment%3A43):
> Replying to [mpatel](#comment%3A41):
> Or did I misunderstand you? (As mentioned in a comment above, the hint to rerun `make` is given in the wrong situation.)


Oooops, I missed [your comment](#comment%3A30).  Thanks for pointing it out.



---

archive/issue_comments_091257.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -50,3 +50,7 @@\n ---\n \n See comment(s) below on how to *\"manually\"* install and test the new packages. (ECM has to be updated, too.)\n+\n+---\n+\n+#9522 can be closed as invalid / duplicate once this ticket has been merged.\n``````\n",
    "created_at": "2010-11-05T01:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91257",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -50,3 +50,7 @@
 ---
 
 See comment(s) below on how to *"manually"* install and test the new packages. (ECM has to be updated, too.)
+
+---
+
+#9522 can be closed as invalid / duplicate once this ticket has been merged.
``````




---

archive/issue_comments_091258.json:
```json
{
    "body": "<a id='comment:46'></a>\nAny reason to keep\n\n```sh\n    SAGE_CONF_OPTS=\"--enable-shared --disable-static\"\n```\n(i.e., why not build the static library, too)?",
    "created_at": "2010-11-05T03:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91258",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:46'></a>
Any reason to keep

```sh
    SAGE_CONF_OPTS="--enable-shared --disable-static"
```
(i.e., why not build the static library, too)?



---

archive/issue_comments_091259.json:
```json
{
    "body": "<a id='comment:47'></a>\nReplying to [leif](#comment%3A33):\n\nI tried to build mpir-2.1.3.p0.spkg on MacOSX 10.5 PPC, and it did not work; \nsage -f mpir-2.1.3.p0.spkg bails out  with the following:\n\n```\n...\n gcc -std=gnu99 -c -DHAVE_CONFIG_H -g -O3 -D__GMP_WITHIN_GMP -I.. -DOPERATION_popcount -I. -I.. tmp-popcount.s -fno-common -DPIC -o .libs/popcount.o\ntmp-popcount.s:127:vspltisb vector instruction is optional for the PowerPC (not allowed without -force_cpusubtype_ALL option)\ntmp-popcount.s:128:vspltisb vector instruction is optional for the PowerPC (not allowed without -force_cpusubtype_ALL option)\n\n... etc etc etc ...\n\ntmp-popcount.s:239:stvx vector instruction is optional for the PowerPC (not allowed without -force_cpusubtype_ALL option)\nmake[2]: *** [popcount.lo] Error 1\nmake[1]: *** [all-recursive] Error 1\nmake: *** [all] Error 2\nError building MPIR.\n\n```",
    "created_at": "2010-11-05T17:23:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91259",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:47'></a>
Replying to [leif](#comment%3A33):

I tried to build mpir-2.1.3.p0.spkg on MacOSX 10.5 PPC, and it did not work; 
sage -f mpir-2.1.3.p0.spkg bails out  with the following:

```
...
 gcc -std=gnu99 -c -DHAVE_CONFIG_H -g -O3 -D__GMP_WITHIN_GMP -I.. -DOPERATION_popcount -I. -I.. tmp-popcount.s -fno-common -DPIC -o .libs/popcount.o
tmp-popcount.s:127:vspltisb vector instruction is optional for the PowerPC (not allowed without -force_cpusubtype_ALL option)
tmp-popcount.s:128:vspltisb vector instruction is optional for the PowerPC (not allowed without -force_cpusubtype_ALL option)

... etc etc etc ...

tmp-popcount.s:239:stvx vector instruction is optional for the PowerPC (not allowed without -force_cpusubtype_ALL option)
make[2]: *** [popcount.lo] Error 1
make[1]: *** [all-recursive] Error 1
make: *** [all] Error 2
Error building MPIR.

```



---

archive/issue_comments_091260.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-11-05T17:23:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91260",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_091261.json:
```json
{
    "body": "<a id='comment:48'></a>\nReplying to [dimpase](#comment%3A47):\n> Replying to [leif](#comment%3A33):\n> \n> I tried to build mpir-2.1.3.p0.spkg on MacOSX 10.5 PPC, and it did not work; \n> sage -f mpir-2.1.3.p0.spkg bails out  with [...]\n\n{{{\n...\ntmp-popcount.s:127:vspltisb vector instruction is optional for the PowerPC (not allowed without -force_cpusubtype_ALL option)\n...\n}}}\n\nThanks for testing this.\n\nWould adding `-Wa,-force_cpusubtype_ALL` on MacOS PPCs work? (Unless `SAGE_FAT_BINARY=yes`... Don't know what to do in that case, i.e. if `--enable-fat` works in that case, too.)\n\n(I think PPC implies [32-bit] MacOS X 10.4 or 10.5 in Sage.)\n\nOr do we have to make further distinctions on the CPU type?\n\nFor 32-bit **x86** builds on MacOS X < 10.6 we currently remove a lot of assembly files:\n\n```sh\nremove_pic_osx_32_bit()\n{\n    # Assumes we are in src/\n    echo \"Deleting assembly files which depend on PIC assembly\" \\\n        \"working or 32 bit OSX on Intel hardware...\"\n    rm mpn/x86/dive_1.asm \n    rm mpn/x86/diveby3.asm \n    rm mpn/x86/pentium4/sse2/dive_1.asm \n    rm mpn/x86/pentium4/sse2/mode1o.asm \n    rm mpn/x86/pentium4/sse2/diveby3.asm \n    rm mpn/x86/pentium4/mmx/popham.asm \n    rm mpn/x86/pentium4/mmx/rshift.asm\n    rm mpn/x86/p6/mode1o.asm\n    rm mpn/x86/p6/dive_1.asm\n    rm mpn/x86/pentium/hamdist.asm\n    rm mpn/x86/pentium/mod_1.asm\n    rm mpn/x86/pentium/popcount.asm\n    rm mpn/x86/pentium/mode1o.asm\n    rm mpn/x86/pentium/dive_1.asm\n}\n```\n\nWe should report this upstream. Bill, can you forward this?",
    "created_at": "2010-11-05T19:06:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91261",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:48'></a>
Replying to [dimpase](#comment%3A47):
> Replying to [leif](#comment%3A33):
> 
> I tried to build mpir-2.1.3.p0.spkg on MacOSX 10.5 PPC, and it did not work; 
> sage -f mpir-2.1.3.p0.spkg bails out  with [...]

{{{
...
tmp-popcount.s:127:vspltisb vector instruction is optional for the PowerPC (not allowed without -force_cpusubtype_ALL option)
...
}}}

Thanks for testing this.

Would adding `-Wa,-force_cpusubtype_ALL` on MacOS PPCs work? (Unless `SAGE_FAT_BINARY=yes`... Don't know what to do in that case, i.e. if `--enable-fat` works in that case, too.)

(I think PPC implies [32-bit] MacOS X 10.4 or 10.5 in Sage.)

Or do we have to make further distinctions on the CPU type?

For 32-bit **x86** builds on MacOS X < 10.6 we currently remove a lot of assembly files:

```sh
remove_pic_osx_32_bit()
{
    # Assumes we are in src/
    echo "Deleting assembly files which depend on PIC assembly" \
        "working or 32 bit OSX on Intel hardware..."
    rm mpn/x86/dive_1.asm 
    rm mpn/x86/diveby3.asm 
    rm mpn/x86/pentium4/sse2/dive_1.asm 
    rm mpn/x86/pentium4/sse2/mode1o.asm 
    rm mpn/x86/pentium4/sse2/diveby3.asm 
    rm mpn/x86/pentium4/mmx/popham.asm 
    rm mpn/x86/pentium4/mmx/rshift.asm
    rm mpn/x86/p6/mode1o.asm
    rm mpn/x86/p6/dive_1.asm
    rm mpn/x86/pentium/hamdist.asm
    rm mpn/x86/pentium/mod_1.asm
    rm mpn/x86/pentium/popcount.asm
    rm mpn/x86/pentium/mode1o.asm
    rm mpn/x86/pentium/dive_1.asm
}
```

We should report this upstream. Bill, can you forward this?



---

archive/issue_comments_091262.json:
```json
{
    "body": "<a id='comment:49'></a>\nReplying to [leif](#comment%3A48):\n> Would adding `-Wa,-force_cpusubtype_ALL` on MacOS PPCs work?\n\n\nI.e.\n\n```sh\n$ env CFLAGS=\"-Wa,-force_cpusubtype_ALL\" ./sage -f mpir-2.1.3.p0.spkg\n```\n\nEven if this works for you, I'm not sure if MPIR only enables that code on CPUs that really support these instructions. Jeroen apparently has built this spkg on a MacOS X 10.4 PPC G5.",
    "created_at": "2010-11-05T19:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91262",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:49'></a>
Replying to [leif](#comment%3A48):
> Would adding `-Wa,-force_cpusubtype_ALL` on MacOS PPCs work?


I.e.

```sh
$ env CFLAGS="-Wa,-force_cpusubtype_ALL" ./sage -f mpir-2.1.3.p0.spkg
```

Even if this works for you, I'm not sure if MPIR only enables that code on CPUs that really support these instructions. Jeroen apparently has built this spkg on a MacOS X 10.4 PPC G5.



---

archive/issue_comments_091263.json:
```json
{
    "body": "<a id='comment:50'></a>\nReplying to [leif](#comment%3A49):\n> Replying to [leif](#comment%3A48):\n> > Would adding `-Wa,-force_cpusubtype_ALL` on MacOS PPCs work?\n\n> \n> \n> Even if this works for you, I'm not sure if MPIR only enables that code on CPUs that really support these instructions. Jeroen apparently has built this spkg on a MacOS X 10.4 PPC G5.\n\n\nyes, it at least builds without errors this way, on MacOSX 10.5 G4 PPC, with gcc 4.2.1 (Apple Inc. build 5577).\nTell me what I should test. (I don't want to rerun the whole Sage testsuite, as it takes ages on this machine, and I use it otherwise too)",
    "created_at": "2010-11-05T20:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91263",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:50'></a>
Replying to [leif](#comment%3A49):
> Replying to [leif](#comment%3A48):
> > Would adding `-Wa,-force_cpusubtype_ALL` on MacOS PPCs work?

> 
> 
> Even if this works for you, I'm not sure if MPIR only enables that code on CPUs that really support these instructions. Jeroen apparently has built this spkg on a MacOS X 10.4 PPC G5.


yes, it at least builds without errors this way, on MacOSX 10.5 G4 PPC, with gcc 4.2.1 (Apple Inc. build 5577).
Tell me what I should test. (I don't want to rerun the whole Sage testsuite, as it takes ages on this machine, and I use it otherwise too)



---

archive/issue_comments_091264.json:
```json
{
    "body": "<a id='comment:51'></a>\nReplying to [leif](#comment%3A49):\n> Jeroen apparently has built this spkg on a MacOS X 10.4 PPC G5.\n\nYes, I did.  If it helps, I've put the log at [http://sage.math.washington.edu/home/jdemeyer/moufang/mpir-2.1.3.p0.log](http://sage.math.washington.edu/home/jdemeyer/moufang/mpir-2.1.3.p0.log).",
    "created_at": "2010-11-05T20:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91264",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:51'></a>
Replying to [leif](#comment%3A49):
> Jeroen apparently has built this spkg on a MacOS X 10.4 PPC G5.

Yes, I did.  If it helps, I've put the log at [http://sage.math.washington.edu/home/jdemeyer/moufang/mpir-2.1.3.p0.log](http://sage.math.washington.edu/home/jdemeyer/moufang/mpir-2.1.3.p0.log).



---

archive/issue_comments_091265.json:
```json
{
    "body": "<a id='comment:52'></a>\nReplying to [dimpase](#comment%3A50):\n> Replying to [leif](#comment%3A49):\n> > Replying to [leif](#comment%3A48):\n> > > Would adding `-Wa,-force_cpusubtype_ALL` on MacOS PPCs work?\n\n> > \n> > \n> > Even if this works for you, I'm not sure if MPIR only enables that code on CPUs that really support these instructions. Jeroen apparently has built this spkg on a MacOS X 10.4 PPC G5.\n\n> \n> yes, it at least builds without errors this way, on MacOSX 10.5 G4 PPC, with gcc 4.2.1 (Apple Inc. build 5577).\n> Tell me what I should test. (I don't want to rerun the whole Sage testsuite, as it takes ages on this machine, and I use it otherwise too)\n\n\nNice, thanks.\n\nDid you run MPIR's test suite (i.e., installed with `SAGE_CHECK=yes`)?\n\nI'll update the ECM package (#5847) with the upstream patch, then you could also test this.\n\nI don't know if you already broke your Sage installation by now having successfully installed the new MPIR, since we delete all older versions, which other parts of Sage will still try to use unless you also rebuild the dependent packages.\n\nYou can of course always force the reinstallation of the old MPIR (and ECM) package with `sage -f ...`, then Sage will again work as before.",
    "created_at": "2010-11-05T21:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91265",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:52'></a>
Replying to [dimpase](#comment%3A50):
> Replying to [leif](#comment%3A49):
> > Replying to [leif](#comment%3A48):
> > > Would adding `-Wa,-force_cpusubtype_ALL` on MacOS PPCs work?

> > 
> > 
> > Even if this works for you, I'm not sure if MPIR only enables that code on CPUs that really support these instructions. Jeroen apparently has built this spkg on a MacOS X 10.4 PPC G5.

> 
> yes, it at least builds without errors this way, on MacOSX 10.5 G4 PPC, with gcc 4.2.1 (Apple Inc. build 5577).
> Tell me what I should test. (I don't want to rerun the whole Sage testsuite, as it takes ages on this machine, and I use it otherwise too)


Nice, thanks.

Did you run MPIR's test suite (i.e., installed with `SAGE_CHECK=yes`)?

I'll update the ECM package (#5847) with the upstream patch, then you could also test this.

I don't know if you already broke your Sage installation by now having successfully installed the new MPIR, since we delete all older versions, which other parts of Sage will still try to use unless you also rebuild the dependent packages.

You can of course always force the reinstallation of the old MPIR (and ECM) package with `sage -f ...`, then Sage will again work as before.



---

archive/issue_comments_091266.json:
```json
{
    "body": "<a id='comment:53'></a>\nReplying to [leif](#comment%3A52):\n> Replying to [dimpase](#comment%3A50):\n> > Replying to [leif](#comment%3A49):\n> > > Replying to [leif](#comment%3A48):\n> > > > Would adding `-Wa,-force_cpusubtype_ALL` on MacOS PPCs work?\n\n\nP.S.: Does Apple's XCode `gcc` understand `-force_cpusubtype_ALL` (i.e., without `-Wa,`)?\n\nI just noticed at least recent \"originals\" do on Darwin, but it's perhaps safer to directly pass it to the assembler.\n\nStill need to now what happens on *Linux* PPC (with `gas`)...",
    "created_at": "2010-11-05T21:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91266",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:53'></a>
Replying to [leif](#comment%3A52):
> Replying to [dimpase](#comment%3A50):
> > Replying to [leif](#comment%3A49):
> > > Replying to [leif](#comment%3A48):
> > > > Would adding `-Wa,-force_cpusubtype_ALL` on MacOS PPCs work?


P.S.: Does Apple's XCode `gcc` understand `-force_cpusubtype_ALL` (i.e., without `-Wa,`)?

I just noticed at least recent "originals" do on Darwin, but it's perhaps safer to directly pass it to the assembler.

Still need to now what happens on *Linux* PPC (with `gas`)...



---

archive/issue_comments_091267.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-11-06T02:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91267",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_091268.json:
```json
{
    "body": "<a id='comment:54'></a>\n**New spkg with Darwin fixes: http://spkg-upload.googlecode.com/files/mpir-2.1.3.p1.spkg**\n\n**md5sum:** `0f13106ed6c8af933f93fa4a8981c453  mpir-2.1.3.p1.spkg`\n\nI've uploaded a new p1 spkg that fixes the assembler error on Darwin PPC. [Attached patch](http://trac.sagemath.org/sage_trac/attachment/ticket/8664/trac_8664-mpir-2.1.3.p0-p1.spkg.patch) reflects changes between this and the previous one (p0). Use [this link](http://trac.sagemath.org/sage_trac/raw-attachment/ticket/8664/trac_8664-mpir-2.1.3.p0-p1.spkg.patch) to *download or apply* the patch.\n\n---\n\n### mpir-2.1.3.p1 (Leif Leonhardy, November 5th, 2010)\n* #8664: Upgrade Sage's MPIR spkg to version 2.1.3\n* Fix Darwin assembler errors on PPC by passing the option to allow\n  use of extended instruction set to it. (See also #5847.)\n* Enable the build of a static MPIR library, to be e.g. used by ECM.\n* Support additional 'configure' options given by MPIR_EXTRA_OPTS,\n  and print messages how we configure.\n* Print various environment variable settings (CC, CFLAGS et al.).\n* Move hint to rerun 'make' on *install* errors to correct place.\n* Further comments added.",
    "created_at": "2010-11-06T02:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91268",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:54'></a>
**New spkg with Darwin fixes: http://spkg-upload.googlecode.com/files/mpir-2.1.3.p1.spkg**

**md5sum:** `0f13106ed6c8af933f93fa4a8981c453  mpir-2.1.3.p1.spkg`

I've uploaded a new p1 spkg that fixes the assembler error on Darwin PPC. [Attached patch](http://trac.sagemath.org/sage_trac/attachment/ticket/8664/trac_8664-mpir-2.1.3.p0-p1.spkg.patch) reflects changes between this and the previous one (p0). Use [this link](http://trac.sagemath.org/sage_trac/raw-attachment/ticket/8664/trac_8664-mpir-2.1.3.p0-p1.spkg.patch) to *download or apply* the patch.

---

### mpir-2.1.3.p1 (Leif Leonhardy, November 5th, 2010)
* #8664: Upgrade Sage's MPIR spkg to version 2.1.3
* Fix Darwin assembler errors on PPC by passing the option to allow
  use of extended instruction set to it. (See also #5847.)
* Enable the build of a static MPIR library, to be e.g. used by ECM.
* Support additional 'configure' options given by MPIR_EXTRA_OPTS,
  and print messages how we configure.
* Print various environment variable settings (CC, CFLAGS et al.).
* Move hint to rerun 'make' on *install* errors to correct place.
* Further comments added.



---

archive/issue_comments_091269.json:
```json
{
    "body": "<a id='comment:55'></a>\nP.S.: Except for the filename, test / installation instructions remain the same. (See [above](http://trac.sagemath.org/sage_trac/ticket/8664#comment:33).)",
    "created_at": "2010-11-06T02:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91269",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:55'></a>
P.S.: Except for the filename, test / installation instructions remain the same. (See [above](http://trac.sagemath.org/sage_trac/ticket/8664#comment:33).)



---

archive/issue_comments_091270.json:
```json
{
    "body": "<a id='comment:56'></a>\nReplying to [leif](#comment%3A54):\n> **New spkg with Darwin fixes: http://spkg-upload.googlecode.com/files/mpir-2.1.3.p1.spkg**\n> \n> **md5sum:** `0f13106ed6c8af933f93fa4a8981c453  mpir-2.1.3.p1.spkg`\n> \n> I've uploaded a new p1 spkg that fixes the assembler error on Darwin PPC. [Attached patch](http://trac.sagemath.org/sage_trac/attachment/ticket/8664/trac_8664-mpir-2.1.3.p0-p1.spkg.patch) reflects changes between this and the previous one (p0). Use [this link](http://trac.sagemath.org/sage_trac/raw-attachment/ticket/8664/trac_8664-mpir-2.1.3.p0-p1.spkg.patch) to *download or apply* the patch.\n\n\nThis won't work just like this. Ineed: \n\n```\n$ uname -m                  \nPower Macintosh\n$ uname -a                \nDarwin cantor.local 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:57:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_PPC Power Macintosh\n```\n\nso it's not 'ppc', it's 'Power Macintosh' on OSX 10.5, apparently...",
    "created_at": "2010-11-06T04:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91270",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:56'></a>
Replying to [leif](#comment%3A54):
> **New spkg with Darwin fixes: http://spkg-upload.googlecode.com/files/mpir-2.1.3.p1.spkg**
> 
> **md5sum:** `0f13106ed6c8af933f93fa4a8981c453  mpir-2.1.3.p1.spkg`
> 
> I've uploaded a new p1 spkg that fixes the assembler error on Darwin PPC. [Attached patch](http://trac.sagemath.org/sage_trac/attachment/ticket/8664/trac_8664-mpir-2.1.3.p0-p1.spkg.patch) reflects changes between this and the previous one (p0). Use [this link](http://trac.sagemath.org/sage_trac/raw-attachment/ticket/8664/trac_8664-mpir-2.1.3.p0-p1.spkg.patch) to *download or apply* the patch.


This won't work just like this. Ineed: 

```
$ uname -m                  
Power Macintosh
$ uname -a                
Darwin cantor.local 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:57:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_PPC Power Macintosh
```

so it's not 'ppc', it's 'Power Macintosh' on OSX 10.5, apparently...



---

archive/issue_comments_091271.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-11-06T04:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91271",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_091272.json:
```json
{
    "body": "<a id='comment:57'></a>\nReplying to [leif](#comment%3A52):\n> Replying to [dimpase](#comment%3A50):\n> > Replying to [leif](#comment%3A49):\n> > > Replying to [leif](#comment%3A48):\n> > > > Would adding `-Wa,-force_cpusubtype_ALL` on MacOS PPCs work?\n\n> > > \n> > > \n> > > Even if this works for you, I'm not sure if MPIR only enables that code on CPUs that really support these instructions. Jeroen apparently has built this spkg on a MacOS X 10.4 PPC G5.\n\n> > \n> > yes, it at least builds without errors this way, on MacOSX 10.5 G4 PPC, with gcc 4.2.1 (Apple Inc. build 5577).\n> > Tell me what I should test. (I don't want to rerun the whole Sage testsuite, as it takes ages on this machine, and I use it otherwise too)\n\n> \n> Nice, thanks.\n> \n> Did you run MPIR's test suite (i.e., installed with `SAGE_CHECK=yes`)?\n\n\nI just re-run the installation of p0 with SAGE_CHECK=yes, and all the tests passed.\nSo I suppose it's very close, only that small config fix remains...\n\n\n> \n> I'll update the ECM package (#5847) with the upstream patch, then you could also test this.\n> \n> I don't know if you already broke your Sage installation by now having successfully installed the new MPIR, since we delete all older versions, which other parts of Sage will still try to use unless you also rebuild the dependent packages.\n> \n> You can of course always force the reinstallation of the old MPIR (and ECM) package with `sage -f ...`, then Sage will again work as before.\n\n\nThanks for the reminder, but I am quite familiar with sage -f, spkg-install,  etc etc... I am involved in maintaining of *gap*.spkg and cvxopt*.spkg...",
    "created_at": "2010-11-06T04:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91272",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:57'></a>
Replying to [leif](#comment%3A52):
> Replying to [dimpase](#comment%3A50):
> > Replying to [leif](#comment%3A49):
> > > Replying to [leif](#comment%3A48):
> > > > Would adding `-Wa,-force_cpusubtype_ALL` on MacOS PPCs work?

> > > 
> > > 
> > > Even if this works for you, I'm not sure if MPIR only enables that code on CPUs that really support these instructions. Jeroen apparently has built this spkg on a MacOS X 10.4 PPC G5.

> > 
> > yes, it at least builds without errors this way, on MacOSX 10.5 G4 PPC, with gcc 4.2.1 (Apple Inc. build 5577).
> > Tell me what I should test. (I don't want to rerun the whole Sage testsuite, as it takes ages on this machine, and I use it otherwise too)

> 
> Nice, thanks.
> 
> Did you run MPIR's test suite (i.e., installed with `SAGE_CHECK=yes`)?


I just re-run the installation of p0 with SAGE_CHECK=yes, and all the tests passed.
So I suppose it's very close, only that small config fix remains...


> 
> I'll update the ECM package (#5847) with the upstream patch, then you could also test this.
> 
> I don't know if you already broke your Sage installation by now having successfully installed the new MPIR, since we delete all older versions, which other parts of Sage will still try to use unless you also rebuild the dependent packages.
> 
> You can of course always force the reinstallation of the old MPIR (and ECM) package with `sage -f ...`, then Sage will again work as before.


Thanks for the reminder, but I am quite familiar with sage -f, spkg-install,  etc etc... I am involved in maintaining of *gap*.spkg and cvxopt*.spkg...



---

archive/issue_comments_091273.json:
```json
{
    "body": "<a id='comment:58'></a>\nReplying to [dimpase](#comment%3A56):\n> This won't work just like this. Ineed: \n\n{{{\n$ uname -m                  \nPower Macintosh\n$ uname -a                \nDarwin cantor.local 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:57:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_PPC Power Macintosh\n}}}\n> \n> so it's not 'ppc', it's 'Power Macintosh' on OSX 10.5, apparently...\n\n\nWTF? *Which* `uname`? Some Apple XXXX?\n\nI've never seen *any* `configure` or `config.guess` script testing for \"Power Macintosh\", since this is neither a CPU nor an architecture. (The space is nice, too.)\n\nI'll make a special case for your machine... ;-)\n\n[Ok, I've searched now and the only one I've found is Singular's. Some others test for `Power*`.]",
    "created_at": "2010-11-06T05:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91273",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:58'></a>
Replying to [dimpase](#comment%3A56):
> This won't work just like this. Ineed: 

{{{
$ uname -m                  
Power Macintosh
$ uname -a                
Darwin cantor.local 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:57:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_PPC Power Macintosh
}}}
> 
> so it's not 'ppc', it's 'Power Macintosh' on OSX 10.5, apparently...


WTF? *Which* `uname`? Some Apple XXXX?

I've never seen *any* `configure` or `config.guess` script testing for "Power Macintosh", since this is neither a CPU nor an architecture. (The space is nice, too.)

I'll make a special case for your machine... ;-)

[Ok, I've searched now and the only one I've found is Singular's. Some others test for `Power*`.]



---

archive/issue_comments_091274.json:
```json
{
    "body": "<a id='comment:59'></a>\nReplying to [dimpase](#comment%3A57):\n> Replying to [leif](#comment%3A52):\n> > I don't know if you already broke your Sage installation by now having successfully installed the new MPIR, since we delete all older versions, which other parts of Sage will still try to use unless you also rebuild the dependent packages.\n> > \n> > You can of course always force the reinstallation of the old MPIR (and ECM) package with `sage -f ...`, then Sage will again work as before.\n\n> \n> Thanks for the reminder, but I am quite familiar with sage -f, spkg-install,  etc etc... I am involved in maintaining of *gap*.spkg and cvxopt*.spkg...\n\n\n:-) Certainly, just ignore... (cf.[this nice comment](http://trac.sagemath.org/sage_trac/ticket/9921#comment:7))\n\nBut there are other people less familiar with this. (In fact this is a slightly modified copy of what I mailed someone else. I then became aware of not having it mentioned here at all.)",
    "created_at": "2010-11-06T05:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91274",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:59'></a>
Replying to [dimpase](#comment%3A57):
> Replying to [leif](#comment%3A52):
> > I don't know if you already broke your Sage installation by now having successfully installed the new MPIR, since we delete all older versions, which other parts of Sage will still try to use unless you also rebuild the dependent packages.
> > 
> > You can of course always force the reinstallation of the old MPIR (and ECM) package with `sage -f ...`, then Sage will again work as before.

> 
> Thanks for the reminder, but I am quite familiar with sage -f, spkg-install,  etc etc... I am involved in maintaining of *gap*.spkg and cvxopt*.spkg...


:-) Certainly, just ignore... (cf.[this nice comment](http://trac.sagemath.org/sage_trac/ticket/9921#comment:7))

But there are other people less familiar with this. (In fact this is a slightly modified copy of what I mailed someone else. I then became aware of not having it mentioned here at all.)



---

archive/issue_comments_091275.json:
```json
{
    "body": "<a id='comment:60'></a>\nReplying to [leif](#comment%3A58):\n\n\n> > so it's not 'ppc', it's 'Power Macintosh' on OSX 10.5, apparently...\n\n> \n> WTF? *Which* `uname`? Some Apple XXXX?\n\n\nWhat a Terrible Failure indeed:\n\n/usr/bin/uname\n\nThe choice  \"Power Macintosh\" is undoubtedly the result of an out of court settlement between IBM and Apple :-)",
    "created_at": "2010-11-06T05:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91275",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:60'></a>
Replying to [leif](#comment%3A58):


> > so it's not 'ppc', it's 'Power Macintosh' on OSX 10.5, apparently...

> 
> WTF? *Which* `uname`? Some Apple XXXX?


What a Terrible Failure indeed:

/usr/bin/uname

The choice  "Power Macintosh" is undoubtedly the result of an out of court settlement between IBM and Apple :-)



---

archive/issue_comments_091276.json:
```json
{
    "body": "<a id='comment:61'></a>\nReplying to [leif](#comment%3A53):\n> Replying to [leif](#comment%3A52):\n> > Replying to [dimpase](#comment%3A50):\n> > > Replying to [leif](#comment%3A49):\n> > > > Replying to [leif](#comment%3A48):\n> > > > > Would adding `-Wa,-force_cpusubtype_ALL` on MacOS PPCs work?\n\n> \n> P.S.: Does Apple's XCode `gcc` understand `-force_cpusubtype_ALL` (i.e., without `-Wa,`)?\n\n\nyes Apple's gcc 4.2.1 does. As well as gcc-4.0.1, which is probably more usual on OSX PPC...",
    "created_at": "2010-11-06T06:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91276",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:61'></a>
Replying to [leif](#comment%3A53):
> Replying to [leif](#comment%3A52):
> > Replying to [dimpase](#comment%3A50):
> > > Replying to [leif](#comment%3A49):
> > > > Replying to [leif](#comment%3A48):
> > > > > Would adding `-Wa,-force_cpusubtype_ALL` on MacOS PPCs work?

> 
> P.S.: Does Apple's XCode `gcc` understand `-force_cpusubtype_ALL` (i.e., without `-Wa,`)?


yes Apple's gcc 4.2.1 does. As well as gcc-4.0.1, which is probably more usual on OSX PPC...



---

archive/issue_comments_091277.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-11-06T06:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91277",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_091278.json:
```json
{
    "body": "<a id='comment:62'></a>\n**Updated p1 spkg: http://spkg-upload.googlecode.com/files/mpir-2.1.3.p1.spkg (same place)**\n\n**md5sum:** `08dfaa24301ba4e4481cfbbbc77156b3  mpir-2.1.3.p1.spkg`\n\nNow also recognizes PPCs giving \"`Power*`\" as `uname -m`.",
    "created_at": "2010-11-06T06:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91278",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:62'></a>
**Updated p1 spkg: http://spkg-upload.googlecode.com/files/mpir-2.1.3.p1.spkg (same place)**

**md5sum:** `08dfaa24301ba4e4481cfbbbc77156b3  mpir-2.1.3.p1.spkg`

Now also recognizes PPCs giving "`Power*`" as `uname -m`.



---

archive/issue_comments_091279.json:
```json
{
    "body": "<a id='comment:63'></a>\nReplying to [dimpase](#comment%3A60):\n> Replying to [leif](#comment%3A58):\n> \n> \n> > > so it's not 'ppc', it's 'Power Macintosh' on OSX 10.5, apparently...\n\n> > \n> > WTF? *Which* `uname`? Some Apple XXXX?\n\n> \n> What a Terrible Failure indeed:\n> \n> /usr/bin/uname\n\n\nWhat do `/bin/uname` and `/usr/local/bin/uname` give? \n\n(Consider installing GNU coreutils, and / or perhaps changing the `PATH`... ;-) )\n\nThere are other packages in Sage that won't recognize \"Power Macintosh\".\n\n\n> The choice  \"Power Macintosh\" is undoubtedly the result of an out of court settlement between IBM and Apple :-)\n\n\nWell, POWER<sup>TM</sup> is IBMs; the PowerPC was a later joint venture of Apple, IBM and Motorola.",
    "created_at": "2010-11-06T06:40:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91279",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:63'></a>
Replying to [dimpase](#comment%3A60):
> Replying to [leif](#comment%3A58):
> 
> 
> > > so it's not 'ppc', it's 'Power Macintosh' on OSX 10.5, apparently...

> > 
> > WTF? *Which* `uname`? Some Apple XXXX?

> 
> What a Terrible Failure indeed:
> 
> /usr/bin/uname


What do `/bin/uname` and `/usr/local/bin/uname` give? 

(Consider installing GNU coreutils, and / or perhaps changing the `PATH`... ;-) )

There are other packages in Sage that won't recognize "Power Macintosh".


> The choice  "Power Macintosh" is undoubtedly the result of an out of court settlement between IBM and Apple :-)


Well, POWER<sup>TM</sup> is IBMs; the PowerPC was a later joint venture of Apple, IBM and Motorola.



---

archive/issue_comments_091280.json:
```json
{
    "body": "Attachment [trac_8664-mpir-2.1.3.p0-p1.spkg.patch](tarball://root/attachments/some-uuid/ticket8664/trac_8664-mpir-2.1.3.p0-p1.spkg.patch) by @nexttime created at 2010-11-06 06:45:51\n\nSPKG patch. Apply to MPIR 2.1.3.p0 to get the p1. Fixes Darwin assembler error, corrects hint; some improvements.",
    "created_at": "2010-11-06T06:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91280",
    "user": "https://github.com/nexttime"
}
```

Attachment [trac_8664-mpir-2.1.3.p0-p1.spkg.patch](tarball://root/attachments/some-uuid/ticket8664/trac_8664-mpir-2.1.3.p0-p1.spkg.patch) by @nexttime created at 2010-11-06 06:45:51

SPKG patch. Apply to MPIR 2.1.3.p0 to get the p1. Fixes Darwin assembler error, corrects hint; some improvements.



---

archive/issue_comments_091281.json:
```json
{
    "body": "Changing reviewer from \"Leif Leonhardy\" to \"Leif Leonhardy, Dmitrii Pasechnik\"",
    "created_at": "2010-11-06T07:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91281",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "Leif Leonhardy" to "Leif Leonhardy, Dmitrii Pasechnik"



---

archive/issue_comments_091282.json:
```json
{
    "body": "<a id='comment:64'></a>\nReplying to [leif](#comment%3A63):\n> Replying to [dimpase](#comment%3A60):\n> > Replying to [leif](#comment%3A58):\n> > \n> > \n> > > > so it's not 'ppc', it's 'Power Macintosh' on OSX 10.5, apparently...\n\n> > > \n> > > WTF? *Which* `uname`? Some Apple XXXX?\n\n> > \n> > What a Terrible Failure indeed:\n> > \n> > /usr/bin/uname\n\n> \n> What do `/bin/uname` and `/usr/local/bin/uname` give? \n> \n> (Consider installing GNU coreutils, and / or perhaps changing the `PATH`... ;-) )\n\n\nGNU's uname says:\n\n```\n$ /usr/local/bin/uname -m\nPower Macintosh\n$ /usr/local/bin/uname -a\nDarwin cantor.local 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:57:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_PPC Power Macintosh powerpc PowerBook5,5 Darwin\n```\n\n> \n> There are other packages in Sage that won't recognize \"Power Macintosh\".\n> \n> \n> > The choice  \"Power Macintosh\" is undoubtedly the result of an out of court settlement between IBM and Apple :-)\n\n> \n> Well, POWER<sup>TM</sup> is IBMs; the PowerPC was a later joint venture of Apple, IBM and Motorola.",
    "created_at": "2010-11-06T07:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91282",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:64'></a>
Replying to [leif](#comment%3A63):
> Replying to [dimpase](#comment%3A60):
> > Replying to [leif](#comment%3A58):
> > 
> > 
> > > > so it's not 'ppc', it's 'Power Macintosh' on OSX 10.5, apparently...

> > > 
> > > WTF? *Which* `uname`? Some Apple XXXX?

> > 
> > What a Terrible Failure indeed:
> > 
> > /usr/bin/uname

> 
> What do `/bin/uname` and `/usr/local/bin/uname` give? 
> 
> (Consider installing GNU coreutils, and / or perhaps changing the `PATH`... ;-) )


GNU's uname says:

```
$ /usr/local/bin/uname -m
Power Macintosh
$ /usr/local/bin/uname -a
Darwin cantor.local 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:57:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_PPC Power Macintosh powerpc PowerBook5,5 Darwin
```

> 
> There are other packages in Sage that won't recognize "Power Macintosh".
> 
> 
> > The choice  "Power Macintosh" is undoubtedly the result of an out of court settlement between IBM and Apple :-)

> 
> Well, POWER<sup>TM</sup> is IBMs; the PowerPC was a later joint venture of Apple, IBM and Motorola.



---

archive/issue_comments_091283.json:
```json
{
    "body": "<a id='comment:65'></a>\nReplying to [dimpase](#comment%3A64):\n> GNU's uname says:\n\n{{{\n$ /usr/local/bin/uname -m\nPower Macintosh\n$ /usr/local/bin/uname -a\nDarwin cantor.local 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:57:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_PPC Power Macintosh powerpc PowerBook5,5 Darwin\n}}}\n\nReport upstream... ;-)\n\nI should have added `[Pp]ower*` :/",
    "created_at": "2010-11-06T07:28:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91283",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:65'></a>
Replying to [dimpase](#comment%3A64):
> GNU's uname says:

{{{
$ /usr/local/bin/uname -m
Power Macintosh
$ /usr/local/bin/uname -a
Darwin cantor.local 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:57:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_PPC Power Macintosh powerpc PowerBook5,5 Darwin
}}}

Report upstream... ;-)

I should have added `[Pp]ower*` :/



---

archive/issue_comments_091284.json:
```json
{
    "body": "<a id='comment:66'></a>\np1 builds and passes all tests on OSX 10.5 PPC (G4), with gcc-4.2.1.\nExcept that somewhere in the log I see:\n\n```\n...\nmake[4]: Entering directory `/usr/local/src/sage/sage-4.6/spkg/build/mpir-2.1.3.p1/src/tests/cxx'\n...\nPASS: t-istream\nReplacing decimal point didn't work, tests skipped\nPASS: t-locale\n...\n }}}\nThis does not happen on Debian x64.\nProbably a harmless (for Sage) C++-specific issue. Can this be ignored?",
    "created_at": "2010-11-06T07:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91284",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:66'></a>
p1 builds and passes all tests on OSX 10.5 PPC (G4), with gcc-4.2.1.
Except that somewhere in the log I see:

```
...
make[4]: Entering directory `/usr/local/src/sage/sage-4.6/spkg/build/mpir-2.1.3.p1/src/tests/cxx'
...
PASS: t-istream
Replacing decimal point didn't work, tests skipped
PASS: t-locale
...
 }}}
This does not happen on Debian x64.
Probably a harmless (for Sage) C++-specific issue. Can this be ignored?



---

archive/issue_comments_091285.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2010-11-06T07:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91285",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_091286.json:
```json
{
    "body": "<a id='comment:67'></a>\nhowever, Sage does not start on OSX 10.5 PPC: I get \n\n```\n$ ./sage -b\n...\ng++ -o libcsage.dylib -single_module -flat_namespace -undefined dynamic_lookup -dynamiclib src/convert.os src/interrupt.os src/mpn_pylong.os src/mpz_pylong.os src/mpz_longlong.os src/stdsage.os src/gmp_globals.os src/ZZ_pylong.os src/ntl_wrap.os -L/usr/local/src/sage/sage-4.6/local/lib -L/usr/local/src/sage/sage-4.6/local/lib/python/config -lntl -lgmp -lpari -lpython2.6\nld: file not found: /usr/local/src/sage/sage-4.6/local/lib/libgmp.3.dylib\ncollect2: ld returned 1 exit status\nscons: *** [libcsage.dylib] Error 1\nERROR: There was an error building c_lib.\n```\nI don't know whether this is a result of this spkg upgrade, or something else was broken even before. I'll see.",
    "created_at": "2010-11-06T07:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91286",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:67'></a>
however, Sage does not start on OSX 10.5 PPC: I get 

```
$ ./sage -b
...
g++ -o libcsage.dylib -single_module -flat_namespace -undefined dynamic_lookup -dynamiclib src/convert.os src/interrupt.os src/mpn_pylong.os src/mpz_pylong.os src/mpz_longlong.os src/stdsage.os src/gmp_globals.os src/ZZ_pylong.os src/ntl_wrap.os -L/usr/local/src/sage/sage-4.6/local/lib -L/usr/local/src/sage/sage-4.6/local/lib/python/config -lntl -lgmp -lpari -lpython2.6
ld: file not found: /usr/local/src/sage/sage-4.6/local/lib/libgmp.3.dylib
collect2: ld returned 1 exit status
scons: *** [libcsage.dylib] Error 1
ERROR: There was an error building c_lib.
```
I don't know whether this is a result of this spkg upgrade, or something else was broken even before. I'll see.



---

archive/issue_comments_091287.json:
```json
{
    "body": "<a id='comment:68'></a>\nReplying to [dimpase](#comment%3A67):\n> however, Sage does not start on OSX 10.5 PPC: I get \n\n{{{\n$ ./sage -b\n...\ng++ -o libcsage.dylib -single_module -flat_namespace -undefined dynamic_lookup -dynamiclib src/convert.os src/interrupt.os src/mpn_pylong.os src/mpz_pylong.os src/mpz_longlong.os src/stdsage.os src/gmp_globals.os src/ZZ_pylong.os src/ntl_wrap.os -L/usr/local/src/sage/sage-4.6/local/lib -L/usr/local/src/sage/sage-4.6/local/lib/python/config -lntl -lgmp -lpari -lpython2.6\nld: file not found: /usr/local/src/sage/sage-4.6/local/lib/libgmp.3.dylib\ncollect2: ld returned 1 exit status\nscons: *** [libcsage.dylib] Error 1\nERROR: There was an error building c_lib.\n}}}\n> I don't know whether this is a result of this spkg upgrade, or something else was broken even before. I'll see.\n\n\nDid you rebuild all dependent packages, i.e. use `SAGE_UPGRADING=yes`?\n\nWhat MPIR versions do you have in `local/lib/`?\n\n---\n\nI guess the locale issue is a minor thing (hopefully). Perhaps Bill knows better.\n\n(I almost always build with `LC_ALL=C`.)",
    "created_at": "2010-11-06T08:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91287",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:68'></a>
Replying to [dimpase](#comment%3A67):
> however, Sage does not start on OSX 10.5 PPC: I get 

{{{
$ ./sage -b
...
g++ -o libcsage.dylib -single_module -flat_namespace -undefined dynamic_lookup -dynamiclib src/convert.os src/interrupt.os src/mpn_pylong.os src/mpz_pylong.os src/mpz_longlong.os src/stdsage.os src/gmp_globals.os src/ZZ_pylong.os src/ntl_wrap.os -L/usr/local/src/sage/sage-4.6/local/lib -L/usr/local/src/sage/sage-4.6/local/lib/python/config -lntl -lgmp -lpari -lpython2.6
ld: file not found: /usr/local/src/sage/sage-4.6/local/lib/libgmp.3.dylib
collect2: ld returned 1 exit status
scons: *** [libcsage.dylib] Error 1
ERROR: There was an error building c_lib.
}}}
> I don't know whether this is a result of this spkg upgrade, or something else was broken even before. I'll see.


Did you rebuild all dependent packages, i.e. use `SAGE_UPGRADING=yes`?

What MPIR versions do you have in `local/lib/`?

---

I guess the locale issue is a minor thing (hopefully). Perhaps Bill knows better.

(I almost always build with `LC_ALL=C`.)



---

archive/issue_comments_091288.json:
```json
{
    "body": "<a id='comment:69'></a>\nP.S.: Could you attach the full MPIR build log, or its `make install` part?",
    "created_at": "2010-11-06T09:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91288",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:69'></a>
P.S.: Could you attach the full MPIR build log, or its `make install` part?



---

archive/issue_comments_091289.json:
```json
{
    "body": "<a id='comment:70'></a>\nReplying to [leif](#comment%3A68):\n\n\n> Did you rebuild all dependent packages, i.e. use `SAGE_UPGRADING=yes`?\n\n\nI tried\n\n```\n$ SAGE_UPGRADING=yes ../../sage -f mpir-2.1.3.p1.spkg\n$ ../../sage -b\n```\nwith the same outcome. \nInstalling the version 1.* mpir spkg cures the installation, i.e. I get a working copy of Sage back.\n\n> \n> What MPIR versions do you have in `local/lib/`?\n\n\nhere are mpirs and gmps I have:\n \n```\n-rwxr-xr-x  1 dima  wheel   500140 Nov  6 18:48 ../../local/lib/libmpir.8.2.3.dylib\nlrwxr-xr-x  1 dima  wheel       19 Nov  6 18:48 ../../local/lib/libmpir.8.dylib -> libmpir.8.2.3.dylib\n-rw-r--r--  1 dima  wheel  2487088 Nov  6 18:48 ../../local/lib/libmpir.a\nlrwxr-xr-x  1 dima  wheel       19 Nov  6 18:48 ../../local/lib/libmpir.dylib -> libmpir.8.2.3.dylib\n-rwxr-xr-x  1 dima  wheel      829 Nov  6 18:48 ../../local/lib/libmpir.la\n-rwxr-xr-x  1 dima  wheel    25592 Nov  6 18:48 ../../local/lib/libmpirxx.2.2.11.dylib\nlrwxr-xr-x  1 dima  wheel       22 Nov  6 18:48 ../../local/lib/libmpirxx.2.dylib -> libmpirxx.2.2.11.dylib\n-rw-r--r--  1 dima  wheel   699424 Nov  6 18:48 ../../local/lib/libmpirxx.a\nlrwxr-xr-x  1 dima  wheel       22 Nov  6 18:48 ../../local/lib/libmpirxx.dylib -> libmpirxx.2.2.11.dylib\n-rwxr-xr-x  1 dima  wheel      894 Nov  6 18:48 ../../local/lib/libmpirxx.la\n\n-rwxr-xr-x  1 dima  wheel   500140 Nov  6 18:48 ../../local/lib/libgmp.8.2.3.dylib\nlrwxr-xr-x  1 dima  wheel       18 Nov  6 18:48 ../../local/lib/libgmp.8.dylib -> libgmp.8.2.3.dylib\n-rw-r--r--  1 dima  wheel  2487088 Nov  6 18:48 ../../local/lib/libgmp.a\nlrwxr-xr-x  1 dima  wheel       18 Nov  6 18:48 ../../local/lib/libgmp.dylib -> libgmp.8.2.3.dylib\n-rwxr-xr-x  1 dima  wheel      822 Nov  6 18:48 ../../local/lib/libgmp.la\n-rwxr-xr-x  1 dima  wheel    25592 Nov  6 18:48 ../../local/lib/libgmpxx.2.2.11.dylib\nlrwxr-xr-x  1 dima  wheel       21 Nov  6 18:48 ../../local/lib/libgmpxx.2.dylib -> libgmpxx.2.2.11.dylib\n-rw-r--r--  1 dima  wheel   699424 Nov  6 18:48 ../../local/lib/libgmpxx.a\nlrwxr-xr-x  1 dima  wheel       21 Nov  6 18:48 ../../local/lib/libgmpxx.dylib -> libgmpxx.2.2.11.dylib\n-rwxr-xr-x  1 dima  wheel      886 Nov  6 18:48 ../../local/lib/libgmpxx.la\n```\n\nI'm  trying the following:\n\n```\n$ cd local/lib\n$ ln -s libgmp.dylib libgmp.3.dylib\n$ ../../sage -b \n```\nand this seems to work (triggering a large recompile of extensions that still is running)",
    "created_at": "2010-11-06T11:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91289",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:70'></a>
Replying to [leif](#comment%3A68):


> Did you rebuild all dependent packages, i.e. use `SAGE_UPGRADING=yes`?


I tried

```
$ SAGE_UPGRADING=yes ../../sage -f mpir-2.1.3.p1.spkg
$ ../../sage -b
```
with the same outcome. 
Installing the version 1.* mpir spkg cures the installation, i.e. I get a working copy of Sage back.

> 
> What MPIR versions do you have in `local/lib/`?


here are mpirs and gmps I have:
 
```
-rwxr-xr-x  1 dima  wheel   500140 Nov  6 18:48 ../../local/lib/libmpir.8.2.3.dylib
lrwxr-xr-x  1 dima  wheel       19 Nov  6 18:48 ../../local/lib/libmpir.8.dylib -> libmpir.8.2.3.dylib
-rw-r--r--  1 dima  wheel  2487088 Nov  6 18:48 ../../local/lib/libmpir.a
lrwxr-xr-x  1 dima  wheel       19 Nov  6 18:48 ../../local/lib/libmpir.dylib -> libmpir.8.2.3.dylib
-rwxr-xr-x  1 dima  wheel      829 Nov  6 18:48 ../../local/lib/libmpir.la
-rwxr-xr-x  1 dima  wheel    25592 Nov  6 18:48 ../../local/lib/libmpirxx.2.2.11.dylib
lrwxr-xr-x  1 dima  wheel       22 Nov  6 18:48 ../../local/lib/libmpirxx.2.dylib -> libmpirxx.2.2.11.dylib
-rw-r--r--  1 dima  wheel   699424 Nov  6 18:48 ../../local/lib/libmpirxx.a
lrwxr-xr-x  1 dima  wheel       22 Nov  6 18:48 ../../local/lib/libmpirxx.dylib -> libmpirxx.2.2.11.dylib
-rwxr-xr-x  1 dima  wheel      894 Nov  6 18:48 ../../local/lib/libmpirxx.la

-rwxr-xr-x  1 dima  wheel   500140 Nov  6 18:48 ../../local/lib/libgmp.8.2.3.dylib
lrwxr-xr-x  1 dima  wheel       18 Nov  6 18:48 ../../local/lib/libgmp.8.dylib -> libgmp.8.2.3.dylib
-rw-r--r--  1 dima  wheel  2487088 Nov  6 18:48 ../../local/lib/libgmp.a
lrwxr-xr-x  1 dima  wheel       18 Nov  6 18:48 ../../local/lib/libgmp.dylib -> libgmp.8.2.3.dylib
-rwxr-xr-x  1 dima  wheel      822 Nov  6 18:48 ../../local/lib/libgmp.la
-rwxr-xr-x  1 dima  wheel    25592 Nov  6 18:48 ../../local/lib/libgmpxx.2.2.11.dylib
lrwxr-xr-x  1 dima  wheel       21 Nov  6 18:48 ../../local/lib/libgmpxx.2.dylib -> libgmpxx.2.2.11.dylib
-rw-r--r--  1 dima  wheel   699424 Nov  6 18:48 ../../local/lib/libgmpxx.a
lrwxr-xr-x  1 dima  wheel       21 Nov  6 18:48 ../../local/lib/libgmpxx.dylib -> libgmpxx.2.2.11.dylib
-rwxr-xr-x  1 dima  wheel      886 Nov  6 18:48 ../../local/lib/libgmpxx.la
```

I'm  trying the following:

```
$ cd local/lib
$ ln -s libgmp.dylib libgmp.3.dylib
$ ../../sage -b 
```
and this seems to work (triggering a large recompile of extensions that still is running)



---

archive/issue_comments_091290.json:
```json
{
    "body": "<a id='comment:71'></a>\nReplying to [dimpase](#comment%3A70):\n> Replying to [leif](#comment%3A68):\n> > Did you rebuild all dependent packages, i.e. use `SAGE_UPGRADING=yes`? \n\n> I tried\n\n```\n$ SAGE_UPGRADING=yes ../../sage -f mpir-2.1.3.p1.spkg\n$ ../../sage -b\n```\n> with the same outcome.\n\n\n`SAGE_UPGRADING=yes` only works with `make`, not `sage -i ...` etc. (and only if all [new] spkgs are in `spkg/standard/`).\n\n\n\n\n\n> Installing the version 1.* mpir spkg cures the installation, i.e. I get a working copy of Sage back.\n\n\nYep.\n\n\n\n\n> > What MPIR versions do you have in `local/lib/`?\n\n> \n> here are mpirs and gmps I have:\n\n{{{\n-rwxr-xr-x  1 dima  wheel   500140 Nov  6 18:48 ../../local/lib/libmpir.8.2.3.dylib\nlrwxr-xr-x  1 dima  wheel       19 Nov  6 18:48 ../../local/lib/libmpir.8.dylib -> libmpir.8.2.3.dylib\n-rw-r--r--  1 dima  wheel  2487088 Nov  6 18:48 ../../local/lib/libmpir.a\nlrwxr-xr-x  1 dima  wheel       19 Nov  6 18:48 ../../local/lib/libmpir.dylib -> libmpir.8.2.3.dylib\n-rwxr-xr-x  1 dima  wheel      829 Nov  6 18:48 ../../local/lib/libmpir.la\n-rwxr-xr-x  1 dima  wheel    25592 Nov  6 18:48 ../../local/lib/libmpirxx.2.2.11.dylib\nlrwxr-xr-x  1 dima  wheel       22 Nov  6 18:48 ../../local/lib/libmpirxx.2.dylib -> libmpirxx.2.2.11.dylib\n-rw-r--r--  1 dima  wheel   699424 Nov  6 18:48 ../../local/lib/libmpirxx.a\nlrwxr-xr-x  1 dima  wheel       22 Nov  6 18:48 ../../local/lib/libmpirxx.dylib -> libmpirxx.2.2.11.dylib\n-rwxr-xr-x  1 dima  wheel      894 Nov  6 18:48 ../../local/lib/libmpirxx.la\n...\n}}}\nThese are the correct new ones, same basenames as on other systems. (Note that the version number of `libgmpxx*` is now *smaller* than in MPIR 1.2.2, which was `3[.1.6]`.)\n\n\n\n\n \n> I'm  trying the following:\n\n{{{\n$ cd local/lib\n$ ln -s libgmp.dylib libgmp.3.dylib\n$ ../../sage -b \n}}}\n> and this seems to work (triggering a large recompile of extensions that still is running)\n\n\nSo the patch to the Sage library apparently works for you. :)\n\n---\n\nThe `libcsage` linker error occurs because some other library (NTL or PARI) still refers to the old MPIR library, i.e. hasn't been rebuilt.\n\nCan you check the modification times of `spkg/installed/*` (e.g. `ls -rtl spkg/installed`)?\n(Or just `ls -1rt local/lib/lib{gmp,ntl,pari}*`; all PARI and NTL libraries should be *below* MPIR's.)",
    "created_at": "2010-11-06T16:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91290",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:71'></a>
Replying to [dimpase](#comment%3A70):
> Replying to [leif](#comment%3A68):
> > Did you rebuild all dependent packages, i.e. use `SAGE_UPGRADING=yes`? 

> I tried

```
$ SAGE_UPGRADING=yes ../../sage -f mpir-2.1.3.p1.spkg
$ ../../sage -b
```
> with the same outcome.


`SAGE_UPGRADING=yes` only works with `make`, not `sage -i ...` etc. (and only if all [new] spkgs are in `spkg/standard/`).





> Installing the version 1.* mpir spkg cures the installation, i.e. I get a working copy of Sage back.


Yep.




> > What MPIR versions do you have in `local/lib/`?

> 
> here are mpirs and gmps I have:

{{{
-rwxr-xr-x  1 dima  wheel   500140 Nov  6 18:48 ../../local/lib/libmpir.8.2.3.dylib
lrwxr-xr-x  1 dima  wheel       19 Nov  6 18:48 ../../local/lib/libmpir.8.dylib -> libmpir.8.2.3.dylib
-rw-r--r--  1 dima  wheel  2487088 Nov  6 18:48 ../../local/lib/libmpir.a
lrwxr-xr-x  1 dima  wheel       19 Nov  6 18:48 ../../local/lib/libmpir.dylib -> libmpir.8.2.3.dylib
-rwxr-xr-x  1 dima  wheel      829 Nov  6 18:48 ../../local/lib/libmpir.la
-rwxr-xr-x  1 dima  wheel    25592 Nov  6 18:48 ../../local/lib/libmpirxx.2.2.11.dylib
lrwxr-xr-x  1 dima  wheel       22 Nov  6 18:48 ../../local/lib/libmpirxx.2.dylib -> libmpirxx.2.2.11.dylib
-rw-r--r--  1 dima  wheel   699424 Nov  6 18:48 ../../local/lib/libmpirxx.a
lrwxr-xr-x  1 dima  wheel       22 Nov  6 18:48 ../../local/lib/libmpirxx.dylib -> libmpirxx.2.2.11.dylib
-rwxr-xr-x  1 dima  wheel      894 Nov  6 18:48 ../../local/lib/libmpirxx.la
...
}}}
These are the correct new ones, same basenames as on other systems. (Note that the version number of `libgmpxx*` is now *smaller* than in MPIR 1.2.2, which was `3[.1.6]`.)




 
> I'm  trying the following:

{{{
$ cd local/lib
$ ln -s libgmp.dylib libgmp.3.dylib
$ ../../sage -b 
}}}
> and this seems to work (triggering a large recompile of extensions that still is running)


So the patch to the Sage library apparently works for you. :)

---

The `libcsage` linker error occurs because some other library (NTL or PARI) still refers to the old MPIR library, i.e. hasn't been rebuilt.

Can you check the modification times of `spkg/installed/*` (e.g. `ls -rtl spkg/installed`)?
(Or just `ls -1rt local/lib/lib{gmp,ntl,pari}*`; all PARI and NTL libraries should be *below* MPIR's.)



---

archive/issue_comments_091291.json:
```json
{
    "body": "<a id='comment:72'></a>\nReplying to [leif](#comment%3A71):\n\n> The `libcsage` linker error occurs because some other library (NTL or PARI) still refers to the old MPIR library, i.e. hasn't been rebuilt.\n> \n> Can you check the modification times of `spkg/installed/*` (e.g. `ls -rtl spkg/installed`)?\n> (Or just `ls -1rt local/lib/lib{gmp,ntl,pari}*`; all PARI and NTL libraries should be *below* MPIR's.)\n\n\nIs ecm-6.2.1 compatible with  mpir 2.1.3?\nJust wondering.\n\nI'm going to rebuild Sage from scratch and with mpir 2.1.3.\nIt will take a night, but it's already pretty later over here.",
    "created_at": "2010-11-06T17:01:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91291",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:72'></a>
Replying to [leif](#comment%3A71):

> The `libcsage` linker error occurs because some other library (NTL or PARI) still refers to the old MPIR library, i.e. hasn't been rebuilt.
> 
> Can you check the modification times of `spkg/installed/*` (e.g. `ls -rtl spkg/installed`)?
> (Or just `ls -1rt local/lib/lib{gmp,ntl,pari}*`; all PARI and NTL libraries should be *below* MPIR's.)


Is ecm-6.2.1 compatible with  mpir 2.1.3?
Just wondering.

I'm going to rebuild Sage from scratch and with mpir 2.1.3.
It will take a night, but it's already pretty later over here.



---

archive/issue_comments_091292.json:
```json
{
    "body": "<a id='comment:73'></a>\nReplying to [dimpase](#comment%3A72):\n> Replying to [leif](#comment%3A71):\n> \n> > The `libcsage` linker error occurs because some other library (NTL or PARI) still refers to the old MPIR library, i.e. hasn't been rebuilt.\n> > \n> > Can you check the modification times of `spkg/installed/*` (e.g. `ls -rtl spkg/installed`)?\n> > (Or just `ls -1rt local/lib/lib{gmp,ntl,pari}*`; all PARI and NTL libraries should be *below* MPIR's.)\n\n> \n> Is ecm-6.2.1 compatible with  mpir 2.1.3?\n\n\nRather not. (See #5847.)\n\n\n> I'm going to rebuild Sage from scratch and with mpir 2.1.3.\n> It will take a night, but it's already pretty later over here.\n\n\nYou could try faking ecm-6.3.p0.spkg (or the old one if you haven't copied the new spkg) was already installed, then at least the build should pass.",
    "created_at": "2010-11-06T17:54:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91292",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:73'></a>
Replying to [dimpase](#comment%3A72):
> Replying to [leif](#comment%3A71):
> 
> > The `libcsage` linker error occurs because some other library (NTL or PARI) still refers to the old MPIR library, i.e. hasn't been rebuilt.
> > 
> > Can you check the modification times of `spkg/installed/*` (e.g. `ls -rtl spkg/installed`)?
> > (Or just `ls -1rt local/lib/lib{gmp,ntl,pari}*`; all PARI and NTL libraries should be *below* MPIR's.)

> 
> Is ecm-6.2.1 compatible with  mpir 2.1.3?


Rather not. (See #5847.)


> I'm going to rebuild Sage from scratch and with mpir 2.1.3.
> It will take a night, but it's already pretty later over here.


You could try faking ecm-6.3.p0.spkg (or the old one if you haven't copied the new spkg) was already installed, then at least the build should pass.



---

archive/issue_comments_091293.json:
```json
{
    "body": "<a id='comment:74'></a>\nI asked Bill by email about Leif's comments above.  Please see [mpir-devel](http://groups.google.com/group/mpir-devel/browse_thread/thread/892ce7f3c9c93b9f).",
    "created_at": "2010-11-06T20:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91293",
    "user": "https://github.com/qed777"
}
```

<a id='comment:74'></a>
I asked Bill by email about Leif's comments above.  Please see [mpir-devel](http://groups.google.com/group/mpir-devel/browse_thread/thread/892ce7f3c9c93b9f).



---

archive/issue_comments_091294.json:
```json
{
    "body": "<a id='comment:75'></a>\nReplying to [mpatel](#comment%3A74):\n> I asked Bill by email about Leif's comments above.  Please see [mpir-devel](http://groups.google.com/group/mpir-devel/browse_thread/thread/892ce7f3c9c93b9f).\n\n\nI tried a vanilla build from the source, i.e. untarred the spkg, then\n\n```\n$ cd src/\n$ ./configure\n$ make\n```\nand it just works, picking up the flag -force_cpusubtype_ALL without any help.",
    "created_at": "2010-11-07T04:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91294",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:75'></a>
Replying to [mpatel](#comment%3A74):
> I asked Bill by email about Leif's comments above.  Please see [mpir-devel](http://groups.google.com/group/mpir-devel/browse_thread/thread/892ce7f3c9c93b9f).


I tried a vanilla build from the source, i.e. untarred the spkg, then

```
$ cd src/
$ ./configure
$ make
```
and it just works, picking up the flag -force_cpusubtype_ALL without any help.



---

archive/issue_comments_091295.json:
```json
{
    "body": "<a id='comment:76'></a>\nReplying to [dimpase](#comment%3A72):\n> Replying to [leif](#comment%3A71):\n> \n> > The `libcsage` linker error occurs because some other library (NTL or PARI) still refers to the old MPIR library, i.e. hasn't been rebuilt.\n> > \n> > Can you check the modification times of `spkg/installed/*` (e.g. `ls -rtl spkg/installed`)?\n> > (Or just `ls -1rt local/lib/lib{gmp,ntl,pari}*`; all PARI and NTL libraries should be *below* MPIR's.)\n\n> \n> Is ecm-6.2.1 compatible with  mpir 2.1.3?\n> Just wondering.\n> \n> I'm going to rebuild Sage from scratch and with mpir 2.1.3.\n> It will take a night, but it's already pretty later over here.\n> \n\n\nrebuilt Sage 4.6 from scratch with p1 spk of this ticket, the Sage library patch of this ticket applied to sage spkg, and with tweaked ECM spkg (see the ECM ticket). All works, as well as passes testlong (>12 hours on this machine).\n\nDima\n\nIt all worked, as well as all",
    "created_at": "2010-11-09T05:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91295",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:76'></a>
Replying to [dimpase](#comment%3A72):
> Replying to [leif](#comment%3A71):
> 
> > The `libcsage` linker error occurs because some other library (NTL or PARI) still refers to the old MPIR library, i.e. hasn't been rebuilt.
> > 
> > Can you check the modification times of `spkg/installed/*` (e.g. `ls -rtl spkg/installed`)?
> > (Or just `ls -1rt local/lib/lib{gmp,ntl,pari}*`; all PARI and NTL libraries should be *below* MPIR's.)

> 
> Is ecm-6.2.1 compatible with  mpir 2.1.3?
> Just wondering.
> 
> I'm going to rebuild Sage from scratch and with mpir 2.1.3.
> It will take a night, but it's already pretty later over here.
> 


rebuilt Sage 4.6 from scratch with p1 spk of this ticket, the Sage library patch of this ticket applied to sage spkg, and with tweaked ECM spkg (see the ECM ticket). All works, as well as passes testlong (>12 hours on this machine).

Dima

It all worked, as well as all



---

archive/issue_comments_091296.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2010-11-09T05:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91296",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_091297.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-11-09T05:08:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91297",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_091298.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -41,11 +41,10 @@\n \n ---\n \n-New spkg: [http://spkg-upload.googlecode.com/files/mpir-2.1.3.p0.spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p0.spkg)\n+New spkg: [http://spkg-upload.googlecode.com/files/mpir-2.1.3.p1.spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p1.spkg)\n \n Testing distribution (including #5847):\n [http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar](http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar)\n-\n \n ---\n \n``````\n",
    "created_at": "2010-11-09T08:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91298",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -41,11 +41,10 @@
 
 ---
 
-New spkg: [http://spkg-upload.googlecode.com/files/mpir-2.1.3.p0.spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p0.spkg)
+New spkg: [http://spkg-upload.googlecode.com/files/mpir-2.1.3.p1.spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p1.spkg)
 
 Testing distribution (including #5847):
 [http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar](http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar)
-
 
 ---
 
``````




---

archive/issue_comments_091299.json:
```json
{
    "body": "<a id='comment:79'></a>\nReplying to [dimpase](#comment%3A76):\n> and with tweaked ECM spkg (see #5847).\n\n\nWhich \"tweaked\" ECM spkg do you mean?",
    "created_at": "2010-11-09T08:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91299",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:79'></a>
Replying to [dimpase](#comment%3A76):
> and with tweaked ECM spkg (see #5847).


Which "tweaked" ECM spkg do you mean?



---

archive/issue_comments_091300.json:
```json
{
    "body": "<a id='comment:80'></a>\nReplying to [jdemeyer](#comment%3A79):\n> Replying to [dimpase](#comment%3A76):\n> > and with tweaked ECM spkg (see #5847).\n\n> \n> Which \"tweaked\" ECM spkg do you mean?\n\n\nThe one I made from the spkg on the ticket that 1) avoids the linker crash by supplying a longer assembler program in configure 2) runs ./configure --disable-asm-redc in spkg-install.\n\nI did not yet try the configure patch suggested by Paul:\n\n```\nin fact this bug is already fixed upstream (in revision 1516), see\n  https://gforge.inria.fr/tracker/index.php func=detail&aid=10646&group_id=135&atid=623\n```",
    "created_at": "2010-11-09T09:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91300",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:80'></a>
Replying to [jdemeyer](#comment%3A79):
> Replying to [dimpase](#comment%3A76):
> > and with tweaked ECM spkg (see #5847).

> 
> Which "tweaked" ECM spkg do you mean?


The one I made from the spkg on the ticket that 1) avoids the linker crash by supplying a longer assembler program in configure 2) runs ./configure --disable-asm-redc in spkg-install.

I did not yet try the configure patch suggested by Paul:

```
in fact this bug is already fixed upstream (in revision 1516), see
  https://gforge.inria.fr/tracker/index.php func=detail&aid=10646&group_id=135&atid=623
```



---

archive/issue_events_033520.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-11T13:02:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33520"
}
```



---

archive/issue_comments_091301.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.6.1.alpha1\"",
    "created_at": "2010-11-11T13:02:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91301",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-4.6.1.alpha1"



---

archive/issue_comments_091302.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-11-11T13:02:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91302",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_091303.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2010-11-12T13:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91303",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from closed to new.



---

archive/issue_events_033521.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-12T13:07:10Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33521"
}
```



---

archive/issue_comments_091304.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2010-11-12T13:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91304",
    "user": "https://github.com/jdemeyer"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_091305.json:
```json
{
    "body": "Changing merged from \"sage-4.6.1.alpha1\" to \"\"",
    "created_at": "2010-11-12T13:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91305",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "sage-4.6.1.alpha1" to ""



---

archive/issue_comments_091306.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-11-12T13:07:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91306",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_091307.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-11-12T13:07:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91307",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_091308.json:
```json
{
    "body": "<a id='comment:85'></a>\nUnmerged from sage-4.6.1.alpha1 because of the problems with the ECM package, see #10252.",
    "created_at": "2010-11-12T13:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91308",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:85'></a>
Unmerged from sage-4.6.1.alpha1 because of the problems with the ECM package, see #10252.



---

archive/issue_events_033522.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-20T10:06:09Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "milestone": "sage-4.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33522"
}
```



---

archive/issue_events_033523.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-20T10:06:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "milestone": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33523"
}
```



---

archive/issue_comments_091309.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -44,7 +44,7 @@\n New spkg: [http://spkg-upload.googlecode.com/files/mpir-2.1.3.p1.spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p1.spkg)\n \n Testing distribution (including #5847):\n-[http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar](http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar)\n+[http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha2-mpir/sage-4.6.1.alpha2-mpir.tar](http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha2-mpir/sage-4.6.1.alpha2-mpir.tar)\n \n ---\n \n``````\n",
    "created_at": "2010-11-26T08:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91309",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -44,7 +44,7 @@
 New spkg: [http://spkg-upload.googlecode.com/files/mpir-2.1.3.p1.spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p1.spkg)
 
 Testing distribution (including #5847):
-[http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar](http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha0-mpir/sage-4.6.1.alpha0-mpir.tar)
+[http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha2-mpir/sage-4.6.1.alpha2-mpir.tar](http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha2-mpir/sage-4.6.1.alpha2-mpir.tar)
 
 ---
 
``````




---

archive/issue_comments_091310.json:
```json
{
    "body": "<a id='comment:88'></a>\nReplying to [leif](#comment%3A25):\n> W.r.t. the race condition, cf. http://trac.sagemath.org/sage_trac/ticket/9343#comment:324\n> \n> (I currently don't recall if I reported this elsewhere, or my results of inspecting the Makefile... :( )\n\n\nI've reported the parallel `make install` error on [mpir-devel](http://groups.google.com/group/mpir-devel/browse_thread/thread/04928454886f34ab/e29bf19c2590d2d0?#e29bf19c2590d2d0).",
    "created_at": "2010-11-26T13:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91310",
    "user": "https://github.com/qed777"
}
```

<a id='comment:88'></a>
Replying to [leif](#comment%3A25):
> W.r.t. the race condition, cf. http://trac.sagemath.org/sage_trac/ticket/9343#comment:324
> 
> (I currently don't recall if I reported this elsewhere, or my results of inspecting the Makefile... :( )


I've reported the parallel `make install` error on [mpir-devel](http://groups.google.com/group/mpir-devel/browse_thread/thread/04928454886f34ab/e29bf19c2590d2d0?#e29bf19c2590d2d0).



---

archive/issue_comments_091311.json:
```json
{
    "body": "<a id='comment:89'></a>\nReplying to [mpatel](#comment%3A88):\n> Replying to [leif](#comment%3A25):\n> > W.r.t. the race condition, cf. http://trac.sagemath.org/sage_trac/ticket/9343#comment:324\n> > \n> > (I currently don't recall if I reported this elsewhere, or my results of inspecting the Makefile... :( )\n\n> \n> I've reported the parallel `make install` error on [mpir-devel](http://groups.google.com/group/mpir-devel/browse_thread/thread/04928454886f34ab/e29bf19c2590d2d0?#e29bf19c2590d2d0).\n\n\nJust yesterday ran into this for the first time on an old 32-bit single-core HT Pentium 4 (with 8 jobs); I previously only encountered it on Core2s with e.g. 16 or 32 jobs.",
    "created_at": "2010-11-26T13:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91311",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:89'></a>
Replying to [mpatel](#comment%3A88):
> Replying to [leif](#comment%3A25):
> > W.r.t. the race condition, cf. http://trac.sagemath.org/sage_trac/ticket/9343#comment:324
> > 
> > (I currently don't recall if I reported this elsewhere, or my results of inspecting the Makefile... :( )

> 
> I've reported the parallel `make install` error on [mpir-devel](http://groups.google.com/group/mpir-devel/browse_thread/thread/04928454886f34ab/e29bf19c2590d2d0?#e29bf19c2590d2d0).


Just yesterday ran into this for the first time on an old 32-bit single-core HT Pentium 4 (with 8 jobs); I previously only encountered it on Core2s with e.g. 16 or 32 jobs.



---

archive/issue_comments_091312.json:
```json
{
    "body": "<a id='comment:90'></a>\nReplying to [leif](#comment%3A89):\n> Replying to [mpatel](#comment%3A88):\n> > I've reported the parallel `make install` error on [mpir-devel](http://groups.google.com/group/mpir-devel/browse_thread/thread/04928454886f34ab/e29bf19c2590d2d0?#e29bf19c2590d2d0).\n\n> \n> Just yesterday ran into this for the first time on an old 32-bit single-core HT Pentium 4 (with 8 jobs); I previously only encountered it on Core2s with e.g. 16 or 32 jobs.\n\n\nThis has now been fixed in MPIR 2.1.4 (released today), but I'm not going to make any further changes *on this ticket*.\n\n(I'll open a follow-up ticket anyway, since I already have an MPIR 2.1.3.p2 spkg with other improvements; MPIR 2.2 is on the way, too.)",
    "created_at": "2010-12-01T20:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91312",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:90'></a>
Replying to [leif](#comment%3A89):
> Replying to [mpatel](#comment%3A88):
> > I've reported the parallel `make install` error on [mpir-devel](http://groups.google.com/group/mpir-devel/browse_thread/thread/04928454886f34ab/e29bf19c2590d2d0?#e29bf19c2590d2d0).

> 
> Just yesterday ran into this for the first time on an old 32-bit single-core HT Pentium 4 (with 8 jobs); I previously only encountered it on Core2s with e.g. 16 or 32 jobs.


This has now been fixed in MPIR 2.1.4 (released today), but I'm not going to make any further changes *on this ticket*.

(I'll open a follow-up ticket anyway, since I already have an MPIR 2.1.3.p2 spkg with other improvements; MPIR 2.2 is on the way, too.)



---

archive/issue_events_033524.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "rename": {
        "from": "Upgrade Sage's MPIR spkg to version 2.1.3 or later",
        "to": "Upgrade Sage's MPIR spkg to version 2.1.3"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33524"
}
```



---

archive/issue_comments_091313.json:
```json
{
    "body": "<a id='comment:92'></a>\nReplying to [leif](#comment%3A90):\n> This has now been fixed in MPIR 2.1.4 (released today), but I'm not going to make any further changes *on this ticket*.\n\n\n> \n> (I'll open a follow-up ticket anyway, since I already have an MPIR 2.1.3.p2 spkg with other improvements; MPIR 2.2 is on the way, too.)\n\n\nMPIR 2.2.0 was released today... ;-)",
    "created_at": "2010-12-02T18:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91313",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:92'></a>
Replying to [leif](#comment%3A90):
> This has now been fixed in MPIR 2.1.4 (released today), but I'm not going to make any further changes *on this ticket*.


> 
> (I'll open a follow-up ticket anyway, since I already have an MPIR 2.1.3.p2 spkg with other improvements; MPIR 2.2 is on the way, too.)


MPIR 2.2.0 was released today... ;-)



---

archive/issue_comments_091314.json:
```json
{
    "body": "<a id='comment:93'></a>\nReplying to [jdemeyer](#comment%3A36):\n> Replying to [leif](#comment%3A33):\n> >  * Download the [patch to the Sage library](http://trac.sagemath.org/sage_trac/raw-attachment/ticket/8664/trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib.patch). **Do not yet apply the patch.** (We first rebuild / reinstall dependent spkgs, of which the Sage library is one, so the patched version could get overwritten.)\n \n> \n> Please explain.  When can `setup.py` be overwritten?  This patched-files-being-overwritten-thing has bitten me already several times.\n\n\nA problem with `SAGE_UPGRADING` (whose \"external\" use is inofficial anyway) is that if the Sage library gets reinstalled because some of its dependencies got rebuilt (which is the typical case), Sage unconditionally switches back to the `main` branch without any warning, so previously applied patches to a clone take no longer effect (though they are still there, but no longer in the afterwards current branch, `sage-main`). It took me some time to realize that (or in fact track down weird errors caused by this)... ;-)\n\nThe Sage library's `spkg-install` should at least issue a warning when it switches the current branch; perhaps there should be some option to avoid this, since it is IMHO convenient to do e.g. `env SAGE_UPGRADING=yes make ptestlong` rather than patching the `main` branch or first building a new source distribution to build from scratch (or a new patched Sage library spkg to be installed).",
    "created_at": "2010-12-04T23:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91314",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:93'></a>
Replying to [jdemeyer](#comment%3A36):
> Replying to [leif](#comment%3A33):
> >  * Download the [patch to the Sage library](http://trac.sagemath.org/sage_trac/raw-attachment/ticket/8664/trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib.patch). **Do not yet apply the patch.** (We first rebuild / reinstall dependent spkgs, of which the Sage library is one, so the patched version could get overwritten.)
 
> 
> Please explain.  When can `setup.py` be overwritten?  This patched-files-being-overwritten-thing has bitten me already several times.


A problem with `SAGE_UPGRADING` (whose "external" use is inofficial anyway) is that if the Sage library gets reinstalled because some of its dependencies got rebuilt (which is the typical case), Sage unconditionally switches back to the `main` branch without any warning, so previously applied patches to a clone take no longer effect (though they are still there, but no longer in the afterwards current branch, `sage-main`). It took me some time to realize that (or in fact track down weird errors caused by this)... ;-)

The Sage library's `spkg-install` should at least issue a warning when it switches the current branch; perhaps there should be some option to avoid this, since it is IMHO convenient to do e.g. `env SAGE_UPGRADING=yes make ptestlong` rather than patching the `main` branch or first building a new source distribution to build from scratch (or a new patched Sage library spkg to be installed).



---

archive/issue_comments_091315.json:
```json
{
    "body": "<a id='comment:94'></a>\nThe old mpir spkg compiles with -march=<...>, the new spkg here doesn't do that.  That is definately a bug.",
    "created_at": "2011-01-12T19:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91315",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:94'></a>
The old mpir spkg compiles with -march=<...>, the new spkg here doesn't do that.  That is definately a bug.



---

archive/issue_comments_091316.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-01-12T19:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91316",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_091317.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2011-01-12T19:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91317",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_091318.json:
```json
{
    "body": "<a id='comment:95'></a>\nReplying to [jdemeyer](#comment%3A94):\n> The old mpir spkg compiles with -march=<...>, the new spkg here doesn't do that.  That is definately a bug.\n\n\nisn't mpir's config intelligent enough to figure out the right arch?",
    "created_at": "2011-01-12T19:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91318",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:95'></a>
Replying to [jdemeyer](#comment%3A94):
> The old mpir spkg compiles with -march=<...>, the new spkg here doesn't do that.  That is definately a bug.


isn't mpir's config intelligent enough to figure out the right arch?



---

archive/issue_comments_091319.json:
```json
{
    "body": "<a id='comment:96'></a>\nReplying to [dimpase](#comment%3A95):\n> isn't mpir's config intelligent enough to figure out the right arch?\n\n\nYes, but Sage's `CFLAGS` override `mpir`'s optimized `CFLAGS` (and this does not happen with the current mpir-1.2.2)",
    "created_at": "2011-01-12T20:01:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91319",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:96'></a>
Replying to [dimpase](#comment%3A95):
> isn't mpir's config intelligent enough to figure out the right arch?


Yes, but Sage's `CFLAGS` override `mpir`'s optimized `CFLAGS` (and this does not happen with the current mpir-1.2.2)



---

archive/issue_comments_091320.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2011-01-12T20:01:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91320",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_091321.json:
```json
{
    "body": "Changing work_issues from \"\" to \"Use MPIR's optimized CFLAGS\"",
    "created_at": "2011-04-07T13:37:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91321",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "" to "Use MPIR's optimized CFLAGS"



---

archive/issue_comments_091322.json:
```json
{
    "body": "<a id='comment:98'></a>\nReplying to [jdemeyer](#comment%3A97):\n\nas MPIR is at version 2.3.1 already, should all this be rebased?\n(well, I don't know if it works with ECM 6.3...)\n\nDima",
    "created_at": "2011-04-18T16:42:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91322",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:98'></a>
Replying to [jdemeyer](#comment%3A97):

as MPIR is at version 2.3.1 already, should all this be rebased?
(well, I don't know if it works with ECM 6.3...)

Dima



---

archive/issue_comments_091323.json:
```json
{
    "body": "<a id='comment:99'></a>\nProbably, yes, it should be rebased.\n\nBut also the `CFLAGS` issue still needs to be fixed...",
    "created_at": "2011-04-18T16:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91323",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:99'></a>
Probably, yes, it should be rebased.

But also the `CFLAGS` issue still needs to be fixed...



---

archive/issue_comments_091324.json:
```json
{
    "body": "<a id='comment:100'></a>\nReplying to [jdemeyer](#comment%3A99):\n> Probably, yes, it should be rebased.\n> \n> But also the `CFLAGS` issue still needs to be fixed...\n\n\n8S See [my comment above](http://trac.sagemath.org/sage_trac/ticket/8664#comment:90).\n\nI still can't believe this ticket didn't get merged *month* ago, just because (apparently) nobody felt able to give the ECM one (#5847) a final positive review.\n\nThe `CFLAGS` (or `-march=`) issue is IMHO completely unrelated -- if not irrelevant. ;-)\n\nIt's easy to extract and merge the *relevant* parts of MPIR's `CFLAGS` without ignoring a user's settings, which I did in the follow-up spkg (IIRC), mentioned above.\n\nI'll try to take a look at its state during the next days; I'm currently not even sure if I hadn't already uploaded it onto google code...\n\nCheers.",
    "created_at": "2011-04-18T17:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91324",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:100'></a>
Replying to [jdemeyer](#comment%3A99):
> Probably, yes, it should be rebased.
> 
> But also the `CFLAGS` issue still needs to be fixed...


8S See [my comment above](http://trac.sagemath.org/sage_trac/ticket/8664#comment:90).

I still can't believe this ticket didn't get merged *month* ago, just because (apparently) nobody felt able to give the ECM one (#5847) a final positive review.

The `CFLAGS` (or `-march=`) issue is IMHO completely unrelated -- if not irrelevant. ;-)

It's easy to extract and merge the *relevant* parts of MPIR's `CFLAGS` without ignoring a user's settings, which I did in the follow-up spkg (IIRC), mentioned above.

I'll try to take a look at its state during the next days; I'm currently not even sure if I hadn't already uploaded it onto google code...

Cheers.



---

archive/issue_comments_091325.json:
```json
{
    "body": "<a id='comment:1'></a>\nOh, not to mention #9858 (FLINT). :)\n\n(And I guess MPFR also still should be upgraded, an MPC spkg provided...)",
    "created_at": "2011-04-18T17:42:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91325",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:1'></a>
Oh, not to mention #9858 (FLINT). :)

(And I guess MPFR also still should be upgraded, an MPC spkg provided...)



---

archive/issue_comments_091326.json:
```json
{
    "body": "<a id='comment:102'></a>\nReplying to [leif](#comment%3A100):\n> The `CFLAGS` (or `-march=`) issue is IMHO completely unrelated -- if not irrelevant. ;-)\n\n\nThe current MPIR spkg *does* use machine-specific CFLAGS, the new spkg on this ticket *does not*.  This is a step backwards.\n\nIf you think it is irrelevant, please explain why...",
    "created_at": "2011-04-18T18:44:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91326",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:102'></a>
Replying to [leif](#comment%3A100):
> The `CFLAGS` (or `-march=`) issue is IMHO completely unrelated -- if not irrelevant. ;-)


The current MPIR spkg *does* use machine-specific CFLAGS, the new spkg on this ticket *does not*.  This is a step backwards.

If you think it is irrelevant, please explain why...



---

archive/issue_comments_091327.json:
```json
{
    "body": "<a id='comment:103'></a>\nReplying to [jdemeyer](#comment%3A102):\n> Replying to [leif](#comment%3A100):\n> > The `CFLAGS` (or `-march=`) issue is IMHO completely unrelated -- if not irrelevant. ;-)\n\n> \n> The current MPIR spkg *does* use machine-specific CFLAGS, the new spkg on this ticket *does not*.  This is a step backwards.\n> \n> If you think it is irrelevant, please explain why...\n\n\nGive me a *realistic* showcase where that matters... (i.e., causes a significant decrease in performance) ;-)\n\nFirst of all, the important parts of MPIR are (more or less) hand-optimized assembly code, selected by MPIR's `configure` (or its parameters*) to best match the detected architecture (where MPIR's `config.guess` doesn't always necessarily choose the current nearest one btw.).\n\nA properly configured GCC is usually sufficient, i.e. should default to something like `-march=native` (or a small subset of processors the actual CPU fits into), at least for people to whom performance is really crucial.\n\nWith my *current* spkg here, the user can always (intentionally or not) use the \"global\" `CFLAGS`, i.e. specify whatever is most appropriate to him or her.\n\nThe spkg had been extensively tested -- as is, month ago. As always: New changes, new pitfalls. [And even more delay due to a new test / review cycle. That's why I did not make any further changes *on this ticket*. Speaking of the devil, can someone **please** give #5847 a positive review?]\n\n\n---\n\n* If I haven't already, one (or me) should implement `MPIR_EXTRA_OPTS` or whatever it was called (but I think I already did).\n\nP.S.: Ah, I see. It's already in the p1 here.",
    "created_at": "2011-04-19T00:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91327",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:103'></a>
Replying to [jdemeyer](#comment%3A102):
> Replying to [leif](#comment%3A100):
> > The `CFLAGS` (or `-march=`) issue is IMHO completely unrelated -- if not irrelevant. ;-)

> 
> The current MPIR spkg *does* use machine-specific CFLAGS, the new spkg on this ticket *does not*.  This is a step backwards.
> 
> If you think it is irrelevant, please explain why...


Give me a *realistic* showcase where that matters... (i.e., causes a significant decrease in performance) ;-)

First of all, the important parts of MPIR are (more or less) hand-optimized assembly code, selected by MPIR's `configure` (or its parameters*) to best match the detected architecture (where MPIR's `config.guess` doesn't always necessarily choose the current nearest one btw.).

A properly configured GCC is usually sufficient, i.e. should default to something like `-march=native` (or a small subset of processors the actual CPU fits into), at least for people to whom performance is really crucial.

With my *current* spkg here, the user can always (intentionally or not) use the "global" `CFLAGS`, i.e. specify whatever is most appropriate to him or her.

The spkg had been extensively tested -- as is, month ago. As always: New changes, new pitfalls. [And even more delay due to a new test / review cycle. That's why I did not make any further changes *on this ticket*. Speaking of the devil, can someone **please** give #5847 a positive review?]


---

* If I haven't already, one (or me) should implement `MPIR_EXTRA_OPTS` or whatever it was called (but I think I already did).

P.S.: Ah, I see. It's already in the p1 here.



---

archive/issue_comments_091328.json:
```json
{
    "body": "<a id='comment:4'></a>\nWe really need to get MPIR updated in Sage.  What's the status of this?",
    "created_at": "2011-05-09T18:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91328",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:4'></a>
We really need to get MPIR updated in Sage.  What's the status of this?



---

archive/issue_comments_091329.json:
```json
{
    "body": "<a id='comment:105'></a>\nReplying to [mhansen](#comment%3A104):\n> We really need to get MPIR updated in Sage.  What's the status of this?\n\n\nThe package builds and works.  However, there is still the CFLAGS issue.  Me and William Stein think the package should not be merged in its current state, but others disagree.",
    "created_at": "2011-05-09T20:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91329",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:105'></a>
Replying to [mhansen](#comment%3A104):
> We really need to get MPIR updated in Sage.  What's the status of this?


The package builds and works.  However, there is still the CFLAGS issue.  Me and William Stein think the package should not be merged in its current state, but others disagree.



---

archive/issue_comments_091330.json:
```json
{
    "body": "<a id='comment:106'></a>\nReplying to [jdemeyer](#comment%3A105):\n> Replying to [mhansen](#comment%3A104):\n> > We really need to get MPIR updated in Sage.  What's the status of this?\n\n> \n> The package builds and works.  However, there is still the CFLAGS issue.  Me and William Stein think the package should not be merged in its current state, but others disagree.\n\n\n\n\nOk, I've asked Mercurial about my p2 (which was intended to be a follow-up):\n\n```\n+=== mpir-2.1.3.p2 (Leif Leonhardy, November 24th, 2010) ===\n+ * #8664: Upgrade Sage's MPIR spkg to version 2.1.3\n+ * Further improvements:\n+   - Let MPIR select CPU-specific code generation parameters (for CFLAGS) even\n+     if we (also) pass our own (or user-specified) CC and CFLAGS; these might\n+     be used by MPFR and GMP-ECM later, too, since MPIR's settings are recorded\n+     in 'gmp.h' / 'mpir.h'.\n+     Don't override user-settings (and respect SAGE_FAT_BINARY, SAGE_DEBUG\n+     etc.) though. Add '-march-native' if appropriate and supported.\n+  * Recognize also lower-case 'power*' arch (from 'uname -m').\n+  * Major restructuring / reformatting; more comments and messages added.\n```\n\nI'm not sure right now if it's ready for release, at least it is functional as far as I remember; haven't yet committed all changes though.\n\nStill believe we could [and maybe should] merge the p1 as is; upstream has to be updated anyway (once again, sooner or later, but IMHO definitely on a follow-up ticket).",
    "created_at": "2011-05-15T07:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91330",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:106'></a>
Replying to [jdemeyer](#comment%3A105):
> Replying to [mhansen](#comment%3A104):
> > We really need to get MPIR updated in Sage.  What's the status of this?

> 
> The package builds and works.  However, there is still the CFLAGS issue.  Me and William Stein think the package should not be merged in its current state, but others disagree.




Ok, I've asked Mercurial about my p2 (which was intended to be a follow-up):

```
+=== mpir-2.1.3.p2 (Leif Leonhardy, November 24th, 2010) ===
+ * #8664: Upgrade Sage's MPIR spkg to version 2.1.3
+ * Further improvements:
+   - Let MPIR select CPU-specific code generation parameters (for CFLAGS) even
+     if we (also) pass our own (or user-specified) CC and CFLAGS; these might
+     be used by MPFR and GMP-ECM later, too, since MPIR's settings are recorded
+     in 'gmp.h' / 'mpir.h'.
+     Don't override user-settings (and respect SAGE_FAT_BINARY, SAGE_DEBUG
+     etc.) though. Add '-march-native' if appropriate and supported.
+  * Recognize also lower-case 'power*' arch (from 'uname -m').
+  * Major restructuring / reformatting; more comments and messages added.
```

I'm not sure right now if it's ready for release, at least it is functional as far as I remember; haven't yet committed all changes though.

Still believe we could [and maybe should] merge the p1 as is; upstream has to be updated anyway (once again, sooner or later, but IMHO definitely on a follow-up ticket).



---

archive/issue_comments_091331.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#5847\"",
    "created_at": "2011-06-10T15:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91331",
    "user": "https://github.com/nexttime"
}
```

Changing dependencies from "" to "#5847"



---

archive/issue_comments_091332.json:
```json
{
    "body": "Sage library patch. Fixes extension modules not getting rebuilt though depending on MPIR. Rebased to Sage 4.7.1.alpha4.",
    "created_at": "2011-07-05T18:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91332",
    "user": "https://github.com/nexttime"
}
```

Sage library patch. Fixes extension modules not getting rebuilt though depending on MPIR. Rebased to Sage 4.7.1.alpha4.



---

archive/issue_comments_091333.json:
```json
{
    "body": "<a id='comment:8'></a>\nAttachment [trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib-rebased_to_4.7.1.alpha4.patch](tarball://root/attachments/some-uuid/ticket8664/trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib-rebased_to_4.7.1.alpha4.patch) by @williamstein created at 2011-07-18 05:21:21\n\nMPIR 2.4.0 has now been out over a month:  http://mpir.org/\nWe really, really need to get this upgraded.",
    "created_at": "2011-07-18T05:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91333",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:8'></a>
Attachment [trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib-rebased_to_4.7.1.alpha4.patch](tarball://root/attachments/some-uuid/ticket8664/trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib-rebased_to_4.7.1.alpha4.patch) by @williamstein created at 2011-07-18 05:21:21

MPIR 2.4.0 has now been out over a month:  http://mpir.org/
We really, really need to get this upgraded.



---

archive/issue_comments_091334.json:
```json
{
    "body": "<a id='comment:109'></a>\nReplying to [was](#comment%3A108):\n> MPIR 2.4.0 has now been out over a month:  http://mpir.org/\n> We really, really need to get this upgraded.\n\n\nWell, we could have merged this last year...\n\nFurther upstream upgrades should IMHO be made on follow-ups, but shouldn't be a problem once this is in.\n\nHopefully I can make a FLINT 1.5.2 spkg (cf. #9858) this week, rebasing the one I already have on the latest changes to our 1.5.0, and check / finish the p2 mentioned above which fixes the \"`CFLAGS` issue\" (though I still consider that kind of ridiculous, at least not a reason to delay an overdue major upgrade for month).\n\nThe also required new GMP-ECM package at #5847 was reverted from positive review to \"needs work\" just because a more or less optional patch to the Sage library would have to be rebased on another that had not even been merged into the at that time current devel release. I did so, but it now again technically needs review.",
    "created_at": "2011-07-18T06:10:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91334",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:109'></a>
Replying to [was](#comment%3A108):
> MPIR 2.4.0 has now been out over a month:  http://mpir.org/
> We really, really need to get this upgraded.


Well, we could have merged this last year...

Further upstream upgrades should IMHO be made on follow-ups, but shouldn't be a problem once this is in.

Hopefully I can make a FLINT 1.5.2 spkg (cf. #9858) this week, rebasing the one I already have on the latest changes to our 1.5.0, and check / finish the p2 mentioned above which fixes the "`CFLAGS` issue" (though I still consider that kind of ridiculous, at least not a reason to delay an overdue major upgrade for month).

The also required new GMP-ECM package at #5847 was reverted from positive review to "needs work" just because a more or less optional patch to the Sage library would have to be rebased on another that had not even been merged into the at that time current devel release. I did so, but it now again technically needs review.



---

archive/issue_comments_091335.json:
```json
{
    "body": "Preliminary \"preview\" diff between the p1 and the upcoming p2 with improved option handling (CFLAGS etc.)",
    "created_at": "2011-07-18T08:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91335",
    "user": "https://github.com/nexttime"
}
```

Preliminary "preview" diff between the p1 and the upcoming p2 with improved option handling (CFLAGS etc.)



---

archive/issue_comments_091336.json:
```json
{
    "body": "<a id='comment:0'></a>\nAttachment [mpir-2.1.3.p1-mpir-2.1.3.p2.diff](tarball://root/attachments/some-uuid/ticket8664/mpir-2.1.3.p1-mpir-2.1.3.p2.diff) by @nexttime created at 2011-07-18 08:33:17\n\nI've attached a \"preview\" diff of the p2 in case that makes anyone happy...",
    "created_at": "2011-07-18T08:33:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91336",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:0'></a>
Attachment [mpir-2.1.3.p1-mpir-2.1.3.p2.diff](tarball://root/attachments/some-uuid/ticket8664/mpir-2.1.3.p1-mpir-2.1.3.p2.diff) by @nexttime created at 2011-07-18 08:33:17

I've attached a "preview" diff of the p2 in case that makes anyone happy...



---

archive/issue_comments_091337.json:
```json
{
    "body": "<a id='comment:1'></a>\nI have a new p3, but now I'm having the \"usual\" trouble with PPL (in Sage 4.7.1.rc0).\n\nI.e., installing MPIR works, but after the installation GCC is broken inside Sage, because it tries to use Sage's PPL which still refers to the old `libgmpxx.so.3` which got deleted upon installation. (Others are having trouble with unresolved symbols not provided by Sage's PPL.)\n\nIt was IMHO a very bad idea to include PPL into Sage using the same name for the shared library, apparently without taking any care of these issues. (GMP / MPIR, MPFR and the -- currently optional IIRC -- MPC, all used by more recent versions of GCC, are in principle likely dangerous.)\n\nFortunately<sup>TM</sup> I can just change my `CC` setting to cure the installation, not deleting or copying any libraries or creating symbolic links...\n\n(Apropos, I by incident saw that GAP's `spkg-install` is **unsetting `CC`** because not doing so is said to \"break the install\". That's very very odd as well.)\n\nI'll update the MPIR spkg again to not delete its old shared libraries as a quick fix.",
    "created_at": "2011-07-18T22:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91337",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:1'></a>
I have a new p3, but now I'm having the "usual" trouble with PPL (in Sage 4.7.1.rc0).

I.e., installing MPIR works, but after the installation GCC is broken inside Sage, because it tries to use Sage's PPL which still refers to the old `libgmpxx.so.3` which got deleted upon installation. (Others are having trouble with unresolved symbols not provided by Sage's PPL.)

It was IMHO a very bad idea to include PPL into Sage using the same name for the shared library, apparently without taking any care of these issues. (GMP / MPIR, MPFR and the -- currently optional IIRC -- MPC, all used by more recent versions of GCC, are in principle likely dangerous.)

Fortunately<sup>TM</sup> I can just change my `CC` setting to cure the installation, not deleting or copying any libraries or creating symbolic links...

(Apropos, I by incident saw that GAP's `spkg-install` is **unsetting `CC`** because not doing so is said to "break the install". That's very very odd as well.)

I'll update the MPIR spkg again to not delete its old shared libraries as a quick fix.



---

archive/issue_comments_091338.json:
```json
{
    "body": "Attachment [mpir-2.1.3.p1-mpir-2.1.3.p4.diff](tarball://root/attachments/some-uuid/ticket8664/mpir-2.1.3.p1-mpir-2.1.3.p4.diff) by @nexttime created at 2011-07-20 04:16:11\n\nDiff between the formerly positively reviewed p1 and the p4. For reference / review.",
    "created_at": "2011-07-20T04:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91338",
    "user": "https://github.com/nexttime"
}
```

Attachment [mpir-2.1.3.p1-mpir-2.1.3.p4.diff](tarball://root/attachments/some-uuid/ticket8664/mpir-2.1.3.p1-mpir-2.1.3.p4.diff) by @nexttime created at 2011-07-20 04:16:11

Diff between the formerly positively reviewed p1 and the p4. For reference / review.



---

archive/issue_comments_091339.json:
```json
{
    "body": "Changing keywords from \"GMP ECM execstack Fedora 14 extension module library dependencies\" to \"GMP ECM execstack Fedora 14 extension module library dependencies Darwin 11 MacOS X 10.7\".",
    "created_at": "2011-07-20T04:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91339",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "GMP ECM execstack Fedora 14 extension module library dependencies" to "GMP ECM execstack Fedora 14 extension module library dependencies Darwin 11 MacOS X 10.7".



---

archive/issue_comments_091340.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -41,14 +41,15 @@\n \n ---\n \n-New spkg: [http://spkg-upload.googlecode.com/files/mpir-2.1.3.p1.spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p1.spkg)\n+**New spkg: [http://spkg-upload.googlecode.com/files/mpir-2.1.3.p4.spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p4.spkg)**\n \n-Testing distribution (including #5847):\n-[http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha2-mpir/sage-4.6.1.alpha2-mpir.tar](http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha2-mpir/sage-4.6.1.alpha2-mpir.tar)\n+**md5sum:** `f84278504f4e1b696030c41cac6e4719  mpir-2.1.3.p4.spkg`\n+\n+**Apply** [attachment:trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib-rebased_to_4.7.1.alpha4.patch] **to the Sage library** (after installation of the spkgs and a rebuild of dependent packages).\n \n ---\n \n-See comment(s) below on how to *\"manually\"* install and test the new packages. (ECM has to be updated, too.)\n+See comment(s) below on how to *\"manually\"* install and test the new packages. (ECM has to be updated, too, package is at #5847.)\n \n ---\n \n``````\n",
    "created_at": "2011-07-20T04:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91340",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -41,14 +41,15 @@
 
 ---
 
-New spkg: [http://spkg-upload.googlecode.com/files/mpir-2.1.3.p1.spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p1.spkg)
+**New spkg: [http://spkg-upload.googlecode.com/files/mpir-2.1.3.p4.spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p4.spkg)**
 
-Testing distribution (including #5847):
-[http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha2-mpir/sage-4.6.1.alpha2-mpir.tar](http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.1.alpha2-mpir/sage-4.6.1.alpha2-mpir.tar)
+**md5sum:** `f84278504f4e1b696030c41cac6e4719  mpir-2.1.3.p4.spkg`
+
+**Apply** [attachment:trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib-rebased_to_4.7.1.alpha4.patch] **to the Sage library** (after installation of the spkgs and a rebuild of dependent packages).
 
 ---
 
-See comment(s) below on how to *"manually"* install and test the new packages. (ECM has to be updated, too.)
+See comment(s) below on how to *"manually"* install and test the new packages. (ECM has to be updated, too, package is at #5847.)
 
 ---
 
``````




---

archive/issue_comments_091341.json:
```json
{
    "body": "Changing work_issues from \"Use MPIR's optimized CFLAGS\" to \"\"",
    "created_at": "2011-07-20T04:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91341",
    "user": "https://github.com/nexttime"
}
```

Changing work_issues from "Use MPIR's optimized CFLAGS" to ""



---

archive/issue_comments_091342.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew spkg is up:\n\n http://spkg-upload.googlecode.com/files/mpir-2.1.3.p4.spkg\n\n md5sum: `f84278504f4e1b696030c41cac6e4719  mpir-2.1.3.p4.spkg`\n\nFrom a user's view, fixes the \"`CFLAGS` issue\", adds support for MacOS X 10.7 and some messages.\n\nInstallation instructions remain the same; I'll perhaps put them into the description later.\n\n---\n\n### mpir-2.1.3.p4 (Leif Leonhardy, July 19th, 2011)\n* #8664: Upgrade Sage's MPIR spkg to version 2.1.3\n* Do not delete old GMP/MPIR shared libraries as Sage's versions of libraries\n  used by GCC might still refer to them, such that their deletion would break\n  GCC inside Sage. (PPL e.g. refers to libgmpxx; MPFR and MPC are equally\n  dangerous, since they're [also] used by recent versions of GCC.)\n* Some more messages (e.g on rebuilding the Sage library and other packages\n  after installation) and comments added.\n* \"Patches\" section added.\n* Also refreshed the patched gmp-h.in for SunOS. ;-)\n\n### mpir-2.1.3.p3 (Leif Leonhardy, July 18th, 2011)\n* #8664: Upgrade Sage's MPIR spkg to version 2.1.3\n* Support MacOS 10.7 (Darwin 11) and later.\n* Add warning if SAGE_DEBUG=yes since we then disable optimization.\n\n### mpir-2.1.3.p2 (Leif Leonhardy, November 24th, 2010)\n* #8664: Upgrade Sage's MPIR spkg to version 2.1.3\n* Further improvements:\n  - Let MPIR select CPU-specific code generation parameters (for CFLAGS) even\n    if we (also) pass our own (or user-specified) CC and CFLAGS; these might\n    be used by MPFR and GMP-ECM later, too, since MPIR's settings are recorded\n    in 'gmp.h' / 'mpir.h'.\n    Don't override user-settings (and respect SAGE_FAT_BINARY, SAGE_DEBUG\n    etc.) though. Add '-march-native' if appropriate and supported.\n  * Recognize also lower-case 'power*' arch (from 'uname -m').\n  * Major restructuring / reformatting; more comments and messages added.\n\n(Changes I made relative to the p1 which already had positive review, but got unmerged later.)\n\n---\n\nFurther upstream upgrade to MPIR 2.4.0 (or 2.3.1 if more upstream issues should arise) will come soon *on another ticket*. We IMHO first should get this well-tested upstream release in.\n\nPlease build, test and review...",
    "created_at": "2011-07-20T04:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91342",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:2'></a>
New spkg is up:

 http://spkg-upload.googlecode.com/files/mpir-2.1.3.p4.spkg

 md5sum: `f84278504f4e1b696030c41cac6e4719  mpir-2.1.3.p4.spkg`

From a user's view, fixes the "`CFLAGS` issue", adds support for MacOS X 10.7 and some messages.

Installation instructions remain the same; I'll perhaps put them into the description later.

---

### mpir-2.1.3.p4 (Leif Leonhardy, July 19th, 2011)
* #8664: Upgrade Sage's MPIR spkg to version 2.1.3
* Do not delete old GMP/MPIR shared libraries as Sage's versions of libraries
  used by GCC might still refer to them, such that their deletion would break
  GCC inside Sage. (PPL e.g. refers to libgmpxx; MPFR and MPC are equally
  dangerous, since they're [also] used by recent versions of GCC.)
* Some more messages (e.g on rebuilding the Sage library and other packages
  after installation) and comments added.
* "Patches" section added.
* Also refreshed the patched gmp-h.in for SunOS. ;-)

### mpir-2.1.3.p3 (Leif Leonhardy, July 18th, 2011)
* #8664: Upgrade Sage's MPIR spkg to version 2.1.3
* Support MacOS 10.7 (Darwin 11) and later.
* Add warning if SAGE_DEBUG=yes since we then disable optimization.

### mpir-2.1.3.p2 (Leif Leonhardy, November 24th, 2010)
* #8664: Upgrade Sage's MPIR spkg to version 2.1.3
* Further improvements:
  - Let MPIR select CPU-specific code generation parameters (for CFLAGS) even
    if we (also) pass our own (or user-specified) CC and CFLAGS; these might
    be used by MPFR and GMP-ECM later, too, since MPIR's settings are recorded
    in 'gmp.h' / 'mpir.h'.
    Don't override user-settings (and respect SAGE_FAT_BINARY, SAGE_DEBUG
    etc.) though. Add '-march-native' if appropriate and supported.
  * Recognize also lower-case 'power*' arch (from 'uname -m').
  * Major restructuring / reformatting; more comments and messages added.

(Changes I made relative to the p1 which already had positive review, but got unmerged later.)

---

Further upstream upgrade to MPIR 2.4.0 (or 2.3.1 if more upstream issues should arise) will come soon *on another ticket*. We IMHO first should get this well-tested upstream release in.

Please build, test and review...



---

archive/issue_comments_091343.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-07-20T04:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91343",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_091344.json:
```json
{
    "body": "<a id='comment:3'></a>\nP.S.: It would perhaps be convenient to either have a testing distribution or at least a Sage (library) package with the patch here applied, since during the automatic rebuild of dependent packages Sage switches back to the \"main\" branch and may invalidate an already applied patch. The behavior seems to have meanwhile changed a bit though.",
    "created_at": "2011-07-20T04:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91344",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'></a>
P.S.: It would perhaps be convenient to either have a testing distribution or at least a Sage (library) package with the patch here applied, since during the automatic rebuild of dependent packages Sage switches back to the "main" branch and may invalidate an already applied patch. The behavior seems to have meanwhile changed a bit though.



---

archive/issue_comments_091345.json:
```json
{
    "body": "<a id='comment:4'></a>\nOk, to ease testing, I've uploaded a [Sage 4.7.1.rc0 library spkg](http://spkg-upload.googlecode.com/files/sage-4.7.1.rc0-8664-5847.spkg) with both patches (from here and #5847) already applied.\n\nYou can either build Sage 4.7.1.rc0 from scratch with these three spkgs, or take a Sage 4.7.1.rc0 installation and just install them, automatically rebuilding (only) the dependent spkgs.\n\n1. Copy [the MPIR spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p4.spkg) and [the GMP-ECM spkg](http://spkg-upload.googlecode.com/files/ecm-6.3.p2.spkg) into `$SAGE_ROOT/spkg/standard/`.\n2. **Replace** the `sage-4.7.1.rc0.spkg` with [this one](http://spkg-upload.googlecode.com/files/sage-4.7.1.rc0-8664-5847.spkg) (i.e., copy it to `$SAGE_ROOT/spkg/standard` and **delete** the original since `newest_version` would otherwise take the wrong one).\n3. Build:\n   * For a build from scratch, simply type `make`.\n   * For rebuilding an existing installation with the new spkgs, type\n\n```sh\nenv SAGE_UPGRADING=yes make\n```\n\nNote that you currently must not set `SAGE_CHECK` to `yes` in the above procedures, since the test suite of our current FLINT won't build with the new MPIR.\n\nTo run MPIR's and GMP-ECM's test suites, I'd suggest to simply reinstall them afterwards with `env SAGE_CHECK=yes ./sage -f mpir-2.1.3.p4 ecm-6.3.p2`. Likewise, you can also play with different `CFLAGS` settings (empty, some non-processor-specific flags, with some `-march=...` or `-mtune=...` etc. included).\n\nThen preferably run `make testlong` or `make ptestlong`, though both upstream releases have IMHO already been quite excessively tested.",
    "created_at": "2011-07-20T07:03:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91345",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'></a>
Ok, to ease testing, I've uploaded a [Sage 4.7.1.rc0 library spkg](http://spkg-upload.googlecode.com/files/sage-4.7.1.rc0-8664-5847.spkg) with both patches (from here and #5847) already applied.

You can either build Sage 4.7.1.rc0 from scratch with these three spkgs, or take a Sage 4.7.1.rc0 installation and just install them, automatically rebuilding (only) the dependent spkgs.

1. Copy [the MPIR spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p4.spkg) and [the GMP-ECM spkg](http://spkg-upload.googlecode.com/files/ecm-6.3.p2.spkg) into `$SAGE_ROOT/spkg/standard/`.
2. **Replace** the `sage-4.7.1.rc0.spkg` with [this one](http://spkg-upload.googlecode.com/files/sage-4.7.1.rc0-8664-5847.spkg) (i.e., copy it to `$SAGE_ROOT/spkg/standard` and **delete** the original since `newest_version` would otherwise take the wrong one).
3. Build:
   * For a build from scratch, simply type `make`.
   * For rebuilding an existing installation with the new spkgs, type

```sh
env SAGE_UPGRADING=yes make
```

Note that you currently must not set `SAGE_CHECK` to `yes` in the above procedures, since the test suite of our current FLINT won't build with the new MPIR.

To run MPIR's and GMP-ECM's test suites, I'd suggest to simply reinstall them afterwards with `env SAGE_CHECK=yes ./sage -f mpir-2.1.3.p4 ecm-6.3.p2`. Likewise, you can also play with different `CFLAGS` settings (empty, some non-processor-specific flags, with some `-march=...` or `-mtune=...` etc. included).

Then preferably run `make testlong` or `make ptestlong`, though both upstream releases have IMHO already been quite excessively tested.



---

archive/issue_comments_091346.json:
```json
{
    "body": "<a id='comment:115'></a>\nReplying to [leif](#comment%3A114):\n\n\nI'm currently running this on MacOSX 10.6. Will report as soon as it's done",
    "created_at": "2011-07-21T11:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91346",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:115'></a>
Replying to [leif](#comment%3A114):


I'm currently running this on MacOSX 10.6. Will report as soon as it's done



---

archive/issue_comments_091347.json:
```json
{
    "body": "<a id='comment:116'></a>\nReplying to [dimpase](#comment%3A115):\n> I'm currently running this on MacOSX 10.6. Will report as soon as it's done\n\n\nThanks. If all tests pass and you're happy with the spkg *here*, you may want to take a look at #11616. ;-)",
    "created_at": "2011-07-22T07:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91347",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:116'></a>
Replying to [dimpase](#comment%3A115):
> I'm currently running this on MacOSX 10.6. Will report as soon as it's done


Thanks. If all tests pass and you're happy with the spkg *here*, you may want to take a look at #11616. ;-)



---

archive/issue_comments_091348.json:
```json
{
    "body": "<a id='comment:117'></a>\nReplying to [dimpase](#comment%3A115):\n> Replying to [leif](#comment%3A114):\n> \n> \n> I'm currently running this on MacOSX 10.6. Will report as soon as it's done\n\n\nI can confirm that the above procedure and \"make ptestlong\" works just fine on MacOSX 10.6.",
    "created_at": "2011-07-22T10:25:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91348",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:117'></a>
Replying to [dimpase](#comment%3A115):
> Replying to [leif](#comment%3A114):
> 
> 
> I'm currently running this on MacOSX 10.6. Will report as soon as it's done


I can confirm that the above procedure and "make ptestlong" works just fine on MacOSX 10.6.



---

archive/issue_comments_091349.json:
```json
{
    "body": "<a id='comment:118'></a>\nReplying to [leif](#comment%3A116):\n> Replying to [dimpase](#comment%3A115):\n> > I'm currently running this on MacOSX 10.6. Will report as soon as it's done\n\n> \n> Thanks. If all tests pass and you're happy with the spkg *here*, you may want to take a look at #11616. ;-)\n> \n\n\nI think I can give this a positive review.",
    "created_at": "2011-07-22T10:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91349",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:118'></a>
Replying to [leif](#comment%3A116):
> Replying to [dimpase](#comment%3A115):
> > I'm currently running this on MacOSX 10.6. Will report as soon as it's done

> 
> Thanks. If all tests pass and you're happy with the spkg *here*, you may want to take a look at #11616. ;-)
> 


I think I can give this a positive review.



---

archive/issue_comments_091350.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-07-22T10:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91350",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_033525.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-22T12:52:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "milestone": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33525"
}
```



---

archive/issue_events_033526.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-22T12:52:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "milestone": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33526"
}
```



---

archive/issue_comments_091351.json:
```json
{
    "body": "<a id='comment:0'></a>\nbecause it depends on a not-yet-positively-reviewed ticket",
    "created_at": "2011-07-24T18:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91351",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:0'></a>
because it depends on a not-yet-positively-reviewed ticket



---

archive/issue_events_033527.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-24T18:53:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "milestone": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33527"
}
```



---

archive/issue_events_033528.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-24T18:53:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33528"
}
```



---

archive/issue_comments_091352.json:
```json
{
    "body": "<a id='comment:121'></a>\nReplying to [jdemeyer](#comment%3A120):\n> because it depends on a not-yet-positively-reviewed ticket\n\n\nWell, can't you re-review #5847, which you set back to \"needs work\"?\n\nThe only single thing that has changed there is that the one-line patch to `module_list.py` got rebased to Sage 4.7.1.alpha4, in particular it is the same patch, differing just in line numbers (or, more precisely, a single after-context line):\n\n```patch\n--- ../patches/trac_5847-module_list-fix_execstack-sagelib.patch\t2011-06-02 21:38:51.000000000 +0200\n+++ ../patches/trac_5847-module_list-fix_execstack-sagelib-rebased_to_4.7.1.alpha4.patch\t2011-07-20 07:08:13.000000000 +0200\n@@ -1,22 +1,24 @@\n # HG changeset patch\n # User Leif Leonhardy <not.really@online.de>\n-# Date 1307043111 -7200\n-# Node ID e7b1b631a38756bb37aa5edc7a0e31ff10eaa86a\n-# Parent  fb00ec75853019eb9799fd863b193fe82ee97c74\n+# Date 1309863032 -7200\n+# Node ID 556a3825c961b6871451652dede6ec3742705482\n+# Parent  8532a2ad1e558cbc91ddaaa6b7cc79956dd1e8ba\n #5847: Add 'noexecstack' flag when linking libecm extension module on Linux.\n \n (Not doing so caused trouble on a SkyNet Fedora machine with Sage 4.7.1.alpha1\n  and GMP-ECM 6.3.p2 from #5847, GCC 4.6.0; didn't occur previously.)\n \n-diff -r fb00ec758530 -r e7b1b631a387 module_list.py\n---- a/module_list.py\tWed May 11 22:39:05 2011 +0000\n-+++ b/module_list.py\tThu Jun 02 21:31:51 2011 +0200\n-@@ -561,6 +561,8 @@\n+(Rebased patch for Sage 4.7.1.alpha4 / #11377)\n+\n+diff -r 8532a2ad1e55 -r 556a3825c961 module_list.py\n+--- a/module_list.py\tSun Jul 03 14:23:12 2011 +0000\n++++ b/module_list.py\tTue Jul 05 12:50:32 2011 +0200\n+@@ -568,6 +568,8 @@\n      Extension('sage.libs.libecm',\n                sources = ['sage/libs/libecm.pyx'],\n                libraries = ['ecm', 'gmp'],\n +              extra_link_args = uname_specific(\"Linux\", [\"-Wl,-z,noexecstack\"],\n +                                                        []),\n-               depends = [SAGE_ROOT + \"/local/include/ecm.h\"]),\n+               depends = [SAGE_INC + \"ecm.h\"]),\n       \n      Extension('sage.libs.mwrank.mwrank',\n```",
    "created_at": "2011-07-24T23:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91352",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:121'></a>
Replying to [jdemeyer](#comment%3A120):
> because it depends on a not-yet-positively-reviewed ticket


Well, can't you re-review #5847, which you set back to "needs work"?

The only single thing that has changed there is that the one-line patch to `module_list.py` got rebased to Sage 4.7.1.alpha4, in particular it is the same patch, differing just in line numbers (or, more precisely, a single after-context line):

```patch
--- ../patches/trac_5847-module_list-fix_execstack-sagelib.patch	2011-06-02 21:38:51.000000000 +0200
+++ ../patches/trac_5847-module_list-fix_execstack-sagelib-rebased_to_4.7.1.alpha4.patch	2011-07-20 07:08:13.000000000 +0200
@@ -1,22 +1,24 @@
 # HG changeset patch
 # User Leif Leonhardy <not.really@online.de>
-# Date 1307043111 -7200
-# Node ID e7b1b631a38756bb37aa5edc7a0e31ff10eaa86a
-# Parent  fb00ec75853019eb9799fd863b193fe82ee97c74
+# Date 1309863032 -7200
+# Node ID 556a3825c961b6871451652dede6ec3742705482
+# Parent  8532a2ad1e558cbc91ddaaa6b7cc79956dd1e8ba
 #5847: Add 'noexecstack' flag when linking libecm extension module on Linux.
 
 (Not doing so caused trouble on a SkyNet Fedora machine with Sage 4.7.1.alpha1
  and GMP-ECM 6.3.p2 from #5847, GCC 4.6.0; didn't occur previously.)
 
-diff -r fb00ec758530 -r e7b1b631a387 module_list.py
---- a/module_list.py	Wed May 11 22:39:05 2011 +0000
-+++ b/module_list.py	Thu Jun 02 21:31:51 2011 +0200
-@@ -561,6 +561,8 @@
+(Rebased patch for Sage 4.7.1.alpha4 / #11377)
+
+diff -r 8532a2ad1e55 -r 556a3825c961 module_list.py
+--- a/module_list.py	Sun Jul 03 14:23:12 2011 +0000
++++ b/module_list.py	Tue Jul 05 12:50:32 2011 +0200
+@@ -568,6 +568,8 @@
      Extension('sage.libs.libecm',
                sources = ['sage/libs/libecm.pyx'],
                libraries = ['ecm', 'gmp'],
 +              extra_link_args = uname_specific("Linux", ["-Wl,-z,noexecstack"],
 +                                                        []),
-               depends = [SAGE_ROOT + "/local/include/ecm.h"]),
+               depends = [SAGE_INC + "ecm.h"]),
       
      Extension('sage.libs.mwrank.mwrank',
```



---

archive/issue_comments_091353.json:
```json
{
    "body": "<a id='comment:123'></a>\n#5847 has a positive review again",
    "created_at": "2011-08-23T05:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91353",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:123'></a>
#5847 has a positive review again



---

archive/issue_events_033529.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2011-08-23T05:57:45Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33529"
}
```



---

archive/issue_events_033530.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2011-08-23T05:57:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "milestone": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33530"
}
```



---

archive/issue_comments_091354.json:
```json
{
    "body": "Changing keywords from \"GMP ECM execstack Fedora 14 extension module library dependencies Darwin 11 MacOS X 10.7\" to \"sd32, GMP ECM execstack Fedora 14 extension module library dependencies Darwin 11 MacOS X 10.7\".",
    "created_at": "2011-08-24T23:35:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91354",
    "user": "https://github.com/williamstein"
}
```

Changing keywords from "GMP ECM execstack Fedora 14 extension module library dependencies Darwin 11 MacOS X 10.7" to "sd32, GMP ECM execstack Fedora 14 extension module library dependencies Darwin 11 MacOS X 10.7".



---

archive/issue_comments_091355.json:
```json
{
    "body": "Sage library patch. Fixes extension modules not getting rebuilt though depending on MPIR. Rebased on Sage 4.7.2.alpha2 / #11376.",
    "created_at": "2011-08-31T21:45:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91355",
    "user": "https://github.com/nexttime"
}
```

Sage library patch. Fixes extension modules not getting rebuilt though depending on MPIR. Rebased on Sage 4.7.2.alpha2 / #11376.



---

archive/issue_comments_091356.json:
```json
{
    "body": "<a id='comment:5'></a>\nAttachment [trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib-rebased_to_4.7.2.alpha2.patch](tarball://root/attachments/some-uuid/ticket8664/trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib-rebased_to_4.7.2.alpha2.patch) by @nexttime created at 2011-08-31 21:49:09",
    "created_at": "2011-08-31T21:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91356",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:5'></a>
Attachment [trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib-rebased_to_4.7.2.alpha2.patch](tarball://root/attachments/some-uuid/ticket8664/trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib-rebased_to_4.7.2.alpha2.patch) by @nexttime created at 2011-08-31 21:49:09



---

archive/issue_comments_091357.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -45,7 +45,7 @@\n \n **md5sum:** `f84278504f4e1b696030c41cac6e4719  mpir-2.1.3.p4.spkg`\n \n-**Apply** [attachment:trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib-rebased_to_4.7.1.alpha4.patch] **to the Sage library** (after installation of the spkgs and a rebuild of dependent packages).\n+**Apply** [attachment:trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib-rebased_to_4.7.2.alpha2.patch] **to the Sage library** (after installation of the spkgs and a rebuild of dependent packages).\n \n ---\n \n``````\n",
    "created_at": "2011-08-31T21:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91357",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -45,7 +45,7 @@
 
 **md5sum:** `f84278504f4e1b696030c41cac6e4719  mpir-2.1.3.p4.spkg`
 
-**Apply** [attachment:trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib-rebased_to_4.7.1.alpha4.patch] **to the Sage library** (after installation of the spkgs and a rebuild of dependent packages).
+**Apply** [attachment:trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib-rebased_to_4.7.2.alpha2.patch] **to the Sage library** (after installation of the spkgs and a rebuild of dependent packages).
 
 ---
 
``````




---

archive/issue_comments_091358.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-09-12T19:03:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91358",
    "user": "https://github.com/nexttime"
}
```

Resolution: fixed



---

archive/issue_comments_091359.json:
```json
{
    "body": "Changing keywords from \"sd32, GMP ECM execstack Fedora 14 extension module library dependencies Darwin 11 MacOS X 10.7\" to \"sd32, GMP ECM execstack Fedora 14 extension module library dependencies Darwin 11 MacOS X 10.7 Lion\".",
    "created_at": "2011-09-12T19:03:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91359",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "sd32, GMP ECM execstack Fedora 14 extension module library dependencies Darwin 11 MacOS X 10.7" to "sd32, GMP ECM execstack Fedora 14 extension module library dependencies Darwin 11 MacOS X 10.7 Lion".



---

archive/issue_events_033531.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-12T19:03:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33531"
}
```



---

archive/issue_comments_091360.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.7.2.alpha3\"",
    "created_at": "2011-09-12T19:03:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91360",
    "user": "https://github.com/nexttime"
}
```

Changing merged from "" to "sage-4.7.2.alpha3"



---

archive/issue_comments_091361.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -41,9 +41,9 @@\n \n ---\n \n-**New spkg: [http://spkg-upload.googlecode.com/files/mpir-2.1.3.p4.spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p4.spkg)**\n+**New spkg: [http://sage.math.washington.edu/home/leif/Sage/spkgs/mpir-2.1.3.p4.spkg](http://sage.math.washington.edu/home/leif/Sage/spkgs/mpir-2.1.3.p4.spkg)**\n \n-**md5sum:** `f84278504f4e1b696030c41cac6e4719  mpir-2.1.3.p4.spkg`\n+**md5sum:** `197c652a6bdbf20c2e47be9176a8616e  mpir-2.1.3.p4.spkg`\n \n **Apply** [attachment:trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib-rebased_to_4.7.2.alpha2.patch] **to the Sage library** (after installation of the spkgs and a rebuild of dependent packages).\n \n``````\n",
    "created_at": "2011-09-23T05:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91361",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -41,9 +41,9 @@
 
 ---
 
-**New spkg: [http://spkg-upload.googlecode.com/files/mpir-2.1.3.p4.spkg](http://spkg-upload.googlecode.com/files/mpir-2.1.3.p4.spkg)**
+**New spkg: [http://sage.math.washington.edu/home/leif/Sage/spkgs/mpir-2.1.3.p4.spkg](http://sage.math.washington.edu/home/leif/Sage/spkgs/mpir-2.1.3.p4.spkg)**
 
-**md5sum:** `f84278504f4e1b696030c41cac6e4719  mpir-2.1.3.p4.spkg`
+**md5sum:** `197c652a6bdbf20c2e47be9176a8616e  mpir-2.1.3.p4.spkg`
 
 **Apply** [attachment:trac_8664-fix_extmod_deps_for_MPIR_generically-sagelib-rebased_to_4.7.2.alpha2.patch] **to the Sage library** (after installation of the spkgs and a rebuild of dependent packages).
 
``````




---

archive/issue_comments_091362.json:
```json
{
    "body": "<a id='comment:7'></a>\nHad to fix the changelog and some file permissions.\n\nCorrected spkg at new location.",
    "created_at": "2011-09-23T05:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91362",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>
Had to fix the changelog and some file permissions.

Corrected spkg at new location.



---

archive/issue_comments_091363.json:
```json
{
    "body": "<a id='comment:8'></a>\nI'm not sure if this is the best place to report this since the ticket has been merged, but in building vanilla sage-4.7.2.alpha3 on x86, mpir-2.1.3.p4 fails with\n\n```\n ../strip_fPIC.sh ../yasm/yasm -I .. -f elf64 submul_1.as -o submul_1.o >/dev/null 2>&1\n/bin/bash ../libtool --mode=c\n ../mpn/m4-ccas --m4=m4 gcc -std=gnu99 -c -DHAVE_CONFIG_H -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -D__GMP_WITHIN_GMP -I.. -DOPERATION_lshift -I. -I.. lshift.asm  -fPIC -DPIC -o .libs/lshift.o\nm4  -DHAVE_CONFIG_H -D__GMP_WITHIN_GMP -DOPERATION_lshift -DPIC lshift.asm >tmp-lshift.s\n gcc -std=gnu99 -c -DHAVE_CONFIG_H -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -D__GMP_WITHIN_GMP -I.. -DOPERATION_lshift -I. -I.. tmp-lshift.s -fPIC -DPIC -o .libs/lshift.o\ntmp-lshift.s: Assembler messages:\ntmp-lshift.s:53: Error: bad register name `%rbx'\ntmp-lshift.s:54: Error: bad register name `%rdx'\ntmp-lshift.s:55: Error: bad register name `%rsi)'\ntmp-lshift.s:56: Error: bad register name `%rdi)'\ntmp-lshift.s:57: Error: bad register name `%rsi,%rbx,8)'\ntmp-lshift.s:58: Error: bad register name `%rax'\ntmp-lshift.s:59: Error: bad register name `%rdx'\ntmp-lshift.s:60: Error: bad register name `%rbx'\ntmp-lshift.s:64: Error: bad register name `%rsi,%rbx,8)'\ntmp-lshift.s:65: Error: bad register name `%rsi,%rbx,8)'\ntmp-lshift.s:66: Error: bad register name `%rsi,%rbx,8)'\ntmp-lshift.s:67: Error: bad register name `%r8'\ntmp-lshift.s:68: Error: bad register name `%rdx'\ntmp-lshift.s:69: Error: bad register name `%r11'\ntmp-lshift.s:70: Error: bad register name `%rsi,%rbx,8)'\n\n...\n\ntmp-lshift.s:118: Error: bad register name `%rsi,%rbx,8)'\ntmp-lshift.s:119: Error: bad register name `%r8'\ntmp-lshift.s:120: Error: bad register name `%rdx'\ntmp-lshift.s:121: Error: bad register name `%r8'\ntmp-lshift.s:122: Error: bad register name `%r8'\ntmp-lshift.s:123: Error: bad register name `%rbx'\nmake[4]: *** [lshift.lo] Error 1\nmake[4]: Leaving directory `/storage/sage/sage-4.7.2.alpha3/spkg/build/mpir-2.1.3.p4/src/mpn'\nmake[3]: *** [all-recursive] Error 1\nmake[3]: Leaving directory `/storage/sage/sage-4.7.2.alpha3/spkg/build/mpir-2.1.3.p4/src'\nmake[2]: *** [all] Error 2\nmake[2]: Leaving directory `/storage/sage/sage-4.7.2.alpha3/spkg/build/mpir-2.1.3.p4/src'\nError building MPIR.\n```\nI've never seen this before. The machine is running debian, but the sage build was done from within a gentoo prefix. So the build is basically one using gentoo. There doesn't seem to be a problem on amd64. I still have the build log.",
    "created_at": "2011-10-03T01:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91363",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:8'></a>
I'm not sure if this is the best place to report this since the ticket has been merged, but in building vanilla sage-4.7.2.alpha3 on x86, mpir-2.1.3.p4 fails with

```
 ../strip_fPIC.sh ../yasm/yasm -I .. -f elf64 submul_1.as -o submul_1.o >/dev/null 2>&1
/bin/bash ../libtool --mode=c
 ../mpn/m4-ccas --m4=m4 gcc -std=gnu99 -c -DHAVE_CONFIG_H -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -D__GMP_WITHIN_GMP -I.. -DOPERATION_lshift -I. -I.. lshift.asm  -fPIC -DPIC -o .libs/lshift.o
m4  -DHAVE_CONFIG_H -D__GMP_WITHIN_GMP -DOPERATION_lshift -DPIC lshift.asm >tmp-lshift.s
 gcc -std=gnu99 -c -DHAVE_CONFIG_H -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -D__GMP_WITHIN_GMP -I.. -DOPERATION_lshift -I. -I.. tmp-lshift.s -fPIC -DPIC -o .libs/lshift.o
tmp-lshift.s: Assembler messages:
tmp-lshift.s:53: Error: bad register name `%rbx'
tmp-lshift.s:54: Error: bad register name `%rdx'
tmp-lshift.s:55: Error: bad register name `%rsi)'
tmp-lshift.s:56: Error: bad register name `%rdi)'
tmp-lshift.s:57: Error: bad register name `%rsi,%rbx,8)'
tmp-lshift.s:58: Error: bad register name `%rax'
tmp-lshift.s:59: Error: bad register name `%rdx'
tmp-lshift.s:60: Error: bad register name `%rbx'
tmp-lshift.s:64: Error: bad register name `%rsi,%rbx,8)'
tmp-lshift.s:65: Error: bad register name `%rsi,%rbx,8)'
tmp-lshift.s:66: Error: bad register name `%rsi,%rbx,8)'
tmp-lshift.s:67: Error: bad register name `%r8'
tmp-lshift.s:68: Error: bad register name `%rdx'
tmp-lshift.s:69: Error: bad register name `%r11'
tmp-lshift.s:70: Error: bad register name `%rsi,%rbx,8)'

...

tmp-lshift.s:118: Error: bad register name `%rsi,%rbx,8)'
tmp-lshift.s:119: Error: bad register name `%r8'
tmp-lshift.s:120: Error: bad register name `%rdx'
tmp-lshift.s:121: Error: bad register name `%r8'
tmp-lshift.s:122: Error: bad register name `%r8'
tmp-lshift.s:123: Error: bad register name `%rbx'
make[4]: *** [lshift.lo] Error 1
make[4]: Leaving directory `/storage/sage/sage-4.7.2.alpha3/spkg/build/mpir-2.1.3.p4/src/mpn'
make[3]: *** [all-recursive] Error 1
make[3]: Leaving directory `/storage/sage/sage-4.7.2.alpha3/spkg/build/mpir-2.1.3.p4/src'
make[2]: *** [all] Error 2
make[2]: Leaving directory `/storage/sage/sage-4.7.2.alpha3/spkg/build/mpir-2.1.3.p4/src'
Error building MPIR.
```
I've never seen this before. The machine is running debian, but the sage build was done from within a gentoo prefix. So the build is basically one using gentoo. There doesn't seem to be a problem on amd64. I still have the build log.



---

archive/issue_comments_091364.json:
```json
{
    "body": "<a id='comment:129'></a>\nReplying to [strogdon](#comment%3A128):\n> I'm not sure if this is the best place to report this since the ticket has been merged, but in building vanilla sage-4.7.2.alpha3 on x86, mpir-2.1.3.p4 fails with\n> \n\n{{{\ntmp-lshift.s: Assembler messages:\ntmp-lshift.s:53: Error: bad register name `%rbx'\n...\nmake[4]: *** [lshift.lo] Error 1\n...\n}}}\n> I've never seen this before. The machine is running debian, but the sage build was done from within a gentoo prefix. So the build is basically one using gentoo. There doesn't seem to be a problem on amd64. I still have the build log.\n\n\nSee [sage-release](http://groups.google.com/group/sage-release/msg/c560179ee11e8692) and [this mpir-devel thread](http://groups.google.com/group/mpir-devel/browse_thread/thread/46ccdc5dfc3485cd#).\n\nI'm sorry I didn't catch this earlier, but it's a waste of resources to run 32-bit operating systems (or software in general) on 64-bit processors... ;-)\n\nI'll provide follow-up spkgs (also at #11616) that will fix this without the need to set `ABI`, but perhaps not that very soon.\n\nBy the way, MPIR 2.5.0 should get released in the next days as well, so I'll presumably also make an spkg based on that.",
    "created_at": "2011-10-03T06:18:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91364",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:129'></a>
Replying to [strogdon](#comment%3A128):
> I'm not sure if this is the best place to report this since the ticket has been merged, but in building vanilla sage-4.7.2.alpha3 on x86, mpir-2.1.3.p4 fails with
> 

{{{
tmp-lshift.s: Assembler messages:
tmp-lshift.s:53: Error: bad register name `%rbx'
...
make[4]: *** [lshift.lo] Error 1
...
}}}
> I've never seen this before. The machine is running debian, but the sage build was done from within a gentoo prefix. So the build is basically one using gentoo. There doesn't seem to be a problem on amd64. I still have the build log.


See [sage-release](http://groups.google.com/group/sage-release/msg/c560179ee11e8692) and [this mpir-devel thread](http://groups.google.com/group/mpir-devel/browse_thread/thread/46ccdc5dfc3485cd#).

I'm sorry I didn't catch this earlier, but it's a waste of resources to run 32-bit operating systems (or software in general) on 64-bit processors... ;-)

I'll provide follow-up spkgs (also at #11616) that will fix this without the need to set `ABI`, but perhaps not that very soon.

By the way, MPIR 2.5.0 should get released in the next days as well, so I'll presumably also make an spkg based on that.



---

archive/issue_comments_091365.json:
```json
{
    "body": "<a id='comment:130'></a>\nReplying to [leif](#comment%3A129):\n> Replying to [strogdon](#comment%3A128):\n> > I'm not sure if this is the best place to report this since the ticket has been merged, but in building vanilla sage-4.7.2.alpha3 on x86, mpir-2.1.3.p4 fails with\n> > \n\n{{{\ntmp-lshift.s: Assembler messages:\ntmp-lshift.s:53: Error: bad register name `%rbx'\n...\nmake[4]: *** [lshift.lo] Error 1\n...\n}}}\n> I'll provide follow-up spkgs (also at #11616) that will fix this without the need to set `ABI`, but perhaps not that very soon.\n\n\nAn MPIR 2.1.3.p5 spkg fixing this is now available at #11896, currently needing review.",
    "created_at": "2011-10-05T03:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91365",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:130'></a>
Replying to [leif](#comment%3A129):
> Replying to [strogdon](#comment%3A128):
> > I'm not sure if this is the best place to report this since the ticket has been merged, but in building vanilla sage-4.7.2.alpha3 on x86, mpir-2.1.3.p4 fails with
> > 

{{{
tmp-lshift.s: Assembler messages:
tmp-lshift.s:53: Error: bad register name `%rbx'
...
make[4]: *** [lshift.lo] Error 1
...
}}}
> I'll provide follow-up spkgs (also at #11616) that will fix this without the need to set `ABI`, but perhaps not that very soon.


An MPIR 2.1.3.p5 spkg fixing this is now available at #11896, currently needing review.



---

archive/issue_events_033532.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-11T07:36:14Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "milestone": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33532"
}
```



---

archive/issue_comments_091366.json:
```json
{
    "body": "Changing merged from \"sage-4.7.2.alpha3\" to \"\"",
    "created_at": "2011-10-11T07:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91366",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "sage-4.7.2.alpha3" to ""



---

archive/issue_comments_091367.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2011-10-11T07:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91367",
    "user": "https://github.com/jdemeyer"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_091368.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2011-10-11T07:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91368",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from closed to new.



---

archive/issue_events_033533.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-11T07:36:14Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33533"
}
```



---

archive/issue_comments_091369.json:
```json
{
    "body": "Changing dependencies from \"#5847\" to \"#5847, #9858, #11896\"",
    "created_at": "2011-10-11T07:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91369",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#5847" to "#5847, #9858, #11896"



---

archive/issue_comments_091370.json:
```json
{
    "body": "<a id='comment:1'></a>\nUnmerging this because of #9858 and #11896.",
    "created_at": "2011-10-11T07:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91370",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>
Unmerging this because of #9858 and #11896.



---

archive/issue_comments_091371.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-10-11T07:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91371",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_091372.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-10-11T07:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91372",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_091373.json:
```json
{
    "body": "<a id='comment:4'></a>\nAnother cyclic dependency... ;-) (#11698 depends on this ticket)\n\n---\n\nA new FLINT spkg (still 1.5.0, a p10) fixing the FLINT test suite build error (occurring in combination with any recent GMP / MPIR version like the one here) by just applying an upstream patch from FLINT 1.5.2 is ready for review at #9858.\n\n(FLINT 1.5.2 and 1.6 spkgs will now most probably be on follow-up tickets to #9858.)",
    "created_at": "2011-10-11T22:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91373",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'></a>
Another cyclic dependency... ;-) (#11698 depends on this ticket)

---

A new FLINT spkg (still 1.5.0, a p10) fixing the FLINT test suite build error (occurring in combination with any recent GMP / MPIR version like the one here) by just applying an upstream patch from FLINT 1.5.2 is ready for review at #9858.

(FLINT 1.5.2 and 1.6 spkgs will now most probably be on follow-up tickets to #9858.)



---

archive/issue_comments_091374.json:
```json
{
    "body": "<a id='comment:135'></a>\nReplying to [leif](#comment%3A134):\n> Another cyclic dependency... ;-) (#11698 depends on this ticket)\n\n\nOoops, #11896 of course. XD\n\n(But I'll try to review #11698 anyway.)",
    "created_at": "2011-10-11T22:32:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91374",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:135'></a>
Replying to [leif](#comment%3A134):
> Another cyclic dependency... ;-) (#11698 depends on this ticket)


Ooops, #11896 of course. XD

(But I'll try to review #11698 anyway.)



---

archive/issue_events_033534.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-14T09:41:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33534"
}
```



---

archive/issue_comments_091375.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-10-14T09:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91375",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_091376.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.7.3.alpha0\"",
    "created_at": "2011-10-14T09:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91376",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-4.7.3.alpha0"



---

archive/issue_comments_091377.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91377",
    "user": "https://github.com/jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_events_033535.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-03T16:15:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "milestone": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8664#event-33535"
}
```



---

archive/issue_comments_091378.json:
```json
{
    "body": "Changing merged from \"sage-4.7.3.alpha0\" to \"sage-4.8.alpha0\"",
    "created_at": "2011-11-03T16:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91378",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "sage-4.7.3.alpha0" to "sage-4.8.alpha0"



---

archive/issue_comments_091379.json:
```json
{
    "body": "<a id='comment:139'></a>\nReplying to [leif](#comment%3A46):\n> Any reason to keep\n> \n> ```\n> #!sh\n>     SAGE_CONF_OPTS=\"--enable-shared --disable-static\"\n> ```\n> (i.e., why not build the static library, too)?\n> \n\nAs it turns out, this change seems to break MPIR on Cygwin.  See [this sage-windows thread](http://groups.google.com/group/sage-windows/browse_thread/thread/be2b2af416351c9b).",
    "created_at": "2011-12-03T19:08:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8664#issuecomment-91379",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:139'></a>
Replying to [leif](#comment%3A46):
> Any reason to keep
> 
> ```
> #!sh
>     SAGE_CONF_OPTS="--enable-shared --disable-static"
> ```
> (i.e., why not build the static library, too)?
> 

As it turns out, this change seems to break MPIR on Cygwin.  See [this sage-windows thread](http://groups.google.com/group/sage-windows/browse_thread/thread/be2b2af416351c9b).
