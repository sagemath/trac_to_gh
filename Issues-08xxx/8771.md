# Issue 8771: Sage-4.4 + GCC-4.5.0 -- sage fails to startup due to libzn_poly missing symbol issue (ZNP_mpn_mulmid_fallback_thresh)

archive/issues_008771.json:
```json
{
    "body": "The machine\n\n```\n[wstein@lena sage-4.4]$ uname -a\nLinux lena 2.6.31.12-174.2.19.fc12.x86_64 #1 SMP Thu Feb 11 07:07:16 UTC 2010 x86_64 x86_64 x86_64 GNU/Linux\n[wstein@lena sage-4.4]$ cat /etc/issue\nFedora release 12 (Constantine)\nKernel \\r on an \\m (\\l)\n\n[wstein@lena sage-4.4]$ gcc -v\nUsing built-in specs.\nCOLLECT_GCC=gcc\nCOLLECT_LTO_WRAPPER=/usr/local/gcc-4.5.0/x86_64-Linux-k10-fc/libexec/gcc/x86_64-unknown-linux-gnu/4.5.0/lto-wrapper\nTarget: x86_64-unknown-linux-gnu\nConfigured with: /usr/local/gcc-4.5.0/src/gcc-4.5.0/configure --enable-languages=c,c++,fortran --with-gnu-as --with-gnu-as=/usr/local/binutils-2.20.1/x86_64-Linux-k10-fc-gcc-4.4.3/bin/as --with-gnu-ld --with-ld=/usr/local/binutils-2.20.1/x86_64-Linux-k10-fc-gcc-4.4.3/bin/ld --with-gmp=/usr/local/mpir-1.2.2/x86_64-Linux-k10-gcc-4.2.2 --with-mpfr=/usr/local/mpfr-2.4.2/x86_64-Linux-k10-fc-mpir-1.2.2-gcc-4.4.2 --with-mpc=/usr/local/mpc-0.8.1/x86_64-Linux-k10-fc-mpfr-2.4.2-mpir-1.2.2-gcc-4.4.3 --prefix=/usr/local/gcc-4.5.0/x86_64-Linux-k10-fc\nThread model: posix\ngcc version 4.5.0 (GCC)\n```\n\nThe error, after building Sage seems to finish fine:\n\n```\n./sage \n...\nboom!\n...\nImportError: /home/wstein/screen/lena/sage-4.4/local/lib/libzn_poly-0.9.so: undefined symbol: ZNP_mpn_mulmid_fallback_thresh\n```\n\nAssignee: GeorgSWeber\n\nUpstream: Reported upstream. Little or no feedback.\n\nReviewer: William Stein\n\nAuthor: Willem Jan Palenstijn\n\nMerged: sage-4.4.1.alpha0\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/8771\n\n",
    "closed_at": "2010-04-28T19:17:27Z",
    "created_at": "2010-04-26T20:53:40Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.4.1",
    "title": "Sage-4.4 + GCC-4.5.0 -- sage fails to startup due to libzn_poly missing symbol issue (ZNP_mpn_mulmid_fallback_thresh)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8771",
    "user": "https://github.com/williamstein"
}
```
The machine

```
[wstein@lena sage-4.4]$ uname -a
Linux lena 2.6.31.12-174.2.19.fc12.x86_64 #1 SMP Thu Feb 11 07:07:16 UTC 2010 x86_64 x86_64 x86_64 GNU/Linux
[wstein@lena sage-4.4]$ cat /etc/issue
Fedora release 12 (Constantine)
Kernel \r on an \m (\l)

[wstein@lena sage-4.4]$ gcc -v
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/local/gcc-4.5.0/x86_64-Linux-k10-fc/libexec/gcc/x86_64-unknown-linux-gnu/4.5.0/lto-wrapper
Target: x86_64-unknown-linux-gnu
Configured with: /usr/local/gcc-4.5.0/src/gcc-4.5.0/configure --enable-languages=c,c++,fortran --with-gnu-as --with-gnu-as=/usr/local/binutils-2.20.1/x86_64-Linux-k10-fc-gcc-4.4.3/bin/as --with-gnu-ld --with-ld=/usr/local/binutils-2.20.1/x86_64-Linux-k10-fc-gcc-4.4.3/bin/ld --with-gmp=/usr/local/mpir-1.2.2/x86_64-Linux-k10-gcc-4.2.2 --with-mpfr=/usr/local/mpfr-2.4.2/x86_64-Linux-k10-fc-mpir-1.2.2-gcc-4.4.2 --with-mpc=/usr/local/mpc-0.8.1/x86_64-Linux-k10-fc-mpfr-2.4.2-mpir-1.2.2-gcc-4.4.3 --prefix=/usr/local/gcc-4.5.0/x86_64-Linux-k10-fc
Thread model: posix
gcc version 4.5.0 (GCC)
```

The error, after building Sage seems to finish fine:

```
./sage 
...
boom!
...
ImportError: /home/wstein/screen/lena/sage-4.4/local/lib/libzn_poly-0.9.so: undefined symbol: ZNP_mpn_mulmid_fallback_thresh
```

Assignee: GeorgSWeber

Upstream: Reported upstream. Little or no feedback.

Reviewer: William Stein

Author: Willem Jan Palenstijn

Merged: sage-4.4.1.alpha0

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/8771





---

archive/issue_comments_080141.json:
```json
{
    "body": "<a id='comment:1'></a>wjp figured out that this boils down to some tuning program not getting built:\n\n```\nsage subshell$ gcc -fPIC -std=c99 -O3 -L. -I/home/wstein/screen/eno/sage-4.4/local/include -I./include -DNDEBUG -o tune/mulmid-tune.o -c tune/mulmid-tune.c\ntune/mulmid-tune.c: In function \u2018ZNP_tune_mulmid\u2019:\ntune/mulmid-tune.c:85:10: error: jump into scope of identifier with variably modified type\ntune/mulmid-tune.c:135:7: note: label \u2018done\u2019 defined here\ntune/mulmid-tune.c:115:14: note: \u2018score\u2019 declared here\ntune/mulmid-tune.c:85:10: error: jump into scope of identifier with variably modified type\ntune/mulmid-tune.c:135:7: note: label \u2018done\u2019 defined here\ntune/mulmid-tune.c:114:14: note: \u2018points\u2019 declared here\ntune/mulmid-tune.c:108:10: error: jump into scope of identifier with variably modified type\ntune/mulmid-tune.c:135:7: note: label \u2018done\u2019 defined here\ntune/mulmid-tune.c:115:14: note: \u2018score\u2019 declared here\ntune/mulmid-tune.c:108:10: error: jump into scope of identifier with variably modified type\ntune/mulmid-tune.c:135:7: note: label \u2018done\u2019 defined here\ntune/mulmid-tune.c:114:14: note: \u2018points\u2019 declared here\n/home/wstein/screen/eno/sage-4.4\nsage subshell$                     \n```\n\nFor this, \n\n```\n14:26 < wjp> the fix is to move the lines\n14:26 < wjp>       const int max_intervals = 20;\n14:26 < wjp>       size_t points[max_intervals + 1];\n14:26 < wjp>       double score[max_intervals + 1];\n14:26 < wjp> up a bit to at least above the goto\n```\nbut... \n\n```\n4:26 < wjp> but after doing that it is now complaining about a missing ZNP_tuning_info when linking 'tune'\n```",
    "created_at": "2010-04-26T21:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8771",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8771#issuecomment-80141",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:1'></a>wjp figured out that this boils down to some tuning program not getting built:

```
sage subshell$ gcc -fPIC -std=c99 -O3 -L. -I/home/wstein/screen/eno/sage-4.4/local/include -I./include -DNDEBUG -o tune/mulmid-tune.o -c tune/mulmid-tune.c
tune/mulmid-tune.c: In function ‘ZNP_tune_mulmid’:
tune/mulmid-tune.c:85:10: error: jump into scope of identifier with variably modified type
tune/mulmid-tune.c:135:7: note: label ‘done’ defined here
tune/mulmid-tune.c:115:14: note: ‘score’ declared here
tune/mulmid-tune.c:85:10: error: jump into scope of identifier with variably modified type
tune/mulmid-tune.c:135:7: note: label ‘done’ defined here
tune/mulmid-tune.c:114:14: note: ‘points’ declared here
tune/mulmid-tune.c:108:10: error: jump into scope of identifier with variably modified type
tune/mulmid-tune.c:135:7: note: label ‘done’ defined here
tune/mulmid-tune.c:115:14: note: ‘score’ declared here
tune/mulmid-tune.c:108:10: error: jump into scope of identifier with variably modified type
tune/mulmid-tune.c:135:7: note: label ‘done’ defined here
tune/mulmid-tune.c:114:14: note: ‘points’ declared here
/home/wstein/screen/eno/sage-4.4
sage subshell$                     
```

For this, 

```
14:26 < wjp> the fix is to move the lines
14:26 < wjp>       const int max_intervals = 20;
14:26 < wjp>       size_t points[max_intervals + 1];
14:26 < wjp>       double score[max_intervals + 1];
14:26 < wjp> up a bit to at least above the goto
```
but... 

```
4:26 < wjp> but after doing that it is now complaining about a missing ZNP_tuning_info when linking 'tune'
```



---

archive/issue_comments_080142.json:
```json
{
    "body": "<a id='comment:2'></a>I fixed the compile errors by moving the offending \"identifiers with variably modified type\" to above the goto, and added a check to the `spkg-install` script to see if building this tune program failed.\n\nNew spkg at:\n\nhttp://www.math.leidenuniv.nl/~wpalenst/sage/zn_poly-0.9.p4.spkg",
    "created_at": "2010-04-26T21:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8771",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8771#issuecomment-80142",
    "user": "https://github.com/wjp"
}
```

<a id='comment:2'></a>I fixed the compile errors by moving the offending "identifiers with variably modified type" to above the goto, and added a check to the `spkg-install` script to see if building this tune program failed.

New spkg at:

http://www.math.leidenuniv.nl/~wpalenst/sage/zn_poly-0.9.p4.spkg



---

archive/issue_comments_080143.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-04-26T21:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8771",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8771#issuecomment-80143",
    "user": "https://github.com/wjp"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_080144.json:
```json
{
    "body": "<a id='comment:3'></a>Even new spkg here (with some slight referee improvements): \n\n          http://wstein.org/home/wstein/patches/zn_poly-0.9.p4.spkg",
    "created_at": "2010-04-26T22:19:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8771",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8771#issuecomment-80144",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:3'></a>Even new spkg here (with some slight referee improvements): 

          http://wstein.org/home/wstein/patches/zn_poly-0.9.p4.spkg



---

archive/issue_comments_080145.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-04-26T22:19:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8771",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8771#issuecomment-80145",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_080146.json:
```json
{
    "body": "<a id='comment:4'></a>```\n15:21 < wjp> ok, your extra changes look good to me too\n```",
    "created_at": "2010-04-26T22:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8771",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8771#issuecomment-80146",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:4'></a>```
15:21 < wjp> ok, your extra changes look good to me too
```



---

archive/issue_events_021359.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-04-28T19:17:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8771",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8771#event-21359"
}
```



---

archive/issue_comments_080147.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-04-28T19:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8771",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8771#issuecomment-80147",
    "user": "https://github.com/williamstein"
}
```

Resolution: fixed



---

archive/issue_comments_080148.json:
```json
{
    "body": "<a id='comment:9'></a>Only the changelog entry references the wrong ticket (#8711); now fixed at #12433...",
    "created_at": "2012-04-20T02:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8771",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8771#issuecomment-80148",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'></a>Only the changelog entry references the wrong ticket (#8711); now fixed at #12433...
