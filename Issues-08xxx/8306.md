# Issue 8306: Parallel inter/intra-spkg builds

archive/issues_008306.json:
```json
{
    "body": "Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.\n\nTo build multiple spkgs in parallel:\n\n* Start with Sage 4.4.4.\n* Update [attachment:makefile], `spkg/`[attachment:install], and `spkg/standard/`[attachment:deps].\n* Copy [attachment:pipestatus] to `spkg/`.\n* Copy the latest spkgs from #8645 (Maxima), #9185 (Singular), #9186 (R), and #9264 (ECL) to `spkg/standard`.\n* `export SAGE_PARALLEL_SPKG_BUILD=\"yes\"`\n* `export MAKE=\"make -jX\"` where `X > 1`\n* `make`\n\nAlso:\n\n* Apply [attachment:trac_8306_scripts-spkg_log_files.2.patch] to the scripts repository.  This makes `sage -i foo-X.Y.spkg` *also* append to `spkg/logs/foo-X.Y.log`.\n\n* Apply [attachment:trac_8306_scripts-pipestatus.patch] to the scripts repository.  This ensures that `sage -sdist <VERSION>` includes `pipestatus` in a new Sage source distribution.\n\n**Assignee:** GeorgSWeber\n\n**CC:**  @mwhansen mvngu\n\n**Author:** Mitesh Patel, John Palmieri\n\n**Reviewer:** David Kirkby, John Palmieri\n\n**Merged:** sage-4.5.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/8306\n\n",
    "closed_at": "2010-06-25T15:40:56Z",
    "created_at": "2010-02-19T11:31:16Z",
    "labels": [
        "component: build",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.5",
    "title": "Parallel inter/intra-spkg builds",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8306",
    "user": "https://github.com/qed777"
}
```
Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.

To build multiple spkgs in parallel:

* Start with Sage 4.4.4.
* Update [attachment:makefile], `spkg/`[attachment:install], and `spkg/standard/`[attachment:deps].
* Copy [attachment:pipestatus] to `spkg/`.
* Copy the latest spkgs from #8645 (Maxima), #9185 (Singular), #9186 (R), and #9264 (ECL) to `spkg/standard`.
* `export SAGE_PARALLEL_SPKG_BUILD="yes"`
* `export MAKE="make -jX"` where `X > 1`
* `make`

Also:

* Apply [attachment:trac_8306_scripts-spkg_log_files.2.patch] to the scripts repository.  This makes `sage -i foo-X.Y.spkg` *also* append to `spkg/logs/foo-X.Y.log`.

* Apply [attachment:trac_8306_scripts-pipestatus.patch] to the scripts repository.  This ensures that `sage -sdist <VERSION>` includes `pipestatus` in a new Sage source distribution.

**Assignee:** GeorgSWeber

**CC:**  @mwhansen mvngu

**Author:** Mitesh Patel, John Palmieri

**Reviewer:** David Kirkby, John Palmieri

**Merged:** sage-4.5.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/8306





---

archive/issue_comments_085139.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.\n \n See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.\n+\n+Note: We should drop `$(INST)/$(MPIR)` from `$(GAP)`'s dependencies (see [sage-devel](http://groups.google.com/group/sage-devel/msg/c97a99f23ea576b7)) and other obsolete targets.\n``````\n",
    "created_at": "2010-02-19T11:36:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85139",
    "user": "https://github.com/qed777"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.
 
 See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.
+
+Note: We should drop `$(INST)/$(MPIR)` from `$(GAP)`'s dependencies (see [sage-devel](http://groups.google.com/group/sage-devel/msg/c97a99f23ea576b7)) and other obsolete targets.
``````




---

archive/issue_comments_085140.json:
```json
{
    "body": "<a id='comment:2'></a>\nSee #7943 and #8191 for recent changes to `makefile`, `spkg/install`, and `spkg/standard/deps`.",
    "created_at": "2010-02-25T11:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85140",
    "user": "https://github.com/qed777"
}
```

<a id='comment:2'></a>
See #7943 and #8191 for recent changes to `makefile`, `spkg/install`, and `spkg/standard/deps`.



---

archive/issue_comments_085141.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,21 @@\n-Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.\n+Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.\n \n-See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.\n+The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.3 + #7552 + #8191 + #7943.  Notes:\n \n-Note: We should drop `$(INST)/$(MPIR)` from `$(GAP)`'s dependencies (see [sage-devel](http://groups.google.com/group/sage-devel/msg/c97a99f23ea576b7)) and other obsolete targets.\n+* It seems that prefixing a command with `+` (see `deps`) tells GNU make to attempt to propagate `$MAKE` to sub-makes.  Please see the [documentation](http://www.gnu.org/software/automake/manual/make/MAKE-Variable.html) (and the bottom of [this page](http://www.gnu.org/software/automake/manual/make/Error-Messages.html#Error-Messages)) for an exceptionally clear explanation.\n+\n+* In order to determine which commands could \"handle\" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, eclib, maxima, and singular.\n+\n+* I grouped packages installed by setuptools (twisted, zodb, pygments, jinja, jinja2, sphinx, sqlalchemy, sagenb) into one target, because setuptools does not consistently update `SAGE_LOCAL/lib/python/site-packages/easy-install.pth` in parallel.\n+\n+* I put the per-spkg build logs in `SAGE_ROOT/spkg/logs`.  Feel free to suggest a different place.  Note: I haven't (re)moved `install.log`.\n+\n+* I added iconv to gd's dependencies (cf. #8191).\n+\n+* I dropped mpir from gap's dependencies (see [sage-devel](http://groups.google.com/group/sage-devel/msg/c97a99f23ea576b7)).\n+\n+* I removed `$(GNUCRYPTOLIB)` and `$(TWISTEDWEB2)`, which appear to be unnecessary.\n+\n+* I removed several comments about Gnuplot, dvipng, etc.  These also seem to be obsolete.  I wasn't sure about the (Py)OpenSSL comments, so I left them.\n+\n+I'm not a `Makefile` expert.  Feel free to suggest improvements!\n``````\n",
    "created_at": "2010-02-25T17:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85141",
    "user": "https://github.com/qed777"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,21 @@
-Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.
+Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.
 
-See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.
+The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.3 + #7552 + #8191 + #7943.  Notes:
 
-Note: We should drop `$(INST)/$(MPIR)` from `$(GAP)`'s dependencies (see [sage-devel](http://groups.google.com/group/sage-devel/msg/c97a99f23ea576b7)) and other obsolete targets.
+* It seems that prefixing a command with `+` (see `deps`) tells GNU make to attempt to propagate `$MAKE` to sub-makes.  Please see the [documentation](http://www.gnu.org/software/automake/manual/make/MAKE-Variable.html) (and the bottom of [this page](http://www.gnu.org/software/automake/manual/make/Error-Messages.html#Error-Messages)) for an exceptionally clear explanation.
+
+* In order to determine which commands could "handle" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, eclib, maxima, and singular.
+
+* I grouped packages installed by setuptools (twisted, zodb, pygments, jinja, jinja2, sphinx, sqlalchemy, sagenb) into one target, because setuptools does not consistently update `SAGE_LOCAL/lib/python/site-packages/easy-install.pth` in parallel.
+
+* I put the per-spkg build logs in `SAGE_ROOT/spkg/logs`.  Feel free to suggest a different place.  Note: I haven't (re)moved `install.log`.
+
+* I added iconv to gd's dependencies (cf. #8191).
+
+* I dropped mpir from gap's dependencies (see [sage-devel](http://groups.google.com/group/sage-devel/msg/c97a99f23ea576b7)).
+
+* I removed `$(GNUCRYPTOLIB)` and `$(TWISTEDWEB2)`, which appear to be unnecessary.
+
+* I removed several comments about Gnuplot, dvipng, etc.  These also seem to be obsolete.  I wasn't sure about the (Py)OpenSSL comments, so I left them.
+
+I'm not a `Makefile` expert.  Feel free to suggest improvements!
``````




---

archive/issue_comments_085142.json:
```json
{
    "body": "**Author:** Mitesh Patel",
    "created_at": "2010-02-25T17:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85142",
    "user": "https://github.com/qed777"
}
```

**Author:** Mitesh Patel



---

archive/issue_events_024255.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-02-25T17:27:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "milestone": "sage-4.3.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8306#event-24255"
}
```



---

archive/issue_comments_085143.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2010-02-25T17:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85143",
    "user": "https://github.com/qed777"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_085144.json:
```json
{
    "body": "<a id='comment:4'></a>\nWith a \"primed\" compiler cache, i.e., I've already built Sage at least once, I can build Sage sans docs in about 15-20 minutes on an otherwise mostly idle sage.math --- with `make -j20`.  The long doctests pass (after I've built the docs).",
    "created_at": "2010-02-25T17:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85144",
    "user": "https://github.com/qed777"
}
```

<a id='comment:4'></a>
With a "primed" compiler cache, i.e., I've already built Sage at least once, I can build Sage sans docs in about 15-20 minutes on an otherwise mostly idle sage.math --- with `make -j20`.  The long doctests pass (after I've built the docs).



---

archive/issue_comments_085145.json:
```json
{
    "body": "<a id='comment:5'></a>\nWhat is it about eclib which makes this fail?  I would be happy to change it if only I knew -- the \"exceptionally clear explanation\" you refer to was not quite clear enough for me...  John",
    "created_at": "2010-02-25T19:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85145",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:5'></a>
What is it about eclib which makes this fail?  I would be happy to change it if only I knew -- the "exceptionally clear explanation" you refer to was not quite clear enough for me...  John



---

archive/issue_comments_085146.json:
```json
{
    "body": "<a id='comment:6'></a>\nOops.  That was an attempt at humor.\n\nI don't know why the build fails.  [Here's a log](http://sage.math.washington.edu/home/mpatel/trac/8306/eclib-20080310.p9.log) from building eclib with `+`.\n\nA possibly related problem is that the top-level make doesn't notice the error.  It keeps going until \"Sage build/upgrade complete!\".  I'll see what happens if I add `$(INST)/$(ECLIB)` to \"all\"'s list of dependencies.",
    "created_at": "2010-02-26T23:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85146",
    "user": "https://github.com/qed777"
}
```

<a id='comment:6'></a>
Oops.  That was an attempt at humor.

I don't know why the build fails.  [Here's a log](http://sage.math.washington.edu/home/mpatel/trac/8306/eclib-20080310.p9.log) from building eclib with `+`.

A possibly related problem is that the top-level make doesn't notice the error.  It keeps going until "Sage build/upgrade complete!".  I'll see what happens if I add `$(INST)/$(ECLIB)` to "all"'s list of dependencies.



---

archive/issue_comments_085147.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [mpatel](#comment%3A6):\n> [...] I'll see what happens if I add `$(INST)/$(ECLIB)` to \"all\"'s list of dependencies.\n\nSame result.  All of the other spkgs build properly.  But I definitely need to figure out why this happens with eclib and check the other spkgs for similar potential behavior.",
    "created_at": "2010-02-27T03:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85147",
    "user": "https://github.com/qed777"
}
```

<a id='comment:7'></a>
Replying to [mpatel](#comment%3A6):
> [...] I'll see what happens if I add `$(INST)/$(ECLIB)` to "all"'s list of dependencies.

Same result.  All of the other spkgs build properly.  But I definitely need to figure out why this happens with eclib and check the other spkgs for similar potential behavior.



---

archive/issue_comments_085148.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2010-02-27T03:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85148",
    "user": "https://github.com/qed777"
}
```

**Changing status** from needs_review to needs_work.



---

archive/attachments_010256.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "eclib_makefiles.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8306/eclib_makefiles.patch",
    "created_at": "2010-02-27T05:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/qed777"
}
```



---

archive/issue_comments_085149.json:
```json
{
    "body": "Tweak eclib `Makefile`s so it builds with `+`.  eclib src repo.",
    "created_at": "2010-02-27T05:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85149",
    "user": "https://github.com/qed777"
}
```

Tweak eclib `Makefile`s so it builds with `+`.  eclib src repo.



---

archive/issue_comments_085150.json:
```json
{
    "body": "<a id='comment:8'></a>\n[attachment:eclib_makefiles.patch This patch] gets eclib to build with `+`.  I noticed that eclib's `spkg-install` contains\n\n```sh\nif [ \"$MAKE\" == gmake ]; then \n   echo \"using gmake\"\nelse\n   echo \"Disabling parallel make for now\"\n   MAKE=make; export $MAKE\nfi\n```\nIs there a particular reason for this?",
    "created_at": "2010-02-27T05:45:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85150",
    "user": "https://github.com/qed777"
}
```

<a id='comment:8'></a>
[attachment:eclib_makefiles.patch This patch] gets eclib to build with `+`.  I noticed that eclib's `spkg-install` contains

```sh
if [ "$MAKE" == gmake ]; then 
   echo "using gmake"
else
   echo "Disabling parallel make for now"
   MAKE=make; export $MAKE
fi
```
Is there a particular reason for this?



---

archive/issue_comments_085151.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-02-27T06:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85151",
    "user": "https://github.com/qed777"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_085152.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,10 +1,12 @@\n Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.\n \n-The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.3 + #7552 + #8191 + #7943.  Notes:\n+The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.3 + #7552 + #8191 + #7943 and a [attachment:eclib_makefiles.patch patched] eclib spkg.  Notes:\n+\n+* To build multiple spkgs simultaneously, please replace `PARALLEL_SPKG_BUILD=\"no\"` with `PARALLEL_SPKG_BUILD=\"yes\"` near the top of `deps` and `export MAKE=\"make -jX\"`, where `X > 1`.  With the default (`\"no\"`), builds should proceed as before.\n \n * It seems that prefixing a command with `+` (see `deps`) tells GNU make to attempt to propagate `$MAKE` to sub-makes.  Please see the [documentation](http://www.gnu.org/software/automake/manual/make/MAKE-Variable.html) (and the bottom of [this page](http://www.gnu.org/software/automake/manual/make/Error-Messages.html#Error-Messages)) for an exceptionally clear explanation.\n \n-* In order to determine which commands could \"handle\" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, eclib, maxima, and singular.\n+* In order to determine which commands could \"handle\" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, maxima, and singular.\n \n * I grouped packages installed by setuptools (twisted, zodb, pygments, jinja, jinja2, sphinx, sqlalchemy, sagenb) into one target, because setuptools does not consistently update `SAGE_LOCAL/lib/python/site-packages/easy-install.pth` in parallel.\n \n``````\n",
    "created_at": "2010-02-27T06:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85152",
    "user": "https://github.com/qed777"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,10 +1,12 @@
 Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.
 
-The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.3 + #7552 + #8191 + #7943.  Notes:
+The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.3 + #7552 + #8191 + #7943 and a [attachment:eclib_makefiles.patch patched] eclib spkg.  Notes:
+
+* To build multiple spkgs simultaneously, please replace `PARALLEL_SPKG_BUILD="no"` with `PARALLEL_SPKG_BUILD="yes"` near the top of `deps` and `export MAKE="make -jX"`, where `X > 1`.  With the default (`"no"`), builds should proceed as before.
 
 * It seems that prefixing a command with `+` (see `deps`) tells GNU make to attempt to propagate `$MAKE` to sub-makes.  Please see the [documentation](http://www.gnu.org/software/automake/manual/make/MAKE-Variable.html) (and the bottom of [this page](http://www.gnu.org/software/automake/manual/make/Error-Messages.html#Error-Messages)) for an exceptionally clear explanation.
 
-* In order to determine which commands could "handle" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, eclib, maxima, and singular.
+* In order to determine which commands could "handle" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, maxima, and singular.
 
 * I grouped packages installed by setuptools (twisted, zodb, pygments, jinja, jinja2, sphinx, sqlalchemy, sagenb) into one target, because setuptools does not consistently update `SAGE_LOCAL/lib/python/site-packages/easy-install.pth` in parallel.
 
``````




---

archive/issue_comments_085153.json:
```json
{
    "body": "<a id='comment:10'></a>\nI've updated the attachments so the usual build behavior is the default.  To tell make it's OK to build multiple spkgs at a time, set `PARALLEL_SPKG_BUILD=\"yes\"` near the top of `spkg/standard/deps`.\n\nThe new `deps` \"depends\" on an eclib spkg with [attachment:eclib_makefiles.patch] (or an equivalent).  Should I make it part of #8357?",
    "created_at": "2010-02-27T07:09:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85153",
    "user": "https://github.com/qed777"
}
```

<a id='comment:10'></a>
I've updated the attachments so the usual build behavior is the default.  To tell make it's OK to build multiple spkgs at a time, set `PARALLEL_SPKG_BUILD="yes"` near the top of `spkg/standard/deps`.

The new `deps` "depends" on an eclib spkg with [attachment:eclib_makefiles.patch] (or an equivalent).  Should I make it part of #8357?



---

archive/issue_comments_085154.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.3 + #7552 + #8191 + #7943 and a [attachment:eclib_makefiles.patch patched] eclib spkg.  Notes:\n \n-* To build multiple spkgs simultaneously, please replace `PARALLEL_SPKG_BUILD=\"no\"` with `PARALLEL_SPKG_BUILD=\"yes\"` near the top of `deps` and `export MAKE=\"make -jX\"`, where `X > 1`.  With the default (`\"no\"`), builds should proceed as before.\n+* To build multiple spkgs simultaneously, please replace `PARALLEL_SPKG_BUILD=\"no\"` with `PARALLEL_SPKG_BUILD=\"yes\"` near the top of `install` and `export MAKE=\"make -jX\"`, where `X > 1`.  With the default (`\"no\"`), builds should proceed as before.\n \n * It seems that prefixing a command with `+` (see `deps`) tells GNU make to attempt to propagate `$MAKE` to sub-makes.  Please see the [documentation](http://www.gnu.org/software/automake/manual/make/MAKE-Variable.html) (and the bottom of [this page](http://www.gnu.org/software/automake/manual/make/Error-Messages.html#Error-Messages)) for an exceptionally clear explanation.\n \n``````\n",
    "created_at": "2010-02-27T07:10:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85154",
    "user": "https://github.com/qed777"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.3 + #7552 + #8191 + #7943 and a [attachment:eclib_makefiles.patch patched] eclib spkg.  Notes:
 
-* To build multiple spkgs simultaneously, please replace `PARALLEL_SPKG_BUILD="no"` with `PARALLEL_SPKG_BUILD="yes"` near the top of `deps` and `export MAKE="make -jX"`, where `X > 1`.  With the default (`"no"`), builds should proceed as before.
+* To build multiple spkgs simultaneously, please replace `PARALLEL_SPKG_BUILD="no"` with `PARALLEL_SPKG_BUILD="yes"` near the top of `install` and `export MAKE="make -jX"`, where `X > 1`.  With the default (`"no"`), builds should proceed as before.
 
 * It seems that prefixing a command with `+` (see `deps`) tells GNU make to attempt to propagate `$MAKE` to sub-makes.  Please see the [documentation](http://www.gnu.org/software/automake/manual/make/MAKE-Variable.html) (and the bottom of [this page](http://www.gnu.org/software/automake/manual/make/Error-Messages.html#Error-Messages)) for an exceptionally clear explanation.
 
``````




---

archive/issue_comments_085155.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [mpatel](#comment%3A10):\n> I've updated the attachments so the usual build behavior is the default.  To tell make it's OK to build multiple spkgs at a time, set `PARALLEL_SPKG_BUILD=\"yes\"` near the top of `spkg/standard/deps`.\n\nThat should be \"near the top of `spkg/install`.\"",
    "created_at": "2010-02-27T07:10:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85155",
    "user": "https://github.com/qed777"
}
```

<a id='comment:12'></a>
Replying to [mpatel](#comment%3A10):
> I've updated the attachments so the usual build behavior is the default.  To tell make it's OK to build multiple spkgs at a time, set `PARALLEL_SPKG_BUILD="yes"` near the top of `spkg/standard/deps`.

That should be "near the top of `spkg/install`."



---

archive/issue_comments_085156.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2010-02-27T10:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85156",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_085157.json:
```json
{
    "body": "**Reviewer:** David Kirkby",
    "created_at": "2010-02-27T10:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85157",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Reviewer:** David Kirkby



---

archive/issue_comments_085158.json:
```json
{
    "body": "<a id='comment:13'></a>\nThe idea seems excellent. Ir is such a waste on modern machines to \n\nI think it would be a lot better if an environment variable SAGE_PARALLEL_BUILD or SAGE_PARALLEL_SPKG_BUILD was set to \"yes\", rather than require the user to edit the spkg/install. Since virtually all other environement variables are prefixed with SAGE (e.g. SAGE_FORTRAN, SAGE_FORTRAN_LIB, SAGE64 ...) I would do likewise for consistency. \n\nIt would be necessary to test this on different architectures and operating systems. It is quite possible that the time different packages take to build differs vastly by the processor and operating system. It is likely that package X always builds in parallel before package Y on sage.math, but Y would build before X on another system. That could well mean there are dependencies existing that are not apparerent in serial builds. \n\nFor example, ATLAS takes at least 10x as long to build on 't2' as it does on my own SPARC, simply because there are no default tuning parameters for ATLAS on t2, so it is tuned each time. That is an extreme example, but it is well known some machine are faster at some tasks than others, but slower on other tasks. Some packages have assembly language support for certain processors, but not others. Several packages go through some sort of tuning process to determine the optimal build parameters. So the timings could be expected to be different on different operating systems. \n\nAt the very least, this should be tested on t2 and bsd, as they run Solaris and OS X repectively. (When testing on t2, I would suggest using j of 256 or 512. That machine has 128 threads). For t2, one would need to use sage 4.3.0.1. (I think any changes to spkg/install and spkg/standard/deps should minimal between 4.3.0.1 and 4.3.3.  There are probably no changes at all. \n\nIt would be safer to compare the md5 checksums of libraries & binaries built in series and parallel to prove they are indeed the same. It is quite possible that there are failures that just do not get exercised by doctests. However, that may not be fully possible, as perhaps some would have the build time information encoded in some way. But I would at least investigate. \n\nOverall, I think this is a really **excellent** idea, but it needs further testing before I'd want to give it a positive review. \n\nDave",
    "created_at": "2010-02-27T10:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85158",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:13'></a>
The idea seems excellent. Ir is such a waste on modern machines to 

I think it would be a lot better if an environment variable SAGE_PARALLEL_BUILD or SAGE_PARALLEL_SPKG_BUILD was set to "yes", rather than require the user to edit the spkg/install. Since virtually all other environement variables are prefixed with SAGE (e.g. SAGE_FORTRAN, SAGE_FORTRAN_LIB, SAGE64 ...) I would do likewise for consistency. 

It would be necessary to test this on different architectures and operating systems. It is quite possible that the time different packages take to build differs vastly by the processor and operating system. It is likely that package X always builds in parallel before package Y on sage.math, but Y would build before X on another system. That could well mean there are dependencies existing that are not apparerent in serial builds. 

For example, ATLAS takes at least 10x as long to build on 't2' as it does on my own SPARC, simply because there are no default tuning parameters for ATLAS on t2, so it is tuned each time. That is an extreme example, but it is well known some machine are faster at some tasks than others, but slower on other tasks. Some packages have assembly language support for certain processors, but not others. Several packages go through some sort of tuning process to determine the optimal build parameters. So the timings could be expected to be different on different operating systems. 

At the very least, this should be tested on t2 and bsd, as they run Solaris and OS X repectively. (When testing on t2, I would suggest using j of 256 or 512. That machine has 128 threads). For t2, one would need to use sage 4.3.0.1. (I think any changes to spkg/install and spkg/standard/deps should minimal between 4.3.0.1 and 4.3.3.  There are probably no changes at all. 

It would be safer to compare the md5 checksums of libraries & binaries built in series and parallel to prove they are indeed the same. It is quite possible that there are failures that just do not get exercised by doctests. However, that may not be fully possible, as perhaps some would have the build time information encoded in some way. But I would at least investigate. 

Overall, I think this is a really **excellent** idea, but it needs further testing before I'd want to give it a positive review. 

Dave



---

archive/issue_comments_085159.json:
```json
{
    "body": "<a id='comment:14'></a>\nI didn't write eclib's spkg-install, and I know that several people have changed it in the past -- there's at least one ticket out there specifically about managing eclib's Makefiles.\n\nNext time someone edits it they should change the two occurrences of \"cremona\" in error messages to \"eclib\".",
    "created_at": "2010-02-27T11:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85159",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:14'></a>
I didn't write eclib's spkg-install, and I know that several people have changed it in the past -- there's at least one ticket out there specifically about managing eclib's Makefiles.

Next time someone edits it they should change the two occurrences of "cremona" in error messages to "eclib".



---

archive/issue_comments_085160.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [cremona](#comment%3A14):\n> I didn't write eclib's spkg-install, and I know that several people have changed it in the past -- there's at least one ticket out there specifically about managing eclib's Makefiles.\n\nIndeed, the workaround is from #4228.\n> Next time someone edits it they should change the two occurrences of \"cremona\" in error messages to \"eclib\".\n\nI'll make a new spkg available at #8357.",
    "created_at": "2010-02-27T22:58:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85160",
    "user": "https://github.com/qed777"
}
```

<a id='comment:15'></a>
Replying to [cremona](#comment%3A14):
> I didn't write eclib's spkg-install, and I know that several people have changed it in the past -- there's at least one ticket out there specifically about managing eclib's Makefiles.

Indeed, the workaround is from #4228.
> Next time someone edits it they should change the two occurrences of "cremona" in error messages to "eclib".

I'll make a new spkg available at #8357.



---

archive/issue_comments_085161.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [mpatel](#comment%3A15):\n> I'll make a new spkg available at #8357.\n\nDone, with a provisional version, at least.",
    "created_at": "2010-02-28T00:25:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85161",
    "user": "https://github.com/qed777"
}
```

<a id='comment:16'></a>
Replying to [mpatel](#comment%3A15):
> I'll make a new spkg available at #8357.

Done, with a provisional version, at least.



---

archive/issue_comments_085162.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [drkirkby](#comment%3A13):\n\n> The idea seems excellent. Ir is such a waste on modern machines to\n\n\nThanks!  I'll get an account on bsd and try to test on both bsd and t2, as well.\n\n`SAGE_PARALLEL_SPKG_BUILD` looks good.\n\nMy motivation for making the new feature optional, for now, is so we can get feedback (via sage-devel) from early testers about a much wider range of build conditions and configurations.  It's likely they'll report problems, and we can attempt to solve them before we make it the default for everyone.",
    "created_at": "2010-02-28T01:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85162",
    "user": "https://github.com/qed777"
}
```

<a id='comment:17'></a>
Replying to [drkirkby](#comment%3A13):

> The idea seems excellent. Ir is such a waste on modern machines to


Thanks!  I'll get an account on bsd and try to test on both bsd and t2, as well.

`SAGE_PARALLEL_SPKG_BUILD` looks good.

My motivation for making the new feature optional, for now, is so we can get feedback (via sage-devel) from early testers about a much wider range of build conditions and configurations.  It's likely they'll report problems, and we can attempt to solve them before we make it the default for everyone.



---

archive/attachments_010257.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_8306_scripts-spkg_log_files.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8306/trac_8306_scripts-spkg_log_files.patch",
    "created_at": "2010-03-01T05:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/qed777"
}
```



---

archive/issue_comments_085163.json:
```json
{
    "body": "Make `sage -i foo.spkg` also append to `spkg/logs/foo.spkg`.  **scripts** repo.",
    "created_at": "2010-03-01T05:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85163",
    "user": "https://github.com/qed777"
}
```

Make `sage -i foo.spkg` also append to `spkg/logs/foo.spkg`.  **scripts** repo.



---

archive/issue_comments_085164.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,14 +1,14 @@\n Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.\n \n-The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.3 + #7552 + #8191 + #7943 and a [attachment:eclib_makefiles.patch patched] eclib spkg.  Notes:\n+The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.3 + #7552 + #8191 + #7943 and the latest spkg at #8357.  Notes:\n \n-* To build multiple spkgs simultaneously, please replace `PARALLEL_SPKG_BUILD=\"no\"` with `PARALLEL_SPKG_BUILD=\"yes\"` near the top of `install` and `export MAKE=\"make -jX\"`, where `X > 1`.  With the default (`\"no\"`), builds should proceed as before.\n+* It seems that prefixing a command with `+` (see `deps`) tells GNU make to attempt to propagate `$MAKE` to sub-makes.  Please see the [documentation](http://www.gnu.org/software/automake/manual/make/MAKE-Variable.html) (and the bottom of [this page](http://www.gnu.org/software/automake/manual/make/Error-Messages.html#Error-Messages)) for an exceptionally clear explanation. :)\n \n-* It seems that prefixing a command with `+` (see `deps`) tells GNU make to attempt to propagate `$MAKE` to sub-makes.  Please see the [documentation](http://www.gnu.org/software/automake/manual/make/MAKE-Variable.html) (and the bottom of [this page](http://www.gnu.org/software/automake/manual/make/Error-Messages.html#Error-Messages)) for an exceptionally clear explanation.\n+* In order to determine which commands could \"handle\" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, maxima, R, and singular.\n \n-* In order to determine which commands could \"handle\" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, maxima, and singular.\n+* I put packages installed by setuptools (twisted, zodb, pygments, jinja, jinja2, sphinx, sqlalchemy, sagenb) in a linear chain, because setuptools does not consistently update `SAGE_LOCAL/lib/python/site-packages/easy-install.pth` in parallel.\n \n-* I grouped packages installed by setuptools (twisted, zodb, pygments, jinja, jinja2, sphinx, sqlalchemy, sagenb) into one target, because setuptools does not consistently update `SAGE_LOCAL/lib/python/site-packages/easy-install.pth` in parallel.\n+* I removed `MAKE_REL` commands from `deps`, since `sage-spkg` always does this.\n \n * I put the per-spkg build logs in `SAGE_ROOT/spkg/logs`.  Feel free to suggest a different place.  Note: I haven't (re)moved `install.log`.\n \n@@ -20,4 +20,11 @@\n \n * I removed several comments about Gnuplot, dvipng, etc.  These also seem to be obsolete.  I wasn't sure about the (Py)OpenSSL comments, so I left them.\n \n-I'm not a `Makefile` expert.  Feel free to suggest improvements!\n+To test the changes:\n+\n+* Update `spkg/install` and `spkg/standard/deps`.\n+* `export SAGE_PARALLEL_SPKG_BUILD=\"yes\"`\n+* `export MAKE=\"make -jX\"` where `X > 1`\n+* `make`\n+\n+To make `sage -i foo-X.Y.spkg` *also* append to `spkg/logs/foo-X.Y.log`, apply [attachment:trac_8306_scripts-spkg_log_files.patch] to the scripts repository.\n``````\n",
    "created_at": "2010-03-01T15:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85164",
    "user": "https://github.com/qed777"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,14 +1,14 @@
 Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.
 
-The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.3 + #7552 + #8191 + #7943 and a [attachment:eclib_makefiles.patch patched] eclib spkg.  Notes:
+The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.3 + #7552 + #8191 + #7943 and the latest spkg at #8357.  Notes:
 
-* To build multiple spkgs simultaneously, please replace `PARALLEL_SPKG_BUILD="no"` with `PARALLEL_SPKG_BUILD="yes"` near the top of `install` and `export MAKE="make -jX"`, where `X > 1`.  With the default (`"no"`), builds should proceed as before.
+* It seems that prefixing a command with `+` (see `deps`) tells GNU make to attempt to propagate `$MAKE` to sub-makes.  Please see the [documentation](http://www.gnu.org/software/automake/manual/make/MAKE-Variable.html) (and the bottom of [this page](http://www.gnu.org/software/automake/manual/make/Error-Messages.html#Error-Messages)) for an exceptionally clear explanation. :)
 
-* It seems that prefixing a command with `+` (see `deps`) tells GNU make to attempt to propagate `$MAKE` to sub-makes.  Please see the [documentation](http://www.gnu.org/software/automake/manual/make/MAKE-Variable.html) (and the bottom of [this page](http://www.gnu.org/software/automake/manual/make/Error-Messages.html#Error-Messages)) for an exceptionally clear explanation.
+* In order to determine which commands could "handle" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, maxima, R, and singular.
 
-* In order to determine which commands could "handle" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, maxima, and singular.
+* I put packages installed by setuptools (twisted, zodb, pygments, jinja, jinja2, sphinx, sqlalchemy, sagenb) in a linear chain, because setuptools does not consistently update `SAGE_LOCAL/lib/python/site-packages/easy-install.pth` in parallel.
 
-* I grouped packages installed by setuptools (twisted, zodb, pygments, jinja, jinja2, sphinx, sqlalchemy, sagenb) into one target, because setuptools does not consistently update `SAGE_LOCAL/lib/python/site-packages/easy-install.pth` in parallel.
+* I removed `MAKE_REL` commands from `deps`, since `sage-spkg` always does this.
 
 * I put the per-spkg build logs in `SAGE_ROOT/spkg/logs`.  Feel free to suggest a different place.  Note: I haven't (re)moved `install.log`.
 
@@ -20,4 +20,11 @@
 
 * I removed several comments about Gnuplot, dvipng, etc.  These also seem to be obsolete.  I wasn't sure about the (Py)OpenSSL comments, so I left them.
 
-I'm not a `Makefile` expert.  Feel free to suggest improvements!
+To test the changes:
+
+* Update `spkg/install` and `spkg/standard/deps`.
+* `export SAGE_PARALLEL_SPKG_BUILD="yes"`
+* `export MAKE="make -jX"` where `X > 1`
+* `make`
+
+To make `sage -i foo-X.Y.spkg` *also* append to `spkg/logs/foo-X.Y.log`, apply [attachment:trac_8306_scripts-spkg_log_files.patch] to the scripts repository.
``````




---

archive/issue_comments_085165.json:
```json
{
    "body": "<a id='comment:19'></a>\nAgain, against 4.3.3 on sage.math, this appears to work well.  With `SAGE_CHECK=\"yes\"`, I get the same known errors\n\n```\n     sage: An error occurred while testing sagetex-2.2.3\n     sage: An error occurred while testing pyprocessing-0.52.p0\n     sage: An error occurred while testing sqlalchemy-0.4.6.p1\n```\nwith and without parallel spkg builds.  All the docs build and the long doctests pass.\n\nAgainst 4.3.0.1 on t2: It builds and runs --- I used a stand-in atlas spkg that just copies the files from the [existing binary build](http://boxen.math.washington.edu/sage/solaris/index.html).  \"Several\" doctests still fail or segfault.  With `SAGE_CHECK=\"yes\"`, I get the known testing errors, a known testing error with eclib (see #8357),  and *maybe* a testing error with R.  I ran out of patience with the latter.  I don't have time to test further on t2 / *Solaris.  It's probably better that someone else test with 4.3.3+ on a capable machine.\n\nIf I have time (and an account), I'll run a few tests on `bsd.math`.\n\nNote: With `SAGE_PARALLEL_SPKG_BUILD=\"yes\"`, I find it useful to run one of\n\n```sh\ngrep \"An error occurred\" SAGE_ROOT/install.log\nls -l SAGE_ROOT/spkg/installed | wc\n```\nwhen I see `\"Sage build/upgrade complete!\"`.  Maybe we should add a similar check at the end of `install`?\n\nPlease test and let us know what happens.  I didn't log detailed statistics, but with a warm compiler cache, I noticed a roughly three-fold speedup.  From a recent run on sage.math:\n\n```\nSage build/upgrade complete!\n\nreal    15m44.846s\nuser    45m55.780s\nsys     11m10.470s\n```",
    "created_at": "2010-03-01T16:27:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85165",
    "user": "https://github.com/qed777"
}
```

<a id='comment:19'></a>
Again, against 4.3.3 on sage.math, this appears to work well.  With `SAGE_CHECK="yes"`, I get the same known errors

```
     sage: An error occurred while testing sagetex-2.2.3
     sage: An error occurred while testing pyprocessing-0.52.p0
     sage: An error occurred while testing sqlalchemy-0.4.6.p1
```
with and without parallel spkg builds.  All the docs build and the long doctests pass.

Against 4.3.0.1 on t2: It builds and runs --- I used a stand-in atlas spkg that just copies the files from the [existing binary build](http://boxen.math.washington.edu/sage/solaris/index.html).  "Several" doctests still fail or segfault.  With `SAGE_CHECK="yes"`, I get the known testing errors, a known testing error with eclib (see #8357),  and *maybe* a testing error with R.  I ran out of patience with the latter.  I don't have time to test further on t2 / *Solaris.  It's probably better that someone else test with 4.3.3+ on a capable machine.

If I have time (and an account), I'll run a few tests on `bsd.math`.

Note: With `SAGE_PARALLEL_SPKG_BUILD="yes"`, I find it useful to run one of

```sh
grep "An error occurred" SAGE_ROOT/install.log
ls -l SAGE_ROOT/spkg/installed | wc
```
when I see `"Sage build/upgrade complete!"`.  Maybe we should add a similar check at the end of `install`?

Please test and let us know what happens.  I didn't log detailed statistics, but with a warm compiler cache, I noticed a roughly three-fold speedup.  From a recent run on sage.math:

```
Sage build/upgrade complete!

real    15m44.846s
user    45m55.780s
sys     11m10.470s
```



---

archive/issue_comments_085166.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [mpatel](#comment%3A19):\n\n> [... ...] with a warm compiler cache, I noticed a roughly three-fold speedup. [... ...]\n\n\nI should add that this could be very useful to a release manager.",
    "created_at": "2010-03-01T16:30:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85166",
    "user": "https://github.com/qed777"
}
```

<a id='comment:20'></a>
Replying to [mpatel](#comment%3A19):

> [... ...] with a warm compiler cache, I noticed a roughly three-fold speedup. [... ...]


I should add that this could be very useful to a release manager.



---

archive/issue_comments_085167.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [mpatel](#comment%3A20):\n\n> I should add that this could be very useful to a release manager.\n\nWhat exactly is a \"warm compiler cache\" ? A Google on the term only shows only references to Sage.",
    "created_at": "2010-03-01T16:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85167",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:21'></a>
Replying to [mpatel](#comment%3A20):

> I should add that this could be very useful to a release manager.

What exactly is a "warm compiler cache" ? A Google on the term only shows only references to Sage.



---

archive/issue_comments_085168.json:
```json
{
    "body": "<a id='comment:22'></a>\nOops.  I just mean that I've set up [ccache](http://ccache.samba.org/) and compiled Sage twice, say.  Stats from t2:\n\n```\nmpatel@t2 ~$ ccache -s\ncache directory                     /home/mpatel/.ccache\ncache hit                          34598\ncache miss                         23288\ncalled for link                     5050\nmultiple source files                 14\ncompiler produced stdout              10\ncompile failed                       774\npreprocessor error                   465\ncouldn't find the compiler            39\nnot a C/C++ file                    3409\nautoconf compile/link               7006\nunsupported compiler option         2815\nno input file                       3107\nfiles in cache                     45248\ncache size                           2.3 Gbytes\nmax cache size                       5.0 Gbytes\n```\n(I think it'll be faster in `/scratch`, but I don't know by how much.)  From sage.math:\n\n```\nmpatel@sage ~$ ccache -s\ncache directory                     /scratch/mpatel/.ccache\ncache hit                         371602\ncache miss                         61435\ncalled for link                    48342\nmultiple source files                131\ncompiler produced stdout              78\ncompile failed                      2635\nccache internal error                  2\npreprocessor error                  2433\ncache file missing                     4\nnot a C/C++ file                   15851\nautoconf compile/link              39762\nunsupported compiler option        21463\nno input file                      18871\nfiles in cache                    106837\ncache size                           4.6 Gbytes\nmax cache size                      10.0 Gbytes\n```\n(Lots of testing with different `X` values.)  I've been using ccache 2.4.  I don't know how 3.0pre0 compares.",
    "created_at": "2010-03-01T16:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85168",
    "user": "https://github.com/qed777"
}
```

<a id='comment:22'></a>
Oops.  I just mean that I've set up [ccache](http://ccache.samba.org/) and compiled Sage twice, say.  Stats from t2:

```
mpatel@t2 ~$ ccache -s
cache directory                     /home/mpatel/.ccache
cache hit                          34598
cache miss                         23288
called for link                     5050
multiple source files                 14
compiler produced stdout              10
compile failed                       774
preprocessor error                   465
couldn't find the compiler            39
not a C/C++ file                    3409
autoconf compile/link               7006
unsupported compiler option         2815
no input file                       3107
files in cache                     45248
cache size                           2.3 Gbytes
max cache size                       5.0 Gbytes
```
(I think it'll be faster in `/scratch`, but I don't know by how much.)  From sage.math:

```
mpatel@sage ~$ ccache -s
cache directory                     /scratch/mpatel/.ccache
cache hit                         371602
cache miss                         61435
called for link                    48342
multiple source files                131
compiler produced stdout              78
compile failed                      2635
ccache internal error                  2
preprocessor error                  2433
cache file missing                     4
not a C/C++ file                   15851
autoconf compile/link              39762
unsupported compiler option        21463
no input file                      18871
files in cache                    106837
cache size                           4.6 Gbytes
max cache size                      10.0 Gbytes
```
(Lots of testing with different `X` values.)  I've been using ccache 2.4.  I don't know how 3.0pre0 compares.



---

archive/issue_comments_085169.json:
```json
{
    "body": "<a id='comment:23'></a>\nReminder: Update #8263, if it's necessary.",
    "created_at": "2010-03-02T23:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85169",
    "user": "https://github.com/qed777"
}
```

<a id='comment:23'></a>
Reminder: Update #8263, if it's necessary.



---

archive/issue_comments_085170.json:
```json
{
    "body": "<a id='comment:24'></a>\nTicket #8432 adds iconv to the dependency rule for building gd. So you don't need to implement that rule here.",
    "created_at": "2010-03-04T04:05:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85170",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:24'></a>
Ticket #8432 adds iconv to the dependency rule for building gd. So you don't need to implement that rule here.



---

archive/issue_comments_085171.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,18 +1,16 @@\n Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.\n \n-The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.3 + #7552 + #8191 + #7943 and the latest spkg at #8357.  Notes:\n+The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.4.alpha0 + #7943 + #8357's spkg.  Notes:\n \n * It seems that prefixing a command with `+` (see `deps`) tells GNU make to attempt to propagate `$MAKE` to sub-makes.  Please see the [documentation](http://www.gnu.org/software/automake/manual/make/MAKE-Variable.html) (and the bottom of [this page](http://www.gnu.org/software/automake/manual/make/Error-Messages.html#Error-Messages)) for an exceptionally clear explanation. :)\n \n-* In order to determine which commands could \"handle\" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, maxima, R, and singular.\n+* In order to determine which commands could \"handle\" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, maxima, R, and singular.  Note: It may be possible to build in parallel without any plus signs, but when I try this, I get an error with palp.\n \n * I put packages installed by setuptools (twisted, zodb, pygments, jinja, jinja2, sphinx, sqlalchemy, sagenb) in a linear chain, because setuptools does not consistently update `SAGE_LOCAL/lib/python/site-packages/easy-install.pth` in parallel.\n \n * I removed `MAKE_REL` commands from `deps`, since `sage-spkg` always does this.\n \n-* I put the per-spkg build logs in `SAGE_ROOT/spkg/logs`.  Feel free to suggest a different place.  Note: I haven't (re)moved `install.log`.\n-\n-* I added iconv to gd's dependencies (cf. #8191).\n+* I put the per-spkg build logs in `SAGE_ROOT/spkg/logs`.  The patch [attachment:trac_8306_scripts-spkg_log_files.patch] does the same for `sage -i` and `sage -f`.  Note: I have not (re)moved `install.log`.\n \n * I dropped mpir from gap's dependencies (see [sage-devel](http://groups.google.com/group/sage-devel/msg/c97a99f23ea576b7)).\n \n``````\n",
    "created_at": "2010-03-05T00:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85171",
    "user": "https://github.com/qed777"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,18 +1,16 @@
 Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.
 
-The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.3 + #7552 + #8191 + #7943 and the latest spkg at #8357.  Notes:
+The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.4.alpha0 + #7943 + #8357's spkg.  Notes:
 
 * It seems that prefixing a command with `+` (see `deps`) tells GNU make to attempt to propagate `$MAKE` to sub-makes.  Please see the [documentation](http://www.gnu.org/software/automake/manual/make/MAKE-Variable.html) (and the bottom of [this page](http://www.gnu.org/software/automake/manual/make/Error-Messages.html#Error-Messages)) for an exceptionally clear explanation. :)
 
-* In order to determine which commands could "handle" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, maxima, R, and singular.
+* In order to determine which commands could "handle" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, maxima, R, and singular.  Note: It may be possible to build in parallel without any plus signs, but when I try this, I get an error with palp.
 
 * I put packages installed by setuptools (twisted, zodb, pygments, jinja, jinja2, sphinx, sqlalchemy, sagenb) in a linear chain, because setuptools does not consistently update `SAGE_LOCAL/lib/python/site-packages/easy-install.pth` in parallel.
 
 * I removed `MAKE_REL` commands from `deps`, since `sage-spkg` always does this.
 
-* I put the per-spkg build logs in `SAGE_ROOT/spkg/logs`.  Feel free to suggest a different place.  Note: I haven't (re)moved `install.log`.
-
-* I added iconv to gd's dependencies (cf. #8191).
+* I put the per-spkg build logs in `SAGE_ROOT/spkg/logs`.  The patch [attachment:trac_8306_scripts-spkg_log_files.patch] does the same for `sage -i` and `sage -f`.  Note: I have not (re)moved `install.log`.
 
 * I dropped mpir from gap's dependencies (see [sage-devel](http://groups.google.com/group/sage-devel/msg/c97a99f23ea576b7)).
 
``````




---

archive/issue_comments_085172.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,10 +1,10 @@\n Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.\n \n-The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.4.alpha0 + #7943 + #8357's spkg.  Notes:\n+The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.4.alpha0 + #7943 + #8357's spkg.  There's an implicit dependence on #8432.  Notes:\n \n * It seems that prefixing a command with `+` (see `deps`) tells GNU make to attempt to propagate `$MAKE` to sub-makes.  Please see the [documentation](http://www.gnu.org/software/automake/manual/make/MAKE-Variable.html) (and the bottom of [this page](http://www.gnu.org/software/automake/manual/make/Error-Messages.html#Error-Messages)) for an exceptionally clear explanation. :)\n \n-* In order to determine which commands could \"handle\" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, maxima, R, and singular.  Note: It may be possible to build in parallel without any plus signs, but when I try this, I get an error with palp.\n+* In order to determine which commands could \"handle\" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, maxima, R, and singular.  Note: It may be possible to build in parallel without any plus signs, but when I try this, I get a strange make jobserver error with palp.\n \n * I put packages installed by setuptools (twisted, zodb, pygments, jinja, jinja2, sphinx, sqlalchemy, sagenb) in a linear chain, because setuptools does not consistently update `SAGE_LOCAL/lib/python/site-packages/easy-install.pth` in parallel.\n \n``````\n",
    "created_at": "2010-03-05T00:24:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85172",
    "user": "https://github.com/qed777"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,10 +1,10 @@
 Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.
 
-The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.4.alpha0 + #7943 + #8357's spkg.  Notes:
+The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.4.alpha0 + #7943 + #8357's spkg.  There's an implicit dependence on #8432.  Notes:
 
 * It seems that prefixing a command with `+` (see `deps`) tells GNU make to attempt to propagate `$MAKE` to sub-makes.  Please see the [documentation](http://www.gnu.org/software/automake/manual/make/MAKE-Variable.html) (and the bottom of [this page](http://www.gnu.org/software/automake/manual/make/Error-Messages.html#Error-Messages)) for an exceptionally clear explanation. :)
 
-* In order to determine which commands could "handle" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, maxima, R, and singular.  Note: It may be possible to build in parallel without any plus signs, but when I try this, I get an error with palp.
+* In order to determine which commands could "handle" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, maxima, R, and singular.  Note: It may be possible to build in parallel without any plus signs, but when I try this, I get a strange make jobserver error with palp.
 
 * I put packages installed by setuptools (twisted, zodb, pygments, jinja, jinja2, sphinx, sqlalchemy, sagenb) in a linear chain, because setuptools does not consistently update `SAGE_LOCAL/lib/python/site-packages/easy-install.pth` in parallel.
 
``````




---

archive/issue_comments_085173.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-03-05T01:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85173",
    "user": "https://github.com/qed777"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_085174.json:
```json
{
    "body": "<a id='comment:27'></a>\nI've attached updates rebased vs. #7943 and #8432.",
    "created_at": "2010-03-05T01:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85174",
    "user": "https://github.com/qed777"
}
```

<a id='comment:27'></a>
I've attached updates rebased vs. #7943 and #8432.



---

archive/issue_comments_085175.json:
```json
{
    "body": "<a id='comment:28'></a>\nAdding Mike Hansen to the Cc: list.",
    "created_at": "2010-03-05T01:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85175",
    "user": "https://github.com/qed777"
}
```

<a id='comment:28'></a>
Adding Mike Hansen to the Cc: list.



---

archive/issue_comments_085176.json:
```json
{
    "body": "<a id='comment:29'></a>\nStrange error when building on sage.math with `MAKE=\"make -j23 -l25\"` and `SAGE_PARALLEL_SPKG_BUILD` **not** set:\n\n```\nNow install rpy\n**************************************************************************\nYou must compile Sage first using 'make' in the Sage root directory.\n(If you have already compiled Sage, you must set the SAGE_ROOT variable in \nthe file '/mnt/usb1/scratch/mpatel/tmp/sage-4.3.4.alpha0/sage').\n**************************************************************************\nError installing rpy.\n```",
    "created_at": "2010-03-05T03:53:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85176",
    "user": "https://github.com/qed777"
}
```

<a id='comment:29'></a>
Strange error when building on sage.math with `MAKE="make -j23 -l25"` and `SAGE_PARALLEL_SPKG_BUILD` **not** set:

```
Now install rpy
**************************************************************************
You must compile Sage first using 'make' in the Sage root directory.
(If you have already compiled Sage, you must set the SAGE_ROOT variable in 
the file '/mnt/usb1/scratch/mpatel/tmp/sage-4.3.4.alpha0/sage').
**************************************************************************
Error installing rpy.
```



---

archive/issue_comments_085177.json:
```json
{
    "body": "<a id='comment:30'></a>\nFixed by appending `SAGE_SCRIPTS` to `BASE`.  I'm putting the updates here:\n\n* http://sage.math.washington.edu/home/mpatel/trac/8306",
    "created_at": "2010-03-05T04:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85177",
    "user": "https://github.com/qed777"
}
```

<a id='comment:30'></a>
Fixed by appending `SAGE_SCRIPTS` to `BASE`.  I'm putting the updates here:

* http://sage.math.washington.edu/home/mpatel/trac/8306



---

archive/issue_comments_085178.json:
```json
{
    "body": "<a id='comment:31'></a>\nWith Sage 4.3.4.alpha0 on sage.math, I updated \"deps\" and \"install\" with [deps](http://sage.math.washington.edu/home/mpatel/trac/8306/deps) and [install](http://sage.math.washington.edu/home/mpatel/trac/8306/install). I exported these environment variables:\n\n```\nexport SAGE_PARALLEL_SPKG_BUILD=\"yes\"\nexport MAKE=\"make -j4\"\nmake \n```\nThe build failed with \n\n```\nSuccessfully installed gap-4.4.12.p1\nNow cleaning up tmp files.\nMaking Sage/Python scripts relocatable...\nMaking script relocatable\nFinished installing gap-4.4.12.p1.spkg\nmake[1]: Leaving directory `/dev/shm/mvngu/sandbox/sage-4.3.4.alpha0/spkg'\n\nreal    45m12.933s\nuser    105m39.580s\nsys     15m46.550s\nError building Sage.\nTraceback (most recent call last):\n  File \"/dev/shm/mvngu/sandbox/sage-4.3.4.alpha0/local/bin/sage-preparse\", line 230, in <module>\n    do_preparse(f)\n  File \"/dev/shm/mvngu/sandbox/sage-4.3.4.alpha0/local/bin/sage-preparse\", line 118, in do_preparse\n    from sage.misc.preparser  import preparse_file\nImportError: No module named sage.misc.preparser\n```",
    "created_at": "2010-03-07T04:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85178",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:31'></a>
With Sage 4.3.4.alpha0 on sage.math, I updated "deps" and "install" with [deps](http://sage.math.washington.edu/home/mpatel/trac/8306/deps) and [install](http://sage.math.washington.edu/home/mpatel/trac/8306/install). I exported these environment variables:

```
export SAGE_PARALLEL_SPKG_BUILD="yes"
export MAKE="make -j4"
make 
```
The build failed with 

```
Successfully installed gap-4.4.12.p1
Now cleaning up tmp files.
Making Sage/Python scripts relocatable...
Making script relocatable
Finished installing gap-4.4.12.p1.spkg
make[1]: Leaving directory `/dev/shm/mvngu/sandbox/sage-4.3.4.alpha0/spkg'

real    45m12.933s
user    105m39.580s
sys     15m46.550s
Error building Sage.
Traceback (most recent call last):
  File "/dev/shm/mvngu/sandbox/sage-4.3.4.alpha0/local/bin/sage-preparse", line 230, in <module>
    do_preparse(f)
  File "/dev/shm/mvngu/sandbox/sage-4.3.4.alpha0/local/bin/sage-preparse", line 118, in do_preparse
    from sage.misc.preparser  import preparse_file
ImportError: No module named sage.misc.preparser
```



---

archive/issue_comments_085179.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -21,6 +21,7 @@\n To test the changes:\n \n * Update `spkg/install` and `spkg/standard/deps`.\n+* Add #8357's eclib-*.spkg.\n * `export SAGE_PARALLEL_SPKG_BUILD=\"yes\"`\n * `export MAKE=\"make -jX\"` where `X > 1`\n * `make`\n``````\n",
    "created_at": "2010-03-07T05:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85179",
    "user": "https://github.com/qed777"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -21,6 +21,7 @@
 To test the changes:
 
 * Update `spkg/install` and `spkg/standard/deps`.
+* Add #8357's eclib-*.spkg.
 * `export SAGE_PARALLEL_SPKG_BUILD="yes"`
 * `export MAKE="make -jX"` where `X > 1`
 * `make`
``````




---

archive/issue_comments_085180.json:
```json
{
    "body": "<a id='comment:32'></a>\nThe eclib and sage packages did not build:\n\n```sh\n$ grep \"An error occurred\" /dev/shm/mvngu/sandbox/sage-4.3.4.alpha0/spkg/logs/*\neclib-20080310.p9.log:sage: An error occurred while installing eclib-20080310.p9\nsage-4.3.4.alpha0.log:sage: An error occurred while installing sage-4.3.4.alpha0\n```\nTicket #8357's `eclib-*.spkg` should fix this.  I apologize for not mentioning it in \"To test the changes\".\n\nQuestions:\n\n* If I untar `sage-*.tar`, copy over `install`, etc., and start the build, then at some point, `install` is overwritten with the original version.  Do you know which package or script does this?  For my tests, I've run `chmod u-w install` before `make`.\n\n* I don't know why the build didn't stop when eclib failed to build.  This seems strange.  The file `installed/eclib*` is missing and according to `deps`, it's required for the `sage` target.  Similarly, `installed/sage*` is a prerequisite for gap.  Does anyone know why this happens?  Can we modify `deps` to avoid it?",
    "created_at": "2010-03-07T05:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85180",
    "user": "https://github.com/qed777"
}
```

<a id='comment:32'></a>
The eclib and sage packages did not build:

```sh
$ grep "An error occurred" /dev/shm/mvngu/sandbox/sage-4.3.4.alpha0/spkg/logs/*
eclib-20080310.p9.log:sage: An error occurred while installing eclib-20080310.p9
sage-4.3.4.alpha0.log:sage: An error occurred while installing sage-4.3.4.alpha0
```
Ticket #8357's `eclib-*.spkg` should fix this.  I apologize for not mentioning it in "To test the changes".

Questions:

* If I untar `sage-*.tar`, copy over `install`, etc., and start the build, then at some point, `install` is overwritten with the original version.  Do you know which package or script does this?  For my tests, I've run `chmod u-w install` before `make`.

* I don't know why the build didn't stop when eclib failed to build.  This seems strange.  The file `installed/eclib*` is missing and according to `deps`, it's required for the `sage` target.  Similarly, `installed/sage*` is a prerequisite for gap.  Does anyone know why this happens?  Can we modify `deps` to avoid it?



---

archive/issue_comments_085181.json:
```json
{
    "body": "<a id='comment:33'></a>\nTo install and use ccache, I did this\n\n```sh\nwget http://samba.org/ftp/ccache/ccache-2.4.tar.gz\ntar zxvf ccache-2.4.tar.gz\ncd ccache-2.4\n./configure\nmake\ncp ccache ~/bin\n```\nBecause I set\n\n```sh\nPATH=\".:$HOME/bin:$HOME/apps/sage/local/bin:$PATH\"\n```\nin `~/.profile`, I did\n\n```sh\ncd ~/bin\nln -s c++ ccache\nln -s cc ccache\nln -s g++ ccache\nln -s g++-3.4 ccache\nln -s g++-4.2 ccache\nln -s gcc ccache\nln -s gcc-3.4 ccache\nln -s gcc-4.1 ccache\nln -s gcc-4.2 ccache\nln -s x86_64-linux-gnu-g++ ccache\nln -s x86_64-linux-gnu-g++-3.4 ccache\nln -s x86_64-linux-gnu-g++-4.2 ccache\nln -s x86_64-linux-gnu-gcc ccache\nln -s x86_64-linux-gnu-gcc-3.4 ccache\nln -s x86_64-linux-gnu-gcc-4.1 ccache\nln -s x86_64-linux-gnu-gcc-4.2 ccache\nln -s x86_64-linux-gnu-gcj-4.2 ccache\nln -s x86_64-linux-gnu-gfortran ccache\nln -s x86_64-linux-gnu-gfortran-4.1 ccache\nln -s x86_64-linux-gnu-gfortran-4.2 ccache\n```\nThis may be overkill.  In `~/.bashrc`, I've put\n\n```sh\nexport CCACHE_DIR=/scratch/mpatel/.ccache\n```",
    "created_at": "2010-03-07T06:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85181",
    "user": "https://github.com/qed777"
}
```

<a id='comment:33'></a>
To install and use ccache, I did this

```sh
wget http://samba.org/ftp/ccache/ccache-2.4.tar.gz
tar zxvf ccache-2.4.tar.gz
cd ccache-2.4
./configure
make
cp ccache ~/bin
```
Because I set

```sh
PATH=".:$HOME/bin:$HOME/apps/sage/local/bin:$PATH"
```
in `~/.profile`, I did

```sh
cd ~/bin
ln -s c++ ccache
ln -s cc ccache
ln -s g++ ccache
ln -s g++-3.4 ccache
ln -s g++-4.2 ccache
ln -s gcc ccache
ln -s gcc-3.4 ccache
ln -s gcc-4.1 ccache
ln -s gcc-4.2 ccache
ln -s x86_64-linux-gnu-g++ ccache
ln -s x86_64-linux-gnu-g++-3.4 ccache
ln -s x86_64-linux-gnu-g++-4.2 ccache
ln -s x86_64-linux-gnu-gcc ccache
ln -s x86_64-linux-gnu-gcc-3.4 ccache
ln -s x86_64-linux-gnu-gcc-4.1 ccache
ln -s x86_64-linux-gnu-gcc-4.2 ccache
ln -s x86_64-linux-gnu-gcj-4.2 ccache
ln -s x86_64-linux-gnu-gfortran ccache
ln -s x86_64-linux-gnu-gfortran-4.1 ccache
ln -s x86_64-linux-gnu-gfortran-4.2 ccache
```
This may be overkill.  In `~/.bashrc`, I've put

```sh
export CCACHE_DIR=/scratch/mpatel/.ccache
```



---

archive/issue_comments_085182.json:
```json
{
    "body": "<a id='comment:34'></a>\nI also set a larger ccache size with `ccache -M 10G`.  To print statistics run `ccache -s`.",
    "created_at": "2010-03-07T06:35:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85182",
    "user": "https://github.com/qed777"
}
```

<a id='comment:34'></a>
I also set a larger ccache size with `ccache -M 10G`.  To print statistics run `ccache -s`.



---

archive/issue_comments_085183.json:
```json
{
    "body": "<a id='comment:35'></a>\nThe patch [trac_8306_scripts-spkg_log_files.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/8306/trac_8306_scripts-spkg_log_files.patch) introduces the environment variable\n\n```\nSAGE_LOGS=\"$SAGE_ROOT/spkg/logs\"\n```\nfor storing build logs of spkg's. A closely related idea, but for MD5 integrity check files, can be found at #7617. What could be implemented is an environment variable like\n\n```\nSAGE_SPKG_MD5=\"$SAGE_ROOT/spkg/md5\"\n```\nAs of Sage 4.3.3, the SageTeX package is the only standard package that has an MD5 file bundled together with the package itself to result in an spkg. Whenever the SageTeX spkg is built, its MD5 file is extracted and lingers under \n\n```\nSAGE_ROOT/spkg/build\n```\nPerhaps a more appropriate place is to deposit MD5 files of spkg's under\n\n```\nSAGE_ROOT/spkg/md5\n```\nThis would nicely solve ticket #329 after more than 3 years.",
    "created_at": "2010-03-07T06:51:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85183",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:35'></a>
The patch [trac_8306_scripts-spkg_log_files.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/8306/trac_8306_scripts-spkg_log_files.patch) introduces the environment variable

```
SAGE_LOGS="$SAGE_ROOT/spkg/logs"
```
for storing build logs of spkg's. A closely related idea, but for MD5 integrity check files, can be found at #7617. What could be implemented is an environment variable like

```
SAGE_SPKG_MD5="$SAGE_ROOT/spkg/md5"
```
As of Sage 4.3.3, the SageTeX package is the only standard package that has an MD5 file bundled together with the package itself to result in an spkg. Whenever the SageTeX spkg is built, its MD5 file is extracted and lingers under 

```
SAGE_ROOT/spkg/build
```
Perhaps a more appropriate place is to deposit MD5 files of spkg's under

```
SAGE_ROOT/spkg/md5
```
This would nicely solve ticket #329 after more than 3 years.



---

archive/issue_comments_085184.json:
```json
{
    "body": "<a id='comment:36'></a>\nWe could do the integrity check and relocation (`mv -f foo.md5 \"$SAGE_SPKG_MD5\"`) in `spkg-checksum`, say, call this script in `sage-spkg`, test `$?`, print a message, etc.  Or we could just delete `foo.md5`.  How useful is the file outside the archive?",
    "created_at": "2010-03-07T09:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85184",
    "user": "https://github.com/qed777"
}
```

<a id='comment:36'></a>
We could do the integrity check and relocation (`mv -f foo.md5 "$SAGE_SPKG_MD5"`) in `spkg-checksum`, say, call this script in `sage-spkg`, test `$?`, print a message, etc.  Or we could just delete `foo.md5`.  How useful is the file outside the archive?



---

archive/issue_comments_085185.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [mpatel](#comment%3A32):\n>  * I don't know why the build didn't stop when eclib failed to build.  This seems strange.  The file `installed/eclib*` is missing and according to `deps`, it's required for the `sage` target.  Similarly, `installed/sage*` is a prerequisite for gap.  Does anyone know why this happens?  Can we modify `deps` to avoid it?\n\n\nThe problem is that the exit status `$?` of\n\n```sh\n$(SAGE_SPKG) $(FOO) 2>&1 | tee -a $(SAGE_LOGS)/$(FOO).log\n```\nis the exit status of `tee`, but we need the exit status of `sage-spkg`.  (I found some other workarounds [here](http://www.unix.com/shell-programming-scripting/92163-command-does-not-return-exit-status-due-tee.html).)  We can get this with `$PIPESTATUS` in `bash`.  We could add a helper script somewhere that runs the pipeline and exits with the status of `sage-spkg`.\n\nOr we could use\n\n```sh\n$(SAGE_SPKG) $(FOO) 2>&1 | tee -a $(SAGE_LOGS)/$(FOO).log | grep \"sage: An error occurred while\"\n```\nif we test the status of `grep`.  The `sage-spkg` script prints this error string when `spkg-install` or `spkg-check` fails.   We could also print the string in a few other places in `sage-spkg` (search for `exit 1`).\n\nThoughts?",
    "created_at": "2010-03-07T14:51:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85185",
    "user": "https://github.com/qed777"
}
```

<a id='comment:37'></a>
Replying to [mpatel](#comment%3A32):
>  * I don't know why the build didn't stop when eclib failed to build.  This seems strange.  The file `installed/eclib*` is missing and according to `deps`, it's required for the `sage` target.  Similarly, `installed/sage*` is a prerequisite for gap.  Does anyone know why this happens?  Can we modify `deps` to avoid it?


The problem is that the exit status `$?` of

```sh
$(SAGE_SPKG) $(FOO) 2>&1 | tee -a $(SAGE_LOGS)/$(FOO).log
```
is the exit status of `tee`, but we need the exit status of `sage-spkg`.  (I found some other workarounds [here](http://www.unix.com/shell-programming-scripting/92163-command-does-not-return-exit-status-due-tee.html).)  We can get this with `$PIPESTATUS` in `bash`.  We could add a helper script somewhere that runs the pipeline and exits with the status of `sage-spkg`.

Or we could use

```sh
$(SAGE_SPKG) $(FOO) 2>&1 | tee -a $(SAGE_LOGS)/$(FOO).log | grep "sage: An error occurred while"
```
if we test the status of `grep`.  The `sage-spkg` script prints this error string when `spkg-install` or `spkg-check` fails.   We could also print the string in a few other places in `sage-spkg` (search for `exit 1`).

Thoughts?



---

archive/issue_comments_085186.json:
```json
{
    "body": "<a id='comment:38'></a>\nI have a helper script that I'm testing.  So far, it's working well, *if* I force palp to build serially.  The spkg at #8477 does this.",
    "created_at": "2010-03-07T18:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85186",
    "user": "https://github.com/qed777"
}
```

<a id='comment:38'></a>
I have a helper script that I'm testing.  So far, it's working well, *if* I force palp to build serially.  The spkg at #8477 does this.



---

archive/issue_comments_085187.json:
```json
{
    "body": "<a id='comment:39'></a>\nReplying to [mvngu](#comment%3A35):\n\n> Perhaps a more appropriate place is to deposit MD5 files of spkg's under\n> \n> ```\n> SAGE_ROOT/spkg/md5\n> ```\n> This would nicely solve ticket #329 after more than 3 years.\n\n\nSee my comment on #329. The problem with md5 is that there is no standard command for getting the md5 checksum. I've seen\n\n* md5\n* md5sum\n* digest -a md5 ('digest' is part of OpenSSL, and is what I use on Solaris)\n\nIt is not a standard POSIX command. In contrast, 'cksum' is much more portable, as it is defined by POSIX. \n\nhttp://www.opengroup.org/onlinepubs/9699919799/utilities/cksum.html\n\nIt is a 32-bit bit number, so the probability of an error not being detected is around 2.3 x 10^-10.  \n\nAvoid using 'sum' - that is not portable, as the algorithm is implementation dependent. \n\nDave",
    "created_at": "2010-03-08T00:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85187",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:39'></a>
Replying to [mvngu](#comment%3A35):

> Perhaps a more appropriate place is to deposit MD5 files of spkg's under
> 
> ```
> SAGE_ROOT/spkg/md5
> ```
> This would nicely solve ticket #329 after more than 3 years.


See my comment on #329. The problem with md5 is that there is no standard command for getting the md5 checksum. I've seen

* md5
* md5sum
* digest -a md5 ('digest' is part of OpenSSL, and is what I use on Solaris)

It is not a standard POSIX command. In contrast, 'cksum' is much more portable, as it is defined by POSIX. 

http://www.opengroup.org/onlinepubs/9699919799/utilities/cksum.html

It is a 32-bit bit number, so the probability of an error not being detected is around 2.3 x 10^-10.  

Avoid using 'sum' - that is not portable, as the algorithm is implementation dependent. 

Dave



---

archive/issue_comments_085188.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,29 +1,16 @@\n-Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.\n-\n-The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.4.alpha0 + #7943 + #8357's spkg.  There's an implicit dependence on #8432.  Notes:\n-\n-* It seems that prefixing a command with `+` (see `deps`) tells GNU make to attempt to propagate `$MAKE` to sub-makes.  Please see the [documentation](http://www.gnu.org/software/automake/manual/make/MAKE-Variable.html) (and the bottom of [this page](http://www.gnu.org/software/automake/manual/make/Error-Messages.html#Error-Messages)) for an exceptionally clear explanation. :)\n-\n-* In order to determine which commands could \"handle\" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, maxima, R, and singular.  Note: It may be possible to build in parallel without any plus signs, but when I try this, I get a strange make jobserver error with palp.\n+Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.  Notes:\n \n * I put packages installed by setuptools (twisted, zodb, pygments, jinja, jinja2, sphinx, sqlalchemy, sagenb) in a linear chain, because setuptools does not consistently update `SAGE_LOCAL/lib/python/site-packages/easy-install.pth` in parallel.\n \n-* I removed `MAKE_REL` commands from `deps`, since `sage-spkg` always does this.\n-\n-* I put the per-spkg build logs in `SAGE_ROOT/spkg/logs`.  The patch [attachment:trac_8306_scripts-spkg_log_files.patch] does the same for `sage -i` and `sage -f`.  Note: I have not (re)moved `install.log`.\n-\n * I dropped mpir from gap's dependencies (see [sage-devel](http://groups.google.com/group/sage-devel/msg/c97a99f23ea576b7)).\n-\n-* I removed `$(GNUCRYPTOLIB)` and `$(TWISTEDWEB2)`, which appear to be unnecessary.\n-\n-* I removed several comments about Gnuplot, dvipng, etc.  These also seem to be obsolete.  I wasn't sure about the (Py)OpenSSL comments, so I left them.\n \n To test the changes:\n \n-* Update `spkg/install` and `spkg/standard/deps`.\n-* Add #8357's eclib-*.spkg.\n+* Update `spkg/install` and `spkg/standard/deps` from [here](http://sage.math.washington.edu/home/mpatel/trac/8306).\n+* Add #8357's `eclib-*.spkg`.\n+* Add #8477's `palp-*.spkg`.\n * `export SAGE_PARALLEL_SPKG_BUILD=\"yes\"`\n * `export MAKE=\"make -jX\"` where `X > 1`\n * `make`\n \n-To make `sage -i foo-X.Y.spkg` *also* append to `spkg/logs/foo-X.Y.log`, apply [attachment:trac_8306_scripts-spkg_log_files.patch] to the scripts repository.\n+To build with `SAGE_CHECK=\"ok\"`, add #7091's `sqlalchemy-*.spkg`.  To make `sage -i foo-X.Y.spkg` *also* append to `spkg/logs/foo-X.Y.log`, apply [attachment:trac_8306_scripts-spkg_log_files.patch] to the scripts repository.\n``````\n",
    "created_at": "2010-03-09T04:13:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85188",
    "user": "https://github.com/qed777"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,29 +1,16 @@
-Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.
-
-The attached `spkg/install` and `spkg/standard/deps` depend on 4.3.4.alpha0 + #7943 + #8357's spkg.  There's an implicit dependence on #8432.  Notes:
-
-* It seems that prefixing a command with `+` (see `deps`) tells GNU make to attempt to propagate `$MAKE` to sub-makes.  Please see the [documentation](http://www.gnu.org/software/automake/manual/make/MAKE-Variable.html) (and the bottom of [this page](http://www.gnu.org/software/automake/manual/make/Error-Messages.html#Error-Messages)) for an exceptionally clear explanation. :)
-
-* In order to determine which commands could "handle" `+`, I prefixed them all and went through many build / test / edit cycles on sage.math.  Besides the setuptools packages (see below), the packages that are not built with `+` are atlas, ecl, maxima, R, and singular.  Note: It may be possible to build in parallel without any plus signs, but when I try this, I get a strange make jobserver error with palp.
+Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.  Notes:
 
 * I put packages installed by setuptools (twisted, zodb, pygments, jinja, jinja2, sphinx, sqlalchemy, sagenb) in a linear chain, because setuptools does not consistently update `SAGE_LOCAL/lib/python/site-packages/easy-install.pth` in parallel.
 
-* I removed `MAKE_REL` commands from `deps`, since `sage-spkg` always does this.
-
-* I put the per-spkg build logs in `SAGE_ROOT/spkg/logs`.  The patch [attachment:trac_8306_scripts-spkg_log_files.patch] does the same for `sage -i` and `sage -f`.  Note: I have not (re)moved `install.log`.
-
 * I dropped mpir from gap's dependencies (see [sage-devel](http://groups.google.com/group/sage-devel/msg/c97a99f23ea576b7)).
-
-* I removed `$(GNUCRYPTOLIB)` and `$(TWISTEDWEB2)`, which appear to be unnecessary.
-
-* I removed several comments about Gnuplot, dvipng, etc.  These also seem to be obsolete.  I wasn't sure about the (Py)OpenSSL comments, so I left them.
 
 To test the changes:
 
-* Update `spkg/install` and `spkg/standard/deps`.
-* Add #8357's eclib-*.spkg.
+* Update `spkg/install` and `spkg/standard/deps` from [here](http://sage.math.washington.edu/home/mpatel/trac/8306).
+* Add #8357's `eclib-*.spkg`.
+* Add #8477's `palp-*.spkg`.
 * `export SAGE_PARALLEL_SPKG_BUILD="yes"`
 * `export MAKE="make -jX"` where `X > 1`
 * `make`
 
-To make `sage -i foo-X.Y.spkg` *also* append to `spkg/logs/foo-X.Y.log`, apply [attachment:trac_8306_scripts-spkg_log_files.patch] to the scripts repository.
+To build with `SAGE_CHECK="ok"`, add #7091's `sqlalchemy-*.spkg`.  To make `sage -i foo-X.Y.spkg` *also* append to `spkg/logs/foo-X.Y.log`, apply [attachment:trac_8306_scripts-spkg_log_files.patch] to the scripts repository.
``````




---

archive/issue_comments_085189.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,6 +7,7 @@\n To test the changes:\n \n * Update `spkg/install` and `spkg/standard/deps` from [here](http://sage.math.washington.edu/home/mpatel/trac/8306).\n+* Copy [pipestatus](http://sage.math.washington.edu/home/mpatel/trac/8306/pipestatus) to `spkg/`.\n * Add #8357's `eclib-*.spkg`.\n * Add #8477's `palp-*.spkg`.\n * `export SAGE_PARALLEL_SPKG_BUILD=\"yes\"`\n``````\n",
    "created_at": "2010-03-09T04:16:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85189",
    "user": "https://github.com/qed777"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,6 +7,7 @@
 To test the changes:
 
 * Update `spkg/install` and `spkg/standard/deps` from [here](http://sage.math.washington.edu/home/mpatel/trac/8306).
+* Copy [pipestatus](http://sage.math.washington.edu/home/mpatel/trac/8306/pipestatus) to `spkg/`.
 * Add #8357's `eclib-*.spkg`.
 * Add #8477's `palp-*.spkg`.
 * `export SAGE_PARALLEL_SPKG_BUILD="yes"`
``````




---

archive/issue_comments_085190.json:
```json
{
    "body": "<a id='comment:42'></a>\nI've updated the description with what seems to work.  With `SAGE_PARALLEL_SPKG_BUILD=\"yes\"`, `make` should now *not* start building new spkgs if it encounters a fatal error with a package.  It'll just wait for the other processes to stop.\n\nFeel free to find a better place or name for the short `pipestatus` script.",
    "created_at": "2010-03-09T04:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85190",
    "user": "https://github.com/qed777"
}
```

<a id='comment:42'></a>
I've updated the description with what seems to work.  With `SAGE_PARALLEL_SPKG_BUILD="yes"`, `make` should now *not* start building new spkgs if it encounters a fatal error with a package.  It'll just wait for the other processes to stop.

Feel free to find a better place or name for the short `pipestatus` script.



---

archive/issue_comments_085191.json:
```json
{
    "body": "<a id='comment:43'></a>\nIs the intension to use SAGE_CHECK=\"ok\", rather than SAGE_CHECK=\"yes\". I'm not sure if that's a typo in your revised description.",
    "created_at": "2010-03-09T11:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85191",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:43'></a>
Is the intension to use SAGE_CHECK="ok", rather than SAGE_CHECK="yes". I'm not sure if that's a typo in your revised description.



---

archive/issue_comments_085192.json:
```json
{
    "body": "<a id='comment:44'></a>\nIt's just to avoid running some [comment:ticket:8262:2 tests twice].",
    "created_at": "2010-03-09T11:48:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85192",
    "user": "https://github.com/qed777"
}
```

<a id='comment:44'></a>
It's just to avoid running some [comment:ticket:8262:2 tests twice].



---

archive/issue_comments_085193.json:
```json
{
    "body": "<a id='comment:45'></a>\nBuilding spkgs in parallel with 4.3.4.alpha1 per the description:\n\nsage.math: Still works.  Long doctests pass.\n\nbsd: Works, but sometimes palp doesn't build properly.  I think this is a problem with palp's makefiles.  I'll update #8477.  Long doctests pass.\n\nt2: Works with the [stand-in atlas package](http://sage.math.washington.edu/home/mpatel/trac/8306/atlas-3.8.3.p13.spkg) mentioned earlier and modulo a problem with cddlib that happens even with serial builds ([log](http://sage.math.washington.edu/home/mpatel/trac/8306/cddlib-094f.p5.log)).  Long doctests pass, except for `ell_rational_field`, `ell_curve_isogeny`, and `ssmod`, which timed out.  Their short versions pass.",
    "created_at": "2010-03-11T04:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85193",
    "user": "https://github.com/qed777"
}
```

<a id='comment:45'></a>
Building spkgs in parallel with 4.3.4.alpha1 per the description:

sage.math: Still works.  Long doctests pass.

bsd: Works, but sometimes palp doesn't build properly.  I think this is a problem with palp's makefiles.  I'll update #8477.  Long doctests pass.

t2: Works with the [stand-in atlas package](http://sage.math.washington.edu/home/mpatel/trac/8306/atlas-3.8.3.p13.spkg) mentioned earlier and modulo a problem with cddlib that happens even with serial builds ([log](http://sage.math.washington.edu/home/mpatel/trac/8306/cddlib-094f.p5.log)).  Long doctests pass, except for `ell_rational_field`, `ell_curve_isogeny`, and `ssmod`, which timed out.  Their short versions pass.



---

archive/issue_comments_085194.json:
```json
{
    "body": "<a id='comment:46'></a>\nOn my Blade 1000 (900 MHz), bought for the US equivalent of about $75, all those tests pass, in the times indicated below: \n\n```\nsage -t  -long \"devel/sage/sage/schemes/elliptic_curves/ell_curve_isogeny.py\"\n         [933.6 s]\n\nsage -t  -long \"devel/sage/sage/modular/ssmod/ssmod.py\"     \n         [1737.7 s]\n\nsage -t  -long \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\n         [1590.4 s]\n```\n\nGiven my Blade 1000 is faster than 't2', and the default value for SAGE_TIMOUT_LONG is 1800s, it is no surprise these timeout. You will need to increase that variable. I think 10000 s should be safe (actually I rekon 4000 s will be, but I'd play it safe). \n\nI'm surprised the short ones passed if you used the default 300 s timeout. \n\nDave",
    "created_at": "2010-03-11T05:21:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85194",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:46'></a>
On my Blade 1000 (900 MHz), bought for the US equivalent of about $75, all those tests pass, in the times indicated below: 

```
sage -t  -long "devel/sage/sage/schemes/elliptic_curves/ell_curve_isogeny.py"
         [933.6 s]

sage -t  -long "devel/sage/sage/modular/ssmod/ssmod.py"     
         [1737.7 s]

sage -t  -long "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
         [1590.4 s]
```

Given my Blade 1000 is faster than 't2', and the default value for SAGE_TIMOUT_LONG is 1800s, it is no surprise these timeout. You will need to increase that variable. I think 10000 s should be safe (actually I rekon 4000 s will be, but I'd play it safe). 

I'm surprised the short ones passed if you used the default 300 s timeout. 

Dave



---

archive/issue_comments_085195.json:
```json
{
    "body": "<a id='comment:47'></a>\nI increased the timeout for the short tests.  I've also increased the timeout for the long tests and rerun the timed-out tests.  They pass.\n\nAlso: As far as I can tell, this ticket does not break builds where `SAGE_PARALLEL_SPKG_BUILD != \"yes\"`.",
    "created_at": "2010-03-12T09:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85195",
    "user": "https://github.com/qed777"
}
```

<a id='comment:47'></a>
I increased the timeout for the short tests.  I've also increased the timeout for the long tests and rerun the timed-out tests.  They pass.

Also: As far as I can tell, this ticket does not break builds where `SAGE_PARALLEL_SPKG_BUILD != "yes"`.



---

archive/issue_comments_085196.json:
```json
{
    "body": "<a id='comment:48'></a>\nTwo comments: \n\n- Note that the sage_scripts spkg overwrites the file spkg/install, so a few minutes after you've run \"make\", that file no longer has the parallel build changes in it.  I assume that this doesn't interfere with the current build (?).  This would be fixed by implementing the changes here and making a source distribution, thereby producing a new sage_scripts spkg.  Is that the only way?  Or at least the best way?\n\n- Running \"make distclean\" should delete spkg/logs/*.  Here's a patch.",
    "created_at": "2010-04-06T05:50:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85196",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:48'></a>
Two comments: 

- Note that the sage_scripts spkg overwrites the file spkg/install, so a few minutes after you've run "make", that file no longer has the parallel build changes in it.  I assume that this doesn't interfere with the current build (?).  This would be fixed by implementing the changes here and making a source distribution, thereby producing a new sage_scripts spkg.  Is that the only way?  Or at least the best way?

- Running "make distclean" should delete spkg/logs/*.  Here's a patch.



---

archive/attachments_010258.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "makefile",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8306/makefile",
    "created_at": "2010-04-06T05:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_085197.json:
```json
{
    "body": "new version of SAGE_ROOT/makefile",
    "created_at": "2010-04-06T05:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85197",
    "user": "https://github.com/jhpalmieri"
}
```

new version of SAGE_ROOT/makefile



---

archive/issue_comments_085198.json:
```json
{
    "body": "diff of SAGE_ROOT/makefile",
    "created_at": "2010-04-06T05:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85198",
    "user": "https://github.com/jhpalmieri"
}
```

diff of SAGE_ROOT/makefile



---

archive/attachments_010259.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "makefile.diff",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8306/makefile.diff",
    "created_at": "2010-04-06T21:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.diff",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_085199.json:
```json
{
    "body": "scripts repo: add pipestatus to source distribution",
    "created_at": "2010-04-06T21:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85199",
    "user": "https://github.com/jhpalmieri"
}
```

scripts repo: add pipestatus to source distribution



---

archive/issue_comments_085200.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2010-04-06T22:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85200",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from needs_review to needs_work.



---

archive/attachments_010260.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_8306_scripts-pipestatus.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8306/trac_8306_scripts-pipestatus.patch",
    "created_at": "2010-04-06T22:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_085201.json:
```json
{
    "body": "<a id='comment:49'></a>\nRunning \"sage -sdist\" with these changes doesn't work because pipestatus doesn't get copied over.  The patch \"trac_8306_scripts-pipestatus.patch\" fixes this.\n\nI was able to successfully build this on sage.math, but I had problems on my mac (with two cores, using \"make -j2\").  I think it's with singular; I get lots of lines like\n\n```\nsage/libs/singular/singular.cpp:162:21: error: factory.h: No such file or directory\n```\nIt seems to be building singular at the same time as the main Sage spkg; does that sound okay?",
    "created_at": "2010-04-06T22:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85201",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:49'></a>
Running "sage -sdist" with these changes doesn't work because pipestatus doesn't get copied over.  The patch "trac_8306_scripts-pipestatus.patch" fixes this.

I was able to successfully build this on sage.math, but I had problems on my mac (with two cores, using "make -j2").  I think it's with singular; I get lots of lines like

```
sage/libs/singular/singular.cpp:162:21: error: factory.h: No such file or directory
```
It seems to be building singular at the same time as the main Sage spkg; does that sound okay?



---

archive/issue_comments_085202.json:
```json
{
    "body": "<a id='comment:50'></a>\nFrom spkg/logs/singular-3-1-0-4-20100214.log:\n\n```\nmake install in omalloc\ngcc -O3 -g -fPIC -I. -I/Applications/sage_builds/sage-4.3.5.1/local/include  -I/Applications/sage_builds/sage-4.3.5.1/local/include -DHAVE_CONFIG_H -DOM_GENERATE_INC omTables.c -o omTables\n./makeheader om_Alloc.h omalloc.h\nmakeheader: Include file omTables.h not found\nmake[4]: *** [omalloc.h] Error 1\nmake[3]: *** [install] Error 1\nmake[2]: *** [/Applications/sage_builds/sage-4.3.5.1/local/bin/Singular-3-1-0] Error 2\nUnable to build Singular.\n```",
    "created_at": "2010-04-06T22:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85202",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:50'></a>
From spkg/logs/singular-3-1-0-4-20100214.log:

```
make install in omalloc
gcc -O3 -g -fPIC -I. -I/Applications/sage_builds/sage-4.3.5.1/local/include  -I/Applications/sage_builds/sage-4.3.5.1/local/include -DHAVE_CONFIG_H -DOM_GENERATE_INC omTables.c -o omTables
./makeheader om_Alloc.h omalloc.h
makeheader: Include file omTables.h not found
make[4]: *** [omalloc.h] Error 1
make[3]: *** [install] Error 1
make[2]: *** [/Applications/sage_builds/sage-4.3.5.1/local/bin/Singular-3-1-0] Error 2
Unable to build Singular.
```



---

archive/issue_comments_085203.json:
```json
{
    "body": "<a id='comment:51'></a>\nTypo in deps: \n\n```\n$(SAGE_LOGS)/$(FLINGQS).log\n```\nshould say \n\n```\n$(SAGE_LOGS)/$(FLINTQS).log\n                   ^\n```",
    "created_at": "2010-04-07T04:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85203",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:51'></a>
Typo in deps: 

```
$(SAGE_LOGS)/$(FLINGQS).log
```
should say 

```
$(SAGE_LOGS)/$(FLINTQS).log
                   ^
```



---

archive/issue_comments_085204.json:
```json
{
    "body": "<a id='comment:52'></a>\nOn my iMac, the following packages failed to build with SAGE_CHECK='1':\n\n- iconv (failed because spkg-check failed; this should be fixed by the new iconv spkg at #8638)\n- sagetex (failed because spkg-check failed; this is because spkg-check requires the main Sage library, but Sage is not a prerequisite for sagetex in spkg/standard/deps - ought to be fixable, but I'm not sure what the right prerequisites are: sage, maxima, gap?  Perhaps should be done independently of this ticket?)\n- ecl (failed, but I don't know why -- see the log file [here](http://sage.math.washington.edu/home/palmieri/misc/ecl-10.2.1.log))\n- maxima (failed because ecl failed, although I don't know why the build process didn't just stop when ecl failed)\n- singular (failed, but I don't know why -- see the log file [here](http://sage.math.washington.edu/home/palmieri/misc/singular-3-1-0-4-20100214.log))\n- sage (failed because singular failed)\n\nFor both singular and ecl, I was able to build them by turning off parallel building just for them (by hand).  Then after turning off SAGE_CHECK, everything else built successfully.",
    "created_at": "2010-04-07T06:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85204",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:52'></a>
On my iMac, the following packages failed to build with SAGE_CHECK='1':

- iconv (failed because spkg-check failed; this should be fixed by the new iconv spkg at #8638)
- sagetex (failed because spkg-check failed; this is because spkg-check requires the main Sage library, but Sage is not a prerequisite for sagetex in spkg/standard/deps - ought to be fixable, but I'm not sure what the right prerequisites are: sage, maxima, gap?  Perhaps should be done independently of this ticket?)
- ecl (failed, but I don't know why -- see the log file [here](http://sage.math.washington.edu/home/palmieri/misc/ecl-10.2.1.log))
- maxima (failed because ecl failed, although I don't know why the build process didn't just stop when ecl failed)
- singular (failed, but I don't know why -- see the log file [here](http://sage.math.washington.edu/home/palmieri/misc/singular-3-1-0-4-20100214.log))
- sage (failed because singular failed)

For both singular and ecl, I was able to build them by turning off parallel building just for them (by hand).  Then after turning off SAGE_CHECK, everything else built successfully.



---

archive/issue_comments_085205.json:
```json
{
    "body": "<a id='comment:53'></a>\nFrom irc:\n\n```\n<_leif> we don't need \"pipestatus\" either\n<_leif> \"set -o pipefail;\"\n<_leif> that will set the exit status of a pipe to the last non-zero one\n```\nSome random web page says that this was introduced in version 3 of bash and doesn't work on the Mac, but it does work on my Mac running OS X 10.6.  I guess this may not work on OS X 10.4, as that seems to have included version 2.",
    "created_at": "2010-04-10T23:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85205",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:53'></a>
From irc:

```
<_leif> we don't need "pipestatus" either
<_leif> "set -o pipefail;"
<_leif> that will set the exit status of a pipe to the last non-zero one
```
Some random web page says that this was introduced in version 3 of bash and doesn't work on the Mac, but it does work on my Mac running OS X 10.6.  I guess this may not work on OS X 10.4, as that seems to have included version 2.



---

archive/issue_comments_085206.json:
```json
{
    "body": "<a id='comment:54'></a>\nReplying to [jhpalmieri](#comment%3A53):\n> Some random web page says that this was introduced in version 3 of bash and doesn't work on the Mac, but it does work on my Mac running OS X 10.6.  I guess this may not work on OS X 10.4, as that seems to have included version 2.\n\n\nThe `bash` ChangeLog states it was introduced in version 3.0-alpha.\n\nTo avoid side effects, the setting should be done just for a/the subshell, i.e. replacing\n\n```\n    cmd1 | cmd2 | ... | cmdN | tee logfile\n```\nby\n\n```\n    (set -o pipefail; cmd1 | cmd2 | ... | cmdN | tee logfile)\n```\n\nSufficiently recent versions of bash should at least be *available* for all OSs currently supported by Sage (including OS X).",
    "created_at": "2010-04-11T00:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85206",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:54'></a>
Replying to [jhpalmieri](#comment%3A53):
> Some random web page says that this was introduced in version 3 of bash and doesn't work on the Mac, but it does work on my Mac running OS X 10.6.  I guess this may not work on OS X 10.4, as that seems to have included version 2.


The `bash` ChangeLog states it was introduced in version 3.0-alpha.

To avoid side effects, the setting should be done just for a/the subshell, i.e. replacing

```
    cmd1 | cmd2 | ... | cmdN | tee logfile
```
by

```
    (set -o pipefail; cmd1 | cmd2 | ... | cmdN | tee logfile)
```

Sufficiently recent versions of bash should at least be *available* for all OSs currently supported by Sage (including OS X).



---

archive/issue_comments_085207.json:
```json
{
    "body": "<a id='comment:55'></a>\nReplying to [leif](#comment%3A54):\n> Sufficiently recent versions of bash should at least be *available* for all OSs currently supported by Sage (including OS X).\n\n\nRecent versions may be available, but we don't necessarily want to require people to install a newer version of bash just to use Sage.  So (if for example OS X 10.4 is officially supported by Sage) we would have to write a script that tests the version of bash (using `${BASH_VERSINFO[0]`}, I guess), and if less than 3, then do something else.\n\nOr since parallel building is an enhancement, I suppose we could make bash 3 a prerequisite for it.  We would have to write SAGE_ROOT/spkg/standard/deps in a way which works with all versions, though.",
    "created_at": "2010-04-11T01:14:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85207",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:55'></a>
Replying to [leif](#comment%3A54):
> Sufficiently recent versions of bash should at least be *available* for all OSs currently supported by Sage (including OS X).


Recent versions may be available, but we don't necessarily want to require people to install a newer version of bash just to use Sage.  So (if for example OS X 10.4 is officially supported by Sage) we would have to write a script that tests the version of bash (using `${BASH_VERSINFO[0]`}, I guess), and if less than 3, then do something else.

Or since parallel building is an enhancement, I suppose we could make bash 3 a prerequisite for it.  We would have to write SAGE_ROOT/spkg/standard/deps in a way which works with all versions, though.



---

archive/issue_comments_085208.json:
```json
{
    "body": "<a id='comment:56'></a>\nReplying to [jhpalmieri](#comment%3A55):\n> Or since parallel building is an enhancement, I suppose we could make bash 3 a prerequisite for it.  We would have to write SAGE_ROOT/spkg/standard/deps in a way which works with all versions, though.\n\n\nWell, `bash` 3.0 was released nearly six years ago (and there are pre-built binaries of it available), so I'd say it *should* be OK to make it a prerequisite - it's central and ubiquitous, and I'd call 2.x deprecated.\n\nBut that's only *my* opinion, though in general I'd prefer omitting as much GNUism as possible, trying to stay within POSIX scope (which for example the shell's `trap` mechanism is).\n\n[Sorry, maybe too off-topic.]",
    "created_at": "2010-04-11T05:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85208",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:56'></a>
Replying to [jhpalmieri](#comment%3A55):
> Or since parallel building is an enhancement, I suppose we could make bash 3 a prerequisite for it.  We would have to write SAGE_ROOT/spkg/standard/deps in a way which works with all versions, though.


Well, `bash` 3.0 was released nearly six years ago (and there are pre-built binaries of it available), so I'd say it *should* be OK to make it a prerequisite - it's central and ubiquitous, and I'd call 2.x deprecated.

But that's only *my* opinion, though in general I'd prefer omitting as much GNUism as possible, trying to stay within POSIX scope (which for example the shell's `trap` mechanism is).

[Sorry, maybe too off-topic.]



---

archive/issue_comments_085209.json:
```json
{
    "body": "<a id='comment:57'></a>\nI too would rather POSIX was used, and not basisms. The -o option is specified by POSIX\n\nhttp://www.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#set\n\nbut note the comment about \"unspecified format\". If it's possible to avoid that I would, since even bash could change at a later date.",
    "created_at": "2010-04-11T08:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85209",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:57'></a>
I too would rather POSIX was used, and not basisms. The -o option is specified by POSIX

http://www.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#set

but note the comment about "unspecified format". If it's possible to avoid that I would, since even bash could change at a later date.



---

archive/issue_comments_085210.json:
```json
{
    "body": "<a id='comment:58'></a>\n> note the comment about \"unspecified format\".\n\n\nI read that comment to be about \"set -o\" with no further options, not about \"set -o OPTION\". \"pipefail\" is documented here, by the way:\n\n http://www.gnu.org/software/bash/manual/bashref.html#The-Set-Builtin\n\nI don't see anything wrong with bashisms, as long as we have #!/usr/bin/env bash at the top of the file. In any case, I'm happy for *any* solution to the pipe situation here: in a command of the form ($1) | ($2), we want the exit code of ($1).\n\nI'm posting experimental versions of pipestatus and deps which test for the bash version and if at least 3, use pipefail.\n\nBy the way, I still can't get singular and ecl to compile on my iMac if SAGE_PARALLEL_SPKG_BUILD is set to \"yes\". Any help with that issue would be appreciated.",
    "created_at": "2010-04-11T15:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85210",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:58'></a>
> note the comment about "unspecified format".


I read that comment to be about "set -o" with no further options, not about "set -o OPTION". "pipefail" is documented here, by the way:

 http://www.gnu.org/software/bash/manual/bashref.html#The-Set-Builtin

I don't see anything wrong with bashisms, as long as we have #!/usr/bin/env bash at the top of the file. In any case, I'm happy for *any* solution to the pipe situation here: in a command of the form ($1) | ($2), we want the exit code of ($1).

I'm posting experimental versions of pipestatus and deps which test for the bash version and if at least 3, use pipefail.

By the way, I still can't get singular and ecl to compile on my iMac if SAGE_PARALLEL_SPKG_BUILD is set to "yes". Any help with that issue would be appreciated.



---

archive/attachments_010261.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "pipestatus-new",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8306/pipestatus-new",
    "created_at": "2010-04-11T15:22:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_085211.json:
```json
{
    "body": "version of pipestatus using pipefail",
    "created_at": "2010-04-11T15:22:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85211",
    "user": "https://github.com/jhpalmieri"
}
```

version of pipestatus using pipefail



---

archive/issue_comments_085212.json:
```json
{
    "body": "<a id='comment:59'></a>\nReplying to [jhpalmieri](#comment%3A58):\n> I'm posting experimental versions of pipestatus and deps which test for the bash version and if at least 3, use pipefail.\n\n\nIt appears that `deps-new` is based on a version of `deps` that predates the [latest] version at\n\n* http://sage.math.washington.edu/home/mpatel/trac/8306/\n\n(last modified on 8 March).  Is there a particular reason for this?  For example, it turns out that we shouldn't use `$(PLUS)`, which can sometimes force an unwanted parallel build within an spkg (i.e., it's better to leave the decision to `spkg-install`).  The 8 March version also fixes [comment:ticket:8306:29 this problem].  But this version still has the `FLINTQS` typo [comment:ticket:8306:51 mentioned above].\n\n> By the way, I still can't get singular and ecl to compile on my iMac if SAGE_PARALLEL_SPKG_BUILD is set to \"yes\". Any help with that issue would be appreciated.\n\n\nI'll try to investigate soon.",
    "created_at": "2010-06-03T09:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85212",
    "user": "https://github.com/qed777"
}
```

<a id='comment:59'></a>
Replying to [jhpalmieri](#comment%3A58):
> I'm posting experimental versions of pipestatus and deps which test for the bash version and if at least 3, use pipefail.


It appears that `deps-new` is based on a version of `deps` that predates the [latest] version at

* http://sage.math.washington.edu/home/mpatel/trac/8306/

(last modified on 8 March).  Is there a particular reason for this?  For example, it turns out that we shouldn't use `$(PLUS)`, which can sometimes force an unwanted parallel build within an spkg (i.e., it's better to leave the decision to `spkg-install`).  The 8 March version also fixes [comment:ticket:8306:29 this problem].  But this version still has the `FLINTQS` typo [comment:ticket:8306:51 mentioned above].

> By the way, I still can't get singular and ecl to compile on my iMac if SAGE_PARALLEL_SPKG_BUILD is set to "yes". Any help with that issue would be appreciated.


I'll try to investigate soon.



---

archive/issue_comments_085213.json:
```json
{
    "body": "**Changing reviewer** from \"David Kirkby\" to \"David Kirkby, John Palmieri\".",
    "created_at": "2010-06-03T09:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85213",
    "user": "https://github.com/qed777"
}
```

**Changing reviewer** from "David Kirkby" to "David Kirkby, John Palmieri".



---

archive/issue_comments_085214.json:
```json
{
    "body": "Allow redirection of stderr and other file descriptors.  Add comp.os.unix FAQ reference.",
    "created_at": "2010-06-08T08:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85214",
    "user": "https://github.com/qed777"
}
```

Allow redirection of stderr and other file descriptors.  Add comp.os.unix FAQ reference.



---

archive/attachments_010262.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "pipestatus",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8306/pipestatus",
    "created_at": "2010-06-08T09:04:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid",
    "user": "https://github.com/qed777"
}
```



---

archive/issue_comments_085215.json:
```json
{
    "body": "<a id='comment:60'></a>\nReplying to [mpatel](#comment%3A59):\n> > By the way, I still can't get singular and ecl to compile on my iMac if SAGE_PARALLEL_SPKG_BUILD is set to \"yes\". Any help with that issue would be appreciated.\n\n> \n> I'll try to investigate soon.\n\n\nI've attached updated versions of `deps`, `install`, and `pipestatus` to accompany the `makefile` and the two `trac_8306_scripts-*` patches.  With these and the forthcoming spkgs at #9185, #9186, and #9187, I can build 4.4.4.alpha0 with SAGE_PARALLEL_SPKG_BUILD=\"yes\"`.",
    "created_at": "2010-06-08T09:04:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85215",
    "user": "https://github.com/qed777"
}
```

<a id='comment:60'></a>
Replying to [mpatel](#comment%3A59):
> > By the way, I still can't get singular and ecl to compile on my iMac if SAGE_PARALLEL_SPKG_BUILD is set to "yes". Any help with that issue would be appreciated.

> 
> I'll try to investigate soon.


I've attached updated versions of `deps`, `install`, and `pipestatus` to accompany the `makefile` and the two `trac_8306_scripts-*` patches.  With these and the forthcoming spkgs at #9185, #9186, and #9187, I can build 4.4.4.alpha0 with SAGE_PARALLEL_SPKG_BUILD="yes"`.



---

archive/issue_comments_085216.json:
```json
{
    "body": "<a id='comment:61'></a>\nReplying to [mpatel](#comment%3A60):\n> I've attached updated versions of `deps`, `install`, and `pipestatus` to accompany the `makefile` and the two `trac_8306_scripts-*` patches.  With these and the forthcoming spkgs at #9185, #9186, and #9187, I can build 4.4.4.alpha0 with SAGE_PARALLEL_SPKG_BUILD=\"yes\"`.\n\n\nI also need the latest Maxima spkg at #8731.",
    "created_at": "2010-06-09T03:23:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85216",
    "user": "https://github.com/qed777"
}
```

<a id='comment:61'></a>
Replying to [mpatel](#comment%3A60):
> I've attached updated versions of `deps`, `install`, and `pipestatus` to accompany the `makefile` and the two `trac_8306_scripts-*` patches.  With these and the forthcoming spkgs at #9185, #9186, and #9187, I can build 4.4.4.alpha0 with SAGE_PARALLEL_SPKG_BUILD="yes"`.


I also need the latest Maxima spkg at #8731.



---

archive/issue_comments_085217.json:
```json
{
    "body": "Rebased for 4.4.4.alpha0.  Replaces previous version.",
    "created_at": "2010-06-09T07:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85217",
    "user": "https://github.com/qed777"
}
```

Rebased for 4.4.4.alpha0.  Replaces previous version.



---

archive/issue_comments_085218.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,17 +1,17 @@\n-Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.  Notes:\n+Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.\n \n-* I put packages installed by setuptools (twisted, zodb, pygments, jinja, jinja2, sphinx, sqlalchemy, sagenb) in a linear chain, because setuptools does not consistently update `SAGE_LOCAL/lib/python/site-packages/easy-install.pth` in parallel.\n+To build multiple spkgs in parallel:\n \n-* I dropped mpir from gap's dependencies (see [sage-devel](http://groups.google.com/group/sage-devel/msg/c97a99f23ea576b7)).\n-\n-To test the changes:\n-\n-* Update `spkg/install` and `spkg/standard/deps` from [here](http://sage.math.washington.edu/home/mpatel/trac/8306).\n-* Copy [pipestatus](http://sage.math.washington.edu/home/mpatel/trac/8306/pipestatus) to `spkg/`.\n-* Add #8357's `eclib-*.spkg`.\n-* Add #8477's `palp-*.spkg`.\n+* Start with Sage 4.4.4.alpha0.\n+* Update [attachment:makefile], `spkg/`[attachment:install], and `spkg/standard/`[attachment:deps].\n+* Copy [attachment:pipestatus] to `spkg/`.\n+* Copy the latest spkgs from #8731 (Maxima), #9185 (Singular), #9186 (R), and #9187 (ECL) to `spkg/standard`.\n * `export SAGE_PARALLEL_SPKG_BUILD=\"yes\"`\n * `export MAKE=\"make -jX\"` where `X > 1`\n * `make`\n \n-To build with `SAGE_CHECK=\"ok\"`, add #7091's `sqlalchemy-*.spkg`.  To make `sage -i foo-X.Y.spkg` *also* append to `spkg/logs/foo-X.Y.log`, apply [attachment:trac_8306_scripts-spkg_log_files.patch] to the scripts repository.\n+Also:\n+\n+* Apply [attachment:trac_8306_scripts-spkg_log_files.2.patch] to the scripts repository.  This makes `sage -i foo-X.Y.spkg` *also* append to `spkg/logs/foo-X.Y.log`.\n+\n+* Apply [attachment:trac_8306_scripts-pipestatus.patch] to the scripts repository.  This ensures that `sage -sdist <VERSION>` includes `pipestatus` in a new Sage source distribution.\n``````\n",
    "created_at": "2010-06-09T09:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85218",
    "user": "https://github.com/qed777"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,17 +1,17 @@
-Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.  Notes:
+Along with a primed [ccache](http://ccache.samba.org/), compiling multiple spkgs in parallel may significantly speed up Sage builds on multicore machines.  See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/4c915ae814dd6514) for some information.
 
-* I put packages installed by setuptools (twisted, zodb, pygments, jinja, jinja2, sphinx, sqlalchemy, sagenb) in a linear chain, because setuptools does not consistently update `SAGE_LOCAL/lib/python/site-packages/easy-install.pth` in parallel.
+To build multiple spkgs in parallel:
 
-* I dropped mpir from gap's dependencies (see [sage-devel](http://groups.google.com/group/sage-devel/msg/c97a99f23ea576b7)).
-
-To test the changes:
-
-* Update `spkg/install` and `spkg/standard/deps` from [here](http://sage.math.washington.edu/home/mpatel/trac/8306).
-* Copy [pipestatus](http://sage.math.washington.edu/home/mpatel/trac/8306/pipestatus) to `spkg/`.
-* Add #8357's `eclib-*.spkg`.
-* Add #8477's `palp-*.spkg`.
+* Start with Sage 4.4.4.alpha0.
+* Update [attachment:makefile], `spkg/`[attachment:install], and `spkg/standard/`[attachment:deps].
+* Copy [attachment:pipestatus] to `spkg/`.
+* Copy the latest spkgs from #8731 (Maxima), #9185 (Singular), #9186 (R), and #9187 (ECL) to `spkg/standard`.
 * `export SAGE_PARALLEL_SPKG_BUILD="yes"`
 * `export MAKE="make -jX"` where `X > 1`
 * `make`
 
-To build with `SAGE_CHECK="ok"`, add #7091's `sqlalchemy-*.spkg`.  To make `sage -i foo-X.Y.spkg` *also* append to `spkg/logs/foo-X.Y.log`, apply [attachment:trac_8306_scripts-spkg_log_files.patch] to the scripts repository.
+Also:
+
+* Apply [attachment:trac_8306_scripts-spkg_log_files.2.patch] to the scripts repository.  This makes `sage -i foo-X.Y.spkg` *also* append to `spkg/logs/foo-X.Y.log`.
+
+* Apply [attachment:trac_8306_scripts-pipestatus.patch] to the scripts repository.  This ensures that `sage -sdist <VERSION>` includes `pipestatus` in a new Sage source distribution.
``````




---

archive/attachments_010263.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_8306_scripts-spkg_log_files.2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8306/trac_8306_scripts-spkg_log_files.2.patch",
    "created_at": "2010-06-09T09:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/qed777"
}
```



---

archive/issue_comments_085219.json:
```json
{
    "body": "<a id='comment:62'></a>\n",
    "created_at": "2010-06-09T09:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85219",
    "user": "https://github.com/qed777"
}
```

<a id='comment:62'></a>




---

archive/issue_comments_085220.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-06-09T09:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85220",
    "user": "https://github.com/qed777"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_085221.json:
```json
{
    "body": "<a id='comment:63'></a>\nI'm testing this now: I've applied the patches, put the new spkg's in place, etc., and run \"sage -sdist ...\".  Then I unpacked the new tar file and tried building.  It failed on my mac: I needed to change the line (in \"deps\") from\n\n```\nINSTALL = pipestatus\n```\nto\n\n```\nINSTALL = $(SAGE_ROOT)/spkg/pipestatus\n```\nAfter making that change, it's building right now.  I'll report on the outcome when it's done.",
    "created_at": "2010-06-09T15:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85221",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:63'></a>
I'm testing this now: I've applied the patches, put the new spkg's in place, etc., and run "sage -sdist ...".  Then I unpacked the new tar file and tried building.  It failed on my mac: I needed to change the line (in "deps") from

```
INSTALL = pipestatus
```
to

```
INSTALL = $(SAGE_ROOT)/spkg/pipestatus
```
After making that change, it's building right now.  I'll report on the outcome when it's done.



---

archive/issue_comments_085222.json:
```json
{
    "body": "<a id='comment:64'></a>\nThings look good.  It's worked successfully on sage.math (took 30 minutes!), a Mac, on the skynet machine \"lena\" (`x86_64-Linux-k10 (with NVIDIA GeForce GPUs)`).  It's still building on t2, although I cheated a bit: I used a build of atlas from a previous Sage install to save myself 11 hours of build time.  It has a chance to finish in 6 or 8 hours instead of the previous time of 17 hours (sans atlas and docs).\n\nI'll report back when the t2 build is done, but once the small change to \"deps\" is made, I think this will be done (modulo #8731, #9185, #9186, and #9187).",
    "created_at": "2010-06-09T21:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85222",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:64'></a>
Things look good.  It's worked successfully on sage.math (took 30 minutes!), a Mac, on the skynet machine "lena" (`x86_64-Linux-k10 (with NVIDIA GeForce GPUs)`).  It's still building on t2, although I cheated a bit: I used a build of atlas from a previous Sage install to save myself 11 hours of build time.  It has a chance to finish in 6 or 8 hours instead of the previous time of 17 hours (sans atlas and docs).

I'll report back when the t2 build is done, but once the small change to "deps" is made, I think this will be done (modulo #8731, #9185, #9186, and #9187).



---

archive/issue_comments_085223.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2010-06-09T23:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85223",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_085224.json:
```json
{
    "body": "<a id='comment:65'></a>\nThe t2 build has completed successfully, in just over 4 hours -- much better than the 17 hours previously required, and even better than the 6 or 8 that I was predicting.  So if you'll fix deps, I'll give this a positive review.",
    "created_at": "2010-06-09T23:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85224",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:65'></a>
The t2 build has completed successfully, in just over 4 hours -- much better than the 17 hours previously required, and even better than the 6 or 8 that I was predicting.  So if you'll fix deps, I'll give this a positive review.



---

archive/issue_comments_085225.json:
```json
{
    "body": "<a id='comment:66'></a>\nI've updated `deps` and `deps.diff`.  Thanks very much to everyone for their help with patches, typos, builds, testing, and other advice!\n\nAdditional data: I've had successful builds on bsd, sage.math, and t2.  The long tests pass, up to those to be fixed at #8731 and a [pre-existing failure](http://groups.google.com/group/sage-devel/browse_thread/thread/26b2aae934131c92/4faf6a32bd792962?q=solaris+bsd.py+group:sage-devel#4faf6a32bd792962) in `BSD.py` on Solaris.  Builds with `SAGE_CHECK` set also succeed, except for R on t2, but this appears to be a separate problem (see a later comment).\n\nShould `$(BASE)` be an (in)direct prerequisite for all non-base packages, including Fortran and Cephes?  So far, I haven't had any problems with these.  Pending reports on sage-devel, we could open a separate ticket about making the dependencies in `deps` more explicit/strict.",
    "created_at": "2010-06-09T23:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85225",
    "user": "https://github.com/qed777"
}
```

<a id='comment:66'></a>
I've updated `deps` and `deps.diff`.  Thanks very much to everyone for their help with patches, typos, builds, testing, and other advice!

Additional data: I've had successful builds on bsd, sage.math, and t2.  The long tests pass, up to those to be fixed at #8731 and a [pre-existing failure](http://groups.google.com/group/sage-devel/browse_thread/thread/26b2aae934131c92/4faf6a32bd792962?q=solaris+bsd.py+group:sage-devel#4faf6a32bd792962) in `BSD.py` on Solaris.  Builds with `SAGE_CHECK` set also succeed, except for R on t2, but this appears to be a separate problem (see a later comment).

Should `$(BASE)` be an (in)direct prerequisite for all non-base packages, including Fortran and Cephes?  So far, I haven't had any problems with these.  Pending reports on sage-devel, we could open a separate ticket about making the dependencies in `deps` more explicit/strict.



---

archive/issue_comments_085226.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-06-09T23:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85226",
    "user": "https://github.com/qed777"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_085227.json:
```json
{
    "body": "**Changing author** from \"Mitesh Patel\" to \"Mitesh Patel, John Palmieri\".",
    "created_at": "2010-06-09T23:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85227",
    "user": "https://github.com/qed777"
}
```

**Changing author** from "Mitesh Patel" to "Mitesh Patel, John Palmieri".



---

archive/issue_comments_085228.json:
```json
{
    "body": "<a id='comment:67'></a>\nFrom R's `make check` on t2:\n\n```\nCollecting examples for package \u2018stats\u2019\n  Extracting from parsed Rd's ..............................\nRunning examples in package \u2018stats\u2019\nError: testing 'stats' failed\nExecution halted\nmake[5]: *** [test-Examples-Base] Error 1\n```\nSome detail from `src/tests/Examples/stats-Ex.Rout.fail`:\n\n```\n> contrasts(ffs) <- contr.sum(5, sparse=TRUE)[,1:2]; contrasts(ffs)\nError in .Diag(levels, sparse = sparse) : \n  contr*(.., sparse=TRUE) needs package \"Matrix\" correctly installed\nCalls: contr.sum -> .Diag\nExecution halted\n```\nAccording to [this log](http://sage.math.washington.edu/home/mpatel/trac/8306/r-2.10.1.p2.log), R's Matrix package isn't built/installed successfully on t2:\n\n```\nLoading required package: Matrix\nError in dyn.load(file, DLLpath = DLLpath, ...) : \n  unable to load shared library '/scratch/mpatel/sage-4.4.4.alpha0-j64-par-chk/spkg/build/r-2.10.1.p2/src/library/Matrix/libs/Matrix.so':\n  ld.so.1: R: fatal: libgcc_s.so.1: open failed: No such file or directory\nError : require(Matrix, save = FALSE) is not TRUE\n```\nAn alternative is to compare the output of `ls SAGE_LOCAL/lib/R/library` on non-#8306 sage.math and t2 builds.  I think we're also missing class, mgcv, nnet, rpart, spatial, and survival on t2.\n\nBut I think this is independent of this ticket --- see, e.g., `/rootpool2/local/kirkby/sage-4.4.3/install.log` on t2.",
    "created_at": "2010-06-10T00:09:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85228",
    "user": "https://github.com/qed777"
}
```

<a id='comment:67'></a>
From R's `make check` on t2:

```
Collecting examples for package stats
  Extracting from parsed Rd's ..............................
Running examples in package stats
Error: testing 'stats' failed
Execution halted
make[5]: *** [test-Examples-Base] Error 1
```
Some detail from `src/tests/Examples/stats-Ex.Rout.fail`:

```
> contrasts(ffs) <- contr.sum(5, sparse=TRUE)[,1:2]; contrasts(ffs)
Error in .Diag(levels, sparse = sparse) : 
  contr*(.., sparse=TRUE) needs package "Matrix" correctly installed
Calls: contr.sum -> .Diag
Execution halted
```
According to [this log](http://sage.math.washington.edu/home/mpatel/trac/8306/r-2.10.1.p2.log), R's Matrix package isn't built/installed successfully on t2:

```
Loading required package: Matrix
Error in dyn.load(file, DLLpath = DLLpath, ...) : 
  unable to load shared library '/scratch/mpatel/sage-4.4.4.alpha0-j64-par-chk/spkg/build/r-2.10.1.p2/src/library/Matrix/libs/Matrix.so':
  ld.so.1: R: fatal: libgcc_s.so.1: open failed: No such file or directory
Error : require(Matrix, save = FALSE) is not TRUE
```
An alternative is to compare the output of `ls SAGE_LOCAL/lib/R/library` on non-#8306 sage.math and t2 builds.  I think we're also missing class, mgcv, nnet, rpart, spatial, and survival on t2.

But I think this is independent of this ticket --- see, e.g., `/rootpool2/local/kirkby/sage-4.4.3/install.log` on t2.



---

archive/issue_comments_085229.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2010-06-10T01:31:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85229",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_085230.json:
```json
{
    "body": "<a id='comment:68'></a>\nI agree that the R issue can go on another ticket.  I'm marking this as positive review.\n\nDepends on #8731, #9185, #9186, and #9187.",
    "created_at": "2010-06-10T01:31:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85230",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:68'></a>
I agree that the R issue can go on another ticket.  I'm marking this as positive review.

Depends on #8731, #9185, #9186, and #9187.



---

archive/issue_comments_085231.json:
```json
{
    "body": "<a id='comment:69'></a>\nReplying to [jhpalmieri](#comment%3A68):\n> I agree that the R issue can go on another ticket.\n\nI've opened #9201 for this problem.",
    "created_at": "2010-06-10T07:50:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85231",
    "user": "https://github.com/qed777"
}
```

<a id='comment:69'></a>
Replying to [jhpalmieri](#comment%3A68):
> I agree that the R issue can go on another ticket.

I've opened #9201 for this problem.



---

archive/attachments_010264.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "install",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8306/install",
    "created_at": "2010-06-24T07:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid",
    "user": "https://github.com/qed777"
}
```



---

archive/issue_comments_085232.json:
```json
{
    "body": "`spkg/install`.  Rebased for 4.4.4.",
    "created_at": "2010-06-24T07:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85232",
    "user": "https://github.com/qed777"
}
```

`spkg/install`.  Rebased for 4.4.4.



---

archive/attachments_010265.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "deps",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8306/deps",
    "created_at": "2010-06-24T07:52:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid",
    "user": "https://github.com/qed777"
}
```



---

archive/issue_comments_085233.json:
```json
{
    "body": "`spkg/standard/deps`.  Rebased for 4.4.4.",
    "created_at": "2010-06-24T07:52:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85233",
    "user": "https://github.com/qed777"
}
```

`spkg/standard/deps`.  Rebased for 4.4.4.



---

archive/issue_comments_085234.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,10 +2,10 @@\n \n To build multiple spkgs in parallel:\n \n-* Start with Sage 4.4.4.alpha0.\n+* Start with Sage 4.4.4.\n * Update [attachment:makefile], `spkg/`[attachment:install], and `spkg/standard/`[attachment:deps].\n * Copy [attachment:pipestatus] to `spkg/`.\n-* Copy the latest spkgs from #8731 (Maxima), #9185 (Singular), #9186 (R), and #9187 (ECL) to `spkg/standard`.\n+* Copy the latest spkgs from #8645 (Maxima), #9185 (Singular), #9186 (R), and #9264 (ECL) to `spkg/standard`.\n * `export SAGE_PARALLEL_SPKG_BUILD=\"yes\"`\n * `export MAKE=\"make -jX\"` where `X > 1`\n * `make`\n``````\n",
    "created_at": "2010-06-24T07:53:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85234",
    "user": "https://github.com/qed777"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,10 +2,10 @@
 
 To build multiple spkgs in parallel:
 
-* Start with Sage 4.4.4.alpha0.
+* Start with Sage 4.4.4.
 * Update [attachment:makefile], `spkg/`[attachment:install], and `spkg/standard/`[attachment:deps].
 * Copy [attachment:pipestatus] to `spkg/`.
-* Copy the latest spkgs from #8731 (Maxima), #9185 (Singular), #9186 (R), and #9187 (ECL) to `spkg/standard`.
+* Copy the latest spkgs from #8645 (Maxima), #9185 (Singular), #9186 (R), and #9264 (ECL) to `spkg/standard`.
 * `export SAGE_PARALLEL_SPKG_BUILD="yes"`
 * `export MAKE="make -jX"` where `X > 1`
 * `make`
``````




---

archive/issue_comments_085235.json:
```json
{
    "body": "<a id='comment:71'></a>\nI've updated `deps` and `install` (and diffs) for Sage 4.4.4's removal of GHMM.",
    "created_at": "2010-06-24T07:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85235",
    "user": "https://github.com/qed777"
}
```

<a id='comment:71'></a>
I've updated `deps` and `install` (and diffs) for Sage 4.4.4's removal of GHMM.



---

archive/issue_comments_085236.json:
```json
{
    "body": "<a id='comment:72'></a>\nDependencies: #8645, #9185, #9186, #9264.",
    "created_at": "2010-06-24T07:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85236",
    "user": "https://github.com/qed777"
}
```

<a id='comment:72'></a>
Dependencies: #8645, #9185, #9186, #9264.



---

archive/issue_comments_085237.json:
```json
{
    "body": "<a id='comment:73'></a>\nFor what it's worth, I think that your \"diff\" files for deps and install are backwards, showing the diffs from the new version to the old, rather than from the old to the new.\n\nThe deps file is a bit off: first, under the target \"all\", `$(INST)/$(SAGENB)` is listed, but it's not in the \"real\" version of deps.  I think this is good, and I think it's a bug in the version of deps distributed with Sage.  Other targets are missing from \"all\", though:\n\n```\n  $(INST)/$(JINJA)\n  $(INST)/$(JINJA2)\n  $(INST)/$(PYGMENTS)\n  $(INST)/$(SPHINX)\n  $(INST)/$(SQLALCHEMY)\n  $(INST)/$(TWISTED)\n  $(INST)/$(TWISTEDWEB2)\n```  \nAlso, the following lines are missing:\n\n```\n$(INST)/$(TWISTEDWEB2): $(INST)/$(TWISTED)\n\t$(INSTALL) \"$(SAGE_SPKG) $(TWISTEDWEB2) 2>&1\" \"tee -a $(SAGE_LOGS)/$(TWISTEDWEB2).log\"\n```\nI'm attaching \"deps-new\" and \"deps-new.diff\" to fix this.",
    "created_at": "2010-06-24T20:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85237",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:73'></a>
For what it's worth, I think that your "diff" files for deps and install are backwards, showing the diffs from the new version to the old, rather than from the old to the new.

The deps file is a bit off: first, under the target "all", `$(INST)/$(SAGENB)` is listed, but it's not in the "real" version of deps.  I think this is good, and I think it's a bug in the version of deps distributed with Sage.  Other targets are missing from "all", though:

```
  $(INST)/$(JINJA)
  $(INST)/$(JINJA2)
  $(INST)/$(PYGMENTS)
  $(INST)/$(SPHINX)
  $(INST)/$(SQLALCHEMY)
  $(INST)/$(TWISTED)
  $(INST)/$(TWISTEDWEB2)
```  
Also, the following lines are missing:

```
$(INST)/$(TWISTEDWEB2): $(INST)/$(TWISTED)
	$(INSTALL) "$(SAGE_SPKG) $(TWISTEDWEB2) 2>&1" "tee -a $(SAGE_LOGS)/$(TWISTEDWEB2).log"
```
I'm attaching "deps-new" and "deps-new.diff" to fix this.



---

archive/issue_comments_085238.json:
```json
{
    "body": "<a id='comment:74'></a>\nOkay, now I'm confused.\n\n```\n  $(INST)/$(TWISTEDWEB2)\n```\nWhat is this package?  It's included in the target \"all\", and the current version of deps has lines\n\n```\n$(INST)/$(TWISTEDWEB2): $(INST)/$(TWISTED)\n\t$(SAGE_SPKG) $(TWISTEDWEB2) 2>&1\n```\nbut it doesn't look like there's an actual package there.  For instance, there are **no** lines like this in install:\n\n```\nTWISTEDWEB2 =`$newest twistedweb2`\nexport TWISTEDWEB2\n```",
    "created_at": "2010-06-24T23:33:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85238",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:74'></a>
Okay, now I'm confused.

```
  $(INST)/$(TWISTEDWEB2)
```
What is this package?  It's included in the target "all", and the current version of deps has lines

```
$(INST)/$(TWISTEDWEB2): $(INST)/$(TWISTED)
	$(SAGE_SPKG) $(TWISTEDWEB2) 2>&1
```
but it doesn't look like there's an actual package there.  For instance, there are **no** lines like this in install:

```
TWISTEDWEB2 =`$newest twistedweb2`
export TWISTEDWEB2
```



---

archive/issue_comments_085239.json:
```json
{
    "body": "<a id='comment:75'></a>\nI think twistedweb2 used to be a package but is no longer.  I can't find the relevant ticket, but I'm going to remove references to it from deps.  (See also a comment at #9274.)",
    "created_at": "2010-06-25T00:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85239",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:75'></a>
I think twistedweb2 used to be a package but is no longer.  I can't find the relevant ticket, but I'm going to remove references to it from deps.  (See also a comment at #9274.)



---

archive/issue_comments_085240.json:
```json
{
    "body": "spkg/standard/deps. Rebased for 4.4.4.",
    "created_at": "2010-06-25T00:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85240",
    "user": "https://github.com/jhpalmieri"
}
```

spkg/standard/deps. Rebased for 4.4.4.



---

archive/attachments_010266.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "deps-new",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8306/deps-new",
    "created_at": "2010-06-25T00:12:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_085241.json:
```json
{
    "body": "diff between \"deps\" in 4.4.4 and \"deps-new\"",
    "created_at": "2010-06-25T00:12:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85241",
    "user": "https://github.com/jhpalmieri"
}
```

diff between "deps" in 4.4.4 and "deps-new"



---

archive/attachments_010267.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "deps-deps-new.diff",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8306/deps-deps-new.diff",
    "created_at": "2010-06-25T00:12:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.diff",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_085242.json:
```json
{
    "body": "diff between mpatel's \"deps\" and \"deps-new\"",
    "created_at": "2010-06-25T00:12:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85242",
    "user": "https://github.com/jhpalmieri"
}
```

diff between mpatel's "deps" and "deps-new"



---

archive/issue_comments_085243.json:
```json
{
    "body": "<a id='comment:76'></a>\nI tried this again on t2 yesterday.  With `MAKE=\"make -j4\"`, it worked, building Sage (except for Atlas, which I installed by hand) in 4 hours.  For future tickets, we might want to pursue the following: with `MAKE=\"make -j36\"`, the installation failed on the packages `lapack`, `mpir`, `r`, and `sage`.  (After each failure, I switched to \"make -j4\" until the problematic package was built, then switched back to \"j36\".)",
    "created_at": "2010-06-25T15:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85243",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:76'></a>
I tried this again on t2 yesterday.  With `MAKE="make -j4"`, it worked, building Sage (except for Atlas, which I installed by hand) in 4 hours.  For future tickets, we might want to pursue the following: with `MAKE="make -j36"`, the installation failed on the packages `lapack`, `mpir`, `r`, and `sage`.  (After each failure, I switched to "make -j4" until the problematic package was built, then switched back to "j36".)



---

archive/issue_events_024256.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-06-25T15:40:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8306#event-24256"
}
```



---

archive/issue_comments_085244.json:
```json
{
    "body": "**Merged:** sage-4.5.alpha0",
    "created_at": "2010-06-25T15:40:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85244",
    "user": "https://github.com/rlmill"
}
```

**Merged:** sage-4.5.alpha0



---

archive/attachments_010268.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "deps.diff",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8306/deps.diff",
    "created_at": "2010-06-26T07:47:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.diff",
    "user": "https://github.com/qed777"
}
```



---

archive/issue_comments_085245.json:
```json
{
    "body": "Diff of `spkg/standard/deps` vs 4.4.4.",
    "created_at": "2010-06-26T07:47:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85245",
    "user": "https://github.com/qed777"
}
```

Diff of `spkg/standard/deps` vs 4.4.4.



---

archive/issue_comments_085246.json:
```json
{
    "body": "Diff of `spkg/install` vs 4.4.4.",
    "created_at": "2010-06-26T07:48:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85246",
    "user": "https://github.com/qed777"
}
```

Diff of `spkg/install` vs 4.4.4.



---

archive/attachments_010269.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "install.diff",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8306/install.diff",
    "created_at": "2010-06-26T08:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.diff",
    "user": "https://github.com/qed777"
}
```



---

archive/issue_comments_085247.json:
```json
{
    "body": "<a id='comment:78'></a>\nReplying to [jhpalmieri](#comment%3A75):\n> I think twistedweb2 used to be a package but is no longer.  I can't find the relevant ticket, but I'm going to remove references to it from deps.  (See also a comment at #9274.)\n\n\nI mentioned twistedweb2 in an [older version of the description](http://trac.sagemath.org/sage_trac/ticket/8306?action=diff&version=70&old_version=3).\n\nMaybe we should add the missing targets (Sphinx, etc.) at #9274?  It does seem better to be explicit about the dependencies.",
    "created_at": "2010-06-26T08:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8306#issuecomment-85247",
    "user": "https://github.com/qed777"
}
```

<a id='comment:78'></a>
Replying to [jhpalmieri](#comment%3A75):
> I think twistedweb2 used to be a package but is no longer.  I can't find the relevant ticket, but I'm going to remove references to it from deps.  (See also a comment at #9274.)


I mentioned twistedweb2 in an [older version of the description](http://trac.sagemath.org/sage_trac/ticket/8306?action=diff&version=70&old_version=3).

Maybe we should add the missing targets (Sphinx, etc.) at #9274?  It does seem better to be explicit about the dependencies.
