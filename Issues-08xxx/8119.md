# Issue 8119: Rename change the hash value of some objects

archive/issues_008119.json:
```json
{
    "body": "For many objects the hash value is computed from `__repr__`. This is a bad idea since renaming the object change its hash value.\n\n```\nsage: bla = PolynomialRing(ZZ,\"x\")\nsage: hash(bla)\n-1525918542791298668\nsage: bla.rename(\"toto\")\nsage: hash(bla)\n2314052222105390764\n```\n\n**Apply Only:**\n1. [attachment:8119-parent-hash-final.patch]\n\n\nAssignee: tbd\n\nCC:  @jasongrout simonking\n\nReviewer: Florent Hivert, Nicolas M. Thi\u00e9ry, Nicolas Borie\n\nAuthor: Robert Bradshaw\n\nMerged: sage-5.0.rc0\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/8119\n\n",
    "closed_at": "2012-04-30T09:51:35Z",
    "created_at": "2010-01-29T15:22:48Z",
    "labels": [
        "component: misc",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Rename change the hash value of some objects",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8119",
    "user": "https://github.com/hivert"
}
```
For many objects the hash value is computed from `__repr__`. This is a bad idea since renaming the object change its hash value.

```
sage: bla = PolynomialRing(ZZ,"x")
sage: hash(bla)
-1525918542791298668
sage: bla.rename("toto")
sage: hash(bla)
2314052222105390764
```

**Apply Only:**
1. [attachment:8119-parent-hash-final.patch]


Assignee: tbd

CC:  @jasongrout simonking

Reviewer: Florent Hivert, Nicolas M. Thi√©ry, Nicolas Borie

Author: Robert Bradshaw

Merged: sage-5.0.rc0

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/8119





---

archive/issue_comments_073770.json:
```json
{
    "body": "<a id='comment:1'></a>For immutable objects, like Parents, the default __hash__ could store the value used the first time it is computed. This doesn't solve the problem of \n\n```\nsage: bla = PolynomialRing(ZZ,\"x\")\nsage: hash(bla['t'])\n-1733828288\nsage: bla.rename(\"toto\")\nsage: hash(bla['t'])\n-1924319844\n```",
    "created_at": "2010-03-12T09:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73770",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:1'></a>For immutable objects, like Parents, the default __hash__ could store the value used the first time it is computed. This doesn't solve the problem of 

```
sage: bla = PolynomialRing(ZZ,"x")
sage: hash(bla['t'])
-1733828288
sage: bla.rename("toto")
sage: hash(bla['t'])
-1924319844
```



---

archive/issue_comments_073771.json:
```json
{
    "body": "Attachment [8119-parent-hash.patch](tarball://root/attachments/some-uuid/ticket8119/8119-parent-hash.patch) by @robertwb created at 2010-03-12 09:57:30",
    "created_at": "2010-03-12T09:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73771",
    "user": "https://github.com/robertwb"
}
```

Attachment [8119-parent-hash.patch](tarball://root/attachments/some-uuid/ticket8119/8119-parent-hash.patch) by @robertwb created at 2010-03-12 09:57:30



---

archive/issue_comments_073772.json:
```json
{
    "body": "<a id='comment:2'></a>This is a partial fix (that won't work for SageObject in general, unless we enforce that mutable objects maintain their own hash, and I don't think we want to put an extra field on all Elements), but resolves the most important case. It's also a performance gain.",
    "created_at": "2010-03-12T09:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73772",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:2'></a>This is a partial fix (that won't work for SageObject in general, unless we enforce that mutable objects maintain their own hash, and I don't think we want to put an extra field on all Elements), but resolves the most important case. It's also a performance gain.



---

archive/issue_events_019436.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-03-12T09:59:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "milestone": "sage-4.3.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8119#event-19436"
}
```



---

archive/issue_comments_073773.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-03-12T09:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73773",
    "user": "https://github.com/robertwb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_073774.json:
```json
{
    "body": "<a id='comment:3'></a>Hi Robert,\n\nI've one question related to this and I like to have the confirmation from an expert. After your patch, upon pickling/unpickling the hash value can change because it is not pickled and neither is the name, right ? As far as I manage to test this is not harmful to pickle a dict containing a renamed parent. Indeed, trying to read `cPickle.c`, I understood that the dict is reconstructed from it's items and thus even if the hash changed the element is inserted correctly in the dict during unpickling. Can you confirm this ?\n\nIf this is not both this patch and #8120 are broken.\n\nAlso, after this, do you still need #8506 ?\n\nFlorent",
    "created_at": "2010-03-12T22:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73774",
    "user": "https://github.com/hivert"
}
```

<a id='comment:3'></a>Hi Robert,

I've one question related to this and I like to have the confirmation from an expert. After your patch, upon pickling/unpickling the hash value can change because it is not pickled and neither is the name, right ? As far as I manage to test this is not harmful to pickle a dict containing a renamed parent. Indeed, trying to read `cPickle.c`, I understood that the dict is reconstructed from it's items and thus even if the hash changed the element is inserted correctly in the dict during unpickling. Can you confirm this ?

If this is not both this patch and #8120 are broken.

Also, after this, do you still need #8506 ?

Florent



---

archive/issue_comments_073775.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 hivert]:\n> Hi Robert,\n> \n> I've one question related to this and I like to have the confirmation from an expert. After your patch, upon pickling/unpickling the hash value can change because it is not pickled and neither is the name, right ? As far as I manage to test this is not harmful to pickle a dict containing a renamed parent. Indeed, trying to read `cPickle.c`, I understood that the dict is reconstructed from it's items and thus even if the hash changed the element is inserted correctly in the dict during unpickling. Can you confirm this ?\n\n\nThat is correct. Hashes in general are not guaranteed to be consistent from run to run, all that really matters is that they satisfy (to the best they can) the equality constraints. \n\n> If this is not both this patch and #8120 are broken.\n> \n> Also, after this, do you still need #8506 ?\n\n\nYes, #8506 is still important--in my case I'm reducing a curve mod many, many primes, doing just a bit of stuff on each before throwing them away. I suppose eventually caching the hash value would eventually be a win, but that's a separate optimization.",
    "created_at": "2010-03-13T09:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73775",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:4'></a>Replying to [comment:3 hivert]:
> Hi Robert,
> 
> I've one question related to this and I like to have the confirmation from an expert. After your patch, upon pickling/unpickling the hash value can change because it is not pickled and neither is the name, right ? As far as I manage to test this is not harmful to pickle a dict containing a renamed parent. Indeed, trying to read `cPickle.c`, I understood that the dict is reconstructed from it's items and thus even if the hash changed the element is inserted correctly in the dict during unpickling. Can you confirm this ?


That is correct. Hashes in general are not guaranteed to be consistent from run to run, all that really matters is that they satisfy (to the best they can) the equality constraints. 

> If this is not both this patch and #8120 are broken.
> 
> Also, after this, do you still need #8506 ?


Yes, #8506 is still important--in my case I'm reducing a curve mod many, many primes, doing just a bit of stuff on each before throwing them away. I suppose eventually caching the hash value would eventually be a win, but that's a separate optimization.



---

archive/issue_comments_073776.json:
```json
{
    "body": "<a id='comment:6'></a>hivert: do you want to review this ticket?",
    "created_at": "2010-10-02T19:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73776",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:6'></a>hivert: do you want to review this ticket?



---

archive/issue_comments_073777.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-04-04T17:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73777",
    "user": "https://github.com/hivert"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_073778.json:
```json
{
    "body": "<a id='comment:7'></a>> hivert: do you want to review this ticket?\n\n\nSure ! I completely forgot about this one. Sorry !\n\nThey are a few place where we should remove the bad implementation using `__repr__` since they all inherits from `CategoryObject`: \n\n```\npopcorn-*ge-combinat/sage $ grep \"hash(self.__repr__())\" **/*.py*\ngroups/group.pyx:        return hash(self.__repr__())\nmodules/module.pyx:        return hash(self.__repr__())\nmodules/module.pyx:        return hash(self.__repr__())\nrings/polynomial/multi_polynomial_libsingular.pyx:        return hash(self.__repr__())\nrings/ring.pyx:        return hash(self.__repr__())\nstructure/sage_object.pyx:        return hash(self.__repr__())\n```\nI don't have time to do it right now. I'll do it soon if you don't beat me.",
    "created_at": "2011-04-04T17:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73778",
    "user": "https://github.com/hivert"
}
```

<a id='comment:7'></a>> hivert: do you want to review this ticket?


Sure ! I completely forgot about this one. Sorry !

They are a few place where we should remove the bad implementation using `__repr__` since they all inherits from `CategoryObject`: 

```
popcorn-*ge-combinat/sage $ grep "hash(self.__repr__())" **/*.py*
groups/group.pyx:        return hash(self.__repr__())
modules/module.pyx:        return hash(self.__repr__())
modules/module.pyx:        return hash(self.__repr__())
rings/polynomial/multi_polynomial_libsingular.pyx:        return hash(self.__repr__())
rings/ring.pyx:        return hash(self.__repr__())
structure/sage_object.pyx:        return hash(self.__repr__())
```
I don't have time to do it right now. I'll do it soon if you don't beat me.



---

archive/issue_comments_073779.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-04-04T18:48:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73779",
    "user": "https://github.com/hivert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_073780.json:
```json
{
    "body": "<a id='comment:8'></a>> They are a few place where we should remove the bad implementation using\n> `__repr__` since they all inherits from `CategoryObject`:\n\n\nI just added a review patch which removes the wrong hash methods.\n\nPlease review. I'm ok with the original patch, so if my review patch is ok\nyou can put a positive review on my behalf.",
    "created_at": "2011-04-04T18:48:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73780",
    "user": "https://github.com/hivert"
}
```

<a id='comment:8'></a>> They are a few place where we should remove the bad implementation using
> `__repr__` since they all inherits from `CategoryObject`:


I just added a review patch which removes the wrong hash methods.

Please review. I'm ok with the original patch, so if my review patch is ok
you can put a positive review on my behalf.



---

archive/issue_comments_073781.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -9,6 +9,11 @@\n 2314052222105390764\n \\`\\`\\`\n \n+**Apply:**\n+1. [attachment:8119-parent-hash.patch]\n+2. [attachment:8119-parent-hash-review.patch]\n+\n+\n Comment: 1\n \n Issue created by migration from https://trac.sagemath.org/ticket/8119\n```\n",
    "created_at": "2011-04-04T18:48:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73781",
    "user": "https://github.com/hivert"
}
```

Description changed:
```diff
--- 
+++ 
@@ -9,6 +9,11 @@
 2314052222105390764
 \`\`\`
 
+**Apply:**
+1. [attachment:8119-parent-hash.patch]
+2. [attachment:8119-parent-hash-review.patch]
+
+
 Comment: 1
 
 Issue created by migration from https://trac.sagemath.org/ticket/8119
```




---

archive/issue_comments_073782.json:
```json
{
    "body": "<a id='comment:9'></a>Attachment [8119-parent-hash-review.patch](tarball://root/attachments/some-uuid/ticket8119/8119-parent-hash-review.patch) by @nthiery created at 2011-04-21 01:45:08\n\nFlorent's review patch looks good. However ``consistant* should be written ``consistent* in the first patch. I also did not yet set a positive review because of the ongoing discussion on sage-devel. Please feel free to go ahead and set a positive review once the typo is fixed and if it is decided that the PolynomialRing issue shall be fixed in a follow up patch.\n\nCheers,\n                                   Nicolas",
    "created_at": "2011-04-21T01:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73782",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:9'></a>Attachment [8119-parent-hash-review.patch](tarball://root/attachments/some-uuid/ticket8119/8119-parent-hash-review.patch) by @nthiery created at 2011-04-21 01:45:08

Florent's review patch looks good. However ``consistant* should be written ``consistent* in the first patch. I also did not yet set a positive review because of the ongoing discussion on sage-devel. Please feel free to go ahead and set a positive review once the typo is fixed and if it is decided that the PolynomialRing issue shall be fixed in a follow up patch.

Cheers,
                                   Nicolas



---

archive/issue_comments_073783.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-04-21T01:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73783",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_073784.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2011-04-21T09:27:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73784",
    "user": "https://github.com/robertwb"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_073785.json:
```json
{
    "body": "<a id='comment:10'></a>Attachment [8119-parent-hash.2.patch](tarball://root/attachments/some-uuid/ticket8119/8119-parent-hash.2.patch) by @robertwb created at 2011-04-21 09:27:06\n\nFixed the typo, I don't think the issue with sparse PolynomialRing #11231 should hold this ticket up any longer (it's had a patch sitting on it for over a year...)",
    "created_at": "2011-04-21T09:27:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73785",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:10'></a>Attachment [8119-parent-hash.2.patch](tarball://root/attachments/some-uuid/ticket8119/8119-parent-hash.2.patch) by @robertwb created at 2011-04-21 09:27:06

Fixed the typo, I don't think the issue with sparse PolynomialRing #11231 should hold this ticket up any longer (it's had a patch sitting on it for over a year...)



---

archive/issue_comments_073786.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,17 @@\n+For many objects the hash value is computed from \\`__repr__\\`. This is a bad idea since renaming the object change its hash value.\n+\n+\\`\\`\\`\n+sage: bla = PolynomialRing(ZZ,\"x\")\n+sage: hash(bla)\n+-1525918542791298668\n+sage: bla.rename(\"toto\")\n+sage: hash(bla)\n+2314052222105390764\n+\\`\\`\\`\n+\n+**Apply:**\n+1. [attachment:8119-parent-hash.2.patch]\n+2. [attachment:8119-parent-hash-review.patch]\n \n \n Comment: 1\n```\n",
    "created_at": "2011-04-21T19:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73786",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,17 @@
+For many objects the hash value is computed from \`__repr__\`. This is a bad idea since renaming the object change its hash value.
+
+\`\`\`
+sage: bla = PolynomialRing(ZZ,"x")
+sage: hash(bla)
+-1525918542791298668
+sage: bla.rename("toto")
+sage: hash(bla)
+2314052222105390764
+\`\`\`
+
+**Apply:**
+1. [attachment:8119-parent-hash.2.patch]
+2. [attachment:8119-parent-hash-review.patch]
 
 
 Comment: 1
```




---

archive/issue_comments_073787.json:
```json
{
    "body": "<a id='comment:11'></a>I'm assuming the \"apply\" should be changed...",
    "created_at": "2011-04-21T19:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73787",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>I'm assuming the "apply" should be changed...



---

archive/issue_events_019437.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-21T19:36:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "milestone": "sage-4.3.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8119#event-19437"
}
```



---

archive/issue_events_019438.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-21T19:36:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "milestone": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8119#event-19438"
}
```



---

archive/issue_comments_073788.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-04-22T19:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73788",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_073789.json:
```json
{
    "body": "<a id='comment:12'></a>Please change the commit message of [attachment:8119-parent-hash.2.patch] (use hg qrefresh -e for that).",
    "created_at": "2011-04-22T19:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73789",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>Please change the commit message of [attachment:8119-parent-hash.2.patch] (use hg qrefresh -e for that).



---

archive/issue_comments_073790.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-04-23T10:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73790",
    "user": "https://github.com/hivert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_073791.json:
```json
{
    "body": "<a id='comment:13'></a>Attachment [8119-parent-hash.3.patch](tarball://root/attachments/some-uuid/ticket8119/8119-parent-hash.3.patch) by @hivert created at 2011-04-23 10:47:52\n\nI just re-uploaded roberts patch with a correct log message. I'm not sure I'm allowed to put a positive review though. \n\nFlorent",
    "created_at": "2011-04-23T10:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73791",
    "user": "https://github.com/hivert"
}
```

<a id='comment:13'></a>Attachment [8119-parent-hash.3.patch](tarball://root/attachments/some-uuid/ticket8119/8119-parent-hash.3.patch) by @hivert created at 2011-04-23 10:47:52

I just re-uploaded roberts patch with a correct log message. I'm not sure I'm allowed to put a positive review though. 

Florent



---

archive/issue_comments_073792.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,17 @@\n+For many objects the hash value is computed from \\`__repr__\\`. This is a bad idea since renaming the object change its hash value.\n+\n+\\`\\`\\`\n+sage: bla = PolynomialRing(ZZ,\"x\")\n+sage: hash(bla)\n+-1525918542791298668\n+sage: bla.rename(\"toto\")\n+sage: hash(bla)\n+2314052222105390764\n+\\`\\`\\`\n+\n+**Apply:**\n+1. [attachment:8119-parent-hash.3.patch]\n+2. [attachment:8119-parent-hash-review.patch]\n \n \n Comment: 1\n```\n",
    "created_at": "2011-04-23T10:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73792",
    "user": "https://github.com/hivert"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,17 @@
+For many objects the hash value is computed from \`__repr__\`. This is a bad idea since renaming the object change its hash value.
+
+\`\`\`
+sage: bla = PolynomialRing(ZZ,"x")
+sage: hash(bla)
+-1525918542791298668
+sage: bla.rename("toto")
+sage: hash(bla)
+2314052222105390764
+\`\`\`
+
+**Apply:**
+1. [attachment:8119-parent-hash.3.patch]
+2. [attachment:8119-parent-hash-review.patch]
 
 
 Comment: 1
```




---

archive/issue_comments_073793.json:
```json
{
    "body": "<a id='comment:14'></a>Bonjour Florent!\n\nI am not sure the log message for 8119-parent-hash-review.patch is proper. While you are at it, I'd suggest to just fold it in the other patch. The review history does not bring much information here, so having a single patch will give a better overview to the future reader.\n\nI'll set a positive review right after.",
    "created_at": "2011-04-23T13:12:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73793",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:14'></a>Bonjour Florent!

I am not sure the log message for 8119-parent-hash-review.patch is proper. While you are at it, I'd suggest to just fold it in the other patch. The review history does not bring much information here, so having a single patch will give a better overview to the future reader.

I'll set a positive review right after.



---

archive/issue_comments_073794.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-04-23T13:12:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73794",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_073795.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,16 @@\n+For many objects the hash value is computed from \\`__repr__\\`. This is a bad idea since renaming the object change its hash value.\n+\n+\\`\\`\\`\n+sage: bla = PolynomialRing(ZZ,\"x\")\n+sage: hash(bla)\n+-1525918542791298668\n+sage: bla.rename(\"toto\")\n+sage: hash(bla)\n+2314052222105390764\n+\\`\\`\\`\n+\n+**Apply Only:**\n+1. [attachment:8119-parent-hash-final.patch]\n \n \n Comment: 1\n```\n",
    "created_at": "2011-04-23T13:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73795",
    "user": "https://github.com/hivert"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,16 @@
+For many objects the hash value is computed from \`__repr__\`. This is a bad idea since renaming the object change its hash value.
+
+\`\`\`
+sage: bla = PolynomialRing(ZZ,"x")
+sage: hash(bla)
+-1525918542791298668
+sage: bla.rename("toto")
+sage: hash(bla)
+2314052222105390764
+\`\`\`
+
+**Apply Only:**
+1. [attachment:8119-parent-hash-final.patch]
 
 
 Comment: 1
```




---

archive/issue_comments_073796.json:
```json
{
    "body": "<a id='comment:15'></a>> I'd suggest to just fold it in the other patch.\n\n\nDone.",
    "created_at": "2011-04-23T13:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73796",
    "user": "https://github.com/hivert"
}
```

<a id='comment:15'></a>> I'd suggest to just fold it in the other patch.


Done.



---

archive/issue_comments_073797.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-04-23T13:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73797",
    "user": "https://github.com/hivert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_073798.json:
```json
{
    "body": "<a id='comment:17'></a>Thanks!\n\nIt seems the buildbot is getting confused about which patch to apply though.",
    "created_at": "2011-04-23T15:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73798",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:17'></a>Thanks!

It seems the buildbot is getting confused about which patch to apply though.



---

archive/issue_comments_073799.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-04-23T15:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73799",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_073800.json:
```json
{
    "body": "<a id='comment:18'></a>Apply 8119-parent-hash-final.patch\n\nGranted, the patchbot doesn't bother testing positively reviewed tickets (not that anything it's concerned with changed). Thanks for getting to this for me.",
    "created_at": "2011-04-24T05:05:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73800",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:18'></a>Apply 8119-parent-hash-final.patch

Granted, the patchbot doesn't bother testing positively reviewed tickets (not that anything it's concerned with changed). Thanks for getting to this for me.



---

archive/issue_comments_073801.json:
```json
{
    "body": "<a id='comment:19'></a>Some of these doctests should be differentiated on 32-bit systems (in particular, all the results of `hash()`).",
    "created_at": "2011-05-03T08:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73801",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>Some of these doctests should be differentiated on 32-bit systems (in particular, all the results of `hash()`).



---

archive/issue_comments_073802.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-05-03T08:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73802",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_073803.json:
```json
{
    "body": "<a id='comment:20'></a>*bump*",
    "created_at": "2011-05-19T08:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73803",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>*bump*



---

archive/issue_comments_073804.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,16 @@\n+For many objects the hash value is computed from \\`__repr__\\`. This is a bad idea since renaming the object change its hash value.\n+\n+\\`\\`\\`\n+sage: bla = PolynomialRing(ZZ,\"x\")\n+sage: hash(bla)\n+-1525918542791298668\n+sage: bla.rename(\"toto\")\n+sage: hash(bla)\n+2314052222105390764\n+\\`\\`\\`\n+\n+**Apply Only:**\n+1. [attachment:8119-parent-hash-final-fix32.patch]\n \n \n Comment: 1\n```\n",
    "created_at": "2012-03-29T14:48:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73804",
    "user": "https://trac.sagemath.org/admin/accounts/users/nborie"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,16 @@
+For many objects the hash value is computed from \`__repr__\`. This is a bad idea since renaming the object change its hash value.
+
+\`\`\`
+sage: bla = PolynomialRing(ZZ,"x")
+sage: hash(bla)
+-1525918542791298668
+sage: bla.rename("toto")
+sage: hash(bla)
+2314052222105390764
+\`\`\`
+
+**Apply Only:**
+1. [attachment:8119-parent-hash-final-fix32.patch]
 
 
 Comment: 1
```




---

archive/issue_comments_073805.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-29T14:48:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73805",
    "user": "https://trac.sagemath.org/admin/accounts/users/nborie"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_073806.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-29T14:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73806",
    "user": "https://github.com/hivert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_073807.json:
```json
{
    "body": "<a id='comment:23'></a>On boxen (Linux x86_64), I get:\n\n```\nsage -t  -force_lib devel/sage/sage/structure/category_object.pyx\n**********************************************************************\nFile \"/padic/scratch/jdemeyer/merger/sage-5.0.beta14/devel/sage-main/sage/structure/category_object.pyx\", line 757:\n    sage: hash(bla)\nExpected:\n    -1525918542791298668\nGot:\n    -5279516879544852222\n**********************************************************************\nFile \"/padic/scratch/jdemeyer/merger/sage-5.0.beta14/devel/sage-main/sage/structure/category_object.pyx\", line 761:\n    sage: hash(bla)\nExpected:\n    -1525918542791298668\nGot:\n    -5279516879544852222\n**********************************************************************\n```",
    "created_at": "2012-04-06T06:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73807",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>On boxen (Linux x86_64), I get:

```
sage -t  -force_lib devel/sage/sage/structure/category_object.pyx
**********************************************************************
File "/padic/scratch/jdemeyer/merger/sage-5.0.beta14/devel/sage-main/sage/structure/category_object.pyx", line 757:
    sage: hash(bla)
Expected:
    -1525918542791298668
Got:
    -5279516879544852222
**********************************************************************
File "/padic/scratch/jdemeyer/merger/sage-5.0.beta14/devel/sage-main/sage/structure/category_object.pyx", line 761:
    sage: hash(bla)
Expected:
    -1525918542791298668
Got:
    -5279516879544852222
**********************************************************************
```



---

archive/issue_comments_073808.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-04-06T06:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73808",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_073809.json:
```json
{
    "body": "<a id='comment:24'></a>Attachment [8119-parent-hash-final-fix32.patch](tarball://root/attachments/some-uuid/ticket8119/8119-parent-hash-final-fix32.patch) by @nthiery created at 2012-04-06 14:45:27\n\nReplying to [comment:23 jdemeyer]:\n> On boxen (Linux x86_64), I get:\n> \n> ```\n> sage -t  -force_lib devel/sage/sage/structure/category_object.pyx\n> **********************************************************************\n> File \"/padic/scratch/jdemeyer/merger/sage-5.0.beta14/devel/sage-main/sage/structure/category_object.pyx\", line 757:\n>     sage: hash(bla)\n> Expected:\n>     -1525918542791298668\n> Got:\n>     -5279516879544852222\n> **********************************************************************\n> File \"/padic/scratch/jdemeyer/merger/sage-5.0.beta14/devel/sage-main/sage/structure/category_object.pyx\", line 761:\n>     sage: hash(bla)\n> Expected:\n>     -1525918542791298668\n> Got:\n>     -5279516879544852222\n> **********************************************************************\n> ```\n\n\nWeird, I get here the same result as you on boxen, both with 4.8 and 5.0.beta8. I don't know how a wrong return value ended up in the patch. \n\nOh well, I updated the patch to expect the result obtained on boxen.",
    "created_at": "2012-04-06T14:45:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73809",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:24'></a>Attachment [8119-parent-hash-final-fix32.patch](tarball://root/attachments/some-uuid/ticket8119/8119-parent-hash-final-fix32.patch) by @nthiery created at 2012-04-06 14:45:27

Replying to [comment:23 jdemeyer]:
> On boxen (Linux x86_64), I get:
> 
> ```
> sage -t  -force_lib devel/sage/sage/structure/category_object.pyx
> **********************************************************************
> File "/padic/scratch/jdemeyer/merger/sage-5.0.beta14/devel/sage-main/sage/structure/category_object.pyx", line 757:
>     sage: hash(bla)
> Expected:
>     -1525918542791298668
> Got:
>     -5279516879544852222
> **********************************************************************
> File "/padic/scratch/jdemeyer/merger/sage-5.0.beta14/devel/sage-main/sage/structure/category_object.pyx", line 761:
>     sage: hash(bla)
> Expected:
>     -1525918542791298668
> Got:
>     -5279516879544852222
> **********************************************************************
> ```


Weird, I get here the same result as you on boxen, both with 4.8 and 5.0.beta8. I don't know how a wrong return value ended up in the patch. 

Oh well, I updated the patch to expect the result obtained on boxen.



---

archive/issue_comments_073810.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-04-06T14:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73810",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_073811.json:
```json
{
    "body": "<a id='comment:26'></a>Apply 8119-parent-hash-final-fix32.patch\n\n(for patchbot)",
    "created_at": "2012-04-07T12:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73811",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:26'></a>Apply 8119-parent-hash-final-fix32.patch

(for patchbot)



---

archive/issue_comments_073812.json:
```json
{
    "body": "Attachment [8119-parent-hash-final.patch](tarball://root/attachments/some-uuid/ticket8119/8119-parent-hash-final.patch) by @hivert created at 2012-04-26 22:17:25",
    "created_at": "2012-04-26T22:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73812",
    "user": "https://github.com/hivert"
}
```

Attachment [8119-parent-hash-final.patch](tarball://root/attachments/some-uuid/ticket8119/8119-parent-hash-final.patch) by @hivert created at 2012-04-26 22:17:25



---

archive/issue_comments_073813.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-04-26T22:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73813",
    "user": "https://github.com/hivert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_073814.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,16 @@\n+For many objects the hash value is computed from \\`__repr__\\`. This is a bad idea since renaming the object change its hash value.\n+\n+\\`\\`\\`\n+sage: bla = PolynomialRing(ZZ,\"x\")\n+sage: hash(bla)\n+-1525918542791298668\n+sage: bla.rename(\"toto\")\n+sage: hash(bla)\n+2314052222105390764\n+\\`\\`\\`\n+\n+**Apply Only:**\n+1. [attachment:8119-parent-hash-final.patch]\n \n \n Comment: 1\n```\n",
    "created_at": "2012-04-26T22:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73814",
    "user": "https://github.com/hivert"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,16 @@
+For many objects the hash value is computed from \`__repr__\`. This is a bad idea since renaming the object change its hash value.
+
+\`\`\`
+sage: bla = PolynomialRing(ZZ,"x")
+sage: hash(bla)
+-1525918542791298668
+sage: bla.rename("toto")
+sage: hash(bla)
+2314052222105390764
+\`\`\`
+
+**Apply Only:**
+1. [attachment:8119-parent-hash-final.patch]
 
 
 Comment: 1
```




---

archive/issue_comments_073815.json:
```json
{
    "body": "<a id='comment:28'></a>Hi there,\n\nI'm setting a positive review here but I uploaded a new patch removing a\ntrailling whitespace which bothered the patchbot. The only difference between\n[attachment:8119-parent-hash-final-fix32.patch] and\n[attachment:8119-parent-hash-final.patch] is the trailling space (and of course\nMercurials header), so I don't think a new review is needed.\n\nFlorent",
    "created_at": "2012-04-26T22:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73815",
    "user": "https://github.com/hivert"
}
```

<a id='comment:28'></a>Hi there,

I'm setting a positive review here but I uploaded a new patch removing a
trailling whitespace which bothered the patchbot. The only difference between
[attachment:8119-parent-hash-final-fix32.patch] and
[attachment:8119-parent-hash-final.patch] is the trailling space (and of course
Mercurials header), so I don't think a new review is needed.

Florent



---

archive/issue_comments_073816.json:
```json
{
    "body": "<a id='comment:29'></a>Thanks for the final review!",
    "created_at": "2012-04-27T17:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73816",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:29'></a>Thanks for the final review!



---

archive/issue_comments_073817.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-04-30T09:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8119#issuecomment-73817",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_019439.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-30T09:51:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8119",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8119#event-19439"
}
```
