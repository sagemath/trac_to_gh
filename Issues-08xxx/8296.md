# Issue 8296: getattr hack not failing graciously on descriptors / tab completion broken in emacs

archive/issues_008296.json:
```json
{
    "body": "The getattr hack of #7921 to let extension types \"inherit\" from category does not fail graciously on descriptors.\n\nVisible effect: tab completion is broken under emacs:\n\n```\n   sage: n=1\n   sage: n.<tab>  # gives nothing\n```\n\nThis is a variant of #8223. Emacs does not use dir straight away, but instead calls _ip.IP.magic_psearch which is conservative and does not trust dir. So it actually tries to get all advertised attributes, and in particular the descriptor `__weakref__` which failed on 1 and confused getattr.\n\nThe attached patch makes the getattr fail graciously in such situations.  It probably would be better for `__weakref__` to not appear in dir in the first place, but at least this should fix the bug and variants thereof.\n\nAgain, better implementations of the getattr hack are most welcome. See comments in the code.\n\n**Assignee:** @nthiery\n\n**CC:**  sage-combinat\n\n**Keywords:** tab completion, dir, getattr\n\n**Resolution:** fixed\n\n**Author:** Nicolas M. Thi\u00e9ry\n\n**Reviewer:** Mike Hansen\n\n**Merged:** sage-4.3.4.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/8296\n\n",
    "closed_at": "2010-03-08T20:54:25Z",
    "created_at": "2010-02-17T21:12:53Z",
    "labels": [
        "component: misc",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3.4",
    "title": "getattr hack not failing graciously on descriptors / tab completion broken in emacs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8296",
    "user": "https://github.com/nthiery"
}
```
The getattr hack of #7921 to let extension types "inherit" from category does not fail graciously on descriptors.

Visible effect: tab completion is broken under emacs:

```
   sage: n=1
   sage: n.<tab>  # gives nothing
```

This is a variant of #8223. Emacs does not use dir straight away, but instead calls _ip.IP.magic_psearch which is conservative and does not trust dir. So it actually tries to get all advertised attributes, and in particular the descriptor `__weakref__` which failed on 1 and confused getattr.

The attached patch makes the getattr fail graciously in such situations.  It probably would be better for `__weakref__` to not appear in dir in the first place, but at least this should fix the bug and variants thereof.

Again, better implementations of the getattr hack are most welcome. See comments in the code.

**Assignee:** @nthiery

**CC:**  sage-combinat

**Keywords:** tab completion, dir, getattr

**Resolution:** fixed

**Author:** Nicolas M. Thi√©ry

**Reviewer:** Mike Hansen

**Merged:** sage-4.3.4.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/8296





---

archive/issue_comments_092814.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2010-02-17T21:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8296",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8296#issuecomment-92814",
    "user": "https://github.com/nthiery"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_092815.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,21 @@\n-This is caused by #7981.\n+The getattr hack of #7981 to let extension types \"inherit\" from\n+category does not fail graciously on descriptors.\n+\n+Visible effect: tab completion is broken under emacs:\n+\n+```\n+   sage: n=1\n+   sage: n.<tab>  # gives nothing\n+```\n+\n+This is a variant of #8223. Emacs does not use dir straight away, but\n+instead calls _ip.IP.magic_psearch which is conservative and does not\n+trust dir. So it actually tries to get all advertised attributes, and\n+in particular the descriptor `__weakref__` which failed on 1 and\n+confused getattr.\n+\n+The attached patch makes the getattr fail graciously in such\n+situations.  It probably would be better for `__weakref__` to not appear\n+in dir in the first place, but at least this should fix the bug and\n+variants thereof.\n+\n``````\n",
    "created_at": "2010-02-17T21:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8296",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8296#issuecomment-92815",
    "user": "https://github.com/nthiery"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,21 @@
-This is caused by #7981.
+The getattr hack of #7981 to let extension types "inherit" from
+category does not fail graciously on descriptors.
+
+Visible effect: tab completion is broken under emacs:
+
+```
+   sage: n=1
+   sage: n.<tab>  # gives nothing
+```
+
+This is a variant of #8223. Emacs does not use dir straight away, but
+instead calls _ip.IP.magic_psearch which is conservative and does not
+trust dir. So it actually tries to get all advertised attributes, and
+in particular the descriptor `__weakref__` which failed on 1 and
+confused getattr.
+
+The attached patch makes the getattr fail graciously in such
+situations.  It probably would be better for `__weakref__` to not appear
+in dir in the first place, but at least this should fix the bug and
+variants thereof.
+
``````




---

archive/issue_comments_092816.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,4 @@\n-The getattr hack of #7981 to let extension types \"inherit\" from\n-category does not fail graciously on descriptors.\n+The getattr hack of #7981 to let extension types \"inherit\" from category does not fail graciously on descriptors.\n \n Visible effect: tab completion is broken under emacs:\n \n@@ -8,14 +7,8 @@\n    sage: n.<tab>  # gives nothing\n ```\n \n-This is a variant of #8223. Emacs does not use dir straight away, but\n-instead calls _ip.IP.magic_psearch which is conservative and does not\n-trust dir. So it actually tries to get all advertised attributes, and\n-in particular the descriptor `__weakref__` which failed on 1 and\n-confused getattr.\n+This is a variant of #8223. Emacs does not use dir straight away, but instead calls _ip.IP.magic_psearch which is conservative and does not trust dir. So it actually tries to get all advertised attributes, and in particular the descriptor `__weakref__` which failed on 1 and confused getattr.\n \n-The attached patch makes the getattr fail graciously in such\n-situations.  It probably would be better for `__weakref__` to not appear\n-in dir in the first place, but at least this should fix the bug and\n-variants thereof.\n+The attached patch makes the getattr fail graciously in such situations.  It probably would be better for `__weakref__` to not appear in dir in the first place, but at least this should fix the bug and variants thereof.\n \n+Again, better implementations of the getattr hack are most welcome. See comments in the code.\n``````\n",
    "created_at": "2010-02-17T21:50:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8296",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8296#issuecomment-92816",
    "user": "https://github.com/nthiery"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,4 @@
-The getattr hack of #7981 to let extension types "inherit" from
-category does not fail graciously on descriptors.
+The getattr hack of #7981 to let extension types "inherit" from category does not fail graciously on descriptors.
 
 Visible effect: tab completion is broken under emacs:
 
@@ -8,14 +7,8 @@
    sage: n.<tab>  # gives nothing
 ```
 
-This is a variant of #8223. Emacs does not use dir straight away, but
-instead calls _ip.IP.magic_psearch which is conservative and does not
-trust dir. So it actually tries to get all advertised attributes, and
-in particular the descriptor `__weakref__` which failed on 1 and
-confused getattr.
+This is a variant of #8223. Emacs does not use dir straight away, but instead calls _ip.IP.magic_psearch which is conservative and does not trust dir. So it actually tries to get all advertised attributes, and in particular the descriptor `__weakref__` which failed on 1 and confused getattr.
 
-The attached patch makes the getattr fail graciously in such
-situations.  It probably would be better for `__weakref__` to not appear
-in dir in the first place, but at least this should fix the bug and
-variants thereof.
+The attached patch makes the getattr fail graciously in such situations.  It probably would be better for `__weakref__` to not appear in dir in the first place, but at least this should fix the bug and variants thereof.
 
+Again, better implementations of the getattr hack are most welcome. See comments in the code.
``````




---

archive/issue_events_024744.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/8296",
    "rename": {
        "from": "tab completion broken in emacs",
        "to": "getattr hack not failing graciously on descriptors / tab completion broken in emacs"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8296#event-24744"
}
```



---

archive/attachments_010243.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_8296-fix-tab-completion-emacs-nt.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8296/trac_8296-fix-tab-completion-emacs-nt.patch",
    "created_at": "2010-02-17T21:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8296",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/nthiery"
}
```



---

archive/issue_comments_092817.json:
```json
{
    "body": "",
    "created_at": "2010-02-17T21:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8296",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8296#issuecomment-92817",
    "user": "https://github.com/nthiery"
}
```





---

archive/issue_comments_092818.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The getattr hack of #7981 to let extension types \"inherit\" from category does not fail graciously on descriptors.\n+The getattr hack of #7921 to let extension types \"inherit\" from category does not fail graciously on descriptors.\n \n Visible effect: tab completion is broken under emacs:\n \n``````\n",
    "created_at": "2010-02-17T21:57:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8296",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8296#issuecomment-92818",
    "user": "https://github.com/nthiery"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The getattr hack of #7981 to let extension types "inherit" from category does not fail graciously on descriptors.
+The getattr hack of #7921 to let extension types "inherit" from category does not fail graciously on descriptors.
 
 Visible effect: tab completion is broken under emacs:
 
``````




---

archive/issue_comments_092819.json:
```json
{
    "body": "<a id='comment:5'></a>\nLooks good to me.",
    "created_at": "2010-03-08T20:51:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8296",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8296#issuecomment-92819",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:5'></a>
Looks good to me.



---

archive/issue_comments_092820.json:
```json
{
    "body": "**Reviewer:** Mike Hansen",
    "created_at": "2010-03-08T20:51:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8296",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8296#issuecomment-92820",
    "user": "https://github.com/mwhansen"
}
```

**Reviewer:** Mike Hansen



---

archive/issue_comments_092821.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2010-03-08T20:51:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8296",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8296#issuecomment-92821",
    "user": "https://github.com/mwhansen"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_092822.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2010-03-08T20:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8296",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8296#issuecomment-92822",
    "user": "https://github.com/mwhansen"
}
```

**Resolution:** fixed



---

archive/issue_comments_092823.json:
```json
{
    "body": "**Merged:** sage-4.3.4.alpha1",
    "created_at": "2010-03-08T20:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8296",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8296#issuecomment-92823",
    "user": "https://github.com/mwhansen"
}
```

**Merged:** sage-4.3.4.alpha1



---

archive/issue_events_024745.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-03-08T20:54:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8296",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8296#event-24745"
}
```
