# Issue 8707: view(x) calls x._latex_() 5 times!

archive/issues_008707.json:
```json
{
    "body": "latex(x) calls x._latex_() twice, and view(x) 5 times!!!\n\nFor small objects, that's fine, but when x is a graph, and latex'ing it requires calling graphviz, dot2tex, ... it is not reasonable!\n\n```\nsage: class blah():\n....:     def _latex_(x):\n....:         print \"coucou\"\n....:         return \"x\"\n....: \nsage: latex(blah())\ncoucou\ncoucou\nx\nsage: view(blah())\ncoucou\ncoucou\ncoucou\ncoucou\ncoucou\n```\n\nAnalysis:\n- latex makes use of has_latex_expr which makes a call to _latex_ but discards the result\n\n- latex_file does not reuse its calls to latex(x)\n\nAssignee: @aghitza\n\nCC:  sage-combinat\n\nKeywords: latex\n\nResolution: fixed\n\nAuthor: Nicolas M. Thi\u00e9ry\n\nReviewer: Andrey Novoseltsev\n\nMerged: sage-4.4.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/8707\n\n",
    "closed_at": "2010-04-19T05:18:02Z",
    "created_at": "2010-04-17T21:52:29Z",
    "labels": [
        "component: misc",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.4",
    "title": "view(x) calls x._latex_() 5 times!",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8707",
    "user": "https://github.com/nthiery"
}
```
latex(x) calls x._latex_() twice, and view(x) 5 times!!!

For small objects, that's fine, but when x is a graph, and latex'ing it requires calling graphviz, dot2tex, ... it is not reasonable!

```
sage: class blah():
....:     def _latex_(x):
....:         print "coucou"
....:         return "x"
....: 
sage: latex(blah())
coucou
coucou
x
sage: view(blah())
coucou
coucou
coucou
coucou
coucou
```

Analysis:
- latex makes use of has_latex_expr which makes a call to _latex_ but discards the result

- latex_file does not reuse its calls to latex(x)

Assignee: @aghitza

CC:  sage-combinat

Keywords: latex

Resolution: fixed

Author: Nicolas M. Thiéry

Reviewer: Andrey Novoseltsev

Merged: sage-4.4.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/8707





---

archive/issue_comments_092173.json:
```json
{
    "body": "Attachment [trac_8707-5x_faster_latex-nt.patch](tarball://root/attachments/some-uuid/ticket8707/trac_8707-5x_faster_latex-nt.patch) by @nthiery created at 2010-04-17 22:10:27",
    "created_at": "2010-04-17T22:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8707#issuecomment-92173",
    "user": "https://github.com/nthiery"
}
```

Attachment [trac_8707-5x_faster_latex-nt.patch](tarball://root/attachments/some-uuid/ticket8707/trac_8707-5x_faster_latex-nt.patch) by @nthiery created at 2010-04-17 22:10:27



---

archive/issue_comments_092174.json:
```json
{
    "body": "<a id='comment:1'></a>\nNow, e.g.\n\n```\nsage: g = sage.categories.category.category_graph()\nsage: g.set_latex_options(format = \"dot2tex\")\nsage: view(g, viewer=\"pdf\", tightpage = True)\n```\ntakes 6 seconds instead of .5 minutes, which makes it finally usable!",
    "created_at": "2010-04-17T22:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8707#issuecomment-92174",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:1'></a>
Now, e.g.

```
sage: g = sage.categories.category.category_graph()
sage: g.set_latex_options(format = "dot2tex")
sage: view(g, viewer="pdf", tightpage = True)
```
takes 6 seconds instead of .5 minutes, which makes it finally usable!



---

archive/issue_comments_092175.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-04-17T22:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8707#issuecomment-92175",
    "user": "https://github.com/nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_092176.json:
```json
{
    "body": "Changing author from \"\" to \"Nicolas M. Thi\u00e9ry\"",
    "created_at": "2010-04-17T22:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8707#issuecomment-92176",
    "user": "https://github.com/nthiery"
}
```

Changing author from "" to "Nicolas M. Thiéry"



---

archive/issue_comments_092177.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-04-17T23:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8707#issuecomment-92177",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_092178.json:
```json
{
    "body": "<a id='comment:2'></a>\nLooks good, passes all doctests!",
    "created_at": "2010-04-17T23:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8707#issuecomment-92178",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:2'></a>
Looks good, passes all doctests!



---

archive/issue_comments_092179.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Andrey Novoseltsev\"",
    "created_at": "2010-04-17T23:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8707#issuecomment-92179",
    "user": "https://github.com/novoselt"
}
```

Changing reviewer from "" to "Andrey Novoseltsev"



---

archive/issue_comments_092180.json:
```json
{
    "body": "<a id='comment:3'></a>\nDo we know for sure that types are the only sorts of objects which have this problem (that is, which seem to inherit a `_latex_` method according to hasattr, but which actually don't when you try to call it)?",
    "created_at": "2010-04-18T02:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8707#issuecomment-92180",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>
Do we know for sure that types are the only sorts of objects which have this problem (that is, which seem to inherit a `_latex_` method according to hasattr, but which actually don't when you try to call it)?



---

archive/issue_comments_092181.json:
```json
{
    "body": "<a id='comment:4'></a>\nI thought about it, but it seems to me that such objects should be \"special\" rather than \"usual\". Then it makes sense to check if x is in one of the special classes and hope that everything is good otherwise, i.e. return True. If it will turn out that there are other special cases, we can add tests for them and document them!",
    "created_at": "2010-04-18T03:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8707#issuecomment-92181",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:4'></a>
I thought about it, but it seems to me that such objects should be "special" rather than "usual". Then it makes sense to check if x is in one of the special classes and hope that everything is good otherwise, i.e. return True. If it will turn out that there are other special cases, we can add tests for them and document them!



---

archive/issue_events_033684.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-04-19T05:18:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8707",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8707#event-33684"
}
```



---

archive/issue_comments_092182.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.4.alpha1\"",
    "created_at": "2010-04-19T05:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8707#issuecomment-92182",
    "user": "https://github.com/jhpalmieri"
}
```

Changing merged from "" to "sage-4.4.alpha1"



---

archive/issue_comments_092183.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-04-19T05:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8707#issuecomment-92183",
    "user": "https://github.com/jhpalmieri"
}
```

Resolution: fixed



---

archive/issue_comments_092184.json:
```json
{
    "body": "<a id='comment:5'></a>\nMerged into 4.4.alpha1.",
    "created_at": "2010-04-19T05:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8707#issuecomment-92184",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
Merged into 4.4.alpha1.
