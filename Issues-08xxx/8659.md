# Issue 8659: another broken square root simplification

archive/issues_008659.json:
```json
{
    "assignees": [
        "https://github.com/burcin"
    ],
    "body": "Reported by Alex Raichev on sage-support:\n\n```\nOn Wed, 7 Apr 2010 16:56:01 -0700 (PDT)\nAlex Raichev <tortoise.said@gmail.com> wrote:\n\n> What the?\n> \n> ----------------------------------------------------------------------\n> | Sage Version 4.3.5, Release Date: 2010-03-28                       |\n> | Type notebook() for the GUI, and license() for information.        |\n> ----------------------------------------------------------------------\n> sage: a= matrix([[2,2,I],[2,2,-I],[I,-I,0]]).determinant(); a\n> 8\n> sage: a^(-1/2)\n> ---------------------------------------------------------------------------\n> TypeError                                 Traceback (most recent call\n> last)\n> \n> /Users/arai021/Dropbox/sage_work/<ipython console> in <module>()\n> \n> /Applications/sage/local/lib/python2.6/site-packages/sage/symbolic/\n> expression.so in sage.symbolic.expression.Expression.__pow__ (sage/\n> symbolic/expression.cpp:11892)()\n> \n> /Applications/sage/local/lib/python2.6/site-packages/sage/rings/\n> number_field/number_field_element.so in\n> sage.rings.number_field.number_field_element.NumberFieldElement.__pow__\n> (sage/rings/number_field/number_field_element.cpp:10038)()\n> \n> /Applications/sage/local/lib/python2.6/site-packages/sage/symbolic/\n> power_helper.so in sage.symbolic.power_helper.try_symbolic_power\n> (sage/ symbolic/power_helper.cpp:633)()\n> \n> /Applications/sage/local/lib/python2.6/site-packages/sage/symbolic/\n> power_helper.so in sage.symbolic.power_helper.try_symbolic_power\n> (sage/ symbolic/power_helper.cpp:509)()\n> \n> /Applications/sage/local/lib/python2.6/site-packages/sage/symbolic/\n> expression.so in sage.symbolic.expression.Expression.__pow__ (sage/\n> symbolic/expression.cpp:11892)()\n> \n> /Applications/sage/local/lib/python2.6/site-packages/sage/rings/\n> rational.so in sage.rings.rational.Rational.__pow__ (sage/rings/\n> rational.c:15609)()\n> \n> /Applications/sage/local/lib/python2.6/site-packages/sage/structure/\n> element.so in sage.structure.element.RingElement.__mul__ (sage/\n> structure/element.c:11337)()\n> \n> /Applications/sage/local/lib/python2.6/site-packages/sage/structure/\n> coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op\n> (sage/structure/coerce.c:6994)()\n> \n> TypeError: unsupported operand parent(s) for '*': 'Rational Field' and\n> '<type 'NoneType'>'\n\n```\n\nHere is the thread:\n\nhttp://groups.google.com/group/sage-support/t/3e8ae9f6b7c44e7c\n\nThis looks similar to #8540, though it is a long standing issue, not caused by that ticket:\n\n```\n----------------------------------------------------------------------\n| Sage Version 4.3.3.alpha0, Release Date: 2010-02-11                |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\nsage: a= matrix([[2,2,I],[2,2,-I],[I,-I,0]]).determinant(); a\n8\nsage: a^(-1/2)\n<boom>\n```\n\nApply [attachment: trac_8659-hold_powers.take4.patch](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.take4.patch.gz)\n\nDepends on #12511\n\nCC:  @kcrisman\n\nKeywords: **sd40.5**\n\nReviewer: **Karl-Dieter Crisman, Mike Hansen**\n\nAuthor: **Burcin Erocal**\n\nMerged: **sage-5.1.beta5**\n\nComponent: **symbolics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/8659_\n\n",
    "closed_at": "2012-06-18T10:21:48Z",
    "created_at": "2010-04-08T10:10:49Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "another broken square root simplification",
    "type": "issue",
    "updated_at": "2012-06-18T10:21:48Z",
    "url": "https://github.com/sagemath/sage/issues/8659",
    "user": "https://github.com/burcin"
}
```
Reported by Alex Raichev on sage-support:

```
On Wed, 7 Apr 2010 16:56:01 -0700 (PDT)
Alex Raichev <tortoise.said@gmail.com> wrote:

> What the?
> 
> ----------------------------------------------------------------------
> | Sage Version 4.3.5, Release Date: 2010-03-28                       |
> | Type notebook() for the GUI, and license() for information.        |
> ----------------------------------------------------------------------
> sage: a= matrix([[2,2,I],[2,2,-I],[I,-I,0]]).determinant(); a
> 8
> sage: a^(-1/2)
> ---------------------------------------------------------------------------
> TypeError                                 Traceback (most recent call
> last)
> 
> /Users/arai021/Dropbox/sage_work/<ipython console> in <module>()
> 
> /Applications/sage/local/lib/python2.6/site-packages/sage/symbolic/
> expression.so in sage.symbolic.expression.Expression.__pow__ (sage/
> symbolic/expression.cpp:11892)()
> 
> /Applications/sage/local/lib/python2.6/site-packages/sage/rings/
> number_field/number_field_element.so in
> sage.rings.number_field.number_field_element.NumberFieldElement.__pow__
> (sage/rings/number_field/number_field_element.cpp:10038)()
> 
> /Applications/sage/local/lib/python2.6/site-packages/sage/symbolic/
> power_helper.so in sage.symbolic.power_helper.try_symbolic_power
> (sage/ symbolic/power_helper.cpp:633)()
> 
> /Applications/sage/local/lib/python2.6/site-packages/sage/symbolic/
> power_helper.so in sage.symbolic.power_helper.try_symbolic_power
> (sage/ symbolic/power_helper.cpp:509)()
> 
> /Applications/sage/local/lib/python2.6/site-packages/sage/symbolic/
> expression.so in sage.symbolic.expression.Expression.__pow__ (sage/
> symbolic/expression.cpp:11892)()
> 
> /Applications/sage/local/lib/python2.6/site-packages/sage/rings/
> rational.so in sage.rings.rational.Rational.__pow__ (sage/rings/
> rational.c:15609)()
> 
> /Applications/sage/local/lib/python2.6/site-packages/sage/structure/
> element.so in sage.structure.element.RingElement.__mul__ (sage/
> structure/element.c:11337)()
> 
> /Applications/sage/local/lib/python2.6/site-packages/sage/structure/
> coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op
> (sage/structure/coerce.c:6994)()
> 
> TypeError: unsupported operand parent(s) for '*': 'Rational Field' and
> '<type 'NoneType'>'

```

Here is the thread:

http://groups.google.com/group/sage-support/t/3e8ae9f6b7c44e7c

This looks similar to #8540, though it is a long standing issue, not caused by that ticket:

```
----------------------------------------------------------------------
| Sage Version 4.3.3.alpha0, Release Date: 2010-02-11                |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
sage: a= matrix([[2,2,I],[2,2,-I],[I,-I,0]]).determinant(); a
8
sage: a^(-1/2)
<boom>
```

Apply [attachment: trac_8659-hold_powers.take4.patch](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.take4.patch.gz)

Depends on #12511

CC:  @kcrisman

Keywords: **sd40.5**

Reviewer: **Karl-Dieter Crisman, Mike Hansen**

Author: **Burcin Erocal**

Merged: **sage-5.1.beta5**

Component: **symbolics**

_Issue created by migration from https://trac.sagemath.org/ticket/8659_





---

archive/issue_events_108108.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-04-08T10:10:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "milestone_number": null,
    "milestone_title": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108108"
}
```



---

archive/issue_events_108109.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-04-08T10:10:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108109"
}
```



---

archive/issue_events_108110.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-04-08T10:10:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108110"
}
```



---

archive/issue_events_108111.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-04-08T10:10:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108111"
}
```



---

archive/issue_events_108112.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-04-08T10:10:49Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "subject": "https://github.com/burcin",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108112"
}
```



---

archive/issue_comments_069462.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThis problem might not be in symbolics, but in number fields:\n\n```\n----------------------------------------------------------------------\n| Sage Version 4.3.4, Release Date: 2010-03-19                       |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nsage: a= matrix([[2,2,I],[2,2,-I],[I,-I,0]]).determinant();\nsage: a\n8\nsage: type(a.pyobject())\n<type 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'>\nsage: b=a.pyobject()\nsage: b\n8\nsage: parent(b)\nNumber Field in I with defining polynomial x^2 + 1\nsage: sqrt(b)\n2*sqrt(2)\nsage: 1/sqrt(b)\n1/4*sqrt(2)\nsage: b^(-1/2)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/home/jason/<ipython console> in <module>()\n\n/home/jason/sage/local/lib/python2.6/site-packages/sage/rings/number_field/number_field_element.so in sage.rings.number_field.number_field_element.NumberFieldElement.__pow__ (sage/rings/number_field/number_field_element.cpp:10038)()\n\n/home/jason/sage/local/lib/python2.6/site-packages/sage/symbolic/power_helper.so in sage.symbolic.power_helper.try_symbolic_power (sage/symbolic/power_helper.cpp:633)()\n\n/home/jason/sage/local/lib/python2.6/site-packages/sage/symbolic/power_helper.so in sage.symbolic.power_helper.try_symbolic_power (sage/symbolic/power_helper.cpp:509)()\n\n/home/jason/sage/local/lib/python2.6/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression.__pow__ (sage/symbolic/expression.cpp:11892)()\n\n/home/jason/sage/local/lib/python2.6/site-packages/sage/rings/rational.so in sage.rings.rational.Rational.__pow__ (sage/rings/rational.c:15609)()\n\n/home/jason/sage/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.RingElement.__mul__ (sage/structure/element.c:11337)()\n\n/home/jason/sage/local/lib/python2.6/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6994)()\n\nTypeError: unsupported operand parent(s) for '*': 'Rational Field' and '<type 'NoneType'>'\n```",
    "created_at": "2010-04-08T14:46:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69462",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:1" align="right">comment:1</div>

This problem might not be in symbolics, but in number fields:

```
----------------------------------------------------------------------
| Sage Version 4.3.4, Release Date: 2010-03-19                       |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
sage: a= matrix([[2,2,I],[2,2,-I],[I,-I,0]]).determinant();
sage: a
8
sage: type(a.pyobject())
<type 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'>
sage: b=a.pyobject()
sage: b
8
sage: parent(b)
Number Field in I with defining polynomial x^2 + 1
sage: sqrt(b)
2*sqrt(2)
sage: 1/sqrt(b)
1/4*sqrt(2)
sage: b^(-1/2)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/jason/<ipython console> in <module>()

/home/jason/sage/local/lib/python2.6/site-packages/sage/rings/number_field/number_field_element.so in sage.rings.number_field.number_field_element.NumberFieldElement.__pow__ (sage/rings/number_field/number_field_element.cpp:10038)()

/home/jason/sage/local/lib/python2.6/site-packages/sage/symbolic/power_helper.so in sage.symbolic.power_helper.try_symbolic_power (sage/symbolic/power_helper.cpp:633)()

/home/jason/sage/local/lib/python2.6/site-packages/sage/symbolic/power_helper.so in sage.symbolic.power_helper.try_symbolic_power (sage/symbolic/power_helper.cpp:509)()

/home/jason/sage/local/lib/python2.6/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression.__pow__ (sage/symbolic/expression.cpp:11892)()

/home/jason/sage/local/lib/python2.6/site-packages/sage/rings/rational.so in sage.rings.rational.Rational.__pow__ (sage/rings/rational.c:15609)()

/home/jason/sage/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.RingElement.__mul__ (sage/structure/element.c:11337)()

/home/jason/sage/local/lib/python2.6/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6994)()

TypeError: unsupported operand parent(s) for '*': 'Rational Field' and '<type 'NoneType'>'
```



---

archive/issue_comments_069463.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nInterestingly, these all work (starting from the above example in my post):\n\n```\nsage: b^(1/3)\n2\nsage: b^(1/4)\n8^(1/4)\nsage: b^(-1/4)\n1/8*8^(3/4)\n```\n\nSo it seems that b^(1/2) is the only problem?",
    "created_at": "2010-04-08T14:51:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69463",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:2" align="right">comment:2</div>

Interestingly, these all work (starting from the above example in my post):

```
sage: b^(1/3)
2
sage: b^(1/4)
8^(1/4)
sage: b^(-1/4)
1/8*8^(3/4)
```

So it seems that b^(1/2) is the only problem?



---

archive/issue_comments_069464.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nOn the other hand, it seems like the problem is in try_symbolic_power.  When I change that function to:\n\n```\n    global __pynac_pow\n    print \"entering try_symbolic_power: \", obj, p, \"; __pynac_pow is \", __pynac_pow\n    if __pynac_pow:\n        __pynac_pow = False\n        print \"    set __pynac_pow to False and return None\"\n        return None\n    else:\n        try:\n            __pynac_pow = True\n            print \"    Try SR powers: \", ring.SR(obj), ring.SR(p)\n            return ring.SR(obj)**ring.SR(p)\n        finally:\n            print \"        and then set __pynac_pow to False\"\n            __pynac_pow = False\n```\n\nthen I get:\n\n```\nsage: b^(1/2)\nentering try_symbolic_power:  8 1/2 ; __pynac_pow is  False\n    Try SR powers:  8 1/2\nentering try_symbolic_power:  2 1/2 ; __pynac_pow is  True\n    set __pynac_pow to False and return None\n        and then set __pynac_pow to False\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/home/jason/<ipython console> in <module>()\n\n/home/jason/sage/local/lib/python2.6/site-packages/sage/rings/number_field/number_field_element.so in sage.rings.number_field.number_field_element.NumberFieldElement.__pow__ (sage/rings/number_field/number_field_element.cpp:10065)()\n\n/home/jason/sage/local/lib/python2.6/site-packages/sage/symbolic/power_helper.so in sage.symbolic.power_helper.try_symbolic_power (sage/symbolic/power_helper.cpp:755)()\n\n/home/jason/sage/local/lib/python2.6/site-packages/sage/symbolic/power_helper.so in sage.symbolic.power_helper.try_symbolic_power (sage/symbolic/power_helper.cpp:614)()\n\n/home/jason/sage/local/lib/python2.6/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression.__pow__ (sage/symbolic/expression.cpp:11892)()\n\n/home/jason/sage/local/lib/python2.6/site-packages/sage/rings/rational.so in sage.rings.rational.Rational.__pow__ (sage/rings/rational.c:15609)()\n\n/home/jason/sage/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.RingElement.__mul__ (sage/structure/element.c:11337)()\n\n/home/jason/sage/local/lib/python2.6/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6994)()\n\nTypeError: unsupported operand parent(s) for '*': 'Rational Field' and '<type 'NoneType'>'\nsage: b^(1/4)\nentering try_symbolic_power:  8 1/4 ; __pynac_pow is  False\n    Try SR powers:  8 1/4\nentering try_symbolic_power:  8 1/4 ; __pynac_pow is  True\n    set __pynac_pow to False and return None\n        and then set __pynac_pow to False\n8^(1/4)\n\n```",
    "created_at": "2010-04-08T15:27:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69464",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:3" align="right">comment:3</div>

On the other hand, it seems like the problem is in try_symbolic_power.  When I change that function to:

```
    global __pynac_pow
    print "entering try_symbolic_power: ", obj, p, "; __pynac_pow is ", __pynac_pow
    if __pynac_pow:
        __pynac_pow = False
        print "    set __pynac_pow to False and return None"
        return None
    else:
        try:
            __pynac_pow = True
            print "    Try SR powers: ", ring.SR(obj), ring.SR(p)
            return ring.SR(obj)**ring.SR(p)
        finally:
            print "        and then set __pynac_pow to False"
            __pynac_pow = False
```

then I get:

```
sage: b^(1/2)
entering try_symbolic_power:  8 1/2 ; __pynac_pow is  False
    Try SR powers:  8 1/2
entering try_symbolic_power:  2 1/2 ; __pynac_pow is  True
    set __pynac_pow to False and return None
        and then set __pynac_pow to False
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/jason/<ipython console> in <module>()

/home/jason/sage/local/lib/python2.6/site-packages/sage/rings/number_field/number_field_element.so in sage.rings.number_field.number_field_element.NumberFieldElement.__pow__ (sage/rings/number_field/number_field_element.cpp:10065)()

/home/jason/sage/local/lib/python2.6/site-packages/sage/symbolic/power_helper.so in sage.symbolic.power_helper.try_symbolic_power (sage/symbolic/power_helper.cpp:755)()

/home/jason/sage/local/lib/python2.6/site-packages/sage/symbolic/power_helper.so in sage.symbolic.power_helper.try_symbolic_power (sage/symbolic/power_helper.cpp:614)()

/home/jason/sage/local/lib/python2.6/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression.__pow__ (sage/symbolic/expression.cpp:11892)()

/home/jason/sage/local/lib/python2.6/site-packages/sage/rings/rational.so in sage.rings.rational.Rational.__pow__ (sage/rings/rational.c:15609)()

/home/jason/sage/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.RingElement.__mul__ (sage/structure/element.c:11337)()

/home/jason/sage/local/lib/python2.6/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6994)()

TypeError: unsupported operand parent(s) for '*': 'Rational Field' and '<type 'NoneType'>'
sage: b^(1/4)
entering try_symbolic_power:  8 1/4 ; __pynac_pow is  False
    Try SR powers:  8 1/4
entering try_symbolic_power:  8 1/4 ; __pynac_pow is  True
    set __pynac_pow to False and return None
        and then set __pynac_pow to False
8^(1/4)

```



---

archive/issue_comments_069465.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nUnsurprisingly, I get the same error traceback if I do `(b*b)^(1/4)`",
    "created_at": "2010-04-08T16:00:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69465",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:4" align="right">comment:4</div>

Unsurprisingly, I get the same error traceback if I do `(b*b)^(1/4)`



---

archive/issue_comments_069466.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nNow that we have the `hold()` function for symbolic expressions (#9879), we don't need `sage.symbolic.power_helper`. [attachment: trac_8659-hold_powers.patch](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.patch.gz) removes this module, and fixes the problem described.\n\nThis ticket depends on #9879.",
    "created_at": "2010-09-25T23:24:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69466",
    "user": "https://github.com/burcin"
}
```

<div id="comment:5" align="right">comment:5</div>

Now that we have the `hold()` function for symbolic expressions (#9879), we don't need `sage.symbolic.power_helper`. [attachment: trac_8659-hold_powers.patch](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.patch.gz) removes this module, and fixes the problem described.

This ticket depends on #9879.



---

archive/issue_events_108113.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-09-25T23:24:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108113"
}
```



---

archive/issue_comments_069467.json:
```json
{
    "body": "Author: **Burcin Erocal**",
    "created_at": "2010-09-25T23:24:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69467",
    "user": "https://github.com/burcin"
}
```

Author: **Burcin Erocal**



---

archive/issue_comments_069468.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAttachment: **[trac_8659-hold_powers.patch.gz](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.patch.gz)**\n\nAt first I thought I minded this discrepancy, but I think that maybe that's okay, given they really do live in different places.  At the same time, in theory then we should be holding anything that might ever be multivalued.  Like a square root.\n\n```\nsage: 8^(1/2)\n2*sqrt(2)\nsage: I.pyobject().parent()\nNumber Field in I with defining polynomial x^2 + 1\nsage: I.pyobject().parent()(8)^(1/2)\nsqrt(8)\n```\nIn particular, what do we want here?\n\n```\nsage: a= matrix([[2,2,I],[2,2,-I],[I,-I,0]]).determinant();\nsage: b = a.pyobject()\nsage: b^(-1/2); a^(-1/2)\n1/sqrt(8)\n1/8*sqrt(8)\n```",
    "created_at": "2011-04-25T17:02:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69468",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:7" align="right">comment:7</div>

Attachment: **[trac_8659-hold_powers.patch.gz](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.patch.gz)**

At first I thought I minded this discrepancy, but I think that maybe that's okay, given they really do live in different places.  At the same time, in theory then we should be holding anything that might ever be multivalued.  Like a square root.

```
sage: 8^(1/2)
2*sqrt(2)
sage: I.pyobject().parent()
Number Field in I with defining polynomial x^2 + 1
sage: I.pyobject().parent()(8)^(1/2)
sqrt(8)
```
In particular, what do we want here?

```
sage: a= matrix([[2,2,I],[2,2,-I],[I,-I,0]]).determinant();
sage: b = a.pyobject()
sage: b^(-1/2); a^(-1/2)
1/sqrt(8)
1/8*sqrt(8)
```



---

archive/issue_events_108114.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-04-25T17:02:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108114"
}
```



---

archive/issue_events_108115.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-04-25T17:02:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108115"
}
```



---

archive/issue_comments_069469.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAlso, is \n\n```\nsage: (t^2)^(1/4) \n64^(1/4) \n```\nintended to test\n\n```\nreturn SR(nbase).power(nexp*exp, hold=True)\n```\nBut the powers weren't multiplied, because `SR(base)` already is just 64.  \n\nSimilarly, \n\n```\nsage: 8^(-1/5) \n```\ncan't be to test the change in that file, because 8 isn't rational.  \n\nOr am I missing something?   Sorry if I've misinterpreted something; otherwise this is a good fix, it seems.",
    "created_at": "2011-04-25T19:53:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69469",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:8" align="right">comment:8</div>

Also, is 

```
sage: (t^2)^(1/4) 
64^(1/4) 
```
intended to test

```
return SR(nbase).power(nexp*exp, hold=True)
```
But the powers weren't multiplied, because `SR(base)` already is just 64.  

Similarly, 

```
sage: 8^(-1/5) 
```
can't be to test the change in that file, because 8 isn't rational.  

Or am I missing something?   Sorry if I've misinterpreted something; otherwise this is a good fix, it seems.



---

archive/issue_comments_069470.json:
```json
{
    "body": "Attachment: **[trac_8659-hold_powers.take2.patch.gz](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.take2.patch.gz)**",
    "created_at": "2011-05-30T22:28:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69470",
    "user": "https://github.com/burcin"
}
```

Attachment: **[trac_8659-hold_powers.take2.patch.gz](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.take2.patch.gz)**



---

archive/issue_events_108116.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2011-05-30T22:32:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108116"
}
```



---

archive/issue_events_108117.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2011-05-30T22:32:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108117"
}
```



---

archive/issue_comments_069471.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n[attachment: trac_8659-hold_powers.take2.patch](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.take2.patch.gz) should address the issues in [comment:7](#comment%3A7) at the cost of magically changing the type of the coefficients to rational.\n\nThe test\n\n```\nsage: 8^(-1/5)\n```\ndoes test the `__pow__` method of rationals, since the `__pow__` method of `Integer` casts the base to a rational and calls pow again.",
    "created_at": "2011-05-30T22:32:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69471",
    "user": "https://github.com/burcin"
}
```

<div id="comment:9" align="right">comment:9</div>

[attachment: trac_8659-hold_powers.take2.patch](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.take2.patch.gz) should address the issues in [comment:7](#comment%3A7) at the cost of magically changing the type of the coefficients to rational.

The test

```
sage: 8^(-1/5)
```
does test the `__pow__` method of rationals, since the `__pow__` method of `Integer` casts the base to a rational and calls pow again.



---

archive/issue_comments_069472.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -78,3 +78,5 @@\n sage: a^(-1/2)\n <boom>\n ```\n+\n+Apply trac_8659-hold_powers.take2.patch\n``````\n",
    "created_at": "2011-05-30T22:32:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69472",
    "user": "https://github.com/burcin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -78,3 +78,5 @@
 sage: a^(-1/2)
 <boom>
 ```
+
+Apply trac_8659-hold_powers.take2.patch
``````




---

archive/issue_events_108118.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-06-16T04:37:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108118"
}
```



---

archive/issue_events_108119.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-06-16T04:37:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108119"
}
```



---

archive/issue_comments_069473.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -79,4 +79,4 @@\n <boom>\n ```\n \n-Apply trac_8659-hold_powers.take2.patch\n+Apply [attachment: trac_8659-hold_powers.take3.patch](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.take3.patch.gz)\n``````\n",
    "created_at": "2012-02-15T15:46:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69473",
    "user": "https://github.com/burcin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -79,4 +79,4 @@
 <boom>
 ```
 
-Apply trac_8659-hold_powers.take2.patch
+Apply [attachment: trac_8659-hold_powers.take3.patch](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.take3.patch.gz)
``````




---

archive/issue_comments_069474.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI uploaded a new patch which should finally fix this. Please review.",
    "created_at": "2012-02-15T15:46:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69474",
    "user": "https://github.com/burcin"
}
```

<div id="comment:11" align="right">comment:11</div>

I uploaded a new patch which should finally fix this. Please review.



---

archive/issue_events_108120.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2012-02-15T15:46:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108120"
}
```



---

archive/issue_events_108121.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2012-02-15T15:46:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108121"
}
```



---

archive/issue_comments_069475.json:
```json
{
    "body": "Dependencies: **#12511**",
    "created_at": "2012-02-15T15:46:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69475",
    "user": "https://github.com/burcin"
}
```

Dependencies: **#12511**



---

archive/issue_events_108122.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-02-15T15:59:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108122"
}
```



---

archive/issue_events_108123.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-02-15T15:59:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108123"
}
```



---

archive/issue_comments_069476.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\n[[[\ninfite loops\n}}}",
    "created_at": "2012-02-15T15:59:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69476",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:12" align="right">comment:12</div>

[[[
infite loops
}}}



---

archive/issue_comments_069477.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nHmm, that didn't format right.  I meant to say, there are two occurrences of \n\n```\ninfite loops\n```\n\nI think it would be helpful to have a doctest or two for each branch of the number field code.  Some are no doubt already in there, but all?  For instance, I would have thought that `(t<sup>2)</sup>(1/4)` is testing `return nbase.power(pexp * exp, hold=True) `, but it doesn't give `8^(1/2)` like I would have thought from that (so it must be from the `if not SR` branch); so it would be good to have one for that branch.\n\nAlso, can you think of a place where putting the rational power in the denominator could cause something to break?    Is that standard practice in this kind of computer algebra?  For instance, Maxima does not do this.\n\n```\n(%i3) 2^(-1/2);\n(%o3) 1/sqrt(2)\n```\n\nSorry if these are dumb questions.",
    "created_at": "2012-02-15T16:14:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69477",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:13" align="right">comment:13</div>

Hmm, that didn't format right.  I meant to say, there are two occurrences of 

```
infite loops
```

I think it would be helpful to have a doctest or two for each branch of the number field code.  Some are no doubt already in there, but all?  For instance, I would have thought that `(t<sup>2)</sup>(1/4)` is testing `return nbase.power(pexp * exp, hold=True) `, but it doesn't give `8^(1/2)` like I would have thought from that (so it must be from the `if not SR` branch); so it would be good to have one for that branch.

Also, can you think of a place where putting the rational power in the denominator could cause something to break?    Is that standard practice in this kind of computer algebra?  For instance, Maxima does not do this.

```
(%i3) 2^(-1/2);
(%o3) 1/sqrt(2)
```

Sorry if these are dumb questions.



---

archive/issue_comments_069478.json:
```json
{
    "body": "Attachment: **[trac_8659-hold_powers.take3.patch.gz](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.take3.patch.gz)**",
    "created_at": "2012-02-15T16:59:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69478",
    "user": "https://github.com/burcin"
}
```

Attachment: **[trac_8659-hold_powers.take3.patch.gz](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.take3.patch.gz)**



---

archive/issue_events_108124.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2012-02-15T17:05:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108124"
}
```



---

archive/issue_events_108125.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2012-02-15T17:05:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108125"
}
```



---

archive/issue_comments_069479.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@kcrisman](#comment%3A13):\n> Hmm, that didn't format right.  I meant to say, there are two occurrences of \n> \n> ```\n> infite loops\n> ```\n\nI updated the patch to fix the typos.\n\n> I think it would be helpful to have a doctest or two for each branch of the number field code.  Some are no doubt already in there, but all?  For instance, I would have thought that `(t<sup>2)</sup>(1/4)` is testing `return nbase.power(pexp * exp, hold=True) `, but it doesn't give `8^(1/2)` like I would have thought from that (so it must be from the `if not SR` branch); so it would be good to have one for that branch.\n\nThat branch is tested by these:\n\n```\n            sage: sqrt2^(1/5)\n            2^(1/10)\n            sage: sqrt2^sqrt2\n            2^(1/2*sqrt(2))\n```\n\n> Also, can you think of a place where putting the rational power in the denominator could cause something to break?    Is that standard practice in this kind of computer algebra?  For instance, Maxima does not do this.\n> \n> ```\n> (%i3) 2^(-1/2);\n> (%o3) 1/sqrt(2)\n> ```\n\nAFAICT, GiNaC assumes this normal form.\n\n\nOn another note... IMHO, a simple typo in comments within source code, or not documenting which doctest corresponds to which branch in the code is justification to switch a ticket to `needs_work`. You might not be satisfied with the work, but it is possible that someone else will give a positive review, especially since this is a `critical` ticket.",
    "created_at": "2012-02-15T17:05:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69479",
    "user": "https://github.com/burcin"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@kcrisman](#comment%3A13):
> Hmm, that didn't format right.  I meant to say, there are two occurrences of 
> 
> ```
> infite loops
> ```

I updated the patch to fix the typos.

> I think it would be helpful to have a doctest or two for each branch of the number field code.  Some are no doubt already in there, but all?  For instance, I would have thought that `(t<sup>2)</sup>(1/4)` is testing `return nbase.power(pexp * exp, hold=True) `, but it doesn't give `8^(1/2)` like I would have thought from that (so it must be from the `if not SR` branch); so it would be good to have one for that branch.

That branch is tested by these:

```
            sage: sqrt2^(1/5)
            2^(1/10)
            sage: sqrt2^sqrt2
            2^(1/2*sqrt(2))
```

> Also, can you think of a place where putting the rational power in the denominator could cause something to break?    Is that standard practice in this kind of computer algebra?  For instance, Maxima does not do this.
> 
> ```
> (%i3) 2^(-1/2);
> (%o3) 1/sqrt(2)
> ```

AFAICT, GiNaC assumes this normal form.


On another note... IMHO, a simple typo in comments within source code, or not documenting which doctest corresponds to which branch in the code is justification to switch a ticket to `needs_work`. You might not be satisfied with the work, but it is possible that someone else will give a positive review, especially since this is a `critical` ticket.



---

archive/issue_comments_069480.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\n> On another note... IMHO, a simple typo in comments within source code, or not documenting which doctest corresponds to which branch in the code is justification to switch a ticket to `needs_work`. You might not be satisfied with the work, but it is \n\nFair enough!  Though I do think typos are 'needs work', often I can update them on a refresh.  The doctest thing was just wanting to check that we *did* check all branches.  Maybe 'needs info' is better?  The point is that I want to make sure the comment gets seen; a lot of times I see questions on 'needs review' that are then never actually addressed.  I don't really care what the status itself is.\n\n> possible that someone else will give a positive review, especially since this is a `critical` ticket.\n\nWell, it's apparently been `critical` for nearly two years, so perhaps that is less convincing of an argument on this ticket than others.  But point taken in general!",
    "created_at": "2012-02-15T17:52:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69480",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:15" align="right">comment:15</div>

> On another note... IMHO, a simple typo in comments within source code, or not documenting which doctest corresponds to which branch in the code is justification to switch a ticket to `needs_work`. You might not be satisfied with the work, but it is 

Fair enough!  Though I do think typos are 'needs work', often I can update them on a refresh.  The doctest thing was just wanting to check that we *did* check all branches.  Maybe 'needs info' is better?  The point is that I want to make sure the comment gets seen; a lot of times I see questions on 'needs review' that are then never actually addressed.  I don't really care what the status itself is.

> possible that someone else will give a positive review, especially since this is a `critical` ticket.

Well, it's apparently been `critical` for nearly two years, so perhaps that is less convincing of an argument on this ticket than others.  But point taken in general!



---

archive/issue_comments_069481.json:
```json
{
    "body": "Reviewer: **Karl-Dieter Crisman**",
    "created_at": "2012-02-15T20:22:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69481",
    "user": "https://github.com/kcrisman"
}
```

Reviewer: **Karl-Dieter Crisman**



---

archive/issue_comments_069482.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nOkay, I now get all the branches, and it makes sense.  Thanks for hanging in there with me!  Also, good catch and test on the powers less than -1.\n\nI'm not putting 'needs work' :) but also not yet positive review.   In [comment:7](#comment%3A7), we see the equivalent of this inconsistency: \n\n```\nsage: a= matrix([[2,2,I],[2,2,-I],[I,-I,0]]).determinant();\nsage: a; type(a)\n8\n<type 'sage.symbolic.expression.Expression'>\nsage: b = SR(8)\nsage: type(b)\n<type 'sage.symbolic.expression.Expression'>\nsage: a.operands(); a.operator()\n[]\nsage: b.operands(); b.operator()\n[]\nsage: b^(-1/2)\n1/4*sqrt(2)\nsage: a^(-1/2)\n1/8*sqrt(8)\nsage: a^(1/2)\nsqrt(8)\nsage: b^(1/2)\n2*sqrt(2)\n```\n\nI thought that maybe this was because (for reasons unclear to me) we had entered \n\n```\n\n        if not PY_TYPE_CHECK(self, Rational):\n```\nbut \n\n```\nsage: isinstance(b,Rational)\nFalse\nsage: isinstance(a,Rational)\nFalse\n```\nso I must be missing something obvious.  Anyway, I can't see why these should return different things, and we still have the switch to rational that should take care of this:\n\n```\n                res = QQ(base)**exp \n```\n\n\n\nAlso, the documentation in rational.pyx still says\n\n```\n\n    def __pow__(self, n, dummy):\n        \"\"\"\n        Raise self to the integer power n.\n        \n```\nthough I think this code has been used for non-integer powers for quite a while.\n\nBut perhaps another reviewer will see what is going on in these cases, my apologies if I'm wasting time.",
    "created_at": "2012-02-15T20:22:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69482",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:16" align="right">comment:16</div>

Okay, I now get all the branches, and it makes sense.  Thanks for hanging in there with me!  Also, good catch and test on the powers less than -1.

I'm not putting 'needs work' :) but also not yet positive review.   In [comment:7](#comment%3A7), we see the equivalent of this inconsistency: 

```
sage: a= matrix([[2,2,I],[2,2,-I],[I,-I,0]]).determinant();
sage: a; type(a)
8
<type 'sage.symbolic.expression.Expression'>
sage: b = SR(8)
sage: type(b)
<type 'sage.symbolic.expression.Expression'>
sage: a.operands(); a.operator()
[]
sage: b.operands(); b.operator()
[]
sage: b^(-1/2)
1/4*sqrt(2)
sage: a^(-1/2)
1/8*sqrt(8)
sage: a^(1/2)
sqrt(8)
sage: b^(1/2)
2*sqrt(2)
```

I thought that maybe this was because (for reasons unclear to me) we had entered 

```

        if not PY_TYPE_CHECK(self, Rational):
```
but 

```
sage: isinstance(b,Rational)
False
sage: isinstance(a,Rational)
False
```
so I must be missing something obvious.  Anyway, I can't see why these should return different things, and we still have the switch to rational that should take care of this:

```
                res = QQ(base)**exp 
```



Also, the documentation in rational.pyx still says

```

    def __pow__(self, n, dummy):
        """
        Raise self to the integer power n.
        
```
though I think this code has been used for non-integer powers for quite a while.

But perhaps another reviewer will see what is going on in these cases, my apologies if I'm wasting time.



---

archive/issue_comments_069483.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nApply trac_8659-hold_powers.take3.patch\n\n(for the patchbot, which is trying to apply all three patches simultaneously)",
    "created_at": "2012-03-10T10:53:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69483",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:17" align="right">comment:17</div>

Apply trac_8659-hold_powers.take3.patch

(for the patchbot, which is trying to apply all three patches simultaneously)



---

archive/issue_events_108126.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2012-03-11T14:32:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108126"
}
```



---

archive/issue_events_108127.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2012-03-11T14:32:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108127"
}
```



---

archive/issue_comments_069484.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nPatch does not apply (either to 5.0.beta7, or to 4.8 with #12511 installed).",
    "created_at": "2012-03-11T14:32:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69484",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:18" align="right">comment:18</div>

Patch does not apply (either to 5.0.beta7, or to 4.8 with #12511 installed).



---

archive/issue_comments_069485.json:
```json
{
    "body": "Changed reviewer from **Karl-Dieter Crisman** to **Karl-Dieter Crisman, PatchBot**",
    "created_at": "2012-03-11T14:32:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69485",
    "user": "https://github.com/loefflerd"
}
```

Changed reviewer from **Karl-Dieter Crisman** to **Karl-Dieter Crisman, PatchBot**



---

archive/issue_comments_069486.json:
```json
{
    "body": "Attachment: **[trac_8659-hold_powers.take4.patch.gz](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.take4.patch.gz)**",
    "created_at": "2012-05-24T09:49:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69486",
    "user": "https://github.com/burcin"
}
```

Attachment: **[trac_8659-hold_powers.take4.patch.gz](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.take4.patch.gz)**



---

archive/issue_comments_069487.json:
```json
{
    "body": "Changed reviewer from **Karl-Dieter Crisman, PatchBot** to **Karl-Dieter Crisman**",
    "created_at": "2012-05-24T09:50:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69487",
    "user": "https://github.com/burcin"
}
```

Changed reviewer from **Karl-Dieter Crisman, PatchBot** to **Karl-Dieter Crisman**



---

archive/issue_comments_069488.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI rebased the patch to 5.0. Apply only [attachment: trac_8659-hold_powers.take4.patch.](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.take4.patch..gz)",
    "created_at": "2012-05-24T09:50:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69488",
    "user": "https://github.com/burcin"
}
```

<div id="comment:19" align="right">comment:19</div>

I rebased the patch to 5.0. Apply only [attachment: trac_8659-hold_powers.take4.patch.](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.take4.patch..gz)



---

archive/issue_events_108128.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2012-05-24T09:50:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108128"
}
```



---

archive/issue_events_108129.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2012-05-24T09:50:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108129"
}
```



---

archive/issue_comments_069489.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -79,4 +79,4 @@\n <boom>\n ```\n \n-Apply [attachment: trac_8659-hold_powers.take3.patch](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.take3.patch.gz)\n+Apply [attachment: trac_8659-hold_powers.take4.patch](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.take4.patch.gz)\n``````\n",
    "created_at": "2012-05-28T20:53:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69489",
    "user": "https://github.com/mwhansen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -79,4 +79,4 @@
 <boom>
 ```
 
-Apply [attachment: trac_8659-hold_powers.take3.patch](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.take3.patch.gz)
+Apply [attachment: trac_8659-hold_powers.take4.patch](https://github.com/sagemath/sage/files/ticket8659/trac_8659-hold_powers.take4.patch.gz)
``````




---

archive/issue_comments_069490.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nFor the patchbot, apply trac_8659-hold_powers.take4.patch",
    "created_at": "2012-05-28T20:53:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69490",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:20" align="right">comment:20</div>

For the patchbot, apply trac_8659-hold_powers.take4.patch



---

archive/issue_events_108130.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2012-05-28T21:09:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108130"
}
```



---

archive/issue_events_108131.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2012-05-28T21:09:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108131"
}
```



---

archive/issue_comments_069491.json:
```json
{
    "body": "Changed keywords from none to **sd40.5**",
    "created_at": "2012-05-28T21:09:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69491",
    "user": "https://github.com/mwhansen"
}
```

Changed keywords from none to **sd40.5**



---

archive/issue_comments_069492.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nLooks good to me.",
    "created_at": "2012-05-28T21:09:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69492",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:21" align="right">comment:21</div>

Looks good to me.



---

archive/issue_comments_069493.json:
```json
{
    "body": "Changed reviewer from **Karl-Dieter Crisman** to **Karl-Dieter Crisman, Mike Hansen**",
    "created_at": "2012-05-28T21:09:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69493",
    "user": "https://github.com/mwhansen"
}
```

Changed reviewer from **Karl-Dieter Crisman** to **Karl-Dieter Crisman, Mike Hansen**



---

archive/issue_events_108132.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-18T10:21:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108132"
}
```



---

archive/issue_events_108133.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-18T10:21:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8659#event-108133"
}
```



---

archive/issue_comments_069494.json:
```json
{
    "body": "Merged: **sage-5.1.beta5**",
    "created_at": "2012-06-18T10:21:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/8659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8659#issuecomment-69494",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.1.beta5**
