# Issue 8056: symbolic expressions involving rational functions with numerator 1 cannot be converted to fast callable

archive/issues_008056.json:
```json
{
    "body": "From the sage-devel list:\n\nhttp://groups.google.com/group/sage-devel/t/575627f654d21dd9\n\n```\nsage: t = 1/pi/x\nsage: from sage.ext.fast_callable import ExpressionTreeBuilder\nsage: etb = ExpressionTreeBuilder(vars=[x])\nsage: t._fast_callable_(etb)\n<boom>\n```\n\n\n\n**Assignee:** @burcin\n\n**CC:**  @haraldschilly @kcrisman\n\n**Author:** Burcin Erocal\n\n**Reviewer:** Thomas Hupfer\n\n**Merged:** sage-4.3.3.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/8056\n\n",
    "closed_at": "2010-02-11T15:03:18Z",
    "created_at": "2010-01-25T17:17:02Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3.3",
    "title": "symbolic expressions involving rational functions with numerator 1 cannot be converted to fast callable",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8056",
    "user": "https://github.com/burcin"
}
```
From the sage-devel list:

http://groups.google.com/group/sage-devel/t/575627f654d21dd9

```
sage: t = 1/pi/x
sage: from sage.ext.fast_callable import ExpressionTreeBuilder
sage: etb = ExpressionTreeBuilder(vars=[x])
sage: t._fast_callable_(etb)
<boom>
```



**Assignee:** @burcin

**CC:**  @haraldschilly @kcrisman

**Author:** Burcin Erocal

**Reviewer:** Thomas Hupfer

**Merged:** sage-4.3.3.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/8056





---

archive/attachments_009904.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_8056-fast_callable.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8056/trac_8056-fast_callable.patch",
    "created_at": "2010-01-25T19:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8056",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/burcin"
}
```



---

archive/issue_comments_081505.json:
```json
{
    "body": "",
    "created_at": "2010-01-25T19:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8056#issuecomment-81505",
    "user": "https://github.com/burcin"
}
```





---

archive/issue_comments_081506.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2010-01-25T19:10:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8056#issuecomment-81506",
    "user": "https://github.com/burcin"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_081507.json:
```json
{
    "body": "<a id='comment:2'></a>\nI asked the reporter of the bug, and he found yet another problem. I think it's still related:\n\nFor me the patch fixes the problem only partially.\n\nthings like\n\n`var('X'); f(x)=1/pi/x; fast_callable(f)(x)`\n\ndo now work as expected, but\n\n`var('X');  f(x)=1/pi/x; plot(f,2,3)`\n\nstill fails -- now with a different error:\n\n```\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n\n/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-\nLinux/<ipython console> in <module>()\n\n/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-\nLinux/local/lib/python2.6/site-packages/sage/plot/misc.pyc in wrapper(*args,\n**kwds)\n   241                     kwds[new_name] = kwds[old_name]\n   242                     del kwds[old_name]\n--> 243             return func(*args, **kwds)\n   244\n   245         from sage.misc.sageinspect import sage_getsource\n\n/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-\nLinux/local/lib/python2.6/site-packages/sage/plot/misc.pyc in wrapper(*args,\n**kwds)\n   136                 options['__original_opts'] = kwds\n   137             options.update(kwds)\n--> 138             return func(*args, **options)\n   139\n   140\n\n/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-\nLinux/local/lib/python2.6/site-packages/sage/plot/plot.pyc in plot(funcs,\n*args, **kwds)\n  2463\n  2464     if hasattr(funcs, 'plot'):\n-> 2465         G = funcs.plot(*args, **original_opts)\n  2466     # if we are using the generic plotting method\n  2467     else:\n\n/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-\nLinux/local/lib/python2.6/site-packages/sage/symbolic/expression.so in\nsage.symbolic.expression.Expression.plot (sage/symbolic/expression.cpp:25582)\n()\n\n/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-\nLinux/local/lib/python2.6/site-packages/sage/symbolic/expression.so in\nsage.symbolic.expression.Expression._plot_fast_callable\n(sage/symbolic/expression.cpp:26014)()\n\n/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-\nLinux/local/lib/python2.6/site-packages/sage/symbolic/expression.so in\nsage.symbolic.expression.Expression._fast_float_\n(sage/symbolic/expression.cpp:25025)()\n\n/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-\nLinux/local/lib/python2.6/site-\npackages/sage/symbolic/expression_conversions.py in fast_float(ex, *vars)\n  1199         1.4142135623730951\n  1200     \"\"\"\n-> 1201     return FastFloatConverter(ex, *vars)()\n  1202\n  1203 #################\n\n/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-\nLinux/local/lib/python2.6/site-\npackages/sage/symbolic/expression_conversions.py in __call__(self, ex)\n   211             if getattr(self, 'use_fake_div', False) and operator is\n_operator.mul:\n   212                 div = self.get_fake_div(ex)\n--> 213                 return self.arithmetic(div, div.operator())\n   214             return self.arithmetic(ex, operator)\n   215         elif operator in relation_operators:\n\n/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-\nLinux/local/lib/python2.6/site-\npackages/sage/symbolic/expression_conversions.py in arithmetic(self, ex,\noperator)\n  1150             from sage.functions.all import sqrt\n  1151             return sqrt(self(operands[0]))\n-> 1152         fops = map(self, operands)\n  1153         return reduce(operator, fops)\n  1154\n\n/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-\nLinux/local/lib/python2.6/site-\npackages/sage/symbolic/expression_conversions.py in __call__(self, ex)\n   198\n   199         try:\n--> 200             obj = ex.pyobject()\n   201             return self.pyobject(ex, obj)\n   202         except TypeError, err:\n\nAttributeError: 'sage.rings.integer.Integer' object has no attribute\n'pyobject'\n```",
    "created_at": "2010-01-27T23:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8056#issuecomment-81507",
    "user": "https://github.com/haraldschilly"
}
```

<a id='comment:2'></a>
I asked the reporter of the bug, and he found yet another problem. I think it's still related:

For me the patch fixes the problem only partially.

things like

`var('X'); f(x)=1/pi/x; fast_callable(f)(x)`

do now work as expected, but

`var('X');  f(x)=1/pi/x; plot(f,2,3)`

still fails -- now with a different error:

```
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-
Linux/<ipython console> in <module>()

/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-
Linux/local/lib/python2.6/site-packages/sage/plot/misc.pyc in wrapper(*args,
**kwds)
   241                     kwds[new_name] = kwds[old_name]
   242                     del kwds[old_name]
--> 243             return func(*args, **kwds)
   244
   245         from sage.misc.sageinspect import sage_getsource

/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-
Linux/local/lib/python2.6/site-packages/sage/plot/misc.pyc in wrapper(*args,
**kwds)
   136                 options['__original_opts'] = kwds
   137             options.update(kwds)
--> 138             return func(*args, **options)
   139
   140

/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-
Linux/local/lib/python2.6/site-packages/sage/plot/plot.pyc in plot(funcs,
*args, **kwds)
  2463
  2464     if hasattr(funcs, 'plot'):
-> 2465         G = funcs.plot(*args, **original_opts)
  2466     # if we are using the generic plotting method
  2467     else:

/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-
Linux/local/lib/python2.6/site-packages/sage/symbolic/expression.so in
sage.symbolic.expression.Expression.plot (sage/symbolic/expression.cpp:25582)
()

/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-
Linux/local/lib/python2.6/site-packages/sage/symbolic/expression.so in
sage.symbolic.expression.Expression._plot_fast_callable
(sage/symbolic/expression.cpp:26014)()

/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-
Linux/local/lib/python2.6/site-packages/sage/symbolic/expression.so in
sage.symbolic.expression.Expression._fast_float_
(sage/symbolic/expression.cpp:25025)()

/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-
Linux/local/lib/python2.6/site-
packages/sage/symbolic/expression_conversions.py in fast_float(ex, *vars)
  1199         1.4142135623730951
  1200     """
-> 1201     return FastFloatConverter(ex, *vars)()
  1202
  1203 #################

/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-
Linux/local/lib/python2.6/site-
packages/sage/symbolic/expression_conversions.py in __call__(self, ex)
   211             if getattr(self, 'use_fake_div', False) and operator is
_operator.mul:
   212                 div = self.get_fake_div(ex)
--> 213                 return self.arithmetic(div, div.operator())
   214             return self.arithmetic(ex, operator)
   215         elif operator in relation_operators:

/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-
Linux/local/lib/python2.6/site-
packages/sage/symbolic/expression_conversions.py in arithmetic(self, ex,
operator)
  1150             from sage.functions.all import sqrt
  1151             return sqrt(self(operands[0]))
-> 1152         fops = map(self, operands)
  1153         return reduce(operator, fops)
  1154

/usr/local/sage-mathe/sage-4.3.1-linux-openSUSE_11.1_x86_64-x86_64-
Linux/local/lib/python2.6/site-
packages/sage/symbolic/expression_conversions.py in __call__(self, ex)
   198
   199         try:
--> 200             obj = ex.pyobject()
   201             return self.pyobject(ex, obj)
   202         except TypeError, err:

AttributeError: 'sage.rings.integer.Integer' object has no attribute
'pyobject'
```



---

archive/attachments_009905.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_8056-fast_callable.take2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8056/trac_8056-fast_callable.take2.patch",
    "created_at": "2010-01-31T21:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8056",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/burcin"
}
```



---

archive/issue_comments_081508.json:
```json
{
    "body": "second try",
    "created_at": "2010-01-31T21:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8056#issuecomment-81508",
    "user": "https://github.com/burcin"
}
```

second try



---

archive/issue_comments_081509.json:
```json
{
    "body": "**Reviewer:** Harald Schilly",
    "created_at": "2010-01-31T21:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8056#issuecomment-81509",
    "user": "https://github.com/burcin"
}
```

**Reviewer:** Harald Schilly



---

archive/issue_comments_081510.json:
```json
{
    "body": "<a id='comment:3'></a>\nThank you for the review.\n\nattachment:trac_8056-fast_callable.take2.patch uses `SR.one_element()` instead of `ZZ(1)`. This fixes the problems reported in [comment:2](#comment%3A2).\n\nApply only attachment:trac_8056-fast_callable.take2.patch.\n\nCan you take another look?",
    "created_at": "2010-01-31T21:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8056#issuecomment-81510",
    "user": "https://github.com/burcin"
}
```

<a id='comment:3'></a>
Thank you for the review.

attachment:trac_8056-fast_callable.take2.patch uses `SR.one_element()` instead of `ZZ(1)`. This fixes the problems reported in [comment:2](#comment%3A2).

Apply only attachment:trac_8056-fast_callable.take2.patch.

Can you take another look?



---

archive/issue_comments_081511.json:
```json
{
    "body": "**Changing reviewer** from \"Harald Schilly\" to \"Thomas Hupfer\".",
    "created_at": "2010-02-01T10:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8056#issuecomment-81511",
    "user": "https://github.com/haraldschilly"
}
```

**Changing reviewer** from "Harald Schilly" to "Thomas Hupfer".



---

archive/issue_comments_081512.json:
```json
{
    "body": "<a id='comment:4'></a>\nthomas hupfer:\n\n>\u00a0\u00a0looks good, plotting now works for me as expected.\n",
    "created_at": "2010-02-01T10:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8056#issuecomment-81512",
    "user": "https://github.com/haraldschilly"
}
```

<a id='comment:4'></a>
thomas hupfer:

>  looks good, plotting now works for me as expected.




---

archive/issue_comments_081513.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2010-02-01T10:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8056#issuecomment-81513",
    "user": "https://github.com/haraldschilly"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_081514.json:
```json
{
    "body": "**Merged:** sage-4.3.3.alpha0",
    "created_at": "2010-02-11T15:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8056#issuecomment-81514",
    "user": "https://github.com/qed777"
}
```

**Merged:** sage-4.3.3.alpha0



---

archive/issue_events_023631.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-02-11T15:03:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8056",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8056#event-23631"
}
```
