# Issue 8495: Regression: Many mathematica doctests now fail

archive/issues_008495.json:
```json
{
    "body": "Since #3587, which implements a _sage_() method for mathematica elements, many mathematica doctests fail.  E.g:\n\n```\nsage: def math_bessel_K(nu,x): \n     ...       return mathematica(nu).BesselK(x).N(20).sage() \n     ... \n     sage: math_bessel_K(2,I) \nNotImplementedError: Unable to parse \nMathematica output: \n-2.5928861754911969781676606702635284285719718407749199115289`20.1494653502 82203 \n+ \n0.1804899720669620266296208808560650432663536549483055754141`18.99213497581 376*i \n\n```\n\napply only [attachment:trac_8495-rewrite-_sage_.2.patch](https://github.com/sagemath/sage/files/ticket8495/trac_8495-rewrite-_sage_.2.patch)\n\n**Assignee:** flawrence\n\n**CC:**  @burcin @jasongrout\n\n**Author:** Felix Lawrence\n\n**Reviewer:** Mike Hansen, Burcin Erocal, David Kirkby\n\n**Merged:** sage-4.7.alpha3\n\nIssue created by migration from https://trac.sagemath.org/ticket/8495\n\n",
    "closed_at": "2011-03-25T12:31:01Z",
    "created_at": "2010-03-11T06:33:47Z",
    "labels": [
        "component: interfaces",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7",
    "title": "Regression: Many mathematica doctests now fail",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/8495",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```
Since #3587, which implements a _sage_() method for mathematica elements, many mathematica doctests fail.  E.g:

```
sage: def math_bessel_K(nu,x): 
     ...       return mathematica(nu).BesselK(x).N(20).sage() 
     ... 
     sage: math_bessel_K(2,I) 
NotImplementedError: Unable to parse 
Mathematica output: 
-2.5928861754911969781676606702635284285719718407749199115289`20.1494653502 82203 
+ 
0.1804899720669620266296208808560650432663536549483055754141`18.99213497581 376*i 

```

apply only [attachment:trac_8495-rewrite-_sage_.2.patch](https://github.com/sagemath/sage/files/ticket8495/trac_8495-rewrite-_sage_.2.patch)

**Assignee:** flawrence

**CC:**  @burcin @jasongrout

**Author:** Felix Lawrence

**Reviewer:** Mike Hansen, Burcin Erocal, David Kirkby

**Merged:** sage-4.7.alpha3

Issue created by migration from https://trac.sagemath.org/ticket/8495





---

archive/issue_comments_069413.json:
```json
{
    "body": "<a id='comment:1'></a>\nBefore #3587, mathematica's output was sent to ExpectElement._sage_repr() in expect.py, which called repr() and tidied up the results (converting {} to [], stripping new line characters etc) then sage_eval() was called on the results.  With this approach, mathematica functions that returned numbers, symbolic variables or arrays could be imported successfully into sage.  The approach had the disadvantage that all symbolic variables had to be passed in manually as locals, and that functions couldn't be translated from mathematica to their equivalents in sage.\n\n#3587 instead calls str() on mathematica's results (which has the alarming option ascii_art = True), then replaces []s by (), changes everything to lower case and sends it to SR.  This works for simple functions but fails for arrays and probably anything affected by ascii_art = True\n\nI'm not familiar with SR, but at a minimum MathematicaElement._sage_() should be patched to call sage_repr() instead of str().  I don't know whether SR has all the functionality of sage_eval(), e.g. supporting arrays.",
    "created_at": "2010-03-11T06:42:51Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69413",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```

<a id='comment:1'></a>
Before #3587, mathematica's output was sent to ExpectElement._sage_repr() in expect.py, which called repr() and tidied up the results (converting {} to [], stripping new line characters etc) then sage_eval() was called on the results.  With this approach, mathematica functions that returned numbers, symbolic variables or arrays could be imported successfully into sage.  The approach had the disadvantage that all symbolic variables had to be passed in manually as locals, and that functions couldn't be translated from mathematica to their equivalents in sage.

#3587 instead calls str() on mathematica's results (which has the alarming option ascii_art = True), then replaces []s by (), changes everything to lower case and sends it to SR.  This works for simple functions but fails for arrays and probably anything affected by ascii_art = True

I'm not familiar with SR, but at a minimum MathematicaElement._sage_() should be patched to call sage_repr() instead of str().  I don't know whether SR has all the functionality of sage_eval(), e.g. supporting arrays.



---

archive/issue_events_060193.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/flawrence",
    "created_at": "2010-03-11T06:42:51Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "rename": {
        "from": "Regression: Many mathematica doctests fail",
        "to": "Regression: Many mathematica doctests now fail"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60193"
}
```



---

archive/issue_comments_069414.json:
```json
{
    "body": "<a id='comment:2'></a>\nI've uploaded a patch that has a thorough rewrite of MathematicaElement._sage_() to get the functionality from #3587 while keeping the functionality from before it (lists, complex numbers, numbers in scientific notation...).  I still need to write some documentation for the top of the file (i.e. documentation that makes it into the reference manual) but before I do that and submit this for formal review I'd like wise comments about my approach, e.g. \"The way you convert function names is really inefficient and problematic, do it this way...\", or \"You can efficiently get a list of all sage functions recognised by sage_eval() by ...\".\n\nAlso if someone could check the doctests on a 32-bit computer and let me know the result that they get instead of\n[[1.00000000000000, 4], pi, 3.20000000000000*e100, I]\nthat would be grand.",
    "created_at": "2010-03-14T12:59:36Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69414",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```

<a id='comment:2'></a>
I've uploaded a patch that has a thorough rewrite of MathematicaElement._sage_() to get the functionality from #3587 while keeping the functionality from before it (lists, complex numbers, numbers in scientific notation...).  I still need to write some documentation for the top of the file (i.e. documentation that makes it into the reference manual) but before I do that and submit this for formal review I'd like wise comments about my approach, e.g. "The way you convert function names is really inefficient and problematic, do it this way...", or "You can efficiently get a list of all sage functions recognised by sage_eval() by ...".

Also if someone could check the doctests on a 32-bit computer and let me know the result that they get instead of
[[1.00000000000000, 4], pi, 3.20000000000000*e100, I]
that would be grand.



---

archive/issue_comments_069415.json:
```json
{
    "body": "**Changing assignee** from @williamstein to flawrence.",
    "created_at": "2010-03-14T12:59:36Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69415",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```

**Changing assignee** from @williamstein to flawrence.



---

archive/issue_comments_069416.json:
```json
{
    "body": "<a id='comment:3'></a>\nI've updated the patch file so that it updates the Mathematica module documentation.  This needs to be doctested on a 32-bit computer at some point.",
    "created_at": "2010-04-06T05:20:22Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69416",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```

<a id='comment:3'></a>
I've updated the patch file so that it updates the Mathematica module documentation.  This needs to be doctested on a 32-bit computer at some point.



---

archive/issue_events_060194.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/flawrence",
    "created_at": "2010-04-06T05:20:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "milestone": "sage-4.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60194"
}
```



---

archive/issue_comments_069417.json:
```json
{
    "body": "**Author:** flawrence",
    "created_at": "2010-04-06T05:20:22Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69417",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```

**Author:** flawrence



---

archive/issue_events_060195.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/flawrence",
    "created_at": "2010-04-06T05:20:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60195"
}
```



---

archive/issue_comments_069418.json:
```json
{
    "body": "**Changing author** from \"flawrence\" to \"Felix Lawrence\".",
    "created_at": "2010-07-19T08:16:32Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69418",
    "user": "https://github.com/burcin"
}
```

**Changing author** from "flawrence" to "Felix Lawrence".



---

archive/issue_comments_069419.json:
```json
{
    "body": "**Reviewer:** Mike Hansen",
    "created_at": "2010-07-19T20:05:32Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69419",
    "user": "https://github.com/mwhansen"
}
```

**Reviewer:** Mike Hansen



---

archive/issue_comments_069420.json:
```json
{
    "body": "<a id='comment:5'></a>\nThere is dictionary in place from Mathematica to Sage.\n\n```\n\nsage: sage.symbolic.pynac.symbol_table['mathematica']\n{'Log[2]': log2, 'Cos': cos, 'DiracDelta': dirac_delta, 'EulerGamma': euler_gamma, 'Glaisher': glaisher, 'Sqrt': <function sqrt at 0x2c20f50>, 'Factorial': factorial, 'Khinchin': khinchin, 'Catalan': catalan, '(1+Sqrt[5])/2': golden_ratio, 'Binomial': binomial, 'PolyGamma': psi, 'HeavisideTheta': heaviside, 'KroneckerDelta': kronecker_delta, 'Pi': pi, 'UnitStep': unit_step, 'Sin': sin, 'Gamma': gamma, 'Sign': sgn}\n```\n\nThis is constructed at runtime and is filled in by the `__init__` methods of the functions and constants.",
    "created_at": "2010-07-19T20:05:32Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69420",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:5'></a>
There is dictionary in place from Mathematica to Sage.

```

sage: sage.symbolic.pynac.symbol_table['mathematica']
{'Log[2]': log2, 'Cos': cos, 'DiracDelta': dirac_delta, 'EulerGamma': euler_gamma, 'Glaisher': glaisher, 'Sqrt': <function sqrt at 0x2c20f50>, 'Factorial': factorial, 'Khinchin': khinchin, 'Catalan': catalan, '(1+Sqrt[5])/2': golden_ratio, 'Binomial': binomial, 'PolyGamma': psi, 'HeavisideTheta': heaviside, 'KroneckerDelta': kronecker_delta, 'Pi': pi, 'UnitStep': unit_step, 'Sin': sin, 'Gamma': gamma, 'Sign': sgn}
```

This is constructed at runtime and is filled in by the `__init__` methods of the functions and constants.



---

archive/issue_comments_069421.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [flawrence](#comment%3A2):\n> I've uploaded a patch that has a thorough rewrite of MathematicaElement._sage_() to get the functionality from #3587 while keeping the functionality from before it (lists, complex numbers, numbers in scientific notation...).  I still need to write some documentation for the top of the file (i.e. documentation that makes it into the reference manual) but before I do that and submit this for formal review I'd like wise comments about my approach, e.g. \"The way you convert function names is really inefficient and problematic, do it this way...\", or \"You can efficiently get a list of all sage functions recognised by sage_eval() by ...\".\n> \n> Also if someone could check the doctests on a 32-bit computer and let me know the result that they get instead of\n> [[1.00000000000000, 4], pi, 3.20000000000000*e100, I]\n> that would be grand.\n\nOn 32-bit Debian I get the same output. There is only one doctest failure:\n\n```\n./sage -t  -only-optional=mathematica \"devel/sage/sage/interfaces/mathematica.py\"\nsage -t -only-optional=mathematica \"devel/sage/sage/interfaces/mathematica.py\"\n**********************************************************************\nFile \"./sage-4.4.4/devel/sage/sage/interfaces/mathematica.py\", line 281:\n    sage: math_bessel_K(2,I)                      # optional - mathematica\nExpected:\n    0.180489972066962*I - 2.592886175491197\nGot:\n    -2.59288617549119697816765132253822887 + 0.180489972066962026629620880838378650*I\n**********************************************************************\n\n```\n\nBut this is probably unrelated to this patch, since also without this patch applied I get\nthings like:\n\n```\nsage: mathematica('N[Pi, 1]')\n3.1415926535897932385\nsage: mathematica('N[Pi, 10]')\n3.1415926535897932385\nsage: mathematica('N[Pi, 11]')\n3.1415926535897932384626433836\n```",
    "created_at": "2010-07-20T13:20:03Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69421",
    "user": "https://trac.sagemath.org/admin/accounts/users/whuss"
}
```

<a id='comment:6'></a>
Replying to [flawrence](#comment%3A2):
> I've uploaded a patch that has a thorough rewrite of MathematicaElement._sage_() to get the functionality from #3587 while keeping the functionality from before it (lists, complex numbers, numbers in scientific notation...).  I still need to write some documentation for the top of the file (i.e. documentation that makes it into the reference manual) but before I do that and submit this for formal review I'd like wise comments about my approach, e.g. "The way you convert function names is really inefficient and problematic, do it this way...", or "You can efficiently get a list of all sage functions recognised by sage_eval() by ...".
> 
> Also if someone could check the doctests on a 32-bit computer and let me know the result that they get instead of
> [[1.00000000000000, 4], pi, 3.20000000000000*e100, I]
> that would be grand.

On 32-bit Debian I get the same output. There is only one doctest failure:

```
./sage -t  -only-optional=mathematica "devel/sage/sage/interfaces/mathematica.py"
sage -t -only-optional=mathematica "devel/sage/sage/interfaces/mathematica.py"
**********************************************************************
File "./sage-4.4.4/devel/sage/sage/interfaces/mathematica.py", line 281:
    sage: math_bessel_K(2,I)                      # optional - mathematica
Expected:
    0.180489972066962*I - 2.592886175491197
Got:
    -2.59288617549119697816765132253822887 + 0.180489972066962026629620880838378650*I
**********************************************************************

```

But this is probably unrelated to this patch, since also without this patch applied I get
things like:

```
sage: mathematica('N[Pi, 1]')
3.1415926535897932385
sage: mathematica('N[Pi, 10]')
3.1415926535897932385
sage: mathematica('N[Pi, 11]')
3.1415926535897932384626433836
```



---

archive/issue_comments_069422.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [mhansen](#comment%3A5):\n> There is dictionary in place from Mathematica to Sage.\n> \n\n ```\n sage: sage.symbolic.pynac.symbol_table['mathematica']\n {'Log[2]': log2, 'Cos': cos, 'DiracDelta': dirac_delta, 'EulerGamma': euler_gamma, 'Glaisher': glaisher, 'Sqrt': <function sqrt at 0x2c20f50>, 'Factorial': factorial, 'Khinchin': khinchin, 'Catalan': catalan, '(1+Sqrt[5])/2': golden_ratio, 'Binomial': binomial, 'PolyGamma': psi, 'HeavisideTheta': heaviside, 'KroneckerDelta': kronecker_delta, 'Pi': pi, 'UnitStep': unit_step, 'Sin': sin, 'Gamma': gamma, 'Sign': sgn}\n```\n\nExcellent! I've updated the patch so that it uses that dictionary.  I also added the ability to pass a locals dictionary to `_sage_`, which complements and/or overrides the symbol_table['mathematica'] dictionary.\n\nThe documentation for this function won't be very visible, since it starts with an underscore, so I was contemplating setting up a mathematica-specific .sage function that accepts a locals dictionary and has a copy of this documentation.  In the end I didn't do this because I don't understand the consequences (or why there are separate `_sage_` and sage functions at all).  Opinions?\n\nReplying to [whuss](#comment%3A6):\n>On 32-bit Debian I get the same output. There is only one doctest failure:\n\n>But this is probably unrelated to this patch, since also without this patch applied I get things like:\n\nYes, I'm not sure it's related to the patch either.  For the record I get the correct behaviour with the patch:\n\n```\nsage: mathematica('N[Pi, 1]')\n3.1\nsage: mathematica('N[Pi, 10]')\n3.1415926536\nsage: mathematica('N[Pi, 11]')\n3.14159265359\n```",
    "created_at": "2010-07-21T08:51:34Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69422",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```

<a id='comment:7'></a>
Replying to [mhansen](#comment%3A5):
> There is dictionary in place from Mathematica to Sage.
> 

 ```
 sage: sage.symbolic.pynac.symbol_table['mathematica']
 {'Log[2]': log2, 'Cos': cos, 'DiracDelta': dirac_delta, 'EulerGamma': euler_gamma, 'Glaisher': glaisher, 'Sqrt': <function sqrt at 0x2c20f50>, 'Factorial': factorial, 'Khinchin': khinchin, 'Catalan': catalan, '(1+Sqrt[5])/2': golden_ratio, 'Binomial': binomial, 'PolyGamma': psi, 'HeavisideTheta': heaviside, 'KroneckerDelta': kronecker_delta, 'Pi': pi, 'UnitStep': unit_step, 'Sin': sin, 'Gamma': gamma, 'Sign': sgn}
```

Excellent! I've updated the patch so that it uses that dictionary.  I also added the ability to pass a locals dictionary to `_sage_`, which complements and/or overrides the symbol_table['mathematica'] dictionary.

The documentation for this function won't be very visible, since it starts with an underscore, so I was contemplating setting up a mathematica-specific .sage function that accepts a locals dictionary and has a copy of this documentation.  In the end I didn't do this because I don't understand the consequences (or why there are separate `_sage_` and sage functions at all).  Opinions?

Replying to [whuss](#comment%3A6):
>On 32-bit Debian I get the same output. There is only one doctest failure:

>But this is probably unrelated to this patch, since also without this patch applied I get things like:

Yes, I'm not sure it's related to the patch either.  For the record I get the correct behaviour with the patch:

```
sage: mathematica('N[Pi, 1]')
3.1
sage: mathematica('N[Pi, 10]')
3.1415926536
sage: mathematica('N[Pi, 11]')
3.14159265359
```



---

archive/issue_comments_069423.json:
```json
{
    "body": "<a id='comment:9'></a>\nThis looks great! Many thanks for your work Felix.\n\nHere is my review:\n* Can you change the line lengths to be less than 78 characters? Some of us still edit code using the terminal.\n* There should be an empty line after `::` in the documentation. You can also put the `::` sign right after the text, you don't need to make it a separate line.\n* On line 648 of `interfaces/mathematica.py`, you can change the test `if result.find('\"') != -1:` to `if '\"' in result:`\n* The dictionary merge in the `_sage_()` method might be expensive. I think it's better to do it only if the locals dictionary is not empty. Perhaps `lsymbols = symbol_table['mathematica'].copy(); lsymbols.update(locals)` would be faster.\n* Using `sage_eval()` has lot's of security implications. Can we replace it with `sage.calculus.calculus.SR_parser` or `sage.calculus.calculus.symbolic_expression_from_string()` in this case?\n\nThis is definitely an improvement over what we have currently. I'd really like to see it included in the next release.",
    "created_at": "2010-09-08T14:13:16Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69423",
    "user": "https://github.com/burcin"
}
```

<a id='comment:9'></a>
This looks great! Many thanks for your work Felix.

Here is my review:
* Can you change the line lengths to be less than 78 characters? Some of us still edit code using the terminal.
* There should be an empty line after `::` in the documentation. You can also put the `::` sign right after the text, you don't need to make it a separate line.
* On line 648 of `interfaces/mathematica.py`, you can change the test `if result.find('"') != -1:` to `if '"' in result:`
* The dictionary merge in the `_sage_()` method might be expensive. I think it's better to do it only if the locals dictionary is not empty. Perhaps `lsymbols = symbol_table['mathematica'].copy(); lsymbols.update(locals)` would be faster.
* Using `sage_eval()` has lot's of security implications. Can we replace it with `sage.calculus.calculus.SR_parser` or `sage.calculus.calculus.symbolic_expression_from_string()` in this case?

This is definitely an improvement over what we have currently. I'd really like to see it included in the next release.



---

archive/issue_comments_069424.json:
```json
{
    "body": "**Changing reviewer** from \"Mike Hansen\" to \"Mike Hansen, Burcin Erocal\".",
    "created_at": "2010-09-08T14:13:16Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69424",
    "user": "https://github.com/burcin"
}
```

**Changing reviewer** from "Mike Hansen" to "Mike Hansen, Burcin Erocal".



---

archive/issue_events_060196.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-09-08T14:13:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60196"
}
```



---

archive/issue_events_060197.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-09-08T14:13:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60197"
}
```



---

archive/issue_comments_069425.json:
```json
{
    "body": "<a id='comment:10'></a>\nOne more:\n* The last two hunks applied to `sage/symbolic/constants.py` should be removed. The `conversions` dictionary defines how the current constant is represented in the given system. The values stored in the dictionary should be in MMA syntax.",
    "created_at": "2010-09-08T14:18:27Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69425",
    "user": "https://github.com/burcin"
}
```

<a id='comment:10'></a>
One more:
* The last two hunks applied to `sage/symbolic/constants.py` should be removed. The `conversions` dictionary defines how the current constant is represented in the given system. The values stored in the dictionary should be in MMA syntax.



---

archive/issue_events_060198.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/flawrence",
    "created_at": "2010-11-03T04:45:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60198"
}
```



---

archive/issue_events_060199.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/flawrence",
    "created_at": "2010-11-03T04:45:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60199"
}
```



---

archive/issue_comments_069426.json:
```json
{
    "body": "<a id='comment:11'></a>\nThanks for your suggestions Burcin.  I implemented all of them, and made some significant further changes:\n\nNow we actually check whether each function exists, before we try to convert the entire expression.  This allows us to check several variations of mma's function names, such as a downcased version, a down_cased version, and the original name.  In order to do this I needed to add an option to sage.calculus.calculus._find_func() whereby it wouldn't automatically create a symbolic function if none were present in Sage.  We now also try the same downcasing tricks for constants.\n\nIn order to convert from [CamelCase](../wikis/CamelCase) to camel_case I used code from [stack overflow](http://stackoverflow.com/questions/1175208/does-the-python-standard-library-have-function-to-convert-camelcase-to-camel-case).  I presume such code is public domain and doesn't require attribution in the docstring.\n\nI also realised that the documentation for `_sage_` won't get into Sage's HTML documentation so I added a short section in the module's documentation that reproduces some of the material in the docstring for _sage_().",
    "created_at": "2010-11-03T04:45:38Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69426",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```

<a id='comment:11'></a>
Thanks for your suggestions Burcin.  I implemented all of them, and made some significant further changes:

Now we actually check whether each function exists, before we try to convert the entire expression.  This allows us to check several variations of mma's function names, such as a downcased version, a down_cased version, and the original name.  In order to do this I needed to add an option to sage.calculus.calculus._find_func() whereby it wouldn't automatically create a symbolic function if none were present in Sage.  We now also try the same downcasing tricks for constants.

In order to convert from [CamelCase](../wikis/CamelCase) to camel_case I used code from [stack overflow](http://stackoverflow.com/questions/1175208/does-the-python-standard-library-have-function-to-convert-camelcase-to-camel-case).  I presume such code is public domain and doesn't require attribution in the docstring.

I also realised that the documentation for `_sage_` won't get into Sage's HTML documentation so I added a short section in the module's documentation that reproduces some of the material in the docstring for _sage_().



---

archive/attachments_011005.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "diff_with_previous_review.patch",
    "asset_url": "tarball://root/attachments/ticket8495/diff_with_previous_review.patch",
    "created_at": "2010-11-03T04:50:02Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket8495/diff_with_previous_review.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```



---

archive/issue_comments_069427.json:
```json
{
    "body": "**Attachment:** [diff_with_previous_review.patch](https://github.com/sagemath/sage/files/ticket8495/diff_with_previous_review.patch)\n\nWhat's changed since burcin's review",
    "created_at": "2010-11-03T04:50:02Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69427",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```

**Attachment:** [diff_with_previous_review.patch](https://github.com/sagemath/sage/files/ticket8495/diff_with_previous_review.patch)

What's changed since burcin's review



---

archive/issue_events_060200.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/drkirkby",
    "created_at": "2011-03-09T06:19:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60200"
}
```



---

archive/issue_events_060201.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/drkirkby",
    "created_at": "2011-03-09T06:19:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60201"
}
```



---

archive/issue_comments_069428.json:
```json
{
    "body": "<a id='comment:12'></a>\nWhat patch(s)  is supposed to be applied here? `trac_8495-rewrite-_sage_.patch` applied cleanly to sage-4.6.2.rc1, but `diff_with_previous_review.patch` neither applies cleanly on its own, or after applying `trac_8495-rewrite-_sage_.patch`.",
    "created_at": "2011-03-09T06:19:32Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69428",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:12'></a>
What patch(s)  is supposed to be applied here? `trac_8495-rewrite-_sage_.patch` applied cleanly to sage-4.6.2.rc1, but `diff_with_previous_review.patch` neither applies cleanly on its own, or after applying `trac_8495-rewrite-_sage_.patch`.



---

archive/issue_comments_069429.json:
```json
{
    "body": "<a id='comment:13'></a>\n`trac_8495-rewrite-_sage_.patch` is the patch to apply.  The other patch is for the eye only: it shows what changed since the patch that burcin originally reviewed (which I perhaps foolishly overwrote with the current version of `trac_8495-rewrite-_sage_.patch`)",
    "created_at": "2011-03-09T08:03:47Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69429",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```

<a id='comment:13'></a>
`trac_8495-rewrite-_sage_.patch` is the patch to apply.  The other patch is for the eye only: it shows what changed since the patch that burcin originally reviewed (which I perhaps foolishly overwrote with the current version of `trac_8495-rewrite-_sage_.patch`)



---

archive/issue_events_060202.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/flawrence",
    "created_at": "2011-03-09T08:03:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60202"
}
```



---

archive/issue_events_060203.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/flawrence",
    "created_at": "2011-03-09T08:03:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60203"
}
```



---

archive/issue_events_060204.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/drkirkby",
    "created_at": "2011-03-09T10:14:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60204"
}
```



---

archive/issue_events_060205.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/drkirkby",
    "created_at": "2011-03-09T10:14:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60205"
}
```



---

archive/issue_comments_069430.json:
```json
{
    "body": "<a id='comment:14'></a>\nFor me at least, on OpenSolaris with Mathematica 7.0.1, this is a definite improvement, as it reduced the number of failures in `devel/sage/sage/interfaces/mathematica.py` from 17 to 2. \n\n == Prior to adding the patch ==\n\n```\n\n<snip out lots of failures>\n\n4 items had failures:\n   5 of  84 in __main__.example_0\n   4 of   6 in __main__.example_1\n   4 of  19 in __main__.example_12\n   4 of   6 in __main__.example_2\n***Test Failed*** 17 failures.\nFor whitespace errors, see the file /export/home/drkirkby/.sage//tmp/.doctest_mathematica.py\n\t [5.4 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\tsage -t -optional \"devel/sage/sage/interfaces/mathematica.py\"\nTotal time for all tests: 5.4 seconds\n```\n\n## After adding the patch\nAfter applying the patch, the number of failures is reduced to 2. \n\n```\nsage-4.6.2.rc1$ ./sage -t -optional devel/sage/sage/interfaces/\nsage -t -optional \"devel/sage/sage/interfaces/mathematica.py\"\n**********************************************************************\nFile \"/export/home/drkirkby/3/sage-4.6.2.rc1/devel/sage/sage/interfaces/mathematica.py\", line 270:\n    sage: print n                   # optional - mathematica\nExpected:\n                  1.5707963267948966192313216916397514420985846996876\nGot:\n    1.5707963267949\n**********************************************************************\nFile \"/export/home/drkirkby/3/sage-4.6.2.rc1/devel/sage/sage/interfaces/mathematica.py\", line 311:\n    sage: math_bessel_K(2,I)                      # optional - mathematica\nException raised:\n    Traceback (most recent call last):\n      File \"/export/home/drkirkby/3/sage-4.6.2.rc1/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/export/home/drkirkby/3/sage-4.6.2.rc1/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/export/home/drkirkby/3/sage-4.6.2.rc1/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_0[75]>\", line 1, in <module>\n        math_bessel_K(Integer(2),I)                      # optional - mathematica###line 311:\n    sage: math_bessel_K(2,I)                      # optional - mathematica\n      File \"<doctest __main__.example_0[74]>\", line 2, in math_bessel_K\n        return mathematica(nu).BesselK(x).N(Integer(20))\n      File \"element.pyx\", line 617, in sage.structure.element.Element.numerical_approx (sage/structure/element.c:4658)\n      File \"/export/home/drkirkby/3/sage-4.6.2.rc1/local/lib/python/site-packages/sage/misc/functional.py\", line 1265, in numerical_approx\n        return sage.rings.complex_field.ComplexField(prec)(x)\n      File \"/export/home/drkirkby/3/sage-4.6.2.rc1/local/lib/python/site-packages/sage/rings/complex_field.py\", line 279, in __call__\n        return Parent.__call__(self, x)\n      File \"parent.pyx\", line 915, in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6668)\n      File \"coerce_maps.pyx\", line 82, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3119)\n      File \"coerce_maps.pyx\", line 77, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3022)\n      File \"/export/home/drkirkby/3/sage-4.6.2.rc1/local/lib/python/site-packages/sage/rings/complex_field.py\", line 310, in _element_constructor_\n        return complex_number.ComplexNumber(self, x)\n      File \"complex_number.pyx\", line 162, in sage.rings.complex_number.ComplexNumber.__init__ (sage/rings/complex_number.c:3995)\n    TypeError: unable to coerce to a ComplexNumber: <class 'sage.interfaces.mathematica.MathematicaElement'>\n**********************************************************************\n1 items had failures:\n   2 of  84 in __main__.example_0\n***Test Failed*** 2 failures.\nFor whitespace errors, see the file /export/home/drkirkby/.sage//tmp/.doctest_mathematica.py\n\t [5.2 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\tsage -t -optional \"devel/sage/sage/interfaces/mathematica.py\"\nTotal time for all tests: 5.2 seconds\n```\n\n\n## Mathematica session on the sage machine computing Pi/2\n\n```\ndrkirkby@hawk:~$ math\nMathematica 7.0 for Sun Solaris x86 (64-bit)\nCopyright 1988-2009 Wolfram Research, Inc.\n\nIn[1]:= n=Pi/2\n\n        Pi\nOut[1]= --\n        2\n\nIn[2]:= N[n,50]\n\nOut[2]= 1.5707963267948966192313216916397514420985846996876\n```\n\n## Sage session on the same machine computing pi/2 with the Mathematica interface\n\n```\nsage: x = mathematica(pi/2)\nsage: print x\n        Pi\n        --\n        2\nsage: loads(dumps(x)) == x\nTrue\nsage: n = x.N(50)  \nsage: print n \n1.5707963267949\n```",
    "created_at": "2011-03-09T10:14:57Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69430",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:14'></a>
For me at least, on OpenSolaris with Mathematica 7.0.1, this is a definite improvement, as it reduced the number of failures in `devel/sage/sage/interfaces/mathematica.py` from 17 to 2. 

 == Prior to adding the patch ==

```

<snip out lots of failures>

4 items had failures:
   5 of  84 in __main__.example_0
   4 of   6 in __main__.example_1
   4 of  19 in __main__.example_12
   4 of   6 in __main__.example_2
***Test Failed*** 17 failures.
For whitespace errors, see the file /export/home/drkirkby/.sage//tmp/.doctest_mathematica.py
	 [5.4 s]
 
----------------------------------------------------------------------
The following tests failed:


	sage -t -optional "devel/sage/sage/interfaces/mathematica.py"
Total time for all tests: 5.4 seconds
```

## After adding the patch
After applying the patch, the number of failures is reduced to 2. 

```
sage-4.6.2.rc1$ ./sage -t -optional devel/sage/sage/interfaces/
sage -t -optional "devel/sage/sage/interfaces/mathematica.py"
**********************************************************************
File "/export/home/drkirkby/3/sage-4.6.2.rc1/devel/sage/sage/interfaces/mathematica.py", line 270:
    sage: print n                   # optional - mathematica
Expected:
                  1.5707963267948966192313216916397514420985846996876
Got:
    1.5707963267949
**********************************************************************
File "/export/home/drkirkby/3/sage-4.6.2.rc1/devel/sage/sage/interfaces/mathematica.py", line 311:
    sage: math_bessel_K(2,I)                      # optional - mathematica
Exception raised:
    Traceback (most recent call last):
      File "/export/home/drkirkby/3/sage-4.6.2.rc1/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/export/home/drkirkby/3/sage-4.6.2.rc1/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/export/home/drkirkby/3/sage-4.6.2.rc1/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_0[75]>", line 1, in <module>
        math_bessel_K(Integer(2),I)                      # optional - mathematica###line 311:
    sage: math_bessel_K(2,I)                      # optional - mathematica
      File "<doctest __main__.example_0[74]>", line 2, in math_bessel_K
        return mathematica(nu).BesselK(x).N(Integer(20))
      File "element.pyx", line 617, in sage.structure.element.Element.numerical_approx (sage/structure/element.c:4658)
      File "/export/home/drkirkby/3/sage-4.6.2.rc1/local/lib/python/site-packages/sage/misc/functional.py", line 1265, in numerical_approx
        return sage.rings.complex_field.ComplexField(prec)(x)
      File "/export/home/drkirkby/3/sage-4.6.2.rc1/local/lib/python/site-packages/sage/rings/complex_field.py", line 279, in __call__
        return Parent.__call__(self, x)
      File "parent.pyx", line 915, in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6668)
      File "coerce_maps.pyx", line 82, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3119)
      File "coerce_maps.pyx", line 77, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3022)
      File "/export/home/drkirkby/3/sage-4.6.2.rc1/local/lib/python/site-packages/sage/rings/complex_field.py", line 310, in _element_constructor_
        return complex_number.ComplexNumber(self, x)
      File "complex_number.pyx", line 162, in sage.rings.complex_number.ComplexNumber.__init__ (sage/rings/complex_number.c:3995)
    TypeError: unable to coerce to a ComplexNumber: <class 'sage.interfaces.mathematica.MathematicaElement'>
**********************************************************************
1 items had failures:
   2 of  84 in __main__.example_0
***Test Failed*** 2 failures.
For whitespace errors, see the file /export/home/drkirkby/.sage//tmp/.doctest_mathematica.py
	 [5.2 s]
 
----------------------------------------------------------------------
The following tests failed:


	sage -t -optional "devel/sage/sage/interfaces/mathematica.py"
Total time for all tests: 5.2 seconds
```


## Mathematica session on the sage machine computing Pi/2

```
drkirkby@hawk:~$ math
Mathematica 7.0 for Sun Solaris x86 (64-bit)
Copyright 1988-2009 Wolfram Research, Inc.

In[1]:= n=Pi/2

        Pi
Out[1]= --
        2

In[2]:= N[n,50]

Out[2]= 1.5707963267948966192313216916397514420985846996876
```

## Sage session on the same machine computing pi/2 with the Mathematica interface

```
sage: x = mathematica(pi/2)
sage: print x
        Pi
        --
        2
sage: loads(dumps(x)) == x
True
sage: n = x.N(50)  
sage: print n 
1.5707963267949
```



---

archive/issue_comments_069431.json:
```json
{
    "body": "<a id='comment:15'></a>\nOK, that's quite strange.  On my OS X 10.6 64-bit box with Sage 4.6.1, all tests pass.  But the two doctests that failed on your computer don't even call .sage(), which is the main thing that this ticket modifies!\n\nCan you see whether these doctests pass without my patch applied?\n\nCould you evaluate the following lines for me (with the patch applied) and give me the output from your computer:\n\n```\nsage: a = mathematica(2).BesselK(I).N(20)\nsage: repr(a)\n'-2.59288617549119697817 + 0.18048997206696202663*I'\nsage: a._sage_repr()\n'-2.59288617549119697817 + 0.18048997206696202663*I'\nsage: a.sage()\n-2.59288617549 + 0.180489972067*I\n```",
    "created_at": "2011-03-09T10:56:58Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69431",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```

<a id='comment:15'></a>
OK, that's quite strange.  On my OS X 10.6 64-bit box with Sage 4.6.1, all tests pass.  But the two doctests that failed on your computer don't even call .sage(), which is the main thing that this ticket modifies!

Can you see whether these doctests pass without my patch applied?

Could you evaluate the following lines for me (with the patch applied) and give me the output from your computer:

```
sage: a = mathematica(2).BesselK(I).N(20)
sage: repr(a)
'-2.59288617549119697817 + 0.18048997206696202663*I'
sage: a._sage_repr()
'-2.59288617549119697817 + 0.18048997206696202663*I'
sage: a.sage()
-2.59288617549 + 0.180489972067*I
```



---

archive/issue_comments_069432.json:
```json
{
    "body": "<a id='comment:16'></a>\nBTW, the use of `sage.calculus.calculus.symbolic_expression_from_string` seems to limit the accuracy of results:\n\n```\nsage: from sage.calculus.calculus import symbolic_expression_from_string as sefs \nsage: repr(mathematica(pi/2).N(50))\n'1.57079632679489661923132169163975144209858469968755'\nsage: sefs('1.57079632679489661923132169163975144209858469968755')\n1.57079632679\nsage: sage_eval('1.57079632679489661923132169163975144209858469968755')\n1.5707963267948966192313216916397514420985846996875\n```\n\n`sage_eval` gets it right, but Burcin noted above that using it is a security risk.  I guess my suggestion would be to stick with `symbolic_expression_from_string` and open a ticket on improving its accuracy.  Thoughts?",
    "created_at": "2011-03-09T11:06:25Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69432",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```

<a id='comment:16'></a>
BTW, the use of `sage.calculus.calculus.symbolic_expression_from_string` seems to limit the accuracy of results:

```
sage: from sage.calculus.calculus import symbolic_expression_from_string as sefs 
sage: repr(mathematica(pi/2).N(50))
'1.57079632679489661923132169163975144209858469968755'
sage: sefs('1.57079632679489661923132169163975144209858469968755')
1.57079632679
sage: sage_eval('1.57079632679489661923132169163975144209858469968755')
1.5707963267948966192313216916397514420985846996875
```

`sage_eval` gets it right, but Burcin noted above that using it is a security risk.  I guess my suggestion would be to stick with `symbolic_expression_from_string` and open a ticket on improving its accuracy.  Thoughts?



---

archive/issue_comments_069433.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [flawrence](#comment%3A16):\n> BTW, the use of `sage.calculus.calculus.symbolic_expression_from_string` seems to limit the accuracy of results:\n> \n\n ```\n > sage: from sage.calculus.calculus import symbolic_expression_from_string as sefs \n > sage: repr(mathematica(pi/2).N(50))\n > '1.57079632679489661923132169163975144209858469968755'\n > sage: sefs('1.57079632679489661923132169163975144209858469968755')\n > 1.57079632679\n > sage: sage_eval('1.57079632679489661923132169163975144209858469968755')\n > 1.5707963267948966192313216916397514420985846996875\n ```\n> \n> `sage_eval` gets it right, but Burcin noted above that using it is a security risk.  I guess my suggestion would be to stick with `symbolic_expression_from_string` and open a ticket on improving its accuracy.  Thoughts?\n\nSounds good to me. Can you open that ticket? :)",
    "created_at": "2011-03-09T14:16:43Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69433",
    "user": "https://github.com/burcin"
}
```

<a id='comment:17'></a>
Replying to [flawrence](#comment%3A16):
> BTW, the use of `sage.calculus.calculus.symbolic_expression_from_string` seems to limit the accuracy of results:
> 

 ```
 > sage: from sage.calculus.calculus import symbolic_expression_from_string as sefs 
 > sage: repr(mathematica(pi/2).N(50))
 > '1.57079632679489661923132169163975144209858469968755'
 > sage: sefs('1.57079632679489661923132169163975144209858469968755')
 > 1.57079632679
 > sage: sage_eval('1.57079632679489661923132169163975144209858469968755')
 > 1.5707963267948966192313216916397514420985846996875
 ```
> 
> `sage_eval` gets it right, but Burcin noted above that using it is a security risk.  I guess my suggestion would be to stick with `symbolic_expression_from_string` and open a ticket on improving its accuracy.  Thoughts?

Sounds good to me. Can you open that ticket? :)



---

archive/issue_comments_069434.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [flawrence](#comment%3A15):\n> OK, that's quite strange.  On my OS X 10.6 64-bit box with Sage 4.6.1, all tests pass.  But the two doctests that failed on your computer don't even call .sage(), which is the main thing that this ticket modifies!\n\nEm, it is strange. \n\nI'm a bit tied up now, but will repeat later. \n\nI'm actually willing to give this a positive review, on the basis that it fixes a very large number of the problems, and no new bugs are introduced. But I'll run the tests later and see what can be done. \n\nDave",
    "created_at": "2011-03-09T15:56:55Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69434",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:18'></a>
Replying to [flawrence](#comment%3A15):
> OK, that's quite strange.  On my OS X 10.6 64-bit box with Sage 4.6.1, all tests pass.  But the two doctests that failed on your computer don't even call .sage(), which is the main thing that this ticket modifies!

Em, it is strange. 

I'm a bit tied up now, but will repeat later. 

I'm actually willing to give this a positive review, on the basis that it fixes a very large number of the problems, and no new bugs are introduced. But I'll run the tests later and see what can be done. 

Dave



---

archive/issue_comments_069435.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [burcin](#comment%3A17):\n> Replying to [flawrence](#comment%3A16):\n> > `sage_eval` gets it right, but Burcin noted above that using it is a security risk.  I guess my suggestion would be to stick with `symbolic_expression_from_string` and open a ticket on improving its accuracy.  Thoughts?\n\n> \n> Sounds good to me. Can you open that ticket? :)\n\nDone: #10898",
    "created_at": "2011-03-10T00:58:37Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69435",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```

<a id='comment:19'></a>
Replying to [burcin](#comment%3A17):
> Replying to [flawrence](#comment%3A16):
> > `sage_eval` gets it right, but Burcin noted above that using it is a security risk.  I guess my suggestion would be to stick with `symbolic_expression_from_string` and open a ticket on improving its accuracy.  Thoughts?

> 
> Sounds good to me. Can you open that ticket? :)

Done: #10898



---

archive/issue_comments_069436.json:
```json
{
    "body": "<a id='comment:20'></a>\nHi Dave,\n\nHave you had a chance to investigate what was happening on Solaris?\n\nCheers,\nFelix",
    "created_at": "2011-03-19T12:03:52Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69436",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```

<a id='comment:20'></a>
Hi Dave,

Have you had a chance to investigate what was happening on Solaris?

Cheers,
Felix



---

archive/issue_events_060206.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/flawrence",
    "created_at": "2011-03-19T12:03:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60206"
}
```



---

archive/issue_events_060207.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/flawrence",
    "created_at": "2011-03-19T12:03:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60207"
}
```



---

archive/issue_comments_069437.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [flawrence](#comment%3A20):\n> Hi Dave,\n> \n> Have you had a chance to investigate what was happening on Solaris?\n> \n> Cheers,\n> Felix\n\nCan you clarify the exact commands you want tested with and without the patch?",
    "created_at": "2011-03-19T19:11:29Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69437",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:21'></a>
Replying to [flawrence](#comment%3A20):
> Hi Dave,
> 
> Have you had a chance to investigate what was happening on Solaris?
> 
> Cheers,
> Felix

Can you clarify the exact commands you want tested with and without the patch?



---

archive/issue_events_060208.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/flawrence",
    "created_at": "2011-03-20T00:06:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60208"
}
```



---

archive/issue_events_060209.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/flawrence",
    "created_at": "2011-03-20T00:06:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60209"
}
```



---

archive/issue_comments_069438.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -13,3 +13,4 @@\n \n ```\n \n+apply only `trac_8495-rewrite-_sage_.patch`\n``````\n",
    "created_at": "2011-03-20T00:06:54Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69438",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -13,3 +13,4 @@
 
 ```
 
+apply only `trac_8495-rewrite-_sage_.patch`
``````




---

archive/issue_comments_069439.json:
```json
{
    "body": "<a id='comment:22'></a>\nARGH! I upgraded to 4.6.2 (from 4.6.1), ran the tests and get the same errors as Dave.\n\n#9032 modified Sage's .n(), and added (in two files)\n\n```\nn = numerical_approx\nN = n\n```\n\nThis means that Mathematica's `N[]` is no longer being called - instead Sage's `numerical_approx()` is being called, and it can't handle certain mma objects.  Furthermore the argument taken by `numerical_approx` is the number of bits (I think?) whereas `N[50]` gives 50 sig figs.\n\nI think that the way to fix this is by adjusting precedences so that on mathematica objects, mathematica functions take priority.  I also think that fixing this is beyond the scope of this ticket (which was a rewrite of `._sage_`).  I have created a new ticket regarding this issue: #10968",
    "created_at": "2011-03-20T00:06:54Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69439",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```

<a id='comment:22'></a>
ARGH! I upgraded to 4.6.2 (from 4.6.1), ran the tests and get the same errors as Dave.

#9032 modified Sage's .n(), and added (in two files)

```
n = numerical_approx
N = n
```

This means that Mathematica's `N[]` is no longer being called - instead Sage's `numerical_approx()` is being called, and it can't handle certain mma objects.  Furthermore the argument taken by `numerical_approx` is the number of bits (I think?) whereas `N[50]` gives 50 sig figs.

I think that the way to fix this is by adjusting precedences so that on mathematica objects, mathematica functions take priority.  I also think that fixing this is beyond the scope of this ticket (which was a rewrite of `._sage_`).  I have created a new ticket regarding this issue: #10968



---

archive/issue_comments_069440.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [flawrence](#comment%3A22):\n> ARGH! I upgraded to 4.6.2 (from 4.6.1), ran the tests and get the same errors as Dave.\n\nI'm glad I;m not going mad. \n\nSince the changes reduces the number of failures from 17 to 2, I believe this should be merged, so positive review. The remaining issues can be sorted out on #10968",
    "created_at": "2011-03-20T01:29:31Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69440",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:23'></a>
Replying to [flawrence](#comment%3A22):
> ARGH! I upgraded to 4.6.2 (from 4.6.1), ran the tests and get the same errors as Dave.

I'm glad I;m not going mad. 

Since the changes reduces the number of failures from 17 to 2, I believe this should be merged, so positive review. The remaining issues can be sorted out on #10968



---

archive/issue_comments_069441.json:
```json
{
    "body": "**Changing reviewer** from \"Mike Hansen, Burcin Erocal\" to \"Mike Hansen, Burcin Erocal, David Kirkby\".",
    "created_at": "2011-03-20T01:29:31Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69441",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Changing reviewer** from "Mike Hansen, Burcin Erocal" to "Mike Hansen, Burcin Erocal, David Kirkby".



---

archive/issue_events_060210.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/drkirkby",
    "created_at": "2011-03-20T01:29:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60210"
}
```



---

archive/issue_events_060211.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/drkirkby",
    "created_at": "2011-03-20T01:29:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60211"
}
```



---

archive/issue_comments_069442.json:
```json
{
    "body": "<a id='comment:24'></a>\nProblems while building the documentation:\n\n```\ndochtml.log:/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.alpha3/local/lib/python2.6/site-packages/sage/interfaces/mathematica.py:docstring of sage.interfaces.mathematica:282: (WARNING/2) Bullet list ends without a blank line; unexpected unindent.\ndochtml.log:/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.alpha3/local/lib/python2.6/site-packages/sage/interfaces/mathematica.py:docstring of sage.interfaces.mathematica:284: (WARNING/2) Block quote ends without a blank line; unexpected unindent.\ndochtml.log:/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.alpha3/local/lib/python2.6/site-packages/sage/interfaces/mathematica.py:docstring of sage.interfaces.mathematica:277: (ERROR/3) Unexpected indentation.\n```",
    "created_at": "2011-03-23T13:54:44Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69442",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
Problems while building the documentation:

```
dochtml.log:/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.alpha3/local/lib/python2.6/site-packages/sage/interfaces/mathematica.py:docstring of sage.interfaces.mathematica:282: (WARNING/2) Bullet list ends without a blank line; unexpected unindent.
dochtml.log:/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.alpha3/local/lib/python2.6/site-packages/sage/interfaces/mathematica.py:docstring of sage.interfaces.mathematica:284: (WARNING/2) Block quote ends without a blank line; unexpected unindent.
dochtml.log:/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.alpha3/local/lib/python2.6/site-packages/sage/interfaces/mathematica.py:docstring of sage.interfaces.mathematica:277: (ERROR/3) Unexpected indentation.
```



---

archive/issue_events_060212.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-03-23T13:54:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60212"
}
```



---

archive/issue_events_060213.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-03-23T13:54:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60213"
}
```



---

archive/attachments_011006.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_8495-rewrite-_sage_.patch",
    "asset_url": "tarball://root/attachments/ticket8495/trac_8495-rewrite-_sage_.patch",
    "created_at": "2011-03-23T14:15:20Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket8495/trac_8495-rewrite-_sage_.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```



---

archive/issue_comments_069443.json:
```json
{
    "body": "**Attachment:** [trac_8495-rewrite-_sage_.patch](https://github.com/sagemath/sage/files/ticket8495/trac_8495-rewrite-_sage_.patch)",
    "created_at": "2011-03-23T14:15:20Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69443",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```

**Attachment:** [trac_8495-rewrite-_sage_.patch](https://github.com/sagemath/sage/files/ticket8495/trac_8495-rewrite-_sage_.patch)



---

archive/attachments_011007.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_8495-rewrite-_sage_.2.patch",
    "asset_url": "tarball://root/attachments/ticket8495/trac_8495-rewrite-_sage_.2.patch",
    "created_at": "2011-03-23T14:27:23Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket8495/trac_8495-rewrite-_sage_.2.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```



---

archive/issue_comments_069444.json:
```json
{
    "body": "<a id='comment:25'></a>\n**Attachment:** [trac_8495-rewrite-_sage_.2.patch](https://github.com/sagemath/sage/files/ticket8495/trac_8495-rewrite-_sage_.2.patch)\n\nI made some minor formatting changes to the documentation to avoid the above problems.  The documentation now builds without errors and looks OK on my machine.\n\nI forgot to tick the 'replace attachment' box; please disregard the older (non \".2.\") patch.",
    "created_at": "2011-03-23T14:27:23Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69444",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```

<a id='comment:25'></a>
**Attachment:** [trac_8495-rewrite-_sage_.2.patch](https://github.com/sagemath/sage/files/ticket8495/trac_8495-rewrite-_sage_.2.patch)

I made some minor formatting changes to the documentation to avoid the above problems.  The documentation now builds without errors and looks OK on my machine.

I forgot to tick the 'replace attachment' box; please disregard the older (non ".2.") patch.



---

archive/issue_comments_069445.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -13,4 +13,4 @@\n \n ```\n \n-apply only `trac_8495-rewrite-_sage_.patch`\n+apply only [attachment:trac_8495-rewrite-_sage_.2.patch](https://github.com/sagemath/sage/files/ticket8495/trac_8495-rewrite-_sage_.2.patch)\n``````\n",
    "created_at": "2011-03-23T14:27:23Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69445",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -13,4 +13,4 @@
 
 ```
 
-apply only `trac_8495-rewrite-_sage_.patch`
+apply only [attachment:trac_8495-rewrite-_sage_.2.patch](https://github.com/sagemath/sage/files/ticket8495/trac_8495-rewrite-_sage_.2.patch)
``````




---

archive/issue_events_060214.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/flawrence",
    "created_at": "2011-03-23T14:27:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60214"
}
```



---

archive/issue_events_060215.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/flawrence",
    "created_at": "2011-03-23T14:27:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60215"
}
```



---

archive/issue_events_060216.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/drkirkby",
    "created_at": "2011-03-23T17:22:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60216"
}
```



---

archive/issue_events_060217.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/drkirkby",
    "created_at": "2011-03-23T17:22:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60217"
}
```



---

archive/issue_comments_069446.json:
```json
{
    "body": "<a id='comment:26'></a>\nYes, the documentation builds ok for me. That was something I did not check before I must admit. \n\n\nDave",
    "created_at": "2011-03-23T17:22:15Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69446",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:26'></a>
Yes, the documentation builds ok for me. That was something I did not check before I must admit. 


Dave



---

archive/issue_events_060218.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-03-25T12:31:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60218"
}
```



---

archive/issue_events_060219.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-03-25T12:31:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/8495#event-60219"
}
```



---

archive/issue_comments_069447.json:
```json
{
    "body": "**Merged:** sage-4.7.alpha3",
    "created_at": "2011-03-25T12:31:01Z",
    "issue": "https://github.com/sagemath/sage/issues/8495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/8495#issuecomment-69447",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.7.alpha3
