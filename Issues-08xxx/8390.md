# Issue 8390: Find all roots of a trigonometric equation

archive/issues_008390.json:
```json
{
    "body": "When using\n\n```\nx,y=var('x,y')\nsolve([sin(2*x-pi/6)==1/2],x)\n```\n\nsage returns [x == 1/6*pi]. Which is correct, but we would wish to have all roots. This can be done with:\n\n```\nsolve([sin(2*x-pi/6)==y,y==1/2],[x,y])\n```\n\nwhich returns [[x == 1/2*pi + pi*z5, y == (1/2)], [x == 1/6*pi + pi*z7, y == (1/2)]]\n\nBut this is a very weird way to do things. Surely \n\n```\nsolve([sin(2*x-pi/6)==1/2],x)\n```\nshould also give all roots.\n\n**Assignee:** olazo\n\n**CC:**  @robert-marik @kcrisman @mwhansen\n\n**Keywords:** trigonometric, roots\n\n**Author:** Robert Ma\u0159\u00edk\n\n**Reviewer:** William Stein\n\n**Merged:** sage-4.4.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/8390\n\n",
    "closed_at": "2010-04-15T20:11:34Z",
    "created_at": "2010-02-27T19:07:36Z",
    "labels": [
        "component: algebra",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.4",
    "title": "Find all roots of a trigonometric equation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/8390",
    "user": "https://trac.sagemath.org/admin/accounts/users/olazo"
}
```
When using

```
x,y=var('x,y')
solve([sin(2*x-pi/6)==1/2],x)
```

sage returns [x == 1/6*pi]. Which is correct, but we would wish to have all roots. This can be done with:

```
solve([sin(2*x-pi/6)==y,y==1/2],[x,y])
```

which returns [[x == 1/2*pi + pi*z5, y == (1/2)], [x == 1/6*pi + pi*z7, y == (1/2)]]

But this is a very weird way to do things. Surely 

```
solve([sin(2*x-pi/6)==1/2],x)
```
should also give all roots.

**Assignee:** olazo

**CC:**  @robert-marik @kcrisman @mwhansen

**Keywords:** trigonometric, roots

**Author:** Robert Mařík

**Reviewer:** William Stein

**Merged:** sage-4.4.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/8390





---

archive/issue_comments_086945.json:
```json
{
    "body": "<a id='comment:1'></a>\nCCing our maxima experts--this looks like it might be a problem with maxima.",
    "created_at": "2010-02-27T19:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8390#issuecomment-86945",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:1'></a>
CCing our maxima experts--this looks like it might be a problem with maxima.



---

archive/issue_comments_086946.json:
```json
{
    "body": "<a id='comment:2'></a>\nSage interface for Maxima's solver works like this:\n\nWe try Maxima's solve function first. It we get empty answer, we try the to_poly_solve for the same equation.\n\nIf the answer is not empty, we pass the answer of solve command to Maxima's to_poly_solve.\n\nFor our equation, solve command in Maxima gives only one solution pi/6 (and probably writes something like \"SOLVE is using arc-trig functions to get a solution. Some solutions will be lost.\" on terminal).\n\n```\n[marik@um-bc107 /opt/sage]$ ./sage\n----------------------------------------------------------------------\n| Sage Version 4.3.2, Release Date: 2010-02-06                       |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nsage: eq = sin(2*x-pi/6) == 1/2\nsage: eq._maxima_().solve(x)\n[x=%pi/6]\nsage: eq._maxima_().to_poly_solve(x)\n%union([x=-(-2*%pi*%z6-%pi)/2],[x=-(-2*%pi*%z8-%pi/3)/2])\nsage:\n```\n\nI hope this is an explanation. I do not have enough experiences with to_poly_solve, so my questions are: Is it good idea to skip solve and use to_poly_solve immediatelly when to_poly_sole = True? Or is it posssible to check from within Sage, that the warning about arc-trig functions has been printed? Or introduce to_poly_solve = 'force' to omit solve command?\n\nNow you can use \n\n```\nsage: eq._maxima_().to_poly_solve(x).sage()\n[[x == 1/2*pi + pi*z16], [x == 1/6*pi + pi*z18]]\n```",
    "created_at": "2010-02-27T21:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8390#issuecomment-86946",
    "user": "https://github.com/robert-marik"
}
```

<a id='comment:2'></a>
Sage interface for Maxima's solver works like this:

We try Maxima's solve function first. It we get empty answer, we try the to_poly_solve for the same equation.

If the answer is not empty, we pass the answer of solve command to Maxima's to_poly_solve.

For our equation, solve command in Maxima gives only one solution pi/6 (and probably writes something like "SOLVE is using arc-trig functions to get a solution. Some solutions will be lost." on terminal).

```
[marik@um-bc107 /opt/sage]$ ./sage
----------------------------------------------------------------------
| Sage Version 4.3.2, Release Date: 2010-02-06                       |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
sage: eq = sin(2*x-pi/6) == 1/2
sage: eq._maxima_().solve(x)
[x=%pi/6]
sage: eq._maxima_().to_poly_solve(x)
%union([x=-(-2*%pi*%z6-%pi)/2],[x=-(-2*%pi*%z8-%pi/3)/2])
sage:
```

I hope this is an explanation. I do not have enough experiences with to_poly_solve, so my questions are: Is it good idea to skip solve and use to_poly_solve immediatelly when to_poly_sole = True? Or is it posssible to check from within Sage, that the warning about arc-trig functions has been printed? Or introduce to_poly_solve = 'force' to omit solve command?

Now you can use 

```
sage: eq._maxima_().to_poly_solve(x).sage()
[[x == 1/2*pi + pi*z16], [x == 1/6*pi + pi*z18]]
```



---

archive/issue_comments_086947.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -13,4 +13,9 @@\n \n which returns [[x == 1/2*pi + pi*z5, y == (1/2)], [x == 1/6*pi + pi*z7, y == (1/2)]]\n \n-But this is a very weird way to do things. Surely solve([sin(2*x-pi/6)==y,y==1/2],[x,y]) should also give all roots.\n+But this is a very weird way to do things. Surely \n+\n+```\n+solve([sin(2*x-pi/6)==1/2],x)\n+```\n+should also give all roots.\n``````\n",
    "created_at": "2010-02-27T21:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8390#issuecomment-86947",
    "user": "https://github.com/robert-marik"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -13,4 +13,9 @@
 
 which returns [[x == 1/2*pi + pi*z5, y == (1/2)], [x == 1/6*pi + pi*z7, y == (1/2)]]
 
-But this is a very weird way to do things. Surely solve([sin(2*x-pi/6)==y,y==1/2],[x,y]) should also give all roots.
+But this is a very weird way to do things. Surely 
+
+```
+solve([sin(2*x-pi/6)==1/2],x)
+```
+should also give all roots.
``````




---

archive/issue_comments_086948.json:
```json
{
    "body": "<a id='comment:4'></a>\ntemporary patch:\n\n```\ndiff -r 799f70320d89 sage/symbolic/expression.pyx\n--- a/sage/symbolic/expression.pyx      Thu Feb 11 09:03:17 2010 -0800\n+++ b/sage/symbolic/expression.pyx      Sun Feb 28 16:16:33 2010 +0100\n@@ -6501,7 +6501,7 @@\n         # solutions being returned.                            #\n         ########################################################\n         if to_poly_solve and not multiplicities:\n-            if len(X)==0: # if Maxima's solve gave no solutions, only try it\n+            if len(X)==0 or to_poly_solve == 'force': # if Maxima's solve gave no solutions, only try it\n                 try:\n                     s = m.to_poly_solve(x)\n                     T = string_to_list_of_solutions(repr(s))\n```\n\nallows this\n\n```\n[marik@taxus ../sage-4.3.3.alpha0]$ ./sage\n----------------------------------------------------------------------\n| Sage Version 4.3.3.alpha0, Release Date: 2010-02-11                |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\nsage: solve(sin(x)==1/2,x)\n[x == 1/6*pi]\nsage: solve(sin(x)==1/2,x,to_poly_solve = 'force')\n[x == 5/6*pi + 2*pi*z8, x == 1/6*pi + 2*pi*z6]\nsage:\n```",
    "created_at": "2010-02-28T15:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8390#issuecomment-86948",
    "user": "https://github.com/robert-marik"
}
```

<a id='comment:4'></a>
temporary patch:

```
diff -r 799f70320d89 sage/symbolic/expression.pyx
--- a/sage/symbolic/expression.pyx      Thu Feb 11 09:03:17 2010 -0800
+++ b/sage/symbolic/expression.pyx      Sun Feb 28 16:16:33 2010 +0100
@@ -6501,7 +6501,7 @@
         # solutions being returned.                            #
         ########################################################
         if to_poly_solve and not multiplicities:
-            if len(X)==0: # if Maxima's solve gave no solutions, only try it
+            if len(X)==0 or to_poly_solve == 'force': # if Maxima's solve gave no solutions, only try it
                 try:
                     s = m.to_poly_solve(x)
                     T = string_to_list_of_solutions(repr(s))
```

allows this

```
[marik@taxus ../sage-4.3.3.alpha0]$ ./sage
----------------------------------------------------------------------
| Sage Version 4.3.3.alpha0, Release Date: 2010-02-11                |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
sage: solve(sin(x)==1/2,x)
[x == 1/6*pi]
sage: solve(sin(x)==1/2,x,to_poly_solve = 'force')
[x == 5/6*pi + 2*pi*z8, x == 1/6*pi + 2*pi*z6]
sage:
```



---

archive/issue_comments_086949.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2010-02-28T23:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8390#issuecomment-86949",
    "user": "https://github.com/robert-marik"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_086950.json:
```json
{
    "body": "**Author:** Robert Ma\u0159\u00edk",
    "created_at": "2010-02-28T23:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8390#issuecomment-86950",
    "user": "https://github.com/robert-marik"
}
```

**Author:** Robert Mařík



---

archive/issue_comments_086951.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe patch is attached. Code starts at line 6564. The rest is from reindent.py (I got memory error when testing).\n\nThe patch introduces option to_poly_solve='force'. Perhaps, could be done automatically in future when invcerse trigonometric functions appear. Needs some coding in Lisp and changes in Maxima, see [Maxima forum](http://thread.gmane.org/gmane.comp.mathematics.maxima.general/29966/focus=29974).",
    "created_at": "2010-02-28T23:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8390#issuecomment-86951",
    "user": "https://github.com/robert-marik"
}
```

<a id='comment:5'></a>
The patch is attached. Code starts at line 6564. The rest is from reindent.py (I got memory error when testing).

The patch introduces option to_poly_solve='force'. Perhaps, could be done automatically in future when invcerse trigonometric functions appear. Needs some coding in Lisp and changes in Maxima, see [Maxima forum](http://thread.gmane.org/gmane.comp.mathematics.maxima.general/29966/focus=29974).



---

archive/attachments_010429.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac-8390.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket8390/trac-8390.patch",
    "created_at": "2010-04-06T20:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8390",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/robert-marik"
}
```



---

archive/issue_comments_086952.json:
```json
{
    "body": "rebased for Sage 4.3.5",
    "created_at": "2010-04-06T20:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8390#issuecomment-86952",
    "user": "https://github.com/robert-marik"
}
```

rebased for Sage 4.3.5



---

archive/issue_comments_086953.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2010-04-07T14:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8390#issuecomment-86953",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_024539.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-04-07T14:07:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/8390",
    "milestone": "sage-4.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8390#event-24539"
}
```



---

archive/issue_comments_086954.json:
```json
{
    "body": "<a id='comment:6'></a>\nThe code looks fine to me. I agree that the interface is not so elegant, since it's somewhat tied to Maxima, and it's uncomfortable to have an input (to_poly_solve) be either bool or string.  However, I can't really think of anything better given the design decisions we've already made. \n\nAll tests pass.",
    "created_at": "2010-04-07T14:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8390#issuecomment-86954",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:6'></a>
The code looks fine to me. I agree that the interface is not so elegant, since it's somewhat tied to Maxima, and it's uncomfortable to have an input (to_poly_solve) be either bool or string.  However, I can't really think of anything better given the design decisions we've already made. 

All tests pass.



---

archive/issue_comments_086955.json:
```json
{
    "body": "<a id='comment:7'></a>\nMerged trac-8390.patch in 4.4.alpha0",
    "created_at": "2010-04-15T20:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8390#issuecomment-86955",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>
Merged trac-8390.patch in 4.4.alpha0



---

archive/issue_events_024540.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-04-15T20:11:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/8390",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/8390#event-24540"
}
```



---

archive/issue_comments_086956.json:
```json
{
    "body": "**Reviewer:** William Stein",
    "created_at": "2010-04-15T20:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8390#issuecomment-86956",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** William Stein



---

archive/issue_comments_086957.json:
```json
{
    "body": "**Merged:** sage-4.4.alpha0",
    "created_at": "2010-04-15T20:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/8390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/8390#issuecomment-86957",
    "user": "https://github.com/jhpalmieri"
}
```

**Merged:** sage-4.4.alpha0
