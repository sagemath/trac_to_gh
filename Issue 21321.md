# Issue 21321: IPython 5 / python-prompt-toolkit not usable on dumb terminals (inside Emacs comint)

Issue created by migration from Trac.

Original creator: mkoeppe

Original creation time: 2016-09-21 22:57:30

CC:  darthandrus@gmail.com jsrn vbraun dimpase fbissey charpent stakemori novoselt jhpalmieri

This ticket tracks on our side the following issues:

- IPython: â€‹https://github.com/ipython/ipython/issues/9886
- python-prompt-toolkit: https://github.com/jonathanslenders/python-prompt-toolkit/issues/390

These issues cause sage-mode to fail (#21227). 



---

Comment by mkoeppe created at 2020-01-16 00:10:28

Upstream is now working on a fix: https://github.com/prompt-toolkit/python-prompt-toolkit/pull/1035


---

Comment by mkoeppe created at 2020-02-02 13:32:35

A fix has been merged into `prompt-toolkit` master.


---

Comment by mkoeppe created at 2020-02-02 13:51:00

It appears to be in the 3.0.3 release. The 3.x releases are python3 only. Sage currently uses IPython 5, which is using prompt-toolkit 1.x.


---

Comment by mkoeppe created at 2020-08-12 06:25:57

After #28197, we have prompt-toolkit 3.0.3. Something has changed, but `TERM=dumb ./sage` now has strange echo behavior.

This is not very important for us any more after #25363 (`--simple-prompt`), noting that the shortcomings of simple-prompt pointed out in https://github.com/prompt-toolkit/python-prompt-toolkit/issues/390#issuecomment-246825655 have been fixed.
