# Issue 24080: Improve conversion of inexact symbolic values

archive/issues_024080.json:
```json
{
    "body": "Because there is no conversion implemented between some fields this ticket adds fallback code that goes through a RR/CC intermediate. Example:\n\n```\nsage: SR(CBF(1+I))._convert(CDF)\n...\nAttributeError: 'PolynomialRing_field_with_category' object has no attribute 'complex_field'\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24317\n\n",
    "created_at": "2017-12-03T15:26:47Z",
    "labels": [
        "symbolics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Improve conversion of inexact symbolic values",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24080",
    "user": "@rwst"
}
```
Because there is no conversion implemented between some fields this ticket adds fallback code that goes through a RR/CC intermediate. Example:

```
sage: SR(CBF(1+I))._convert(CDF)
...
AttributeError: 'PolynomialRing_field_with_category' object has no attribute 'complex_field'
```


Issue created by migration from https://trac.sagemath.org/ticket/24317





---

archive/issue_comments_337501.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-12-03T15:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24080#issuecomment-337501",
    "user": "@rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_337502.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-12-03T15:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24080#issuecomment-337502",
    "user": "@rwst"
}
```

New commits:



---

archive/issue_comments_337503.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-04T06:40:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24080#issuecomment-337503",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_337504.json:
```json
{
    "body": "It is not the role of the symbolic ring to decide which conversion should exist. Concerning the example provided, the only reasonable way to go is to improve `CBF` (see #24318).",
    "created_at": "2017-12-04T08:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24080#issuecomment-337504",
    "user": "@videlec"
}
```

It is not the role of the symbolic ring to decide which conversion should exist. Concerning the example provided, the only reasonable way to go is to improve `CBF` (see #24318).



---

archive/issue_comments_337505.json:
```json
{
    "body": "Replying to [comment:5 vdelecroix]:\n> It is not the role of the symbolic ring to decide which conversion should exist. Concerning the example provided, the only reasonable way to go is to improve `CBF` (see #24318).\n\nAh the symbolic ring does not decide that but the symbolic function code has to return the input type, and as long as this can be done with a few lines of code successfully it's certainly better to do so. Moreover this can handle cases that are unknown at the moment.",
    "created_at": "2017-12-04T09:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24080#issuecomment-337505",
    "user": "@rwst"
}
```

Replying to [comment:5 vdelecroix]:
> It is not the role of the symbolic ring to decide which conversion should exist. Concerning the example provided, the only reasonable way to go is to improve `CBF` (see #24318).

Ah the symbolic ring does not decide that but the symbolic function code has to return the input type, and as long as this can be done with a few lines of code successfully it's certainly better to do so. Moreover this can handle cases that are unknown at the moment.



---

archive/issue_comments_337506.json:
```json
{
    "body": "Your conversion code (when EVER it exists) will be called automatically BTW.",
    "created_at": "2017-12-04T09:45:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24080#issuecomment-337506",
    "user": "@rwst"
}
```

Your conversion code (when EVER it exists) will be called automatically BTW.



---

archive/issue_comments_337507.json:
```json
{
    "body": "Replying to [comment:6 rws]:\n> Replying to [comment:5 vdelecroix]:\n> > It is not the role of the symbolic ring to decide which conversion should exist. Concerning the example provided, the only reasonable way to go is to improve `CBF` (see #24318).\n> \n> Ah the symbolic ring does not decide that but the symbolic function code has to return the input type, and as long as this can be done with a few lines of code successfully it's certainly better to do so.\n\nYou are pretending that it is successful. Conversion is not a trivial task. Going through an intermediate ring is not innocent (especially with floating point).\n\n> Moreover this can handle cases that are unknown at the moment.\n\nFor me it is: this proposal is hiding missing conversions that will remain unknown.\n\n\nAgain: the aim of the symbolic ring is not to be better than the rest of Sage. If a conversion does not exist, then it does not exist. It might be a bug, a mistake, but it is not the role of the symbolic ring to complete the conversion.",
    "created_at": "2017-12-04T09:51:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24080#issuecomment-337507",
    "user": "@videlec"
}
```

Replying to [comment:6 rws]:
> Replying to [comment:5 vdelecroix]:
> > It is not the role of the symbolic ring to decide which conversion should exist. Concerning the example provided, the only reasonable way to go is to improve `CBF` (see #24318).
> 
> Ah the symbolic ring does not decide that but the symbolic function code has to return the input type, and as long as this can be done with a few lines of code successfully it's certainly better to do so.

You are pretending that it is successful. Conversion is not a trivial task. Going through an intermediate ring is not innocent (especially with floating point).

> Moreover this can handle cases that are unknown at the moment.

For me it is: this proposal is hiding missing conversions that will remain unknown.


Again: the aim of the symbolic ring is not to be better than the rest of Sage. If a conversion does not exist, then it does not exist. It might be a bug, a mistake, but it is not the role of the symbolic ring to complete the conversion.



---

archive/issue_comments_337508.json:
```json
{
    "body": "At least, the doctest mentioned in the ticket description should be solved by #24318 that is in needs review.",
    "created_at": "2017-12-04T10:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24080#issuecomment-337508",
    "user": "@videlec"
}
```

At least, the doctest mentioned in the ticket description should be solved by #24318 that is in needs review.



---

archive/issue_comments_337509.json:
```json
{
    "body": "Okay, I tested #24318 and it works. This ticket should then add these doctests to `ex._convert`:\n\n```\nsage: SR(RBF(1))._convert({'parent':RDF})\n1.0\nsage: SR(CBF(1))._convert({'parent':RDF})\n1.0\nsage: type(_.pyobject())\n<type 'sage.rings.real_double.RealDoubleElement'>\nsage: SR(CBF(1+I))._convert({'parent':RDF})\n1.0 + 1.0*I\nsage: type(_.pyobject())\n<type 'sage.rings.complex_double.ComplexDoubleElement'>\nsage: SR(CBF(1+I))._convert({'parent':CDF})\n1.0 + 1.0*I\n```\n",
    "created_at": "2017-12-04T14:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24080#issuecomment-337509",
    "user": "@rwst"
}
```

Okay, I tested #24318 and it works. This ticket should then add these doctests to `ex._convert`:

```
sage: SR(RBF(1))._convert({'parent':RDF})
1.0
sage: SR(CBF(1))._convert({'parent':RDF})
1.0
sage: type(_.pyobject())
<type 'sage.rings.real_double.RealDoubleElement'>
sage: SR(CBF(1+I))._convert({'parent':RDF})
1.0 + 1.0*I
sage: type(_.pyobject())
<type 'sage.rings.complex_double.ComplexDoubleElement'>
sage: SR(CBF(1+I))._convert({'parent':CDF})
1.0 + 1.0*I
```




---

archive/issue_comments_337510.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-12-04T15:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24080#issuecomment-337510",
    "user": "@rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_337511.json:
```json
{
    "body": "#24318 gets merged in 8.2.beta0",
    "created_at": "2017-12-13T23:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24080#issuecomment-337511",
    "user": "@videlec"
}
```

#24318 gets merged in 8.2.beta0



---

archive/issue_comments_337512.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-12-14T07:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24080#issuecomment-337512",
    "user": "@rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_337513.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-12-14T07:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24080#issuecomment-337513",
    "user": "@rwst"
}
```

New commits:



---

archive/issue_comments_337514.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-01-24T01:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24080#issuecomment-337514",
    "user": "@DaveWitteMorris"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_337515.json:
```json
{
    "body": "The PR just adds some doctests (and makes minor formatting corrections).",
    "created_at": "2021-01-24T01:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24080#issuecomment-337515",
    "user": "@DaveWitteMorris"
}
```

The PR just adds some doctests (and makes minor formatting corrections).



---

archive/issue_comments_337516.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2021-01-24T01:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24080#issuecomment-337516",
    "user": "@DaveWitteMorris"
}
```

Changing priority from major to minor.



---

archive/issue_comments_337517.json:
```json
{
    "body": "Changing type from defect to enhancement.",
    "created_at": "2021-01-24T01:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24080#issuecomment-337517",
    "user": "@DaveWitteMorris"
}
```

Changing type from defect to enhancement.



---

archive/issue_comments_337518.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-01-31T20:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24080#issuecomment-337518",
    "user": "@vbraun"
}
```

Resolution: fixed
