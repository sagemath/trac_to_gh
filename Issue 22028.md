# Issue 22028: Fix Dynatomic Polynomials

archive/issues_022028.json:
```json
{
    "body": "CC:  ben hutz\n\nNeed to add NotImplementedError to try/except in homogenize in affine_morphism.\nNeed to fix dynatomic error that returns wrong parent in projective_morphsim.\nCurrent examples of failure:\n\n```\n  R.<c>=QQ[]\nA.<z>=AffineSpace(R,1)\nH=End(A)\nf=H([z^2+c])\nf.dynatomic_polynomial([1,2])\n```\n\n\n```\nR.<c>=QQ[]\nP.<x,y>=ProjectiveSpace(R,1)\nH=End(P)\nf=H([x^2+c*y^2,y^2])\nf.dynatomic_polynomial([1,2]).parent()\n```\n\n\n```\nR.<c>=QQ[]\nP.<x,y>=ProjectiveSpace(ZZ,1)\nH=End(P)\nf=H([x^2+y^2,(1)*y^2 + (1)*x*y])\nf.dynatomic_polynomial([1,2]).parent()\n```\n\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/22265\n\n",
    "created_at": "2017-01-27T19:42:59Z",
    "labels": [
        "component: algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Fix Dynatomic Polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22028",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```
CC:  ben hutz

Need to add NotImplementedError to try/except in homogenize in affine_morphism.
Need to fix dynatomic error that returns wrong parent in projective_morphsim.
Current examples of failure:

```
  R.<c>=QQ[]
A.<z>=AffineSpace(R,1)
H=End(A)
f=H([z^2+c])
f.dynatomic_polynomial([1,2])
```


```
R.<c>=QQ[]
P.<x,y>=ProjectiveSpace(R,1)
H=End(P)
f=H([x^2+c*y^2,y^2])
f.dynatomic_polynomial([1,2]).parent()
```


```
R.<c>=QQ[]
P.<x,y>=ProjectiveSpace(ZZ,1)
H=End(P)
f=H([x^2+y^2,(1)*y^2 + (1)*x*y])
f.dynatomic_polynomial([1,2]).parent()
```




Issue created by migration from https://trac.sagemath.org/ticket/22265





---

archive/issue_comments_305803.json:
```json
{
    "body": "Another failure as of 7.6.beta2\n\n\n```\nsage: P.<x,y> = ProjectiveSpace(CC, 1)\nsage: H = Hom(P,P)\nsage: f = H([x^2-CC.0/3*y^2, y^2])\nsage: f.dynatomic_polynomial(2)\n```\n\n\nthis is line 853 in the projective_morphism.py file. The expected value is also wrong.",
    "created_at": "2017-02-02T22:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22028#issuecomment-305803",
    "user": "https://github.com/bhutz"
}
```

Another failure as of 7.6.beta2


```
sage: P.<x,y> = ProjectiveSpace(CC, 1)
sage: H = Hom(P,P)
sage: f = H([x^2-CC.0/3*y^2, y^2])
sage: f.dynatomic_polynomial(2)
```


this is line 853 in the projective_morphism.py file. The expected value is also wrong.



---

archive/issue_comments_305804.json:
```json
{
    "body": "What is happening in that example is that the quo_rem fails to return a nonzero reminder, so then maxima is tried. The division in maxima (line 964) is not checked to see if the remainder is zero (which it is not).\n\nThis example is unable to be exactly divided, so it should return the rational function.",
    "created_at": "2017-02-02T23:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22028#issuecomment-305804",
    "user": "https://github.com/bhutz"
}
```

What is happening in that example is that the quo_rem fails to return a nonzero reminder, so then maxima is tried. The division in maxima (line 964) is not checked to see if the remainder is zero (which it is not).

This example is unable to be exactly divided, so it should return the rational function.



---

archive/issue_comments_305805.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-02-09T19:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22028#issuecomment-305805",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

New commits:



---

archive/issue_comments_305806.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-02-09T19:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22028#issuecomment-305806",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_305807.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-02-13T16:33:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22028#issuecomment-305807",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_305808.json:
```json
{
    "body": "Both examples where the base ring is a polynomial ring still do not work.\n\nThe example you added with\n\n\n```\nf.dynatomic_polynomial([0,1]).parent()\n```\n\n\nis still the m=0 case, which is not what you changed. I would choose a different period for the example.\n\n\nYou need to add some readability spacing such as around = and ==\n\n\nThe complex example is fixed. I think it would be good to also add an example where the division succeeds, CC.0/2 or some other finite decimal expansion.",
    "created_at": "2017-02-13T16:33:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22028#issuecomment-305808",
    "user": "https://github.com/bhutz"
}
```

Both examples where the base ring is a polynomial ring still do not work.

The example you added with


```
f.dynatomic_polynomial([0,1]).parent()
```


is still the m=0 case, which is not what you changed. I would choose a different period for the example.


You need to add some readability spacing such as around = and ==


The complex example is fixed. I think it would be good to also add an example where the division succeeds, CC.0/2 or some other finite decimal expansion.



---

archive/issue_comments_305809.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-19T18:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22028#issuecomment-305809",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305810.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-02-19T18:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22028#issuecomment-305810",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_305811.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-02-20T17:45:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22028#issuecomment-305811",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_305812.json:
```json
{
    "body": "The original failures listed in the ticket now work. However, I found a number of additional examples that fail. Mostly it is for the affine computation, but apparently there is also no input checking done on the `n` parameter in both affine and projective.\n\nNeeds input checking:\n\n```\nP.<x,y> = ProjectiveSpace(ZZ, 1)\nH = Hom(P,P)\nf = H([x^2-5*y^2, y^2])\nD=f.dynatomic_polynomial(-3)\nprint D.parent(),D\nF=f.dehomogenize(1)\nD=F.dynatomic_polynomial(-3)\nD.parent(),D\n```\n\n\n\n```\nP.<x,y> = ProjectiveSpace(ZZ, 1)\nH = Hom(P,P)\nf = H([x^2-5*y^2, y^2])\nD=f.dynatomic_polynomial([1,0])\nprint D.parent(),D\nF=f.dehomogenize(1)\nD=F.dynatomic_polynomial([1,0])\nD.parent(),D\n```\n\n\nOther failures:\n\n```\nR.<x>=QQ[]\nK.<i>=R.quo(x^2+1)\nP.<x,y> = ProjectiveSpace(K, 1)\nH = Hom(P,P)\nf = H([x^2-i/3*y^2, y^2])\nD=f.dynatomic_polynomial([2,1])\nprint D.parent(),D\nF=f.dehomogenize(1)\nD=F.dynatomic_polynomial([2,1])\nD.parent(),D\nTraceback (click to the left of this block for traceback)\n...\nTypeError: lift() takes exactly 2 arguments (1 given)\n```\n\n\n\n```\nP.<x,y> = ProjectiveSpace(Zp(3), 1)\nH = Hom(P,P)\nf = H([x^2-5*y^2, y^2])\nD=f.dynatomic_polynomial([1,2])\nprint D.parent(),D\nF=f.dehomogenize(1)\nD=F.dynatomic_polynomial([1,2])\nD.parent(),D\nTraceback (click to the left of this block for traceback)\n...\nTypeError: not a constant polynomial\n```\n\n\n\n\n```\nR.<c,d>=QQbar[]\nP.<x,y>=ProjectiveSpace(R,1)\nH=End(P)\nf=H([x^2+c*y^2,d*y^2])\nD=f.dynatomic_polynomial([1,2])\nprint D.parent(),D\nF=f.dehomogenize(1)\nD=F.dynatomic_polynomial([1,2])\nD.parent(),D\nTraceback (click to the left of this block for traceback)\n...\nTypeError: no conversion of this ring to a Singular ring defined\n```\n\n\n\n```\nR.<c,d>=QQbar[]\nP.<x,y>=ProjectiveSpace(QQbar,1)\nH=End(P)\nf=H([x^2+QQbar(sqrt(3))*y^2,2*y^2])\nD=f.dynatomic_polynomial([1,2])\nprint D.parent(),D\nF=f.dehomogenize(1)\nD=F.dynatomic_polynomial([1,2])\nD.parent(),D\nTraceback (click to the left of this block for traceback)\n...\nTypeError: not a constant polynomial\n```\n",
    "created_at": "2017-02-20T17:45:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22028#issuecomment-305812",
    "user": "https://github.com/bhutz"
}
```

The original failures listed in the ticket now work. However, I found a number of additional examples that fail. Mostly it is for the affine computation, but apparently there is also no input checking done on the `n` parameter in both affine and projective.

Needs input checking:

```
P.<x,y> = ProjectiveSpace(ZZ, 1)
H = Hom(P,P)
f = H([x^2-5*y^2, y^2])
D=f.dynatomic_polynomial(-3)
print D.parent(),D
F=f.dehomogenize(1)
D=F.dynatomic_polynomial(-3)
D.parent(),D
```



```
P.<x,y> = ProjectiveSpace(ZZ, 1)
H = Hom(P,P)
f = H([x^2-5*y^2, y^2])
D=f.dynatomic_polynomial([1,0])
print D.parent(),D
F=f.dehomogenize(1)
D=F.dynatomic_polynomial([1,0])
D.parent(),D
```


Other failures:

```
R.<x>=QQ[]
K.<i>=R.quo(x^2+1)
P.<x,y> = ProjectiveSpace(K, 1)
H = Hom(P,P)
f = H([x^2-i/3*y^2, y^2])
D=f.dynatomic_polynomial([2,1])
print D.parent(),D
F=f.dehomogenize(1)
D=F.dynatomic_polynomial([2,1])
D.parent(),D
Traceback (click to the left of this block for traceback)
...
TypeError: lift() takes exactly 2 arguments (1 given)
```



```
P.<x,y> = ProjectiveSpace(Zp(3), 1)
H = Hom(P,P)
f = H([x^2-5*y^2, y^2])
D=f.dynatomic_polynomial([1,2])
print D.parent(),D
F=f.dehomogenize(1)
D=F.dynatomic_polynomial([1,2])
D.parent(),D
Traceback (click to the left of this block for traceback)
...
TypeError: not a constant polynomial
```




```
R.<c,d>=QQbar[]
P.<x,y>=ProjectiveSpace(R,1)
H=End(P)
f=H([x^2+c*y^2,d*y^2])
D=f.dynatomic_polynomial([1,2])
print D.parent(),D
F=f.dehomogenize(1)
D=F.dynatomic_polynomial([1,2])
D.parent(),D
Traceback (click to the left of this block for traceback)
...
TypeError: no conversion of this ring to a Singular ring defined
```



```
R.<c,d>=QQbar[]
P.<x,y>=ProjectiveSpace(QQbar,1)
H=End(P)
f=H([x^2+QQbar(sqrt(3))*y^2,2*y^2])
D=f.dynatomic_polynomial([1,2])
print D.parent(),D
F=f.dehomogenize(1)
D=F.dynatomic_polynomial([1,2])
D.parent(),D
Traceback (click to the left of this block for traceback)
...
TypeError: not a constant polynomial
```




---

archive/issue_comments_305813.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-22T17:15:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22028#issuecomment-305813",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305814.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-02-22T17:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22028#issuecomment-305814",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_305815.json:
```json
{
    "body": "Looks like these are all fixed except the input checking. The following should also be returning `0`\n\n\n```\nP.<x,y> = ProjectiveSpace(ZZ, 1)\nH = Hom(P,P)\nf = H([x^2-5*y^2, y^2])\nf.dynatomic_polynomial([3,0])\n```\n",
    "created_at": "2017-02-24T18:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22028#issuecomment-305815",
    "user": "https://github.com/bhutz"
}
```

Looks like these are all fixed except the input checking. The following should also be returning `0`


```
P.<x,y> = ProjectiveSpace(ZZ, 1)
H = Hom(P,P)
f = H([x^2-5*y^2, y^2])
f.dynatomic_polynomial([3,0])
```




---

archive/issue_comments_305816.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-02-24T18:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22028#issuecomment-305816",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_305817.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-24T18:23:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22028#issuecomment-305817",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305818.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-02-24T18:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22028#issuecomment-305818",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_305819.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-24T18:40:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22028#issuecomment-305819",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305820.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-24T18:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22028#issuecomment-305820",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_305821.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-03-01T18:50:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22028#issuecomment-305821",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
