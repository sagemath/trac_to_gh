# Issue 22028: Fix Dynatomic Polynomials

Issue created by migration from Trac.

Original creator: rlmiller

Original creation time: 2017-01-27 19:42:59

CC:  ben hutz

Need to add NotImplementedError to try/except in homogenize in affine_morphism.
Need to fix dynatomic error that returns wrong parent in projective_morphsim.
Current examples of failure:

```
  R.<c>=QQ[]
A.<z>=AffineSpace(R,1)
H=End(A)
f=H([z^2+c])
f.dynatomic_polynomial([1,2])
```


```
R.<c>=QQ[]
P.<x,y>=ProjectiveSpace(R,1)
H=End(P)
f=H([x^2+c*y^2,y^2])
f.dynatomic_polynomial([1,2]).parent()
```


```
R.<c>=QQ[]
P.<x,y>=ProjectiveSpace(ZZ,1)
H=End(P)
f=H([x^2+y^2,(1)*y^2 + (1)*x*y])
f.dynatomic_polynomial([1,2]).parent()
```





---

Comment by bhutz created at 2017-02-02 22:44:14

Another failure as of 7.6.beta2


```
sage: P.<x,y> = ProjectiveSpace(CC, 1)
sage: H = Hom(P,P)
sage: f = H([x^2-CC.0/3*y^2, y^2])
sage: f.dynatomic_polynomial(2)
```


this is line 853 in the projective_morphism.py file. The expected value is also wrong.


---

Comment by bhutz created at 2017-02-02 23:00:37

What is happening in that example is that the quo_rem fails to return a nonzero reminder, so then maxima is tried. The division in maxima (line 964) is not checked to see if the remainder is zero (which it is not).

This example is unable to be exactly divided, so it should return the rational function.


---

Comment by rlmiller created at 2017-02-09 19:28:02

New commits:


---

Comment by rlmiller created at 2017-02-09 19:28:02

Changing status from new to needs_review.


---

Comment by bhutz created at 2017-02-13 16:33:21

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2017-02-13 16:33:21

Both examples where the base ring is a polynomial ring still do not work.

The example you added with


```
f.dynatomic_polynomial([0,1]).parent()
```


is still the m=0 case, which is not what you changed. I would choose a different period for the example.


You need to add some readability spacing such as around = and ==


The complex example is fixed. I think it would be good to also add an example where the division succeeds, CC.0/2 or some other finite decimal expansion.


---

Comment by git created at 2017-02-19 18:27:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rlmiller created at 2017-02-19 18:28:40

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2017-02-20 17:45:57

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2017-02-20 17:45:57

The original failures listed in the ticket now work. However, I found a number of additional examples that fail. Mostly it is for the affine computation, but apparently there is also no input checking done on the `n` parameter in both affine and projective.

Needs input checking:

```
P.<x,y> = ProjectiveSpace(ZZ, 1)
H = Hom(P,P)
f = H([x^2-5*y^2, y^2])
D=f.dynatomic_polynomial(-3)
print D.parent(),D
F=f.dehomogenize(1)
D=F.dynatomic_polynomial(-3)
D.parent(),D
```



```
P.<x,y> = ProjectiveSpace(ZZ, 1)
H = Hom(P,P)
f = H([x^2-5*y^2, y^2])
D=f.dynatomic_polynomial([1,0])
print D.parent(),D
F=f.dehomogenize(1)
D=F.dynatomic_polynomial([1,0])
D.parent(),D
```


Other failures:

```
R.<x>=QQ[]
K.<i>=R.quo(x^2+1)
P.<x,y> = ProjectiveSpace(K, 1)
H = Hom(P,P)
f = H([x^2-i/3*y^2, y^2])
D=f.dynatomic_polynomial([2,1])
print D.parent(),D
F=f.dehomogenize(1)
D=F.dynatomic_polynomial([2,1])
D.parent(),D
Traceback (click to the left of this block for traceback)
...
TypeError: lift() takes exactly 2 arguments (1 given)
```



```
P.<x,y> = ProjectiveSpace(Zp(3), 1)
H = Hom(P,P)
f = H([x^2-5*y^2, y^2])
D=f.dynatomic_polynomial([1,2])
print D.parent(),D
F=f.dehomogenize(1)
D=F.dynatomic_polynomial([1,2])
D.parent(),D
Traceback (click to the left of this block for traceback)
...
TypeError: not a constant polynomial
```




```
R.<c,d>=QQbar[]
P.<x,y>=ProjectiveSpace(R,1)
H=End(P)
f=H([x^2+c*y^2,d*y^2])
D=f.dynatomic_polynomial([1,2])
print D.parent(),D
F=f.dehomogenize(1)
D=F.dynatomic_polynomial([1,2])
D.parent(),D
Traceback (click to the left of this block for traceback)
...
TypeError: no conversion of this ring to a Singular ring defined
```



```
R.<c,d>=QQbar[]
P.<x,y>=ProjectiveSpace(QQbar,1)
H=End(P)
f=H([x^2+QQbar(sqrt(3))*y^2,2*y^2])
D=f.dynatomic_polynomial([1,2])
print D.parent(),D
F=f.dehomogenize(1)
D=F.dynatomic_polynomial([1,2])
D.parent(),D
Traceback (click to the left of this block for traceback)
...
TypeError: not a constant polynomial
```



---

Comment by git created at 2017-02-22 17:15:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rlmiller created at 2017-02-22 17:15:53

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2017-02-24 18:06:30

Looks like these are all fixed except the input checking. The following should also be returning `0`


```
P.<x,y> = ProjectiveSpace(ZZ, 1)
H = Hom(P,P)
f = H([x^2-5*y^2, y^2])
f.dynatomic_polynomial([3,0])
```



---

Comment by bhutz created at 2017-02-24 18:06:30

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-02-24 18:23:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rlmiller created at 2017-02-24 18:24:22

Changing status from needs_work to needs_review.


---

Comment by git created at 2017-02-24 18:40:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2017-02-24 18:43:37

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-03-01 18:50:52

Resolution: fixed
