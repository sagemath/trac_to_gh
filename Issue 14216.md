# Issue 14216: Compositions with min_part=0 induces OOM

Issue created by migration from https://trac.sagemath.org/ticket/14420

Original creator: ppurka

Original creation time: 2013-04-06 10:27:58

Assignee: sage-combinat

CC:  nthiery

Try the following after setting your ulimit

```
$ ulimit -v 2000000 # 2G max of virtual memory
$ sage
...
sage: Compositions(2, min_part=0).list()
...
MemoryError:
```

I suspect the Compositions code goes into an infinite recursion or something which eats up all the memory on the system.

This memory error can be easily avoided by checking that the `length` keyword is nonempty or that the `max_length` (or `outer` -- it seems to affect the max length) is set by the user.


---

Comment by hivert created at 2013-04-06 10:35:27

You are actually asking for an infinite list:

```
sage: l = Compositions(2, min_part=0)
/home/data/Sage-Install/sage-5.8/local/lib/python2.7/site-packages/sage/combinat/composition.py:1036: RuntimeWarning: Currently, setting min_part=0 produces Composition objects which violate internal assumptions.  Calling methods on these objects may produce errors or WRONG results!
  warn("Currently, setting min_part=0 produces Composition objects which violate internal assumptions.  Calling methods on these objects may produce errors or WRONG results!", RuntimeWarning)
sage: it = iter(l)
sage: it.next()
[2]
sage: it.next()
[1, 1]
sage: it.next()
[1, 0, 1]
sage: it.next()
[1, 0, 0, 1]
sage: it.next()
[1, 0, 0, 0, 1]
sage: it.next()
[1, 0, 0, 0, 0, 1]
sage: it.next()
[1, 0, 0, 0, 0, 0, 1]
sage: it.next()
[1, 0, 0, 0, 0, 0, 0, 1]
sage: it.next()
[1, 0, 0, 0, 0, 0, 0, 0, 1]
sage: it.next()
[1, 0, 0, 0, 0, 0, 0, 0, 0, 1]
sage: it.next()
[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
sage: it.next()
[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
sage: it.next()
[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
sage: it.next()
[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
...
```


So what is needed is to detect if the set is finite or not and to set up the proper category `EnumeratedSet.Finite()` or `EnumeratedSet.Infinite()` as in

```
sage: Compositions().list()
[...]
NotImplementedError: infinite list
```


Florent


---

Comment by ppurka created at 2013-04-07 14:53:40

Replying to [comment:2 hivert]:
> You are actually asking for an infinite list:

Indeed. That was what I suspected. What I wanted to point out in this ticket is that it _should be_ easy to detect that the list is infinite - just check for the value of `max_length` if `min_part=0`. If this case is handled automatically in the code then it will at least prevent Sage from bringing down the whole machine. I was able to kill the process by invoking `SysRq`, but not everyone knows the `SysRq` keycodes.


---

Comment by tscrim created at 2013-04-09 19:22:02

There any many things in sage which go into infinite lists (ex. `Sequence((1..))`, `list(Partitions())`, ...). That aside, you're actually breaking an assumption of `Compositions` by setting `min_part=0`; `IntegerVectors` is what should be used. The documentation for `Compositions` states all of this, but perhaps that could be improved.


---

Comment by ppurka created at 2013-04-13 05:35:37

Shouldn't `IntegerVectors` be called directly from inside `Compositions` if `min_part=0` is passed as an argument? If we already have a solution which can handle this case of `min_part=0`, why are we still providing the big scary warning?

Or, is it the case that `Compositions` is more general than `IntegerVectors`, even if we restrict ourselves to the case `min_part=0`?


---

Comment by tscrim created at 2013-04-13 13:06:07

If it should do anything, it should adjust `min_part` to fit it's own internal assumptions. Nevertheless we still need this mentioned in the doc, but probably not so buried in it. I'm cc-ing Nicolas to get his opinion on this.
