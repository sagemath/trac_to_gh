# Issue 34258: Construction for invariant/equivariant submodules

archive/issues_034258.json:
```json
{
    "body": "CC:  @tscrim @trevorkarn @egourgoulhon @anneschilling\n\nWe introduce a construction functor for invariant and equivariant submodules.\n\n`sage.modules.with_basis.invariant.FiniteDimensionalInvariantModule` gets a `construction` method.\n\nIn a follow-up ticket, also the tensor modules with prescribed monoterm symmetries from #30229 will get a `construction` method. (This will depend on first modeling the group action, see #32029, #30276.)\n\nIssue created by migration from https://trac.sagemath.org/ticket/34495\n\n",
    "created_at": "2022-09-05T16:55:02Z",
    "labels": [
        "component: linear algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Construction for invariant/equivariant submodules",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34258",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @tscrim @trevorkarn @egourgoulhon @anneschilling

We introduce a construction functor for invariant and equivariant submodules.

`sage.modules.with_basis.invariant.FiniteDimensionalInvariantModule` gets a `construction` method.

In a follow-up ticket, also the tensor modules with prescribed monoterm symmetries from #30229 will get a `construction` method. (This will depend on first modeling the group action, see #32029, #30276.)

Issue created by migration from https://trac.sagemath.org/ticket/34495





---

archive/issue_comments_485242.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-05T18:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485242",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485243.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-05T21:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485243",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485244.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-05T21:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485244",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485245.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-05T22:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485245",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485246.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-09-05T22:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485246",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_485247.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-05T22:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485247",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485248.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-05T22:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485248",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485249.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-06T02:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485249",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485250.json:
```json
{
    "body": "Are we sure that the invariant module cannot get bigger when we extend scalars? I think the answer is no because the multiplicity of 1 as a root of the minimal polynomial of the matrix that encodes the group action. What I am worried about is a situation similar to what happens for a C<sub>4</sub> action over **R** versus **C** with the 2 dimensional rotation representation. Do you agree with my reasoning (or have an alternative proof)?\n\nIf you are not expecting this to work with pushouts (at least, this is the only reason I know for having the constructor functors), what is your reasoning for adding the construction functor? It starts feeling like unnecessary weight for the class on its own.\n\nAlso, I am curious what your thoughts are about the OS/OT algebra invariants not having a construction functor. It seems to suggest that the `invariant_module()` hook has a deficiency.",
    "created_at": "2022-09-07T04:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485250",
    "user": "https://github.com/tscrim"
}
```

Are we sure that the invariant module cannot get bigger when we extend scalars? I think the answer is no because the multiplicity of 1 as a root of the minimal polynomial of the matrix that encodes the group action. What I am worried about is a situation similar to what happens for a C<sub>4</sub> action over **R** versus **C** with the 2 dimensional rotation representation. Do you agree with my reasoning (or have an alternative proof)?

If you are not expecting this to work with pushouts (at least, this is the only reason I know for having the constructor functors), what is your reasoning for adding the construction functor? It starts feeling like unnecessary weight for the class on its own.

Also, I am curious what your thoughts are about the OS/OT algebra invariants not having a construction functor. It seems to suggest that the `invariant_module()` hook has a deficiency.



---

archive/issue_comments_485251.json:
```json
{
    "body": "Yes, this is for pushouts.",
    "created_at": "2022-09-07T04:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485251",
    "user": "https://github.com/mkoeppe"
}
```

Yes, this is for pushouts.



---

archive/issue_comments_485252.json:
```json
{
    "body": "Replying to [comment:13 Travis Scrimshaw]:\n> Are we sure that the invariant module cannot get bigger when we extend scalars? \n\nAre you asking why the constructed pushout is a correct pushout? In the end, this will depend on the Action doing the right thing on the elements of the larger module. If it doesn't, then all bets are off.",
    "created_at": "2022-09-07T04:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485252",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:13 Travis Scrimshaw]:
> Are we sure that the invariant module cannot get bigger when we extend scalars? 

Are you asking why the constructed pushout is a correct pushout? In the end, this will depend on the Action doing the right thing on the elements of the larger module. If it doesn't, then all bets are off.



---

archive/issue_comments_485253.json:
```json
{
    "body": "Replying to [comment:15 Matthias K\u00f6ppe]:\n> Replying to [comment:13 Travis Scrimshaw]:\n> > Are we sure that the invariant module cannot get bigger when we extend scalars? \n> \n> Are you asking why the constructed pushout is a correct pushout? In the end, this will depend on the Action doing the right thing on the elements of the larger module. If it doesn't, then all bets are off.\n\nAh, right, because it goes through the hook and doesn\u2019t try to simply change the ring of the class. Perhaps then my question is an optimization one. Can we simply just change the base field (IIRC, it doesn\u2019t work over general commutative rings, maybe not even `ZZ`, but I am not sure offhand) and not go through the (likely expensive) linear algebra computation? Although this creates some issues for subclasses with different construction signatures and forcing things to be overriden\u2026 I am wondering if we can find a good solution to that.",
    "created_at": "2022-09-07T04:57:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485253",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:15 Matthias Köppe]:
> Replying to [comment:13 Travis Scrimshaw]:
> > Are we sure that the invariant module cannot get bigger when we extend scalars? 
> 
> Are you asking why the constructed pushout is a correct pushout? In the end, this will depend on the Action doing the right thing on the elements of the larger module. If it doesn't, then all bets are off.

Ah, right, because it goes through the hook and doesn’t try to simply change the ring of the class. Perhaps then my question is an optimization one. Can we simply just change the base field (IIRC, it doesn’t work over general commutative rings, maybe not even `ZZ`, but I am not sure offhand) and not go through the (likely expensive) linear algebra computation? Although this creates some issues for subclasses with different construction signatures and forcing things to be overriden… I am wondering if we can find a good solution to that.



---

archive/issue_comments_485254.json:
```json
{
    "body": "There will be easy cases and hard cases. \n\nIn my immediate application (#34499), it does not matter because the invariant module is not actually computed using linear algebra.",
    "created_at": "2022-09-07T05:03:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485254",
    "user": "https://github.com/mkoeppe"
}
```

There will be easy cases and hard cases. 

In my immediate application (#34499), it does not matter because the invariant module is not actually computed using linear algebra.



---

archive/issue_comments_485255.json:
```json
{
    "body": "True, and more specific cases (e.g., the `FiniteDimensionalInvariantModule`) could then implement their own version rather than going through the hook. The `invariant_module()` hook might need some more thought at some point about its signature since it was just considered in a more local context.\n\nOnly thing left is the failures in the (graded) free resolutions. I don\u2019t think they are related, but I don\u2019t know what would cause them to fail in general.",
    "created_at": "2022-09-07T05:25:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485255",
    "user": "https://github.com/tscrim"
}
```

True, and more specific cases (e.g., the `FiniteDimensionalInvariantModule`) could then implement their own version rather than going through the hook. The `invariant_module()` hook might need some more thought at some point about its signature since it was just considered in a more local context.

Only thing left is the failures in the (graded) free resolutions. I don’t think they are related, but I don’t know what would cause them to fail in general.



---

archive/issue_comments_485256.json:
```json
{
    "body": "Replying to [comment:18 Travis Scrimshaw]:\n> Only thing left is the failures in the (graded) free resolutions. I don\u2019t think they are related, but I don\u2019t know what would cause them to fail in general.\n\nMaybe just someone's broken patchbot? I don't see these failures in the Build&Test run",
    "created_at": "2022-09-07T05:36:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485256",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:18 Travis Scrimshaw]:
> Only thing left is the failures in the (graded) free resolutions. I don’t think they are related, but I don’t know what would cause them to fail in general.

Maybe just someone's broken patchbot? I don't see these failures in the Build&Test run



---

archive/issue_comments_485257.json:
```json
{
    "body": "I've run it again locally, with `--long`. Can't reproduce these failures in `sage.homology`.",
    "created_at": "2022-09-07T05:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485257",
    "user": "https://github.com/mkoeppe"
}
```

I've run it again locally, with `--long`. Can't reproduce these failures in `sage.homology`.



---

archive/issue_comments_485258.json:
```json
{
    "body": "Then it should be unrelated.",
    "created_at": "2022-09-07T06:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485258",
    "user": "https://github.com/tscrim"
}
```

Then it should be unrelated.



---

archive/issue_comments_485259.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-07T06:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485259",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_485260.json:
```json
{
    "body": "Thanks for the review!",
    "created_at": "2022-09-07T14:52:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485260",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for the review!



---

archive/issue_events_089601.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-09-22T22:35:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34258#event-89601"
}
```



---

archive/issue_comments_485261.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-09-22T22:35:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34258",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34258#issuecomment-485261",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
