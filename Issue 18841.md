# Issue 18841: Finite posets: Faster is_antichain_of_poset()

Issue created by migration from https://trac.sagemath.org/ticket/19078

Original creator: jmantysalo

Original creation time: 2015-08-24 07:41:25

CC:  kdilks

Implementation in the category of posets works but is unoptimal for finite posets. It compares every pair of elements twice, using only `le()` function.


---

Comment by jmantysalo created at 2015-08-24 09:33:56

Changing type from enhancement to defect.


---

Comment by jmantysalo created at 2015-08-24 12:47:28

After `P = Posets.BooleanLattice(10); l = P.level_sets()[5]` this patch reduced time for `P.is_antichain_of_poset(l)` from 642 ms to 558 ms. That is 13% faster.

At the same time the index in `posets.py` can be slightly better, as now both `is_chain_of_poset()` and `is_antichain_of_poset()` are defined in the same file. Also the user will get error message always, if there is an element of `elms` not in the poset.

The code may seem slightly odd, but AFAIK there is no built-in way in Python to get pairs `(a,b)` from list `L` such that `L.index(a) < L.index(b)`. This implementation was fastest I found.

However, I am waiting for #18941 to get accepted (or rejected). Then I'll add this to index of functions. (Assuming that #19061 isn't done yet.)
----
New commits:


---

Comment by git created at 2016-10-24 07:21:28

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jmantysalo created at 2016-10-24 07:22:55

Changing status from new to needs_review.


---

Comment by tscrim created at 2016-10-24 15:10:05

Are you also saying that there is a bug in the category version of `is_antichain_of_poset`? (I think we should also remove the `_of_poset`; it is redundant to have in the method name...)


---

Comment by jmantysalo created at 2016-10-24 18:11:51

Replying to [comment:6 tscrim]:
> Are you also saying that there is a bug in the category version of `is_antichain_of_poset`?

It depends. Do you consider `P.is_antichain_of_poset([2,3,'junk'])` (where `2<3` in the poset) a bug or a good short-circuit evaluation?

> (I think we should also remove the `_of_poset`; it is redundant to have in the method name...)

Nope, we already have `is_chain` and `is_chain_of_poset`. Better to have `is_antichain_of_poset` for symmetry.


---

Comment by jmantysalo created at 2016-11-27 19:36:46

Just pinging.


---

Comment by tscrim created at 2016-12-01 22:16:43

Replying to [comment:7 jmantysalo]:
> Replying to [comment:6 tscrim]:
> > Are you also saying that there is a bug in the category version of `is_antichain_of_poset`?
> 
> It depends. Do you consider `P.is_antichain_of_poset([2,3,'junk'])` (where `2<3` in the poset) a bug or a good short-circuit evaluation?

I would want that to return `False` since that is not an antichain of the poset, but I know some people agree that it would be a bug (see the `is_similar` discussion).

> > (I think we should also remove the `_of_poset`; it is redundant to have in the method name...)
> 
> Nope, we already have `is_chain` and `is_chain_of_poset`. Better to have `is_antichain_of_poset` for symmetry.

Good point, and it already exists in the category.


---

Comment by jmantysalo created at 2016-12-02 07:31:34

Replying to [comment:10 tscrim]:

> > > Are you also saying that there is a bug in the category version of `is_antichain_of_poset`?
> > 
> > It depends. Do you consider `P.is_antichain_of_poset([2,3,'junk'])` (where `2<3` in the poset) a bug or a good short-circuit evaluation?
> 
> I would want that to return `False` since that is not an antichain of the poset, but I know some people agree that it would be a bug (see the `is_similar` discussion).

At least then `P.is_antichain_of_poset(['junk',2,3])` should also return `False`, not raise an exception. And for example `is_induced_subposet()` raises exception in similar situation.

I guess for this one we have no common view and so this can be closed as _wontfix_, but I'll wait for a week or two if others have more opinions.


---

Comment by tscrim created at 2016-12-02 15:14:46

Ah, I see what you mean by short-circuit now. I think the bet behavior going forward is to catch this exception and return `False`. We can change the behavior of this function and/or `is_induced_subposet` to make things more globally consistent on a separate ticket. At least this will make `is_antichain_of_poset` locally consistent.

Also, we definitely do not want this to be a _wontfix_ because there is a definite improvement in the speed.


---

Comment by jmantysalo created at 2016-12-04 07:54:09

Replying to [comment:12 tscrim]:
> I think the bet behavior going forward is to catch this exception and return `False`. We can change the behavior of this function and/or `is_induced_subposet` to make things more globally consistent on a separate ticket.

We have a clear disagreement here. I want to change this to be like `is_induced_subposet`, you want just the opposite.

I'll write to sage-devel.

> Also, we definitely do not want this to be a _wontfix_ because there is a definite improvement in the speed.

OK. It's not actually very big, as even the current version is fast.


---

Comment by jmantysalo created at 2016-12-04 09:23:58

Changing status from needs_review to needs_info.


---

Comment by jmantysalo created at 2016-12-12 20:14:52

Replying to [comment:13 jmantysalo]:

> I'll write to sage-devel.

This done, but we got only one answer. It voted for raising an exception. Should we proceed with that ("vote" 2-1), or ask for more opinions?


---

Comment by tscrim created at 2016-12-12 22:54:18

I can deal with it raising an exception, but note it will also slow things down for shortcut failures as it must check that every input object is equal to something in the poset.


---

Comment by git created at 2016-12-14 11:17:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2016-12-14 12:04:10

Replying to [comment:16 tscrim]:
> I can deal with it raising an exception, but note it will also slow things down for shortcut failures as it must check that every input object is equal to something in the poset.

True, but other possibility is worst, as it can pass some errors unnoticed.

I rebased this, ready for review.


---

Comment by jmantysalo created at 2016-12-14 12:04:10

Changing status from needs_info to needs_review.


---

Comment by tscrim created at 2016-12-14 15:32:35

For the record, I only believe it may sometimes be a logical error.

However, I'm setting this to a positive review because the speed improvements are good.


---

Comment by tscrim created at 2016-12-14 15:32:35

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-12-18 23:17:27

Resolution: fixed
