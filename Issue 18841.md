# Issue 18841: Finite posets: Faster is_antichain_of_poset()

archive/issues_018841.json:
```json
{
    "body": "CC:  @kevindilks\n\nImplementation in the category of posets works but is unoptimal for finite posets. It compares every pair of elements twice, using only `le()` function.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19078\n\n",
    "created_at": "2015-08-24T07:41:25Z",
    "labels": [
        "component: combinatorics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Finite posets: Faster is_antichain_of_poset()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18841",
    "user": "https://github.com/jm58660"
}
```
CC:  @kevindilks

Implementation in the category of posets works but is unoptimal for finite posets. It compares every pair of elements twice, using only `le()` function.

Issue created by migration from https://trac.sagemath.org/ticket/19078





---

archive/issue_comments_257478.json:
```json
{
    "body": "Changing type from enhancement to defect.",
    "created_at": "2015-08-24T09:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257478",
    "user": "https://github.com/jm58660"
}
```

Changing type from enhancement to defect.



---

archive/issue_comments_257479.json:
```json
{
    "body": "After `P = Posets.BooleanLattice(10); l = P.level_sets()[5]` this patch reduced time for `P.is_antichain_of_poset(l)` from 642 ms to 558 ms. That is 13% faster.\n\nAt the same time the index in `posets.py` can be slightly better, as now both `is_chain_of_poset()` and `is_antichain_of_poset()` are defined in the same file. Also the user will get error message always, if there is an element of `elms` not in the poset.\n\nThe code may seem slightly odd, but AFAIK there is no built-in way in Python to get pairs `(a,b)` from list `L` such that `L.index(a) < L.index(b)`. This implementation was fastest I found.\n\nHowever, I am waiting for #18941 to get accepted (or rejected). Then I'll add this to index of functions. (Assuming that #19061 isn't done yet.)\n----\nNew commits:",
    "created_at": "2015-08-24T12:47:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257479",
    "user": "https://github.com/jm58660"
}
```

After `P = Posets.BooleanLattice(10); l = P.level_sets()[5]` this patch reduced time for `P.is_antichain_of_poset(l)` from 642 ms to 558 ms. That is 13% faster.

At the same time the index in `posets.py` can be slightly better, as now both `is_chain_of_poset()` and `is_antichain_of_poset()` are defined in the same file. Also the user will get error message always, if there is an element of `elms` not in the poset.

The code may seem slightly odd, but AFAIK there is no built-in way in Python to get pairs `(a,b)` from list `L` such that `L.index(a) < L.index(b)`. This implementation was fastest I found.

However, I am waiting for #18941 to get accepted (or rejected). Then I'll add this to index of functions. (Assuming that #19061 isn't done yet.)
----
New commits:



---

archive/issue_comments_257480.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-10-24T07:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257480",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_257481.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-10-24T07:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257481",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_257482.json:
```json
{
    "body": "Are you also saying that there is a bug in the category version of `is_antichain_of_poset`? (I think we should also remove the `_of_poset`; it is redundant to have in the method name...)",
    "created_at": "2016-10-24T15:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257482",
    "user": "https://github.com/tscrim"
}
```

Are you also saying that there is a bug in the category version of `is_antichain_of_poset`? (I think we should also remove the `_of_poset`; it is redundant to have in the method name...)



---

archive/issue_comments_257483.json:
```json
{
    "body": "Replying to [comment:6 tscrim]:\n> Are you also saying that there is a bug in the category version of `is_antichain_of_poset`?\n\nIt depends. Do you consider `P.is_antichain_of_poset([2,3,'junk'])` (where `2<3` in the poset) a bug or a good short-circuit evaluation?\n\n> (I think we should also remove the `_of_poset`; it is redundant to have in the method name...)\n\nNope, we already have `is_chain` and `is_chain_of_poset`. Better to have `is_antichain_of_poset` for symmetry.",
    "created_at": "2016-10-24T18:11:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257483",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:6 tscrim]:
> Are you also saying that there is a bug in the category version of `is_antichain_of_poset`?

It depends. Do you consider `P.is_antichain_of_poset([2,3,'junk'])` (where `2<3` in the poset) a bug or a good short-circuit evaluation?

> (I think we should also remove the `_of_poset`; it is redundant to have in the method name...)

Nope, we already have `is_chain` and `is_chain_of_poset`. Better to have `is_antichain_of_poset` for symmetry.



---

archive/issue_comments_257484.json:
```json
{
    "body": "Just pinging.",
    "created_at": "2016-11-27T19:36:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257484",
    "user": "https://github.com/jm58660"
}
```

Just pinging.



---

archive/issue_comments_257485.json:
```json
{
    "body": "Replying to [comment:7 jmantysalo]:\n> Replying to [comment:6 tscrim]:\n> > Are you also saying that there is a bug in the category version of `is_antichain_of_poset`?\n> \n> It depends. Do you consider `P.is_antichain_of_poset([2,3,'junk'])` (where `2<3` in the poset) a bug or a good short-circuit evaluation?\n\nI would want that to return `False` since that is not an antichain of the poset, but I know some people agree that it would be a bug (see the `is_similar` discussion).\n\n> > (I think we should also remove the `_of_poset`; it is redundant to have in the method name...)\n> \n> Nope, we already have `is_chain` and `is_chain_of_poset`. Better to have `is_antichain_of_poset` for symmetry.\n\nGood point, and it already exists in the category.",
    "created_at": "2016-12-01T22:16:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257485",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:7 jmantysalo]:
> Replying to [comment:6 tscrim]:
> > Are you also saying that there is a bug in the category version of `is_antichain_of_poset`?
> 
> It depends. Do you consider `P.is_antichain_of_poset([2,3,'junk'])` (where `2<3` in the poset) a bug or a good short-circuit evaluation?

I would want that to return `False` since that is not an antichain of the poset, but I know some people agree that it would be a bug (see the `is_similar` discussion).

> > (I think we should also remove the `_of_poset`; it is redundant to have in the method name...)
> 
> Nope, we already have `is_chain` and `is_chain_of_poset`. Better to have `is_antichain_of_poset` for symmetry.

Good point, and it already exists in the category.



---

archive/issue_comments_257486.json:
```json
{
    "body": "Replying to [comment:10 tscrim]:\n\n> > > Are you also saying that there is a bug in the category version of `is_antichain_of_poset`?\n> > \n> > It depends. Do you consider `P.is_antichain_of_poset([2,3,'junk'])` (where `2<3` in the poset) a bug or a good short-circuit evaluation?\n> \n> I would want that to return `False` since that is not an antichain of the poset, but I know some people agree that it would be a bug (see the `is_similar` discussion).\n\nAt least then `P.is_antichain_of_poset(['junk',2,3])` should also return `False`, not raise an exception. And for example `is_induced_subposet()` raises exception in similar situation.\n\nI guess for this one we have no common view and so this can be closed as *wontfix*, but I'll wait for a week or two if others have more opinions.",
    "created_at": "2016-12-02T07:31:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257486",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:10 tscrim]:

> > > Are you also saying that there is a bug in the category version of `is_antichain_of_poset`?
> > 
> > It depends. Do you consider `P.is_antichain_of_poset([2,3,'junk'])` (where `2<3` in the poset) a bug or a good short-circuit evaluation?
> 
> I would want that to return `False` since that is not an antichain of the poset, but I know some people agree that it would be a bug (see the `is_similar` discussion).

At least then `P.is_antichain_of_poset(['junk',2,3])` should also return `False`, not raise an exception. And for example `is_induced_subposet()` raises exception in similar situation.

I guess for this one we have no common view and so this can be closed as *wontfix*, but I'll wait for a week or two if others have more opinions.



---

archive/issue_comments_257487.json:
```json
{
    "body": "Ah, I see what you mean by short-circuit now. I think the bet behavior going forward is to catch this exception and return `False`. We can change the behavior of this function and/or `is_induced_subposet` to make things more globally consistent on a separate ticket. At least this will make `is_antichain_of_poset` locally consistent.\n\nAlso, we definitely do not want this to be a *wontfix* because there is a definite improvement in the speed.",
    "created_at": "2016-12-02T15:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257487",
    "user": "https://github.com/tscrim"
}
```

Ah, I see what you mean by short-circuit now. I think the bet behavior going forward is to catch this exception and return `False`. We can change the behavior of this function and/or `is_induced_subposet` to make things more globally consistent on a separate ticket. At least this will make `is_antichain_of_poset` locally consistent.

Also, we definitely do not want this to be a *wontfix* because there is a definite improvement in the speed.



---

archive/issue_comments_257488.json:
```json
{
    "body": "Replying to [comment:12 tscrim]:\n> I think the bet behavior going forward is to catch this exception and return `False`. We can change the behavior of this function and/or `is_induced_subposet` to make things more globally consistent on a separate ticket.\n\nWe have a clear disagreement here. I want to change this to be like `is_induced_subposet`, you want just the opposite.\n\nI'll write to sage-devel.\n\n> Also, we definitely do not want this to be a *wontfix* because there is a definite improvement in the speed.\n\nOK. It's not actually very big, as even the current version is fast.",
    "created_at": "2016-12-04T07:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257488",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:12 tscrim]:
> I think the bet behavior going forward is to catch this exception and return `False`. We can change the behavior of this function and/or `is_induced_subposet` to make things more globally consistent on a separate ticket.

We have a clear disagreement here. I want to change this to be like `is_induced_subposet`, you want just the opposite.

I'll write to sage-devel.

> Also, we definitely do not want this to be a *wontfix* because there is a definite improvement in the speed.

OK. It's not actually very big, as even the current version is fast.



---

archive/issue_comments_257489.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2016-12-04T09:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257489",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_257490.json:
```json
{
    "body": "Replying to [comment:13 jmantysalo]:\n\n> I'll write to sage-devel.\n\nThis done, but we got only one answer. It voted for raising an exception. Should we proceed with that (\"vote\" 2-1), or ask for more opinions?",
    "created_at": "2016-12-12T20:14:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257490",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:13 jmantysalo]:

> I'll write to sage-devel.

This done, but we got only one answer. It voted for raising an exception. Should we proceed with that ("vote" 2-1), or ask for more opinions?



---

archive/issue_comments_257491.json:
```json
{
    "body": "I can deal with it raising an exception, but note it will also slow things down for shortcut failures as it must check that every input object is equal to something in the poset.",
    "created_at": "2016-12-12T22:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257491",
    "user": "https://github.com/tscrim"
}
```

I can deal with it raising an exception, but note it will also slow things down for shortcut failures as it must check that every input object is equal to something in the poset.



---

archive/issue_comments_257492.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-14T11:17:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257492",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_257493.json:
```json
{
    "body": "Replying to [comment:16 tscrim]:\n> I can deal with it raising an exception, but note it will also slow things down for shortcut failures as it must check that every input object is equal to something in the poset.\n\nTrue, but other possibility is worst, as it can pass some errors unnoticed.\n\nI rebased this, ready for review.",
    "created_at": "2016-12-14T12:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257493",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:16 tscrim]:
> I can deal with it raising an exception, but note it will also slow things down for shortcut failures as it must check that every input object is equal to something in the poset.

True, but other possibility is worst, as it can pass some errors unnoticed.

I rebased this, ready for review.



---

archive/issue_comments_257494.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-12-14T12:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257494",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_257495.json:
```json
{
    "body": "For the record, I only believe it may sometimes be a logical error.\n\nHowever, I'm setting this to a positive review because the speed improvements are good.",
    "created_at": "2016-12-14T15:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257495",
    "user": "https://github.com/tscrim"
}
```

For the record, I only believe it may sometimes be a logical error.

However, I'm setting this to a positive review because the speed improvements are good.



---

archive/issue_comments_257496.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-12-14T15:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257496",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_257497.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-12-18T23:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18841#issuecomment-257497",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
