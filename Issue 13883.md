# Issue 13883: inconsistent input handling of backslash operator of matrices

Issue created by migration from Trac.

Original creator: ppurka

Original creation time: 2013-02-09 14:59:17

Assignee: jason, was

CC:  rbeezer kcrisman

From [this ask.sagemath question](http://ask.sagemath.org/question/2231/backslash-operator-on-rdf-matrices):

```
sage: A = matrix(QQ, 3, [1,2,4,2,3,1,0,1,2])
sage: B = matrix(QQ, 3, 2, [1,7,5,2,1,3])
sage: A\B
[  -1    1]
[13/5 -3/5]
[-4/5  9/5]
sage: A = matrix(RDF, 3, [1,2,4,2,3,1,0,1,2])
sage: B = matrix(RDF, 3, 2, [1,7,5,2,1,3])
sage: A\B
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: vector of constants over Real Double Field incompatible with matrix over Real Double Field
```

Paraphrasing from my reply there:

The problem arises because when A is a matrix over QQ and when A is a matrix over RDF, you will find that the former allows B to be a matrix, but the latter does not. Only vectors are supported/implemented for RDF fields. As such it is not a bug, but I think this should raise a `NotImplementedError` when a matrix B is used over RDF A.


---

Attachment


---

Comment by jason created at 2013-02-12 09:43:46

The problem is that there is too much and too restrictive "error" handling, when really no error is necessary.  I've attached a preliminary patch, but lots of the doctests will fail that check the error messages.  Also, 0-column/row matrices probably aren't handled nicely.


---

Comment by ppurka created at 2013-02-12 10:10:52

Out of all the doctests in the sage/matrix directory only 6 of them failed, all in `matrix_double_dense.pyx`. Let's allow the patchbot to run the doctests, and then we can fix any other failing doctests. The current patch seems good enough since there is apparently no need to solve selectively for vectors or matrices - scipy seems to handle both just fine.

I think the `try: except:` statement should remain. It seems to give a decent error message when we try to solve linear equations over a matrix which is over RDF, but a vector which is over some incompatible field like a finite field. In its absence an absurd implementation-specific error message is returned:

```
   AttributeError: 'sage.modules.free_module_element.FreeModuleElement_generic_dense' object has no attribute 'numpy'
```


I am curious though - how does `vector(scipy_output)` or `matrix(scipy_output)` work? How does it know which field or ring to convert to, since we are not specifying the ring explicitly?


---

Comment by jason created at 2013-02-12 10:29:38

numpy arrays store a data type, and matrix() or vector() look at that datatype.


---

Comment by jason created at 2013-02-12 10:30:23

I agree that some of the error handling should be put back in.  The patch is more to get someone started in the right direction.


---

Comment by ppurka created at 2013-02-14 02:22:43

Is the patchbot down? I haven't seen any activity or testing even after I kicked the patchbot a day or two ago.


---

Comment by @mwageringel created at 2020-02-20 17:23:53

Changing priority from major to trivial.


---

Comment by @mwageringel created at 2020-02-20 17:23:53

Changing status from new to needs_review.


---

Comment by @mwageringel created at 2020-02-20 17:23:53

Duplicate of #17405.


---

Comment by kcrisman created at 2020-02-20 18:39:45

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2020-02-20 18:39:45

Good catch.


---

Comment by chapoton created at 2020-02-29 13:00:06

Resolution: duplicate
