# Issue 27912: Implement compact real forms for matrix Lie algebras

Issue created by migration from https://trac.sagemath.org/ticket/28149

Original creator: tscrim

Original creation time: 2019-07-09 22:20:52

CC:  bsalisbury1 chapoton

Keywords: lie algebras, fpsac2019

Because they are interesting and are useful.


---

Comment by tscrim created at 2019-07-09 22:21:38

Changing status from new to needs_review.


---

Comment by tscrim created at 2019-07-09 22:21:38

New commits:


---

Comment by git created at 2019-07-10 07:12:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-10 08:00:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-10 21:36:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bsalisbury1 created at 2019-07-10 21:38:10

Hi Travis,

I made some small changes to the documentation.  If you are okay with these changes, you may set this to positive review on my behalf.

~Ben


---

Comment by tscrim created at 2019-07-10 21:44:42

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2019-07-10 21:44:42

Thank you!


---

Comment by vbraun created at 2019-07-12 19:05:19

On Python 3:

```
sage -t --long src/sage/algebras/lie_algebras/classical_lie_algebra.py
**********************************************************************
File "src/sage/algebras/lie_algebras/classical_lie_algebra.py", line 1202, in sage.algebras.lie_algebras.classical_lie_algebra.MatrixCompactRealForm.Element._richcmp_
Failed example:
    sorted(L.basis())
Exception raised:
    Traceback (most recent call last):
      File "/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.algebras.lie_algebras.classical_lie_algebra.MatrixCompactRealForm.Element._richcmp_[1]>", line 1, in <module>
        sorted(L.basis())
      File "sage/structure/element.pyx", line 1091, in sage.structure.element.Element.__richcmp__ (build/cythonized/sage/structure/element.c:9923)
        return (<Element>self)._richcmp_(other, op)
      File "sage/structure/element.pyx", line 1095, in sage.structure.element.Element._richcmp_ (build/cythonized/sage/structure/element.c:10030)
        cpdef _richcmp_(left, right, int op):
      File "/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/algebras/lie_algebras/classical_lie_algebra.py", line 1208, in _richcmp_
        return richcmp((self._real, self._imag), (other._real, other._imag), op)
      File "sage/structure/richcmp.pxd", line 6, in sage.structure.richcmp.richcmp (build/cythonized/sage/structure/richcmp.c:3043)
        cpdef inline richcmp(x, y, int op):
      File "sage/structure/richcmp.pxd", line 50, in sage.structure.richcmp.richcmp (build/cythonized/sage/structure/richcmp.c:2939)
        return PyObject_RichCompare(x, y, op)
      File "sage/structure/element.pyx", line 1091, in sage.structure.element.Element.__richcmp__ (build/cythonized/sage/structure/element.c:9923)
        return (<Element>self)._richcmp_(other, op)
      File "sage/matrix/matrix_sparse.pyx", line 373, in sage.matrix.matrix_sparse.Matrix_sparse._richcmp_ (build/cythonized/sage/matrix/matrix_sparse.c:5799)
        return richcmp(self._dict(), right._dict(), op)
      File "sage/structure/richcmp.pxd", line 50, in sage.structure.richcmp.richcmp (build/cythonized/sage/matrix/matrix_sparse.c:14822)
        return PyObject_RichCompare(x, y, op)
    TypeError: '<' not supported between instances of 'dict' and 'dict'
**********************************************************************
1 item had failures:
   1 of   3 in sage.algebras.lie_algebras.classical_lie_algebra.MatrixCompactRealForm.Element._richcmp_
    [210 tests, 1 failure, 47.86 s]
```



---

Comment by vbraun created at 2019-07-12 19:05:19

Changing status from positive_review to needs_work.


---

Comment by git created at 2019-07-13 16:00:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-07-13 16:01:35

The root cause is that `dict`'s are incomparable on Python3, which means sparse matrices are incomparable, unlike dense matrices. So I changed how comparisons are done for sparse matrices, which is why I put you in cc Frédéric.


---

Comment by tscrim created at 2019-07-13 16:01:35

Changing status from needs_work to needs_review.


---

Comment by git created at 2019-07-17 15:17:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-07-17 15:19:39

(Now) Passes all doctests. Can someone review the last two changes? Should be quick.


---

Comment by chapoton created at 2019-07-17 19:16:48

* some pyflakes warnings, see last patchbot (only 2 fixable ones)

* typo "tranposes"

* here the brackets can be removed, I think: 
`+        names = tuple(['CR%s'%s for s in range(dim)])`

Otherwise, looks good. You can set to positive once the above is fixed.


---

Comment by git created at 2019-07-17 20:10:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-07-17 20:11:22

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2019-07-17 20:11:22

Replying to [comment:13 chapoton]:
> * some pyflakes warnings, see last patchbot (only 2 fixable ones)

Fixed.

> * typo "tranposes"

Fixed.

> * here the brackets can be removed, I think: 
> `+        names = tuple(['CR%s'%s for s in range(dim)])`

It is actually slightly faster to have the brackets. I think internally Python has some optimization for constructing tuples from lists.

> Otherwise, looks good. You can set to positive once the above is fixed.

Thank you. I am allowing myself to set this to a positive review.


---

Comment by vbraun created at 2019-07-20 09:10:48

Resolution: fixed
