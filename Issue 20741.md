# Issue 20741: polygon3d view broken

Issue created by migration from Trac.

Original creator: kcrisman

Original creation time: 2016-07-07 22:18:50

CC:  paulmasson novoselt mkoeppe


```
polygon3d([[0,0,0], [1,2,3], [3,0,0]]) 
```

does not show anything.  See [this ask.sagemath question](http://ask.sagemath.org/question/34054/polygon3d-doesnt-work/).


---

Comment by tscrim created at 2016-07-08 04:18:17

When I add an `arrow3d` (for example), then it displays properly:

```
sage: polygon3d([[0,0,1],[0,1,0],[1,0,0]]) + arrow3d([0,0,0],[1,1,1])
sage: p2.plot() + arrow3d([0,0,0],[1,1,1])
```

It seems like it is just ignoring the polygon3d when it is the only object:

```
sage: p = polygon3d([[0,0,1],[0,1,0],[1,0,0]]) + arrow3d([0,0,0],[1,1,1])
sage: rp = p.default_render_params()
sage: rp.output_archive = None
sage: p.jmol_repr(rp)
['pmesh obj_1 "/home/travis/.sage/temp/apricot/5573/tmp_pU6Ppq-obj_1.pmesh"\ncolor pmesh  [0,0,255]']
<type 'sage.plot.plot3d.index_face_set.IndexFaceSet'>

sage: p = polygon3d([[0,0,1],[0,1,0],[1,0,0]]) + arrow3d([0,0,0],[1,1,1])
sage: p.jmol_repr(rp)
[['pmesh obj_2 "/home/travis/.sage/temp/apricot/5573/tmp_pU6Ppq-obj_2.pmesh"\ncolor pmesh  [0,0,255]'],
 [[['\ndraw line_3 width 0.02 {0.0 0.0 0.0} {0.896076951546 0.896076951546 0.896076951546}\ncolor $line_3  [102,102,255]\n'],
   [['pmesh obj_4 "/home/travis/.sage/temp/apricot/5573/tmp_pU6Ppq-obj_4.pmesh"\ncolor pmesh  [102,102,255]']]]]]
sage: type(p)
<class 'sage.plot.plot3d.base.Graphics3dGroup'>

sage: p = arrow3d([0,0,0],[1,1,1])
sage: p.plot()    # This works fine
Launched jmol viewer for Graphics3d Object
sage: p.jmol_repr(rp)
[[['\ndraw line_5 width 0.02 {0.0 0.0 0.0} {0.896076951546 0.896076951546 0.896076951546}\ncolor $line_5  [102,102,255]\n'],
  [['pmesh obj_6 "/home/travis/.sage/temp/apricot/5573/tmp_pU6Ppq-obj_6.pmesh"\ncolor pmesh  [102,102,255]']]]]
sage: type(p)
<class 'sage.plot.plot3d.base.TransformGroup'>
```


A somewhat strange thing is that the graphics group `jmol_repr` calls the `jmol_repr` of the polygon. Perhaps someone has an idea about this (and knows how to read the jmol input).


---

Comment by egourgoulhon created at 2016-07-08 11:35:57

Works for me with sage 7.3.beta6 on Ubuntu 15.10 for both sage notebook and jupyter notebook (a blue triangle is displayed in the jmol output). Does *not* work from the sage console (only the bounding box is displayed).


---

Comment by egourgoulhon created at 2016-07-08 11:48:05

Replying to [comment:3 egourgoulhon]:
> Works for me with sage 7.3.beta6 on Ubuntu 15.10 for both sage notebook and jupyter notebook (a blue triangle is displayed in the jmol output). Does *not* work from the sage console (only the bounding box is displayed). 

Addendum: in the sage notebook, the triangle is displayed only after one has clicked on the figure.


---

Comment by paulmasson created at 2016-07-11 20:59:54

I don't think this is a Sage problem. If you look at the temporary files under the hidden `User/.sage` directory that are passed to the Jmol viewer, the `pmesh` files for the polygons are there and included every time in the `SCRIPT` file in `scene.spt.zip`. The data for the polygons is exactly the same whether or not the arrow is included.

As a test, run this at the command line:


```
p=polygon([(0,0,0),(1,0,0),(1,1,0)])
for n in range(1,10):
     p+=polygon([(n,0,0),(n+1,0,0),(n+1,n+1,0)])
     p
```


When I run it the polygons don't being to appear until there are six of them, and don't appear reliably for higher numbers.

I think this is a Jmol display problem.


---

Comment by tscrim created at 2016-07-12 14:58:21

Hmmm...perhaps it is time to revive the discussion of moving to a different 3d viewing platform? At least we should probably tell upstream.


---

Comment by paulmasson created at 2016-09-30 00:10:58

On #12402 I've written some basic Three.js support for `Graphics3d` objects that can handle examples here that fail in Jmol. If there is interest in having an option other than Jmol, feedback on #12402 would be appreciated.


---

Comment by mkoeppe created at 2016-09-30 05:47:16

Is this usable with sage running in a terminal? Note that the failure documented in this ticket is about the Java version of Jmol, which is the one that is used in this situation.


---

Comment by paulmasson created at 2016-09-30 19:52:23

Replying to [comment:10 mkoeppe]:
> Is this usable with sage running in a terminal?
Yup! That's the entire point: an HTML file is generated at the command line and saved in a temporary file like other plots. It can then be displayed immediately in a browser, or embedded in an iframe for future application in notebooks or the cell server.


---

Comment by paulmasson created at 2019-10-08 20:27:03

Changing status from new to needs_review.


---

Comment by paulmasson created at 2019-10-08 20:27:03

Since Three.js will be the default viewer in Sage 9.0 this ticket can be closed.


---

Comment by paulmasson created at 2019-10-08 20:27:03

Changing keywords from "" to "jmol threejs".


---

Comment by egourgoulhon created at 2019-10-08 21:08:22

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2019-10-08 21:08:22

Replying to [comment:12 paulmasson]:
> Since Three.js will be the default viewer in Sage 9.0 this ticket can be closed.

Yes indeed.


---

Comment by kcrisman created at 2019-10-08 21:09:02

Changing priority from critical to minor.


---

Comment by kcrisman created at 2019-10-08 21:09:02

Changing status from positive_review to needs_info.


---

Comment by kcrisman created at 2019-10-08 21:09:02

Just because the default changes doesn't mean this is fixed, and some people may still be using Jmol from command line or whatever.    But we can certainly modify the ticket.


---

Comment by egourgoulhon created at 2019-10-08 21:14:17

Replying to [comment:14 kcrisman]:
> Just because the default changes doesn't mean this is fixed, and some people may still be using Jmol from command line or whatever.    

Yes you are right of course, I've been too fast here.


---

Comment by egourgoulhon created at 2019-10-08 21:18:55

For the record, the issue is still there in Sage 9.0.beta0, even after the update of Jmol in #25026.


---

Comment by paulmasson created at 2019-10-08 22:29:01

Replying to [comment:14 kcrisman]:
> Just because the default changes doesn't mean this is fixed, and some people may still be using Jmol from command line or whatever.    But we can certainly modify the ticket.
As I pointed out three years ago, this is not a Sage problem and wonâ€™t get fixed here. Are you keeping the ticket open monitor upstream activity? Otherwise it should be closed.


---

Comment by kcrisman created at 2019-10-09 12:19:26

We have tons of tickets here that monitor upstream activity, because they impact Sage usability in various contexts.   I notice that "Report Upstream" is currently N/A, though, so maybe that should be changed and possibly worked on.  I often do this with Maxima bugs but I don't know what the current Jmol upstream reporting process is.


---

Comment by embray created at 2020-01-06 14:10:03

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-05-01 04:28:42

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.


---

Comment by mkoeppe created at 2021-04-02 20:21:54

Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.


---

Comment by mkoeppe created at 2021-12-18 19:53:12

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.
