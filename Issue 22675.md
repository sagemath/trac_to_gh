# Issue 22675: issue with is_tree when the graph has loops

Issue created by migration from Trac.

Original creator: dcoudert

Original creation time: 2017-04-30 16:01:31

The method `is_tree` is currently not working properly for graphs with loops. In particular, when asking for a certificate, the method may end without returning anything.

```
sage: G = Graph([(0,0), (0,1)], loops=True)
sage: G.is_tree()
False
sage: G.is_tree(certificate=True)
```


I'm not sure of the best way to fix it. 
1. consider that a graph has a loop it is not a tree. It suffices to add a special case, and possibly return a loop as a certificate.
2. ignore loops. Certainly more complicated to implement.


---

Comment by tscrim created at 2017-04-30 16:08:41

I would never ignore loops as it would make `G` into a tree. So the only option is 1, where we return the loop as the certificate.


---

Comment by dcoudert created at 2017-04-30 16:14:33

Changing status from new to needs_review.


---

Comment by dcoudert created at 2017-04-30 16:14:33

agreed and implemented.
----
New commits:


---

Comment by tscrim created at 2017-04-30 16:25:43

I think we can be a bit more efficient about how we do this. In particular, the usual check of `V + 1 = E` works for loops (it checks connectedness beforehand). Also, you could just do something like

```python
L = self.loop_edges() if output == 'edge' else self.loop_vertices()
if L:
    return L[:1]
```

within the `if certificate:` block.


---

Comment by git created at 2017-04-30 17:17:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2017-04-30 17:17:47

Perfectly right.


---

Comment by tscrim created at 2017-04-30 17:44:33

By calling `has_loops`, you iterate over the vertices twice compared to what I suggest in comment:3. It's a little messier code, but it's not as bad as deconstructing the calls to `loop_edges` and/or `loop_vertices` (which really would be the most efficient, but IMO, that is going a little overboard here at this point in time). Your thoughts?


---

Comment by git created at 2017-04-30 18:00:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2017-04-30 18:01:46

The last version is certainly even better.


---

Comment by tscrim created at 2017-04-30 18:32:38

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-04-30 18:32:38

Thanks.


---

Comment by vbraun created at 2017-05-04 21:00:28

Resolution: fixed
