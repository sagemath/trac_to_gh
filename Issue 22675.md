# Issue 22675: issue with is_tree when the graph has loops

archive/issues_022675.json:
```json
{
    "body": "The method `is_tree` is currently not working properly for graphs with loops. In particular, when asking for a certificate, the method may end without returning anything.\n\n```\nsage: G = Graph([(0,0), (0,1)], loops=True)\nsage: G.is_tree()\nFalse\nsage: G.is_tree(certificate=True)\n```\n\n\nI'm not sure of the best way to fix it. \n1. consider that a graph has a loop it is not a tree. It suffices to add a special case, and possibly return a loop as a certificate.\n2. ignore loops. Certainly more complicated to implement.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22912\n\n",
    "created_at": "2017-04-30T16:01:31Z",
    "labels": [
        "graph theory",
        "major",
        "bug"
    ],
    "title": "issue with is_tree when the graph has loops",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22675",
    "user": "dcoudert"
}
```
The method `is_tree` is currently not working properly for graphs with loops. In particular, when asking for a certificate, the method may end without returning anything.

```
sage: G = Graph([(0,0), (0,1)], loops=True)
sage: G.is_tree()
False
sage: G.is_tree(certificate=True)
```


I'm not sure of the best way to fix it. 
1. consider that a graph has a loop it is not a tree. It suffices to add a special case, and possibly return a loop as a certificate.
2. ignore loops. Certainly more complicated to implement.

Issue created by migration from https://trac.sagemath.org/ticket/22912





---

archive/issue_comments_316219.json:
```json
{
    "body": "I would never ignore loops as it would make `G` into a tree. So the only option is 1, where we return the loop as the certificate.",
    "created_at": "2017-04-30T16:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22675#issuecomment-316219",
    "user": "tscrim"
}
```

I would never ignore loops as it would make `G` into a tree. So the only option is 1, where we return the loop as the certificate.



---

archive/issue_comments_316220.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-04-30T16:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22675#issuecomment-316220",
    "user": "dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_316221.json:
```json
{
    "body": "agreed and implemented.\n----\nNew commits:",
    "created_at": "2017-04-30T16:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22675#issuecomment-316221",
    "user": "dcoudert"
}
```

agreed and implemented.
----
New commits:



---

archive/issue_comments_316222.json:
```json
{
    "body": "I think we can be a bit more efficient about how we do this. In particular, the usual check of `V + 1 = E` works for loops (it checks connectedness beforehand). Also, you could just do something like\n\n```python\nL = self.loop_edges() if output == 'edge' else self.loop_vertices()\nif L:\n    return L[:1]\n```\n\nwithin the `if certificate:` block.",
    "created_at": "2017-04-30T16:25:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22675#issuecomment-316222",
    "user": "tscrim"
}
```

I think we can be a bit more efficient about how we do this. In particular, the usual check of `V + 1 = E` works for loops (it checks connectedness beforehand). Also, you could just do something like

```python
L = self.loop_edges() if output == 'edge' else self.loop_vertices()
if L:
    return L[:1]
```

within the `if certificate:` block.



---

archive/issue_comments_316223.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-30T17:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22675#issuecomment-316223",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_316224.json:
```json
{
    "body": "Perfectly right.",
    "created_at": "2017-04-30T17:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22675#issuecomment-316224",
    "user": "dcoudert"
}
```

Perfectly right.



---

archive/issue_comments_316225.json:
```json
{
    "body": "By calling `has_loops`, you iterate over the vertices twice compared to what I suggest in comment:3. It's a little messier code, but it's not as bad as deconstructing the calls to `loop_edges` and/or `loop_vertices` (which really would be the most efficient, but IMO, that is going a little overboard here at this point in time). Your thoughts?",
    "created_at": "2017-04-30T17:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22675#issuecomment-316225",
    "user": "tscrim"
}
```

By calling `has_loops`, you iterate over the vertices twice compared to what I suggest in comment:3. It's a little messier code, but it's not as bad as deconstructing the calls to `loop_edges` and/or `loop_vertices` (which really would be the most efficient, but IMO, that is going a little overboard here at this point in time). Your thoughts?



---

archive/issue_comments_316226.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-30T18:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22675#issuecomment-316226",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_316227.json:
```json
{
    "body": "The last version is certainly even better.",
    "created_at": "2017-04-30T18:01:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22675#issuecomment-316227",
    "user": "dcoudert"
}
```

The last version is certainly even better.



---

archive/issue_comments_316228.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-30T18:32:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22675#issuecomment-316228",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_316229.json:
```json
{
    "body": "Thanks.",
    "created_at": "2017-04-30T18:32:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22675#issuecomment-316229",
    "user": "tscrim"
}
```

Thanks.



---

archive/issue_comments_316230.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-05-04T21:00:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22675#issuecomment-316230",
    "user": "vbraun"
}
```

Resolution: fixed
