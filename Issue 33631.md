# Issue 33631: A bug in modules with basis

archive/issues_033631.json:
```json
{
    "body": "CC:  @tscrim @jhpalmieri\n\nIt seems that stuffs of new modules with flexible bases interfere with classical modules with fixed basis:\n\n```\nsage: S.<x,y,z,w> = PolynomialRing(QQ)\nsage: A = S**2\nsage: A\nAmbient free module of rank 2 over the integral domain Multivariate Polynomial Ring in x, y, z, w over Rational Field\nsage: A.submodule([vector([x-y,z-w]), vector([y*z, x*w])])\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-7-cabbcc8d5285> in <module>\n----> 1 A.submodule([vector([x-y,z-w]), vector([y*z, x*w])])\n\n~/GitHub/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/categories/modules_with_basis.py in submodule(self, gens, check, already_echelonized, unitriangular, support_order, category, *args, **opts)\n    876             support_order = self._compute_support_order(gens, support_order)\n    877             if not already_echelonized:\n--> 878                 gens = self.echelon_form(gens, unitriangular, order=support_order)\n    879 \n    880             from sage.modules.with_basis.subquotient import SubmoduleWithBasis\n\n~/GitHub/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/categories/finite_dimensional_modules_with_basis.py in echelon_form(self, elements, row_reduced, order)\n    367             order = self._compute_support_order(elements, order)\n    368             from sage.matrix.constructor import matrix\n--> 369             mat = matrix(self.base_ring(), [g._vector_(order=order) for g in elements])\n    370             # Echelonizing a matrix over a field returned the rref\n    371             if row_reduced and self.base_ring() not in Fields():\n\n~/GitHub/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/categories/finite_dimensional_modules_with_basis.py in <listcomp>(.0)\n    367             order = self._compute_support_order(elements, order)\n    368             from sage.matrix.constructor import matrix\n--> 369             mat = matrix(self.base_ring(), [g._vector_(order=order) for g in elements])\n    370             # Echelonizing a matrix over a field returned the rref\n    371             if row_reduced and self.base_ring() not in Fields():\n\n~/GitHub/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/modules/free_module_element.pyx in sage.modules.free_module_element.FreeModuleElement._vector_ (build/cythonized/sage/modules/free_module_element.c:9892)()\n   1141         return hash(tuple(self))\n   1142 \n-> 1143     def _vector_(self, R=None):\n   1144         r\"\"\"\n   1145         Return self as a vector.\n\nTypeError: _vector_() got an unexpected keyword argument 'order'\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33868\n\n",
    "created_at": "2022-05-19T08:17:39Z",
    "labels": [
        "component: algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "A bug in modules with basis",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33631",
    "user": "https://github.com/kwankyu"
}
```
CC:  @tscrim @jhpalmieri

It seems that stuffs of new modules with flexible bases interfere with classical modules with fixed basis:

```
sage: S.<x,y,z,w> = PolynomialRing(QQ)
sage: A = S**2
sage: A
Ambient free module of rank 2 over the integral domain Multivariate Polynomial Ring in x, y, z, w over Rational Field
sage: A.submodule([vector([x-y,z-w]), vector([y*z, x*w])])
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-7-cabbcc8d5285> in <module>
----> 1 A.submodule([vector([x-y,z-w]), vector([y*z, x*w])])

~/GitHub/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/categories/modules_with_basis.py in submodule(self, gens, check, already_echelonized, unitriangular, support_order, category, *args, **opts)
    876             support_order = self._compute_support_order(gens, support_order)
    877             if not already_echelonized:
--> 878                 gens = self.echelon_form(gens, unitriangular, order=support_order)
    879 
    880             from sage.modules.with_basis.subquotient import SubmoduleWithBasis

~/GitHub/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/categories/finite_dimensional_modules_with_basis.py in echelon_form(self, elements, row_reduced, order)
    367             order = self._compute_support_order(elements, order)
    368             from sage.matrix.constructor import matrix
--> 369             mat = matrix(self.base_ring(), [g._vector_(order=order) for g in elements])
    370             # Echelonizing a matrix over a field returned the rref
    371             if row_reduced and self.base_ring() not in Fields():

~/GitHub/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/categories/finite_dimensional_modules_with_basis.py in <listcomp>(.0)
    367             order = self._compute_support_order(elements, order)
    368             from sage.matrix.constructor import matrix
--> 369             mat = matrix(self.base_ring(), [g._vector_(order=order) for g in elements])
    370             # Echelonizing a matrix over a field returned the rref
    371             if row_reduced and self.base_ring() not in Fields():

~/GitHub/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/modules/free_module_element.pyx in sage.modules.free_module_element.FreeModuleElement._vector_ (build/cythonized/sage/modules/free_module_element.c:9892)()
   1141         return hash(tuple(self))
   1142 
-> 1143     def _vector_(self, R=None):
   1144         r"""
   1145         Return self as a vector.

TypeError: _vector_() got an unexpected keyword argument 'order'
```


Issue created by migration from https://trac.sagemath.org/ticket/33868





---

archive/issue_comments_478140.json:
```json
{
    "body": "I see many module-related methods accept this `order` argument. It is not immediately clear what is the role of this argument. I guess it gives an \"order\" to the basis...",
    "created_at": "2022-05-19T08:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478140",
    "user": "https://github.com/kwankyu"
}
```

I see many module-related methods accept this `order` argument. It is not immediately clear what is the role of this argument. I guess it gives an "order" to the basis...



---

archive/issue_comments_478141.json:
```json
{
    "body": "As dimpase pointed out on sage-devel, many things are just not implemented for modules over infinite-dimensional rings. The recently added `modules/fp_graded` (finitely presented modules over graded connected rings) implements some things, but only in a graded setting.",
    "created_at": "2022-05-19T21:07:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478141",
    "user": "https://github.com/jhpalmieri"
}
```

As dimpase pointed out on sage-devel, many things are just not implemented for modules over infinite-dimensional rings. The recently added `modules/fp_graded` (finitely presented modules over graded connected rings) implements some things, but only in a graded setting.



---

archive/issue_comments_478142.json:
```json
{
    "body": "Replying to [comment:3 jhpalmieri]:\n> As dimpase pointed out on sage-devel, many things are just not implemented for modules over infinite-dimensional rings. The recently added `modules/fp_graded` (finitely presented modules over graded connected rings) implements some things, but only in a graded setting.\n\nI see. I forgot that... Anyway I will think of a way to raise an exception less surprising in such cases, or provide a simple implementation of submodules of such ambient modules. \n\nI was working with morphisms between modules over multivariate polynomial rings, and tried to get the image and the kernel of a morphism. I did't know even submodules are not in place...",
    "created_at": "2022-05-20T01:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478142",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:3 jhpalmieri]:
> As dimpase pointed out on sage-devel, many things are just not implemented for modules over infinite-dimensional rings. The recently added `modules/fp_graded` (finitely presented modules over graded connected rings) implements some things, but only in a graded setting.

I see. I forgot that... Anyway I will think of a way to raise an exception less surprising in such cases, or provide a simple implementation of submodules of such ambient modules. 

I was working with morphisms between modules over multivariate polynomial rings, and tried to get the image and the kernel of a morphism. I did't know even submodules are not in place...



---

archive/issue_comments_478143.json:
```json
{
    "body": "Replying to [comment:3 jhpalmieri]:\n> The recently added `modules/fp_graded` (finitely presented modules over graded connected rings) implements some things, but only in a graded setting.\n\nActually what I need is submodules of free modules (of finite rank) over graded multivariate polynomial rings. The grading may be multigrades, that is, by integer vectors. Then are these modules included in `fp_graded` modules?",
    "created_at": "2022-05-20T02:07:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478143",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:3 jhpalmieri]:
> The recently added `modules/fp_graded` (finitely presented modules over graded connected rings) implements some things, but only in a graded setting.

Actually what I need is submodules of free modules (of finite rank) over graded multivariate polynomial rings. The grading may be multigrades, that is, by integer vectors. Then are these modules included in `fp_graded` modules?



---

archive/issue_comments_478144.json:
```json
{
    "body": "Replying to [comment:5 klee]:\n> Replying to [comment:3 jhpalmieri]:\n> > The recently added `modules/fp_graded` (finitely presented modules over graded connected rings) implements some things, but only in a graded setting.\n> \n> Actually what I need is submodules of free modules (of finite rank) over graded multivariate polynomial rings. The grading may be multigrades, that is, by integer vectors. Then are these modules included in `fp_graded` modules?\n\nI don't know how well tested the code is for multigradings, but in principle it should work. The biggest issue I think is polynomial rings do not know they are multigraded. We can hack around this with an appropriate subclass of `CombinatorialFreeModule` that uses a free monoid as its indexing set. However, do not expect algebraic operations to be fast, or have some other polynomial features like division, Gr\u00f6bner bases, etc.\n\nThe easiest fix for this issue would probably be to just modify the `_vector_` to take `order` and ignore it. I can't promise there won't be another compatibility issue, but we can fix those as we encounter them.",
    "created_at": "2022-05-20T02:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478144",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:5 klee]:
> Replying to [comment:3 jhpalmieri]:
> > The recently added `modules/fp_graded` (finitely presented modules over graded connected rings) implements some things, but only in a graded setting.
> 
> Actually what I need is submodules of free modules (of finite rank) over graded multivariate polynomial rings. The grading may be multigrades, that is, by integer vectors. Then are these modules included in `fp_graded` modules?

I don't know how well tested the code is for multigradings, but in principle it should work. The biggest issue I think is polynomial rings do not know they are multigraded. We can hack around this with an appropriate subclass of `CombinatorialFreeModule` that uses a free monoid as its indexing set. However, do not expect algebraic operations to be fast, or have some other polynomial features like division, Gröbner bases, etc.

The easiest fix for this issue would probably be to just modify the `_vector_` to take `order` and ignore it. I can't promise there won't be another compatibility issue, but we can fix those as we encounter them.



---

archive/issue_comments_478145.json:
```json
{
    "body": "Replying to [comment:6 tscrim]:\n> I don't know how well tested the code is for multigradings, but in principle it should work. The biggest issue I think is polynomial rings do not know they are multigraded. We can hack around this with an appropriate subclass of `CombinatorialFreeModule` that uses a free monoid as its indexing set. However, do not expect algebraic operations to be fast, or have some other polynomial features like division, Gr\u00f6bner bases, etc.\n\nMoreover, these modules like `fp_graded` seem intended for modules over algebras and these algebras are not primarily commutative. I see \"graded commutative\" in sage.algebras.commutative_dga, but this is not \"graded\" + \"commutative\".\n\nThese seem to be not proper tools to work with the usual graded polynomials rings and modules needed for computational commutative algebra and algebraic geometry.\n\n> \n> The easiest fix for this issue would probably be to just modify the `_vector_` to take `order` and ignore it. \n\nOkay. I thought of that, but was not sure if that is a right way. Thanks.",
    "created_at": "2022-05-20T02:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478145",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:6 tscrim]:
> I don't know how well tested the code is for multigradings, but in principle it should work. The biggest issue I think is polynomial rings do not know they are multigraded. We can hack around this with an appropriate subclass of `CombinatorialFreeModule` that uses a free monoid as its indexing set. However, do not expect algebraic operations to be fast, or have some other polynomial features like division, Gröbner bases, etc.

Moreover, these modules like `fp_graded` seem intended for modules over algebras and these algebras are not primarily commutative. I see "graded commutative" in sage.algebras.commutative_dga, but this is not "graded" + "commutative".

These seem to be not proper tools to work with the usual graded polynomials rings and modules needed for computational commutative algebra and algebraic geometry.

> 
> The easiest fix for this issue would probably be to just modify the `_vector_` to take `order` and ignore it. 

Okay. I thought of that, but was not sure if that is a right way. Thanks.



---

archive/issue_comments_478146.json:
```json
{
    "body": "Replying to [comment:7 klee]:\n> Replying to [comment:6 tscrim]:\n> > I don't know how well tested the code is for multigradings, but in principle it should work. The biggest issue I think is polynomial rings do not know they are multigraded. We can hack around this with an appropriate subclass of `CombinatorialFreeModule` that uses a free monoid as its indexing set. However, do not expect algebraic operations to be fast, or have some other polynomial features like division, Gr\u00f6bner bases, etc.\n> \n> Moreover, these modules like `fp_graded` seem intended for modules over algebras and these algebras are not primarily commutative.\n\nThat is true. They are meant to work with general (likely associative unital) algebras. It does not have the linear algebra quite so close at hand, but they might fair a bit better when moving outside of free modules. We need to have more native support for non-free modules, some of which for commutative base rings can be pulled from singular.\n\n> These seem to be not proper tools to work with the usual graded polynomials rings and modules needed for computational commutative algebra and algebraic geometry.\n\nI don't quite know what you are hoping to compute as it is a bit too far outside of my area. The code here can do some homological algebra. John might know more about how it could be applied.\n\nPS - The `order` argument is for free modules that do not necessarily have a fixed/well-defined ordering of the basis elements. However, to (efficiently) do the linear algebra, we need to chose an ordering of the basis to manipulate the matrices. Thus this is used to convert to/from the implementation with a fixed ordering.",
    "created_at": "2022-05-20T02:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478146",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:7 klee]:
> Replying to [comment:6 tscrim]:
> > I don't know how well tested the code is for multigradings, but in principle it should work. The biggest issue I think is polynomial rings do not know they are multigraded. We can hack around this with an appropriate subclass of `CombinatorialFreeModule` that uses a free monoid as its indexing set. However, do not expect algebraic operations to be fast, or have some other polynomial features like division, Gröbner bases, etc.
> 
> Moreover, these modules like `fp_graded` seem intended for modules over algebras and these algebras are not primarily commutative.

That is true. They are meant to work with general (likely associative unital) algebras. It does not have the linear algebra quite so close at hand, but they might fair a bit better when moving outside of free modules. We need to have more native support for non-free modules, some of which for commutative base rings can be pulled from singular.

> These seem to be not proper tools to work with the usual graded polynomials rings and modules needed for computational commutative algebra and algebraic geometry.

I don't quite know what you are hoping to compute as it is a bit too far outside of my area. The code here can do some homological algebra. John might know more about how it could be applied.

PS - The `order` argument is for free modules that do not necessarily have a fixed/well-defined ordering of the basis elements. However, to (efficiently) do the linear algebra, we need to chose an ordering of the basis to manipulate the matrices. Thus this is used to convert to/from the implementation with a fixed ordering.



---

archive/issue_comments_478147.json:
```json
{
    "body": "Replying to [comment:8 tscrim]:\n\n> I don't quite know what you are hoping to compute as it is a bit too far outside of my area. The code here can do some homological algebra. John might know more about how it could be applied.\n\nI am working on graded free resolutions of graded modules over polynomial rings, pulling the resolution machinery of Singular. Hence I really don't need to compute with the modules in Sage, but just need the framework. As it is not there, perhaps I can work with matrices instead.\n\n> PS - The `order` argument is for free modules that do not necessarily have a fixed/well-defined ordering of the basis elements. However, to (efficiently) do the linear algebra, we need to choose an ordering of the basis to manipulate the matrices. Thus this is used to convert to/from the implementation with a fixed ordering.\n\nThanks for explanation.",
    "created_at": "2022-05-20T03:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478147",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:8 tscrim]:

> I don't quite know what you are hoping to compute as it is a bit too far outside of my area. The code here can do some homological algebra. John might know more about how it could be applied.

I am working on graded free resolutions of graded modules over polynomial rings, pulling the resolution machinery of Singular. Hence I really don't need to compute with the modules in Sage, but just need the framework. As it is not there, perhaps I can work with matrices instead.

> PS - The `order` argument is for free modules that do not necessarily have a fixed/well-defined ordering of the basis elements. However, to (efficiently) do the linear algebra, we need to choose an ordering of the basis to manipulate the matrices. Thus this is used to convert to/from the implementation with a fixed ordering.

Thanks for explanation.



---

archive/issue_comments_478148.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-20T23:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478148",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478149.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-05-20T23:06:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478149",
    "user": "https://github.com/kwankyu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_478150.json:
```json
{
    "body": "I decided to follow Dima's idea, to implement modules over domain. This just amount to insert a class for \"modules over domain\" between \"modules over ring\" and \"modules over pid\". Refactoring thus gives some (trivial) functions to modules over domain.",
    "created_at": "2022-05-20T23:06:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478150",
    "user": "https://github.com/kwankyu"
}
```

I decided to follow Dima's idea, to implement modules over domain. This just amount to insert a class for "modules over domain" between "modules over ring" and "modules over pid". Refactoring thus gives some (trivial) functions to modules over domain.



---

archive/issue_comments_478151.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-05-21T11:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478151",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_478152.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-21T12:26:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478152",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478153.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-05-21T12:26:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478153",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_478154.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-05-21T23:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478154",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_478155.json:
```json
{
    "body": "As submodules of modules over domain may lack a (linearly independent) basis, the \"quick fix\" code needs more thought...",
    "created_at": "2022-05-21T23:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478155",
    "user": "https://github.com/kwankyu"
}
```

As submodules of modules over domain may lack a (linearly independent) basis, the "quick fix" code needs more thought...



---

archive/issue_comments_478156.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-05-25T02:04:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478156",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_478157.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-05-25T02:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478157",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_478158.json:
```json
{
    "body": "Now `FreeModule_generic`, which is the base class of all modules, does not assume that a rank is defined (or an echelon form of its basis matrix is defined). The argument `rank` is `None` in this case.\n\nThe change allows a room for `FreeModule_generic_domain` the class of modules over an integral domain, for which there is no notion of rank. Submodules and quotient modules of ambient free modules over a domain can be constructed. There is no attempt to provide a \"rank\" (or an \"echelon form\" of the defining matrix) for them.",
    "created_at": "2022-05-25T02:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478158",
    "user": "https://github.com/kwankyu"
}
```

Now `FreeModule_generic`, which is the base class of all modules, does not assume that a rank is defined (or an echelon form of its basis matrix is defined). The argument `rank` is `None` in this case.

The change allows a room for `FreeModule_generic_domain` the class of modules over an integral domain, for which there is no notion of rank. Submodules and quotient modules of ambient free modules over a domain can be constructed. There is no attempt to provide a "rank" (or an "echelon form" of the defining matrix) for them.



---

archive/issue_comments_478159.json:
```json
{
    "body": "It now seems to me that classes `FreeModule_submodule_...` defined in `sage.modules.free_module` are intended for (mathematical) free modules, but just embedded as a submodule (of a free module). Hence they all have mathematically well-defined notion of rank (but still possibly no echelon form). \n\nThen it seems wrong to insert submodules of free modules over a domain (without well-defined notion of rank) here...",
    "created_at": "2022-05-27T09:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478159",
    "user": "https://github.com/kwankyu"
}
```

It now seems to me that classes `FreeModule_submodule_...` defined in `sage.modules.free_module` are intended for (mathematical) free modules, but just embedded as a submodule (of a free module). Hence they all have mathematically well-defined notion of rank (but still possibly no echelon form). 

Then it seems wrong to insert submodules of free modules over a domain (without well-defined notion of rank) here...



---

archive/issue_comments_478160.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-05-27T09:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478160",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_478161.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-28T12:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478161",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478162.json:
```json
{
    "body": "Now submodules of free modules over a domain is defined in new `submodule.py`.\n\nI also cleaned up modules toc tree.",
    "created_at": "2022-05-28T12:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478162",
    "user": "https://github.com/kwankyu"
}
```

Now submodules of free modules over a domain is defined in new `submodule.py`.

I also cleaned up modules toc tree.



---

archive/issue_comments_478163.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-05-28T12:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478163",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_478164.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-28T12:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478164",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478165.json:
```json
{
    "body": "Some quick comments:\n\n- For `submodule.py`, I don't think it is good to call the generators basis elements since that implies it is a free module. It would be better to call them generators.\n- It might be good to have a shortcut way to construct the morphism from the ambient free module into the submodule in order to do homological algebra (a la the finitely presented graded modules code; but perhaps one needs a little more finite-dimensional-ness coming from the grading to do anything meaningful).",
    "created_at": "2022-06-08T03:25:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478165",
    "user": "https://github.com/tscrim"
}
```

Some quick comments:

- For `submodule.py`, I don't think it is good to call the generators basis elements since that implies it is a free module. It would be better to call them generators.
- It might be good to have a shortcut way to construct the morphism from the ambient free module into the submodule in order to do homological algebra (a la the finitely presented graded modules code; but perhaps one needs a little more finite-dimensional-ness coming from the grading to do anything meaningful).



---

archive/issue_comments_478166.json:
```json
{
    "body": "Replying to [comment:28 tscrim]:\n> - For `submodule.py`, I don't think it is good to call the generators basis elements since that implies it is a free module. It would be better to call them generators.\n\nI agree. But technically the matters are more complicated. Currently submodules and quotients of free modules over any ring are all subclasses of `FreeModule_generic`. If submodules and quotients of free modules over a multivariate polynomial ring should work well together with existing infrastructure, they should also be subclasses of `FreeModule_generic`. As `FreeModule_generic` expects `basis()` method (implemented in subclasses), I have no choice but to supply this `basis()` method, which simply returns the set of generators. So unfortunately I cannot call them generators everywhere...",
    "created_at": "2022-06-08T05:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478166",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:28 tscrim]:
> - For `submodule.py`, I don't think it is good to call the generators basis elements since that implies it is a free module. It would be better to call them generators.

I agree. But technically the matters are more complicated. Currently submodules and quotients of free modules over any ring are all subclasses of `FreeModule_generic`. If submodules and quotients of free modules over a multivariate polynomial ring should work well together with existing infrastructure, they should also be subclasses of `FreeModule_generic`. As `FreeModule_generic` expects `basis()` method (implemented in subclasses), I have no choice but to supply this `basis()` method, which simply returns the set of generators. So unfortunately I cannot call them generators everywhere...



---

archive/issue_comments_478167.json:
```json
{
    "body": "Replying to [comment:29 klee]:\n> Replying to [comment:28 tscrim]:\n> > - For `submodule.py`, I don't think it is good to call the generators basis elements since that implies it is a free module. It would be better to call them generators.\n> \n> I agree. But technically the matters are more complicated. Currently submodules and quotients of free modules over any ring are all subclasses of `FreeModule_generic`. If submodules and quotients of free modules over a multivariate polynomial ring should work well together with existing infrastructure, they should also be subclasses of `FreeModule_generic`. As `FreeModule_generic` expects `basis()` method (implemented in subclasses), I have no choice but to supply this `basis()` method, which simply returns the set of generators. So unfortunately I cannot call them generators everywhere...\n\nThat seems like there should be a refactoring since anything titled `FreeModule` should naturally expect to have a basis. Probably some common methods related to submodules need to be factored out to some `Module_generic` class and then the stuff for free modules is a subclass of that with your generic submodule code being in a separate branch of the class hierarchy. This might get rid of the bit of a code smell coming from allowing `rank=None` as input.",
    "created_at": "2022-06-08T05:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478167",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:29 klee]:
> Replying to [comment:28 tscrim]:
> > - For `submodule.py`, I don't think it is good to call the generators basis elements since that implies it is a free module. It would be better to call them generators.
> 
> I agree. But technically the matters are more complicated. Currently submodules and quotients of free modules over any ring are all subclasses of `FreeModule_generic`. If submodules and quotients of free modules over a multivariate polynomial ring should work well together with existing infrastructure, they should also be subclasses of `FreeModule_generic`. As `FreeModule_generic` expects `basis()` method (implemented in subclasses), I have no choice but to supply this `basis()` method, which simply returns the set of generators. So unfortunately I cannot call them generators everywhere...

That seems like there should be a refactoring since anything titled `FreeModule` should naturally expect to have a basis. Probably some common methods related to submodules need to be factored out to some `Module_generic` class and then the stuff for free modules is a subclass of that with your generic submodule code being in a separate branch of the class hierarchy. This might get rid of the bit of a code smell coming from allowing `rank=None` as input.



---

archive/issue_comments_478168.json:
```json
{
    "body": "Replying to [comment:30 tscrim]:\n> That seems like there should be a refactoring since anything titled `FreeModule` should naturally expect to have a basis. Probably some common methods related to submodules need to be factored out to some `Module_generic` class and then the stuff for free modules is a subclass of that with your generic submodule code being in a separate branch of the class hierarchy. This might get rid of the bit of a code smell coming from allowing `rank=None` as input.\n\nI agree that what you said is the right way to go. But that would be more demanding work... \n\nOkay. I will work more.",
    "created_at": "2022-06-08T06:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478168",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:30 tscrim]:
> That seems like there should be a refactoring since anything titled `FreeModule` should naturally expect to have a basis. Probably some common methods related to submodules need to be factored out to some `Module_generic` class and then the stuff for free modules is a subclass of that with your generic submodule code being in a separate branch of the class hierarchy. This might get rid of the bit of a code smell coming from allowing `rank=None` as input.

I agree that what you said is the right way to go. But that would be more demanding work... 

Okay. I will work more.



---

archive/issue_comments_478169.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-06-08T06:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478169",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_478170.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-09T04:17:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478170",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478171.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-06-09T04:17:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478171",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_478172.json:
```json
{
    "body": "Replying to [comment:30 tscrim]: \n> That seems like there should be a refactoring since anything titled `FreeModule` should naturally expect to have a basis. Probably some common methods related to submodules need to be factored out to some `Module_generic` class and then the stuff for free modules is a subclass of that with your generic submodule code being in a separate branch of the class hierarchy. This might get rid of the bit of a code smell coming from allowing `rank=None` as input.\n\nDone in the last commit. I used the name `FreeModule_base`, as the base class of modules whose elements are represented by elements of a free module. `FreeModule_generic` is such a base class but it is for modules with a basis. `FreeModule_base` are for modules without a basis.",
    "created_at": "2022-06-09T04:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478172",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:30 tscrim]: 
> That seems like there should be a refactoring since anything titled `FreeModule` should naturally expect to have a basis. Probably some common methods related to submodules need to be factored out to some `Module_generic` class and then the stuff for free modules is a subclass of that with your generic submodule code being in a separate branch of the class hierarchy. This might get rid of the bit of a code smell coming from allowing `rank=None` as input.

Done in the last commit. I used the name `FreeModule_base`, as the base class of modules whose elements are represented by elements of a free module. `FreeModule_generic` is such a base class but it is for modules with a basis. `FreeModule_base` are for modules without a basis.



---

archive/issue_comments_478173.json:
```json
{
    "body": "Replying to [comment:28 tscrim]:\n> It might be good to have a shortcut way to construct the morphism from the ambient free module into the submodule in order to do homological algebra.\n\nThere is no natural map from the ambient free module to a submodule. There is a natural coercion map from the ambient free module to a quotient. This map is really what I need for the free resolutions.",
    "created_at": "2022-06-09T04:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478173",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:28 tscrim]:
> It might be good to have a shortcut way to construct the morphism from the ambient free module into the submodule in order to do homological algebra.

There is no natural map from the ambient free module to a submodule. There is a natural coercion map from the ambient free module to a quotient. This map is really what I need for the free resolutions.



---

archive/issue_comments_478174.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-06-09T04:30:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478174",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_478175.json:
```json
{
    "body": "Replying to [comment:35 klee]:\n> Replying to [comment:28 tscrim]:\n> > It might be good to have a shortcut way to construct the morphism from the ambient free module into the submodule in order to do homological algebra.\n> \n> There is no natural map from the ambient free module to a submodule. There is a natural coercion map from the ambient free module to a quotient. This map is really what I need for the free resolutions.\n\nI think that was basically a typo: I think the suggestion was that it might be good to have a shortcut way to construct the morphism from the submodule to the ambient free module. The finitely presented module code, for example, rather than constructing a submodule `M` instead constructs the inclusion map `M -> F`.",
    "created_at": "2022-06-09T04:57:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478175",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:35 klee]:
> Replying to [comment:28 tscrim]:
> > It might be good to have a shortcut way to construct the morphism from the ambient free module into the submodule in order to do homological algebra.
> 
> There is no natural map from the ambient free module to a submodule. There is a natural coercion map from the ambient free module to a quotient. This map is really what I need for the free resolutions.

I think that was basically a typo: I think the suggestion was that it might be good to have a shortcut way to construct the morphism from the submodule to the ambient free module. The finitely presented module code, for example, rather than constructing a submodule `M` instead constructs the inclusion map `M -> F`.



---

archive/issue_comments_478176.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-09T06:52:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478176",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478177.json:
```json
{
    "body": "Replying to [comment:37 jhpalmieri]:\n> Replying to [comment:35 klee]:\n> > Replying to [comment:28 tscrim]:\n> > > It might be good to have a shortcut way to construct the morphism from the ambient free module into the submodule in order to do homological algebra.\n> > \n> > There is no natural map from the ambient free module to a submodule. There is a natural coercion map from the ambient free module to a quotient. This map is really what I need for the free resolutions.\n> \n> I think that was basically a typo: I think the suggestion was that it might be good to have a shortcut way to construct the morphism from the submodule to the ambient free module. The finitely presented module code, for example, rather than constructing a submodule `M` instead constructs the inclusion map `M -> F`.\n\nOkay. Now a submodule has a coercion map into the ambient free module.",
    "created_at": "2022-06-09T06:54:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478177",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:37 jhpalmieri]:
> Replying to [comment:35 klee]:
> > Replying to [comment:28 tscrim]:
> > > It might be good to have a shortcut way to construct the morphism from the ambient free module into the submodule in order to do homological algebra.
> > 
> > There is no natural map from the ambient free module to a submodule. There is a natural coercion map from the ambient free module to a quotient. This map is really what I need for the free resolutions.
> 
> I think that was basically a typo: I think the suggestion was that it might be good to have a shortcut way to construct the morphism from the submodule to the ambient free module. The finitely presented module code, for example, rather than constructing a submodule `M` instead constructs the inclusion map `M -> F`.

Okay. Now a submodule has a coercion map into the ambient free module.



---

archive/issue_comments_478178.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-09T07:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478178",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478179.json:
```json
{
    "body": "Still does not work well with free resolution code.",
    "created_at": "2022-06-09T07:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478179",
    "user": "https://github.com/kwankyu"
}
```

Still does not work well with free resolution code.



---

archive/issue_comments_478180.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-06-09T07:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478180",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_478181.json:
```json
{
    "body": "I was confused. Ready for review.",
    "created_at": "2022-06-09T07:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478181",
    "user": "https://github.com/kwankyu"
}
```

I was confused. Ready for review.



---

archive/issue_comments_478182.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-06-09T07:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478182",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_478183.json:
```json
{
    "body": "Thank you for doing the refactoring. I think this is better and reflects the mathematics.\n\nYes, that was a typo; I was also thinking of the morphism to the quotient module too.\n\nFrom the patchbot, you have some doctest failures:\n\n```\nsage -t --long --random-seed=[snip] src/sage/manifolds/chart.py  # 1 doctest failed\nsage -t --long --random-seed=[snip] src/sage/rings/padics/padic_generic_element.pyx  # 8 doctests failed\n```\n\n\nI am not sure I like the generic class called `FreeModule_base` as it suggests that it is a free module. Perhaps `ModuleWithAmbientFreeModule` (or `Module_with_free_ambient`)?\n\nDo we also want that class to have a `rank()` method? I feel like that should belong only to the free module subclasses.",
    "created_at": "2022-06-09T09:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478183",
    "user": "https://github.com/tscrim"
}
```

Thank you for doing the refactoring. I think this is better and reflects the mathematics.

Yes, that was a typo; I was also thinking of the morphism to the quotient module too.

From the patchbot, you have some doctest failures:

```
sage -t --long --random-seed=[snip] src/sage/manifolds/chart.py  # 1 doctest failed
sage -t --long --random-seed=[snip] src/sage/rings/padics/padic_generic_element.pyx  # 8 doctests failed
```


I am not sure I like the generic class called `FreeModule_base` as it suggests that it is a free module. Perhaps `ModuleWithAmbientFreeModule` (or `Module_with_free_ambient`)?

Do we also want that class to have a `rank()` method? I feel like that should belong only to the free module subclasses.



---

archive/issue_comments_478184.json:
```json
{
    "body": "Replying to [comment:43 tscrim]:\n> I am not sure I like the generic class called `FreeModule_base` as it suggests that it is a free module. Perhaps `ModuleWithAmbientFreeModule` (or `Module_with_free_ambient`)?\n\nJust `Module_free_ambient`?\n\n> Do we also want that class to have a `rank()` method? I feel like that should belong only to the free module subclasses.\n\nOkay. That is not necessary.",
    "created_at": "2022-06-09T10:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478184",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:43 tscrim]:
> I am not sure I like the generic class called `FreeModule_base` as it suggests that it is a free module. Perhaps `ModuleWithAmbientFreeModule` (or `Module_with_free_ambient`)?

Just `Module_free_ambient`?

> Do we also want that class to have a `rank()` method? I feel like that should belong only to the free module subclasses.

Okay. That is not necessary.



---

archive/issue_comments_478185.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-09T12:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478185",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478186.json:
```json
{
    "body": "I used uniformly `Module_free_ambient`, `Submodule_free_ambient`, `QuotientModule_free_ambient`.",
    "created_at": "2022-06-09T12:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478186",
    "user": "https://github.com/kwankyu"
}
```

I used uniformly `Module_free_ambient`, `Submodule_free_ambient`, `QuotientModule_free_ambient`.



---

archive/issue_comments_478187.json:
```json
{
    "body": "Thank you. Those are good names.\n\nThe patchbot Pyflakes is raising two issues. The second indicates one of the code paths does not have a doctest. This isn't strictly necessary, but if you know of a quick one to add, please do so.\n\nI think I am otherwise happy with this ticket (modulo some nitpicks regarding the mass formatting changes in this branch; I don't really like the extra blanklines between bulletpoint items, much less making a de facto standard through an unrelated ticket).",
    "created_at": "2022-06-13T05:26:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478187",
    "user": "https://github.com/tscrim"
}
```

Thank you. Those are good names.

The patchbot Pyflakes is raising two issues. The second indicates one of the code paths does not have a doctest. This isn't strictly necessary, but if you know of a quick one to add, please do so.

I think I am otherwise happy with this ticket (modulo some nitpicks regarding the mass formatting changes in this branch; I don't really like the extra blanklines between bulletpoint items, much less making a de facto standard through an unrelated ticket).



---

archive/issue_comments_478188.json:
```json
{
    "body": "Replying to [comment:47 tscrim]:\n> Thank you. Those are good names.\n> \n> The patchbot Pyflakes is raising two issues. The second indicates one of the code paths does not have a doctest. This isn't strictly necessary, but if you know of a quick one to add, please do so.\n\nBy \"the second\", you mean `'sage.misc.cachefunc.cached_method' imported but unused`? This is really an unused import. I removed it.\n\n> ... modulo some nitpicks regarding the mass formatting changes in this branch; \n\nSorry about those many tiny changes (and not so tiny reformatting of the modules documentation), not strictly related with this ticket. Hopefully they are all for better readability of source files (and the documentation).\n\n> I don't really like the extra blanklines between bulletpoint items, much less making a de facto standard through an unrelated ticket).\n\nI see. I guess you mean specifically the extra blankline in the `AUTHORS` section. I removed it.\n\nI did think the blanklines in `AUTHORS` section is standard. But as I now checked source files, they are not uniform in this matter. I do think there should be a standard though. But this ticket is not a place for the discussion.",
    "created_at": "2022-06-13T09:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478188",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:47 tscrim]:
> Thank you. Those are good names.
> 
> The patchbot Pyflakes is raising two issues. The second indicates one of the code paths does not have a doctest. This isn't strictly necessary, but if you know of a quick one to add, please do so.

By "the second", you mean `'sage.misc.cachefunc.cached_method' imported but unused`? This is really an unused import. I removed it.

> ... modulo some nitpicks regarding the mass formatting changes in this branch; 

Sorry about those many tiny changes (and not so tiny reformatting of the modules documentation), not strictly related with this ticket. Hopefully they are all for better readability of source files (and the documentation).

> I don't really like the extra blanklines between bulletpoint items, much less making a de facto standard through an unrelated ticket).

I see. I guess you mean specifically the extra blankline in the `AUTHORS` section. I removed it.

I did think the blanklines in `AUTHORS` section is standard. But as I now checked source files, they are not uniform in this matter. I do think there should be a standard though. But this ticket is not a place for the discussion.



---

archive/issue_comments_478189.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-13T09:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478189",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478190.json:
```json
{
    "body": "Replying to [comment:48 klee]:\n> Replying to [comment:47 tscrim]:\n> > Thank you. Those are good names.\n> > \n> > The patchbot Pyflakes is raising two issues. The second indicates one of the code paths does not have a doctest. This isn't strictly necessary, but if you know of a quick one to add, please do so.\n> \n> By \"the second\", you mean `'sage.misc.cachefunc.cached_method' imported but unused`? This is really an unused import. I removed it.\n\nSorry, I had transposed the two when I wrote my comment. It was the `FreeModule_base` that no longer existed with your refactoring and that code path in the quotient module comparison code.\n\n> > ... modulo some nitpicks regarding the mass formatting changes in this branch; \n> \n> Sorry about those many tiny changes (and not so tiny reformatting of the modules documentation), not strictly related with this ticket. Hopefully they are all for better readability of source files (and the documentation).\n\nI am not sure how much I agree, and there are a number of conventions being chosen. The first/title line capitalization and some of the other formatting things are another example of things I don't think we have standardized or discussed as a community. It is not so good that we don't have consistency in the doc. As a disclaimer, part of my agitation about this comes from the fact that these changes are not what I think it should be, which means you can just ignore my ranting about it.\n\n> > I don't really like the extra blanklines between bulletpoint items, much less making a de facto standard through an unrelated ticket).\n> \n> I see. I guess you mean specifically the extra blankline in the `AUTHORS` section. I removed it.\n\nNot just that but more broadly throughout the Sage documentation. However, we have not set any standard about this AFAIK.\n\n> I did think the blanklines in `AUTHORS` section is standard. But as I now checked source files, they are not uniform in this matter. I do think there should be a standard though. But this ticket is not a place for the discussion.  \n\nI remember the Sage dev guide not having this in its example before. Anyways, this is not the place to be deciding standards.",
    "created_at": "2022-06-14T05:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478190",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:48 klee]:
> Replying to [comment:47 tscrim]:
> > Thank you. Those are good names.
> > 
> > The patchbot Pyflakes is raising two issues. The second indicates one of the code paths does not have a doctest. This isn't strictly necessary, but if you know of a quick one to add, please do so.
> 
> By "the second", you mean `'sage.misc.cachefunc.cached_method' imported but unused`? This is really an unused import. I removed it.

Sorry, I had transposed the two when I wrote my comment. It was the `FreeModule_base` that no longer existed with your refactoring and that code path in the quotient module comparison code.

> > ... modulo some nitpicks regarding the mass formatting changes in this branch; 
> 
> Sorry about those many tiny changes (and not so tiny reformatting of the modules documentation), not strictly related with this ticket. Hopefully they are all for better readability of source files (and the documentation).

I am not sure how much I agree, and there are a number of conventions being chosen. The first/title line capitalization and some of the other formatting things are another example of things I don't think we have standardized or discussed as a community. It is not so good that we don't have consistency in the doc. As a disclaimer, part of my agitation about this comes from the fact that these changes are not what I think it should be, which means you can just ignore my ranting about it.

> > I don't really like the extra blanklines between bulletpoint items, much less making a de facto standard through an unrelated ticket).
> 
> I see. I guess you mean specifically the extra blankline in the `AUTHORS` section. I removed it.

Not just that but more broadly throughout the Sage documentation. However, we have not set any standard about this AFAIK.

> I did think the blanklines in `AUTHORS` section is standard. But as I now checked source files, they are not uniform in this matter. I do think there should be a standard though. But this ticket is not a place for the discussion.  

I remember the Sage dev guide not having this in its example before. Anyways, this is not the place to be deciding standards.



---

archive/issue_comments_478191.json:
```json
{
    "body": "Replying to [comment:51 tscrim]:\n> ... The first/title line capitalization and some of the other formatting things are another example of things I don't think we have standardized or discussed as a community. It is not so good that we don't have consistency in the doc. \n\nAt some point, I wished consistency in the formatting of the first line in the header of source files, as different formats used by different authors really made the tables of contents of our html documentation look ugly. So in some ticket, I put the \"standard\" header format into the developer manual: \n\nhttps://doc.sagemath.org/html/en/developer/coding_basics.html#headings-of-sage-library-code-files\n\nBut as far as I remember this was not openly discussed in the sage-devel. If you think the format suggested in the developer manual is not \"right\" in some way (like the blanklines in the `AUTHOR` section), please open a discussion there. It would be good that we have a standard that most developers agree.",
    "created_at": "2022-06-14T06:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478191",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:51 tscrim]:
> ... The first/title line capitalization and some of the other formatting things are another example of things I don't think we have standardized or discussed as a community. It is not so good that we don't have consistency in the doc. 

At some point, I wished consistency in the formatting of the first line in the header of source files, as different formats used by different authors really made the tables of contents of our html documentation look ugly. So in some ticket, I put the "standard" header format into the developer manual: 

https://doc.sagemath.org/html/en/developer/coding_basics.html#headings-of-sage-library-code-files

But as far as I remember this was not openly discussed in the sage-devel. If you think the format suggested in the developer manual is not "right" in some way (like the blanklines in the `AUTHOR` section), please open a discussion there. It would be good that we have a standard that most developers agree.



---

archive/issue_comments_478192.json:
```json
{
    "body": "Indeed, I should do that so we can set a standard.\n\nOnto some more technical parts of the review:\n\n- Why not have `Module_free_ambient` use the richcmp? I feel like the comparison method makes sense in the non-free case.\n- You should add doctests for the `__init__` method you added. Ideally, it should be both, but one of them is just moved and not necessary.\n- Some doc formatting:\n  {{{#!diff\n-    - ``sparse`` -- bool (default: False)\n+    - ``sparse`` -- boolean (default: ``False``)\n \n- ``coordinate_ring`` -- a ring containing ``base_ring``\n  (default: equal to ``base_ring``)\n \n-    - ``category`` -- category (default: None)\n+    - ``category`` -- category (default: ``None``)\n  }}}",
    "created_at": "2022-06-14T07:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478192",
    "user": "https://github.com/tscrim"
}
```

Indeed, I should do that so we can set a standard.

Onto some more technical parts of the review:

- Why not have `Module_free_ambient` use the richcmp? I feel like the comparison method makes sense in the non-free case.
- You should add doctests for the `__init__` method you added. Ideally, it should be both, but one of them is just moved and not necessary.
- Some doc formatting:
  {{{#!diff
-    - ``sparse`` -- bool (default: False)
+    - ``sparse`` -- boolean (default: ``False``)
 
- ``coordinate_ring`` -- a ring containing ``base_ring``
  (default: equal to ``base_ring``)
 
-    - ``category`` -- category (default: None)
+    - ``category`` -- category (default: ``None``)
  }}}



---

archive/issue_comments_478193.json:
```json
{
    "body": "Replying to [comment:53 tscrim]:\n\n> - Why not have `Module_free_ambient` use the richcmp? I feel like the comparison method makes sense in the non-free case.\n\nThe `__richcmp__` method of `FreeModule_generic` is sophisticated (depends on the rank notion and echelon form). So for `Module_free_ambient`, I should make up a new comparison method. Submodules and quotients are also subclasses of `Module_free_ambient`. For these modules, it is not possible even to check containment just using generators. I cannot imagine an easy comparison method that makes sense for all these modules.",
    "created_at": "2022-06-14T08:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478193",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:53 tscrim]:

> - Why not have `Module_free_ambient` use the richcmp? I feel like the comparison method makes sense in the non-free case.

The `__richcmp__` method of `FreeModule_generic` is sophisticated (depends on the rank notion and echelon form). So for `Module_free_ambient`, I should make up a new comparison method. Submodules and quotients are also subclasses of `Module_free_ambient`. For these modules, it is not possible even to check containment just using generators. I cannot imagine an easy comparison method that makes sense for all these modules.



---

archive/issue_comments_478194.json:
```json
{
    "body": "Replying to [comment:54 klee]:\n> For these modules, it is not possible even to check containment just using generators. \n\nThis is possible if the base ring is a multivariate polynomial ring, using Groebner bases. For general rings, I think there is no meaningful equality check (for submodules).",
    "created_at": "2022-06-14T08:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478194",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:54 klee]:
> For these modules, it is not possible even to check containment just using generators. 

This is possible if the base ring is a multivariate polynomial ring, using Groebner bases. For general rings, I think there is no meaningful equality check (for submodules).



---

archive/issue_comments_478195.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-14T08:40:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478195",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478196.json:
```json
{
    "body": "Replying to [comment:53 tscrim]:\n> - You should add doctests for the `__init__` method you added. \n\nDone.\n\n> Ideally, it should be both, but one of them is just moved and not necessary.\n\nI don't understand...\n\n> - Some doc formatting: ...\n\nDone. There are many of these. I tried to fix as many as I can spot. Hence more tiny changes :)",
    "created_at": "2022-06-14T08:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478196",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:53 tscrim]:
> - You should add doctests for the `__init__` method you added. 

Done.

> Ideally, it should be both, but one of them is just moved and not necessary.

I don't understand...

> - Some doc formatting: ...

Done. There are many of these. I tried to fix as many as I can spot. Hence more tiny changes :)



---

archive/issue_comments_478197.json:
```json
{
    "body": "Replying to [comment:57 klee]:\n> Replying to [comment:53 tscrim]:\n> > - You should add doctests for the `__init__` method you added. \n> \n> Done.\n\nThank you.\n\n> > Ideally, it should be both, but one of them is just moved and not necessary.\n> \n> I don't understand...\n\nThere was another `__init__()` method that you moved from the refactoring that doesn't have any doctests. Anyways, since it was already like that, you don't need to do anything.\n\n> > - Some doc formatting: ...\n> \n> Done. There are many of these. I tried to fix as many as I can spot. Hence more tiny changes :)\n\nThanks. However, these are directly affected docstrings by the refactoring. `:)`",
    "created_at": "2022-06-14T08:57:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478197",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:57 klee]:
> Replying to [comment:53 tscrim]:
> > - You should add doctests for the `__init__` method you added. 
> 
> Done.

Thank you.

> > Ideally, it should be both, but one of them is just moved and not necessary.
> 
> I don't understand...

There was another `__init__()` method that you moved from the refactoring that doesn't have any doctests. Anyways, since it was already like that, you don't need to do anything.

> > - Some doc formatting: ...
> 
> Done. There are many of these. I tried to fix as many as I can spot. Hence more tiny changes :)

Thanks. However, these are directly affected docstrings by the refactoring. `:)`



---

archive/issue_comments_478198.json:
```json
{
    "body": "Replying to [comment:54 klee]:\n> Replying to [comment:53 tscrim]:\n> \n> > - Why not have `Module_free_ambient` use the richcmp? I feel like the comparison method makes sense in the non-free case.\n> \n> The `__richcmp__` method of `FreeModule_generic` is sophisticated (depends on the rank notion and echelon form). So for `Module_free_ambient`, I should make up a new comparison method. Submodules and quotients are also subclasses of `Module_free_ambient`. For these modules, it is not possible even to check containment just using generators. I cannot imagine an easy comparison method that makes sense for all these modules.\n\nIt doesn't have to work correctly in all cases (although the fact we don't have an `Unknown` return type possible makes a `False` slightly annoying). Although the generic `__richcmp__()` that redirects to other methods would still lift up, then the `_eq()` and `is_submodule()` could do some simple checks and otherwise return a `NotImplemented`. For this ticket, it doesn't have to be anything sophisticated. I could possibly do this tomorrow.",
    "created_at": "2022-06-14T09:07:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478198",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:54 klee]:
> Replying to [comment:53 tscrim]:
> 
> > - Why not have `Module_free_ambient` use the richcmp? I feel like the comparison method makes sense in the non-free case.
> 
> The `__richcmp__` method of `FreeModule_generic` is sophisticated (depends on the rank notion and echelon form). So for `Module_free_ambient`, I should make up a new comparison method. Submodules and quotients are also subclasses of `Module_free_ambient`. For these modules, it is not possible even to check containment just using generators. I cannot imagine an easy comparison method that makes sense for all these modules.

It doesn't have to work correctly in all cases (although the fact we don't have an `Unknown` return type possible makes a `False` slightly annoying). Although the generic `__richcmp__()` that redirects to other methods would still lift up, then the `_eq()` and `is_submodule()` could do some simple checks and otherwise return a `NotImplemented`. For this ticket, it doesn't have to be anything sophisticated. I could possibly do this tomorrow.



---

archive/issue_comments_478199.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-15T04:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478199",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478200.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-16T00:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478200",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478201.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-20T07:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478201",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478202.json:
```json
{
    "body": "Replying to [comment:59 tscrim]:\n> It doesn't have to work correctly in all cases (although the fact we don't have an `Unknown` return type possible makes a `False` slightly annoying).\n\nI don't know if we have an agreement. I guess I would prefer to have either `NotImplemented` exception or only `True` or `False` return values...\n\n> Although the generic `__richcmp__()` that redirects to other methods would still lift up, then the `_eq()` and `is_submodule()` could do some simple checks and otherwise return a `NotImplemented`. For this ticket, it doesn't have to be anything sophisticated.\n\nI think those could be implemented in subclasses of `Module_free_ambient`, in future. \n \n> I could possibly do this tomorrow.\n\nWould you?",
    "created_at": "2022-06-20T07:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478202",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:59 tscrim]:
> It doesn't have to work correctly in all cases (although the fact we don't have an `Unknown` return type possible makes a `False` slightly annoying).

I don't know if we have an agreement. I guess I would prefer to have either `NotImplemented` exception or only `True` or `False` return values...

> Although the generic `__richcmp__()` that redirects to other methods would still lift up, then the `_eq()` and `is_submodule()` could do some simple checks and otherwise return a `NotImplemented`. For this ticket, it doesn't have to be anything sophisticated.

I think those could be implemented in subclasses of `Module_free_ambient`, in future. 
 
> I could possibly do this tomorrow.

Would you?



---

archive/issue_comments_478203.json:
```json
{
    "body": "Here is a version that makes some feeble attempt at comparisons for general modules. With the first commit, all (short) tests pass in the modules folder. I haven't really tested this to see what it is capable of or if there are any bugs (I have been trying to figure out the issue below).\n\n----\n\nIn the second comment, I tried to use inheritance to try and streamline the code and reduce bloat. However, I get one error (and two errors that follow from this):\n\n```\nsage -t --warn-long 41.3 --random-seed=225430021128322878573582192201316989060 fp_graded/morphism.py\n**********************************************************************\nFile \"fp_graded/morphism.py\", line 1331, in sage.modules.fp_graded.morphism.FPModuleMorphism.homology\nFailed example:\n    ho = f.homology(g)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/travis/sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/travis/sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.modules.fp_graded.morphism.FPModuleMorphism.homology[7]>\", line 1, in <module>\n        ho = f.homology(g)\n      File \"/home/travis/sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage/modules/fp_graded/morphism.py\", line 1341, in homology\n        raise ValueError('the image of the given homomorphism is not contained '\n    ValueError: the image of the given homomorphism is not contained in the kernel of this homomorphism; the homology is therefore not defined for this pair of maps\n```\n\n`@`jhpalmieri I have cc-ed you to see if you have an idea about what could be causing this. I am stuck as the output of the different quotient modules seems to be the same. I don't know how that is working well enough to be able to debug it further.\n\nIf we have no idea what is causing this, we can simply revert the last commit.\n----\nNew commits:",
    "created_at": "2022-06-21T04:27:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478203",
    "user": "https://github.com/tscrim"
}
```

Here is a version that makes some feeble attempt at comparisons for general modules. With the first commit, all (short) tests pass in the modules folder. I haven't really tested this to see what it is capable of or if there are any bugs (I have been trying to figure out the issue below).

----

In the second comment, I tried to use inheritance to try and streamline the code and reduce bloat. However, I get one error (and two errors that follow from this):

```
sage -t --warn-long 41.3 --random-seed=225430021128322878573582192201316989060 fp_graded/morphism.py
**********************************************************************
File "fp_graded/morphism.py", line 1331, in sage.modules.fp_graded.morphism.FPModuleMorphism.homology
Failed example:
    ho = f.homology(g)
Exception raised:
    Traceback (most recent call last):
      File "/home/travis/sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/travis/sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.modules.fp_graded.morphism.FPModuleMorphism.homology[7]>", line 1, in <module>
        ho = f.homology(g)
      File "/home/travis/sage/local/var/lib/sage/venv-python3.10.3/lib/python3.10/site-packages/sage/modules/fp_graded/morphism.py", line 1341, in homology
        raise ValueError('the image of the given homomorphism is not contained '
    ValueError: the image of the given homomorphism is not contained in the kernel of this homomorphism; the homology is therefore not defined for this pair of maps
```

`@`jhpalmieri I have cc-ed you to see if you have an idea about what could be causing this. I am stuck as the output of the different quotient modules seems to be the same. I don't know how that is working well enough to be able to debug it further.

If we have no idea what is causing this, we can simply revert the last commit.
----
New commits:



---

archive/issue_comments_478204.json:
```json
{
    "body": "\n```sage\nsage: P.<x,y> = QQ[]\nsage: M = P**2\nsage: S1 = M.submodule([(x,y),(y,x)])\nsage: S2 = M.submodule([(x,y),(y-x,x-y)])\nsage: S1 == S2\nFalse\n```\n",
    "created_at": "2022-06-21T05:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478204",
    "user": "https://github.com/kwankyu"
}
```


```sage
sage: P.<x,y> = QQ[]
sage: M = P**2
sage: S1 = M.submodule([(x,y),(y,x)])
sage: S2 = M.submodule([(x,y),(y-x,x-y)])
sage: S1 == S2
False
```




---

archive/issue_comments_478205.json:
```json
{
    "body": "That is because I didn't remove the `is_submodule()`. Although removing that causes some other issues to fix... I should be able to do something quick about it.",
    "created_at": "2022-06-21T05:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478205",
    "user": "https://github.com/tscrim"
}
```

That is because I didn't remove the `is_submodule()`. Although removing that causes some other issues to fix... I should be able to do something quick about it.



---

archive/issue_comments_478206.json:
```json
{
    "body": "Replying to [comment:66 tscrim]:\n> That is because I didn't remove the `is_submodule()`. Although removing that causes some other issues to fix... I should be able to do something quick about it.\n\nThen would we get correct result (`True`)?",
    "created_at": "2022-06-21T05:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478206",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:66 tscrim]:
> That is because I didn't remove the `is_submodule()`. Although removing that causes some other issues to fix... I should be able to do something quick about it.

Then would we get correct result (`True`)?



---

archive/issue_comments_478207.json:
```json
{
    "body": "If we do not assume that the base ring is a field or at least PID, we don't have much to do in comparing `Module_free_ambient` modules. I think an attempt to provide `__richcmp__` that works both for `Module_free_ambient` and `FreeModule_generic` would easily fail. \n\nA subclass of `Module_free_ambient` can work with more specific `Module_free_ambient` modules, like submodules, quotient modules, or subquotient modules (not yet implemented) of free ambient modules. These subclasses could implement `__richcmp__` using Groebner bases on firm mathematical ground.",
    "created_at": "2022-06-21T05:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478207",
    "user": "https://github.com/kwankyu"
}
```

If we do not assume that the base ring is a field or at least PID, we don't have much to do in comparing `Module_free_ambient` modules. I think an attempt to provide `__richcmp__` that works both for `Module_free_ambient` and `FreeModule_generic` would easily fail. 

A subclass of `Module_free_ambient` can work with more specific `Module_free_ambient` modules, like submodules, quotient modules, or subquotient modules (not yet implemented) of free ambient modules. These subclasses could implement `__richcmp__` using Groebner bases on firm mathematical ground.



---

archive/issue_comments_478208.json:
```json
{
    "body": "Replying to [comment:68 klee]:\n> A subclass of `Module_free_ambient` can work with more specific `Module_free_ambient` modules, like submodules, quotient modules, or subquotient modules (not yet implemented) of free ambient modules. These subclasses could implement `__richcmp__` using Groebner bases on firm mathematical ground.   \n\nOnly when the base ring is a multivariate polynomial ring. For a general ring, I have no idea...",
    "created_at": "2022-06-21T05:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478208",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:68 klee]:
> A subclass of `Module_free_ambient` can work with more specific `Module_free_ambient` modules, like submodules, quotient modules, or subquotient modules (not yet implemented) of free ambient modules. These subclasses could implement `__richcmp__` using Groebner bases on firm mathematical ground.   

Only when the base ring is a multivariate polynomial ring. For a general ring, I have no idea...



---

archive/issue_comments_478209.json:
```json
{
    "body": "What we should get is also `S1 != S2` returning `False`. Again, this is an issue because we don't have an `Unknown` return option. We can check a number of simple cases. Stop thinking that not implementing this means that comparison doesn't work; it just completely compares by identity.",
    "created_at": "2022-06-21T05:41:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478209",
    "user": "https://github.com/tscrim"
}
```

What we should get is also `S1 != S2` returning `False`. Again, this is an issue because we don't have an `Unknown` return option. We can check a number of simple cases. Stop thinking that not implementing this means that comparison doesn't work; it just completely compares by identity.



---

archive/issue_comments_478210.json:
```json
{
    "body": "Sorry, that was a snappy of a response. What I was trying to express is that we can do some things that are somewhat trivial but we can still do. Partially correct answers are better than nothing IMO. It isn't hard to make this work. I am just bug-fixing right now trying to expand what it can do with quotient modules. I might just give up on that though.",
    "created_at": "2022-06-21T06:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478210",
    "user": "https://github.com/tscrim"
}
```

Sorry, that was a snappy of a response. What I was trying to express is that we can do some things that are somewhat trivial but we can still do. Partially correct answers are better than nothing IMO. It isn't hard to make this work. I am just bug-fixing right now trying to expand what it can do with quotient modules. I might just give up on that though.



---

archive/issue_comments_478211.json:
```json
{
    "body": "One wrinkle in the current implementation is the ambient module of a quotient module:\n\n```\nsage: k.<a> = GF(9); A = k^3; V = A.span_of_basis([[1,0,a], [a,a,1]]); W = V.span([V.1])\nsage: Q = V/W\nsage: Q.ambient_module() is Q\nTrue\n```\n\n\nAh, this might be my bug in comment:64: it has a mismatch with the ambient spaces being created.",
    "created_at": "2022-06-21T06:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478211",
    "user": "https://github.com/tscrim"
}
```

One wrinkle in the current implementation is the ambient module of a quotient module:

```
sage: k.<a> = GF(9); A = k^3; V = A.span_of_basis([[1,0,a], [a,a,1]]); W = V.span([V.1])
sage: Q = V/W
sage: Q.ambient_module() is Q
True
```


Ah, this might be my bug in comment:64: it has a mismatch with the ambient spaces being created.



---

archive/issue_comments_478212.json:
```json
{
    "body": "Replying to [comment:71 tscrim]:\n> What I was trying to express is that we can do some things that are somewhat trivial but we can still do. Partially correct answers are better than nothing IMO. \n\nWe may have a separate `__richcmp__` for `Module_free_ambient`, that does the simple cases. As you say, there are obvious cases that can answer `True` or `False`. In other cases, we may raise an exception.",
    "created_at": "2022-06-21T06:06:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478212",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:71 tscrim]:
> What I was trying to express is that we can do some things that are somewhat trivial but we can still do. Partially correct answers are better than nothing IMO. 

We may have a separate `__richcmp__` for `Module_free_ambient`, that does the simple cases. As you say, there are obvious cases that can answer `True` or `False`. In other cases, we may raise an exception.



---

archive/issue_comments_478213.json:
```json
{
    "body": "Raising exceptions during equality checks is really dangerous. The key example is a `dict` that has a hash collision.",
    "created_at": "2022-06-21T06:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478213",
    "user": "https://github.com/tscrim"
}
```

Raising exceptions during equality checks is really dangerous. The key example is a `dict` that has a hash collision.



---

archive/issue_comments_478214.json:
```json
{
    "body": "Replying to [comment:74 tscrim]:\n> Raising exceptions during equality checks is really dangerous. \n\nThen I wonder what is the convention in sage for this situation that we can answer correctly for simple cases, but not (or take too much time to get answer) for most other cases. Do we just return `None`? Perhaps there was a discussion in sage-devel before...",
    "created_at": "2022-06-21T06:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478214",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:74 tscrim]:
> Raising exceptions during equality checks is really dangerous. 

Then I wonder what is the convention in sage for this situation that we can answer correctly for simple cases, but not (or take too much time to get answer) for most other cases. Do we just return `None`? Perhaps there was a discussion in sage-devel before...



---

archive/issue_comments_478215.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-21T07:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478215",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478216.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-21T07:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478216",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478217.json:
```json
{
    "body": "Unfortunately `__eq__` cannot return anything other than `True` or `False`.\n\nSo I have hacked around some issues: In particular, submodules of a quotient module and the free module should not be comparable. So I have a `defining_module()` attribute so there is no confusion with `ambient_module()`. It leads to some fairly ugly code, but it was the easiest thing to do without further doing major overhauls. I also moved up the `submodule()` and `span()` code as they work in more generality. The code is telling me that it should just override `ambient_module()`. However, then the ambient module for quotients will need some care, and likely the comparison code too. What are your thoughts about this?\n\nThe only thing left is to file those doctest failures in `fp_graded/morphism.py`. The issue is not the ambient space it seems. I have no idea whatsoever. `:/`",
    "created_at": "2022-06-21T07:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478217",
    "user": "https://github.com/tscrim"
}
```

Unfortunately `__eq__` cannot return anything other than `True` or `False`.

So I have hacked around some issues: In particular, submodules of a quotient module and the free module should not be comparable. So I have a `defining_module()` attribute so there is no confusion with `ambient_module()`. It leads to some fairly ugly code, but it was the easiest thing to do without further doing major overhauls. I also moved up the `submodule()` and `span()` code as they work in more generality. The code is telling me that it should just override `ambient_module()`. However, then the ambient module for quotients will need some care, and likely the comparison code too. What are your thoughts about this?

The only thing left is to file those doctest failures in `fp_graded/morphism.py`. The issue is not the ambient space it seems. I have no idea whatsoever. `:/`



---

archive/issue_comments_478218.json:
```json
{
    "body": "Replying to [comment:78 tscrim]:\n> So I have hacked around some issues: In particular, submodules of a quotient module and the free module should not be comparable. So I have a `defining_module()` attribute so there is no confusion with `ambient_module()`. It leads to some fairly ugly code, but it was the easiest thing to do without further doing major overhauls. I also moved up the `submodule()` and `span()` code as they work in more generality. The code is telling me that it should just override `ambient_module()`. However, then the ambient module for quotients will need some care, and likely the comparison code too. What are your thoughts about this?\n\nI cannot answer yet. You made lots of changes. With these changes (over my code), what do we achieve? Would you give some examples here? Some comparisons worked (correct or not. for instance, the above `S1` and `S2`) before your changes. What have changed?\n\n> The only thing left is to file those doctest failures in `fp_graded/morphism.py`. The issue is not the ambient space it seems. I have no idea whatsoever. `:/`\n\nIt seems that comparison of submodules is broken...",
    "created_at": "2022-06-21T07:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478218",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:78 tscrim]:
> So I have hacked around some issues: In particular, submodules of a quotient module and the free module should not be comparable. So I have a `defining_module()` attribute so there is no confusion with `ambient_module()`. It leads to some fairly ugly code, but it was the easiest thing to do without further doing major overhauls. I also moved up the `submodule()` and `span()` code as they work in more generality. The code is telling me that it should just override `ambient_module()`. However, then the ambient module for quotients will need some care, and likely the comparison code too. What are your thoughts about this?

I cannot answer yet. You made lots of changes. With these changes (over my code), what do we achieve? Would you give some examples here? Some comparisons worked (correct or not. for instance, the above `S1` and `S2`) before your changes. What have changed?

> The only thing left is to file those doctest failures in `fp_graded/morphism.py`. The issue is not the ambient space it seems. I have no idea whatsoever. `:/`

It seems that comparison of submodules is broken...



---

archive/issue_comments_478219.json:
```json
{
    "body": "Replying to [comment:79 klee]:\n> Replying to [comment:78 tscrim]:\n> > So I have hacked around some issues: In particular, submodules of a quotient module and the free module should not be comparable. So I have a `defining_module()` attribute so there is no confusion with `ambient_module()`. It leads to some fairly ugly code, but it was the easiest thing to do without further doing major overhauls. I also moved up the `submodule()` and `span()` code as they work in more generality. The code is telling me that it should just override `ambient_module()`. However, then the ambient module for quotients will need some care, and likely the comparison code too. What are your thoughts about this?\n> \n> I cannot answer yet. You made lots of changes. With these changes (over my code), what do we achieve? Would you give some examples here? Some comparisons worked (correct or not. for instance, the above `S1` and `S2`) before your changes. What have changed?\n\n- Degree 1 submodules now compare correctly:\n  {{{\nsage: S.<x,y,z> = PolynomialRing(QQ)\nsage: M = S**1\nsage: N2 = M.submodule([M([x^2]), M([y^2])])\nsage: N1 = M.submodule([M([x]), M([y])])\nsage: N2.is_submodule(N1)\nTrue\nsage: N2 < N1\nTrue\nsage: N1 < N2\nFalse\n  }}}\n- Zero submodules now also compare correctly too.\n- Things are also prepared to implement more specialized comparisons, such as modules over polynomial rings (although some minor refactoring might be needed to avoid code duplication).\n- The `is_submodule()` is used for comparisons.\n- I don't understand your comment about `S1` and `S2`. That returns `False` with your branch for me.\n\nI believe we can push the comparison code a bit further by rejecting the modules that do not have containment with extension of scalars over the fraction field.\n\n> > The only thing left is to file those doctest failures in `fp_graded/morphism.py`. The issue is not the ambient space it seems. I have no idea whatsoever. `:/`\n> \n> It seems that comparison of submodules is broken... \n\nI don't think you can conclude that from the above, nor do I think that is the problem. I do not get this failure when only changing the comparison code. It only happens when I make the free quotient a subclass of the generic quotient. To me, this seems to be a very subtle behavior change in the quotient module, but I cannot see what actually changes.",
    "created_at": "2022-06-21T08:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478219",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:79 klee]:
> Replying to [comment:78 tscrim]:
> > So I have hacked around some issues: In particular, submodules of a quotient module and the free module should not be comparable. So I have a `defining_module()` attribute so there is no confusion with `ambient_module()`. It leads to some fairly ugly code, but it was the easiest thing to do without further doing major overhauls. I also moved up the `submodule()` and `span()` code as they work in more generality. The code is telling me that it should just override `ambient_module()`. However, then the ambient module for quotients will need some care, and likely the comparison code too. What are your thoughts about this?
> 
> I cannot answer yet. You made lots of changes. With these changes (over my code), what do we achieve? Would you give some examples here? Some comparisons worked (correct or not. for instance, the above `S1` and `S2`) before your changes. What have changed?

- Degree 1 submodules now compare correctly:
  {{{
sage: S.<x,y,z> = PolynomialRing(QQ)
sage: M = S**1
sage: N2 = M.submodule([M([x^2]), M([y^2])])
sage: N1 = M.submodule([M([x]), M([y])])
sage: N2.is_submodule(N1)
True
sage: N2 < N1
True
sage: N1 < N2
False
  }}}
- Zero submodules now also compare correctly too.
- Things are also prepared to implement more specialized comparisons, such as modules over polynomial rings (although some minor refactoring might be needed to avoid code duplication).
- The `is_submodule()` is used for comparisons.
- I don't understand your comment about `S1` and `S2`. That returns `False` with your branch for me.

I believe we can push the comparison code a bit further by rejecting the modules that do not have containment with extension of scalars over the fraction field.

> > The only thing left is to file those doctest failures in `fp_graded/morphism.py`. The issue is not the ambient space it seems. I have no idea whatsoever. `:/`
> 
> It seems that comparison of submodules is broken... 

I don't think you can conclude that from the above, nor do I think that is the problem. I do not get this failure when only changing the comparison code. It only happens when I make the free quotient a subclass of the generic quotient. To me, this seems to be a very subtle behavior change in the quotient module, but I cannot see what actually changes.



---

archive/issue_comments_478220.json:
```json
{
    "body": "Replying to [comment:80 tscrim]:\n> - I don't understand your comment about `S1` and `S2`. That returns `False` with your branch for me.\n\nI meant that :)\n\n> > It seems that comparison of submodules is broken... \n> \n> I don't think you can conclude that from the above, nor do I think that is the problem. I do not get this failure when only changing the comparison code. It only happens when I make the free quotient a subclass of the generic quotient. \n\nI see.",
    "created_at": "2022-06-21T08:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478220",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:80 tscrim]:
> - I don't understand your comment about `S1` and `S2`. That returns `False` with your branch for me.

I meant that :)

> > It seems that comparison of submodules is broken... 
> 
> I don't think you can conclude that from the above, nor do I think that is the problem. I do not get this failure when only changing the comparison code. It only happens when I make the free quotient a subclass of the generic quotient. 

I see.



---

archive/issue_comments_478221.json:
```json
{
    "body": "Replying to [comment:81 klee]:\n> Replying to [comment:80 tscrim]:\n> > - I don't understand your comment about `S1` and `S2`. That returns `False` with your branch for me.\n> \n> I meant that :)\n\nAh, now `S1 != S2` also returns `False`.\n\n> > > It seems that comparison of submodules is broken... \n> > \n> > I don't think you can conclude that from the above, nor do I think that is the problem. I do not get this failure when only changing the comparison code. It only happens when I make the free quotient a subclass of the generic quotient. \n> \n> I see.\n\nIt somehow seems to be loosing one additional coercion check:\n\n```\nchecking _coerce_map_from_ Vector space of dimension 1 over Finite Field of size 2\nself: Vector space quotient V/W of dimension 1 over Finite Field of size 2 where\nV: Vector space of dimension 2 over Finite Field of size 2\nW: Vector space of degree 2 and dimension 1 over Finite Field of size 2\nBasis matrix:\n[1 0]\n```\n\nI see that this is missing against `develop` by adding a `print()` inside the quotient's `_coerce_map_from_`. (I even checked with using the same constructor as the `develop` version and making sure the `super()` calls are correct too.) The MRO only differs in the added classes marked with a `#`:\n\n```\nsage: A = QQ^5; V = A.span_of_basis([[1,0,-1,1,1], [1,-1,0,2/3,3/4]]); W = V.span_of_basis([V.0 - 2/3*V.1]); Q = V / W\nsage: Q.__class__.__mro__\n(<class 'sage.modules.quotient_module.FreeModule_ambient_field_quotient_with_category'>,\n <class 'sage.modules.quotient_module.FreeModule_ambient_field_quotient'>,\n <class 'sage.modules.free_module.FreeModule_ambient_field'>,\n <class 'sage.modules.free_module.FreeModule_generic_field'>,\n <class 'sage.modules.free_module.FreeModule_ambient_pid'>,\n <class 'sage.modules.free_module.FreeModule_generic_pid'>,\n <class 'sage.modules.free_module.FreeModule_ambient_domain'>,\n <class 'sage.modules.free_module.FreeModule_generic_domain'>,  #\n <class 'sage.modules.free_module.FreeModule_ambient'>,\n <class 'sage.modules.free_module.FreeModule_generic'>,\n <class 'sage.modules.quotient_module.QuotientModule_free_ambient'>,  #\n <class 'sage.modules.free_module.Module_free_ambient'>,  #\n```\n\n\nI am out of ideas for this today.",
    "created_at": "2022-06-21T09:15:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478221",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:81 klee]:
> Replying to [comment:80 tscrim]:
> > - I don't understand your comment about `S1` and `S2`. That returns `False` with your branch for me.
> 
> I meant that :)

Ah, now `S1 != S2` also returns `False`.

> > > It seems that comparison of submodules is broken... 
> > 
> > I don't think you can conclude that from the above, nor do I think that is the problem. I do not get this failure when only changing the comparison code. It only happens when I make the free quotient a subclass of the generic quotient. 
> 
> I see.

It somehow seems to be loosing one additional coercion check:

```
checking _coerce_map_from_ Vector space of dimension 1 over Finite Field of size 2
self: Vector space quotient V/W of dimension 1 over Finite Field of size 2 where
V: Vector space of dimension 2 over Finite Field of size 2
W: Vector space of degree 2 and dimension 1 over Finite Field of size 2
Basis matrix:
[1 0]
```

I see that this is missing against `develop` by adding a `print()` inside the quotient's `_coerce_map_from_`. (I even checked with using the same constructor as the `develop` version and making sure the `super()` calls are correct too.) The MRO only differs in the added classes marked with a `#`:

```
sage: A = QQ^5; V = A.span_of_basis([[1,0,-1,1,1], [1,-1,0,2/3,3/4]]); W = V.span_of_basis([V.0 - 2/3*V.1]); Q = V / W
sage: Q.__class__.__mro__
(<class 'sage.modules.quotient_module.FreeModule_ambient_field_quotient_with_category'>,
 <class 'sage.modules.quotient_module.FreeModule_ambient_field_quotient'>,
 <class 'sage.modules.free_module.FreeModule_ambient_field'>,
 <class 'sage.modules.free_module.FreeModule_generic_field'>,
 <class 'sage.modules.free_module.FreeModule_ambient_pid'>,
 <class 'sage.modules.free_module.FreeModule_generic_pid'>,
 <class 'sage.modules.free_module.FreeModule_ambient_domain'>,
 <class 'sage.modules.free_module.FreeModule_generic_domain'>,  #
 <class 'sage.modules.free_module.FreeModule_ambient'>,
 <class 'sage.modules.free_module.FreeModule_generic'>,
 <class 'sage.modules.quotient_module.QuotientModule_free_ambient'>,  #
 <class 'sage.modules.free_module.Module_free_ambient'>,  #
```


I am out of ideas for this today.



---

archive/issue_comments_478222.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-22T00:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478222",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478223.json:
```json
{
    "body": "I just reverted the change since doctests pass. We can spend time improving this later if we need to. I am still not very happy about the `defining_module()` hack, but that can be revisited if this isn't robust enough. If you want to rework things here and now, we can, but we then need a little more robust of a plan on how to structure things and think about it from a higher level.",
    "created_at": "2022-06-22T00:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478223",
    "user": "https://github.com/tscrim"
}
```

I just reverted the change since doctests pass. We can spend time improving this later if we need to. I am still not very happy about the `defining_module()` hack, but that can be revisited if this isn't robust enough. If you want to rework things here and now, we can, but we then need a little more robust of a plan on how to structure things and think about it from a higher level.



---

archive/issue_comments_478224.json:
```json
{
    "body": "Replying to [comment:84 tscrim]:\n> I just reverted the change since doctests pass. We can spend time improving this later if we need to. I am still not very happy about the `defining_module()` hack, but that can be revisited if this isn't robust enough. \n\nYou added `defining_module()` as a public method. What is the \"defining module\" of a submodule from a user's perspective? It should be something different from `ambient_module()`.\n\nYou added `submodule()` of `QuotientModule_free_ambient`. It should return a submodule of a quotient module, but it returns an instance of `Submodule_free_ambient`. For submodules of a quotient module, we should have a new class `Subquotient_free_ambient` (as in Macaulay2), but this is not yet implemented. \n\n> If you want to rework things here and now, we can, but we then need a little more robust of a plan on how to structure things and think about it from a higher level.\n\nFrankly I want to revert back to my last commit, as `__richcmp__` for `Module_free_ambient` is not a prerequisite but a missing feature. It would be great to have `__richcmp__` method but as you say, we should think more from a higher level to avoid introducing inadequate hacks. We may open a new ticket for `__richcmp__`.",
    "created_at": "2022-06-22T03:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478224",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:84 tscrim]:
> I just reverted the change since doctests pass. We can spend time improving this later if we need to. I am still not very happy about the `defining_module()` hack, but that can be revisited if this isn't robust enough. 

You added `defining_module()` as a public method. What is the "defining module" of a submodule from a user's perspective? It should be something different from `ambient_module()`.

You added `submodule()` of `QuotientModule_free_ambient`. It should return a submodule of a quotient module, but it returns an instance of `Submodule_free_ambient`. For submodules of a quotient module, we should have a new class `Subquotient_free_ambient` (as in Macaulay2), but this is not yet implemented. 

> If you want to rework things here and now, we can, but we then need a little more robust of a plan on how to structure things and think about it from a higher level.

Frankly I want to revert back to my last commit, as `__richcmp__` for `Module_free_ambient` is not a prerequisite but a missing feature. It would be great to have `__richcmp__` method but as you say, we should think more from a higher level to avoid introducing inadequate hacks. We may open a new ticket for `__richcmp__`.



---

archive/issue_comments_478225.json:
```json
{
    "body": "Replying to [comment:85 klee]:\n> Replying to [comment:84 tscrim]:\n> > I just reverted the change since doctests pass. We can spend time improving this later if we need to. I am still not very happy about the `defining_module()` hack, but that can be revisited if this isn't robust enough. \n> \n> You added `defining_module()` as a public method. What is the \"defining module\" of a submodule from a user's perspective? It should be something different from `ambient_module()`.\n\nI don't want the zero submodule of a quotient to compare equal to the zero submodule of the `cover()` free module. I am thinking actually of implementing an `ambient_free_module()` and using that do the linear algebra, which will be different than `ambient_module()`, which would be what is currently the `defining_module()`.\n\n> You added `submodule()` of `QuotientModule_free_ambient`. It should return a submodule of a quotient module, but it returns an instance of `Submodule_free_ambient`. For submodules of a quotient module, we should have a new class `Subquotient_free_ambient` (as in Macaulay2), but this is not yet implemented. \n\nIf we implement a subquotient, then that would be another way out of the above issue of submodule comparisons. Do we really want a separate class for submodules of free modules and submodules of (general) quotient modules? This would further split the generic modules and free modules implementations.\n\n> > If you want to rework things here and now, we can, but we then need a little more robust of a plan on how to structure things and think about it from a higher level.\n> \n> Frankly I want to revert back to my last commit, as `__richcmp__` for `Module_free_ambient` is not a prerequisite but a missing feature. It would be great to have `__richcmp__` method but as you say, we should think more from a higher level to avoid introducing inadequate hacks. We may open a new ticket for `__richcmp__`.\n\nWhy? The \"hack\" I am referring to has to do with submodule definitions that is independent of `__richcmp__`. I can remove the submodules of quotient modules and still have the comparison (which  I would argue should be there to protect against mathematically wrong answers, see `S1 != S2`). That is a natural thing to want to construct, and it is not something that should require that much more work.",
    "created_at": "2022-06-22T04:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478225",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:85 klee]:
> Replying to [comment:84 tscrim]:
> > I just reverted the change since doctests pass. We can spend time improving this later if we need to. I am still not very happy about the `defining_module()` hack, but that can be revisited if this isn't robust enough. 
> 
> You added `defining_module()` as a public method. What is the "defining module" of a submodule from a user's perspective? It should be something different from `ambient_module()`.

I don't want the zero submodule of a quotient to compare equal to the zero submodule of the `cover()` free module. I am thinking actually of implementing an `ambient_free_module()` and using that do the linear algebra, which will be different than `ambient_module()`, which would be what is currently the `defining_module()`.

> You added `submodule()` of `QuotientModule_free_ambient`. It should return a submodule of a quotient module, but it returns an instance of `Submodule_free_ambient`. For submodules of a quotient module, we should have a new class `Subquotient_free_ambient` (as in Macaulay2), but this is not yet implemented. 

If we implement a subquotient, then that would be another way out of the above issue of submodule comparisons. Do we really want a separate class for submodules of free modules and submodules of (general) quotient modules? This would further split the generic modules and free modules implementations.

> > If you want to rework things here and now, we can, but we then need a little more robust of a plan on how to structure things and think about it from a higher level.
> 
> Frankly I want to revert back to my last commit, as `__richcmp__` for `Module_free_ambient` is not a prerequisite but a missing feature. It would be great to have `__richcmp__` method but as you say, we should think more from a higher level to avoid introducing inadequate hacks. We may open a new ticket for `__richcmp__`.

Why? The "hack" I am referring to has to do with submodule definitions that is independent of `__richcmp__`. I can remove the submodules of quotient modules and still have the comparison (which  I would argue should be there to protect against mathematically wrong answers, see `S1 != S2`). That is a natural thing to want to construct, and it is not something that should require that much more work.



---

archive/issue_comments_478226.json:
```json
{
    "body": "Replying to [comment:86 tscrim]:\n> > You added `defining_module()` as a public method. What is the \"defining module\" of a submodule from a user's perspective? It should be something different from `ambient_module()`.\n> \n> I don't want the zero submodule of a quotient to compare equal to the zero submodule of the `cover()` free module. I am thinking actually of implementing an `ambient_free_module()` and using that do the linear algebra, which will be different than `ambient_module()`, which would be what is currently the `defining_module()`.\n\nIt seems we think different things for `Submodule_free_ambient`, and `Quotient_free_ambient`. \n\n`Submodule_free_ambient` is the class of **submodules of an ambient free module**. `S1` and `S2` here:\n\n```\nsage: P.<x,y> = QQ[]\nsage: F = P**2\nsage: F\nAmbient free module of rank 2 over the integral domain Multivariate Polynomial Ring in x, y over Rational Field\nsage: S1 = F.submodule([(x,y),(y,x)])\nsage: S2 = F.submodule([(x,y)])\n```\n\nA submodule is the row space of a matrix over the base ring. In this sense, a submodule is defined by a matrix.\n\n`Quotient_free_ambient` is the class of **quotient of an ambient free module by a submodule of the ambient free module**. `Q1` and `Q2` here:\n\n```\nsage: Q1 = F.quotient(S1)\nsage: Q2 = F.quotient(S2)\n```\n\n\nNow if we do (hypothetically as we do not have subquotients yet),\n\n```\nsage: SQ = Q2.submodule(S1)\n```\n\nThen `SQ` is a subquotient. Mathematically it is S1/S2. Hence it is defined by **two matrices**.\n\nSo subquotients (submodules of quotients) need a separate class, perhaps `Subquotient_free_ambient`.\n\nUnder these definitions, what do you mean by `defining_module()` of a submodule? To me,  `ambient_module`, `ambient_free_module`, `defining_module` refer to the same thing!",
    "created_at": "2022-06-22T05:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478226",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:86 tscrim]:
> > You added `defining_module()` as a public method. What is the "defining module" of a submodule from a user's perspective? It should be something different from `ambient_module()`.
> 
> I don't want the zero submodule of a quotient to compare equal to the zero submodule of the `cover()` free module. I am thinking actually of implementing an `ambient_free_module()` and using that do the linear algebra, which will be different than `ambient_module()`, which would be what is currently the `defining_module()`.

It seems we think different things for `Submodule_free_ambient`, and `Quotient_free_ambient`. 

`Submodule_free_ambient` is the class of **submodules of an ambient free module**. `S1` and `S2` here:

```
sage: P.<x,y> = QQ[]
sage: F = P**2
sage: F
Ambient free module of rank 2 over the integral domain Multivariate Polynomial Ring in x, y over Rational Field
sage: S1 = F.submodule([(x,y),(y,x)])
sage: S2 = F.submodule([(x,y)])
```

A submodule is the row space of a matrix over the base ring. In this sense, a submodule is defined by a matrix.

`Quotient_free_ambient` is the class of **quotient of an ambient free module by a submodule of the ambient free module**. `Q1` and `Q2` here:

```
sage: Q1 = F.quotient(S1)
sage: Q2 = F.quotient(S2)
```


Now if we do (hypothetically as we do not have subquotients yet),

```
sage: SQ = Q2.submodule(S1)
```

Then `SQ` is a subquotient. Mathematically it is S1/S2. Hence it is defined by **two matrices**.

So subquotients (submodules of quotients) need a separate class, perhaps `Subquotient_free_ambient`.

Under these definitions, what do you mean by `defining_module()` of a submodule? To me,  `ambient_module`, `ambient_free_module`, `defining_module` refer to the same thing!



---

archive/issue_comments_478227.json:
```json
{
    "body": "Replying to [comment:87 klee]:\n> It seems we think different things for `Submodule_free_ambient`, and `Quotient_free_ambient`. \n\nActually, I wasn't quite sure how we wanted to model things. Thank you for clarifying it. My past thought was to mimic fully the free module implementation: that submodules don't care if their ambient module is a quotient module or not. (So I was treating `Submodule_free_ambient` as just not having the correct name for what it was suppose to model.) However, the quotient of a free module by a free module is again a free module (at least when working over a field). Yet, as you explained, subquotients have different structure in general and the programming model (i.e., class hierarchy) should be different. Thus, I will instead implement a subquotients class and remove the `defining_module()` and rework things to match the math.",
    "created_at": "2022-06-22T05:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478227",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:87 klee]:
> It seems we think different things for `Submodule_free_ambient`, and `Quotient_free_ambient`. 

Actually, I wasn't quite sure how we wanted to model things. Thank you for clarifying it. My past thought was to mimic fully the free module implementation: that submodules don't care if their ambient module is a quotient module or not. (So I was treating `Submodule_free_ambient` as just not having the correct name for what it was suppose to model.) However, the quotient of a free module by a free module is again a free module (at least when working over a field). Yet, as you explained, subquotients have different structure in general and the programming model (i.e., class hierarchy) should be different. Thus, I will instead implement a subquotients class and remove the `defining_module()` and rework things to match the math.



---

archive/issue_comments_478228.json:
```json
{
    "body": "Replying to [comment:86 tscrim]:\n> > Frankly I want to revert back to my last commit, as `__richcmp__` for `Module_free_ambient` is not a prerequisite but a missing feature. It would be great to have `__richcmp__` method but as you say, we should think more from a higher level to avoid introducing inadequate hacks. We may open a new ticket for `__richcmp__`.\n> \n> Why? The \"hack\" I am referring to has to do with submodule definitions that is independent of `__richcmp__`. I can remove the submodules of quotient modules and still have the comparison \n\nWithout your `defining_module()` and `submodule()` of quotients, does your `__richcmp__` meaningfully work with no doctest failures? I thought you introduced them to make `__richcmp__` work with no doctest failures. That is why I called them \"inadequate hacks\" (no intention to be personal).\n\nAs we can now fully appreciate, it would be much more work to implement `__richcmp__` for `Module_free_ambient` that work well with submodules, quotient modules (and subquotients). The aim of this ticket is just to introduce the frames for submodules and quotients (which I need for another ticket). So, I would ask again, how about opening a new ticket for the next work and limit the scope of this ticket?",
    "created_at": "2022-06-22T05:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478228",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:86 tscrim]:
> > Frankly I want to revert back to my last commit, as `__richcmp__` for `Module_free_ambient` is not a prerequisite but a missing feature. It would be great to have `__richcmp__` method but as you say, we should think more from a higher level to avoid introducing inadequate hacks. We may open a new ticket for `__richcmp__`.
> 
> Why? The "hack" I am referring to has to do with submodule definitions that is independent of `__richcmp__`. I can remove the submodules of quotient modules and still have the comparison 

Without your `defining_module()` and `submodule()` of quotients, does your `__richcmp__` meaningfully work with no doctest failures? I thought you introduced them to make `__richcmp__` work with no doctest failures. That is why I called them "inadequate hacks" (no intention to be personal).

As we can now fully appreciate, it would be much more work to implement `__richcmp__` for `Module_free_ambient` that work well with submodules, quotient modules (and subquotients). The aim of this ticket is just to introduce the frames for submodules and quotients (which I need for another ticket). So, I would ask again, how about opening a new ticket for the next work and limit the scope of this ticket?



---

archive/issue_comments_478229.json:
```json
{
    "body": "Replying to [comment:89 klee]:\n> Replying to [comment:86 tscrim]:\n> > > Frankly I want to revert back to my last commit, as `__richcmp__` for `Module_free_ambient` is not a prerequisite but a missing feature. It would be great to have `__richcmp__` method but as you say, we should think more from a higher level to avoid introducing inadequate hacks. We may open a new ticket for `__richcmp__`.\n> > \n> > Why? The \"hack\" I am referring to has to do with submodule definitions that is independent of `__richcmp__`. I can remove the submodules of quotient modules and still have the comparison \n> \n> Without your `defining_module()` and `submodule()` of quotients, does your `__richcmp__` meaningfully work with no doctest failures? I thought you introduced them to make `__richcmp__` work with no doctest failures. That is why I called them \"inadequate hacks\"\n\nThe types of the classes themselves now will actually do the job that the `defining_module()` was meant for. It will prevent, e.g., zero modules that have no business being compared from actually being compared...well, returning anything other than `False`.\n\n> (no intention to be personal).\n\nI didn't take it to be. `:)`\n\n> As we can now fully appreciate, it would be much more work to implement `__richcmp__` for `Module_free_ambient` that work well with submodules, quotient modules (and subquotients). The aim of this ticket is just to introduce the frames for submodules and quotients (which I need for another ticket). So, I would ask again, how about opening a new ticket for the next work and limit the scope of this ticket?\n\nI think it is important to at least get some of the most trivial comparisons implemented. I believe your code would have only compared thing by identity, which means that we could not even compare if two zero module are equal.\n\nI might not be able to do the quick fixes today due to other commitments, but I will do it tomorrow morning at the latest.",
    "created_at": "2022-06-22T06:15:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478229",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:89 klee]:
> Replying to [comment:86 tscrim]:
> > > Frankly I want to revert back to my last commit, as `__richcmp__` for `Module_free_ambient` is not a prerequisite but a missing feature. It would be great to have `__richcmp__` method but as you say, we should think more from a higher level to avoid introducing inadequate hacks. We may open a new ticket for `__richcmp__`.
> > 
> > Why? The "hack" I am referring to has to do with submodule definitions that is independent of `__richcmp__`. I can remove the submodules of quotient modules and still have the comparison 
> 
> Without your `defining_module()` and `submodule()` of quotients, does your `__richcmp__` meaningfully work with no doctest failures? I thought you introduced them to make `__richcmp__` work with no doctest failures. That is why I called them "inadequate hacks"

The types of the classes themselves now will actually do the job that the `defining_module()` was meant for. It will prevent, e.g., zero modules that have no business being compared from actually being compared...well, returning anything other than `False`.

> (no intention to be personal).

I didn't take it to be. `:)`

> As we can now fully appreciate, it would be much more work to implement `__richcmp__` for `Module_free_ambient` that work well with submodules, quotient modules (and subquotients). The aim of this ticket is just to introduce the frames for submodules and quotients (which I need for another ticket). So, I would ask again, how about opening a new ticket for the next work and limit the scope of this ticket?

I think it is important to at least get some of the most trivial comparisons implemented. I believe your code would have only compared thing by identity, which means that we could not even compare if two zero module are equal.

I might not be able to do the quick fixes today due to other commitments, but I will do it tomorrow morning at the latest.



---

archive/issue_comments_478230.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-23T08:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478230",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478231.json:
```json
{
    "body": "Okay, it took me a little longer than expected due to other commitments, and I had to think a lot about the overall class structure when adding in subquotients and check that I don't need to be as careful about `ambient_module()` as I previously thought. I believe I have arrived at something that reduces duplication but still has all of the comparison features I want.\n\nThe main idea is that every subobject should think of itself as a subquotient. In particular, it should have a `relations()`. The telling line is actually in the documentation of `Module_free_ambient`: it only expects that its *elements* are represented by vectors in a free module, not that its `ambient_module()` itself is a free module. By thinking about how a subquotients should be implemented, I realized that I would just be lifting all of the methods up to a base class (say, `Module_generic`) and that `ModuleSubquotient` would be the same as `Submodule_free_ambient`. So I simply remaned `Submodule_free_ambient` to `Subquotient_free_ambient`.\n\nNow it is easy to implement a quotient of a quotient: We just need to lift everything up to the ambient free module and stack the matrices. I am going to implement this really quick next. Once that is done, I want to see if I can remove some code duplication. That is the last thing I would want in this ticket.\n\nA wish-list item would be a slightly better echelon form for matrices that at least checked if `a | b` when trying to reduce the matrix. This would help in some more trivial cases...",
    "created_at": "2022-06-23T08:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478231",
    "user": "https://github.com/tscrim"
}
```

Okay, it took me a little longer than expected due to other commitments, and I had to think a lot about the overall class structure when adding in subquotients and check that I don't need to be as careful about `ambient_module()` as I previously thought. I believe I have arrived at something that reduces duplication but still has all of the comparison features I want.

The main idea is that every subobject should think of itself as a subquotient. In particular, it should have a `relations()`. The telling line is actually in the documentation of `Module_free_ambient`: it only expects that its *elements* are represented by vectors in a free module, not that its `ambient_module()` itself is a free module. By thinking about how a subquotients should be implemented, I realized that I would just be lifting all of the methods up to a base class (say, `Module_generic`) and that `ModuleSubquotient` would be the same as `Submodule_free_ambient`. So I simply remaned `Submodule_free_ambient` to `Subquotient_free_ambient`.

Now it is easy to implement a quotient of a quotient: We just need to lift everything up to the ambient free module and stack the matrices. I am going to implement this really quick next. Once that is done, I want to see if I can remove some code duplication. That is the last thing I would want in this ticket.

A wish-list item would be a slightly better echelon form for matrices that at least checked if `a | b` when trying to reduce the matrix. This would help in some more trivial cases...



---

archive/issue_comments_478232.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-23T09:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478232",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478233.json:
```json
{
    "body": "Now we can take quotients of quotients, which keeps track of how it was created, as well as the defining matrices of generators and relations for future use in doing homological algebra (a la Macaulay2).\n\nI also was able to remove redundant `span()` and `submodule()` by a new attribute that tells which class defines the submodules and by adding one call to `ambient_module()` when the base ring changes (which will very slightly slow down that code when ``self`` already is an ambient module, but this should be negligible).\n\nI am now happy with the current capabilities of the code. It should be fairly future-proof. There might be some trivial failures around due to changing the error messages.",
    "created_at": "2022-06-23T09:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478233",
    "user": "https://github.com/tscrim"
}
```

Now we can take quotients of quotients, which keeps track of how it was created, as well as the defining matrices of generators and relations for future use in doing homological algebra (a la Macaulay2).

I also was able to remove redundant `span()` and `submodule()` by a new attribute that tells which class defines the submodules and by adding one call to `ambient_module()` when the base ring changes (which will very slightly slow down that code when ``self`` already is an ambient module, but this should be negligible).

I am now happy with the current capabilities of the code. It should be fairly future-proof. There might be some trivial failures around due to changing the error messages.



---

archive/issue_comments_478234.json:
```json
{
    "body": "I just looked over. Yes, it looks nice. I will check in detail later.",
    "created_at": "2022-06-23T10:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478234",
    "user": "https://github.com/kwankyu"
}
```

I just looked over. Yes, it looks nice. I will check in detail later.



---

archive/issue_comments_478235.json:
```json
{
    "body": "Thank you. Hopefully a patchbot will test this overnight too.",
    "created_at": "2022-06-23T11:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478235",
    "user": "https://github.com/tscrim"
}
```

Thank you. Hopefully a patchbot will test this overnight too.



---

archive/issue_comments_478236.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-06-24T07:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478236",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_478237.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-24T07:57:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478237",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478238.json:
```json
{
    "body": "I am also happy overall with the new design.\n\nI did minor edits. I renamed `Subquotient_free_module` back to `Submodule_free_quotient` as subquotients are also submodules of the ambient module, which is a quotient module in this case. This name also matches with the filename. I reverted back the `domain` argument of `QuotientModule_free_ambient` to `module` as domain may be misunderstood as integral domain.",
    "created_at": "2022-06-24T08:08:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478238",
    "user": "https://github.com/kwankyu"
}
```

I am also happy overall with the new design.

I did minor edits. I renamed `Subquotient_free_module` back to `Submodule_free_quotient` as subquotients are also submodules of the ambient module, which is a quotient module in this case. This name also matches with the filename. I reverted back the `domain` argument of `QuotientModule_free_ambient` to `module` as domain may be misunderstood as integral domain.



---

archive/issue_comments_478239.json:
```json
{
    "body": "Ah, I removed the degree 1 case in `is_submodule` test. It is trivial case and the test is wrong. Your test would give false for `M.is_submodule(N)` with N=(3,5), M=(2)` over `ZZ`.",
    "created_at": "2022-06-24T08:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478239",
    "user": "https://github.com/kwankyu"
}
```

Ah, I removed the degree 1 case in `is_submodule` test. It is trivial case and the test is wrong. Your test would give false for `M.is_submodule(N)` with N=(3,5), M=(2)` over `ZZ`.



---

archive/issue_comments_478240.json:
```json
{
    "body": "Replying to [comment:101 klee]:\n> Ah, I removed the degree 1 case in `is_submodule` test. It is trivial case and the test is wrong. Your test would give false for `M.is_submodule(N)` with `N=(3,5), M=(2)` over `ZZ`.\n\nRight, it is not an if-and-only-if due to linear combinations... This really should have been checking for general cases if we can scale the generators by checking the divisibility of the leading coefficients and only return `True` if that was the case. Anyways, it isn't so important for now.",
    "created_at": "2022-06-24T08:37:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478240",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:101 klee]:
> Ah, I removed the degree 1 case in `is_submodule` test. It is trivial case and the test is wrong. Your test would give false for `M.is_submodule(N)` with `N=(3,5), M=(2)` over `ZZ`.

Right, it is not an if-and-only-if due to linear combinations... This really should have been checking for general cases if we can scale the generators by checking the divisibility of the leading coefficients and only return `True` if that was the case. Anyways, it isn't so important for now.



---

archive/issue_comments_478241.json:
```json
{
    "body": "Replying to [comment:100 klee]:\n> I am also happy overall with the new design.\n\nThank you for dealing with me as I worked on it.\n\n> I did minor edits. I renamed `Subquotient_free_module` back to `Submodule_free_quotient` as subquotients are also submodules of the ambient module, which is a quotient module in this case. This name also matches with the filename.\n\nThese are good.\n\n> I reverted back the `domain` argument of `QuotientModule_free_ambient` to `module` as domain may be misunderstood as integral domain. \n\nI am 99% okay with this. I just have a very slight reservation that it doesn't make the free module version. Yet, it is not public facing and the classes are currently separate (although IMO they should not be), so this is okay with me.\n\nIf everything else is good, then I think we can set a positive review once a patchbot takes a look at it.",
    "created_at": "2022-06-24T08:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478241",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:100 klee]:
> I am also happy overall with the new design.

Thank you for dealing with me as I worked on it.

> I did minor edits. I renamed `Subquotient_free_module` back to `Submodule_free_quotient` as subquotients are also submodules of the ambient module, which is a quotient module in this case. This name also matches with the filename.

These are good.

> I reverted back the `domain` argument of `QuotientModule_free_ambient` to `module` as domain may be misunderstood as integral domain. 

I am 99% okay with this. I just have a very slight reservation that it doesn't make the free module version. Yet, it is not public facing and the classes are currently separate (although IMO they should not be), so this is okay with me.

If everything else is good, then I think we can set a positive review once a patchbot takes a look at it.



---

archive/issue_comments_478242.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-26T10:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478242",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478243.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-27T01:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478243",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478244.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-06-27T01:03:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478244",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_478245.json:
```json
{
    "body": "Replying to [comment:103 tscrim]:\n> Replying to [comment:100 klee]:\n> > I am also happy overall with the new design.\n> \n> Thank you for dealing with me as I worked on it.\n\nThis ticket achieved much more than I first envisioned. It laid a groundwork to elevate Sage as an alternative platform for commutative algebra computations.",
    "created_at": "2022-06-27T01:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478245",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:103 tscrim]:
> Replying to [comment:100 klee]:
> > I am also happy overall with the new design.
> 
> Thank you for dealing with me as I worked on it.

This ticket achieved much more than I first envisioned. It laid a groundwork to elevate Sage as an alternative platform for commutative algebra computations.



---

archive/issue_comments_478246.json:
```json
{
    "body": "Thank you for the changes. There is still work that can be done; in particular things for modules over polynomial rings (possibly using, e.g., `singular` to do the computations). However, that is all good for followup tickets.",
    "created_at": "2022-06-27T02:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478246",
    "user": "https://github.com/tscrim"
}
```

Thank you for the changes. There is still work that can be done; in particular things for modules over polynomial rings (possibly using, e.g., `singular` to do the computations). However, that is all good for followup tickets.



---

archive/issue_comments_478247.json:
```json
{
    "body": "Merge failure on top of:\n\n8f2fe518a7 Trac #33708: make elliptic-curve isogenies compute Montgomery codomains\n\n86ddb48e2f Trac #33144: Remove some py2 tags in explain_pickle\n\n30ecff9f6d Trac #34085: fix some details in braid groups\n\n3755f58519 Trac #34082: Add an option up_to_isomorphism for is_subgraph\n\n92c75af48c Trac #34080: pycodestyle cleanup in src/sage/graphs/digraph.py\n\nca49485d88 Trac #34062: enhance our conversion system\n\n1da48e72af Trac #34052: tweaking the giac / libgiac interface\n\n21a14a9dce Trac #34049: fix wrong use of Path inside libgap.Read\n\nd73e3d7af7 Trac #34045: OpenSSL 3.0.4 security update\n\nb617c66a07 Trac #34040: fix W605 in all pyx files inside matrix/\n\nca041b6034 Trac #34039: fix pycodestyle E306 in categories and part of combinat\n\n2c9b6f0230 Trac #34029: bug in elliptic curve saturation: update to eclib bugfix release 20220621 required.\n\nb2b107f016 Trac #34006: Fix the Killing form and generators for a Lie subalgebra\n\n963b374cb1 Trac #33995: make *test*: Log to a common log file test.log\n\ne3ceba0a60 Trac #33928: phitigra error with hold_canvas\n\nb5d0423a3f Trac #33866: Make jupyter_packaging standard; add hatchling, editables, pathspec, poetry_core, tomlkit, deprecation; update tomli, flit_core, setuptools, pip, wheel\n\ndd6e379e27 Trac #33821: Remove use of SAGE_LIB in sage.misc\n\n2bd081ee38 Trac #33409: Size of docker images has increased in 9.5\n\n1f77ce0ac9 Trac #33295: Refactor sage_conf\n\n3b0dc53967 Trac #33029: Feature and doctest tag for runtime cython\n\n226f4353c3 Trac #29779: pkgconf: Update to 1.8.0, remove runtime dep on environment variable SAGE_LOCAL\n\n548795354e Trac #29549: bootstrap: Clean up use of gettextize\n\nc02edcb15b Trac #25374: Upgrade cryptominisat to 5.8.0, fix build on Cygwin\n\ne22b33a0c1 Trac #34017: Fix tox-docker builds after #29941\n\nc4236d0844 Trac #34008: pycodestyle cleanup in sage.graphs.generic_graph_pyx.pyx\n\n6f961ffa38 Trac #34007: Allow start parameter in Python's sum\n\nc59c86cfbd Trac #33996: ascii_art fail in jupyter notebook\n\nc40983afcd Trac #33991: remove some unused imports\n\nb02c408763 Trac #33978: various details about typing in combinat\n\n6fb1e3f13a Trac #34037: Make doctest from #25626 more robust\n\n4169d7d6c0 Trac #34035: Add __reversed__ method to FrozenBitsets\n\n45c963e0c7 Trac #34030: move supercommutator to superalgebras\n\nd4706f96f9 Trac #34019: minor code details in combinat\n\n3d336f0435 Trac #34014: Clean src/sage/graphs/pq_trees.py\n\nc9aa34b34c Trac #33957: Manifold.options.omit_function_arguments ineffective for arguments not in alphabetic order\n\n0b2741d399 Trac #33619: clean up ell_curve_isogeny.py\n\nc0e59251e2 Trac #34036: fix the linter\n\n2b36879ae1 Trac #34025: Fix doctest in sage/modular/overconvergent/hecke_series.py\n\nc0abe3f5ee Trac #33213: Replace SAGE_TMP by the system location in the sage library\n\n7ab174a70d Trac #32340: document behavior of .is_prime() for number fields\n\nc69f4af336 Trac #28263: Degree for Affine Morphism or Affine Dynamical System\n\ne516392523 Trac #34001: Add flag to avoid OrePolynomialRing cast to PolynomialRing\n\n01b8bcb85f Trac #33993: pep cleanup for words/morphism.py\n\n716c5ce262 Trac #33992: remove class inheritance of object in remaining places\n\nde375bce02 Trac #33990: Subset_s _an_element_\n\n0593e83957 Trac #33987: modernize super() in structure, symbolic, doctest, databases\n\nd9a45e29eb Trac #33985: modernize super() in monoids,modules,modular\n\n7ed404657b Trac #33984: modernize super() in schemes,libs,sets,quivers\n\n1df260e842 Trac #33979: .roots() does not always return elements of the base ring\n\nc6c2b85405 Trac #33974: Documentation addition for symmetric functions - Cauchy identity\n\nf92916e358 Trac #33840: bool(matrix) ignores exceptions raised while comparing entries\n\nf8df80820d Updated [SageMath](SageMath) version to 9.7.beta3\n\n\n\nmerge was not clean: conflicts in src/sage/modules/free_module.py",
    "created_at": "2022-06-28T22:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478247",
    "user": "https://github.com/vbraun"
}
```

Merge failure on top of:

8f2fe518a7 Trac #33708: make elliptic-curve isogenies compute Montgomery codomains

86ddb48e2f Trac #33144: Remove some py2 tags in explain_pickle

30ecff9f6d Trac #34085: fix some details in braid groups

3755f58519 Trac #34082: Add an option up_to_isomorphism for is_subgraph

92c75af48c Trac #34080: pycodestyle cleanup in src/sage/graphs/digraph.py

ca49485d88 Trac #34062: enhance our conversion system

1da48e72af Trac #34052: tweaking the giac / libgiac interface

21a14a9dce Trac #34049: fix wrong use of Path inside libgap.Read

d73e3d7af7 Trac #34045: OpenSSL 3.0.4 security update

b617c66a07 Trac #34040: fix W605 in all pyx files inside matrix/

ca041b6034 Trac #34039: fix pycodestyle E306 in categories and part of combinat

2c9b6f0230 Trac #34029: bug in elliptic curve saturation: update to eclib bugfix release 20220621 required.

b2b107f016 Trac #34006: Fix the Killing form and generators for a Lie subalgebra

963b374cb1 Trac #33995: make *test*: Log to a common log file test.log

e3ceba0a60 Trac #33928: phitigra error with hold_canvas

b5d0423a3f Trac #33866: Make jupyter_packaging standard; add hatchling, editables, pathspec, poetry_core, tomlkit, deprecation; update tomli, flit_core, setuptools, pip, wheel

dd6e379e27 Trac #33821: Remove use of SAGE_LIB in sage.misc

2bd081ee38 Trac #33409: Size of docker images has increased in 9.5

1f77ce0ac9 Trac #33295: Refactor sage_conf

3b0dc53967 Trac #33029: Feature and doctest tag for runtime cython

226f4353c3 Trac #29779: pkgconf: Update to 1.8.0, remove runtime dep on environment variable SAGE_LOCAL

548795354e Trac #29549: bootstrap: Clean up use of gettextize

c02edcb15b Trac #25374: Upgrade cryptominisat to 5.8.0, fix build on Cygwin

e22b33a0c1 Trac #34017: Fix tox-docker builds after #29941

c4236d0844 Trac #34008: pycodestyle cleanup in sage.graphs.generic_graph_pyx.pyx

6f961ffa38 Trac #34007: Allow start parameter in Python's sum

c59c86cfbd Trac #33996: ascii_art fail in jupyter notebook

c40983afcd Trac #33991: remove some unused imports

b02c408763 Trac #33978: various details about typing in combinat

6fb1e3f13a Trac #34037: Make doctest from #25626 more robust

4169d7d6c0 Trac #34035: Add __reversed__ method to FrozenBitsets

45c963e0c7 Trac #34030: move supercommutator to superalgebras

d4706f96f9 Trac #34019: minor code details in combinat

3d336f0435 Trac #34014: Clean src/sage/graphs/pq_trees.py

c9aa34b34c Trac #33957: Manifold.options.omit_function_arguments ineffective for arguments not in alphabetic order

0b2741d399 Trac #33619: clean up ell_curve_isogeny.py

c0e59251e2 Trac #34036: fix the linter

2b36879ae1 Trac #34025: Fix doctest in sage/modular/overconvergent/hecke_series.py

c0abe3f5ee Trac #33213: Replace SAGE_TMP by the system location in the sage library

7ab174a70d Trac #32340: document behavior of .is_prime() for number fields

c69f4af336 Trac #28263: Degree for Affine Morphism or Affine Dynamical System

e516392523 Trac #34001: Add flag to avoid OrePolynomialRing cast to PolynomialRing

01b8bcb85f Trac #33993: pep cleanup for words/morphism.py

716c5ce262 Trac #33992: remove class inheritance of object in remaining places

de375bce02 Trac #33990: Subset_s _an_element_

0593e83957 Trac #33987: modernize super() in structure, symbolic, doctest, databases

d9a45e29eb Trac #33985: modernize super() in monoids,modules,modular

7ed404657b Trac #33984: modernize super() in schemes,libs,sets,quivers

1df260e842 Trac #33979: .roots() does not always return elements of the base ring

c6c2b85405 Trac #33974: Documentation addition for symmetric functions - Cauchy identity

f92916e358 Trac #33840: bool(matrix) ignores exceptions raised while comparing entries

f8df80820d Updated [SageMath](SageMath) version to 9.7.beta3



merge was not clean: conflicts in src/sage/modules/free_module.py



---

archive/issue_comments_478248.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-06-28T22:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478248",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_478249.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-29T00:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478249",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478250.json:
```json
{
    "body": "Only a trivial conflict with #33985, but I also merged in #34040 just to make sure there was not a conflict there.",
    "created_at": "2022-06-29T00:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478250",
    "user": "https://github.com/tscrim"
}
```

Only a trivial conflict with #33985, but I also merged in #34040 just to make sure there was not a conflict there.



---

archive/issue_comments_478251.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-06-29T00:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478251",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_030342.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2022-07-09T22:31:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33631#event-30342"
}
```



---

archive/issue_comments_478252.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-07-09T22:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33631#issuecomment-478252",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
