# Issue 27133: Global function fields: differentials

Issue created by migration from https://trac.sagemath.org/ticket/27370

Original creator: klee

Original creation time: 2019-02-27 02:14:43

This is part of the meta-ticket #22982.

The goal of the present ticket is to add code for computing with differentials of global function fields.


---

Comment by git created at 2019-02-28 06:11:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2019-02-28 06:14:36

Changing status from new to needs_review.


---

Comment by tscrim created at 2019-03-01 02:18:30

I would move the doc from `FunctionFieldDifferential_global.__init__` to the class level (`FunctionFieldDifferential_global`) and instead put a test in the `__init__` to do a `TestSuite(foo).run()`.

I think you are better off cached `_differential_space()` than `differential_space()` as all of the other parts of the construction are essentially trivial and that way `basis_differential_space()` also will benefit from the caching.

I am not sure that the `_element_constructor_` raising an `NotImplementedError` is the best behavior. It suggests that any other input should be handled. The typical thing done here is to instead raise a `ValueError`.

Does the differential space have the structure of a Lie algebra, where `[X, Y] = XY - YX` is also in the space?

Do you want to add a `_latex_` for the differentials? Same question for ascii/unicode art.


---

Comment by git created at 2019-03-02 02:52:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2019-03-02 03:05:07

Replying to [comment:4 tscrim]:
> I would move the doc from `FunctionFieldDifferential_global.__init__` to the class level (`FunctionFieldDifferential_global`) and instead put a test in the `__init__` to do a `TestSuite(foo).run()`.

I missed that. Thanks. Done.
 
> I think you are better off cached `_differential_space()` than `differential_space()` as all of the other parts of the construction are essentially trivial and that way `basis_differential_space()` also will benefit from the caching.

Right. Done.

> I am not sure that the `_element_constructor_` raising an `NotImplementedError` is the best behavior. It suggests that any other input should be handled. The typical thing done here is to instead raise a `ValueError`.

Done.

> Does the differential space have the structure of a Lie algebra, where `[X, Y] = XY - YX` is also in the space?

No. The space of derivations is closed under commutator operation though, but I don't know even the definition of product of differentials...

> Do you want to add a `_latex_` for the differentials? Same question for ascii/unicode art.

Yes for `_latex_`. Done.


---

Comment by tscrim created at 2019-03-02 11:54:50

Thank you.

Replying to [comment:6 klee]:
> Replying to [comment:4 tscrim]:
> > Does the differential space have the structure of a Lie algebra, where `[X, Y] = XY - YX` is also in the space?
> 
> No. The space of derivations is closed under commutator operation though, but I don't know even the definition of product of differentials...

Ah, right. They are not the same. Another na√Øve question, do the differentials `d(x)` satisfy some commutation relation like in the Weyl algebra:

```
[dx, x] = 1   <=>   dx x = x dx + 1
```


```
sage: W.<x> = algebras.DifferentialWeyl(QQ)
sage: dx = W.differentials()['dx']
sage: x * dx
x*dx
sage: dx*x - x*dx
1
```


One other question: Can you say anything more about the space of differentials? Is it 1 dimensional (over its base ring)? If so, I can make the necessary implementations to get it into the correct category.

Finally, one more nitpick on output:

```
sage: S(1)
(0) d(x)
```

looks strange. It would also be nice to have the special output cases as doctests to show the indent.


---

Comment by tscrim created at 2019-03-02 11:57:55

I want to clarify one thing, the Weyl algebra could possibly be a separate implementation that could be a bigger space (and a separate ticket). There is a question of would it be the more natural object or would we want to have 2 objects with a natural coercion when performing multiplication (I implemented this for Lie algebras going to their universal enveloping algebras, so I could port that over).


---

Comment by git created at 2019-03-04 04:53:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2019-03-04 05:04:44

> do the differentials `d(x)` satisfy some commutation relation like in the Weyl algebra:
> {{{
> [dx, x] = 1   <=>   dx x = x dx + 1
> }}}
> {{{
> sage: W.<x> = algebras.DifferentialWeyl(QQ)
> sage: dx = W.differentials()['dx']
> sage: x * dx
> x*dx
> sage: dx*x - x*dx
> 1
> }}}
> 

I am not familiar with Weyl algebra. But the things above would make sense if you regard `dx` as derivations, usually denoted `d_x` (taking derivative with respect to x). 

> One other question: Can you say anything more about the space of differentials? Is it 1 dimensional (over its base ring)? If so, I can make the necessary implementations to get it into the correct category.

The space of differentials is 1 dimensional over the function field F. Therefore  differentials are of the form fdx with an element f and a separable element x in F.  

> 
> Finally, one more nitpick on output:
> {{{
> sage: S(1)
> (0) d(x)
> }}}
> looks strange. It would also be nice to have the special output cases as doctests to show the indent(intent ?).

Done. Now print `0`.


---

Comment by klee created at 2019-03-04 05:15:56

Replying to [comment:8 tscrim]:
> I want to clarify one thing, the Weyl algebra could possibly be a separate implementation that could be a bigger space (and a separate ticket). There is a question of would it be the more natural object or would we want to have 2 objects with a natural coercion when performing multiplication (I implemented this for Lie algebras going to their universal enveloping algebras, so I could port that over).

This is a territory, mostly unknown to me. I don't know if the space of differentials on a function field belongs to the category of Weyl algebras. I guess not.  But if somehow can be related, it would be good to have natural coercion between it and the bigger Weyl algebra, of course.


---

Comment by tscrim created at 2019-03-05 04:48:43

Well, I guess the definition does not straight lift since a Weyl algebra is defined over a polynomial ring. Maybe we could define it under this class of generalized Weyl algebras due to Bavula (https://arxiv.org/abs/1612.08941)? Anyways, just something to ponder and I was curious about (seeing if we could form a natural ring in an analogous way).

Here are the promised changes making it into a finite-dimensional module with basis. If my changes are good, then positive review.
----
New commits:


---

Comment by klee created at 2019-03-05 08:22:02

> Here are the promised changes making it into a finite-dimensional module with basis. 

Looks good to me. Just one question: Why do you have `copy=False`, that is not used anywhere in `monomial_coefficients` method?


---

Comment by tscrim created at 2019-03-05 19:59:40

This is part of the API of the method, for those elements that are implemented using dicts as a way to improve the speed by avoiding copying when, e.g., iterating over it.


---

Comment by klee created at 2019-03-06 09:16:58

Replying to [comment:14 tscrim]:
> This is part of the API of the method, for those elements that are implemented using dicts as a way to improve the speed by avoiding copying when, e.g., iterating over it.

I now see the intent. Then for our case, a new dictionary is returned each time. Hence the default behaviour is for `copy=True` (and `copy=False` is ignored). No?


---

Comment by git created at 2019-03-06 11:19:19

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2019-03-06 11:20:36

The parameter is ignored in either case, but I changed the default to `copy=True` to reflect the behavior better.


---

Comment by klee created at 2019-03-06 11:50:47

Replying to [comment:17 tscrim]:
> The parameter is ignored in either case, but I changed the default to `copy=True` to reflect the behavior better.

Positive review on your addition. Thanks!


---

Comment by klee created at 2019-03-06 11:50:47

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2019-03-06 11:51:34

No problem. Thank you.


---

Comment by vbraun created at 2019-03-07 19:26:56

Resolution: fixed
