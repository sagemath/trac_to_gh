# Issue 14060: Fix negation of Jacobian morphisms

Issue created by migration from Trac.

Original creator: SimonKing

Original creation time: 2013-03-13 10:40:59

Assignee: AlexGhitza

Keywords: Jacobian morphism

The following fails with a coercion error:

```

            sage: P.<x> = QQ[]
            sage: f = x^5 - x + 1; h = x
            sage: C = HyperellipticCurve(f,h,'u,v')
            sage: J = C.jacobian()
            sage: K.<t> = NumberField(x^2-2)
            sage: R.<x> = K[]
            sage: Q = J(K)([x^2-t,R(1)])
            sage: Q
            (u^2 - t, v - 1)
            sage: -Q
            (u^2 - t, v + u + 1)
```


The reason is that in the `__neg__` method, the remainder of a polynomial h over the rationals is computed modulo a non-constant polynomial over a number field. The involved `__mod__` method of FLINT polynomials would try to coerce the modulus into the parent of h, which fails here for obvious reasons.

I see two possible solutions:

1. Make sure in `JacobianMorphism_divisor_class_field.__neg__` that h and the modulus live in the same ring, e.g., by adding the modulus to h before computing the remainder (which won't change the result).
2. In the `__mod__` method of FLINT polynomials, invoke coercion_model.canonical_coercion on h and the modulus, rather than trying to coerce the modulus into the parent of h.

I prefer the first approach, since then the output of `__mod__` would potentially live in a different ring (which should not be the case!) and since it would imply a general slowdown of the `__mod__` method.


---

Attachment


---

Comment by SimonKing created at 2013-03-13 10:43:30

Changing status from new to needs_review.


---

Comment by SimonKing created at 2013-03-13 22:59:51

I think the old formulation at the end of the ticket description was misleading.


---

Comment by tscrim created at 2013-04-04 16:20:52

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2013-04-04 16:20:52

Looks good to me.


---

Comment by jdemeyer created at 2013-04-06 14:50:37

Resolution: fixed
