# Issue 23083: Fix Expression substitution interface inconsistency

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2017-06-23 12:47:04

From tomchor on https://github.com/sagemath/sage/issues/78

```
I recently started using Sagemath and I noticed this behavior:

>>> a1=var('a_1')
>>> E=x^a1
>>> E(a1=1)

 a₁
x  
>>> E(a_1=1)
x
Should this be the behavior? I feel like this is a bug and the correct way would be to indeed use E(a1=1) because that is the name of the variable, while a_1 is just its representation. For example, if I use Sympy's syntax it works as it should:

>>> E.subs({a1:1})
x
I'm using SageMath version 7.5.1 compiled for Linux Mint 18.1.
```



---

Comment by tscrim created at 2017-06-23 23:24:49

Changing status from new to needs_review.


---

Comment by tscrim created at 2017-06-23 23:24:49

I disagree. I would say this is a misuse and tomchor is backwards on what is a representation and what is a variable. `a1` is the representation (i.e., a pointer) in !Python/Sage of the variable `a_1` that is used by the symbolic expression. One reason why we should keep things the way they are is

```
a1 = var('x')
a2 = var('x')
f = (a1 + e^a2)
```

is a function in `x` and cannot be evaluated separately by `a1` and `a2`.


---

Comment by rws created at 2017-06-24 06:00:08

Changing status from needs_review to needs_work.


---

Comment by rws created at 2017-06-24 06:00:08

I agree with your explanation. But note that this ticket is about the inconsistency between 

```
sage: E.subs({a1:1})
x
sage: E(a1=1)
x^a_1
```

It happens because the dict key is immediately replaced but the `kwds` dict key in `a1=1` is not:

```
sage: {a1:1}
{a_1: 1}
```



---

Comment by tscrim created at 2017-06-24 06:08:01

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-06-24 06:08:01

There is no way around that either because it points to the "correct" variable and because they key of the dict is the variable, not a string. So by the time you are doing the substitution, it is evaluated to `'a_1'`. It is the same problem if I called the Python variable `x`. It comes down to understanding the difference between a python variable and the actual symbolic variable. IMO, this is the correct behavior.


---

Comment by rws created at 2017-06-24 07:49:59

You are sure that the entry `a1` in the `kwds` dict that is created with `E(a1=1)` cannot be replaced with `a_1`, in order to make the behaviour consistent? I disagree. The dict entry there is a string, and the problem is 'just' to get the object that is pointed to. This knowledge is somewhere in the ipython shell, isn't it?


---

Comment by tscrim created at 2017-06-24 13:39:02

Replying to [comment:4 rws]:
> You are sure that the entry `a1` in the `kwds` dict that is created with `E(a1=1)` cannot be replaced with `a_1`, in order to make the behaviour consistent? I disagree. The dict entry there is a string, and the problem is 'just' to get the object that is pointed to. This knowledge is somewhere in the ipython shell, isn't it?

Yes, I am sure. In the `kwds` dict, the input is the _string_ `'a1'`, not the variable `a1`. We could search the Python namespace for a variable named `a1`. However, this has a number of shortcomings: the Python `a1` could be anything, or worse, someone did `a1 = var('x')` and then the behavior is extremely unexpected (albeit a slightly contrived of an example). Also, how would you differentiate if someone wanted to use variables `a1` and `a_1`? What about if it is defined as a local variable in a function?

I believe that anytime we have to go find a variable in all Python variables (which is very [relatively] expensive) gives off a very strong code smell. In my mind, the variable is `a_1`, not the Python pointer `a1`, and we should not move away from that as it is a huge can of worms.


---

Comment by rws created at 2017-06-24 13:58:08

Changing status from needs_review to positive_review.


---

Comment by rws created at 2017-06-24 14:35:18

IMHO for this inherent inconsistency the usage of `ex.subs(a=b)` should be discouraged in favor of `ex.subs(a==b)`.


---

Comment by embray created at 2017-07-13 07:54:31

Resolution: wontfix


---

Comment by embray created at 2017-07-13 07:54:31

Closing tickets in the sage-duplicate/invalid/wontfix module with positive_review (i.e. someone has confirmed they should be closed).
