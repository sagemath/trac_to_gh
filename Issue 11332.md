# Issue 11332: Tachyon fails to build on Cygwin - again

Issue created by migration from https://trac.sagemath.org/ticket/11504

Original creator: kcrisman

Original creation time: 2011-06-16 16:46:31

Assignee: tbd

CC:  mhansen dimpase leif

Apparently the same problem from #7335 is back.

The fix should be the same, apparently.


---

Comment by kcrisman created at 2011-06-16 16:58:09

This works on my XP.  At least the VM I have.


---

Comment by kcrisman created at 2011-06-22 16:46:28

Changing status from new to needs_review.


---

Comment by kcrisman created at 2011-06-22 16:46:28

Changing component from PLEASE CHANGE to cygwin.


---

Comment by kcrisman created at 2011-06-22 16:46:28

There is now an spkg at [http://sage.math.washington.edu/home/kcrisman/tachyon-0.98.9.p4.spkg](http://sage.math.washington.edu/home/kcrisman/tachyon-0.98.9.p4.spkg).  The fix worked on XP, will be trying on W7 soon.


---

Comment by kcrisman created at 2011-06-22 16:46:28

Changing type from PLEASE CHANGE to defect.


---

Attachment

For review purposes only


---

Comment by kcrisman created at 2011-06-28 18:03:46

This builds on Windows 7 now as well.    Just needs review - the changes are only for the Windows architecture parts of the file, so it really shouldn't affect anything.


---

Comment by kcrisman created at 2011-07-29 15:24:58

User "RegB" was able to use this successfully for this - see [this sage-windows thread](http://groups.google.com/group/sage-windows/browse_thread/thread/b7d6ed4902914726).  

So this just needs someone to look at the actual spkg.


---

Comment by kcrisman created at 2011-07-29 19:26:41

That is, this needs someone _other than me_ to look at the actual spkg and its construction :) - should be very easy.


---

Comment by kcrisman created at 2011-07-29 19:42:16

Replying to [comment:4 kcrisman]:
> User "RegB" was able to use this successfully for this - see [this sage-windows thread](http://groups.google.com/group/sage-windows/browse_thread/thread/b7d6ed4902914726).  

This was Vista, just FYI, but that shouldn't affect review for this issue.


---

Comment by leif created at 2011-08-19 02:55:51

Except for

```sh
$ hg status
? .DS_Store
? ._.DS_Store
? patches/.DS_Store
? patches/._.DS_Store
```

and missing trailing `===`s in the last five(!) Changelog entry headings (greetings from the copy-paste community), the spkg looks ok to me.

I could fix both when providing a p5 for #11706 with William's and a few more changes of mine (re)based on the p4 here, since these are rather minor issues.


---

Comment by leif created at 2011-08-19 03:01:47

Also, `spkg-install` isn't executable and the file modes ("permissions") are quite funny.


---

Comment by dimpase created at 2011-08-19 03:17:08

Replying to [comment:9 leif]:
> Also, `spkg-install` isn't executable and the file modes ("permissions") are quite funny.

Cygwin's setting of file permissions is really LMAO... 
(sorry for a slightly OT comment :))


---

Comment by leif created at 2011-08-19 04:29:40

Karl-Dieter (or anybody else), are you sure that

```sh
    cp compile/*/tachyon "$SAGE_LOCAL/bin"
```

works on Cygwin, too?

Shouldn't there be an `.exe` extension on Cygwin / Windows?

(This is btw. a case where checking the exit code of `cp` really makes sense, or is crucial.)


---

Comment by leif created at 2011-08-19 04:30:34

Changing status from needs_review to needs_info.


---

Comment by leif created at 2011-08-19 06:10:11

Mike confirmed (currently without being able to verify / test that) that it should be `tachyon`*`.exe`* on Cygwin, so I changed the code to:

```sh
    ...
    if [ "$UNAME" = CYGWIN ]; then
        binary_name=tachyon.exe
    else
        binary_name=tachyon
    fi
    # The '*' is a place-holder for the arch just built (e.g. 'win32' for
    # Cygwin, other directories won't exist):
    cp -p -f src/compile/*/"${binary_name}" "$SAGE_LOCAL/bin"
    if [ $? -ne 0 ]; then
        echo "Error installing Tachyon Ray Tracer binary (\"${binary_name}\")."
        exit 1
    fi
    ...
```


Note that this change is only in the p5 spkg for #11706 (based on the p4 here) I'll upload in a few minutes...


---

Comment by leif created at 2011-08-19 07:12:15

Replying to [comment:13 leif]:
> Mike confirmed (currently without being able to verify / test that) that it should be `tachyon`*`.exe`* on Cygwin, so I changed the code... 

> 

> Note that this change is only in the p5 spkg for #11706 (based on the p4 here) I'll upload in a few minutes...

It would be nice if someone could now test the new p5 from #11706 (which is up now) on Cygwin as well, then I can give _this ticket_ a positive review. :)


---

Comment by kcrisman created at 2011-08-19 12:25:16

Wow, this is really frustrating.  I really thought I had gotten all the cruft out of these.  Thank you for catching those stupid `DS*` files; it's almost impossible to get Mac not to put them in sometimes.

What is particularly weird is that the package installs fine, so spkg-install must have been usable, at least!  Maybe the permissions were "good enough"...

As to the .exe, that doesn't seem to have been present before, so maybe Cygwin was able to use it after all?  (Or maybe it just never worked and no one noticed!)

Since the current goal is to get Sage to build, then start, I hadn't even been able to check whether Tachyon worked.  I did once run doctests on a functioning Sage on Cygwin, but I don't think it had a problem with Tachyon stuff.  I'll try that when looking at #11706.


---

Comment by leif created at 2011-08-19 12:41:25

Replying to [comment:15 kcrisman]:
> What is particularly weird is that the package installs fine, so spkg-install must have been usable, at least!  Maybe the permissions were "good enough"...

Well, `sage-spkg` always makes `spkg-install` executable before running it, so that's a minor issue. The other permission issues could have only caused some trouble in a multi-user environment, i.e., if the user wasn't the owner of files.




> As to the .exe, that doesn't seem to have been present before, so maybe Cygwin was able to use it after all?  (Or maybe it just never worked and no one noticed!)

The spkg was said to _build_, not Tachyon to work... ;-)

(The installation of the executable might have actually failed without anybody noticing that, because the exit code of `cp` wasn't checked and, worse, an unconditional `exit 0` followed. The p5 spkg should still be checked on Cygwin w.r.t. this.)


---

Comment by kcrisman created at 2011-08-19 12:54:51

Ok, here is an update. [This picture](http://sage.math.washington.edu/home/kcrisman/tachyonpic.png) was generated by an alpha of 4.7.1 that has this p4 installed.  Looking in `local/bin/` finds tachyon.exe already there.

My guess is that Cygwin "knows" that it's supposed to be .exe as an ending and behaves accordingly?   In any case, the picture is proof, as well as the result of `ls local/bin/tachyo[tab]`.

I'll try installing the spkg at #11706 and make sure that still works.  Shouldn't take long to deal with, I hope.


---

Comment by kcrisman created at 2011-08-19 12:54:51

Changing status from needs_info to needs_review.


---

Comment by leif created at 2011-08-19 13:02:53

Replying to [comment:17 kcrisman]:
> I'll try installing the spkg at #11706 and make sure that still works.  Shouldn't take long to deal with, I hope.

You can install it with the `-s` option (`./sage -f -s ...`) and afterwards look into the subdirectory `src/compile/win32/` of the Tachyon build directory (the latter given in the message _"You can safely delete ..."_).


---

Comment by kcrisman created at 2011-08-19 13:08:36

Too late, I already just installed the whole thing and it works.  See my comments at #11706.


---

Comment by leif created at 2011-08-19 15:21:29

Replying to [comment:19 kcrisman]:
> Too late, I already just installed the whole thing and it works.  See my comments at #11706.

 >:'( I was soooo curious...

And now I still don't know what weird magic Cygwin apparently applies (either the shell or `cp`) that _both_ spkgs seem to install the `.exe` file.

Do you have a single `tachyon.exe` in `$SAGE_ROOT/local/bin/` or do you have both, one with and another without the extension?


---

Comment by kcrisman created at 2011-08-19 15:54:41

Replying to [comment:20 leif]:
> Replying to [comment:19 kcrisman]:
> > Too late, I already just installed the whole thing and it works.  See my comments at #11706.
> 
>  >:'( I was soooo curious...

Just for you, I restarted my virtual machine, waited a long time, and then reinstalled (`-f -s`) the p4 spkg, which does not have the exe.  The directory in question has libtachyon, libtachyon.a, and tachyon.exe.  

_And_ I tried copying that tachyon.exe file by using `cp path/to/tachyon path/to/home/` and it worked.

It's possible that Cygwin/Windows treats exe's as folders, like Mac and .app's...

Hope that satisfies your curiosity!

> And now I still don't know what weird magic Cygwin apparently applies (either the shell or `cp`) that _both_ spkgs seem to install the `.exe` file.
> 
> Do you have a single `tachyon.exe` in `$SAGE_ROOT/local/bin/` or do you have both, one with and another without the extension?

Just the one with exe.


---

Comment by kcrisman created at 2011-08-19 15:54:41

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-08-22 09:24:30

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2011-08-22 09:24:30

Please remove the following garbage from the spkg:

```
? .DS_Store
? ._.DS_Store
? patches/.DS_Store
? patches/._.DS_Store
```



---

Comment by leif created at 2011-08-22 10:29:56

Replying to [comment:23 jdemeyer]:
> Please remove the following garbage from the spkg:

```
? .DS_Store
? ._.DS_Store
? patches/.DS_Store
? patches/._.DS_Store
```


Cf. [comment:8 this comment].

The spkg here is superseded by the p5 at #11706 anyway, in which these files aren't present.


---

Comment by jdemeyer created at 2011-08-22 12:05:52

Replying to [comment:24 leif]:
> The spkg here is superseded by the p5 at #11706 anyway, in which these files aren't present.

True, but that ticket does not yet have positive review.


---

Comment by kcrisman created at 2011-08-22 12:16:22

Replying to [comment:25 jdemeyer]:
> Replying to [comment:24 leif]:
> > The spkg here is superseded by the p5 at #11706 anyway, in which these files aren't present.
Leif already noticed these files above, and I already apologized :)
> True, but that ticket does not yet have positive review.
Presumably someone at the Sage Days can do this.  I think that whoever is funding that PPC Linux box is also funding that workshop.  (?)  

I don't see the point in making a new spkg when several other issues that needed addressing are taken care of in #11706.    If that ticket languishes I will do this, though.


---

Comment by leif created at 2011-08-27 03:21:39

Changing status from needs_work to positive_review.


---

Comment by leif created at 2011-08-27 03:21:39

Replying to [comment:26 kcrisman]:
> Replying to [comment:25 jdemeyer]:
> > Replying to [comment:24 leif]:
> > > The spkg here is superseded by the p5 at #11706 anyway, in which these files aren't present.
> Leif already noticed these files above, and I already apologized :)
> > True, but that ticket does not yet have positive review.

Now it does have, so I consider this a minor issue which doesn't have to be fixed here, too.

Therefore setting this ticket back to positive review, as I made #11706 formally depend on this one.


---

Comment by leif created at 2011-09-12 18:20:18

Resolution: fixed
