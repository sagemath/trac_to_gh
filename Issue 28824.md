# Issue 28824: Upgrade to symmetrica-3.0.1

Issue created by migration from https://trac.sagemath.org/ticket/29061

Original creator: mjo

Original creation time: 2020-01-21 16:18:57

CC:  arojas fbissey saraedum @timokau

I tagged a new release of symmetrica with all of the build/crash fixes from over the years:

* https://gitlab.com/sagemath/symmetrica/-/releases
* https://gitlab.com/sagemath/symmetrica/uploads/b3d8e1ad5ab2449c30bbc3147e7a5e53/symmetrica-3.0.1.tar.xz

A standard ./configure && make && make install should suffice, with no patching.



---

Comment by @timokau created at 2020-03-10 11:58:28

The README states "The original developers of symmetrica at the University of Bayreuth are no longer active, but symmetrica is still in use in [SageMath](SageMath) and elsewhere". Is there some source to this claim? Did anyone ever try contacting upstream?


---

Comment by mjo created at 2020-03-10 13:11:10

Replying to [comment:2 gh-timokau]:
> The README states "The original developers of symmetrica at the University of Bayreuth are no longer active, but symmetrica is still in use in [SageMath](SageMath) and elsewhere". Is there some source to this claim? Did anyone ever try contacting upstream?

Yes, the primary maintainer passed away a few years ago and as far as I know there is no one else at Bayreuth working on symmetrica. A colleague of his, Michael Kiermaier, has given us his blessing insofar as is possible. And the other distribution maintainers are on board.


---

Comment by @timokau created at 2020-03-10 13:15:58

Ah, now I remember the [sage-devel discussion](https://groups.google.com/d/msg/sage-devel/AE2rFtJxO-c/GgXibjI-BAAJ). That is sad to hear. Thanks for clarifying.


---

Comment by mkoeppe created at 2020-04-18 16:28:41

Is there anything in the new release that provides version information to programs linking to the library?


---

Comment by mjo created at 2020-04-19 16:16:59

Replying to [comment:5 mkoeppe]:
> Is there anything in the new release that provides version information to programs linking to the library?

You can detect this exact version by looking at the soname (which was bumped) or some of the files we rearranged. We also took a few things out of the public API that were there by mistake (and so can be detected).

But long term, this is the way to go: https://gitlab.com/sagemath/symmetrica/-/issues/10


---

Comment by dimpase created at 2020-09-19 07:56:12

Changing priority from major to blocker.


---

Comment by dimpase created at 2020-09-19 07:56:12

here is a branch, please test.
It builds with SAGE_CHECK=yes on macOS 10.15 with Xcode 12.
----
New commits:


---

Comment by dimpase created at 2020-09-19 07:56:12

Changing status from new to needs_review.


---

Comment by dimpase created at 2020-09-19 08:24:34

also works on Fedora 30 - but for some reason I need to download the tarball mentioned in checksum.ini manually.


---

Comment by mjo created at 2020-09-19 14:39:03

`CFLAGS="-O2"` should suffice. The preprocessor definitions are made automatically now in `src/Makefile.am`:


```
# -DFAST disables some runtime checks in src/macro.h to speed things up.
#
# -DALLTRUE defines a bunch of other constants in def.h that ultimately
# enable every symmetrica "subsystem."
libsymmetrica_la_CPPFLAGS = -DFAST -DALLTRUE
```


The `cd src` can also be dropped. Right now, `src` is the only subdirectory with a test suite, but `make check` at the top level runs is what runs them all.


---

Comment by dimpase created at 2020-09-19 15:34:04

please add commits as you see fit.


---

Comment by mkoeppe created at 2020-09-19 20:16:26

Replying to [comment:9 dimpase]:
> also works on Fedora 30 - but for some reason I need to download the tarball mentioned in checksum.ini manually.
We had the same problems on another upgrade ticket that used a gitlab URL. Perhaps best to put the tarball somewhere else to allow for automatic testing...


---

Comment by git created at 2020-09-20 07:41:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-09-20 08:14:20

OK, this location for tarball works


---

Comment by jhpalmieri created at 2020-09-20 16:40:28

This works for me, too, with Xcode 12.


---

Comment by tscrim created at 2020-09-21 23:32:24

Works for me on Ubuntu 18.


---

Comment by mkoeppe created at 2020-09-22 13:59:46

As usual, this should be run on GH Actions.


---

Comment by dimpase created at 2020-09-22 15:44:23

tests run on https://github.com/dimpase/sage/pull/17


---

Comment by mkoeppe created at 2020-09-23 04:11:13

Patches don't apply - see for example https://github.com/mkoeppe/sage/runs/1152418779


---

Comment by mkoeppe created at 2020-09-23 04:11:13

Changing status from needs_review to needs_work.


---

Comment by jhpalmieri created at 2020-09-23 05:22:37

What patches? The branch removes all of them.


---

Comment by jhpalmieri created at 2020-09-23 05:24:35

Oh, don't use both #30608 and this ticket, use just this one. If this one gets positively reviewed, that one can be closed as invalid. If this one runs into problems or takes too long to get reviewed on enough platforms, then #30608 will be a stopgap.


---

Comment by jhpalmieri created at 2020-09-23 05:25:02

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2020-09-23 11:25:28

Replying to [comment:21 jhpalmieri]:
> Oh, don't use both #30608 and this ticket, use just this one. If this one gets positively reviewed, that one can be closed as invalid. If this one runs into problems or takes too long to get reviewed on enough platforms, then #30608 will be a stopgap.

Ah, my mistake, sorry for the noise. I had merged all the Xcode 12 related tickets that were in positive review or needs review status.


---

Comment by mkoeppe created at 2020-09-24 00:02:41

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-09-30 22:30:28

Resolution: fixed
