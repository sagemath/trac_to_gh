# Issue 23190: intersection of hyperbolic geodesics is wrong

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2017-07-13 21:12:00

CC:  jhonrubia6 slelievre

Keywords: bug

The following geodesics do not intersect but Sage thinks they do

```
sage: UHP = HyperbolicPlane().UHP()
sage: g1 = UHP.get_geodesic(2*QQbar.gen(), 5)
sage: g2 = UHP.get_geodesic(-1/2, Infinity)
sage: g1.intersection(g2)
[Point in UHP -0.500000000000000? + 1.284523257866513?*I]
```



---

Comment by jhonrubia6 created at 2017-07-14 12:38:21

It seems easy. Checking that the real part of the fixed point of both involutions lies between the real part of endpoints of both geodesics,would be a fast implementation.
Are you going to tackle this? I have time these days to code it.


---

Comment by jhonrubia6 created at 2017-08-01 17:51:28

New commits:


---

Comment by jhonrubia6 created at 2017-08-01 17:51:28

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2017-08-01 20:50:32

What about vertical geodesics?


---

Comment by vdelecroix created at 2017-08-03 08:30:16

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2017-08-03 08:30:16

Replying to [comment:4 vdelecroix]:
> What about vertical geodesics?

More precisely

```
sage: UHP = HyperbolicPlane().UHP()
sage: g1 = UHP.get_geodesic(I, 2*I)
sage: g2 = UHP.get_geodesic(I/2, 4*I)
sage: g3 = UHP.get_geodesic(3*I, 4*I)
sage: g1.intersection(g2)
[Boundary point in UHP +Infinity, Boundary point in UHP 0]
sage: g1.intersection(g3)
[Boundary point in UHP +Infinity, Boundary point in UHP 0]
```



---

Comment by jhonrubia6 created at 2017-08-10 09:54:26

we also need to correct

```
sage: UHP = HyperbolicPlane().UHP()
sage: g1=UHP.get_geodesic(-1,+1)
sage: g2=UHP.get_geodesic(-1,-1+2*I)
sage: g1.intersection(g2)
[]
```

should return

```
[Boundary point in UHP -1]
```

and

```
UHP = HyperbolicPlane().UHP()
g1=UHP.get_geodesic(-1,I)
g2=UHP.get_geodesic(+1,(+cos(pi/3)+I*sin(pi/3)))
[Boundary point in UHP -1, Boundary point in UHP 1]
```

should return `[]`

What should be the correct answer of the function in the following case?

```
UHP = HyperbolicPlane().UHP()
g1=UHP.get_geodesic(I,3*I)
g2=UHP.get_geodesic(2*I,4*I)
```

Maybe

```
[2*I,3*I]
```

or

```
Geodesic in UHP from 2*I to 3*I
```



---

Comment by vdelecroix created at 2017-08-10 10:07:39

Replying to [comment:6 jhonrubia6]:
>
> <SNIP>
>
> What should be the correct answer of the function in the following case?
> {{{
> UHP = HyperbolicPlane().UHP()
> g1=UHP.get_geodesic(I,3*I)
> g2=UHP.get_geodesic(2*I,4*I)
> }}}
> Maybe
> {{{
> [2*I,3*I]
> }}}

definitely not

> or
> {{{
> Geodesic in UHP from 2*I to 3*I
> }}}

Much better


---

Comment by git created at 2021-11-13 17:57:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slelievre created at 2021-11-13 18:03:00

Ideally, work on top of the develop branch
(currently Sage 9.5.beta6) rather than master.


---

Comment by jhonrubia6 created at 2021-11-13 18:05:46

Replying to [comment:9 slelievre]:
> Ideally, work on top of the develop branch
> (currently Sage 9.5.beta6) rather than master.
Right, I've just noticed, I merge with develop and re-submit


---

Comment by git created at 2021-11-16 18:34:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhonrubia6 created at 2021-11-16 18:42:14

However an important new bug appeared when dealing with the intersection in the PD model:


```
sage: g=HyperbolicPlane().PD().random_geodesic()
sage: h = g.perpendicular_bisector().complete()
sage: g.intersection(h)
[]

```


which is an obvious error. Somehow the problem lies in the abstract method `intersection(self, other)`

```
sage: g._cached_geodesic.intersection(h)
[]
```

whereas

```
sage: g._cached_geodesic.intersection(h._cached_geodesic)
[Point in UHP -1.27483700342883 + 2.78119562788909*I]
```

However

```
sage: g=HyperbolicPlane().PD().random_geodesic()
sage: h = g.perpendicular_bisector().complete()
sage: g.intersection(h)
[Point in UHP 0.815206723839169 + 2.95290895719856*I]
```


Work in progress


---

Comment by git created at 2021-11-17 17:53:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-11-17 22:29:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhonrubia6 created at 2021-11-20 10:11:15

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2021-11-25 23:11:48

Just merge (or rebase) locally, and push the merged branch.


---

Comment by @DaveWitteMorris created at 2021-11-26 00:47:59

Here are the merge conflicts that I see with 9.5b7. They are in the `EXAMPLES` sections of the two `perpendicular_bisector` methods. 

```
<<<<<<< HEAD
            sage: h = g.perpendicular_bisector()
            sage: P = g.plot(color='blue')+h.plot(color='orange');P  # optional - sage.plot
=======
            sage: h = g.perpendicular_bisector().complete()
            sage: P = g.plot(color='blue')+h.plot(color='orange');P
>>>>>>> b0648b27e31c67536205a4fe9c4e85d66adea382
```


```
<<<<<<< HEAD
            sage: h = g.perpendicular_bisector()
            sage: show(g.plot(color='blue')+h.plot(color='orange'))  # optional - sage.plot
=======
            sage: h = g.perpendicular_bisector().complete()
            sage: show(g.plot(color='blue')+h.plot(color='orange'))
>>>>>>> b0648b27e31c67536205a4fe9c4e85d66adea382
```



---

Comment by dimpase created at 2021-11-26 15:09:00

so just use the lines in HEAD when you resolve the conflict.


---

Comment by dimpase created at 2021-11-26 15:12:09

sorry - if these `.complete()` things are in the ticket's branch the you need  to do the obvious editing.


---

Comment by @DaveWitteMorris created at 2021-11-29 07:30:38

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-11-29 17:49:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhonrubia6 created at 2021-11-30 19:49:39

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2021-12-03 13:24:30

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2021-12-03 13:24:30

clean up is needed:

```
% tox -e pycodestyle --  src/sage/geometry/hyperbolic_space/hyperbolic_geodesic.py
pycodestyle recreate: /Users/dima/sage/.tox/src
pycodestyle run-test-pre: PYTHONHASHSEED='3653170419'
pycodestyle run-test: commands[0] | tox -c /Users/dima/sage/src/tox.ini -e pycodestyle -- src/sage/geometry/hyperbolic_space/hyperbolic_geodesic.py
pycodestyle create: /Users/dima/sage/src/.tox/pycodestyle
pycodestyle installdeps: pycodestyle
pycodestyle installed: pycodestyle==2.8.0
pycodestyle run-test-pre: PYTHONHASHSEED='400015120'
pycodestyle run-test: commands[0] | pycodestyle sage/geometry/hyperbolic_space/hyperbolic_geodesic.py
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1043:1: E265 block comment should start with '# '
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1045:1: E265 block comment should start with '# '
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1155:1: W293 blank line contains whitespace
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1358:1: W293 blank line contains whitespace
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1388:1: W293 blank line contains whitespace
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1395:1: W293 blank line contains whitespace
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1401:1: W293 blank line contains whitespace
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1407:1: W293 blank line contains whitespace
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1413:1: W293 blank line contains whitespace
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1419:1: W293 blank line contains whitespace
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1425:1: W293 blank line contains whitespace
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1431:1: W293 blank line contains whitespace
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1443:1: W293 blank line contains whitespace
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1449:1: W293 blank line contains whitespace
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1455:1: W293 blank line contains whitespace
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1460:25: E225 missing whitespace around operator
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1462:9: E265 block comment should start with '# '
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1467:9: E265 block comment should start with '# '
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1468:9: E265 block comment should start with '# '
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1469:42: E261 at least two spaces before inline comment
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1469:43: E262 inline comment should start with '# '
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1470:20: E231 missing whitespace after ','
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1470:43: W291 trailing whitespace
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1473:24: E231 missing whitespace after ','
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1474:9: E265 block comment should start with '# '
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1475:9: E265 block comment should start with '# '
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1477:20: E231 missing whitespace after ','
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1480:24: E231 missing whitespace after ','
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1483:23: E225 missing whitespace around operator
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1483:42: E225 missing whitespace around operator
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1486:17: E265 block comment should start with '# '
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1488:21: E265 block comment should start with '# '
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1489:28: E231 missing whitespace after ','
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1489:46: E231 missing whitespace after ','
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1491:25: E225 missing whitespace around operator
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1494:52: E231 missing whitespace after ','
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1494:59: E261 at least two spaces before inline comment
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1494:60: E262 inline comment should start with '# '
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1495:34: E225 missing whitespace around operator
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1500:17: E265 block comment should start with '# '
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1501:17: E265 block comment should start with '# '
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1502:34: E225 missing whitespace around operator
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1503:28: E231 missing whitespace after ','
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1505:25: E225 missing whitespace around operator
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1507:34: E225 missing whitespace around operator
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1512:13: E265 block comment should start with '# '
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1513:13: E265 block comment should start with '# '
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1514:30: E225 missing whitespace around operator
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1515:24: E231 missing whitespace after ','
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1518:17: E265 block comment should start with '# '
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1532:21: E265 block comment should start with '# '
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1533:29: E225 missing whitespace around operator
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1537:42: E225 missing whitespace around operator
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1537:52: E225 missing whitespace around operator
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1537:85: E225 missing whitespace around operator
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1537:95: E225 missing whitespace around operator
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:1874:1: W293 blank line contains whitespace
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:2031:13: E741 ambiguous variable name 'I'
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:2036:13: E741 ambiguous variable name 'I'
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:2143:1: E265 block comment should start with '# '
sage/geometry/hyperbolic_space/hyperbolic_geodesic.py:2145:1: E265 block comment should start with '# '
14      E225 missing whitespace around operator
9       E231 missing whitespace after ','
2       E261 at least two spaces before inline comment
2       E262 inline comment should start with '# '
17      E265 block comment should start with '# '
2       E741 ambiguous variable name 'I'
1       W291 trailing whitespace
14      W293 blank line contains whitespace
ERROR: InvocationError for command /Users/dima/sage/src/.tox/pycodestyle/bin/pycodestyle sage/geometry/hyperbolic_space/hyperbolic_geodesic.py (exited with code 1)
______________________________ summary _______________________________
ERROR:   pycodestyle: commands failed
ERROR: InvocationError for command /usr/local/bin/tox -c src/tox.ini -e pycodestyle -- src/sage/geometry/hyperbolic_space/hyperbolic_geodesic.py (exited with code 1)
```


all of these except E741 can be trivially fixed. (Leave E741 as is).


---

Comment by git created at 2021-12-06 20:16:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhonrubia6 created at 2021-12-06 20:17:47

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2021-12-06 22:31:15

OK, good.


---

Comment by dimpase created at 2021-12-06 22:31:15

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-12-19 11:47:55

Resolution: fixed
