# Issue 10796: Bug in Huffman  algorithm

archive/issues_010796.json:
```json
{
    "body": "Assignee: wdj\n\nCC:  ncohen mvngu\n\nKeywords: huffman\n\nThere seems to be a bug in the Huffman build algorithm when given a frequency dictionary.\n\nThe following example results in a wrong encoding table: Let there be 10 symbols numbered 1,..,10 where number i occurs with probability i/55.\nThe Huffman table I end up with, manually running the algorithm is something like the following:\n\n\n```\n{ 1: '00000', 2: '00001', 3: '0001', 4: '1000', 5: '1001',\n  6: '001', 7: '110', 8: '111', 9: '101', 10: '01' }\n```\n\n\nwhich has expected length 173/55.\n\nThe current Huffman-algorithm returns\n\n\n```\n{1: '1100', 2: '1101', 3: '1110', 4: '1111', 5: '000',\n 6: '001', 7: '010', 8: '011', 9: '100', 10: '101'}\n```\n\n\nwhich has expected length 175/55.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10864\n\n",
    "created_at": "2011-03-01T09:27:40Z",
    "labels": [
        "coding theory",
        "major",
        "bug"
    ],
    "title": "Bug in Huffman  algorithm",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10796",
    "user": "jsrn"
}
```
Assignee: wdj

CC:  ncohen mvngu

Keywords: huffman

There seems to be a bug in the Huffman build algorithm when given a frequency dictionary.

The following example results in a wrong encoding table: Let there be 10 symbols numbered 1,..,10 where number i occurs with probability i/55.
The Huffman table I end up with, manually running the algorithm is something like the following:


```
{ 1: '00000', 2: '00001', 3: '0001', 4: '1000', 5: '1001',
  6: '001', 7: '110', 8: '111', 9: '101', 10: '01' }
```


which has expected length 173/55.

The current Huffman-algorithm returns


```
{1: '1100', 2: '1101', 3: '1110', 4: '1111', 5: '000',
 6: '001', 7: '010', 8: '011', 9: '100', 10: '101'}
```


which has expected length 175/55.

Issue created by migration from https://trac.sagemath.org/ticket/10864





---

archive/issue_comments_114292.json:
```json
{
    "body": "This happens when Sage is fed with a dictionnary where it expects a string.\n\n\n```\nsage: freq = dict([(i,i) for i in range(1,11)])\nsage: freq\n{1: 1, 2: 2, 3: 3, 4: 4, 5: 5, 6: 6, 7: 7, 8: 8, 9: 9, 10: 10}\n\nsage: Huffman(freq).encoding_table()\n{1: '1100', 2: '1101', 3: '1110', 4: '1111', 5: '000', 6: '001', 7: '010', 8: '011', 9: '100', 10: '101'}\n\nsage: Huffman(table = freq).encoding_table()\n{1: '01110', 2: '01111', 3: '0110', 4: '1110', 5: '1111', 6: '010', 7: '100', 8: '101', 9: '110', 10: '00'}\nsage: enc = Huffman(table = freq).encoding_table()\nsage: sum(map(lambda (x,y): x*len(y),enc.items()))\n173\n```\n\n\nThis would take half a second to notice if only Sage was returning an error rather than work on a dictionary instead of a string. This patch should avoid this problem in the future `:-)`\n\nNathann",
    "created_at": "2011-03-01T16:43:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114292",
    "user": "ncohen"
}
```

This happens when Sage is fed with a dictionnary where it expects a string.


```
sage: freq = dict([(i,i) for i in range(1,11)])
sage: freq
{1: 1, 2: 2, 3: 3, 4: 4, 5: 5, 6: 6, 7: 7, 8: 8, 9: 9, 10: 10}

sage: Huffman(freq).encoding_table()
{1: '1100', 2: '1101', 3: '1110', 4: '1111', 5: '000', 6: '001', 7: '010', 8: '011', 9: '100', 10: '101'}

sage: Huffman(table = freq).encoding_table()
{1: '01110', 2: '01111', 3: '0110', 4: '1110', 5: '1111', 6: '010', 7: '100', 8: '101', 9: '110', 10: '00'}
sage: enc = Huffman(table = freq).encoding_table()
sage: sum(map(lambda (x,y): x*len(y),enc.items()))
173
```


This would take half a second to notice if only Sage was returning an error rather than work on a dictionary instead of a string. This patch should avoid this problem in the future `:-)`

Nathann



---

archive/issue_comments_114293.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-03-01T16:43:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114293",
    "user": "ncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_114294.json:
```json
{
    "body": "Oh.. Thanks ! :-)",
    "created_at": "2011-03-01T16:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114294",
    "user": "ncohen"
}
```

Oh.. Thanks ! :-)



---

archive/issue_comments_114295.json:
```json
{
    "body": "Minor: the doctest says \" Feeding a dictionary instead of a string:: \", but then feeds it a list of strings, not a dictionary.\nAnd I don't know if this was intended, but the use of isinstance(string,str) rules out the use of unicode strings.",
    "created_at": "2011-03-02T01:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114295",
    "user": "dsm"
}
```

Minor: the doctest says " Feeding a dictionary instead of a string:: ", but then feeds it a list of strings, not a dictionary.
And I don't know if this was intended, but the use of isinstance(string,str) rules out the use of unicode strings.



---

archive/issue_comments_114296.json:
```json
{
    "body": "Ok, I see that I used the class in the wrong way :-)\n\nWouldn't it be more user-friendly to change the Huffman constructor to accept only one unnamed argument, and then treat it according to type, e.g:\n\n\n```\ndef __init__(self, source):\n  if isinstance(source, string):\n     # init by string\n  elif isinstance(source, dict):\n     # init by dict\n  else:\n     # give the user an error\n```\n\n\n(Because of deprecation policy, I guess we would need to support the current interface in some way, which would make the code a bit messy, but that will only be for a year)",
    "created_at": "2011-03-02T07:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114296",
    "user": "jsrn"
}
```

Ok, I see that I used the class in the wrong way :-)

Wouldn't it be more user-friendly to change the Huffman constructor to accept only one unnamed argument, and then treat it according to type, e.g:


```
def __init__(self, source):
  if isinstance(source, string):
     # init by string
  elif isinstance(source, dict):
     # init by dict
  else:
     # give the user an error
```


(Because of deprecation policy, I guess we would need to support the current interface in some way, which would make the code a bit messy, but that will only be for a year)



---

archive/issue_comments_114297.json:
```json
{
    "body": "Hello !\n\nReplying to [comment:6 dsm]:\n> Minor: the doctest says \" Feeding a dictionary instead of a string:: \", but then feeds it a list of strings, not a dictionary.\n\nRight. I just thought : \"Let's feed it anything but a string\"\n\n> And I don't know if this was intended, but the use of isinstance(string,str) rules out the use of unicode strings.\n\nI don't know what an unicode string is, and I will try to find it out immediately. How do you think we should filter it then ?\n\nNathann",
    "created_at": "2011-03-02T07:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114297",
    "user": "ncohen"
}
```

Hello !

Replying to [comment:6 dsm]:
> Minor: the doctest says " Feeding a dictionary instead of a string:: ", but then feeds it a list of strings, not a dictionary.

Right. I just thought : "Let's feed it anything but a string"

> And I don't know if this was intended, but the use of isinstance(string,str) rules out the use of unicode strings.

I don't know what an unicode string is, and I will try to find it out immediately. How do you think we should filter it then ?

Nathann



---

archive/issue_comments_114298.json:
```json
{
    "body": "Replying to [comment:8 ncohen]:\n\n> I don't know what an unicode string is, and I will try to find it out immediately. How do you think we should filter it then ?\n\nI think the usual idiom in python 2 is \"isinstance(s, basestring)\" to allow both.",
    "created_at": "2011-03-02T08:59:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114298",
    "user": "dsm"
}
```

Replying to [comment:8 ncohen]:

> I don't know what an unicode string is, and I will try to find it out immediately. How do you think we should filter it then ?

I think the usual idiom in python 2 is "isinstance(s, basestring)" to allow both.



---

archive/issue_comments_114299.json:
```json
{
    "body": "Hello !!\n\nThis is an updated patch in which string has been replaced by basename, and an unique argument is expected by the constructor.\n\nThis class being pretty new and not really advertised, perhaps we can do without backward compatibility for once ?.. `:-p`\n\nI mean, this class is perhaps only useful to illustrate what the Huffman algorithm is (slow encoding in Python..), and updating a possibly uncompatible (if it exists somewhere in the world) should not take more than a few seconds `:-)`\n\nNathann",
    "created_at": "2011-03-02T09:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114299",
    "user": "ncohen"
}
```

Hello !!

This is an updated patch in which string has been replaced by basename, and an unique argument is expected by the constructor.

This class being pretty new and not really advertised, perhaps we can do without backward compatibility for once ?.. `:-p`

I mean, this class is perhaps only useful to illustrate what the Huffman algorithm is (slow encoding in Python..), and updating a possibly uncompatible (if it exists somewhere in the world) should not take more than a few seconds `:-)`

Nathann



---

archive/issue_comments_114300.json:
```json
{
    "body": "Attachment",
    "created_at": "2011-03-02T09:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114300",
    "user": "ncohen"
}
```

Attachment



---

archive/issue_comments_114301.json:
```json
{
    "body": "Nice patch. I agree with sidestepping the deprecation policy :-)\nI'll try and review once my 4.6.2 finish compiling :-P\n\nJohan",
    "created_at": "2011-03-02T14:33:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114301",
    "user": "jsrn"
}
```

Nice patch. I agree with sidestepping the deprecation policy :-)
I'll try and review once my 4.6.2 finish compiling :-P

Johan



---

archive/issue_comments_114302.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-03-03T11:17:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114302",
    "user": "jsrn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_114303.json:
```json
{
    "body": "Yep, works fine for me on 4.6.2, and code looks fine as well. Green light.",
    "created_at": "2011-03-03T11:17:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114303",
    "user": "jsrn"
}
```

Yep, works fine for me on 4.6.2, and code looks fine as well. Green light.



---

archive/issue_comments_114304.json:
```json
{
    "body": "Replying to [comment:12 jsrn]:\n> Yep, works fine for me on 4.6.2, and code looks fine as well. Green light.\n\nI object to the positive review. Note that the documentation for the class `Huffman` is out of sync with the definition of that class. For instance, the documentation still refers to the deleted argument `table`. Sorry for being nasty, but this ticket goes to \"needs_work\".",
    "created_at": "2011-03-03T11:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114304",
    "user": "mvngu"
}
```

Replying to [comment:12 jsrn]:
> Yep, works fine for me on 4.6.2, and code looks fine as well. Green light.

I object to the positive review. Note that the documentation for the class `Huffman` is out of sync with the definition of that class. For instance, the documentation still refers to the deleted argument `table`. Sorry for being nasty, but this ticket goes to "needs_work".



---

archive/issue_comments_114305.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-03-03T11:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114305",
    "user": "mvngu"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_114306.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-03-03T11:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114306",
    "user": "ncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_114307.json:
```json
{
    "body": "Argggggg !!! Sorry about that !!!\n\nI had been looking for occurrences of ``table =`` in the code to replace them by ``source`` or remove them, and I forgot some occurrences of ``table`` in the documentation.... I hope there is none left `:-)`\n\nNathann",
    "created_at": "2011-03-03T11:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114307",
    "user": "ncohen"
}
```

Argggggg !!! Sorry about that !!!

I had been looking for occurrences of ``table =`` in the code to replace them by ``source`` or remove them, and I forgot some occurrences of ``table`` in the documentation.... I hope there is none left `:-)`

Nathann



---

archive/issue_comments_114308.json:
```json
{
    "body": "Attachment",
    "created_at": "2011-03-03T11:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114308",
    "user": "ncohen"
}
```

Attachment



---

archive/issue_comments_114309.json:
```json
{
    "body": "Woops, sorry about that. Good thing you're awake Minh :-)\n\nI reread the whole thing with the new patch, and retested, rebuilt and redoc'ed. It seems alright now.",
    "created_at": "2011-03-03T11:47:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114309",
    "user": "jsrn"
}
```

Woops, sorry about that. Good thing you're awake Minh :-)

I reread the whole thing with the new patch, and retested, rebuilt and redoc'ed. It seems alright now.



---

archive/issue_comments_114310.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-03-03T11:47:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114310",
    "user": "jsrn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_114311.json:
```json
{
    "body": "Replying to [comment:16 jsrn]:\n> Woops, sorry about that. Good thing you're awake Minh :-)\n\nMinh is always awake. Minh does not rest, and sees everything. Minh is like a better version of Chuck Nurris invented by Chuck Nurris `O_O`\n\nNathann",
    "created_at": "2011-03-03T11:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114311",
    "user": "ncohen"
}
```

Replying to [comment:16 jsrn]:
> Woops, sorry about that. Good thing you're awake Minh :-)

Minh is always awake. Minh does not rest, and sees everything. Minh is like a better version of Chuck Nurris invented by Chuck Nurris `O_O`

Nathann



---

archive/issue_comments_114312.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-03-25T12:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10796#issuecomment-114312",
    "user": "jdemeyer"
}
```

Resolution: fixed
