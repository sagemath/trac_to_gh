# Issue 32815: conda-forge-macos-minimal: build error in brial

Issue created by migration from https://trac.sagemath.org/ticket/33052

Original creator: mkoeppe

Original creation time: 2021-12-20 22:00:44

CC:  fbissey dimpase isuruf

Tested using `tox -e local-conda-forge-macos-minimal` on a system that has homebrew (including `boost`) in `/usr/local`:

```
## -------------------------------------------------------------- ##
## Checking whether SageMath should install SPKG boost_cropped... ##
## -------------------------------------------------------------- ##
configure:14832: checking for boostlib >= 1.66.0 (106600)
configure:14864: x86_64-apple-darwin13.4.0-clang++ -std=gnu++11 -c -march=core2 -mtune=haswell -mssse3 -ftree-vectorize -fPIC -fPIE -fstack-protector-strong -O2 -pipe -stdlib=libc++ -fvisibility-inlines-hidden -std=c++14 -fmessage-length=0 -isystem /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/.tox/local-conda-forge-macos-minimal/conda/include -D_FORTIFY_SOURCE=2 -isystem /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/.tox/local-conda-forge-macos-minimal/conda/include -I/usr/local/include conftest.cpp >&5
configure:14864: $? = 0
configure:14866: result: yes
configure:15030: will use system package and not install SPKG boost_cropped
...
  [brial-1.2.8] error installing, exit status 1. End of log file:
  [brial-1.2.8]   In file included from ../../libbrial/include/polybori/BooleSet.h:23:
  [brial-1.2.8]   In file included from ../../libbrial/include/polybori/routines/pbori_func.h:22:
  [brial-1.2.8]   ../../libbrial/include/polybori/common/traits.h:26:10: fatal error: 'boost/preprocessor/cat.hpp' file not found
  [brial-1.2.8]   #include <boost/preprocessor/cat.hpp>
  [brial-1.2.8]            ^~~~~~~~~~~~~~~~~~~~~~~~~~~~
  [brial-1.2.8]   1 error generated.
  [brial-1.2.8]   make[8]: *** [Makefile:657: libbrial_groebner_la-ReductionStrategy.lo] Error 1
```


This failure follows a familiar pattern: Our `configure` script tests for the presence of `boost` but our build system does not tell the `boost`-using package (`brial`) where it is.




---

Comment by dimpase created at 2021-12-22 11:32:46

can this be fixed in our .homebrew... script?


---

Comment by mkoeppe created at 2021-12-22 18:03:22

Replying to [comment:2 dimpase]:
> can this be fixed in our .homebrew... script?

This is for conda, not homebrew.


---

Comment by fbissey created at 2021-12-22 21:23:31

I am a bit concerned that something in a standard location like `/usr/local/` is not found. If this is the case, there must be something wrong in `brial`'s own build system.

Since `boost` should be checked by `brial`'s `configure`, this is all the more confusing that things break down during compilation. I'd like to have more of the `brial` build log.


---

Comment by fbissey created at 2021-12-22 21:39:21

OK, I have reminded myself of https://github.com/cschwan/sage-on-gentoo/issues/551 (it becomes really interesting from https://github.com/cschwan/sage-on-gentoo/issues/551#issuecomment-593621077 onwards when I make progress towards identifying some weird bits) in which I concluded that it was a good idea to always provide `--with-boost=...` _and_ `--with-boost-libdir=...` to `brial`'s configure because of the quirks in `AX_BOOST_BASE` macros. While I cannot spot anything special about OS X, I cannot dismiss a special case being in action


---

Comment by mkoeppe created at 2021-12-22 22:04:45

Replying to [comment:4 fbissey]:
> I am a bit concerned that something in a standard location like `/usr/local/` is not found. If this is the case, there must be something wrong in `brial`'s own build system.

No, I don't think so. On macOS, I would not consider `/usr/local` as a standard location but rather as a "legacy location"; because it is disabled in various contexts by setting the sysroot explicitly to one of the Xcode sysroots.

Note that the only reason that our `configure` script finds Boost is that it explicitly searches some candidate locations which are not on compiler search paths.
