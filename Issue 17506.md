# Issue 17506: Plots are not shown in the notebook without show

archive/issues_017506.json:
```json
{
    "body": "In Sage-6.5.rc0 entering\n\n```\nplot(sin(x))\n```\n\ninto a cell and evaluating it produces nothing, while a plot has to be shown without necessity to add show command explicitly.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17743\n\n",
    "created_at": "2015-02-07T00:57:04Z",
    "labels": [
        "notebook",
        "blocker",
        "bug"
    ],
    "title": "Plots are not shown in the notebook without show",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17506",
    "user": "novoselt"
}
```
In Sage-6.5.rc0 entering

```
plot(sin(x))
```

into a cell and evaluating it produces nothing, while a plot has to be shown without necessity to add show command explicitly.

Issue created by migration from https://trac.sagemath.org/ticket/17743





---

archive/issue_comments_233804.json:
```json
{
    "body": "In case it helps: I had a similar issue upgrading to Sage-6.4 in SageCell. The solution was https://github.com/novoselt/sage/commit/6b47f2e388a7e7b23243862a314313abe1344ed3",
    "created_at": "2015-02-07T00:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233804",
    "user": "novoselt"
}
```

In case it helps: I had a similar issue upgrading to Sage-6.4 in SageCell. The solution was https://github.com/novoselt/sage/commit/6b47f2e388a7e7b23243862a314313abe1344ed3



---

archive/issue_comments_233805.json:
```json
{
    "body": "works for me...\n\nare you using vanilla Sage 6.5.rc0?",
    "created_at": "2015-02-07T09:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233805",
    "user": "jdemeyer"
}
```

works for me...

are you using vanilla Sage 6.5.rc0?



---

archive/issue_comments_233806.json:
```json
{
    "body": "In any case, you should test with #17645.",
    "created_at": "2015-02-07T09:21:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233806",
    "user": "jdemeyer"
}
```

In any case, you should test with #17645.



---

archive/issue_comments_233807.json:
```json
{
    "body": "works for me, too.",
    "created_at": "2015-02-08T09:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233807",
    "user": "vbraun"
}
```

works for me, too.



---

archive/issue_comments_233808.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-08T10:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233808",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_233809.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-08T10:06:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233809",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_233810.json:
```json
{
    "body": "Resolution: worksforme",
    "created_at": "2015-02-08T15:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233810",
    "user": "vbraun"
}
```

Resolution: worksforme



---

archive/issue_comments_233811.json:
```json
{
    "body": "I have observed it on my installation with a separate worker account. After `make distclean` and recompiling I still see this, while on a local machine everything works fine.\n\nCan someone test it with multiple accounts?",
    "created_at": "2015-02-08T17:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233811",
    "user": "novoselt"
}
```

I have observed it on my installation with a separate worker account. After `make distclean` and recompiling I still see this, while on a local machine everything works fine.

Can someone test it with multiple accounts?



---

archive/issue_comments_233812.json:
```json
{
    "body": "Multiple accounts or `server_pool`? I tried both and they both work. Do you get any log on the commandline?",
    "created_at": "2015-02-09T00:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233812",
    "user": "vbraun"
}
```

Multiple accounts or `server_pool`? I tried both and they both work. Do you get any log on the commandline?



---

archive/issue_comments_233813.json:
```json
{
    "body": "Yes!\n\n```\n2015-02-08 17:13:19-0700 [HTTPChannel,5,192.168.122.1] Error copying file from worksheet process: [Errno 13] Permission denied: '/tmp/tmpeF7EjV/sage0.png'\n```\n\nThis is after executing a command that should show a plot, but does not. The file has 0600 permissions. It seems that commands with explicit `show` do not create these files, they are served from somewhere else (or perhaps moved?).",
    "created_at": "2015-02-09T00:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233813",
    "user": "novoselt"
}
```

Yes!

```
2015-02-08 17:13:19-0700 [HTTPChannel,5,192.168.122.1] Error copying file from worksheet process: [Errno 13] Permission denied: '/tmp/tmpeF7EjV/sage0.png'
```

This is after executing a command that should show a plot, but does not. The file has 0600 permissions. It seems that commands with explicit `show` do not create these files, they are served from somewhere else (or perhaps moved?).



---

archive/issue_comments_233814.json:
```json
{
    "body": "Confirmed with `server_pool`!\n\nI think this bug should be reopened as Sage 6.5 blocker.",
    "created_at": "2015-02-09T09:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233814",
    "user": "jdemeyer"
}
```

Confirmed with `server_pool`!

I think this bug should be reopened as Sage 6.5 blocker.



---

archive/issue_comments_233815.json:
```json
{
    "body": "Thats a configuration issue, the worker process needs to set a umask (in `.bashrc`, for example) that allows the server to read the temporary files.",
    "created_at": "2015-02-09T09:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233815",
    "user": "vbraun"
}
```

Thats a configuration issue, the worker process needs to set a umask (in `.bashrc`, for example) that allows the server to read the temporary files.



---

archive/issue_comments_233816.json:
```json
{
    "body": "It's not purely a configuration issue, as Sage 6.3 does not have this problem.\n\n6.4 and 6.4.1 *do* have the problem.",
    "created_at": "2015-02-09T12:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233816",
    "user": "jdemeyer"
}
```

It's not purely a configuration issue, as Sage 6.3 does not have this problem.

6.4 and 6.4.1 *do* have the problem.



---

archive/issue_comments_233817.json:
```json
{
    "body": "That seems to be about the time the new display hook was brought into play, maybe?",
    "created_at": "2015-02-09T15:56:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233817",
    "user": "kcrisman"
}
```

That seems to be about the time the new display hook was brought into play, maybe?



---

archive/issue_comments_233818.json:
```json
{
    "body": "There are a number of other permission issues, e.g. by default `server_pool` doesn't work on my machine because my home directory is 0x700 so the worker can't start my Sage installation.\n\nIMHO its a stupid design to send data back in temp files, the results should be serialized properly and sent though a pipe or socket. See also: Make Sage usable as a library (https://groups.google.com/d/msg/sage-devel/87Rlenvcfrs/-vOyTkZ_FGYJ)",
    "created_at": "2015-02-09T15:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233818",
    "user": "vbraun"
}
```

There are a number of other permission issues, e.g. by default `server_pool` doesn't work on my machine because my home directory is 0x700 so the worker can't start my Sage installation.

IMHO its a stupid design to send data back in temp files, the results should be serialized properly and sent though a pipe or socket. See also: Make Sage usable as a library (https://groups.google.com/d/msg/sage-devel/87Rlenvcfrs/-vOyTkZ_FGYJ)



---

archive/issue_comments_233819.json:
```json
{
    "body": "Replying to [comment:19 vbraun]:\n> There are a number of other permission issues, e.g. by default `server_pool` doesn't work on my machine because my home directory is 0x700 so the worker can't start my Sage installation.\nYou mean you install Sage in your unaccessible home directory? Now **that's** a configuration problem, not a Sage issue.\n\n> IMHO its a stupid design to send data back in temp files\nPerhaps, but that's not the point of this ticket.",
    "created_at": "2015-02-09T16:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233819",
    "user": "jdemeyer"
}
```

Replying to [comment:19 vbraun]:
> There are a number of other permission issues, e.g. by default `server_pool` doesn't work on my machine because my home directory is 0x700 so the worker can't start my Sage installation.
You mean you install Sage in your unaccessible home directory? Now **that's** a configuration problem, not a Sage issue.

> IMHO its a stupid design to send data back in temp files
Perhaps, but that's not the point of this ticket.



---

archive/issue_comments_233820.json:
```json
{
    "body": "> Perhaps, but that's not the point of this ticket.\n\nExactly - what we have is a subtle but important regression that appears under certain conditions, which perhaps has a relatively easy fix. \"Configuration problem\" is when nothing works at all and there are some indications to what is wrong. Here, a fix would be to set group readable permissions somewhere where those files are created, instead of relying on UMASK (or perhaps set/improve UMASK at the start of Sage to be what is necessary). I am also curious why these files are treated differently than those created with explicit show command...",
    "created_at": "2015-02-09T16:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233820",
    "user": "novoselt"
}
```

> Perhaps, but that's not the point of this ticket.

Exactly - what we have is a subtle but important regression that appears under certain conditions, which perhaps has a relatively easy fix. "Configuration problem" is when nothing works at all and there are some indications to what is wrong. Here, a fix would be to set group readable permissions somewhere where those files are created, instead of relying on UMASK (or perhaps set/improve UMASK at the start of Sage to be what is necessary). I am also curious why these files are treated differently than those created with explicit show command...



---

archive/issue_comments_233821.json:
```json
{
    "body": "Replying to [comment:20 jdemeyer]:\n> You mean you install Sage in your unaccessible home directory? Now **that's** a configuration problem, not a Sage issue.\n\nBut every new distro defaults to private home directories, and you have to guess from a rather obscure error message that this is the issue.",
    "created_at": "2015-02-09T16:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233821",
    "user": "vbraun"
}
```

Replying to [comment:20 jdemeyer]:
> You mean you install Sage in your unaccessible home directory? Now **that's** a configuration problem, not a Sage issue.

But every new distro defaults to private home directories, and you have to guess from a rather obscure error message that this is the issue.



---

archive/issue_comments_233822.json:
```json
{
    "body": "Replying to [comment:22 vbraun]:\n> But every new distro defaults to private home directories, and you have to guess from a rather obscure error message that this is the issue.\nIn any case, that's also not what this ticket is about.",
    "created_at": "2015-02-09T16:38:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233822",
    "user": "jdemeyer"
}
```

Replying to [comment:22 vbraun]:
> But every new distro defaults to private home directories, and you have to guess from a rather obscure error message that this is the issue.
In any case, that's also not what this ticket is about.



---

archive/issue_comments_233823.json:
```json
{
    "body": "Also, temporary files **should** be private, so I tend to see it as an improvement ;-)\n\nI guess its time for yet another place to weaken security for sagenb wrapped in a if EMBEDDED_MODE...",
    "created_at": "2015-02-09T16:42:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233823",
    "user": "vbraun"
}
```

Also, temporary files **should** be private, so I tend to see it as an improvement ;-)

I guess its time for yet another place to weaken security for sagenb wrapped in a if EMBEDDED_MODE...



---

archive/issue_comments_233824.json:
```json
{
    "body": "Volker, could you please reopen the ticket...",
    "created_at": "2015-02-09T19:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233824",
    "user": "jdemeyer"
}
```

Volker, could you please reopen the ticket...



---

archive/issue_comments_233825.json:
```json
{
    "body": "See #17755 for a one-line patch.",
    "created_at": "2015-02-09T21:09:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233825",
    "user": "jdemeyer"
}
```

See #17755 for a one-line patch.



---

archive/issue_comments_233826.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2015-02-10T01:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233826",
    "user": "vbraun"
}
```

Changing status from closed to new.



---

archive/issue_comments_233827.json:
```json
{
    "body": "Resolution changed from worksforme to ",
    "created_at": "2015-02-10T01:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233827",
    "user": "vbraun"
}
```

Resolution changed from worksforme to 



---

archive/issue_comments_233828.json:
```json
{
    "body": "Duplicate?",
    "created_at": "2015-02-10T01:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233828",
    "user": "vbraun"
}
```

Duplicate?



---

archive/issue_comments_233829.json:
```json
{
    "body": "Apparently the `server_pool` feature works by making directories on the sagenb side world-writable, so the worker (or anybody else) can write into them. And I thought making the worker files world-readable would be bad...",
    "created_at": "2015-02-10T02:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233829",
    "user": "vbraun"
}
```

Apparently the `server_pool` feature works by making directories on the sagenb side world-writable, so the worker (or anybody else) can write into them. And I thought making the worker files world-readable would be bad...



---

archive/issue_comments_233830.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-10T08:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233830",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_233831.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-10T08:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233831",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_233832.json:
```json
{
    "body": "Replying to [comment:34 vbraun]:\n> Apparently the `server_pool` feature works by making directories on the sagenb side world-writable, so the worker (or anybody else) can write into them. And I thought making the worker files world-readable would be bad... \n\nThere is some protection possible by creating all temporary directories inside a common temporary directory (set by the `SAGENB_TMPDIR` environment variable) and setting that directory with `0711` permissions.",
    "created_at": "2015-02-10T08:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233832",
    "user": "jdemeyer"
}
```

Replying to [comment:34 vbraun]:
> Apparently the `server_pool` feature works by making directories on the sagenb side world-writable, so the worker (or anybody else) can write into them. And I thought making the worker files world-readable would be bad... 

There is some protection possible by creating all temporary directories inside a common temporary directory (set by the `SAGENB_TMPDIR` environment variable) and setting that directory with `0711` permissions.



---

archive/issue_comments_233833.json:
```json
{
    "body": "Sagenb will set `SAGENB_TMPDIR` to 0777 on startup. Not that I would want to base my safety on the secrecy of a temp dir name anyways...",
    "created_at": "2015-02-10T11:32:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233833",
    "user": "vbraun"
}
```

Sagenb will set `SAGENB_TMPDIR` to 0777 on startup. Not that I would want to base my safety on the secrecy of a temp dir name anyways...



---

archive/issue_comments_233834.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2015-02-10T11:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233834",
    "user": "vbraun"
}
```

Resolution: duplicate



---

archive/issue_comments_233835.json:
```json
{
    "body": "Replying to [comment:38 vbraun]:\n> Not that I would want to base my safety on the secrecy of a temp dir name anyways...\nI agree, but it should protect against \"script kiddies\".",
    "created_at": "2015-02-10T13:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233835",
    "user": "jdemeyer"
}
```

Replying to [comment:38 vbraun]:
> Not that I would want to base my safety on the secrecy of a temp dir name anyways...
I agree, but it should protect against "script kiddies".



---

archive/issue_comments_233836.json:
```json
{
    "body": "Replying to [comment:38 vbraun]:\n> Sagenb will set `SAGENB_TMPDIR` to 0777 on startup.\n\nAre you sure? I cannot reproduce this with Sage 6.5.rc1.",
    "created_at": "2015-02-10T13:33:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233836",
    "user": "jdemeyer"
}
```

Replying to [comment:38 vbraun]:
> Sagenb will set `SAGENB_TMPDIR` to 0777 on startup.

Are you sure? I cannot reproduce this with Sage 6.5.rc1.



---

archive/issue_comments_233837.json:
```json
{
    "body": "Agree, doesn't change `SAGENB_TMPDIR` permissions. Misremembered that. But it does change the `DOT_SAGE/sage_notebook.sagenb/home/admin/0/data` to 0777, which even has a pretty much predictable name.",
    "created_at": "2015-02-10T22:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233837",
    "user": "vbraun"
}
```

Agree, doesn't change `SAGENB_TMPDIR` permissions. Misremembered that. But it does change the `DOT_SAGE/sage_notebook.sagenb/home/admin/0/data` to 0777, which even has a pretty much predictable name.



---

archive/issue_comments_233838.json:
```json
{
    "body": "Replying to [comment:42 vbraun]:\n> Agree, doesn't change `SAGENB_TMPDIR` permissions. Misremembered that. But it does change the `DOT_SAGE/sage_notebook.sagenb/home/admin/0/data` to 0777, which even has a pretty much predictable name.\n\nOn the other hand, the permissions of `DOT_SAGE` are changed to `0700`, so that would even be pointless.",
    "created_at": "2015-02-11T10:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233838",
    "user": "jdemeyer"
}
```

Replying to [comment:42 vbraun]:
> Agree, doesn't change `SAGENB_TMPDIR` permissions. Misremembered that. But it does change the `DOT_SAGE/sage_notebook.sagenb/home/admin/0/data` to 0777, which even has a pretty much predictable name.

On the other hand, the permissions of `DOT_SAGE` are changed to `0700`, so that would even be pointless.



---

archive/issue_comments_233839.json:
```json
{
    "body": "Replying to [comment:42 vbraun]:\n> But it does change the `DOT_SAGE/sage_notebook.sagenb/home/admin/0/data` to 0777\nIn my `DOT_SAGE` folder, all `data` directories have permission either `0700` or `0755`...",
    "created_at": "2015-02-11T10:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233839",
    "user": "jdemeyer"
}
```

Replying to [comment:42 vbraun]:
> But it does change the `DOT_SAGE/sage_notebook.sagenb/home/admin/0/data` to 0777
In my `DOT_SAGE` folder, all `data` directories have permission either `0700` or `0755`...



---

archive/issue_comments_233840.json:
```json
{
    "body": "The permission of the data directory is changed to 0777 after the first evaluation. Its changed to 0700 if you shut down the notebook server normally.",
    "created_at": "2015-02-11T20:29:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17506#issuecomment-233840",
    "user": "vbraun"
}
```

The permission of the data directory is changed to 0777 after the first evaluation. Its changed to 0700 if you shut down the notebook server normally.
