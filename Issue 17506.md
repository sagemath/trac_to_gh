# Issue 17506: Plots are not shown in the notebook without show

Issue created by migration from Trac.

Original creator: novoselt

Original creation time: 2015-02-07 00:57:04

In Sage-6.5.rc0 entering

```
plot(sin(x))
```

into a cell and evaluating it produces nothing, while a plot has to be shown without necessity to add show command explicitly.


---

Comment by novoselt created at 2015-02-07 00:57:47

In case it helps: I had a similar issue upgrading to Sage-6.4 in SageCell. The solution was https://github.com/novoselt/sage/commit/6b47f2e388a7e7b23243862a314313abe1344ed3


---

Comment by jdemeyer created at 2015-02-07 09:20:29

works for me...

are you using vanilla Sage 6.5.rc0?


---

Comment by jdemeyer created at 2015-02-07 09:21:05

In any case, you should test with #17645.


---

Comment by vbraun created at 2015-02-08 09:33:25

works for me, too.


---

Comment by jdemeyer created at 2015-02-08 10:06:39

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2015-02-08 10:06:49

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-02-08 15:26:43

Resolution: worksforme


---

Comment by novoselt created at 2015-02-08 17:37:15

I have observed it on my installation with a separate worker account. After `make distclean` and recompiling I still see this, while on a local machine everything works fine.

Can someone test it with multiple accounts?


---

Comment by vbraun created at 2015-02-09 00:09:37

Multiple accounts or `server_pool`? I tried both and they both work. Do you get any log on the commandline?


---

Comment by novoselt created at 2015-02-09 00:19:14

Yes!

```
2015-02-08 17:13:19-0700 [HTTPChannel,5,192.168.122.1] Error copying file from worksheet process: [Errno 13] Permission denied: '/tmp/tmpeF7EjV/sage0.png'
```

This is after executing a command that should show a plot, but does not. The file has 0600 permissions. It seems that commands with explicit `show` do not create these files, they are served from somewhere else (or perhaps moved?).


---

Comment by jdemeyer created at 2015-02-09 09:27:30

Confirmed with `server_pool`!

I think this bug should be reopened as Sage 6.5 blocker.


---

Comment by vbraun created at 2015-02-09 09:53:42

Thats a configuration issue, the worker process needs to set a umask (in `.bashrc`, for example) that allows the server to read the temporary files.


---

Comment by jdemeyer created at 2015-02-09 12:52:34

It's not purely a configuration issue, as Sage 6.3 does not have this problem.

6.4 and 6.4.1 _do_ have the problem.


---

Comment by kcrisman created at 2015-02-09 15:56:20

That seems to be about the time the new display hook was brought into play, maybe?


---

Comment by vbraun created at 2015-02-09 15:58:01

There are a number of other permission issues, e.g. by default `server_pool` doesn't work on my machine because my home directory is 0x700 so the worker can't start my Sage installation.

IMHO its a stupid design to send data back in temp files, the results should be serialized properly and sent though a pipe or socket. See also: Make Sage usable as a library (https://groups.google.com/d/msg/sage-devel/87Rlenvcfrs/-vOyTkZ_FGYJ)


---

Comment by jdemeyer created at 2015-02-09 16:04:35

Replying to [comment:19 vbraun]:
> There are a number of other permission issues, e.g. by default `server_pool` doesn't work on my machine because my home directory is 0x700 so the worker can't start my Sage installation.
You mean you install Sage in your unaccessible home directory? Now *that's* a configuration problem, not a Sage issue.

> IMHO its a stupid design to send data back in temp files
Perhaps, but that's not the point of this ticket.


---

Comment by novoselt created at 2015-02-09 16:32:29

> Perhaps, but that's not the point of this ticket.

Exactly - what we have is a subtle but important regression that appears under certain conditions, which perhaps has a relatively easy fix. "Configuration problem" is when nothing works at all and there are some indications to what is wrong. Here, a fix would be to set group readable permissions somewhere where those files are created, instead of relying on UMASK (or perhaps set/improve UMASK at the start of Sage to be what is necessary). I am also curious why these files are treated differently than those created with explicit show command...


---

Comment by vbraun created at 2015-02-09 16:37:35

Replying to [comment:20 jdemeyer]:
> You mean you install Sage in your unaccessible home directory? Now *that's* a configuration problem, not a Sage issue.

But every new distro defaults to private home directories, and you have to guess from a rather obscure error message that this is the issue.


---

Comment by jdemeyer created at 2015-02-09 16:38:51

Replying to [comment:22 vbraun]:
> But every new distro defaults to private home directories, and you have to guess from a rather obscure error message that this is the issue.
In any case, that's also not what this ticket is about.


---

Comment by vbraun created at 2015-02-09 16:42:13

Also, temporary files *should* be private, so I tend to see it as an improvement ;-)

I guess its time for yet another place to weaken security for sagenb wrapped in a if EMBEDDED_MODE...


---

Comment by jdemeyer created at 2015-02-09 19:29:01

Volker, could you please reopen the ticket...


---

Comment by jdemeyer created at 2015-02-09 21:09:55

See #17755 for a one-line patch.


---

Comment by vbraun created at 2015-02-10 01:14:15

Changing status from closed to new.


---

Comment by vbraun created at 2015-02-10 01:14:15

Resolution changed from worksforme to 


---

Comment by vbraun created at 2015-02-10 01:16:55

Duplicate?


---

Comment by vbraun created at 2015-02-10 02:18:44

Apparently the `server_pool` feature works by making directories on the sagenb side world-writable, so the worker (or anybody else) can write into them. And I thought making the worker files world-readable would be bad...


---

Comment by jdemeyer created at 2015-02-10 08:55:40

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2015-02-10 08:55:44

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2015-02-10 08:57:17

Replying to [comment:34 vbraun]:
> Apparently the `server_pool` feature works by making directories on the sagenb side world-writable, so the worker (or anybody else) can write into them. And I thought making the worker files world-readable would be bad... 

There is some protection possible by creating all temporary directories inside a common temporary directory (set by the `SAGENB_TMPDIR` environment variable) and setting that directory with `0711` permissions.


---

Comment by vbraun created at 2015-02-10 11:32:47

Sagenb will set `SAGENB_TMPDIR` to 0777 on startup. Not that I would want to base my safety on the secrecy of a temp dir name anyways...


---

Comment by vbraun created at 2015-02-10 11:33:19

Resolution: duplicate


---

Comment by jdemeyer created at 2015-02-10 13:02:51

Replying to [comment:38 vbraun]:
> Not that I would want to base my safety on the secrecy of a temp dir name anyways...
I agree, but it should protect against "script kiddies".


---

Comment by jdemeyer created at 2015-02-10 13:33:23

Replying to [comment:38 vbraun]:
> Sagenb will set `SAGENB_TMPDIR` to 0777 on startup.

Are you sure? I cannot reproduce this with Sage 6.5.rc1.


---

Comment by vbraun created at 2015-02-10 22:13:38

Agree, doesn't change `SAGENB_TMPDIR` permissions. Misremembered that. But it does change the `DOT_SAGE/sage_notebook.sagenb/home/admin/0/data` to 0777, which even has a pretty much predictable name.


---

Comment by jdemeyer created at 2015-02-11 10:14:33

Replying to [comment:42 vbraun]:
> Agree, doesn't change `SAGENB_TMPDIR` permissions. Misremembered that. But it does change the `DOT_SAGE/sage_notebook.sagenb/home/admin/0/data` to 0777, which even has a pretty much predictable name.

On the other hand, the permissions of `DOT_SAGE` are changed to `0700`, so that would even be pointless.


---

Comment by jdemeyer created at 2015-02-11 10:15:46

Replying to [comment:42 vbraun]:
> But it does change the `DOT_SAGE/sage_notebook.sagenb/home/admin/0/data` to 0777
In my `DOT_SAGE` folder, all `data` directories have permission either `0700` or `0755`...


---

Comment by vbraun created at 2015-02-11 20:29:46

The permission of the data directory is changed to 0777 after the first evaluation. Its changed to 0700 if you shut down the notebook server normally.
