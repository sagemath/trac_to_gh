# Issue 14265: Fix _repr_ of graphics objects

archive/issues_014265.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  @ppurka\n\nGraphical output of plots (or other graphics objects) is hooked into `_repr_()`. Obviously, Python doesn't expect `repr` to have side effects so we get fun stuff like\n\n```\nsage: g = Graphics()\nsage: g?\n```\n\nshowing a plot in addition to the help.\n\nThis patch moves the decision logic into the displayhook, and makes `repr` always return a string representation as it should.\n\nAlso, deprecate the `show_output()` function. Wat?\n\nIssue created by migration from https://trac.sagemath.org/ticket/14469\n\n",
    "created_at": "2013-04-20T18:57:06Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.12",
    "title": "Fix _repr_ of graphics objects",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14265",
    "user": "https://github.com/vbraun"
}
```
Assignee: jason, was

CC:  @ppurka

Graphical output of plots (or other graphics objects) is hooked into `_repr_()`. Obviously, Python doesn't expect `repr` to have side effects so we get fun stuff like

```
sage: g = Graphics()
sage: g?
```

showing a plot in addition to the help.

This patch moves the decision logic into the displayhook, and makes `repr` always return a string representation as it should.

Also, deprecate the `show_output()` function. Wat?

Issue created by migration from https://trac.sagemath.org/ticket/14469





---

archive/issue_comments_179270.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-04-20T20:02:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14265#issuecomment-179270",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_179271.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-04-20T21:50:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14265#issuecomment-179271",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_179272.json:
```json
{
    "body": "I've totally done something analogous to `[g]*100`.  Making lists of plots is useful, but the previous behavior was not good, and no one should have been relying on it.\n\nI don't have time to learn about displayhook now, but the rest looks good, assuming it works properly in the notebook.\n\nUnless... you don't suppose someone would actually want to be able to change the default behavior of (say) `[g]*100` to show all these graphics *in addition to* printing the list?  Just a crazy thought.",
    "created_at": "2013-04-22T13:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14265#issuecomment-179272",
    "user": "https://github.com/kcrisman"
}
```

I've totally done something analogous to `[g]*100`.  Making lists of plots is useful, but the previous behavior was not good, and no one should have been relying on it.

I don't have time to learn about displayhook now, but the rest looks good, assuming it works properly in the notebook.

Unless... you don't suppose someone would actually want to be able to change the default behavior of (say) `[g]*100` to show all these graphics *in addition to* printing the list?  Just a crazy thought.



---

archive/issue_comments_179273.json:
```json
{
    "body": "The IMHO only remaining problem is that the patch triggers what looks like a Python bug, see #14471.",
    "created_at": "2013-04-22T13:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14265#issuecomment-179273",
    "user": "https://github.com/vbraun"
}
```

The IMHO only remaining problem is that the patch triggers what looks like a Python bug, see #14471.



---

archive/issue_comments_179274.json:
```json
{
    "body": "Two things on the current patch:\n\n- Is there a reason why you're importing `DOCTEST_MODE` in `displayhook.py`? You don't seem to be using it.\n- The method `_graphics_()` in `sage_input.py` will need a doctest.\n\nAlso I think if someone wants `[g]*100` to display all plots, we can just tell them to use `map(lambda x: x.show(), L)` where `L` is the above list since (to me) this is not likely to be very desirable...",
    "created_at": "2013-04-25T18:03:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14265#issuecomment-179274",
    "user": "https://github.com/tscrim"
}
```

Two things on the current patch:

- Is there a reason why you're importing `DOCTEST_MODE` in `displayhook.py`? You don't seem to be using it.
- The method `_graphics_()` in `sage_input.py` will need a doctest.

Also I think if someone wants `[g]*100` to display all plots, we can just tell them to use `map(lambda x: x.show(), L)` where `L` is the above list since (to me) this is not likely to be very desirable...



---

archive/issue_comments_179275.json:
```json
{
    "body": "Rebased for",
    "created_at": "2013-05-29T14:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14265#issuecomment-179275",
    "user": "https://github.com/vbraun"
}
```

Rebased for



---

archive/issue_comments_179276.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-29T21:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14265#issuecomment-179276",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_179277.json:
```json
{
    "body": "Changed patch to not catch any exceptions that might have come from generating the plot",
    "created_at": "2013-05-30T15:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14265#issuecomment-179277",
    "user": "https://github.com/vbraun"
}
```

Changed patch to not catch any exceptions that might have come from generating the plot



---

archive/issue_comments_179278.json:
```json
{
    "body": "Just a heads up -- it is failing some doctests according to the patchbot.",
    "created_at": "2013-05-31T11:46:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14265#issuecomment-179278",
    "user": "https://github.com/ppurka"
}
```

Just a heads up -- it is failing some doctests according to the patchbot.



---

archive/issue_comments_179279.json:
```json
{
    "body": "Updated patch",
    "created_at": "2013-05-31T18:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14265#issuecomment-179279",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_179280.json:
```json
{
    "body": "Attachment [trac_14469_repr_graphics.patch](tarball://root/attachments/some-uuid/ticket14469/trac_14469_repr_graphics.patch) by @vbraun created at 2013-05-31 18:53:44\n\nShould be fixed now.",
    "created_at": "2013-05-31T18:53:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14265#issuecomment-179280",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_14469_repr_graphics.patch](tarball://root/attachments/some-uuid/ticket14469/trac_14469_repr_graphics.patch) by @vbraun created at 2013-05-31 18:53:44

Should be fixed now.



---

archive/issue_comments_179281.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-07-13T11:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14265#issuecomment-179281",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_179282.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2013-07-13T11:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14265#issuecomment-179282",
    "user": "https://github.com/tscrim"
}
```

Looks good to me.



---

archive/issue_comments_179283.json:
```json
{
    "body": "This requires a version of the notebook that includes the commit https://github.com/vbraun/sagenb/commit/89c6b6ced13733bcedff7c18ae49ba0dc8db0457. I've tentatively made a ticket for the upgrade to have something to put into the dependency fied.",
    "created_at": "2013-08-06T22:06:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14265#issuecomment-179283",
    "user": "https://github.com/vbraun"
}
```

This requires a version of the notebook that includes the commit https://github.com/vbraun/sagenb/commit/89c6b6ced13733bcedff7c18ae49ba0dc8db0457. I've tentatively made a ticket for the upgrade to have something to put into the dependency fied.



---

archive/issue_comments_179284.json:
```json
{
    "body": "Fixed with the sagenb spkg from #15016",
    "created_at": "2013-08-08T13:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14265#issuecomment-179284",
    "user": "https://github.com/vbraun"
}
```

Fixed with the sagenb spkg from #15016



---

archive/issue_comments_179285.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-08-16T21:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14265#issuecomment-179285",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_179286.json:
```json
{
    "body": "Followup at #15066",
    "created_at": "2013-08-20T11:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14265#issuecomment-179286",
    "user": "https://github.com/vbraun"
}
```

Followup at #15066



---

archive/issue_comments_179287.json:
```json
{
    "body": "I am not sure if this is the reason, but in a server-worker setup graphics is not shown in 5.12.beta4, while it does in 5.11 + sagenb-0.10.7.1.",
    "created_at": "2013-09-05T00:30:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14265#issuecomment-179287",
    "user": "https://github.com/novoselt"
}
```

I am not sure if this is the reason, but in a server-worker setup graphics is not shown in 5.12.beta4, while it does in 5.11 + sagenb-0.10.7.1.



---

archive/issue_comments_179288.json:
```json
{
    "body": "Made a ticket #15168 for this.",
    "created_at": "2013-09-06T18:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14265#issuecomment-179288",
    "user": "https://github.com/novoselt"
}
```

Made a ticket #15168 for this.
