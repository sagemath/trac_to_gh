# Issue 14265: Fix _repr_ of graphics objects

Issue created by migration from https://trac.sagemath.org/ticket/14469

Original creator: vbraun

Original creation time: 2013-04-20 18:57:06

Assignee: jason, was

CC:  ppurka

Graphical output of plots (or other graphics objects) is hooked into `_repr_()`. Obviously, Python doesn't expect `repr` to have side effects so we get fun stuff like

```
sage: g = Graphics()
sage: g?
```

showing a plot in addition to the help.

This patch moves the decision logic into the displayhook, and makes `repr` always return a string representation as it should.

Also, deprecate the `show_output()` function. Wat?


---

Comment by vbraun created at 2013-04-20 20:02:31

Changing status from new to needs_review.


---

Comment by vbraun created at 2013-04-20 21:50:16

Changing status from needs_review to needs_work.


---

Comment by kcrisman created at 2013-04-22 13:45:29

I've totally done something analogous to `[g]*100`.  Making lists of plots is useful, but the previous behavior was not good, and no one should have been relying on it.

I don't have time to learn about displayhook now, but the rest looks good, assuming it works properly in the notebook.

Unless... you don't suppose someone would actually want to be able to change the default behavior of (say) `[g]*100` to show all these graphics _in addition to_ printing the list?  Just a crazy thought.


---

Comment by vbraun created at 2013-04-22 13:51:29

The IMHO only remaining problem is that the patch triggers what looks like a Python bug, see #14471.


---

Comment by tscrim created at 2013-04-25 18:03:26

Two things on the current patch:

- Is there a reason why you're importing `DOCTEST_MODE` in `displayhook.py`? You don't seem to be using it.
- The method `_graphics_()` in `sage_input.py` will need a doctest.

Also I think if someone wants `[g]*100` to display all plots, we can just tell them to use `map(lambda x: x.show(), L)` where `L` is the above list since (to me) this is not likely to be very desirable...


---

Comment by vbraun created at 2013-05-29 14:12:05

Rebased for


---

Comment by vbraun created at 2013-05-29 21:42:53

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2013-05-30 15:24:27

Changed patch to not catch any exceptions that might have come from generating the plot


---

Comment by ppurka created at 2013-05-31 11:46:22

Just a heads up -- it is failing some doctests according to the patchbot.


---

Comment by vbraun created at 2013-05-31 18:53:32

Updated patch


---

Attachment

Should be fixed now.


---

Comment by tscrim created at 2013-07-13 11:53:42

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2013-07-13 11:53:42

Looks good to me.


---

Comment by vbraun created at 2013-08-06 22:06:57

This requires a version of the notebook that includes the commit https://github.com/vbraun/sagenb/commit/89c6b6ced13733bcedff7c18ae49ba0dc8db0457. I've tentatively made a ticket for the upgrade to have something to put into the dependency fied.


---

Comment by vbraun created at 2013-08-08 13:23:46

Fixed with the sagenb spkg from #15016


---

Comment by jdemeyer created at 2013-08-16 21:11:26

Resolution: fixed


---

Comment by vbraun created at 2013-08-20 11:15:14

Followup at #15066


---

Comment by novoselt created at 2013-09-05 00:30:07

I am not sure if this is the reason, but in a server-worker setup graphics is not shown in 5.12.beta4, while it does in 5.11 + sagenb-0.10.7.1.


---

Comment by novoselt created at 2013-09-06 18:33:07

Made a ticket #15168 for this.
