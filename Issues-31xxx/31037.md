# Issue 31037: Install tests in sage/tests/books

archive/issues_030800.json:
```json
{
    "assignees": [],
    "body": "Following sd111 discussion at #31016 we noted that tests in `sage/tests/books` are not installed and therefore not doctested when doctests are run from a globally installed sage as is done by the like of sage-on-gentoo and Arch.\n\nCC:  @antonio-rojas\n\nKeywords: **sd111**\n\nBranch/Commit: **[0fd15f7](https://github.com/sagemath/sagetrac-mirror/commit/0fd15f75b8ca79339b5a3cd97e16331b34ef8c65)**\n\nReviewer: **Matthias Koeppe**\n\nAuthor: **Fran\u00e7ois Bissey**\n\nComponent: **distribution**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31037_\n\n",
    "closed_at": "2020-12-14T23:52:58Z",
    "created_at": "2020-12-11T00:06:00Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20distribution",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Install tests in sage/tests/books",
    "type": "issue",
    "updated_at": "2020-12-14T23:52:58Z",
    "url": "https://github.com/sagemath/sage/issues/31037",
    "user": "https://github.com/kiwifb"
}
```
Following sd111 discussion at #31016 we noted that tests in `sage/tests/books` are not installed and therefore not doctested when doctests are run from a globally installed sage as is done by the like of sage-on-gentoo and Arch.

CC:  @antonio-rojas

Keywords: **sd111**

Branch/Commit: **[0fd15f7](https://github.com/sagemath/sagetrac-mirror/commit/0fd15f75b8ca79339b5a3cd97e16331b34ef8c65)**

Reviewer: **Matthias Koeppe**

Author: **François Bissey**

Component: **distribution**

_Issue created by migration from https://trac.sagemath.org/ticket/31037_





---

archive/issue_events_428032.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2020-12-11T00:06:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31037#event-428032"
}
```



---

archive/issue_events_428033.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2020-12-11T00:06:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20distribution",
    "label_color": "000080",
    "label_name": "c: distribution",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31037#event-428033"
}
```



---

archive/issue_events_428034.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2020-12-11T00:06:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31037#event-428034"
}
```



---

archive/issue_events_428035.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2020-12-11T00:06:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31037#event-428035"
}
```



---

archive/issue_events_428036.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2020-12-11T00:08:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31037#event-428036"
}
```



---

archive/issue_comments_497519.json:
```json
{
    "body": "Author: **Fran\u00e7ois Bissey**",
    "created_at": "2020-12-11T00:08:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31037#issuecomment-497519",
    "user": "https://github.com/kiwifb"
}
```

Author: **François Bissey**



---

archive/issue_comments_497520.json:
```json
{
    "body": "Commit: **[0fd15f7](https://github.com/sagemath/sagetrac-mirror/commit/0fd15f75b8ca79339b5a3cd97e16331b34ef8c65)**",
    "created_at": "2020-12-11T00:08:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31037#issuecomment-497520",
    "user": "https://github.com/kiwifb"
}
```

Commit: **[0fd15f7](https://github.com/sagemath/sagetrac-mirror/commit/0fd15f75b8ca79339b5a3cd97e16331b34ef8c65)**



---

archive/issue_comments_497521.json:
```json
{
    "body": "Branch: **[u/fbissey/booktests](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/booktests)**",
    "created_at": "2020-12-11T00:08:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31037#issuecomment-497521",
    "user": "https://github.com/kiwifb"
}
```

Branch: **[u/fbissey/booktests](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/booktests)**



---

archive/issue_comments_497522.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0fd15f75b8ca79339b5a3cd97e16331b34ef8c65\">0fd15f7</a></td><td><code>make files in the tests/books folder to be automatically installed</code></td></tr></table>\n",
    "created_at": "2020-12-11T00:08:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31037#issuecomment-497522",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0fd15f75b8ca79339b5a3cd97e16331b34ef8c65">0fd15f7</a></td><td><code>make files in the tests/books folder to be automatically installed</code></td></tr></table>




---

archive/issue_comments_497523.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nBefore putting it for review we need to make a final decision on the README file attached to the \"computational mathematics with sagemath\" book.\nhttps://github.com/sagemath/sage/blob/develop/src/sage/tests/books/computational-mathematics-with-sagemath/README",
    "created_at": "2020-12-11T00:09:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31037#issuecomment-497523",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:2" align="right">comment:2</div>

Before putting it for review we need to make a final decision on the README file attached to the "computational mathematics with sagemath" book.
https://github.com/sagemath/sage/blob/develop/src/sage/tests/books/computational-mathematics-with-sagemath/README



---

archive/issue_comments_497524.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI think I would prefer a solution that installs all these files as package data rather than as Python packages.",
    "created_at": "2020-12-11T00:12:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31037#issuecomment-497524",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:3" align="right">comment:3</div>

I think I would prefer a solution that installs all these files as package data rather than as Python packages.



---

archive/issue_comments_497525.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI am not even sure that `sage/tests` is the right location for them in the first place. In `judson-abstract-algebra` we have solution of problems from the book, in a doctestable format. And in `computational-mathematics-with-sage` we have autogenerated example, that are meant to be doctestable. In fact there is a disconnect between the name of the files and their own description. See https://github.com/sagemath/sage/blob/develop/src/sage/tests/books/computational-mathematics-with-sagemath/calculus_doctest.py for example.\n\nThey have been put into sage so they can be updated on change of behavior, but a better location may be somewhere under `doc` and that could still be doctested.",
    "created_at": "2020-12-11T00:21:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31037#issuecomment-497525",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:4" align="right">comment:4</div>

I am not even sure that `sage/tests` is the right location for them in the first place. In `judson-abstract-algebra` we have solution of problems from the book, in a doctestable format. And in `computational-mathematics-with-sage` we have autogenerated example, that are meant to be doctestable. In fact there is a disconnect between the name of the files and their own description. See https://github.com/sagemath/sage/blob/develop/src/sage/tests/books/computational-mathematics-with-sagemath/calculus_doctest.py for example.

They have been put into sage so they can be updated on change of behavior, but a better location may be somewhere under `doc` and that could still be doctested.



---

archive/issue_comments_497526.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nJust to re-iterate: \n\nIf it is .py files that you install under `PYTHON_PATH` (site-package or otherwise), it should be precompiled. This happens automatically if you install things as python package but not as package data. QA in Gentoo would tell me to manually compile them, effectively it would introduce something I have to do on my side.\n\nIf we install them as real data by changing them to .rst files for example, we could then install them as package data, but we would need some kind of runner for them like `sage/doctest/test.py` is for the content of `sage/doctest/tests/`.\n\nPutting them under `doc` is interesting but may cause problem with the doc build system. We don't want to produce html or pdf.",
    "created_at": "2020-12-11T01:55:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31037#issuecomment-497526",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:5" align="right">comment:5</div>

Just to re-iterate: 

If it is .py files that you install under `PYTHON_PATH` (site-package or otherwise), it should be precompiled. This happens automatically if you install things as python package but not as package data. QA in Gentoo would tell me to manually compile them, effectively it would introduce something I have to do on my side.

If we install them as real data by changing them to .rst files for example, we could then install them as package data, but we would need some kind of runner for them like `sage/doctest/test.py` is for the content of `sage/doctest/tests/`.

Putting them under `doc` is interesting but may cause problem with the doc build system. We don't want to produce html or pdf.



---

archive/issue_comments_497527.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nOK, adding the `__init__` files seems like a good simple solution then.",
    "created_at": "2020-12-11T02:46:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31037#issuecomment-497527",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">comment:6</div>

OK, adding the `__init__` files seems like a good simple solution then.



---

archive/issue_events_428037.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-11T19:02:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31037#event-428037"
}
```



---

archive/issue_events_428038.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-11T19:02:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31037#event-428038"
}
```



---

archive/issue_events_428039.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-11T19:02:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31037#event-428039"
}
```



---

archive/issue_events_428040.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-11T19:02:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31037#event-428040"
}
```



---

archive/issue_comments_497528.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe**",
    "created_at": "2020-12-11T19:02:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31037#issuecomment-497528",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe**



---

archive/issue_events_428041.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-14T23:52:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31037#event-428041"
}
```



---

archive/issue_events_428042.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c25b0765a1ca97c75b3e7188c2bd3933617bfca1",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-12-14T23:52:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31037#event-428042"
}
```



---

archive/issue_comments_497529.json:
```json
{
    "body": "Changed branch from **[u/fbissey/booktests](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/booktests)** to **[0fd15f7](https://github.com/sagemath/sagetrac-mirror/commit/0fd15f75b8ca79339b5a3cd97e16331b34ef8c65)**",
    "created_at": "2020-12-14T23:52:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31037",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31037#issuecomment-497529",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/fbissey/booktests](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/booktests)** to **[0fd15f7](https://github.com/sagemath/sagetrac-mirror/commit/0fd15f75b8ca79339b5a3cd97e16331b34ef8c65)**
