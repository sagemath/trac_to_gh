# Issue 31348: build/pkgs/{gmp,mpfr}/spkg-configure.m4: Check pkg-config first

archive/issues_031111.json:
```json
{
    "assignees": [],
    "body": "Currently `gmp.pc`, which may be provided at least on some platforms, is not used at all -- neither by `configure` nor by `sage.env.cython_aliases`, `sage.misc.cython`.\n\nFor example, on homebrew, using it will provide the specific library search directory `-L/usr/local/Cellar/gmp/6.2.1/lib` instead of having to rely on `/usr/local/` (which is disabled when compiler/linker are invoked with `-isysroot`)\n\nCurrently, `gmp` is detected using `AC_CHECK_HEADER`, and the result is communicated to `sage-build-env-config` as variables `SAGE_GMP_PREFIX` and `SAGE_GMP_INCLUDE`; but it is not available in the runtime environment (`sage_conf.py`, `sage-env-config`).\n\nThe failures reported in \n- [#31335 comment:47](https://github.com/sagemath/sage/issues/31335#comment:47) \n- https://groups.google.com/g/sage-release/c/6WjKQt_e_B8/m/H2I4HZ-YCwAJ (https://groups.google.com/g/sage-release/c/6WjKQt_e_B8/m/Uut_ZRaZCwAJ)\n- https://groups.google.com/g/sage-release/c/0q3kywk7RP8/m/uspq0xeuAgAJ\ncan be fixed by simply changing `sage.misc.cython` to pick up `gmp.pc`.  But to avoid unpleasant surprises, we need to make sure that it is used consistently when present.\n\n(After #32549, the relevant file is `build/pkgs/gmp/spkg-configure.m4`.)\n\nThe above applies to `mpfr` as well. See failure report in https://groups.google.com/g/sage-release/c/8ctwsUGl6LQ/m/Ob38Iyh1AAAJ\n\nSimilar situation with `readline` (#29000): The spkg-configure script already uses pkg-config - but forgets to tell the build system what it found.\n\nPrevious tickets: #27212\n\n\nDepends on #31344\nDepends on #32549\n\nCC:  @dimpase @jhpalmieri @zlscherr @orlitzky\n\nKeywords: **mpfr**\n\nBranch/Commit: **[u/gh-zlscherr/add_gmp_mpfr_cython](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-zlscherr/add_gmp_mpfr_cython) @ [07e00b6](https://github.com/sagemath/sagetrac-mirror/commit/07e00b608d79e90c8854c2b4c157a1d6456e9985)**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31348_\n\n",
    "created_at": "2021-02-06T02:40:02Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "build/pkgs/{gmp,mpfr}/spkg-configure.m4: Check pkg-config first",
    "type": "issue",
    "updated_at": "2022-09-19T18:58:47Z",
    "url": "https://github.com/sagemath/sage/issues/31348",
    "user": "https://github.com/mkoeppe"
}
```
Currently `gmp.pc`, which may be provided at least on some platforms, is not used at all -- neither by `configure` nor by `sage.env.cython_aliases`, `sage.misc.cython`.

For example, on homebrew, using it will provide the specific library search directory `-L/usr/local/Cellar/gmp/6.2.1/lib` instead of having to rely on `/usr/local/` (which is disabled when compiler/linker are invoked with `-isysroot`)

Currently, `gmp` is detected using `AC_CHECK_HEADER`, and the result is communicated to `sage-build-env-config` as variables `SAGE_GMP_PREFIX` and `SAGE_GMP_INCLUDE`; but it is not available in the runtime environment (`sage_conf.py`, `sage-env-config`).

The failures reported in 
- [#31335 comment:47](https://github.com/sagemath/sage/issues/31335#comment:47) 
- https://groups.google.com/g/sage-release/c/6WjKQt_e_B8/m/H2I4HZ-YCwAJ (https://groups.google.com/g/sage-release/c/6WjKQt_e_B8/m/Uut_ZRaZCwAJ)
- https://groups.google.com/g/sage-release/c/0q3kywk7RP8/m/uspq0xeuAgAJ
can be fixed by simply changing `sage.misc.cython` to pick up `gmp.pc`.  But to avoid unpleasant surprises, we need to make sure that it is used consistently when present.

(After #32549, the relevant file is `build/pkgs/gmp/spkg-configure.m4`.)

The above applies to `mpfr` as well. See failure report in https://groups.google.com/g/sage-release/c/8ctwsUGl6LQ/m/Ob38Iyh1AAAJ

Similar situation with `readline` (#29000): The spkg-configure script already uses pkg-config - but forgets to tell the build system what it found.

Previous tickets: #27212


Depends on #31344
Depends on #32549

CC:  @dimpase @jhpalmieri @zlscherr @orlitzky

Keywords: **mpfr**

Branch/Commit: **[u/gh-zlscherr/add_gmp_mpfr_cython](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-zlscherr/add_gmp_mpfr_cython) @ [07e00b6](https://github.com/sagemath/sagetrac-mirror/commit/07e00b608d79e90c8854c2b4c157a1d6456e9985)**

_Issue created by migration from https://trac.sagemath.org/ticket/31348_





---

archive/issue_events_413825.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-06T02:40:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31348#event-413825"
}
```



---

archive/issue_events_413826.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-06T02:40:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build%3A%20configure",
    "label_color": "000080",
    "label_name": "component: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31348#event-413826"
}
```



---

archive/issue_events_413827.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-06T02:40:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "label": "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31348#event-413827"
}
```



---

archive/issue_events_413828.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-06T02:40:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31348#event-413828"
}
```



---

archive/issue_comments_505650.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n For example, on homebrew, using it will provide the specific library search directory `-L/usr/local/Cellar/gmp/6.2.1/lib` instead of having to rely on `/usr/local/` (which is disabled when compiler/linker are invoked with `-isysroot`)\n \n-The failure reported in [#31335 comment:47](https://github.com/sagemath/sage/issues/31335#comment:47) only `sage.misc.cython` to pick up `gmp.pc` - but to avoid unpleasant surprises, we need to make sure that it is used consistently when present.\n+The failure reported in [#31335 comment:47](https://github.com/sagemath/sage/issues/31335#comment:47) can be fixed by simply changing `sage.misc.cython` to pick up `gmp.pc`.  But to avoid unpleasant surprises, we need to make sure that it is used consistently when present.\n \n previous tickets: #27212\n \n``````\n",
    "created_at": "2021-02-06T02:51:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505650",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 For example, on homebrew, using it will provide the specific library search directory `-L/usr/local/Cellar/gmp/6.2.1/lib` instead of having to rely on `/usr/local/` (which is disabled when compiler/linker are invoked with `-isysroot`)
 
-The failure reported in [#31335 comment:47](https://github.com/sagemath/sage/issues/31335#comment:47) only `sage.misc.cython` to pick up `gmp.pc` - but to avoid unpleasant surprises, we need to make sure that it is used consistently when present.
+The failure reported in [#31335 comment:47](https://github.com/sagemath/sage/issues/31335#comment:47) can be fixed by simply changing `sage.misc.cython` to pick up `gmp.pc`.  But to avoid unpleasant surprises, we need to make sure that it is used consistently when present.
 
 previous tickets: #27212
 
``````




---

archive/issue_comments_505651.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,8 @@\n Currently `gmp.pc`, which may be provided at least on some platforms, is not used at all -- neither by `configure` nor by `sage.env.cython_aliases`, `sage.misc.cython`.\n \n For example, on homebrew, using it will provide the specific library search directory `-L/usr/local/Cellar/gmp/6.2.1/lib` instead of having to rely on `/usr/local/` (which is disabled when compiler/linker are invoked with `-isysroot`)\n+\n+Currently, `gmp` is detected using `AC_CHECK_HEADER`, and the result is communicated to `sage-build-env-config` as variables `SAGE_GMP_PREFIX` and `SAGE_GMP_INCLUDE`; but it is not available in the runtime environment (`sage_conf.py`, `sage-env-config`).\n \n The failure reported in [#31335 comment:47](https://github.com/sagemath/sage/issues/31335#comment:47) can be fixed by simply changing `sage.misc.cython` to pick up `gmp.pc`.  But to avoid unpleasant surprises, we need to make sure that it is used consistently when present.\n \n``````\n",
    "created_at": "2021-02-06T02:53:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505651",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,8 @@
 Currently `gmp.pc`, which may be provided at least on some platforms, is not used at all -- neither by `configure` nor by `sage.env.cython_aliases`, `sage.misc.cython`.
 
 For example, on homebrew, using it will provide the specific library search directory `-L/usr/local/Cellar/gmp/6.2.1/lib` instead of having to rely on `/usr/local/` (which is disabled when compiler/linker are invoked with `-isysroot`)
+
+Currently, `gmp` is detected using `AC_CHECK_HEADER`, and the result is communicated to `sage-build-env-config` as variables `SAGE_GMP_PREFIX` and `SAGE_GMP_INCLUDE`; but it is not available in the runtime environment (`sage_conf.py`, `sage-env-config`).
 
 The failure reported in [#31335 comment:47](https://github.com/sagemath/sage/issues/31335#comment:47) can be fixed by simply changing `sage.misc.cython` to pick up `gmp.pc`.  But to avoid unpleasant surprises, we need to make sure that it is used consistently when present.
 
``````




---

archive/issue_events_413829.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-06T05:02:47Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "title_is": "build/pkgs/{mpir,mpfr}/spkg-configure.m4: Check pkg-config first",
    "title_was": "build/pkgs/mpir/spkg-configure.m4: Check pkg-config first",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31348#event-413829"
}
```



---

archive/issue_comments_505652.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,5 +6,8 @@\n \n The failure reported in [#31335 comment:47](https://github.com/sagemath/sage/issues/31335#comment:47) can be fixed by simply changing `sage.misc.cython` to pick up `gmp.pc`.  But to avoid unpleasant surprises, we need to make sure that it is used consistently when present.\n \n+\n+The above applies to `mpfr` as well.\n+\n previous tickets: #27212\n \n``````\n",
    "created_at": "2021-02-06T05:02:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505652",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,5 +6,8 @@
 
 The failure reported in [#31335 comment:47](https://github.com/sagemath/sage/issues/31335#comment:47) can be fixed by simply changing `sage.misc.cython` to pick up `gmp.pc`.  But to avoid unpleasant surprises, we need to make sure that it is used consistently when present.
 
+
+The above applies to `mpfr` as well.
+
 previous tickets: #27212
 
``````




---

archive/issue_comments_505653.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nI started to play around with this a bit, and I can use python\u2019s pkgconfig to locate gmp and mpfr.  After doing that though, I get complaints about not being able to locagte -lntl, which I don\u2019t think I can find with pkgconfig since it doesn\u2019t have an ntl.pc file.\n\nThis may be a bit too hacky, but would it be possible in the build process to copy the various includes and libraries to SAGE_LOCAL/{include, lib} that are picked up by configure? That seems like it would solve a whole host of problems at the expense of if the user updates one of those libraries then the new version would not be picked up.",
    "created_at": "2021-02-09T02:14:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505653",
    "user": "https://github.com/zlscherr"
}
```

<div id="comment:4" align="right">Comment 4</div>

I started to play around with this a bit, and I can use python’s pkgconfig to locate gmp and mpfr.  After doing that though, I get complaints about not being able to locagte -lntl, which I don’t think I can find with pkgconfig since it doesn’t have an ntl.pc file.

This may be a bit too hacky, but would it be possible in the build process to copy the various includes and libraries to SAGE_LOCAL/{include, lib} that are picked up by configure? That seems like it would solve a whole host of problems at the expense of if the user updates one of those libraries then the new version would not be picked up.



---

archive/issue_comments_505654.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nReplying to [@zlscherr](#comment%3A4):\n> I started to play around with this a bit, and I can use python\u2019s pkgconfig to locate gmp and mpfr.  After doing that though, I get complaints about not being able to locagte -lntl, which I don\u2019t think I can find with pkgconfig since it doesn\u2019t have an ntl.pc file.\n\nFor NTL, the configure script already determines `SAGE_NTL_PREFIX`.\nThis variable just needs to be used more.",
    "created_at": "2021-02-09T02:51:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505654",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">Comment 5</div>

Replying to [@zlscherr](#comment%3A4):
> I started to play around with this a bit, and I can use python’s pkgconfig to locate gmp and mpfr.  After doing that though, I get complaints about not being able to locagte -lntl, which I don’t think I can find with pkgconfig since it doesn’t have an ntl.pc file.

For NTL, the configure script already determines `SAGE_NTL_PREFIX`.
This variable just needs to be used more.



---

archive/issue_comments_505655.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nI've opened #31365 for NTL.",
    "created_at": "2021-02-09T02:57:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505655",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">Comment 6</div>

I've opened #31365 for NTL.



---

archive/issue_comments_505656.json:
```json
{
    "body": "Branch: **[u/gh-zlscherr/add_gmp_mpfr_cython](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-zlscherr/add_gmp_mpfr_cython)**",
    "created_at": "2021-04-07T21:00:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505656",
    "user": "https://github.com/zlscherr"
}
```

Branch: **[u/gh-zlscherr/add_gmp_mpfr_cython](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-zlscherr/add_gmp_mpfr_cython)**



---

archive/issue_comments_505657.json:
```json
{
    "body": "Commit: **[07e00b6](https://github.com/sagemath/sagetrac-mirror/commit/07e00b608d79e90c8854c2b4c157a1d6456e9985)**",
    "created_at": "2021-04-07T21:00:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505657",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[07e00b6](https://github.com/sagemath/sagetrac-mirror/commit/07e00b608d79e90c8854c2b4c157a1d6456e9985)**



---

archive/issue_comments_505658.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07e00b608d79e90c8854c2b4c157a1d6456e9985\">07e00b6</a></td><td><code>Modify stdlibs/incs in misc/cython.py</code></td></tr></table>\n",
    "created_at": "2021-04-07T21:00:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505658",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8" align="right">Comment 8</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07e00b608d79e90c8854c2b4c157a1d6456e9985">07e00b6</a></td><td><code>Modify stdlibs/incs in misc/cython.py</code></td></tr></table>




---

archive/issue_comments_505659.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nI pushed very simple code for trying to deal with this.  It's probably better to use regular expressions, but I just wanted a proof of concept.  This allows make ptest to work with homebrew without having to source .homebrew-build-env.",
    "created_at": "2021-04-07T21:03:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505659",
    "user": "https://github.com/zlscherr"
}
```

<div id="comment:9" align="right">Comment 9</div>

I pushed very simple code for trying to deal with this.  It's probably better to use regular expressions, but I just wanted a proof of concept.  This allows make ptest to work with homebrew without having to source .homebrew-build-env.



---

archive/issue_comments_505660.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,5 +9,7 @@\n \n The above applies to `mpfr` as well.\n \n+Also `readline` - #29000.\n+\n previous tickets: #27212\n \n``````\n",
    "created_at": "2021-04-09T19:26:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505660",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,5 +9,7 @@
 
 The above applies to `mpfr` as well.
 
+Also `readline` - #29000.
+
 previous tickets: #27212
 
``````




---

archive/issue_comments_505661.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,7 +9,7 @@\n \n The above applies to `mpfr` as well.\n \n-Also `readline` - #29000.\n+Similar situation with `readline` (#29000): The spkg-configure script already uses pkg-config - but forgets to tell the build system what it found.\n \n previous tickets: #27212\n \n``````\n",
    "created_at": "2021-04-09T19:30:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505661",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,7 +9,7 @@
 
 The above applies to `mpfr` as well.
 
-Also `readline` - #29000.
+Similar situation with `readline` (#29000): The spkg-configure script already uses pkg-config - but forgets to tell the build system what it found.
 
 previous tickets: #27212
 
``````




---

archive/issue_comments_505662.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,11 @@\n \n Currently, `gmp` is detected using `AC_CHECK_HEADER`, and the result is communicated to `sage-build-env-config` as variables `SAGE_GMP_PREFIX` and `SAGE_GMP_INCLUDE`; but it is not available in the runtime environment (`sage_conf.py`, `sage-env-config`).\n \n-The failure reported in [#31335 comment:47](https://github.com/sagemath/sage/issues/31335#comment:47) can be fixed by simply changing `sage.misc.cython` to pick up `gmp.pc`.  But to avoid unpleasant surprises, we need to make sure that it is used consistently when present.\n+The failures reported in \n+- [#31335 comment:47](https://github.com/sagemath/sage/issues/31335#comment:47) \n+- https://groups.google.com/g/sage-release/c/6WjKQt_e_B8/m/H2I4HZ-YCwAJ (https://groups.google.com/g/sage-release/c/6WjKQt_e_B8/m/Uut_ZRaZCwAJ)\n+- https://groups.google.com/g/sage-release/c/0q3kywk7RP8/m/uspq0xeuAgAJ\n+can be fixed by simply changing `sage.misc.cython` to pick up `gmp.pc`.  But to avoid unpleasant surprises, we need to make sure that it is used consistently when present.\n \n \n The above applies to `mpfr` as well.\n``````\n",
    "created_at": "2021-04-19T17:16:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505662",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,11 @@
 
 Currently, `gmp` is detected using `AC_CHECK_HEADER`, and the result is communicated to `sage-build-env-config` as variables `SAGE_GMP_PREFIX` and `SAGE_GMP_INCLUDE`; but it is not available in the runtime environment (`sage_conf.py`, `sage-env-config`).
 
-The failure reported in [#31335 comment:47](https://github.com/sagemath/sage/issues/31335#comment:47) can be fixed by simply changing `sage.misc.cython` to pick up `gmp.pc`.  But to avoid unpleasant surprises, we need to make sure that it is used consistently when present.
+The failures reported in 
+- [#31335 comment:47](https://github.com/sagemath/sage/issues/31335#comment:47) 
+- https://groups.google.com/g/sage-release/c/6WjKQt_e_B8/m/H2I4HZ-YCwAJ (https://groups.google.com/g/sage-release/c/6WjKQt_e_B8/m/Uut_ZRaZCwAJ)
+- https://groups.google.com/g/sage-release/c/0q3kywk7RP8/m/uspq0xeuAgAJ
+can be fixed by simply changing `sage.misc.cython` to pick up `gmp.pc`.  But to avoid unpleasant surprises, we need to make sure that it is used consistently when present.
 
 
 The above applies to `mpfr` as well.
``````




---

archive/issue_comments_505663.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nI've started getting [failures](https://math.mit.edu/~roed/31348.log) that are fixed by sourcing `.homebrew-build-env` even when I'm just changing Cython files and recompiling (not changing any spkgs).  Is this expected?",
    "created_at": "2021-04-26T05:31:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505663",
    "user": "https://github.com/roed314"
}
```

<div id="comment:13" align="right">Comment 13</div>

I've started getting [failures](https://math.mit.edu/~roed/31348.log) that are fixed by sourcing `.homebrew-build-env` even when I'm just changing Cython files and recompiling (not changing any spkgs).  Is this expected?



---

archive/issue_comments_505664.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nYes, this is part of what this ticket intends to fix.",
    "created_at": "2021-04-26T17:17:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505664",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:14" align="right">Comment 14</div>

Yes, this is part of what this ticket intends to fix.



---

archive/issue_comments_505665.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nGreat, thanks for the clarification!",
    "created_at": "2021-04-26T18:00:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505665",
    "user": "https://github.com/roed314"
}
```

<div id="comment:15" align="right">Comment 15</div>

Great, thanks for the clarification!



---

archive/issue_events_413830.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31348#event-413830"
}
```



---

archive/issue_events_413831.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31348#event-413831"
}
```



---

archive/issue_comments_505666.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nMoving to 9.4, as 9.3 has been released.",
    "created_at": "2021-05-10T17:42:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505666",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:16" align="right">Comment 16</div>

Moving to 9.4, as 9.3 has been released.



---

archive/issue_events_413832.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31348#event-413832"
}
```



---

archive/issue_events_413833.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31348#event-413833"
}
```



---

archive/issue_comments_505667.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,6 +10,7 @@\n - https://groups.google.com/g/sage-release/c/0q3kywk7RP8/m/uspq0xeuAgAJ\n can be fixed by simply changing `sage.misc.cython` to pick up `gmp.pc`.  But to avoid unpleasant surprises, we need to make sure that it is used consistently when present.\n \n+(After #32549, the relevant file is `build/pkgs/gmp/spkg-configure.m4`.)\n \n The above applies to `mpfr` as well.\n \n``````\n",
    "created_at": "2021-09-23T15:46:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505667",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,6 +10,7 @@
 - https://groups.google.com/g/sage-release/c/0q3kywk7RP8/m/uspq0xeuAgAJ
 can be fixed by simply changing `sage.misc.cython` to pick up `gmp.pc`.  But to avoid unpleasant surprises, we need to make sure that it is used consistently when present.
 
+(After #32549, the relevant file is `build/pkgs/gmp/spkg-configure.m4`.)
 
 The above applies to `mpfr` as well.
 
``````




---

archive/issue_comments_505668.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nsome distros, like Fedora, have an unpleasant habit of not installing .pc files, while these are available.",
    "created_at": "2021-09-23T15:57:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505668",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">Comment 19</div>

some distros, like Fedora, have an unpleasant habit of not installing .pc files, while these are available.



---

archive/issue_comments_505669.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nYes, the ticket is \"Check pkg-config first\", not \"Check pkg-config only\".",
    "created_at": "2021-09-23T15:59:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505669",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">Comment 20</div>

Yes, the ticket is "Check pkg-config first", not "Check pkg-config only".



---

archive/issue_comments_505670.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nIMO homebrew (and anyone else installing libgmp to a nonstandard directory) should be pestered to install it to the system's default location. I'm pretty sure that the gmp and mpir packages then conflict, but you don't need to install them both at the same time. In fact, mpir can probably be deprecated.\n\nUsing pkg-config just changes this potential problem (libraries in wrong locations) to another one (pc files in wrong locations) and adds an extra layer of indirection in the process. We may have to go ahead and fix it anyway, but we shouldn't lose track of the simple and easy way that this was all meant to work.",
    "created_at": "2021-09-23T17:00:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505670",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:21" align="right">Comment 21</div>

IMO homebrew (and anyone else installing libgmp to a nonstandard directory) should be pestered to install it to the system's default location. I'm pretty sure that the gmp and mpir packages then conflict, but you don't need to install them both at the same time. In fact, mpir can probably be deprecated.

Using pkg-config just changes this potential problem (libraries in wrong locations) to another one (pc files in wrong locations) and adds an extra layer of indirection in the process. We may have to go ahead and fix it anyway, but we shouldn't lose track of the simple and easy way that this was all meant to work.



---

archive/issue_comments_505671.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nThe problem on homebrew is really a very specific one, which I have explained in the ticket description: The GMP headers *are* installed in what you would call the \"standard location\" (`/usr/local/`), but when compiler/linker are invoked with `-isysroot`, then `/usr/local` is not a standard location. Yes, we fix it in the *build* environment using `.homebrew-build-env` but that does not affect the compiler use in the *runtime* environment.",
    "created_at": "2021-09-23T17:13:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505671",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">Comment 22</div>

The problem on homebrew is really a very specific one, which I have explained in the ticket description: The GMP headers *are* installed in what you would call the "standard location" (`/usr/local/`), but when compiler/linker are invoked with `-isysroot`, then `/usr/local` is not a standard location. Yes, we fix it in the *build* environment using `.homebrew-build-env` but that does not affect the compiler use in the *runtime* environment.



---

archive/issue_comments_505672.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nReplying to [@orlitzky](#comment%3A21):\n> IMO homebrew (and anyone else installing libgmp to a nonstandard directory) should be pestered to install it to the system's default location. I'm pretty sure that the gmp and mpir packages then conflict, but you don't need to install them both at the same time. In fact, mpir can probably be deprecated.\n\nNo, brew does not install mpir in gmp-compatible mode, as far as\nI can tell from reading https://github.com/Homebrew/homebrew-core/blob/HEAD/Formula/mpir.rb\n- so there is no interference with gmp.",
    "created_at": "2021-09-23T18:27:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505672",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:23" align="right">Comment 23</div>

Replying to [@orlitzky](#comment%3A21):
> IMO homebrew (and anyone else installing libgmp to a nonstandard directory) should be pestered to install it to the system's default location. I'm pretty sure that the gmp and mpir packages then conflict, but you don't need to install them both at the same time. In fact, mpir can probably be deprecated.

No, brew does not install mpir in gmp-compatible mode, as far as
I can tell from reading https://github.com/Homebrew/homebrew-core/blob/HEAD/Formula/mpir.rb
- so there is no interference with gmp.



---

archive/issue_comments_505673.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nBesides, we're getting rid of mpir spkg all together.",
    "created_at": "2021-09-23T18:28:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505673",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:24" align="right">Comment 24</div>

Besides, we're getting rid of mpir spkg all together.



---

archive/issue_comments_505674.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nThis ticket has really nothing to do with MPIR. It's just (pre #32549) that the spkg-configure duties for gmp are done by MPIR's spkg-configure.",
    "created_at": "2021-09-23T18:29:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505674",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">Comment 25</div>

This ticket has really nothing to do with MPIR. It's just (pre #32549) that the spkg-configure duties for gmp are done by MPIR's spkg-configure.



---

archive/issue_comments_505675.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nReplying to [@mkoeppe](#comment%3A22):\n> The problem on homebrew is really a very specific one, which I have explained in the ticket description: The GMP headers *are* installed in what you would call the \"standard location\" (`/usr/local/`), but when compiler/linker are invoked with `-isysroot`, then `/usr/local` is not a standard location. Yes, we fix it in the *build* environment using `.homebrew-build-env` but that does not affect the compiler use in the *runtime* environment.\n\nOh, the description makes it sounds like libgmp being in `/usr/local/Cellar/gmp/6.2.1/lib` is the problem. Is this another case of trying to use cython (which in turn uses the C toolchain) without sourcing `.homebrew-build-env` to make the C toolchain work?",
    "created_at": "2021-09-23T19:24:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505675",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:26" align="right">Comment 26</div>

Replying to [@mkoeppe](#comment%3A22):
> The problem on homebrew is really a very specific one, which I have explained in the ticket description: The GMP headers *are* installed in what you would call the "standard location" (`/usr/local/`), but when compiler/linker are invoked with `-isysroot`, then `/usr/local` is not a standard location. Yes, we fix it in the *build* environment using `.homebrew-build-env` but that does not affect the compiler use in the *runtime* environment.

Oh, the description makes it sounds like libgmp being in `/usr/local/Cellar/gmp/6.2.1/lib` is the problem. Is this another case of trying to use cython (which in turn uses the C toolchain) without sourcing `.homebrew-build-env` to make the C toolchain work?



---

archive/issue_comments_505676.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nIt's really just the broken design of homebrew's `python3`. They use `-isysroot` in the build configuration of python, which goes into the compiler/flags of any extensions built via distutils/setuptools. Then they add back a few homebrew directories via `distutils.cfg`. It's hopelessly broken because these directories take priority over other user/package-provided include and linker directories. At build time, we work around it by disabling use of the system python's vendored distutils and use our own. \nAt runtime, we would be best off by using paths explicitly that can be discovered via pkg-config -- because in the Sage library we already do that for all other packages.",
    "created_at": "2021-09-25T01:44:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505676",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">Comment 27</div>

It's really just the broken design of homebrew's `python3`. They use `-isysroot` in the build configuration of python, which goes into the compiler/flags of any extensions built via distutils/setuptools. Then they add back a few homebrew directories via `distutils.cfg`. It's hopelessly broken because these directories take priority over other user/package-provided include and linker directories. At build time, we work around it by disabling use of the system python's vendored distutils and use our own. 
At runtime, we would be best off by using paths explicitly that can be discovered via pkg-config -- because in the Sage library we already do that for all other packages.



---

archive/issue_comments_505677.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nis this reported to Homebrew as a bug?",
    "created_at": "2021-09-25T07:30:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505677",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:28" align="right">Comment 28</div>

is this reported to Homebrew as a bug?



---

archive/issue_comments_505678.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nReplying to [@dimpase](#comment%3A28):\n> is this reported to Homebrew as a bug?\n\nI didn't report it when I came across it in #31335. I figured a bug report titled \"distutils.cfg considered harmful\" would drain a lot of energy...",
    "created_at": "2021-09-25T17:02:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505678",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:29" align="right">Comment 29</div>

Replying to [@dimpase](#comment%3A28):
> is this reported to Homebrew as a bug?

I didn't report it when I came across it in #31335. I figured a bug report titled "distutils.cfg considered harmful" would drain a lot of energy...



---

archive/issue_comments_505679.json:
```json
{
    "body": "Changed dependencies from **#31344** to **#31344, #32549**",
    "created_at": "2021-09-25T18:07:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505679",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#31344** to **#31344, #32549**



---

archive/issue_comments_505680.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nReplying to [@mkoeppe](#comment%3A29):\n> Replying to [@dimpase](#comment%3A28):\n> > is this reported to Homebrew as a bug?\n\n> I didn't report it when I came across it in #31335. I figured a bug report titled \"distutils.cfg considered harmful\" would drain a lot of energy... \n\nYou don't need to fight a battle, merely report the problem, please.",
    "created_at": "2021-09-26T08:12:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505680",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:31" align="right">Comment 31</div>

Replying to [@mkoeppe](#comment%3A29):
> Replying to [@dimpase](#comment%3A28):
> > is this reported to Homebrew as a bug?

> I didn't report it when I came across it in #31335. I figured a bug report titled "distutils.cfg considered harmful" would drain a lot of energy... 

You don't need to fight a battle, merely report the problem, please.



---

archive/issue_comments_505681.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nThey're pretty quick with closing as wontfix if one doesn't also provide a patch",
    "created_at": "2021-09-27T19:18:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505681",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">Comment 32</div>

They're pretty quick with closing as wontfix if one doesn't also provide a patch



---

archive/issue_comments_505682.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nReplying to [@mkoeppe](#comment%3A32):\n> They're pretty quick with closing as wontfix if one doesn't also provide a patch\n\nSprecht du kein Ruby, oder? :-)",
    "created_at": "2021-09-27T19:50:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505682",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:33" align="right">Comment 33</div>

Replying to [@mkoeppe](#comment%3A32):
> They're pretty quick with closing as wontfix if one doesn't also provide a patch

Sprecht du kein Ruby, oder? :-)



---

archive/issue_comments_505683.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nReplying to [@dimpase](#comment%3A31):\n> Replying to [@mkoeppe](#comment%3A29):\n> > Replying to [@dimpase](#comment%3A28):\n> > > is this reported to Homebrew as a bug?\n\n> > I didn't report it when I came across it in #31335. I figured a bug report titled \"distutils.cfg considered harmful\" would drain a lot of energy... \n\n> \n> You don't need to fight a battle, merely report the problem, please.\n\nI sent a first PR to reduce homebrew's `distutils.cfg` - https://github.com/Homebrew/homebrew-core/pull/91043",
    "created_at": "2021-12-12T00:15:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505683",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:34" align="right">Comment 34</div>

Replying to [@dimpase](#comment%3A31):
> Replying to [@mkoeppe](#comment%3A29):
> > Replying to [@dimpase](#comment%3A28):
> > > is this reported to Homebrew as a bug?

> > I didn't report it when I came across it in #31335. I figured a bug report titled "distutils.cfg considered harmful" would drain a lot of energy... 

> 
> You don't need to fight a battle, merely report the problem, please.

I sent a first PR to reduce homebrew's `distutils.cfg` - https://github.com/Homebrew/homebrew-core/pull/91043



---

archive/issue_events_413834.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2022-01-01T21:46:46Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "title_is": "build/pkgs/mpfr/spkg-configure.m4: Check pkg-config first",
    "title_was": "build/pkgs/{mpir,mpfr}/spkg-configure.m4: Check pkg-config first",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31348#event-413834"
}
```



---

archive/issue_comments_505684.json:
```json
{
    "body": "Changed keywords from **** to **mpfr**",
    "created_at": "2022-01-01T21:46:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505684",
    "user": "https://github.com/slel"
}
```

Changed keywords from **** to **mpfr**



---

archive/issue_comments_505685.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,5 +16,5 @@\n \n Similar situation with `readline` (#29000): The spkg-configure script already uses pkg-config - but forgets to tell the build system what it found.\n \n-previous tickets: #27212\n+Previous tickets: #27212\n \n``````\n",
    "created_at": "2022-01-01T21:46:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505685",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,5 +16,5 @@
 
 Similar situation with `readline` (#29000): The spkg-configure script already uses pkg-config - but forgets to tell the build system what it found.
 
-previous tickets: #27212
+Previous tickets: #27212
 
``````




---

archive/issue_comments_505686.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nRemoved mpir from ticket summary after its removal in #32549, #32727.",
    "created_at": "2022-01-01T21:46:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505686",
    "user": "https://github.com/slel"
}
```

<div id="comment:35" align="right">Comment 35</div>

Removed mpir from ticket summary after its removal in #32549, #32727.



---

archive/issue_events_413835.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-10T00:37:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31348#event-413835"
}
```



---

archive/issue_events_413836.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-10T00:37:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31348#event-413836"
}
```



---

archive/issue_comments_505687.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,7 +12,7 @@\n \n (After #32549, the relevant file is `build/pkgs/gmp/spkg-configure.m4`.)\n \n-The above applies to `mpfr` as well.\n+The above applies to `mpfr` as well. See failure report in https://groups.google.com/g/sage-release/c/8ctwsUGl6LQ/m/Ob38Iyh1AAAJ\n \n Similar situation with `readline` (#29000): The spkg-configure script already uses pkg-config - but forgets to tell the build system what it found.\n \n``````\n",
    "created_at": "2022-01-16T17:17:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505687",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,7 +12,7 @@
 
 (After #32549, the relevant file is `build/pkgs/gmp/spkg-configure.m4`.)
 
-The above applies to `mpfr` as well.
+The above applies to `mpfr` as well. See failure report in https://groups.google.com/g/sage-release/c/8ctwsUGl6LQ/m/Ob38Iyh1AAAJ
 
 Similar situation with `readline` (#29000): The spkg-configure script already uses pkg-config - but forgets to tell the build system what it found.
 
``````




---

archive/issue_comments_505688.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nReplying to [@mkoeppe](#comment%3A34):\n> I sent a first PR to reduce homebrew's `distutils.cfg` - https://github.com/Homebrew/homebrew-core/pull/91043\n\nThey have merged a broader change now, eliminating all of `distutils.cfg` (https://github.com/Homebrew/homebrew-core/pull/91043#issuecomment-1032079055), at least for their Python 3.10 package. That's a good improvement, but it changes nothing for the present ticket.",
    "created_at": "2022-02-08T06:47:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505688",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:38" align="right">Comment 38</div>

Replying to [@mkoeppe](#comment%3A34):
> I sent a first PR to reduce homebrew's `distutils.cfg` - https://github.com/Homebrew/homebrew-core/pull/91043

They have merged a broader change now, eliminating all of `distutils.cfg` (https://github.com/Homebrew/homebrew-core/pull/91043#issuecomment-1032079055), at least for their Python 3.10 package. That's a good improvement, but it changes nothing for the present ticket.



---

archive/issue_events_413837.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-07T00:07:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31348#event-413837"
}
```



---

archive/issue_events_413838.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-07T00:07:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31348#event-413838"
}
```



---

archive/issue_events_413839.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-16T20:55:22Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "title_is": "build/pkgs/{gmp,mpfr}/spkg-configure.m4: Check pkg-config first",
    "title_was": "build/pkgs/mpfr/spkg-configure.m4: Check pkg-config first",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31348#event-413839"
}
```



---

archive/issue_comments_505689.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nso this needs changes to gmp's and mpfr's `spkg-configure.m4` ? Anything else?",
    "created_at": "2022-05-20T13:19:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505689",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:41" align="right">Comment 41</div>

so this needs changes to gmp's and mpfr's `spkg-configure.m4` ? Anything else?



---

archive/issue_comments_505690.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\n`sage.env.cython_aliases` also needs to be extended",
    "created_at": "2022-05-20T16:39:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505690",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:42" align="right">Comment 42</div>

`sage.env.cython_aliases` also needs to be extended



---

archive/issue_comments_505691.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">Comment 43</div>\n\nshould we remove all the crud needed for gmp and mpfr without .pc files available?\n\nI suppose almost every platform we support nowadays will have them installed.",
    "created_at": "2022-05-30T10:59:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505691",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:43" align="right">Comment 43</div>

should we remove all the crud needed for gmp and mpfr without .pc files available?

I suppose almost every platform we support nowadays will have them installed.



---

archive/issue_comments_505692.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">Comment 44</div>\n\nReplying to [@dimpase](#comment%3A43):\n> I suppose almost every platform we support nowadays will have them installed.\n\nThat would be worth checking.",
    "created_at": "2022-05-30T18:42:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31348#issuecomment-505692",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:44" align="right">Comment 44</div>

Replying to [@dimpase](#comment%3A43):
> I suppose almost every platform we support nowadays will have them installed.

That would be worth checking.



---

archive/issue_events_413840.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31348#event-413840"
}
```



---

archive/issue_events_413841.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31348",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31348#event-413841"
}
```
