# Issue 31400: Serious errors in heights of projective points over number fields

archive/issues_031163.json:
```json
{
    "assignees": [],
    "body": "This was raised at [Ask Sage question 55698](https://ask.sagemath.org/question/55698).\n\nNumber fields have an iterator to yield all elements of bounded global height.  This is used in an incorrect way to enumerate points of bounded height on projective space: in `schemes.projective.projective_space` the iterator `points_of_bounded_height` appears to iterate over all points whose projective coordinates all have height less than the given bound -- this is not just wrong, it is not well-defined.  Similarly, in `schemes.projective.projective_point` the global height of a point is incorrectly implemented as the max of the heights of its coordinates -- again, not well defined.\n\nCC:  @slel @EnderWannabe\n\nKeywords: **projective height**\n\nBranch: **[71e63df](https://github.com/sagemath/sagetrac-mirror/commit/71e63dfeb71fea4fa6dad05e98a31aec16eba058)**\n\nReviewer: **Alexander Galarraga**\n\nAuthor: **Jieao Song, Fr\u00e9d\u00e9ric Chapoton**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31400_\n\n",
    "closed_at": "2021-10-09T11:10:23Z",
    "created_at": "2021-02-15T11:31:38Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20number%20theory",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Serious errors in heights of projective points over number fields",
    "type": "issue",
    "updated_at": "2021-10-13T23:48:06Z",
    "url": "https://github.com/sagemath/sage/issues/31400",
    "user": "https://github.com/JohnCremona"
}
```
This was raised at [Ask Sage question 55698](https://ask.sagemath.org/question/55698).

Number fields have an iterator to yield all elements of bounded global height.  This is used in an incorrect way to enumerate points of bounded height on projective space: in `schemes.projective.projective_space` the iterator `points_of_bounded_height` appears to iterate over all points whose projective coordinates all have height less than the given bound -- this is not just wrong, it is not well-defined.  Similarly, in `schemes.projective.projective_point` the global height of a point is incorrectly implemented as the max of the heights of its coordinates -- again, not well defined.

CC:  @slel @EnderWannabe

Keywords: **projective height**

Branch: **[71e63df](https://github.com/sagemath/sagetrac-mirror/commit/71e63dfeb71fea4fa6dad05e98a31aec16eba058)**

Reviewer: **Alexander Galarraga**

Author: **Jieao Song, Frédéric Chapoton**

_Issue created by migration from https://trac.sagemath.org/ticket/31400_





---

archive/issue_events_414541.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2021-02-15T11:31:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31400#event-414541"
}
```



---

archive/issue_events_414542.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2021-02-15T11:31:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "component: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31400#event-414542"
}
```



---

archive/issue_events_414543.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2021-02-15T11:31:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31400#event-414543"
}
```



---

archive/issue_events_414544.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2021-02-15T11:31:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31400#event-414544"
}
```



---

archive/issue_comments_507080.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-This was raised at https://ask.sagemath.org/question/55698/height-of-rational-points/ .\n+This was raised at [Ask Sage question 55698](https://ask.sagemath.org/question/55698).\n \n-Number fields have an iterator to yield all elements of bounded global height.  This is used in an incorrect way to enumerate points of bounded height on projective space: in schemes.projective.projective_space the iterator `points_of_bounded_height` appears to iterate over all points whose projective coordinates all have height less than the given bound -- this is not just wrong, it is not well-defined.  Similarly, in schemes.projective.projective_point the global height of a point is incorrectly implemented as the max of the heights of its coordinates -- again, not well defined.\n+Number fields have an iterator to yield all elements of bounded global height.  This is used in an incorrect way to enumerate points of bounded height on projective space: in `schemes.projective.projective_space` the iterator `points_of_bounded_height` appears to iterate over all points whose projective coordinates all have height less than the given bound -- this is not just wrong, it is not well-defined.  Similarly, in `schemes.projective.projective_point` the global height of a point is incorrectly implemented as the max of the heights of its coordinates -- again, not well defined.\n``````\n",
    "created_at": "2021-02-15T23:27:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507080",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-This was raised at https://ask.sagemath.org/question/55698/height-of-rational-points/ .
+This was raised at [Ask Sage question 55698](https://ask.sagemath.org/question/55698).
 
-Number fields have an iterator to yield all elements of bounded global height.  This is used in an incorrect way to enumerate points of bounded height on projective space: in schemes.projective.projective_space the iterator `points_of_bounded_height` appears to iterate over all points whose projective coordinates all have height less than the given bound -- this is not just wrong, it is not well-defined.  Similarly, in schemes.projective.projective_point the global height of a point is incorrectly implemented as the max of the heights of its coordinates -- again, not well defined.
+Number fields have an iterator to yield all elements of bounded global height.  This is used in an incorrect way to enumerate points of bounded height on projective space: in `schemes.projective.projective_space` the iterator `points_of_bounded_height` appears to iterate over all points whose projective coordinates all have height less than the given bound -- this is not just wrong, it is not well-defined.  Similarly, in `schemes.projective.projective_point` the global height of a point is incorrectly implemented as the max of the heights of its coordinates -- again, not well defined.
``````




---

archive/issue_comments_507081.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nHi, I updated my code and added some docs (see the `.py` file here https://github.com/8d1h/RationalPoints/)\n\nThe global height is implemented without log, since this gives the precise value for rational numbers.\n\nThe rational point enumeration method uses elimination and is a lot faster than the current available algorithms (see the documented examples).",
    "created_at": "2021-02-26T13:42:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507081",
    "user": "https://github.com/8d1h"
}
```

<div id="comment:2" align="right">Comment 2</div>

Hi, I updated my code and added some docs (see the `.py` file here https://github.com/8d1h/RationalPoints/)

The global height is implemented without log, since this gives the precise value for rational numbers.

The rational point enumeration method uses elimination and is a lot faster than the current available algorithms (see the documented examples).



---

archive/issue_events_414545.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31400#event-414545"
}
```



---

archive/issue_events_414546.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31400#event-414546"
}
```



---

archive/issue_comments_507082.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nMoving to 9.4, as 9.3 has been released.",
    "created_at": "2021-05-10T17:42:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507082",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:3" align="right">Comment 3</div>

Moving to 9.4, as 9.3 has been released.



---

archive/issue_events_414547.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31400#event-414547"
}
```



---

archive/issue_events_414548.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31400#event-414548"
}
```



---

archive/issue_comments_507083.json:
```json
{
    "body": "Branch: **[public/ticket/31400](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/31400)**",
    "created_at": "2021-09-12T09:58:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507083",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[public/ticket/31400](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/31400)**



---

archive/issue_comments_507084.json:
```json
{
    "body": "Commit: **[15b37ca](https://github.com/sagemath/sagetrac-mirror/commit/15b37cacc178272923528ea816ced3fdf2a49d57)**",
    "created_at": "2021-09-12T09:58:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507084",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[15b37ca](https://github.com/sagemath/sagetrac-mirror/commit/15b37cacc178272923528ea816ced3fdf2a49d57)**



---

archive/issue_events_414549.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-09-12T09:58:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31400#event-414549"
}
```



---

archive/issue_comments_507085.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nI have ported the code for global_height from \"gh-8d1h\" git repo. No idea if this is correct and better than before.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15b37cacc178272923528ea816ced3fdf2a49d57\">15b37ca</a></td><td><code>modify global_height for projective points</code></td></tr></table>\n",
    "created_at": "2021-09-12T09:58:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507085",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:5" align="right">Comment 5</div>

I have ported the code for global_height from "gh-8d1h" git repo. No idea if this is correct and better than before.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15b37cacc178272923528ea816ced3fdf2a49d57">15b37ca</a></td><td><code>modify global_height for projective points</code></td></tr></table>




---

archive/issue_comments_507086.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nwould someone please provide a doctest where the value was wrong before ?",
    "created_at": "2021-09-17T07:33:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507086",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:7" align="right">Comment 7</div>

would someone please provide a doctest where the value was wrong before ?



---

archive/issue_comments_507087.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nHi! Sorry I was going to fix this but I didn't quite figure out how the whole trac thing works.\n\nFor doctests, I put two of them in my file.\n\n```\nsage: P = ProjectiveSpace(QQ, 2)\nsage: P(1/1,2/3,5/8).global_height()\n2.77258872223978\nsage: F.<u> = NumberField(x^3-5)\nsage: P = ProjectiveSpace(F, 2)\nsage: P(u,u^2/5,1).global_height()\n0.536479304144700\n```\n\nThese are the current wrong results: they should be log(24) and 1.07295860828940 respectively.",
    "created_at": "2021-09-17T09:33:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507087",
    "user": "https://github.com/8d1h"
}
```

<div id="comment:8" align="right">Comment 8</div>

Hi! Sorry I was going to fix this but I didn't quite figure out how the whole trac thing works.

For doctests, I put two of them in my file.

```
sage: P = ProjectiveSpace(QQ, 2)
sage: P(1/1,2/3,5/8).global_height()
2.77258872223978
sage: F.<u> = NumberField(x^3-5)
sage: P = ProjectiveSpace(F, 2)
sage: P(u,u^2/5,1).global_height()
0.536479304144700
```

These are the current wrong results: they should be log(24) and 1.07295860828940 respectively.



---

archive/issue_comments_507088.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be63bb32b1bec11089799024354f561be8ff2d2a\">be63bb3</a></td><td><code>Merge branch 'public/ticket/31400' in 9.5.b1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b67f8b028c5ceb68514dd613ca3b088b679d44e\">8b67f8b</a></td><td><code>adding doctests</code></td></tr></table>\n",
    "created_at": "2021-09-17T12:36:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507088",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9" align="right">Comment 9</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be63bb32b1bec11089799024354f561be8ff2d2a">be63bb3</a></td><td><code>Merge branch 'public/ticket/31400' in 9.5.b1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b67f8b028c5ceb68514dd613ca3b088b679d44e">8b67f8b</a></td><td><code>adding doctests</code></td></tr></table>




---

archive/issue_comments_507089.json:
```json
{
    "body": "Changed commit from **[15b37ca](https://github.com/sagemath/sagetrac-mirror/commit/15b37cacc178272923528ea816ced3fdf2a49d57)** to **[8b67f8b](https://github.com/sagemath/sagetrac-mirror/commit/8b67f8b028c5ceb68514dd613ca3b088b679d44e)**",
    "created_at": "2021-09-17T12:36:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507089",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[15b37ca](https://github.com/sagemath/sagetrac-mirror/commit/15b37cacc178272923528ea816ced3fdf2a49d57)** to **[8b67f8b](https://github.com/sagemath/sagetrac-mirror/commit/8b67f8b028c5ceb68514dd613ca3b088b679d44e)**



---

archive/issue_comments_507090.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nThanks. I have added these doctests.",
    "created_at": "2021-09-17T12:37:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507090",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:10" align="right">Comment 10</div>

Thanks. I have added these doctests.



---

archive/issue_comments_507091.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nIs there any other program that can be used to check these values ?",
    "created_at": "2021-09-17T12:38:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507091",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:11" align="right">Comment 11</div>

Is there any other program that can be used to check these values ?



---

archive/issue_comments_507092.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nI guess you could try Magma at http://magma.maths.usyd.edu.au/calc/\n\n```\nP := ProjectiveSpace(Rationals(),2);\np := P ! [1/1,2/3,5/8];\nLog(HeightOnAmbient(p:Absolute));\n\nR<x> := PolynomialRing(Integers());\nF<u> := NumberField(x^3-5);\nP := ProjectiveSpace(F,2);\np := P ! [u,u^2/5,1];\nLog(HeightOnAmbient(p:Absolute));\n```\nalthough there are some differences in conventions, hence the `Log` and `:Absolute`.\n\n(BTW I was trying to use Sage to check these values for my computation in Macaulay2 in the first place, and it turned out that the function is not correctly implemented...)",
    "created_at": "2021-09-17T12:59:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507092",
    "user": "https://github.com/8d1h"
}
```

<div id="comment:12" align="right">Comment 12</div>

I guess you could try Magma at http://magma.maths.usyd.edu.au/calc/

```
P := ProjectiveSpace(Rationals(),2);
p := P ! [1/1,2/3,5/8];
Log(HeightOnAmbient(p:Absolute));

R<x> := PolynomialRing(Integers());
F<u> := NumberField(x^3-5);
P := ProjectiveSpace(F,2);
p := P ! [u,u^2/5,1];
Log(HeightOnAmbient(p:Absolute));
```
although there are some differences in conventions, hence the `Log` and `:Absolute`.

(BTW I was trying to use Sage to check these values for my computation in Macaulay2 in the first place, and it turned out that the function is not correctly implemented...)



---

archive/issue_comments_507093.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nok, looks good, same results in magma. I would propose to keep the other problem about the iterator for another ticket. \n\n@JohnCremona, @roed314, would you please review ?",
    "created_at": "2021-09-17T13:06:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507093",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:13" align="right">Comment 13</div>

ok, looks good, same results in magma. I would propose to keep the other problem about the iterator for another ticket. 

@JohnCremona, @roed314, would you please review ?



---

archive/issue_comments_507094.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nThe functionality looks good to me.\n\nWe have an issue with return types.\n\n```\nsage: P.<x,y,z> = ProjectiveSpace(QQ,2)\nsage: Q = P.point([4, 4, 1/30])\nsage: type(Q.global_height())\n<class 'sage.symbolic.expression.Expression'>\n```\n\nWhile sometimes we return a real number. Since the function previously returned a real number, we shouldn't change the return type.",
    "created_at": "2021-09-17T17:04:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507094",
    "user": "https://github.com/EnderWannabe"
}
```

<div id="comment:14" align="right">Comment 14</div>

The functionality looks good to me.

We have an issue with return types.

```
sage: P.<x,y,z> = ProjectiveSpace(QQ,2)
sage: Q = P.point([4, 4, 1/30])
sage: type(Q.global_height())
<class 'sage.symbolic.expression.Expression'>
```

While sometimes we return a real number. Since the function previously returned a real number, we shouldn't change the return type.



---

archive/issue_events_414550.json:
```json
{
    "actor": "https://github.com/EnderWannabe",
    "created_at": "2021-09-17T17:04:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31400#event-414550"
}
```



---

archive/issue_events_414551.json:
```json
{
    "actor": "https://github.com/EnderWannabe",
    "created_at": "2021-09-17T17:04:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31400#event-414551"
}
```



---

archive/issue_comments_507095.json:
```json
{
    "body": "Reviewer: **Alexander Galarraga**",
    "created_at": "2021-09-17T17:04:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507095",
    "user": "https://github.com/EnderWannabe"
}
```

Reviewer: **Alexander Galarraga**



---

archive/issue_comments_507096.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nso you prefer the inexact answer to the exact answer ?",
    "created_at": "2021-09-17T17:59:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507096",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:15" align="right">Comment 15</div>

so you prefer the inexact answer to the exact answer ?



---

archive/issue_comments_507097.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nSince this a function already included in Sage, we can't change it's return type without somehow deprecating the function.\n\nAdditionally, it seems we can't return the exact answer in all cases - some answers are still inexact. Having different types returned from the same function with the same parameters is bad practice.\n\nSo here I do prefer the inexact answer. It would be nice to return an exact answer, but I don't think it's possible here.",
    "created_at": "2021-09-17T18:04:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507097",
    "user": "https://github.com/EnderWannabe"
}
```

<div id="comment:16" align="right">Comment 16</div>

Since this a function already included in Sage, we can't change it's return type without somehow deprecating the function.

Additionally, it seems we can't return the exact answer in all cases - some answers are still inexact. Having different types returned from the same function with the same parameters is bad practice.

So here I do prefer the inexact answer. It would be nice to return an exact answer, but I don't think it's possible here.



---

archive/issue_comments_507098.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nActually, it is possible to return the exact answer even for general number fields, ~~by implementing an exact version of `complex_embedding` using `QQbar`, which would also be useful in general.~~ by using `K.embeddings(QQbar)`.\n\nBut I agree that one should be consistent with the return type. Since `2.global_height()` returns an inexact value instead of `log(2)`, I think here it should also return the inexact value.",
    "created_at": "2021-09-17T19:35:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507098",
    "user": "https://github.com/8d1h"
}
```

<div id="comment:17" align="right">Comment 17</div>

Actually, it is possible to return the exact answer even for general number fields, ~~by implementing an exact version of `complex_embedding` using `QQbar`, which would also be useful in general.~~ by using `K.embeddings(QQbar)`.

But I agree that one should be consistent with the return type. Since `2.global_height()` returns an inexact value instead of `log(2)`, I think here it should also return the inexact value.



---

archive/issue_comments_507099.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e35065cf3af39d883e1d25ba741f3505287039a4\">e35065c</a></td><td><code>now with numeric doctests</code></td></tr></table>\n",
    "created_at": "2021-09-18T09:50:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507099",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18" align="right">Comment 18</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e35065cf3af39d883e1d25ba741f3505287039a4">e35065c</a></td><td><code>now with numeric doctests</code></td></tr></table>




---

archive/issue_comments_507100.json:
```json
{
    "body": "Changed commit from **[8b67f8b](https://github.com/sagemath/sagetrac-mirror/commit/8b67f8b028c5ceb68514dd613ca3b088b679d44e)** to **[e35065c](https://github.com/sagemath/sagetrac-mirror/commit/e35065cf3af39d883e1d25ba741f3505287039a4)**",
    "created_at": "2021-09-18T09:50:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507100",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8b67f8b](https://github.com/sagemath/sagetrac-mirror/commit/8b67f8b028c5ceb68514dd613ca3b088b679d44e)** to **[e35065c](https://github.com/sagemath/sagetrac-mirror/commit/e35065cf3af39d883e1d25ba741f3505287039a4)**



---

archive/issue_comments_507101.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nok, here it goes",
    "created_at": "2021-09-18T09:51:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507101",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:19" align="right">Comment 19</div>

ok, here it goes



---

archive/issue_events_414552.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-09-18T17:48:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31400#event-414552"
}
```



---

archive/issue_events_414553.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-09-18T17:48:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31400#event-414553"
}
```



---

archive/issue_comments_507102.json:
```json
{
    "body": "Changed commit from **[e35065c](https://github.com/sagemath/sagetrac-mirror/commit/e35065cf3af39d883e1d25ba741f3505287039a4)** to **[71e63df](https://github.com/sagemath/sagetrac-mirror/commit/71e63dfeb71fea4fa6dad05e98a31aec16eba058)**",
    "created_at": "2021-09-19T15:46:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507102",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e35065c](https://github.com/sagemath/sagetrac-mirror/commit/e35065cf3af39d883e1d25ba741f3505287039a4)** to **[71e63df](https://github.com/sagemath/sagetrac-mirror/commit/71e63dfeb71fea4fa6dad05e98a31aec16eba058)**



---

archive/issue_comments_507103.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/71e63dfeb71fea4fa6dad05e98a31aec16eba058\">71e63df</a></td><td><code>fix doctests</code></td></tr></table>\n",
    "created_at": "2021-09-19T15:46:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507103",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21" align="right">Comment 21</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/71e63dfeb71fea4fa6dad05e98a31aec16eba058">71e63df</a></td><td><code>fix doctests</code></td></tr></table>




---

archive/issue_comments_507104.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nLGTM",
    "created_at": "2021-09-20T01:51:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507104",
    "user": "https://github.com/EnderWannabe"
}
```

<div id="comment:22" align="right">Comment 22</div>

LGTM



---

archive/issue_events_414554.json:
```json
{
    "actor": "https://github.com/EnderWannabe",
    "created_at": "2021-09-20T01:51:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31400#event-414554"
}
```



---

archive/issue_events_414555.json:
```json
{
    "actor": "https://github.com/EnderWannabe",
    "created_at": "2021-09-20T01:51:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31400#event-414555"
}
```



---

archive/issue_comments_507105.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nthe author should probably be gh-8d1h ? I just copied and adapted the code\n\nWe need an \"Author full name\"..",
    "created_at": "2021-09-20T06:07:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507105",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:23" align="right">Comment 23</div>

the author should probably be gh-8d1h ? I just copied and adapted the code

We need an "Author full name"..



---

archive/issue_comments_507106.json:
```json
{
    "body": "Author: **Jieao Song, Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2021-09-20T10:23:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507106",
    "user": "https://github.com/fchapoton"
}
```

Author: **Jieao Song, Frédéric Chapoton**



---

archive/issue_comments_507107.json:
```json
{
    "body": "Changed branch from **[public/ticket/31400](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/31400)** to **[71e63df](https://github.com/sagemath/sagetrac-mirror/commit/71e63dfeb71fea4fa6dad05e98a31aec16eba058)**",
    "created_at": "2021-10-09T11:10:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507107",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/ticket/31400](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/31400)** to **[71e63df](https://github.com/sagemath/sagetrac-mirror/commit/71e63dfeb71fea4fa6dad05e98a31aec16eba058)**



---

archive/issue_events_414556.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-09T11:10:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31400#event-414556"
}
```



---

archive/issue_events_414557.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d01d808fbbbf76b0bd486582727f6074dd1e0431",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-10-09T11:10:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31400#event-414557"
}
```



---

archive/issue_comments_507108.json:
```json
{
    "body": "Changed commit from **[71e63df](https://github.com/sagemath/sagetrac-mirror/commit/71e63dfeb71fea4fa6dad05e98a31aec16eba058)** to none",
    "created_at": "2021-10-12T21:37:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507108",
    "user": "https://github.com/bhutz"
}
```

Changed commit from **[71e63df](https://github.com/sagemath/sagetrac-mirror/commit/71e63dfeb71fea4fa6dad05e98a31aec16eba058)** to none



---

archive/issue_comments_507109.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nI recently came across this bug in the height functions as well as a couple other height bugs. This ticket did fix the the incorrect values I was seeing in global_height().\n\nI'm trying to see if the other issues already have tickets opened too. Was there a ticket opened for the projective points of bounded height iterator? I couldn't find one when I searched trac.\n\nThanks.",
    "created_at": "2021-10-12T21:37:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507109",
    "user": "https://github.com/bhutz"
}
```

<div id="comment:26" align="right">Comment 26</div>

I recently came across this bug in the height functions as well as a couple other height bugs. This ticket did fix the the incorrect values I was seeing in global_height().

I'm trying to see if the other issues already have tickets opened too. Was there a ticket opened for the projective points of bounded height iterator? I couldn't find one when I searched trac.

Thanks.



---

archive/issue_comments_507110.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nI've created the iterator ticket as #32686",
    "created_at": "2021-10-13T23:48:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31400#issuecomment-507110",
    "user": "https://github.com/bhutz"
}
```

<div id="comment:27" align="right">Comment 27</div>

I've created the iterator ticket as #32686
