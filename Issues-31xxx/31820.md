# Issue 31820: Fix pickling of normaliz representation objects

archive/issues_031583.json:
```json
{
    "body": "The normaliz cone is recreated after loading a saved normaliz polyhedron. Unfortunatly, it is recreated from the representation objects and not from the corresponding vectors. This leads to circular dependencies that are not always successfully resolved:\n\n```\nsage: P = polytopes.cube(backend='normaliz')                                    \nsage: v = P.Vrepresentation()[0]                                                \nsage: v1 = loads(v.dumps())                                                     \nTraceback (most recent call last)\n...\n~/Applications/sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/representation.py in __getitem__(self, i)\n     83             2\n     84         \"\"\"\n---> 85         return self._vector[i]\n     86 \n     87     def __hash__(self):\n\nAttributeError: 'Vertex' object has no attribute '_vector'\n```\n\nWe fix this by initialization of the cone from the vectors instead.\n\nCC:  @jplab @mkoeppe @vbraun\n\nKeywords: normaliz, pickling\n\nReviewer: Matthias Koeppe\n\nAuthor: Jonathan Kliem\n\nBranch: public/31820\n\nCommit: 5e65a5e65dee0d4f9a4d35ac3a081f3ca5adc90a\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31820\n\n",
    "closed_at": "2021-07-24T18:57:02Z",
    "created_at": "2021-05-12T13:48:07Z",
    "labels": [
        "component: geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Fix pickling of normaliz representation objects",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31820",
    "user": "https://github.com/kliem"
}
```
The normaliz cone is recreated after loading a saved normaliz polyhedron. Unfortunatly, it is recreated from the representation objects and not from the corresponding vectors. This leads to circular dependencies that are not always successfully resolved:

```
sage: P = polytopes.cube(backend='normaliz')                                    
sage: v = P.Vrepresentation()[0]                                                
sage: v1 = loads(v.dumps())                                                     
Traceback (most recent call last)
...
~/Applications/sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/representation.py in __getitem__(self, i)
     83             2
     84         """
---> 85         return self._vector[i]
     86 
     87     def __hash__(self):

AttributeError: 'Vertex' object has no attribute '_vector'
```

We fix this by initialization of the cone from the vectors instead.

CC:  @jplab @mkoeppe @vbraun

Keywords: normaliz, pickling

Reviewer: Matthias Koeppe

Author: Jonathan Kliem

Branch: public/31820

Commit: 5e65a5e65dee0d4f9a4d35ac3a081f3ca5adc90a

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31820





---

archive/issue_comments_624819.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-05-12T13:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31820#issuecomment-624819",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_624820.json:
```json
{
    "body": "Changing branch from \"\" to \"public/31820\"",
    "created_at": "2021-05-12T13:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31820#issuecomment-624820",
    "user": "https://github.com/kliem"
}
```

Changing branch from "" to "public/31820"



---

archive/issue_comments_624821.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                                              |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------|\n|[79983a9](https://github.com/sagemath/sagetrac-mirror/commit/79983a997f37ef15e9edade5c67a8a6ffe747d7c)|`fix pickling of representation objects with backend normaliz`|\n|[5e65a5e](https://github.com/sagemath/sagetrac-mirror/commit/5e65a5e65dee0d4f9a4d35ac3a081f3ca5adc90a)|`add doctest`|",
    "created_at": "2021-05-12T13:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31820#issuecomment-624821",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                                              |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------|
|[79983a9](https://github.com/sagemath/sagetrac-mirror/commit/79983a997f37ef15e9edade5c67a8a6ffe747d7c)|`fix pickling of representation objects with backend normaliz`|
|[5e65a5e](https://github.com/sagemath/sagetrac-mirror/commit/5e65a5e65dee0d4f9a4d35ac3a081f3ca5adc90a)|`add doctest`|



---

archive/issue_comments_624822.json:
```json
{
    "body": "Changing keywords from \"\" to \"normaliz, pickling\".",
    "created_at": "2021-05-12T13:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31820#issuecomment-624822",
    "user": "https://github.com/kliem"
}
```

Changing keywords from "" to "normaliz, pickling".



---

archive/issue_comments_624823.json:
```json
{
    "body": "Changing commit from \"\" to \"5e65a5e65dee0d4f9a4d35ac3a081f3ca5adc90a\"",
    "created_at": "2021-05-12T13:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31820#issuecomment-624823",
    "user": "https://github.com/kliem"
}
```

Changing commit from "" to "5e65a5e65dee0d4f9a4d35ac3a081f3ca5adc90a"



---

archive/issue_comments_624824.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-05-12T15:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31820#issuecomment-624824",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_624825.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe\"",
    "created_at": "2021-05-12T15:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31820#issuecomment-624825",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Matthias Koeppe"



---

archive/issue_comments_624826.json:
```json
{
    "body": "<a id='comment:3'></a>\nThank you.",
    "created_at": "2021-05-12T20:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31820#issuecomment-624826",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>
Thank you.



---

archive/issue_events_102478.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-24T18:57:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31820",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31820#event-102478"
}
```



---

archive/issue_comments_624827.json:
```json
{
    "body": "<a id='comment:4'></a>\nApparently this was merged as part of #31821.",
    "created_at": "2021-07-24T18:57:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31820#issuecomment-624827",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
Apparently this was merged as part of #31821.



---

archive/issue_comments_624828.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-24T18:57:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31820",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31820#issuecomment-624828",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: fixed
