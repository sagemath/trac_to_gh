# Issue 31203: multiplication_table does not work for certain types of groups

archive/issues_030966.json:
```json
{
    "body": "apparently not for finitely presented groups, although they have such a method, and the documentation says that all that is required is a multiplication operation:\n(Might be related to an ancient ticket. #7555 about so-called \"Cayley tables\")\n\n```\nGU.<s,t> = FreeGroup()\ngr0 = tetrahedral_group = GU / (s^(-2)*t*s*t, t^(-2)*s*t*s, s*t*s*t)\nprint(gr0.order())\ngr0.multiplication_table()\n\n\nError in lines 1-1\nTraceback (most recent call last):\n  File \"/ext/sage/sage-9.2/local/lib/python3.8/site-packages/sage/matrix/operation_table.py\", line 447, in __init__\n    r = get_row(result)\nKeyError: t^2\n...\n```\n\n**Keywords:** groups, multiplication table\n\n**Branch/Commit:** [65938052495bc436be6fe53691fd207917142a0b](https://github.com/sagemath/sagetrac-mirror/commit/65938052495bc436be6fe53691fd207917142a0b)\n\n**Reviewer:** G\u00fcnter Rote\n\n**Author:** Travis Scrimshaw\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31203\n\n",
    "closed_at": "2021-03-09T00:00:08Z",
    "created_at": "2021-01-07T21:23:51Z",
    "labels": [
        "component: group theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "multiplication_table does not work for certain types of groups",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31203",
    "user": "https://github.com/guenterrote"
}
```
apparently not for finitely presented groups, although they have such a method, and the documentation says that all that is required is a multiplication operation:
(Might be related to an ancient ticket. #7555 about so-called "Cayley tables")

```
GU.<s,t> = FreeGroup()
gr0 = tetrahedral_group = GU / (s^(-2)*t*s*t, t^(-2)*s*t*s, s*t*s*t)
print(gr0.order())
gr0.multiplication_table()


Error in lines 1-1
Traceback (most recent call last):
  File "/ext/sage/sage-9.2/local/lib/python3.8/site-packages/sage/matrix/operation_table.py", line 447, in __init__
    r = get_row(result)
KeyError: t^2
...
```

**Keywords:** groups, multiplication table

**Branch/Commit:** [65938052495bc436be6fe53691fd207917142a0b](https://github.com/sagemath/sagetrac-mirror/commit/65938052495bc436be6fe53691fd207917142a0b)

**Reviewer:** Günter Rote

**Author:** Travis Scrimshaw

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/31203





---

archive/issue_comments_619367.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n apparently not for finitely presented groups, although they have such a method, and the documentation says that all that is required is a multiplication operation:\n-(Might be related to an ancient ticket. #7555)\n+(Might be related to an ancient ticket. #7555 about so-called \"Cayley tables\")\n \n ```\n GU.<s,t> = FreeGroup()\n``````\n",
    "created_at": "2021-01-07T21:24:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619367",
    "user": "https://github.com/guenterrote"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 apparently not for finitely presented groups, although they have such a method, and the documentation says that all that is required is a multiplication operation:
-(Might be related to an ancient ticket. #7555)
+(Might be related to an ancient ticket. #7555 about so-called "Cayley tables")
 
 ```
 GU.<s,t> = FreeGroup()
``````




---

archive/issue_comments_619368.json:
```json
{
    "body": "**Changing keywords** from \"groups\" to \"groups, multiplication table\".",
    "created_at": "2021-01-07T21:24:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619368",
    "user": "https://github.com/guenterrote"
}
```

**Changing keywords** from "groups" to "groups, multiplication table".



---

archive/issue_comments_619369.json:
```json
{
    "body": "**Branch:** [u/guenterrote/multiplication_table_does_not_work_for_certain_types_of_groups_](https://github.com/sagemath/sagetrac-mirror/tree/u/guenterrote/multiplication_table_does_not_work_for_certain_types_of_groups_)",
    "created_at": "2021-01-10T00:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619369",
    "user": "https://github.com/guenterrote"
}
```

**Branch:** [u/guenterrote/multiplication_table_does_not_work_for_certain_types_of_groups_](https://github.com/sagemath/sagetrac-mirror/tree/u/guenterrote/multiplication_table_does_not_work_for_certain_types_of_groups_)



---

archive/issue_comments_619370.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2021-01-10T00:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619370",
    "user": "https://github.com/guenterrote"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_619371.json:
```json
{
    "body": "<a id='comment:3'></a>\nI have updated the documentation.\n\n(Sorry that I did not run the automatic doctests myself. I could not install the development version due to some bug.)\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15247bce27986709088ccc76ff76d47ac01c684f\">15247bc</a></td><td><code>warning about finitely generated groups</code></td></tr></table>\n",
    "created_at": "2021-01-10T00:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619371",
    "user": "https://github.com/guenterrote"
}
```

<a id='comment:3'></a>
I have updated the documentation.

(Sorry that I did not run the automatic doctests myself. I could not install the development version due to some bug.)

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15247bce27986709088ccc76ff76d47ac01c684f">15247bc</a></td><td><code>warning about finitely generated groups</code></td></tr></table>




---

archive/issue_comments_619372.json:
```json
{
    "body": "**Commit:** [15247bce27986709088ccc76ff76d47ac01c684f](https://github.com/sagemath/sagetrac-mirror/commit/15247bce27986709088ccc76ff76d47ac01c684f)",
    "created_at": "2021-01-10T00:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619372",
    "user": "https://github.com/guenterrote"
}
```

**Commit:** [15247bce27986709088ccc76ff76d47ac01c684f](https://github.com/sagemath/sagetrac-mirror/commit/15247bce27986709088ccc76ff76d47ac01c684f)



---

archive/issue_comments_619373.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/23a07b94b37a09fa635307f2af0b2fb104cb999a\">23a07b9</a></td><td><code>doctests passed. (generating the html doc files still fails!)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/10b0dbeb8ad623f603e0485e9940e82c16f187a1\">10b0dbe</a></td><td><code>now the documentation is also fine!</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7aa86978206307b19342ad45b534ea1fd32b42d9\">7aa8697</a></td><td><code>final polishing</code></td></tr></table>\n",
    "created_at": "2021-01-22T06:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619373",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/23a07b94b37a09fa635307f2af0b2fb104cb999a">23a07b9</a></td><td><code>doctests passed. (generating the html doc files still fails!)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/10b0dbeb8ad623f603e0485e9940e82c16f187a1">10b0dbe</a></td><td><code>now the documentation is also fine!</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7aa86978206307b19342ad45b534ea1fd32b42d9">7aa8697</a></td><td><code>final polishing</code></td></tr></table>




---

archive/issue_comments_619374.json:
```json
{
    "body": "**Changing commit** from \"[15247bce27986709088ccc76ff76d47ac01c684f](https://github.com/sagemath/sagetrac-mirror/commit/15247bce27986709088ccc76ff76d47ac01c684f)\" to \"[7aa86978206307b19342ad45b534ea1fd32b42d9](https://github.com/sagemath/sagetrac-mirror/commit/7aa86978206307b19342ad45b534ea1fd32b42d9)\".",
    "created_at": "2021-01-22T06:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619374",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[15247bce27986709088ccc76ff76d47ac01c684f](https://github.com/sagemath/sagetrac-mirror/commit/15247bce27986709088ccc76ff76d47ac01c684f)" to "[7aa86978206307b19342ad45b534ea1fd32b42d9](https://github.com/sagemath/sagetrac-mirror/commit/7aa86978206307b19342ad45b534ea1fd32b42d9)".



---

archive/issue_comments_619375.json:
```json
{
    "body": "<a id='comment:5'></a>\nThis proposed \"fix\" is just an update to the documentation. I think it is important to warn users that finitely generated groups might not work as expected in some cases.\n\n(I could not get the doctest with the failed multiplication table to run. Apparently two nested exceptions are beyond doctest's capabilities.)",
    "created_at": "2021-01-22T07:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619375",
    "user": "https://github.com/guenterrote"
}
```

<a id='comment:5'></a>
This proposed "fix" is just an update to the documentation. I think it is important to warn users that finitely generated groups might not work as expected in some cases.

(I could not get the doctest with the failed multiplication table to run. Apparently two nested exceptions are beyond doctest's capabilities.)



---

archive/issue_comments_619376.json:
```json
{
    "body": "<a id='comment:6'></a>\nI think it would be better to have a more comprehensive solution. In particular, I think the `multiplication_table()` method should belong to the category of finite magmas. Another thing to consider is a specific implementation for finitely presented groups as it would need to construct the confluent rewriting system and do the reductions upon every multiplication (preferably on the GAP side).\n\nAlso, you should fill in your (real) name as the author.",
    "created_at": "2021-01-25T04:00:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619376",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>
I think it would be better to have a more comprehensive solution. In particular, I think the `multiplication_table()` method should belong to the category of finite magmas. Another thing to consider is a specific implementation for finitely presented groups as it would need to construct the confluent rewriting system and do the reductions upon every multiplication (preferably on the GAP side).

Also, you should fill in your (real) name as the author.



---

archive/issue_comments_619377.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2021-01-25T04:00:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619377",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_619378.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [tscrim](#comment%3A6):\n> I think it would be better to have a more comprehensive solution. In particular, I think the `multiplication_table()` method should belong to the category of finite magmas. Another thing to consider is a specific implementation for finitely presented groups as it would need to construct the confluent rewriting system and do the reductions upon every multiplication (preferably on the GAP side).\n\n\nAs far as I see the `multiplication_table()` method DOES belong to the category of magmas.\n\nOn the other hand, the issue with putting group elements into sets is a trap into which\nunsuspecting users may easily fall, and thus I find it appropriate to issue a warning,\nregardless of how the multiplication_table issue is eventually resolved.\n(However, from what I saw from glancing through the sage documentation, \"wrong\" hashcodes\nseems to be a fundamental issue of sage. But I did not see anywhere a warning that\nsets would not work as expected.)\n\n\n> Also, you should fill in your (real) name as the author.\n\n\nI am not sure I understand. Where should I write my real name?\nDoes a small clarification of the documentation qualify me to\nadd my name to the author list of the package.",
    "created_at": "2021-01-25T08:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619378",
    "user": "https://github.com/guenterrote"
}
```

<a id='comment:7'></a>
Replying to [tscrim](#comment%3A6):
> I think it would be better to have a more comprehensive solution. In particular, I think the `multiplication_table()` method should belong to the category of finite magmas. Another thing to consider is a specific implementation for finitely presented groups as it would need to construct the confluent rewriting system and do the reductions upon every multiplication (preferably on the GAP side).


As far as I see the `multiplication_table()` method DOES belong to the category of magmas.

On the other hand, the issue with putting group elements into sets is a trap into which
unsuspecting users may easily fall, and thus I find it appropriate to issue a warning,
regardless of how the multiplication_table issue is eventually resolved.
(However, from what I saw from glancing through the sage documentation, "wrong" hashcodes
seems to be a fundamental issue of sage. But I did not see anywhere a warning that
sets would not work as expected.)


> Also, you should fill in your (real) name as the author.


I am not sure I understand. Where should I write my real name?
Does a small clarification of the documentation qualify me to
add my name to the author list of the package.



---

archive/issue_comments_619379.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [guenterrote](#comment%3A7):\n> Replying to [tscrim](#comment%3A6):\n> > I think it would be better to have a more comprehensive solution. In particular, I think the `multiplication_table()` method should belong to the category of finite magmas. Another thing to consider is a specific implementation for finitely presented groups as it would need to construct the confluent rewriting system and do the reductions upon every multiplication (preferably on the GAP side).\n\n> \n> As far as I see the `multiplication_table()` method DOES belong to the category of magmas.\n\n\nI disagree because it only makes computational sense for finite magmas. For general magmas, we have no idea if there is a solution to the word problem. Of course, mathematically, this would be defined, but in order to actual make any computation, you need a solution to the word problem.\n\n> On the other hand, the issue with putting group elements into sets is a trap into which\n> unsuspecting users may easily fall, and thus I find it appropriate to issue a warning,\n> regardless of how the multiplication_table issue is eventually resolved.\n> (However, from what I saw from glancing through the sage documentation, \"wrong\" hashcodes\n> seems to be a fundamental issue of sage. But I did not see anywhere a warning that\n> sets would not work as expected.)\n\n\nI don't understand. I am not sure if you are making a mathematical or implementation argument. The mathematical one doesn't make sense to me because it is a table, which means we have put some ordering on the magma's elements. For the implementation, again, we want an ordering, so it would be a `list` and doesn't use hashing.\n\n> > Also, you should fill in your (real) name as the author.\n\n> \n> I am not sure I understand. Where should I write my real name?\n> Does a small clarification of the documentation qualify me to\n> add my name to the author list of the package.\n\n\nNo, here on the ticket.",
    "created_at": "2021-01-26T02:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619379",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
Replying to [guenterrote](#comment%3A7):
> Replying to [tscrim](#comment%3A6):
> > I think it would be better to have a more comprehensive solution. In particular, I think the `multiplication_table()` method should belong to the category of finite magmas. Another thing to consider is a specific implementation for finitely presented groups as it would need to construct the confluent rewriting system and do the reductions upon every multiplication (preferably on the GAP side).

> 
> As far as I see the `multiplication_table()` method DOES belong to the category of magmas.


I disagree because it only makes computational sense for finite magmas. For general magmas, we have no idea if there is a solution to the word problem. Of course, mathematically, this would be defined, but in order to actual make any computation, you need a solution to the word problem.

> On the other hand, the issue with putting group elements into sets is a trap into which
> unsuspecting users may easily fall, and thus I find it appropriate to issue a warning,
> regardless of how the multiplication_table issue is eventually resolved.
> (However, from what I saw from glancing through the sage documentation, "wrong" hashcodes
> seems to be a fundamental issue of sage. But I did not see anywhere a warning that
> sets would not work as expected.)


I don't understand. I am not sure if you are making a mathematical or implementation argument. The mathematical one doesn't make sense to me because it is a table, which means we have put some ordering on the magma's elements. For the implementation, again, we want an ordering, so it would be a `list` and doesn't use hashing.

> > Also, you should fill in your (real) name as the author.

> 
> I am not sure I understand. Where should I write my real name?
> Does a small clarification of the documentation qualify me to
> add my name to the author list of the package.


No, here on the ticket.



---

archive/issue_comments_619380.json:
```json
{
    "body": "**Author:** G\u00fcnter Rote",
    "created_at": "2021-01-26T09:44:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619380",
    "user": "https://github.com/guenterrote"
}
```

**Author:** Günter Rote



---

archive/issue_comments_619381.json:
```json
{
    "body": "**Changing commit** from \"[7aa86978206307b19342ad45b534ea1fd32b42d9](https://github.com/sagemath/sagetrac-mirror/commit/7aa86978206307b19342ad45b534ea1fd32b42d9)\" to \"[bde9ea3cfff6c1b2d642b129f0e79630ba1bf29d](https://github.com/sagemath/sagetrac-mirror/commit/bde9ea3cfff6c1b2d642b129f0e79630ba1bf29d)\".",
    "created_at": "2021-01-29T11:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619381",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7aa86978206307b19342ad45b534ea1fd32b42d9](https://github.com/sagemath/sagetrac-mirror/commit/7aa86978206307b19342ad45b534ea1fd32b42d9)" to "[bde9ea3cfff6c1b2d642b129f0e79630ba1bf29d](https://github.com/sagemath/sagetrac-mirror/commit/bde9ea3cfff6c1b2d642b129f0e79630ba1bf29d)".



---

archive/issue_comments_619382.json:
```json
{
    "body": "<a id='comment:10'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bde9ea3cfff6c1b2d642b129f0e79630ba1bf29d\">bde9ea3</a></td><td><code>put warnings up front in the documentation, slight changes</code></td></tr></table>\n",
    "created_at": "2021-01-29T11:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619382",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bde9ea3cfff6c1b2d642b129f0e79630ba1bf29d">bde9ea3</a></td><td><code>put warnings up front in the documentation, slight changes</code></td></tr></table>




---

archive/issue_comments_619383.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [tscrim](#comment%3A8):\n> Replying to [guenterrote](#comment%3A7):\n> > On the other hand, the issue with putting group elements into sets is a trap into which\n> > unsuspecting users may easily fall, and thus I find it appropriate to issue a warning,\n> > regardless of how the multiplication_table issue is eventually resolved.\n> > (However, from what I saw from glancing through the sage documentation, \"wrong\" hashcodes\n> > seems to be a fundamental issue of sage. But I did not see anywhere a warning that\n> > sets would not work as expected.)\n\n> \n> I don't understand. I am not sure if you are making a mathematical or implementation argument. The mathematical one doesn't make sense to me because it is a table, which means we have put some ordering on the magma's elements. For the implementation, again, we want an ordering, so it would be a `list` and doesn't use hashing.\n\n\nI had updated the documentation to be in line with the current state of the software.\nYou apparently did not notice that, on that occasion, I also adressed an issue with use of finitely generated group elements as set elements and dictionary keys:\n\n```\nThe following example shows that two different representations of the\nsame element can result in two distinct elements of a \"set\"::\n\n    sage: F.<r,s,t> = FreeGroup()\n    sage: G = F / (r^2, s^3, t^3, r*s*t) # the tetrahedral group\n    sage: G.order()\n    12\n    sage: a,b = G(r*s),G(~t) # ~t is an alternative notation for t^-1\n    sage: set_of_2 = {a,b}\n    sage: print(set_of_2, len(set_of_2)) # two-element set\n    {r*s, t^-1} 2\n    sage: a==b # a and b are the same element!\n    True\n```\nI also added the workaround via permutation groups.\n\nShould I open a different ticket for updating the documention? I am afraid fixing the multiplication_table as part of a comprehensive solution will require some fundamental design decisions and will not be done soon.",
    "created_at": "2021-01-29T11:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619383",
    "user": "https://github.com/guenterrote"
}
```

<a id='comment:11'></a>
Replying to [tscrim](#comment%3A8):
> Replying to [guenterrote](#comment%3A7):
> > On the other hand, the issue with putting group elements into sets is a trap into which
> > unsuspecting users may easily fall, and thus I find it appropriate to issue a warning,
> > regardless of how the multiplication_table issue is eventually resolved.
> > (However, from what I saw from glancing through the sage documentation, "wrong" hashcodes
> > seems to be a fundamental issue of sage. But I did not see anywhere a warning that
> > sets would not work as expected.)

> 
> I don't understand. I am not sure if you are making a mathematical or implementation argument. The mathematical one doesn't make sense to me because it is a table, which means we have put some ordering on the magma's elements. For the implementation, again, we want an ordering, so it would be a `list` and doesn't use hashing.


I had updated the documentation to be in line with the current state of the software.
You apparently did not notice that, on that occasion, I also adressed an issue with use of finitely generated group elements as set elements and dictionary keys:

```
The following example shows that two different representations of the
same element can result in two distinct elements of a "set"::

    sage: F.<r,s,t> = FreeGroup()
    sage: G = F / (r^2, s^3, t^3, r*s*t) # the tetrahedral group
    sage: G.order()
    12
    sage: a,b = G(r*s),G(~t) # ~t is an alternative notation for t^-1
    sage: set_of_2 = {a,b}
    sage: print(set_of_2, len(set_of_2)) # two-element set
    {r*s, t^-1} 2
    sage: a==b # a and b are the same element!
    True
```
I also added the workaround via permutation groups.

Should I open a different ticket for updating the documention? I am afraid fixing the multiplication_table as part of a comprehensive solution will require some fundamental design decisions and will not be done soon.



---

archive/issue_comments_619384.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [guenterrote](#comment%3A11):\n> Replying to [tscrim](#comment%3A8):\n> > Replying to [guenterrote](#comment%3A7):\n> > > On the other hand, the issue with putting group elements into sets is a trap into which\n> > > unsuspecting users may easily fall, and thus I find it appropriate to issue a warning,\n> > > regardless of how the multiplication_table issue is eventually resolved.\n> > > (However, from what I saw from glancing through the sage documentation, \"wrong\" hashcodes\n> > > seems to be a fundamental issue of sage. But I did not see anywhere a warning that\n> > > sets would not work as expected.)\n\n> > \n> > I don't understand. I am not sure if you are making a mathematical or implementation argument. The mathematical one doesn't make sense to me because it is a table, which means we have put some ordering on the magma's elements. For the implementation, again, we want an ordering, so it would be a `list` and doesn't use hashing.\n\n> \n> I had updated the documentation to be in line with the current state of the software.\n> You apparently did not notice that, on that occasion, I also adressed an issue with use of finitely generated group elements as set elements and dictionary keys:\n\n\nNo, I saw it. You're asking for a solution to a provably unsolvable problem. We know we cannot be perfect with hashes because of that since there is no canonical normal form for elements in a general finitely presented group.\n\nPlease actually respond to what I am saying because the issue here has *nothing* to do with hashing or constructing a `set`/`dict`. Again, a table is a **list** of elements.\n\n> I also added the workaround via permutation groups.\n\n>\n> Should I open a different ticket for updating the documention? I am afraid fixing the multiplication_table as part of a comprehensive solution will require some fundamental design decisions and will not be done soon.\n\n\nDocumenting a separate issue (which does deserve to be documented) does not solve the problem of this ticket. So that should be a separate ticket. Fixing the multiplication table for a finitely presented group is not hard if you use `list(G)` and `==` checking. Basically you just need to have `get_row = self._elts.index` in `sage.matrix.operation_table.OperationTable.__init__` for FPGs.",
    "created_at": "2021-01-30T08:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619384",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>
Replying to [guenterrote](#comment%3A11):
> Replying to [tscrim](#comment%3A8):
> > Replying to [guenterrote](#comment%3A7):
> > > On the other hand, the issue with putting group elements into sets is a trap into which
> > > unsuspecting users may easily fall, and thus I find it appropriate to issue a warning,
> > > regardless of how the multiplication_table issue is eventually resolved.
> > > (However, from what I saw from glancing through the sage documentation, "wrong" hashcodes
> > > seems to be a fundamental issue of sage. But I did not see anywhere a warning that
> > > sets would not work as expected.)

> > 
> > I don't understand. I am not sure if you are making a mathematical or implementation argument. The mathematical one doesn't make sense to me because it is a table, which means we have put some ordering on the magma's elements. For the implementation, again, we want an ordering, so it would be a `list` and doesn't use hashing.

> 
> I had updated the documentation to be in line with the current state of the software.
> You apparently did not notice that, on that occasion, I also adressed an issue with use of finitely generated group elements as set elements and dictionary keys:


No, I saw it. You're asking for a solution to a provably unsolvable problem. We know we cannot be perfect with hashes because of that since there is no canonical normal form for elements in a general finitely presented group.

Please actually respond to what I am saying because the issue here has *nothing* to do with hashing or constructing a `set`/`dict`. Again, a table is a **list** of elements.

> I also added the workaround via permutation groups.

>
> Should I open a different ticket for updating the documention? I am afraid fixing the multiplication_table as part of a comprehensive solution will require some fundamental design decisions and will not be done soon.


Documenting a separate issue (which does deserve to be documented) does not solve the problem of this ticket. So that should be a separate ticket. Fixing the multiplication table for a finitely presented group is not hard if you use `list(G)` and `==` checking. Basically you just need to have `get_row = self._elts.index` in `sage.matrix.operation_table.OperationTable.__init__` for FPGs.



---

archive/issue_comments_619385.json:
```json
{
    "body": "<a id='comment:13'></a>\n>You're asking for a solution to a provably unsolvable problem.\n\n\nOK, but this is not specific to the multiplication table.\nNearly ALL methods for finitely generated groups are not guaranteed to finish. There is already a warning about this in the documentation.\nBut sometimes they DO finish. (e.g. the order() method in my example).\nI think if sage (or GAP) is able to figure out the order or the group and the order is reasonably small, it is not\nunreasonable to expect that it should be possible to construct a multiplication table.\n\nI am unsure whether the error in multiplication_table has \"nothing to do with hashing or constructing a set/dict.\" The `KeyError` seems to indicate that a dict might be involved. Using `==` might slow down things, but probably acceptable for those cases\nwhere one would want a multiplication table.\n\nI guess this type of conversion and  `==` checking is already done anyway when converting to a permutation group, so it would be the easiest solution to piggyback on the multiplication table for permutation groups.\n\nAnyway, I have opened a new ticket, #31311. (have to figure out how to associate the git branch with a new ticket)\n\nAre there any issues to which I should still respond?",
    "created_at": "2021-01-31T10:36:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619385",
    "user": "https://github.com/guenterrote"
}
```

<a id='comment:13'></a>
>You're asking for a solution to a provably unsolvable problem.


OK, but this is not specific to the multiplication table.
Nearly ALL methods for finitely generated groups are not guaranteed to finish. There is already a warning about this in the documentation.
But sometimes they DO finish. (e.g. the order() method in my example).
I think if sage (or GAP) is able to figure out the order or the group and the order is reasonably small, it is not
unreasonable to expect that it should be possible to construct a multiplication table.

I am unsure whether the error in multiplication_table has "nothing to do with hashing or constructing a set/dict." The `KeyError` seems to indicate that a dict might be involved. Using `==` might slow down things, but probably acceptable for those cases
where one would want a multiplication table.

I guess this type of conversion and  `==` checking is already done anyway when converting to a permutation group, so it would be the easiest solution to piggyback on the multiplication table for permutation groups.

Anyway, I have opened a new ticket, #31311. (have to figure out how to associate the git branch with a new ticket)

Are there any issues to which I should still respond?



---

archive/issue_comments_619386.json:
```json
{
    "body": "**Changing commit** from \"[bde9ea3cfff6c1b2d642b129f0e79630ba1bf29d](https://github.com/sagemath/sagetrac-mirror/commit/bde9ea3cfff6c1b2d642b129f0e79630ba1bf29d)\" to \"[65938052495bc436be6fe53691fd207917142a0b](https://github.com/sagemath/sagetrac-mirror/commit/65938052495bc436be6fe53691fd207917142a0b)\".",
    "created_at": "2021-02-01T01:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619386",
    "user": "https://github.com/tscrim"
}
```

**Changing commit** from "[bde9ea3cfff6c1b2d642b129f0e79630ba1bf29d](https://github.com/sagemath/sagetrac-mirror/commit/bde9ea3cfff6c1b2d642b129f0e79630ba1bf29d)" to "[65938052495bc436be6fe53691fd207917142a0b](https://github.com/sagemath/sagetrac-mirror/commit/65938052495bc436be6fe53691fd207917142a0b)".



---

archive/issue_comments_619387.json:
```json
{
    "body": "**Changing author** from \"G\u00fcnter Rote\" to \"Travis Scrimshaw\".",
    "created_at": "2021-02-01T01:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619387",
    "user": "https://github.com/tscrim"
}
```

**Changing author** from "Günter Rote" to "Travis Scrimshaw".



---

archive/issue_comments_619388.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [guenterrote](#comment%3A13):\n> I am unsure whether the error in multiplication_table has \"nothing to do with hashing or constructing a set/dict.\" The `KeyError` seems to indicate that a dict might be involved. Using `==` might slow down things, but probably acceptable for those cases\n> where one would want a multiplication table.\n\n\nThis is an implementation detail for optimization that is coming back to bite us in this special case. Here is a proposal for fixing the multiplication table to use the list as a fallback.\n\n> I guess this type of conversion and  `==` checking is already done anyway when converting to a permutation group, so it would be the easiest solution to piggyback on the multiplication table for permutation groups.\n\n\nThere would be a disassociation of the FPG with the multiplication table as it wouldn't be able to hold on to that information in a natural way.\n\n> Anyway, I have opened a new ticket, #31311. (have to figure out how to associate the git branch with a new ticket)\n\n\nYou just need to put the branch name in the ticket's branch field (if you aren't using the git trac commands).\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65938052495bc436be6fe53691fd207917142a0b\">6593805</a></td><td><code>Use the list of elements index() as a fallback in operation_table.py.</code></td></tr></table>\n",
    "created_at": "2021-02-01T01:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619388",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>
Replying to [guenterrote](#comment%3A13):
> I am unsure whether the error in multiplication_table has "nothing to do with hashing or constructing a set/dict." The `KeyError` seems to indicate that a dict might be involved. Using `==` might slow down things, but probably acceptable for those cases
> where one would want a multiplication table.


This is an implementation detail for optimization that is coming back to bite us in this special case. Here is a proposal for fixing the multiplication table to use the list as a fallback.

> I guess this type of conversion and  `==` checking is already done anyway when converting to a permutation group, so it would be the easiest solution to piggyback on the multiplication table for permutation groups.


There would be a disassociation of the FPG with the multiplication table as it wouldn't be able to hold on to that information in a natural way.

> Anyway, I have opened a new ticket, #31311. (have to figure out how to associate the git branch with a new ticket)


You just need to put the branch name in the ticket's branch field (if you aren't using the git trac commands).

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65938052495bc436be6fe53691fd207917142a0b">6593805</a></td><td><code>Use the list of elements index() as a fallback in operation_table.py.</code></td></tr></table>




---

archive/issue_comments_619389.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-02-01T01:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619389",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_619390.json:
```json
{
    "body": "**Changing branch** from \"[u/guenterrote/multiplication_table_does_not_work_for_certain_types_of_groups_](https://github.com/sagemath/sagetrac-mirror/tree/u/guenterrote/multiplication_table_does_not_work_for_certain_types_of_groups_)\" to \"[public/groups/mult_table_fpg-31203](https://github.com/sagemath/sagetrac-mirror/tree/public/groups/mult_table_fpg-31203)\".",
    "created_at": "2021-02-01T01:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619390",
    "user": "https://github.com/tscrim"
}
```

**Changing branch** from "[u/guenterrote/multiplication_table_does_not_work_for_certain_types_of_groups_](https://github.com/sagemath/sagetrac-mirror/tree/u/guenterrote/multiplication_table_does_not_work_for_certain_types_of_groups_)" to "[public/groups/mult_table_fpg-31203](https://github.com/sagemath/sagetrac-mirror/tree/public/groups/mult_table_fpg-31203)".



---

archive/issue_comments_619391.json:
```json
{
    "body": "<a id='comment:15'></a>\nFor large groups, this is quite slow when compared to the detour via perm-groups.\n\n```\nsage: F4.<r,s,t,z> = FreeGroup() \nsage: G120 = F4 / (r^2*z, s^3*z, t^5*z, r*s*t*z) # the binary icosahedral group                                                                                                                  \nsage: time G120p = G120.as_permutation_group()                                                                                                                                                         \nCPU times: user 5.94 ms, sys: 74 \u00b5s, total: 6.01 ms\nWall time: 5.8 ms\nsage: time m2 = G120p.multiplication_table()                                                                                                                                                           \nCPU times: user 32.6 ms, sys: 3.87 ms, total: 36.4 ms\nWall time: 35.2 ms\nsage: time m1 = G120.multiplication_table()                                                                                                                                                            \nCPU times: user 32.5 s, sys: 4.13 ms, total: 32.5 s\nWall time: 32.5 s\nsage: G120.order()                                                                                                                                                                                     \n120\nsage: [G120(x) for x in m2.row_keys()][:10]                                                                                                                                                            \n[1, r, r^-1, s, s^-1, t, t^-1, z^-1, r*s, r*s^-1]\n```\n\nBut I am not sure whether anyone might ever want to look at such large multiplication tables. So I guess it is tolerable.",
    "created_at": "2021-02-08T12:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619391",
    "user": "https://github.com/guenterrote"
}
```

<a id='comment:15'></a>
For large groups, this is quite slow when compared to the detour via perm-groups.

```
sage: F4.<r,s,t,z> = FreeGroup() 
sage: G120 = F4 / (r^2*z, s^3*z, t^5*z, r*s*t*z) # the binary icosahedral group                                                                                                                  
sage: time G120p = G120.as_permutation_group()                                                                                                                                                         
CPU times: user 5.94 ms, sys: 74 µs, total: 6.01 ms
Wall time: 5.8 ms
sage: time m2 = G120p.multiplication_table()                                                                                                                                                           
CPU times: user 32.6 ms, sys: 3.87 ms, total: 36.4 ms
Wall time: 35.2 ms
sage: time m1 = G120.multiplication_table()                                                                                                                                                            
CPU times: user 32.5 s, sys: 4.13 ms, total: 32.5 s
Wall time: 32.5 s
sage: G120.order()                                                                                                                                                                                     
120
sage: [G120(x) for x in m2.row_keys()][:10]                                                                                                                                                            
[1, r, r^-1, s, s^-1, t, t^-1, z^-1, r*s, r*s^-1]
```

But I am not sure whether anyone might ever want to look at such large multiplication tables. So I guess it is tolerable.



---

archive/issue_comments_619392.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [guenterrote](#comment%3A15):\n> For large groups, this is quite slow when compared to the detour via perm-groups.\n\n\nWe loose the association with the elements of the FPG by going to another group. This defeats the purpose of the code. If someone wants to use a perm group, then they can (and should IMO) just convert it themselves.\n\n> But I am not sure whether anyone might ever want to look at such large multiplication tables. So I guess it is tolerable.\n\n\nThen does that constitute a review? The patchbot is green. If so, then you can put your name as the reviewer and set it to a positive review.",
    "created_at": "2021-02-08T23:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619392",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>
Replying to [guenterrote](#comment%3A15):
> For large groups, this is quite slow when compared to the detour via perm-groups.


We loose the association with the elements of the FPG by going to another group. This defeats the purpose of the code. If someone wants to use a perm group, then they can (and should IMO) just convert it themselves.

> But I am not sure whether anyone might ever want to look at such large multiplication tables. So I guess it is tolerable.


Then does that constitute a review? The patchbot is green. If so, then you can put your name as the reviewer and set it to a positive review.



---

archive/issue_comments_619393.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-02-10T18:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619393",
    "user": "https://github.com/guenterrote"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_619394.json:
```json
{
    "body": "**Reviewer:** G\u00fcnter Rote",
    "created_at": "2021-02-10T20:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619394",
    "user": "https://github.com/mkoeppe"
}
```

**Reviewer:** Günter Rote



---

archive/issue_events_091847.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "rename": {
        "from": "multiplication_table does not work for certain types of groups.",
        "to": "multiplication_table does not work for certain types of groups"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31203#event-91847"
}
```



---

archive/issue_comments_619395.json:
```json
{
    "body": "<a id='comment:19'></a>\nThank you!",
    "created_at": "2021-02-10T22:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619395",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>
Thank you!



---

archive/issue_events_091848.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-09T00:00:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31203#event-91848"
}
```



---

archive/issue_comments_619396.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2021-03-09T00:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619396",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_comments_619397.json:
```json
{
    "body": "**Changing branch** from \"[public/groups/mult_table_fpg-31203](https://github.com/sagemath/sagetrac-mirror/tree/public/groups/mult_table_fpg-31203)\" to \"[65938052495bc436be6fe53691fd207917142a0b](https://github.com/sagemath/sagetrac-mirror/commit/65938052495bc436be6fe53691fd207917142a0b)\".",
    "created_at": "2021-03-09T00:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31203#issuecomment-619397",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/groups/mult_table_fpg-31203](https://github.com/sagemath/sagetrac-mirror/tree/public/groups/mult_table_fpg-31203)" to "[65938052495bc436be6fe53691fd207917142a0b](https://github.com/sagemath/sagetrac-mirror/commit/65938052495bc436be6fe53691fd207917142a0b)".
