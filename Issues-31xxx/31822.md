# Issue 31822: Check containment for combinatorial faces

archive/issues_031585.json:
```json
{
    "body": "We add a method `is_subface` to combinatorial faces.\n\nCC:  @jplab @mkoeppe @yuan-zhou\n\nKeywords: combinatorial polyhedron, subface\n\nReviewer: Yuan Zhou, Matthias Koeppe\n\nAuthor: Jonathan Kliem\n\nBranch: ac5c32764b3b9283fc5b7635fac631fea7bb6840\n\nDependencies: #31819\n\nCommit: ac5c32764b3b9283fc5b7635fac631fea7bb6840\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31822\n\n",
    "closed_at": "2021-07-01T20:44:58Z",
    "created_at": "2021-05-12T14:05:37Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Check containment for combinatorial faces",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31822",
    "user": "https://github.com/kliem"
}
```
We add a method `is_subface` to combinatorial faces.

CC:  @jplab @mkoeppe @yuan-zhou

Keywords: combinatorial polyhedron, subface

Reviewer: Yuan Zhou, Matthias Koeppe

Author: Jonathan Kliem

Branch: ac5c32764b3b9283fc5b7635fac631fea7bb6840

Dependencies: #31819

Commit: ac5c32764b3b9283fc5b7635fac631fea7bb6840

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31822





---

archive/issue_comments_450759.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-05-12T14:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450759",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_450760.json:
```json
{
    "body": "<a id='comment:3'></a>It works fine in the intended case.\n\nHowever, it should raise an error, when `self` and `other` or not from the same `CombinatorialPolyhedron` (`NotImplementedError`?) and it should consider the case that `self` is from a dual face iterator and `other isn't.",
    "created_at": "2021-05-13T05:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450760",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>It works fine in the intended case.

However, it should raise an error, when `self` and `other` or not from the same `CombinatorialPolyhedron` (`NotImplementedError`?) and it should consider the case that `self` is from a dual face iterator and `other isn't.



---

archive/issue_comments_450761.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-05-13T05:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450761",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_450762.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-13T07:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450762",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_450763.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-05-13T07:20:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450763",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_450764.json:
```json
{
    "body": "<a id='comment:6'></a>The pyflakes plugin complains that `facet` is not defined in this line:\n\n```\n            if isinstance(v, PolyhedronFace) and facet.dim() == 0:\n```\nDid you mean `v.dim()`?",
    "created_at": "2021-05-13T17:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450764",
    "user": "https://github.com/slel"
}
```

<a id='comment:6'></a>The pyflakes plugin complains that `facet` is not defined in this line:

```
            if isinstance(v, PolyhedronFace) and facet.dim() == 0:
```
Did you mean `v.dim()`?



---

archive/issue_comments_450765.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-05-13T17:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450765",
    "user": "https://github.com/slel"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_450766.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-13T18:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450766",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_450767.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-05-13T18:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450767",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_450768.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-05-13T18:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450768",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_450769.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:6 slelievre]:\n> The pyflakes plugin complains that `facet` is not defined in this line:\n> \n> ```\n>             if isinstance(v, PolyhedronFace) and facet.dim() == 0:\n> ```\n> Did you mean `v.dim()`?\n\n\nFixed in #29683 and rebased.",
    "created_at": "2021-05-13T18:56:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450769",
    "user": "https://github.com/kliem"
}
```

<a id='comment:10'></a>Replying to [comment:6 slelievre]:
> The pyflakes plugin complains that `facet` is not defined in this line:
> 
> ```
>             if isinstance(v, PolyhedronFace) and facet.dim() == 0:
> ```
> Did you mean `v.dim()`?


Fixed in #29683 and rebased.



---

archive/issue_comments_450770.json:
```json
{
    "body": "<a id='comment:11'></a>Thanks.",
    "created_at": "2021-05-13T18:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450770",
    "user": "https://github.com/kliem"
}
```

<a id='comment:11'></a>Thanks.



---

archive/issue_comments_450771.json:
```json
{
    "body": "<a id='comment:12'></a>Nees rebase.",
    "created_at": "2021-05-20T07:23:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450771",
    "user": "https://github.com/kliem"
}
```

<a id='comment:12'></a>Nees rebase.



---

archive/issue_comments_450772.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-05-20T07:23:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450772",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_450773.json:
```json
{
    "body": "<a id='comment:13'></a>`is_subface` looks correct. However I don't understand why you distinguished two cases on whether`self._dual == other_face._dual`. It seems to me that the `ambient_V_indices` containment check always works. Is it because using `face_issubset` in the first case is faster? Then, how about using `only_subfaces`?\n\n```\nsage: P = polytopes.cube()\nsage: C = P.combinatorial_polyhedron()\n```\nis repeated in the doctest.",
    "created_at": "2021-05-22T11:51:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450773",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:13'></a>`is_subface` looks correct. However I don't understand why you distinguished two cases on whether`self._dual == other_face._dual`. It seems to me that the `ambient_V_indices` containment check always works. Is it because using `face_issubset` in the first case is faster? Then, how about using `only_subfaces`?

```
sage: P = polytopes.cube()
sage: C = P.combinatorial_polyhedron()
```
is repeated in the doctest.



---

archive/issue_comments_450774.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-22T11:59:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450774",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_450775.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:13 yzh]:\n> `is_subface` looks correct. However I don't understand why you distinguished two cases on whether`self._dual == other_face._dual`. It seems to me that the `ambient_V_indices` containment check always works. Is it because using `face_issubset` in the first case is faster? Then, how about using `only_subfaces`?\n\n\nUsing the face as a bitset is much much faster than creating a list. Well there would be a faster method for the second case by comparing directly the array instead of the list, but I don't think this case is very important anyway.\n\nHere is some speed comparison:\n\n```\nsage: P = polytopes.hypercube(14, backend='field')                                                                                                                                  \nsage: C = CombinatorialPolyhedron(P)                                                                                                                                                \nsage: it = C.face_iter(dual=False)                                                                                                                                                  \nsage: f = next(it)                                                                                                                                                                  \nsage: it.only_subfaces()                                                                                                                                                            \nsage: f2 = next(it)                                                                                                                                                                 \nsage: %timeit f2.is_subface(f)                                                                                                                                                      \n80.2 ns \u00b1 0.0408 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: %timeit f.is_subface(f2)                                                                                                                                                      \n50.1 ns \u00b1 0.0767 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: it2 = C.face_iter(dual=True)                                                                                                                                                  \nsage: f3 = next(it2)                                                                                                                                                                \nsage: %timeit f3.is_subface(f)                                                                                                                                                      \n781 \u00b5s \u00b1 444 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: %timeit f.is_subface(f3)                                                                                                                                                      \n708 \u00b5s \u00b1 239 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: while f3.dimension() < 12: \n....:     while not f3.is_subface(f): \n....:         f3 = next(it2) \n....:     it2.only_supfaces() \n....:     f3 = next(it2) \n....:                                                                                                                                                                               \nsage: f3.dimension()                                                                                                                                                                \n12\nsage: %timeit f3.is_subface(f)                                                                                                                                                      \n1.16 ms \u00b1 619 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: %timeit f.is_subface(f3)                                                                                                                                                      \n1.06 ms \u00b1 256 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n```\n\nEven the very difficult first case (`f2` is indeed a subface of `f`) only takes a few nano seconds to check all `2^14` bits. In comparison the other case is really slow (but it is also not optimized at all).\n\n> \n> \n> ```\n> sage: P = polytopes.cube()\n> sage: C = P.combinatorial_polyhedron()\n> ```\n> is repeated in the doctest.\n\n\nFixed.",
    "created_at": "2021-05-22T12:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450775",
    "user": "https://github.com/kliem"
}
```

<a id='comment:15'></a>Replying to [comment:13 yzh]:
> `is_subface` looks correct. However I don't understand why you distinguished two cases on whether`self._dual == other_face._dual`. It seems to me that the `ambient_V_indices` containment check always works. Is it because using `face_issubset` in the first case is faster? Then, how about using `only_subfaces`?


Using the face as a bitset is much much faster than creating a list. Well there would be a faster method for the second case by comparing directly the array instead of the list, but I don't think this case is very important anyway.

Here is some speed comparison:

```
sage: P = polytopes.hypercube(14, backend='field')                                                                                                                                  
sage: C = CombinatorialPolyhedron(P)                                                                                                                                                
sage: it = C.face_iter(dual=False)                                                                                                                                                  
sage: f = next(it)                                                                                                                                                                  
sage: it.only_subfaces()                                                                                                                                                            
sage: f2 = next(it)                                                                                                                                                                 
sage: %timeit f2.is_subface(f)                                                                                                                                                      
80.2 ns ± 0.0408 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: %timeit f.is_subface(f2)                                                                                                                                                      
50.1 ns ± 0.0767 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: it2 = C.face_iter(dual=True)                                                                                                                                                  
sage: f3 = next(it2)                                                                                                                                                                
sage: %timeit f3.is_subface(f)                                                                                                                                                      
781 µs ± 444 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: %timeit f.is_subface(f3)                                                                                                                                                      
708 µs ± 239 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: while f3.dimension() < 12: 
....:     while not f3.is_subface(f): 
....:         f3 = next(it2) 
....:     it2.only_supfaces() 
....:     f3 = next(it2) 
....:                                                                                                                                                                               
sage: f3.dimension()                                                                                                                                                                
12
sage: %timeit f3.is_subface(f)                                                                                                                                                      
1.16 ms ± 619 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: %timeit f.is_subface(f3)                                                                                                                                                      
1.06 ms ± 256 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
```

Even the very difficult first case (`f2` is indeed a subface of `f`) only takes a few nano seconds to check all `2^14` bits. In comparison the other case is really slow (but it is also not optimized at all).

> 
> 
> ```
> sage: P = polytopes.cube()
> sage: C = P.combinatorial_polyhedron()
> ```
> is repeated in the doctest.


Fixed.



---

archive/issue_comments_450776.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 gh-kliem]:\n> Replying to [comment:13 yzh]:\n> In comparison the other case is really slow (but it is also not optimized at all).\n\nIf speed is a concern, then I'd recommend to check `self.dimension() <= other.dimension()` at least.\n\nDoes a face know about the original combinatorial polyhedron `C`? Is `f2.is_subface(f1)`   through something like `C.face_iter().find_face(f1).only_subfaces().find_face(f2)` faster than comparing `ambient_V_indices()`?",
    "created_at": "2021-05-22T13:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450776",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:16'></a>Replying to [comment:15 gh-kliem]:
> Replying to [comment:13 yzh]:
> In comparison the other case is really slow (but it is also not optimized at all).

If speed is a concern, then I'd recommend to check `self.dimension() <= other.dimension()` at least.

Does a face know about the original combinatorial polyhedron `C`? Is `f2.is_subface(f1)`   through something like `C.face_iter().find_face(f1).only_subfaces().find_face(f2)` faster than comparing `ambient_V_indices()`?



---

archive/issue_comments_450777.json:
```json
{
    "body": "<a id='comment:17'></a>If `f1` and `f2` are in the same mode, then the current check is fast enough I think.\n\nThe other case is not really intended and I just have something that will work. However, if you want, I can do something more efficient. `find_face` is definitely not the best way of doing it, because it does way to much work. After all, I just have to get the coatom representation of `f1` and compare it with the atom representation of `f2` (the atoms of `f1` are the coatoms of `f2`).",
    "created_at": "2021-05-22T13:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450777",
    "user": "https://github.com/kliem"
}
```

<a id='comment:17'></a>If `f1` and `f2` are in the same mode, then the current check is fast enough I think.

The other case is not really intended and I just have something that will work. However, if you want, I can do something more efficient. `find_face` is definitely not the best way of doing it, because it does way to much work. After all, I just have to get the coatom representation of `f1` and compare it with the atom representation of `f2` (the atoms of `f1` are the coatoms of `f2`).



---

archive/issue_comments_450778.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 gh-kliem]:\n> After all, I just have to get the coatom representation of `f1` and compare it with the atom representation of `f2` (the atoms of `f1` are the coatoms of `f2`).\n\nIf it's not too complicated to implement, this sounds like a great solution! I don't have a direct use case of \"f1 and f2 not in the same mode\", so I feel good about the ticket even if you won't implement the additional speed-up. However, I'd like to include the `self.dimension() <= other.dimension()` check, as mentioned above.",
    "created_at": "2021-05-23T10:24:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450778",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:18'></a>Replying to [comment:17 gh-kliem]:
> After all, I just have to get the coatom representation of `f1` and compare it with the atom representation of `f2` (the atoms of `f1` are the coatoms of `f2`).

If it's not too complicated to implement, this sounds like a great solution! I don't have a direct use case of "f1 and f2 not in the same mode", so I feel good about the ticket even if you won't implement the additional speed-up. However, I'd like to include the `self.dimension() <= other.dimension()` check, as mentioned above.



---

archive/issue_comments_450779.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-23T19:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450779",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_450780.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:18 yzh]:\n> Replying to [comment:17 gh-kliem]:\n> > After all, I just have to get the coatom representation of `f1` and compare it with the atom representation of `f2` (the atoms of `f1` are the coatoms of `f2`).\n\n> If it's not too complicated to implement, this sounds like a great solution! I don't have a direct use case of \"f1 and f2 not in the same mode\", so I feel good about the ticket even if you won't implement the additional speed-up. However, I'd like to include the `self.dimension() <= other.dimension()` check, as mentioned above. \n\nThe check `self.dimension() <= other.dimension()` is no improvement either way, when `self` and `other` are in same mode.\n\nHere are the new timings:\n\n```\nsage: P = polytopes.hypercube(14, backend='field')                                                                                                                                  \nsage: C = CombinatorialPolyhedron(P)                                                                                                                                                \nsage: it = C.face_iter(dual=False)                                                                                                                                                  \nsage: f = next(it)                                                                                                                                                                  \nsage: it.only_subfaces()                                                                                                                                                            \nsage: f2 = next(it)                                                                                                                                                                 \nsage: %timeit f.is_subface(f2)                                                                                                                                                      \n42.2 ns \u00b1 0.0401 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: %timeit f2.is_subface(f)                                                                                                                                                      \n72.4 ns \u00b1 0.0662 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: it2 = C.face_iter(dual=True)                                                                                                                                                  \nsage: f3 = next(it2)                                                                                                                                                                \nsage: %timeit f.is_subface(f3)                                                                                                                                                      \n56.8 ns \u00b1 0.0814 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: %timeit f3.is_subface(f)                                                                                                                                                      \n78.1 \u00b5s \u00b1 92.8 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\nsage: while True: \n....:     while not f3.is_subface(f): \n....:         f3 = next(it2) \n....:     it2.only_supfaces() \n....:     if f3.dimension() == 12: \n....:         break \n....:     f3 = next(it2) \n....:                                                                                                                                                                               \nsage: %timeit f.is_subface(f3)                                                                                                                                                      \n58.5 ns \u00b1 0.0699 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: %timeit f3.is_subface(f)                                                                                                                                                      \n78.3 \u00b5s \u00b1 46.5 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\nsage: f3.dimension()                                                                                                                                                                \n12\nsage: f.is_subface(f3)                                                                                                                                                              \nFalse\nsage: f3.is_subface(f)                                                                                                                                                              \nTrue\n```",
    "created_at": "2021-05-23T19:17:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450780",
    "user": "https://github.com/kliem"
}
```

<a id='comment:20'></a>Replying to [comment:18 yzh]:
> Replying to [comment:17 gh-kliem]:
> > After all, I just have to get the coatom representation of `f1` and compare it with the atom representation of `f2` (the atoms of `f1` are the coatoms of `f2`).

> If it's not too complicated to implement, this sounds like a great solution! I don't have a direct use case of "f1 and f2 not in the same mode", so I feel good about the ticket even if you won't implement the additional speed-up. However, I'd like to include the `self.dimension() <= other.dimension()` check, as mentioned above. 

The check `self.dimension() <= other.dimension()` is no improvement either way, when `self` and `other` are in same mode.

Here are the new timings:

```
sage: P = polytopes.hypercube(14, backend='field')                                                                                                                                  
sage: C = CombinatorialPolyhedron(P)                                                                                                                                                
sage: it = C.face_iter(dual=False)                                                                                                                                                  
sage: f = next(it)                                                                                                                                                                  
sage: it.only_subfaces()                                                                                                                                                            
sage: f2 = next(it)                                                                                                                                                                 
sage: %timeit f.is_subface(f2)                                                                                                                                                      
42.2 ns ± 0.0401 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: %timeit f2.is_subface(f)                                                                                                                                                      
72.4 ns ± 0.0662 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: it2 = C.face_iter(dual=True)                                                                                                                                                  
sage: f3 = next(it2)                                                                                                                                                                
sage: %timeit f.is_subface(f3)                                                                                                                                                      
56.8 ns ± 0.0814 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: %timeit f3.is_subface(f)                                                                                                                                                      
78.1 µs ± 92.8 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
sage: while True: 
....:     while not f3.is_subface(f): 
....:         f3 = next(it2) 
....:     it2.only_supfaces() 
....:     if f3.dimension() == 12: 
....:         break 
....:     f3 = next(it2) 
....:                                                                                                                                                                               
sage: %timeit f.is_subface(f3)                                                                                                                                                      
58.5 ns ± 0.0699 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: %timeit f3.is_subface(f)                                                                                                                                                      
78.3 µs ± 46.5 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
sage: f3.dimension()                                                                                                                                                                
12
sage: f.is_subface(f3)                                                                                                                                                              
False
sage: f3.is_subface(f)                                                                                                                                                              
True
```



---

archive/issue_comments_450781.json:
```json
{
    "body": "<a id='comment:21'></a>Btw, currently `face.coatom_rep` etc. is reinitialized. I expect things to be much faster on repeated calls, if I change the code to realize this.\n\nHowever, this might be the more honest timing, as it reflects more realistic the amount of time the first call needs.",
    "created_at": "2021-05-23T19:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450781",
    "user": "https://github.com/kliem"
}
```

<a id='comment:21'></a>Btw, currently `face.coatom_rep` etc. is reinitialized. I expect things to be much faster on repeated calls, if I change the code to realize this.

However, this might be the more honest timing, as it reflects more realistic the amount of time the first call needs.



---

archive/issue_comments_450782.json:
```json
{
    "body": "<a id='comment:22'></a>Caching `atom_rep` and `coatom_rep` (actually not cashing, but only remembering that it has already been computed), I get the following timings now:\n\n```\nsage: P = polytopes.hypercube(14, backend='field')                                                                                                                                  \nsage: C = CombinatorialPolyhedron(P)                                                                                                                                                \nsage: it = C.face_iter(dual=False)                                                                                                                                                  \nsage: f = next(it)                                                                                                                                                                   \nsage: it2 = C.face_iter(dual=True)                                                                                                                                                  \nsage: f3 = next(it2)                                                                                                                                                                \nsage: %timeit f.is_subface(f3)                                                                                                                                                      \n56.7 ns \u00b1 0.0563 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: %timeit f3.is_subface(f)                                                                                                                                                      \n7.12 \u00b5s \u00b1 68.1 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\nsage: while True: \n....:     while not f3.is_subface(f): \n....:         f3 = next(it2) \n....:     it2.only_supfaces() \n....:     if f3.dimension() == 12: \n....:         break \n....:     f3 = next(it2) \n....:                                                                                                                                                                               \nsage: %timeit f.is_subface(f3)                                                                                                                                                      \n58.1 ns \u00b1 0.0822 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: %timeit f3.is_subface(f)                                                                                                                                                      \n5.34 \u00b5s \u00b1 2.1 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\n```",
    "created_at": "2021-05-25T07:02:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450782",
    "user": "https://github.com/kliem"
}
```

<a id='comment:22'></a>Caching `atom_rep` and `coatom_rep` (actually not cashing, but only remembering that it has already been computed), I get the following timings now:

```
sage: P = polytopes.hypercube(14, backend='field')                                                                                                                                  
sage: C = CombinatorialPolyhedron(P)                                                                                                                                                
sage: it = C.face_iter(dual=False)                                                                                                                                                  
sage: f = next(it)                                                                                                                                                                   
sage: it2 = C.face_iter(dual=True)                                                                                                                                                  
sage: f3 = next(it2)                                                                                                                                                                
sage: %timeit f.is_subface(f3)                                                                                                                                                      
56.7 ns ± 0.0563 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: %timeit f3.is_subface(f)                                                                                                                                                      
7.12 µs ± 68.1 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
sage: while True: 
....:     while not f3.is_subface(f): 
....:         f3 = next(it2) 
....:     it2.only_supfaces() 
....:     if f3.dimension() == 12: 
....:         break 
....:     f3 = next(it2) 
....:                                                                                                                                                                               
sage: %timeit f.is_subface(f3)                                                                                                                                                      
58.1 ns ± 0.0822 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: %timeit f3.is_subface(f)                                                                                                                                                      
5.34 µs ± 2.1 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
```



---

archive/issue_comments_450783.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-25T07:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450783",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_450784.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-06-23T01:08:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450784",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_450785.json:
```json
{
    "body": "<a id='comment:25'></a>I am guessing that this ticket \"needs review\"\n\n---\nLast 10 new commits:",
    "created_at": "2021-06-23T01:08:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450785",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>I am guessing that this ticket "needs review"

---
Last 10 new commits:



---

archive/issue_comments_450786.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-23T01:24:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450786",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_450787.json:
```json
{
    "body": "<a id='comment:26'></a>I have not followed the discussion on timing, but the code looks fine to me, and passes tests.",
    "created_at": "2021-06-23T01:24:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450787",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>I have not followed the discussion on timing, but the code looks fine to me, and passes tests.



---

archive/issue_comments_450788.json:
```json
{
    "body": "<a id='comment:27'></a>Thank you.",
    "created_at": "2021-06-23T11:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450788",
    "user": "https://github.com/kliem"
}
```

<a id='comment:27'></a>Thank you.



---

archive/issue_events_084043.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-01T20:44:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31822#event-84043"
}
```



---

archive/issue_comments_450789.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-01T20:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31822#issuecomment-450789",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
