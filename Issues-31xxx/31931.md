# Issue 31931: _sympy_ methods for some parent classes

archive/issues_031694.json:
```json
{
    "body": "We add `_sympy_` methods to various parent classes, returning sympy `Integers`, `Reals`, `Complexes`, `ProductSet`.\n\nThese methods override the generic `_sympy_` method provided by #31938.\n\nPart of #31926 Meta-ticket: Connect Sage sets to sympy sets\n\n\nCC:  @tscrim @kcrisman @certik @videlec\n\nBranch/Commit: 32cdd5c1c8db52696499212f4b27d53579d48163\n\nReviewer: Karl-Dieter Crisman\n\nAuthor: Matthias Koeppe\n\nDependencies: #31938, #31877\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31931\n\n",
    "closed_at": "2021-06-29T23:08:27Z",
    "created_at": "2021-06-08T01:54:20Z",
    "labels": [
        "component: interfaces"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "_sympy_ methods for some parent classes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31931",
    "user": "https://github.com/mkoeppe"
}
```
We add `_sympy_` methods to various parent classes, returning sympy `Integers`, `Reals`, `Complexes`, `ProductSet`.

These methods override the generic `_sympy_` method provided by #31938.

Part of #31926 Meta-ticket: Connect Sage sets to sympy sets


CC:  @tscrim @kcrisman @certik @videlec

Branch/Commit: 32cdd5c1c8db52696499212f4b27d53579d48163

Reviewer: Karl-Dieter Crisman

Author: Matthias Koeppe

Dependencies: #31938, #31877

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31931





---

archive/issue_comments_483384.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-09T00:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483384",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_483385.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2021-06-09T00:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483385",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_483386.json:
```json
{
    "body": "<a id='comment:3'></a>Nice - if patchbot says yes this this seems to be good.  \n\nQuestion: Do these reimport into Sage as one might expect (does the diagram commute in either direction)?  If so, some tests for that might be appropriate.  Also, with the products, what happens if one of the parts doesn't have a Sympy version - presumably there is an error message, but is it a useful one?",
    "created_at": "2021-06-09T00:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483386",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:3'></a>Nice - if patchbot says yes this this seems to be good.  

Question: Do these reimport into Sage as one might expect (does the diagram commute in either direction)?  If so, some tests for that might be appropriate.  Also, with the products, what happens if one of the parts doesn't have a Sympy version - presumably there is an error message, but is it a useful one?



---

archive/issue_comments_483387.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 kcrisman]:\n> Do these reimport into Sage as one might expect (does the diagram commute in either direction)?\n\n\nNo, the other direction of conversion is not implemented yet, this would be part of #31935. The closest we have is `sage.interfaces.sympy.sympy_set_to_list`, which converts from various sympy set types to lists of Sage SR relation expressions.",
    "created_at": "2021-06-09T01:29:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483387",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>Replying to [comment:3 kcrisman]:
> Do these reimport into Sage as one might expect (does the diagram commute in either direction)?


No, the other direction of conversion is not implemented yet, this would be part of #31935. The closest we have is `sage.interfaces.sympy.sympy_set_to_list`, which converts from various sympy set types to lists of Sage SR relation expressions.



---

archive/issue_comments_483388.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:3 kcrisman]:\n> with the products, what happens if one of the parts doesn't have a Sympy version - presumably there is an error message, but is it a useful one?\n\n\nIt fails with an unpleasant error message because SymPy tries too hard to make sense of it. Example:\n\n```\nsage: F = FiniteEnumeratedSets().example()\nsage: cartesian_product([F, F])._sympy_()\nSymPyDeprecationWarning: \n\nString fallback in sympify has been deprecated since SymPy 1.6. Use\nsympify(str(obj)) or sympy.core.sympify.converter or obj._sympy_\ninstead. See https://github.com/sympy/sympy/issues/18066 for more\ninfo.\n\n  SymPyDeprecationWarning(.....)\n\nSyntaxError: invalid syntax (<string>, line 1)\n\nDuring handling of the above exception, another exception occurred:\n\nSympifyError: Sympify of expression 'could not parse 'An example of a finite enumerated set: {1,2,3}'' failed, because of exception being raised:\nSyntaxError: invalid syntax (<string>, line 1)\n```\n\n#31938 will provide all Sage sets with a `_sympy_` method.",
    "created_at": "2021-06-09T01:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483388",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>Replying to [comment:3 kcrisman]:
> with the products, what happens if one of the parts doesn't have a Sympy version - presumably there is an error message, but is it a useful one?


It fails with an unpleasant error message because SymPy tries too hard to make sense of it. Example:

```
sage: F = FiniteEnumeratedSets().example()
sage: cartesian_product([F, F])._sympy_()
SymPyDeprecationWarning: 

String fallback in sympify has been deprecated since SymPy 1.6. Use
sympify(str(obj)) or sympy.core.sympify.converter or obj._sympy_
instead. See https://github.com/sympy/sympy/issues/18066 for more
info.

  SymPyDeprecationWarning(.....)

SyntaxError: invalid syntax (<string>, line 1)

During handling of the above exception, another exception occurred:

SympifyError: Sympify of expression 'could not parse 'An example of a finite enumerated set: {1,2,3}'' failed, because of exception being raised:
SyntaxError: invalid syntax (<string>, line 1)
```

#31938 will provide all Sage sets with a `_sympy_` method.



---

archive/issue_comments_483389.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 mkoeppe]:\n> Replying to [comment:3 kcrisman]:\n> > with the products, what happens if one of the parts doesn't have a Sympy version - presumably there is an error message, but is it a useful one?\n\n> \n> It fails with an unpleasant error message because SymPy tries too hard to make sense of it. Example:\n\n\nI agree this isn't as helpful to the end user.  What I'd formally recommend as a review, until #31938 is merged, is to document this type of error as a doctest so it is at least searchable if someone comes across it.",
    "created_at": "2021-06-09T11:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483389",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:6'></a>Replying to [comment:5 mkoeppe]:
> Replying to [comment:3 kcrisman]:
> > with the products, what happens if one of the parts doesn't have a Sympy version - presumably there is an error message, but is it a useful one?

> 
> It fails with an unpleasant error message because SymPy tries too hard to make sense of it. Example:


I agree this isn't as helpful to the end user.  What I'd formally recommend as a review, until #31938 is merged, is to document this type of error as a doctest so it is at least searchable if someone comes across it.



---

archive/issue_comments_483390.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,9 @@\n We add `_sympy_` methods to various parent classes, returning sympy `Integers`, `Reals`, `Complexes`, `ProductSet`.\n \n+These methods override the generic `_sympy_` method provided by #31938.\n+\n Part of #31926 Meta-ticket: Connect Sage sets to sympy sets\n+\n \n Comment: 1\n \n``````\n",
    "created_at": "2021-06-09T20:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483390",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,9 @@
 We add `_sympy_` methods to various parent classes, returning sympy `Integers`, `Reals`, `Complexes`, `ProductSet`.
 
+These methods override the generic `_sympy_` method provided by #31938.
+
 Part of #31926 Meta-ticket: Connect Sage sets to sympy sets
+
 
 Comment: 1
 
``````




---

archive/issue_comments_483391.json:
```json
{
    "body": "<a id='comment:8'></a>Now, after merging #31938, this example works:\n\n```\nsage: F = FiniteEnumeratedSets().example()\nsage: cartesian_product([F, F])._sympy_()\nProductSet(SageSet(An example of a finite enumerated set: {1,2,3}), SageSet(An example of a finite enumerated set: {1,2,3}))\n```",
    "created_at": "2021-06-09T20:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483391",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Now, after merging #31938, this example works:

```
sage: F = FiniteEnumeratedSets().example()
sage: cartesian_product([F, F])._sympy_()
ProductSet(SageSet(An example of a finite enumerated set: {1,2,3}), SageSet(An example of a finite enumerated set: {1,2,3}))
```



---

archive/issue_comments_483392.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-10T00:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483392",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483393.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-10T00:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483393",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483394.json:
```json
{
    "body": "<a id='comment:11'></a>> Now, after merging #31938, this example works:\nNice.  I am not reviewing that one, but anyway that was my only comment on this one.",
    "created_at": "2021-06-10T00:54:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483394",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:11'></a>> Now, after merging #31938, this example works:
Nice.  I am not reviewing that one, but anyway that was my only comment on this one.



---

archive/issue_comments_483395.json:
```json
{
    "body": "<a id='comment:12'></a>`@`kcrisman Will you be reviewing this ticket? I have basically reviewed #31938; just waiting on patchbot approval.",
    "created_at": "2021-06-10T02:03:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483395",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>`@`kcrisman Will you be reviewing this ticket? I have basically reviewed #31938; just waiting on patchbot approval.



---

archive/issue_comments_483396.json:
```json
{
    "body": "<a id='comment:13'></a>> `@`kcrisman Will you be reviewing this ticket? I have basically reviewed #31938; just waiting on patchbot approval.\n\nI'm happy with this one given your review of that one, as long as patchbot is.  I am unable to manually test however, so your additional green light would be great.",
    "created_at": "2021-06-10T03:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483396",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:13'></a>> `@`kcrisman Will you be reviewing this ticket? I have basically reviewed #31938; just waiting on patchbot approval.

I'm happy with this one given your review of that one, as long as patchbot is.  I am unable to manually test however, so your additional green light would be great.



---

archive/issue_comments_483397.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-06-10T23:03:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483397",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_483398.json:
```json
{
    "body": "<a id='comment:14'></a>\n```\nsage -t --long --random-seed=0 src/sage/sets/real_set.py  # 7 doctests failed\n```\nbecause there is no `ambient()` method called via the `is_universe()` method.",
    "created_at": "2021-06-10T23:03:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483398",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>
```
sage -t --long --random-seed=0 src/sage/sets/real_set.py  # 7 doctests failed
```
because there is no `ambient()` method called via the `is_universe()` method.



---

archive/issue_comments_483399.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-11T00:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483399",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483400.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-06-11T00:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483400",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_483401.json:
```json
{
    "body": "<a id='comment:16'></a>Right, that method comes from #31877, which I have now merged",
    "created_at": "2021-06-11T00:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483401",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>Right, that method comes from #31877, which I have now merged



---

archive/issue_comments_483402.json:
```json
{
    "body": "<a id='comment:17'></a>Now to wait for the patchbot one more time.",
    "created_at": "2021-06-11T00:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483402",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'></a>Now to wait for the patchbot one more time.



---

archive/issue_comments_483403.json:
```json
{
    "body": "<a id='comment:18'></a>Patchbots seem stuck on #31928,\nsee ticket:31928#comment:1.",
    "created_at": "2021-06-11T08:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483403",
    "user": "https://github.com/slel"
}
```

<a id='comment:18'></a>Patchbots seem stuck on #31928,
see ticket:31928#comment:1.



---

archive/issue_comments_483404.json:
```json
{
    "body": "<a id='comment:19'></a>Setting to positive as per comment:13.",
    "created_at": "2021-06-12T08:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483404",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>Setting to positive as per comment:13.



---

archive/issue_comments_483405.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-12T08:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483405",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_483406.json:
```json
{
    "body": "<a id='comment:20'></a>Thanks!",
    "created_at": "2021-06-12T13:46:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483406",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>Thanks!



---

archive/issue_comments_483407.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-06-29T23:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31931#issuecomment-483407",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_084381.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-29T23:08:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31931",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31931#event-84381"
}
```
