# Issue 31106: refresh combinat.py

archive/issues_030869.json:
```json
{
    "body": "* full flake8\n* some typing annotation\n* using maxima_lib\n\n\nCC:  @tscrim @slel\n\nBranch/Commit: d02b2750a1ca3406fd632662e2a3ae71c6334375\n\nReviewer: David Coudert\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31106\n\n",
    "closed_at": "2020-12-27T23:25:26Z",
    "created_at": "2020-12-25T14:44:01Z",
    "labels": [
        "component: combinatorics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "refresh combinat.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31106",
    "user": "https://github.com/fchapoton"
}
```
* full flake8
* some typing annotation
* using maxima_lib


CC:  @tscrim @slel

Branch/Commit: d02b2750a1ca3406fd632662e2a3ae71c6334375

Reviewer: David Coudert

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31106





---

archive/issue_comments_617220.json:
```json
{
    "body": "Changing commit from \"\" to \"ba32878b2bdd8604c921d3eccbfe73886f9b809c\"",
    "created_at": "2020-12-25T14:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31106#issuecomment-617220",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "ba32878b2bdd8604c921d3eccbfe73886f9b809c"



---

archive/issue_comments_617221.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-12-25T14:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31106#issuecomment-617221",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_617222.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/31106\"",
    "created_at": "2020-12-25T14:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31106#issuecomment-617222",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/31106"



---

archive/issue_comments_617223.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------|\n|[ba32878](https://git.sagemath.org/sage.git/commit?id=ba32878b2bdd8604c921d3eccbfe73886f9b809c)|`refresh combinat.py`|",
    "created_at": "2020-12-25T14:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31106#issuecomment-617223",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                     |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------|
|[ba32878](https://git.sagemath.org/sage.git/commit?id=ba32878b2bdd8604c921d3eccbfe73886f9b809c)|`refresh combinat.py`|



---

archive/issue_comments_617224.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------|\n|[d02b275](https://git.sagemath.org/sage.git/commit/?id=d02b2750a1ca3406fd632662e2a3ae71c6334375)|`fix doctest`|",
    "created_at": "2020-12-25T18:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31106#issuecomment-617224",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------|
|[d02b275](https://git.sagemath.org/sage.git/commit/?id=d02b2750a1ca3406fd632662e2a3ae71c6334375)|`fix doctest`|



---

archive/issue_comments_617225.json:
```json
{
    "body": "Changing commit from \"ba32878b2bdd8604c921d3eccbfe73886f9b809c\" to \"d02b2750a1ca3406fd632662e2a3ae71c6334375\"",
    "created_at": "2020-12-25T18:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31106#issuecomment-617225",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ba32878b2bdd8604c921d3eccbfe73886f9b809c" to "d02b2750a1ca3406fd632662e2a3ae71c6334375"



---

archive/issue_comments_617226.json:
```json
{
    "body": "<a id='comment:3'></a>\ngreen bot, please review",
    "created_at": "2020-12-26T08:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31106#issuecomment-617226",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>
green bot, please review



---

archive/issue_comments_617227.json:
```json
{
    "body": "<a id='comment:4'></a>\na small possible correction\n\n```diff\n-        if (self.first != self.__first_from_iterator and\n-                self.next != self.__next_from_iterator):\n+        if (self.first != self.__first_from_iterator and\n+            self.next != self.__next_from_iterator):\n```\notherwise, LGTM.",
    "created_at": "2020-12-26T10:08:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31106#issuecomment-617227",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:4'></a>
a small possible correction

```diff
-        if (self.first != self.__first_from_iterator and
-                self.next != self.__next_from_iterator):
+        if (self.first != self.__first_from_iterator and
+            self.next != self.__next_from_iterator):
```
otherwise, LGTM.



---

archive/issue_comments_617228.json:
```json
{
    "body": "<a id='comment:5'></a>\nben, je crois que flake8 n'aime pas trop les trucs alignes avec la ligne d'apres..",
    "created_at": "2020-12-26T10:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31106#issuecomment-617228",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
ben, je crois que flake8 n'aime pas trop les trucs alignes avec la ligne d'apres..



---

archive/issue_comments_617229.json:
```json
{
    "body": "<a id='comment:6'></a>\nCa explique pourquoi emacs aligne par d\u00e9faut comme tu l'as fait.\n\nLGTM.",
    "created_at": "2020-12-26T10:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31106#issuecomment-617229",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:6'></a>
Ca explique pourquoi emacs aligne par défaut comme tu l'as fait.

LGTM.



---

archive/issue_comments_617230.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-12-26T10:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31106#issuecomment-617230",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_617231.json:
```json
{
    "body": "Changing reviewer from \"\" to \"David Coudert\"",
    "created_at": "2020-12-26T10:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31106#issuecomment-617231",
    "user": "https://github.com/dcoudert"
}
```

Changing reviewer from "" to "David Coudert"



---

archive/issue_comments_617232.json:
```json
{
    "body": "<a id='comment:7'></a>\nEn option, m\u00eame si ce n'est pas le propos principal du ticket,\ndans `bell_number` on pourrait changer `R(-1)` -> `(-R.one())`, comme\nc'est d\u00e9j\u00e0 fait dans `bernoulli_polynomial` pour `ZZ(1)` -> `ZZ.one()`.",
    "created_at": "2020-12-26T12:09:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31106#issuecomment-617232",
    "user": "https://github.com/slel"
}
```

<a id='comment:7'></a>
En option, même si ce n'est pas le propos principal du ticket,
dans `bell_number` on pourrait changer `R(-1)` -> `(-R.one())`, comme
c'est déjà fait dans `bernoulli_polynomial` pour `ZZ(1)` -> `ZZ.one()`.



---

archive/issue_comments_617233.json:
```json
{
    "body": "<a id='comment:8'></a>\nEt dans `euler_number` on pourrait changer\n\n```diff\n-        sage: 2/(exp(x)+exp(-x))\n+        sage: x.cosh().inverse()\n         1 - 1/2*x^2 + 5/24*x^4 - 61/720*x^6 + 277/8064*x^8 + O(x^10)\n```\npour gagner quelques microsecondes \u00e0 chaque doctest\n\n```\nsage: sage: x = PowerSeriesRing(QQ, 'x').gen().O(10)\nsage: timeit('2/(exp(x) + exp(-x))')\n625 loops, best of 3: 439 \u03bcs per loop\nsage: timeit('x.cosh().inverse()')\n625 loops, best of 3: 250 \u03bcs per loop\n```\nmais je n'insiste bien s\u00fbr pas.",
    "created_at": "2020-12-26T12:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31106#issuecomment-617233",
    "user": "https://github.com/slel"
}
```

<a id='comment:8'></a>
Et dans `euler_number` on pourrait changer

```diff
-        sage: 2/(exp(x)+exp(-x))
+        sage: x.cosh().inverse()
         1 - 1/2*x^2 + 5/24*x^4 - 61/720*x^6 + 277/8064*x^8 + O(x^10)
```
pour gagner quelques microsecondes à chaque doctest

```
sage: sage: x = PowerSeriesRing(QQ, 'x').gen().O(10)
sage: timeit('2/(exp(x) + exp(-x))')
625 loops, best of 3: 439 μs per loop
sage: timeit('x.cosh().inverse()')
625 loops, best of 3: 250 μs per loop
```
mais je n'insiste bien sûr pas.



---

archive/issue_comments_617234.json:
```json
{
    "body": "<a id='comment:9'></a>\nDans `bernoulli_polynomial` on pourrait clarifier ainsi:\n\n```diff\n-    coeffs = [0] * k + sum(([n.binomial(i) * bernoulli(n - i), 0]\n-                            for i in range(k, n + 1, 2)), [])\n-    coeffs[-3] = -n / 2\n+    coeffs = [0] * (n + 1)\n+    coeffs[k::2] = (n.binomial(i) * bernoulli(n - i)\n+                    for i in range(k, n + 1, 2))\n+    coeffs[-2] = -n / 2\n```",
    "created_at": "2020-12-26T17:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31106#issuecomment-617234",
    "user": "https://github.com/slel"
}
```

<a id='comment:9'></a>
Dans `bernoulli_polynomial` on pourrait clarifier ainsi:

```diff
-    coeffs = [0] * k + sum(([n.binomial(i) * bernoulli(n - i), 0]
-                            for i in range(k, n + 1, 2)), [])
-    coeffs[-3] = -n / 2
+    coeffs = [0] * (n + 1)
+    coeffs[k::2] = (n.binomial(i) * bernoulli(n - i)
+                    for i in range(k, n + 1, 2))
+    coeffs[-2] = -n / 2
```



---

archive/issue_comments_617235.json:
```json
{
    "body": "<a id='comment:10'></a>\nMerci pour les suggestions.\nCependant, ces changements ne me paraissent pas tr\u00e8s utiles, donc je pr\u00e9f\u00e8re en rester l\u00e0.",
    "created_at": "2020-12-27T08:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31106#issuecomment-617235",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
Merci pour les suggestions.
Cependant, ces changements ne me paraissent pas très utiles, donc je préfère en rester là.



---

archive/issue_comments_617236.json:
```json
{
    "body": "Changing branch from \"u/chapoton/31106\" to \"d02b2750a1ca3406fd632662e2a3ae71c6334375\"",
    "created_at": "2020-12-27T23:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31106#issuecomment-617236",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/chapoton/31106" to "d02b2750a1ca3406fd632662e2a3ae71c6334375"



---

archive/issue_comments_617237.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-12-27T23:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31106#issuecomment-617237",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_081263.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-27T23:25:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31106",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31106#event-81263"
}
```
