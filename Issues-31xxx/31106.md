# Issue 31106: refresh combinat.py

archive/issues_030869.json:
```json
{
    "assignees": [],
    "body": "* full flake8\n* some typing annotation\n* using maxima_lib\n\n\nCC:  @tscrim @slel\n\nBranch/Commit: **[d02b275](https://github.com/sagemath/sagetrac-mirror/commit/d02b2750a1ca3406fd632662e2a3ae71c6334375)**\n\nReviewer: **David Coudert**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31106_\n\n",
    "closed_at": "2020-12-27T23:25:26Z",
    "created_at": "2020-12-25T14:44:01Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "refresh combinat.py",
    "type": "issue",
    "updated_at": "2020-12-27T23:25:26Z",
    "url": "https://github.com/sagemath/sage/issues/31106",
    "user": "https://github.com/fchapoton"
}
```
* full flake8
* some typing annotation
* using maxima_lib


CC:  @tscrim @slel

Branch/Commit: **[d02b275](https://github.com/sagemath/sagetrac-mirror/commit/d02b2750a1ca3406fd632662e2a3ae71c6334375)**

Reviewer: **David Coudert**

Author: **Frédéric Chapoton**

_Issue created by migration from https://trac.sagemath.org/ticket/31106_





---

archive/issue_events_410660.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-12-25T14:44:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31106#event-410660"
}
```



---

archive/issue_events_410661.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-12-25T14:44:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "component: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31106#event-410661"
}
```



---

archive/issue_events_410662.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-12-25T14:44:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31106#event-410662"
}
```



---

archive/issue_events_410663.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-12-25T14:44:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31106#event-410663"
}
```



---

archive/issue_comments_501487.json:
```json
{
    "body": "Commit: **[ba32878](https://github.com/sagemath/sagetrac-mirror/commit/ba32878b2bdd8604c921d3eccbfe73886f9b809c)**",
    "created_at": "2020-12-25T14:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501487",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[ba32878](https://github.com/sagemath/sagetrac-mirror/commit/ba32878b2bdd8604c921d3eccbfe73886f9b809c)**



---

archive/issue_events_410664.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-12-25T14:44:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31106#event-410664"
}
```



---

archive/issue_comments_501488.json:
```json
{
    "body": "Branch: **[u/chapoton/31106](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/31106)**",
    "created_at": "2020-12-25T14:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501488",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/31106](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/31106)**



---

archive/issue_comments_501489.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba32878b2bdd8604c921d3eccbfe73886f9b809c\">ba32878</a></td><td><code>refresh combinat.py</code></td></tr></table>\n",
    "created_at": "2020-12-25T14:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501489",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1" align="right">Comment 1</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba32878b2bdd8604c921d3eccbfe73886f9b809c">ba32878</a></td><td><code>refresh combinat.py</code></td></tr></table>




---

archive/issue_comments_501490.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d02b2750a1ca3406fd632662e2a3ae71c6334375\">d02b275</a></td><td><code>fix doctest</code></td></tr></table>\n",
    "created_at": "2020-12-25T18:18:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501490",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2" align="right">Comment 2</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d02b2750a1ca3406fd632662e2a3ae71c6334375">d02b275</a></td><td><code>fix doctest</code></td></tr></table>




---

archive/issue_comments_501491.json:
```json
{
    "body": "Changed commit from **[ba32878](https://github.com/sagemath/sagetrac-mirror/commit/ba32878b2bdd8604c921d3eccbfe73886f9b809c)** to **[d02b275](https://github.com/sagemath/sagetrac-mirror/commit/d02b2750a1ca3406fd632662e2a3ae71c6334375)**",
    "created_at": "2020-12-25T18:18:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501491",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ba32878](https://github.com/sagemath/sagetrac-mirror/commit/ba32878b2bdd8604c921d3eccbfe73886f9b809c)** to **[d02b275](https://github.com/sagemath/sagetrac-mirror/commit/d02b2750a1ca3406fd632662e2a3ae71c6334375)**



---

archive/issue_comments_501492.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\ngreen bot, please review",
    "created_at": "2020-12-26T08:26:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501492",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:3" align="right">Comment 3</div>

green bot, please review



---

archive/issue_comments_501493.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\na small possible correction\n\n```diff\n-        if (self.first != self.__first_from_iterator and\n-                self.next != self.__next_from_iterator):\n+        if (self.first != self.__first_from_iterator and\n+            self.next != self.__next_from_iterator):\n```\notherwise, LGTM.",
    "created_at": "2020-12-26T10:08:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501493",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:4" align="right">Comment 4</div>

a small possible correction

```diff
-        if (self.first != self.__first_from_iterator and
-                self.next != self.__next_from_iterator):
+        if (self.first != self.__first_from_iterator and
+            self.next != self.__next_from_iterator):
```
otherwise, LGTM.



---

archive/issue_comments_501494.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nben, je crois que flake8 n'aime pas trop les trucs alignes avec la ligne d'apres..",
    "created_at": "2020-12-26T10:34:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501494",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:5" align="right">Comment 5</div>

ben, je crois que flake8 n'aime pas trop les trucs alignes avec la ligne d'apres..



---

archive/issue_comments_501495.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nCa explique pourquoi emacs aligne par d\u00e9faut comme tu l'as fait.\n\nLGTM.",
    "created_at": "2020-12-26T10:39:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501495",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:6" align="right">Comment 6</div>

Ca explique pourquoi emacs aligne par défaut comme tu l'as fait.

LGTM.



---

archive/issue_events_410665.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-12-26T10:39:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31106#event-410665"
}
```



---

archive/issue_events_410666.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-12-26T10:39:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31106#event-410666"
}
```



---

archive/issue_comments_501496.json:
```json
{
    "body": "Reviewer: **David Coudert**",
    "created_at": "2020-12-26T10:39:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501496",
    "user": "https://github.com/dcoudert"
}
```

Reviewer: **David Coudert**



---

archive/issue_comments_501497.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nEn option, m\u00eame si ce n'est pas le propos principal du ticket,\ndans `bell_number` on pourrait changer `R(-1)` -> `(-R.one())`, comme\nc'est d\u00e9j\u00e0 fait dans `bernoulli_polynomial` pour `ZZ(1)` -> `ZZ.one()`.",
    "created_at": "2020-12-26T12:09:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501497",
    "user": "https://github.com/slel"
}
```

<div id="comment:7" align="right">Comment 7</div>

En option, même si ce n'est pas le propos principal du ticket,
dans `bell_number` on pourrait changer `R(-1)` -> `(-R.one())`, comme
c'est déjà fait dans `bernoulli_polynomial` pour `ZZ(1)` -> `ZZ.one()`.



---

archive/issue_comments_501498.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nEt dans `euler_number` on pourrait changer\n\n```diff\n-        sage: 2/(exp(x)+exp(-x))\n+        sage: x.cosh().inverse()\n         1 - 1/2*x^2 + 5/24*x^4 - 61/720*x^6 + 277/8064*x^8 + O(x^10)\n```\npour gagner quelques microsecondes \u00e0 chaque doctest\n\n```\nsage: sage: x = PowerSeriesRing(QQ, 'x').gen().O(10)\nsage: timeit('2/(exp(x) + exp(-x))')\n625 loops, best of 3: 439 \u03bcs per loop\nsage: timeit('x.cosh().inverse()')\n625 loops, best of 3: 250 \u03bcs per loop\n```\nmais je n'insiste bien s\u00fbr pas.",
    "created_at": "2020-12-26T12:18:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501498",
    "user": "https://github.com/slel"
}
```

<div id="comment:8" align="right">Comment 8</div>

Et dans `euler_number` on pourrait changer

```diff
-        sage: 2/(exp(x)+exp(-x))
+        sage: x.cosh().inverse()
         1 - 1/2*x^2 + 5/24*x^4 - 61/720*x^6 + 277/8064*x^8 + O(x^10)
```
pour gagner quelques microsecondes à chaque doctest

```
sage: sage: x = PowerSeriesRing(QQ, 'x').gen().O(10)
sage: timeit('2/(exp(x) + exp(-x))')
625 loops, best of 3: 439 μs per loop
sage: timeit('x.cosh().inverse()')
625 loops, best of 3: 250 μs per loop
```
mais je n'insiste bien sûr pas.



---

archive/issue_comments_501499.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nDans `bernoulli_polynomial` on pourrait clarifier ainsi:\n\n```diff\n-    coeffs = [0] * k + sum(([n.binomial(i) * bernoulli(n - i), 0]\n-                            for i in range(k, n + 1, 2)), [])\n-    coeffs[-3] = -n / 2\n+    coeffs = [0] * (n + 1)\n+    coeffs[k::2] = (n.binomial(i) * bernoulli(n - i)\n+                    for i in range(k, n + 1, 2))\n+    coeffs[-2] = -n / 2\n```",
    "created_at": "2020-12-26T17:51:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501499",
    "user": "https://github.com/slel"
}
```

<div id="comment:9" align="right">Comment 9</div>

Dans `bernoulli_polynomial` on pourrait clarifier ainsi:

```diff
-    coeffs = [0] * k + sum(([n.binomial(i) * bernoulli(n - i), 0]
-                            for i in range(k, n + 1, 2)), [])
-    coeffs[-3] = -n / 2
+    coeffs = [0] * (n + 1)
+    coeffs[k::2] = (n.binomial(i) * bernoulli(n - i)
+                    for i in range(k, n + 1, 2))
+    coeffs[-2] = -n / 2
```



---

archive/issue_comments_501500.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nMerci pour les suggestions.\nCependant, ces changements ne me paraissent pas tr\u00e8s utiles, donc je pr\u00e9f\u00e8re en rester l\u00e0.",
    "created_at": "2020-12-27T08:51:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501500",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:10" align="right">Comment 10</div>

Merci pour les suggestions.
Cependant, ces changements ne me paraissent pas très utiles, donc je préfère en rester là.



---

archive/issue_comments_501501.json:
```json
{
    "body": "Changed branch from **[u/chapoton/31106](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/31106)** to **[d02b275](https://github.com/sagemath/sagetrac-mirror/commit/d02b2750a1ca3406fd632662e2a3ae71c6334375)**",
    "created_at": "2020-12-27T23:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501501",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/31106](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/31106)** to **[d02b275](https://github.com/sagemath/sagetrac-mirror/commit/d02b2750a1ca3406fd632662e2a3ae71c6334375)**



---

archive/issue_events_410667.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-27T23:25:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31106#event-410667"
}
```



---

archive/issue_events_410668.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "0c355ddc523129acf154e6f361a6366058591105",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-12-27T23:25:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31106#event-410668"
}
```
