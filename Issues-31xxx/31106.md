# Issue 31106: refresh combinat.py

archive/issues_030869.json:
```json
{
    "assignees": [],
    "body": "* full flake8\n* some typing annotation\n* using maxima_lib\n\n\n**CC:**  @tscrim @slel\n\n**Branch/Commit:** [d02b2750a1ca3406fd632662e2a3ae71c6334375](https://github.com/sagemath/sagetrac-mirror/commit/d02b2750a1ca3406fd632662e2a3ae71c6334375)\n\n**Reviewer:** David Coudert\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton\n\nIssue created by migration from https://trac.sagemath.org/ticket/31106\n\n",
    "closed_at": "2020-12-27T23:25:26Z",
    "created_at": "2020-12-25T14:44:01Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "refresh combinat.py",
    "type": "issue",
    "updated_at": "2020-12-27T23:25:26Z",
    "url": "https://github.com/sagemath/sage/issues/31106",
    "user": "https://github.com/fchapoton"
}
```
* full flake8
* some typing annotation
* using maxima_lib


**CC:**  @tscrim @slel

**Branch/Commit:** [d02b2750a1ca3406fd632662e2a3ae71c6334375](https://github.com/sagemath/sagetrac-mirror/commit/d02b2750a1ca3406fd632662e2a3ae71c6334375)

**Reviewer:** David Coudert

**Author:** Frédéric Chapoton

Issue created by migration from https://trac.sagemath.org/ticket/31106





---

archive/issue_events_377237.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-12-25T14:44:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31106#event-377237"
}
```



---

archive/issue_events_377238.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-12-25T14:44:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
    "label_color": "08517b",
    "label_name": "component: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31106#event-377238"
}
```



---

archive/issue_events_377239.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-12-25T14:44:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "label": "https://github.com/sagemath/sage/labels/minor",
    "label_color": "ff0000",
    "label_name": "minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31106#event-377239"
}
```



---

archive/issue_events_377240.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-12-25T14:44:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31106#event-377240"
}
```



---

archive/issue_comments_501289.json:
```json
{
    "body": "**Commit:** [ba32878b2bdd8604c921d3eccbfe73886f9b809c](https://github.com/sagemath/sagetrac-mirror/commit/ba32878b2bdd8604c921d3eccbfe73886f9b809c)",
    "created_at": "2020-12-25T14:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501289",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [ba32878b2bdd8604c921d3eccbfe73886f9b809c](https://github.com/sagemath/sagetrac-mirror/commit/ba32878b2bdd8604c921d3eccbfe73886f9b809c)



---

archive/issue_events_377241.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-12-25T14:44:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31106#event-377241"
}
```



---

archive/issue_comments_501290.json:
```json
{
    "body": "**Branch:** [u/chapoton/31106](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/31106)",
    "created_at": "2020-12-25T14:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501290",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/31106](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/31106)



---

archive/issue_comments_501291.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba32878b2bdd8604c921d3eccbfe73886f9b809c\">ba32878</a></td><td><code>refresh combinat.py</code></td></tr></table>\n",
    "created_at": "2020-12-25T14:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501291",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba32878b2bdd8604c921d3eccbfe73886f9b809c">ba32878</a></td><td><code>refresh combinat.py</code></td></tr></table>




---

archive/issue_comments_501292.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d02b2750a1ca3406fd632662e2a3ae71c6334375\">d02b275</a></td><td><code>fix doctest</code></td></tr></table>\n",
    "created_at": "2020-12-25T18:18:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501292",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d02b2750a1ca3406fd632662e2a3ae71c6334375">d02b275</a></td><td><code>fix doctest</code></td></tr></table>




---

archive/issue_comments_501293.json:
```json
{
    "body": "**Changing commit** from \"[ba32878b2bdd8604c921d3eccbfe73886f9b809c](https://github.com/sagemath/sagetrac-mirror/commit/ba32878b2bdd8604c921d3eccbfe73886f9b809c)\" to \"[d02b2750a1ca3406fd632662e2a3ae71c6334375](https://github.com/sagemath/sagetrac-mirror/commit/d02b2750a1ca3406fd632662e2a3ae71c6334375)\".",
    "created_at": "2020-12-25T18:18:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501293",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[ba32878b2bdd8604c921d3eccbfe73886f9b809c](https://github.com/sagemath/sagetrac-mirror/commit/ba32878b2bdd8604c921d3eccbfe73886f9b809c)" to "[d02b2750a1ca3406fd632662e2a3ae71c6334375](https://github.com/sagemath/sagetrac-mirror/commit/d02b2750a1ca3406fd632662e2a3ae71c6334375)".



---

archive/issue_comments_501294.json:
```json
{
    "body": "<a id='comment:3'></a>\ngreen bot, please review",
    "created_at": "2020-12-26T08:26:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501294",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>
green bot, please review



---

archive/issue_comments_501295.json:
```json
{
    "body": "<a id='comment:4'></a>\na small possible correction\n\n```diff\n-        if (self.first != self.__first_from_iterator and\n-                self.next != self.__next_from_iterator):\n+        if (self.first != self.__first_from_iterator and\n+            self.next != self.__next_from_iterator):\n```\notherwise, LGTM.",
    "created_at": "2020-12-26T10:08:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501295",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:4'></a>
a small possible correction

```diff
-        if (self.first != self.__first_from_iterator and
-                self.next != self.__next_from_iterator):
+        if (self.first != self.__first_from_iterator and
+            self.next != self.__next_from_iterator):
```
otherwise, LGTM.



---

archive/issue_comments_501296.json:
```json
{
    "body": "<a id='comment:5'></a>\nben, je crois que flake8 n'aime pas trop les trucs alignes avec la ligne d'apres..",
    "created_at": "2020-12-26T10:34:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501296",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
ben, je crois que flake8 n'aime pas trop les trucs alignes avec la ligne d'apres..



---

archive/issue_comments_501297.json:
```json
{
    "body": "<a id='comment:6'></a>\nCa explique pourquoi emacs aligne par d\u00e9faut comme tu l'as fait.\n\nLGTM.",
    "created_at": "2020-12-26T10:39:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501297",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:6'></a>
Ca explique pourquoi emacs aligne par défaut comme tu l'as fait.

LGTM.



---

archive/issue_events_377242.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-12-26T10:39:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31106#event-377242"
}
```



---

archive/issue_events_377243.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-12-26T10:39:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31106#event-377243"
}
```



---

archive/issue_comments_501298.json:
```json
{
    "body": "**Reviewer:** David Coudert",
    "created_at": "2020-12-26T10:39:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501298",
    "user": "https://github.com/dcoudert"
}
```

**Reviewer:** David Coudert



---

archive/issue_comments_501299.json:
```json
{
    "body": "<a id='comment:7'></a>\nEn option, m\u00eame si ce n'est pas le propos principal du ticket,\ndans `bell_number` on pourrait changer `R(-1)` -> `(-R.one())`, comme\nc'est d\u00e9j\u00e0 fait dans `bernoulli_polynomial` pour `ZZ(1)` -> `ZZ.one()`.",
    "created_at": "2020-12-26T12:09:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501299",
    "user": "https://github.com/slel"
}
```

<a id='comment:7'></a>
En option, même si ce n'est pas le propos principal du ticket,
dans `bell_number` on pourrait changer `R(-1)` -> `(-R.one())`, comme
c'est déjà fait dans `bernoulli_polynomial` pour `ZZ(1)` -> `ZZ.one()`.



---

archive/issue_comments_501300.json:
```json
{
    "body": "<a id='comment:8'></a>\nEt dans `euler_number` on pourrait changer\n\n```diff\n-        sage: 2/(exp(x)+exp(-x))\n+        sage: x.cosh().inverse()\n         1 - 1/2*x^2 + 5/24*x^4 - 61/720*x^6 + 277/8064*x^8 + O(x^10)\n```\npour gagner quelques microsecondes \u00e0 chaque doctest\n\n```\nsage: sage: x = PowerSeriesRing(QQ, 'x').gen().O(10)\nsage: timeit('2/(exp(x) + exp(-x))')\n625 loops, best of 3: 439 \u03bcs per loop\nsage: timeit('x.cosh().inverse()')\n625 loops, best of 3: 250 \u03bcs per loop\n```\nmais je n'insiste bien s\u00fbr pas.",
    "created_at": "2020-12-26T12:18:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501300",
    "user": "https://github.com/slel"
}
```

<a id='comment:8'></a>
Et dans `euler_number` on pourrait changer

```diff
-        sage: 2/(exp(x)+exp(-x))
+        sage: x.cosh().inverse()
         1 - 1/2*x^2 + 5/24*x^4 - 61/720*x^6 + 277/8064*x^8 + O(x^10)
```
pour gagner quelques microsecondes à chaque doctest

```
sage: sage: x = PowerSeriesRing(QQ, 'x').gen().O(10)
sage: timeit('2/(exp(x) + exp(-x))')
625 loops, best of 3: 439 μs per loop
sage: timeit('x.cosh().inverse()')
625 loops, best of 3: 250 μs per loop
```
mais je n'insiste bien sûr pas.



---

archive/issue_comments_501301.json:
```json
{
    "body": "<a id='comment:9'></a>\nDans `bernoulli_polynomial` on pourrait clarifier ainsi:\n\n```diff\n-    coeffs = [0] * k + sum(([n.binomial(i) * bernoulli(n - i), 0]\n-                            for i in range(k, n + 1, 2)), [])\n-    coeffs[-3] = -n / 2\n+    coeffs = [0] * (n + 1)\n+    coeffs[k::2] = (n.binomial(i) * bernoulli(n - i)\n+                    for i in range(k, n + 1, 2))\n+    coeffs[-2] = -n / 2\n```",
    "created_at": "2020-12-26T17:51:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501301",
    "user": "https://github.com/slel"
}
```

<a id='comment:9'></a>
Dans `bernoulli_polynomial` on pourrait clarifier ainsi:

```diff
-    coeffs = [0] * k + sum(([n.binomial(i) * bernoulli(n - i), 0]
-                            for i in range(k, n + 1, 2)), [])
-    coeffs[-3] = -n / 2
+    coeffs = [0] * (n + 1)
+    coeffs[k::2] = (n.binomial(i) * bernoulli(n - i)
+                    for i in range(k, n + 1, 2))
+    coeffs[-2] = -n / 2
```



---

archive/issue_comments_501302.json:
```json
{
    "body": "<a id='comment:10'></a>\nMerci pour les suggestions.\nCependant, ces changements ne me paraissent pas tr\u00e8s utiles, donc je pr\u00e9f\u00e8re en rester l\u00e0.",
    "created_at": "2020-12-27T08:51:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501302",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
Merci pour les suggestions.
Cependant, ces changements ne me paraissent pas très utiles, donc je préfère en rester là.



---

archive/issue_comments_501303.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/31106](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/31106)\" to \"[d02b2750a1ca3406fd632662e2a3ae71c6334375](https://github.com/sagemath/sagetrac-mirror/commit/d02b2750a1ca3406fd632662e2a3ae71c6334375)\".",
    "created_at": "2020-12-27T23:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31106#issuecomment-501303",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/chapoton/31106](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/31106)" to "[d02b2750a1ca3406fd632662e2a3ae71c6334375](https://github.com/sagemath/sagetrac-mirror/commit/d02b2750a1ca3406fd632662e2a3ae71c6334375)".



---

archive/issue_events_377244.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-27T23:25:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31106#event-377244"
}
```



---

archive/issue_events_377245.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "0c355ddc523129acf154e6f361a6366058591105",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-12-27T23:25:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31106",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31106#event-377245"
}
```
