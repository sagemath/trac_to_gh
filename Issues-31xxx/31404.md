# Issue 31404: Replace most of sage.libs.gap with gappy

archive/issues_031167.json:
```json
{
    "body": "From [the gappy README](https://github.com/embray/gappy#gappy--a-python-interface-to-gap):\n\n> gappy provides a Python interface to the GAP\n> computer algebra system by linking to its\n> library interface.\n\n\nThis is a follow-up to #31297, particularly inspired by [#31297 comment:17](https://github.com/sagemath/sage/issues/31297#comment:17).  It is a more disruptive change, in that instead of providing wrappers around gappy that are Sage Parents and Elements, it follows the example of cypari2 and just uses gappy more-or-less directly without any wrappers.\n\nIt remains completely agnostic to the coercion system, though I am not completely happy with this state of affairs.  In particular you can see I had to add a special case to `Polynomial.__call__` for handling evaluating polynomials on `GapObj`s, a case that used to work fine, but now needs a special case since other Sage types cannot be coerced to `GapObj`s.\n\nAlso had to add special cases for instantiating `Integer`s and `Rational`s from `GapObj`s, but on the plus side this is now a bit faster.\n\n**CC:**  @videlec @dimpase @mkoeppe @slel\n\n**Keywords:** gap libgap gappy\n\n**Branch:** [u/dimpase/gappy-without-wrappers](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/gappy-without-wrappers)\n\n**Commit:** [3f1d051757a0e9fa35b6bb04c0a93d606e080d13](https://github.com/sagemath/sagetrac-mirror/commit/3f1d051757a0e9fa35b6bb04c0a93d606e080d13)\n\n**Work Issues:** release gappy 0.1.0 final and update spkg version before merging, test against p_groups_cohomology\n\n**Upstream:** Reported upstream. No feedback yet.\n\n**Reviewer:** Dima Pasechnik, ...\n\n**Author:** Erik Bray\n\nIssue created by migration from https://trac.sagemath.org/ticket/31404\n\n",
    "created_at": "2021-02-16T12:17:53Z",
    "labels": [
        "component: interfaces",
        "enhancement",
        "needs work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "title": "Replace most of sage.libs.gap with gappy",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/31404",
    "user": "https://github.com/embray"
}
```
From [the gappy README](https://github.com/embray/gappy#gappy--a-python-interface-to-gap):

> gappy provides a Python interface to the GAP
> computer algebra system by linking to its
> library interface.


This is a follow-up to #31297, particularly inspired by [#31297 comment:17](https://github.com/sagemath/sage/issues/31297#comment:17).  It is a more disruptive change, in that instead of providing wrappers around gappy that are Sage Parents and Elements, it follows the example of cypari2 and just uses gappy more-or-less directly without any wrappers.

It remains completely agnostic to the coercion system, though I am not completely happy with this state of affairs.  In particular you can see I had to add a special case to `Polynomial.__call__` for handling evaluating polynomials on `GapObj`s, a case that used to work fine, but now needs a special case since other Sage types cannot be coerced to `GapObj`s.

Also had to add special cases for instantiating `Integer`s and `Rational`s from `GapObj`s, but on the plus side this is now a bit faster.

**CC:**  @videlec @dimpase @mkoeppe @slel

**Keywords:** gap libgap gappy

**Branch:** [u/dimpase/gappy-without-wrappers](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/gappy-without-wrappers)

**Commit:** [3f1d051757a0e9fa35b6bb04c0a93d606e080d13](https://github.com/sagemath/sagetrac-mirror/commit/3f1d051757a0e9fa35b6bb04c0a93d606e080d13)

**Work Issues:** release gappy 0.1.0 final and update spkg version before merging, test against p_groups_cohomology

**Upstream:** Reported upstream. No feedback yet.

**Reviewer:** Dima Pasechnik, ...

**Author:** Erik Bray

Issue created by migration from https://trac.sagemath.org/ticket/31404





---

archive/issue_comments_506928.json:
```json
{
    "body": "**Commit:** [943b009d917673aa833c3ec67922cbedfbc3fe33](https://github.com/sagemath/sagetrac-mirror/commit/943b009d917673aa833c3ec67922cbedfbc3fe33)",
    "created_at": "2021-02-16T12:37:01Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506928",
    "user": "https://github.com/embray"
}
```

**Commit:** [943b009d917673aa833c3ec67922cbedfbc3fe33](https://github.com/sagemath/sagetrac-mirror/commit/943b009d917673aa833c3ec67922cbedfbc3fe33)



---

archive/issue_comments_506929.json:
```json
{
    "body": "<a id='comment:1'></a>\n**Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/197290f339ef5da0dbce0eb6afde85ad65dabd6a\">197290f</a></td><td><code>Fix miscellaneous tests that broke due to different group iteration</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f621e96ff870e7fba2fc1177d82a08aca6ce52f\">9f621e9</a></td><td><code>Update gappy to v0.1.0a1 with some fixes for matrices and gap_function.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/483931628b3a4ce7ffe9e15fb28de20b5362a757\">4839316</a></td><td><code>Miscellaneous updates to not use deprecated interfaces, particularly</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/baa0f61f86120ca2bb53e6d3a039f69239a1d0ac\">baa0f61</a></td><td><code>Update gappy to v0.1.0a2 which adds MacOS and Cygwin fixes.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a07f20ecee90d82914116e45b31e58b93d0e3ca1\">a07f20e</a></td><td><code>Fixes needed for gappy v0.1.0a2 which did away with the libgap_soname</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9160c10e033565c1e2b538cb55f89f4c518ae72\">c9160c1</a></td><td><code>Further rework of 45b175e43621795f890204a9cdfb30b524f961fa which</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0ae791e6a1335d065d28448a80d072c26c257747\">0ae791e</a></td><td><code>Update gappy to v0.1.3a3 with the requisite changes needed to adapt to</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82e7e56cdea9b8d24a3465f9661189288f54cc26\">82e7e56</a></td><td><code>A few minor test fixes:</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b305f39f9d504610949eb515d919dc77a4e39ecb\">b305f39</a></td><td><code>Don't assume that anything with a 'parent' attribute is fully</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/943b009d917673aa833c3ec67922cbedfbc3fe33\">943b009</a></td><td><code>Deprecate sage.libs.gap.element and convert Sage to use</code></td></tr></table>\n",
    "created_at": "2021-02-16T12:37:01Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506929",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>
**Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/197290f339ef5da0dbce0eb6afde85ad65dabd6a">197290f</a></td><td><code>Fix miscellaneous tests that broke due to different group iteration</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f621e96ff870e7fba2fc1177d82a08aca6ce52f">9f621e9</a></td><td><code>Update gappy to v0.1.0a1 with some fixes for matrices and gap_function.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/483931628b3a4ce7ffe9e15fb28de20b5362a757">4839316</a></td><td><code>Miscellaneous updates to not use deprecated interfaces, particularly</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/baa0f61f86120ca2bb53e6d3a039f69239a1d0ac">baa0f61</a></td><td><code>Update gappy to v0.1.0a2 which adds MacOS and Cygwin fixes.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a07f20ecee90d82914116e45b31e58b93d0e3ca1">a07f20e</a></td><td><code>Fixes needed for gappy v0.1.0a2 which did away with the libgap_soname</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9160c10e033565c1e2b538cb55f89f4c518ae72">c9160c1</a></td><td><code>Further rework of 45b175e43621795f890204a9cdfb30b524f961fa which</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0ae791e6a1335d065d28448a80d072c26c257747">0ae791e</a></td><td><code>Update gappy to v0.1.3a3 with the requisite changes needed to adapt to</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82e7e56cdea9b8d24a3465f9661189288f54cc26">82e7e56</a></td><td><code>A few minor test fixes:</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b305f39f9d504610949eb515d919dc77a4e39ecb">b305f39</a></td><td><code>Don't assume that anything with a 'parent' attribute is fully</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/943b009d917673aa833c3ec67922cbedfbc3fe33">943b009</a></td><td><code>Deprecate sage.libs.gap.element and convert Sage to use</code></td></tr></table>




---

archive/issue_comments_506930.json:
```json
{
    "body": "**Branch:** [u/embray/gappy-without-wrappers](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/gappy-without-wrappers)",
    "created_at": "2021-02-16T12:37:01Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506930",
    "user": "https://github.com/embray"
}
```

**Branch:** [u/embray/gappy-without-wrappers](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/gappy-without-wrappers)



---

archive/issue_events_281597.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2021-02-16T12:37:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31404#event-281597"
}
```



---

archive/issue_comments_506931.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n This is a follow-up to #31297, particularly inspired by [#31297 comment:17](https://github.com/sagemath/sage/issues/31297#comment:17).  It is a more disruptive change, in that instead of providing wrappers around gappy that are Sage Parents and Elements, it follows the example of cypari2 and just uses gappy more-or-less directly without any wrappers.\n \n-It remains completely agnostic to the coercion system, though I am not completely happy with this state of affairs.  In particular you can see I had to add a special case to `Polynomial.__call__` for handling evaluating polynomials on GapObjs, a case that used to work fine, but now needs a special case since other Sage types cannot be coerced to GapObjs.\n+It remains completely agnostic to the coercion system, though I am not completely happy with this state of affairs.  In particular you can see I had to add a special case to `Polynomial.__call__` for handling evaluating polynomials on `GapObj`s, a case that used to work fine, but now needs a special case since other Sage types cannot be coerced to `GapObj`s.\n \n Also had to add special cases for instantiating Integers and Rationals from GapObjs, but on the plus side this is now a bit faster.\n``````\n",
    "created_at": "2021-02-16T12:37:52Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506931",
    "user": "https://github.com/embray"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 This is a follow-up to #31297, particularly inspired by [#31297 comment:17](https://github.com/sagemath/sage/issues/31297#comment:17).  It is a more disruptive change, in that instead of providing wrappers around gappy that are Sage Parents and Elements, it follows the example of cypari2 and just uses gappy more-or-less directly without any wrappers.
 
-It remains completely agnostic to the coercion system, though I am not completely happy with this state of affairs.  In particular you can see I had to add a special case to `Polynomial.__call__` for handling evaluating polynomials on GapObjs, a case that used to work fine, but now needs a special case since other Sage types cannot be coerced to GapObjs.
+It remains completely agnostic to the coercion system, though I am not completely happy with this state of affairs.  In particular you can see I had to add a special case to `Polynomial.__call__` for handling evaluating polynomials on `GapObj`s, a case that used to work fine, but now needs a special case since other Sage types cannot be coerced to `GapObj`s.
 
 Also had to add special cases for instantiating Integers and Rationals from GapObjs, but on the plus side this is now a bit faster.
``````




---

archive/issue_comments_506932.json:
```json
{
    "body": "<a id='comment:2'></a>\nIf eventually approved, this would supersede #31297.",
    "created_at": "2021-02-16T12:37:52Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506932",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'></a>
If eventually approved, this would supersede #31297.



---

archive/issue_comments_506933.json:
```json
{
    "body": "<a id='comment:3'></a>\nDoes sphinx link such as <code>:mod:\\`gappy.gapobj\\`</code> actually works? The question is merely\n- where is it resolved?\n- in the documentation where does it point to: local or distant documentation?\n\nFor `pplpy` we had to trick a bit, (commit `684e10`)\n\n```diff\ndiff --git a/build/pkgs/pplpy/spkg-install b/build/pkgs/pplpy/spkg-install\nindex deba1bb42b..5a39f43925 100644\n--- a/build/pkgs/pplpy/spkg-install\n+++ b/build/pkgs/pplpy/spkg-install\n@@ -1 +1,14 @@\n cd src && sdh_pip_install .\n+\n+if [[ \"$SAGE_SPKG_INSTALL_DOCS\" != no ]] ; then\n+    # Compile pplpy's documentation\n+    sage-python23 setup.py build_ext --inplace\n+    PYTHONPATH=$PYTHONPATH:$(pwd)\n+    cd docs\n+    $MAKE html\n+\n+    # install pplpy's documentation\n+    PPLPY_DOCS=$SAGE_SHARE/doc/pplpy\n+    mkdir -p $PPLPY_DOCS\n+    cp -r build/html/*  $PPLPY_DOCS\n+fi\ndiff --git a/src/doc/common/conf.py b/src/doc/common/conf.py\nindex 91f651a41c..70dd17f271 100644\n--- a/src/doc/common/conf.py\n+++ b/src/doc/common/conf.py\n@@ -177,7 +177,8 @@ python_version = sys.version_info.major\n intersphinx_mapping = {\n     'python': ('https://docs.python.org/',\n                 os.path.join(SAGE_DOC_SRC, \"common\",\n-                             \"python{}.inv\".format(python_version)))}\n+                             \"python{}.inv\".format(python_version))),\n+    'pplpy': (os.path.join(SAGE_SHARE, \"doc\", \"pplpy\"), None)}\n \n def set_intersphinx_mappings(app):\n     \"\"\"\n```\nWhat we did is not robust at all...",
    "created_at": "2021-02-16T15:56:14Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506933",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>
Does sphinx link such as <code>:mod:\`gappy.gapobj\`</code> actually works? The question is merely
- where is it resolved?
- in the documentation where does it point to: local or distant documentation?

For `pplpy` we had to trick a bit, (commit `684e10`)

```diff
diff --git a/build/pkgs/pplpy/spkg-install b/build/pkgs/pplpy/spkg-install
index deba1bb42b..5a39f43925 100644
--- a/build/pkgs/pplpy/spkg-install
+++ b/build/pkgs/pplpy/spkg-install
@@ -1 +1,14 @@
 cd src && sdh_pip_install .
+
+if [[ "$SAGE_SPKG_INSTALL_DOCS" != no ]] ; then
+    # Compile pplpy's documentation
+    sage-python23 setup.py build_ext --inplace
+    PYTHONPATH=$PYTHONPATH:$(pwd)
+    cd docs
+    $MAKE html
+
+    # install pplpy's documentation
+    PPLPY_DOCS=$SAGE_SHARE/doc/pplpy
+    mkdir -p $PPLPY_DOCS
+    cp -r build/html/*  $PPLPY_DOCS
+fi
diff --git a/src/doc/common/conf.py b/src/doc/common/conf.py
index 91f651a41c..70dd17f271 100644
--- a/src/doc/common/conf.py
+++ b/src/doc/common/conf.py
@@ -177,7 +177,8 @@ python_version = sys.version_info.major
 intersphinx_mapping = {
     'python': ('https://docs.python.org/',
                 os.path.join(SAGE_DOC_SRC, "common",
-                             "python{}.inv".format(python_version)))}
+                             "python{}.inv".format(python_version))),
+    'pplpy': (os.path.join(SAGE_SHARE, "doc", "pplpy"), None)}
 
 def set_intersphinx_mappings(app):
     """
```
What we did is not robust at all...



---

archive/issue_comments_506934.json:
```json
{
    "body": "<a id='comment:4'></a>\nI think the Python package `pplpy` should advertise the install location of the docs if possible. Assuming that things live in `SAGE_SHARE` is not a good idea...\nSee also: #27495 - Use sphinx.ext.extlinks to add Sphinx roles for links to external package docs",
    "created_at": "2021-02-16T16:40:35Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506934",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
I think the Python package `pplpy` should advertise the install location of the docs if possible. Assuming that things live in `SAGE_SHARE` is not a good idea...
See also: #27495 - Use sphinx.ext.extlinks to add Sphinx roles for links to external package docs



---

archive/issue_comments_506935.json:
```json
{
    "body": "<a id='comment:5'></a>\nI am still working on updating the docs.",
    "created_at": "2021-02-16T16:45:01Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506935",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>
I am still working on updating the docs.



---

archive/issue_comments_506936.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [mkoeppe](#comment%3A4):\n> SNIP\n\n\nI opened a [thread on sage-devel](https://groups.google.com/g/sage-devel/c/oWkFwhinoMc), no need to clutter the ticket with general documentation issue.",
    "created_at": "2021-02-16T18:46:22Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506936",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>
Replying to [mkoeppe](#comment%3A4):
> SNIP


I opened a [thread on sage-devel](https://groups.google.com/g/sage-devel/c/oWkFwhinoMc), no need to clutter the ticket with general documentation issue.



---

archive/issue_comments_506937.json:
```json
{
    "body": "<a id='comment:7'></a>\nAnother tricky aspect of the doc build: When I try to add a spkg-postinst to install the docs for gappy, gappy's own conf.py has an intersphinx mapping for the Python docs.\n\nEven weirder, when it tries to download the objects.inv from python.org it just hangs.  If I manually cd to the build directory for gappy and run `cd src/docs; make html` the download works no problem.  But when running `./sage -i gappy` it hangs at:\n\n```\n[gappy-0.1.0a3] loading intersphinx inventory from https://docs.python.org/3/objects.inv...\n```\n\nAre we actually doing something to block the internet connection when installing packages?",
    "created_at": "2021-02-26T11:55:34Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506937",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>
Another tricky aspect of the doc build: When I try to add a spkg-postinst to install the docs for gappy, gappy's own conf.py has an intersphinx mapping for the Python docs.

Even weirder, when it tries to download the objects.inv from python.org it just hangs.  If I manually cd to the build directory for gappy and run `cd src/docs; make html` the download works no problem.  But when running `./sage -i gappy` it hangs at:

```
[gappy-0.1.0a3] loading intersphinx inventory from https://docs.python.org/3/objects.inv...
```

Are we actually doing something to block the internet connection when installing packages?



---

archive/issue_comments_506938.json:
```json
{
    "body": "<a id='comment:8'></a>\nIt eventually fails with\n\n```\n[gappy-0.1.0a3] WARNING: failed to reach any of the inventories with the following issues:\n[gappy-0.1.0a3] intersphinx inventory 'https://docs.python.org/3/objects.inv' not fetchable due to <class 'requests.exceptions.ProxyError'>: HTTPSConnectionPool(host='docs.python.org', port=443): Max retries exceeded with url: /3/objects.inv (Caused by ProxyError('Cannot connect to proxy.', NewConnectionError('<requests.packages.urllib3.connection.VerifiedHTTPSConnection object at 0x7f8dcb536518>: Failed to establish a new connection: [Errno 110] Connection timed out',)))\n```",
    "created_at": "2021-02-26T11:56:13Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506938",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
It eventually fails with

```
[gappy-0.1.0a3] WARNING: failed to reach any of the inventories with the following issues:
[gappy-0.1.0a3] intersphinx inventory 'https://docs.python.org/3/objects.inv' not fetchable due to <class 'requests.exceptions.ProxyError'>: HTTPSConnectionPool(host='docs.python.org', port=443): Max retries exceeded with url: /3/objects.inv (Caused by ProxyError('Cannot connect to proxy.', NewConnectionError('<requests.packages.urllib3.connection.VerifiedHTTPSConnection object at 0x7f8dcb536518>: Failed to establish a new connection: [Errno 110] Connection timed out',)))
```



---

archive/issue_comments_506939.json:
```json
{
    "body": "<a id='comment:9'></a>\nA simple workaround suggested [here](https://github.com/sphinx-doc/sphinx/issues/3887#issuecomment-310810995) is to write a wrapper around the original `conf.py` to override the `intersphinx_mapping` setting.  I'm trying to get that to work now.",
    "created_at": "2021-02-26T12:14:51Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506939",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>
A simple workaround suggested [here](https://github.com/sphinx-doc/sphinx/issues/3887#issuecomment-310810995) is to write a wrapper around the original `conf.py` to override the `intersphinx_mapping` setting.  I'm trying to get that to work now.



---

archive/issue_comments_506940.json:
```json
{
    "body": "**Changing commit** from \"[943b009d917673aa833c3ec67922cbedfbc3fe33](https://github.com/sagemath/sagetrac-mirror/commit/943b009d917673aa833c3ec67922cbedfbc3fe33)\" to \"[092fa4b8111575c45e9b634e482558fd150ec9ea](https://github.com/sagemath/sagetrac-mirror/commit/092fa4b8111575c45e9b634e482558fd150ec9ea)\".",
    "created_at": "2021-02-26T12:23:56Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506940",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[943b009d917673aa833c3ec67922cbedfbc3fe33](https://github.com/sagemath/sagetrac-mirror/commit/943b009d917673aa833c3ec67922cbedfbc3fe33)" to "[092fa4b8111575c45e9b634e482558fd150ec9ea](https://github.com/sagemath/sagetrac-mirror/commit/092fa4b8111575c45e9b634e482558fd150ec9ea)".



---

archive/issue_comments_506941.json:
```json
{
    "body": "<a id='comment:10'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5c9a06a074e388d97fa072a5d0cf0c6471074953\">5c9a06a</a></td><td><code>Since this code was moved into a function it should use globals() not</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/092fa4b8111575c45e9b634e482558fd150ec9ea\">092fa4b</a></td><td><code>Install the gappy docs if SAGE_SPKG_INSTALL_DOCS=yes</code></td></tr></table>\n",
    "created_at": "2021-02-26T12:23:56Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506941",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5c9a06a074e388d97fa072a5d0cf0c6471074953">5c9a06a</a></td><td><code>Since this code was moved into a function it should use globals() not</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/092fa4b8111575c45e9b634e482558fd150ec9ea">092fa4b</a></td><td><code>Install the gappy docs if SAGE_SPKG_INSTALL_DOCS=yes</code></td></tr></table>




---

archive/issue_comments_506942.json:
```json
{
    "body": "<a id='comment:11'></a>\nYep, [this approach](https://github.com/sagemath/sagetrac-mirror/commit/092fa4b8111575c45e9b634e482558fd150ec9ea) gets the job done.\n\nIn case we also have a local copy of the Python docs installed, this can also change the intersphinx mapping to generate links to the local docs instead of the online ones, if desired.  Same approach could be used in other packages (pplpy, etc.)\n\nNext step: add the intersphinx mapping to the Sage docs, again generating links to the local gappy docs if available, and otherwise to the online docs.",
    "created_at": "2021-02-26T12:25:30Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506942",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>
Yep, [this approach](https://github.com/sagemath/sagetrac-mirror/commit/092fa4b8111575c45e9b634e482558fd150ec9ea) gets the job done.

In case we also have a local copy of the Python docs installed, this can also change the intersphinx mapping to generate links to the local docs instead of the online ones, if desired.  Same approach could be used in other packages (pplpy, etc.)

Next step: add the intersphinx mapping to the Sage docs, again generating links to the local gappy docs if available, and otherwise to the online docs.



---

archive/issue_comments_506943.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86e4b1ba175c9971ae5a4e9ff511506c3bcfed09\">86e4b1b</a></td><td><code>Deprecate sage.libs.gap.element and convert Sage to use</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2be416a553ce3d7070b68702be2aaf0090909f93\">2be416a</a></td><td><code>Since this code was moved into a function it should use globals() not</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/45eeb8f425f19de238ae4850a075572b648a9938\">45eeb8f</a></td><td><code>Install the gappy docs if SAGE_SPKG_INSTALL_DOCS=yes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a87cfbef3b1f287d730c42138680fe59cbffd301\">a87cfbe</a></td><td><code>Various documentation improvements:</code></td></tr></table>\n",
    "created_at": "2021-02-26T14:23:24Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506943",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86e4b1ba175c9971ae5a4e9ff511506c3bcfed09">86e4b1b</a></td><td><code>Deprecate sage.libs.gap.element and convert Sage to use</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2be416a553ce3d7070b68702be2aaf0090909f93">2be416a</a></td><td><code>Since this code was moved into a function it should use globals() not</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/45eeb8f425f19de238ae4850a075572b648a9938">45eeb8f</a></td><td><code>Install the gappy docs if SAGE_SPKG_INSTALL_DOCS=yes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a87cfbef3b1f287d730c42138680fe59cbffd301">a87cfbe</a></td><td><code>Various documentation improvements:</code></td></tr></table>




---

archive/issue_comments_506944.json:
```json
{
    "body": "**Changing commit** from \"[092fa4b8111575c45e9b634e482558fd150ec9ea](https://github.com/sagemath/sagetrac-mirror/commit/092fa4b8111575c45e9b634e482558fd150ec9ea)\" to \"[a87cfbef3b1f287d730c42138680fe59cbffd301](https://github.com/sagemath/sagetrac-mirror/commit/a87cfbef3b1f287d730c42138680fe59cbffd301)\".",
    "created_at": "2021-02-26T14:23:24Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506944",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[092fa4b8111575c45e9b634e482558fd150ec9ea](https://github.com/sagemath/sagetrac-mirror/commit/092fa4b8111575c45e9b634e482558fd150ec9ea)" to "[a87cfbef3b1f287d730c42138680fe59cbffd301](https://github.com/sagemath/sagetrac-mirror/commit/a87cfbef3b1f287d730c42138680fe59cbffd301)".



---

archive/issue_comments_506945.json:
```json
{
    "body": "<a id='comment:13'></a>\nThis is nearly ready to go from my point of view, except that when I run the full test suite I get a weird segfault from the Singular interface around here:\n\n```\nsage: a = singular(1) ## line 502 ##\nsage: _ = singular._expect.sendline('1+')  # unfinished input ## line 503 ##\nsage: try:\n    alarm(0.5)\n    singular._expect_expr('>')  # interrupt this\nexcept KeyboardInterrupt:\n    pass ## line 504 ##\nControl-C pressed. Interrupting Singular. Please wait a few seconds...\nsage: 2*a ## line 513 ##\n```\n\nwhich seems to be emanating from `sage.rings.integer`\n\n```\n/home/embray/src/sagemath/sage/local/lib/python3.6/site-packages/cysignals/signals.cpython-36m-x86_64-linux-gnu.so(+0x6a6b)[0x7fc69ffd9a6b]\n/home/embray/src/sagemath/sage/local/lib/python3.6/site-packages/cysignals/signals.cpython-36m-x86_64-linux-gnu.so(+0x6c48)[0x7fc69ffd9c48]\n/home/embray/src/sagemath/sage/local/lib/python3.6/site-packages/cysignals/signals.cpython-36m-x86_64-linux-gnu.so(+0x9103)[0x7fc69ffdc103]\n/lib/x86_64-linux-gnu/libc.so.6(+0x3efd0)[0x7fc6a6542fd0]\n/home/embray/src/sagemath/sage/local/lib/python3.6/site-packages/cysignals/signals.cpython-36m-x86_64-linux-gnu.so(+0x9deb)[0x7fc69ffdcdeb]\n/home/embray/src/sagemath/sage/local/lib/python3.6/site-packages/sage/rings/integer.cpython-36m-x86_64-linux-gnu.so(+0x16ab6)[0x7fc68bbd0ab6]\n...\n```\n\nI'm not sure what this would possibly have to do with the libgap interface, but it's not outside the realm of possibility.\n\nWhen I re-run the failing test by itself the segfault does not occur :/",
    "created_at": "2021-02-26T16:39:55Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506945",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>
This is nearly ready to go from my point of view, except that when I run the full test suite I get a weird segfault from the Singular interface around here:

```
sage: a = singular(1) ## line 502 ##
sage: _ = singular._expect.sendline('1+')  # unfinished input ## line 503 ##
sage: try:
    alarm(0.5)
    singular._expect_expr('>')  # interrupt this
except KeyboardInterrupt:
    pass ## line 504 ##
Control-C pressed. Interrupting Singular. Please wait a few seconds...
sage: 2*a ## line 513 ##
```

which seems to be emanating from `sage.rings.integer`

```
/home/embray/src/sagemath/sage/local/lib/python3.6/site-packages/cysignals/signals.cpython-36m-x86_64-linux-gnu.so(+0x6a6b)[0x7fc69ffd9a6b]
/home/embray/src/sagemath/sage/local/lib/python3.6/site-packages/cysignals/signals.cpython-36m-x86_64-linux-gnu.so(+0x6c48)[0x7fc69ffd9c48]
/home/embray/src/sagemath/sage/local/lib/python3.6/site-packages/cysignals/signals.cpython-36m-x86_64-linux-gnu.so(+0x9103)[0x7fc69ffdc103]
/lib/x86_64-linux-gnu/libc.so.6(+0x3efd0)[0x7fc6a6542fd0]
/home/embray/src/sagemath/sage/local/lib/python3.6/site-packages/cysignals/signals.cpython-36m-x86_64-linux-gnu.so(+0x9deb)[0x7fc69ffdcdeb]
/home/embray/src/sagemath/sage/local/lib/python3.6/site-packages/sage/rings/integer.cpython-36m-x86_64-linux-gnu.so(+0x16ab6)[0x7fc68bbd0ab6]
...
```

I'm not sure what this would possibly have to do with the libgap interface, but it's not outside the realm of possibility.

When I re-run the failing test by itself the segfault does not occur :/



---

archive/issue_comments_506946.json:
```json
{
    "body": "<a id='comment:14'></a>\nShould #31297 be listed as a dependency?",
    "created_at": "2021-02-27T21:46:04Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506946",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
Should #31297 be listed as a dependency?



---

archive/issue_comments_506947.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [mkoeppe](#comment%3A14):\n> Should #31297 be listed as a dependency?\n\n\nI don't think so.  This supersedes #31297.  Unless anyone has strong feelings that the wrapper approach is better, I think at some point that ticket should be closed in favor of this one.",
    "created_at": "2021-03-02T13:16:43Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506947",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>
Replying to [mkoeppe](#comment%3A14):
> Should #31297 be listed as a dependency?


I don't think so.  This supersedes #31297.  Unless anyone has strong feelings that the wrapper approach is better, I think at some point that ticket should be closed in favor of this one.



---

archive/issue_comments_506948.json:
```json
{
    "body": "<a id='comment:16'></a>\nThanks for the clarification. I have set the milestone of #31297 accordingly.",
    "created_at": "2021-03-02T16:10:21Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506948",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
Thanks for the clarification. I have set the milestone of #31297 accordingly.



---

archive/issue_comments_506949.json:
```json
{
    "body": "<a id='comment:17'></a>\nI fought to make initialization of `PermutationGroupElement` much faster. The following bit reverts it completely when initializing from libgap permutations (using `.ListPerm()` go through the slow Python iteration protocol).\n\n```diff\n@@ -581,31 +576,11 @@ cdef class PermutationGroupElement(MultiplicativeGroupElement):\n             ...\n             ValueError: invalid data to initialize a permutation\n         \"\"\"\n-        cdef UInt2* p2\n-        cdef UInt4* p4\n-        cdef int i\n-        cdef UInt d\n-\n-        if TNUM_OBJ(p.value) == T_PERM2:\n-            d = DEG_PERM2(p.value)\n-            if d > self.n:\n-                d = self.n\n-            else:\n-                for i in range(d, self.n):\n-                    self.perm[i] = i\n-            p2 = CONST_ADDR_PERM2(p.value)\n-            for i in range(d):\n-                self.perm[i] = p2[i]\n-        elif TNUM_OBJ(p.value) == T_PERM4:\n-            d = DEG_PERM4(p.value)\n-            if d > self.n:\n-                d = self.n\n-            else:\n-                for i in range(d, self.n):\n-                    self.perm[i] = i\n-            p4 = CONST_ADDR_PERM4(p.value)\n-            for i in range(d):\n-                self.perm[i] = p4[i]\n+        if isinstance(p, GapPermutation):\n+            try:\n+                self._set_list_images(p.ListPerm(), False)\n+            except AssertionError:\n+                raise ValueError(\"invalid data to initialize a permutation\")\n         else:\n             raise TypeError(\"not a gap permutation\")\n```\nIs there any reason why not use the C API of GAP here?",
    "created_at": "2021-03-02T16:16:02Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506949",
    "user": "https://github.com/videlec"
}
```

<a id='comment:17'></a>
I fought to make initialization of `PermutationGroupElement` much faster. The following bit reverts it completely when initializing from libgap permutations (using `.ListPerm()` go through the slow Python iteration protocol).

```diff
@@ -581,31 +576,11 @@ cdef class PermutationGroupElement(MultiplicativeGroupElement):
             ...
             ValueError: invalid data to initialize a permutation
         """
-        cdef UInt2* p2
-        cdef UInt4* p4
-        cdef int i
-        cdef UInt d
-
-        if TNUM_OBJ(p.value) == T_PERM2:
-            d = DEG_PERM2(p.value)
-            if d > self.n:
-                d = self.n
-            else:
-                for i in range(d, self.n):
-                    self.perm[i] = i
-            p2 = CONST_ADDR_PERM2(p.value)
-            for i in range(d):
-                self.perm[i] = p2[i]
-        elif TNUM_OBJ(p.value) == T_PERM4:
-            d = DEG_PERM4(p.value)
-            if d > self.n:
-                d = self.n
-            else:
-                for i in range(d, self.n):
-                    self.perm[i] = i
-            p4 = CONST_ADDR_PERM4(p.value)
-            for i in range(d):
-                self.perm[i] = p4[i]
+        if isinstance(p, GapPermutation):
+            try:
+                self._set_list_images(p.ListPerm(), False)
+            except AssertionError:
+                raise ValueError("invalid data to initialize a permutation")
         else:
             raise TypeError("not a gap permutation")
```
Is there any reason why not use the C API of GAP here?



---

archive/issue_comments_506950.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [vdelecroix](#comment%3A17):\n> Is there any reason why not use the C API of GAP here?\n\n\nYes, the goal is to do away as much as possible with using undocumented/potentially unstable GAP internals.  The GAP community has shown an interest of late of developing something more of a \"public\" API for using GAP as a library, and I and others from the Sage side have been working with them a lot to develop that.\n\nUnfortunately, one of the \"gaps\" is public APIs for accessing permutation objects efficiently.\n\nI'm glad you brought this up though because I was worried about exactly this change, and was not 100% sure how impactful it was.  Is there an example case you can give me that might show whether or not there is a performance deficit?\n\nI've made other performance improvements that might negate the change, but you are right that when using `ListPerm` it will, in the current code, have to iterate over the GAP List.  Perhaps I can add a C method to `GapPermutation` to do this more efficiently.",
    "created_at": "2021-03-03T10:07:41Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506950",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>
Replying to [vdelecroix](#comment%3A17):
> Is there any reason why not use the C API of GAP here?


Yes, the goal is to do away as much as possible with using undocumented/potentially unstable GAP internals.  The GAP community has shown an interest of late of developing something more of a "public" API for using GAP as a library, and I and others from the Sage side have been working with them a lot to develop that.

Unfortunately, one of the "gaps" is public APIs for accessing permutation objects efficiently.

I'm glad you brought this up though because I was worried about exactly this change, and was not 100% sure how impactful it was.  Is there an example case you can give me that might show whether or not there is a performance deficit?

I've made other performance improvements that might negate the change, but you are right that when using `ListPerm` it will, in the current code, have to iterate over the GAP List.  Perhaps I can add a C method to `GapPermutation` to do this more efficiently.



---

archive/issue_comments_506951.json:
```json
{
    "body": "<a id='comment:19'></a>\nI'll add, if it makes an enormous difference, I can make an exception for now.  It wouldn't be the only exception I've made in the current version of gappy for APIs that are not yet available in the libgap API.  I'll propose some additions to libgap for accessing permutations, and then in gappy provide wrappers that provide the currently missing APIs.",
    "created_at": "2021-03-03T11:56:25Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506951",
    "user": "https://github.com/embray"
}
```

<a id='comment:19'></a>
I'll add, if it makes an enormous difference, I can make an exception for now.  It wouldn't be the only exception I've made in the current version of gappy for APIs that are not yet available in the libgap API.  I'll propose some additions to libgap for accessing permutations, and then in gappy provide wrappers that provide the currently missing APIs.



---

archive/issue_comments_506952.json:
```json
{
    "body": "<a id='comment:20'></a>\nSome more info on the failing Singular test:\n\n```\n#0  0x00007fa76509e6d0 in __GI___waitpid () at /build/glibc-2ORdQG/glibc-2.27/posix/../sysdeps/unix/sysv/linux/waitpid.c:30\n#1  0x00007fa75ea8fad0 in print_enhanced_backtrace () at /tmp/pip-req-build-b0moadh3/build/src/cysignals/implementation.c:563\n#2  0x00007fa75ea8fc10 in sigdie () at /tmp/pip-req-build-b0moadh3/build/src/cysignals/implementation.c:589\n#3  0x00007fa75ea91f31 in sigdie_for_sig () at /tmp/pip-req-build-b0moadh3/build/src/cysignals/implementation.c:164\n#4  0x00007fa75ea91f00 in cysigs_signal_handler () at /tmp/pip-req-build-b0moadh3/build/src/cysignals/implementation.c:262\n#5  0x00007fa7653c8170 in __restore_rt ()\n#6  0x00007fa75ea92ac0 in __pyx_f_9cysignals_7signals_verify_exc_value () at /tmp/pip-req-build-b0moadh3/build/src/cysignals/signals.c:3736\n#7  0x00007fa74a6989f9 in sig_occurred () at /home/embray/src/sagemath/sage/build/pkgs/sagelib/src/sage/modular/arithgroup/congroup.pyx:0\n     1    \"\"\"\n     2    Cython helper functions for congruence subgroups\n     3    \n     4    This file contains optimized Cython implementations of a few functions related\n#8  0x00007fa74a6989f0 in fast_tp_dealloc () at /home/embray/src/sagemath/sage/build/pkgs/sagelib/src/sage/rings/integer.pyx:7423\n  7418        cdef mpz_ptr o_mpz = <mpz_ptr>((<Integer>o).value)\n  7419    \n  7420        # If we are recovering from an interrupt, throw the mpz_t away\n  7421        # without recycling or freeing it because it might be in an\n  7422        # inconsistent state (see Trac #24986).\n> 7423        if sig_occurred() is NULL:\n  7424            if integer_pool_count < integer_pool_size:\n  7425                # Here we free any extra memory used by the mpz_t by\n  7426                # setting it to a single limb.\n  7427                if o_mpz._mp_alloc > 10:\n```\n\nThe [test](https://github.com/sagemath/sage/issues/31404#comment:13) in question is testing an alarm interrupt, so it seems maybe the interrupt is occurring before this `sig_occurred()` check in `fast_tp_dealloc`, which appears to be trying to do what it's supposed to do (don't recycle an `mpz_t` which might be in an inconsistent state).  The rest of the stack trace above this isn't useful since it's using the system Python and I don't have the debugging symbols installed.\n\nA couple weird things about this:\n\n* The segfault appears to be happening inside cysignals itself in `verify_exc_value()`.\n\n* This happens consistently, in the same place, when I run the full test suite on this branch, but I can't seem to reproduce it in any other way, and I can't reproduce it on the current develop branch.",
    "created_at": "2021-03-04T10:05:11Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506952",
    "user": "https://github.com/embray"
}
```

<a id='comment:20'></a>
Some more info on the failing Singular test:

```
#0  0x00007fa76509e6d0 in __GI___waitpid () at /build/glibc-2ORdQG/glibc-2.27/posix/../sysdeps/unix/sysv/linux/waitpid.c:30
#1  0x00007fa75ea8fad0 in print_enhanced_backtrace () at /tmp/pip-req-build-b0moadh3/build/src/cysignals/implementation.c:563
#2  0x00007fa75ea8fc10 in sigdie () at /tmp/pip-req-build-b0moadh3/build/src/cysignals/implementation.c:589
#3  0x00007fa75ea91f31 in sigdie_for_sig () at /tmp/pip-req-build-b0moadh3/build/src/cysignals/implementation.c:164
#4  0x00007fa75ea91f00 in cysigs_signal_handler () at /tmp/pip-req-build-b0moadh3/build/src/cysignals/implementation.c:262
#5  0x00007fa7653c8170 in __restore_rt ()
#6  0x00007fa75ea92ac0 in __pyx_f_9cysignals_7signals_verify_exc_value () at /tmp/pip-req-build-b0moadh3/build/src/cysignals/signals.c:3736
#7  0x00007fa74a6989f9 in sig_occurred () at /home/embray/src/sagemath/sage/build/pkgs/sagelib/src/sage/modular/arithgroup/congroup.pyx:0
     1    """
     2    Cython helper functions for congruence subgroups
     3    
     4    This file contains optimized Cython implementations of a few functions related
#8  0x00007fa74a6989f0 in fast_tp_dealloc () at /home/embray/src/sagemath/sage/build/pkgs/sagelib/src/sage/rings/integer.pyx:7423
  7418        cdef mpz_ptr o_mpz = <mpz_ptr>((<Integer>o).value)
  7419    
  7420        # If we are recovering from an interrupt, throw the mpz_t away
  7421        # without recycling or freeing it because it might be in an
  7422        # inconsistent state (see Trac #24986).
> 7423        if sig_occurred() is NULL:
  7424            if integer_pool_count < integer_pool_size:
  7425                # Here we free any extra memory used by the mpz_t by
  7426                # setting it to a single limb.
  7427                if o_mpz._mp_alloc > 10:
```

The [test](https://github.com/sagemath/sage/issues/31404#comment:13) in question is testing an alarm interrupt, so it seems maybe the interrupt is occurring before this `sig_occurred()` check in `fast_tp_dealloc`, which appears to be trying to do what it's supposed to do (don't recycle an `mpz_t` which might be in an inconsistent state).  The rest of the stack trace above this isn't useful since it's using the system Python and I don't have the debugging symbols installed.

A couple weird things about this:

* The segfault appears to be happening inside cysignals itself in `verify_exc_value()`.

* This happens consistently, in the same place, when I run the full test suite on this branch, but I can't seem to reproduce it in any other way, and I can't reproduce it on the current develop branch.



---

archive/issue_comments_506953.json:
```json
{
    "body": "<a id='comment:21'></a>\nOh cool, just trying things at random, it seems I can reproduce it reliably with\n\n```\n./sage -t --file-iterations=2 src/sage/interfaces/singular.py\n```\n\nfor some reason.",
    "created_at": "2021-03-04T10:19:48Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506953",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>
Oh cool, just trying things at random, it seems I can reproduce it reliably with

```
./sage -t --file-iterations=2 src/sage/interfaces/singular.py
```

for some reason.



---

archive/issue_comments_506954.json:
```json
{
    "body": "<a id='comment:22'></a>\nI opened https://github.com/sagemath/cysignals/issues/126 to track/discuss the cysignals issue.  I wonder if anyone else can reproduce this.  What's weird is that it seems to be pretty deterministic as far as when and how it happens, but hard to get it to happen in the first place, and also appears to be a rare corner case.",
    "created_at": "2021-03-04T17:23:15Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506954",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'></a>
I opened https://github.com/sagemath/cysignals/issues/126 to track/discuss the cysignals issue.  I wonder if anyone else can reproduce this.  What's weird is that it seems to be pretty deterministic as far as when and how it happens, but hard to get it to happen in the first place, and also appears to be a rare corner case.



---

archive/issue_comments_506955.json:
```json
{
    "body": "<a id='comment:23'></a>\nI'm pretty sure that we have seen this failure in the singular interface quite consistently for a while now - thanks for isolating it - I don't think it has anything to do with the present ticket.",
    "created_at": "2021-03-04T17:27:39Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506955",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>
I'm pretty sure that we have seen this failure in the singular interface quite consistently for a while now - thanks for isolating it - I don't think it has anything to do with the present ticket.



---

archive/issue_comments_506956.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [mkoeppe](#comment%3A23):\n> I'm pretty sure that we have seen this failure in the singular interface quite consistently for a while now - thanks for isolating it - I don't think it has anything to do with the present ticket.\n\n\nThanks for pointing that out. I'm glad I'm not the only one.  Apparently this is tracked already in #30945.",
    "created_at": "2021-03-04T17:53:03Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506956",
    "user": "https://github.com/embray"
}
```

<a id='comment:24'></a>
Replying to [mkoeppe](#comment%3A23):
> I'm pretty sure that we have seen this failure in the singular interface quite consistently for a while now - thanks for isolating it - I don't think it has anything to do with the present ticket.


Thanks for pointing that out. I'm glad I'm not the only one.  Apparently this is tracked already in #30945.



---

archive/issue_comments_506957.json:
```json
{
    "body": "**Changing commit** from \"[a87cfbef3b1f287d730c42138680fe59cbffd301](https://github.com/sagemath/sagetrac-mirror/commit/a87cfbef3b1f287d730c42138680fe59cbffd301)\" to \"[24574e9feae3fedf29fe8a2c903b45db701ce083](https://github.com/sagemath/sagetrac-mirror/commit/24574e9feae3fedf29fe8a2c903b45db701ce083)\".",
    "created_at": "2021-03-08T16:33:26Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506957",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a87cfbef3b1f287d730c42138680fe59cbffd301](https://github.com/sagemath/sagetrac-mirror/commit/a87cfbef3b1f287d730c42138680fe59cbffd301)" to "[24574e9feae3fedf29fe8a2c903b45db701ce083](https://github.com/sagemath/sagetrac-mirror/commit/24574e9feae3fedf29fe8a2c903b45db701ce083)".



---

archive/issue_comments_506958.json:
```json
{
    "body": "<a id='comment:25'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/79a8f51fb4e20a415557024c4103d5624c4cea81\">79a8f51</a></td><td><code>Update gappy to v0.1.0a2 which adds MacOS and Cygwin fixes.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2f1443c2faca75985cb6d2d2a9300c9f4662538\">f2f1443</a></td><td><code>Fixes needed for gappy v0.1.0a2 which did away with the libgap_soname</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e69f14648640973b2697b573a576f73c95d2757\">1e69f14</a></td><td><code>Further rework of 45b175e43621795f890204a9cdfb30b524f961fa which</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9efa4a3d53147d9d5c11812b7af7d9f9b1d26323\">9efa4a3</a></td><td><code>Update gappy to v0.1.3a3 with the requisite changes needed to adapt to</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/abe29b25a6ce99f48b2adf745ec71866b3fa7444\">abe29b2</a></td><td><code>A few minor test fixes:</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/28ea0fa0bb12db87b9c539596b67315f23ec3578\">28ea0fa</a></td><td><code>Don't assume that anything with a 'parent' attribute is fully</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9ac9d9eacb88295aebd01fd19aca159d91b7cd7c\">9ac9d9e</a></td><td><code>Deprecate sage.libs.gap.element and convert Sage to use</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9bd39d7412f8fbc29e9a008a5876d88d3e265e19\">9bd39d7</a></td><td><code>Since this code was moved into a function it should use globals() not</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de80b44160fac264e7345ce8123be525575b5d5b\">de80b44</a></td><td><code>Install the gappy docs if SAGE_SPKG_INSTALL_DOCS=yes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/24574e9feae3fedf29fe8a2c903b45db701ce083\">24574e9</a></td><td><code>Various documentation improvements:</code></td></tr></table>\n",
    "created_at": "2021-03-08T16:33:26Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506958",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/79a8f51fb4e20a415557024c4103d5624c4cea81">79a8f51</a></td><td><code>Update gappy to v0.1.0a2 which adds MacOS and Cygwin fixes.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2f1443c2faca75985cb6d2d2a9300c9f4662538">f2f1443</a></td><td><code>Fixes needed for gappy v0.1.0a2 which did away with the libgap_soname</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e69f14648640973b2697b573a576f73c95d2757">1e69f14</a></td><td><code>Further rework of 45b175e43621795f890204a9cdfb30b524f961fa which</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9efa4a3d53147d9d5c11812b7af7d9f9b1d26323">9efa4a3</a></td><td><code>Update gappy to v0.1.3a3 with the requisite changes needed to adapt to</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/abe29b25a6ce99f48b2adf745ec71866b3fa7444">abe29b2</a></td><td><code>A few minor test fixes:</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/28ea0fa0bb12db87b9c539596b67315f23ec3578">28ea0fa</a></td><td><code>Don't assume that anything with a 'parent' attribute is fully</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9ac9d9eacb88295aebd01fd19aca159d91b7cd7c">9ac9d9e</a></td><td><code>Deprecate sage.libs.gap.element and convert Sage to use</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9bd39d7412f8fbc29e9a008a5876d88d3e265e19">9bd39d7</a></td><td><code>Since this code was moved into a function it should use globals() not</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de80b44160fac264e7345ce8123be525575b5d5b">de80b44</a></td><td><code>Install the gappy docs if SAGE_SPKG_INSTALL_DOCS=yes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/24574e9feae3fedf29fe8a2c903b45db701ce083">24574e9</a></td><td><code>Various documentation improvements:</code></td></tr></table>




---

archive/issue_comments_506959.json:
```json
{
    "body": "**Changing commit** from \"[24574e9feae3fedf29fe8a2c903b45db701ce083](https://github.com/sagemath/sagetrac-mirror/commit/24574e9feae3fedf29fe8a2c903b45db701ce083)\" to \"[82a5f02ad12087e2b372ddecd0dd539b35bed4fd](https://github.com/sagemath/sagetrac-mirror/commit/82a5f02ad12087e2b372ddecd0dd539b35bed4fd)\".",
    "created_at": "2021-03-08T17:15:27Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506959",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[24574e9feae3fedf29fe8a2c903b45db701ce083](https://github.com/sagemath/sagetrac-mirror/commit/24574e9feae3fedf29fe8a2c903b45db701ce083)" to "[82a5f02ad12087e2b372ddecd0dd539b35bed4fd](https://github.com/sagemath/sagetrac-mirror/commit/82a5f02ad12087e2b372ddecd0dd539b35bed4fd)".



---

archive/issue_comments_506960.json:
```json
{
    "body": "<a id='comment:26'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82a5f02ad12087e2b372ddecd0dd539b35bed4fd\">82a5f02</a></td><td><code>Replace a few more deprecated libgap.function_factory calls.</code></td></tr></table>\n",
    "created_at": "2021-03-08T17:15:27Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506960",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82a5f02ad12087e2b372ddecd0dd539b35bed4fd">82a5f02</a></td><td><code>Replace a few more deprecated libgap.function_factory calls.</code></td></tr></table>




---

archive/issue_comments_506961.json:
```json
{
    "body": "<a id='comment:27'></a>\nGAP had a new release a week ago:\n\nhttps://www.gap-system.org/Releases/4.11.1.html\n\nDoes gappy work with it?",
    "created_at": "2021-03-11T21:22:22Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506961",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'></a>
GAP had a new release a week ago:

https://www.gap-system.org/Releases/4.11.1.html

Does gappy work with it?



---

archive/issue_comments_506962.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [dimpase](#comment%3A27):\n> GAP had a new release a week ago:\n> \n> https://www.gap-system.org/Releases/4.11.1.html\n> \n> Does gappy work with it?\n\n\nYes, it does.  In fact the new release contains fixes that were motivated by gappy.\n\nOne thing I do need to add on the gappy side now is to either:\n\n1) Remove workarounds that were needed prior to this fixes and just make GAP 4.11.1 the minimum GAP version, or\n\n2) Do some version detection to decide what workarounds to include.\n\nI'm going to try for the latter first.",
    "created_at": "2021-03-12T11:19:51Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506962",
    "user": "https://github.com/embray"
}
```

<a id='comment:28'></a>
Replying to [dimpase](#comment%3A27):
> GAP had a new release a week ago:
> 
> https://www.gap-system.org/Releases/4.11.1.html
> 
> Does gappy work with it?


Yes, it does.  In fact the new release contains fixes that were motivated by gappy.

One thing I do need to add on the gappy side now is to either:

1) Remove workarounds that were needed prior to this fixes and just make GAP 4.11.1 the minimum GAP version, or

2) Do some version detection to decide what workarounds to include.

I'm going to try for the latter first.



---

archive/issue_comments_506963.json:
```json
{
    "body": "<a id='comment:29'></a>\nsee #31498 for GAP upgrade",
    "created_at": "2021-03-15T11:41:46Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506963",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:29'></a>
see #31498 for GAP upgrade



---

archive/issue_comments_506964.json:
```json
{
    "body": "**Work_Issues:** release gappy 0.1.0 final and update spkg version before merging",
    "created_at": "2021-03-29T08:15:22Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506964",
    "user": "https://github.com/embray"
}
```

**Work_Issues:** release gappy 0.1.0 final and update spkg version before merging



---

archive/issue_comments_506965.json:
```json
{
    "body": "**Changing work_issues** from \"release gappy 0.1.0 final and update spkg version before merging\" to \"release gappy 0.1.0 final and update spkg version before merging, test against p_groups_cohomology\".",
    "created_at": "2021-03-29T08:20:46Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506965",
    "user": "https://github.com/embray"
}
```

**Changing work_issues** from "release gappy 0.1.0 final and update spkg version before merging" to "release gappy 0.1.0 final and update spkg version before merging, test against p_groups_cohomology".



---

archive/issue_events_281598.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-05-13T21:10:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31404#event-281598"
}
```



---

archive/issue_events_281599.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-05-13T21:10:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31404#event-281599"
}
```



---

archive/issue_comments_506966.json:
```json
{
    "body": "<a id='comment:32'></a>\nneeds a rebase",
    "created_at": "2021-05-13T21:10:21Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506966",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:32'></a>
needs a rebase



---

archive/issue_comments_506967.json:
```json
{
    "body": "<a id='comment:33'></a>\nHow far along is Sage 9.4 currently?  I've been really wanting to get back to finishing up the first release of gappy and getting it into Sage, but my other projects have been slamming me the last several months :(\n\nI hope by this summer I'll have time to do this, but it can wait for Sage 9.5 if need be...",
    "created_at": "2021-05-20T08:04:45Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506967",
    "user": "https://github.com/embray"
}
```

<a id='comment:33'></a>
How far along is Sage 9.4 currently?  I've been really wanting to get back to finishing up the first release of gappy and getting it into Sage, but my other projects have been slamming me the last several months :(

I hope by this summer I'll have time to do this, but it can wait for Sage 9.5 if need be...



---

archive/issue_comments_506968.json:
```json
{
    "body": "<a id='comment:34'></a>\n9.4 has not yet gotten its 1st beta.",
    "created_at": "2021-05-20T22:10:49Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506968",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'></a>
9.4 has not yet gotten its 1st beta.



---

archive/issue_events_281600.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31404#event-281600"
}
```



---

archive/issue_events_281601.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31404#event-281601"
}
```



---

archive/issue_comments_506969.json:
```json
{
    "body": "<a id='comment:35'></a>\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506969",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>
Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_506970.json:
```json
{
    "body": "<a id='comment:36'></a>\na straighforward rebase over 9.4.beta5 (hopefully correct)\n\n---\n**Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4debcd5eeaf9fc238846eccb2ababcd7e073fff8\">4debcd5</a></td><td><code>Fixes needed for gappy v0.1.0a2 which did away with the libgap_soname</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4e76c23887ac9a706a88f41ea7377ea659f9770\">d4e76c2</a></td><td><code>Further rework of 45b175e43621795f890204a9cdfb30b524f961fa which</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b544ad472fed358d9561775cd7f6768aea6808a8\">b544ad4</a></td><td><code>Update gappy to v0.1.3a3 with the requisite changes needed to adapt to</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c02e750d19d77687dd666e81fa3d6e309b5f2042\">c02e750</a></td><td><code>A few minor test fixes:</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/112d1548fc65dd74b7ebf0afa9ca19301315ac1a\">112d154</a></td><td><code>Don't assume that anything with a 'parent' attribute is fully</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/58a5880073430da49f0af1a0c3ffb334a266bc94\">58a5880</a></td><td><code>Deprecate sage.libs.gap.element and convert Sage to use</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b90c2480946236dabe42ebce5cef86ee624a8ebe\">b90c248</a></td><td><code>Since this code was moved into a function it should use globals() not</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74dfdf8fb5e72e70e5cd77591c6628b4b59279c7\">74dfdf8</a></td><td><code>Install the gappy docs if SAGE_SPKG_INSTALL_DOCS=yes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0e99fca6237afa4ed8c8ab9d1818a2853f8003d\">f0e99fc</a></td><td><code>Various documentation improvements:</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c5c84fbb45342c2c24ed1cd9a5e9c36f412d3336\">c5c84fb</a></td><td><code>Replace a few more deprecated libgap.function_factory calls.</code></td></tr></table>\n",
    "created_at": "2021-07-22T12:13:07Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506970",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'></a>
a straighforward rebase over 9.4.beta5 (hopefully correct)

---
**Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4debcd5eeaf9fc238846eccb2ababcd7e073fff8">4debcd5</a></td><td><code>Fixes needed for gappy v0.1.0a2 which did away with the libgap_soname</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4e76c23887ac9a706a88f41ea7377ea659f9770">d4e76c2</a></td><td><code>Further rework of 45b175e43621795f890204a9cdfb30b524f961fa which</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b544ad472fed358d9561775cd7f6768aea6808a8">b544ad4</a></td><td><code>Update gappy to v0.1.3a3 with the requisite changes needed to adapt to</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c02e750d19d77687dd666e81fa3d6e309b5f2042">c02e750</a></td><td><code>A few minor test fixes:</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/112d1548fc65dd74b7ebf0afa9ca19301315ac1a">112d154</a></td><td><code>Don't assume that anything with a 'parent' attribute is fully</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/58a5880073430da49f0af1a0c3ffb334a266bc94">58a5880</a></td><td><code>Deprecate sage.libs.gap.element and convert Sage to use</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b90c2480946236dabe42ebce5cef86ee624a8ebe">b90c248</a></td><td><code>Since this code was moved into a function it should use globals() not</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74dfdf8fb5e72e70e5cd77591c6628b4b59279c7">74dfdf8</a></td><td><code>Install the gappy docs if SAGE_SPKG_INSTALL_DOCS=yes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0e99fca6237afa4ed8c8ab9d1818a2853f8003d">f0e99fc</a></td><td><code>Various documentation improvements:</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c5c84fbb45342c2c24ed1cd9a5e9c36f412d3336">c5c84fb</a></td><td><code>Replace a few more deprecated libgap.function_factory calls.</code></td></tr></table>




---

archive/issue_comments_506971.json:
```json
{
    "body": "**Changing branch** from \"[u/embray/gappy-without-wrappers](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/gappy-without-wrappers)\" to \"[u/dimpase/gappy-without-wrappers](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/gappy-without-wrappers)\".",
    "created_at": "2021-07-22T12:13:07Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506971",
    "user": "https://github.com/dimpase"
}
```

**Changing branch** from "[u/embray/gappy-without-wrappers](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/gappy-without-wrappers)" to "[u/dimpase/gappy-without-wrappers](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/gappy-without-wrappers)".



---

archive/issue_comments_506972.json:
```json
{
    "body": "**Changing commit** from \"[82a5f02ad12087e2b372ddecd0dd539b35bed4fd](https://github.com/sagemath/sagetrac-mirror/commit/82a5f02ad12087e2b372ddecd0dd539b35bed4fd)\" to \"[c5c84fbb45342c2c24ed1cd9a5e9c36f412d3336](https://github.com/sagemath/sagetrac-mirror/commit/c5c84fbb45342c2c24ed1cd9a5e9c36f412d3336)\".",
    "created_at": "2021-07-22T12:13:07Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506972",
    "user": "https://github.com/dimpase"
}
```

**Changing commit** from "[82a5f02ad12087e2b372ddecd0dd539b35bed4fd](https://github.com/sagemath/sagetrac-mirror/commit/82a5f02ad12087e2b372ddecd0dd539b35bed4fd)" to "[c5c84fbb45342c2c24ed1cd9a5e9c36f412d3336](https://github.com/sagemath/sagetrac-mirror/commit/c5c84fbb45342c2c24ed1cd9a5e9c36f412d3336)".



---

archive/issue_comments_506973.json:
```json
{
    "body": "<a id='comment:37'></a>\nit builds, but starting errors out:\n\n```\ncd \"/home/scratch2/dimpase/sage/sage/src/doc\" && sage-logger -p \"make -j8 doc-html\" /home/scratch2/dimpase/sage/sage/logs/dochtml.log\nmake[3]: Nothing to be done for 'all-sage'.\n[dochtml] make[4]: warning: -jN forced in submake: disabling jobserver mode.\n[dochtml] Traceback (most recent call last):\n[dochtml]   File \"/usr/lib64/python3.8/runpy.py\", line 185, in _run_module_as_main\n[dochtml]     mod_name, mod_spec, code = _get_module_details(mod_name, _Error)\n[dochtml]   File \"/usr/lib64/python3.8/runpy.py\", line 144, in _get_module_details\n[dochtml]     return _get_module_details(pkg_main_name, error)\n[dochtml]   File \"/usr/lib64/python3.8/runpy.py\", line 111, in _get_module_details\n[dochtml]     __import__(pkg_name)\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage_docbuild/__init__.py\", line 57, in <module>\n[dochtml]     import sage.all\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/all.py\", line 130, in <module>\n[dochtml]     from sage.misc.all       import *         # takes a while\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/misc/all.py\", line 90, in <module>\n[dochtml]     from .functional import (additive_order,\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/misc/functional.py\", line 25, in <module>\n[dochtml]     from sage.rings.complex_double import CDF\n[dochtml]   File \"sage/rings/complex_double.pyx\", line 101, in init sage.rings.complex_double (build/cythonized/sage/rings/complex_double.c:25297)\n[dochtml]   File \"sage/rings/complex_mpfr.pyx\", line 200, in sage.rings.complex_mpfr.ComplexField (build/cythonized/sage/rings/complex_mpfr.c:5145)\n[dochtml]   File \"sage/rings/complex_mpfr.pyx\", line 299, in sage.rings.complex_mpfr.ComplexField_class.__init__ (build/cythonized/sage/rings/complex_mpfr.c:5509)\n[dochtml]   File \"sage/rings/complex_mpfr.pyx\", line 3365, in sage.rings.complex_mpfr.RRtoCC.__init__ (build/cythonized/sage/rings/complex_mpfr.c:28414)\n[dochtml]   File \"sage/categories/map.pyx\", line 125, in sage.categories.map.Map.__init__ (build/cythonized/sage/categories/map.c:3579)\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/categories/homset.py\", line 395, in Hom\n[dochtml]     H = Hom(X, Y, category, check=False)\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/categories/homset.py\", line 422, in Hom\n[dochtml]     H = X._Hom_(Y, category)\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/categories/rings.py\", line 422, in _Hom_\n[dochtml]     from sage.rings.homset import RingHomset\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/rings/homset.py\", line 18, in <module>\n[dochtml]     from . import quotient_ring\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/rings/quotient_ring.py\", line 113, in <module>\n[dochtml]     import sage.rings.polynomial.multi_polynomial_ideal\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py\", line 235, in <module>\n[dochtml]     from sage.interfaces.all import (singular as singular_default,\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/interfaces/all.py\", line 10, in <module>\n[dochtml]     from .gap import gap, gap_reset_workspace, set_gap_memory_pool_size, Gap\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/interfaces/gap.py\", line 180, in <module>\n[dochtml]     from .gap_workspace import gap_workspace_file, prepare_workspace_dir\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/interfaces/gap_workspace.py\", line 19, in <module>\n[dochtml]     from sage.env import DOT_SAGE, GAP_SO\n[dochtml] ImportError: cannot import name 'GAP_SO' from 'sage.env' (/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/env.py)\n[dochtml] make -j8 doc-inventory--\n[dochtml] make[5]: warning: -jN forced in submake: disabling jobserver mode.\n[dochtml] cd /home/scratch2/dimpase/sage/sage && ./sage --docbuild --no-pdf-links .o inventory\n[dochtml] Traceback (most recent call last):\n[dochtml]   File \"/usr/lib64/python3.8/runpy.py\", line 185, in _run_module_as_main\n[dochtml]     mod_name, mod_spec, code = _get_module_details(mod_name, _Error)\n[dochtml]   File \"/usr/lib64/python3.8/runpy.py\", line 144, in _get_module_details\n[dochtml]     return _get_module_details(pkg_main_name, error)\n[dochtml]   File \"/usr/lib64/python3.8/runpy.py\", line 111, in _get_module_details\n[dochtml]     __import__(pkg_name)\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage_docbuild/__init__.py\", line 57, in <module>\n[dochtml]     import sage.all\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/all.py\", line 130, in <module>\n[dochtml]     from sage.misc.all       import *         # takes a while\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/misc/all.py\", line 90, in <module>\n[dochtml]     from .functional import (additive_order,\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/misc/functional.py\", line 25, in <module>\n[dochtml]     from sage.rings.complex_double import CDF\n[dochtml]   File \"sage/rings/complex_double.pyx\", line 101, in init sage.rings.complex_double (build/cythonized/sage/rings/complex_double.c:25297)\n[dochtml]   File \"sage/rings/complex_mpfr.pyx\", line 200, in sage.rings.complex_mpfr.ComplexField (build/cythonized/sage/rings/complex_mpfr.c:5145)\n[dochtml]   File \"sage/rings/complex_mpfr.pyx\", line 299, in sage.rings.complex_mpfr.ComplexField_class.__init__ (build/cythonized/sage/rings/complex_mpfr.c:5509)\n[dochtml]   File \"sage/rings/complex_mpfr.pyx\", line 3365, in sage.rings.complex_mpfr.RRtoCC.__init__ (build/cythonized/sage/rings/complex_mpfr.c:28414)\n[dochtml]   File \"sage/categories/map.pyx\", line 125, in sage.categories.map.Map.__init__ (build/cythonized/sage/categories/map.c:3579)\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/categories/homset.py\", line 395, in Hom\n[dochtml]     H = Hom(X, Y, category, check=False)\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/categories/homset.py\", line 422, in Hom\n[dochtml]     H = X._Hom_(Y, category)\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/categories/rings.py\", line 422, in _Hom_\n[dochtml]     from sage.rings.homset import RingHomset\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/rings/homset.py\", line 18, in <module>\n[dochtml]     from . import quotient_ring\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/rings/quotient_ring.py\", line 113, in <module>\n[dochtml]     import sage.rings.polynomial.multi_polynomial_ideal\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py\", line 235, in <module>\n[dochtml]     from sage.interfaces.all import (singular as singular_default,\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/interfaces/all.py\", line 10, in <module>\n[dochtml]     from .gap import gap, gap_reset_workspace, set_gap_memory_pool_size, Gap\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/interfaces/gap.py\", line 180, in <module>\n[dochtml]     from .gap_workspace import gap_workspace_file, prepare_workspace_dir\n[dochtml]   File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/interfaces/gap_workspace.py\", line 19, in <module>\n[dochtml]     from sage.env import DOT_SAGE, GAP_SO\n[dochtml] ImportError: cannot import name 'GAP_SO' from 'sage.env' (/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/env.py)\n[dochtml] make[5]: *** [Makefile:20: doc-inventory--.o] Error 1\n[dochtml] make[4]: *** [Makefile:35: doc-inventory-reference] Error 2\nmake[3]: *** [Makefile:2359: doc-html] Error 2\nmake[2]: *** [Makefile:2245: all-start] Error 2\nmake[2]: Leaving directory '/home/scratch2/dimpase/sage/sage/build/make'\n```\n\nis it something trivial?",
    "created_at": "2021-07-22T12:16:57Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506973",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:37'></a>
it builds, but starting errors out:

```
cd "/home/scratch2/dimpase/sage/sage/src/doc" && sage-logger -p "make -j8 doc-html" /home/scratch2/dimpase/sage/sage/logs/dochtml.log
make[3]: Nothing to be done for 'all-sage'.
[dochtml] make[4]: warning: -jN forced in submake: disabling jobserver mode.
[dochtml] Traceback (most recent call last):
[dochtml]   File "/usr/lib64/python3.8/runpy.py", line 185, in _run_module_as_main
[dochtml]     mod_name, mod_spec, code = _get_module_details(mod_name, _Error)
[dochtml]   File "/usr/lib64/python3.8/runpy.py", line 144, in _get_module_details
[dochtml]     return _get_module_details(pkg_main_name, error)
[dochtml]   File "/usr/lib64/python3.8/runpy.py", line 111, in _get_module_details
[dochtml]     __import__(pkg_name)
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage_docbuild/__init__.py", line 57, in <module>
[dochtml]     import sage.all
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/all.py", line 130, in <module>
[dochtml]     from sage.misc.all       import *         # takes a while
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/misc/all.py", line 90, in <module>
[dochtml]     from .functional import (additive_order,
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/misc/functional.py", line 25, in <module>
[dochtml]     from sage.rings.complex_double import CDF
[dochtml]   File "sage/rings/complex_double.pyx", line 101, in init sage.rings.complex_double (build/cythonized/sage/rings/complex_double.c:25297)
[dochtml]   File "sage/rings/complex_mpfr.pyx", line 200, in sage.rings.complex_mpfr.ComplexField (build/cythonized/sage/rings/complex_mpfr.c:5145)
[dochtml]   File "sage/rings/complex_mpfr.pyx", line 299, in sage.rings.complex_mpfr.ComplexField_class.__init__ (build/cythonized/sage/rings/complex_mpfr.c:5509)
[dochtml]   File "sage/rings/complex_mpfr.pyx", line 3365, in sage.rings.complex_mpfr.RRtoCC.__init__ (build/cythonized/sage/rings/complex_mpfr.c:28414)
[dochtml]   File "sage/categories/map.pyx", line 125, in sage.categories.map.Map.__init__ (build/cythonized/sage/categories/map.c:3579)
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/categories/homset.py", line 395, in Hom
[dochtml]     H = Hom(X, Y, category, check=False)
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/categories/homset.py", line 422, in Hom
[dochtml]     H = X._Hom_(Y, category)
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/categories/rings.py", line 422, in _Hom_
[dochtml]     from sage.rings.homset import RingHomset
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/rings/homset.py", line 18, in <module>
[dochtml]     from . import quotient_ring
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/rings/quotient_ring.py", line 113, in <module>
[dochtml]     import sage.rings.polynomial.multi_polynomial_ideal
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py", line 235, in <module>
[dochtml]     from sage.interfaces.all import (singular as singular_default,
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/interfaces/all.py", line 10, in <module>
[dochtml]     from .gap import gap, gap_reset_workspace, set_gap_memory_pool_size, Gap
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/interfaces/gap.py", line 180, in <module>
[dochtml]     from .gap_workspace import gap_workspace_file, prepare_workspace_dir
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/interfaces/gap_workspace.py", line 19, in <module>
[dochtml]     from sage.env import DOT_SAGE, GAP_SO
[dochtml] ImportError: cannot import name 'GAP_SO' from 'sage.env' (/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/env.py)
[dochtml] make -j8 doc-inventory--
[dochtml] make[5]: warning: -jN forced in submake: disabling jobserver mode.
[dochtml] cd /home/scratch2/dimpase/sage/sage && ./sage --docbuild --no-pdf-links .o inventory
[dochtml] Traceback (most recent call last):
[dochtml]   File "/usr/lib64/python3.8/runpy.py", line 185, in _run_module_as_main
[dochtml]     mod_name, mod_spec, code = _get_module_details(mod_name, _Error)
[dochtml]   File "/usr/lib64/python3.8/runpy.py", line 144, in _get_module_details
[dochtml]     return _get_module_details(pkg_main_name, error)
[dochtml]   File "/usr/lib64/python3.8/runpy.py", line 111, in _get_module_details
[dochtml]     __import__(pkg_name)
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage_docbuild/__init__.py", line 57, in <module>
[dochtml]     import sage.all
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/all.py", line 130, in <module>
[dochtml]     from sage.misc.all       import *         # takes a while
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/misc/all.py", line 90, in <module>
[dochtml]     from .functional import (additive_order,
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/misc/functional.py", line 25, in <module>
[dochtml]     from sage.rings.complex_double import CDF
[dochtml]   File "sage/rings/complex_double.pyx", line 101, in init sage.rings.complex_double (build/cythonized/sage/rings/complex_double.c:25297)
[dochtml]   File "sage/rings/complex_mpfr.pyx", line 200, in sage.rings.complex_mpfr.ComplexField (build/cythonized/sage/rings/complex_mpfr.c:5145)
[dochtml]   File "sage/rings/complex_mpfr.pyx", line 299, in sage.rings.complex_mpfr.ComplexField_class.__init__ (build/cythonized/sage/rings/complex_mpfr.c:5509)
[dochtml]   File "sage/rings/complex_mpfr.pyx", line 3365, in sage.rings.complex_mpfr.RRtoCC.__init__ (build/cythonized/sage/rings/complex_mpfr.c:28414)
[dochtml]   File "sage/categories/map.pyx", line 125, in sage.categories.map.Map.__init__ (build/cythonized/sage/categories/map.c:3579)
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/categories/homset.py", line 395, in Hom
[dochtml]     H = Hom(X, Y, category, check=False)
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/categories/homset.py", line 422, in Hom
[dochtml]     H = X._Hom_(Y, category)
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/categories/rings.py", line 422, in _Hom_
[dochtml]     from sage.rings.homset import RingHomset
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/rings/homset.py", line 18, in <module>
[dochtml]     from . import quotient_ring
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/rings/quotient_ring.py", line 113, in <module>
[dochtml]     import sage.rings.polynomial.multi_polynomial_ideal
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py", line 235, in <module>
[dochtml]     from sage.interfaces.all import (singular as singular_default,
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/interfaces/all.py", line 10, in <module>
[dochtml]     from .gap import gap, gap_reset_workspace, set_gap_memory_pool_size, Gap
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/interfaces/gap.py", line 180, in <module>
[dochtml]     from .gap_workspace import gap_workspace_file, prepare_workspace_dir
[dochtml]   File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/interfaces/gap_workspace.py", line 19, in <module>
[dochtml]     from sage.env import DOT_SAGE, GAP_SO
[dochtml] ImportError: cannot import name 'GAP_SO' from 'sage.env' (/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/env.py)
[dochtml] make[5]: *** [Makefile:20: doc-inventory--.o] Error 1
[dochtml] make[4]: *** [Makefile:35: doc-inventory-reference] Error 2
make[3]: *** [Makefile:2359: doc-html] Error 2
make[2]: *** [Makefile:2245: all-start] Error 2
make[2]: Leaving directory '/home/scratch2/dimpase/sage/sage/build/make'
```

is it something trivial?



---

archive/issue_comments_506974.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2021-07-22T12:17:19Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506974",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_comments_506975.json:
```json
{
    "body": "<a id='comment:39'></a>\nwell:\n\n```\nsrc/sage/interfaces/gap_workspace.py:from sage.env import DOT_SAGE, GAP_SO\n```\nand is not touched by the branch...",
    "created_at": "2021-07-22T15:36:55Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506975",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:39'></a>
well:

```
src/sage/interfaces/gap_workspace.py:from sage.env import DOT_SAGE, GAP_SO
```
and is not touched by the branch...



---

archive/issue_comments_506976.json:
```json
{
    "body": "<a id='comment:40'></a>\nThat use of GAP_SO, which causes the crash, is pretty recent:\n\n```\n$ git show a801e6d85bd\ncommit a801e6d85bd420b60ea75b1671856eb43ac6b18b\nAuthor: Matthias Koeppe <mkoeppe@math.ucdavis.edu>\nDate:   Wed Jun 23 14:50:08 2021 -0700\n\n    src/sage/interfaces/gap_workspace.py: Use hash of GAP_SO to disambiguate the workspace file, not SAGE_LOCAL\n\ndiff --git a/src/sage/interfaces/gap_workspace.py b/src/sage/interfaces/gap_workspace.py\nindex 953dc85116..33a87dd507 100644\n--- a/src/sage/interfaces/gap_workspace.py\n+++ b/src/sage/interfaces/gap_workspace.py\n@@ -16,7 +16,7 @@ Support for (lib)GAP workspace files\n import os\n import time\n import hashlib\n-from sage.env import DOT_SAGE, SAGE_LOCAL\n+from sage.env import DOT_SAGE, GAP_SO\n \n \n def gap_workspace_file(system=\"gap\", name=\"workspace\", dir=None):\n@@ -59,7 +59,10 @@ def gap_workspace_file(system=\"gap\", name=\"workspace\", dir=None):\n     if dir is None:\n         dir = os.path.join(DOT_SAGE, 'gap')\n \n-    h = hashlib.sha1(SAGE_LOCAL.encode('utf-8')).hexdigest()\n+    if GAP_SO:\n+        h = hashlib.sha1(GAP_SO.encode('utf-8')).hexdigest()\n+    else:\n+        h = 'unknown'\n     return os.path.join(dir, '%s-%s-%s' % (system, name, h))\n \n \n```\n\nReverting it allows Sage to start. Matthias, how should this be properly dealt with?",
    "created_at": "2021-07-22T15:42:11Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506976",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:40'></a>
That use of GAP_SO, which causes the crash, is pretty recent:

```
$ git show a801e6d85bd
commit a801e6d85bd420b60ea75b1671856eb43ac6b18b
Author: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date:   Wed Jun 23 14:50:08 2021 -0700

    src/sage/interfaces/gap_workspace.py: Use hash of GAP_SO to disambiguate the workspace file, not SAGE_LOCAL

diff --git a/src/sage/interfaces/gap_workspace.py b/src/sage/interfaces/gap_workspace.py
index 953dc85116..33a87dd507 100644
--- a/src/sage/interfaces/gap_workspace.py
+++ b/src/sage/interfaces/gap_workspace.py
@@ -16,7 +16,7 @@ Support for (lib)GAP workspace files
 import os
 import time
 import hashlib
-from sage.env import DOT_SAGE, SAGE_LOCAL
+from sage.env import DOT_SAGE, GAP_SO
 
 
 def gap_workspace_file(system="gap", name="workspace", dir=None):
@@ -59,7 +59,10 @@ def gap_workspace_file(system="gap", name="workspace", dir=None):
     if dir is None:
         dir = os.path.join(DOT_SAGE, 'gap')
 
-    h = hashlib.sha1(SAGE_LOCAL.encode('utf-8')).hexdigest()
+    if GAP_SO:
+        h = hashlib.sha1(GAP_SO.encode('utf-8')).hexdigest()
+    else:
+        h = 'unknown'
     return os.path.join(dir, '%s-%s-%s' % (system, name, h))
 
 
```

Reverting it allows Sage to start. Matthias, how should this be properly dealt with?



---

archive/issue_comments_506977.json:
```json
{
    "body": "<a id='comment:41'></a>\nApart from this, GAP workspace management is broken:\n\n```\n**********************************************************************\nFile \"src/sage/libs/gap/libgap.pyx\", line 24, in sage.libs.gap.libgap\nFailed example:\n    a = libgap(10)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/doctest/forker.py\", line 718, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/doctest/forker.py\", line 1137, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.libs.gap.libgap[0]>\", line 1, in <module>\n        a = libgap(Integer(10))\n      File \"sage/misc/lazy_import.pyx\", line 362, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:4036)\n        return self.get_object()(*args, **kwds)\n      File \"gappy/core.pyx\", line 691, in gappy.core.Gap.__call__\n        self.initialize()\n      File \"sage/libs/gap/libgap.pyx\", line 274, in sage.libs.gap.libgap.SageGap.initialize (build/cythonized/sage/libs/gap/libgap.c:2786)\n        initializing = Gap.initialize(self)\n      File \"gappy/core.pyx\", line 603, in gappy.core.Gap.initialize\n        self._init_kwargs.update(initialize(\n      File \"gappy/core.pyx\", line 253, in gappy.core.initialize\n        with open(workspace, 'rb'):\n    FileNotFoundError: [Errno 2] No such file or directory: '/home/scratch/dimpase/.sage/gap/libgap-workspace-f048f6ddda94b972db915da793e521b0a11cd05f'\n...\n```",
    "created_at": "2021-07-22T18:12:01Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506977",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:41'></a>
Apart from this, GAP workspace management is broken:

```
**********************************************************************
File "src/sage/libs/gap/libgap.pyx", line 24, in sage.libs.gap.libgap
Failed example:
    a = libgap(10)
Exception raised:
    Traceback (most recent call last):
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.8/site-packages/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.gap.libgap[0]>", line 1, in <module>
        a = libgap(Integer(10))
      File "sage/misc/lazy_import.pyx", line 362, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:4036)
        return self.get_object()(*args, **kwds)
      File "gappy/core.pyx", line 691, in gappy.core.Gap.__call__
        self.initialize()
      File "sage/libs/gap/libgap.pyx", line 274, in sage.libs.gap.libgap.SageGap.initialize (build/cythonized/sage/libs/gap/libgap.c:2786)
        initializing = Gap.initialize(self)
      File "gappy/core.pyx", line 603, in gappy.core.Gap.initialize
        self._init_kwargs.update(initialize(
      File "gappy/core.pyx", line 253, in gappy.core.initialize
        with open(workspace, 'rb'):
    FileNotFoundError: [Errno 2] No such file or directory: '/home/scratch/dimpase/.sage/gap/libgap-workspace-f048f6ddda94b972db915da793e521b0a11cd05f'
...
```



---

archive/issue_comments_506978.json:
```json
{
    "body": "<a id='comment:42'></a>\nReplying to [dimpase](#comment%3A40):\n> That use of GAP_SO, which causes the crash, is pretty recent:\n> \n> ```\n> $ git show a801e6d85bd\n> commit a801e6d85bd420b60ea75b1671856eb43ac6b18b\n> Author: Matthias Koeppe <mkoeppe@math.ucdavis.edu>\n> Date:   Wed Jun 23 14:50:08 2021 -0700\n> \n>     src/sage/interfaces/gap_workspace.py: Use hash of GAP_SO to disambiguate the workspace file, not SAGE_LOCAL\n> \n> diff --git a/src/sage/interfaces/gap_workspace.py b/src/sage/interfaces/gap_workspace.py\n> index 953dc85116..33a87dd507 100644\n> --- a/src/sage/interfaces/gap_workspace.py\n> +++ b/src/sage/interfaces/gap_workspace.py\n> @@ -16,7 +16,7 @@ Support for (lib)GAP workspace files\n>  import os\n>  import time\n>  import hashlib\n> -from sage.env import DOT_SAGE, SAGE_LOCAL\n> +from sage.env import DOT_SAGE, GAP_SO\n>  \n>  \n>  def gap_workspace_file(system=\"gap\", name=\"workspace\", dir=None):\n> @@ -59,7 +59,10 @@ def gap_workspace_file(system=\"gap\", name=\"workspace\", dir=None):\n>      if dir is None:\n>          dir = os.path.join(DOT_SAGE, 'gap')\n>  \n> -    h = hashlib.sha1(SAGE_LOCAL.encode('utf-8')).hexdigest()\n> +    if GAP_SO:\n> +        h = hashlib.sha1(GAP_SO.encode('utf-8')).hexdigest()\n> +    else:\n> +        h = 'unknown'\n>      return os.path.join(dir, '%s-%s-%s' % (system, name, h))\n>  \n>  \n> ```\n> \n> Reverting it allows Sage to start. Matthias, how should this be properly dealt with?\n\n\nI don't have much of an idea about GAP workspaces. Before my change, a unique identifier was obtained keyed to SAGE_LOCAL. I figured this was supposed to somehow capture version dependence. So keying it to `GAP_SO` was my solution to remove the use of SAGE_LOCAL. I suppose any kind of version info of `gappy` would also do the job.",
    "created_at": "2021-07-22T19:20:53Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506978",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>
Replying to [dimpase](#comment%3A40):
> That use of GAP_SO, which causes the crash, is pretty recent:
> 
> ```
> $ git show a801e6d85bd
> commit a801e6d85bd420b60ea75b1671856eb43ac6b18b
> Author: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
> Date:   Wed Jun 23 14:50:08 2021 -0700
> 
>     src/sage/interfaces/gap_workspace.py: Use hash of GAP_SO to disambiguate the workspace file, not SAGE_LOCAL
> 
> diff --git a/src/sage/interfaces/gap_workspace.py b/src/sage/interfaces/gap_workspace.py
> index 953dc85116..33a87dd507 100644
> --- a/src/sage/interfaces/gap_workspace.py
> +++ b/src/sage/interfaces/gap_workspace.py
> @@ -16,7 +16,7 @@ Support for (lib)GAP workspace files
>  import os
>  import time
>  import hashlib
> -from sage.env import DOT_SAGE, SAGE_LOCAL
> +from sage.env import DOT_SAGE, GAP_SO
>  
>  
>  def gap_workspace_file(system="gap", name="workspace", dir=None):
> @@ -59,7 +59,10 @@ def gap_workspace_file(system="gap", name="workspace", dir=None):
>      if dir is None:
>          dir = os.path.join(DOT_SAGE, 'gap')
>  
> -    h = hashlib.sha1(SAGE_LOCAL.encode('utf-8')).hexdigest()
> +    if GAP_SO:
> +        h = hashlib.sha1(GAP_SO.encode('utf-8')).hexdigest()
> +    else:
> +        h = 'unknown'
>      return os.path.join(dir, '%s-%s-%s' % (system, name, h))
>  
>  
> ```
> 
> Reverting it allows Sage to start. Matthias, how should this be properly dealt with?


I don't have much of an idea about GAP workspaces. Before my change, a unique identifier was obtained keyed to SAGE_LOCAL. I figured this was supposed to somehow capture version dependence. So keying it to `GAP_SO` was my solution to remove the use of SAGE_LOCAL. I suppose any kind of version info of `gappy` would also do the job.



---

archive/issue_comments_506979.json:
```json
{
    "body": "<a id='comment:43'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/260c19fc0f32e315a72ab06ad3f1d567e5fd2956\">260c19f</a></td><td><code>Fixes needed for gappy v0.1.0a2 which did away with the libgap_soname</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78a7b7b24a283fa23fb1b576d9a3a2b7df7ce744\">78a7b7b</a></td><td><code>Further rework of 45b175e43621795f890204a9cdfb30b524f961fa which</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a2463d8ddd49906c1a36c53d5aae70d7b612876b\">a2463d8</a></td><td><code>Update gappy to v0.1.3a3 with the requisite changes needed to adapt to</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/58560a96a6cc6d15199c1161f2634d6e8378d509\">58560a9</a></td><td><code>A few minor test fixes:</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b7c0a317d8c97f6dfa87c38159e6967fd6d89eee\">b7c0a31</a></td><td><code>Don't assume that anything with a 'parent' attribute is fully</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb86c3ce8108e9b39f00dcf623bb0ba1402fabad\">fb86c3c</a></td><td><code>Deprecate sage.libs.gap.element and convert Sage to use</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/111760c560afe0f7116536f3b2625cbf25194908\">111760c</a></td><td><code>Since this code was moved into a function it should use globals() not</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/343b898ef5fbb23bfaae248f57391426981f809f\">343b898</a></td><td><code>Install the gappy docs if SAGE_SPKG_INSTALL_DOCS=yes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/42a115cb2f360765fe5bca5ae94f3a33ae3f6078\">42a115c</a></td><td><code>Various documentation improvements:</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/049ec501c8a5fc1d99cd1d9e400823f5ceb2b49b\">049ec50</a></td><td><code>Replace a few more deprecated libgap.function_factory calls.</code></td></tr></table>\n",
    "created_at": "2021-09-04T09:00:53Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506979",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/260c19fc0f32e315a72ab06ad3f1d567e5fd2956">260c19f</a></td><td><code>Fixes needed for gappy v0.1.0a2 which did away with the libgap_soname</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78a7b7b24a283fa23fb1b576d9a3a2b7df7ce744">78a7b7b</a></td><td><code>Further rework of 45b175e43621795f890204a9cdfb30b524f961fa which</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a2463d8ddd49906c1a36c53d5aae70d7b612876b">a2463d8</a></td><td><code>Update gappy to v0.1.3a3 with the requisite changes needed to adapt to</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/58560a96a6cc6d15199c1161f2634d6e8378d509">58560a9</a></td><td><code>A few minor test fixes:</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b7c0a317d8c97f6dfa87c38159e6967fd6d89eee">b7c0a31</a></td><td><code>Don't assume that anything with a 'parent' attribute is fully</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb86c3ce8108e9b39f00dcf623bb0ba1402fabad">fb86c3c</a></td><td><code>Deprecate sage.libs.gap.element and convert Sage to use</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/111760c560afe0f7116536f3b2625cbf25194908">111760c</a></td><td><code>Since this code was moved into a function it should use globals() not</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/343b898ef5fbb23bfaae248f57391426981f809f">343b898</a></td><td><code>Install the gappy docs if SAGE_SPKG_INSTALL_DOCS=yes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/42a115cb2f360765fe5bca5ae94f3a33ae3f6078">42a115c</a></td><td><code>Various documentation improvements:</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/049ec501c8a5fc1d99cd1d9e400823f5ceb2b49b">049ec50</a></td><td><code>Replace a few more deprecated libgap.function_factory calls.</code></td></tr></table>




---

archive/issue_comments_506980.json:
```json
{
    "body": "**Changing commit** from \"[c5c84fbb45342c2c24ed1cd9a5e9c36f412d3336](https://github.com/sagemath/sagetrac-mirror/commit/c5c84fbb45342c2c24ed1cd9a5e9c36f412d3336)\" to \"[049ec501c8a5fc1d99cd1d9e400823f5ceb2b49b](https://github.com/sagemath/sagetrac-mirror/commit/049ec501c8a5fc1d99cd1d9e400823f5ceb2b49b)\".",
    "created_at": "2021-09-04T09:00:53Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506980",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c5c84fbb45342c2c24ed1cd9a5e9c36f412d3336](https://github.com/sagemath/sagetrac-mirror/commit/c5c84fbb45342c2c24ed1cd9a5e9c36f412d3336)" to "[049ec501c8a5fc1d99cd1d9e400823f5ceb2b49b](https://github.com/sagemath/sagetrac-mirror/commit/049ec501c8a5fc1d99cd1d9e400823f5ceb2b49b)".



---

archive/issue_comments_506981.json:
```json
{
    "body": "<a id='comment:44'></a>\nOK, this branch at least builds and it's possible to start Sage, and build docs. Some doctests in `sage.geometry.polyhedron.base` fail, however:\n\n```\n...\nFile \"src/sage/geometry/polyhedron/base.py\", line 10469, in sage.geometry.polyhedron.base.Polyhedron_base.restricted_automorphism_group\nFailed example:\n    P.restricted_automorphism_group(output=\"matrixlist\")[0].is_immutable()\nException raised:\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 1943, in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10347)\n        return cache[k]\n    KeyError: (('matrixlist',), ())\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 718, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1137, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.geometry.polyhedron.base.Polyhedron_base.restricted_automorphism_group[43]>\", line 1, in <module>\n        P.restricted_automorphism_group(output=\"matrixlist\")[Integer(0)].is_immutable()\n      File \"sage/misc/cachefunc.pyx\", line 1948, in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10483)\n        w = self._instance_call(*args, **kwds)\n      File \"sage/misc/cachefunc.pyx\", line 1824, in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:9949)\n        return self.f(self._instance, *args, **kwds)\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/geometry/polyhedron/base.py\", line 10563, in restricted_automorphism_group\n        permgroup = G.automorphism_group(edge_labels=True)\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/graphs/generic_graph.py\", line 22260, in automorphism_group\n        output.append(PermutationGroup(gens=gens, domain=int_to_vertex.values()))\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/groups/perm_gps/permgroup.py\", line 352, in PermutationGroup\n        return PermutationGroup_generic(gens=gens, gap_group=gap_group, domain=domain,\n    NameError: name 'gap_group' is not defined\n**********************************************************************\n4 items had failures:\n   9 of  15 in sage.geometry.polyhedron.base.Polyhedron_base.combinatorial_automorphism_group\n  28 of  45 in sage.geometry.polyhedron.base.Polyhedron_base.restricted_automorphism_group\n   1 of  15 in sage.geometry.polyhedron.base.Polyhedron_base.vertex_facet_graph\n   1 of  10 in sage.geometry.polyhedron.base.Polyhedron_base.vertex_graph\n    [1755 tests, 39 failures, 121.34 s]\n```",
    "created_at": "2021-09-04T09:52:51Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506981",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:44'></a>
OK, this branch at least builds and it's possible to start Sage, and build docs. Some doctests in `sage.geometry.polyhedron.base` fail, however:

```
...
File "src/sage/geometry/polyhedron/base.py", line 10469, in sage.geometry.polyhedron.base.Polyhedron_base.restricted_automorphism_group
Failed example:
    P.restricted_automorphism_group(output="matrixlist")[0].is_immutable()
Exception raised:
    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 1943, in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10347)
        return cache[k]
    KeyError: (('matrixlist',), ())

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.polyhedron.base.Polyhedron_base.restricted_automorphism_group[43]>", line 1, in <module>
        P.restricted_automorphism_group(output="matrixlist")[Integer(0)].is_immutable()
      File "sage/misc/cachefunc.pyx", line 1948, in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10483)
        w = self._instance_call(*args, **kwds)
      File "sage/misc/cachefunc.pyx", line 1824, in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:9949)
        return self.f(self._instance, *args, **kwds)
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/geometry/polyhedron/base.py", line 10563, in restricted_automorphism_group
        permgroup = G.automorphism_group(edge_labels=True)
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/graphs/generic_graph.py", line 22260, in automorphism_group
        output.append(PermutationGroup(gens=gens, domain=int_to_vertex.values()))
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/groups/perm_gps/permgroup.py", line 352, in PermutationGroup
        return PermutationGroup_generic(gens=gens, gap_group=gap_group, domain=domain,
    NameError: name 'gap_group' is not defined
**********************************************************************
4 items had failures:
   9 of  15 in sage.geometry.polyhedron.base.Polyhedron_base.combinatorial_automorphism_group
  28 of  45 in sage.geometry.polyhedron.base.Polyhedron_base.restricted_automorphism_group
   1 of  15 in sage.geometry.polyhedron.base.Polyhedron_base.vertex_facet_graph
   1 of  10 in sage.geometry.polyhedron.base.Polyhedron_base.vertex_graph
    [1755 tests, 39 failures, 121.34 s]
```



---

archive/issue_comments_506982.json:
```json
{
    "body": "<a id='comment:45'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c99fbf4be01a2a47789f22d5d7b57aaf3dff977\">6c99fbf</a></td><td><code>restore preparing PermutationGroup_generic() args</code></td></tr></table>\n",
    "created_at": "2021-09-05T08:21:51Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506982",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c99fbf4be01a2a47789f22d5d7b57aaf3dff977">6c99fbf</a></td><td><code>restore preparing PermutationGroup_generic() args</code></td></tr></table>




---

archive/issue_comments_506983.json:
```json
{
    "body": "**Changing commit** from \"[049ec501c8a5fc1d99cd1d9e400823f5ceb2b49b](https://github.com/sagemath/sagetrac-mirror/commit/049ec501c8a5fc1d99cd1d9e400823f5ceb2b49b)\" to \"[6c99fbf4be01a2a47789f22d5d7b57aaf3dff977](https://github.com/sagemath/sagetrac-mirror/commit/6c99fbf4be01a2a47789f22d5d7b57aaf3dff977)\".",
    "created_at": "2021-09-05T08:21:51Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506983",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[049ec501c8a5fc1d99cd1d9e400823f5ceb2b49b](https://github.com/sagemath/sagetrac-mirror/commit/049ec501c8a5fc1d99cd1d9e400823f5ceb2b49b)" to "[6c99fbf4be01a2a47789f22d5d7b57aaf3dff977](https://github.com/sagemath/sagetrac-mirror/commit/6c99fbf4be01a2a47789f22d5d7b57aaf3dff977)".



---

archive/issue_comments_506984.json:
```json
{
    "body": "<a id='comment:46'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/69feb677af2bc947f3de6bb43af7d57cee7f29fa\">69feb67</a></td><td><code>restore computing GAP_SO</code></td></tr></table>\n",
    "created_at": "2021-09-05T08:36:37Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506984",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/69feb677af2bc947f3de6bb43af7d57cee7f29fa">69feb67</a></td><td><code>restore computing GAP_SO</code></td></tr></table>




---

archive/issue_comments_506985.json:
```json
{
    "body": "**Changing commit** from \"[6c99fbf4be01a2a47789f22d5d7b57aaf3dff977](https://github.com/sagemath/sagetrac-mirror/commit/6c99fbf4be01a2a47789f22d5d7b57aaf3dff977)\" to \"[69feb677af2bc947f3de6bb43af7d57cee7f29fa](https://github.com/sagemath/sagetrac-mirror/commit/69feb677af2bc947f3de6bb43af7d57cee7f29fa)\".",
    "created_at": "2021-09-05T08:36:37Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506985",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6c99fbf4be01a2a47789f22d5d7b57aaf3dff977](https://github.com/sagemath/sagetrac-mirror/commit/6c99fbf4be01a2a47789f22d5d7b57aaf3dff977)" to "[69feb677af2bc947f3de6bb43af7d57cee7f29fa](https://github.com/sagemath/sagetrac-mirror/commit/69feb677af2bc947f3de6bb43af7d57cee7f29fa)".



---

archive/issue_comments_506986.json:
```json
{
    "body": "<a id='comment:47'></a>\nlibgap workspace management is still broken, as can be seen  by removing `~/.sage/gap/` and\nrunning e.g. `sage: libgap(1)` at Sage prompt.\n\n```\nsage: libgap(1)\n---------------------------------------------------------------------------\nFileNotFoundError                         Traceback (most recent call last)\n<ipython-input-1-037524c8c625> in <module>\n----> 1 libgap(Integer(1))\n\n/home/scratch2/dimpase/sage/sage/local/lib64/python3.9/site-packages/sage/misc/lazy_import.pyx in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:4052)()\n    360             True\n    361         \"\"\"\n--> 362         return self.get_object()(*args, **kwds)\n    363\n    364     def __repr__(self):\n\n/home/scratch2/dimpase/sage/sage/local/lib64/python3.9/site-packages/gappy/core.pyx in gappy.core.Gap.__call__()\n    689\n    690         \"\"\"\n--> 691         self.initialize()\n    692         if isinstance(x, GapObj):\n    693             return x\n\n/home/scratch2/dimpase/sage/sage/local/lib64/python3.9/site-packages/sage/libs/gap/libgap.pyx in sage.libs.gap.libgap.SageGap.initialize (build/cythonized/sage/libs/gap/libgap.c:2801)()\n    272         \"\"\"\n    273\n--> 274         initializing = Gap.initialize(self)\n    275\n    276         if initializing:\n\n/home/scratch2/dimpase/sage/sage/local/lib64/python3.9/site-packages/gappy/core.pyx in gappy.core.Gap.initialize()\n    601             return False\n    602\n--> 603         self._init_kwargs.update(initialize(\n    604             gap_root=self._init_kwargs['gap_root'],\n    605             gaprc=self._init_kwargs['gaprc'],\n\n/home/scratch2/dimpase/sage/sage/local/lib64/python3.9/site-packages/gappy/core.pyx in gappy.core.initialize()\n    251         workspace = os.path.normpath(workspace)\n    252\n--> 253         with open(workspace, 'rb'):\n    254             pass\n    255\n\nFileNotFoundError: [Errno 2] No such file or directory: '/home/scratch/dimpase/.sage/gap/libgap-workspace-c357604137f37c963401793ca1ab74cce6c00efd'\n```",
    "created_at": "2021-09-05T20:55:18Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506986",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:47'></a>
libgap workspace management is still broken, as can be seen  by removing `~/.sage/gap/` and
running e.g. `sage: libgap(1)` at Sage prompt.

```
sage: libgap(1)
---------------------------------------------------------------------------
FileNotFoundError                         Traceback (most recent call last)
<ipython-input-1-037524c8c625> in <module>
----> 1 libgap(Integer(1))

/home/scratch2/dimpase/sage/sage/local/lib64/python3.9/site-packages/sage/misc/lazy_import.pyx in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:4052)()
    360             True
    361         """
--> 362         return self.get_object()(*args, **kwds)
    363
    364     def __repr__(self):

/home/scratch2/dimpase/sage/sage/local/lib64/python3.9/site-packages/gappy/core.pyx in gappy.core.Gap.__call__()
    689
    690         """
--> 691         self.initialize()
    692         if isinstance(x, GapObj):
    693             return x

/home/scratch2/dimpase/sage/sage/local/lib64/python3.9/site-packages/sage/libs/gap/libgap.pyx in sage.libs.gap.libgap.SageGap.initialize (build/cythonized/sage/libs/gap/libgap.c:2801)()
    272         """
    273
--> 274         initializing = Gap.initialize(self)
    275
    276         if initializing:

/home/scratch2/dimpase/sage/sage/local/lib64/python3.9/site-packages/gappy/core.pyx in gappy.core.Gap.initialize()
    601             return False
    602
--> 603         self._init_kwargs.update(initialize(
    604             gap_root=self._init_kwargs['gap_root'],
    605             gaprc=self._init_kwargs['gaprc'],

/home/scratch2/dimpase/sage/sage/local/lib64/python3.9/site-packages/gappy/core.pyx in gappy.core.initialize()
    251         workspace = os.path.normpath(workspace)
    252
--> 253         with open(workspace, 'rb'):
    254             pass
    255

FileNotFoundError: [Errno 2] No such file or directory: '/home/scratch/dimpase/.sage/gap/libgap-workspace-c357604137f37c963401793ca1ab74cce6c00efd'
```



---

archive/issue_comments_506987.json:
```json
{
    "body": "<a id='comment:48'></a>\nI see how the workspace issue can be fixed, but it might need a change in `gappy` - I opened https://github.com/embray/gappy/issues/16 to discuss.",
    "created_at": "2021-09-05T22:18:26Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506987",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:48'></a>
I see how the workspace issue can be fixed, but it might need a change in `gappy` - I opened https://github.com/embray/gappy/issues/16 to discuss.



---

archive/issue_comments_506988.json:
```json
{
    "body": "**Upstream:** Reported upstream. No feedback yet.",
    "created_at": "2021-09-05T22:18:26Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506988",
    "user": "https://github.com/dimpase"
}
```

**Upstream:** Reported upstream. No feedback yet.



---

archive/issue_comments_506989.json:
```json
{
    "body": "<a id='comment:49'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1b5adee47a11523397f105787e254d49210b9a02\">1b5adee</a></td><td><code>gappy PR#17 patch; uses it to handle workspaces</code></td></tr></table>\n",
    "created_at": "2021-09-06T10:16:43Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506989",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1b5adee47a11523397f105787e254d49210b9a02">1b5adee</a></td><td><code>gappy PR#17 patch; uses it to handle workspaces</code></td></tr></table>




---

archive/issue_comments_506990.json:
```json
{
    "body": "**Changing commit** from \"[69feb677af2bc947f3de6bb43af7d57cee7f29fa](https://github.com/sagemath/sagetrac-mirror/commit/69feb677af2bc947f3de6bb43af7d57cee7f29fa)\" to \"[1b5adee47a11523397f105787e254d49210b9a02](https://github.com/sagemath/sagetrac-mirror/commit/1b5adee47a11523397f105787e254d49210b9a02)\".",
    "created_at": "2021-09-06T10:16:43Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506990",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[69feb677af2bc947f3de6bb43af7d57cee7f29fa](https://github.com/sagemath/sagetrac-mirror/commit/69feb677af2bc947f3de6bb43af7d57cee7f29fa)" to "[1b5adee47a11523397f105787e254d49210b9a02](https://github.com/sagemath/sagetrac-mirror/commit/1b5adee47a11523397f105787e254d49210b9a02)".



---

archive/issue_comments_506991.json:
```json
{
    "body": "**Changing reviewer** from \"Dima Pasechnik\" to \"Dima Pasechnik, ...\".",
    "created_at": "2021-09-06T10:18:34Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506991",
    "user": "https://github.com/dimpase"
}
```

**Changing reviewer** from "Dima Pasechnik" to "Dima Pasechnik, ...".



---

archive/issue_events_281602.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-09-06T10:18:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31404#event-281602"
}
```



---

archive/issue_events_281603.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-09-06T10:18:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31404#event-281603"
}
```



---

archive/issue_comments_506992.json:
```json
{
    "body": "<a id='comment:50'></a>\nwe still need to carefully check that GAP workspace rotation is not broken, but hopefully not.",
    "created_at": "2021-09-06T10:18:34Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506992",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:50'></a>
we still need to carefully check that GAP workspace rotation is not broken, but hopefully not.



---

archive/issue_comments_506993.json:
```json
{
    "body": "<a id='comment:51'></a>\na couple of test failures I can't quite make sense of. The 1st one has something to do with \n`cachefunc`, categories, etc...\n\n```\nFile \"src/sage/groups/perm_gps/permgroup_morphism.py\", line 119, in sage.groups.perm_gps.permgroup_morphism.PermutationGroupMorphism.image\nFailed example:\n    h = D4.isomorphism_to(G)\nException raised:\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 1943, in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10347)\n        return cache[k]\n    KeyError: ((<SageGap(gap_root='/mnt/opt/Sage/sage-dev/local/share/gap')>,), ())\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"sage/structure/category_object.pyx\", line 839, in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:7089)\n        return self.__cached_methods[name]\n    KeyError: '_pari_nf'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/rings/number_field/number_field.py\", line 4348, in pari_nf\n        return self._pari_nf\n      File \"sage/structure/category_object.pyx\", line 833, in sage.structure.category_object.CategoryObject.__getattr__ (build/cythonized/sage/structure/category_object.c:7008)\n        return self.getattr_from_category(name)\n      File \"sage/structure/category_object.pyx\", line 848, in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:7174)\n        attr = getattr_from_other_class(self, cls, name)\n      File \"sage/cpython/getattr.pyx\", line 367, in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2566)\n        raise AttributeError(dummy_error_message)\n    AttributeError: 'NumberField_absolute_with_category' object has no attribute '_cache___pari_absolute_structure'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 718, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1137, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.groups.perm_gps.permgroup_morphism.PermutationGroupMorphism.image[17]>\", line 1, in <module>\n        h = D4.isomorphism_to(G)\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/groups/perm_gps/permgroup.py\", line 4076, in isomorphism_to\n        iso = self._libgap_().IsomorphismGroups(right)\n      File \"gappy/gapobj.pyx\", line 2773, in gappy.gapobj.GapMethodProxy.__call__\n        return self.func.__call__(self.self, *args)\n      File \"gappy/gapobj.pyx\", line 2489, in gappy.gapobj.GapFunction.__call__\n        sig_on()\n    SystemError: calling remove_from_pari_stack() inside sig_on()\n```\n\n\nThe 2nd one is even less explicit, with a mysterious\n`SyntaxWarning: 'tuple' object is not callable; perhaps you missed a comma?`\ncoming from somewhere I don't see\n\n```\nFile \"src/sage/groups/perm_gps/permgroup.py\", line 614, in sage.groups.perm_gps.permgroup.PermutationGroup_generic.gap\nFailed example:\n    gap(P8) == P8.gap()\nExpected:\n    True\nGot:\n    doctest:warning\n      File \"/mnt/opt/Sage/sage-dev/src/bin/sage-runtests\", line 144, in <module>\n        err = DC.run()\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/control.py\", line 1207, in run\n        self.run_doctests()\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/control.py\", line 909, in run_doctests\n        self.dispatcher.dispatch()\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 2044, in dispatch\n        self.parallel_dispatch()\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1939, in parallel_dispatch\n        w.start()  # This might take some time\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 2211, in start\n        super(DocTestWorker, self).start()\n      File \"/usr/lib/python3.8/multiprocessing/process.py\", line 121, in start\n        self._popen = self._Popen(self)\n      File \"/usr/lib/python3.8/multiprocessing/context.py\", line 224, in _Popen\n        return _default_context.get_context().Process._Popen(process_obj)\n      File \"/usr/lib/python3.8/multiprocessing/context.py\", line 277, in _Popen\n        return Popen(process_obj)\n      File \"/usr/lib/python3.8/multiprocessing/popen_fork.py\", line 19, in __init__\n        self._launch(process_obj)\n      File \"/usr/lib/python3.8/multiprocessing/popen_fork.py\", line 75, in _launch\n        code = process_obj._bootstrap(parent_sentinel=child_r)\n      File \"/usr/lib/python3.8/multiprocessing/process.py\", line 315, in _bootstrap\n        self.run()\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 2183, in run\n        task(self.options, self.outtmpfile, msgpipe, self.result_queue)\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 2512, in __call__\n        doctests, extras = self._run(runner, options, results)\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 2559, in _run\n        result = runner.run(test)\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 910, in run\n        return self._run(test, compileflags, out)\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 718, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1137, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.groups.perm_gps.permgroup.PermutationGroup_generic.gap[2]>\", line 1, in <module>\n        gap(P8) == P8.gap()\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/interfaces/interface.py\", line 1082, in _sage_\n        return sage.misc.sage_eval.sage_eval(string)\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/misc/sage_eval.py\", line 201, in sage_eval\n        return eval(source, sage.all.__dict__, locals)\n      File \"/usr/lib/python3.8/warnings.py\", line 109, in _showwarnmsg\n        sw(msg.message, msg.category, msg.filename, msg.lineno,\n    :\n    SyntaxWarning: 'tuple' object is not callable; perhaps you missed a comma?\n    doctest:warning\n      File \"/mnt/opt/Sage/sage-dev/src/bin/sage-runtests\", line 144, in <module>\n        err = DC.run()\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/control.py\", line 1207, in run\n        self.run_doctests()\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/control.py\", line 909, in run_doctests\n        self.dispatcher.dispatch()\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 2044, in dispatch\n        self.parallel_dispatch()\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1939, in parallel_dispatch\n        w.start()  # This might take some time\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 2211, in start\n        super(DocTestWorker, self).start()\n      File \"/usr/lib/python3.8/multiprocessing/process.py\", line 121, in start\n        self._popen = self._Popen(self)\n      File \"/usr/lib/python3.8/multiprocessing/context.py\", line 224, in _Popen\n        return _default_context.get_context().Process._Popen(process_obj)\n      File \"/usr/lib/python3.8/multiprocessing/context.py\", line 277, in _Popen\n        return Popen(process_obj)\n      File \"/usr/lib/python3.8/multiprocessing/popen_fork.py\", line 19, in __init__\n        self._launch(process_obj)\n      File \"/usr/lib/python3.8/multiprocessing/popen_fork.py\", line 75, in _launch\n        code = process_obj._bootstrap(parent_sentinel=child_r)\n      File \"/usr/lib/python3.8/multiprocessing/process.py\", line 315, in _bootstrap\n        self.run()\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 2183, in run\n        task(self.options, self.outtmpfile, msgpipe, self.result_queue)\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 2512, in __call__\n        doctests, extras = self._run(runner, options, results)\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 2559, in _run\n        result = runner.run(test)\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 910, in run\n        return self._run(test, compileflags, out)\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 718, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1137, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.groups.perm_gps.permgroup.PermutationGroup_generic.gap[2]>\", line 1, in <module>\n        gap(P8) == P8.gap()\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/interfaces/interface.py\", line 1082, in _sage_\n        return sage.misc.sage_eval.sage_eval(string)\n      File \"/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/misc/sage_eval.py\", line 201, in sage_eval\n        return eval(source, sage.all.__dict__, locals)\n      File \"/usr/lib/python3.8/warnings.py\", line 109, in _showwarnmsg\n        sw(msg.message, msg.category, msg.filename, msg.lineno,\n    :\n    SyntaxWarning: 'tuple' object is not callable; perhaps you missed a comma?\n    True\n```",
    "created_at": "2021-09-10T08:56:36Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506993",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:51'></a>
a couple of test failures I can't quite make sense of. The 1st one has something to do with 
`cachefunc`, categories, etc...

```
File "src/sage/groups/perm_gps/permgroup_morphism.py", line 119, in sage.groups.perm_gps.permgroup_morphism.PermutationGroupMorphism.image
Failed example:
    h = D4.isomorphism_to(G)
Exception raised:
    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 1943, in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10347)
        return cache[k]
    KeyError: ((<SageGap(gap_root='/mnt/opt/Sage/sage-dev/local/share/gap')>,), ())

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "sage/structure/category_object.pyx", line 839, in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:7089)
        return self.__cached_methods[name]
    KeyError: '_pari_nf'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/rings/number_field/number_field.py", line 4348, in pari_nf
        return self._pari_nf
      File "sage/structure/category_object.pyx", line 833, in sage.structure.category_object.CategoryObject.__getattr__ (build/cythonized/sage/structure/category_object.c:7008)
        return self.getattr_from_category(name)
      File "sage/structure/category_object.pyx", line 848, in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:7174)
        attr = getattr_from_other_class(self, cls, name)
      File "sage/cpython/getattr.pyx", line 367, in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2566)
        raise AttributeError(dummy_error_message)
    AttributeError: 'NumberField_absolute_with_category' object has no attribute '_cache___pari_absolute_structure'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.groups.perm_gps.permgroup_morphism.PermutationGroupMorphism.image[17]>", line 1, in <module>
        h = D4.isomorphism_to(G)
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/groups/perm_gps/permgroup.py", line 4076, in isomorphism_to
        iso = self._libgap_().IsomorphismGroups(right)
      File "gappy/gapobj.pyx", line 2773, in gappy.gapobj.GapMethodProxy.__call__
        return self.func.__call__(self.self, *args)
      File "gappy/gapobj.pyx", line 2489, in gappy.gapobj.GapFunction.__call__
        sig_on()
    SystemError: calling remove_from_pari_stack() inside sig_on()
```


The 2nd one is even less explicit, with a mysterious
`SyntaxWarning: 'tuple' object is not callable; perhaps you missed a comma?`
coming from somewhere I don't see

```
File "src/sage/groups/perm_gps/permgroup.py", line 614, in sage.groups.perm_gps.permgroup.PermutationGroup_generic.gap
Failed example:
    gap(P8) == P8.gap()
Expected:
    True
Got:
    doctest:warning
      File "/mnt/opt/Sage/sage-dev/src/bin/sage-runtests", line 144, in <module>
        err = DC.run()
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/control.py", line 1207, in run
        self.run_doctests()
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/control.py", line 909, in run_doctests
        self.dispatcher.dispatch()
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 2044, in dispatch
        self.parallel_dispatch()
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 1939, in parallel_dispatch
        w.start()  # This might take some time
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 2211, in start
        super(DocTestWorker, self).start()
      File "/usr/lib/python3.8/multiprocessing/process.py", line 121, in start
        self._popen = self._Popen(self)
      File "/usr/lib/python3.8/multiprocessing/context.py", line 224, in _Popen
        return _default_context.get_context().Process._Popen(process_obj)
      File "/usr/lib/python3.8/multiprocessing/context.py", line 277, in _Popen
        return Popen(process_obj)
      File "/usr/lib/python3.8/multiprocessing/popen_fork.py", line 19, in __init__
        self._launch(process_obj)
      File "/usr/lib/python3.8/multiprocessing/popen_fork.py", line 75, in _launch
        code = process_obj._bootstrap(parent_sentinel=child_r)
      File "/usr/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
        self.run()
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 2183, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 2512, in __call__
        doctests, extras = self._run(runner, options, results)
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 2559, in _run
        result = runner.run(test)
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 910, in run
        return self._run(test, compileflags, out)
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.groups.perm_gps.permgroup.PermutationGroup_generic.gap[2]>", line 1, in <module>
        gap(P8) == P8.gap()
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/interfaces/interface.py", line 1082, in _sage_
        return sage.misc.sage_eval.sage_eval(string)
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/misc/sage_eval.py", line 201, in sage_eval
        return eval(source, sage.all.__dict__, locals)
      File "/usr/lib/python3.8/warnings.py", line 109, in _showwarnmsg
        sw(msg.message, msg.category, msg.filename, msg.lineno,
    :
    SyntaxWarning: 'tuple' object is not callable; perhaps you missed a comma?
    doctest:warning
      File "/mnt/opt/Sage/sage-dev/src/bin/sage-runtests", line 144, in <module>
        err = DC.run()
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/control.py", line 1207, in run
        self.run_doctests()
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/control.py", line 909, in run_doctests
        self.dispatcher.dispatch()
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 2044, in dispatch
        self.parallel_dispatch()
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 1939, in parallel_dispatch
        w.start()  # This might take some time
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 2211, in start
        super(DocTestWorker, self).start()
      File "/usr/lib/python3.8/multiprocessing/process.py", line 121, in start
        self._popen = self._Popen(self)
      File "/usr/lib/python3.8/multiprocessing/context.py", line 224, in _Popen
        return _default_context.get_context().Process._Popen(process_obj)
      File "/usr/lib/python3.8/multiprocessing/context.py", line 277, in _Popen
        return Popen(process_obj)
      File "/usr/lib/python3.8/multiprocessing/popen_fork.py", line 19, in __init__
        self._launch(process_obj)
      File "/usr/lib/python3.8/multiprocessing/popen_fork.py", line 75, in _launch
        code = process_obj._bootstrap(parent_sentinel=child_r)
      File "/usr/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
        self.run()
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 2183, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 2512, in __call__
        doctests, extras = self._run(runner, options, results)
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 2559, in _run
        result = runner.run(test)
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 910, in run
        return self._run(test, compileflags, out)
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.groups.perm_gps.permgroup.PermutationGroup_generic.gap[2]>", line 1, in <module>
        gap(P8) == P8.gap()
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/interfaces/interface.py", line 1082, in _sage_
        return sage.misc.sage_eval.sage_eval(string)
      File "/mnt/opt/Sage/sage-dev/local/lib/python3.8/site-packages/sage/misc/sage_eval.py", line 201, in sage_eval
        return eval(source, sage.all.__dict__, locals)
      File "/usr/lib/python3.8/warnings.py", line 109, in _showwarnmsg
        sw(msg.message, msg.category, msg.filename, msg.lineno,
    :
    SyntaxWarning: 'tuple' object is not callable; perhaps you missed a comma?
    True
```



---

archive/issue_comments_506994.json:
```json
{
    "body": "<a id='comment:52'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3f1d051757a0e9fa35b6bb04c0a93d606e080d13\">3f1d051</a></td><td><code>make invocation of _libgap_() explicit</code></td></tr></table>\n",
    "created_at": "2021-09-10T12:40:07Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506994",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:52'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3f1d051757a0e9fa35b6bb04c0a93d606e080d13">3f1d051</a></td><td><code>make invocation of _libgap_() explicit</code></td></tr></table>




---

archive/issue_comments_506995.json:
```json
{
    "body": "**Changing commit** from \"[1b5adee47a11523397f105787e254d49210b9a02](https://github.com/sagemath/sagetrac-mirror/commit/1b5adee47a11523397f105787e254d49210b9a02)\" to \"[3f1d051757a0e9fa35b6bb04c0a93d606e080d13](https://github.com/sagemath/sagetrac-mirror/commit/3f1d051757a0e9fa35b6bb04c0a93d606e080d13)\".",
    "created_at": "2021-09-10T12:40:07Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506995",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1b5adee47a11523397f105787e254d49210b9a02](https://github.com/sagemath/sagetrac-mirror/commit/1b5adee47a11523397f105787e254d49210b9a02)" to "[3f1d051757a0e9fa35b6bb04c0a93d606e080d13](https://github.com/sagemath/sagetrac-mirror/commit/3f1d051757a0e9fa35b6bb04c0a93d606e080d13)".



---

archive/issue_comments_506996.json:
```json
{
    "body": "<a id='comment:53'></a>\nI still wouldn't move forward on this too much until I have a first release of gappy out.  I haven't had time to work on it in several months, so it's probably fallen a bit behind the last GAP releases (and can probably drop some workarounds for older GAP versions).\n\nOther than that there isn't too much holding up making a gappy release--I think, as you found, some of the workspace management stuff, and some of the global namespace stuff from Sage's libgap needs to be worked into it better.",
    "created_at": "2021-09-13T09:30:08Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506996",
    "user": "https://github.com/embray"
}
```

<a id='comment:53'></a>
I still wouldn't move forward on this too much until I have a first release of gappy out.  I haven't had time to work on it in several months, so it's probably fallen a bit behind the last GAP releases (and can probably drop some workarounds for older GAP versions).

Other than that there isn't too much holding up making a gappy release--I think, as you found, some of the workspace management stuff, and some of the global namespace stuff from Sage's libgap needs to be worked into it better.



---

archive/issue_events_281604.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31404#event-281604"
}
```



---

archive/issue_events_281605.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31404#event-281605"
}
```



---

archive/issue_comments_506997.json:
```json
{
    "body": "<a id='comment:54'></a>\nStalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506997",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:54'></a>
Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.



---

archive/issue_comments_506998.json:
```json
{
    "body": "<a id='comment:55'></a>\nSee also: #33072.",
    "created_at": "2022-01-12T14:26:38Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506998",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:55'></a>
See also: #33072.



---

archive/issue_comments_506999.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,12 @@\n+From [the gappy README](https://github.com/embray/gappy#gappy--a-python-interface-to-gap):\n+\n+> gappy provides a Python interface to the GAP\n+> computer algebra system by linking to its\n+> library interface.\n+\n+\n This is a follow-up to #31297, particularly inspired by [#31297 comment:17](https://github.com/sagemath/sage/issues/31297#comment:17).  It is a more disruptive change, in that instead of providing wrappers around gappy that are Sage Parents and Elements, it follows the example of cypari2 and just uses gappy more-or-less directly without any wrappers.\n \n It remains completely agnostic to the coercion system, though I am not completely happy with this state of affairs.  In particular you can see I had to add a special case to `Polynomial.__call__` for handling evaluating polynomials on `GapObj`s, a case that used to work fine, but now needs a special case since other Sage types cannot be coerced to `GapObj`s.\n \n-Also had to add special cases for instantiating Integers and Rationals from GapObjs, but on the plus side this is now a bit faster.\n+Also had to add special cases for instantiating `Integer`s and `Rational`s from `GapObj`s, but on the plus side this is now a bit faster.\n``````\n",
    "created_at": "2022-01-25T09:04:26Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-506999",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,12 @@
+From [the gappy README](https://github.com/embray/gappy#gappy--a-python-interface-to-gap):
+
+> gappy provides a Python interface to the GAP
+> computer algebra system by linking to its
+> library interface.
+
+
 This is a follow-up to #31297, particularly inspired by [#31297 comment:17](https://github.com/sagemath/sage/issues/31297#comment:17).  It is a more disruptive change, in that instead of providing wrappers around gappy that are Sage Parents and Elements, it follows the example of cypari2 and just uses gappy more-or-less directly without any wrappers.
 
 It remains completely agnostic to the coercion system, though I am not completely happy with this state of affairs.  In particular you can see I had to add a special case to `Polynomial.__call__` for handling evaluating polynomials on `GapObj`s, a case that used to work fine, but now needs a special case since other Sage types cannot be coerced to `GapObj`s.
 
-Also had to add special cases for instantiating Integers and Rationals from GapObjs, but on the plus side this is now a bit faster.
+Also had to add special cases for instantiating `Integer`s and `Rational`s from `GapObj`s, but on the plus side this is now a bit faster.
``````




---

archive/issue_events_281606.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-02-07T14:45:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31404#event-281606"
}
```



---

archive/issue_events_281607.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-02-07T14:45:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31404#event-281607"
}
```



---

archive/issue_comments_507000.json:
```json
{
    "body": "<a id='comment:57'></a>\nMoving to \"needs work,\" as there's nothing to review at the moment (we're waiting for an upstream gappy release).",
    "created_at": "2022-02-07T14:45:11Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-507000",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:57'></a>
Moving to "needs work," as there's nothing to review at the moment (we're waiting for an upstream gappy release).



---

archive/issue_comments_507001.json:
```json
{
    "body": "<a id='comment:58'></a>\nUpstream changed  jobs recently, not sure if an update will be soon...",
    "created_at": "2022-02-07T14:55:45Z",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31404#issuecomment-507001",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:58'></a>
Upstream changed  jobs recently, not sure if an update will be soon...



---

archive/issue_events_281608.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T01:55:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31404#event-281608"
}
```



---

archive/issue_events_281609.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T01:55:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31404#event-281609"
}
```



---

archive/issue_events_281610.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-10T18:47:00Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31404#event-281610"
}
```



---

archive/issue_events_281611.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-10T18:47:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31404",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31404#event-281611"
}
```
