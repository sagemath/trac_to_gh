# Issue 31985: WQSym.M().basis(3) is broken

archive/issues_031748.json:
```json
{
    "body": "Attached is a *minimal* fix, which defines\n\n```\ndef subset(self, size=None, **kwargs)\n```\nfor the classes `OrderedSetPartitions_all` and `SetPartitions_all`. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.\n\n---\n\nThis should return a basis for the degree-3 component of WQSym (and yes, it is finite):\n\n```\nsage: WQSym = algebras.WQSym(QQ)\nsage: M = WQSym.M()\nsage: M.basis(3)\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\n~/sage/local/lib/python3.6/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10303)()\n   1942             try:\n-> 1943                 return cache[k]\n   1944             except TypeError:  # k is not hashable\n\nKeyError: ((3,), ())\n\nDuring handling of the above exception, another exception occurred:\n\nKeyError                                  Traceback (most recent call last)\n~/sage/local/lib/python3.6/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:7074)()\n    838         try:\n--> 839             return self.__cached_methods[name]\n    840         except KeyError:\n\nKeyError: 'subset'\n\nDuring handling of the above exception, another exception occurred:\n\nAttributeError                            Traceback (most recent call last)\n~/sage/local/lib/python3.6/site-packages/sage/categories/filtered_modules_with_basis.py in homogeneous_component_basis(self, d)\n    214             try:\n--> 215                 S = self._indices.subset(size=d)\n    216             except (AttributeError, ValueError, TypeError):\n\n~/sage/local/lib/python3.6/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.CategoryObject.__getattr__ (build/cythonized/sage/structure/category_object.c:6993)()\n    832         \"\"\"\n--> 833         return self.getattr_from_category(name)\n    834\n\n~/sage/local/lib/python3.6/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:7159)()\n    847\n--> 848             attr = getattr_from_other_class(self, cls, name)\n    849             self.__cached_methods[name] = attr\n\n~/sage/local/lib/python3.6/site-packages/sage/cpython/getattr.pyx in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2551)()\n    366         dummy_error_message.name = name\n--> 367         raise AttributeError(dummy_error_message)\n    368     cdef PyObject* attr = instance_getattr(cls, name)\n\nAttributeError: 'OrderedSetPartitions_all_with_category' object has no attribute 'subset'\n\nDuring handling of the above exception, another exception occurred:\n\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-5-446eb4b46bf3> in <module>\n----> 1 M.basis(Integer(3))\n\n~/sage/local/lib/python3.6/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10437)()\n   1946                 return cache[k]\n   1947         except KeyError:\n-> 1948             w = self._instance_call(*args, **kwds)\n   1949             cache[k] = w\n   1950             return w\n\n~/sage/local/lib/python3.6/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:9916)()\n   1822             True\n   1823         \"\"\"\n-> 1824         return self.f(self._instance, *args, **kwds)\n   1825\n   1826     cdef fix_args_kwds(self, tuple args, dict kwds):\n\n~/sage/local/lib/python3.6/site-packages/sage/categories/filtered_modules_with_basis.py in basis(self, d)\n    186                 return Family(self._indices, self.monomial)\n    187             else:\n--> 188                 return self.homogeneous_component_basis(d)\n    189\n    190         # TODO: Change `list(self._indices)` to `self._indices` and move\n\n~/sage/local/lib/python3.6/site-packages/sage/categories/filtered_modules_with_basis.py in homogeneous_component_basis(self, d)\n    215                 S = self._indices.subset(size=d)\n    216             except (AttributeError, ValueError, TypeError):\n--> 217                 S = [i for i in list(self._indices) if self.degree_on_basis(i) == d]\n    218             return Family(S, self.monomial)\n    219\n\n~/sage/local/lib/python3.6/site-packages/sage/categories/enumerated_sets.py in __len__(self)\n    477                 c = self.cardinality()\n    478                 if c is Infinity:\n--> 479                     raise NotImplementedError('infinite set')\n    480                 return int(c)\n    481             except AttributeError:\n\nNotImplementedError: infinite set\n```\n\nSame problem with other bases.\n\nI assume the problem is that OrderedSetPartition has no subset(size=d) method.\n\nCC:  @tscrim @darijgr lauve\n\nKeywords: WQSym, combinatorial Hopf algebras, ordered set partitions\n\nBranch/Commit: [27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03](https://github.com/sagemath/sagetrac-mirror/commit/27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03)\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton, Travis Scrimshaw\n\nAuthor: Darij Grinberg\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31985\n\n",
    "closed_at": "2021-07-09T20:23:36Z",
    "created_at": "2021-06-15T17:56:40Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "WQSym.M().basis(3) is broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31985",
    "user": "https://github.com/darijgr"
}
```
Attached is a *minimal* fix, which defines

```
def subset(self, size=None, **kwargs)
```
for the classes `OrderedSetPartitions_all` and `SetPartitions_all`. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.

---

This should return a basis for the degree-3 component of WQSym (and yes, it is finite):

```
sage: WQSym = algebras.WQSym(QQ)
sage: M = WQSym.M()
sage: M.basis(3)
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
~/sage/local/lib/python3.6/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10303)()
   1942             try:
-> 1943                 return cache[k]
   1944             except TypeError:  # k is not hashable

KeyError: ((3,), ())

During handling of the above exception, another exception occurred:

KeyError                                  Traceback (most recent call last)
~/sage/local/lib/python3.6/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:7074)()
    838         try:
--> 839             return self.__cached_methods[name]
    840         except KeyError:

KeyError: 'subset'

During handling of the above exception, another exception occurred:

AttributeError                            Traceback (most recent call last)
~/sage/local/lib/python3.6/site-packages/sage/categories/filtered_modules_with_basis.py in homogeneous_component_basis(self, d)
    214             try:
--> 215                 S = self._indices.subset(size=d)
    216             except (AttributeError, ValueError, TypeError):

~/sage/local/lib/python3.6/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.CategoryObject.__getattr__ (build/cythonized/sage/structure/category_object.c:6993)()
    832         """
--> 833         return self.getattr_from_category(name)
    834

~/sage/local/lib/python3.6/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:7159)()
    847
--> 848             attr = getattr_from_other_class(self, cls, name)
    849             self.__cached_methods[name] = attr

~/sage/local/lib/python3.6/site-packages/sage/cpython/getattr.pyx in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2551)()
    366         dummy_error_message.name = name
--> 367         raise AttributeError(dummy_error_message)
    368     cdef PyObject* attr = instance_getattr(cls, name)

AttributeError: 'OrderedSetPartitions_all_with_category' object has no attribute 'subset'

During handling of the above exception, another exception occurred:

NotImplementedError                       Traceback (most recent call last)
<ipython-input-5-446eb4b46bf3> in <module>
----> 1 M.basis(Integer(3))

~/sage/local/lib/python3.6/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10437)()
   1946                 return cache[k]
   1947         except KeyError:
-> 1948             w = self._instance_call(*args, **kwds)
   1949             cache[k] = w
   1950             return w

~/sage/local/lib/python3.6/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:9916)()
   1822             True
   1823         """
-> 1824         return self.f(self._instance, *args, **kwds)
   1825
   1826     cdef fix_args_kwds(self, tuple args, dict kwds):

~/sage/local/lib/python3.6/site-packages/sage/categories/filtered_modules_with_basis.py in basis(self, d)
    186                 return Family(self._indices, self.monomial)
    187             else:
--> 188                 return self.homogeneous_component_basis(d)
    189
    190         # TODO: Change `list(self._indices)` to `self._indices` and move

~/sage/local/lib/python3.6/site-packages/sage/categories/filtered_modules_with_basis.py in homogeneous_component_basis(self, d)
    215                 S = self._indices.subset(size=d)
    216             except (AttributeError, ValueError, TypeError):
--> 217                 S = [i for i in list(self._indices) if self.degree_on_basis(i) == d]
    218             return Family(S, self.monomial)
    219

~/sage/local/lib/python3.6/site-packages/sage/categories/enumerated_sets.py in __len__(self)
    477                 c = self.cardinality()
    478                 if c is Infinity:
--> 479                     raise NotImplementedError('infinite set')
    480                 return int(c)
    481             except AttributeError:

NotImplementedError: infinite set
```

Same problem with other bases.

I assume the problem is that OrderedSetPartition has no subset(size=d) method.

CC:  @tscrim @darijgr lauve

Keywords: WQSym, combinatorial Hopf algebras, ordered set partitions

Branch/Commit: [27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03](https://github.com/sagemath/sagetrac-mirror/commit/27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03)

Reviewer: Frédéric Chapoton, Travis Scrimshaw

Author: Darij Grinberg

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31985





---

archive/issue_comments_636587.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -93,3 +93,5 @@\n ```\n \n Same problem with other bases.\n+\n+I assume the problem is that OrderedSetPartition has no subset(size=d) method.\n``````\n",
    "created_at": "2021-06-15T17:59:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636587",
    "user": "https://github.com/darijgr"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -93,3 +93,5 @@
 ```
 
 Same problem with other bases.
+
+I assume the problem is that OrderedSetPartition has no subset(size=d) method.
``````




---

archive/issue_comments_636588.json:
```json
{
    "body": "Author: Darij Grinberg",
    "created_at": "2021-06-15T18:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636588",
    "user": "https://github.com/darijgr"
}
```

Author: Darij Grinberg



---

archive/issue_comments_636589.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n+Attached is a *minimal* fix, which defines ``def subset(self, size=None, **kwargs)`` for the classes ``OrderedSetPartitions_all`` and ``SetPartitions_all``. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.\n+\n+---\n+\n This should return a basis for the degree-3 component of WQSym (and yes, it is finite):\n \n ```\n``````\n",
    "created_at": "2021-06-15T18:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636589",
    "user": "https://github.com/darijgr"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,7 @@
+Attached is a *minimal* fix, which defines ``def subset(self, size=None, **kwargs)`` for the classes ``OrderedSetPartitions_all`` and ``SetPartitions_all``. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.
+
+---
+
 This should return a basis for the degree-3 component of WQSym (and yes, it is finite):
 
 ```
``````




---

archive/issue_comments_636590.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-15T18:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636590",
    "user": "https://github.com/darijgr"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_636591.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n-Attached is a *minimal* fix, which defines ``def subset(self, size=None, **kwargs)`` for the classes ``OrderedSetPartitions_all`` and ``SetPartitions_all``. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.\n+Attached is a *minimal* fix, which defines\n+\n+```\n+def subset(self, size=None, **kwargs)\n+```\n+for the classes ``OrderedSetPartitions_all`` and ``SetPartitions_all``. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.\n \n ---\n \n``````\n",
    "created_at": "2021-06-15T18:45:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636591",
    "user": "https://github.com/darijgr"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,9 @@
-Attached is a *minimal* fix, which defines ``def subset(self, size=None, **kwargs)`` for the classes ``OrderedSetPartitions_all`` and ``SetPartitions_all``. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.
+Attached is a *minimal* fix, which defines
+
+```
+def subset(self, size=None, **kwargs)
+```
+for the classes ``OrderedSetPartitions_all`` and ``SetPartitions_all``. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.
 
 ---
 
``````




---

archive/issue_comments_636592.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,7 +3,7 @@\n ```\n def subset(self, size=None, **kwargs)\n ```\n-for the classes ``OrderedSetPartitions_all`` and ``SetPartitions_all``. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.\n+for the classes `OrderedSetPartitions_all` and `SetPartitions_all`. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.\n \n ---\n \n``````\n",
    "created_at": "2021-06-15T18:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636592",
    "user": "https://github.com/darijgr"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,7 +3,7 @@
 ```
 def subset(self, size=None, **kwargs)
 ```
-for the classes ``OrderedSetPartitions_all`` and ``SetPartitions_all``. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.
+for the classes `OrderedSetPartitions_all` and `SetPartitions_all`. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.
 
 ---
 
``````




---

archive/issue_comments_636593.json:
```json
{
    "body": "Branch: [public/ticket/31985](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/31985)",
    "created_at": "2021-06-15T18:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636593",
    "user": "https://github.com/darijgr"
}
```

Branch: [public/ticket/31985](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/31985)



---

archive/issue_comments_636594.json:
```json
{
    "body": "Commit: [68be17b29aa4f90a494992a9d14c54f37c258ae5](https://github.com/sagemath/sagetrac-mirror/commit/68be17b29aa4f90a494992a9d14c54f37c258ae5)",
    "created_at": "2021-06-15T18:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636594",
    "user": "https://github.com/darijgr"
}
```

Commit: [68be17b29aa4f90a494992a9d14c54f37c258ae5](https://github.com/sagemath/sagetrac-mirror/commit/68be17b29aa4f90a494992a9d14c54f37c258ae5)



---

archive/issue_comments_636595.json:
```json
{
    "body": "<a id='comment:4'></a>\nNew commits:\n|                                                                                                                                          |                                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|\n|[68be17b](https://github.com/sagemath/sagetrac-mirror/commit/68be17b29aa4f90a494992a9d14c54f37c258ae5)|`allow slicing set partition classes by size`|",
    "created_at": "2021-06-15T18:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636595",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:4'></a>
New commits:
|                                                                                                                                          |                                             |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|
|[68be17b](https://github.com/sagemath/sagetrac-mirror/commit/68be17b29aa4f90a494992a9d14c54f37c258ae5)|`allow slicing set partition classes by size`|



---

archive/issue_comments_636596.json:
```json
{
    "body": "<a id='comment:5'></a>\nReturns should be Return",
    "created_at": "2021-06-15T18:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636596",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
Returns should be Return



---

archive/issue_comments_636597.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------|\n|[27b3b4c](https://github.com/sagemath/sagetrac-mirror/commit/27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03)|`convention fix`|",
    "created_at": "2021-06-15T18:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636597",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------|
|[27b3b4c](https://github.com/sagemath/sagetrac-mirror/commit/27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03)|`convention fix`|



---

archive/issue_comments_636598.json:
```json
{
    "body": "Changing commit from \"[68be17b29aa4f90a494992a9d14c54f37c258ae5](https://github.com/sagemath/sagetrac-mirror/commit/68be17b29aa4f90a494992a9d14c54f37c258ae5)\" to \"[27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03](https://github.com/sagemath/sagetrac-mirror/commit/27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03)\"",
    "created_at": "2021-06-15T18:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636598",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[68be17b29aa4f90a494992a9d14c54f37c258ae5](https://github.com/sagemath/sagetrac-mirror/commit/68be17b29aa4f90a494992a9d14c54f37c258ae5)" to "[27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03](https://github.com/sagemath/sagetrac-mirror/commit/27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03)"



---

archive/issue_comments_636599.json:
```json
{
    "body": "Reviewer: Fr\u00e9d\u00e9ric Chapoton, Travis Scrimshaw",
    "created_at": "2021-06-16T05:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636599",
    "user": "https://github.com/tscrim"
}
```

Reviewer: Frédéric Chapoton, Travis Scrimshaw



---

archive/issue_comments_636600.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-16T05:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636600",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_636601.json:
```json
{
    "body": "<a id='comment:7'></a>\nLGTM. Thanks. There might be others CHAs that need a similar treatment as a warning.\n\nFr\u00e9d\u00e9ric, I added you as a reviewer for[comment:5](#comment%3A5).",
    "created_at": "2021-06-16T05:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636601",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
LGTM. Thanks. There might be others CHAs that need a similar treatment as a warning.

Frédéric, I added you as a reviewer for[comment:5](#comment%3A5).



---

archive/issue_comments_636602.json:
```json
{
    "body": "<a id='comment:8'></a>\nThanks, both of you!",
    "created_at": "2021-06-16T09:11:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636602",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:8'></a>
Thanks, both of you!



---

archive/issue_comments_636603.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-06-30T21:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636603",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_636604.json:
```json
{
    "body": "<a id='comment:9'></a>\n\n```\nsage -t --long --warn-long 41.1 --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py  # 1 doctest failed\nsage -t --long --warn-long 41.1 --random-seed=0 src/sage/categories/quotient_fields.py  # 2 doctests failed\n```",
    "created_at": "2021-06-30T21:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636604",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>

```
sage -t --long --warn-long 41.1 --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py  # 1 doctest failed
sage -t --long --warn-long 41.1 --random-seed=0 src/sage/categories/quotient_fields.py  # 2 doctests failed
```



---

archive/issue_comments_636605.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-06-30T21:32:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636605",
    "user": "https://github.com/darijgr"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_636606.json:
```json
{
    "body": "<a id='comment:10'></a>\nI don't think these have anything to do with my branch.\n\n```\nskraeling@moria ~/sage\n$ sage -t --long --warn-long 41.1 --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py  # 1 doctest failed\nRunning doctests with ID 2021-06-30-23-20-11-ecd9f2e8.\nGit branch: ospsize\nUsing --optional=build,cygwin,dochtml,pip,rubiks,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 41.1 --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py\n    [110 tests, 16.76 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 23.1 seconds\n    cpu time: 4.2 seconds\n    cumulative wall time: 16.8 seconds\n\nskraeling@moria ~/sage\n$ sage -t --long --warn-long 41.1 --random-seed=0 src/sage/categories/quotient_fields.py  # 2 doctests failed\nRunning doctests with ID 2021-06-30-23-30-34-35f1c6cc.\nGit branch: ospsize\nUsing --optional=build,cygwin,dochtml,pip,rubiks,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 41.1 --random-seed=0 src/sage/categories/quotient_fields.py\n    [158 tests, 7.91 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 8.7 seconds\n    cpu time: 3.3 seconds\n    cumulative wall time: 7.9 seconds\n```",
    "created_at": "2021-06-30T21:32:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636606",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:10'></a>
I don't think these have anything to do with my branch.

```
skraeling@moria ~/sage
$ sage -t --long --warn-long 41.1 --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py  # 1 doctest failed
Running doctests with ID 2021-06-30-23-20-11-ecd9f2e8.
Git branch: ospsize
Using --optional=build,cygwin,dochtml,pip,rubiks,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 41.1 --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py
    [110 tests, 16.76 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 23.1 seconds
    cpu time: 4.2 seconds
    cumulative wall time: 16.8 seconds

skraeling@moria ~/sage
$ sage -t --long --warn-long 41.1 --random-seed=0 src/sage/categories/quotient_fields.py  # 2 doctests failed
Running doctests with ID 2021-06-30-23-30-34-35f1c6cc.
Git branch: ospsize
Using --optional=build,cygwin,dochtml,pip,rubiks,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 41.1 --random-seed=0 src/sage/categories/quotient_fields.py
    [158 tests, 7.91 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 8.7 seconds
    cpu time: 3.3 seconds
    cumulative wall time: 7.9 seconds
```



---

archive/issue_comments_636607.json:
```json
{
    "body": "<a id='comment:11'></a>\nWhile I don't have your logs, both of the files that are randomly failing involve approximate values in doctest results. I wouldn't be surprised if they need to be hardened for approximation errors.",
    "created_at": "2021-06-30T21:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636607",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:11'></a>
While I don't have your logs, both of the files that are randomly failing involve approximate values in doctest results. I wouldn't be surprised if they need to be hardened for approximation errors.



---

archive/issue_comments_636608.json:
```json
{
    "body": "<a id='comment:12'></a>\nCan you try on top of the latest beta?\n\n```\nsage -t --long --warn-long 43.2 --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py\n**********************************************************************\nFile \"src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py\", line 260, in sage.tests.books.computational-mathematics-with-sagemath.polynomes_doctest\nFailed example:\n    Frac(C['x'])(r).partial_fraction_decomposition()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 718, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 1137, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.tests.books.computational-mathematics-with-sagemath.polynomes_doctest[69]>\", line 1, in <module>\n        Frac(C['x'])(r).partial_fraction_decomposition()\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/categories/quotient_fields.py\", line 540, in partial_fraction_decomposition\n        for r in factor:\n    NameError: name 'factor' is not defined\n**********************************************************************\n```",
    "created_at": "2021-07-04T22:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636608",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'></a>
Can you try on top of the latest beta?

```
sage -t --long --warn-long 43.2 --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py
**********************************************************************
File "src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py", line 260, in sage.tests.books.computational-mathematics-with-sagemath.polynomes_doctest
Failed example:
    Frac(C['x'])(r).partial_fraction_decomposition()
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.tests.books.computational-mathematics-with-sagemath.polynomes_doctest[69]>", line 1, in <module>
        Frac(C['x'])(r).partial_fraction_decomposition()
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/categories/quotient_fields.py", line 540, in partial_fraction_decomposition
        for r in factor:
    NameError: name 'factor' is not defined
**********************************************************************
```



---

archive/issue_comments_636609.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-07-04T22:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636609",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_636610.json:
```json
{
    "body": "<a id='comment:13'></a>\nLine 540 of quotient_fields.py says \"for r in factors\", not \"for r in factor\":\n\nhttps://github.com/sagemath/sage/blob/develop/src/sage/categories/quotient_fields.py\n\nNothing about my branch changes this. Are you sure your setup isn't corrupted (e.g., by some broken E701/702 fix)?",
    "created_at": "2021-07-04T22:54:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636610",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:13'></a>
Line 540 of quotient_fields.py says "for r in factors", not "for r in factor":

https://github.com/sagemath/sage/blob/develop/src/sage/categories/quotient_fields.py

Nothing about my branch changes this. Are you sure your setup isn't corrupted (e.g., by some broken E701/702 fix)?



---

archive/issue_comments_636611.json:
```json
{
    "body": "<a id='comment:14'></a>\nThat, or your bot is either merging or testing the wrong branch.",
    "created_at": "2021-07-04T23:01:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636611",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:14'></a>
That, or your bot is either merging or testing the wrong branch.



---

archive/issue_comments_636612.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-07-04T23:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636612",
    "user": "https://github.com/darijgr"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_636613.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-09T20:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636613",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_095166.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-09T20:23:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31985#event-95166"
}
```



---

archive/issue_comments_636614.json:
```json
{
    "body": "Changing branch from \"[public/ticket/31985](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/31985)\" to \"[27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03](https://github.com/sagemath/sagetrac-mirror/commit/27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03)\"",
    "created_at": "2021-07-09T20:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31985#issuecomment-636614",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[public/ticket/31985](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/31985)" to "[27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03](https://github.com/sagemath/sagetrac-mirror/commit/27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03)"
