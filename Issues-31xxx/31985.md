# Issue 31985: WQSym.M().basis(3) is broken

archive/issues_031748.json:
```json
{
    "assignees": [],
    "body": "Attached is a *minimal* fix, which defines\n\n```\ndef subset(self, size=None, **kwargs)\n```\nfor the classes `OrderedSetPartitions_all` and `SetPartitions_all`. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.\n\n---\n\nThis should return a basis for the degree-3 component of WQSym (and yes, it is finite):\n\n```\nsage: WQSym = algebras.WQSym(QQ)\nsage: M = WQSym.M()\nsage: M.basis(3)\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\n~/sage/local/lib/python3.6/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10303)()\n   1942             try:\n-> 1943                 return cache[k]\n   1944             except TypeError:  # k is not hashable\n\nKeyError: ((3,), ())\n\nDuring handling of the above exception, another exception occurred:\n\nKeyError                                  Traceback (most recent call last)\n~/sage/local/lib/python3.6/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:7074)()\n    838         try:\n--> 839             return self.__cached_methods[name]\n    840         except KeyError:\n\nKeyError: 'subset'\n\nDuring handling of the above exception, another exception occurred:\n\nAttributeError                            Traceback (most recent call last)\n~/sage/local/lib/python3.6/site-packages/sage/categories/filtered_modules_with_basis.py in homogeneous_component_basis(self, d)\n    214             try:\n--> 215                 S = self._indices.subset(size=d)\n    216             except (AttributeError, ValueError, TypeError):\n\n~/sage/local/lib/python3.6/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.CategoryObject.__getattr__ (build/cythonized/sage/structure/category_object.c:6993)()\n    832         \"\"\"\n--> 833         return self.getattr_from_category(name)\n    834\n\n~/sage/local/lib/python3.6/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:7159)()\n    847\n--> 848             attr = getattr_from_other_class(self, cls, name)\n    849             self.__cached_methods[name] = attr\n\n~/sage/local/lib/python3.6/site-packages/sage/cpython/getattr.pyx in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2551)()\n    366         dummy_error_message.name = name\n--> 367         raise AttributeError(dummy_error_message)\n    368     cdef PyObject* attr = instance_getattr(cls, name)\n\nAttributeError: 'OrderedSetPartitions_all_with_category' object has no attribute 'subset'\n\nDuring handling of the above exception, another exception occurred:\n\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-5-446eb4b46bf3> in <module>\n----> 1 M.basis(Integer(3))\n\n~/sage/local/lib/python3.6/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10437)()\n   1946                 return cache[k]\n   1947         except KeyError:\n-> 1948             w = self._instance_call(*args, **kwds)\n   1949             cache[k] = w\n   1950             return w\n\n~/sage/local/lib/python3.6/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:9916)()\n   1822             True\n   1823         \"\"\"\n-> 1824         return self.f(self._instance, *args, **kwds)\n   1825\n   1826     cdef fix_args_kwds(self, tuple args, dict kwds):\n\n~/sage/local/lib/python3.6/site-packages/sage/categories/filtered_modules_with_basis.py in basis(self, d)\n    186                 return Family(self._indices, self.monomial)\n    187             else:\n--> 188                 return self.homogeneous_component_basis(d)\n    189\n    190         # TODO: Change `list(self._indices)` to `self._indices` and move\n\n~/sage/local/lib/python3.6/site-packages/sage/categories/filtered_modules_with_basis.py in homogeneous_component_basis(self, d)\n    215                 S = self._indices.subset(size=d)\n    216             except (AttributeError, ValueError, TypeError):\n--> 217                 S = [i for i in list(self._indices) if self.degree_on_basis(i) == d]\n    218             return Family(S, self.monomial)\n    219\n\n~/sage/local/lib/python3.6/site-packages/sage/categories/enumerated_sets.py in __len__(self)\n    477                 c = self.cardinality()\n    478                 if c is Infinity:\n--> 479                     raise NotImplementedError('infinite set')\n    480                 return int(c)\n    481             except AttributeError:\n\nNotImplementedError: infinite set\n```\n\nSame problem with other bases.\n\nI assume the problem is that OrderedSetPartition has no subset(size=d) method.\n\nCC:  @tscrim @darijgr lauve\n\nKeywords: **WQSym, combinatorial Hopf algebras, ordered set partitions**\n\nBranch/Commit: **[27b3b4c](https://github.com/sagemath/sagetrac-mirror/commit/27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton, Travis Scrimshaw**\n\nAuthor: **Darij Grinberg**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31985_\n\n",
    "closed_at": "2021-07-09T20:23:36Z",
    "created_at": "2021-06-15T17:56:40Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "WQSym.M().basis(3) is broken",
    "type": "issue",
    "updated_at": "2021-07-09T20:23:36Z",
    "url": "https://github.com/sagemath/sage/issues/31985",
    "user": "https://github.com/darijgr"
}
```
Attached is a *minimal* fix, which defines

```
def subset(self, size=None, **kwargs)
```
for the classes `OrderedSetPartitions_all` and `SetPartitions_all`. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.

---

This should return a basis for the degree-3 component of WQSym (and yes, it is finite):

```
sage: WQSym = algebras.WQSym(QQ)
sage: M = WQSym.M()
sage: M.basis(3)
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
~/sage/local/lib/python3.6/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10303)()
   1942             try:
-> 1943                 return cache[k]
   1944             except TypeError:  # k is not hashable

KeyError: ((3,), ())

During handling of the above exception, another exception occurred:

KeyError                                  Traceback (most recent call last)
~/sage/local/lib/python3.6/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:7074)()
    838         try:
--> 839             return self.__cached_methods[name]
    840         except KeyError:

KeyError: 'subset'

During handling of the above exception, another exception occurred:

AttributeError                            Traceback (most recent call last)
~/sage/local/lib/python3.6/site-packages/sage/categories/filtered_modules_with_basis.py in homogeneous_component_basis(self, d)
    214             try:
--> 215                 S = self._indices.subset(size=d)
    216             except (AttributeError, ValueError, TypeError):

~/sage/local/lib/python3.6/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.CategoryObject.__getattr__ (build/cythonized/sage/structure/category_object.c:6993)()
    832         """
--> 833         return self.getattr_from_category(name)
    834

~/sage/local/lib/python3.6/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:7159)()
    847
--> 848             attr = getattr_from_other_class(self, cls, name)
    849             self.__cached_methods[name] = attr

~/sage/local/lib/python3.6/site-packages/sage/cpython/getattr.pyx in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2551)()
    366         dummy_error_message.name = name
--> 367         raise AttributeError(dummy_error_message)
    368     cdef PyObject* attr = instance_getattr(cls, name)

AttributeError: 'OrderedSetPartitions_all_with_category' object has no attribute 'subset'

During handling of the above exception, another exception occurred:

NotImplementedError                       Traceback (most recent call last)
<ipython-input-5-446eb4b46bf3> in <module>
----> 1 M.basis(Integer(3))

~/sage/local/lib/python3.6/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10437)()
   1946                 return cache[k]
   1947         except KeyError:
-> 1948             w = self._instance_call(*args, **kwds)
   1949             cache[k] = w
   1950             return w

~/sage/local/lib/python3.6/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:9916)()
   1822             True
   1823         """
-> 1824         return self.f(self._instance, *args, **kwds)
   1825
   1826     cdef fix_args_kwds(self, tuple args, dict kwds):

~/sage/local/lib/python3.6/site-packages/sage/categories/filtered_modules_with_basis.py in basis(self, d)
    186                 return Family(self._indices, self.monomial)
    187             else:
--> 188                 return self.homogeneous_component_basis(d)
    189
    190         # TODO: Change `list(self._indices)` to `self._indices` and move

~/sage/local/lib/python3.6/site-packages/sage/categories/filtered_modules_with_basis.py in homogeneous_component_basis(self, d)
    215                 S = self._indices.subset(size=d)
    216             except (AttributeError, ValueError, TypeError):
--> 217                 S = [i for i in list(self._indices) if self.degree_on_basis(i) == d]
    218             return Family(S, self.monomial)
    219

~/sage/local/lib/python3.6/site-packages/sage/categories/enumerated_sets.py in __len__(self)
    477                 c = self.cardinality()
    478                 if c is Infinity:
--> 479                     raise NotImplementedError('infinite set')
    480                 return int(c)
    481             except AttributeError:

NotImplementedError: infinite set
```

Same problem with other bases.

I assume the problem is that OrderedSetPartition has no subset(size=d) method.

CC:  @tscrim @darijgr lauve

Keywords: **WQSym, combinatorial Hopf algebras, ordered set partitions**

Branch/Commit: **[27b3b4c](https://github.com/sagemath/sagetrac-mirror/commit/27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03)**

Reviewer: **Frédéric Chapoton, Travis Scrimshaw**

Author: **Darij Grinberg**

_Issue created by migration from https://trac.sagemath.org/ticket/31985_





---

archive/issue_events_408644.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2021-06-15T17:56:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31985#event-408644"
}
```



---

archive/issue_events_408645.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2021-06-15T17:56:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "component: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31985#event-408645"
}
```



---

archive/issue_events_408646.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2021-06-15T17:56:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31985#event-408646"
}
```



---

archive/issue_events_408647.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2021-06-15T17:56:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31985#event-408647"
}
```



---

archive/issue_comments_517818.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -93,3 +93,5 @@\n ```\n \n Same problem with other bases.\n+\n+I assume the problem is that OrderedSetPartition has no subset(size=d) method.\n``````\n",
    "created_at": "2021-06-15T17:59:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517818",
    "user": "https://github.com/darijgr"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -93,3 +93,5 @@
 ```
 
 Same problem with other bases.
+
+I assume the problem is that OrderedSetPartition has no subset(size=d) method.
``````




---

archive/issue_comments_517819.json:
```json
{
    "body": "Author: **Darij Grinberg**",
    "created_at": "2021-06-15T18:45:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517819",
    "user": "https://github.com/darijgr"
}
```

Author: **Darij Grinberg**



---

archive/issue_comments_517820.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n+Attached is a *minimal* fix, which defines ``def subset(self, size=None, **kwargs)`` for the classes ``OrderedSetPartitions_all`` and ``SetPartitions_all``. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.\n+\n+---\n+\n This should return a basis for the degree-3 component of WQSym (and yes, it is finite):\n \n ```\n``````\n",
    "created_at": "2021-06-15T18:45:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517820",
    "user": "https://github.com/darijgr"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,7 @@
+Attached is a *minimal* fix, which defines ``def subset(self, size=None, **kwargs)`` for the classes ``OrderedSetPartitions_all`` and ``SetPartitions_all``. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.
+
+---
+
 This should return a basis for the degree-3 component of WQSym (and yes, it is finite):
 
 ```
``````




---

archive/issue_events_408648.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2021-06-15T18:45:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31985#event-408648"
}
```



---

archive/issue_comments_517821.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n-Attached is a *minimal* fix, which defines ``def subset(self, size=None, **kwargs)`` for the classes ``OrderedSetPartitions_all`` and ``SetPartitions_all``. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.\n+Attached is a *minimal* fix, which defines\n+\n+```\n+def subset(self, size=None, **kwargs)\n+```\n+for the classes ``OrderedSetPartitions_all`` and ``SetPartitions_all``. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.\n \n ---\n \n``````\n",
    "created_at": "2021-06-15T18:45:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517821",
    "user": "https://github.com/darijgr"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,9 @@
-Attached is a *minimal* fix, which defines ``def subset(self, size=None, **kwargs)`` for the classes ``OrderedSetPartitions_all`` and ``SetPartitions_all``. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.
+Attached is a *minimal* fix, which defines
+
+```
+def subset(self, size=None, **kwargs)
+```
+for the classes ``OrderedSetPartitions_all`` and ``SetPartitions_all``. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.
 
 ---
 
``````




---

archive/issue_comments_517822.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,7 +3,7 @@\n ```\n def subset(self, size=None, **kwargs)\n ```\n-for the classes ``OrderedSetPartitions_all`` and ``SetPartitions_all``. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.\n+for the classes `OrderedSetPartitions_all` and `SetPartitions_all`. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.\n \n ---\n \n``````\n",
    "created_at": "2021-06-15T18:46:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517822",
    "user": "https://github.com/darijgr"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,7 +3,7 @@
 ```
 def subset(self, size=None, **kwargs)
 ```
-for the classes ``OrderedSetPartitions_all`` and ``SetPartitions_all``. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.
+for the classes `OrderedSetPartitions_all` and `SetPartitions_all`. Judging by partition.py, it might be conventional to also define this method for other classes of (ordered) set partitions, although I'm not sure why or what for.
 
 ---
 
``````




---

archive/issue_comments_517823.json:
```json
{
    "body": "Branch: **[public/ticket/31985](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/31985)**",
    "created_at": "2021-06-15T18:46:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517823",
    "user": "https://github.com/darijgr"
}
```

Branch: **[public/ticket/31985](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/31985)**



---

archive/issue_comments_517824.json:
```json
{
    "body": "Commit: **[68be17b](https://github.com/sagemath/sagetrac-mirror/commit/68be17b29aa4f90a494992a9d14c54f37c258ae5)**",
    "created_at": "2021-06-15T18:46:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517824",
    "user": "https://github.com/darijgr"
}
```

Commit: **[68be17b](https://github.com/sagemath/sagetrac-mirror/commit/68be17b29aa4f90a494992a9d14c54f37c258ae5)**



---

archive/issue_comments_517825.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/68be17b29aa4f90a494992a9d14c54f37c258ae5\">68be17b</a></td><td><code>allow slicing set partition classes by size</code></td></tr></table>\n",
    "created_at": "2021-06-15T18:46:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517825",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:4'>Comment 4:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/68be17b29aa4f90a494992a9d14c54f37c258ae5">68be17b</a></td><td><code>allow slicing set partition classes by size</code></td></tr></table>




---

archive/issue_comments_517826.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nReturns should be Return",
    "created_at": "2021-06-15T18:56:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517826",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'>Comment 5:</a>
Returns should be Return



---

archive/issue_comments_517827.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03\">27b3b4c</a></td><td><code>convention fix</code></td></tr></table>\n",
    "created_at": "2021-06-15T18:58:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517827",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>Comment 6:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03">27b3b4c</a></td><td><code>convention fix</code></td></tr></table>




---

archive/issue_comments_517828.json:
```json
{
    "body": "Changed commit from **[68be17b](https://github.com/sagemath/sagetrac-mirror/commit/68be17b29aa4f90a494992a9d14c54f37c258ae5)** to **[27b3b4c](https://github.com/sagemath/sagetrac-mirror/commit/27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03)**",
    "created_at": "2021-06-15T18:58:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517828",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[68be17b](https://github.com/sagemath/sagetrac-mirror/commit/68be17b29aa4f90a494992a9d14c54f37c258ae5)** to **[27b3b4c](https://github.com/sagemath/sagetrac-mirror/commit/27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03)**



---

archive/issue_comments_517829.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton, Travis Scrimshaw**",
    "created_at": "2021-06-16T05:13:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517829",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Frédéric Chapoton, Travis Scrimshaw**



---

archive/issue_events_408649.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-06-16T05:13:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31985#event-408649"
}
```



---

archive/issue_events_408650.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-06-16T05:13:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31985#event-408650"
}
```



---

archive/issue_comments_517830.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nLGTM. Thanks. There might be others CHAs that need a similar treatment as a warning.\n\nFr\u00e9d\u00e9ric, I added you as a reviewer for [comment:5](#comment%3A5).",
    "created_at": "2021-06-16T05:13:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517830",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'>Comment 7:</a>
LGTM. Thanks. There might be others CHAs that need a similar treatment as a warning.

Frédéric, I added you as a reviewer for [comment:5](#comment%3A5).



---

archive/issue_comments_517831.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nThanks, both of you!",
    "created_at": "2021-06-16T09:11:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517831",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:8'>Comment 8:</a>
Thanks, both of you!



---

archive/issue_events_408651.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-30T21:16:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31985#event-408651"
}
```



---

archive/issue_events_408652.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-30T21:16:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31985#event-408652"
}
```



---

archive/issue_comments_517832.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\n\n```\nsage -t --long --warn-long 41.1 --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py  # 1 doctest failed\nsage -t --long --warn-long 41.1 --random-seed=0 src/sage/categories/quotient_fields.py  # 2 doctests failed\n```",
    "created_at": "2021-06-30T21:16:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517832",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'>Comment 9:</a>

```
sage -t --long --warn-long 41.1 --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py  # 1 doctest failed
sage -t --long --warn-long 41.1 --random-seed=0 src/sage/categories/quotient_fields.py  # 2 doctests failed
```



---

archive/issue_events_408653.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2021-06-30T21:32:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31985#event-408653"
}
```



---

archive/issue_events_408654.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2021-06-30T21:32:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31985#event-408654"
}
```



---

archive/issue_comments_517833.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nI don't think these have anything to do with my branch.\n\n```\nskraeling@moria ~/sage\n$ sage -t --long --warn-long 41.1 --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py  # 1 doctest failed\nRunning doctests with ID 2021-06-30-23-20-11-ecd9f2e8.\nGit branch: ospsize\nUsing --optional=build,cygwin,dochtml,pip,rubiks,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 41.1 --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py\n    [110 tests, 16.76 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 23.1 seconds\n    cpu time: 4.2 seconds\n    cumulative wall time: 16.8 seconds\n\nskraeling@moria ~/sage\n$ sage -t --long --warn-long 41.1 --random-seed=0 src/sage/categories/quotient_fields.py  # 2 doctests failed\nRunning doctests with ID 2021-06-30-23-30-34-35f1c6cc.\nGit branch: ospsize\nUsing --optional=build,cygwin,dochtml,pip,rubiks,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 41.1 --random-seed=0 src/sage/categories/quotient_fields.py\n    [158 tests, 7.91 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 8.7 seconds\n    cpu time: 3.3 seconds\n    cumulative wall time: 7.9 seconds\n```",
    "created_at": "2021-06-30T21:32:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517833",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:10'>Comment 10:</a>
I don't think these have anything to do with my branch.

```
skraeling@moria ~/sage
$ sage -t --long --warn-long 41.1 --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py  # 1 doctest failed
Running doctests with ID 2021-06-30-23-20-11-ecd9f2e8.
Git branch: ospsize
Using --optional=build,cygwin,dochtml,pip,rubiks,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 41.1 --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py
    [110 tests, 16.76 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 23.1 seconds
    cpu time: 4.2 seconds
    cumulative wall time: 16.8 seconds

skraeling@moria ~/sage
$ sage -t --long --warn-long 41.1 --random-seed=0 src/sage/categories/quotient_fields.py  # 2 doctests failed
Running doctests with ID 2021-06-30-23-30-34-35f1c6cc.
Git branch: ospsize
Using --optional=build,cygwin,dochtml,pip,rubiks,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 41.1 --random-seed=0 src/sage/categories/quotient_fields.py
    [158 tests, 7.91 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 8.7 seconds
    cpu time: 3.3 seconds
    cumulative wall time: 7.9 seconds
```



---

archive/issue_comments_517834.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nWhile I don't have your logs, both of the files that are randomly failing involve approximate values in doctest results. I wouldn't be surprised if they need to be hardened for approximation errors.",
    "created_at": "2021-06-30T21:35:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517834",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:11'>Comment 11:</a>
While I don't have your logs, both of the files that are randomly failing involve approximate values in doctest results. I wouldn't be surprised if they need to be hardened for approximation errors.



---

archive/issue_comments_517835.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nCan you try on top of the latest beta?\n\n```\nsage -t --long --warn-long 43.2 --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py\n**********************************************************************\nFile \"src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py\", line 260, in sage.tests.books.computational-mathematics-with-sagemath.polynomes_doctest\nFailed example:\n    Frac(C['x'])(r).partial_fraction_decomposition()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 718, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 1137, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.tests.books.computational-mathematics-with-sagemath.polynomes_doctest[69]>\", line 1, in <module>\n        Frac(C['x'])(r).partial_fraction_decomposition()\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/categories/quotient_fields.py\", line 540, in partial_fraction_decomposition\n        for r in factor:\n    NameError: name 'factor' is not defined\n**********************************************************************\n```",
    "created_at": "2021-07-04T22:45:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517835",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'>Comment 12:</a>
Can you try on top of the latest beta?

```
sage -t --long --warn-long 43.2 --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py
**********************************************************************
File "src/sage/tests/books/computational-mathematics-with-sagemath/polynomes_doctest.py", line 260, in sage.tests.books.computational-mathematics-with-sagemath.polynomes_doctest
Failed example:
    Frac(C['x'])(r).partial_fraction_decomposition()
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.tests.books.computational-mathematics-with-sagemath.polynomes_doctest[69]>", line 1, in <module>
        Frac(C['x'])(r).partial_fraction_decomposition()
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/categories/quotient_fields.py", line 540, in partial_fraction_decomposition
        for r in factor:
    NameError: name 'factor' is not defined
**********************************************************************
```



---

archive/issue_events_408655.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-04T22:45:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31985#event-408655"
}
```



---

archive/issue_events_408656.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-04T22:45:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31985#event-408656"
}
```



---

archive/issue_comments_517836.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nLine 540 of quotient_fields.py says \"for r in factors\", not \"for r in factor\":\n\nhttps://github.com/sagemath/sage/blob/develop/src/sage/categories/quotient_fields.py\n\nNothing about my branch changes this. Are you sure your setup isn't corrupted (e.g., by some broken E701/702 fix)?",
    "created_at": "2021-07-04T22:54:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517836",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:13'>Comment 13:</a>
Line 540 of quotient_fields.py says "for r in factors", not "for r in factor":

https://github.com/sagemath/sage/blob/develop/src/sage/categories/quotient_fields.py

Nothing about my branch changes this. Are you sure your setup isn't corrupted (e.g., by some broken E701/702 fix)?



---

archive/issue_comments_517837.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nThat, or your bot is either merging or testing the wrong branch.",
    "created_at": "2021-07-04T23:01:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517837",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:14'>Comment 14:</a>
That, or your bot is either merging or testing the wrong branch.



---

archive/issue_events_408657.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2021-07-04T23:02:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31985#event-408657"
}
```



---

archive/issue_events_408658.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2021-07-04T23:02:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31985#event-408658"
}
```



---

archive/issue_events_408659.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-09T20:23:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31985#event-408659"
}
```



---

archive/issue_events_408660.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "48bbb4a85970671e1560b6602776907668b2f3ca",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-07-09T20:23:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31985#event-408660"
}
```



---

archive/issue_comments_517838.json:
```json
{
    "body": "Changed branch from **[public/ticket/31985](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/31985)** to **[27b3b4c](https://github.com/sagemath/sagetrac-mirror/commit/27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03)**",
    "created_at": "2021-07-09T20:23:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31985#issuecomment-517838",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/ticket/31985](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/31985)** to **[27b3b4c](https://github.com/sagemath/sagetrac-mirror/commit/27b3b4cd55ac0b79dcd92f2a4c47d10eda5ebf03)**
