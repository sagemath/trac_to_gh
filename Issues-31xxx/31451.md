# Issue 31451: Faster version of longest_increasing_subsequences

archive/issues_031214.json:
```json
{
    "assignees": [],
    "body": "The algorithm for the longest_increasing_subsequences function for permutations is currently very inefficient. I worked on a new version that vastly improves the run time of the function. \nNew version:\n\n```\nsage: %timeit Permutations(30).random_element().longest_increasing_subsequences()                                     \n19.6 ms \u00b1 2.28 ms per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n```\n\nOld version:\n\n```\nsage: %timeit Permutations(30).random_element().longest_increasing_subsequences()                                     \nThe slowest run took 10.40 times longer than the fastest. This could mean that an intermediate result is being cached.\n3min 34s \u00b1 2min 47s per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n```\n\nfollow-up: #34218\n\nCC:  @nadialafreniere @enadeau @tscrim\n\nKeywords: **permutation, subsequences**\n\nBranch/Commit: **[5969eda](https://github.com/sagemath/sagetrac-mirror/commit/5969edaa2e395e683feaba38db8ea94c6290e996)**\n\nReviewer: **David Coudert, Vincent Delecroix**\n\nAuthor: **Peter Morawitz, Finn Hulse, Nadia Lafreni\u00e8re**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31451_\n\n",
    "closed_at": "2022-08-01T20:23:14Z",
    "created_at": "2021-03-03T23:08:54Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Faster version of longest_increasing_subsequences",
    "type": "issue",
    "updated_at": "2022-08-01T20:23:14Z",
    "url": "https://github.com/sagemath/sage/issues/31451",
    "user": "https://github.com/petermoraw"
}
```
The algorithm for the longest_increasing_subsequences function for permutations is currently very inefficient. I worked on a new version that vastly improves the run time of the function. 
New version:

```
sage: %timeit Permutations(30).random_element().longest_increasing_subsequences()                                     
19.6 ms ± 2.28 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
```

Old version:

```
sage: %timeit Permutations(30).random_element().longest_increasing_subsequences()                                     
The slowest run took 10.40 times longer than the fastest. This could mean that an intermediate result is being cached.
3min 34s ± 2min 47s per loop (mean ± std. dev. of 7 runs, 1 loop each)
```

follow-up: #34218

CC:  @nadialafreniere @enadeau @tscrim

Keywords: **permutation, subsequences**

Branch/Commit: **[5969eda](https://github.com/sagemath/sagetrac-mirror/commit/5969edaa2e395e683feaba38db8ea94c6290e996)**

Reviewer: **David Coudert, Vincent Delecroix**

Author: **Peter Morawitz, Finn Hulse, Nadia Lafrenière**

_Issue created by migration from https://trac.sagemath.org/ticket/31451_





---

archive/issue_events_415328.json:
```json
{
    "actor": "https://github.com/petermoraw",
    "created_at": "2021-03-03T23:08:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415328"
}
```



---

archive/issue_events_415329.json:
```json
{
    "actor": "https://github.com/petermoraw",
    "created_at": "2021-03-03T23:08:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "component: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415329"
}
```



---

archive/issue_events_415330.json:
```json
{
    "actor": "https://github.com/petermoraw",
    "created_at": "2021-03-03T23:08:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415330"
}
```



---

archive/issue_events_415331.json:
```json
{
    "actor": "https://github.com/petermoraw",
    "created_at": "2021-03-03T23:08:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415331"
}
```



---

archive/issue_comments_508056.json:
```json
{
    "body": "Branch: **[u/gh-petermoraw/LongestIncreasingSubsequences](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-petermoraw/LongestIncreasingSubsequences)**",
    "created_at": "2021-03-03T23:18:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508056",
    "user": "https://github.com/petermoraw"
}
```

Branch: **[u/gh-petermoraw/LongestIncreasingSubsequences](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-petermoraw/LongestIncreasingSubsequences)**



---

archive/issue_comments_508057.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c65429faa7548a2ae8321a7f8b3295a25fa19b39\">c65429f</a></td><td><code>improved longest increasing subsequences function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0bb729e48b1669180599854ac8f2f4ee5741a094\">0bb729e</a></td><td><code>Added reference</code></td></tr></table>\n",
    "created_at": "2021-03-03T23:37:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508057",
    "user": "https://github.com/nadialafreniere"
}
```

<div id="comment:2" align="right">Comment 2</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c65429faa7548a2ae8321a7f8b3295a25fa19b39">c65429f</a></td><td><code>improved longest increasing subsequences function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0bb729e48b1669180599854ac8f2f4ee5741a094">0bb729e</a></td><td><code>Added reference</code></td></tr></table>




---

archive/issue_comments_508058.json:
```json
{
    "body": "Commit: **[0bb729e](https://github.com/sagemath/sagetrac-mirror/commit/0bb729e48b1669180599854ac8f2f4ee5741a094)**",
    "created_at": "2021-03-03T23:37:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508058",
    "user": "https://github.com/nadialafreniere"
}
```

Commit: **[0bb729e](https://github.com/sagemath/sagetrac-mirror/commit/0bb729e48b1669180599854ac8f2f4ee5741a094)**



---

archive/issue_events_415332.json:
```json
{
    "actor": "https://github.com/nadialafreniere",
    "created_at": "2021-03-03T23:37:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415332"
}
```



---

archive/issue_comments_508059.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\n* when citing a reference, you should append an underscore, like this\n\n```\n[Sch1961]_\n```\n\n* Do not use \"Returns\" in the first line of doc, but \"Return\"",
    "created_at": "2021-03-04T07:46:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508059",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:3" align="right">Comment 3</div>

* when citing a reference, you should append an underscore, like this

```
[Sch1961]_
```

* Do not use "Returns" in the first line of doc, but "Return"



---

archive/issue_comments_508060.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nand patchbot complains about\n\n```\nsrc/doc/en/reference/references/index.rst  # Tab character found\n```",
    "created_at": "2021-03-04T15:13:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508060",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">Comment 4</div>

and patchbot complains about

```
src/doc/en/reference/references/index.rst  # Tab character found
```



---

archive/issue_comments_508061.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nI think `seq == sorted(seq)` would be better replaced by\n\n```\nall(seq[i] <= seq[i+1] for i in range(len(seq)-1))\n```\n\nAlso, is there a way you can avoid all of the calls to `index` here:\n\n```\nself.index(seq[j]) < self.index(seq[j+1]):\n```\nI feel like there should be a better way to track things, otherwise this could run in `O(len(seq)^2)` (maybe `O(log(len(seq)*len(seq))`) time.\n\nYou can remove this useless list\n\n```diff\n-        potential_sequences = list(itertools.product(*s))\n-        for seq in potential_sequences:\n+        for seq in itertools.product(*s):\n```\n\nI think it is cleaner to write `j += 1` instead of `j = j+1`. It might also be marginally faster.",
    "created_at": "2021-03-06T03:47:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508061",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:6" align="right">Comment 6</div>

I think `seq == sorted(seq)` would be better replaced by

```
all(seq[i] <= seq[i+1] for i in range(len(seq)-1))
```

Also, is there a way you can avoid all of the calls to `index` here:

```
self.index(seq[j]) < self.index(seq[j+1]):
```
I feel like there should be a better way to track things, otherwise this could run in `O(len(seq)^2)` (maybe `O(log(len(seq)*len(seq))`) time.

You can remove this useless list

```diff
-        potential_sequences = list(itertools.product(*s))
-        for seq in potential_sequences:
+        for seq in itertools.product(*s):
```

I think it is cleaner to write `j += 1` instead of `j = j+1`. It might also be marginally faster.



---

archive/issue_comments_508062.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86204b5f3a3bf3f4c116e35890c94a4fb3087575\">86204b5</a></td><td><code>tscrim edits</code></td></tr></table>\n",
    "created_at": "2021-03-15T04:04:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508062",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7" align="right">Comment 7</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86204b5f3a3bf3f4c116e35890c94a4fb3087575">86204b5</a></td><td><code>tscrim edits</code></td></tr></table>




---

archive/issue_comments_508063.json:
```json
{
    "body": "Changed commit from **[0bb729e](https://github.com/sagemath/sagetrac-mirror/commit/0bb729e48b1669180599854ac8f2f4ee5741a094)** to **[86204b5](https://github.com/sagemath/sagetrac-mirror/commit/86204b5f3a3bf3f4c116e35890c94a4fb3087575)**",
    "created_at": "2021-03-15T04:04:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508063",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0bb729e](https://github.com/sagemath/sagetrac-mirror/commit/0bb729e48b1669180599854ac8f2f4ee5741a094)** to **[86204b5](https://github.com/sagemath/sagetrac-mirror/commit/86204b5f3a3bf3f4c116e35890c94a4fb3087575)**



---

archive/issue_comments_508064.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nyou still have not fixed [comment:3](#comment%3A3) and [comment:4](#comment%3A4)",
    "created_at": "2021-03-15T08:48:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508064",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:8" align="right">Comment 8</div>

you still have not fixed [comment:3](#comment%3A3) and [comment:4](#comment%3A4)



---

archive/issue_comments_508065.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nNor have you commented on why you did not implement all of the suggestions from [comment:6](#comment%3A6).",
    "created_at": "2021-03-15T22:33:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508065",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:9" align="right">Comment 9</div>

Nor have you commented on why you did not implement all of the suggestions from [comment:6](#comment%3A6).



---

archive/issue_events_415333.json:
```json
{
    "actor": "https://github.com/nadialafreniere",
    "created_at": "2021-03-16T12:28:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415333"
}
```



---

archive/issue_events_415334.json:
```json
{
    "actor": "https://github.com/nadialafreniere",
    "created_at": "2021-03-16T12:28:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415334"
}
```



---

archive/issue_comments_508066.json:
```json
{
    "body": "Changed commit from **[86204b5](https://github.com/sagemath/sagetrac-mirror/commit/86204b5f3a3bf3f4c116e35890c94a4fb3087575)** to **[1f7a29a](https://github.com/sagemath/sagetrac-mirror/commit/1f7a29ae89f3b1e5b3144451c4860d7b9c19e0fe)**",
    "created_at": "2021-03-17T17:40:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508066",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[86204b5](https://github.com/sagemath/sagetrac-mirror/commit/86204b5f3a3bf3f4c116e35890c94a4fb3087575)** to **[1f7a29a](https://github.com/sagemath/sagetrac-mirror/commit/1f7a29ae89f3b1e5b3144451c4860d7b9c19e0fe)**



---

archive/issue_comments_508067.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f5391f5887b3eda82877fe5fdd0a9c513ec323b\">2f5391f</a></td><td><code>[Sch1961]_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1f7a29ae89f3b1e5b3144451c4860d7b9c19e0fe\">1f7a29a</a></td><td><code>Tab in references</code></td></tr></table>\n",
    "created_at": "2021-03-17T17:40:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508067",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11" align="right">Comment 11</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f5391f5887b3eda82877fe5fdd0a9c513ec323b">2f5391f</a></td><td><code>[Sch1961]_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1f7a29ae89f3b1e5b3144451c4860d7b9c19e0fe">1f7a29a</a></td><td><code>Tab in references</code></td></tr></table>




---

archive/issue_comments_508068.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nAbout [comment:6](#comment%3A6), you actually don't need to use `index` at all. You can do a single pass on your permutation to check if the element of seq appear in the right order in your permutation.",
    "created_at": "2021-03-18T10:29:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508068",
    "user": "https://github.com/enadeau"
}
```

<div id="comment:12" align="right">Comment 12</div>

About [comment:6](#comment%3A6), you actually don't need to use `index` at all. You can do a single pass on your permutation to check if the element of seq appear in the right order in your permutation.



---

archive/issue_events_415335.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415335"
}
```



---

archive/issue_events_415336.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415336"
}
```



---

archive/issue_comments_508069.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nSage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508069",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">Comment 13</div>

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_508070.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nThere's a clever Python way to check if one sequence is a subsequence of another with a single pass ( https://stackoverflow.com/questions/24017363/how-to-test-if-one-string-is-a-subsequence-of-another ):\n\n```\ndef is_subseq(x, y):\n    it = iter(y)\n    return all(c in it for c in x)\n```\n\nShort enough that you could eliminate the helper function and go with\n\n```\nit = iter(self)\nif seq == sorted(seq) and all(c in it for c in seq):\n```\n\nthough including the helper function with the name may make code more transparent.\n\nWere there any other lingering concerns besides fixing that helper function? If no other concerns and no preference between in-line vs helper function, I'll pick one, push the change and set to 'needs review'.",
    "created_at": "2021-07-05T23:05:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508070",
    "user": "https://github.com/kevindilks"
}
```

<div id="comment:14" align="right">Comment 14</div>

There's a clever Python way to check if one sequence is a subsequence of another with a single pass ( https://stackoverflow.com/questions/24017363/how-to-test-if-one-string-is-a-subsequence-of-another ):

```
def is_subseq(x, y):
    it = iter(y)
    return all(c in it for c in x)
```

Short enough that you could eliminate the helper function and go with

```
it = iter(self)
if seq == sorted(seq) and all(c in it for c in seq):
```

though including the helper function with the name may make code more transparent.

Were there any other lingering concerns besides fixing that helper function? If no other concerns and no preference between in-line vs helper function, I'll pick one, push the change and set to 'needs review'.



---

archive/issue_comments_508071.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nI tried to implement Kevin's solution, but it runs slower than Peter's proposed solution on my computer. I agree that the code would look better, though.\nI think that Peter is working on a clever and much faster solution that would involve a directed graph to store the potential increasing subsequences. That would reduce the number of sequences to check, and they would automatically be subsequences of the permutation (so there would be no need to check that they indeed are; getting rid of the problem pointed out here).\n\nMaybe Peter can confirm my thoughts and update us with where he is in the process.",
    "created_at": "2021-07-07T15:06:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508071",
    "user": "https://github.com/nadialafreniere"
}
```

<div id="comment:15" align="right">Comment 15</div>

I tried to implement Kevin's solution, but it runs slower than Peter's proposed solution on my computer. I agree that the code would look better, though.
I think that Peter is working on a clever and much faster solution that would involve a directed graph to store the potential increasing subsequences. That would reduce the number of sequences to check, and they would automatically be subsequences of the permutation (so there would be no need to check that they indeed are; getting rid of the problem pointed out here).

Maybe Peter can confirm my thoughts and update us with where he is in the process.



---

archive/issue_comments_508072.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508072",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:16" align="right">Comment 16</div>

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_415337.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415337"
}
```



---

archive/issue_events_415338.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415338"
}
```



---

archive/issue_events_415339.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415339"
}
```



---

archive/issue_events_415340.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415340"
}
```



---

archive/issue_events_415341.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415341"
}
```



---

archive/issue_events_415342.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415342"
}
```



---

archive/issue_comments_508073.json:
```json
{
    "body": "Changed branch from **[u/gh-petermoraw/LongestIncreasingSubsequences](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-petermoraw/LongestIncreasingSubsequences)** to **[u/nadialafreniere/LongestIncreasingSubsequences](https://github.com/sagemath/sagetrac-mirror/tree/u/nadialafreniere/LongestIncreasingSubsequences)**",
    "created_at": "2022-07-15T16:21:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508073",
    "user": "https://github.com/nadialafreniere"
}
```

Changed branch from **[u/gh-petermoraw/LongestIncreasingSubsequences](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-petermoraw/LongestIncreasingSubsequences)** to **[u/nadialafreniere/LongestIncreasingSubsequences](https://github.com/sagemath/sagetrac-mirror/tree/u/nadialafreniere/LongestIncreasingSubsequences)**



---

archive/issue_comments_508074.json:
```json
{
    "body": "Changed author from **Peter Morawitz** to **Peter Morawitz. Finn Hulse, Nadia Lafreni\u00e8re**",
    "created_at": "2022-07-15T16:22:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508074",
    "user": "https://github.com/nadialafreniere"
}
```

Changed author from **Peter Morawitz** to **Peter Morawitz. Finn Hulse, Nadia Lafrenière**



---

archive/issue_events_415343.json:
```json
{
    "actor": "https://github.com/nadialafreniere",
    "created_at": "2022-07-15T16:22:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415343"
}
```



---

archive/issue_events_415344.json:
```json
{
    "actor": "https://github.com/nadialafreniere",
    "created_at": "2022-07-15T16:22:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415344"
}
```



---

archive/issue_comments_508075.json:
```json
{
    "body": "Changed commit from **[1f7a29a](https://github.com/sagemath/sagetrac-mirror/commit/1f7a29ae89f3b1e5b3144451c4860d7b9c19e0fe)** to **[f5d40fa](https://github.com/sagemath/sagetrac-mirror/commit/f5d40fa41d7cdee746b26a98a6a64f10eba47579)**",
    "created_at": "2022-07-15T16:22:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508075",
    "user": "https://github.com/nadialafreniere"
}
```

Changed commit from **[1f7a29a](https://github.com/sagemath/sagetrac-mirror/commit/1f7a29ae89f3b1e5b3144451c4860d7b9c19e0fe)** to **[f5d40fa](https://github.com/sagemath/sagetrac-mirror/commit/f5d40fa41d7cdee746b26a98a6a64f10eba47579)**



---

archive/issue_comments_508076.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nPeter decided to leave the project. I took his ideas as well as some ideas from Finn Hulse, another student I had in my class, to write the patch that should solve the problem. Instead of listing all potential longest increasing subsequences and checking for their presence in the sequence, it uses a directed graph in which all the paths from a source vertex to a sink are longest increasing subsequences.\n\nAs for speeding up the solution, I get the following results:\n\n```\nsage: %timeit Permutations(30).random_element().longest_increasing_subsequences()\n416 \u00b5s \u00b1 6.73 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: %timeit Permutations(100).random_element().longest_increasing_subsequences()\n3.34 ms \u00b1 291 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n```\n\nIn comparison, with the code currently in Sage 9.7.beta5, I get\n\n```\nsage: %timeit Permutations(30).random_element().longest_increasing_subsequences()\nThe slowest run took 34.93 times longer than the fastest. This could mean that an intermediate result is being cached.\n6min 27s \u00b1 6min 38s per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n```\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0466305070c1c780fe5c15faad4d526f1329dabd\">0466305</a></td><td><code>Merge branch 'u/gh-petermoraw/LongestIncreasingSubsequences' of git://trac.sagemath.org/sage into t/31451/LongestIncreasingSubsequences</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f5d40fa41d7cdee746b26a98a6a64f10eba47579\">f5d40fa</a></td><td><code>Implemented the digraph solution for enumerating longest increasing subsequences</code></td></tr></table>\n",
    "created_at": "2022-07-15T16:22:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508076",
    "user": "https://github.com/nadialafreniere"
}
```

<div id="comment:20" align="right">Comment 20</div>

Peter decided to leave the project. I took his ideas as well as some ideas from Finn Hulse, another student I had in my class, to write the patch that should solve the problem. Instead of listing all potential longest increasing subsequences and checking for their presence in the sequence, it uses a directed graph in which all the paths from a source vertex to a sink are longest increasing subsequences.

As for speeding up the solution, I get the following results:

```
sage: %timeit Permutations(30).random_element().longest_increasing_subsequences()
416 µs ± 6.73 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: %timeit Permutations(100).random_element().longest_increasing_subsequences()
3.34 ms ± 291 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
```

In comparison, with the code currently in Sage 9.7.beta5, I get

```
sage: %timeit Permutations(30).random_element().longest_increasing_subsequences()
The slowest run took 34.93 times longer than the fastest. This could mean that an intermediate result is being cached.
6min 27s ± 6min 38s per loop (mean ± std. dev. of 7 runs, 1 loop each)
```

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0466305070c1c780fe5c15faad4d526f1329dabd">0466305</a></td><td><code>Merge branch 'u/gh-petermoraw/LongestIncreasingSubsequences' of git://trac.sagemath.org/sage into t/31451/LongestIncreasingSubsequences</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f5d40fa41d7cdee746b26a98a6a64f10eba47579">f5d40fa</a></td><td><code>Implemented the digraph solution for enumerating longest increasing subsequences</code></td></tr></table>




---

archive/issue_comments_508077.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nSorry, I realized I push the wrong branch. Will push the correct one soon.",
    "created_at": "2022-07-15T19:33:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508077",
    "user": "https://github.com/nadialafreniere"
}
```

<div id="comment:21" align="right">Comment 21</div>

Sorry, I realized I push the wrong branch. Will push the correct one soon.



---

archive/issue_comments_508078.json:
```json
{
    "body": "Changed branch from **[u/nadialafreniere/LongestIncreasingSubsequences](https://github.com/sagemath/sagetrac-mirror/tree/u/nadialafreniere/LongestIncreasingSubsequences)** to none",
    "created_at": "2022-07-15T19:33:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508078",
    "user": "https://github.com/nadialafreniere"
}
```

Changed branch from **[u/nadialafreniere/LongestIncreasingSubsequences](https://github.com/sagemath/sagetrac-mirror/tree/u/nadialafreniere/LongestIncreasingSubsequences)** to none



---

archive/issue_comments_508079.json:
```json
{
    "body": "Changed commit from **[f5d40fa](https://github.com/sagemath/sagetrac-mirror/commit/f5d40fa41d7cdee746b26a98a6a64f10eba47579)** to none",
    "created_at": "2022-07-15T19:33:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508079",
    "user": "https://github.com/nadialafreniere"
}
```

Changed commit from **[f5d40fa](https://github.com/sagemath/sagetrac-mirror/commit/f5d40fa41d7cdee746b26a98a6a64f10eba47579)** to none



---

archive/issue_comments_508080.json:
```json
{
    "body": "Commit: **[8d1c1d6](https://github.com/sagemath/sagetrac-mirror/commit/8d1c1d6d8e39875c22299ec1912752db0e9332b6)**",
    "created_at": "2022-07-15T20:07:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508080",
    "user": "https://github.com/nadialafreniere"
}
```

Commit: **[8d1c1d6](https://github.com/sagemath/sagetrac-mirror/commit/8d1c1d6d8e39875c22299ec1912752db0e9332b6)**



---

archive/issue_comments_508081.json:
```json
{
    "body": "Branch: **[u/nadialafreniere/LongestIncreasingSubsequences2](https://github.com/sagemath/sagetrac-mirror/tree/u/nadialafreniere/LongestIncreasingSubsequences2)**",
    "created_at": "2022-07-15T20:07:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508081",
    "user": "https://github.com/nadialafreniere"
}
```

Branch: **[u/nadialafreniere/LongestIncreasingSubsequences2](https://github.com/sagemath/sagetrac-mirror/tree/u/nadialafreniere/LongestIncreasingSubsequences2)**



---

archive/issue_comments_508082.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nFixed the branch issue.",
    "created_at": "2022-07-15T20:07:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508082",
    "user": "https://github.com/nadialafreniere"
}
```

<div id="comment:22" align="right">Comment 22</div>

Fixed the branch issue.



---

archive/issue_comments_508083.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nI think the end would be clearer as\n\n```diff\n-        increasing_subsequences = []\n    \n        for i in columns[0]:\n            D.add_edge(0, i)  # 0 is source\n        for i in columns[-1]:\n            D.add_edge(i, n+1) # n+1 is sink\n\n-        for p in D.all_paths(0, n+1):\n-            increasing_subsequences.append(p[1:-1])\n+        increasing_subsequences = [p[1:-1] for p in D.all_paths(0, n+1)]\n```",
    "created_at": "2022-07-21T21:02:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508083",
    "user": "https://github.com/videlec"
}
```

<div id="comment:23" align="right">Comment 23</div>

I think the end would be clearer as

```diff
-        increasing_subsequences = []
    
        for i in columns[0]:
            D.add_edge(0, i)  # 0 is source
        for i in columns[-1]:
            D.add_edge(i, n+1) # n+1 is sink

-        for p in D.all_paths(0, n+1):
-            increasing_subsequences.append(p[1:-1])
+        increasing_subsequences = [p[1:-1] for p in D.all_paths(0, n+1)]
```



---

archive/issue_comments_508084.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nAnother detail,\n\n```\n        increasing_subsequences.sort()\n        increasing_subsequences.reverse()\n```\nwould better be\n\n```\n        increasing_subsequences.sort(reverse=True)\n```",
    "created_at": "2022-07-21T21:06:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508084",
    "user": "https://github.com/videlec"
}
```

<div id="comment:24" align="right">Comment 24</div>

Another detail,

```
        increasing_subsequences.sort()
        increasing_subsequences.reverse()
```
would better be

```
        increasing_subsequences.sort(reverse=True)
```



---

archive/issue_comments_508085.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nWouldn't it be more efficient to keep the lists in `columns` sorted so that one can do early stop\n\n```\nfor k in columns[j-1]:\n    if k >= self[i]:\n        break\n    D.add_edge(k, self[i])\n```\nOf course keeping them sorted imposes a `log(|size|)` for insertion + something smarter than a list as a data structure.",
    "created_at": "2022-07-21T21:12:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508085",
    "user": "https://github.com/videlec"
}
```

<div id="comment:25" align="right">Comment 25</div>

Wouldn't it be more efficient to keep the lists in `columns` sorted so that one can do early stop

```
for k in columns[j-1]:
    if k >= self[i]:
        break
    D.add_edge(k, self[i])
```
Of course keeping them sorted imposes a `log(|size|)` for insertion + something smarter than a list as a data structure.



---

archive/issue_comments_508086.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/62b9a399268375ef45311c9d773f40227a7dcfd6\">62b9a39</a></td><td><code>Simplified end of code for longest increasing subsequences</code></td></tr></table>\n",
    "created_at": "2022-07-22T16:23:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508086",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26" align="right">Comment 26</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/62b9a399268375ef45311c9d773f40227a7dcfd6">62b9a39</a></td><td><code>Simplified end of code for longest increasing subsequences</code></td></tr></table>




---

archive/issue_comments_508087.json:
```json
{
    "body": "Changed commit from **[8d1c1d6](https://github.com/sagemath/sagetrac-mirror/commit/8d1c1d6d8e39875c22299ec1912752db0e9332b6)** to **[62b9a39](https://github.com/sagemath/sagetrac-mirror/commit/62b9a399268375ef45311c9d773f40227a7dcfd6)**",
    "created_at": "2022-07-22T16:23:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508087",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8d1c1d6](https://github.com/sagemath/sagetrac-mirror/commit/8d1c1d6d8e39875c22299ec1912752db0e9332b6)** to **[62b9a39](https://github.com/sagemath/sagetrac-mirror/commit/62b9a399268375ef45311c9d773f40227a7dcfd6)**



---

archive/issue_comments_508088.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nThanks, Vincent, for your comments. I implemented the changes to the end of the code. I believe it is more readable now.\n\nReplying to [@videlec](#comment%3A25):\n> Wouldn't it be more efficient to keep the lists in `columns` sorted so that one can do early stop\n> \n> ```\n> for k in columns[j-1]:\n>     if k >= self[i]:\n>         break\n>     D.add_edge(k, self[i])\n> ```\n> Of course keeping them sorted imposes a `log(|size|)` for insertion + something smarter than a list as a data structure.\n\nThat would indeed be more efficient. I'm trying to think of the appropriate data structure for it, but I'm not sure how to handle this in order to keep it efficient. Did you have anything in mind?",
    "created_at": "2022-07-22T16:24:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508088",
    "user": "https://github.com/nadialafreniere"
}
```

<div id="comment:27" align="right">Comment 27</div>

Thanks, Vincent, for your comments. I implemented the changes to the end of the code. I believe it is more readable now.

Replying to [@videlec](#comment%3A25):
> Wouldn't it be more efficient to keep the lists in `columns` sorted so that one can do early stop
> 
> ```
> for k in columns[j-1]:
>     if k >= self[i]:
>         break
>     D.add_edge(k, self[i])
> ```
> Of course keeping them sorted imposes a `log(|size|)` for insertion + something smarter than a list as a data structure.

That would indeed be more efficient. I'm trying to think of the appropriate data structure for it, but I'm not sure how to handle this in order to keep it efficient. Did you have anything in mind?



---

archive/issue_comments_508089.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nYou can maintain the elements in a column sorted using\n\n```\nsage: from bisect import insort\nsage: L = []\nsage: for e in Permutations(30).random_element():\n....:     insort(L, e)\nsage: print(L)\n[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30]\n```\n\nYou can also avoid the call to method `self.longest_increasing_subsequence_length` and ensure that both `use `first_row_p_tableau` and `columns[j]` are sorted. Overall this is faster than your current code.\n\n```\ndef longest_increasing_subsequences(self):\n    r\"\"\"\n    \"\"\"\n    n = self.size()\n    if not n:\n        return([[]])\n\n    from bisect import insort\n\n    # getting the column in which each element is inserted\n    first_row_p_tableau = []\n    columns = []\n    D = DiGraph(n+2)\n    for x in self:\n        j = bisect(first_row_p_tableau, x)\n        if j == len(first_row_p_tableau):\n            if columns:\n                for k in columns[-1]:\n                    if k >= x:\n                        break\n                    D.add_edge(k, x)\n            first_row_p_tableau.append(x)\n            columns.append([x])\n        else:\n            first_row_p_tableau[j] = x\n            insort(columns[j], x)\n            if j:\n                for k in columns[j-1]:\n                    if k >= x:\n                        break\n                    D.add_edge(k, x)\n\n    for i in columns[0]:\n        D.add_edge(0, i)  # 0 is source\n    for i in columns[-1]:\n        D.add_edge(i, n+1)  # n+1 is sink\n\n    return sorted([p[1:-1] for p in D.all_paths(0, n+1)], reverse=True)\n```",
    "created_at": "2022-07-23T10:07:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508089",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:28" align="right">Comment 28</div>

You can maintain the elements in a column sorted using

```
sage: from bisect import insort
sage: L = []
sage: for e in Permutations(30).random_element():
....:     insort(L, e)
sage: print(L)
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30]
```

You can also avoid the call to method `self.longest_increasing_subsequence_length` and ensure that both `use `first_row_p_tableau` and `columns[j]` are sorted. Overall this is faster than your current code.

```
def longest_increasing_subsequences(self):
    r"""
    """
    n = self.size()
    if not n:
        return([[]])

    from bisect import insort

    # getting the column in which each element is inserted
    first_row_p_tableau = []
    columns = []
    D = DiGraph(n+2)
    for x in self:
        j = bisect(first_row_p_tableau, x)
        if j == len(first_row_p_tableau):
            if columns:
                for k in columns[-1]:
                    if k >= x:
                        break
                    D.add_edge(k, x)
            first_row_p_tableau.append(x)
            columns.append([x])
        else:
            first_row_p_tableau[j] = x
            insort(columns[j], x)
            if j:
                for k in columns[j-1]:
                    if k >= x:
                        break
                    D.add_edge(k, x)

    for i in columns[0]:
        D.add_edge(0, i)  # 0 is source
    for i in columns[-1]:
        D.add_edge(i, n+1)  # n+1 is sink

    return sorted([p[1:-1] for p in D.all_paths(0, n+1)], reverse=True)
```



---

archive/issue_comments_508090.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,3 +13,5 @@\n The slowest run took 10.40 times longer than the fastest. This could mean that an intermediate result is being cached.\n 3min 34s \u00b1 2min 47s per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n ```\n+\n+follow-up: #34218\n``````\n",
    "created_at": "2022-07-25T07:19:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508090",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,3 +13,5 @@
 The slowest run took 10.40 times longer than the fastest. This could mean that an intermediate result is being cached.
 3min 34s ± 2min 47s per loop (mean ± std. dev. of 7 runs, 1 loop each)
 ```
+
+follow-up: #34218
``````




---

archive/issue_comments_508091.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nI did not know about `bisect.insort`. The Python implementation of list uses contiguous array so that insertion is `O(n)` and not `O(log n)`. A priori, using balanced search tree would be more efficient here : iterating through them is `O(1)` per element and insertion is `O(log n)`. Browsing quickly, I found https://pypi.org/project/blist/. But since we are dealing with integers, I would go with the `bstree` from `boost` in C++. Not sure it is worth implementing it, but it could be mentioned as a remark in the code.",
    "created_at": "2022-07-25T07:29:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508091",
    "user": "https://github.com/videlec"
}
```

<div id="comment:30" align="right">Comment 30</div>

I did not know about `bisect.insort`. The Python implementation of list uses contiguous array so that insertion is `O(n)` and not `O(log n)`. A priori, using balanced search tree would be more efficient here : iterating through them is `O(1)` per element and insertion is `O(log n)`. Browsing quickly, I found https://pypi.org/project/blist/. But since we are dealing with integers, I would go with the `bstree` from `boost` in C++. Not sure it is worth implementing it, but it could be mentioned as a remark in the code.



---

archive/issue_comments_508092.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nRight, insort is `O(n)`.  What we need here is a data structure with quick insert and enabling to iterate over the elements in increasing order without extra cost...",
    "created_at": "2022-07-25T08:43:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508092",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:31" align="right">Comment 31</div>

Right, insort is `O(n)`.  What we need here is a data structure with quick insert and enabling to iterate over the elements in increasing order without extra cost...



---

archive/issue_comments_508093.json:
```json
{
    "body": "Changed commit from **[62b9a39](https://github.com/sagemath/sagetrac-mirror/commit/62b9a399268375ef45311c9d773f40227a7dcfd6)** to **[4a7f5c8](https://github.com/sagemath/sagetrac-mirror/commit/4a7f5c8cf4097ff903f625d1e4b97b5416308fba)**",
    "created_at": "2022-07-25T15:58:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508093",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[62b9a39](https://github.com/sagemath/sagetrac-mirror/commit/62b9a399268375ef45311c9d773f40227a7dcfd6)** to **[4a7f5c8](https://github.com/sagemath/sagetrac-mirror/commit/4a7f5c8cf4097ff903f625d1e4b97b5416308fba)**



---

archive/issue_comments_508094.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a7f5c8cf4097ff903f625d1e4b97b5416308fba\">4a7f5c8</a></td><td><code>Use of bisect for columns in longest_increasing_subsequences</code></td></tr></table>\n",
    "created_at": "2022-07-25T15:58:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508094",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32" align="right">Comment 32</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a7f5c8cf4097ff903f625d1e4b97b5416308fba">4a7f5c8</a></td><td><code>Use of bisect for columns in longest_increasing_subsequences</code></td></tr></table>




---

archive/issue_comments_508095.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nThanks, David. I did not know about bisect either. That's a great improvement!\nI left the columns into sorted lists and did not implement the BST mostly because I think that the code is easier to read this way and because the code is still pretty fast. Given how slow it used to be, I doubt anyone ever used this code on large permutations. As suggested by Vincent, I added a note to the docstring about it. If others think a more efficient data structure is worth implementing, I would also be fine with it.",
    "created_at": "2022-07-25T16:03:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508095",
    "user": "https://github.com/nadialafreniere"
}
```

<div id="comment:33" align="right">Comment 33</div>

Thanks, David. I did not know about bisect either. That's a great improvement!
I left the columns into sorted lists and did not implement the BST mostly because I think that the code is easier to read this way and because the code is still pretty fast. Given how slow it used to be, I doubt anyone ever used this code on large permutations. As suggested by Vincent, I added a note to the docstring about it. If others think a more efficient data structure is worth implementing, I would also be fine with it.



---

archive/issue_comments_508096.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nNadia, you need a line break after `.. NOTE::` as in\n\n```\n        .. NOTE::\n\n            This algorithm could be made faster using a balanced search tree\n            for each column instead of sorted lists. See discussion on\n            :trac:`31451`.\n```",
    "created_at": "2022-07-25T16:30:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508096",
    "user": "https://github.com/videlec"
}
```

<div id="comment:34" align="right">Comment 34</div>

Nadia, you need a line break after `.. NOTE::` as in

```
        .. NOTE::

            This algorithm could be made faster using a balanced search tree
            for each column instead of sorted lists. See discussion on
            :trac:`31451`.
```



---

archive/issue_comments_508097.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nThe rest looks perfectly good to me. Thanks.",
    "created_at": "2022-07-25T16:32:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508097",
    "user": "https://github.com/videlec"
}
```

<div id="comment:35" align="right">Comment 35</div>

The rest looks perfectly good to me. Thanks.



---

archive/issue_comments_508098.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nand also 2 spaces before comments. Just a coding style.\n\n```diff\n-            D.add_edge(i, n+1) # n+1 is sink\n+            D.add_edge(i, n+1)  # n+1 is sink\n```\n\nI also think that this code is good enough for now.",
    "created_at": "2022-07-25T16:40:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508098",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:36" align="right">Comment 36</div>

and also 2 spaces before comments. Just a coding style.

```diff
-            D.add_edge(i, n+1) # n+1 is sink
+            D.add_edge(i, n+1)  # n+1 is sink
```

I also think that this code is good enough for now.



---

archive/issue_comments_508099.json:
```json
{
    "body": "Changed commit from **[4a7f5c8](https://github.com/sagemath/sagetrac-mirror/commit/4a7f5c8cf4097ff903f625d1e4b97b5416308fba)** to **[5969eda](https://github.com/sagemath/sagetrac-mirror/commit/5969edaa2e395e683feaba38db8ea94c6290e996)**",
    "created_at": "2022-07-25T17:24:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508099",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4a7f5c8](https://github.com/sagemath/sagetrac-mirror/commit/4a7f5c8cf4097ff903f625d1e4b97b5416308fba)** to **[5969eda](https://github.com/sagemath/sagetrac-mirror/commit/5969edaa2e395e683feaba38db8ea94c6290e996)**



---

archive/issue_comments_508100.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5969edaa2e395e683feaba38db8ea94c6290e996\">5969eda</a></td><td><code>proper formatting for longest_increasing_subsequences</code></td></tr></table>\n",
    "created_at": "2022-07-25T17:24:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508100",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:37" align="right">Comment 37</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5969edaa2e395e683feaba38db8ea94c6290e996">5969eda</a></td><td><code>proper formatting for longest_increasing_subsequences</code></td></tr></table>




---

archive/issue_comments_508101.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nReplying to [@videlec](#comment%3A35):\n> The rest looks perfectly good to me. Thanks.\n\n\nThanks, Vincent. I just fixed the formatting.",
    "created_at": "2022-07-25T17:25:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508101",
    "user": "https://github.com/nadialafreniere"
}
```

<div id="comment:38" align="right">Comment 38</div>

Replying to [@videlec](#comment%3A35):
> The rest looks perfectly good to me. Thanks.


Thanks, Vincent. I just fixed the formatting.



---

archive/issue_events_415345.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-07-25T17:27:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415345"
}
```



---

archive/issue_events_415346.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2022-07-25T17:27:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415346"
}
```



---

archive/issue_comments_508102.json:
```json
{
    "body": "Reviewer: **David Coudert, Vincent Delecroix**",
    "created_at": "2022-07-25T17:27:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508102",
    "user": "https://github.com/videlec"
}
```

Reviewer: **David Coudert, Vincent Delecroix**



---

archive/issue_comments_508103.json:
```json
{
    "body": "Changed author from **Peter Morawitz. Finn Hulse, Nadia Lafreni\u00e8re** to **Peter Morawitz, Finn Hulse, Nadia Lafreni\u00e8re**",
    "created_at": "2022-07-27T08:06:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508103",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Peter Morawitz. Finn Hulse, Nadia Lafrenière** to **Peter Morawitz, Finn Hulse, Nadia Lafrenière**



---

archive/issue_events_415347.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-08-01T20:23:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415347"
}
```



---

archive/issue_events_415348.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "7f0a555ccb2f6092326487b74250dfec4324c2ae",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-08-01T20:23:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31451#event-415348"
}
```



---

archive/issue_comments_508104.json:
```json
{
    "body": "Changed branch from **[u/nadialafreniere/LongestIncreasingSubsequences2](https://github.com/sagemath/sagetrac-mirror/tree/u/nadialafreniere/LongestIncreasingSubsequences2)** to **[5969eda](https://github.com/sagemath/sagetrac-mirror/commit/5969edaa2e395e683feaba38db8ea94c6290e996)**",
    "created_at": "2022-08-01T20:23:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31451#issuecomment-508104",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/nadialafreniere/LongestIncreasingSubsequences2](https://github.com/sagemath/sagetrac-mirror/tree/u/nadialafreniere/LongestIncreasingSubsequences2)** to **[5969eda](https://github.com/sagemath/sagetrac-mirror/commit/5969edaa2e395e683feaba38db8ea94c6290e996)**
