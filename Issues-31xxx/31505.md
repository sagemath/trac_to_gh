# Issue 31505: Extend system package scripts to handle macports; tox.ini: Add macports environment

archive/issues_031268.json:
```json
{
    "body": "Based on #30504, which added MacPorts package information, we update the system package scripts to include support for MacPorts.\n\nCurrent Sage builds just fine on a system with MacPorts. \nTo test this, we add `local-macports` environments to `tox.ini`:\n\n```\ntox -e local-macports-minimal\n```\nor\n\n```\ntox -e local-macports-standard             # uses /usr/bin/python3\n```\nor \n\n```\ntox -e local-macports-standard-python3.10  # uses python3.10 from macports\n```\n\nEach of these commands creates an isolated installation of MacPorts in a subdirectory of `.tox` (using https://guide.macports.org/#installing.macports.source.multiple\n); it will not use or modify `/opt/local`.  \n\n(There is also `tox -e local-macports-optlocal-standard`, which uses `sudo` to install things into the default location -- use at your own risk.)\n\nRequested at\n\n- [Ask Sage question 54790: Use OpenSSL from /opt/local/](https://ask.sagemath.org/question/54790)\n- [sage-support, 2020-12](https://groups.google.com/g/sage-support/c/_cfY37nFF84/m/1biGwJetBgAJ)\n- [sage-devel, 2022-04](https://groups.google.com/g/sage-devel/c/qTcF8tlWLcE/m/9QRODrv0CgAJ)\n\nCC:  @slel @kliem @jhpalmieri @dimpase @seblabbe @vbraun @zlscherr\n\nUpstream: Not yet reported upstream; Will do shortly.\n\nAuthor: Matthias Koeppe\n\nBranch: u/mkoeppe/tox_ini__add_macports_environment\n\nStatus: needs_review\n\nCommit: 476fa33e16780466a04556f1c87532465dbde898\n\nIssue created by migration from https://trac.sagemath.org/ticket/31505\n\n",
    "created_at": "2021-03-17T01:03:08Z",
    "labels": [
        "component: porting"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Extend system package scripts to handle macports; tox.ini: Add macports environment",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31505",
    "user": "https://github.com/mkoeppe"
}
```
Based on #30504, which added MacPorts package information, we update the system package scripts to include support for MacPorts.

Current Sage builds just fine on a system with MacPorts. 
To test this, we add `local-macports` environments to `tox.ini`:

```
tox -e local-macports-minimal
```
or

```
tox -e local-macports-standard             # uses /usr/bin/python3
```
or 

```
tox -e local-macports-standard-python3.10  # uses python3.10 from macports
```

Each of these commands creates an isolated installation of MacPorts in a subdirectory of `.tox` (using https://guide.macports.org/#installing.macports.source.multiple
); it will not use or modify `/opt/local`.  

(There is also `tox -e local-macports-optlocal-standard`, which uses `sudo` to install things into the default location -- use at your own risk.)

Requested at

- [Ask Sage question 54790: Use OpenSSL from /opt/local/](https://ask.sagemath.org/question/54790)
- [sage-support, 2020-12](https://groups.google.com/g/sage-support/c/_cfY37nFF84/m/1biGwJetBgAJ)
- [sage-devel, 2022-04](https://groups.google.com/g/sage-devel/c/qTcF8tlWLcE/m/9QRODrv0CgAJ)

CC:  @slel @kliem @jhpalmieri @dimpase @seblabbe @vbraun @zlscherr

Upstream: Not yet reported upstream; Will do shortly.

Author: Matthias Koeppe

Branch: u/mkoeppe/tox_ini__add_macports_environment

Status: needs_review

Commit: 476fa33e16780466a04556f1c87532465dbde898

Issue created by migration from https://trac.sagemath.org/ticket/31505





---

archive/issue_comments_625814.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/tox_ini__add_macports_environment\"",
    "created_at": "2021-03-17T02:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625814",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/tox_ini__add_macports_environment"



---

archive/issue_comments_625815.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,15 @@\n+\n https://guide.macports.org/#installing.macports.source.multiple\n+\n+To test:\n+\n+```\n+tox -e local-macports-minimal\n+```\n+(It creates an isolated installation of MacPorts in a subdirectory of `.tox`; it will not use or modify `/opt/local`.)\n+\n+With package lists added in #30504, it will also support `tox -e local-macports-standard`.\n+\n \n Comment: 1\n \n``````\n",
    "created_at": "2021-03-17T02:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625815",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,15 @@
+
 https://guide.macports.org/#installing.macports.source.multiple
+
+To test:
+
+```
+tox -e local-macports-minimal
+```
+(It creates an isolated installation of MacPorts in a subdirectory of `.tox`; it will not use or modify `/opt/local`.)
+
+With package lists added in #30504, it will also support `tox -e local-macports-standard`.
+
 
 Comment: 1
 
``````




---

archive/issue_comments_625816.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-03-17T02:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625816",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_625817.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2021-03-17T02:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625817",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_625818.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2021-03-17T02:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625818",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_625819.json:
```json
{
    "body": "Changing commit from \"\" to \"72c92412c8bd9fa903c24084ef2a42590eb30ae7\"",
    "created_at": "2021-03-17T02:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625819",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "72c92412c8bd9fa903c24084ef2a42590eb30ae7"



---

archive/issue_comments_625820.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-17T21:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625820",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625821.json:
```json
{
    "body": "Changing commit from \"72c92412c8bd9fa903c24084ef2a42590eb30ae7\" to \"b6f1596e6e250f2f4a3bf537051154f4fc1933f2\"",
    "created_at": "2021-03-17T21:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625821",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "72c92412c8bd9fa903c24084ef2a42590eb30ae7" to "b6f1596e6e250f2f4a3bf537051154f4fc1933f2"



---

archive/issue_comments_625822.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-18T19:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625822",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625823.json:
```json
{
    "body": "Changing commit from \"b6f1596e6e250f2f4a3bf537051154f4fc1933f2\" to \"218989037968aa4d94c2b151cb3183bd5840b184\"",
    "created_at": "2021-03-18T19:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625823",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b6f1596e6e250f2f4a3bf537051154f4fc1933f2" to "218989037968aa4d94c2b151cb3183bd5840b184"



---

archive/issue_comments_625824.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#30504\"",
    "created_at": "2021-03-18T19:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625824",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#30504"



---

archive/issue_comments_625825.json:
```json
{
    "body": "Changing commit from \"218989037968aa4d94c2b151cb3183bd5840b184\" to \"4acfc5c8bed0227762a73ff23204bdce2e88e5cf\"",
    "created_at": "2021-03-18T19:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625825",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "218989037968aa4d94c2b151cb3183bd5840b184" to "4acfc5c8bed0227762a73ff23204bdce2e88e5cf"



---

archive/issue_comments_625826.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-18T19:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625826",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625827.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,19 @@\n+\n+https://guide.macports.org/#installing.macports.source.multiple\n+\n+To test:\n+\n+```\n+tox -e local-macports-minimal\n+```\n+or\n+\n+```\n+tox -e local-macports-standard\n+```\n+It creates an isolated installation of MacPorts in a subdirectory of `.tox`; it will not use or modify `/opt/local`.  \n+\n+(There is also `tox -e local-macports-optlocal`, which uses `sudo` to install things into the default location -- use at your own risk.)\n \n \n Comment: 1\n``````\n",
    "created_at": "2021-03-18T20:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625827",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,19 @@
+
+https://guide.macports.org/#installing.macports.source.multiple
+
+To test:
+
+```
+tox -e local-macports-minimal
+```
+or
+
+```
+tox -e local-macports-standard
+```
+It creates an isolated installation of MacPorts in a subdirectory of `.tox`; it will not use or modify `/opt/local`.  
+
+(There is also `tox -e local-macports-optlocal`, which uses `sudo` to install things into the default location -- use at your own risk.)
 
 
 Comment: 1
``````




---

archive/issue_comments_625828.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,22 @@\n+Based on #30504, which added MacPorts package information, we update the system package scripts to include support for MacPorts.\n+\n+We remove the outdated ban of the systems with MacPorts (and also fink) in the configure phase.  This unfair ban has in at least one case outraged a devoted user of that packaging system.\n+\n+Current Sage builds just fine on a system with MacPorts. \n+To test this, we add `local-macports` environments to `tox.ini`:\n+\n+```\n+tox -e local-macports-minimal\n+```\n+or\n+\n+```\n+tox -e local-macports-standard\n+```\n+It creates an isolated installation of MacPorts in a subdirectory of `.tox` (using https://guide.macports.org/#installing.macports.source.multiple\n+); it will not use or modify `/opt/local`.  \n+\n+(There is also `tox -e local-macports-optlocal`, which uses `sudo` to install things into the default location -- use at your own risk.)\n \n \n Comment: 1\n``````\n",
    "created_at": "2021-03-18T22:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625828",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,22 @@
+Based on #30504, which added MacPorts package information, we update the system package scripts to include support for MacPorts.
+
+We remove the outdated ban of the systems with MacPorts (and also fink) in the configure phase.  This unfair ban has in at least one case outraged a devoted user of that packaging system.
+
+Current Sage builds just fine on a system with MacPorts. 
+To test this, we add `local-macports` environments to `tox.ini`:
+
+```
+tox -e local-macports-minimal
+```
+or
+
+```
+tox -e local-macports-standard
+```
+It creates an isolated installation of MacPorts in a subdirectory of `.tox` (using https://guide.macports.org/#installing.macports.source.multiple
+); it will not use or modify `/opt/local`.  
+
+(There is also `tox -e local-macports-optlocal`, which uses `sudo` to install things into the default location -- use at your own risk.)
 
 
 Comment: 1
``````




---

archive/issue_comments_625829.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2021-03-18T22:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625829",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_625830.json:
```json
{
    "body": "<a id='comment:13'></a>No need for a `.macports-build-env` file similar to `.homebrew-build-env`?",
    "created_at": "2021-03-21T01:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625830",
    "user": "https://github.com/slel"
}
```

<a id='comment:13'></a>No need for a `.macports-build-env` file similar to `.homebrew-build-env`?



---

archive/issue_comments_625831.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,27 @@\n+Based on #30504, which added MacPorts package information, we update the system package scripts to include support for MacPorts.\n \n+We remove the outdated ban of the systems with MacPorts (and also fink) in the configure phase.  This unfair ban has in at least one case outraged a devoted user of that packaging system.\n+\n+Current Sage builds just fine on a system with MacPorts. \n+To test this, we add `local-macports` environments to `tox.ini`:\n+\n+```\n+tox -e local-macports-minimal\n+```\n+or\n+\n+```\n+tox -e local-macports-standard\n+```\n+It creates an isolated installation of MacPorts in a subdirectory of `.tox` (using https://guide.macports.org/#installing.macports.source.multiple\n+); it will not use or modify `/opt/local`.  \n+\n+(There is also `tox -e local-macports-optlocal`, which uses `sudo` to install things into the default location -- use at your own risk.)\n+\n+Requested at\n+\n+- [Ask Sage question 54790: Use OpenSSL from /opt/local/](https://ask.sagemath.org/question/54790)\n+- [sage-support, 2020-12](https://groups.google.com/g/sage-support/c/_cfY37nFF84/m/1biGwJetBgAJ)\n \n Comment: 1\n \n``````\n",
    "created_at": "2021-03-21T02:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625831",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,27 @@
+Based on #30504, which added MacPorts package information, we update the system package scripts to include support for MacPorts.
 
+We remove the outdated ban of the systems with MacPorts (and also fink) in the configure phase.  This unfair ban has in at least one case outraged a devoted user of that packaging system.
+
+Current Sage builds just fine on a system with MacPorts. 
+To test this, we add `local-macports` environments to `tox.ini`:
+
+```
+tox -e local-macports-minimal
+```
+or
+
+```
+tox -e local-macports-standard
+```
+It creates an isolated installation of MacPorts in a subdirectory of `.tox` (using https://guide.macports.org/#installing.macports.source.multiple
+); it will not use or modify `/opt/local`.  
+
+(There is also `tox -e local-macports-optlocal`, which uses `sudo` to install things into the default location -- use at your own risk.)
+
+Requested at
+
+- [Ask Sage question 54790: Use OpenSSL from /opt/local/](https://ask.sagemath.org/question/54790)
+- [sage-support, 2020-12](https://groups.google.com/g/sage-support/c/_cfY37nFF84/m/1biGwJetBgAJ)
 
 Comment: 1
 
``````




---

archive/issue_comments_625832.json:
```json
{
    "body": "<a id='comment:15'></a>I don't think we need this - only 1 command is needed to prepare the build",
    "created_at": "2021-03-21T04:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625832",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>I don't think we need this - only 1 command is needed to prepare the build



---

archive/issue_comments_625833.json:
```json
{
    "body": "<a id='comment:16'></a>The `tox -e ...` commands run `./bootstrap && ./configure && make` or similar.\n\nCould they run `./bootstrap -q && ./configure -q && make -s V=0` instead?",
    "created_at": "2021-03-21T12:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625833",
    "user": "https://github.com/slel"
}
```

<a id='comment:16'></a>The `tox -e ...` commands run `./bootstrap && ./configure && make` or similar.

Could they run `./bootstrap -q && ./configure -q && make -s V=0` instead?



---

archive/issue_comments_625834.json:
```json
{
    "body": "<a id='comment:17'></a>Oh in fact they already do. Sorry for the noise. I'm trying this out and will report.",
    "created_at": "2021-03-21T12:57:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625834",
    "user": "https://github.com/slel"
}
```

<a id='comment:17'></a>Oh in fact they already do. Sorry for the noise. I'm trying this out and will report.



---

archive/issue_comments_625835.json:
```json
{
    "body": "<a id='comment:18'></a>Yes, `make` runs with `V=0`, but for the others I really want to see the output.",
    "created_at": "2021-03-21T16:24:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625835",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>Yes, `make` runs with `V=0`, but for the others I really want to see the output.



---

archive/issue_comments_625836.json:
```json
{
    "body": "<a id='comment:19'></a>For more quiet, you can use `tox -p auto -e local-macports-standard -- config.status` (logs will appear in `.tox/local-macports-standard/log`",
    "created_at": "2021-03-21T16:33:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625836",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>For more quiet, you can use `tox -p auto -e local-macports-standard -- config.status` (logs will appear in `.tox/local-macports-standard/log`



---

archive/issue_comments_625837.json:
```json
{
    "body": "<a id='comment:20'></a>In a fresh clone, I ran:\n\n```\n$ git trac checkout 31505\n$ git trac fetch 31496 && git merge FETCH_HEAD -m \"Merge 31496\"\n$ git trac fetch 31335 && git merge FETCH_HEAD -m \"Merge 31335\"\n$ git trac fetch 31474 && git merge FETCH_HEAD -m \"Merge 31474\"\n```\nand then got this for `local-macports-minimal`\n(I'm a bit surprised it succeeds so fast):\n\n```\n$ tox -p auto -e local-macports-minimal -- config.status\n\u2714 OK local-macports-minimal in 32 minutes, 29.252 seconds\n_________________________ summary _________________________\n  local-macports-minimal: commands succeeded\n  congratulations :)\n```\nAs for `local-macports-standard`, it is taking a lot longer.\nI'll report when it's done.",
    "created_at": "2021-03-22T10:32:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625837",
    "user": "https://github.com/slel"
}
```

<a id='comment:20'></a>In a fresh clone, I ran:

```
$ git trac checkout 31505
$ git trac fetch 31496 && git merge FETCH_HEAD -m "Merge 31496"
$ git trac fetch 31335 && git merge FETCH_HEAD -m "Merge 31335"
$ git trac fetch 31474 && git merge FETCH_HEAD -m "Merge 31474"
```
and then got this for `local-macports-minimal`
(I'm a bit surprised it succeeds so fast):

```
$ tox -p auto -e local-macports-minimal -- config.status
✔ OK local-macports-minimal in 32 minutes, 29.252 seconds
_________________________ summary _________________________
  local-macports-minimal: commands succeeded
  congratulations :)
```
As for `local-macports-standard`, it is taking a lot longer.
I'll report when it's done.



---

archive/issue_comments_625838.json:
```json
{
    "body": "<a id='comment:22'></a>Let's get this into 9.3 please",
    "created_at": "2021-03-24T01:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625838",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>Let's get this into 9.3 please



---

archive/issue_comments_625839.json:
```json
{
    "body": "<a id='comment:24'></a>I tried `tox -e local-macports-standard` on OS X Big Sur, and it seems to have gotten stuck installing `sagelib`. I can't find the `logs/pkgs` directory, but `sagelib` is not listed in `.tox/local-macports-standard/local/var/lib/sage/installed`: the most recently modified file there is for `networkx`. There is also no appropriate directory in `local/lib/python3.8/site-packages/`. It looks like it's been stuck for hours now. (I'm not sure why it decided to use the Xcode Python 3.8 vs. the MacPorts Python 3.9, by the way.)",
    "created_at": "2021-03-26T16:19:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625839",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:24'></a>I tried `tox -e local-macports-standard` on OS X Big Sur, and it seems to have gotten stuck installing `sagelib`. I can't find the `logs/pkgs` directory, but `sagelib` is not listed in `.tox/local-macports-standard/local/var/lib/sage/installed`: the most recently modified file there is for `networkx`. There is also no appropriate directory in `local/lib/python3.8/site-packages/`. It looks like it's been stuck for hours now. (I'm not sure why it decided to use the Xcode Python 3.8 vs. the MacPorts Python 3.9, by the way.)



---

archive/issue_comments_625840.json:
```json
{
    "body": "<a id='comment:26'></a>Oh, the package log files are in their usual place. Here is the sagelib log file (after I hit ctrl-C to end the process).",
    "created_at": "2021-03-26T18:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625840",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:26'></a>Oh, the package log files are in their usual place. Here is the sagelib log file (after I hit ctrl-C to end the process).



---

archive/issue_comments_625841.json:
```json
{
    "body": "<a id='comment:27'></a>Attachment [sagelib-9.3.beta9.log](tarball://root/attachments/some-uuid/ticket31505/sagelib-9.3.beta9.log) by @mkoeppe created at 2021-03-26 18:59:43\n\nReplying to [comment:24 jhpalmieri]:\n> (I'm not sure why it decided to use the Xcode Python 3.8 vs. the MacPorts Python 3.9, by the way.)\n\n\nMacPorts does not install a `python3` executable, only versioned executables `python3.8`, `python3.9`. \n\nUnclear why it gets stuck in the build -- look like yet another library threads vs. python multiprocessing problem, like the ones that we chased in the parallel docbuild ticket not so long ago.\nDoes it go away if you repeat the build (it will not start from scratch)",
    "created_at": "2021-03-26T18:59:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625841",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>Attachment [sagelib-9.3.beta9.log](tarball://root/attachments/some-uuid/ticket31505/sagelib-9.3.beta9.log) by @mkoeppe created at 2021-03-26 18:59:43

Replying to [comment:24 jhpalmieri]:
> (I'm not sure why it decided to use the Xcode Python 3.8 vs. the MacPorts Python 3.9, by the way.)


MacPorts does not install a `python3` executable, only versioned executables `python3.8`, `python3.9`. 

Unclear why it gets stuck in the build -- look like yet another library threads vs. python multiprocessing problem, like the ones that we chased in the parallel docbuild ticket not so long ago.
Does it go away if you repeat the build (it will not start from scratch)



---

archive/issue_comments_625842.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-26T19:05:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625842",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625843.json:
```json
{
    "body": "Changing commit from \"4acfc5c8bed0227762a73ff23204bdce2e88e5cf\" to \"f68ed3c5bb9ce276af78de075bab7c15abe4899f\"",
    "created_at": "2021-03-26T19:05:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625843",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4acfc5c8bed0227762a73ff23204bdce2e88e5cf" to "f68ed3c5bb9ce276af78de075bab7c15abe4899f"



---

archive/issue_comments_625844.json:
```json
{
    "body": "<a id='comment:29'></a>Now you can do `tox -e local-macports-standard-python3.9`",
    "created_at": "2021-03-26T19:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625844",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>Now you can do `tox -e local-macports-standard-python3.9`



---

archive/issue_comments_625845.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,38 @@\n+Based on #30504, which added MacPorts package information, we update the system package scripts to include support for MacPorts.\n \n+We remove the outdated ban of the systems with MacPorts (and also fink) in the configure phase.  This unfair ban has in at least one case outraged a devoted user of that packaging system.\n+\n+Current Sage builds just fine on a system with MacPorts. \n+To test this, we add `local-macports` environments to `tox.ini`:\n+\n+```\n+tox -e local-macports-minimal\n+```\n+or\n+\n+```\n+tox -e local-macports-standard             # uses /usr/bin/python unless configured otherwise\n+```\n+or \n+\n+```\n+tox -e local-macports-standard-python3.8   # uses python3.8 from macports\n+```\n+or \n+\n+```\n+tox -e local-macports-standard-python3.9   # uses python3.9 from macports\n+```\n+\n+Each of these commands creates an isolated installation of MacPorts in a subdirectory of `.tox` (using https://guide.macports.org/#installing.macports.source.multiple\n+); it will not use or modify `/opt/local`.  \n+\n+(There is also `tox -e local-macports-optlocal-standard`, which uses `sudo` to install things into the default location -- use at your own risk.)\n+\n+Requested at\n+\n+- [Ask Sage question 54790: Use OpenSSL from /opt/local/](https://ask.sagemath.org/question/54790)\n+- [sage-support, 2020-12](https://groups.google.com/g/sage-support/c/_cfY37nFF84/m/1biGwJetBgAJ)\n \n Comment: 1\n \n``````\n",
    "created_at": "2021-03-26T19:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625845",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,38 @@
+Based on #30504, which added MacPorts package information, we update the system package scripts to include support for MacPorts.
 
+We remove the outdated ban of the systems with MacPorts (and also fink) in the configure phase.  This unfair ban has in at least one case outraged a devoted user of that packaging system.
+
+Current Sage builds just fine on a system with MacPorts. 
+To test this, we add `local-macports` environments to `tox.ini`:
+
+```
+tox -e local-macports-minimal
+```
+or
+
+```
+tox -e local-macports-standard             # uses /usr/bin/python unless configured otherwise
+```
+or 
+
+```
+tox -e local-macports-standard-python3.8   # uses python3.8 from macports
+```
+or 
+
+```
+tox -e local-macports-standard-python3.9   # uses python3.9 from macports
+```
+
+Each of these commands creates an isolated installation of MacPorts in a subdirectory of `.tox` (using https://guide.macports.org/#installing.macports.source.multiple
+); it will not use or modify `/opt/local`.  
+
+(There is also `tox -e local-macports-optlocal-standard`, which uses `sudo` to install things into the default location -- use at your own risk.)
+
+Requested at
+
+- [Ask Sage question 54790: Use OpenSSL from /opt/local/](https://ask.sagemath.org/question/54790)
+- [sage-support, 2020-12](https://groups.google.com/g/sage-support/c/_cfY37nFF84/m/1biGwJetBgAJ)
 
 Comment: 1
 
``````




---

archive/issue_comments_625846.json:
```json
{
    "body": "<a id='comment:31'></a>`tox -e local-macports-standard-python3.9` doesn't work for me: it ends with\n\n```\nError building Sage.\n\nThe following package(s) may have failed to build (not necessarily\nduring this run of 'make all-build'):\n\n* package:         gmpy2-2.1.0b5\n  last build time: Mar 26 18:32\n  log file:        /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/logs/pkgs/gmpy2-2.1.0b5.log\n  build directory: /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/.tox/local-macports-standard-python3.9/local/var/tmp/sage/build/gmpy2-2.1.0b5\n\n* package:         rpy2-3.3.6\n  last build time: Mar 26 18:40\n  log file:        /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/logs/pkgs/rpy2-3.3.6.log\n  build directory: /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/.tox/local-macports-standard-python3.9/local/var/tmp/sage/build/rpy2-3.3.6\n\n* package:         cysignals-1.10.2\n  last build time: Mar 26 18:42\n  log file:        /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/logs/pkgs/cysignals-1.10.2.log\n  build directory: /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/.tox/local-macports-standard-python3.9/local/var/tmp/sage/build/cysignals-1.10.2\n\n* package:         pynac-0.7.27.p1\n  last build time: Mar 26 18:43\n  log file:        /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/logs/pkgs/pynac-0.7.27.p1.log\n  build directory: /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/.tox/local-macports-standard-python3.9/local/var/tmp/sage/build/pynac-0.7.27.p1\n\n* package:         cvxopt-1.2.5\n  last build time: Mar 26 18:44\n  log file:        /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/logs/pkgs/cvxopt-1.2.5.log\n  build directory: /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/.tox/local-macports-standard-python3.9/local/var/tmp/sage/build/cvxopt-1.2.5\n\nIt is safe to delete any log files and build directories, but they\ncontain information that is helpful for debugging build problems.\nWARNING: If you now run 'make' again, the build directory of the\nsame version of the package will, by default, be deleted. Set the\nenvironment variable SAGE_KEEP_BUILT_SPKGS=yes to prevent this.\n\nmake[1]: *** [all-build] Error 1\nmake: *** [build] Error 2\n```\nrpy2:\n\n```\nclang: error: unsupported option '-fopenmp'\n```\ngmpy2:\n\n```\nIn file included from src/gmpy2.c:461:\n./src/gmpy2.h:81:12: fatal error: 'gmp.h' file not found\n```\ncysignals:\n\n```\nld: illegal thread local variable reference to regular symbol _PARI_SIGINT_block for architecture x86_64\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\nerror: command '/usr/bin/gcc' failed with exit code 1\nBuilding wheel for cysignals (setup.py): finished with status 'error'\n```\netc.",
    "created_at": "2021-03-27T02:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625846",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:31'></a>`tox -e local-macports-standard-python3.9` doesn't work for me: it ends with

```
Error building Sage.

The following package(s) may have failed to build (not necessarily
during this run of 'make all-build'):

* package:         gmpy2-2.1.0b5
  last build time: Mar 26 18:32
  log file:        /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/logs/pkgs/gmpy2-2.1.0b5.log
  build directory: /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/.tox/local-macports-standard-python3.9/local/var/tmp/sage/build/gmpy2-2.1.0b5

* package:         rpy2-3.3.6
  last build time: Mar 26 18:40
  log file:        /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/logs/pkgs/rpy2-3.3.6.log
  build directory: /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/.tox/local-macports-standard-python3.9/local/var/tmp/sage/build/rpy2-3.3.6

* package:         cysignals-1.10.2
  last build time: Mar 26 18:42
  log file:        /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/logs/pkgs/cysignals-1.10.2.log
  build directory: /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/.tox/local-macports-standard-python3.9/local/var/tmp/sage/build/cysignals-1.10.2

* package:         pynac-0.7.27.p1
  last build time: Mar 26 18:43
  log file:        /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/logs/pkgs/pynac-0.7.27.p1.log
  build directory: /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/.tox/local-macports-standard-python3.9/local/var/tmp/sage/build/pynac-0.7.27.p1

* package:         cvxopt-1.2.5
  last build time: Mar 26 18:44
  log file:        /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/logs/pkgs/cvxopt-1.2.5.log
  build directory: /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/.tox/local-macports-standard-python3.9/local/var/tmp/sage/build/cvxopt-1.2.5

It is safe to delete any log files and build directories, but they
contain information that is helpful for debugging build problems.
WARNING: If you now run 'make' again, the build directory of the
same version of the package will, by default, be deleted. Set the
environment variable SAGE_KEEP_BUILT_SPKGS=yes to prevent this.

make[1]: *** [all-build] Error 1
make: *** [build] Error 2
```
rpy2:

```
clang: error: unsupported option '-fopenmp'
```
gmpy2:

```
In file included from src/gmpy2.c:461:
./src/gmpy2.h:81:12: fatal error: 'gmp.h' file not found
```
cysignals:

```
ld: illegal thread local variable reference to regular symbol _PARI_SIGINT_block for architecture x86_64
clang: error: linker command failed with exit code 1 (use -v to see invocation)
error: command '/usr/bin/gcc' failed with exit code 1
Building wheel for cysignals (setup.py): finished with status 'error'
```
etc.



---

archive/issue_comments_625847.json:
```json
{
    "body": "<a id='comment:32'></a>Thanks for testing! Is this on a system that also has homebrew in `/usr/local`?",
    "created_at": "2021-03-27T02:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625847",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>Thanks for testing! Is this on a system that also has homebrew in `/usr/local`?



---

archive/issue_comments_625848.json:
```json
{
    "body": "Changing commit from \"f68ed3c5bb9ce276af78de075bab7c15abe4899f\" to \"c6534e9fd80565e35398df4f84ce6005e8897f9b\"",
    "created_at": "2021-03-27T02:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625848",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f68ed3c5bb9ce276af78de075bab7c15abe4899f" to "c6534e9fd80565e35398df4f84ce6005e8897f9b"



---

archive/issue_comments_625849.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-27T02:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625849",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625850.json:
```json
{
    "body": "<a id='comment:34'></a>For making sure that no homebrew stuff from `/usr/local` leaks in, I have some work in #31552, #31562, #31567",
    "created_at": "2021-03-27T02:42:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625850",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>For making sure that no homebrew stuff from `/usr/local` leaks in, I have some work in #31552, #31562, #31567



---

archive/issue_comments_625851.json:
```json
{
    "body": "<a id='comment:35'></a>Yes, it has homebrew in `/usr/local`.",
    "created_at": "2021-03-27T02:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625851",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:35'></a>Yes, it has homebrew in `/usr/local`.



---

archive/issue_comments_625852.json:
```json
{
    "body": "<a id='comment:36'></a>Could you post config.log please?",
    "created_at": "2021-03-27T02:57:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625852",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>Could you post config.log please?



---

archive/issue_comments_625853.json:
```json
{
    "body": "<a id='comment:37'></a>Here's config.log from `.tox/local-macports-standard/log`.",
    "created_at": "2021-03-27T03:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625853",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:37'></a>Here's config.log from `.tox/local-macports-standard/log`.



---

archive/issue_comments_625854.json:
```json
{
    "body": "Attachment [config.log](tarball://root/attachments/some-uuid/ticket31505/config.log) by @jhpalmieri created at 2021-03-27 03:09:41",
    "created_at": "2021-03-27T03:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625854",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [config.log](tarball://root/attachments/some-uuid/ticket31505/config.log) by @jhpalmieri created at 2021-03-27 03:09:41



---

archive/issue_comments_625855.json:
```json
{
    "body": "<a id='comment:38'></a>config.log has a lot of `/usr/local` - for gmp, ntl, boost.",
    "created_at": "2021-03-27T15:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625855",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'></a>config.log has a lot of `/usr/local` - for gmp, ntl, boost.



---

archive/issue_comments_625856.json:
```json
{
    "body": "Changing dependencies from \"#30504\" to \"#31567\"",
    "created_at": "2021-03-28T01:59:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625856",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#30504" to "#31567"



---

archive/issue_comments_625857.json:
```json
{
    "body": "Changing commit from \"c6534e9fd80565e35398df4f84ce6005e8897f9b\" to \"336a49381df30edc01e32516e2f62e9e88c689ee\"",
    "created_at": "2021-03-28T02:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625857",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c6534e9fd80565e35398df4f84ce6005e8897f9b" to "336a49381df30edc01e32516e2f62e9e88c689ee"



---

archive/issue_comments_625858.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-03-28T02:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625858",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_625859.json:
```json
{
    "body": "<a id='comment:41'></a>I tried with the new branch and I'm still not succeeding. More problematically, and this has been true throughout, the process never ends \u2014\u00a0when it hits a problem, it just hangs and I have to hit ctrl-C to stop it.",
    "created_at": "2021-03-28T05:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625859",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:41'></a>I tried with the new branch and I'm still not succeeding. More problematically, and this has been true throughout, the process never ends — when it hits a problem, it just hangs and I have to hit ctrl-C to stop it.



---

archive/issue_comments_625860.json:
```json
{
    "body": "<a id='comment:42'></a>Replying to [comment:41 jhpalmieri]:\n> More problematically, and this has been true throughout, the process never ends \u2014\u00a0when it hits a problem, it just hangs and I have to hit ctrl-C to stop it.\n\n\nCould this just be the behavior of `make -k`?  I use this throughout in runs via tox.",
    "created_at": "2021-03-28T06:49:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625860",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>Replying to [comment:41 jhpalmieri]:
> More problematically, and this has been true throughout, the process never ends — when it hits a problem, it just hangs and I have to hit ctrl-C to stop it.


Could this just be the behavior of `make -k`?  I use this throughout in runs via tox.



---

archive/issue_comments_625861.json:
```json
{
    "body": "<a id='comment:43'></a>Replying to [comment:42 mkoeppe]:\n> Could this just be the behavior of `make -k`?  I use this throughout in runs via tox.\n\nI've opened #31574 to stop imposing this as a default",
    "created_at": "2021-03-28T16:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625861",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>Replying to [comment:42 mkoeppe]:
> Could this just be the behavior of `make -k`?  I use this throughout in runs via tox.

I've opened #31574 to stop imposing this as a default



---

archive/issue_comments_625862.json:
```json
{
    "body": "<a id='comment:44'></a>I don't know. For example, when there is an error building sagelib, that particular process never ends: there is no conclusion in the sagelib log file until I halt it, and then it ends with `KeyboardInterrupt`. Is that a symptom of using `make -k`? I've used `make -k` before when building Sage and it has always stopped when it was supposed to.",
    "created_at": "2021-03-28T17:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625862",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:44'></a>I don't know. For example, when there is an error building sagelib, that particular process never ends: there is no conclusion in the sagelib log file until I halt it, and then it ends with `KeyboardInterrupt`. Is that a symptom of using `make -k`? I've used `make -k` before when building Sage and it has always stopped when it was supposed to.



---

archive/issue_comments_625863.json:
```json
{
    "body": "<a id='comment:45'></a>That sounds more like another instance of the multiprocessing bugs that we encountered recently in the docbuild, just this time affecting the parallel build of extension modules...",
    "created_at": "2021-03-28T17:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625863",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>That sounds more like another instance of the multiprocessing bugs that we encountered recently in the docbuild, just this time affecting the parallel build of extension modules...



---

archive/issue_comments_625864.json:
```json
{
    "body": "<a id='comment:46'></a>Probably better to first try out #31567",
    "created_at": "2021-03-29T03:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625864",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:46'></a>Probably better to first try out #31567



---

archive/issue_comments_625865.json:
```json
{
    "body": "Changing commit from \"336a49381df30edc01e32516e2f62e9e88c689ee\" to \"cf91f972e1d34ea30d725b217fe71adae324fe8d\"",
    "created_at": "2021-03-31T03:57:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625865",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "336a49381df30edc01e32516e2f62e9e88c689ee" to "cf91f972e1d34ea30d725b217fe71adae324fe8d"



---

archive/issue_comments_625866.json:
```json
{
    "body": "<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-31T03:57:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625866",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625867.json:
```json
{
    "body": "<a id='comment:48'></a>It seems that the macports builds don't exclude homebrew by default, so I had to use `tox -e macos-nohomebrew-local-macports-minimal` \u2014\u00a0I hope I got that right. I don't see many traces of `/usr/local` in the log files, but `openblas` failed to build, ending with\n\n```\nperl ./gensymbol osx x86_64 _ 1 0  0 0 0 0 \"\" \"\" 1 0 1 1 1 1 > osx.def\ngfortran-mp-10 -O2 -m128bit-long-double -Wall -frecursive -fno-optimize-sibling-calls -m64 -fPIC -msse3 -mssse3 -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/.tox/macos-nohomebrew-local-macports-minimal/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/.tox/macos-nohomebrew-local-macports-minimal/local/lib  -all_load -headerpad_max_install_names -install_name \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/.tox/macos-nohomebrew-local-macports-minimal/local/var/tmp/sage/build/openblas-0.3.13/src/exports/../libopenblas.0.dylib\" -dynamiclib -o ../libopenblas_atomp-r0.3.13.dylib ../libopenblas_atomp-r0.3.13.a -Wl,-exported_symbols_list,osx.def  \n/bin/sh: gfortran-mp-10: command not found\n```\nI'll attach the log file.",
    "created_at": "2021-04-01T23:54:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625867",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:48'></a>It seems that the macports builds don't exclude homebrew by default, so I had to use `tox -e macos-nohomebrew-local-macports-minimal` — I hope I got that right. I don't see many traces of `/usr/local` in the log files, but `openblas` failed to build, ending with

```
perl ./gensymbol osx x86_64 _ 1 0  0 0 0 0 "" "" 1 0 1 1 1 1 > osx.def
gfortran-mp-10 -O2 -m128bit-long-double -Wall -frecursive -fno-optimize-sibling-calls -m64 -fPIC -msse3 -mssse3 -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/.tox/macos-nohomebrew-local-macports-minimal/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/.tox/macos-nohomebrew-local-macports-minimal/local/lib  -all_load -headerpad_max_install_names -install_name "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/.tox/macos-nohomebrew-local-macports-minimal/local/var/tmp/sage/build/openblas-0.3.13/src/exports/../libopenblas.0.dylib" -dynamiclib -o ../libopenblas_atomp-r0.3.13.dylib ../libopenblas_atomp-r0.3.13.a -Wl,-exported_symbols_list,osx.def  
/bin/sh: gfortran-mp-10: command not found
```
I'll attach the log file.



---

archive/issue_comments_625868.json:
```json
{
    "body": "Attachment [openblas-0.3.13.log](tarball://root/attachments/some-uuid/ticket31505/openblas-0.3.13.log) by @jhpalmieri created at 2021-04-01 23:55:12",
    "created_at": "2021-04-01T23:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625868",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [openblas-0.3.13.log](tarball://root/attachments/some-uuid/ticket31505/openblas-0.3.13.log) by @jhpalmieri created at 2021-04-01 23:55:12



---

archive/issue_comments_625869.json:
```json
{
    "body": "<a id='comment:49'></a>config.log too please",
    "created_at": "2021-04-01T23:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625869",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:49'></a>config.log too please



---

archive/issue_comments_625870.json:
```json
{
    "body": "Attachment [config.2.log](tarball://root/attachments/some-uuid/ticket31505/config.2.log) by @jhpalmieri created at 2021-04-02 00:07:51\n\nfor nohomebrew macports-minimal",
    "created_at": "2021-04-02T00:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625870",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [config.2.log](tarball://root/attachments/some-uuid/ticket31505/config.2.log) by @jhpalmieri created at 2021-04-02 00:07:51

for nohomebrew macports-minimal



---

archive/issue_comments_625871.json:
```json
{
    "body": "<a id='comment:50'></a>I don't know if there are any helpful files in `.../local/var/tmp/build/sage/openblas/src`, but I can provide those, too.",
    "created_at": "2021-04-02T00:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625871",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:50'></a>I don't know if there are any helpful files in `.../local/var/tmp/build/sage/openblas/src`, but I can provide those, too.



---

archive/issue_comments_625872.json:
```json
{
    "body": "<a id='comment:51'></a>No, I won't need those. I found the problem already",
    "created_at": "2021-04-02T00:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625872",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:51'></a>No, I won't need those. I found the problem already



---

archive/issue_comments_625873.json:
```json
{
    "body": "Changing commit from \"cf91f972e1d34ea30d725b217fe71adae324fe8d\" to \"da6f752e0e38fd1a72617f728193a628a8d4ffdd\"",
    "created_at": "2021-04-02T01:56:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625873",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cf91f972e1d34ea30d725b217fe71adae324fe8d" to "da6f752e0e38fd1a72617f728193a628a8d4ffdd"



---

archive/issue_comments_625874.json:
```json
{
    "body": "<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-02T01:56:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625874",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625875.json:
```json
{
    "body": "<a id='comment:53'></a>Replying to [comment:48 jhpalmieri]:\n> It seems that the macports builds don't exclude homebrew by default,\n\n\nYes, the additional isolation work to ignore homebrew in /usr/local is only done if you use the factors `macos-nohomebrew`. \n\n> so I had to use `tox -e macos-nohomebrew-local-macports-minimal` \u2014\u00a0I hope I got that right\n\n\nThis variant should work better now. What went wrong in the previous version is that it prescribed using the MacPorts-provided gfortran compiler, but in the configuration `macports-minimal` that one is not actually installed.",
    "created_at": "2021-04-02T02:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625875",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:53'></a>Replying to [comment:48 jhpalmieri]:
> It seems that the macports builds don't exclude homebrew by default,


Yes, the additional isolation work to ignore homebrew in /usr/local is only done if you use the factors `macos-nohomebrew`. 

> so I had to use `tox -e macos-nohomebrew-local-macports-minimal` — I hope I got that right


This variant should work better now. What went wrong in the previous version is that it prescribed using the MacPorts-provided gfortran compiler, but in the configuration `macports-minimal` that one is not actually installed.



---

archive/issue_comments_625876.json:
```json
{
    "body": "<a id='comment:54'></a>Great, `macos-nohomebrew-local-macports-minimal` now works. The `standard` version did not, although I'm trying again with the latest branch. (I've now lost the old log files, but a few packages complained about missing `png.h`.)\n\nShould the macports recipes automatically include `nohomebrew`? Conversely, and I haven't tried seriously installing macports on a system, so I don't know if this is an issue, but should homebrew builds also try to exclude macports?",
    "created_at": "2021-04-02T17:29:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625876",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:54'></a>Great, `macos-nohomebrew-local-macports-minimal` now works. The `standard` version did not, although I'm trying again with the latest branch. (I've now lost the old log files, but a few packages complained about missing `png.h`.)

Should the macports recipes automatically include `nohomebrew`? Conversely, and I haven't tried seriously installing macports on a system, so I don't know if this is an issue, but should homebrew builds also try to exclude macports?



---

archive/issue_comments_625877.json:
```json
{
    "body": "<a id='comment:55'></a>Replying to [comment:54 jhpalmieri]:\n> Great, `macos-nohomebrew-local-macports-minimal` now works. \n\n\nThanks for testing!\n\n> Should the macports recipes automatically include `nohomebrew`? \n\n\nI thought about this yesterday but decided against it. I think it's useful for developers to be able to reproduce the build behavior on user machines that have both homebrew and macports installed.\n\n> Conversely, and I haven't tried seriously installing macports on a system, so I don't know if this is an issue, but should homebrew builds also try to exclude macports?\n\n\nI haven't tried yet with a global installation of macports. Given that macports by default does not install into `/usr/local`, there is much less potential for macports leaking into the build, although there could be packages that check the standard macports install location explicitly.",
    "created_at": "2021-04-02T17:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625877",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:55'></a>Replying to [comment:54 jhpalmieri]:
> Great, `macos-nohomebrew-local-macports-minimal` now works. 


Thanks for testing!

> Should the macports recipes automatically include `nohomebrew`? 


I thought about this yesterday but decided against it. I think it's useful for developers to be able to reproduce the build behavior on user machines that have both homebrew and macports installed.

> Conversely, and I haven't tried seriously installing macports on a system, so I don't know if this is an issue, but should homebrew builds also try to exclude macports?


I haven't tried yet with a global installation of macports. Given that macports by default does not install into `/usr/local`, there is much less potential for macports leaking into the build, although there could be packages that check the standard macports install location explicitly.



---

archive/issue_comments_625878.json:
```json
{
    "body": "<a id='comment:56'></a>Probably for another ticket: Sage's build system doesn't find the macports `gpatch` program. The file `build/pkgs/patch/distros/macports.txt` says the right thing, but it looks like `spkg-configure.m4` doesn't look for a `gpatch` executable, only `patch`.",
    "created_at": "2021-04-02T23:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625878",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:56'></a>Probably for another ticket: Sage's build system doesn't find the macports `gpatch` program. The file `build/pkgs/patch/distros/macports.txt` says the right thing, but it looks like `spkg-configure.m4` doesn't look for a `gpatch` executable, only `patch`.



---

archive/issue_comments_625879.json:
```json
{
    "body": "<a id='comment:57'></a>Would this fix it?\n\n```diff\ndiff --git a/build/pkgs/patch/spkg-configure.m4 b/build/pkgs/patch/spkg-configure.m4\nindex 02adb910d9..31bb84dc9d 100644\n--- a/build/pkgs/patch/spkg-configure.m4\n+++ b/build/pkgs/patch/spkg-configure.m4\n@@ -1,7 +1,7 @@\n SAGE_SPKG_CONFIGURE(\n     [patch], [\n        AC_CACHE_CHECK([for GNU patch >= 2.7.0], [ac_cv_path_PATCH], [\n-        AC_PATH_PROGS_FEATURE_CHECK([PATCH], [patch], [\n+        AC_PATH_PROGS_FEATURE_CHECK([PATCH], [patch gpatch], [\n             patch_version=`$ac_path_PATCH --version 2>&1 \\\n                 | $SED -n -e 's/GNU patch *\\([[0-9]]*\\.[[0-9]]*\\.[[0-9]]*\\)/\\1/p'`\n             AS_IF([test -n \"$patch_version\"], [\n```",
    "created_at": "2021-04-02T23:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625879",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:57'></a>Would this fix it?

```diff
diff --git a/build/pkgs/patch/spkg-configure.m4 b/build/pkgs/patch/spkg-configure.m4
index 02adb910d9..31bb84dc9d 100644
--- a/build/pkgs/patch/spkg-configure.m4
+++ b/build/pkgs/patch/spkg-configure.m4
@@ -1,7 +1,7 @@
 SAGE_SPKG_CONFIGURE(
     [patch], [
        AC_CACHE_CHECK([for GNU patch >= 2.7.0], [ac_cv_path_PATCH], [
-        AC_PATH_PROGS_FEATURE_CHECK([PATCH], [patch], [
+        AC_PATH_PROGS_FEATURE_CHECK([PATCH], [patch gpatch], [
             patch_version=`$ac_path_PATCH --version 2>&1 \
                 | $SED -n -e 's/GNU patch *\([[0-9]]*\.[[0-9]]*\.[[0-9]]*\)/\1/p'`
             AS_IF([test -n "$patch_version"], [
```



---

archive/issue_comments_625880.json:
```json
{
    "body": "<a id='comment:58'></a>This alone would not be a good fix. `configure` would certainly find `gpatch` after this change -- but then we would have to make sure that all of our code that uses `patch` instead uses the environment variable `PATCH` -- and also audit all SPKG whether they do the same. (In any case, it would be a different ticket.)",
    "created_at": "2021-04-02T23:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625880",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'></a>This alone would not be a good fix. `configure` would certainly find `gpatch` after this change -- but then we would have to make sure that all of our code that uses `patch` instead uses the environment variable `PATCH` -- and also audit all SPKG whether they do the same. (In any case, it would be a different ticket.)



---

archive/issue_comments_625881.json:
```json
{
    "body": "<a id='comment:59'></a>I opened #31595 for the `gpatch` issue.",
    "created_at": "2021-04-03T00:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625881",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:59'></a>I opened #31595 for the `gpatch` issue.



---

archive/issue_comments_625882.json:
```json
{
    "body": "<a id='comment:60'></a>I have encountered a problem with `local-macports-standard-python3.9`: rpy2 build fails with clang: error: unsupported option '-fopenmp' - this is now #31596",
    "created_at": "2021-04-03T02:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625882",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:60'></a>I have encountered a problem with `local-macports-standard-python3.9`: rpy2 build fails with clang: error: unsupported option '-fopenmp' - this is now #31596



---

archive/issue_comments_625883.json:
```json
{
    "body": "<a id='comment:61'></a>I see that too, with `macos-nohomebrew-local-macports-standard`.",
    "created_at": "2021-04-03T03:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625883",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:61'></a>I see that too, with `macos-nohomebrew-local-macports-standard`.



---

archive/issue_comments_625884.json:
```json
{
    "body": "<a id='comment:62'></a>I am testing with `EXTRA_CONFIGURE_ARGS=\"--disable-r\"` now",
    "created_at": "2021-04-03T03:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625884",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:62'></a>I am testing with `EXTRA_CONFIGURE_ARGS="--disable-r"` now



---

archive/issue_comments_625885.json:
```json
{
    "body": "<a id='comment:63'></a>I'm running into mild problems with `macos-nohomebrew-local-macports-standard`, in particular after I run it once, hit some problems, and then run `tox -r -e ...`:\n\n```\nError: Failed to activate icu: Image error: /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/.tox/macos-nohomebrew-local-macports-stan already exists and does not belong to a registered port.  Unable to activate port icu. Use 'port -f activate icu' to force the activation.\n```\nIs there really supposed to be a file `.tox/macos-nohomebrew-local-macports-stan` (which there is), or was the correct name truncated and then not handled properly by `tox -r ...`?",
    "created_at": "2021-04-05T22:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625885",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:63'></a>I'm running into mild problems with `macos-nohomebrew-local-macports-standard`, in particular after I run it once, hit some problems, and then run `tox -r -e ...`:

```
Error: Failed to activate icu: Image error: /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc0/.tox/macos-nohomebrew-local-macports-stan already exists and does not belong to a registered port.  Unable to activate port icu. Use 'port -f activate icu' to force the activation.
```
Is there really supposed to be a file `.tox/macos-nohomebrew-local-macports-stan` (which there is), or was the correct name truncated and then not handled properly by `tox -r ...`?



---

archive/issue_comments_625886.json:
```json
{
    "body": "<a id='comment:64'></a>No, this looks like a bug in the MacPorts scripts, truncating some filenames.",
    "created_at": "2021-04-05T22:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625886",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:64'></a>No, this looks like a bug in the MacPorts scripts, truncating some filenames.



---

archive/issue_comments_625887.json:
```json
{
    "body": "<a id='comment:65'></a>Replying to [comment:44 jhpalmieri]:\n> I don't know. For example, when there is an error building sagelib, that particular process never ends: there is no conclusion in the sagelib log file until I halt it, and then it ends with `KeyboardInterrupt`. Is that a symptom of using `make -k`? I've used `make -k` before when building Sage and it has always stopped when it was supposed to.\n\n\nI'm hitting this problem on another computer, this time running OS X Catalina. I don't know what to do except interrupt the process.",
    "created_at": "2021-04-06T17:08:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625887",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:65'></a>Replying to [comment:44 jhpalmieri]:
> I don't know. For example, when there is an error building sagelib, that particular process never ends: there is no conclusion in the sagelib log file until I halt it, and then it ends with `KeyboardInterrupt`. Is that a symptom of using `make -k`? I've used `make -k` before when building Sage and it has always stopped when it was supposed to.


I'm hitting this problem on another computer, this time running OS X Catalina. I don't know what to do except interrupt the process.



---

archive/issue_comments_625888.json:
```json
{
    "body": "<a id='comment:66'></a>please rebase",
    "created_at": "2021-04-07T20:01:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625888",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:66'></a>please rebase



---

archive/issue_comments_625889.json:
```json
{
    "body": "Changing commit from \"da6f752e0e38fd1a72617f728193a628a8d4ffdd\" to \"439d7464e10e1115c25a5f7cd499b8fa68e07a9b\"",
    "created_at": "2021-04-07T20:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625889",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "da6f752e0e38fd1a72617f728193a628a8d4ffdd" to "439d7464e10e1115c25a5f7cd499b8fa68e07a9b"



---

archive/issue_comments_625890.json:
```json
{
    "body": "<a id='comment:67'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-07T20:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625890",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:67'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625891.json:
```json
{
    "body": "<a id='comment:68'></a>I see a bug of sorts - /usr/local leaks into macports build, via GMP:\n\n```\n#define ABSOLUTE_GMP_H \"///usr/local/include/gmp.h\"\n```\nand this results in fpylll not finding `gmp.h`, for some reason",
    "created_at": "2021-04-07T22:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625891",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:68'></a>I see a bug of sorts - /usr/local leaks into macports build, via GMP:

```
#define ABSOLUTE_GMP_H "///usr/local/include/gmp.h"
```
and this results in fpylll not finding `gmp.h`, for some reason



---

archive/issue_comments_625892.json:
```json
{
    "body": "<a id='comment:69'></a>and `gmp` in `/opt/local` is not recognised by `./configure`",
    "created_at": "2021-04-07T22:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625892",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:69'></a>and `gmp` in `/opt/local` is not recognised by `./configure`



---

archive/issue_comments_625893.json:
```json
{
    "body": "<a id='comment:70'></a>Yes, this should be fixed via #31348 (as in its ticket description, not the branch just added there)",
    "created_at": "2021-04-07T22:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625893",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:70'></a>Yes, this should be fixed via #31348 (as in its ticket description, not the branch just added there)



---

archive/issue_comments_625894.json:
```json
{
    "body": "<a id='comment:71'></a>Given that the /usr/local leakage only affects users who have both MacPorts and /usr/local installed, perhaps we can get this ticket in as is?",
    "created_at": "2021-04-08T16:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625894",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:71'></a>Given that the /usr/local leakage only affects users who have both MacPorts and /usr/local installed, perhaps we can get this ticket in as is?



---

archive/issue_comments_625895.json:
```json
{
    "body": "<a id='comment:72'></a>I wish that `macos-nohomebrew-local-macports-standard` would succeed on at least one machine for me, but I keep hitting problems with sagelib. I'll try one more time and then upload the sagelib log file, but it will probably look like the one I uploaded before.",
    "created_at": "2021-04-08T18:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625895",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:72'></a>I wish that `macos-nohomebrew-local-macports-standard` would succeed on at least one machine for me, but I keep hitting problems with sagelib. I'll try one more time and then upload the sagelib log file, but it will probably look like the one I uploaded before.



---

archive/issue_comments_625896.json:
```json
{
    "body": "<a id='comment:73'></a>Do you set `MAKE` to `make -j...` or `SAGE_NUM_THREADS` by any chance? If so, it would be worth testing if the problem goes away if you unset these variables.\n\nAnother thing to try could be `export EXTRA_CONFIGURE_ARGS=\"--enable-editable\"`, which uses a simpler build system",
    "created_at": "2021-04-08T18:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625896",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:73'></a>Do you set `MAKE` to `make -j...` or `SAGE_NUM_THREADS` by any chance? If so, it would be worth testing if the problem goes away if you unset these variables.

Another thing to try could be `export EXTRA_CONFIGURE_ARGS="--enable-editable"`, which uses a simpler build system



---

archive/issue_comments_625897.json:
```json
{
    "body": "<a id='comment:74'></a>I unset `MAKE` and `MAKEFLAGS`, and other than taking longer, I see the same thing. I'm attaching the sagelib log file (before hitting ctrl-c). I'll try with `--enable-editable`.",
    "created_at": "2021-04-09T02:15:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625897",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:74'></a>I unset `MAKE` and `MAKEFLAGS`, and other than taking longer, I see the same thing. I'm attaching the sagelib log file (before hitting ctrl-c). I'll try with `--enable-editable`.



---

archive/issue_comments_625898.json:
```json
{
    "body": "<a id='comment:75'></a>Attachment [sagelib-9.3.rc2.log](tarball://root/attachments/some-uuid/ticket31505/sagelib-9.3.rc2.log) by @jhpalmieri created at 2021-04-09 16:19:07\n\nWith `--enable-editable`, it did at least end when building the Sage library failed. The end of the log file looks like this:\n\n```\n    g++ -bundle -undefined dynamic_lookup -Wl,-headerpad,0x1000 -L/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib -Wl,-rpath,/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib -O2 -g -march=native build/temp.macosx-10.14.6-x86_64-3.8/sage/symbolic/expression.o -lpynac -lgmp -o build/lib.macosx-10.14.6-x86_64-3.8/sage/symbolic/expression.cpython-38-darwin.so -lpari\n    ld: warning: dylib (/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/libpynac.dylib) was built for newer macOS version (10.15) than being linked (10.14.6)\n    ld: warning: dylib (/usr/local/lib/libgmp.dylib) was built for newer macOS version (10.15) than being linked (10.14.6)\n    error: command '/usr/bin/gcc' failed with exit code 1\nERROR: Command errored out with exit status 1: /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/bin/python3 -c 'import sys, setuptools, tokenize; sys.argv[0] = '\"'\"'/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/src/setup.py'\"'\"'; __file__='\"'\"'/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/src/setup.py'\"'\"';f=getattr(tokenize, '\"'\"'open'\"'\"', open)(__file__);code=f.read().replace('\"'\"'\\r\\n'\"'\"', '\"'\"'\\n'\"'\"');f.close();exec(compile(code, __file__, '\"'\"'exec'\"'\"'))' --no-user-cfg develop --no-deps Check the logs for full command output.\nException information:\nTraceback (most recent call last):\n  File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/python3.8/site-packages/pip/_internal/cli/base_command.py\", line 189, in _main\n    status = self.run(options, args)\n  File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/python3.8/site-packages/pip/_internal/cli/req_command.py\", line 178, in wrapper\n    return func(self, options, args)\n  File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/python3.8/site-packages/pip/_internal/commands/install.py\", line 391, in run\n    installed = install_given_reqs(\n  File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/python3.8/site-packages/pip/_internal/req/__init__.py\", line 80, in install_given_reqs\n    requirement.install(\n  File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/python3.8/site-packages/pip/_internal/req/req_install.py\", line 764, in install\n    install_editable_legacy(\n  File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/python3.8/site-packages/pip/_internal/operations/install/editable_legacy.py\", line 49, in install_editable\n    call_subprocess(\n  File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/python3.8/site-packages/pip/_internal/utils/subprocess.py\", line 258, in call_subprocess\n    raise InstallationSubprocessError(proc.returncode, command_desc)\npip._internal.exceptions.InstallationSubprocessError: Command errored out with exit status 1: /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/bin/python3 -c 'import sys, setuptools, tokenize; sys.argv[0] = '\"'\"'/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/src/setup.py'\"'\"'; __file__='\"'\"'/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/src/setup.py'\"'\"';f=getattr(tokenize, '\"'\"'open'\"'\"', open)(__file__);code=f.read().replace('\"'\"'\\r\\n'\"'\"', '\"'\"'\\n'\"'\"');f.close();exec(compile(code, __file__, '\"'\"'exec'\"'\"'))' --no-user-cfg develop --no-deps Check the logs for full command output.\nRemoved build tracker: '/private/var/folders/00/zrss7sdj3bzd23f2_gnspy2h0000gp/T/pip-req-tracker-jrbc7dbe'\n\nreal\t5m28.311s\nuser\t49m7.815s\nsys\t1m20.961s\n```\nThis was with the command `EXTRA_CONFIGURE_ARGS=\"--enable-editable --disable-r\" tox -r -e macos-nohomebrew-local-macports-standard`",
    "created_at": "2021-04-09T16:19:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625898",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:75'></a>Attachment [sagelib-9.3.rc2.log](tarball://root/attachments/some-uuid/ticket31505/sagelib-9.3.rc2.log) by @jhpalmieri created at 2021-04-09 16:19:07

With `--enable-editable`, it did at least end when building the Sage library failed. The end of the log file looks like this:

```
    g++ -bundle -undefined dynamic_lookup -Wl,-headerpad,0x1000 -L/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib -Wl,-rpath,/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib -O2 -g -march=native build/temp.macosx-10.14.6-x86_64-3.8/sage/symbolic/expression.o -lpynac -lgmp -o build/lib.macosx-10.14.6-x86_64-3.8/sage/symbolic/expression.cpython-38-darwin.so -lpari
    ld: warning: dylib (/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/libpynac.dylib) was built for newer macOS version (10.15) than being linked (10.14.6)
    ld: warning: dylib (/usr/local/lib/libgmp.dylib) was built for newer macOS version (10.15) than being linked (10.14.6)
    error: command '/usr/bin/gcc' failed with exit code 1
ERROR: Command errored out with exit status 1: /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/bin/python3 -c 'import sys, setuptools, tokenize; sys.argv[0] = '"'"'/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/src/setup.py'"'"'; __file__='"'"'/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/src/setup.py'"'"';f=getattr(tokenize, '"'"'open'"'"', open)(__file__);code=f.read().replace('"'"'\r\n'"'"', '"'"'\n'"'"');f.close();exec(compile(code, __file__, '"'"'exec'"'"'))' --no-user-cfg develop --no-deps Check the logs for full command output.
Exception information:
Traceback (most recent call last):
  File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/python3.8/site-packages/pip/_internal/cli/base_command.py", line 189, in _main
    status = self.run(options, args)
  File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/python3.8/site-packages/pip/_internal/cli/req_command.py", line 178, in wrapper
    return func(self, options, args)
  File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/python3.8/site-packages/pip/_internal/commands/install.py", line 391, in run
    installed = install_given_reqs(
  File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/python3.8/site-packages/pip/_internal/req/__init__.py", line 80, in install_given_reqs
    requirement.install(
  File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/python3.8/site-packages/pip/_internal/req/req_install.py", line 764, in install
    install_editable_legacy(
  File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/python3.8/site-packages/pip/_internal/operations/install/editable_legacy.py", line 49, in install_editable
    call_subprocess(
  File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/python3.8/site-packages/pip/_internal/utils/subprocess.py", line 258, in call_subprocess
    raise InstallationSubprocessError(proc.returncode, command_desc)
pip._internal.exceptions.InstallationSubprocessError: Command errored out with exit status 1: /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/bin/python3 -c 'import sys, setuptools, tokenize; sys.argv[0] = '"'"'/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/src/setup.py'"'"'; __file__='"'"'/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/src/setup.py'"'"';f=getattr(tokenize, '"'"'open'"'"', open)(__file__);code=f.read().replace('"'"'\r\n'"'"', '"'"'\n'"'"');f.close();exec(compile(code, __file__, '"'"'exec'"'"'))' --no-user-cfg develop --no-deps Check the logs for full command output.
Removed build tracker: '/private/var/folders/00/zrss7sdj3bzd23f2_gnspy2h0000gp/T/pip-req-tracker-jrbc7dbe'

real	5m28.311s
user	49m7.815s
sys	1m20.961s
```
This was with the command `EXTRA_CONFIGURE_ARGS="--enable-editable --disable-r" tox -r -e macos-nohomebrew-local-macports-standard`



---

archive/issue_comments_625899.json:
```json
{
    "body": "<a id='comment:76'></a>Thanks for testing!\n\nThis `error: command '/usr/bin/gcc' failed with exit code 1` without an actual gcc error message is really puzzling. \n\nAlso in the previous logs that you sent, there was such a message at the end but I didn't see an actual error either.\n\nCould you try what happens now if you do \n`SKIP_SYSTEM_PKG_INSTALL=1 SKIP_BOOTSTRAP=1 SKIP_CONFIGURE=1 EXTRA_CONFIGURE_ARGS=\"--enable-editable --disable-r\" tox -e macos-nohomebrew-local-macports-standard` (note, no `-r` for tox, so this should be fast)",
    "created_at": "2021-04-09T16:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625899",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:76'></a>Thanks for testing!

This `error: command '/usr/bin/gcc' failed with exit code 1` without an actual gcc error message is really puzzling. 

Also in the previous logs that you sent, there was such a message at the end but I didn't see an actual error either.

Could you try what happens now if you do 
`SKIP_SYSTEM_PKG_INSTALL=1 SKIP_BOOTSTRAP=1 SKIP_CONFIGURE=1 EXTRA_CONFIGURE_ARGS="--enable-editable --disable-r" tox -e macos-nohomebrew-local-macports-standard` (note, no `-r` for tox, so this should be fast)



---

archive/issue_comments_625900.json:
```json
{
    "body": "Attachment [sagelib-9.3.rc2-delta.log](tarball://root/attachments/some-uuid/ticket31505/sagelib-9.3.rc2-delta.log) by @jhpalmieri created at 2021-04-09 17:38:44",
    "created_at": "2021-04-09T17:38:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625900",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [sagelib-9.3.rc2-delta.log](tarball://root/attachments/some-uuid/ticket31505/sagelib-9.3.rc2-delta.log) by @jhpalmieri created at 2021-04-09 17:38:44



---

archive/issue_comments_625901.json:
```json
{
    "body": "<a id='comment:77'></a>It fails again. I've attached the new part of the sagelib log.",
    "created_at": "2021-04-09T17:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625901",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:77'></a>It fails again. I've attached the new part of the sagelib log.



---

archive/issue_comments_625902.json:
```json
{
    "body": "<a id='comment:78'></a>Now error messages are there!\n\n```\n    building 'sage.libs.readline' extension\n    gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers -O2 -g -march=native -Isage/cpython -I/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/src -I/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/include/python3.8 -I/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/python3.8/site-packages/numpy/core/include -I/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/include -I/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/include/python3.8 -c sage/libs/readline.c -o build/temp.macosx-10.14.6-x86_64-3.8/sage/libs/readline.o\n    sage/libs/readline.c:1451:36: error: use of undeclared identifier 'rl_catch_signals'\n      __pyx_t_1 = __Pyx_PyInt_From_int(rl_catch_signals); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)\n```\n\n```\n    gcc -bundle -undefined dynamic_lookup -Wl,-headerpad,0x1000 -L/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib -Wl,-rpath,/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib -O2 -g -march=native build/temp.macosx-10.14.6-x86_64-3.8/sage/rings/complex_double.o -L/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/macports/lib -lm -lgmp -lpari -lgsl -lm -lopenblas -o build/lib.macosx-10.14.6-x86_64-3.8/sage/rings/complex_double.cpython-38-darwin.so -lpari\n    ld: warning: dylib (/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/macports/lib/libgmp.dylib) was built for newer macOS version (10.15) than being linked (10.14.6)\n    ld: warning: dylib (/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/macports/lib/libgsl.dylib) was built for newer macOS version (10.15) than being linked (10.14.6)\n    ld: warning: dylib (/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/macports/lib/libopenblas.dylib) was built for newer macOS version (10.15) than being linked (10.14.6)\n    ld: illegal data reference in _avma to thread local variable _avma in dylib /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/libpari.dylib for architecture x86_64\n    clang: error: linker command failed with exit code 1 (use -v to see invocation)\n    error: command '/usr/bin/gcc' failed with exit code 1\n```",
    "created_at": "2021-04-09T17:53:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625902",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:78'></a>Now error messages are there!

```
    building 'sage.libs.readline' extension
    gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers -O2 -g -march=native -Isage/cpython -I/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/src -I/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/include/python3.8 -I/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/python3.8/site-packages/numpy/core/include -I/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/include -I/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/include/python3.8 -c sage/libs/readline.c -o build/temp.macosx-10.14.6-x86_64-3.8/sage/libs/readline.o
    sage/libs/readline.c:1451:36: error: use of undeclared identifier 'rl_catch_signals'
      __pyx_t_1 = __Pyx_PyInt_From_int(rl_catch_signals); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
```

```
    gcc -bundle -undefined dynamic_lookup -Wl,-headerpad,0x1000 -L/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib -Wl,-rpath,/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib -O2 -g -march=native build/temp.macosx-10.14.6-x86_64-3.8/sage/rings/complex_double.o -L/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/macports/lib -lm -lgmp -lpari -lgsl -lm -lopenblas -o build/lib.macosx-10.14.6-x86_64-3.8/sage/rings/complex_double.cpython-38-darwin.so -lpari
    ld: warning: dylib (/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/macports/lib/libgmp.dylib) was built for newer macOS version (10.15) than being linked (10.14.6)
    ld: warning: dylib (/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/macports/lib/libgsl.dylib) was built for newer macOS version (10.15) than being linked (10.14.6)
    ld: warning: dylib (/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/macports/lib/libopenblas.dylib) was built for newer macOS version (10.15) than being linked (10.14.6)
    ld: illegal data reference in _avma to thread local variable _avma in dylib /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc2/.tox/macos-nohomebrew-local-macports-standard/local/lib/libpari.dylib for architecture x86_64
    clang: error: linker command failed with exit code 1 (use -v to see invocation)
    error: command '/usr/bin/gcc' failed with exit code 1
```



---

archive/issue_comments_625903.json:
```json
{
    "body": "<a id='comment:79'></a>The `readline` issue is probably just #29000 again. \n\n(Or we may want to create a `.macports-build-env` script, after all. https://guide.macports.org/#installing.shell only mentions setting `PATH` - but we may need to also set `CPATH` and `LIBRARY_PATH` if we want libraries to be found that do not come with .pc files.)",
    "created_at": "2021-04-09T18:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625903",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:79'></a>The `readline` issue is probably just #29000 again. 

(Or we may want to create a `.macports-build-env` script, after all. https://guide.macports.org/#installing.shell only mentions setting `PATH` - but we may need to also set `CPATH` and `LIBRARY_PATH` if we want libraries to be found that do not come with .pc files.)



---

archive/issue_comments_625904.json:
```json
{
    "body": "<a id='comment:80'></a>At this point I'm certainly happy removing the ban, but since I can't get the macports-standard tox build to work, I can't positively review the rest.",
    "created_at": "2021-04-10T18:20:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625904",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:80'></a>At this point I'm certainly happy removing the ban, but since I can't get the macports-standard tox build to work, I can't positively review the rest.



---

archive/issue_comments_625905.json:
```json
{
    "body": "Changing dependencies from \"#31567\" to \"#31567, #31641\"",
    "created_at": "2021-04-10T18:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625905",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#31567" to "#31567, #31641"



---

archive/issue_comments_625906.json:
```json
{
    "body": "<a id='comment:81'></a>OK, I have split this part out to #31641",
    "created_at": "2021-04-10T18:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625906",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:81'></a>OK, I have split this part out to #31641



---

archive/issue_events_082761.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-10T18:39:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31505#event-82761"
}
```



---

archive/issue_comments_625907.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-04-10T19:01:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625907",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_625908.json:
```json
{
    "body": "Changing work_issues from \"\" to \"rebase on #31534, #31641\"",
    "created_at": "2021-04-10T19:01:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625908",
    "user": "https://github.com/mkoeppe"
}
```

Changing work_issues from "" to "rebase on #31534, #31641"



---

archive/issue_comments_625909.json:
```json
{
    "body": "Changing commit from \"439d7464e10e1115c25a5f7cd499b8fa68e07a9b\" to \"c787c3cb69c0644f119facea4084459976b25db6\"",
    "created_at": "2021-05-27T22:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625909",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "439d7464e10e1115c25a5f7cd499b8fa68e07a9b" to "c787c3cb69c0644f119facea4084459976b25db6"



---

archive/issue_comments_625910.json:
```json
{
    "body": "<a id='comment:84'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-27T22:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625910",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:84'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625911.json:
```json
{
    "body": "Changing dependencies from \"#31567, #31641\" to \"#31534\"",
    "created_at": "2021-05-27T22:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625911",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#31567, #31641" to "#31534"



---

archive/issue_comments_625912.json:
```json
{
    "body": "Changing work_issues from \"rebase on #31534, #31641\" to \"\"",
    "created_at": "2021-05-27T22:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625912",
    "user": "https://github.com/mkoeppe"
}
```

Changing work_issues from "rebase on #31534, #31641" to ""



---

archive/issue_comments_625913.json:
```json
{
    "body": "<a id='comment:86'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-09T22:38:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625913",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:86'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625914.json:
```json
{
    "body": "Changing commit from \"c787c3cb69c0644f119facea4084459976b25db6\" to \"27b0064337dc42705da89a67518d17d67fa82dfa\"",
    "created_at": "2021-07-09T22:38:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625914",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c787c3cb69c0644f119facea4084459976b25db6" to "27b0064337dc42705da89a67518d17d67fa82dfa"



---

archive/issue_comments_625915.json:
```json
{
    "body": "Changing dependencies from \"#31534\" to \"\"",
    "created_at": "2021-07-09T22:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625915",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#31534" to ""



---

archive/issue_comments_625916.json:
```json
{
    "body": "<a id='comment:88'></a>How can we move forward here? Does this still need work?\nOr is it ready for review?",
    "created_at": "2021-07-21T07:41:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625916",
    "user": "https://github.com/slel"
}
```

<a id='comment:88'></a>How can we move forward here? Does this still need work?
Or is it ready for review?



---

archive/issue_comments_625917.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#31786\"",
    "created_at": "2021-07-21T11:07:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625917",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#31786"



---

archive/issue_comments_625918.json:
```json
{
    "body": "<a id='comment:89'></a>I'd think after #31786 is merged, we can update `build/pkgs/gfortran/distros/macports.txt` and perhaps create a .macports-build-env as suggested in comment:13, comment:79.",
    "created_at": "2021-07-21T11:07:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625918",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:89'></a>I'd think after #31786 is merged, we can update `build/pkgs/gfortran/distros/macports.txt` and perhaps create a .macports-build-env as suggested in comment:13, comment:79.



---

archive/issue_events_082762.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:26:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31505#event-82762"
}
```



---

archive/issue_events_082763.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:26:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31505#event-82763"
}
```



---

archive/issue_comments_625919.json:
```json
{
    "body": "<a id='comment:91'></a>Ticket #31786 was merged in Sage 9.4.beta6.",
    "created_at": "2021-11-21T21:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625919",
    "user": "https://github.com/slel"
}
```

<a id='comment:91'></a>Ticket #31786 was merged in Sage 9.4.beta6.



---

archive/issue_events_082764.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-23T04:18:37Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31505#event-82764"
}
```



---

archive/issue_events_082765.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-23T04:18:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31505#event-82765"
}
```



---

archive/issue_events_082766.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:45:28Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31505#event-82766"
}
```



---

archive/issue_events_082767.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:45:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31505#event-82767"
}
```



---

archive/issue_comments_625920.json:
```json
{
    "body": "<a id='comment:94'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-04-15T17:44:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625920",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:94'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_625921.json:
```json
{
    "body": "Changing commit from \"27b0064337dc42705da89a67518d17d67fa82dfa\" to \"e7e72fa9d4a1ad49ec6a5f8f6459156bba92812c\"",
    "created_at": "2022-04-15T17:44:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625921",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "27b0064337dc42705da89a67518d17d67fa82dfa" to "e7e72fa9d4a1ad49ec6a5f8f6459156bba92812c"



---

archive/issue_comments_625922.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,37 @@\n+Based on #30504, which added MacPorts package information, we update the system package scripts to include support for MacPorts.\n \n+Current Sage builds just fine on a system with MacPorts. \n+To test this, we add `local-macports` environments to `tox.ini`:\n+\n+```\n+tox -e local-macports-minimal\n+```\n+or\n+\n+```\n+tox -e local-macports-standard             # uses /usr/bin/python unless configured otherwise\n+```\n+or \n+\n+```\n+tox -e local-macports-standard-python3.8   # uses python3.8 from macports\n+```\n+or \n+\n+```\n+tox -e local-macports-standard-python3.9   # uses python3.9 from macports\n+```\n+\n+Each of these commands creates an isolated installation of MacPorts in a subdirectory of `.tox` (using https://guide.macports.org/#installing.macports.source.multiple\n+); it will not use or modify `/opt/local`.  \n+\n+(There is also `tox -e local-macports-optlocal-standard`, which uses `sudo` to install things into the default location -- use at your own risk.)\n+\n+Requested at\n+\n+- [Ask Sage question 54790: Use OpenSSL from /opt/local/](https://ask.sagemath.org/question/54790)\n+- [sage-support, 2020-12](https://groups.google.com/g/sage-support/c/_cfY37nFF84/m/1biGwJetBgAJ)\n+- [sage-devel, 2022-04](https://groups.google.com/g/sage-devel/c/qTcF8tlWLcE/m/9QRODrv0CgAJ)\n \n Comment: 1\n \n``````\n",
    "created_at": "2022-04-15T17:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625922",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,37 @@
+Based on #30504, which added MacPorts package information, we update the system package scripts to include support for MacPorts.
 
+Current Sage builds just fine on a system with MacPorts. 
+To test this, we add `local-macports` environments to `tox.ini`:
+
+```
+tox -e local-macports-minimal
+```
+or
+
+```
+tox -e local-macports-standard             # uses /usr/bin/python unless configured otherwise
+```
+or 
+
+```
+tox -e local-macports-standard-python3.8   # uses python3.8 from macports
+```
+or 
+
+```
+tox -e local-macports-standard-python3.9   # uses python3.9 from macports
+```
+
+Each of these commands creates an isolated installation of MacPorts in a subdirectory of `.tox` (using https://guide.macports.org/#installing.macports.source.multiple
+); it will not use or modify `/opt/local`.  
+
+(There is also `tox -e local-macports-optlocal-standard`, which uses `sudo` to install things into the default location -- use at your own risk.)
+
+Requested at
+
+- [Ask Sage question 54790: Use OpenSSL from /opt/local/](https://ask.sagemath.org/question/54790)
+- [sage-support, 2020-12](https://groups.google.com/g/sage-support/c/_cfY37nFF84/m/1biGwJetBgAJ)
+- [sage-devel, 2022-04](https://groups.google.com/g/sage-devel/c/qTcF8tlWLcE/m/9QRODrv0CgAJ)
 
 Comment: 1
 
``````




---

archive/issue_comments_625923.json:
```json
{
    "body": "Changing dependencies from \"#31786\" to \"\"",
    "created_at": "2022-04-15T17:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625923",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#31786" to ""



---

archive/issue_comments_625924.json:
```json
{
    "body": "<a id='comment:96'></a>I must be doing something wrong:\n\n```\n% tox -e local-macports-standard\n_____________________________________________________ summary _____________________________________________________\nERROR:   local-macports-standard: unresolvable substitution(s):\n    commands: 'EXTRA_SAGE_PACKAGES'\nEnvironment variables are missing or defined recursively.\n```",
    "created_at": "2022-04-15T19:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625924",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:96'></a>I must be doing something wrong:

```
% tox -e local-macports-standard
_____________________________________________________ summary _____________________________________________________
ERROR:   local-macports-standard: unresolvable substitution(s):
    commands: 'EXTRA_SAGE_PACKAGES'
Environment variables are missing or defined recursively.
```



---

archive/issue_comments_625925.json:
```json
{
    "body": "Changing commit from \"e7e72fa9d4a1ad49ec6a5f8f6459156bba92812c\" to \"4bf4e4577aa070b0f3fb581e1cfad545225edb9f\"",
    "created_at": "2022-04-15T20:46:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625925",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e7e72fa9d4a1ad49ec6a5f8f6459156bba92812c" to "4bf4e4577aa070b0f3fb581e1cfad545225edb9f"



---

archive/issue_comments_625926.json:
```json
{
    "body": "<a id='comment:97'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-15T20:46:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625926",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:97'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625927.json:
```json
{
    "body": "<a id='comment:98'></a>Thanks for testing! I hadn't tested it yet after rebasing",
    "created_at": "2022-04-15T20:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625927",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:98'></a>Thanks for testing! I hadn't tested it yet after rebasing



---

archive/issue_comments_625928.json:
```json
{
    "body": "<a id='comment:99'></a>Thanks, now it's building. I don't know why it (Macports) is building Python 2.7, but I happened to look just now, and that's what it's doing.",
    "created_at": "2022-04-15T21:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625928",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:99'></a>Thanks, now it's building. I don't know why it (Macports) is building Python 2.7, but I happened to look just now, and that's what it's doing.



---

archive/issue_comments_625929.json:
```json
{
    "body": "<a id='comment:0'></a>I don't know if this part of the description is still accurate:\n\n```\ntox -e local-macports-standard             # uses /usr/bin/python unless configured otherwise\n```\nThere is no `/usr/bin/python` on my OS X machine, just `/usr/bin/python3`.",
    "created_at": "2022-04-15T22:56:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625929",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:0'></a>I don't know if this part of the description is still accurate:

```
tox -e local-macports-standard             # uses /usr/bin/python unless configured otherwise
```
There is no `/usr/bin/python` on my OS X machine, just `/usr/bin/python3`.



---

archive/issue_comments_625930.json:
```json
{
    "body": "<a id='comment:1'></a>`tox -e local-macports-standard` just failed for me (on macOS Big Sur 11.6) with\n\n```\n--->  Applying patches to gcc10\n--->  Configuring gcc10\nWarning: Applying '--without-build-config' workaround to Xcode none / CLT 13.2.0.0.1.1638488800\nWarning: If versions > 12.5 please check if it is still required\n--->  Building gcc10                                     \nError: Failed to build gcc10: command execution failed   \nError: See /Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-standard/macports/var/macports/logs/_Users_mkoeppe_s_sage_sage-rebasing_worktree-rebase_.tox_local-macports-standard_macports_var_macports_sources_rsync.macports.org_macports_release_tarballs_ports_lang_gcc10/gcc10/main.log for details.\nError: Follow https://guide.macports.org/#project.tickets if you believe there is a bug.\nError: Processing of port gcc10 failed\n```",
    "created_at": "2022-04-16T04:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625930",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>`tox -e local-macports-standard` just failed for me (on macOS Big Sur 11.6) with

```
--->  Applying patches to gcc10
--->  Configuring gcc10
Warning: Applying '--without-build-config' workaround to Xcode none / CLT 13.2.0.0.1.1638488800
Warning: If versions > 12.5 please check if it is still required
--->  Building gcc10                                     
Error: Failed to build gcc10: command execution failed   
Error: See /Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-standard/macports/var/macports/logs/_Users_mkoeppe_s_sage_sage-rebasing_worktree-rebase_.tox_local-macports-standard_macports_var_macports_sources_rsync.macports.org_macports_release_tarballs_ports_lang_gcc10/gcc10/main.log for details.
Error: Follow https://guide.macports.org/#project.tickets if you believe there is a bug.
Error: Processing of port gcc10 failed
```



---

archive/issue_comments_625931.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,37 @@\n+Based on #30504, which added MacPorts package information, we update the system package scripts to include support for MacPorts.\n \n+Current Sage builds just fine on a system with MacPorts. \n+To test this, we add `local-macports` environments to `tox.ini`:\n+\n+```\n+tox -e local-macports-minimal\n+```\n+or\n+\n+```\n+tox -e local-macports-standard             # uses /usr/bin/python3\n+```\n+or \n+\n+```\n+tox -e local-macports-standard-python3.8   # uses python3.8 from macports\n+```\n+or \n+\n+```\n+tox -e local-macports-standard-python3.9   # uses python3.9 from macports\n+```\n+\n+Each of these commands creates an isolated installation of MacPorts in a subdirectory of `.tox` (using https://guide.macports.org/#installing.macports.source.multiple\n+); it will not use or modify `/opt/local`.  \n+\n+(There is also `tox -e local-macports-optlocal-standard`, which uses `sudo` to install things into the default location -- use at your own risk.)\n+\n+Requested at\n+\n+- [Ask Sage question 54790: Use OpenSSL from /opt/local/](https://ask.sagemath.org/question/54790)\n+- [sage-support, 2020-12](https://groups.google.com/g/sage-support/c/_cfY37nFF84/m/1biGwJetBgAJ)\n+- [sage-devel, 2022-04](https://groups.google.com/g/sage-devel/c/qTcF8tlWLcE/m/9QRODrv0CgAJ)\n \n Comment: 1\n \n``````\n",
    "created_at": "2022-04-16T06:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625931",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,37 @@
+Based on #30504, which added MacPorts package information, we update the system package scripts to include support for MacPorts.
 
+Current Sage builds just fine on a system with MacPorts. 
+To test this, we add `local-macports` environments to `tox.ini`:
+
+```
+tox -e local-macports-minimal
+```
+or
+
+```
+tox -e local-macports-standard             # uses /usr/bin/python3
+```
+or 
+
+```
+tox -e local-macports-standard-python3.8   # uses python3.8 from macports
+```
+or 
+
+```
+tox -e local-macports-standard-python3.9   # uses python3.9 from macports
+```
+
+Each of these commands creates an isolated installation of MacPorts in a subdirectory of `.tox` (using https://guide.macports.org/#installing.macports.source.multiple
+); it will not use or modify `/opt/local`.  
+
+(There is also `tox -e local-macports-optlocal-standard`, which uses `sudo` to install things into the default location -- use at your own risk.)
+
+Requested at
+
+- [Ask Sage question 54790: Use OpenSSL from /opt/local/](https://ask.sagemath.org/question/54790)
+- [sage-support, 2020-12](https://groups.google.com/g/sage-support/c/_cfY37nFF84/m/1biGwJetBgAJ)
+- [sage-devel, 2022-04](https://groups.google.com/g/sage-devel/c/qTcF8tlWLcE/m/9QRODrv0CgAJ)
 
 Comment: 1
 
``````




---

archive/issue_comments_625932.json:
```json
{
    "body": "<a id='comment:103'></a>Replying to [comment:101 mkoeppe]:\n> `tox -e local-macports-standard` just failed for me (on macOS Big Sur 11.6) with\n> \n> ```\n> --->  Applying patches to gcc10\n> --->  Configuring gcc10\n> Warning: Applying '--without-build-config' workaround to Xcode none / CLT 13.2.0.0.1.1638488800\n> Warning: If versions > 12.5 please check if it is still required\n> --->  Building gcc10                                     \n> Error: Failed to build gcc10: command execution failed   \n> Error: See /Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-standard/macports/var/macports/logs/_Users_mkoeppe_s_sage_sage-rebasing_worktree-rebase_.tox_local-macports-standard_macports_var_macports_sources_rsync.macports.org_macports_release_tarballs_ports_lang_gcc10/gcc10/main.log for details.\n> Error: Follow https://guide.macports.org/#project.tickets if you believe there is a bug.\n> Error: Processing of port gcc10 failed\n> ```\n\nI see the same.",
    "created_at": "2022-04-16T15:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625932",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:103'></a>Replying to [comment:101 mkoeppe]:
> `tox -e local-macports-standard` just failed for me (on macOS Big Sur 11.6) with
> 
> ```
> --->  Applying patches to gcc10
> --->  Configuring gcc10
> Warning: Applying '--without-build-config' workaround to Xcode none / CLT 13.2.0.0.1.1638488800
> Warning: If versions > 12.5 please check if it is still required
> --->  Building gcc10                                     
> Error: Failed to build gcc10: command execution failed   
> Error: See /Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-standard/macports/var/macports/logs/_Users_mkoeppe_s_sage_sage-rebasing_worktree-rebase_.tox_local-macports-standard_macports_var_macports_sources_rsync.macports.org_macports_release_tarballs_ports_lang_gcc10/gcc10/main.log for details.
> Error: Follow https://guide.macports.org/#project.tickets if you believe there is a bug.
> Error: Processing of port gcc10 failed
> ```

I see the same.



---

archive/issue_comments_625933.json:
```json
{
    "body": "Changing commit from \"4bf4e4577aa070b0f3fb581e1cfad545225edb9f\" to \"18a394628b793358016cad8327fa31473c9a6d72\"",
    "created_at": "2022-04-16T17:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625933",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4bf4e4577aa070b0f3fb581e1cfad545225edb9f" to "18a394628b793358016cad8327fa31473c9a6d72"



---

archive/issue_comments_625934.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-16T17:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625934",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625935.json:
```json
{
    "body": "<a id='comment:5'></a>With the change to gcc11, I am getting a bit farther.\n\n```\n--->  Building R\nError: Failed to build R: command execution failed       \nError: See /opt/local/var/macports/logs/_opt_local_var_macports_sources_rsync.macports.org_macports_release_tarballs_ports_math_R/R/main.log for details.\nError: Follow https://guide.macports.org/#project.tickets if you believe there is a bug.\nError: Processing of port R failed\n```\napparently because of a failure in some pdf docbuild\n\n```\n:info:build Error: compiling TeX file 'reshape.tex' failed with message:\n:info:build Running 'texi2dvi' on 'reshape.tex' failed.\n:info:build LaTeX errors:\n:info:build ! LaTeX Error: File `fancyvrb.sty' not found.\n:info:build Type X to quit or <RETURN> to proceed,\n:info:build or enter new name. (Default extension: sty)\n:info:build ! Emergency stop.\n:info:build <read *> \n:info:build          \n:info:build l.19 \\begingroup\n:info:build                 ^^M\n:info:build !  ==> Fatal error occurred, no output PDF file produced!\n:info:build Execution halted\n:info:build make[1]: *** [vignettes] Error 1\n:info:build make[1]: Leaving directory `/opt/local/var/macports/build/_opt_local_var_macports_sources_rsync.macports.org_macports_release_tarballs_ports_math_R/R/work/R-4.1.3/src/library'\n:info:build make: *** [vignettes] Error 2\n```",
    "created_at": "2022-04-16T22:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625935",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>With the change to gcc11, I am getting a bit farther.

```
--->  Building R
Error: Failed to build R: command execution failed       
Error: See /opt/local/var/macports/logs/_opt_local_var_macports_sources_rsync.macports.org_macports_release_tarballs_ports_math_R/R/main.log for details.
Error: Follow https://guide.macports.org/#project.tickets if you believe there is a bug.
Error: Processing of port R failed
```
apparently because of a failure in some pdf docbuild

```
:info:build Error: compiling TeX file 'reshape.tex' failed with message:
:info:build Running 'texi2dvi' on 'reshape.tex' failed.
:info:build LaTeX errors:
:info:build ! LaTeX Error: File `fancyvrb.sty' not found.
:info:build Type X to quit or <RETURN> to proceed,
:info:build or enter new name. (Default extension: sty)
:info:build ! Emergency stop.
:info:build <read *> 
:info:build          
:info:build l.19 \begingroup
:info:build                 ^^M
:info:build !  ==> Fatal error occurred, no output PDF file produced!
:info:build Execution halted
:info:build make[1]: *** [vignettes] Error 1
:info:build make[1]: Leaving directory `/opt/local/var/macports/build/_opt_local_var_macports_sources_rsync.macports.org_macports_release_tarballs_ports_math_R/R/work/R-4.1.3/src/library'
:info:build make: *** [vignettes] Error 2
```



---

archive/issue_comments_625936.json:
```json
{
    "body": "<a id='comment:6'></a>I see\n\n```\nWarning: texlive-bin installs files outside the common directory structure.\n--->  Installing texlive-bin @2022.62882_0+x11\n--->  Activating texlive-bin @2022.62882_0+x11\nError: Failed to activate texlive-bin: can't create directory \"/Library/TeX/Distributions/.FactoryDefaults/MacPorts-Users_palmieri_Desktop_Sage_sage_builds_TESTING_sage-9.6.rc0_.tox_local-macports-standard_macports-TeXLive\": permission denied\nError: See /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.6.rc0/.tox/local-macports-standard/macports/var/macports/logs/_Users_palmieri_Desktop_Sage_sage_builds_TESTING_sage-9.6.rc0_.tox_local-macports-standard_macports_var_macports_sources_rsync.macports.org_macports_release_tarballs_ports_tex_texlive-bin/texlive-bin/main.log for details.\nError: Follow https://guide.macports.org/#project.tickets if you believe there is a bug.\nError: Processing of port R failed\n```\nI don't like the idea of this trying to install anything in `/Library`, and that looks like a problem.",
    "created_at": "2022-04-17T01:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625936",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>I see

```
Warning: texlive-bin installs files outside the common directory structure.
--->  Installing texlive-bin @2022.62882_0+x11
--->  Activating texlive-bin @2022.62882_0+x11
Error: Failed to activate texlive-bin: can't create directory "/Library/TeX/Distributions/.FactoryDefaults/MacPorts-Users_palmieri_Desktop_Sage_sage_builds_TESTING_sage-9.6.rc0_.tox_local-macports-standard_macports-TeXLive": permission denied
Error: See /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.6.rc0/.tox/local-macports-standard/macports/var/macports/logs/_Users_palmieri_Desktop_Sage_sage_builds_TESTING_sage-9.6.rc0_.tox_local-macports-standard_macports_var_macports_sources_rsync.macports.org_macports_release_tarballs_ports_tex_texlive-bin/texlive-bin/main.log for details.
Error: Follow https://guide.macports.org/#project.tickets if you believe there is a bug.
Error: Processing of port R failed
```
I don't like the idea of this trying to install anything in `/Library`, and that looks like a problem.



---

archive/issue_comments_625937.json:
```json
{
    "body": "<a id='comment:7'></a>Yes, it looks like not all packages are prepared for installation in a custom prefix.\n\nI've tried installing in the default prefix (`/opt/local`) with sudo (that's `tox -e local-macports-optlocal-standard`), and installation of texlive went through without error. Just did `sudo /opt/local/bin/port install texlive-latex-extra` to get some of the missing files.",
    "created_at": "2022-04-17T02:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625937",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>Yes, it looks like not all packages are prepared for installation in a custom prefix.

I've tried installing in the default prefix (`/opt/local`) with sudo (that's `tox -e local-macports-optlocal-standard`), and installation of texlive went through without error. Just did `sudo /opt/local/bin/port install texlive-latex-extra` to get some of the missing files.



---

archive/issue_comments_625938.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Not yet reported upstream; Will do shortly.\"",
    "created_at": "2022-04-17T03:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625938",
    "user": "https://github.com/mkoeppe"
}
```

Changing upstream from "N/A" to "Not yet reported upstream; Will do shortly."



---

archive/issue_comments_625939.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-17T06:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625939",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625940.json:
```json
{
    "body": "Changing commit from \"18a394628b793358016cad8327fa31473c9a6d72\" to \"7ab30b4dad469b6f15438148f689252c640ac6d9\"",
    "created_at": "2022-04-17T06:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625940",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "18a394628b793358016cad8327fa31473c9a6d72" to "7ab30b4dad469b6f15438148f689252c640ac6d9"



---

archive/issue_comments_625941.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-17T06:13:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625941",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625942.json:
```json
{
    "body": "Changing commit from \"7ab30b4dad469b6f15438148f689252c640ac6d9\" to \"b91993318a58e73ace783a838b171b1f8208c9c0\"",
    "created_at": "2022-04-17T06:13:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625942",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7ab30b4dad469b6f15438148f689252c640ac6d9" to "b91993318a58e73ace783a838b171b1f8208c9c0"



---

archive/issue_comments_625943.json:
```json
{
    "body": "<a id='comment:1'></a>This gets me to the Sage distribution build. Next error: `rpy2` fails\n\n```\n  gcc -bundle -undefined dynamic_lookup -Wl,-headerpad,0x1000 -L/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -Wl,-rpath,/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -L/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -Wl,-rpath,/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -g -O2 build/temp.macosx-10.14-x86_64-3.8/build/temp.macosx-10.14-x86_64-3.8/_rinterface_cffi_api.o -L/opt/local/lib -L/opt/local/lib -lpcre2-8 -llzma -lbz2 -lz -ldl -lm -liconv -licuuc -licui18n -o build/lib.macosx-10.14-x86_64-3.8/_rinterface_cffi_api.abi3.so -fopenmp -Wl,-headerpad_max_install_names -Wl,-syslibroot,/Library/Developer/CommandLineTools/SDKs/MacOSX11.sdk -arch x86_64 -F/opt/local/Library/Frameworks/R.framework/.. -framework R\n  clang: error: unsupported option '-fopenmp'\n```",
    "created_at": "2022-04-17T06:38:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625943",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>This gets me to the Sage distribution build. Next error: `rpy2` fails

```
  gcc -bundle -undefined dynamic_lookup -Wl,-headerpad,0x1000 -L/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -Wl,-rpath,/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -L/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -Wl,-rpath,/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -g -O2 build/temp.macosx-10.14-x86_64-3.8/build/temp.macosx-10.14-x86_64-3.8/_rinterface_cffi_api.o -L/opt/local/lib -L/opt/local/lib -lpcre2-8 -llzma -lbz2 -lz -ldl -lm -liconv -licuuc -licui18n -o build/lib.macosx-10.14-x86_64-3.8/_rinterface_cffi_api.abi3.so -fopenmp -Wl,-headerpad_max_install_names -Wl,-syslibroot,/Library/Developer/CommandLineTools/SDKs/MacOSX11.sdk -arch x86_64 -F/opt/local/Library/Frameworks/R.framework/.. -framework R
  clang: error: unsupported option '-fopenmp'
```



---

archive/issue_comments_625944.json:
```json
{
    "body": "<a id='comment:2'></a>Also `sagelib` fails\n\n```\n4 warnings generated.\nld: illegal data reference in _avma to thread local variable _avma in dylib /Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib/libpari.dylib for architecture x86_64\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\nerror: Command \"gcc -bundle -undefined dynamic_lookup -Wl,-headerpad,0x1000 -L/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -Wl,-rpath,/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -g -O2 build/temp.macosx-10.14-x86_64-3.8/build/cythonized/sage/libs/pari/convert_sage_complex_double.o -L/opt/local/lib -lgsl -lpari -lgmp -lm -lopenblas -o build/lib.macosx-10.14-x86_64-3.8/sage/libs/pari/convert_sage_complex_double.cpython-38-darwin.so -lpari\" failed with exit status 1\n```",
    "created_at": "2022-04-17T07:24:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625944",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>Also `sagelib` fails

```
4 warnings generated.
ld: illegal data reference in _avma to thread local variable _avma in dylib /Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib/libpari.dylib for architecture x86_64
clang: error: linker command failed with exit code 1 (use -v to see invocation)
error: Command "gcc -bundle -undefined dynamic_lookup -Wl,-headerpad,0x1000 -L/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -Wl,-rpath,/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -g -O2 build/temp.macosx-10.14-x86_64-3.8/build/cythonized/sage/libs/pari/convert_sage_complex_double.o -L/opt/local/lib -lgsl -lpari -lgmp -lm -lopenblas -o build/lib.macosx-10.14-x86_64-3.8/sage/libs/pari/convert_sage_complex_double.cpython-38-darwin.so -lpari" failed with exit status 1
```



---

archive/issue_comments_625945.json:
```json
{
    "body": "<a id='comment:3'></a>With `tox -e local-macports-minimal`, `gfortran` fails. This unfortunately happens on this machine with ordinary Sage if I use `./configure --with-system-gfortran=no` with the error message\n\n```\nError: configuring for an unreleased macOS version x86_64-apple-darwin21.4.0\n```\nI don't know why this is called \"unreleased\".",
    "created_at": "2022-04-18T17:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625945",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>With `tox -e local-macports-minimal`, `gfortran` fails. This unfortunately happens on this machine with ordinary Sage if I use `./configure --with-system-gfortran=no` with the error message

```
Error: configuring for an unreleased macOS version x86_64-apple-darwin21.4.0
```
I don't know why this is called "unreleased".



---

archive/issue_comments_625946.json:
```json
{
    "body": "<a id='comment:4'></a>I guess our gcc/gfortran package is just too old. \n\nUnfortunately we don't see this on our GH Actions because there are no macOS 12 runners yet. Apparently one can request access - https://github.community/t/macos-12-runner-not-available/242185/9",
    "created_at": "2022-04-18T18:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625946",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>I guess our gcc/gfortran package is just too old. 

Unfortunately we don't see this on our GH Actions because there are no macOS 12 runners yet. Apparently one can request access - https://github.community/t/macos-12-runner-not-available/242185/9



---

archive/issue_comments_625947.json:
```json
{
    "body": "<a id='comment:5'></a>I've requested access to the macOS 12 runners for the `sagemath` GH organization.",
    "created_at": "2022-04-18T18:16:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625947",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>I've requested access to the macOS 12 runners for the `sagemath` GH organization.



---

archive/issue_comments_625948.json:
```json
{
    "body": "<a id='comment:116'></a>Replying to [comment:111 mkoeppe]:\n> This gets me to the Sage distribution build. Next error: `rpy2` fails\n> \n> ```\n>   gcc -bundle -undefined dynamic_lookup -Wl,-headerpad,0x1000 -L/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -Wl,-rpath,/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -L/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -Wl,-rpath,/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -g -O2 build/temp.macosx-10.14-x86_64-3.8/build/temp.macosx-10.14-x86_64-3.8/_rinterface_cffi_api.o -L/opt/local/lib -L/opt/local/lib -lpcre2-8 -llzma -lbz2 -lz -ldl -lm -liconv -licuuc -licui18n -o build/lib.macosx-10.14-x86_64-3.8/_rinterface_cffi_api.abi3.so -fopenmp -Wl,-headerpad_max_install_names -Wl,-syslibroot,/Library/Developer/CommandLineTools/SDKs/MacOSX11.sdk -arch x86_64 -F/opt/local/Library/Frameworks/R.framework/.. -framework R\n>   clang: error: unsupported option '-fopenmp'\n> ```\n\n\nThis compiler flag comes from the configuration of the macports-provided R.\n\n```\n(sage-buildsh) mkoeppe@egret:src$ /opt/local/bin/R CMD config --cppflags\n-I/opt/local/Library/Frameworks/R.framework/Resources/include\n(sage-buildsh) mkoeppe@egret:src$ /opt/local/bin/R CMD config --ldflags\n-fopenmp -L/opt/local/lib -Wl,-headerpad_max_install_names -Wl,-syslibroot,/Library/Developer/CommandLineTools/SDKs/MacOSX11.sdk -arch x86_64 -F/opt/local/Library/Frameworks/R.framework/.. -framework R -L/opt/local/lib -lpcre2-8 -llzma -lbz2 -lz -ldl -lm -liconv -licuuc -licui18n\n(sage-buildsh) mkoeppe@egret:src$ /opt/local/bin/R CMD config CC\n/opt/local/bin/clang-mp-13\n```",
    "created_at": "2022-04-20T03:52:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625948",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:116'></a>Replying to [comment:111 mkoeppe]:
> This gets me to the Sage distribution build. Next error: `rpy2` fails
> 
> ```
>   gcc -bundle -undefined dynamic_lookup -Wl,-headerpad,0x1000 -L/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -Wl,-rpath,/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -L/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -Wl,-rpath,/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/.tox/local-macports-optlocal-standard/local/lib -g -O2 build/temp.macosx-10.14-x86_64-3.8/build/temp.macosx-10.14-x86_64-3.8/_rinterface_cffi_api.o -L/opt/local/lib -L/opt/local/lib -lpcre2-8 -llzma -lbz2 -lz -ldl -lm -liconv -licuuc -licui18n -o build/lib.macosx-10.14-x86_64-3.8/_rinterface_cffi_api.abi3.so -fopenmp -Wl,-headerpad_max_install_names -Wl,-syslibroot,/Library/Developer/CommandLineTools/SDKs/MacOSX11.sdk -arch x86_64 -F/opt/local/Library/Frameworks/R.framework/.. -framework R
>   clang: error: unsupported option '-fopenmp'
> ```


This compiler flag comes from the configuration of the macports-provided R.

```
(sage-buildsh) mkoeppe@egret:src$ /opt/local/bin/R CMD config --cppflags
-I/opt/local/Library/Frameworks/R.framework/Resources/include
(sage-buildsh) mkoeppe@egret:src$ /opt/local/bin/R CMD config --ldflags
-fopenmp -L/opt/local/lib -Wl,-headerpad_max_install_names -Wl,-syslibroot,/Library/Developer/CommandLineTools/SDKs/MacOSX11.sdk -arch x86_64 -F/opt/local/Library/Frameworks/R.framework/.. -framework R -L/opt/local/lib -lpcre2-8 -llzma -lbz2 -lz -ldl -lm -liconv -licuuc -licui18n
(sage-buildsh) mkoeppe@egret:src$ /opt/local/bin/R CMD config CC
/opt/local/bin/clang-mp-13
```



---

archive/issue_comments_625949.json:
```json
{
    "body": "<a id='comment:117'></a>Replying to [comment:113 jhpalmieri]:\n> `gfortran` fails. This unfortunately happens on this machine with ordinary Sage if I use `./configure --with-system-gfortran=no` with the error message\n> \n> ```\n> Error: configuring for an unreleased macOS version x86_64-apple-darwin21.4.0\n> ```\n\n\nI've opened #33750 for the upgrade of gcc/gfortran",
    "created_at": "2022-04-24T05:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625949",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:117'></a>Replying to [comment:113 jhpalmieri]:
> `gfortran` fails. This unfortunately happens on this machine with ordinary Sage if I use `./configure --with-system-gfortran=no` with the error message
> 
> ```
> Error: configuring for an unreleased macOS version x86_64-apple-darwin21.4.0
> ```


I've opened #33750 for the upgrade of gcc/gfortran



---

archive/issue_comments_625950.json:
```json
{
    "body": "<a id='comment:8'></a>With 9.6.rc3 + this ticket, `tox -e local-macports-minimal` more or less worked for me: the first time through it hung, but then I hit ctrl-c and ran it again, and it finished. `tox -e local-macports-standard` did not work.",
    "created_at": "2022-05-01T02:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625950",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>With 9.6.rc3 + this ticket, `tox -e local-macports-minimal` more or less worked for me: the first time through it hung, but then I hit ctrl-c and ran it again, and it finished. `tox -e local-macports-standard` did not work.



---

archive/issue_comments_625951.json:
```json
{
    "body": "<a id='comment:9'></a>Running `tox -e local-macports-standard` ends with:\n\n```\n--->  Computing dependencies for gd2\n--->  Dependencies to be installed: fontconfig freetype brotli cmake curl libheif aom git gdk-pixbuf2 gobject-introspection cairo libjpeg-turbo tiff lerc rav1e cargo cargo-bootstrap rust libgit2 cargo-c x265 webp\nError: The following dependencies were not installed because all of them have unmet dependencies (likely due to a dependency cycle): fontconfig freetype brotli cmake curl libheif aom git gdk-pixbuf2 gobject-introspection cairo libjpeg-turbo tiff lerc rav1e cargo cargo-bootstrap rust libgit2 cargo-c x265 webp\nError: Follow https://guide.macports.org/#project.tickets if you believe there is a bug.\nError: Processing of port gd2 failed\nERROR: InvocationError for command /bin/bash -c 'case \"\" in 1|y*|Y*);; *)  port selfupdate &&  port upgrade outdated && PACKAGES=$(build/bin/sage-get-system-packages macports $(PATH=build/bin:$PATH build/bin/sage-package list --has-file=spkg-configure.m4 :standard:) _bootstrap    ); eval $(build/bin/sage-print-system-package-command macports  --yes --no-install-recommends install $PACKAGES) || [ \"$IGNORE_MISSING_SYSTEM_PACKAGES\" = yes ] && echo \"(ignoring errors)\" ;; esac' (exited with code 1)\n________________________________________ summary _________________________________________\nERROR:   local-macports-standard: commands failed\n```",
    "created_at": "2022-05-01T03:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625951",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>Running `tox -e local-macports-standard` ends with:

```
--->  Computing dependencies for gd2
--->  Dependencies to be installed: fontconfig freetype brotli cmake curl libheif aom git gdk-pixbuf2 gobject-introspection cairo libjpeg-turbo tiff lerc rav1e cargo cargo-bootstrap rust libgit2 cargo-c x265 webp
Error: The following dependencies were not installed because all of them have unmet dependencies (likely due to a dependency cycle): fontconfig freetype brotli cmake curl libheif aom git gdk-pixbuf2 gobject-introspection cairo libjpeg-turbo tiff lerc rav1e cargo cargo-bootstrap rust libgit2 cargo-c x265 webp
Error: Follow https://guide.macports.org/#project.tickets if you believe there is a bug.
Error: Processing of port gd2 failed
ERROR: InvocationError for command /bin/bash -c 'case "" in 1|y*|Y*);; *)  port selfupdate &&  port upgrade outdated && PACKAGES=$(build/bin/sage-get-system-packages macports $(PATH=build/bin:$PATH build/bin/sage-package list --has-file=spkg-configure.m4 :standard:) _bootstrap    ); eval $(build/bin/sage-print-system-package-command macports  --yes --no-install-recommends install $PACKAGES) || [ "$IGNORE_MISSING_SYSTEM_PACKAGES" = yes ] && echo "(ignoring errors)" ;; esac' (exited with code 1)
________________________________________ summary _________________________________________
ERROR:   local-macports-standard: commands failed
```



---

archive/issue_comments_625952.json:
```json
{
    "body": "<a id='comment:0'></a>I removed `/opt/local` after the upgrade to macOS Monterey, and `tox -e local-macports-optlocal-minimal` did a fresh installation of macports. The build succeeded.",
    "created_at": "2022-05-01T05:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625952",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:0'></a>I removed `/opt/local` after the upgrade to macOS Monterey, and `tox -e local-macports-optlocal-minimal` did a fresh installation of macports. The build succeeded.



---

archive/issue_comments_625953.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-05-01T05:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625953",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_625954.json:
```json
{
    "body": "Changing commit from \"b91993318a58e73ace783a838b171b1f8208c9c0\" to \"6544ae26b0acdf0a24f411c80dc75a25a2e3b760\"",
    "created_at": "2022-05-01T05:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625954",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b91993318a58e73ace783a838b171b1f8208c9c0" to "6544ae26b0acdf0a24f411c80dc75a25a2e3b760"



---

archive/issue_comments_625955.json:
```json
{
    "body": "<a id='comment:2'></a>(That's after rebasing on 9.6rc3)",
    "created_at": "2022-05-01T05:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625955",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>(That's after rebasing on 9.6rc3)



---

archive/issue_comments_625956.json:
```json
{
    "body": "<a id='comment:123'></a>Replying to [comment:119 jhpalmieri]:\n> Running `tox -e local-macports-standard` ends with:\n> \n> ```\n> --->  Computing dependencies for gd2\n> --->  Dependencies to be installed: fontconfig freetype brotli cmake curl libheif aom git gdk-pixbuf2 gobject-introspection cairo libjpeg-turbo tiff lerc rav1e cargo cargo-bootstrap rust libgit2 cargo-c x265 webp\n\n\nI'm getting the same error with `tox -e local-macports-optlocal-standard`.",
    "created_at": "2022-05-01T07:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625956",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:123'></a>Replying to [comment:119 jhpalmieri]:
> Running `tox -e local-macports-standard` ends with:
> 
> ```
> --->  Computing dependencies for gd2
> --->  Dependencies to be installed: fontconfig freetype brotli cmake curl libheif aom git gdk-pixbuf2 gobject-introspection cairo libjpeg-turbo tiff lerc rav1e cargo cargo-bootstrap rust libgit2 cargo-c x265 webp


I'm getting the same error with `tox -e local-macports-optlocal-standard`.



---

archive/issue_comments_625957.json:
```json
{
    "body": "Changing commit from \"6544ae26b0acdf0a24f411c80dc75a25a2e3b760\" to \"27eff2ba095a385db8ab70434e1a4f8661bc6295\"",
    "created_at": "2022-05-01T07:44:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625957",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6544ae26b0acdf0a24f411c80dc75a25a2e3b760" to "27eff2ba095a385db8ab70434e1a4f8661bc6295"



---

archive/issue_comments_625958.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-01T07:44:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625958",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625959.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-01T07:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625959",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625960.json:
```json
{
    "body": "Changing commit from \"27eff2ba095a385db8ab70434e1a4f8661bc6295\" to \"c6cd79f10c19a26175cdb8b16fe30e52b9e827d0\"",
    "created_at": "2022-05-01T07:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625960",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "27eff2ba095a385db8ab70434e1a4f8661bc6295" to "c6cd79f10c19a26175cdb8b16fe30e52b9e827d0"



---

archive/issue_comments_625961.json:
```json
{
    "body": "<a id='comment:6'></a>Now it ends with `Error: The following dependencies were not installed because all of them have unmet dependencies (likely due to a dependency cycle): curl brotli cmake`",
    "created_at": "2022-05-01T16:18:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625961",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Now it ends with `Error: The following dependencies were not installed because all of them have unmet dependencies (likely due to a dependency cycle): curl brotli cmake`



---

archive/issue_comments_625962.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-01T16:39:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625962",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625963.json:
```json
{
    "body": "Changing commit from \"c6cd79f10c19a26175cdb8b16fe30e52b9e827d0\" to \"a9094850ec0c9b206a224871401a5d6eb33a6962\"",
    "created_at": "2022-05-01T16:39:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625963",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c6cd79f10c19a26175cdb8b16fe30e52b9e827d0" to "a9094850ec0c9b206a224871401a5d6eb33a6962"



---

archive/issue_comments_625964.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-05-01T17:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625964",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_625965.json:
```json
{
    "body": "Changing commit from \"a9094850ec0c9b206a224871401a5d6eb33a6962\" to \"99feb0db45fac76f048c56b8cb083442b99cb1b6\"",
    "created_at": "2022-05-01T17:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625965",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a9094850ec0c9b206a224871401a5d6eb33a6962" to "99feb0db45fac76f048c56b8cb083442b99cb1b6"



---

archive/issue_comments_625966.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-05-01T17:46:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625966",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_625967.json:
```json
{
    "body": "Changing commit from \"99feb0db45fac76f048c56b8cb083442b99cb1b6\" to \"7a2d87519020f7ce44dc74ab74784b12246d73fb\"",
    "created_at": "2022-05-01T17:46:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625967",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "99feb0db45fac76f048c56b8cb083442b99cb1b6" to "7a2d87519020f7ce44dc74ab74784b12246d73fb"



---

archive/issue_comments_625968.json:
```json
{
    "body": "Changing commit from \"7a2d87519020f7ce44dc74ab74784b12246d73fb\" to \"1fcbecf1893fb400a73eb9c55363a47b787ea4f0\"",
    "created_at": "2022-05-01T19:35:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625968",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7a2d87519020f7ce44dc74ab74784b12246d73fb" to "1fcbecf1893fb400a73eb9c55363a47b787ea4f0"



---

archive/issue_comments_625969.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-05-01T19:35:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625969",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_625970.json:
```json
{
    "body": "<a id='comment:1'></a>Now all packages that run into the issue with `cmake` appear to be disabled. Macports package installation finished without error now.",
    "created_at": "2022-05-01T19:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625970",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>Now all packages that run into the issue with `cmake` appear to be disabled. Macports package installation finished without error now.



---

archive/issue_comments_625971.json:
```json
{
    "body": "<a id='comment:2'></a>There are a few installation notes\n\n```\n  gpatch has the following notes:\n    The patch tool provided by this port is prefixed with the character 'g' by default making it available as 'gpatch'.\n    \n    If you want to use 'patch' and other GNU coreutils by default, add this directory to the front of your PATH environment variable:\n        /opt/local/libexec/gnubin/\n\n  py310-tox has the following notes:\n    To make the Python 3.10 version of tox the one that is run when you execute the commands without a version suffix, e.g. 'tox', run:\n    \n    port select --set tox tox310\n  py310-virtualenv has the following notes:\n    The executable is installed as '/opt/local/bin/virtualenv-3.10'. To symlink it to '/opt/local/bin/virtualenv', run:\n    \n        sudo port select --set virtualenv virtualenv310\n  python310 has the following notes:\n    To make this the default Python or Python 3 (i.e., the version run by the 'python' or 'python3' commands), run one or both of:\n    \n        sudo port select --set python python310\n        sudo port select --set python3 python310\n```\n\nIn particular, `tox -e local-macports-optlocal-standard` uses `/usr/bin/python3` as the python.",
    "created_at": "2022-05-01T20:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625971",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>There are a few installation notes

```
  gpatch has the following notes:
    The patch tool provided by this port is prefixed with the character 'g' by default making it available as 'gpatch'.
    
    If you want to use 'patch' and other GNU coreutils by default, add this directory to the front of your PATH environment variable:
        /opt/local/libexec/gnubin/

  py310-tox has the following notes:
    To make the Python 3.10 version of tox the one that is run when you execute the commands without a version suffix, e.g. 'tox', run:
    
    port select --set tox tox310
  py310-virtualenv has the following notes:
    The executable is installed as '/opt/local/bin/virtualenv-3.10'. To symlink it to '/opt/local/bin/virtualenv', run:
    
        sudo port select --set virtualenv virtualenv310
  python310 has the following notes:
    To make this the default Python or Python 3 (i.e., the version run by the 'python' or 'python3' commands), run one or both of:
    
        sudo port select --set python python310
        sudo port select --set python3 python310
```

In particular, `tox -e local-macports-optlocal-standard` uses `/usr/bin/python3` as the python.



---

archive/issue_comments_625972.json:
```json
{
    "body": "<a id='comment:3'></a>`tox -e local-macports-optlocal-standard` succeeds.",
    "created_at": "2022-05-01T22:17:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625972",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>`tox -e local-macports-optlocal-standard` succeeds.



---

archive/issue_comments_625973.json:
```json
{
    "body": "<a id='comment:4'></a>`tox -e local-macports-optlocal-python3.10-standard` warns:\n\n```\nchecking ... whether /opt/local/bin/python3.10 is good... \nconfigure: WARNING: this is a misconfigured Python whose sysconfig compiler/linker flags contain -I or -L options, which may cause wrong versions of libraries to leak into the build of Python packages - see https://trac.sagemath.org/ticket/31132\n```",
    "created_at": "2022-05-01T22:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625973",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>`tox -e local-macports-optlocal-python3.10-standard` warns:

```
checking ... whether /opt/local/bin/python3.10 is good... 
configure: WARNING: this is a misconfigured Python whose sysconfig compiler/linker flags contain -I or -L options, which may cause wrong versions of libraries to leak into the build of Python packages - see https://trac.sagemath.org/ticket/31132
```



---

archive/issue_comments_625974.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-05-01T22:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625974",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_625975.json:
```json
{
    "body": "Changing commit from \"1fcbecf1893fb400a73eb9c55363a47b787ea4f0\" to \"1e8e4bce49ff91a359049ee5a8cd3c50196049b9\"",
    "created_at": "2022-05-01T22:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625975",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1fcbecf1893fb400a73eb9c55363a47b787ea4f0" to "1e8e4bce49ff91a359049ee5a8cd3c50196049b9"



---

archive/issue_comments_625976.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-01T22:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625976",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625977.json:
```json
{
    "body": "<a id='comment:137'></a>Replying to [comment:134 mkoeppe]:\n> `tox -e local-macports-optlocal-python3.10-standard` warns:\n> \n> ```\n> checking ... whether /opt/local/bin/python3.10 is good... \n> configure: WARNING: this is a misconfigured Python whose sysconfig compiler/linker flags contain -I or -L options, which may cause wrong versions of libraries to leak into the build of Python packages - see https://trac.sagemath.org/ticket/31132\n> ```\n... and gmpy2 fails to build",
    "created_at": "2022-05-01T22:55:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625977",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:137'></a>Replying to [comment:134 mkoeppe]:
> `tox -e local-macports-optlocal-python3.10-standard` warns:
> 
> ```
> checking ... whether /opt/local/bin/python3.10 is good... 
> configure: WARNING: this is a misconfigured Python whose sysconfig compiler/linker flags contain -I or -L options, which may cause wrong versions of libraries to leak into the build of Python packages - see https://trac.sagemath.org/ticket/31132
> ```
... and gmpy2 fails to build



---

archive/issue_comments_625978.json:
```json
{
    "body": "<a id='comment:138'></a>Replying to [comment:137 mkoeppe]:\n> Replying to [comment:134 mkoeppe]:\n> > `tox -e local-macports-optlocal-python3.10-standard` warns:\n> > \n> > ```\n> > checking ... whether /opt/local/bin/python3.10 is good... \n> > configure: WARNING: this is a misconfigured Python whose sysconfig compiler/linker flags contain -I or -L options, which may cause wrong versions of libraries to leak into the build of Python packages - see https://trac.sagemath.org/ticket/31132\n> > ```\n\n> ... and `gmpy2`, `cysignals`, `cvxopt` fail to build - similar to comment:31",
    "created_at": "2022-05-02T01:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625978",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:138'></a>Replying to [comment:137 mkoeppe]:
> Replying to [comment:134 mkoeppe]:
> > `tox -e local-macports-optlocal-python3.10-standard` warns:
> > 
> > ```
> > checking ... whether /opt/local/bin/python3.10 is good... 
> > configure: WARNING: this is a misconfigured Python whose sysconfig compiler/linker flags contain -I or -L options, which may cause wrong versions of libraries to leak into the build of Python packages - see https://trac.sagemath.org/ticket/31132
> > ```

> ... and `gmpy2`, `cysignals`, `cvxopt` fail to build - similar to comment:31



---

archive/issue_comments_625979.json:
```json
{
    "body": "Changing commit from \"1e8e4bce49ff91a359049ee5a8cd3c50196049b9\" to \"5bfc840d5de9bed57f2b22c8eb5c8f53a90a27d4\"",
    "created_at": "2022-05-02T01:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625979",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1e8e4bce49ff91a359049ee5a8cd3c50196049b9" to "5bfc840d5de9bed57f2b22c8eb5c8f53a90a27d4"



---

archive/issue_comments_625980.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-02T01:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625980",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625981.json:
```json
{
    "body": "<a id='comment:0'></a>This fixes gmpy2, cvxopt",
    "created_at": "2022-05-02T01:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625981",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:0'></a>This fixes gmpy2, cvxopt



---

archive/issue_comments_625982.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-02T02:41:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625982",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625983.json:
```json
{
    "body": "Changing commit from \"5bfc840d5de9bed57f2b22c8eb5c8f53a90a27d4\" to \"30c326c981897a58dcf1b12f1395ae1065be57d8\"",
    "created_at": "2022-05-02T02:41:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625983",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5bfc840d5de9bed57f2b22c8eb5c8f53a90a27d4" to "30c326c981897a58dcf1b12f1395ae1065be57d8"



---

archive/issue_comments_625984.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-02T06:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625984",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625985.json:
```json
{
    "body": "Changing commit from \"30c326c981897a58dcf1b12f1395ae1065be57d8\" to \"c69872294366bb80b1560505e2ca45cce170db4d\"",
    "created_at": "2022-05-02T06:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625985",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "30c326c981897a58dcf1b12f1395ae1065be57d8" to "c69872294366bb80b1560505e2ca45cce170db4d"



---

archive/issue_comments_625986.json:
```json
{
    "body": "<a id='comment:3'></a>Now `tox -e local-macports-optlocal-python3.10-standard` succeeds. The trick was to block out the homebrew installation in `/usr/local`.",
    "created_at": "2022-05-02T06:37:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625986",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>Now `tox -e local-macports-optlocal-python3.10-standard` succeeds. The trick was to block out the homebrew installation in `/usr/local`.



---

archive/issue_comments_625987.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,32 @@\n+Based on #30504, which added MacPorts package information, we update the system package scripts to include support for MacPorts.\n \n+Current Sage builds just fine on a system with MacPorts. \n+To test this, we add `local-macports` environments to `tox.ini`:\n+\n+```\n+tox -e local-macports-minimal\n+```\n+or\n+\n+```\n+tox -e local-macports-standard             # uses /usr/bin/python3\n+```\n+or \n+\n+```\n+tox -e local-macports-standard-python3.10  # uses python3.10 from macports\n+```\n+\n+Each of these commands creates an isolated installation of MacPorts in a subdirectory of `.tox` (using https://guide.macports.org/#installing.macports.source.multiple\n+); it will not use or modify `/opt/local`.  \n+\n+(There is also `tox -e local-macports-optlocal-standard`, which uses `sudo` to install things into the default location -- use at your own risk.)\n+\n+Requested at\n+\n+- [Ask Sage question 54790: Use OpenSSL from /opt/local/](https://ask.sagemath.org/question/54790)\n+- [sage-support, 2020-12](https://groups.google.com/g/sage-support/c/_cfY37nFF84/m/1biGwJetBgAJ)\n+- [sage-devel, 2022-04](https://groups.google.com/g/sage-devel/c/qTcF8tlWLcE/m/9QRODrv0CgAJ)\n \n Comment: 1\n \n``````\n",
    "created_at": "2022-05-02T06:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625987",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,32 @@
+Based on #30504, which added MacPorts package information, we update the system package scripts to include support for MacPorts.
 
+Current Sage builds just fine on a system with MacPorts. 
+To test this, we add `local-macports` environments to `tox.ini`:
+
+```
+tox -e local-macports-minimal
+```
+or
+
+```
+tox -e local-macports-standard             # uses /usr/bin/python3
+```
+or 
+
+```
+tox -e local-macports-standard-python3.10  # uses python3.10 from macports
+```
+
+Each of these commands creates an isolated installation of MacPorts in a subdirectory of `.tox` (using https://guide.macports.org/#installing.macports.source.multiple
+); it will not use or modify `/opt/local`.  
+
+(There is also `tox -e local-macports-optlocal-standard`, which uses `sudo` to install things into the default location -- use at your own risk.)
+
+Requested at
+
+- [Ask Sage question 54790: Use OpenSSL from /opt/local/](https://ask.sagemath.org/question/54790)
+- [sage-support, 2020-12](https://groups.google.com/g/sage-support/c/_cfY37nFF84/m/1biGwJetBgAJ)
+- [sage-devel, 2022-04](https://groups.google.com/g/sage-devel/c/qTcF8tlWLcE/m/9QRODrv0CgAJ)
 
 Comment: 1
 
``````




---

archive/issue_comments_625988.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-02T17:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625988",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_625989.json:
```json
{
    "body": "Changing commit from \"c69872294366bb80b1560505e2ca45cce170db4d\" to \"476fa33e16780466a04556f1c87532465dbde898\"",
    "created_at": "2022-08-02T17:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625989",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c69872294366bb80b1560505e2ca45cce170db4d" to "476fa33e16780466a04556f1c87532465dbde898"



---

archive/issue_comments_625990.json:
```json
{
    "body": "<a id='comment:6'></a>`tox -e local-macports-optlocal-standard-python3.10 -- ptest ` builds without problems, and there is only a small number of doctest failures.\n\n```\nsage -t --random-seed=37353794756962291469199267391330052516 src/doc/en/constructions/calculus.rst  # Timed out\nsage -t --random-seed=37353794756962291469199267391330052516 src/sage/dynamics/arithmetic_dynamics/projective_ds.py  # Timed out\nsage -t --random-seed=37353794756962291469199267391330052516 src/sage/interfaces/macaulay2.py  # 1 doctest failed\nsage -t --random-seed=37353794756962291469199267391330052516 src/sage/libs/libecm.pyx  # 7 doctests failed\nsage -t --random-seed=37353794756962291469199267391330052516 src/sage/matrix/constructor.pyx  # 1 doctest failed\nsage -t --random-seed=37353794756962291469199267391330052516 src/sage/misc/sageinspect.py  # 1 doctest failed\nsage -t --random-seed=37353794756962291469199267391330052516 src/sage/plot/plot3d/parametric_plot3d.py  # Timed out\nsage -t --random-seed=37353794756962291469199267391330052516 src/sage/repl/attach.py  # 1 doctest failed\nsage -t --random-seed=37353794756962291469199267391330052516 src/sage/repl/display/formatter.py  # 1 doctest failed\nsage -t --random-seed=37353794756962291469199267391330052516 src/sage/repl/interface_magic.py  # 1 doctest failed\nsage -t --random-seed=37353794756962291469199267391330052516 src/sage/repl/interpreter.py  # 2 doctests failed\nsage -t --random-seed=37353794756962291469199267391330052516 src/sage/repl/ipython_tests.py  # 1 doctest failed\nsage -t --random-seed=37353794756962291469199267391330052516 src/sage/repl/rich_output/backend_ipython.py  # 1 doctest failed\nsage -t --random-seed=37353794756962291469199267391330052516 src/sage/repl/ipython_extension.py  # 1 doctest failed\nsage -t --random-seed=37353794756962291469199267391330052516 src/sage/structure/sage_object.pyx  # 1 doctest failed\nsage -t --random-seed=37353794756962291469199267391330052516 src/sage/tests/cmdline.py  # 4 doctests failed\nsage -t --random-seed=37353794756962291469199267391330052516 src/sage/typeset/ascii_art.py  # 1 doctest failed\n```\nMost of these failures are from the warning \"UserWarning: Attempting to work in a virtualenv. If you encounter problems, please install IPython inside the virtualenv.\"\n\nThe only real failures are:\n\n```\nsage -t --random-seed=37353794756962291469199267391330052516 src/sage/libs/libecm.pyx\n**********************************************************************\nFile \"src/sage/libs/libecm.pyx\", line 33, in sage.libs.libecm\nFailed example:\n    ecmfactor(2^128+1,1000,sigma=227140902)\nExpected:\n    (True, 5704689200685129054721, 227140902)\nGot:\n    (False, None)\n**********************************************************************\nFile \"src/sage/libs/libecm.pyx\", line 91, in sage.libs.libecm.ecmfactor\nFailed example:\n    ecmfactor(N, 2e5)\nExpected:\n    (True, 2349023, ...)\nGot:\n    (True, 187072209578355573530071658587684226515959365500927, 0)\n**********************************************************************\nFile \"src/sage/libs/libecm.pyx\", line 113, in sage.libs.libecm.ecmfactor\nFailed example:\n    ecmfactor(N, 1e3)\nExpected:\n    (False, None)\nGot:\n    (True, 170141183460469231731687303715884105727, 0)\n**********************************************************************\nFile \"src/sage/libs/libecm.pyx\", line 130, in sage.libs.libecm.ecmfactor\nFailed example:\n    ecmfactor(N, 100, verbose=True)\nExpected:\n    Performing one curve with B1=100\n    Found factor in step 1: 11\n    (True, 11, ...)\nGot:\n    Performing one curve with B1=100\n    Found factor in step 1: 479270685891287906588011710623477140055626627230262983486227930615309559797523855924635580611607650107391\n    (True,\n     479270685891287906588011710623477140055626627230262983486227930615309559797523855924635580611607650107391,\n     0)\n**********************************************************************\nFile \"src/sage/libs/libecm.pyx\", line 134, in sage.libs.libecm.ecmfactor\nFailed example:\n    ecmfactor(N/11, 100, verbose=True)\nExpected:\n    Performing one curve with B1=100\n    Found no factor.\n    (False, None)\nGot:\n    Performing one curve with B1=100\n    Found factor in step 1: 43570062353753446053455610056679740005056966111842089407838902783209959981593077811330507328327968191581\n    (True,\n     43570062353753446053455610056679740005056966111842089407838902783209959981593077811330507328327968191581,\n     0)\n**********************************************************************\nFile \"src/sage/libs/libecm.pyx\", line 144, in sage.libs.libecm.ecmfactor\nFailed example:\n    alarm(0.5); ecmfactor(2^521-1, 1e7)\nExpected:\n    Traceback (most recent call last):\n    ...\n    AlarmInterrupt\nGot:\n    (True,\n     6864797660130609714981900799081393217269435300143305409394463459185543183397656052122559640661454554977296311391480858037121987999716643812574028291115057151,\n     0)\n**********************************************************************\nFile \"src/sage/libs/libecm.pyx\", line 151, in sage.libs.libecm.ecmfactor\nFailed example:\n    ecmfactor(1, 100)\nExpected:\n    (True, 1, ...)\nGot:\n    (False, None)\n**********************************************************************\n2 items had failures:\n   1 of   9 in sage.libs.libecm\n   6 of  21 in sage.libs.libecm.ecmfactor\n    [28 tests, 7 failures, 0.93 s]\n```",
    "created_at": "2022-08-05T05:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625990",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>`tox -e local-macports-optlocal-standard-python3.10 -- ptest ` builds without problems, and there is only a small number of doctest failures.

```
sage -t --random-seed=37353794756962291469199267391330052516 src/doc/en/constructions/calculus.rst  # Timed out
sage -t --random-seed=37353794756962291469199267391330052516 src/sage/dynamics/arithmetic_dynamics/projective_ds.py  # Timed out
sage -t --random-seed=37353794756962291469199267391330052516 src/sage/interfaces/macaulay2.py  # 1 doctest failed
sage -t --random-seed=37353794756962291469199267391330052516 src/sage/libs/libecm.pyx  # 7 doctests failed
sage -t --random-seed=37353794756962291469199267391330052516 src/sage/matrix/constructor.pyx  # 1 doctest failed
sage -t --random-seed=37353794756962291469199267391330052516 src/sage/misc/sageinspect.py  # 1 doctest failed
sage -t --random-seed=37353794756962291469199267391330052516 src/sage/plot/plot3d/parametric_plot3d.py  # Timed out
sage -t --random-seed=37353794756962291469199267391330052516 src/sage/repl/attach.py  # 1 doctest failed
sage -t --random-seed=37353794756962291469199267391330052516 src/sage/repl/display/formatter.py  # 1 doctest failed
sage -t --random-seed=37353794756962291469199267391330052516 src/sage/repl/interface_magic.py  # 1 doctest failed
sage -t --random-seed=37353794756962291469199267391330052516 src/sage/repl/interpreter.py  # 2 doctests failed
sage -t --random-seed=37353794756962291469199267391330052516 src/sage/repl/ipython_tests.py  # 1 doctest failed
sage -t --random-seed=37353794756962291469199267391330052516 src/sage/repl/rich_output/backend_ipython.py  # 1 doctest failed
sage -t --random-seed=37353794756962291469199267391330052516 src/sage/repl/ipython_extension.py  # 1 doctest failed
sage -t --random-seed=37353794756962291469199267391330052516 src/sage/structure/sage_object.pyx  # 1 doctest failed
sage -t --random-seed=37353794756962291469199267391330052516 src/sage/tests/cmdline.py  # 4 doctests failed
sage -t --random-seed=37353794756962291469199267391330052516 src/sage/typeset/ascii_art.py  # 1 doctest failed
```
Most of these failures are from the warning "UserWarning: Attempting to work in a virtualenv. If you encounter problems, please install IPython inside the virtualenv."

The only real failures are:

```
sage -t --random-seed=37353794756962291469199267391330052516 src/sage/libs/libecm.pyx
**********************************************************************
File "src/sage/libs/libecm.pyx", line 33, in sage.libs.libecm
Failed example:
    ecmfactor(2^128+1,1000,sigma=227140902)
Expected:
    (True, 5704689200685129054721, 227140902)
Got:
    (False, None)
**********************************************************************
File "src/sage/libs/libecm.pyx", line 91, in sage.libs.libecm.ecmfactor
Failed example:
    ecmfactor(N, 2e5)
Expected:
    (True, 2349023, ...)
Got:
    (True, 187072209578355573530071658587684226515959365500927, 0)
**********************************************************************
File "src/sage/libs/libecm.pyx", line 113, in sage.libs.libecm.ecmfactor
Failed example:
    ecmfactor(N, 1e3)
Expected:
    (False, None)
Got:
    (True, 170141183460469231731687303715884105727, 0)
**********************************************************************
File "src/sage/libs/libecm.pyx", line 130, in sage.libs.libecm.ecmfactor
Failed example:
    ecmfactor(N, 100, verbose=True)
Expected:
    Performing one curve with B1=100
    Found factor in step 1: 11
    (True, 11, ...)
Got:
    Performing one curve with B1=100
    Found factor in step 1: 479270685891287906588011710623477140055626627230262983486227930615309559797523855924635580611607650107391
    (True,
     479270685891287906588011710623477140055626627230262983486227930615309559797523855924635580611607650107391,
     0)
**********************************************************************
File "src/sage/libs/libecm.pyx", line 134, in sage.libs.libecm.ecmfactor
Failed example:
    ecmfactor(N/11, 100, verbose=True)
Expected:
    Performing one curve with B1=100
    Found no factor.
    (False, None)
Got:
    Performing one curve with B1=100
    Found factor in step 1: 43570062353753446053455610056679740005056966111842089407838902783209959981593077811330507328327968191581
    (True,
     43570062353753446053455610056679740005056966111842089407838902783209959981593077811330507328327968191581,
     0)
**********************************************************************
File "src/sage/libs/libecm.pyx", line 144, in sage.libs.libecm.ecmfactor
Failed example:
    alarm(0.5); ecmfactor(2^521-1, 1e7)
Expected:
    Traceback (most recent call last):
    ...
    AlarmInterrupt
Got:
    (True,
     6864797660130609714981900799081393217269435300143305409394463459185543183397656052122559640661454554977296311391480858037121987999716643812574028291115057151,
     0)
**********************************************************************
File "src/sage/libs/libecm.pyx", line 151, in sage.libs.libecm.ecmfactor
Failed example:
    ecmfactor(1, 100)
Expected:
    (True, 1, ...)
Got:
    (False, None)
**********************************************************************
2 items had failures:
   1 of   9 in sage.libs.libecm
   6 of  21 in sage.libs.libecm.ecmfactor
    [28 tests, 7 failures, 0.93 s]
```



---

archive/issue_comments_625991.json:
```json
{
    "body": "<a id='comment:7'></a>Good enough to get this in?",
    "created_at": "2022-08-05T05:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625991",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>Good enough to get this in?



---

archive/issue_comments_625992.json:
```json
{
    "body": "<a id='comment:8'></a>does macports have its own ecm here in these errors? If so, we can avoid them by testing ecm more in spkg-configure.",
    "created_at": "2022-08-24T14:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625992",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>does macports have its own ecm here in these errors? If so, we can avoid them by testing ecm more in spkg-configure.



---

archive/issue_comments_625993.json:
```json
{
    "body": "<a id='comment:9'></a>Yes, there is an ecm.",
    "created_at": "2022-08-24T15:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625993",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>Yes, there is an ecm.



---

archive/issue_comments_625994.json:
```json
{
    "body": "<a id='comment:0'></a>Do you want to work on this? I don't, hence my question in comment:147",
    "created_at": "2022-08-24T16:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625994",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:0'></a>Do you want to work on this? I don't, hence my question in comment:147



---

archive/issue_comments_625995.json:
```json
{
    "body": "<a id='comment:151'></a>Replying to [comment:150 mkoeppe]:\n> Do you want to work on this? I don't, hence my question in comment:147\n\nI'll see if I can fix this quickly.\nIf not, it can be merged as is, I guess.",
    "created_at": "2022-08-24T16:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625995",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:151'></a>Replying to [comment:150 mkoeppe]:
> Do you want to work on this? I don't, hence my question in comment:147

I'll see if I can fix this quickly.
If not, it can be merged as is, I guess.



---

archive/issue_comments_625996.json:
```json
{
    "body": "<a id='comment:2'></a>I tried `tox -e local-macports-standard` and got\n\n```\nError: Failed to install cmake-bootstrap: MacPorts requires root privileges for this action\nError: See /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.7.beta8/.tox/local-macports-standard/macports/var/macports/logs/_Users_palmieri_Desktop_Sage_sage_builds_TESTING_sage-9.7.beta8_.tox_local-macports-standard_macports_var_macports_sources_rsync.macports.org_macports_release_tarballs_ports_devel_cmake-bootstrap/cmake-bootstrap/main.log for details.\nError: Follow https://guide.macports.org/#project.tickets if you believe there is a bug.\nError: Processing of port gcc11 failed\n```\nSince I wasn't using `local-macports-optlocal-standard`, I wasn't expecting to need root privileges.",
    "created_at": "2022-08-24T17:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625996",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>I tried `tox -e local-macports-standard` and got

```
Error: Failed to install cmake-bootstrap: MacPorts requires root privileges for this action
Error: See /Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.7.beta8/.tox/local-macports-standard/macports/var/macports/logs/_Users_palmieri_Desktop_Sage_sage_builds_TESTING_sage-9.7.beta8_.tox_local-macports-standard_macports_var_macports_sources_rsync.macports.org_macports_release_tarballs_ports_devel_cmake-bootstrap/cmake-bootstrap/main.log for details.
Error: Follow https://guide.macports.org/#project.tickets if you believe there is a bug.
Error: Processing of port gcc11 failed
```
Since I wasn't using `local-macports-optlocal-standard`, I wasn't expecting to need root privileges.



---

archive/issue_comments_625997.json:
```json
{
    "body": "<a id='comment:3'></a>I can confirm this. It seems to be a new macports bug.",
    "created_at": "2022-08-24T22:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625997",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>I can confirm this. It seems to be a new macports bug.



---

archive/issue_comments_625998.json:
```json
{
    "body": "<a id='comment:4'></a>regarding `ecm` errors, are they only for the library interface, whereas `sage/interfaces/ecm.py` tests OK?",
    "created_at": "2022-08-25T08:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625998",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>regarding `ecm` errors, are they only for the library interface, whereas `sage/interfaces/ecm.py` tests OK?



---

archive/issue_comments_625999.json:
```json
{
    "body": "<a id='comment:5'></a>If I was careful in comment:146 where I summarized the failures, then yes",
    "created_at": "2022-08-25T15:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-625999",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>If I was careful in comment:146 where I summarized the failures, then yes



---

archive/issue_comments_626000.json:
```json
{
    "body": "<a id='comment:156'></a>Replying to [comment:153 mkoeppe]:\n> I can confirm this. It seems to be a new macports bug.\n\nhttps://ports.macports.org/port/cmake-bootstrap/ says to run `sudo port install cmake-bootstrap` - no idea why.\n\nI'm trying to test with `sudo` now.",
    "created_at": "2022-08-27T18:13:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-626000",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:156'></a>Replying to [comment:153 mkoeppe]:
> I can confirm this. It seems to be a new macports bug.

https://ports.macports.org/port/cmake-bootstrap/ says to run `sudo port install cmake-bootstrap` - no idea why.

I'm trying to test with `sudo` now.



---

archive/issue_comments_626001.json:
```json
{
    "body": "<a id='comment:7'></a>How does one pass `--enable-build-as-root` to tox?",
    "created_at": "2022-08-28T07:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-626001",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>How does one pass `--enable-build-as-root` to tox?



---

archive/issue_comments_626002.json:
```json
{
    "body": "<a id='comment:8'></a>You can set the environment variable `EXTRA_CONFIGURE_ARGS`",
    "created_at": "2022-08-28T15:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-626002",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>You can set the environment variable `EXTRA_CONFIGURE_ARGS`



---

archive/issue_comments_626003.json:
```json
{
    "body": "<a id='comment:9'></a>`sudo  EXTRA_CONFIGURE_ARGS=\"--enable-build-as-root\" tox -e local-macports-standard` is very slow (single-thread?), and seems to hang on installing Pari - this is after installing all the pre-reqs - which was also very slow, and included building clang from source (sic!).\n\nCan't it use XCode's clang instead?",
    "created_at": "2022-08-29T09:04:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-626003",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>`sudo  EXTRA_CONFIGURE_ARGS="--enable-build-as-root" tox -e local-macports-standard` is very slow (single-thread?), and seems to hang on installing Pari - this is after installing all the pre-reqs - which was also very slow, and included building clang from source (sic!).

Can't it use XCode's clang instead?



---

archive/issue_comments_626004.json:
```json
{
    "body": "<a id='comment:0'></a>anyway, macports in .tox/ was installed,so I chown'd it to the normal user, and proceeded without sudo. This pushed the build further,but still it is single thread. Waiting for tests to finish.",
    "created_at": "2022-08-29T15:00:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-626004",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:0'></a>anyway, macports in .tox/ was installed,so I chown'd it to the normal user, and proceeded without sudo. This pushed the build further,but still it is single thread. Waiting for tests to finish.



---

archive/issue_comments_626005.json:
```json
{
    "body": "<a id='comment:161'></a>Replying to [comment:159 dimpase]:\n> `sudo  EXTRA_CONFIGURE_ARGS=\"--enable-build-as-root\" tox -e local-macports-standard` is very slow (single-thread?)\n\n\nYou could have set `MAKE=\"make -j16\" `",
    "created_at": "2022-08-29T15:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-626005",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:161'></a>Replying to [comment:159 dimpase]:
> `sudo  EXTRA_CONFIGURE_ARGS="--enable-build-as-root" tox -e local-macports-standard` is very slow (single-thread?)


You could have set `MAKE="make -j16" `



---

archive/issue_comments_626006.json:
```json
{
    "body": "<a id='comment:2'></a>with the latest beta8 merged, I am getting a sagelib building error \n\n```\n    error: Command \"gcc -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk -Wno-unused-result \n-Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System\n/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Develop\ner/Library/Frameworks/Python3.framework/Versions/3.8/Headers -Werror=implicit-function-declaration -g -O2\n -I///Users/dima/software/sage/.tox/local-macports-standard/macports/include -Isage/cpython -Isage/libs/n\ntl -Isage/libs/arb -I/Users/dima/software/sage/.tox/local-macports-standard/local/lib/python3.8/site-pack\nages/cypari2 -Isage/libs/flint -I/Users/dima/software/sage/.tox/local-macports-standard/local/lib/python3\n.8/site-packages/cysignals -I/Users/dima/software/sage/src -I/Users/dima/software/sage/.tox/local-macport\ns-standard/local/lib/python3.8/site-packages/numpy/core/include -I/Applications/Xcode.app/Contents/Develo\nper/Library/Frameworks/Python3.framework/Versions/3.8/include/python3.8 -I/Users/dima/software/sage/.tox/\nlocal-macports-standard/local/include -I/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Pyt\nhon3.framework/Versions/3.8/include/python3.8 -c sage/rings/number_field/number_field_element_quadratic.c\npp -o build/temp.macosx-10.14-x86_64-cpython-38/sage/rings/number_field/number_field_element_quadratic.o \n-std=c++11\" failed with exit status 1\n    error: subprocess-exited-with-error\n    \n    \u00d7 python setup.py develop did not run successfully.\n    \u2502 exit code: 1\n    \u2570\u2500> See above for output.\n    \n    note: This error originates from a subprocess, and is likely not a problem with pip.\n    full command: /Users/dima/software/sage/.tox/local-macports-standard/local/bin/python3 -c '\n    exec(compile('\"'\"''\"'\"''\"'\"'\n    # This is <pip-setuptools-caller> -- a caller that pip uses to run setup.py\n    #\n    # - It imports setuptools before invoking setup.py, to enable projects that directly\n    #   import from `distutils.core` to work with newer packaging standards.\n    # - It provides a clear error message when setuptools is not installed.\n    # - It sets `sys.argv[0]` to the underlying `setup.py`, when invoking `setup.py` so\n    #   setuptools doesn'\"'\"'t think the script is `-c`. This avoids the following warning:\n    #     manifest_maker: standard file '\"'\"'-c'\"'\"' not found\".\n    # - It generates a shim setup.py, for handling setup.cfg-only projects.\n    import os, sys, tokenize\n    \n    try:\n        import setuptools\n    except ImportError as error:\n        print(\n            \"ERROR: Can not execute `setup.py` since setuptools is not available in \"\n            \"the build environment.\",\n            file=sys.stderr,\n        )\n        sys.exit(1)\n    \n    __file__ = %r\n    sys.argv[0] = __file__\n    \n    if os.path.exists(__file__):\n        filename = __file__\n        with tokenize.open(__file__) as f:\n            setup_py_code = f.read()\n    else:\n        filename = \"<auto-generated setuptools caller>\"\n        setup_py_code = \"from setuptools import setup; setup()\"\n    \n    exec(compile(setup_py_code, filename, \"exec\"))\n    '\"'\"''\"'\"''\"'\"' % ('\"'\"'/Users/dima/software/sage/src/setup.py'\"'\"',), \"<pip-setuptools-caller>\", \"exec\"))' --no-user-cfg develop --no-deps\n    cwd: /Users/dima/software/sage/src/\nerror: subprocess-exited-with-error\n\n\u00d7 python setup.py develop did not run successfully.\n\u2502 exit code: 1\n\u2570\u2500> See above for output.\n\nnote: This error originates from a subprocess, and is likely not a problem with pip.\n\n```",
    "created_at": "2022-08-29T20:09:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-626006",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>with the latest beta8 merged, I am getting a sagelib building error 

```
    error: Command "gcc -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk -Wno-unused-result 
-Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System
/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Develop
er/Library/Frameworks/Python3.framework/Versions/3.8/Headers -Werror=implicit-function-declaration -g -O2
 -I///Users/dima/software/sage/.tox/local-macports-standard/macports/include -Isage/cpython -Isage/libs/n
tl -Isage/libs/arb -I/Users/dima/software/sage/.tox/local-macports-standard/local/lib/python3.8/site-pack
ages/cypari2 -Isage/libs/flint -I/Users/dima/software/sage/.tox/local-macports-standard/local/lib/python3
.8/site-packages/cysignals -I/Users/dima/software/sage/src -I/Users/dima/software/sage/.tox/local-macport
s-standard/local/lib/python3.8/site-packages/numpy/core/include -I/Applications/Xcode.app/Contents/Develo
per/Library/Frameworks/Python3.framework/Versions/3.8/include/python3.8 -I/Users/dima/software/sage/.tox/
local-macports-standard/local/include -I/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Pyt
hon3.framework/Versions/3.8/include/python3.8 -c sage/rings/number_field/number_field_element_quadratic.c
pp -o build/temp.macosx-10.14-x86_64-cpython-38/sage/rings/number_field/number_field_element_quadratic.o 
-std=c++11" failed with exit status 1
    error: subprocess-exited-with-error
    
    × python setup.py develop did not run successfully.
    │ exit code: 1
    ╰─> See above for output.
    
    note: This error originates from a subprocess, and is likely not a problem with pip.
    full command: /Users/dima/software/sage/.tox/local-macports-standard/local/bin/python3 -c '
    exec(compile('"'"''"'"''"'"'
    # This is <pip-setuptools-caller> -- a caller that pip uses to run setup.py
    #
    # - It imports setuptools before invoking setup.py, to enable projects that directly
    #   import from `distutils.core` to work with newer packaging standards.
    # - It provides a clear error message when setuptools is not installed.
    # - It sets `sys.argv[0]` to the underlying `setup.py`, when invoking `setup.py` so
    #   setuptools doesn'"'"'t think the script is `-c`. This avoids the following warning:
    #     manifest_maker: standard file '"'"'-c'"'"' not found".
    # - It generates a shim setup.py, for handling setup.cfg-only projects.
    import os, sys, tokenize
    
    try:
        import setuptools
    except ImportError as error:
        print(
            "ERROR: Can not execute `setup.py` since setuptools is not available in "
            "the build environment.",
            file=sys.stderr,
        )
        sys.exit(1)
    
    __file__ = %r
    sys.argv[0] = __file__
    
    if os.path.exists(__file__):
        filename = __file__
        with tokenize.open(__file__) as f:
            setup_py_code = f.read()
    else:
        filename = "<auto-generated setuptools caller>"
        setup_py_code = "from setuptools import setup; setup()"
    
    exec(compile(setup_py_code, filename, "exec"))
    '"'"''"'"''"'"' % ('"'"'/Users/dima/software/sage/src/setup.py'"'"',), "<pip-setuptools-caller>", "exec"))' --no-user-cfg develop --no-deps
    cwd: /Users/dima/software/sage/src/
error: subprocess-exited-with-error

× python setup.py develop did not run successfully.
│ exit code: 1
╰─> See above for output.

note: This error originates from a subprocess, and is likely not a problem with pip.

```



---

archive/issue_comments_626007.json:
```json
{
    "body": "<a id='comment:3'></a>The actual g++ error message is missing in what you pasted here",
    "created_at": "2022-08-29T20:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-626007",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>The actual g++ error message is missing in what you pasted here



---

archive/issue_comments_626008.json:
```json
{
    "body": "<a id='comment:4'></a>right - I thought it's some kind of Python packaging error :-)\n\n```\n    INFO: compile options: '-I///Users/dima/software/sage/.tox/local-macports-standard/macports/include -\nIsage/cpython -Isage/libs/ntl -Isage/libs/arb -I/Users/dima/software/sage/.tox/local-macports-standard/lo\ncal/lib/python3.8/site-packages/cypari2 -Isage/libs/flint -I/Users/dima/software/sage/.tox/local-macports\n-standard/local/lib/python3.8/site-packages/cysignals -I/Users/dima/software/sage/src -I/Users/dima/softw\nare/sage/.tox/local-macports-standard/local/lib/python3.8/site-packages/numpy/core/include -I/Application\ns/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/include/python3.8 -I/Use\nrs/dima/software/sage/.tox/local-macports-standard/local/include -I/Applications/Xcode.app/Contents/Devel\noper/Library/Frameworks/Python3.framework/Versions/3.8/include/python3.8 -c'\n    extra options: '-std=c++11'\n    INFO: gcc: sage/rings/number_field/number_field_element_quadratic.cpp\n    In file included from sage/rings/number_field/number_field_element_quadratic.cpp:837:\n    In file included from sage/libs/flint/flint_wrap.h:42:\n    ///Users/dima/software/sage/.tox/local-macports-standard/macports/include/flint/fmpz_mod_poly.h:306:12: error: use of undeclared identifier '_fmpz_poly_deflation'; did you mean 'fmpz_mod_poly_deflation'?\n        return _fmpz_poly_deflation(input->coeffs, input->length);\n               ^~~~~~~~~~~~~~~~~~~~\n               fmpz_mod_poly_deflation\n    ///Users/dima/software/sage/.tox/local-macports-standard/macports/include/flint/fmpz_mod_poly.h:303:7: note: 'fmpz_mod_poly_deflation' declared here\n    ulong fmpz_mod_poly_deflation(const fmpz_mod_poly_t input,\n          ^\n    ///Users/dima/software/sage/.tox/local-macports-standard/macports/include/flint/fmpz_mod_poly.h:306:33: error: cannot initialize a parameter of type 'const fmpz_mod_poly_struct *' with an lvalue of type 'fmpz *const' (aka 'long *const')\n        return _fmpz_poly_deflation(input->coeffs, input->length);\n...\n```\n\nmacports comes with flint 2.9.0, so it seems there is some kind of  incompatibility with our 2.8.4.",
    "created_at": "2022-08-29T21:26:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-626008",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>right - I thought it's some kind of Python packaging error :-)

```
    INFO: compile options: '-I///Users/dima/software/sage/.tox/local-macports-standard/macports/include -
Isage/cpython -Isage/libs/ntl -Isage/libs/arb -I/Users/dima/software/sage/.tox/local-macports-standard/lo
cal/lib/python3.8/site-packages/cypari2 -Isage/libs/flint -I/Users/dima/software/sage/.tox/local-macports
-standard/local/lib/python3.8/site-packages/cysignals -I/Users/dima/software/sage/src -I/Users/dima/softw
are/sage/.tox/local-macports-standard/local/lib/python3.8/site-packages/numpy/core/include -I/Application
s/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/include/python3.8 -I/Use
rs/dima/software/sage/.tox/local-macports-standard/local/include -I/Applications/Xcode.app/Contents/Devel
oper/Library/Frameworks/Python3.framework/Versions/3.8/include/python3.8 -c'
    extra options: '-std=c++11'
    INFO: gcc: sage/rings/number_field/number_field_element_quadratic.cpp
    In file included from sage/rings/number_field/number_field_element_quadratic.cpp:837:
    In file included from sage/libs/flint/flint_wrap.h:42:
    ///Users/dima/software/sage/.tox/local-macports-standard/macports/include/flint/fmpz_mod_poly.h:306:12: error: use of undeclared identifier '_fmpz_poly_deflation'; did you mean 'fmpz_mod_poly_deflation'?
        return _fmpz_poly_deflation(input->coeffs, input->length);
               ^~~~~~~~~~~~~~~~~~~~
               fmpz_mod_poly_deflation
    ///Users/dima/software/sage/.tox/local-macports-standard/macports/include/flint/fmpz_mod_poly.h:303:7: note: 'fmpz_mod_poly_deflation' declared here
    ulong fmpz_mod_poly_deflation(const fmpz_mod_poly_t input,
          ^
    ///Users/dima/software/sage/.tox/local-macports-standard/macports/include/flint/fmpz_mod_poly.h:306:33: error: cannot initialize a parameter of type 'const fmpz_mod_poly_struct *' with an lvalue of type 'fmpz *const' (aka 'long *const')
        return _fmpz_poly_deflation(input->coeffs, input->length);
...
```

macports comes with flint 2.9.0, so it seems there is some kind of  incompatibility with our 2.8.4.



---

archive/issue_comments_626009.json:
```json
{
    "body": "<a id='comment:5'></a>The problem is that `-I///Users/dima/software/sage/.tox/local-macports-standard/macports/include` at the front of the command line. It's not supposed to be there",
    "created_at": "2022-08-29T21:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-626009",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>The problem is that `-I///Users/dima/software/sage/.tox/local-macports-standard/macports/include` at the front of the command line. It's not supposed to be there



---

archive/issue_comments_626010.json:
```json
{
    "body": "<a id='comment:166'></a>Replying to [comment:165 mkoeppe]:\n> The problem is that `-I///Users/dima/software/sage/.tox/local-macports-standard/macports/include` at the front of the command line. It's not supposed to be there\n\n\nthat's probably what `tox` is doing to create an isolated environment, no?",
    "created_at": "2022-08-29T21:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-626010",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:166'></a>Replying to [comment:165 mkoeppe]:
> The problem is that `-I///Users/dima/software/sage/.tox/local-macports-standard/macports/include` at the front of the command line. It's not supposed to be there


that's probably what `tox` is doing to create an isolated environment, no?



---

archive/issue_comments_626011.json:
```json
{
    "body": "<a id='comment:7'></a>No, this is the install location of macports within the tox environment. I set these variables:\n\n```\n+    local-macports:           MP_PREFIX={envdir}/macports\n+    local-macports:   PATH={env:MP_PREFIX}/bin:/usr/bin:/bin:/usr/sbin:/sbin\n+    local-macports:   CPATH={env:MP_PREFIX}/include\n+    local-macports:   LIBRARY_PATH={env:MP_PREFIX}/lib\n+    local-macports:   SETENV=eval $(build/bin/sage-print-system-package-command {env:SYSTEM} setup-build-env)\n```\nbut not `CFLAGS`.",
    "created_at": "2022-08-29T23:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-626011",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>No, this is the install location of macports within the tox environment. I set these variables:

```
+    local-macports:           MP_PREFIX={envdir}/macports
+    local-macports:   PATH={env:MP_PREFIX}/bin:/usr/bin:/bin:/usr/sbin:/sbin
+    local-macports:   CPATH={env:MP_PREFIX}/include
+    local-macports:   LIBRARY_PATH={env:MP_PREFIX}/lib
+    local-macports:   SETENV=eval $(build/bin/sage-print-system-package-command {env:SYSTEM} setup-build-env)
```
but not `CFLAGS`.



---

archive/issue_comments_626012.json:
```json
{
    "body": "<a id='comment:8'></a>Then it's done by macports, not by tox.",
    "created_at": "2022-08-29T23:26:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-626012",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>Then it's done by macports, not by tox.



---

archive/issue_comments_626013.json:
```json
{
    "body": "<a id='comment:9'></a>Could you check what the macports-installed `python3` gives when you ask it `python3 -m sysconfig`",
    "created_at": "2022-08-29T23:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-626013",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>Could you check what the macports-installed `python3` gives when you ask it `python3 -m sysconfig`



---

archive/issue_comments_626014.json:
```json
{
    "body": "<a id='comment:0'></a>there are 2 installations of python3.10 in .tox/local-macports-standard/:\n\n```\ndima@oucl13243 sage %  .tox/local-macports-standard/macports/bin/python3.10\nPython 3.10.6 (main, Aug 27 2022, 17:58:26) [Clang 13.1.6 (clang-1316.0.21.2.5)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> \ndima@oucl13243 sage %  .tox/local-macports-standard/bin/python3\nPython 3.10.6 (main, Aug 11 2022, 13:49:25) [Clang 13.1.6 (clang-1316.0.21.2.5)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n```\n\nThe latter is the only `python3` (without `.10`), though.",
    "created_at": "2022-08-30T07:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-626014",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:0'></a>there are 2 installations of python3.10 in .tox/local-macports-standard/:

```
dima@oucl13243 sage %  .tox/local-macports-standard/macports/bin/python3.10
Python 3.10.6 (main, Aug 27 2022, 17:58:26) [Clang 13.1.6 (clang-1316.0.21.2.5)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> 
dima@oucl13243 sage %  .tox/local-macports-standard/bin/python3
Python 3.10.6 (main, Aug 11 2022, 13:49:25) [Clang 13.1.6 (clang-1316.0.21.2.5)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
```

The latter is the only `python3` (without `.10`), though.



---

archive/issue_comments_626015.json:
```json
{
    "body": "Attachment [p1](tarball://root/attachments/some-uuid/ticket31505/p1) by @dimpase created at 2022-08-30 07:24:31\n\nsysconfig1",
    "created_at": "2022-08-30T07:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-626015",
    "user": "https://github.com/dimpase"
}
```

Attachment [p1](tarball://root/attachments/some-uuid/ticket31505/p1) by @dimpase created at 2022-08-30 07:24:31

sysconfig1



---

archive/issue_comments_626016.json:
```json
{
    "body": "sysconf2",
    "created_at": "2022-08-30T07:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-626016",
    "user": "https://github.com/dimpase"
}
```

sysconf2



---

archive/issue_comments_626017.json:
```json
{
    "body": "<a id='comment:1'></a>Attachment [p2](tarball://root/attachments/some-uuid/ticket31505/p2) by @dimpase created at 2022-08-30 07:27:43\n\nattached are their outputs when run with `-m sysconfig`.\n\n(there is also python2.7.18 - hopefully we have stopped all python2's used in our build by now...)",
    "created_at": "2022-08-30T07:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31505#issuecomment-626017",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>Attachment [p2](tarball://root/attachments/some-uuid/ticket31505/p2) by @dimpase created at 2022-08-30 07:27:43

attached are their outputs when run with `-m sysconfig`.

(there is also python2.7.18 - hopefully we have stopped all python2's used in our build by now...)



---

archive/issue_events_082768.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31505#event-82768"
}
```



---

archive/issue_events_082769.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31505",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31505#event-82769"
}
```
