# Issue 31536: Fix Sage rich output problems by coupling MathJax with html

archive/issues_031299.json:
```json
{
    "body": "CC:  @egourgoulhon\n\nThis ticket has grown from its initial motive and now solves multiple problems related with Sage rich output. In particular, it \n\n- fixes the blocker #31513\n- fixes the %matplotlib notebook magic, which is broken in a %display latex context in Sage 9.2\n- performs some code improvement regarding the handling of mathjax\n\nThe patch has been quite tested with Jupyter notebooks involving various types of Sage objects, Matplotlib objects and ipywidgets. \n\nThe initial motive, which is the root of the solutions, is\n\n---\nPresently mathjax is coupled with latex in Sage. The coupling causes dilemmas because latex is for printing and mathjax is for rendering math in html. We encounter such a dilemma in solving #11362, for example.\n\nThis ticket takes mathjax from `sage.misc.latex` and place it properly in `sage.misc.html`.\n\nThe command `view(obj)` is used to view the latex representation of an object.  This ticket aims to make  `show(obj)` and `pretty_print(obj)` show the html+mathjax representation of the object. The html+mathjax representation can be made from the latex representation or given by `_html_` method of the object.\n\nWhile we are at it, we also cleaned up old code written for deprecated sage notebook.\n\n\n\n\n\n\n\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/31536\n\n",
    "closed_at": "2021-04-01T19:45:20Z",
    "created_at": "2021-03-22T11:13:47Z",
    "labels": [
        "component: user interface",
        "blocker"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Fix Sage rich output problems by coupling MathJax with html",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31536",
    "user": "https://github.com/kwankyu"
}
```
CC:  @egourgoulhon

This ticket has grown from its initial motive and now solves multiple problems related with Sage rich output. In particular, it 

- fixes the blocker #31513
- fixes the %matplotlib notebook magic, which is broken in a %display latex context in Sage 9.2
- performs some code improvement regarding the handling of mathjax

The patch has been quite tested with Jupyter notebooks involving various types of Sage objects, Matplotlib objects and ipywidgets. 

The initial motive, which is the root of the solutions, is

---
Presently mathjax is coupled with latex in Sage. The coupling causes dilemmas because latex is for printing and mathjax is for rendering math in html. We encounter such a dilemma in solving #11362, for example.

This ticket takes mathjax from `sage.misc.latex` and place it properly in `sage.misc.html`.

The command `view(obj)` is used to view the latex representation of an object.  This ticket aims to make  `show(obj)` and `pretty_print(obj)` show the html+mathjax representation of the object. The html+mathjax representation can be made from the latex representation or given by `_html_` method of the object.

While we are at it, we also cleaned up old code written for deprecated sage notebook.










Issue created by migration from https://trac.sagemath.org/ticket/31536





---

archive/issue_comments_446926.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-23T15:23:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446926",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446927.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-03-23T15:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446927",
    "user": "https://github.com/kwankyu"
}
```

Changing status from new to needs_review.



---

archive/issue_events_082867.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31536#event-82867"
}
```



---

archive/issue_comments_446928.json:
```json
{
    "body": "Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446928",
    "user": "https://github.com/mkoeppe"
}
```

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_446929.json:
```json
{
    "body": "As expressed in https://groups.google.com/g/sage-devel/c/Q4kWXdMxC2Q/m/5PT5QRgvAwAJ, I think that the meaning of `%display latex` is clearer to the end user than `%display html`. The latter sounds quite strange while you are working on a notebook in a browser, the main purpose of which is to display html code. \n\nAt the very least, there should be a long deprecation period, when `%display latex` is still available. For instance, on https://sagemanifolds.obspm.fr/examples.html and on https://luth.obspm.fr/~luthier/gourgoulhon/bh16/sage.html, we have tons of notebooks that start with `%display latex`.",
    "created_at": "2021-03-24T12:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446929",
    "user": "https://github.com/egourgoulhon"
}
```

As expressed in https://groups.google.com/g/sage-devel/c/Q4kWXdMxC2Q/m/5PT5QRgvAwAJ, I think that the meaning of `%display latex` is clearer to the end user than `%display html`. The latter sounds quite strange while you are working on a notebook in a browser, the main purpose of which is to display html code. 

At the very least, there should be a long deprecation period, when `%display latex` is still available. For instance, on https://sagemanifolds.obspm.fr/examples.html and on https://luth.obspm.fr/~luthier/gourgoulhon/bh16/sage.html, we have tons of notebooks that start with `%display latex`.



---

archive/issue_comments_446930.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-03-24T12:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446930",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_446931.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-03-24T13:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446931",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_446932.json:
```json
{
    "body": "Replying to [comment:9 egourgoulhon]:\n> As expressed in https://groups.google.com/g/sage-devel/c/Q4kWXdMxC2Q/m/5PT5QRgvAwAJ, I think that the meaning of `%display latex` is clearer to the end user than `%display html`. The latter sounds quite strange while you are working on a notebook in a browser, the main purpose of which is to display html code. \n\n\nRight.\n\n> At the very least, there should be a long deprecation period, when `%display latex` is still available. For instance, on https://sagemanifolds.obspm.fr/examples.html and on https://luth.obspm.fr/~luthier/gourgoulhon/bh16/sage.html, we have tons of notebooks that start with `%display latex`. \n\n\nI agree. Though I had decided to follow the deprecation path, now I give up.\n\nI think we can make a compromise. We make the clear distinction between latex representation and html(+mathjax) representation internally or on code level but we keep `%display latex` for end users. \n\nI will commit a patch soon.",
    "created_at": "2021-03-24T13:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446932",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:9 egourgoulhon]:
> As expressed in https://groups.google.com/g/sage-devel/c/Q4kWXdMxC2Q/m/5PT5QRgvAwAJ, I think that the meaning of `%display latex` is clearer to the end user than `%display html`. The latter sounds quite strange while you are working on a notebook in a browser, the main purpose of which is to display html code. 


Right.

> At the very least, there should be a long deprecation period, when `%display latex` is still available. For instance, on https://sagemanifolds.obspm.fr/examples.html and on https://luth.obspm.fr/~luthier/gourgoulhon/bh16/sage.html, we have tons of notebooks that start with `%display latex`. 


I agree. Though I had decided to follow the deprecation path, now I give up.

I think we can make a compromise. We make the clear distinction between latex representation and html(+mathjax) representation internally or on code level but we keep `%display latex` for end users. 

I will commit a patch soon.



---

archive/issue_comments_446933.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-24T14:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446933",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446934.json:
```json
{
    "body": "Replying to [comment:12 klee]:\n> \n> I think we can make a compromise. We make the clear distinction between latex representation and html(+mathjax) representation internally or on code level but we keep `%display latex` for end users.\n\n\nSounds good! Thanks. :-)",
    "created_at": "2021-03-24T15:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446934",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:12 klee]:
> 
> I think we can make a compromise. We make the clear distinction between latex representation and html(+mathjax) representation internally or on code level but we keep `%display latex` for end users.


Sounds good! Thanks. :-)



---

archive/issue_comments_446935.json:
```json
{
    "body": "Does by any chance the code improvement in this ticket fix #31513 ?",
    "created_at": "2021-03-24T20:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446935",
    "user": "https://github.com/egourgoulhon"
}
```

Does by any chance the code improvement in this ticket fix #31513 ?



---

archive/issue_comments_446936.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-24T23:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446936",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446937.json:
```json
{
    "body": "I gave a try and it looks OK to me, except that the latex-typeset is broken in the pdf export from the Jupyter notebook. I guess fixing this should wait the resolution of #31513.",
    "created_at": "2021-03-26T17:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446937",
    "user": "https://github.com/egourgoulhon"
}
```

I gave a try and it looks OK to me, except that the latex-typeset is broken in the pdf export from the Jupyter notebook. I guess fixing this should wait the resolution of #31513.



---

archive/issue_comments_446938.json:
```json
{
    "body": "Replying to [comment:18 egourgoulhon]:\n> I gave a try and it looks OK to me, except that the latex-typeset is broken in the pdf export from the Jupyter notebook. I guess fixing this should wait the resolution of #31513. \n\n\nThanks! I agree.",
    "created_at": "2021-03-26T22:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446938",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:18 egourgoulhon]:
> I gave a try and it looks OK to me, except that the latex-typeset is broken in the pdf export from the Jupyter notebook. I guess fixing this should wait the resolution of #31513. 


Thanks! I agree.



---

archive/issue_comments_446939.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-27T02:09:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446939",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446940.json:
```json
{
    "body": "Thanks for the fix. There is still an issue for the pdf export of matrices. For instance, \n\n```\n%display latex\nmatrix([[1, x], [0, 0]])\n```\nproduces a typeset matrix in the Jupyter notebook, but not in its pdf export.",
    "created_at": "2021-03-27T10:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446940",
    "user": "https://github.com/egourgoulhon"
}
```

Thanks for the fix. There is still an issue for the pdf export of matrices. For instance, 

```
%display latex
matrix([[1, x], [0, 0]])
```
produces a typeset matrix in the Jupyter notebook, but not in its pdf export.



---

archive/issue_comments_446941.json:
```json
{
    "body": "Another issue is that `%matplotlib notebook` is broken by this ticket: the following cell of a Jupyter notebook:\n\n```\n%matplotlib notebook\nimport matplotlib.pyplot as plt\nplt.plot([1, 2, 3, 4])\nplt.ylabel('some numbers')\nplt.show()\n```\nyields\n\n```\n<IPython.core.display.HTML object>\n```\ninstead of the pyplot window.",
    "created_at": "2021-03-27T10:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446941",
    "user": "https://github.com/egourgoulhon"
}
```

Another issue is that `%matplotlib notebook` is broken by this ticket: the following cell of a Jupyter notebook:

```
%matplotlib notebook
import matplotlib.pyplot as plt
plt.plot([1, 2, 3, 4])
plt.ylabel('some numbers')
plt.show()
```
yields

```
<IPython.core.display.HTML object>
```
instead of the pyplot window.



---

archive/issue_comments_446942.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-27T11:13:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446942",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446943.json:
```json
{
    "body": "Replying to [comment:22 egourgoulhon]:\n> Another issue is that `%matplotlib notebook` is broken by this ticket: the following cell of a Jupyter notebook:\n> \n> ```\n> %matplotlib notebook\n> import matplotlib.pyplot as plt\n> plt.plot([1, 2, 3, 4])\n> plt.ylabel('some numbers')\n> plt.show()\n> ```\n> yields\n> \n> ```\n> <IPython.core.display.HTML object>\n> ```\n> instead of the pyplot window.\n\n\nAre you sure? I copy and pasted the same code into sage 9.1 and 9.2. They all fail.",
    "created_at": "2021-03-27T11:21:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446943",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:22 egourgoulhon]:
> Another issue is that `%matplotlib notebook` is broken by this ticket: the following cell of a Jupyter notebook:
> 
> ```
> %matplotlib notebook
> import matplotlib.pyplot as plt
> plt.plot([1, 2, 3, 4])
> plt.ylabel('some numbers')
> plt.show()
> ```
> yields
> 
> ```
> <IPython.core.display.HTML object>
> ```
> instead of the pyplot window.


Are you sure? I copy and pasted the same code into sage 9.1 and 9.2. They all fail.



---

archive/issue_comments_446944.json:
```json
{
    "body": "The same code also fails on sage 9.3.beta9 without this ticket.",
    "created_at": "2021-03-27T11:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446944",
    "user": "https://github.com/kwankyu"
}
```

The same code also fails on sage 9.3.beta9 without this ticket.



---

archive/issue_comments_446945.json:
```json
{
    "body": "Replying to [comment:25 klee]:\n> The same code also fails on sage 9.3.beta9 without this ticket.\n\n\nIt works for me, both with sage 9.2 and 9.3.rc0 (note that it does not work if `%display latex` is set first).",
    "created_at": "2021-03-27T12:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446945",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:25 klee]:
> The same code also fails on sage 9.3.beta9 without this ticket.


It works for me, both with sage 9.2 and 9.3.rc0 (note that it does not work if `%display latex` is set first).



---

archive/issue_comments_446946.json:
```json
{
    "body": "Replying to [comment:24 klee]:\n> Replying to [comment:22 egourgoulhon]:\n> > Another issue is that `%matplotlib notebook` is broken by this ticket: the following cell of a Jupyter notebook:\n> > \n> > ```\n> > %matplotlib notebook\n> > import matplotlib.pyplot as plt\n> > plt.plot([1, 2, 3, 4])\n> > plt.ylabel('some numbers')\n> > plt.show()\n> > ```\n> > yields\n> > \n> > ```\n> > <IPython.core.display.HTML object>\n> > ```\n> > instead of the pyplot window.\n\n> \n> Are you sure? I copy and pasted the same code into sage 9.1 and 9.2. They all fail. \n\n\nYes I am sure: it works for me for sage 9.1, 9.2 and 9.3.rc0. It is very convenient to have that pyplot window, because it allows to zoom and pan, contrary to Sage 2d plot outputs. Note that, as said in comment:26, it is broken by `%display latex` though. But\n\n```\n%display plain\n%matplotlib notebook\nimport matplotlib.pyplot as plt\nplt.plot([1, 2, 3, 4])\nplt.ylabel('some numbers')\nplt.show()\n``` \nworks all the time.",
    "created_at": "2021-03-27T12:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446946",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:24 klee]:
> Replying to [comment:22 egourgoulhon]:
> > Another issue is that `%matplotlib notebook` is broken by this ticket: the following cell of a Jupyter notebook:
> > 
> > ```
> > %matplotlib notebook
> > import matplotlib.pyplot as plt
> > plt.plot([1, 2, 3, 4])
> > plt.ylabel('some numbers')
> > plt.show()
> > ```
> > yields
> > 
> > ```
> > <IPython.core.display.HTML object>
> > ```
> > instead of the pyplot window.

> 
> Are you sure? I copy and pasted the same code into sage 9.1 and 9.2. They all fail. 


Yes I am sure: it works for me for sage 9.1, 9.2 and 9.3.rc0. It is very convenient to have that pyplot window, because it allows to zoom and pan, contrary to Sage 2d plot outputs. Note that, as said in comment:26, it is broken by `%display latex` though. But

```
%display plain
%matplotlib notebook
import matplotlib.pyplot as plt
plt.plot([1, 2, 3, 4])
plt.ylabel('some numbers')
plt.show()
``` 
works all the time.



---

archive/issue_comments_446947.json:
```json
{
    "body": "Attachment [Screen Shot 2021-03-28 at 7.54.12 AM.png](tarball://root/attachments/some-uuid/ticket31536/Screen Shot 2021-03-28 at 7.54.12 AM.png) by @kwankyu created at 2021-03-27 22:59:39\n\nReplying to [comment:27 egourgoulhon]:\n> I am sure: it works for me for sage 9.1, 9.2 and 9.3.rc0. It is very convenient to have that pyplot window, because it allows to zoom and pan, contrary to Sage 2d plot outputs. Note that, as said in comment:26, it is broken by `%display latex` though. But\n> \n> ```\n> %display plain\n> %matplotlib notebook\n> import matplotlib.pyplot as plt\n> plt.plot([1, 2, 3, 4])\n> plt.ylabel('some numbers')\n> plt.show()\n> ``` \n> works all the time.\n\n\nI cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.",
    "created_at": "2021-03-27T22:59:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446947",
    "user": "https://github.com/kwankyu"
}
```

Attachment [Screen Shot 2021-03-28 at 7.54.12 AM.png](tarball://root/attachments/some-uuid/ticket31536/Screen Shot 2021-03-28 at 7.54.12 AM.png) by @kwankyu created at 2021-03-27 22:59:39

Replying to [comment:27 egourgoulhon]:
> I am sure: it works for me for sage 9.1, 9.2 and 9.3.rc0. It is very convenient to have that pyplot window, because it allows to zoom and pan, contrary to Sage 2d plot outputs. Note that, as said in comment:26, it is broken by `%display latex` though. But
> 
> ```
> %display plain
> %matplotlib notebook
> import matplotlib.pyplot as plt
> plt.plot([1, 2, 3, 4])
> plt.ylabel('some numbers')
> plt.show()
> ``` 
> works all the time.


I cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.



---

archive/issue_comments_446948.json:
```json
{
    "body": "Anyway, I can observe that with `%display latex`, the failure is of different kind.",
    "created_at": "2021-03-27T23:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446948",
    "user": "https://github.com/kwankyu"
}
```

Anyway, I can observe that with `%display latex`, the failure is of different kind.



---

archive/issue_comments_446949.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-28T01:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446949",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446950.json:
```json
{
    "body": "Please check",
    "created_at": "2021-03-28T01:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446950",
    "user": "https://github.com/kwankyu"
}
```

Please check



---

archive/issue_comments_446951.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-28T07:04:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446951",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_082868.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2021-03-28T08:41:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31536#event-82868"
}
```



---

archive/issue_events_082869.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2021-03-28T08:41:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31536#event-82869"
}
```



---

archive/issue_comments_446952.json:
```json
{
    "body": "Replying to [comment:31 klee]:\n> Please check\n\n\nThanks for the new commits. I confirm that the issue with pdf export of matrices is fixed by them.  However, the issue with matplotlib remains: for the code of comment:27, I still get \n\n```\n<IPython.core.display.HTML object>\n```\ninstead of the pyplot window.",
    "created_at": "2021-03-28T11:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446952",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:31 klee]:
> Please check


Thanks for the new commits. I confirm that the issue with pdf export of matrices is fixed by them.  However, the issue with matplotlib remains: for the code of comment:27, I still get 

```
<IPython.core.display.HTML object>
```
instead of the pyplot window.



---

archive/issue_comments_446953.json:
```json
{
    "body": "Replying to [comment:28 klee]:\n> \n> I cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.\n\n\nNo, it does not work in CoCalc for me either (same error message as you). Given that CoCalc's Jupyter notebook is quite customized, I would say that it is a CoCalc issue, rather than a Sage one. Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1).",
    "created_at": "2021-03-28T13:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446953",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:28 klee]:
> 
> I cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.


No, it does not work in CoCalc for me either (same error message as you). Given that CoCalc's Jupyter notebook is quite customized, I would say that it is a CoCalc issue, rather than a Sage one. Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1).



---

archive/issue_comments_446954.json:
```json
{
    "body": "Replying to [comment:34 egourgoulhon]:\n> Replying to [comment:31 klee]:\n> > Please check\n\n> \n> Thanks for the new commits. I confirm that the issue with pdf export of matrices is fixed by them.  However, the issue with matplotlib remains: for the code of comment:27, I still get \n> \n> ```\n> <IPython.core.display.HTML object>\n> ```\n> instead of the pyplot window. \n\n\nFWIW, for `plt.show()`, the following happens in `SageDisplayFormatter.format`:\n\n```\n        # use IPython display for IPython native objects\n        if isinstance(obj, IPYTHON_NATIVE_TYPES):     <== this test is passed\n            if self.ipython_display_formatter(obj):   <== this test fails\n                return {}, {}                         \n```\nHence the `return {}, {}` is not performed.",
    "created_at": "2021-03-28T14:17:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446954",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:34 egourgoulhon]:
> Replying to [comment:31 klee]:
> > Please check

> 
> Thanks for the new commits. I confirm that the issue with pdf export of matrices is fixed by them.  However, the issue with matplotlib remains: for the code of comment:27, I still get 
> 
> ```
> <IPython.core.display.HTML object>
> ```
> instead of the pyplot window. 


FWIW, for `plt.show()`, the following happens in `SageDisplayFormatter.format`:

```
        # use IPython display for IPython native objects
        if isinstance(obj, IPYTHON_NATIVE_TYPES):     <== this test is passed
            if self.ipython_display_formatter(obj):   <== this test fails
                return {}, {}                         
```
Hence the `return {}, {}` is not performed.



---

archive/issue_comments_446955.json:
```json
{
    "body": "Replying to [comment:35 egourgoulhon]:\n> Replying to [comment:28 klee]:\n> > \n> > I cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.\n\n> \n> No, it does not work in CoCalc for me either (same error message as you). Given that CoCalc's Jupyter notebook is quite customized, I would say that it is a CoCalc issue, rather than a Sage one. Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1). \n\n\nNo. My system is MacOS 11.2.3 with Chrome 89.0.4389.90. \n\nI tried to install jupyter-matplotlib extension with jupyterlab 2 and jupyterlab 3. All did not work.\n\nBy the way, it works with Python 3 kernel in jupyterlab.",
    "created_at": "2021-03-29T04:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446955",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:35 egourgoulhon]:
> Replying to [comment:28 klee]:
> > 
> > I cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.

> 
> No, it does not work in CoCalc for me either (same error message as you). Given that CoCalc's Jupyter notebook is quite customized, I would say that it is a CoCalc issue, rather than a Sage one. Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1). 


No. My system is MacOS 11.2.3 with Chrome 89.0.4389.90. 

I tried to install jupyter-matplotlib extension with jupyterlab 2 and jupyterlab 3. All did not work.

By the way, it works with Python 3 kernel in jupyterlab.



---

archive/issue_comments_446956.json:
```json
{
    "body": "Replying to [comment:36 egourgoulhon]:\n> Replying to [comment:34 egourgoulhon]:\n> > Replying to [comment:31 klee]:\n> > > Please check\n\n> > \n> > Thanks for the new commits. I confirm that the issue with pdf export of matrices is fixed by them.  However, the issue with matplotlib remains: for the code of comment:27, I still get \n> > \n> > ```\n> > <IPython.core.display.HTML object>\n> > ```\n> > instead of the pyplot window. \n\n> \n> FWIW, for `plt.show()`, the following happens in `SageDisplayFormatter.format`:\n> \n> ```\n>         # use IPython display for IPython native objects\n>         if isinstance(obj, IPYTHON_NATIVE_TYPES):     <== this test is passed\n>             if self.ipython_display_formatter(obj):   <== this test fails\n>                 return {}, {}                         \n> ```\n> Hence the `return {}, {}` is not performed. \n> \n\n\n`self.ipython_display_formatter(obj)` is an ipython native method. which has nothing to do with sage `%display` magic. I don't understand why it fails with `%display latex` but it works with `%display plain`.",
    "created_at": "2021-03-29T04:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446956",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:36 egourgoulhon]:
> Replying to [comment:34 egourgoulhon]:
> > Replying to [comment:31 klee]:
> > > Please check

> > 
> > Thanks for the new commits. I confirm that the issue with pdf export of matrices is fixed by them.  However, the issue with matplotlib remains: for the code of comment:27, I still get 
> > 
> > ```
> > <IPython.core.display.HTML object>
> > ```
> > instead of the pyplot window. 

> 
> FWIW, for `plt.show()`, the following happens in `SageDisplayFormatter.format`:
> 
> ```
>         # use IPython display for IPython native objects
>         if isinstance(obj, IPYTHON_NATIVE_TYPES):     <== this test is passed
>             if self.ipython_display_formatter(obj):   <== this test fails
>                 return {}, {}                         
> ```
> Hence the `return {}, {}` is not performed. 
> 


`self.ipython_display_formatter(obj)` is an ipython native method. which has nothing to do with sage `%display` magic. I don't understand why it fails with `%display latex` but it works with `%display plain`.



---

archive/issue_comments_446957.json:
```json
{
    "body": "Replying to [comment:38 klee]:\n> Replying to [comment:36 egourgoulhon]:\n> > Replying to [comment:34 egourgoulhon]:\n> > > Replying to [comment:31 klee]:\n> > > > Please check\n\n> > > \n> > > Thanks for the new commits. I confirm that the issue with pdf export of matrices is fixed by them.  However, the issue with matplotlib remains: for the code of comment:27, I still get \n> > > \n> > > ```\n> > > <IPython.core.display.HTML object>\n> > > ```\n> > > instead of the pyplot window. \n\n> > \n> > FWIW, for `plt.show()`, the following happens in `SageDisplayFormatter.format`:\n> > \n> > ```\n> >         # use IPython display for IPython native objects\n> >         if isinstance(obj, IPYTHON_NATIVE_TYPES):     <== this test is passed\n> >             if self.ipython_display_formatter(obj):   <== this test fails\n> >                 return {}, {}                         \n> > ```\n> > Hence the `return {}, {}` is not performed. \n> > \n\n> \n> `self.ipython_display_formatter(obj)` is an ipython native method. which has nothing to do with sage `%display` magic. I don't understand why it fails with `%display latex` but it works with `%display plain`.\n> \n\nNo, it fails with `%display plain` as well. All subsequent tests in `SageDisplayFormatter.format` also fail, so at the end\n\n```\n        return ipy_format, ipy_metadata\n```\nis achieved. The same thing happens with Sage 9.3.rc0 (i.e. outside this ticket branch), but for some reason, the output `ipy_format, ipy_metadata` is better handled in that case, so that the pyplot window opens.",
    "created_at": "2021-03-29T07:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446957",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:38 klee]:
> Replying to [comment:36 egourgoulhon]:
> > Replying to [comment:34 egourgoulhon]:
> > > Replying to [comment:31 klee]:
> > > > Please check

> > > 
> > > Thanks for the new commits. I confirm that the issue with pdf export of matrices is fixed by them.  However, the issue with matplotlib remains: for the code of comment:27, I still get 
> > > 
> > > ```
> > > <IPython.core.display.HTML object>
> > > ```
> > > instead of the pyplot window. 

> > 
> > FWIW, for `plt.show()`, the following happens in `SageDisplayFormatter.format`:
> > 
> > ```
> >         # use IPython display for IPython native objects
> >         if isinstance(obj, IPYTHON_NATIVE_TYPES):     <== this test is passed
> >             if self.ipython_display_formatter(obj):   <== this test fails
> >                 return {}, {}                         
> > ```
> > Hence the `return {}, {}` is not performed. 
> > 

> 
> `self.ipython_display_formatter(obj)` is an ipython native method. which has nothing to do with sage `%display` magic. I don't understand why it fails with `%display latex` but it works with `%display plain`.
> 

No, it fails with `%display plain` as well. All subsequent tests in `SageDisplayFormatter.format` also fail, so at the end

```
        return ipy_format, ipy_metadata
```
is achieved. The same thing happens with Sage 9.3.rc0 (i.e. outside this ticket branch), but for some reason, the output `ipy_format, ipy_metadata` is better handled in that case, so that the pyplot window opens.



---

archive/issue_comments_446958.json:
```json
{
    "body": "Replying to [comment:39 egourgoulhon]:\n> Replying to [comment:38 klee]:\n> is achieved. The same thing happens with Sage 9.3.rc0 (i.e. outside this ticket branch), but for some reason, the output `ipy_format, ipy_metadata` is better handled in that case, so that the pyplot window opens. \n\n\nWhich do you mean, with the patch, or without the patch?",
    "created_at": "2021-03-29T07:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446958",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:39 egourgoulhon]:
> Replying to [comment:38 klee]:
> is achieved. The same thing happens with Sage 9.3.rc0 (i.e. outside this ticket branch), but for some reason, the output `ipy_format, ipy_metadata` is better handled in that case, so that the pyplot window opens. 


Which do you mean, with the patch, or without the patch?



---

archive/issue_comments_446959.json:
```json
{
    "body": "Replying to [comment:40 klee]:\n> Replying to [comment:39 egourgoulhon]:\n> > Replying to [comment:38 klee]:\n> > is achieved. The same thing happens with Sage 9.3.rc0 (i.e. outside this ticket branch), but for some reason, the output `ipy_format, ipy_metadata` is better handled in that case, so that the pyplot window opens. \n\n> \n> Which do you mean, with the patch, or without the patch?\n\n\nAh, you meant rc0, without the patch..",
    "created_at": "2021-03-29T07:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446959",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:40 klee]:
> Replying to [comment:39 egourgoulhon]:
> > Replying to [comment:38 klee]:
> > is achieved. The same thing happens with Sage 9.3.rc0 (i.e. outside this ticket branch), but for some reason, the output `ipy_format, ipy_metadata` is better handled in that case, so that the pyplot window opens. 

> 
> Which do you mean, with the patch, or without the patch?


Ah, you meant rc0, without the patch..



---

archive/issue_comments_446960.json:
```json
{
    "body": "Replying to [comment:41 klee]:\n> Replying to [comment:40 klee]:\n> > Replying to [comment:39 egourgoulhon]:\n> > > Replying to [comment:38 klee]:\n> > > is achieved. The same thing happens with Sage 9.3.rc0 (i.e. outside this ticket branch), but for some reason, the output `ipy_format, ipy_metadata` is better handled in that case, so that the pyplot window opens. \n\n> > \n> > Which do you mean, with the patch, or without the patch?\n\n> \n> Ah, you meant rc0, without the patch..\n\n\nYes (sorry for not having been clear).",
    "created_at": "2021-03-29T07:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446960",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:41 klee]:
> Replying to [comment:40 klee]:
> > Replying to [comment:39 egourgoulhon]:
> > > Replying to [comment:38 klee]:
> > > is achieved. The same thing happens with Sage 9.3.rc0 (i.e. outside this ticket branch), but for some reason, the output `ipy_format, ipy_metadata` is better handled in that case, so that the pyplot window opens. 

> > 
> > Which do you mean, with the patch, or without the patch?

> 
> Ah, you meant rc0, without the patch..


Yes (sorry for not having been clear).



---

archive/issue_comments_446961.json:
```json
{
    "body": "To summarize: for `plt.show()` in Sage 9.3.rc0, with or without the patch introduced in this ticket, `SageDisplayFormatter.format` terminates by `return ipy_format, ipy_metadata`, whatever the value of `%display`. Then the pyplot window opens correctly only without the patch and without `%display latex`.",
    "created_at": "2021-03-29T07:28:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446961",
    "user": "https://github.com/egourgoulhon"
}
```

To summarize: for `plt.show()` in Sage 9.3.rc0, with or without the patch introduced in this ticket, `SageDisplayFormatter.format` terminates by `return ipy_format, ipy_metadata`, whatever the value of `%display`. Then the pyplot window opens correctly only without the patch and without `%display latex`.



---

archive/issue_comments_446962.json:
```json
{
    "body": "Replying to [comment:37 klee]:\n> Replying to [comment:35 egourgoulhon]:\n> > Replying to [comment:28 klee]:\n> > > \n> > > I cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.\n\n> > \n> > No, it does not work in CoCalc for me either (same error message as you). Given that CoCalc's Jupyter notebook is quite customized, I would say that it is a CoCalc issue, rather than a Sage one. Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1). \n\n> \n> No. My system is MacOS 11.2.3 with Chrome 89.0.4389.90. \n> \n\n\nStrange... On my side, I haven't any special setting regarding matplotlib (it's the default version included in Sage). \n\nRegarding CoCalc, I've just got the answer from William: it works with Sage 9.2 kernel but you have to start a \"Jupyter classic server\" (in the \"New\" menu).",
    "created_at": "2021-03-29T07:44:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446962",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:37 klee]:
> Replying to [comment:35 egourgoulhon]:
> > Replying to [comment:28 klee]:
> > > 
> > > I cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.

> > 
> > No, it does not work in CoCalc for me either (same error message as you). Given that CoCalc's Jupyter notebook is quite customized, I would say that it is a CoCalc issue, rather than a Sage one. Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1). 

> 
> No. My system is MacOS 11.2.3 with Chrome 89.0.4389.90. 
> 


Strange... On my side, I haven't any special setting regarding matplotlib (it's the default version included in Sage). 

Regarding CoCalc, I've just got the answer from William: it works with Sage 9.2 kernel but you have to start a "Jupyter classic server" (in the "New" menu).



---

archive/issue_comments_446963.json:
```json
{
    "body": "Replying to [comment:44 egourgoulhon]:\n> Replying to [comment:37 klee]:\n> > Replying to [comment:35 egourgoulhon]:\n> > > Replying to [comment:28 klee]:\n> > > > \n> > > > I cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.\n\n> > > \n> > > No, it does not work in CoCalc for me either (same error message as you). Given that CoCalc's Jupyter notebook is quite customized, I would say that it is a CoCalc issue, rather than a Sage one. Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1). \n\n> > \n> > No. My system is MacOS 11.2.3 with Chrome 89.0.4389.90. \n> > \n  \n> \n> Strange... On my side, I haven't any special setting regarding matplotlib (it's the default version included in Sage). \n\n\nDoes it work without installing jupyter-matplotlib extension?\n\nI created a new Ubuntu vm, and installed a fresh sage from source, and installed jupyter-matplotlib from the jupyter extension manager. Even then it doesn't work and shows the same message `Javascript Error: IPython is not defined`. Now even with Python3 kernel.",
    "created_at": "2021-03-30T00:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446963",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:44 egourgoulhon]:
> Replying to [comment:37 klee]:
> > Replying to [comment:35 egourgoulhon]:
> > > Replying to [comment:28 klee]:
> > > > 
> > > > I cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.

> > > 
> > > No, it does not work in CoCalc for me either (same error message as you). Given that CoCalc's Jupyter notebook is quite customized, I would say that it is a CoCalc issue, rather than a Sage one. Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1). 

> > 
> > No. My system is MacOS 11.2.3 with Chrome 89.0.4389.90. 
> > 
  
> 
> Strange... On my side, I haven't any special setting regarding matplotlib (it's the default version included in Sage). 


Does it work without installing jupyter-matplotlib extension?

I created a new Ubuntu vm, and installed a fresh sage from source, and installed jupyter-matplotlib from the jupyter extension manager. Even then it doesn't work and shows the same message `Javascript Error: IPython is not defined`. Now even with Python3 kernel.



---

archive/issue_comments_446964.json:
```json
{
    "body": "Replying to [comment:44 egourgoulhon]:\n> Replying to [comment:37 klee]:\n> \n> Strange... On my side, I haven't any special setting regarding matplotlib (it's the default version included in Sage). \n> \n> Regarding CoCalc, I've just got the answer from William: it works with Sage 9.2 kernel but you have to start a \"Jupyter classic server\" (in the \"New\" menu). \n\n\nOk. I finally made it work with the Jupyter classic server. Let me now go back to the ticket.",
    "created_at": "2021-03-30T01:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446964",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:44 egourgoulhon]:
> Replying to [comment:37 klee]:
> 
> Strange... On my side, I haven't any special setting regarding matplotlib (it's the default version included in Sage). 
> 
> Regarding CoCalc, I've just got the answer from William: it works with Sage 9.2 kernel but you have to start a "Jupyter classic server" (in the "New" menu). 


Ok. I finally made it work with the Jupyter classic server. Let me now go back to the ticket.



---

archive/issue_comments_446965.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-30T04:30:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446965",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446966.json:
```json
{
    "body": "I made a rather drastic change, removing `default_mime()` method, which I don't understand clearly. Instead I rely on the ipython class `DisplayObject` to filter out ipython native objects. \n\nIt works well with the examples up to now. But I think it is necessary to test extensively in fear of any bad regressions.",
    "created_at": "2021-03-30T04:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446966",
    "user": "https://github.com/kwankyu"
}
```

I made a rather drastic change, removing `default_mime()` method, which I don't understand clearly. Instead I rely on the ipython class `DisplayObject` to filter out ipython native objects. 

It works well with the examples up to now. But I think it is necessary to test extensively in fear of any bad regressions.



---

archive/issue_comments_446967.json:
```json
{
    "body": "Replying to [comment:48 klee]:\n> I made a rather drastic change, removing `default_mime()` method, which I don't understand clearly. Instead I rely on the ipython class `DisplayObject` to filter out ipython native objects. \n> \n> It works well with the examples up to now. But I think it is necessary to test extensively in fear of any bad regressions.\n\n\nThanks for the new code. The pyplot window is now correctly handled. Unfortunately, two new issues have appeared: \n\n1/ Outside the context `%matplotlib notebook`, there is no graphical display of `plt.show()`: the output of the Jupyter cell\n\n```\nimport matplotlib.pyplot as plt\nplt.plot([1, 2, 3, 4])\nplt.ylabel('some numbers')\nplt.show()\n```\nis\n\n```\n<Figure size 432x288 with 1 Axes>\n```\ninstead of a png figure displayed by the notebook.\n\n2/ The native IPython rich output method `_repr_latex_` is broken:\n\n```\nclass A(SageObject):\n\n    def __init__(self, data):\n        self._data = data\n\n    def _repr_latex_(self):\n        try:\n            return '$' + self._data._latex_() + '$'\n        except (AttributeError, NotImplementedError):  \n            return None  # if None is returned, plain text is used\n\nA(sin(x^2))\n```\nresults in \n\n```\n<__main__.A object at 0x7f0566d4a940>\n```\ninstead of the latex-typeset formula.\n\nThese two issues were not present in the previous version of the patch, nor in plain Sage 9.3.rc0.",
    "created_at": "2021-03-30T08:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446967",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:48 klee]:
> I made a rather drastic change, removing `default_mime()` method, which I don't understand clearly. Instead I rely on the ipython class `DisplayObject` to filter out ipython native objects. 
> 
> It works well with the examples up to now. But I think it is necessary to test extensively in fear of any bad regressions.


Thanks for the new code. The pyplot window is now correctly handled. Unfortunately, two new issues have appeared: 

1/ Outside the context `%matplotlib notebook`, there is no graphical display of `plt.show()`: the output of the Jupyter cell

```
import matplotlib.pyplot as plt
plt.plot([1, 2, 3, 4])
plt.ylabel('some numbers')
plt.show()
```
is

```
<Figure size 432x288 with 1 Axes>
```
instead of a png figure displayed by the notebook.

2/ The native IPython rich output method `_repr_latex_` is broken:

```
class A(SageObject):

    def __init__(self, data):
        self._data = data

    def _repr_latex_(self):
        try:
            return '$' + self._data._latex_() + '$'
        except (AttributeError, NotImplementedError):  
            return None  # if None is returned, plain text is used

A(sin(x^2))
```
results in 

```
<__main__.A object at 0x7f0566d4a940>
```
instead of the latex-typeset formula.

These two issues were not present in the previous version of the patch, nor in plain Sage 9.3.rc0.



---

archive/issue_comments_446968.json:
```json
{
    "body": "Replying to [comment:45 klee]:\n> Replying to [comment:44 egourgoulhon]:\n> > Replying to [comment:37 klee]:\n> > > Replying to [comment:35 egourgoulhon]:\n> > > > Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1). \n\n> > > \n> > > No. My system is MacOS 11.2.3 with Chrome 89.0.4389.90. \n> > > \n  \n> > \n> > Strange... On my side, I haven't any special setting regarding matplotlib (it's the default version included in Sage). \n  \n> \n> Does it work without installing jupyter-matplotlib extension?\n> \n\nYes, since I don't have installed such an extension: the content of `local/share/jupyter/nbextensions` under my Sage root is \n\n```\njsmol  jupyter_jsmol  jupyter-js-widgets  mathjax  threejs\n```",
    "created_at": "2021-03-30T09:15:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446968",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:45 klee]:
> Replying to [comment:44 egourgoulhon]:
> > Replying to [comment:37 klee]:
> > > Replying to [comment:35 egourgoulhon]:
> > > > Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1). 

> > > 
> > > No. My system is MacOS 11.2.3 with Chrome 89.0.4389.90. 
> > > 
  
> > 
> > Strange... On my side, I haven't any special setting regarding matplotlib (it's the default version included in Sage). 
  
> 
> Does it work without installing jupyter-matplotlib extension?
> 

Yes, since I don't have installed such an extension: the content of `local/share/jupyter/nbextensions` under my Sage root is 

```
jsmol  jupyter_jsmol  jupyter-js-widgets  mathjax  threejs
```



---

archive/issue_comments_446969.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-30T09:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446969",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446970.json:
```json
{
    "body": "The commit fixes 1/ and 2/ with me. Check yours.\n\nRegardless of the patch, the matplotlib interactive display is unstable (visible or invisible randomly) on my installation. Strange...",
    "created_at": "2021-03-30T09:44:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446970",
    "user": "https://github.com/kwankyu"
}
```

The commit fixes 1/ and 2/ with me. Check yours.

Regardless of the patch, the matplotlib interactive display is unstable (visible or invisible randomly) on my installation. Strange...



---

archive/issue_comments_446971.json:
```json
{
    "body": "Replying to [comment:54 klee]:\n> The commit fixes 1/ and 2/ with me. Check yours.\n> \n\n\nThanks. I confirm that both 1/ and 2/ are fixed. Moreover, the new commit also fixes `%matplotlib notebook` in a `%display latex` context, which did not work with Sage 9.2 and 9.3.rc0 ! I've also checked that the pdf export of a Jupyter notebook works nicely. So I would say that everything is green from my side. Let us wait for the pachbot and other reviewers, if any.\n\n> Regardless of the patch, the matplotlib interactive display is unstable (visible or invisible randomly) on my installation. Strange...\n\n\nNote that there cannot be two interactive pyplot windows in two distinct cells of a given Jupyter notebook; if you open a new window via `plt.show()` in a new cell, the first one becomes blank (in the same cell, it is OK). This might explain what you observe.",
    "created_at": "2021-03-30T10:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446971",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:54 klee]:
> The commit fixes 1/ and 2/ with me. Check yours.
> 


Thanks. I confirm that both 1/ and 2/ are fixed. Moreover, the new commit also fixes `%matplotlib notebook` in a `%display latex` context, which did not work with Sage 9.2 and 9.3.rc0 ! I've also checked that the pdf export of a Jupyter notebook works nicely. So I would say that everything is green from my side. Let us wait for the pachbot and other reviewers, if any.

> Regardless of the patch, the matplotlib interactive display is unstable (visible or invisible randomly) on my installation. Strange...


Note that there cannot be two interactive pyplot windows in two distinct cells of a given Jupyter notebook; if you open a new window via `plt.show()` in a new cell, the first one becomes blank (in the same cell, it is OK). This might explain what you observe.



---

archive/issue_comments_446972.json:
```json
{
    "body": "If everything is OK with this ticket, I propose that it becomes the fix for the blocker #31513.",
    "created_at": "2021-03-30T10:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446972",
    "user": "https://github.com/egourgoulhon"
}
```

If everything is OK with this ticket, I propose that it becomes the fix for the blocker #31513.



---

archive/issue_comments_446973.json:
```json
{
    "body": "Replying to [comment:55 egourgoulhon]:\n> Replying to [comment:54 klee]:\n> > Regardless of the patch, the matplotlib interactive display is unstable (visible or invisible randomly) on my installation. Strange...\n\n> \n> Note that there cannot be two interactive pyplot windows in two distinct cells of a given Jupyter notebook; if you open a new window via `plt.show()` in a new cell, the first one becomes blank (in the same cell, it is OK). This might explain what you observe. \n\n\nI see. Thanks.",
    "created_at": "2021-03-30T11:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446973",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:55 egourgoulhon]:
> Replying to [comment:54 klee]:
> > Regardless of the patch, the matplotlib interactive display is unstable (visible or invisible randomly) on my installation. Strange...

> 
> Note that there cannot be two interactive pyplot windows in two distinct cells of a given Jupyter notebook; if you open a new window via `plt.show()` in a new cell, the first one becomes blank (in the same cell, it is OK). This might explain what you observe. 


I see. Thanks.



---

archive/issue_comments_446974.json:
```json
{
    "body": "I think the python3 error reported by the patchbot is a false positive, triggered by the presence of `<>` in the string, so we can disregard it. Can you comment on the pyflake errors?",
    "created_at": "2021-03-30T15:56:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446974",
    "user": "https://github.com/egourgoulhon"
}
```

I think the python3 error reported by the patchbot is a false positive, triggered by the presence of `<>` in the string, so we can disregard it. Can you comment on the pyflake errors?



---

archive/issue_comments_446975.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-30T22:53:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446975",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446976.json:
```json
{
    "body": "Replying to [comment:58 egourgoulhon]:\n> I think the python3 error reported by the patchbot is a false positive, triggered by the presence of `<>` in the string, so we can disregard it. Can you comment on the pyflake errors?\n\n\nI fixed some pyflakes errors, which are safe to fix. Anyway none of them are new.",
    "created_at": "2021-03-30T22:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446976",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:58 egourgoulhon]:
> I think the python3 error reported by the patchbot is a false positive, triggered by the presence of `<>` in the string, so we can disregard it. Can you comment on the pyflake errors?


I fixed some pyflakes errors, which are safe to fix. Anyway none of them are new.



---

archive/issue_comments_446977.json:
```json
{
    "body": "Replying to [comment:60 klee]:\n> \n> I fixed some pyflakes errors, which are safe to fix. \n\n\nThanks!\n\n>Anyway none of them are new.\n\n\nIndeed. Thanks for having taken this opportunity to fix them.",
    "created_at": "2021-03-31T07:29:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446977",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:60 klee]:
> 
> I fixed some pyflakes errors, which are safe to fix. 


Thanks!

>Anyway none of them are new.


Indeed. Thanks for having taken this opportunity to fix them.



---

archive/issue_comments_446978.json:
```json
{
    "body": "It's time to move on, if we want this in Sage 9.3. Thanks for all your work on this ticket!",
    "created_at": "2021-03-31T07:31:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446978",
    "user": "https://github.com/egourgoulhon"
}
```

It's time to move on, if we want this in Sage 9.3. Thanks for all your work on this ticket!



---

archive/issue_comments_446979.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-03-31T07:31:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446979",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_446980.json:
```json
{
    "body": "Thank you for a careful review. Hope this sail on peacefully.",
    "created_at": "2021-03-31T08:05:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446980",
    "user": "https://github.com/kwankyu"
}
```

Thank you for a careful review. Hope this sail on peacefully.



---

archive/issue_comments_446981.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2021-03-31T15:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446981",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_446982.json:
```json
{
    "body": "It would probably be good to revise the ticket summary/description based on https://groups.google.com/g/sage-release/c/fXpbYwaqt9o/m/xYOwhU26CAAJ",
    "created_at": "2021-03-31T16:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446982",
    "user": "https://github.com/mkoeppe"
}
```

It would probably be good to revise the ticket summary/description based on https://groups.google.com/g/sage-release/c/fXpbYwaqt9o/m/xYOwhU26CAAJ



---

archive/issue_comments_446983.json:
```json
{
    "body": "Replying to [comment:48 klee]:\n> I made a rather drastic change, removing `default_mime()` method, which I don't understand clearly. Instead I rely on the ipython class `DisplayObject` to filter out ipython native objects. \n> \n> It works well with the examples up to now. But I think it is necessary to test extensively in fear of any bad regressions.\n\n\nBecause of your last paragraph, I think this can't be a blocker for 9.3: it should be one of the first tickets merged in 9.4 instead.",
    "created_at": "2021-03-31T17:24:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446983",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:48 klee]:
> I made a rather drastic change, removing `default_mime()` method, which I don't understand clearly. Instead I rely on the ipython class `DisplayObject` to filter out ipython native objects. 
> 
> It works well with the examples up to now. But I think it is necessary to test extensively in fear of any bad regressions.


Because of your last paragraph, I think this can't be a blocker for 9.3: it should be one of the first tickets merged in 9.4 instead.



---

archive/issue_comments_446984.json:
```json
{
    "body": "Replying to [comment:66 jhpalmieri]:\n> \n> Because of your last paragraph, I think this can't be a blocker for 9.3: it should be one of the first tickets merged in 9.4 instead.\n\n\nWell, since this paragraph was written, much more tests have been performed. For instance, the patch has been successfully run on [this notebook](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_black_hole_rendering.ipynb), which mixes latex display, Sage 2d and 3d plots, pure Matplotlib plots via pyplot, PIL images and ipywidgets (progress bars).",
    "created_at": "2021-03-31T20:49:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446984",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:66 jhpalmieri]:
> 
> Because of your last paragraph, I think this can't be a blocker for 9.3: it should be one of the first tickets merged in 9.4 instead.


Well, since this paragraph was written, much more tests have been performed. For instance, the patch has been successfully run on [this notebook](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_black_hole_rendering.ipynb), which mixes latex display, Sage 2d and 3d plots, pure Matplotlib plots via pyplot, PIL images and ipywidgets (progress bars).



---

archive/issue_comments_446985.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-04-01T19:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31536#issuecomment-446985",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_082870.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-04-01T19:45:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31536",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31536#event-82870"
}
```
