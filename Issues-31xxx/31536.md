# Issue 31536: Fix Sage rich output problems by coupling MathJax with html

archive/issues_031299.json:
```json
{
    "assignees": [],
    "body": "This ticket has grown from its initial motive and now solves multiple problems related with Sage rich output. In particular, it \n\n- fixes the blocker #31513\n- fixes the %matplotlib notebook magic, which is broken in a %display latex context in Sage 9.2\n- performs some code improvement regarding the handling of mathjax\n\nThe patch has been quite tested with Jupyter notebooks involving various types of Sage objects, Matplotlib objects and ipywidgets. \n\nThe initial motive, which is the root of the solutions, is\n\n---\nPresently mathjax is coupled with latex in Sage. The coupling causes dilemmas because latex is for printing and mathjax is for rendering math in html. We encounter such a dilemma in solving #11362, for example.\n\nThis ticket takes mathjax from `sage.misc.latex` and place it properly in `sage.misc.html`.\n\nThe command `view(obj)` is used to view the latex representation of an object.  This ticket aims to make  `show(obj)` and `pretty_print(obj)` show the html+mathjax representation of the object. The html+mathjax representation can be made from the latex representation or given by `_html_` method of the object.\n\nWhile we are at it, we also cleaned up old code written for deprecated sage notebook.\n\n\n\n\n\n\n\n\n\n\n**CC:**  @egourgoulhon\n\n**Branch/Commit:** [4c29b9603fe6f4fcc229f9130c7ea5ccc8f3519b](https://github.com/sagemath/sagetrac-mirror/commit/4c29b9603fe6f4fcc229f9130c7ea5ccc8f3519b)\n\n**Reviewer:** Eric Gourgoulhon\n\n**Author:** Kwankyu Lee\n\nIssue created by migration from https://trac.sagemath.org/ticket/31536\n\n",
    "closed_at": "2021-04-01T19:45:20Z",
    "created_at": "2021-03-22T11:13:47Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20user%20interface",
        "https://github.com/sagemath/sage/labels/blocker",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix Sage rich output problems by coupling MathJax with html",
    "type": "issue",
    "updated_at": "2021-04-01T19:45:20Z",
    "url": "https://github.com/sagemath/sage/issues/31536",
    "user": "https://github.com/kwankyu"
}
```
This ticket has grown from its initial motive and now solves multiple problems related with Sage rich output. In particular, it 

- fixes the blocker #31513
- fixes the %matplotlib notebook magic, which is broken in a %display latex context in Sage 9.2
- performs some code improvement regarding the handling of mathjax

The patch has been quite tested with Jupyter notebooks involving various types of Sage objects, Matplotlib objects and ipywidgets. 

The initial motive, which is the root of the solutions, is

---
Presently mathjax is coupled with latex in Sage. The coupling causes dilemmas because latex is for printing and mathjax is for rendering math in html. We encounter such a dilemma in solving #11362, for example.

This ticket takes mathjax from `sage.misc.latex` and place it properly in `sage.misc.html`.

The command `view(obj)` is used to view the latex representation of an object.  This ticket aims to make  `show(obj)` and `pretty_print(obj)` show the html+mathjax representation of the object. The html+mathjax representation can be made from the latex representation or given by `_html_` method of the object.

While we are at it, we also cleaned up old code written for deprecated sage notebook.










**CC:**  @egourgoulhon

**Branch/Commit:** [4c29b9603fe6f4fcc229f9130c7ea5ccc8f3519b](https://github.com/sagemath/sagetrac-mirror/commit/4c29b9603fe6f4fcc229f9130c7ea5ccc8f3519b)

**Reviewer:** Eric Gourgoulhon

**Author:** Kwankyu Lee

Issue created by migration from https://trac.sagemath.org/ticket/31536





---

archive/issue_events_382569.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2021-03-22T11:13:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31536#event-382569"
}
```



---

archive/issue_events_382570.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2021-03-22T11:13:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20user%20interface",
    "label_color": "08517b",
    "label_name": "component: user interface",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31536#event-382570"
}
```



---

archive/issue_events_382571.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2021-03-22T11:13:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31536#event-382571"
}
```



---

archive/issue_events_382572.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2021-03-22T14:21:24Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "rename": {
        "from": "Move MathJax from latex to html",
        "to": "Divorce MathJax from latex and marry it with html"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31536#event-382572"
}
```



---

archive/issue_events_382573.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2021-03-22T14:30:28Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "rename": {
        "from": "Divorce MathJax from latex and marry it with html",
        "to": "Divorce MathJax from latex and let it marry html"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31536#event-382573"
}
```



---

archive/issue_comments_509445.json:
```json
{
    "body": "**Author:** Kwankyu Lee",
    "created_at": "2021-03-23T15:22:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509445",
    "user": "https://github.com/kwankyu"
}
```

**Author:** Kwankyu Lee



---

archive/issue_comments_509446.json:
```json
{
    "body": "**Branch:** [u/klee/31536](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/31536)",
    "created_at": "2021-03-23T15:22:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509446",
    "user": "https://github.com/kwankyu"
}
```

**Branch:** [u/klee/31536](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/31536)



---

archive/issue_comments_509447.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,16 @@\n+There is a confusion about mathjax in sage. A root of the confusion is that mathjax is coupled with latex in the module `sage.misc.latex`. The coupling causes dilemmas because latex is for printing and mathjax is for rendering math in html. We encounter such a dilemma in solving #11362, for example.\n \n+This ticket aims first to decouple mathjax from latex and place it properly in `sage.misc.html`.\n+\n+In a frontend of sage, latex is used for `view(...)` and html (with a subset of latex rendered by mathjax) is used for `show(...)` and `pretty_print(...)`. Hence the textual rich output in jupyter notebook should be `OutputHtml` not `OutputLatex`. Currently it is `OutputLatex`, which actually contains html!\n+\n+This ticket aims secondly to make `OutputHtml` the default rich output for sage objects in jupyter notebook.\n+\n+Then html display for sage objects should be turned on by `%display html` magic not by the current `%display latex` magic.\n+\n+This ticket aims to replace `%display latex` by `%display html`. \n+\n+If `%display latex` is implemented properly, it should output sage objects like `view(...)`. This is not done in this ticket.\n+\n+\n+\n``````\n",
    "created_at": "2021-03-23T15:22:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509447",
    "user": "https://github.com/kwankyu"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,16 @@
+There is a confusion about mathjax in sage. A root of the confusion is that mathjax is coupled with latex in the module `sage.misc.latex`. The coupling causes dilemmas because latex is for printing and mathjax is for rendering math in html. We encounter such a dilemma in solving #11362, for example.
 
+This ticket aims first to decouple mathjax from latex and place it properly in `sage.misc.html`.
+
+In a frontend of sage, latex is used for `view(...)` and html (with a subset of latex rendered by mathjax) is used for `show(...)` and `pretty_print(...)`. Hence the textual rich output in jupyter notebook should be `OutputHtml` not `OutputLatex`. Currently it is `OutputLatex`, which actually contains html!
+
+This ticket aims secondly to make `OutputHtml` the default rich output for sage objects in jupyter notebook.
+
+Then html display for sage objects should be turned on by `%display html` magic not by the current `%display latex` magic.
+
+This ticket aims to replace `%display latex` by `%display html`. 
+
+If `%display latex` is implemented properly, it should output sage objects like `view(...)`. This is not done in this ticket.
+
+
+
``````




---

archive/issue_comments_509448.json:
```json
{
    "body": "**Commit:** [27c2acbe5ef922ecacb93266225bde2da0c8180d](https://github.com/sagemath/sagetrac-mirror/commit/27c2acbe5ef922ecacb93266225bde2da0c8180d)",
    "created_at": "2021-03-23T15:23:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509448",
    "user": "https://github.com/sagetrac-git"
}
```

**Commit:** [27c2acbe5ef922ecacb93266225bde2da0c8180d](https://github.com/sagemath/sagetrac-mirror/commit/27c2acbe5ef922ecacb93266225bde2da0c8180d)



---

archive/issue_comments_509449.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27c2acbe5ef922ecacb93266225bde2da0c8180d\">27c2acb</a></td><td><code>Divorce mathjax from latex but let it marry html</code></td></tr></table>\n",
    "created_at": "2021-03-23T15:23:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509449",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27c2acbe5ef922ecacb93266225bde2da0c8180d">27c2acb</a></td><td><code>Divorce mathjax from latex but let it marry html</code></td></tr></table>




---

archive/issue_events_382574.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2021-03-23T15:23:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31536#event-382574"
}
```



---

archive/issue_events_382575.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31536#event-382575"
}
```



---

archive/issue_events_382576.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31536#event-382576"
}
```



---

archive/issue_comments_509450.json:
```json
{
    "body": "<a id='comment:7'></a>\nSage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509450",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_509451.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,16 +1,22 @@\n-There is a confusion about mathjax in sage. A root of the confusion is that mathjax is coupled with latex in the module `sage.misc.latex`. The coupling causes dilemmas because latex is for printing and mathjax is for rendering math in html. We encounter such a dilemma in solving #11362, for example.\n+Presently mathjax is coupled with latex in Sage. The coupling causes dilemmas because latex is for printing and mathjax is for rendering math in html. We encounter such a dilemma in solving #11362, for example.\n \n-This ticket aims first to decouple mathjax from latex and place it properly in `sage.misc.html`.\n+This ticket takes mathjax from `sage.misc.latex` and place it properly in `sage.misc.html`.\n \n-In a frontend of sage, latex is used for `view(...)` and html (with a subset of latex rendered by mathjax) is used for `show(...)` and `pretty_print(...)`. Hence the textual rich output in jupyter notebook should be `OutputHtml` not `OutputLatex`. Currently it is `OutputLatex`, which actually contains html!\n+The command `view(obj)` is used to view the latex representation of an object.  \n \n-This ticket aims secondly to make `OutputHtml` the default rich output for sage objects in jupyter notebook.\n+This ticket aims to make  `show(obj)` and `pretty_print(obj)` show the html+mathjax representation of the object. The html+mathjax representation can be made from the latex representation or given by `_html_` method of the object.\n \n-Then html display for sage objects should be turned on by `%display html` magic not by the current `%display latex` magic.\n+This ticket makes `%display html` magic turn on displaying html+mathjax representations. \n \n-This ticket aims to replace `%display latex` by `%display html`. \n+Presently `%display latex` magic turns on displaying mathjax representations. The `%display latex` should properly turn on displaying latex representations like `view(obj`. But this is not done in this ticket. For now `%display latex` is made an alias of `%display html` for backward compatibility.\n \n-If `%display latex` is implemented properly, it should output sage objects like `view(...)`. This is not done in this ticket.\n+While we are at it, we also clean up old code written for deprecated sage notebook.\n \n \n \n+\n+\n+\n+\n+\n+\n``````\n",
    "created_at": "2021-03-24T11:56:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509451",
    "user": "https://github.com/kwankyu"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,16 +1,22 @@
-There is a confusion about mathjax in sage. A root of the confusion is that mathjax is coupled with latex in the module `sage.misc.latex`. The coupling causes dilemmas because latex is for printing and mathjax is for rendering math in html. We encounter such a dilemma in solving #11362, for example.
+Presently mathjax is coupled with latex in Sage. The coupling causes dilemmas because latex is for printing and mathjax is for rendering math in html. We encounter such a dilemma in solving #11362, for example.
 
-This ticket aims first to decouple mathjax from latex and place it properly in `sage.misc.html`.
+This ticket takes mathjax from `sage.misc.latex` and place it properly in `sage.misc.html`.
 
-In a frontend of sage, latex is used for `view(...)` and html (with a subset of latex rendered by mathjax) is used for `show(...)` and `pretty_print(...)`. Hence the textual rich output in jupyter notebook should be `OutputHtml` not `OutputLatex`. Currently it is `OutputLatex`, which actually contains html!
+The command `view(obj)` is used to view the latex representation of an object.  
 
-This ticket aims secondly to make `OutputHtml` the default rich output for sage objects in jupyter notebook.
+This ticket aims to make  `show(obj)` and `pretty_print(obj)` show the html+mathjax representation of the object. The html+mathjax representation can be made from the latex representation or given by `_html_` method of the object.
 
-Then html display for sage objects should be turned on by `%display html` magic not by the current `%display latex` magic.
+This ticket makes `%display html` magic turn on displaying html+mathjax representations. 
 
-This ticket aims to replace `%display latex` by `%display html`. 
+Presently `%display latex` magic turns on displaying mathjax representations. The `%display latex` should properly turn on displaying latex representations like `view(obj`. But this is not done in this ticket. For now `%display latex` is made an alias of `%display html` for backward compatibility.
 
-If `%display latex` is implemented properly, it should output sage objects like `view(...)`. This is not done in this ticket.
+While we are at it, we also clean up old code written for deprecated sage notebook.
 
 
 
+
+
+
+
+
+
``````




---

archive/issue_comments_509452.json:
```json
{
    "body": "<a id='comment:9'></a>\nAs expressed in https://groups.google.com/g/sage-devel/c/Q4kWXdMxC2Q/m/5PT5QRgvAwAJ, I think that the meaning of `%display latex` is clearer to the end user than `%display html`. The latter sounds quite strange while you are working on a notebook in a browser, the main purpose of which is to display html code. \n\nAt the very least, there should be a long deprecation period, when `%display latex` is still available. For instance, on https://sagemanifolds.obspm.fr/examples.html and on https://luth.obspm.fr/~luthier/gourgoulhon/bh16/sage.html, we have tons of notebooks that start with `%display latex`.",
    "created_at": "2021-03-24T12:42:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509452",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:9'></a>
As expressed in https://groups.google.com/g/sage-devel/c/Q4kWXdMxC2Q/m/5PT5QRgvAwAJ, I think that the meaning of `%display latex` is clearer to the end user than `%display html`. The latter sounds quite strange while you are working on a notebook in a browser, the main purpose of which is to display html code. 

At the very least, there should be a long deprecation period, when `%display latex` is still available. For instance, on https://sagemanifolds.obspm.fr/examples.html and on https://luth.obspm.fr/~luthier/gourgoulhon/bh16/sage.html, we have tons of notebooks that start with `%display latex`.



---

archive/issue_comments_509453.json:
```json
{
    "body": "<a id='comment:10'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8f2560e950924844bda41e6d1d9c0f42d31eace2\">8f2560e</a></td><td><code>Divorce mathjax from latex but let it marry html</code></td></tr></table>\n",
    "created_at": "2021-03-24T12:57:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509453",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:10'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8f2560e950924844bda41e6d1d9c0f42d31eace2">8f2560e</a></td><td><code>Divorce mathjax from latex but let it marry html</code></td></tr></table>




---

archive/issue_comments_509454.json:
```json
{
    "body": "**Changing commit** from \"[27c2acbe5ef922ecacb93266225bde2da0c8180d](https://github.com/sagemath/sagetrac-mirror/commit/27c2acbe5ef922ecacb93266225bde2da0c8180d)\" to \"[8f2560e950924844bda41e6d1d9c0f42d31eace2](https://github.com/sagemath/sagetrac-mirror/commit/8f2560e950924844bda41e6d1d9c0f42d31eace2)\".",
    "created_at": "2021-03-24T12:57:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509454",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[27c2acbe5ef922ecacb93266225bde2da0c8180d](https://github.com/sagemath/sagetrac-mirror/commit/27c2acbe5ef922ecacb93266225bde2da0c8180d)" to "[8f2560e950924844bda41e6d1d9c0f42d31eace2](https://github.com/sagemath/sagetrac-mirror/commit/8f2560e950924844bda41e6d1d9c0f42d31eace2)".



---

archive/issue_comments_509455.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/caf2c864c72787cfa1c8c0f6e0407be57c204a7e\">caf2c86</a></td><td><code>Divorce mathjax from latex but let it marry html</code></td></tr></table>\n",
    "created_at": "2021-03-24T13:26:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509455",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/caf2c864c72787cfa1c8c0f6e0407be57c204a7e">caf2c86</a></td><td><code>Divorce mathjax from latex but let it marry html</code></td></tr></table>




---

archive/issue_comments_509456.json:
```json
{
    "body": "**Changing commit** from \"[8f2560e950924844bda41e6d1d9c0f42d31eace2](https://github.com/sagemath/sagetrac-mirror/commit/8f2560e950924844bda41e6d1d9c0f42d31eace2)\" to \"[caf2c864c72787cfa1c8c0f6e0407be57c204a7e](https://github.com/sagemath/sagetrac-mirror/commit/caf2c864c72787cfa1c8c0f6e0407be57c204a7e)\".",
    "created_at": "2021-03-24T13:26:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509456",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[8f2560e950924844bda41e6d1d9c0f42d31eace2](https://github.com/sagemath/sagetrac-mirror/commit/8f2560e950924844bda41e6d1d9c0f42d31eace2)" to "[caf2c864c72787cfa1c8c0f6e0407be57c204a7e](https://github.com/sagemath/sagetrac-mirror/commit/caf2c864c72787cfa1c8c0f6e0407be57c204a7e)".



---

archive/issue_comments_509457.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [@egourgoulhon](#comment%3A9):\n> As expressed in https://groups.google.com/g/sage-devel/c/Q4kWXdMxC2Q/m/5PT5QRgvAwAJ, I think that the meaning of `%display latex` is clearer to the end user than `%display html`. The latter sounds quite strange while you are working on a notebook in a browser, the main purpose of which is to display html code. \n\nRight.\n\n> At the very least, there should be a long deprecation period, when `%display latex` is still available. For instance, on https://sagemanifolds.obspm.fr/examples.html and on https://luth.obspm.fr/~luthier/gourgoulhon/bh16/sage.html, we have tons of notebooks that start with `%display latex`. \n\nI agree. Though I had decided to follow the deprecation path, now I give up.\n\nI think we can make a compromise. We make the clear distinction between latex representation and html(+mathjax) representation internally or on code level but we keep `%display latex` for end users. \n\nI will commit a patch soon.",
    "created_at": "2021-03-24T13:48:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509457",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:12'></a>
Replying to [@egourgoulhon](#comment%3A9):
> As expressed in https://groups.google.com/g/sage-devel/c/Q4kWXdMxC2Q/m/5PT5QRgvAwAJ, I think that the meaning of `%display latex` is clearer to the end user than `%display html`. The latter sounds quite strange while you are working on a notebook in a browser, the main purpose of which is to display html code. 

Right.

> At the very least, there should be a long deprecation period, when `%display latex` is still available. For instance, on https://sagemanifolds.obspm.fr/examples.html and on https://luth.obspm.fr/~luthier/gourgoulhon/bh16/sage.html, we have tons of notebooks that start with `%display latex`. 

I agree. Though I had decided to follow the deprecation path, now I give up.

I think we can make a compromise. We make the clear distinction between latex representation and html(+mathjax) representation internally or on code level but we keep `%display latex` for end users. 

I will commit a patch soon.



---

archive/issue_comments_509458.json:
```json
{
    "body": "**Changing commit** from \"[caf2c864c72787cfa1c8c0f6e0407be57c204a7e](https://github.com/sagemath/sagetrac-mirror/commit/caf2c864c72787cfa1c8c0f6e0407be57c204a7e)\" to \"[ad6c0446ae53cc10b09cf5dedee373cef6e0b70b](https://github.com/sagemath/sagetrac-mirror/commit/ad6c0446ae53cc10b09cf5dedee373cef6e0b70b)\".",
    "created_at": "2021-03-24T14:36:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509458",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[caf2c864c72787cfa1c8c0f6e0407be57c204a7e](https://github.com/sagemath/sagetrac-mirror/commit/caf2c864c72787cfa1c8c0f6e0407be57c204a7e)" to "[ad6c0446ae53cc10b09cf5dedee373cef6e0b70b](https://github.com/sagemath/sagetrac-mirror/commit/ad6c0446ae53cc10b09cf5dedee373cef6e0b70b)".



---

archive/issue_comments_509459.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ad6c0446ae53cc10b09cf5dedee373cef6e0b70b\">ad6c044</a></td><td><code>Restore %display latex</code></td></tr></table>\n",
    "created_at": "2021-03-24T14:36:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509459",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ad6c0446ae53cc10b09cf5dedee373cef6e0b70b">ad6c044</a></td><td><code>Restore %display latex</code></td></tr></table>




---

archive/issue_comments_509460.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [@kwankyu](#comment%3A12):\n> \n> I think we can make a compromise. We make the clear distinction between latex representation and html(+mathjax) representation internally or on code level but we keep `%display latex` for end users.\n\nSounds good! Thanks. :-)",
    "created_at": "2021-03-24T15:38:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509460",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:14'></a>
Replying to [@kwankyu](#comment%3A12):
> 
> I think we can make a compromise. We make the clear distinction between latex representation and html(+mathjax) representation internally or on code level but we keep `%display latex` for end users.

Sounds good! Thanks. :-)



---

archive/issue_comments_509461.json:
```json
{
    "body": "<a id='comment:15'></a>\nDoes by any chance the code improvement in this ticket fix #31513 ?",
    "created_at": "2021-03-24T20:20:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509461",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:15'></a>
Does by any chance the code improvement in this ticket fix #31513 ?



---

archive/issue_comments_509462.json:
```json
{
    "body": "**Changing commit** from \"[ad6c0446ae53cc10b09cf5dedee373cef6e0b70b](https://github.com/sagemath/sagetrac-mirror/commit/ad6c0446ae53cc10b09cf5dedee373cef6e0b70b)\" to \"[1a8089451f898e0747d70b3c4a8951330986d076](https://github.com/sagemath/sagetrac-mirror/commit/1a8089451f898e0747d70b3c4a8951330986d076)\".",
    "created_at": "2021-03-24T23:03:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509462",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[ad6c0446ae53cc10b09cf5dedee373cef6e0b70b](https://github.com/sagemath/sagetrac-mirror/commit/ad6c0446ae53cc10b09cf5dedee373cef6e0b70b)" to "[1a8089451f898e0747d70b3c4a8951330986d076](https://github.com/sagemath/sagetrac-mirror/commit/1a8089451f898e0747d70b3c4a8951330986d076)".



---

archive/issue_comments_509463.json:
```json
{
    "body": "<a id='comment:16'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a8089451f898e0747d70b3c4a8951330986d076\">1a80894</a></td><td><code>Latex string than mathjax string</code></td></tr></table>\n",
    "created_at": "2021-03-24T23:03:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509463",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:16'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a8089451f898e0747d70b3c4a8951330986d076">1a80894</a></td><td><code>Latex string than mathjax string</code></td></tr></table>




---

archive/issue_comments_509464.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,10 +5,6 @@\n The command `view(obj)` is used to view the latex representation of an object.  \n \n This ticket aims to make  `show(obj)` and `pretty_print(obj)` show the html+mathjax representation of the object. The html+mathjax representation can be made from the latex representation or given by `_html_` method of the object.\n-\n-This ticket makes `%display html` magic turn on displaying html+mathjax representations. \n-\n-Presently `%display latex` magic turns on displaying mathjax representations. The `%display latex` should properly turn on displaying latex representations like `view(obj`. But this is not done in this ticket. For now `%display latex` is made an alias of `%display html` for backward compatibility.\n \n While we are at it, we also clean up old code written for deprecated sage notebook.\n \n``````\n",
    "created_at": "2021-03-24T23:06:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509464",
    "user": "https://github.com/kwankyu"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,10 +5,6 @@
 The command `view(obj)` is used to view the latex representation of an object.  
 
 This ticket aims to make  `show(obj)` and `pretty_print(obj)` show the html+mathjax representation of the object. The html+mathjax representation can be made from the latex representation or given by `_html_` method of the object.
-
-This ticket makes `%display html` magic turn on displaying html+mathjax representations. 
-
-Presently `%display latex` magic turns on displaying mathjax representations. The `%display latex` should properly turn on displaying latex representations like `view(obj`. But this is not done in this ticket. For now `%display latex` is made an alias of `%display html` for backward compatibility.
 
 While we are at it, we also clean up old code written for deprecated sage notebook.
 
``````




---

archive/issue_comments_509465.json:
```json
{
    "body": "<a id='comment:18'></a>\nI gave a try and it looks OK to me, except that the latex-typeset is broken in the pdf export from the Jupyter notebook. I guess fixing this should wait the resolution of #31513.",
    "created_at": "2021-03-26T17:17:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509465",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:18'></a>
I gave a try and it looks OK to me, except that the latex-typeset is broken in the pdf export from the Jupyter notebook. I guess fixing this should wait the resolution of #31513.



---

archive/issue_comments_509466.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [@egourgoulhon](#comment%3A18):\n> I gave a try and it looks OK to me, except that the latex-typeset is broken in the pdf export from the Jupyter notebook. I guess fixing this should wait the resolution of #31513. \n\nThanks! I agree.",
    "created_at": "2021-03-26T22:41:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509466",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:19'></a>
Replying to [@egourgoulhon](#comment%3A18):
> I gave a try and it looks OK to me, except that the latex-typeset is broken in the pdf export from the Jupyter notebook. I guess fixing this should wait the resolution of #31513. 

Thanks! I agree.



---

archive/issue_comments_509467.json:
```json
{
    "body": "**Changing commit** from \"[1a8089451f898e0747d70b3c4a8951330986d076](https://github.com/sagemath/sagetrac-mirror/commit/1a8089451f898e0747d70b3c4a8951330986d076)\" to \"[21ea546d85d8a9b0cb580f24f36afcf4bd51623c](https://github.com/sagemath/sagetrac-mirror/commit/21ea546d85d8a9b0cb580f24f36afcf4bd51623c)\".",
    "created_at": "2021-03-27T02:09:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509467",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[1a8089451f898e0747d70b3c4a8951330986d076](https://github.com/sagemath/sagetrac-mirror/commit/1a8089451f898e0747d70b3c4a8951330986d076)" to "[21ea546d85d8a9b0cb580f24f36afcf4bd51623c](https://github.com/sagemath/sagetrac-mirror/commit/21ea546d85d8a9b0cb580f24f36afcf4bd51623c)".



---

archive/issue_comments_509468.json:
```json
{
    "body": "<a id='comment:20'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/21ea546d85d8a9b0cb580f24f36afcf4bd51623c\">21ea546</a></td><td><code>A fix for jupyter pdf export</code></td></tr></table>\n",
    "created_at": "2021-03-27T02:09:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509468",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:20'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/21ea546d85d8a9b0cb580f24f36afcf4bd51623c">21ea546</a></td><td><code>A fix for jupyter pdf export</code></td></tr></table>




---

archive/issue_comments_509469.json:
```json
{
    "body": "<a id='comment:21'></a>\nThanks for the fix. There is still an issue for the pdf export of matrices. For instance, \n\n```\n%display latex\nmatrix([[1, x], [0, 0]])\n```\nproduces a typeset matrix in the Jupyter notebook, but not in its pdf export.",
    "created_at": "2021-03-27T10:39:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509469",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:21'></a>
Thanks for the fix. There is still an issue for the pdf export of matrices. For instance, 

```
%display latex
matrix([[1, x], [0, 0]])
```
produces a typeset matrix in the Jupyter notebook, but not in its pdf export.



---

archive/issue_comments_509470.json:
```json
{
    "body": "<a id='comment:22'></a>\nAnother issue is that `%matplotlib notebook` is broken by this ticket: the following cell of a Jupyter notebook:\n\n```\n%matplotlib notebook\nimport matplotlib.pyplot as plt\nplt.plot([1, 2, 3, 4])\nplt.ylabel('some numbers')\nplt.show()\n```\nyields\n\n```\n<IPython.core.display.HTML object>\n```\ninstead of the pyplot window.",
    "created_at": "2021-03-27T10:43:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509470",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:22'></a>
Another issue is that `%matplotlib notebook` is broken by this ticket: the following cell of a Jupyter notebook:

```
%matplotlib notebook
import matplotlib.pyplot as plt
plt.plot([1, 2, 3, 4])
plt.ylabel('some numbers')
plt.show()
```
yields

```
<IPython.core.display.HTML object>
```
instead of the pyplot window.



---

archive/issue_comments_509471.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bfb1a8f864cb0f84aa4bb9707b23522aff263745\">bfb1a8f</a></td><td><code>Fix for matrix</code></td></tr></table>\n",
    "created_at": "2021-03-27T11:13:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509471",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bfb1a8f864cb0f84aa4bb9707b23522aff263745">bfb1a8f</a></td><td><code>Fix for matrix</code></td></tr></table>




---

archive/issue_comments_509472.json:
```json
{
    "body": "**Changing commit** from \"[21ea546d85d8a9b0cb580f24f36afcf4bd51623c](https://github.com/sagemath/sagetrac-mirror/commit/21ea546d85d8a9b0cb580f24f36afcf4bd51623c)\" to \"[bfb1a8f864cb0f84aa4bb9707b23522aff263745](https://github.com/sagemath/sagetrac-mirror/commit/bfb1a8f864cb0f84aa4bb9707b23522aff263745)\".",
    "created_at": "2021-03-27T11:13:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509472",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[21ea546d85d8a9b0cb580f24f36afcf4bd51623c](https://github.com/sagemath/sagetrac-mirror/commit/21ea546d85d8a9b0cb580f24f36afcf4bd51623c)" to "[bfb1a8f864cb0f84aa4bb9707b23522aff263745](https://github.com/sagemath/sagetrac-mirror/commit/bfb1a8f864cb0f84aa4bb9707b23522aff263745)".



---

archive/issue_comments_509473.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [@egourgoulhon](#comment%3A22):\n> Another issue is that `%matplotlib notebook` is broken by this ticket: the following cell of a Jupyter notebook:\n> \n> ```\n> %matplotlib notebook\n> import matplotlib.pyplot as plt\n> plt.plot([1, 2, 3, 4])\n> plt.ylabel('some numbers')\n> plt.show()\n> ```\n> yields\n> \n> ```\n> <IPython.core.display.HTML object>\n> ```\n> instead of the pyplot window.\n\nAre you sure? I copy and pasted the same code into sage 9.1 and 9.2. They all fail.",
    "created_at": "2021-03-27T11:21:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509473",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:24'></a>
Replying to [@egourgoulhon](#comment%3A22):
> Another issue is that `%matplotlib notebook` is broken by this ticket: the following cell of a Jupyter notebook:
> 
> ```
> %matplotlib notebook
> import matplotlib.pyplot as plt
> plt.plot([1, 2, 3, 4])
> plt.ylabel('some numbers')
> plt.show()
> ```
> yields
> 
> ```
> <IPython.core.display.HTML object>
> ```
> instead of the pyplot window.

Are you sure? I copy and pasted the same code into sage 9.1 and 9.2. They all fail.



---

archive/issue_comments_509474.json:
```json
{
    "body": "<a id='comment:25'></a>\nThe same code also fails on sage 9.3.beta9 without this ticket.",
    "created_at": "2021-03-27T11:23:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509474",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:25'></a>
The same code also fails on sage 9.3.beta9 without this ticket.



---

archive/issue_comments_509475.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [@kwankyu](#comment%3A25):\n> The same code also fails on sage 9.3.beta9 without this ticket.\n\nIt works for me, both with sage 9.2 and 9.3.rc0 (note that it does not work if `%display latex` is set first).",
    "created_at": "2021-03-27T12:29:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509475",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:26'></a>
Replying to [@kwankyu](#comment%3A25):
> The same code also fails on sage 9.3.beta9 without this ticket.

It works for me, both with sage 9.2 and 9.3.rc0 (note that it does not work if `%display latex` is set first).



---

archive/issue_comments_509476.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [@kwankyu](#comment%3A24):\n> Replying to [@egourgoulhon](#comment%3A22):\n> > Another issue is that `%matplotlib notebook` is broken by this ticket: the following cell of a Jupyter notebook:\n> > \n> > ```\n> > %matplotlib notebook\n> > import matplotlib.pyplot as plt\n> > plt.plot([1, 2, 3, 4])\n> > plt.ylabel('some numbers')\n> > plt.show()\n> > ```\n> > yields\n> > \n> > ```\n> > <IPython.core.display.HTML object>\n> > ```\n> > instead of the pyplot window.\n\n> \n> Are you sure? I copy and pasted the same code into sage 9.1 and 9.2. They all fail. \n\nYes I am sure: it works for me for sage 9.1, 9.2 and 9.3.rc0. It is very convenient to have that pyplot window, because it allows to zoom and pan, contrary to Sage 2d plot outputs. Note that, as said in [comment:26](#comment%3A26), it is broken by `%display latex` though. But\n\n```\n%display plain\n%matplotlib notebook\nimport matplotlib.pyplot as plt\nplt.plot([1, 2, 3, 4])\nplt.ylabel('some numbers')\nplt.show()\n``` \nworks all the time.",
    "created_at": "2021-03-27T12:35:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509476",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:27'></a>
Replying to [@kwankyu](#comment%3A24):
> Replying to [@egourgoulhon](#comment%3A22):
> > Another issue is that `%matplotlib notebook` is broken by this ticket: the following cell of a Jupyter notebook:
> > 
> > ```
> > %matplotlib notebook
> > import matplotlib.pyplot as plt
> > plt.plot([1, 2, 3, 4])
> > plt.ylabel('some numbers')
> > plt.show()
> > ```
> > yields
> > 
> > ```
> > <IPython.core.display.HTML object>
> > ```
> > instead of the pyplot window.

> 
> Are you sure? I copy and pasted the same code into sage 9.1 and 9.2. They all fail. 

Yes I am sure: it works for me for sage 9.1, 9.2 and 9.3.rc0. It is very convenient to have that pyplot window, because it allows to zoom and pan, contrary to Sage 2d plot outputs. Note that, as said in [comment:26](#comment%3A26), it is broken by `%display latex` though. But

```
%display plain
%matplotlib notebook
import matplotlib.pyplot as plt
plt.plot([1, 2, 3, 4])
plt.ylabel('some numbers')
plt.show()
``` 
works all the time.



---

archive/issue_comments_509477.json:
```json
{
    "body": "<a id='comment:28'></a>\n**Attachment:** [Screen Shot 2021-03-28 at 7.54.12 AM.png.gz](https://github.com/sagemath/sage/files/ticket31536/b774c9c99a7a93c3f7caa687eb7b8826.gz)\n\nReplying to [@egourgoulhon](#comment%3A27):\n> I am sure: it works for me for sage 9.1, 9.2 and 9.3.rc0. It is very convenient to have that pyplot window, because it allows to zoom and pan, contrary to Sage 2d plot outputs. Note that, as said in [comment:26](#comment%3A26), it is broken by `%display latex` though. But\n> \n> ```\n> %display plain\n> %matplotlib notebook\n> import matplotlib.pyplot as plt\n> plt.plot([1, 2, 3, 4])\n> plt.ylabel('some numbers')\n> plt.show()\n> ``` \n> works all the time.\n\nI cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.",
    "created_at": "2021-03-27T22:59:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509477",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:28'></a>
**Attachment:** [Screen Shot 2021-03-28 at 7.54.12 AM.png.gz](https://github.com/sagemath/sage/files/ticket31536/b774c9c99a7a93c3f7caa687eb7b8826.gz)

Replying to [@egourgoulhon](#comment%3A27):
> I am sure: it works for me for sage 9.1, 9.2 and 9.3.rc0. It is very convenient to have that pyplot window, because it allows to zoom and pan, contrary to Sage 2d plot outputs. Note that, as said in [comment:26](#comment%3A26), it is broken by `%display latex` though. But
> 
> ```
> %display plain
> %matplotlib notebook
> import matplotlib.pyplot as plt
> plt.plot([1, 2, 3, 4])
> plt.ylabel('some numbers')
> plt.show()
> ``` 
> works all the time.

I cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.



---

archive/issue_comments_509478.json:
```json
{
    "body": "<a id='comment:29'></a>\nAnyway, I can observe that with `%display latex`, the failure is of different kind.",
    "created_at": "2021-03-27T23:05:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509478",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:29'></a>
Anyway, I can observe that with `%display latex`, the failure is of different kind.



---

archive/issue_comments_509479.json:
```json
{
    "body": "<a id='comment:30'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f588be835e636581b933d9ba323c31e9dab4e60\">5f588be</a></td><td><code>Fix matplotlib output</code></td></tr></table>\n",
    "created_at": "2021-03-28T01:12:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509479",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:30'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f588be835e636581b933d9ba323c31e9dab4e60">5f588be</a></td><td><code>Fix matplotlib output</code></td></tr></table>




---

archive/issue_comments_509480.json:
```json
{
    "body": "**Changing commit** from \"[bfb1a8f864cb0f84aa4bb9707b23522aff263745](https://github.com/sagemath/sagetrac-mirror/commit/bfb1a8f864cb0f84aa4bb9707b23522aff263745)\" to \"[5f588be835e636581b933d9ba323c31e9dab4e60](https://github.com/sagemath/sagetrac-mirror/commit/5f588be835e636581b933d9ba323c31e9dab4e60)\".",
    "created_at": "2021-03-28T01:12:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509480",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[bfb1a8f864cb0f84aa4bb9707b23522aff263745](https://github.com/sagemath/sagetrac-mirror/commit/bfb1a8f864cb0f84aa4bb9707b23522aff263745)" to "[5f588be835e636581b933d9ba323c31e9dab4e60](https://github.com/sagemath/sagetrac-mirror/commit/5f588be835e636581b933d9ba323c31e9dab4e60)".



---

archive/issue_comments_509481.json:
```json
{
    "body": "<a id='comment:31'></a>\nPlease check",
    "created_at": "2021-03-28T01:13:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509481",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:31'></a>
Please check



---

archive/issue_comments_509482.json:
```json
{
    "body": "<a id='comment:32'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6cf27bfb809b1c5fa436cd8c5ddff01ee434ce84\">6cf27bf</a></td><td><code>Merge branch 'develop' into mathjax-trac31536</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/09beec0ecc167406713ee559225d0091b0025f07\">09beec0</a></td><td><code>Minor fixes for doctest failures</code></td></tr></table>\n",
    "created_at": "2021-03-28T07:04:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509482",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:32'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6cf27bfb809b1c5fa436cd8c5ddff01ee434ce84">6cf27bf</a></td><td><code>Merge branch 'develop' into mathjax-trac31536</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/09beec0ecc167406713ee559225d0091b0025f07">09beec0</a></td><td><code>Minor fixes for doctest failures</code></td></tr></table>




---

archive/issue_comments_509483.json:
```json
{
    "body": "**Changing commit** from \"[5f588be835e636581b933d9ba323c31e9dab4e60](https://github.com/sagemath/sagetrac-mirror/commit/5f588be835e636581b933d9ba323c31e9dab4e60)\" to \"[09beec0ecc167406713ee559225d0091b0025f07](https://github.com/sagemath/sagetrac-mirror/commit/09beec0ecc167406713ee559225d0091b0025f07)\".",
    "created_at": "2021-03-28T07:04:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509483",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[5f588be835e636581b933d9ba323c31e9dab4e60](https://github.com/sagemath/sagetrac-mirror/commit/5f588be835e636581b933d9ba323c31e9dab4e60)" to "[09beec0ecc167406713ee559225d0091b0025f07](https://github.com/sagemath/sagetrac-mirror/commit/09beec0ecc167406713ee559225d0091b0025f07)".



---

archive/issue_events_382577.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2021-03-28T08:41:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31536#event-382577"
}
```



---

archive/issue_events_382578.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2021-03-28T08:41:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31536#event-382578"
}
```



---

archive/issue_comments_509484.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [@kwankyu](#comment%3A31):\n> Please check\n\nThanks for the new commits. I confirm that the issue with pdf export of matrices is fixed by them.  However, the issue with matplotlib remains: for the code of [comment:27](#comment%3A27), I still get \n\n```\n<IPython.core.display.HTML object>\n```\ninstead of the pyplot window.",
    "created_at": "2021-03-28T11:37:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509484",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:34'></a>
Replying to [@kwankyu](#comment%3A31):
> Please check

Thanks for the new commits. I confirm that the issue with pdf export of matrices is fixed by them.  However, the issue with matplotlib remains: for the code of [comment:27](#comment%3A27), I still get 

```
<IPython.core.display.HTML object>
```
instead of the pyplot window.



---

archive/issue_comments_509485.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [@kwankyu](#comment%3A28):\n> \n> I cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.\n\nNo, it does not work in CoCalc for me either (same error message as you). Given that CoCalc's Jupyter notebook is quite customized, I would say that it is a CoCalc issue, rather than a Sage one. Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1).",
    "created_at": "2021-03-28T13:32:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509485",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:35'></a>
Replying to [@kwankyu](#comment%3A28):
> 
> I cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.

No, it does not work in CoCalc for me either (same error message as you). Given that CoCalc's Jupyter notebook is quite customized, I would say that it is a CoCalc issue, rather than a Sage one. Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1).



---

archive/issue_comments_509486.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [@egourgoulhon](#comment%3A34):\n> Replying to [@kwankyu](#comment%3A31):\n> > Please check\n\n> \n> Thanks for the new commits. I confirm that the issue with pdf export of matrices is fixed by them.  However, the issue with matplotlib remains: for the code of [comment:27](#comment%3A27), I still get \n> \n> ```\n> <IPython.core.display.HTML object>\n> ```\n> instead of the pyplot window. \n\nFWIW, for `plt.show()`, the following happens in `SageDisplayFormatter.format`:\n\n```\n        # use IPython display for IPython native objects\n        if isinstance(obj, IPYTHON_NATIVE_TYPES):     <== this test is passed\n            if self.ipython_display_formatter(obj):   <== this test fails\n                return {}, {}                         \n```\nHence the `return {}, {}` is not performed.",
    "created_at": "2021-03-28T14:17:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509486",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:36'></a>
Replying to [@egourgoulhon](#comment%3A34):
> Replying to [@kwankyu](#comment%3A31):
> > Please check

> 
> Thanks for the new commits. I confirm that the issue with pdf export of matrices is fixed by them.  However, the issue with matplotlib remains: for the code of [comment:27](#comment%3A27), I still get 
> 
> ```
> <IPython.core.display.HTML object>
> ```
> instead of the pyplot window. 

FWIW, for `plt.show()`, the following happens in `SageDisplayFormatter.format`:

```
        # use IPython display for IPython native objects
        if isinstance(obj, IPYTHON_NATIVE_TYPES):     <== this test is passed
            if self.ipython_display_formatter(obj):   <== this test fails
                return {}, {}                         
```
Hence the `return {}, {}` is not performed.



---

archive/issue_comments_509487.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [@egourgoulhon](#comment%3A35):\n> Replying to [@kwankyu](#comment%3A28):\n> > \n> > I cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.\n\n> \n> No, it does not work in CoCalc for me either (same error message as you). Given that CoCalc's Jupyter notebook is quite customized, I would say that it is a CoCalc issue, rather than a Sage one. Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1). \n\nNo. My system is MacOS 11.2.3 with Chrome 89.0.4389.90. \n\nI tried to install jupyter-matplotlib extension with jupyterlab 2 and jupyterlab 3. All did not work.\n\nBy the way, it works with Python 3 kernel in jupyterlab.",
    "created_at": "2021-03-29T04:17:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509487",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:37'></a>
Replying to [@egourgoulhon](#comment%3A35):
> Replying to [@kwankyu](#comment%3A28):
> > 
> > I cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.

> 
> No, it does not work in CoCalc for me either (same error message as you). Given that CoCalc's Jupyter notebook is quite customized, I would say that it is a CoCalc issue, rather than a Sage one. Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1). 

No. My system is MacOS 11.2.3 with Chrome 89.0.4389.90. 

I tried to install jupyter-matplotlib extension with jupyterlab 2 and jupyterlab 3. All did not work.

By the way, it works with Python 3 kernel in jupyterlab.



---

archive/issue_comments_509488.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [@egourgoulhon](#comment%3A36):\n> Replying to [@egourgoulhon](#comment%3A34):\n> > Replying to [@kwankyu](#comment%3A31):\n> > > Please check\n\n> > \n> > Thanks for the new commits. I confirm that the issue with pdf export of matrices is fixed by them.  However, the issue with matplotlib remains: for the code of [comment:27](#comment%3A27), I still get \n> > \n> > ```\n> > <IPython.core.display.HTML object>\n> > ```\n> > instead of the pyplot window. \n\n> \n> FWIW, for `plt.show()`, the following happens in `SageDisplayFormatter.format`:\n> \n> ```\n>         # use IPython display for IPython native objects\n>         if isinstance(obj, IPYTHON_NATIVE_TYPES):     <== this test is passed\n>             if self.ipython_display_formatter(obj):   <== this test fails\n>                 return {}, {}                         \n> ```\n> Hence the `return {}, {}` is not performed. \n> \n\n`self.ipython_display_formatter(obj)` is an ipython native method. which has nothing to do with sage `%display` magic. I don't understand why it fails with `%display latex` but it works with `%display plain`.",
    "created_at": "2021-03-29T04:26:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509488",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:38'></a>
Replying to [@egourgoulhon](#comment%3A36):
> Replying to [@egourgoulhon](#comment%3A34):
> > Replying to [@kwankyu](#comment%3A31):
> > > Please check

> > 
> > Thanks for the new commits. I confirm that the issue with pdf export of matrices is fixed by them.  However, the issue with matplotlib remains: for the code of [comment:27](#comment%3A27), I still get 
> > 
> > ```
> > <IPython.core.display.HTML object>
> > ```
> > instead of the pyplot window. 

> 
> FWIW, for `plt.show()`, the following happens in `SageDisplayFormatter.format`:
> 
> ```
>         # use IPython display for IPython native objects
>         if isinstance(obj, IPYTHON_NATIVE_TYPES):     <== this test is passed
>             if self.ipython_display_formatter(obj):   <== this test fails
>                 return {}, {}                         
> ```
> Hence the `return {}, {}` is not performed. 
> 

`self.ipython_display_formatter(obj)` is an ipython native method. which has nothing to do with sage `%display` magic. I don't understand why it fails with `%display latex` but it works with `%display plain`.



---

archive/issue_comments_509489.json:
```json
{
    "body": "<a id='comment:39'></a>\nReplying to [@kwankyu](#comment%3A38):\n> Replying to [@egourgoulhon](#comment%3A36):\n> > Replying to [@egourgoulhon](#comment%3A34):\n> > > Replying to [@kwankyu](#comment%3A31):\n> > > > Please check\n\n> > > \n> > > Thanks for the new commits. I confirm that the issue with pdf export of matrices is fixed by them.  However, the issue with matplotlib remains: for the code of [comment:27](#comment%3A27), I still get \n> > > \n> > > ```\n> > > <IPython.core.display.HTML object>\n> > > ```\n> > > instead of the pyplot window. \n\n> > \n> > FWIW, for `plt.show()`, the following happens in `SageDisplayFormatter.format`:\n> > \n> > ```\n> >         # use IPython display for IPython native objects\n> >         if isinstance(obj, IPYTHON_NATIVE_TYPES):     <== this test is passed\n> >             if self.ipython_display_formatter(obj):   <== this test fails\n> >                 return {}, {}                         \n> > ```\n> > Hence the `return {}, {}` is not performed. \n> > \n\n> \n> `self.ipython_display_formatter(obj)` is an ipython native method. which has nothing to do with sage `%display` magic. I don't understand why it fails with `%display latex` but it works with `%display plain`.\n> \n\nNo, it fails with `%display plain` as well. All subsequent tests in `SageDisplayFormatter.format` also fail, so at the end\n\n```\n        return ipy_format, ipy_metadata\n```\nis achieved. The same thing happens with Sage 9.3.rc0 (i.e. outside this ticket branch), but for some reason, the output `ipy_format, ipy_metadata` is better handled in that case, so that the pyplot window opens.",
    "created_at": "2021-03-29T07:09:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509489",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:39'></a>
Replying to [@kwankyu](#comment%3A38):
> Replying to [@egourgoulhon](#comment%3A36):
> > Replying to [@egourgoulhon](#comment%3A34):
> > > Replying to [@kwankyu](#comment%3A31):
> > > > Please check

> > > 
> > > Thanks for the new commits. I confirm that the issue with pdf export of matrices is fixed by them.  However, the issue with matplotlib remains: for the code of [comment:27](#comment%3A27), I still get 
> > > 
> > > ```
> > > <IPython.core.display.HTML object>
> > > ```
> > > instead of the pyplot window. 

> > 
> > FWIW, for `plt.show()`, the following happens in `SageDisplayFormatter.format`:
> > 
> > ```
> >         # use IPython display for IPython native objects
> >         if isinstance(obj, IPYTHON_NATIVE_TYPES):     <== this test is passed
> >             if self.ipython_display_formatter(obj):   <== this test fails
> >                 return {}, {}                         
> > ```
> > Hence the `return {}, {}` is not performed. 
> > 

> 
> `self.ipython_display_formatter(obj)` is an ipython native method. which has nothing to do with sage `%display` magic. I don't understand why it fails with `%display latex` but it works with `%display plain`.
> 

No, it fails with `%display plain` as well. All subsequent tests in `SageDisplayFormatter.format` also fail, so at the end

```
        return ipy_format, ipy_metadata
```
is achieved. The same thing happens with Sage 9.3.rc0 (i.e. outside this ticket branch), but for some reason, the output `ipy_format, ipy_metadata` is better handled in that case, so that the pyplot window opens.



---

archive/issue_comments_509490.json:
```json
{
    "body": "<a id='comment:40'></a>\nReplying to [@egourgoulhon](#comment%3A39):\n> Replying to [@kwankyu](#comment%3A38):\n> is achieved. The same thing happens with Sage 9.3.rc0 (i.e. outside this ticket branch), but for some reason, the output `ipy_format, ipy_metadata` is better handled in that case, so that the pyplot window opens. \n\nWhich do you mean, with the patch, or without the patch?",
    "created_at": "2021-03-29T07:17:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509490",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:40'></a>
Replying to [@egourgoulhon](#comment%3A39):
> Replying to [@kwankyu](#comment%3A38):
> is achieved. The same thing happens with Sage 9.3.rc0 (i.e. outside this ticket branch), but for some reason, the output `ipy_format, ipy_metadata` is better handled in that case, so that the pyplot window opens. 

Which do you mean, with the patch, or without the patch?



---

archive/issue_comments_509491.json:
```json
{
    "body": "<a id='comment:41'></a>\nReplying to [@kwankyu](#comment%3A40):\n> Replying to [@egourgoulhon](#comment%3A39):\n> > Replying to [@kwankyu](#comment%3A38):\n> > is achieved. The same thing happens with Sage 9.3.rc0 (i.e. outside this ticket branch), but for some reason, the output `ipy_format, ipy_metadata` is better handled in that case, so that the pyplot window opens. \n\n> \n> Which do you mean, with the patch, or without the patch?\n\nAh, you meant rc0, without the patch..",
    "created_at": "2021-03-29T07:19:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509491",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:41'></a>
Replying to [@kwankyu](#comment%3A40):
> Replying to [@egourgoulhon](#comment%3A39):
> > Replying to [@kwankyu](#comment%3A38):
> > is achieved. The same thing happens with Sage 9.3.rc0 (i.e. outside this ticket branch), but for some reason, the output `ipy_format, ipy_metadata` is better handled in that case, so that the pyplot window opens. 

> 
> Which do you mean, with the patch, or without the patch?

Ah, you meant rc0, without the patch..



---

archive/issue_comments_509492.json:
```json
{
    "body": "<a id='comment:42'></a>\nReplying to [@kwankyu](#comment%3A41):\n> Replying to [@kwankyu](#comment%3A40):\n> > Replying to [@egourgoulhon](#comment%3A39):\n> > > Replying to [@kwankyu](#comment%3A38):\n> > > is achieved. The same thing happens with Sage 9.3.rc0 (i.e. outside this ticket branch), but for some reason, the output `ipy_format, ipy_metadata` is better handled in that case, so that the pyplot window opens. \n\n> > \n> > Which do you mean, with the patch, or without the patch?\n\n> \n> Ah, you meant rc0, without the patch..\n\nYes (sorry for not having been clear).",
    "created_at": "2021-03-29T07:20:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509492",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:42'></a>
Replying to [@kwankyu](#comment%3A41):
> Replying to [@kwankyu](#comment%3A40):
> > Replying to [@egourgoulhon](#comment%3A39):
> > > Replying to [@kwankyu](#comment%3A38):
> > > is achieved. The same thing happens with Sage 9.3.rc0 (i.e. outside this ticket branch), but for some reason, the output `ipy_format, ipy_metadata` is better handled in that case, so that the pyplot window opens. 

> > 
> > Which do you mean, with the patch, or without the patch?

> 
> Ah, you meant rc0, without the patch..

Yes (sorry for not having been clear).



---

archive/issue_comments_509493.json:
```json
{
    "body": "<a id='comment:43'></a>\nTo summarize: for `plt.show()` in Sage 9.3.rc0, with or without the patch introduced in this ticket, `SageDisplayFormatter.format` terminates by `return ipy_format, ipy_metadata`, whatever the value of `%display`. Then the pyplot window opens correctly only without the patch and without `%display latex`.",
    "created_at": "2021-03-29T07:28:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509493",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:43'></a>
To summarize: for `plt.show()` in Sage 9.3.rc0, with or without the patch introduced in this ticket, `SageDisplayFormatter.format` terminates by `return ipy_format, ipy_metadata`, whatever the value of `%display`. Then the pyplot window opens correctly only without the patch and without `%display latex`.



---

archive/issue_comments_509494.json:
```json
{
    "body": "<a id='comment:44'></a>\nReplying to [@kwankyu](#comment%3A37):\n> Replying to [@egourgoulhon](#comment%3A35):\n> > Replying to [@kwankyu](#comment%3A28):\n> > > \n> > > I cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.\n\n> > \n> > No, it does not work in CoCalc for me either (same error message as you). Given that CoCalc's Jupyter notebook is quite customized, I would say that it is a CoCalc issue, rather than a Sage one. Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1). \n\n> \n> No. My system is MacOS 11.2.3 with Chrome 89.0.4389.90. \n> \n\nStrange... On my side, I haven't any special setting regarding matplotlib (it's the default version included in Sage). \n\nRegarding CoCalc, I've just got the answer from William: it works with Sage 9.2 kernel but you have to start a \"Jupyter classic server\" (in the \"New\" menu).",
    "created_at": "2021-03-29T07:44:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509494",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:44'></a>
Replying to [@kwankyu](#comment%3A37):
> Replying to [@egourgoulhon](#comment%3A35):
> > Replying to [@kwankyu](#comment%3A28):
> > > 
> > > I cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.

> > 
> > No, it does not work in CoCalc for me either (same error message as you). Given that CoCalc's Jupyter notebook is quite customized, I would say that it is a CoCalc issue, rather than a Sage one. Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1). 

> 
> No. My system is MacOS 11.2.3 with Chrome 89.0.4389.90. 
> 

Strange... On my side, I haven't any special setting regarding matplotlib (it's the default version included in Sage). 

Regarding CoCalc, I've just got the answer from William: it works with Sage 9.2 kernel but you have to start a "Jupyter classic server" (in the "New" menu).



---

archive/issue_comments_509495.json:
```json
{
    "body": "<a id='comment:45'></a>\nReplying to [@egourgoulhon](#comment%3A44):\n> Replying to [@kwankyu](#comment%3A37):\n> > Replying to [@egourgoulhon](#comment%3A35):\n> > > Replying to [@kwankyu](#comment%3A28):\n> > > > \n> > > > I cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.\n\n> > > \n> > > No, it does not work in CoCalc for me either (same error message as you). Given that CoCalc's Jupyter notebook is quite customized, I would say that it is a CoCalc issue, rather than a Sage one. Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1). \n\n> > \n> > No. My system is MacOS 11.2.3 with Chrome 89.0.4389.90. \n> > \n\n> \n> Strange... On my side, I haven't any special setting regarding matplotlib (it's the default version included in Sage). \n\nDoes it work without installing jupyter-matplotlib extension?\n\nI created a new Ubuntu vm, and installed a fresh sage from source, and installed jupyter-matplotlib from the jupyter extension manager. Even then it doesn't work and shows the same message `Javascript Error: IPython is not defined`. Now even with Python3 kernel.",
    "created_at": "2021-03-30T00:58:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509495",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:45'></a>
Replying to [@egourgoulhon](#comment%3A44):
> Replying to [@kwankyu](#comment%3A37):
> > Replying to [@egourgoulhon](#comment%3A35):
> > > Replying to [@kwankyu](#comment%3A28):
> > > > 
> > > > I cannot see what you see. Does it work in cocalc for you? I doen't for me. See the attachment.

> > > 
> > > No, it does not work in CoCalc for me either (same error message as you). Given that CoCalc's Jupyter notebook is quite customized, I would say that it is a CoCalc issue, rather than a Sage one. Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1). 

> > 
> > No. My system is MacOS 11.2.3 with Chrome 89.0.4389.90. 
> > 

> 
> Strange... On my side, I haven't any special setting regarding matplotlib (it's the default version included in Sage). 

Does it work without installing jupyter-matplotlib extension?

I created a new Ubuntu vm, and installed a fresh sage from source, and installed jupyter-matplotlib from the jupyter extension manager. Even then it doesn't work and shows the same message `Javascript Error: IPython is not defined`. Now even with Python3 kernel.



---

archive/issue_comments_509496.json:
```json
{
    "body": "<a id='comment:46'></a>\nReplying to [@egourgoulhon](#comment%3A44):\n> Replying to [@kwankyu](#comment%3A37):\n> \n> Strange... On my side, I haven't any special setting regarding matplotlib (it's the default version included in Sage). \n> \n> Regarding CoCalc, I've just got the answer from William: it works with Sage 9.2 kernel but you have to start a \"Jupyter classic server\" (in the \"New\" menu). \n\nOk. I finally made it work with the Jupyter classic server. Let me now go back to the ticket.",
    "created_at": "2021-03-30T01:07:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509496",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:46'></a>
Replying to [@egourgoulhon](#comment%3A44):
> Replying to [@kwankyu](#comment%3A37):
> 
> Strange... On my side, I haven't any special setting regarding matplotlib (it's the default version included in Sage). 
> 
> Regarding CoCalc, I've just got the answer from William: it works with Sage 9.2 kernel but you have to start a "Jupyter classic server" (in the "New" menu). 

Ok. I finally made it work with the Jupyter classic server. Let me now go back to the ticket.



---

archive/issue_comments_509497.json:
```json
{
    "body": "<a id='comment:47'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1bcda3726576d59b1afe9214a1c1481d0e80ce9\">b1bcda3</a></td><td><code>Remove SageDisplayFormatter.default_mime()</code></td></tr></table>\n",
    "created_at": "2021-03-30T04:30:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509497",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:47'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1bcda3726576d59b1afe9214a1c1481d0e80ce9">b1bcda3</a></td><td><code>Remove SageDisplayFormatter.default_mime()</code></td></tr></table>




---

archive/issue_comments_509498.json:
```json
{
    "body": "**Changing commit** from \"[09beec0ecc167406713ee559225d0091b0025f07](https://github.com/sagemath/sagetrac-mirror/commit/09beec0ecc167406713ee559225d0091b0025f07)\" to \"[b1bcda3726576d59b1afe9214a1c1481d0e80ce9](https://github.com/sagemath/sagetrac-mirror/commit/b1bcda3726576d59b1afe9214a1c1481d0e80ce9)\".",
    "created_at": "2021-03-30T04:30:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509498",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[09beec0ecc167406713ee559225d0091b0025f07](https://github.com/sagemath/sagetrac-mirror/commit/09beec0ecc167406713ee559225d0091b0025f07)" to "[b1bcda3726576d59b1afe9214a1c1481d0e80ce9](https://github.com/sagemath/sagetrac-mirror/commit/b1bcda3726576d59b1afe9214a1c1481d0e80ce9)".



---

archive/issue_comments_509499.json:
```json
{
    "body": "<a id='comment:48'></a>\nI made a rather drastic change, removing `default_mime()` method, which I don't understand clearly. Instead I rely on the ipython class `DisplayObject` to filter out ipython native objects. \n\nIt works well with the examples up to now. But I think it is necessary to test extensively in fear of any bad regressions.",
    "created_at": "2021-03-30T04:36:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509499",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:48'></a>
I made a rather drastic change, removing `default_mime()` method, which I don't understand clearly. Instead I rely on the ipython class `DisplayObject` to filter out ipython native objects. 

It works well with the examples up to now. But I think it is necessary to test extensively in fear of any bad regressions.



---

archive/issue_comments_509500.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,7 +6,7 @@\n \n This ticket aims to make  `show(obj)` and `pretty_print(obj)` show the html+mathjax representation of the object. The html+mathjax representation can be made from the latex representation or given by `_html_` method of the object.\n \n-While we are at it, we also clean up old code written for deprecated sage notebook.\n+While we are at it, we also cleaned up old code written for deprecated sage noteboo, solved the problem of #31513.\n \n \n \n``````\n",
    "created_at": "2021-03-30T04:48:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509500",
    "user": "https://github.com/kwankyu"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,7 +6,7 @@
 
 This ticket aims to make  `show(obj)` and `pretty_print(obj)` show the html+mathjax representation of the object. The html+mathjax representation can be made from the latex representation or given by `_html_` method of the object.
 
-While we are at it, we also clean up old code written for deprecated sage notebook.
+While we are at it, we also cleaned up old code written for deprecated sage noteboo, solved the problem of #31513.
 
 
 
``````




---

archive/issue_comments_509501.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,7 +6,7 @@\n \n This ticket aims to make  `show(obj)` and `pretty_print(obj)` show the html+mathjax representation of the object. The html+mathjax representation can be made from the latex representation or given by `_html_` method of the object.\n \n-While we are at it, we also cleaned up old code written for deprecated sage noteboo, solved the problem of #31513.\n+While we are at it, we also cleaned up old code written for deprecated sage notebook, and solved the problem of #31513.\n \n \n \n``````\n",
    "created_at": "2021-03-30T04:48:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509501",
    "user": "https://github.com/kwankyu"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,7 +6,7 @@
 
 This ticket aims to make  `show(obj)` and `pretty_print(obj)` show the html+mathjax representation of the object. The html+mathjax representation can be made from the latex representation or given by `_html_` method of the object.
 
-While we are at it, we also cleaned up old code written for deprecated sage noteboo, solved the problem of #31513.
+While we are at it, we also cleaned up old code written for deprecated sage notebook, and solved the problem of #31513.
 
 
 
``````




---

archive/issue_comments_509502.json:
```json
{
    "body": "<a id='comment:51'></a>\nReplying to [@kwankyu](#comment%3A48):\n> I made a rather drastic change, removing `default_mime()` method, which I don't understand clearly. Instead I rely on the ipython class `DisplayObject` to filter out ipython native objects. \n> \n> It works well with the examples up to now. But I think it is necessary to test extensively in fear of any bad regressions.\n\nThanks for the new code. The pyplot window is now correctly handled. Unfortunately, two new issues have appeared: \n\n1/ Outside the context `%matplotlib notebook`, there is no graphical display of `plt.show()`: the output of the Jupyter cell\n\n```\nimport matplotlib.pyplot as plt\nplt.plot([1, 2, 3, 4])\nplt.ylabel('some numbers')\nplt.show()\n```\nis\n\n```\n<Figure size 432x288 with 1 Axes>\n```\ninstead of a png figure displayed by the notebook.\n\n2/ The native IPython rich output method `_repr_latex_` is broken:\n\n```\nclass A(SageObject):\n\n    def __init__(self, data):\n        self._data = data\n\n    def _repr_latex_(self):\n        try:\n            return '$' + self._data._latex_() + '$'\n        except (AttributeError, NotImplementedError):  \n            return None  # if None is returned, plain text is used\n\nA(sin(x^2))\n```\nresults in \n\n```\n<__main__.A object at 0x7f0566d4a940>\n```\ninstead of the latex-typeset formula.\n\nThese two issues were not present in the previous version of the patch, nor in plain Sage 9.3.rc0.",
    "created_at": "2021-03-30T08:45:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509502",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:51'></a>
Replying to [@kwankyu](#comment%3A48):
> I made a rather drastic change, removing `default_mime()` method, which I don't understand clearly. Instead I rely on the ipython class `DisplayObject` to filter out ipython native objects. 
> 
> It works well with the examples up to now. But I think it is necessary to test extensively in fear of any bad regressions.

Thanks for the new code. The pyplot window is now correctly handled. Unfortunately, two new issues have appeared: 

1/ Outside the context `%matplotlib notebook`, there is no graphical display of `plt.show()`: the output of the Jupyter cell

```
import matplotlib.pyplot as plt
plt.plot([1, 2, 3, 4])
plt.ylabel('some numbers')
plt.show()
```
is

```
<Figure size 432x288 with 1 Axes>
```
instead of a png figure displayed by the notebook.

2/ The native IPython rich output method `_repr_latex_` is broken:

```
class A(SageObject):

    def __init__(self, data):
        self._data = data

    def _repr_latex_(self):
        try:
            return '$' + self._data._latex_() + '$'
        except (AttributeError, NotImplementedError):  
            return None  # if None is returned, plain text is used

A(sin(x^2))
```
results in 

```
<__main__.A object at 0x7f0566d4a940>
```
instead of the latex-typeset formula.

These two issues were not present in the previous version of the patch, nor in plain Sage 9.3.rc0.



---

archive/issue_comments_509503.json:
```json
{
    "body": "<a id='comment:52'></a>\nReplying to [@kwankyu](#comment%3A45):\n> Replying to [@egourgoulhon](#comment%3A44):\n> > Replying to [@kwankyu](#comment%3A37):\n> > > Replying to [@egourgoulhon](#comment%3A35):\n> > > > Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1). \n\n> > > \n> > > No. My system is MacOS 11.2.3 with Chrome 89.0.4389.90. \n> > > \n\n> > \n> > Strange... On my side, I haven't any special setting regarding matplotlib (it's the default version included in Sage). \n\n> \n> Does it work without installing jupyter-matplotlib extension?\n> \n\nYes, since I don't have installed such an extension: the content of `local/share/jupyter/nbextensions` under my Sage root is \n\n```\njsmol  jupyter_jsmol  jupyter-js-widgets  mathjax  threejs\n```",
    "created_at": "2021-03-30T09:15:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509503",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:52'></a>
Replying to [@kwankyu](#comment%3A45):
> Replying to [@egourgoulhon](#comment%3A44):
> > Replying to [@kwankyu](#comment%3A37):
> > > Replying to [@egourgoulhon](#comment%3A35):
> > > > Can't you see the pyplot window with Sage 9.3.rc0 on your own machine? (mine is Ubuntu 20.04, with Firefox 86.0.1). 

> > > 
> > > No. My system is MacOS 11.2.3 with Chrome 89.0.4389.90. 
> > > 

> > 
> > Strange... On my side, I haven't any special setting regarding matplotlib (it's the default version included in Sage). 

> 
> Does it work without installing jupyter-matplotlib extension?
> 

Yes, since I don't have installed such an extension: the content of `local/share/jupyter/nbextensions` under my Sage root is 

```
jsmol  jupyter_jsmol  jupyter-js-widgets  mathjax  threejs
```



---

archive/issue_comments_509504.json:
```json
{
    "body": "**Changing commit** from \"[b1bcda3726576d59b1afe9214a1c1481d0e80ce9](https://github.com/sagemath/sagetrac-mirror/commit/b1bcda3726576d59b1afe9214a1c1481d0e80ce9)\" to \"[d964733adbeda0df4fd3477f5f728ad5f2c4cc39](https://github.com/sagemath/sagetrac-mirror/commit/d964733adbeda0df4fd3477f5f728ad5f2c4cc39)\".",
    "created_at": "2021-03-30T09:34:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509504",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[b1bcda3726576d59b1afe9214a1c1481d0e80ce9](https://github.com/sagemath/sagetrac-mirror/commit/b1bcda3726576d59b1afe9214a1c1481d0e80ce9)" to "[d964733adbeda0df4fd3477f5f728ad5f2c4cc39](https://github.com/sagemath/sagetrac-mirror/commit/d964733adbeda0df4fd3477f5f728ad5f2c4cc39)".



---

archive/issue_comments_509505.json:
```json
{
    "body": "<a id='comment:53'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d964733adbeda0df4fd3477f5f728ad5f2c4cc39\">d964733</a></td><td><code>Use ipython output  if sage output is plain</code></td></tr></table>\n",
    "created_at": "2021-03-30T09:34:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509505",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:53'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d964733adbeda0df4fd3477f5f728ad5f2c4cc39">d964733</a></td><td><code>Use ipython output  if sage output is plain</code></td></tr></table>




---

archive/issue_comments_509506.json:
```json
{
    "body": "<a id='comment:54'></a>\nThe commit fixes 1/ and 2/ with me. Check yours.\n\nRegardless of the patch, the matplotlib interactive display is unstable (visible or invisible randomly) on my installation. Strange...",
    "created_at": "2021-03-30T09:44:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509506",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:54'></a>
The commit fixes 1/ and 2/ with me. Check yours.

Regardless of the patch, the matplotlib interactive display is unstable (visible or invisible randomly) on my installation. Strange...



---

archive/issue_comments_509507.json:
```json
{
    "body": "<a id='comment:55'></a>\nReplying to [@kwankyu](#comment%3A54):\n> The commit fixes 1/ and 2/ with me. Check yours.\n> \n\nThanks. I confirm that both 1/ and 2/ are fixed. Moreover, the new commit also fixes `%matplotlib notebook` in a `%display latex` context, which did not work with Sage 9.2 and 9.3.rc0 ! I've also checked that the pdf export of a Jupyter notebook works nicely. So I would say that everything is green from my side. Let us wait for the pachbot and other reviewers, if any.\n\n> Regardless of the patch, the matplotlib interactive display is unstable (visible or invisible randomly) on my installation. Strange...\n\nNote that there cannot be two interactive pyplot windows in two distinct cells of a given Jupyter notebook; if you open a new window via `plt.show()` in a new cell, the first one becomes blank (in the same cell, it is OK). This might explain what you observe.",
    "created_at": "2021-03-30T10:08:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509507",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:55'></a>
Replying to [@kwankyu](#comment%3A54):
> The commit fixes 1/ and 2/ with me. Check yours.
> 

Thanks. I confirm that both 1/ and 2/ are fixed. Moreover, the new commit also fixes `%matplotlib notebook` in a `%display latex` context, which did not work with Sage 9.2 and 9.3.rc0 ! I've also checked that the pdf export of a Jupyter notebook works nicely. So I would say that everything is green from my side. Let us wait for the pachbot and other reviewers, if any.

> Regardless of the patch, the matplotlib interactive display is unstable (visible or invisible randomly) on my installation. Strange...

Note that there cannot be two interactive pyplot windows in two distinct cells of a given Jupyter notebook; if you open a new window via `plt.show()` in a new cell, the first one becomes blank (in the same cell, it is OK). This might explain what you observe.



---

archive/issue_comments_509508.json:
```json
{
    "body": "**Reviewer:** Eric Gourgoulhon",
    "created_at": "2021-03-30T10:08:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509508",
    "user": "https://github.com/egourgoulhon"
}
```

**Reviewer:** Eric Gourgoulhon



---

archive/issue_comments_509509.json:
```json
{
    "body": "<a id='comment:56'></a>\nIf everything is OK with this ticket, I propose that it becomes the fix for the blocker #31513.",
    "created_at": "2021-03-30T10:14:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509509",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:56'></a>
If everything is OK with this ticket, I propose that it becomes the fix for the blocker #31513.



---

archive/issue_comments_509510.json:
```json
{
    "body": "<a id='comment:57'></a>\nReplying to [@egourgoulhon](#comment%3A55):\n> Replying to [@kwankyu](#comment%3A54):\n> > Regardless of the patch, the matplotlib interactive display is unstable (visible or invisible randomly) on my installation. Strange...\n\n> \n> Note that there cannot be two interactive pyplot windows in two distinct cells of a given Jupyter notebook; if you open a new window via `plt.show()` in a new cell, the first one becomes blank (in the same cell, it is OK). This might explain what you observe. \n\nI see. Thanks.",
    "created_at": "2021-03-30T11:06:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509510",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:57'></a>
Replying to [@egourgoulhon](#comment%3A55):
> Replying to [@kwankyu](#comment%3A54):
> > Regardless of the patch, the matplotlib interactive display is unstable (visible or invisible randomly) on my installation. Strange...

> 
> Note that there cannot be two interactive pyplot windows in two distinct cells of a given Jupyter notebook; if you open a new window via `plt.show()` in a new cell, the first one becomes blank (in the same cell, it is OK). This might explain what you observe. 

I see. Thanks.



---

archive/issue_comments_509511.json:
```json
{
    "body": "<a id='comment:58'></a>\nI think the python3 error reported by the patchbot is a false positive, triggered by the presence of `<>` in the string, so we can disregard it. Can you comment on the pyflake errors?",
    "created_at": "2021-03-30T15:56:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509511",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:58'></a>
I think the python3 error reported by the patchbot is a false positive, triggered by the presence of `<>` in the string, so we can disregard it. Can you comment on the pyflake errors?



---

archive/issue_comments_509512.json:
```json
{
    "body": "**Changing commit** from \"[d964733adbeda0df4fd3477f5f728ad5f2c4cc39](https://github.com/sagemath/sagetrac-mirror/commit/d964733adbeda0df4fd3477f5f728ad5f2c4cc39)\" to \"[4c29b9603fe6f4fcc229f9130c7ea5ccc8f3519b](https://github.com/sagemath/sagetrac-mirror/commit/4c29b9603fe6f4fcc229f9130c7ea5ccc8f3519b)\".",
    "created_at": "2021-03-30T22:53:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509512",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[d964733adbeda0df4fd3477f5f728ad5f2c4cc39](https://github.com/sagemath/sagetrac-mirror/commit/d964733adbeda0df4fd3477f5f728ad5f2c4cc39)" to "[4c29b9603fe6f4fcc229f9130c7ea5ccc8f3519b](https://github.com/sagemath/sagetrac-mirror/commit/4c29b9603fe6f4fcc229f9130c7ea5ccc8f3519b)".



---

archive/issue_comments_509513.json:
```json
{
    "body": "<a id='comment:59'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c29b9603fe6f4fcc229f9130c7ea5ccc8f3519b\">4c29b96</a></td><td><code>Fix some pyflakes errors</code></td></tr></table>\n",
    "created_at": "2021-03-30T22:53:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509513",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:59'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c29b9603fe6f4fcc229f9130c7ea5ccc8f3519b">4c29b96</a></td><td><code>Fix some pyflakes errors</code></td></tr></table>




---

archive/issue_comments_509514.json:
```json
{
    "body": "<a id='comment:60'></a>\nReplying to [@egourgoulhon](#comment%3A58):\n> I think the python3 error reported by the patchbot is a false positive, triggered by the presence of `<>` in the string, so we can disregard it. Can you comment on the pyflake errors?\n\nI fixed some pyflakes errors, which are safe to fix. Anyway none of them are new.",
    "created_at": "2021-03-30T22:56:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509514",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:60'></a>
Replying to [@egourgoulhon](#comment%3A58):
> I think the python3 error reported by the patchbot is a false positive, triggered by the presence of `<>` in the string, so we can disregard it. Can you comment on the pyflake errors?

I fixed some pyflakes errors, which are safe to fix. Anyway none of them are new.



---

archive/issue_comments_509515.json:
```json
{
    "body": "<a id='comment:61'></a>\nReplying to [@kwankyu](#comment%3A60):\n> \n> I fixed some pyflakes errors, which are safe to fix. \n\nThanks!\n\n>Anyway none of them are new.\n\nIndeed. Thanks for having taken this opportunity to fix them.",
    "created_at": "2021-03-31T07:29:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509515",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:61'></a>
Replying to [@kwankyu](#comment%3A60):
> 
> I fixed some pyflakes errors, which are safe to fix. 

Thanks!

>Anyway none of them are new.

Indeed. Thanks for having taken this opportunity to fix them.



---

archive/issue_comments_509516.json:
```json
{
    "body": "<a id='comment:62'></a>\nIt's time to move on, if we want this in Sage 9.3. Thanks for all your work on this ticket!",
    "created_at": "2021-03-31T07:31:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509516",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:62'></a>
It's time to move on, if we want this in Sage 9.3. Thanks for all your work on this ticket!



---

archive/issue_events_382579.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2021-03-31T07:31:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31536#event-382579"
}
```



---

archive/issue_events_382580.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2021-03-31T07:31:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31536#event-382580"
}
```



---

archive/issue_comments_509517.json:
```json
{
    "body": "<a id='comment:63'></a>\nThank you for a careful review. Hope this sail on peacefully.",
    "created_at": "2021-03-31T08:05:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509517",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:63'></a>
Thank you for a careful review. Hope this sail on peacefully.



---

archive/issue_events_382581.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-31T15:07:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "label": "https://github.com/sagemath/sage/labels/blocker",
    "label_color": "ff0000",
    "label_name": "blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31536#event-382581"
}
```



---

archive/issue_comments_509518.json:
```json
{
    "body": "<a id='comment:65'></a>\nIt would probably be good to revise the ticket summary/description based on https://groups.google.com/g/sage-release/c/fXpbYwaqt9o/m/xYOwhU26CAAJ",
    "created_at": "2021-03-31T16:59:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509518",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:65'></a>
It would probably be good to revise the ticket summary/description based on https://groups.google.com/g/sage-release/c/fXpbYwaqt9o/m/xYOwhU26CAAJ



---

archive/issue_comments_509519.json:
```json
{
    "body": "<a id='comment:66'></a>\nReplying to [@kwankyu](#comment%3A48):\n> I made a rather drastic change, removing `default_mime()` method, which I don't understand clearly. Instead I rely on the ipython class `DisplayObject` to filter out ipython native objects. \n> \n> It works well with the examples up to now. But I think it is necessary to test extensively in fear of any bad regressions.\n\nBecause of your last paragraph, I think this can't be a blocker for 9.3: it should be one of the first tickets merged in 9.4 instead.",
    "created_at": "2021-03-31T17:24:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509519",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:66'></a>
Replying to [@kwankyu](#comment%3A48):
> I made a rather drastic change, removing `default_mime()` method, which I don't understand clearly. Instead I rely on the ipython class `DisplayObject` to filter out ipython native objects. 
> 
> It works well with the examples up to now. But I think it is necessary to test extensively in fear of any bad regressions.

Because of your last paragraph, I think this can't be a blocker for 9.3: it should be one of the first tickets merged in 9.4 instead.



---

archive/issue_comments_509520.json:
```json
{
    "body": "<a id='comment:67'></a>\nReplying to [@jhpalmieri](#comment%3A66):\n> \n> Because of your last paragraph, I think this can't be a blocker for 9.3: it should be one of the first tickets merged in 9.4 instead.\n\nWell, since this paragraph was written, much more tests have been performed. For instance, the patch has been successfully run on [this notebook](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_black_hole_rendering.ipynb), which mixes latex display, Sage 2d and 3d plots, pure Matplotlib plots via pyplot, PIL images and ipywidgets (progress bars).",
    "created_at": "2021-03-31T20:49:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509520",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:67'></a>
Replying to [@jhpalmieri](#comment%3A66):
> 
> Because of your last paragraph, I think this can't be a blocker for 9.3: it should be one of the first tickets merged in 9.4 instead.

Well, since this paragraph was written, much more tests have been performed. For instance, the patch has been successfully run on [this notebook](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_black_hole_rendering.ipynb), which mixes latex display, Sage 2d and 3d plots, pure Matplotlib plots via pyplot, PIL images and ipywidgets (progress bars).



---

archive/issue_comments_509521.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,12 +1,21 @@\n+This ticket has grown from its initial motive and now solves multiple problems related with Sage rich output. In particular, it \n+\n+- fixes the blocker #31513\n+- fixes the %matplotlib notebook magic, which is broken in a %display latex context in Sage 9.2\n+- performs some code improvement regarding the handling of mathjax\n+\n+The patch has been quite tested with Jupyter notebooks involving various types of Sage objects, Matplotlib objects and ipywidgets. \n+\n+The initial motive, which is the root of the solutions, is\n+\n+---\n Presently mathjax is coupled with latex in Sage. The coupling causes dilemmas because latex is for printing and mathjax is for rendering math in html. We encounter such a dilemma in solving #11362, for example.\n \n This ticket takes mathjax from `sage.misc.latex` and place it properly in `sage.misc.html`.\n \n-The command `view(obj)` is used to view the latex representation of an object.  \n+The command `view(obj)` is used to view the latex representation of an object.  This ticket aims to make  `show(obj)` and `pretty_print(obj)` show the html+mathjax representation of the object. The html+mathjax representation can be made from the latex representation or given by `_html_` method of the object.\n \n-This ticket aims to make  `show(obj)` and `pretty_print(obj)` show the html+mathjax representation of the object. The html+mathjax representation can be made from the latex representation or given by `_html_` method of the object.\n-\n-While we are at it, we also cleaned up old code written for deprecated sage notebook, and solved the problem of #31513.\n+While we are at it, we also cleaned up old code written for deprecated sage notebook.\n \n \n \n``````\n",
    "created_at": "2021-03-31T22:41:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509521",
    "user": "https://github.com/kwankyu"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,12 +1,21 @@
+This ticket has grown from its initial motive and now solves multiple problems related with Sage rich output. In particular, it 
+
+- fixes the blocker #31513
+- fixes the %matplotlib notebook magic, which is broken in a %display latex context in Sage 9.2
+- performs some code improvement regarding the handling of mathjax
+
+The patch has been quite tested with Jupyter notebooks involving various types of Sage objects, Matplotlib objects and ipywidgets. 
+
+The initial motive, which is the root of the solutions, is
+
+---
 Presently mathjax is coupled with latex in Sage. The coupling causes dilemmas because latex is for printing and mathjax is for rendering math in html. We encounter such a dilemma in solving #11362, for example.
 
 This ticket takes mathjax from `sage.misc.latex` and place it properly in `sage.misc.html`.
 
-The command `view(obj)` is used to view the latex representation of an object.  
+The command `view(obj)` is used to view the latex representation of an object.  This ticket aims to make  `show(obj)` and `pretty_print(obj)` show the html+mathjax representation of the object. The html+mathjax representation can be made from the latex representation or given by `_html_` method of the object.
 
-This ticket aims to make  `show(obj)` and `pretty_print(obj)` show the html+mathjax representation of the object. The html+mathjax representation can be made from the latex representation or given by `_html_` method of the object.
-
-While we are at it, we also cleaned up old code written for deprecated sage notebook, and solved the problem of #31513.
+While we are at it, we also cleaned up old code written for deprecated sage notebook.
 
 
 
``````




---

archive/issue_events_382582.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2021-03-31T22:41:54Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "rename": {
        "from": "Divorce MathJax from latex and let it marry html",
        "to": "Fix Sage rich output problems by coupling MathJax with html"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31536#event-382582"
}
```



---

archive/issue_events_382583.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-04-01T19:45:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31536#event-382583"
}
```



---

archive/issue_events_382584.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "3da0a29d9f07dc170a7e142f2d4e695d70f068dc",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-04-01T19:45:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31536#event-382584"
}
```



---

archive/issue_comments_509522.json:
```json
{
    "body": "**Changing branch** from \"[u/klee/31536](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/31536)\" to \"[4c29b9603fe6f4fcc229f9130c7ea5ccc8f3519b](https://github.com/sagemath/sagetrac-mirror/commit/4c29b9603fe6f4fcc229f9130c7ea5ccc8f3519b)\".",
    "created_at": "2021-04-01T19:45:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31536#issuecomment-509522",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/klee/31536](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/31536)" to "[4c29b9603fe6f4fcc229f9130c7ea5ccc8f3519b](https://github.com/sagemath/sagetrac-mirror/commit/4c29b9603fe6f4fcc229f9130c7ea5ccc8f3519b)".
