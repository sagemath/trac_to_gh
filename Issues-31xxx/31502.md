# Issue 31502: GH Actions: Free more disk space

archive/issues_031265.json:
```json
{
    "assignees": [],
    "body": "Some of the docker-based tests run out of disk space, for example\n`ubuntu-focal-standard` (https://github.com/mkoeppe/sage/runs/2116657496).\n\nWe uninstall some large unused preinstalled packages.\n\n\n**CC:**  @kliem @slel\n\n**Keywords:** docker\n\n**Branch/Commit:** [1bed9d5ab1be334afb41f2552b1e99a01e3355b1](https://github.com/sagemath/sagetrac-mirror/commit/1bed9d5ab1be334afb41f2552b1e99a01e3355b1)\n\n**Reviewer:** Jonathan Kliem\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/31502\n\n",
    "closed_at": "2021-04-05T19:42:21Z",
    "created_at": "2021-03-16T01:56:52Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20porting",
        "https://github.com/sagemath/sage/labels/blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "GH Actions: Free more disk space",
    "type": "issue",
    "updated_at": "2021-04-05T19:42:21Z",
    "url": "https://github.com/sagemath/sage/issues/31502",
    "user": "https://github.com/mkoeppe"
}
```
Some of the docker-based tests run out of disk space, for example
`ubuntu-focal-standard` (https://github.com/mkoeppe/sage/runs/2116657496).

We uninstall some large unused preinstalled packages.


**CC:**  @kliem @slel

**Keywords:** docker

**Branch/Commit:** [1bed9d5ab1be334afb41f2552b1e99a01e3355b1](https://github.com/sagemath/sagetrac-mirror/commit/1bed9d5ab1be334afb41f2552b1e99a01e3355b1)

**Reviewer:** Jonathan Kliem

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/31502





---

archive/issue_comments_508561.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"docker\".",
    "created_at": "2021-03-16T09:22:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508561",
    "user": "https://github.com/slel"
}
```

**Changing keywords** from "" to "docker".



---

archive/issue_comments_508562.json:
```json
{
    "body": "<a id='comment:1'></a>\nPossibly related: #29849.",
    "created_at": "2021-03-16T09:22:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508562",
    "user": "https://github.com/slel"
}
```

<a id='comment:1'></a>
Possibly related: #29849.



---

archive/issue_comments_508563.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/gh_actions__free_more_disk_space](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions__free_more_disk_space)",
    "created_at": "2021-03-17T04:27:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508563",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/gh_actions__free_more_disk_space](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions__free_more_disk_space)



---

archive/issue_events_282579.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-17T04:29:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31502#event-282579"
}
```



---

archive/issue_comments_508564.json:
```json
{
    "body": "**Commit:** [1bed9d5ab1be334afb41f2552b1e99a01e3355b1](https://github.com/sagemath/sagetrac-mirror/commit/1bed9d5ab1be334afb41f2552b1e99a01e3355b1)",
    "created_at": "2021-03-17T04:29:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508564",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [1bed9d5ab1be334afb41f2552b1e99a01e3355b1](https://github.com/sagemath/sagetrac-mirror/commit/1bed9d5ab1be334afb41f2552b1e99a01e3355b1)



---

archive/issue_comments_508565.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2021-03-17T04:29:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508565",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_508566.json:
```json
{
    "body": "<a id='comment:3'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1bed9d5ab1be334afb41f2552b1e99a01e3355b1\">1bed9d5</a></td><td><code>.github/workflows/tox*.yml: Free more disk space</code></td></tr></table>\n",
    "created_at": "2021-03-17T04:29:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508566",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1bed9d5ab1be334afb41f2552b1e99a01e3355b1">1bed9d5</a></td><td><code>.github/workflows/tox*.yml: Free more disk space</code></td></tr></table>




---

archive/issue_comments_508567.json:
```json
{
    "body": "<a id='comment:4'></a>\nThis can be seen in action in https://github.com/mkoeppe/sage/runs/2127941282 (see output in \"free disk space\" and \"install test prerequisites\" - it frees about 7GB of space.",
    "created_at": "2021-03-17T19:46:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508567",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
This can be seen in action in https://github.com/mkoeppe/sage/runs/2127941282 (see output in "free disk space" and "install test prerequisites" - it frees about 7GB of space.



---

archive/issue_comments_508568.json:
```json
{
    "body": "**Reviewer:** https://github.com/mkoeppe/sage/runs/2127941282",
    "created_at": "2021-03-17T19:46:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508568",
    "user": "https://github.com/mkoeppe"
}
```

**Reviewer:** https://github.com/mkoeppe/sage/runs/2127941282



---

archive/issue_comments_508569.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,5 @@\n Some of the docker-based tests run out of disk space, for example\n `ubuntu-focal-standard` (https://github.com/mkoeppe/sage/runs/2116657496).\n \n+We uninstall some large unused preinstalled packages.\n \n``````\n",
    "created_at": "2021-03-17T19:46:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508569",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,5 @@
 Some of the docker-based tests run out of disk space, for example
 `ubuntu-focal-standard` (https://github.com/mkoeppe/sage/runs/2116657496).
 
+We uninstall some large unused preinstalled packages.
 
``````




---

archive/issue_comments_508570.json:
```json
{
    "body": "<a id='comment:5'></a>\nFixes `ubuntu-focal-standard` - as can be seen in https://github.com/mkoeppe/sage/runs/2135025352",
    "created_at": "2021-03-18T06:11:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508570",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Fixes `ubuntu-focal-standard` - as can be seen in https://github.com/mkoeppe/sage/runs/2135025352



---

archive/issue_comments_508571.json:
```json
{
    "body": "<a id='comment:6'></a>\nLGTM.",
    "created_at": "2021-03-23T08:58:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508571",
    "user": "https://github.com/kliem"
}
```

<a id='comment:6'></a>
LGTM.



---

archive/issue_events_282580.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-23T08:58:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31502#event-282580"
}
```



---

archive/issue_events_282581.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-23T08:58:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31502#event-282581"
}
```



---

archive/issue_comments_508572.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/runs/2127941282\" to \"Jonathan Kliem\".",
    "created_at": "2021-03-23T08:58:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508572",
    "user": "https://github.com/kliem"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/runs/2127941282" to "Jonathan Kliem".



---

archive/issue_comments_508573.json:
```json
{
    "body": "<a id='comment:7'></a>\nThanks!",
    "created_at": "2021-03-23T17:19:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508573",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Thanks!



---

archive/issue_comments_508574.json:
```json
{
    "body": "<a id='comment:8'></a>\nSetting priority to blocker to bring this ticket to the attention of the release bot.",
    "created_at": "2021-03-29T23:54:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508574",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
Setting priority to blocker to bring this ticket to the attention of the release bot.



---

archive/issue_events_282582.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-29T23:54:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "label": "https://github.com/sagemath/sage/labels/critical",
    "label_color": "ff0000",
    "label_name": "critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31502#event-282582"
}
```



---

archive/issue_events_282583.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-29T23:54:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "label": "https://github.com/sagemath/sage/labels/blocker",
    "label_color": "ff0000",
    "label_name": "blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31502#event-282583"
}
```



---

archive/issue_events_282584.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-31T23:00:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "label": "https://github.com/sagemath/sage/labels/blocker",
    "label_color": "ff0000",
    "label_name": "blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31502#event-282584"
}
```



---

archive/issue_events_282585.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-01T00:12:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "label": "https://github.com/sagemath/sage/labels/blocker",
    "label_color": "ff0000",
    "label_name": "blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31502#event-282585"
}
```



---

archive/issue_comments_508575.json:
```json
{
    "body": "<a id='comment:10'></a>\nObviously a blocker because it blocks us from demonstrating that Sage builds and tests correctly on the supported platform `ubuntu-focal-standard`.",
    "created_at": "2021-04-01T00:12:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508575",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Obviously a blocker because it blocks us from demonstrating that Sage builds and tests correctly on the supported platform `ubuntu-focal-standard`.



---

archive/issue_comments_508576.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [@mkoeppe](#comment%3A10):\n> Obviously a blocker because it blocks us from demonstrating that Sage builds and tests correctly on the supported platform `ubuntu-focal-standard`.\n\nThis ticket only changes files in `.github/workflows/`\nThis ticket can't break anything but the github workflows itself (and it doesn't break those).",
    "created_at": "2021-04-01T06:15:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508576",
    "user": "https://github.com/kliem"
}
```

<a id='comment:11'></a>
Replying to [@mkoeppe](#comment%3A10):
> Obviously a blocker because it blocks us from demonstrating that Sage builds and tests correctly on the supported platform `ubuntu-focal-standard`.

This ticket only changes files in `.github/workflows/`
This ticket can't break anything but the github workflows itself (and it doesn't break those).



---

archive/issue_comments_508577.json:
```json
{
    "body": "<a id='comment:12'></a>\nHow likely it is to break things is the wrong question. Instead, ask yourself: Is this ticket important enough so that everyone else's ticket should wait another week before it can get merged, so we can have an additional rc round.",
    "created_at": "2021-04-01T16:32:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508577",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'></a>
How likely it is to break things is the wrong question. Instead, ask yourself: Is this ticket important enough so that everyone else's ticket should wait another week before it can get merged, so we can have an additional rc round.



---

archive/issue_comments_508578.json:
```json
{
    "body": "<a id='comment:13'></a>\nYes, a fully working portability testing infrastructure is crucial to making a release that will be in use for the next 1/2 year.",
    "created_at": "2021-04-01T16:50:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508578",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
Yes, a fully working portability testing infrastructure is crucial to making a release that will be in use for the next 1/2 year.



---

archive/issue_comments_508579.json:
```json
{
    "body": "<a id='comment:14'></a>\nHere's an idea: If a positively reviewed ticket only modifies `/.github/` or `/tox.ini`, just merge it and don't count it to whatever batch size or limits you use in your merge scripts. -- After all, your build scripts do not test anything involving these files.",
    "created_at": "2021-04-01T16:55:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508579",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
Here's an idea: If a positively reviewed ticket only modifies `/.github/` or `/tox.ini`, just merge it and don't count it to whatever batch size or limits you use in your merge scripts. -- After all, your build scripts do not test anything involving these files.



---

archive/issue_comments_508580.json:
```json
{
    "body": "<a id='comment:15'></a>\nThe same idea would probably also apply to `/.ci/`, `/.circleci/`, `/.gitlab-ci.yml`, and `/docker/` -- except these see a lot less activity as the maintainers seem to have disappeared.",
    "created_at": "2021-04-01T16:59:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508580",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
The same idea would probably also apply to `/.ci/`, `/.circleci/`, `/.gitlab-ci.yml`, and `/docker/` -- except these see a lot less activity as the maintainers seem to have disappeared.



---

archive/issue_comments_508581.json:
```json
{
    "body": "<a id='comment:16'></a>\nLook, I appreciate what you are doing. But you need more frequent releases, not a more drawn-out release process so we can wait until everyone has their pet ticket merged.",
    "created_at": "2021-04-01T19:58:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508581",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'></a>
Look, I appreciate what you are doing. But you need more frequent releases, not a more drawn-out release process so we can wait until everyone has their pet ticket merged.



---

archive/issue_comments_508582.json:
```json
{
    "body": "<a id='comment:17'></a>\nVolker, I had hoped for a substantial response to comments 14/15.",
    "created_at": "2021-04-01T20:07:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508582",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Volker, I had hoped for a substantial response to comments 14/15.



---

archive/issue_comments_508583.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/gh_actions__free_more_disk_space](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions__free_more_disk_space)\" to \"[1bed9d5ab1be334afb41f2552b1e99a01e3355b1](https://github.com/sagemath/sagetrac-mirror/commit/1bed9d5ab1be334afb41f2552b1e99a01e3355b1)\".",
    "created_at": "2021-04-05T19:42:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31502#issuecomment-508583",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/gh_actions__free_more_disk_space](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions__free_more_disk_space)" to "[1bed9d5ab1be334afb41f2552b1e99a01e3355b1](https://github.com/sagemath/sagetrac-mirror/commit/1bed9d5ab1be334afb41f2552b1e99a01e3355b1)".



---

archive/issue_events_282586.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-04-05T19:42:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31502#event-282586"
}
```



---

archive/issue_events_282587.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "70711cf13d0d95251ed6822f4a30ca38c484ed94",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-04-05T19:42:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31502",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31502#event-282587"
}
```
