# Issue 31227: Accept /usr/bin/python3 from XCode 12.3 on macOS 10.15 (Catalina) and 11 (Big Sur)

archive/issues_030990.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\n(from #31132)\n\n#27122 determines whether CC accepts `-march=native` and then adds it globally to `CFLAGS` in `build/bin/sage-build-env`.\n\n#30725 fixes this for macOS, where some packages are explicitly built with `clang`.\n\nHowever, there is another mechanism how `clang` can come in: Python extension modules are compiled with the compiler listed in sysconfig. On macOS with homebrew, using `/usr/bin/python3`, this could again be `clang`, which does not accept `-march=native` in combination with `-arch arm64` (which is provided even on x86_64 if `ARCHFLAGS` is unset).\n\nIn this ticket, we fix this by checking whether the compiler used by distutils accepts `-march=native` (or more generally, the flags determined earlier by `configure`). If it does not, then we disable the use of these flags.\n\nIn order to test this with `/usr/bin/python3` from XCode 12.3 (on macOS 10.15 (Catalina)), we fix another issue:\nThis python3 (3.8.2) is not able to build extension modules because it emits `-arch arm64 -arch x86_64` unless `ARCHFLAGS` is set explicitly\n\n```\n$ /usr/bin/python3 -m sysconfig |grep '\\bCFLAGS ='\n\tCFLAGS = \"-Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers -arch arm64 -arch x86_64\"\n\n$ ARCHFLAGS=\"\" /usr/bin/python3 -m sysconfig |grep '\\bCFLAGS ='\n\tCFLAGS = \"-Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers  -arch x86_64 \"\n```\n\nIn this ticket, if the distutils test fails, we try if setting `ARCHFLAGS=\"\"` fixes it.  Also, after accepting a system python and `ARCHFLAGS` so far has not been set, we test whether the system python wants to do the multi-arch build.\n\nIn either of these two cases, we store a configuration variable that causes `sage-env` to set `ARCHFLAGS` as well.\n\nThis is somewhat complicated logic - we are tiptoeing around previous breakage that had been caused by setting `ARCHFLAGS` unconditionally (#29408).\n\n\n\nDepends on #31132\nDepends on #30725\n\nCC:  @jhpalmieri @zlscherr @dimpase @kliem @vbraun\n\nComponent: **build: configure**\n\nAuthor: **Matthias Koeppe**\n\nBranch/Commit: **[`fc8b676`](https://github.com/sagemath/sagetrac-mirror/commit/fc8b67644bada9ea52cbb7c91f53f763ca84f4bb)**\n\nReviewer: **Jonathan Kliem**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31227_\n\n",
    "closed_at": "2021-02-20T10:46:52Z",
    "created_at": "2021-01-13T01:31:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Accept /usr/bin/python3 from XCode 12.3 on macOS 10.15 (Catalina) and 11 (Big Sur)",
    "type": "issue",
    "updated_at": "2021-02-20T10:46:52Z",
    "url": "https://github.com/sagemath/sage/issues/31227",
    "user": "https://github.com/mkoeppe"
}
```
<div id="comment:0"></div>

(from #31132)

#27122 determines whether CC accepts `-march=native` and then adds it globally to `CFLAGS` in `build/bin/sage-build-env`.

#30725 fixes this for macOS, where some packages are explicitly built with `clang`.

However, there is another mechanism how `clang` can come in: Python extension modules are compiled with the compiler listed in sysconfig. On macOS with homebrew, using `/usr/bin/python3`, this could again be `clang`, which does not accept `-march=native` in combination with `-arch arm64` (which is provided even on x86_64 if `ARCHFLAGS` is unset).

In this ticket, we fix this by checking whether the compiler used by distutils accepts `-march=native` (or more generally, the flags determined earlier by `configure`). If it does not, then we disable the use of these flags.

In order to test this with `/usr/bin/python3` from XCode 12.3 (on macOS 10.15 (Catalina)), we fix another issue:
This python3 (3.8.2) is not able to build extension modules because it emits `-arch arm64 -arch x86_64` unless `ARCHFLAGS` is set explicitly

```
$ /usr/bin/python3 -m sysconfig |grep '\bCFLAGS ='
	CFLAGS = "-Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers -arch arm64 -arch x86_64"

$ ARCHFLAGS="" /usr/bin/python3 -m sysconfig |grep '\bCFLAGS ='
	CFLAGS = "-Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers  -arch x86_64 "
```

In this ticket, if the distutils test fails, we try if setting `ARCHFLAGS=""` fixes it.  Also, after accepting a system python and `ARCHFLAGS` so far has not been set, we test whether the system python wants to do the multi-arch build.

In either of these two cases, we store a configuration variable that causes `sage-env` to set `ARCHFLAGS` as well.

This is somewhat complicated logic - we are tiptoeing around previous breakage that had been caused by setting `ARCHFLAGS` unconditionally (#29408).



Depends on #31132
Depends on #30725

CC:  @jhpalmieri @zlscherr @dimpase @kliem @vbraun

Component: **build: configure**

Author: **Matthias Koeppe**

Branch/Commit: **[`fc8b676`](https://github.com/sagemath/sagetrac-mirror/commit/fc8b67644bada9ea52cbb7c91f53f763ca84f4bb)**

Reviewer: **Jonathan Kliem**

_Issue created by migration from https://trac.sagemath.org/ticket/31227_





---

archive/issue_events_427212.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-13T01:31:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31227#event-427212"
}
```



---

archive/issue_events_427213.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-13T01:31:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
    "label_color": "0000b0",
    "label_name": "c: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31227#event-427213"
}
```



---

archive/issue_events_427214.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-13T01:31:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31227#event-427214"
}
```



---

archive/issue_events_427215.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-13T01:31:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31227#event-427215"
}
```



---

archive/issue_comments_500208.json:
```json
{
    "body": "Dependencies: **#31132**",
    "created_at": "2021-01-13T01:54:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500208",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#31132**



---

archive/issue_comments_500209.json:
```json
{
    "body": "Branch: **[u/mkoeppe/accept__usr_bin_python3_from_xcode_12_3_on_macos_10_15__catalina_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/accept__usr_bin_python3_from_xcode_12_3_on_macos_10_15__catalina_)**",
    "created_at": "2021-01-13T01:56:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500209",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/accept__usr_bin_python3_from_xcode_12_3_on_macos_10_15__catalina_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/accept__usr_bin_python3_from_xcode_12_3_on_macos_10_15__catalina_)**



---

archive/issue_comments_500210.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2c6002555d21e242ab5d1e25e4d1f3851e246532\"><code>2c60025</code></a></td><td><code>m4/sage_check_python_for_venv.m4: Warn if python3 is misconfigured like it is currently in homebrew</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ee679bd57302d8e422e76b422d73f83ab87a4293\"><code>ee679bd</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Do not check sysconfig CPPFLAGS so that /usr/bin/python3 is accepted on macOS; reject broken homebrew python3 unless requested explicitly with configgure --with-python=...</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29aee87fc01f6fce3cc4356c98f27c44e4ce2b5b\"><code>29aee87</code></a></td><td><code>build/pkgs/python3: Update to 3.9.0rc2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e61d464292262d80c43895c64fce4f48a6895822\"><code>e61d464</code></a></td><td><code>build/pkgs/python3: Update to 3.9.0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f8bb56d16600c8cfe1bab1d127f3931ca280dff0\"><code>f8bb56d</code></a></td><td><code>build/pkgs/python3: Update to 3.9.1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0e3513fcb3e2efa1832db8bd7957a93ad75b215c\"><code>0e3513f</code></a></td><td><code>build/pkgs/pip: Update to 20.3.3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/41d7e7a74441e5f9deb3e7a93adfccf486dde417\"><code>41d7e7a</code></a></td><td><code>Merge branch 'u/jhpalmieri/new_wheel' of git://trac.sagemath.org/sage into t/30589/upgrade-python-3.9</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/76d5fd15f9bcc50a478471182f70ba8d46bf4319\"><code>76d5fd1</code></a></td><td><code>Merge branch 't/30589/upgrade-python-3.9' into t/31132/homebrew__unused_packages__singular__pari_______in__usr_local_leak_into_build_when_using_homebrew_s_python3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce3481061b6308e730004ed461f8a86341249db1\"><code>ce34810</code></a></td><td><code>m4/sage_check_python_for_venv.m4: Use empty ARCHFLAGS while testing distutils</code></td></tr></table>\n",
    "created_at": "2021-01-14T04:18:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500210",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:3"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2c6002555d21e242ab5d1e25e4d1f3851e246532"><code>2c60025</code></a></td><td><code>m4/sage_check_python_for_venv.m4: Warn if python3 is misconfigured like it is currently in homebrew</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ee679bd57302d8e422e76b422d73f83ab87a4293"><code>ee679bd</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Do not check sysconfig CPPFLAGS so that /usr/bin/python3 is accepted on macOS; reject broken homebrew python3 unless requested explicitly with configgure --with-python=...</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29aee87fc01f6fce3cc4356c98f27c44e4ce2b5b"><code>29aee87</code></a></td><td><code>build/pkgs/python3: Update to 3.9.0rc2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e61d464292262d80c43895c64fce4f48a6895822"><code>e61d464</code></a></td><td><code>build/pkgs/python3: Update to 3.9.0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f8bb56d16600c8cfe1bab1d127f3931ca280dff0"><code>f8bb56d</code></a></td><td><code>build/pkgs/python3: Update to 3.9.1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0e3513fcb3e2efa1832db8bd7957a93ad75b215c"><code>0e3513f</code></a></td><td><code>build/pkgs/pip: Update to 20.3.3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/41d7e7a74441e5f9deb3e7a93adfccf486dde417"><code>41d7e7a</code></a></td><td><code>Merge branch 'u/jhpalmieri/new_wheel' of git://trac.sagemath.org/sage into t/30589/upgrade-python-3.9</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/76d5fd15f9bcc50a478471182f70ba8d46bf4319"><code>76d5fd1</code></a></td><td><code>Merge branch 't/30589/upgrade-python-3.9' into t/31132/homebrew__unused_packages__singular__pari_______in__usr_local_leak_into_build_when_using_homebrew_s_python3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce3481061b6308e730004ed461f8a86341249db1"><code>ce34810</code></a></td><td><code>m4/sage_check_python_for_venv.m4: Use empty ARCHFLAGS while testing distutils</code></td></tr></table>




---

archive/issue_comments_500211.json:
```json
{
    "body": "Changed dependencies from **#31132** to **#31132, #31228**",
    "created_at": "2021-01-14T04:18:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500211",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#31132** to **#31132, #31228**



---

archive/issue_comments_500212.json:
```json
{
    "body": "Commit: **[`ce34810`](https://github.com/sagemath/sagetrac-mirror/commit/ce3481061b6308e730004ed461f8a86341249db1)**",
    "created_at": "2021-01-14T04:18:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500212",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`ce34810`](https://github.com/sagemath/sagetrac-mirror/commit/ce3481061b6308e730004ed461f8a86341249db1)**



---

archive/issue_comments_500213.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1b16a8c4884fd6eb464b94121b29990b0cc4dff8\"><code>1b16a8c</code></a></td><td><code>build/pkgs/pari/spkg-install.in: Do not recompute MACOSX_VERSION</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c6e30eab754c20f53ceef40508a223c590f06cb1\"><code>c6e30ea</code></a></td><td><code>tox.ini: Add configuration factors gcc_10, gcc_11</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b0eb15897bbde3ad5e440b26d714f637516e91d\"><code>9b0eb15</code></a></td><td><code>build/pkgs/{cmake,curl,psutil,python3,r}: If setting CC=clang, also set CFLAGS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05985d85d6f1e0d570ed3882b1f5ccf019e28673\"><code>05985d8</code></a></td><td><code>Merge branch 't/30725/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_' into t/31228/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/02c268457164b76ddd97bece691111725dddf6c0\"><code>02c2684</code></a></td><td><code>R is already compiled without -march=native</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/24b4fcca7179e0b857d3599d7ccf086e37c1d464\"><code>24b4fcc</code></a></td><td><code>set EXTRACFLAGS instead of CFLAGS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/44be9671b85348db09046fa0c720812bfe7393a1\"><code>44be967</code></a></td><td><code>make code a bit more stable against future changes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f56e65e25f23e69aee0d37080c046d36d7f349ed\"><code>f56e65e</code></a></td><td><code>fix CFLAGS for python3/spkg-build.in by running testcflags.sh after determination of the compiler</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/09b03d2dbf209d705cb882edd5987d9096cb80ef\"><code>09b03d2</code></a></td><td><code>Merge branch 'u/gh-kliem/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_' of git://trac.sagemath.org/sage into t/31228/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/67d66b74baa03829defe3f0721e79d8603ce34d8\"><code>67d66b7</code></a></td><td><code>Merge branch 't/31228/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built' into t/31227/accept__usr_bin_python3_from_xcode_12_3_on_macos_10_15__catalina_</code></td></tr></table>\n",
    "created_at": "2021-01-23T20:22:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500213",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1b16a8c4884fd6eb464b94121b29990b0cc4dff8"><code>1b16a8c</code></a></td><td><code>build/pkgs/pari/spkg-install.in: Do not recompute MACOSX_VERSION</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c6e30eab754c20f53ceef40508a223c590f06cb1"><code>c6e30ea</code></a></td><td><code>tox.ini: Add configuration factors gcc_10, gcc_11</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b0eb15897bbde3ad5e440b26d714f637516e91d"><code>9b0eb15</code></a></td><td><code>build/pkgs/{cmake,curl,psutil,python3,r}: If setting CC=clang, also set CFLAGS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05985d85d6f1e0d570ed3882b1f5ccf019e28673"><code>05985d8</code></a></td><td><code>Merge branch 't/30725/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_' into t/31228/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/02c268457164b76ddd97bece691111725dddf6c0"><code>02c2684</code></a></td><td><code>R is already compiled without -march=native</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/24b4fcca7179e0b857d3599d7ccf086e37c1d464"><code>24b4fcc</code></a></td><td><code>set EXTRACFLAGS instead of CFLAGS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/44be9671b85348db09046fa0c720812bfe7393a1"><code>44be967</code></a></td><td><code>make code a bit more stable against future changes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f56e65e25f23e69aee0d37080c046d36d7f349ed"><code>f56e65e</code></a></td><td><code>fix CFLAGS for python3/spkg-build.in by running testcflags.sh after determination of the compiler</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/09b03d2dbf209d705cb882edd5987d9096cb80ef"><code>09b03d2</code></a></td><td><code>Merge branch 'u/gh-kliem/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_' of git://trac.sagemath.org/sage into t/31228/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/67d66b74baa03829defe3f0721e79d8603ce34d8"><code>67d66b7</code></a></td><td><code>Merge branch 't/31228/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built' into t/31227/accept__usr_bin_python3_from_xcode_12_3_on_macos_10_15__catalina_</code></td></tr></table>




---

archive/issue_comments_500214.json:
```json
{
    "body": "Changed commit from **[`ce34810`](https://github.com/sagemath/sagetrac-mirror/commit/ce3481061b6308e730004ed461f8a86341249db1)** to **[`67d66b7`](https://github.com/sagemath/sagetrac-mirror/commit/67d66b74baa03829defe3f0721e79d8603ce34d8)**",
    "created_at": "2021-01-23T20:22:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500214",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ce34810`](https://github.com/sagemath/sagetrac-mirror/commit/ce3481061b6308e730004ed461f8a86341249db1)** to **[`67d66b7`](https://github.com/sagemath/sagetrac-mirror/commit/67d66b74baa03829defe3f0721e79d8603ce34d8)**



---

archive/issue_comments_500215.json:
```json
{
    "body": "Changed dependencies from **#31132, #31228** to **#31132, #30725, #31228**",
    "created_at": "2021-01-23T20:23:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500215",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#31132, #31228** to **#31132, #30725, #31228**



---

archive/issue_comments_500216.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3325a4e4cef11e7b2f9946fd0db143f1c0157af3\"><code>3325a4e</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Actually test with CFLAGS=$CFLAGS_MARCH</code></td></tr></table>\n",
    "created_at": "2021-01-23T20:27:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500216",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3325a4e4cef11e7b2f9946fd0db143f1c0157af3"><code>3325a4e</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Actually test with CFLAGS=$CFLAGS_MARCH</code></td></tr></table>




---

archive/issue_comments_500217.json:
```json
{
    "body": "Changed commit from **[`67d66b7`](https://github.com/sagemath/sagetrac-mirror/commit/67d66b74baa03829defe3f0721e79d8603ce34d8)** to **[`3325a4e`](https://github.com/sagemath/sagetrac-mirror/commit/3325a4e4cef11e7b2f9946fd0db143f1c0157af3)**",
    "created_at": "2021-01-23T20:27:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500217",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`67d66b7`](https://github.com/sagemath/sagetrac-mirror/commit/67d66b74baa03829defe3f0721e79d8603ce34d8)** to **[`3325a4e`](https://github.com/sagemath/sagetrac-mirror/commit/3325a4e4cef11e7b2f9946fd0db143f1c0157af3)**



---

archive/issue_events_427216.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-23T20:30:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31227#event-427216"
}
```



---

archive/issue_comments_500218.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThis is the branch that I had. I won't have time to work on it over the next week.",
    "created_at": "2021-01-23T20:30:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500218",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

This is the branch that I had. I won't have time to work on it over the next week.



---

archive/issue_comments_500219.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,5 +10,6 @@\n egret:~/s/sage/sage-rebasing/worktree-algebraic-2018-spring (t/31132/homebrew__unused_packages__singular__pari_______in__usr_local_leak_into_build_when_using_homebrew_s_python3 *\n ```\n \n-In this ticket, we set `ARCHFLAGS` during this configure step... \n+In this ticket, we set `ARCHFLAGS` during this configure step.\n+ \n \n``````\n",
    "created_at": "2021-01-23T20:30:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500219",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,5 +10,6 @@
 egret:~/s/sage/sage-rebasing/worktree-algebraic-2018-spring (t/31132/homebrew__unused_packages__singular__pari_______in__usr_local_leak_into_build_when_using_homebrew_s_python3 *
 ```
 
-In this ticket, we set `ARCHFLAGS` during this configure step... 
+In this ticket, we set `ARCHFLAGS` during this configure step.
+ 
 
``````




---

archive/issue_comments_500220.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2021-01-23T20:30:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500220",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_500221.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nIt was proposed to mark #31228 as invalid and do it all here. In this case (and it is in fact already done here).\n\nIn this case, this ticket here is really ready for review (and the depency of #31228 could be removed).",
    "created_at": "2021-01-25T06:55:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500221",
    "user": "https://github.com/kliem"
}
```

<div id="comment:9" align="right">comment:9</div>

It was proposed to mark #31228 as invalid and do it all here. In this case (and it is in fact already done here).

In this case, this ticket here is really ready for review (and the depency of #31228 could be removed).



---

archive/issue_comments_500222.json:
```json
{
    "body": "Reviewer: **https://github.com/kliem/sage/pull/36/checks, Jonathan Kliem**",
    "created_at": "2021-01-25T07:04:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500222",
    "user": "https://github.com/kliem"
}
```

Reviewer: **https://github.com/kliem/sage/pull/36/checks, Jonathan Kliem**



---

archive/issue_comments_500223.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI'm happy with this ticket, but I will have to wait and see if things work out in practice.",
    "created_at": "2021-01-25T07:04:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500223",
    "user": "https://github.com/kliem"
}
```

<div id="comment:10" align="right">comment:10</div>

I'm happy with this ticket, but I will have to wait and see if things work out in practice.



---

archive/issue_events_427217.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-25T19:22:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31227#event-427217"
}
```



---

archive/issue_events_427218.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-25T19:22:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31227#event-427218"
}
```



---

archive/issue_comments_500224.json:
```json
{
    "body": "Changed dependencies from **#31132, #30725, #31228** to **#31132, #30725**",
    "created_at": "2021-01-25T19:31:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500224",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#31132, #30725, #31228** to **#31132, #30725**



---

archive/issue_comments_500225.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,14 @@\n (from #31132)\n \n+#27122 determines whether CC accepts `-march=native` and then adds it globally to `CFLAGS` in `build/bin/sage-build-env`.\n+\n+#30725 fixes this for macOS, where some packages are explicitly built with `clang`.\n+\n+However, there is another mechanism how `clang` can come in: Python extension modules are compiled with the compiler listed in sysconfig. On macOS with homebrew, using `/usr/bin/python3`, this could again be `clang`, which does not accept `-march=native`.\n+\n+In this ticket, we fix this by checking whether the compiler used by distutils accepts `-march=native` (or more generally, the flags determined earlier by `configure`). If it does not, then we disable the use of these flags.\n+\n+In order to test this with `/usr/bin/python3` from XCode 12.3 (on macOS 10.15 (Catalina)), we fix another issue:\n This python3 (3.8.2) is not able to build extension modules because it emits `-arch arm64 -arch x86_64` unless `ARCHFLAGS` is set explicitly\n \n ```\n``````\n",
    "created_at": "2021-01-25T19:31:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500225",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,14 @@
 (from #31132)
 
+#27122 determines whether CC accepts `-march=native` and then adds it globally to `CFLAGS` in `build/bin/sage-build-env`.
+
+#30725 fixes this for macOS, where some packages are explicitly built with `clang`.
+
+However, there is another mechanism how `clang` can come in: Python extension modules are compiled with the compiler listed in sysconfig. On macOS with homebrew, using `/usr/bin/python3`, this could again be `clang`, which does not accept `-march=native`.
+
+In this ticket, we fix this by checking whether the compiler used by distutils accepts `-march=native` (or more generally, the flags determined earlier by `configure`). If it does not, then we disable the use of these flags.
+
+In order to test this with `/usr/bin/python3` from XCode 12.3 (on macOS 10.15 (Catalina)), we fix another issue:
 This python3 (3.8.2) is not able to build extension modules because it emits `-arch arm64 -arch x86_64` unless `ARCHFLAGS` is set explicitly
 
 ```
``````




---

archive/issue_comments_500226.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nWith this branch, `./configure --with-python=/usr/bin/python3` fails for me on OS X Catalina with Xcode 12.3. See attached `config.log`.",
    "created_at": "2021-01-25T23:23:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500226",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:13" align="right">comment:13</div>

With this branch, `./configure --with-python=/usr/bin/python3` fails for me on OS X Catalina with Xcode 12.3. See attached `config.log`.



---

archive/issue_comments_500227.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nDid you run `bootstrap`?",
    "created_at": "2021-01-26T04:34:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500227",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:14" align="right">comment:14</div>

Did you run `bootstrap`?



---

archive/issue_comments_500228.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@mkoeppe](#comment%3A14):\n> Did you run `bootstrap`?\n\nNo, sorry for the false report. Having run `./bootstrap`, and with `local/bin/python3` a symlink pointing to `/Applications/Xcode.app/Contents/Developer/usr/bin/python3`, the build has now failed twice: `Pillow` and `cython` have both failed to build.",
    "created_at": "2021-01-26T22:57:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500228",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@mkoeppe](#comment%3A14):
> Did you run `bootstrap`?

No, sorry for the false report. Having run `./bootstrap`, and with `local/bin/python3` a symlink pointing to `/Applications/Xcode.app/Contents/Developer/usr/bin/python3`, the build has now failed twice: `Pillow` and `cython` have both failed to build.



---

archive/issue_comments_500229.json:
```json
{
    "body": "Attachment: **[pillow-8.0.1.log](https://github.com/sagemath/sage/files/ticket31227/pillow-8.0.1.log)**",
    "created_at": "2021-01-26T22:58:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500229",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[pillow-8.0.1.log](https://github.com/sagemath/sage/files/ticket31227/pillow-8.0.1.log)**



---

archive/issue_comments_500230.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAttachment: **[cython-0.29.21.log](https://github.com/sagemath/sage/files/ticket31227/cython-0.29.21.log)**\n\nOh, and `gmpy2`, also.",
    "created_at": "2021-01-26T23:03:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500230",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

Attachment: **[cython-0.29.21.log](https://github.com/sagemath/sage/files/ticket31227/cython-0.29.21.log)**

Oh, and `gmpy2`, also.



---

archive/issue_comments_500231.json:
```json
{
    "body": "Attachment: **[gmpy2-2.1.0b5.log](https://github.com/sagemath/sage/files/ticket31227/gmpy2-2.1.0b5.log)**",
    "created_at": "2021-01-26T23:03:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500231",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[gmpy2-2.1.0b5.log](https://github.com/sagemath/sage/files/ticket31227/gmpy2-2.1.0b5.log)**



---

archive/issue_comments_500232.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nOK, looks like we have to set `ARCHFLAGS=\"\"` in more places. But this needs to be done very carefully - see #29408",
    "created_at": "2021-01-26T23:44:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500232",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">comment:17</div>

OK, looks like we have to set `ARCHFLAGS=""` in more places. But this needs to be done very carefully - see #29408



---

archive/issue_comments_500233.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI ran `make -k` to get a fuller report, and it ended with:\n\n```\n* package:         gmpy2-2.1.0b5\n  last build time: Jan 26 15:52\n  log file:        /Users/jpalmier/Desktop/Sage/git/sage/logs/pkgs/gmpy2-2.1.0b5.log\n  build directory: /Users/jpalmier/Desktop/Sage/git/sage/local/var/tmp/sage/build/gmpy2-2.1.0b5\n\n* package:         cython-0.29.21\n  last build time: Jan 26 15:52\n  log file:        /Users/jpalmier/Desktop/Sage/git/sage/logs/pkgs/cython-0.29.21.log\n  build directory: /Users/jpalmier/Desktop/Sage/git/sage/local/var/tmp/sage/build/cython-0.29.21\n\n* package:         psutil-5.2.0.p2\n  last build time: Jan 26 15:52\n  log file:        /Users/jpalmier/Desktop/Sage/git/sage/logs/pkgs/psutil-5.2.0.p2.log\n  build directory: /Users/jpalmier/Desktop/Sage/git/sage/local/var/tmp/sage/build/psutil-5.2.0.p2\n\n* package:         pillow-8.0.1\n  last build time: Jan 26 15:52\n  log file:        /Users/jpalmier/Desktop/Sage/git/sage/logs/pkgs/pillow-8.0.1.log\n  build directory: /Users/jpalmier/Desktop/Sage/git/sage/local/var/tmp/sage/build/pillow-8.0.1\n\n* package:         kiwisolver-1.0.1\n  last build time: Jan 26 15:52\n  log file:        /Users/jpalmier/Desktop/Sage/git/sage/logs/pkgs/kiwisolver-1.0.1.log\n  build directory: /Users/jpalmier/Desktop/Sage/git/sage/local/var/tmp/sage/build/kiwisolver-1.0.1\n\n* package:         pynac-0.7.26.sage-2020-04-03.p0\n  last build time: Jan 26 15:53\n  log file:        /Users/jpalmier/Desktop/Sage/git/sage/logs/pkgs/pynac-0.7.26.sage-2020-04-03.p0.log\n  build directory: /Users/jpalmier/Desktop/Sage/git/sage/local/var/tmp/sage/build/pynac-0.7.26.sage-2020-04-03.p0\n\n* package:         cffi-1.14.4\n  last build time: Jan 26 15:53\n  log file:        /Users/jpalmier/Desktop/Sage/git/sage/logs/pkgs/cffi-1.14.4.log\n  build directory: /Users/jpalmier/Desktop/Sage/git/sage/local/var/tmp/sage/build/cffi-1.14.4\n```\nAll show the same error, \"clang: error: the clang compiler does not support '-march=native'\".",
    "created_at": "2021-01-27T00:02:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500233",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">comment:18</div>

I ran `make -k` to get a fuller report, and it ended with:

```
* package:         gmpy2-2.1.0b5
  last build time: Jan 26 15:52
  log file:        /Users/jpalmier/Desktop/Sage/git/sage/logs/pkgs/gmpy2-2.1.0b5.log
  build directory: /Users/jpalmier/Desktop/Sage/git/sage/local/var/tmp/sage/build/gmpy2-2.1.0b5

* package:         cython-0.29.21
  last build time: Jan 26 15:52
  log file:        /Users/jpalmier/Desktop/Sage/git/sage/logs/pkgs/cython-0.29.21.log
  build directory: /Users/jpalmier/Desktop/Sage/git/sage/local/var/tmp/sage/build/cython-0.29.21

* package:         psutil-5.2.0.p2
  last build time: Jan 26 15:52
  log file:        /Users/jpalmier/Desktop/Sage/git/sage/logs/pkgs/psutil-5.2.0.p2.log
  build directory: /Users/jpalmier/Desktop/Sage/git/sage/local/var/tmp/sage/build/psutil-5.2.0.p2

* package:         pillow-8.0.1
  last build time: Jan 26 15:52
  log file:        /Users/jpalmier/Desktop/Sage/git/sage/logs/pkgs/pillow-8.0.1.log
  build directory: /Users/jpalmier/Desktop/Sage/git/sage/local/var/tmp/sage/build/pillow-8.0.1

* package:         kiwisolver-1.0.1
  last build time: Jan 26 15:52
  log file:        /Users/jpalmier/Desktop/Sage/git/sage/logs/pkgs/kiwisolver-1.0.1.log
  build directory: /Users/jpalmier/Desktop/Sage/git/sage/local/var/tmp/sage/build/kiwisolver-1.0.1

* package:         pynac-0.7.26.sage-2020-04-03.p0
  last build time: Jan 26 15:53
  log file:        /Users/jpalmier/Desktop/Sage/git/sage/logs/pkgs/pynac-0.7.26.sage-2020-04-03.p0.log
  build directory: /Users/jpalmier/Desktop/Sage/git/sage/local/var/tmp/sage/build/pynac-0.7.26.sage-2020-04-03.p0

* package:         cffi-1.14.4
  last build time: Jan 26 15:53
  log file:        /Users/jpalmier/Desktop/Sage/git/sage/logs/pkgs/cffi-1.14.4.log
  build directory: /Users/jpalmier/Desktop/Sage/git/sage/local/var/tmp/sage/build/cffi-1.14.4
```
All show the same error, "clang: error: the clang compiler does not support '-march=native'".



---

archive/issue_comments_500234.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@mkoeppe](#comment%3A17):\n> OK, looks like we have to set `ARCHFLAGS=\"\"` in more places. But this needs to be done very carefully - see #29408\n\nHow can we detect whether we're using a Python which requires this? And where is the right place to do it? `build/bin/sage-build-env-config.in`? There are lots of affected packages, so doing it globally would be easier. (`pyzmq`, `cysignals`, `numpy`, and others also seem to fail with the same error, if I recklessly add `export ARCHFLAGS=\"\"` to the install scripts for the other packages which were failing.)",
    "created_at": "2021-01-27T01:19:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500234",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@mkoeppe](#comment%3A17):
> OK, looks like we have to set `ARCHFLAGS=""` in more places. But this needs to be done very carefully - see #29408

How can we detect whether we're using a Python which requires this? And where is the right place to do it? `build/bin/sage-build-env-config.in`? There are lots of affected packages, so doing it globally would be easier. (`pyzmq`, `cysignals`, `numpy`, and others also seem to fail with the same error, if I recklessly add `export ARCHFLAGS=""` to the install scripts for the other packages which were failing.)



---

archive/issue_comments_500235.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@jhpalmieri](#comment%3A18):\n> All show the same error, \"clang: error: the clang compiler does not support '-march=native'\".\n\nOh, this is a different error. Let me try to fix this",
    "created_at": "2021-01-27T01:37:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500235",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@jhpalmieri](#comment%3A18):
> All show the same error, "clang: error: the clang compiler does not support '-march=native'".

Oh, this is a different error. Let me try to fix this



---

archive/issue_comments_500236.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nCould you post config.log from this run?",
    "created_at": "2021-01-27T02:04:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500236",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

Could you post config.log from this run?



---

archive/issue_comments_500237.json:
```json
{
    "body": "Attachment: **[config.log](https://github.com/sagemath/sage/files/ticket31227/config.log)**",
    "created_at": "2021-01-27T03:08:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500237",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[config.log](https://github.com/sagemath/sage/files/ticket31227/config.log)**



---

archive/issue_comments_500238.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@mkoeppe](#comment%3A21):\n> Could you post config.log from this run?\n\nYes. I replaced the old `config.log`, since that was a result of my error, not a problem with this ticket.",
    "created_at": "2021-01-27T03:09:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500238",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@mkoeppe](#comment%3A21):
> Could you post config.log from this run?

Yes. I replaced the old `config.log`, since that was a result of my error, not a problem with this ticket.



---

archive/issue_comments_500239.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThanks. The crazy thing is that passing `-march=native` only seems to result in the error `clang: error: the clang compiler does not support '-march=native'` if also `-arch arm64` is passed. The current test in `python3/spkg-configure.m4` does not catch this.",
    "created_at": "2021-01-27T03:53:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500239",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">comment:23</div>

Thanks. The crazy thing is that passing `-march=native` only seems to result in the error `clang: error: the clang compiler does not support '-march=native'` if also `-arch arm64` is passed. The current test in `python3/spkg-configure.m4` does not catch this.



---

archive/issue_comments_500240.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nWhat I find a bit confusing is the following:\n\nWe do not test, whether setting `ARCHFLAGS=\"\"` was necesarry in order to build this test extension during configure\n\nWhy do we expect that in real life situations (when actually compiling python extensions for sage) `ARCHFLAGS=\"\"` is not a requirement anymore?",
    "created_at": "2021-01-27T08:08:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500240",
    "user": "https://github.com/kliem"
}
```

<div id="comment:24" align="right">comment:24</div>

What I find a bit confusing is the following:

We do not test, whether setting `ARCHFLAGS=""` was necesarry in order to build this test extension during configure

Why do we expect that in real life situations (when actually compiling python extensions for sage) `ARCHFLAGS=""` is not a requirement anymore?



---

archive/issue_comments_500241.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nFor what it's worth, setting `ARCHFLAGS=\"\"` in `sage-build-env-config.in` let me build Sage. Doctesting didn't go that well: various failures because of \"command 'gcc' failed with exit status 1\" and \"#error Unsupported architecture\" and \"#error architecture not supported\".",
    "created_at": "2021-01-27T19:25:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500241",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:25" align="right">comment:25</div>

For what it's worth, setting `ARCHFLAGS=""` in `sage-build-env-config.in` let me build Sage. Doctesting didn't go that well: various failures because of "command 'gcc' failed with exit status 1" and "#error Unsupported architecture" and "#error architecture not supported".



---

archive/issue_events_427219.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-30T17:50:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31227#event-427219"
}
```



---

archive/issue_events_427220.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-30T17:50:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31227#event-427220"
}
```



---

archive/issue_comments_500242.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@jhpalmieri](#comment%3A25):\n> For what it's worth, setting `ARCHFLAGS=\"\"` in `sage-build-env-config.in` let me build Sage. Doctesting didn't go that well: various failures because of \"command 'gcc' failed with exit status 1\" and \"#error Unsupported architecture\" and \"#error architecture not supported\".\n\nIf we set `ARCHFLAGS`, we will have to do this in `sage-env` so that it also affects runtime use of the compiler (some of which is tested in doctests) and when users install Python packages with `sage -pip`.",
    "created_at": "2021-01-31T00:11:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500242",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@jhpalmieri](#comment%3A25):
> For what it's worth, setting `ARCHFLAGS=""` in `sage-build-env-config.in` let me build Sage. Doctesting didn't go that well: various failures because of "command 'gcc' failed with exit status 1" and "#error Unsupported architecture" and "#error architecture not supported".

If we set `ARCHFLAGS`, we will have to do this in `sage-env` so that it also affects runtime use of the compiler (some of which is tested in doctests) and when users install Python packages with `sage -pip`.



---

archive/issue_comments_500243.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be3196dbfd015b9fbdbf7a06b9c953b687db3726\"><code>be3196d</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4, src/bin/sage-env[-config.in]: Prepare conditional setting of ARCHFLAGS</code></td></tr></table>\n",
    "created_at": "2021-01-31T00:28:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500243",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be3196dbfd015b9fbdbf7a06b9c953b687db3726"><code>be3196d</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4, src/bin/sage-env[-config.in]: Prepare conditional setting of ARCHFLAGS</code></td></tr></table>




---

archive/issue_comments_500244.json:
```json
{
    "body": "Changed commit from **[`3325a4e`](https://github.com/sagemath/sagetrac-mirror/commit/3325a4e4cef11e7b2f9946fd0db143f1c0157af3)** to **[`be3196d`](https://github.com/sagemath/sagetrac-mirror/commit/be3196dbfd015b9fbdbf7a06b9c953b687db3726)**",
    "created_at": "2021-01-31T00:28:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500244",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3325a4e`](https://github.com/sagemath/sagetrac-mirror/commit/3325a4e4cef11e7b2f9946fd0db143f1c0157af3)** to **[`be3196d`](https://github.com/sagemath/sagetrac-mirror/commit/be3196dbfd015b9fbdbf7a06b9c953b687db3726)**



---

archive/issue_comments_500245.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n \n #30725 fixes this for macOS, where some packages are explicitly built with `clang`.\n \n-However, there is another mechanism how `clang` can come in: Python extension modules are compiled with the compiler listed in sysconfig. On macOS with homebrew, using `/usr/bin/python3`, this could again be `clang`, which does not accept `-march=native`.\n+However, there is another mechanism how `clang` can come in: Python extension modules are compiled with the compiler listed in sysconfig. On macOS with homebrew, using `/usr/bin/python3`, this could again be `clang`, which does not accept `-march=native` in combination with `-arch arm64` (which is provided even on x86_64 if `ARCHFLAGS` is unset).\n \n In this ticket, we fix this by checking whether the compiler used by distutils accepts `-march=native` (or more generally, the flags determined earlier by `configure`). If it does not, then we disable the use of these flags.\n \n``````\n",
    "created_at": "2021-01-31T00:36:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500245",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 
 #30725 fixes this for macOS, where some packages are explicitly built with `clang`.
 
-However, there is another mechanism how `clang` can come in: Python extension modules are compiled with the compiler listed in sysconfig. On macOS with homebrew, using `/usr/bin/python3`, this could again be `clang`, which does not accept `-march=native`.
+However, there is another mechanism how `clang` can come in: Python extension modules are compiled with the compiler listed in sysconfig. On macOS with homebrew, using `/usr/bin/python3`, this could again be `clang`, which does not accept `-march=native` in combination with `-arch arm64` (which is provided even on x86_64 if `ARCHFLAGS` is unset).
 
 In this ticket, we fix this by checking whether the compiler used by distutils accepts `-march=native` (or more generally, the flags determined earlier by `configure`). If it does not, then we disable the use of these flags.
 
``````




---

archive/issue_comments_500246.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c1596ccbf57b7d63f56a189681852e82fe5bac9\"><code>4c1596c</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4, m4/sage_check_python_for_venv.m4: Refactor through new macro SAGE_PYTHON_CHECK_DISTUTILS</code></td></tr></table>\n",
    "created_at": "2021-01-31T02:20:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500246",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c1596ccbf57b7d63f56a189681852e82fe5bac9"><code>4c1596c</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4, m4/sage_check_python_for_venv.m4: Refactor through new macro SAGE_PYTHON_CHECK_DISTUTILS</code></td></tr></table>




---

archive/issue_comments_500247.json:
```json
{
    "body": "Changed commit from **[`be3196d`](https://github.com/sagemath/sagetrac-mirror/commit/be3196dbfd015b9fbdbf7a06b9c953b687db3726)** to **[`4c1596c`](https://github.com/sagemath/sagetrac-mirror/commit/4c1596ccbf57b7d63f56a189681852e82fe5bac9)**",
    "created_at": "2021-01-31T02:20:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500247",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`be3196d`](https://github.com/sagemath/sagetrac-mirror/commit/be3196dbfd015b9fbdbf7a06b9c953b687db3726)** to **[`4c1596c`](https://github.com/sagemath/sagetrac-mirror/commit/4c1596ccbf57b7d63f56a189681852e82fe5bac9)**



---

archive/issue_comments_500248.json:
```json
{
    "body": "Changed commit from **[`4c1596c`](https://github.com/sagemath/sagetrac-mirror/commit/4c1596ccbf57b7d63f56a189681852e82fe5bac9)** to **[`dc5e225`](https://github.com/sagemath/sagetrac-mirror/commit/dc5e22511f783391282eca6a986971e6fe6f20b3)**",
    "created_at": "2021-01-31T04:17:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500248",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4c1596c`](https://github.com/sagemath/sagetrac-mirror/commit/4c1596ccbf57b7d63f56a189681852e82fe5bac9)** to **[`dc5e225`](https://github.com/sagemath/sagetrac-mirror/commit/dc5e22511f783391282eca6a986971e6fe6f20b3)**



---

archive/issue_comments_500249.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc5e22511f783391282eca6a986971e6fe6f20b3\"><code>dc5e225</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: On macOS, if the distutils test fails, try using empty ARCHFLAGS</code></td></tr></table>\n",
    "created_at": "2021-01-31T04:17:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500249",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc5e22511f783391282eca6a986971e6fe6f20b3"><code>dc5e225</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: On macOS, if the distutils test fails, try using empty ARCHFLAGS</code></td></tr></table>




---

archive/issue_comments_500250.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nHere's a new version that may be worth testing",
    "created_at": "2021-01-31T04:22:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500250",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

Here's a new version that may be worth testing



---

archive/issue_events_427221.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-31T04:22:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31227#event-427221"
}
```



---

archive/issue_events_427222.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-31T04:22:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31227#event-427222"
}
```



---

archive/issue_comments_500251.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,6 +19,7 @@\n egret:~/s/sage/sage-rebasing/worktree-algebraic-2018-spring (t/31132/homebrew__unused_packages__singular__pari_______in__usr_local_leak_into_build_when_using_homebrew_s_python3 *\n ```\n \n-In this ticket, we set `ARCHFLAGS` during this configure step.\n+In this ticket, if the distutils test fails, we try if setting `ARCHFLAGS=\"\"` fixes it. In that case, we store a configuration variable that causes `sage-env` to set `ARCHFLAGS` as well.\n+\n  \n \n``````\n",
    "created_at": "2021-01-31T04:25:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500251",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,6 +19,7 @@
 egret:~/s/sage/sage-rebasing/worktree-algebraic-2018-spring (t/31132/homebrew__unused_packages__singular__pari_______in__usr_local_leak_into_build_when_using_homebrew_s_python3 *
 ```
 
-In this ticket, we set `ARCHFLAGS` during this configure step.
+In this ticket, if the distutils test fails, we try if setting `ARCHFLAGS=""` fixes it. In that case, we store a configuration variable that causes `sage-env` to set `ARCHFLAGS` as well.
+
  
 
``````




---

archive/issue_comments_500252.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nBuilds successfully for me with `tox -e local-homebrew-macos-standard-python3_xcode`",
    "created_at": "2021-01-31T04:56:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500252",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:34" align="right">comment:34</div>

Builds successfully for me with `tox -e local-homebrew-macos-standard-python3_xcode`



---

archive/issue_comments_500253.json:
```json
{
    "body": "<div id=\"comment:35\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df17ad4e916d4db69a49dbe7c8082014abbcb539\"><code>df17ad4</code></a></td><td><code>tox.ini: Add configuration factors for specific homebrew python3.x</code></td></tr></table>\n",
    "created_at": "2021-01-31T08:24:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500253",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:35"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df17ad4e916d4db69a49dbe7c8082014abbcb539"><code>df17ad4</code></a></td><td><code>tox.ini: Add configuration factors for specific homebrew python3.x</code></td></tr></table>




---

archive/issue_comments_500254.json:
```json
{
    "body": "Changed commit from **[`dc5e225`](https://github.com/sagemath/sagetrac-mirror/commit/dc5e22511f783391282eca6a986971e6fe6f20b3)** to **[`df17ad4`](https://github.com/sagemath/sagetrac-mirror/commit/df17ad4e916d4db69a49dbe7c8082014abbcb539)**",
    "created_at": "2021-01-31T08:24:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500254",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dc5e225`](https://github.com/sagemath/sagetrac-mirror/commit/dc5e22511f783391282eca6a986971e6fe6f20b3)** to **[`df17ad4`](https://github.com/sagemath/sagetrac-mirror/commit/df17ad4e916d4db69a49dbe7c8082014abbcb539)**



---

archive/issue_comments_500255.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nWhat is the purpose of this line?\n\n```diff\n+    AC_SUBST([ARCHFLAGS], [unset])\n```",
    "created_at": "2021-01-31T08:34:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500255",
    "user": "https://github.com/kliem"
}
```

<div id="comment:36" align="right">comment:36</div>

What is the purpose of this line?

```diff
+    AC_SUBST([ARCHFLAGS], [unset])
```



---

archive/issue_comments_500256.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nI think the second reason is wrong here. Isn't this the case when building a C extension fails?\n\n```\ndnl distutils test\nAC_DEFUN([SAGE_PYTHON_CHECK_DISTUTILS], [\n    m4_pushdef([PYTHON_EXE], [$1])\n    m4_pushdef([COMMANDS_IF_DISTUTILS_GOOD], [$2])\n    m4_pushdef([COMMANDS_IF_DISTUTILS_NOT_GOOD], [$3])\n    SAGE_PYTHON_DISTUTILS_C_CONFTEST\n    dnl (echo \"***ENV***:\"; env; echo \"***SYSCONFIG***\"; conftest_venv/bin/python3 -m sysconfig) >& AS_MESSAGE_LOG_FD\n    echo PYTHON_EXE conftest.py --verbose build --build-base=conftest.dir >& AS_MESSAGE_LOG_FD\n    AS_IF([PYTHON_EXE conftest.py --verbose build --build-base=conftest.dir >& AS_MESSAGE_LOG_FD 2>&1 ], [\n        SAGE_PYTHON_DISTUTILS_CXX_CONFTEST\n        echo PYTHON_EXE conftest.py --verbose build --build-base=conftest.dir >& AS_MESSAGE_LOG_FD 2>&1\n        AS_IF([PYTHON_EXE conftest.py --verbose build --build-base=conftest.dir >& AS_MESSAGE_LOG_FD 2>&1 ], [\n            COMMANDS_IF_DISTUTILS_GOOD], [\n            reason=\"distutils cannot build a C++ 11 extension\"\n            COMMANDS_IF_DISTUTILS_NOT_GOOD\n        ])\n    ], [\n       reason=\"distutils cannot build a C++ 11 extension\"\n       COMMANDS_IF_DISTUTILS_NOT_GOOD\n    ])\n    m4_popdef([PYTHON_EXE])\n    m4_popdef([COMMANDS_IF_DISTUTILS_GOOD])\n    m4_popdef([COMMANDS_IF_DISTUTILS_NOT_GOOD])\n])\n```",
    "created_at": "2021-01-31T08:46:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500256",
    "user": "https://github.com/kliem"
}
```

<div id="comment:37" align="right">comment:37</div>

I think the second reason is wrong here. Isn't this the case when building a C extension fails?

```
dnl distutils test
AC_DEFUN([SAGE_PYTHON_CHECK_DISTUTILS], [
    m4_pushdef([PYTHON_EXE], [$1])
    m4_pushdef([COMMANDS_IF_DISTUTILS_GOOD], [$2])
    m4_pushdef([COMMANDS_IF_DISTUTILS_NOT_GOOD], [$3])
    SAGE_PYTHON_DISTUTILS_C_CONFTEST
    dnl (echo "***ENV***:"; env; echo "***SYSCONFIG***"; conftest_venv/bin/python3 -m sysconfig) >& AS_MESSAGE_LOG_FD
    echo PYTHON_EXE conftest.py --verbose build --build-base=conftest.dir >& AS_MESSAGE_LOG_FD
    AS_IF([PYTHON_EXE conftest.py --verbose build --build-base=conftest.dir >& AS_MESSAGE_LOG_FD 2>&1 ], [
        SAGE_PYTHON_DISTUTILS_CXX_CONFTEST
        echo PYTHON_EXE conftest.py --verbose build --build-base=conftest.dir >& AS_MESSAGE_LOG_FD 2>&1
        AS_IF([PYTHON_EXE conftest.py --verbose build --build-base=conftest.dir >& AS_MESSAGE_LOG_FD 2>&1 ], [
            COMMANDS_IF_DISTUTILS_GOOD], [
            reason="distutils cannot build a C++ 11 extension"
            COMMANDS_IF_DISTUTILS_NOT_GOOD
        ])
    ], [
       reason="distutils cannot build a C++ 11 extension"
       COMMANDS_IF_DISTUTILS_NOT_GOOD
    ])
    m4_popdef([PYTHON_EXE])
    m4_popdef([COMMANDS_IF_DISTUTILS_GOOD])
    m4_popdef([COMMANDS_IF_DISTUTILS_NOT_GOOD])
])
```



---

archive/issue_comments_500257.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nAlso `tox -e local-homebrew-usrlocal-minimal-python3.8` still works.",
    "created_at": "2021-01-31T08:47:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500257",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:38" align="right">comment:38</div>

Also `tox -e local-homebrew-usrlocal-minimal-python3.8` still works.



---

archive/issue_comments_500258.json:
```json
{
    "body": "Changed commit from **[`df17ad4`](https://github.com/sagemath/sagetrac-mirror/commit/df17ad4e916d4db69a49dbe7c8082014abbcb539)** to **[`914ea58`](https://github.com/sagemath/sagetrac-mirror/commit/914ea58a359df5478484da7fa3293007fad2b2df)**",
    "created_at": "2021-01-31T08:50:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500258",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`df17ad4`](https://github.com/sagemath/sagetrac-mirror/commit/df17ad4e916d4db69a49dbe7c8082014abbcb539)** to **[`914ea58`](https://github.com/sagemath/sagetrac-mirror/commit/914ea58a359df5478484da7fa3293007fad2b2df)**



---

archive/issue_comments_500259.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/914ea58a359df5478484da7fa3293007fad2b2df\"><code>914ea58</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Get rid of stray AC_SUBST</code></td></tr></table>\n",
    "created_at": "2021-01-31T08:50:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500259",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/914ea58a359df5478484da7fa3293007fad2b2df"><code>914ea58</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Get rid of stray AC_SUBST</code></td></tr></table>




---

archive/issue_comments_500260.json:
```json
{
    "body": "Changed commit from **[`914ea58`](https://github.com/sagemath/sagetrac-mirror/commit/914ea58a359df5478484da7fa3293007fad2b2df)** to **[`986739b`](https://github.com/sagemath/sagetrac-mirror/commit/986739b940952c7b10dfe0bd2b17dce2407f1ee0)**",
    "created_at": "2021-01-31T08:51:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500260",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`914ea58`](https://github.com/sagemath/sagetrac-mirror/commit/914ea58a359df5478484da7fa3293007fad2b2df)** to **[`986739b`](https://github.com/sagemath/sagetrac-mirror/commit/986739b940952c7b10dfe0bd2b17dce2407f1ee0)**



---

archive/issue_comments_500261.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/986739b940952c7b10dfe0bd2b17dce2407f1ee0\"><code>986739b</code></a></td><td><code>m4/sage_check_python_for_venv.m4: Fix reason</code></td></tr></table>\n",
    "created_at": "2021-01-31T08:51:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500261",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/986739b940952c7b10dfe0bd2b17dce2407f1ee0"><code>986739b</code></a></td><td><code>m4/sage_check_python_for_venv.m4: Fix reason</code></td></tr></table>




---

archive/issue_comments_500262.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nThanks for spotting these mistakes!",
    "created_at": "2021-01-31T08:51:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500262",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:41" align="right">comment:41</div>

Thanks for spotting these mistakes!



---

archive/issue_comments_500263.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nOtherwise, this looks very plausible.\n\nI updated https://github.com/kliem/sage/pull/36/ (not the last two commits, but they are cosmetic).",
    "created_at": "2021-01-31T09:09:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500263",
    "user": "https://github.com/kliem"
}
```

<div id="comment:42" align="right">comment:42</div>

Otherwise, this looks very plausible.

I updated https://github.com/kliem/sage/pull/36/ (not the last two commits, but they are cosmetic).



---

archive/issue_comments_500264.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nThis works for me on OS X Catalina. If I also include #31204, it passes most doctests. I see a few failures I don't remember seeing before:\n\n```\nsage -t --long --random-seed=0 src/sage_setup/find.py\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 278, in sage_setup.find.installed_files_by_module\nFailed example:\n    f1\nExpected:\n    'sage/structure/__init__.py'\nGot:\n    '/Users/jpalmier/Library/Caches/com.apple.python/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python3.8/site-packages/sage/structure/__init__.cpython-38.pyc'\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 280, in sage_setup.find.installed_files_by_module\nFailed example:\n    f2\nExpected:\n    'sage/structure/....pyc'\nGot:\n    'sage/structure/__init__.py'\n```\nand\n\n```\nsage -t --long --random-seed=0 src/sage_setup/clean.py\n**********************************************************************\nFile \"src/sage_setup/clean.py\", line 95, in sage_setup.clean._find_stale_files\nFailed example:\n    for f in stale_iter:\n        if f.endswith(skip_extensions): continue\n        if '/ext_data/' in f: continue\n        print('Found stale file: ' + f)\nExpected nothing\nGot:\n    Found stale file: /Users/jpalmier/Library/Caches/com.apple.python/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python3.8/site-packages/sage/all_cmdline.cpython-38.pyc\n    Found stale file: /Users/jpalmier/Library/Caches/com.apple.python/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python3.8/site-packages/sage/version.cpython-38.pyc\n\n  [ and many more lines of such messages ]\n```\nWhy is it looking in `$HOME/Library`? Also, the files there look from their dates as if they were created during this build of Sage.",
    "created_at": "2021-01-31T22:27:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500264",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:43" align="right">comment:43</div>

This works for me on OS X Catalina. If I also include #31204, it passes most doctests. I see a few failures I don't remember seeing before:

```
sage -t --long --random-seed=0 src/sage_setup/find.py
**********************************************************************
File "src/sage_setup/find.py", line 278, in sage_setup.find.installed_files_by_module
Failed example:
    f1
Expected:
    'sage/structure/__init__.py'
Got:
    '/Users/jpalmier/Library/Caches/com.apple.python/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python3.8/site-packages/sage/structure/__init__.cpython-38.pyc'
**********************************************************************
File "src/sage_setup/find.py", line 280, in sage_setup.find.installed_files_by_module
Failed example:
    f2
Expected:
    'sage/structure/....pyc'
Got:
    'sage/structure/__init__.py'
```
and

```
sage -t --long --random-seed=0 src/sage_setup/clean.py
**********************************************************************
File "src/sage_setup/clean.py", line 95, in sage_setup.clean._find_stale_files
Failed example:
    for f in stale_iter:
        if f.endswith(skip_extensions): continue
        if '/ext_data/' in f: continue
        print('Found stale file: ' + f)
Expected nothing
Got:
    Found stale file: /Users/jpalmier/Library/Caches/com.apple.python/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python3.8/site-packages/sage/all_cmdline.cpython-38.pyc
    Found stale file: /Users/jpalmier/Library/Caches/com.apple.python/Users/jpalmier/Desktop/Sage/git/sage/local/lib/python3.8/site-packages/sage/version.cpython-38.pyc

  [ and many more lines of such messages ]
```
Why is it looking in `$HOME/Library`? Also, the files there look from their dates as if they were created during this build of Sage.



---

archive/issue_comments_500265.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nThis does not work for me with OS X Big Sur, though: many packages (cython, pynac, gmpy2, psutil, pillow, kiwisolver, cffi) fail to build with the error \"clang: error: the clang compiler does not support '-march=native'\".\n\nHold on, I have to run `./bootstrap` and try again.\n\nConfirmed, these packages all fail after\n\n```\nmake distclean && ./bootstrap && ./configure --with-python=/usr/bin/python3 && make -k\n```",
    "created_at": "2021-01-31T23:42:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500265",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:44" align="right">comment:44</div>

This does not work for me with OS X Big Sur, though: many packages (cython, pynac, gmpy2, psutil, pillow, kiwisolver, cffi) fail to build with the error "clang: error: the clang compiler does not support '-march=native'".

Hold on, I have to run `./bootstrap` and try again.

Confirmed, these packages all fail after

```
make distclean && ./bootstrap && ./configure --with-python=/usr/bin/python3 && make -k
```



---

archive/issue_comments_500266.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@jhpalmieri](#comment%3A43):\n> This works for me on OS X Catalina. If I also include #31204, it passes most doctests. I see a few failures I don't remember seeing before [...]\n> Why is it looking in `$HOME/Library`? Also, the files there look from their dates as if they were created during this build of Sage.\n\nIs `PYTHONPYCACHEPREFIX` set on your system? https://docs.python.org/3/using/cmdline.html#envvar-PYTHONPYCACHEPREFIX\n(#31314)",
    "created_at": "2021-02-01T01:22:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500266",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@jhpalmieri](#comment%3A43):
> This works for me on OS X Catalina. If I also include #31204, it passes most doctests. I see a few failures I don't remember seeing before [...]
> Why is it looking in `$HOME/Library`? Also, the files there look from their dates as if they were created during this build of Sage.

Is `PYTHONPYCACHEPREFIX` set on your system? https://docs.python.org/3/using/cmdline.html#envvar-PYTHONPYCACHEPREFIX
(#31314)



---

archive/issue_comments_500267.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\n`config.log` from the big sur system please",
    "created_at": "2021-02-01T01:23:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500267",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:46" align="right">comment:46</div>

`config.log` from the big sur system please



---

archive/issue_comments_500268.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@mkoeppe](#comment%3A45):\n> Replying to [@jhpalmieri](#comment%3A43):\n> > This works for me on OS X Catalina. If I also include #31204, it passes most doctests. I see a few failures I don't remember seeing before [...]\n> > Why is it looking in `$HOME/Library`? Also, the files there look from their dates as if they were created during this build of Sage.\n> \n> \n> Is `PYTHONPYCACHEPREFIX` set on your system? https://docs.python.org/3/using/cmdline.html#envvar-PYTHONPYCACHEPREFIX\n> (#31314)\n\nNo, not normally and not after running `./sage --sh`.",
    "created_at": "2021-02-01T02:08:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500268",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@mkoeppe](#comment%3A45):
> Replying to [@jhpalmieri](#comment%3A43):
> > This works for me on OS X Catalina. If I also include #31204, it passes most doctests. I see a few failures I don't remember seeing before [...]
> > Why is it looking in `$HOME/Library`? Also, the files there look from their dates as if they were created during this build of Sage.
> 
> 
> Is `PYTHONPYCACHEPREFIX` set on your system? https://docs.python.org/3/using/cmdline.html#envvar-PYTHONPYCACHEPREFIX
> (#31314)

No, not normally and not after running `./sage --sh`.



---

archive/issue_comments_500269.json:
```json
{
    "body": "Attachment: **[config.2.log](https://github.com/sagemath/sage/files/ticket31227/config.2.log)**\n\nconfig.log for failed Big Sur build",
    "created_at": "2021-02-01T02:09:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500269",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[config.2.log](https://github.com/sagemath/sage/files/ticket31227/config.2.log)**

config.log for failed Big Sur build



---

archive/issue_comments_500270.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nReplying to [@jhpalmieri](#comment%3A47):\n> Replying to [@mkoeppe](#comment%3A45):\n> > Replying to [@jhpalmieri](#comment%3A43):\n> > > This works for me on OS X Catalina. If I also include #31204, it passes most doctests. I see a few failures I don't remember seeing before [...]\n> > > Why is it looking in `$HOME/Library`? Also, the files there look from their dates as if they were created during this build of Sage.\n> > \n> > \n> > Is `PYTHONPYCACHEPREFIX` set on your system? https://docs.python.org/3/using/cmdline.html#envvar-PYTHONPYCACHEPREFIX\n> > (#31314)\n> \n> \n> No, not normally and not after running `./sage --sh`.\n\nHowever:\n\n```\n% /usr/bin/python3   \nPython 3.8.2 (default, Dec 21 2020, 15:06:04) \n[Clang 12.0.0 (clang-1200.0.32.29)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import sys\n>>> sys.pycache_prefix\n'/Users/jpalmier/Library/Caches/com.apple.python'\n```\nThis is not how `/usr/local/bin/python3` behaves: `sys.pycache_prefix` is `None` there. The Python documentation suggests that the default setting should be `None` since I am not passing a `-X` argument nor am I setting `PYTHONPYCACHEPREFIX`.",
    "created_at": "2021-02-01T02:16:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500270",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:48" align="right">comment:48</div>

Replying to [@jhpalmieri](#comment%3A47):
> Replying to [@mkoeppe](#comment%3A45):
> > Replying to [@jhpalmieri](#comment%3A43):
> > > This works for me on OS X Catalina. If I also include #31204, it passes most doctests. I see a few failures I don't remember seeing before [...]
> > > Why is it looking in `$HOME/Library`? Also, the files there look from their dates as if they were created during this build of Sage.
> > 
> > 
> > Is `PYTHONPYCACHEPREFIX` set on your system? https://docs.python.org/3/using/cmdline.html#envvar-PYTHONPYCACHEPREFIX
> > (#31314)
> 
> 
> No, not normally and not after running `./sage --sh`.

However:

```
% /usr/bin/python3   
Python 3.8.2 (default, Dec 21 2020, 15:06:04) 
[Clang 12.0.0 (clang-1200.0.32.29)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import sys
>>> sys.pycache_prefix
'/Users/jpalmier/Library/Caches/com.apple.python'
```
This is not how `/usr/local/bin/python3` behaves: `sys.pycache_prefix` is `None` there. The Python documentation suggests that the default setting should be `None` since I am not passing a `-X` argument nor am I setting `PYTHONPYCACHEPREFIX`.



---

archive/issue_comments_500271.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nhm... config.2.log does not look like it's coming from this branch...",
    "created_at": "2021-02-01T02:18:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500271",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:49" align="right">comment:49</div>

hm... config.2.log does not look like it's coming from this branch...



---

archive/issue_comments_500272.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [@jhpalmieri](#comment%3A48):\n> \n> ```\n> % /usr/bin/python3   \n> Python 3.8.2 (default, Dec 21 2020, 15:06:04) \n> [Clang 12.0.0 (clang-1200.0.32.29)] on darwin\n> Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n> >>> import sys\n> >>> sys.pycache_prefix\n> '/Users/jpalmier/Library/Caches/com.apple.python'\n> ```\n\nSame here. Looks like Apple has preconfigured their build to do this. I'll update the description of #31314.",
    "created_at": "2021-02-01T02:20:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500272",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [@jhpalmieri](#comment%3A48):
> 
> ```
> % /usr/bin/python3   
> Python 3.8.2 (default, Dec 21 2020, 15:06:04) 
> [Clang 12.0.0 (clang-1200.0.32.29)] on darwin
> Type "help", "copyright", "credits" or "license" for more information.
> >>> import sys
> >>> sys.pycache_prefix
> '/Users/jpalmier/Library/Caches/com.apple.python'
> ```

Same here. Looks like Apple has preconfigured their build to do this. I'll update the description of #31314.



---

archive/issue_comments_500273.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@mkoeppe](#comment%3A49):\n> hm... config.2.log does not look like it's coming from this branch...\n\nSorry, you're right. Typo on my part: I checked out #31127 instead of #31227. Trying again now.",
    "created_at": "2021-02-01T02:25:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500273",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@mkoeppe](#comment%3A49):
> hm... config.2.log does not look like it's coming from this branch...

Sorry, you're right. Typo on my part: I checked out #31127 instead of #31227. Trying again now.



---

archive/issue_comments_500274.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nNow with Big Sur, `cysignals` and `scipy` fail. For `scipy`, the error looks like this:\n\n```\n    /Users/palmieri/Desktop/Sage/sage_builds/TESTING/clean/sage-9.3.beta6/local/lib/python3.8/site-packages/numpy/distutils/system_info.py:838: UserWarning: Specified path /usr/local/include/python3.8 is invalid.\n```\nSomehow it's picking up `/usr/local`. I'm not sure what's going on with `cysignals`. Logs attached.",
    "created_at": "2021-02-01T03:53:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500274",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:52" align="right">comment:52</div>

Now with Big Sur, `cysignals` and `scipy` fail. For `scipy`, the error looks like this:

```
    /Users/palmieri/Desktop/Sage/sage_builds/TESTING/clean/sage-9.3.beta6/local/lib/python3.8/site-packages/numpy/distutils/system_info.py:838: UserWarning: Specified path /usr/local/include/python3.8 is invalid.
```
Somehow it's picking up `/usr/local`. I'm not sure what's going on with `cysignals`. Logs attached.



---

archive/issue_comments_500275.json:
```json
{
    "body": "config.log for failed Big Sur build",
    "created_at": "2021-02-01T03:54:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500275",
    "user": "https://github.com/jhpalmieri"
}
```

config.log for failed Big Sur build



---

archive/issue_comments_500276.json:
```json
{
    "body": "Attachment: **[config.3.log](https://github.com/sagemath/sage/files/ticket31227/config.3.log)**",
    "created_at": "2021-02-01T03:54:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500276",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[config.3.log](https://github.com/sagemath/sage/files/ticket31227/config.3.log)**



---

archive/issue_comments_500277.json:
```json
{
    "body": "Attachment: **[cysignals-1.10.2.log](https://github.com/sagemath/sage/files/ticket31227/cysignals-1.10.2.log)**",
    "created_at": "2021-02-01T03:54:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500277",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[cysignals-1.10.2.log](https://github.com/sagemath/sage/files/ticket31227/cysignals-1.10.2.log)**



---

archive/issue_comments_500278.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nAttachment: **[scipy-1.5.4.log](https://github.com/sagemath/sage/files/ticket31227/scipy-1.5.4.log)**\n\nThe config.log looks good.",
    "created_at": "2021-02-01T03:58:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500278",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:53" align="right">comment:53</div>

Attachment: **[scipy-1.5.4.log](https://github.com/sagemath/sage/files/ticket31227/scipy-1.5.4.log)**

The config.log looks good.



---

archive/issue_comments_500279.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nReplying to [@jhpalmieri](#comment%3A52):\n> Now with Big Sur, `cysignals` and `scipy` fail. For `scipy`, the error looks like this:\n> \n> ```\n>     /Users/palmieri/Desktop/Sage/sage_builds/TESTING/clean/sage-9.3.beta6/local/lib/python3.8/site-packages/numpy/distutils/system_info.py:838: UserWarning: Specified path /usr/local/include/python3.8 is invalid.\n> ```\n\nI think the actual error is this one:\n\n```\n  ar: adding 50 object files to build/temp.macosx-10.14.6-x86_64-3.8/libsuperlu_src.a\n  warning: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: archive library: build/temp.macosx-10.14.6-x86_64-3.8/libsuperlu_src.a will be fat and ar(1) will not be able to operate on it\n  ar: adding 50 object files to build/temp.macosx-10.14.6-x86_64-3.8/libsuperlu_src.a\n  ar: build/temp.macosx-10.14.6-x86_64-3.8/libsuperlu_src.a is a fat file (use libtool(1) or lipo(1) and ar(1) on it)\n  ar: build/temp.macosx-10.14.6-x86_64-3.8/libsuperlu_src.a: Inappropriate file type or format\n```",
    "created_at": "2021-02-01T04:01:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500279",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:54" align="right">comment:54</div>

Replying to [@jhpalmieri](#comment%3A52):
> Now with Big Sur, `cysignals` and `scipy` fail. For `scipy`, the error looks like this:
> 
> ```
>     /Users/palmieri/Desktop/Sage/sage_builds/TESTING/clean/sage-9.3.beta6/local/lib/python3.8/site-packages/numpy/distutils/system_info.py:838: UserWarning: Specified path /usr/local/include/python3.8 is invalid.
> ```

I think the actual error is this one:

```
  ar: adding 50 object files to build/temp.macosx-10.14.6-x86_64-3.8/libsuperlu_src.a
  warning: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: archive library: build/temp.macosx-10.14.6-x86_64-3.8/libsuperlu_src.a will be fat and ar(1) will not be able to operate on it
  ar: adding 50 object files to build/temp.macosx-10.14.6-x86_64-3.8/libsuperlu_src.a
  ar: build/temp.macosx-10.14.6-x86_64-3.8/libsuperlu_src.a is a fat file (use libtool(1) or lipo(1) and ar(1) on it)
  ar: build/temp.macosx-10.14.6-x86_64-3.8/libsuperlu_src.a: Inappropriate file type or format
```



---

archive/issue_comments_500280.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nSimilar: https://github.com/scipy/scipy/issues/10902",
    "created_at": "2021-02-01T04:09:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500280",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:55" align="right">comment:55</div>

Similar: https://github.com/scipy/scipy/issues/10902



---

archive/issue_comments_500281.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nIs `MACOSX_DEPLOYMENT_TARGET` set to something on your big sur system?",
    "created_at": "2021-02-01T04:13:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500281",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:56" align="right">comment:56</div>

Is `MACOSX_DEPLOYMENT_TARGET` set to something on your big sur system?



---

archive/issue_comments_500282.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nReplying to [@mkoeppe](#comment%3A56):\n> Is `MACOSX_DEPLOYMENT_TARGET` set to something on your big sur system?\n\nNo, but who knows what Xcode and/or homebrew are doing these days.",
    "created_at": "2021-02-01T04:17:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500282",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:57" align="right">comment:57</div>

Replying to [@mkoeppe](#comment%3A56):
> Is `MACOSX_DEPLOYMENT_TARGET` set to something on your big sur system?

No, but who knows what Xcode and/or homebrew are doing these days.



---

archive/issue_comments_500283.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nfrom cysignals.log: \n\n```\n  gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers -arch arm64 -arch x86_64 -O2 -g -Wp,-U_FORTIFY_SOURCE -DCYTHON_CLINE_IN_TRACEBACK=0 -U_FORTIFY_SOURCE -Isrc/cysignals -Isrc -I/Users/palmieri/Desktop/Sage/sage_builds/TESTING/clean/sage-9.3.beta6/local/include -I/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/include/python3.8 -c build/src/cysignals/signals.c -o build/temp.macosx-10.14.6-x86_64-3.8/build/src/cysignals/signals.o -pthread\n  In file included from build/src/cysignals/signals.c:1570:\n  In file included from build/src/cysignals/implementation.c:58:\n  In file included from /Users/palmieri/Desktop/Sage/sage_builds/TESTING/clean/sage-9.3.beta6/local/include/pari/pari.h:49:\n  ../src/kernel/none/divll_pre.h:30:10: error: invalid output constraint '=a' in asm\n    return divll(~0UL, n);\n           ^\n```\nThis is trying to build for `-arch arm64 -arch x86_64` and is tripping over the installed pari header ... which is arch-specific!",
    "created_at": "2021-02-01T04:21:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500283",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:58" align="right">comment:58</div>

from cysignals.log: 

```
  gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers -arch arm64 -arch x86_64 -O2 -g -Wp,-U_FORTIFY_SOURCE -DCYTHON_CLINE_IN_TRACEBACK=0 -U_FORTIFY_SOURCE -Isrc/cysignals -Isrc -I/Users/palmieri/Desktop/Sage/sage_builds/TESTING/clean/sage-9.3.beta6/local/include -I/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/include/python3.8 -c build/src/cysignals/signals.c -o build/temp.macosx-10.14.6-x86_64-3.8/build/src/cysignals/signals.o -pthread
  In file included from build/src/cysignals/signals.c:1570:
  In file included from build/src/cysignals/implementation.c:58:
  In file included from /Users/palmieri/Desktop/Sage/sage_builds/TESTING/clean/sage-9.3.beta6/local/include/pari/pari.h:49:
  ../src/kernel/none/divll_pre.h:30:10: error: invalid output constraint '=a' in asm
    return divll(~0UL, n);
           ^
```
This is trying to build for `-arch arm64 -arch x86_64` and is tripping over the installed pari header ... which is arch-specific!



---

archive/issue_comments_500284.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nBefore I source `.homebrew-build-env`, I only set these environment variables:\n\n```\nBIBINPUTS=/Users/palmieri/iCloud/Documents/tex/bibtex:.:\nEDITOR=emacs\nLESS=-R\nLSCOLORS=Gxfxcxdxbxegedabagacad\nMAKE='make -j6'\nMAKEFLAGS=-j6\nPAGER=less\nPATH=/Users/palmieri/.local/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/Library/TeX/texbin:/Library/Apple/usr/bin:/Library/Frameworks/Mono.framework/Versions/Current/Commands\n```\n(If I run `export` at the start of my .zshrc file and also comment out the line that runs `.homebrew-build-env`, and then run `export` again with an actual running terminal, these are the differences.) Nothing strange there, nothing that I think should cause any problems. This is on the Big Sur system, but the Catalina system has a very similar configuration.",
    "created_at": "2021-02-01T04:32:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500284",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:59" align="right">comment:59</div>

Before I source `.homebrew-build-env`, I only set these environment variables:

```
BIBINPUTS=/Users/palmieri/iCloud/Documents/tex/bibtex:.:
EDITOR=emacs
LESS=-R
LSCOLORS=Gxfxcxdxbxegedabagacad
MAKE='make -j6'
MAKEFLAGS=-j6
PAGER=less
PATH=/Users/palmieri/.local/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/Library/TeX/texbin:/Library/Apple/usr/bin:/Library/Frameworks/Mono.framework/Versions/Current/Commands
```
(If I run `export` at the start of my .zshrc file and also comment out the line that runs `.homebrew-build-env`, and then run `export` again with an actual running terminal, these are the differences.) Nothing strange there, nothing that I think should cause any problems. This is on the Big Sur system, but the Catalina system has a very similar configuration.



---

archive/issue_comments_500285.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nIt seems that we need to set `ARCHFLAGS=\"\"` in more situations. The default set by `/usr/bin/python3`, trying to build for both architectures, is unrealistic to support -- this would require major changes to how we install libraries.",
    "created_at": "2021-02-01T04:34:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500285",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:60" align="right">comment:60</div>

It seems that we need to set `ARCHFLAGS=""` in more situations. The default set by `/usr/bin/python3`, trying to build for both architectures, is unrealistic to support -- this would require major changes to how we install libraries.



---

archive/issue_comments_500286.json:
```json
{
    "body": "Changed commit from **[`986739b`](https://github.com/sagemath/sagetrac-mirror/commit/986739b940952c7b10dfe0bd2b17dce2407f1ee0)** to **[`0b3e70d`](https://github.com/sagemath/sagetrac-mirror/commit/0b3e70d458ef88d610c6883ddedaf19565f7de3a)**",
    "created_at": "2021-02-01T04:58:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500286",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`986739b`](https://github.com/sagemath/sagetrac-mirror/commit/986739b940952c7b10dfe0bd2b17dce2407f1ee0)** to **[`0b3e70d`](https://github.com/sagemath/sagetrac-mirror/commit/0b3e70d458ef88d610c6883ddedaf19565f7de3a)**



---

archive/issue_comments_500287.json:
```json
{
    "body": "<div id=\"comment:61\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b3e70d458ef88d610c6883ddedaf19565f7de3a\"><code>0b3e70d</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: If PYTHON_FOR_VENV is configured to build multiarch extensions, set SAGE_ARCHFLAGS to disable it</code></td></tr></table>\n",
    "created_at": "2021-02-01T04:58:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500287",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:61"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b3e70d458ef88d610c6883ddedaf19565f7de3a"><code>0b3e70d</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: If PYTHON_FOR_VENV is configured to build multiarch extensions, set SAGE_ARCHFLAGS to disable it</code></td></tr></table>




---

archive/issue_comments_500288.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nHere's a new version to try on big sur",
    "created_at": "2021-02-01T04:58:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500288",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:62" align="right">comment:62</div>

Here's a new version to try on big sur



---

archive/issue_comments_500289.json:
```json
{
    "body": "<div id=\"comment:63\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/372adcb4b2f3de7a230b14f5c275299d7d8c50fc\"><code>372adcb</code></a></td><td><code>.github/workflows/tox.yml: Update xcode versions</code></td></tr></table>\n",
    "created_at": "2021-02-01T05:54:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500289",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:63"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/372adcb4b2f3de7a230b14f5c275299d7d8c50fc"><code>372adcb</code></a></td><td><code>.github/workflows/tox.yml: Update xcode versions</code></td></tr></table>




---

archive/issue_comments_500290.json:
```json
{
    "body": "Changed commit from **[`0b3e70d`](https://github.com/sagemath/sagetrac-mirror/commit/0b3e70d458ef88d610c6883ddedaf19565f7de3a)** to **[`372adcb`](https://github.com/sagemath/sagetrac-mirror/commit/372adcb4b2f3de7a230b14f5c275299d7d8c50fc)**",
    "created_at": "2021-02-01T05:54:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500290",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0b3e70d`](https://github.com/sagemath/sagetrac-mirror/commit/0b3e70d458ef88d610c6883ddedaf19565f7de3a)** to **[`372adcb`](https://github.com/sagemath/sagetrac-mirror/commit/372adcb4b2f3de7a230b14f5c275299d7d8c50fc)**



---

archive/issue_comments_500291.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nStarted tests at https://github.com/mkoeppe/sage/actions/runs/526769308 but it looks like there is a long wait time to get macos instances",
    "created_at": "2021-02-01T05:56:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500291",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:64" align="right">comment:64</div>

Started tests at https://github.com/mkoeppe/sage/actions/runs/526769308 but it looks like there is a long wait time to get macos instances



---

archive/issue_comments_500292.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,9 +14,9 @@\n ```\n $ /usr/bin/python3 -m sysconfig |grep '\\bCFLAGS ='\n \tCFLAGS = \"-Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers -arch arm64 -arch x86_64\"\n-ARCHFLAGS=\"\" /usr/bin/python3 -m sysconfig |grep '\\bCFLAGS ='\n+\n+$ ARCHFLAGS=\"\" /usr/bin/python3 -m sysconfig |grep '\\bCFLAGS ='\n \tCFLAGS = \"-Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers  -arch x86_64 \"\n-egret:~/s/sage/sage-rebasing/worktree-algebraic-2018-spring (t/31132/homebrew__unused_packages__singular__pari_______in__usr_local_leak_into_build_when_using_homebrew_s_python3 *\n ```\n \n In this ticket, if the distutils test fails, we try if setting `ARCHFLAGS=\"\"` fixes it. In that case, we store a configuration variable that causes `sage-env` to set `ARCHFLAGS` as well.\n``````\n",
    "created_at": "2021-02-01T05:57:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500292",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,9 +14,9 @@
 ```
 $ /usr/bin/python3 -m sysconfig |grep '\bCFLAGS ='
 	CFLAGS = "-Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers -arch arm64 -arch x86_64"
-ARCHFLAGS="" /usr/bin/python3 -m sysconfig |grep '\bCFLAGS ='
+
+$ ARCHFLAGS="" /usr/bin/python3 -m sysconfig |grep '\bCFLAGS ='
 	CFLAGS = "-Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers  -arch x86_64 "
-egret:~/s/sage/sage-rebasing/worktree-algebraic-2018-spring (t/31132/homebrew__unused_packages__singular__pari_______in__usr_local_leak_into_build_when_using_homebrew_s_python3 *
 ```
 
 In this ticket, if the distutils test fails, we try if setting `ARCHFLAGS=""` fixes it. In that case, we store a configuration variable that causes `sage-env` to set `ARCHFLAGS` as well.
``````




---

archive/issue_comments_500293.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,7 +19,10 @@\n \tCFLAGS = \"-Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers  -arch x86_64 \"\n ```\n \n-In this ticket, if the distutils test fails, we try if setting `ARCHFLAGS=\"\"` fixes it. In that case, we store a configuration variable that causes `sage-env` to set `ARCHFLAGS` as well.\n+In this ticket, if the distutils test fails, we try if setting `ARCHFLAGS=\"\"` fixes it.  Also, after accepting a system python and `ARCHFLAGS` so far has not been set, we test whether the system python wants to do the multi-arch build.\n \n- \n+In either of these two cases, we store a configuration variable that causes `sage-env` to set `ARCHFLAGS` as well.\n \n+This is somewhat complicated logic - we are tiptoeing around previous breakage that had been caused by setting `ARCHFLAGS` unconditionally (#29408).\n+\n+\n``````\n",
    "created_at": "2021-02-01T06:00:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500293",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,7 +19,10 @@
 	CFLAGS = "-Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers  -arch x86_64 "
 ```
 
-In this ticket, if the distutils test fails, we try if setting `ARCHFLAGS=""` fixes it. In that case, we store a configuration variable that causes `sage-env` to set `ARCHFLAGS` as well.
+In this ticket, if the distutils test fails, we try if setting `ARCHFLAGS=""` fixes it.  Also, after accepting a system python and `ARCHFLAGS` so far has not been set, we test whether the system python wants to do the multi-arch build.
 
- 
+In either of these two cases, we store a configuration variable that causes `sage-env` to set `ARCHFLAGS` as well.
 
+This is somewhat complicated logic - we are tiptoeing around previous breakage that had been caused by setting `ARCHFLAGS` unconditionally (#29408).
+
+
``````




---

archive/issue_events_427223.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-01T06:05:09Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "title_is": "Accept /usr/bin/python3 from XCode 12.3 on macOS 10.15 (Catalina) and 11 (Big Sur)",
    "title_was": "Accept /usr/bin/python3 from XCode 12.3 on macOS 10.15 (Catalina)",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31227#event-427223"
}
```



---

archive/issue_comments_500294.json:
```json
{
    "body": "<div id=\"comment:68\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fc8b67644bada9ea52cbb7c91f53f763ca84f4bb\"><code>fc8b676</code></a></td><td><code>SAGE_CHECK_PYTHON_FOR_VENV: Rework with less nesting</code></td></tr></table>\n",
    "created_at": "2021-02-01T18:21:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500294",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:68"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fc8b67644bada9ea52cbb7c91f53f763ca84f4bb"><code>fc8b676</code></a></td><td><code>SAGE_CHECK_PYTHON_FOR_VENV: Rework with less nesting</code></td></tr></table>




---

archive/issue_comments_500295.json:
```json
{
    "body": "Changed commit from **[`372adcb`](https://github.com/sagemath/sagetrac-mirror/commit/372adcb4b2f3de7a230b14f5c275299d7d8c50fc)** to **[`fc8b676`](https://github.com/sagemath/sagetrac-mirror/commit/fc8b67644bada9ea52cbb7c91f53f763ca84f4bb)**",
    "created_at": "2021-02-01T18:21:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500295",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`372adcb`](https://github.com/sagemath/sagetrac-mirror/commit/372adcb4b2f3de7a230b14f5c275299d7d8c50fc)** to **[`fc8b676`](https://github.com/sagemath/sagetrac-mirror/commit/fc8b67644bada9ea52cbb7c91f53f763ca84f4bb)**



---

archive/issue_comments_500296.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nFor the record, I was able to successfully build sage and documentation with this ticket on Big Sur using \n\n--with-python=/usr/bin/python3",
    "created_at": "2021-02-01T18:30:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500296",
    "user": "https://github.com/zlscherr"
}
```

<div id="comment:69" align="right">comment:69</div>

For the record, I was able to successfully build sage and documentation with this ticket on Big Sur using 

--with-python=/usr/bin/python3



---

archive/issue_comments_500297.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nThanks for testing!",
    "created_at": "2021-02-01T18:31:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500297",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:70" align="right">comment:70</div>

Thanks for testing!



---

archive/issue_comments_500298.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nWorks for me with the system Python 3 on both Big Sur and Catalina.",
    "created_at": "2021-02-01T21:36:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500298",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:71" align="right">comment:71</div>

Works for me with the system Python 3 on both Big Sur and Catalina.



---

archive/issue_comments_500299.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nThanks for testing! \n\nLet's deal with issue #31314 (messages from `find_stale_files`) in a follow up.\n\nReady for review?",
    "created_at": "2021-02-01T23:12:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500299",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:72" align="right">comment:72</div>

Thanks for testing! 

Let's deal with issue #31314 (messages from `find_stale_files`) in a follow up.

Ready for review?



---

archive/issue_comments_500300.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nReplying to [@mkoeppe](#comment%3A64):\n> Started tests at https://github.com/mkoeppe/sage/actions/runs/526769308 but it looks like there is a long wait time to get macos instances\n\nSome results have been coming in:\n\n- `local-homebrew-macos-10.15-xcode-11.7-{minimal,standard}`: clean\n- `local-homebrew-macos-11.0-xcode-11.7-{minimal,standard}`: Homebrew complains that xcode is too old\n\nStill waiting for the tests with other xcode versions (12.2, 12.3, 12.4). No failures so far.\n\nNote all runs are on `x86_64` - we do not have test infrastructor for `macos-arm64` yet.",
    "created_at": "2021-02-02T01:58:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500300",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:73" align="right">comment:73</div>

Replying to [@mkoeppe](#comment%3A64):
> Started tests at https://github.com/mkoeppe/sage/actions/runs/526769308 but it looks like there is a long wait time to get macos instances

Some results have been coming in:

- `local-homebrew-macos-10.15-xcode-11.7-{minimal,standard}`: clean
- `local-homebrew-macos-11.0-xcode-11.7-{minimal,standard}`: Homebrew complains that xcode is too old

Still waiting for the tests with other xcode versions (12.2, 12.3, 12.4). No failures so far.

Note all runs are on `x86_64` - we do not have test infrastructor for `macos-arm64` yet.



---

archive/issue_comments_500301.json:
```json
{
    "body": "Changed reviewer from **https://github.com/kliem/sage/pull/36/checks, Jonathan Kliem** to **Jonathan Kliem**",
    "created_at": "2021-02-02T09:17:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500301",
    "user": "https://github.com/kliem"
}
```

Changed reviewer from **https://github.com/kliem/sage/pull/36/checks, Jonathan Kliem** to **Jonathan Kliem**



---

archive/issue_comments_500302.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nI'm happy with this ticket, but I would like another opinion on this.",
    "created_at": "2021-02-02T09:17:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500302",
    "user": "https://github.com/kliem"
}
```

<div id="comment:74" align="right">comment:74</div>

I'm happy with this ticket, but I would like another opinion on this.



---

archive/issue_comments_500303.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nOk, I give it another 24 hours. If nobody speaks up, I'll give a positive review (after taking a final look of course).",
    "created_at": "2021-02-02T16:45:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500303",
    "user": "https://github.com/kliem"
}
```

<div id="comment:75" align="right">comment:75</div>

Ok, I give it another 24 hours. If nobody speaks up, I'll give a positive review (after taking a final look of course).



---

archive/issue_comments_500304.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nI don't feel like I have enough experience to review this, but it certainly built on Big Sur and Catalina.  I'm going to upgrade Big Sur to 11.2 later and see if this builds on 11.2 as well.",
    "created_at": "2021-02-02T17:03:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500304",
    "user": "https://github.com/zlscherr"
}
```

<div id="comment:76" align="right">comment:76</div>

I don't feel like I have enough experience to review this, but it certainly built on Big Sur and Catalina.  I'm going to upgrade Big Sur to 11.2 later and see if this builds on 11.2 as well.



---

archive/issue_comments_500305.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nReplying to [@mkoeppe](#comment%3A64):\n> Started tests at https://github.com/mkoeppe/sage/actions/runs/526769308 but it looks like there is a long wait time to get macos instances\n\nSome more results:\n- `local-homebrew-macos-10.15-xcode-{12.2,12.3,12.4}-{minimal,standard}`: clean except for doctest errors from `ld: warning` (#31204)\n- `local-homebrew-macos-11.0-xcode-{12.2,12.3}-minimal`: `scipy` build fails (https://github.com/mkoeppe/sage/runs/1804239019?check_suite_focus=true)\n- `local-homebrew-macos-11.0-xcode-12.3-standard`: clean except for doctest errors from `ld: warning` (#31204)",
    "created_at": "2021-02-02T17:28:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500305",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:77" align="right">comment:77</div>

Replying to [@mkoeppe](#comment%3A64):
> Started tests at https://github.com/mkoeppe/sage/actions/runs/526769308 but it looks like there is a long wait time to get macos instances

Some more results:
- `local-homebrew-macos-10.15-xcode-{12.2,12.3,12.4}-{minimal,standard}`: clean except for doctest errors from `ld: warning` (#31204)
- `local-homebrew-macos-11.0-xcode-{12.2,12.3}-minimal`: `scipy` build fails (https://github.com/mkoeppe/sage/runs/1804239019?check_suite_focus=true)
- `local-homebrew-macos-11.0-xcode-12.3-standard`: clean except for doctest errors from `ld: warning` (#31204)



---

archive/issue_comments_500306.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nLet's take care of the `scipy` build failures in #31326.\n\nI think this is sufficient improvement for one ticket.",
    "created_at": "2021-02-02T17:33:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500306",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:78" align="right">comment:78</div>

Let's take care of the `scipy` build failures in #31326.

I think this is sufficient improvement for one ticket.



---

archive/issue_comments_500307.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nSeems to work well on Big Sur 11.2 with standard homebrew packages.  When running make ptest I get the annoying warnings:\n\nld: warning: dylib (/usr/local/lib/libgmp.dylib) was built for newer macOS version (10.15) than being linked (10.14.6)\n\nwhich is probably because the MACOSX_DEPLOYMENT_TARGET for /usr/bin/python3 is set to 10.14.6 which doesn't match what Homebrew sets. It's easy enough to eliminate the warnings by setting MACOSX_DEPLOYMENT_TARGET=11.0 before doing all the testing.\n\nOtherwise, everything seems to build/test correctly.",
    "created_at": "2021-02-03T01:04:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500307",
    "user": "https://github.com/zlscherr"
}
```

<div id="comment:80" align="right">comment:80</div>

Seems to work well on Big Sur 11.2 with standard homebrew packages.  When running make ptest I get the annoying warnings:

ld: warning: dylib (/usr/local/lib/libgmp.dylib) was built for newer macOS version (10.15) than being linked (10.14.6)

which is probably because the MACOSX_DEPLOYMENT_TARGET for /usr/bin/python3 is set to 10.14.6 which doesn't match what Homebrew sets. It's easy enough to eliminate the warnings by setting MACOSX_DEPLOYMENT_TARGET=11.0 before doing all the testing.

Otherwise, everything seems to build/test correctly.



---

archive/issue_comments_500308.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nOk. Thanks for fixing all of this. I think the ticket is a good improvement as it is.",
    "created_at": "2021-02-03T19:02:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500308",
    "user": "https://github.com/kliem"
}
```

<div id="comment:81" align="right">comment:81</div>

Ok. Thanks for fixing all of this. I think the ticket is a good improvement as it is.



---

archive/issue_events_427224.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-02-03T19:02:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31227#event-427224"
}
```



---

archive/issue_events_427225.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-02-03T19:02:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31227#event-427225"
}
```



---

archive/issue_comments_500309.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nThanks!",
    "created_at": "2021-02-03T19:21:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500309",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:82" align="right">comment:82</div>

Thanks!



---

archive/issue_comments_500310.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/accept__usr_bin_python3_from_xcode_12_3_on_macos_10_15__catalina_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/accept__usr_bin_python3_from_xcode_12_3_on_macos_10_15__catalina_)** to **[`fc8b676`](https://github.com/sagemath/sagetrac-mirror/commit/fc8b67644bada9ea52cbb7c91f53f763ca84f4bb)**",
    "created_at": "2021-02-20T10:46:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31227#issuecomment-500310",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/accept__usr_bin_python3_from_xcode_12_3_on_macos_10_15__catalina_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/accept__usr_bin_python3_from_xcode_12_3_on_macos_10_15__catalina_)** to **[`fc8b676`](https://github.com/sagemath/sagetrac-mirror/commit/fc8b67644bada9ea52cbb7c91f53f763ca84f4bb)**



---

archive/issue_events_427226.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-02-20T10:46:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31227#event-427226"
}
```



---

archive/issue_events_427227.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "1a79f3f401122ebb4a50147c9e0c3076d1f12b32",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-02-20T10:46:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31227",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31227#event-427227"
}
```
