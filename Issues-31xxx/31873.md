# Issue 31873: use libgiac instead of giac for integration

archive/issues_031636.json:
```json
{
    "body": "Now that giacpy_sage has been included into Sage by #29171, we can use it for integration instead of the Pexpect interface. This ticket adds a `libgiac_integrator` which replaces the `giac_integrator` in the default integrator (which uses Maxima, Giac, and Sympy).\n\nThis will resolve issues like #28913 or this [ask-sage question](https://ask.sagemath.org/question/57312/result-that-comes-with-warning-from-giac-integrator/) where the Pexpect output cannot be parsed by Sage because Giac prints warning messages to the output.\n\nThe `libgiac_integrator` behaves slightly different than the Pexpect-based integrator, in that warning messages issued by Giac are not stripped away anymore.\n\n```\nsage: integrate(abs(cos(x)), x, 0, 2*pi)\nWarning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):\nCheck [abs(cos(x))]\nDiscontinuities at zeroes of cos(x) were not checked\n4\n```\nThese messages are generally useful in interactive use. For doctests, the current branch adjusts most of the tests so that they do not depend on the presence of these messages.\n\nDue to the problem at #31655, the first doctest in a file that uses libgiac results in some additional messages, but again the tests are written so that this does not matter. If that ticket is resolved, the second commit could be mostly reverted, but this is not strictly necessary. With the default integrator, these Giac loading messages will appear on the first integral that Maxima cannot solve.\n\nPart of meta-ticket #16688.\n\nCC:  @slel\n\nKeywords: giac, integration\n\nBranch/Commit: bb15f0f3fa8e18801c23442ae73f8bb4fac36cf0\n\nReviewer: Matthias Koeppe\n\nAuthor: Markus Wageringel\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31873\n\n",
    "closed_at": "2021-08-29T09:36:42Z",
    "created_at": "2021-05-28T20:34:55Z",
    "labels": [
        "component: interfaces"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "use libgiac instead of giac for integration",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31873",
    "user": "https://github.com/mwageringel"
}
```
Now that giacpy_sage has been included into Sage by #29171, we can use it for integration instead of the Pexpect interface. This ticket adds a `libgiac_integrator` which replaces the `giac_integrator` in the default integrator (which uses Maxima, Giac, and Sympy).

This will resolve issues like #28913 or this [ask-sage question](https://ask.sagemath.org/question/57312/result-that-comes-with-warning-from-giac-integrator/) where the Pexpect output cannot be parsed by Sage because Giac prints warning messages to the output.

The `libgiac_integrator` behaves slightly different than the Pexpect-based integrator, in that warning messages issued by Giac are not stripped away anymore.

```
sage: integrate(abs(cos(x)), x, 0, 2*pi)
Warning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):
Check [abs(cos(x))]
Discontinuities at zeroes of cos(x) were not checked
4
```
These messages are generally useful in interactive use. For doctests, the current branch adjusts most of the tests so that they do not depend on the presence of these messages.

Due to the problem at #31655, the first doctest in a file that uses libgiac results in some additional messages, but again the tests are written so that this does not matter. If that ticket is resolved, the second commit could be mostly reverted, but this is not strictly necessary. With the default integrator, these Giac loading messages will appear on the first integral that Maxima cannot solve.

Part of meta-ticket #16688.

CC:  @slel

Keywords: giac, integration

Branch/Commit: bb15f0f3fa8e18801c23442ae73f8bb4fac36cf0

Reviewer: Matthias Koeppe

Author: Markus Wageringel

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31873





---

archive/issue_comments_482308.json:
```json
{
    "body": "Changing keywords from \"\" to \"giac\".",
    "created_at": "2021-05-28T20:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31873#issuecomment-482308",
    "user": "https://github.com/mwageringel"
}
```

Changing keywords from "" to "giac".



---

archive/issue_comments_482309.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2021-06-17T18:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31873#issuecomment-482309",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_482310.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-17T18:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31873#issuecomment-482310",
    "user": "https://github.com/mwageringel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_482311.json:
```json
{
    "body": "Changing keywords from \"giac\" to \"giac, integration\".",
    "created_at": "2021-06-17T18:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31873#issuecomment-482311",
    "user": "https://github.com/mwageringel"
}
```

Changing keywords from "giac" to "giac, integration".



---

archive/issue_comments_482312.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,6 +1,19 @@\n-Now that giacpy_sage has been included into Sage by #29171, we can use it for integration instead of the Pexpect interface.\n+Now that giacpy_sage has been included into Sage by #29171, we can use it for integration instead of the Pexpect interface. This ticket adds a `libgiac_integrator` which replaces the `giac_integrator` in the default integrator (which uses Maxima, Giac, and Sympy).\n \n This will resolve issues like #28913 or this [ask-sage question](https://ask.sagemath.org/question/57312/result-that-comes-with-warning-from-giac-integrator/) where the Pexpect output cannot be parsed by Sage because Giac prints warning messages to the output.\n+\n+The `libgiac_integrator` behaves slightly different than the Pexpect-based integrator, in that warning messages issued by Giac are not stripped away anymore.\n+\n+```\n+sage: integrate(abs(cos(x)), x, 0, 2*pi)\n+Warning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):\n+Check [abs(cos(x))]\n+Discontinuities at zeroes of cos(x) were not checked\n+4\n+```\n+These messages are generally useful in interactive use. For doctests, the current branch adjusts most of the tests so that they do not depend on the presence of these messages.\n+\n+Due to the problem at #31655, the first doctest in a file that uses libgiac results in some additional messages, but again the tests are written so that this does not matter. If that ticket is resolved, the second commit could be mostly reverted, but this is not strictly necessary. With the default integrator, these Giac loading messages will appear on the first integral that Maxima cannot solve.\n \n Part of meta-ticket #16688.\n \n```\n",
    "created_at": "2021-06-17T18:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31873#issuecomment-482312",
    "user": "https://github.com/mwageringel"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,6 +1,19 @@
-Now that giacpy_sage has been included into Sage by #29171, we can use it for integration instead of the Pexpect interface.
+Now that giacpy_sage has been included into Sage by #29171, we can use it for integration instead of the Pexpect interface. This ticket adds a `libgiac_integrator` which replaces the `giac_integrator` in the default integrator (which uses Maxima, Giac, and Sympy).
 
 This will resolve issues like #28913 or this [ask-sage question](https://ask.sagemath.org/question/57312/result-that-comes-with-warning-from-giac-integrator/) where the Pexpect output cannot be parsed by Sage because Giac prints warning messages to the output.
+
+The `libgiac_integrator` behaves slightly different than the Pexpect-based integrator, in that warning messages issued by Giac are not stripped away anymore.
+
+```
+sage: integrate(abs(cos(x)), x, 0, 2*pi)
+Warning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):
+Check [abs(cos(x))]
+Discontinuities at zeroes of cos(x) were not checked
+4
+```
+These messages are generally useful in interactive use. For doctests, the current branch adjusts most of the tests so that they do not depend on the presence of these messages.
+
+Due to the problem at #31655, the first doctest in a file that uses libgiac results in some additional messages, but again the tests are written so that this does not matter. If that ticket is resolved, the second commit could be mostly reverted, but this is not strictly necessary. With the default integrator, these Giac loading messages will appear on the first integral that Maxima cannot solve.
 
 Part of meta-ticket #16688.
 
```




---

archive/issue_comments_482313.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-18T16:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31873#issuecomment-482313",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_482314.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-25T21:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31873#issuecomment-482314",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_482315.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-17T21:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31873#issuecomment-482315",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_482316.json:
```json
{
    "body": "<a id='comment:5'></a>LGTM",
    "created_at": "2021-07-17T21:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31873#issuecomment-482316",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>LGTM



---

archive/issue_comments_482317.json:
```json
{
    "body": "<a id='comment:6'></a>Thanks.",
    "created_at": "2021-07-18T13:39:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31873#issuecomment-482317",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:6'></a>Thanks.



---

archive/issue_comments_482318.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-07-23T23:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31873#issuecomment-482318",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_482319.json:
```json
{
    "body": "<a id='comment:7'></a>test failures\n\n```\nsage -t --long --warn-long 45.1 --random-seed=0 src/sage/symbolic/integration/integral.py  # 2 doctests failed\nsage -t --long --warn-long 45.1 --random-seed=0 src/doc/en/prep/Calculus.rst  # 1 doctest failed\n```",
    "created_at": "2021-07-23T23:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31873#issuecomment-482319",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>test failures

```
sage -t --long --warn-long 45.1 --random-seed=0 src/sage/symbolic/integration/integral.py  # 2 doctests failed
sage -t --long --warn-long 45.1 --random-seed=0 src/doc/en/prep/Calculus.rst  # 1 doctest failed
```



---

archive/issue_comments_482320.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-26T20:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31873#issuecomment-482320",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_482321.json:
```json
{
    "body": "<a id='comment:9'></a>I have fixed the doctests. Now this passes ptestlong again. Also, this does not conflict with #32275.",
    "created_at": "2021-07-26T20:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31873#issuecomment-482321",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:9'></a>I have fixed the doctests. Now this passes ptestlong again. Also, this does not conflict with #32275.



---

archive/issue_comments_482322.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-07-26T20:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31873#issuecomment-482322",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_482323.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-01T23:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31873#issuecomment-482323",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_084188.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:07:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31873",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31873#event-84188"
}
```



---

archive/issue_events_084189.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-08-29T09:36:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31873",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31873#event-84189"
}
```



---

archive/issue_comments_482324.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-08-29T09:36:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31873#issuecomment-482324",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
