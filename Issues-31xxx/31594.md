# Issue 31594: Accept giac-1.7.x from the system

archive/issues_031357.json:
```json
{
    "assignees": [],
    "body": "This works fine out-of-the-box, we just need to tweak the version bounds in spkg-configure.m4 to accept it.\n\nCC:  @mkoeppe @dimpase @isuruf @antonio-rojas @kiwifb\n\nBranch/Commit: **[55e3613](https://github.com/sagemath/sagetrac-mirror/commit/55e36139c7719c838c68e0a4bf95472d709b1470)**\n\nReviewer: **Dima Pasechnik, Travis Scrimshaw**\n\nAuthor: **Michael Orlitzky**\n\nComponent: **build: configure**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31594_\n\n",
    "closed_at": "2021-06-06T13:18:33Z",
    "created_at": "2021-04-02T13:32:01Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Accept giac-1.7.x from the system",
    "type": "issue",
    "updated_at": "2021-06-06T13:18:33Z",
    "url": "https://github.com/sagemath/sage/issues/31594",
    "user": "https://github.com/orlitzky"
}
```
This works fine out-of-the-box, we just need to tweak the version bounds in spkg-configure.m4 to accept it.

CC:  @mkoeppe @dimpase @isuruf @antonio-rojas @kiwifb

Branch/Commit: **[55e3613](https://github.com/sagemath/sagetrac-mirror/commit/55e36139c7719c838c68e0a4bf95472d709b1470)**

Reviewer: **Dima Pasechnik, Travis Scrimshaw**

Author: **Michael Orlitzky**

Component: **build: configure**

_Issue created by migration from https://trac.sagemath.org/ticket/31594_





---

archive/issue_events_435796.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-04-02T13:32:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-435796"
}
```



---

archive/issue_events_435797.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-04-02T13:32:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
    "label_color": "000080",
    "label_name": "c: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-435797"
}
```



---

archive/issue_events_435798.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-04-02T13:32:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-435798"
}
```



---

archive/issue_events_435799.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-04-02T13:32:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-435799"
}
```



---

archive/issue_comments_508383.json:
```json
{
    "body": "Branch: **[u/mjo/ticket/31594](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/31594)**",
    "created_at": "2021-04-02T13:34:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508383",
    "user": "https://github.com/orlitzky"
}
```

Branch: **[u/mjo/ticket/31594](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/31594)**



---

archive/issue_events_435800.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-04-02T13:34:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-435800"
}
```



---

archive/issue_comments_508384.json:
```json
{
    "body": "Commit: **[890c354](https://github.com/sagemath/sagetrac-mirror/commit/890c35414a729ec6e094ec2193b77da59290e705)**",
    "created_at": "2021-04-02T13:34:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508384",
    "user": "https://github.com/orlitzky"
}
```

Commit: **[890c354](https://github.com/sagemath/sagetrac-mirror/commit/890c35414a729ec6e094ec2193b77da59290e705)**



---

archive/issue_comments_508385.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/890c35414a729ec6e094ec2193b77da59290e705\">890c354</a></td><td><code>Trac #31594: accept giac-1.7.x from the system.</code></td></tr></table>\n",
    "created_at": "2021-04-02T13:34:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508385",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/890c35414a729ec6e094ec2193b77da59290e705">890c354</a></td><td><code>Trac #31594: accept giac-1.7.x from the system.</code></td></tr></table>




---

archive/issue_events_435801.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-07T19:29:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-435801"
}
```



---

archive/issue_events_435802.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-07T19:29:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-435802"
}
```



---

archive/issue_comments_508386.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nSage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-04-07T19:29:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508386",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">comment:2</div>

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_508387.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI am prepared to accept this, although I probably would want #31563 to be done first.",
    "created_at": "2021-04-11T23:08:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508387",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:3" align="right">comment:3</div>

I am prepared to accept this, although I probably would want #31563 to be done first.



---

archive/issue_comments_508388.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nOne of the main benefits of using system packages is that we don't all have to wait for someone to duplicate pointless work in the SPKG =)",
    "created_at": "2021-04-14T12:59:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508388",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:4" align="right">comment:4</div>

One of the main benefits of using system packages is that we don't all have to wait for someone to duplicate pointless work in the SPKG =)



---

archive/issue_comments_508389.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@orlitzky](#comment:4):\n> One of the main benefits of using system packages is that we don't all have to wait for someone to duplicate pointless work in the SPKG =)\n> \n\nI am impatiently waiting for removal of gcc and gfortran packages (along with the rest of Sage toolchain), to start with :-)",
    "created_at": "2021-04-14T13:13:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508389",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@orlitzky](#comment:4):
> One of the main benefits of using system packages is that we don't all have to wait for someone to duplicate pointless work in the SPKG =)
> 

I am impatiently waiting for removal of gcc and gfortran packages (along with the rest of Sage toolchain), to start with :-)



---

archive/issue_comments_508390.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nlet me test on Gentoo. It seems I'd also  need pari 2.13 from the system for this to work, though.",
    "created_at": "2021-04-14T13:18:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508390",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

let me test on Gentoo. It seems I'd also  need pari 2.13 from the system for this to work, though.



---

archive/issue_comments_508391.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik, Travis Scrimshaw**",
    "created_at": "2021-04-14T13:19:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508391",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik, Travis Scrimshaw**



---

archive/issue_events_435803.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-04-14T13:19:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-435803"
}
```



---

archive/issue_events_435804.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-04-14T13:19:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-435804"
}
```



---

archive/issue_comments_508392.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nBeware that the latest 1.7.0.3 version causes some breakage. Some tests fail because of changes in expression expansion, but there are some other weird failures such as\n\n```\nFile \"/usr/lib/python3.9/site-packages/sage/interfaces/giac.py\", line 724, in sage.interfaces.giac.Giac._equality_symbol\nFailed example:\n    giac(2) == giac(2)\nExpected:\n    True\nGot:\n    False\n```",
    "created_at": "2021-05-01T17:09:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508392",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:8" align="right">comment:8</div>

Beware that the latest 1.7.0.3 version causes some breakage. Some tests fail because of changes in expression expansion, but there are some other weird failures such as

```
File "/usr/lib/python3.9/site-packages/sage/interfaces/giac.py", line 724, in sage.interfaces.giac.Giac._equality_symbol
Failed example:
    giac(2) == giac(2)
Expected:
    True
Got:
    False
```



---

archive/issue_comments_508393.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nSeems that evalb is just broken in 1.7.0.3\n\n```\n0>> a:=0\n0\n// Time 0\n1>> evalb(a==0)\nfalse\n// Time 0\n```\nCould someone with an account please report it upstream?",
    "created_at": "2021-05-02T10:53:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508393",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:9" align="right">comment:9</div>

Seems that evalb is just broken in 1.7.0.3

```
0>> a:=0
0
// Time 0
1>> evalb(a==0)
false
// Time 0
```
Could someone with an account please report it upstream?



---

archive/issue_comments_508394.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nevalb bug fixed [https://dev.geogebra.org/trac/changeset/69847/](https://dev.geogebra.org/trac/changeset/69847/)\nThere are indeed some changes in symbolic integration and simplification in giac 1.7.0-3.",
    "created_at": "2021-05-02T17:32:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508394",
    "user": "https://github.com/sagetrac-parisse"
}
```

<div id="comment:10" align="right">comment:10</div>

evalb bug fixed [https://dev.geogebra.org/trac/changeset/69847/](https://dev.geogebra.org/trac/changeset/69847/)
There are indeed some changes in symbolic integration and simplification in giac 1.7.0-3.



---

archive/issue_comments_508395.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\n1.7.0-3 doesn't like the default `-std=c++17` of gcc-11. I guess that applies to all the previous versions as well. Setting `CXX=\"g++ -std=c++14\"` or passing the standard as a CXXFLAGS does work.",
    "created_at": "2021-05-02T21:49:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508395",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:11" align="right">comment:11</div>

1.7.0-3 doesn't like the default `-std=c++17` of gcc-11. I guess that applies to all the previous versions as well. Setting `CXX="g++ -std=c++14"` or passing the standard as a CXXFLAGS does work.



---

archive/issue_events_435805.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-05-09T10:38:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-435805"
}
```



---

archive/issue_events_435806.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-05-09T10:38:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-435806"
}
```



---

archive/issue_comments_508396.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI'll change this to accept only 1.7.0.1 for now, since the simplification changes are likely to stick around.",
    "created_at": "2021-05-09T10:38:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508396",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:12" align="right">comment:12</div>

I'll change this to accept only 1.7.0.1 for now, since the simplification changes are likely to stick around.



---

archive/issue_comments_508397.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nOh, they all return the same version number.",
    "created_at": "2021-05-09T10:43:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508397",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:13" align="right">comment:13</div>

Oh, they all return the same version number.



---

archive/issue_comments_508398.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nWhy not just modify the tests so they pass with both versions? IMHO a slight change in output format shouldn't block using a system package. And some of these tests already have a very generic expected output:\n\n```\nFile \"/usr/lib/python3.9/site-packages/sage/interfaces/giac.py\", line 609, in sage.interfaces.giac.Giac._eval_line\nFailed example:\n    giac(h)\nExpected:\n    12*(...)\n```",
    "created_at": "2021-05-09T10:47:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508398",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:14" align="right">comment:14</div>

Why not just modify the tests so they pass with both versions? IMHO a slight change in output format shouldn't block using a system package. And some of these tests already have a very generic expected output:

```
File "/usr/lib/python3.9/site-packages/sage/interfaces/giac.py", line 609, in sage.interfaces.giac.Giac._eval_line
Failed example:
    giac(h)
Expected:
    12*(...)
```



---

archive/issue_comments_508399.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@antonio-rojas](#comment:14):\n> Why not just modify the tests so they pass with both versions?\n\nI came to this same conclusion a few seconds ago =)\n\nFirst I have to update our Gentoo package to 1.7.0.5 so that I can see the new output and fix the c++17 issue, but then I'll update this branch with tests that work with all versions.",
    "created_at": "2021-05-09T10:49:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508399",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@antonio-rojas](#comment:14):
> Why not just modify the tests so they pass with both versions?

I came to this same conclusion a few seconds ago =)

First I have to update our Gentoo package to 1.7.0.5 so that I can see the new output and fix the c++17 issue, but then I'll update this branch with tests that work with all versions.



---

archive/issue_comments_508400.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThe bump is trivial. c++17 is probably a can of worms.",
    "created_at": "2021-05-09T10:51:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508400",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:16" align="right">comment:16</div>

The bump is trivial. c++17 is probably a can of worms.



---

archive/issue_comments_508401.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nBy \"fix\" I mean `append-cxxflags -std=c++14`",
    "created_at": "2021-05-09T10:55:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508401",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:17" align="right">comment:17</div>

By "fix" I mean `append-cxxflags -std=c++14`



---

archive/issue_comments_508402.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nYes, I did that in the overlay. A bit ham-fisted but it basically works.",
    "created_at": "2021-05-09T10:56:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508402",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:18" align="right">comment:18</div>

Yes, I did that in the overlay. A bit ham-fisted but it basically works.



---

archive/issue_comments_508403.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@antonio-rojas](#comment:14):\n> Why not just modify the tests so they pass with both versions? IMHO a slight change in output format shouldn't block using a system package. And some of these tests already have a very generic expected output:\n> \n> ```\n> File \"/usr/lib/python3.9/site-packages/sage/interfaces/giac.py\", line 609, in sage.interfaces.giac.Giac._eval_line\n> Failed example:\n>     giac(h)\n> Expected:\n>     12*(...)\n> ```\n\nThis is not such a great example anyway:\n\n```\nsage: f = 1/x*((-2*x^(1/3)+1)^(1/4))^3                                                                                                                                       \nsage: integrate(f,x,algorithm='maxima')(x=1).n()                                                                                                                             \n-0.760158905420130 + 10.1849368661895*I\nsage: integrate(f,x,algorithm='sympy')(x=1).n()                                                                                                                              \n-10.1849368661895 + 10.1849368661895*I\nsage: integrate(f,x,algorithm='giac')(x=1).n()                                                                                                                               \n-0.760158905420130 + 4.29445064070865*I\n```\n\nI think I'll replace it with an integral that I can do in my head.",
    "created_at": "2021-05-10T12:09:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508403",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@antonio-rojas](#comment:14):
> Why not just modify the tests so they pass with both versions? IMHO a slight change in output format shouldn't block using a system package. And some of these tests already have a very generic expected output:
> 
> ```
> File "/usr/lib/python3.9/site-packages/sage/interfaces/giac.py", line 609, in sage.interfaces.giac.Giac._eval_line
> Failed example:
>     giac(h)
> Expected:
>     12*(...)
> ```

This is not such a great example anyway:

```
sage: f = 1/x*((-2*x^(1/3)+1)^(1/4))^3                                                                                                                                       
sage: integrate(f,x,algorithm='maxima')(x=1).n()                                                                                                                             
-0.760158905420130 + 10.1849368661895*I
sage: integrate(f,x,algorithm='sympy')(x=1).n()                                                                                                                              
-10.1849368661895 + 10.1849368661895*I
sage: integrate(f,x,algorithm='giac')(x=1).n()                                                                                                                               
-0.760158905420130 + 4.29445064070865*I
```

I think I'll replace it with an integral that I can do in my head.



---

archive/issue_comments_508404.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@orlitzky](#comment:19):\n> \n> ```\n> sage: f = 1/x*((-2*x^(1/3)+1)^(1/4))^3                                                                                                                                       \n> sage: integrate(f,x,algorithm='maxima')(x=1).n()                                                                                                                             \n> -0.760158905420130 + 10.1849368661895*I\n> sage: integrate(f,x,algorithm='sympy')(x=1).n()                                                                                                                              \n> -10.1849368661895 + 10.1849368661895*I\n> sage: integrate(f,x,algorithm='giac')(x=1).n()                                                                                                                               \n> -0.760158905420130 + 4.29445064070865*I\n> ```\n\n\n```\nsage: integrate(f,x,algorithm='fricas')(x=1).n()\n-0.760158905420130 + 10.1849368661895*I\n```",
    "created_at": "2021-05-10T15:04:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508404",
    "user": "https://github.com/sheerluck"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@orlitzky](#comment:19):
> 
> ```
> sage: f = 1/x*((-2*x^(1/3)+1)^(1/4))^3                                                                                                                                       
> sage: integrate(f,x,algorithm='maxima')(x=1).n()                                                                                                                             
> -0.760158905420130 + 10.1849368661895*I
> sage: integrate(f,x,algorithm='sympy')(x=1).n()                                                                                                                              
> -10.1849368661895 + 10.1849368661895*I
> sage: integrate(f,x,algorithm='giac')(x=1).n()                                                                                                                               
> -0.760158905420130 + 4.29445064070865*I
> ```


```
sage: integrate(f,x,algorithm='fricas')(x=1).n()
-0.760158905420130 + 10.1849368661895*I
```



---

archive/issue_comments_508405.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nIf I understand correctly, you are evaluating an antiderivative at x=1 and you get an approximation. I do not understand how this test can be meaningful, since an antiderivative is defined up to a constant. One could argue it should stay the same for a given CAS, but that's not true, I made some improvements in symbolic integration recently in giac, and that means sometimes that the algorithm changes and the antiderivative expression too.",
    "created_at": "2021-05-10T17:38:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508405",
    "user": "https://github.com/sagetrac-parisse"
}
```

<div id="comment:21" align="right">comment:21</div>

If I understand correctly, you are evaluating an antiderivative at x=1 and you get an approximation. I do not understand how this test can be meaningful, since an antiderivative is defined up to a constant. One could argue it should stay the same for a given CAS, but that's not true, I made some improvements in symbolic integration recently in giac, and that means sometimes that the algorithm changes and the antiderivative expression too.



---

archive/issue_comments_508406.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI'm not blaming giac for anything here. The existing test was a bad choice:\n\n1. It was testing the exact string form of an indefinite integral, which, as you note, is unreliable for many reasons.\n2. The results of that indefinite integral do not agree (even up to a constant) between the various integration engines we have, so who knows if \"expected\" output is correct.\n\nMy use of `(x=1).n()` just makes it clear that the answers are different, since the resulting expression is rather ugly.",
    "created_at": "2021-05-10T18:06:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508406",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:22" align="right">comment:22</div>

I'm not blaming giac for anything here. The existing test was a bad choice:

1. It was testing the exact string form of an indefinite integral, which, as you note, is unreliable for many reasons.
2. The results of that indefinite integral do not agree (even up to a constant) between the various integration engines we have, so who knows if "expected" output is correct.

My use of `(x=1).n()` just makes it clear that the answers are different, since the resulting expression is rather ugly.



---

archive/issue_comments_508407.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nA more meaningful test would be F=integrate(f) then simplify(diff(F)-f). I have added some examples in the check subdirectory of giac, from the independent integrals testsuite from [https://www.12000.org/my_notes/CAS_integration_tests/reports/rubi_4_16_1_graded/inch1.htm#x2-30001.2](https://www.12000.org/my_notes/CAS_integration_tests/reports/rubi_4_16_1_graded/inch1.htm#x2-30001.2)",
    "created_at": "2021-05-10T19:07:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508407",
    "user": "https://github.com/sagetrac-parisse"
}
```

<div id="comment:23" align="right">comment:23</div>

A more meaningful test would be F=integrate(f) then simplify(diff(F)-f). I have added some examples in the check subdirectory of giac, from the independent integrals testsuite from [https://www.12000.org/my_notes/CAS_integration_tests/reports/rubi_4_16_1_graded/inch1.htm#x2-30001.2](https://www.12000.org/my_notes/CAS_integration_tests/reports/rubi_4_16_1_graded/inch1.htm#x2-30001.2)



---

archive/issue_comments_508408.json:
```json
{
    "body": "Changed commit from **[890c354](https://github.com/sagemath/sagetrac-mirror/commit/890c35414a729ec6e094ec2193b77da59290e705)** to **[55e3613](https://github.com/sagemath/sagetrac-mirror/commit/55e36139c7719c838c68e0a4bf95472d709b1470)**",
    "created_at": "2021-05-11T12:29:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508408",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[890c354](https://github.com/sagemath/sagetrac-mirror/commit/890c35414a729ec6e094ec2193b77da59290e705)** to **[55e3613](https://github.com/sagemath/sagetrac-mirror/commit/55e36139c7719c838c68e0a4bf95472d709b1470)**



---

archive/issue_comments_508409.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa49b852c4195e75ebb31dfd8c05117138b0b3bb\">fa49b85</a></td><td><code>Trac #31594: accept giac-1.7.x from the system.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5d6689694c3a590728ddd5ca2a182648ebbc684\">d5d6689</a></td><td><code>Trac #31594: fix an interface test with newer versions of giac.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/60a307aadf9d8d724675d8d3b7343ff9dd12c26d\">60a307a</a></td><td><code>Trac #31594: support giac-1.7.x in symbolic integration tests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55e36139c7719c838c68e0a4bf95472d709b1470\">55e3613</a></td><td><code>Trac #31594: simplify two libgiac simplify() examples.</code></td></tr></table>\n",
    "created_at": "2021-05-11T12:29:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508409",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa49b852c4195e75ebb31dfd8c05117138b0b3bb">fa49b85</a></td><td><code>Trac #31594: accept giac-1.7.x from the system.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5d6689694c3a590728ddd5ca2a182648ebbc684">d5d6689</a></td><td><code>Trac #31594: fix an interface test with newer versions of giac.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/60a307aadf9d8d724675d8d3b7343ff9dd12c26d">60a307a</a></td><td><code>Trac #31594: support giac-1.7.x in symbolic integration tests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55e36139c7719c838c68e0a4bf95472d709b1470">55e3613</a></td><td><code>Trac #31594: simplify two libgiac simplify() examples.</code></td></tr></table>




---

archive/issue_comments_508410.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@sagetrac-parisse](#comment:23):\n> A more meaningful test would be F=integrate(f) then simplify(diff(F)-f). I have added some examples in the check subdirectory of giac, from the independent integrals testsuite from [https://www.12000.org/my_notes/CAS_integration_tests/reports/rubi_4_16_1_graded/inch1.htm#x2-30001.2](https://www.12000.org/my_notes/CAS_integration_tests/reports/rubi_4_16_1_graded/inch1.htm#x2-30001.2)\n\nThe call to `simplify()` takes ages in this case. Since the point of that test is to check that we can pass a string to `giac()`, I changed the example to `sin(x)^2 + cos(x)^2` and have compared the result (`x`) as a symbolic expression.",
    "created_at": "2021-05-11T12:36:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508410",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@sagetrac-parisse](#comment:23):
> A more meaningful test would be F=integrate(f) then simplify(diff(F)-f). I have added some examples in the check subdirectory of giac, from the independent integrals testsuite from [https://www.12000.org/my_notes/CAS_integration_tests/reports/rubi_4_16_1_graded/inch1.htm#x2-30001.2](https://www.12000.org/my_notes/CAS_integration_tests/reports/rubi_4_16_1_graded/inch1.htm#x2-30001.2)

The call to `simplify()` takes ages in this case. Since the point of that test is to check that we can pass a string to `giac()`, I changed the example to `sin(x)^2 + cos(x)^2` and have compared the result (`x`) as a symbolic expression.



---

archive/issue_events_435807.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-05-11T12:36:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-435807"
}
```



---

archive/issue_events_435808.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-05-11T12:36:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-435808"
}
```



---

archive/issue_events_435809.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-05-11T22:53:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-435809"
}
```



---

archive/issue_events_435810.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-05-11T22:53:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-435810"
}
```



---

archive/issue_comments_508411.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nlgtm",
    "created_at": "2021-05-11T22:53:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508411",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

lgtm



---

archive/issue_comments_508412.json:
```json
{
    "body": "Changed branch from **[u/mjo/ticket/31594](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/31594)** to **[55e3613](https://github.com/sagemath/sagetrac-mirror/commit/55e36139c7719c838c68e0a4bf95472d709b1470)**",
    "created_at": "2021-06-06T13:18:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-508412",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mjo/ticket/31594](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/31594)** to **[55e3613](https://github.com/sagemath/sagetrac-mirror/commit/55e36139c7719c838c68e0a4bf95472d709b1470)**



---

archive/issue_events_435811.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-06T13:18:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-435811"
}
```



---

archive/issue_events_435812.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "63c3d0fecba6245e6f33972bc84652fb4415a2ee",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-06-06T13:18:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-435812"
}
```
