# Issue 31594: Accept giac-1.7.x from the system

archive/issues_031357.json:
```json
{
    "assignees": [],
    "body": "This works fine out-of-the-box, we just need to tweak the version bounds in spkg-configure.m4 to accept it.\n\nCC:  @mkoeppe @dimpase @isuruf @antonio-rojas @kiwifb\n\nBranch/Commit: **[55e3613](https://github.com/sagemath/sagetrac-mirror/commit/55e36139c7719c838c68e0a4bf95472d709b1470)**\n\nReviewer: **Dima Pasechnik, Travis Scrimshaw**\n\nAuthor: **Michael Orlitzky**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31594_\n\n",
    "closed_at": "2021-06-06T13:18:33Z",
    "created_at": "2021-04-02T13:32:01Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Accept giac-1.7.x from the system",
    "type": "issue",
    "updated_at": "2021-06-06T13:18:33Z",
    "url": "https://github.com/sagemath/sage/issues/31594",
    "user": "https://github.com/orlitzky"
}
```
This works fine out-of-the-box, we just need to tweak the version bounds in spkg-configure.m4 to accept it.

CC:  @mkoeppe @dimpase @isuruf @antonio-rojas @kiwifb

Branch/Commit: **[55e3613](https://github.com/sagemath/sagetrac-mirror/commit/55e36139c7719c838c68e0a4bf95472d709b1470)**

Reviewer: **Dima Pasechnik, Travis Scrimshaw**

Author: **Michael Orlitzky**

_Issue created by migration from https://trac.sagemath.org/ticket/31594_





---

archive/issue_events_403464.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-04-02T13:32:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-403464"
}
```



---

archive/issue_events_403465.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-04-02T13:32:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build%3A%20configure",
    "label_color": "000080",
    "label_name": "component: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-403465"
}
```



---

archive/issue_events_403466.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-04-02T13:32:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-403466"
}
```



---

archive/issue_events_403467.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-04-02T13:32:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-403467"
}
```



---

archive/issue_comments_511301.json:
```json
{
    "body": "Branch: **[u/mjo/ticket/31594](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/31594)**",
    "created_at": "2021-04-02T13:34:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511301",
    "user": "https://github.com/orlitzky"
}
```

Branch: **[u/mjo/ticket/31594](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/31594)**



---

archive/issue_events_403468.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-04-02T13:34:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-403468"
}
```



---

archive/issue_comments_511302.json:
```json
{
    "body": "Commit: **[890c354](https://github.com/sagemath/sagetrac-mirror/commit/890c35414a729ec6e094ec2193b77da59290e705)**",
    "created_at": "2021-04-02T13:34:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511302",
    "user": "https://github.com/orlitzky"
}
```

Commit: **[890c354](https://github.com/sagemath/sagetrac-mirror/commit/890c35414a729ec6e094ec2193b77da59290e705)**



---

archive/issue_comments_511303.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/890c35414a729ec6e094ec2193b77da59290e705\">890c354</a></td><td><code>Trac #31594: accept giac-1.7.x from the system.</code></td></tr></table>\n",
    "created_at": "2021-04-02T13:34:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511303",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:1'>Comment 1:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/890c35414a729ec6e094ec2193b77da59290e705">890c354</a></td><td><code>Trac #31594: accept giac-1.7.x from the system.</code></td></tr></table>




---

archive/issue_events_403469.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-07T19:29:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-403469"
}
```



---

archive/issue_events_403470.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-07T19:29:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-403470"
}
```



---

archive/issue_comments_511304.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nSage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-04-07T19:29:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511304",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'>Comment 2:</a>
Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_511305.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nI am prepared to accept this, although I probably would want #31563 to be done first.",
    "created_at": "2021-04-11T23:08:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511305",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'>Comment 3:</a>
I am prepared to accept this, although I probably would want #31563 to be done first.



---

archive/issue_comments_511306.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nOne of the main benefits of using system packages is that we don't all have to wait for someone to duplicate pointless work in the SPKG =)",
    "created_at": "2021-04-14T12:59:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511306",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:4'>Comment 4:</a>
One of the main benefits of using system packages is that we don't all have to wait for someone to duplicate pointless work in the SPKG =)



---

archive/issue_comments_511307.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nReplying to [@orlitzky](#comment%3A4):\n> One of the main benefits of using system packages is that we don't all have to wait for someone to duplicate pointless work in the SPKG =)\n> \n\nI am impatiently waiting for removal of gcc and gfortran packages (along with the rest of Sage toolchain), to start with :-)",
    "created_at": "2021-04-14T13:13:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511307",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'>Comment 5:</a>
Replying to [@orlitzky](#comment%3A4):
> One of the main benefits of using system packages is that we don't all have to wait for someone to duplicate pointless work in the SPKG =)
> 

I am impatiently waiting for removal of gcc and gfortran packages (along with the rest of Sage toolchain), to start with :-)



---

archive/issue_comments_511308.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nlet me test on Gentoo. It seems I'd also  need pari 2.13 from the system for this to work, though.",
    "created_at": "2021-04-14T13:18:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511308",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'>Comment 6:</a>
let me test on Gentoo. It seems I'd also  need pari 2.13 from the system for this to work, though.



---

archive/issue_comments_511309.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik, Travis Scrimshaw**",
    "created_at": "2021-04-14T13:19:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511309",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik, Travis Scrimshaw**



---

archive/issue_events_403471.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-04-14T13:19:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-403471"
}
```



---

archive/issue_events_403472.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-04-14T13:19:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-403472"
}
```



---

archive/issue_comments_511310.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nBeware that the latest 1.7.0.3 version causes some breakage. Some tests fail because of changes in expression expansion, but there are some other weird failures such as\n\n```\nFile \"/usr/lib/python3.9/site-packages/sage/interfaces/giac.py\", line 724, in sage.interfaces.giac.Giac._equality_symbol\nFailed example:\n    giac(2) == giac(2)\nExpected:\n    True\nGot:\n    False\n```",
    "created_at": "2021-05-01T17:09:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511310",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:8'>Comment 8:</a>
Beware that the latest 1.7.0.3 version causes some breakage. Some tests fail because of changes in expression expansion, but there are some other weird failures such as

```
File "/usr/lib/python3.9/site-packages/sage/interfaces/giac.py", line 724, in sage.interfaces.giac.Giac._equality_symbol
Failed example:
    giac(2) == giac(2)
Expected:
    True
Got:
    False
```



---

archive/issue_comments_511311.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nSeems that evalb is just broken in 1.7.0.3\n\n```\n0>> a:=0\n0\n// Time 0\n1>> evalb(a==0)\nfalse\n// Time 0\n```\nCould someone with an account please report it upstream?",
    "created_at": "2021-05-02T10:53:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511311",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:9'>Comment 9:</a>
Seems that evalb is just broken in 1.7.0.3

```
0>> a:=0
0
// Time 0
1>> evalb(a==0)
false
// Time 0
```
Could someone with an account please report it upstream?



---

archive/issue_comments_511312.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nevalb bug fixed [https://dev.geogebra.org/trac/changeset/69847/](https://dev.geogebra.org/trac/changeset/69847/)\nThere are indeed some changes in symbolic integration and simplification in giac 1.7.0-3.",
    "created_at": "2021-05-02T17:32:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511312",
    "user": "https://github.com/sagetrac-parisse"
}
```

<a id='comment:10'>Comment 10:</a>
evalb bug fixed [https://dev.geogebra.org/trac/changeset/69847/](https://dev.geogebra.org/trac/changeset/69847/)
There are indeed some changes in symbolic integration and simplification in giac 1.7.0-3.



---

archive/issue_comments_511313.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\n1.7.0-3 doesn't like the default `-std=c++17` of gcc-11. I guess that applies to all the previous versions as well. Setting `CXX=\"g++ -std=c++14\"` or passing the standard as a CXXFLAGS does work.",
    "created_at": "2021-05-02T21:49:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511313",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'>Comment 11:</a>
1.7.0-3 doesn't like the default `-std=c++17` of gcc-11. I guess that applies to all the previous versions as well. Setting `CXX="g++ -std=c++14"` or passing the standard as a CXXFLAGS does work.



---

archive/issue_events_403473.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-05-09T10:38:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-403473"
}
```



---

archive/issue_events_403474.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-05-09T10:38:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-403474"
}
```



---

archive/issue_comments_511314.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nI'll change this to accept only 1.7.0.1 for now, since the simplification changes are likely to stick around.",
    "created_at": "2021-05-09T10:38:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511314",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:12'>Comment 12:</a>
I'll change this to accept only 1.7.0.1 for now, since the simplification changes are likely to stick around.



---

archive/issue_comments_511315.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nOh, they all return the same version number.",
    "created_at": "2021-05-09T10:43:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511315",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:13'>Comment 13:</a>
Oh, they all return the same version number.



---

archive/issue_comments_511316.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nWhy not just modify the tests so they pass with both versions? IMHO a slight change in output format shouldn't block using a system package. And some of these tests already have a very generic expected output:\n\n```\nFile \"/usr/lib/python3.9/site-packages/sage/interfaces/giac.py\", line 609, in sage.interfaces.giac.Giac._eval_line\nFailed example:\n    giac(h)\nExpected:\n    12*(...)\n```",
    "created_at": "2021-05-09T10:47:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511316",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:14'>Comment 14:</a>
Why not just modify the tests so they pass with both versions? IMHO a slight change in output format shouldn't block using a system package. And some of these tests already have a very generic expected output:

```
File "/usr/lib/python3.9/site-packages/sage/interfaces/giac.py", line 609, in sage.interfaces.giac.Giac._eval_line
Failed example:
    giac(h)
Expected:
    12*(...)
```



---

archive/issue_comments_511317.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nReplying to [@antonio-rojas](#comment%3A14):\n> Why not just modify the tests so they pass with both versions?\n\nI came to this same conclusion a few seconds ago =)\n\nFirst I have to update our Gentoo package to 1.7.0.5 so that I can see the new output and fix the c++17 issue, but then I'll update this branch with tests that work with all versions.",
    "created_at": "2021-05-09T10:49:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511317",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:15'>Comment 15:</a>
Replying to [@antonio-rojas](#comment%3A14):
> Why not just modify the tests so they pass with both versions?

I came to this same conclusion a few seconds ago =)

First I have to update our Gentoo package to 1.7.0.5 so that I can see the new output and fix the c++17 issue, but then I'll update this branch with tests that work with all versions.



---

archive/issue_comments_511318.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nThe bump is trivial. c++17 is probably a can of worms.",
    "created_at": "2021-05-09T10:51:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511318",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'>Comment 16:</a>
The bump is trivial. c++17 is probably a can of worms.



---

archive/issue_comments_511319.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nBy \"fix\" I mean `append-cxxflags -std=c++14`",
    "created_at": "2021-05-09T10:55:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511319",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:17'>Comment 17:</a>
By "fix" I mean `append-cxxflags -std=c++14`



---

archive/issue_comments_511320.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nYes, I did that in the overlay. A bit ham-fisted but it basically works.",
    "created_at": "2021-05-09T10:56:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511320",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:18'>Comment 18:</a>
Yes, I did that in the overlay. A bit ham-fisted but it basically works.



---

archive/issue_comments_511321.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nReplying to [@antonio-rojas](#comment%3A14):\n> Why not just modify the tests so they pass with both versions? IMHO a slight change in output format shouldn't block using a system package. And some of these tests already have a very generic expected output:\n> \n> ```\n> File \"/usr/lib/python3.9/site-packages/sage/interfaces/giac.py\", line 609, in sage.interfaces.giac.Giac._eval_line\n> Failed example:\n>     giac(h)\n> Expected:\n>     12*(...)\n> ```\n\nThis is not such a great example anyway:\n\n```\nsage: f = 1/x*((-2*x^(1/3)+1)^(1/4))^3                                                                                                                                       \nsage: integrate(f,x,algorithm='maxima')(x=1).n()                                                                                                                             \n-0.760158905420130 + 10.1849368661895*I\nsage: integrate(f,x,algorithm='sympy')(x=1).n()                                                                                                                              \n-10.1849368661895 + 10.1849368661895*I\nsage: integrate(f,x,algorithm='giac')(x=1).n()                                                                                                                               \n-0.760158905420130 + 4.29445064070865*I\n```\n\nI think I'll replace it with an integral that I can do in my head.",
    "created_at": "2021-05-10T12:09:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511321",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:19'>Comment 19:</a>
Replying to [@antonio-rojas](#comment%3A14):
> Why not just modify the tests so they pass with both versions? IMHO a slight change in output format shouldn't block using a system package. And some of these tests already have a very generic expected output:
> 
> ```
> File "/usr/lib/python3.9/site-packages/sage/interfaces/giac.py", line 609, in sage.interfaces.giac.Giac._eval_line
> Failed example:
>     giac(h)
> Expected:
>     12*(...)
> ```

This is not such a great example anyway:

```
sage: f = 1/x*((-2*x^(1/3)+1)^(1/4))^3                                                                                                                                       
sage: integrate(f,x,algorithm='maxima')(x=1).n()                                                                                                                             
-0.760158905420130 + 10.1849368661895*I
sage: integrate(f,x,algorithm='sympy')(x=1).n()                                                                                                                              
-10.1849368661895 + 10.1849368661895*I
sage: integrate(f,x,algorithm='giac')(x=1).n()                                                                                                                               
-0.760158905420130 + 4.29445064070865*I
```

I think I'll replace it with an integral that I can do in my head.



---

archive/issue_comments_511322.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nReplying to [@orlitzky](#comment%3A19):\n> \n> ```\n> sage: f = 1/x*((-2*x^(1/3)+1)^(1/4))^3                                                                                                                                       \n> sage: integrate(f,x,algorithm='maxima')(x=1).n()                                                                                                                             \n> -0.760158905420130 + 10.1849368661895*I\n> sage: integrate(f,x,algorithm='sympy')(x=1).n()                                                                                                                              \n> -10.1849368661895 + 10.1849368661895*I\n> sage: integrate(f,x,algorithm='giac')(x=1).n()                                                                                                                               \n> -0.760158905420130 + 4.29445064070865*I\n> ```\n\n\n```\nsage: integrate(f,x,algorithm='fricas')(x=1).n()\n-0.760158905420130 + 10.1849368661895*I\n```",
    "created_at": "2021-05-10T15:04:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511322",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:20'>Comment 20:</a>
Replying to [@orlitzky](#comment%3A19):
> 
> ```
> sage: f = 1/x*((-2*x^(1/3)+1)^(1/4))^3                                                                                                                                       
> sage: integrate(f,x,algorithm='maxima')(x=1).n()                                                                                                                             
> -0.760158905420130 + 10.1849368661895*I
> sage: integrate(f,x,algorithm='sympy')(x=1).n()                                                                                                                              
> -10.1849368661895 + 10.1849368661895*I
> sage: integrate(f,x,algorithm='giac')(x=1).n()                                                                                                                               
> -0.760158905420130 + 4.29445064070865*I
> ```


```
sage: integrate(f,x,algorithm='fricas')(x=1).n()
-0.760158905420130 + 10.1849368661895*I
```



---

archive/issue_comments_511323.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nIf I understand correctly, you are evaluating an antiderivative at x=1 and you get an approximation. I do not understand how this test can be meaningful, since an antiderivative is defined up to a constant. One could argue it should stay the same for a given CAS, but that's not true, I made some improvements in symbolic integration recently in giac, and that means sometimes that the algorithm changes and the antiderivative expression too.",
    "created_at": "2021-05-10T17:38:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511323",
    "user": "https://github.com/sagetrac-parisse"
}
```

<a id='comment:21'>Comment 21:</a>
If I understand correctly, you are evaluating an antiderivative at x=1 and you get an approximation. I do not understand how this test can be meaningful, since an antiderivative is defined up to a constant. One could argue it should stay the same for a given CAS, but that's not true, I made some improvements in symbolic integration recently in giac, and that means sometimes that the algorithm changes and the antiderivative expression too.



---

archive/issue_comments_511324.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nI'm not blaming giac for anything here. The existing test was a bad choice:\n\n1. It was testing the exact string form of an indefinite integral, which, as you note, is unreliable for many reasons.\n2. The results of that indefinite integral do not agree (even up to a constant) between the various integration engines we have, so who knows if \"expected\" output is correct.\n\nMy use of `(x=1).n()` just makes it clear that the answers are different, since the resulting expression is rather ugly.",
    "created_at": "2021-05-10T18:06:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511324",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:22'>Comment 22:</a>
I'm not blaming giac for anything here. The existing test was a bad choice:

1. It was testing the exact string form of an indefinite integral, which, as you note, is unreliable for many reasons.
2. The results of that indefinite integral do not agree (even up to a constant) between the various integration engines we have, so who knows if "expected" output is correct.

My use of `(x=1).n()` just makes it clear that the answers are different, since the resulting expression is rather ugly.



---

archive/issue_comments_511325.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nA more meaningful test would be F=integrate(f) then simplify(diff(F)-f). I have added some examples in the check subdirectory of giac, from the independent integrals testsuite from [https://www.12000.org/my_notes/CAS_integration_tests/reports/rubi_4_16_1_graded/inch1.htm#x2-30001.2](https://www.12000.org/my_notes/CAS_integration_tests/reports/rubi_4_16_1_graded/inch1.htm#x2-30001.2)",
    "created_at": "2021-05-10T19:07:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511325",
    "user": "https://github.com/sagetrac-parisse"
}
```

<a id='comment:23'>Comment 23:</a>
A more meaningful test would be F=integrate(f) then simplify(diff(F)-f). I have added some examples in the check subdirectory of giac, from the independent integrals testsuite from [https://www.12000.org/my_notes/CAS_integration_tests/reports/rubi_4_16_1_graded/inch1.htm#x2-30001.2](https://www.12000.org/my_notes/CAS_integration_tests/reports/rubi_4_16_1_graded/inch1.htm#x2-30001.2)



---

archive/issue_comments_511326.json:
```json
{
    "body": "Changed commit from **[890c354](https://github.com/sagemath/sagetrac-mirror/commit/890c35414a729ec6e094ec2193b77da59290e705)** to **[55e3613](https://github.com/sagemath/sagetrac-mirror/commit/55e36139c7719c838c68e0a4bf95472d709b1470)**",
    "created_at": "2021-05-11T12:29:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511326",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[890c354](https://github.com/sagemath/sagetrac-mirror/commit/890c35414a729ec6e094ec2193b77da59290e705)** to **[55e3613](https://github.com/sagemath/sagetrac-mirror/commit/55e36139c7719c838c68e0a4bf95472d709b1470)**



---

archive/issue_comments_511327.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa49b852c4195e75ebb31dfd8c05117138b0b3bb\">fa49b85</a></td><td><code>Trac #31594: accept giac-1.7.x from the system.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5d6689694c3a590728ddd5ca2a182648ebbc684\">d5d6689</a></td><td><code>Trac #31594: fix an interface test with newer versions of giac.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/60a307aadf9d8d724675d8d3b7343ff9dd12c26d\">60a307a</a></td><td><code>Trac #31594: support giac-1.7.x in symbolic integration tests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55e36139c7719c838c68e0a4bf95472d709b1470\">55e3613</a></td><td><code>Trac #31594: simplify two libgiac simplify() examples.</code></td></tr></table>\n",
    "created_at": "2021-05-11T12:29:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511327",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:24'>Comment 24:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa49b852c4195e75ebb31dfd8c05117138b0b3bb">fa49b85</a></td><td><code>Trac #31594: accept giac-1.7.x from the system.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5d6689694c3a590728ddd5ca2a182648ebbc684">d5d6689</a></td><td><code>Trac #31594: fix an interface test with newer versions of giac.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/60a307aadf9d8d724675d8d3b7343ff9dd12c26d">60a307a</a></td><td><code>Trac #31594: support giac-1.7.x in symbolic integration tests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55e36139c7719c838c68e0a4bf95472d709b1470">55e3613</a></td><td><code>Trac #31594: simplify two libgiac simplify() examples.</code></td></tr></table>




---

archive/issue_comments_511328.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nReplying to [parisse](#comment%3A23):\n> A more meaningful test would be F=integrate(f) then simplify(diff(F)-f). I have added some examples in the check subdirectory of giac, from the independent integrals testsuite from [https://www.12000.org/my_notes/CAS_integration_tests/reports/rubi_4_16_1_graded/inch1.htm#x2-30001.2](https://www.12000.org/my_notes/CAS_integration_tests/reports/rubi_4_16_1_graded/inch1.htm#x2-30001.2)\n\nThe call to `simplify()` takes ages in this case. Since the point of that test is to check that we can pass a string to `giac()`, I changed the example to `sin(x)^2 + cos(x)^2` and have compared the result (`x`) as a symbolic expression.",
    "created_at": "2021-05-11T12:36:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511328",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:25'>Comment 25:</a>
Replying to [parisse](#comment%3A23):
> A more meaningful test would be F=integrate(f) then simplify(diff(F)-f). I have added some examples in the check subdirectory of giac, from the independent integrals testsuite from [https://www.12000.org/my_notes/CAS_integration_tests/reports/rubi_4_16_1_graded/inch1.htm#x2-30001.2](https://www.12000.org/my_notes/CAS_integration_tests/reports/rubi_4_16_1_graded/inch1.htm#x2-30001.2)

The call to `simplify()` takes ages in this case. Since the point of that test is to check that we can pass a string to `giac()`, I changed the example to `sin(x)^2 + cos(x)^2` and have compared the result (`x`) as a symbolic expression.



---

archive/issue_events_403475.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-05-11T12:36:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-403475"
}
```



---

archive/issue_events_403476.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-05-11T12:36:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-403476"
}
```



---

archive/issue_events_403477.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-05-11T22:53:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-403477"
}
```



---

archive/issue_events_403478.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-05-11T22:53:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-403478"
}
```



---

archive/issue_comments_511329.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nlgtm",
    "created_at": "2021-05-11T22:53:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511329",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'>Comment 26:</a>
lgtm



---

archive/issue_comments_511330.json:
```json
{
    "body": "Changed branch from **[u/mjo/ticket/31594](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/31594)** to **[55e3613](https://github.com/sagemath/sagetrac-mirror/commit/55e36139c7719c838c68e0a4bf95472d709b1470)**",
    "created_at": "2021-06-06T13:18:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31594#issuecomment-511330",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mjo/ticket/31594](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/31594)** to **[55e3613](https://github.com/sagemath/sagetrac-mirror/commit/55e36139c7719c838c68e0a4bf95472d709b1470)**



---

archive/issue_events_403479.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-06T13:18:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-403479"
}
```



---

archive/issue_events_403480.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "63c3d0fecba6245e6f33972bc84652fb4415a2ee",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-06-06T13:18:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31594",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31594#event-403480"
}
```
