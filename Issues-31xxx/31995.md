# Issue 31995: Submodules of a MatrixSpace

archive/issues_031758.json:
```json
{
    "assignees": [],
    "body": "`MatrixSpace` does not implement the category `ModulesWithBasis` correctly.\n\n```\nsage: M = MatrixSpace(QQ, 2)\nsage: M.submodule([M.matrix([[1, 2], [3, 4]])])\nAttributeError: 'tuple' object has no attribute 'support'\n```\n\n\n**CC:**  @tscrim @roed314\n\n**Branch/Commit:** [2061f10a00a5bfdc53d4473a6a7faa6a16783558](https://github.com/sagemath/sagetrac-mirror/commit/2061f10a00a5bfdc53d4473a6a7faa6a16783558)\n\n**Reviewer:** Travis Scrimshaw, Matthias Koeppe\n\n**Author:** Matthias Koeppe, Travis Scrimshaw\n\nIssue created by migration from https://trac.sagemath.org/ticket/31995\n\n",
    "closed_at": "2021-07-09T20:23:34Z",
    "created_at": "2021-06-17T05:14:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Submodules of a MatrixSpace",
    "type": "issue",
    "updated_at": "2021-07-09T20:23:34Z",
    "url": "https://github.com/sagemath/sage/issues/31995",
    "user": "https://github.com/mkoeppe"
}
```
`MatrixSpace` does not implement the category `ModulesWithBasis` correctly.

```
sage: M = MatrixSpace(QQ, 2)
sage: M.submodule([M.matrix([[1, 2], [3, 4]])])
AttributeError: 'tuple' object has no attribute 'support'
```


**CC:**  @tscrim @roed314

**Branch/Commit:** [2061f10a00a5bfdc53d4473a6a7faa6a16783558](https://github.com/sagemath/sagetrac-mirror/commit/2061f10a00a5bfdc53d4473a6a7faa6a16783558)

**Reviewer:** Travis Scrimshaw, Matthias Koeppe

**Author:** Matthias Koeppe, Travis Scrimshaw

Issue created by migration from https://trac.sagemath.org/ticket/31995





---

archive/issue_events_388376.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-17T05:14:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388376"
}
```



---

archive/issue_events_388377.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-17T05:14:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20linear%20algebra",
    "label_color": "08517b",
    "label_name": "component: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388377"
}
```



---

archive/issue_events_388378.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-17T05:14:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388378"
}
```



---

archive/issue_comments_517760.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/submodules_of_a_matrixspace](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/submodules_of_a_matrixspace)",
    "created_at": "2021-06-17T05:29:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517760",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/submodules_of_a_matrixspace](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/submodules_of_a_matrixspace)



---

archive/issue_comments_517761.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\nHere's a first fix (follow-up from #19448, I think)\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/54915a614fba1f361e7d8e47b87785844a8c165b\">54915a6</a></td><td><code>FiniteDimensionalModulesWithBasis: Fix use of _compute_support_order</code></td></tr></table>\n",
    "created_at": "2021-06-17T05:31:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517761",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'>**Comment 2:**</a>
Here's a first fix (follow-up from #19448, I think)

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/54915a614fba1f361e7d8e47b87785844a8c165b">54915a6</a></td><td><code>FiniteDimensionalModulesWithBasis: Fix use of _compute_support_order</code></td></tr></table>




---

archive/issue_comments_517762.json:
```json
{
    "body": "**Commit:** [54915a614fba1f361e7d8e47b87785844a8c165b](https://github.com/sagemath/sagetrac-mirror/commit/54915a614fba1f361e7d8e47b87785844a8c165b)",
    "created_at": "2021-06-17T05:31:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517762",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [54915a614fba1f361e7d8e47b87785844a8c165b](https://github.com/sagemath/sagetrac-mirror/commit/54915a614fba1f361e7d8e47b87785844a8c165b)



---

archive/issue_comments_517763.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nThis gets a bit farther and now leads to:\n\n```\nTypeError: <class 'sage.sets.family.TrivialFamily_with_category'> is not hashable and does not implement _cache_key()\n```",
    "created_at": "2021-06-17T05:32:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517763",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'>**Comment 3:**</a>
This gets a bit farther and now leads to:

```
TypeError: <class 'sage.sets.family.TrivialFamily_with_category'> is not hashable and does not implement _cache_key()
```



---

archive/issue_comments_517764.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\n`TrivialFamily` is hashable and even has a doctest:\n\n```\nsage: from sage.sets.family import TrivialFamily\nsage: f = TrivialFamily((3,4,7))\nsage: hash(f) == hash(f)\n```\nThe problem comes from the fact that matrices by default are mutable and not hashable. If you look a little higher up in the error, you get:\n\n```\nTypeError: mutable matrices are unhashable\n```\nThis comes from the fact that `echelon_form` creates mutable matrices:\n\n```\nsage: mat = M.matrix([[1, 2], [3, 4]])\nsage: mat.set_immutable()\nsage: M.echelon_form([mat])[0]\n[1 2]\n[3 4]\nsage: _.is_mutable()\nTrue\n```\nIf we skip this step, then it creates the submodule:\n\n```\nsage: M.submodule([mat], already_echelonized=True)\nFree module generated by {0} over Rational Field\n```",
    "created_at": "2021-06-17T06:35:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517764",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'>**Comment 4:**</a>
`TrivialFamily` is hashable and even has a doctest:

```
sage: from sage.sets.family import TrivialFamily
sage: f = TrivialFamily((3,4,7))
sage: hash(f) == hash(f)
```
The problem comes from the fact that matrices by default are mutable and not hashable. If you look a little higher up in the error, you get:

```
TypeError: mutable matrices are unhashable
```
This comes from the fact that `echelon_form` creates mutable matrices:

```
sage: mat = M.matrix([[1, 2], [3, 4]])
sage: mat.set_immutable()
sage: M.echelon_form([mat])[0]
[1 2]
[3 4]
sage: _.is_mutable()
True
```
If we skip this step, then it creates the submodule:

```
sage: M.submodule([mat], already_echelonized=True)
Free module generated by {0} over Rational Field
```



---

archive/issue_comments_517765.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nThe best way around this IMO is a special case of `submodule` in `MatrixSpace` that just makes the result of `echelon_form` into a set of immutable matrices. This now works for me.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f\">c60bc37</a></td><td><code>Make matrices immutable during the construction of submodule().</code></td></tr></table>\n",
    "created_at": "2021-06-17T06:49:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517765",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'>**Comment 5:**</a>
The best way around this IMO is a special case of `submodule` in `MatrixSpace` that just makes the result of `echelon_form` into a set of immutable matrices. This now works for me.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f">c60bc37</a></td><td><code>Make matrices immutable during the construction of submodule().</code></td></tr></table>




---

archive/issue_comments_517766.json:
```json
{
    "body": "**Author:** Matthias Koeppe, Travis Scrimshaw",
    "created_at": "2021-06-17T06:49:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517766",
    "user": "https://github.com/tscrim"
}
```

**Author:** Matthias Koeppe, Travis Scrimshaw



---

archive/issue_comments_517767.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw, Matthias Koeppe",
    "created_at": "2021-06-17T06:49:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517767",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw, Matthias Koeppe



---

archive/issue_comments_517768.json:
```json
{
    "body": "**Changing commit** from \"[54915a614fba1f361e7d8e47b87785844a8c165b](https://github.com/sagemath/sagetrac-mirror/commit/54915a614fba1f361e7d8e47b87785844a8c165b)\" to \"[c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f](https://github.com/sagemath/sagetrac-mirror/commit/c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f)\".",
    "created_at": "2021-06-17T06:49:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517768",
    "user": "https://github.com/tscrim"
}
```

**Changing commit** from "[54915a614fba1f361e7d8e47b87785844a8c165b](https://github.com/sagemath/sagetrac-mirror/commit/54915a614fba1f361e7d8e47b87785844a8c165b)" to "[c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f](https://github.com/sagemath/sagetrac-mirror/commit/c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f)".



---

archive/issue_comments_517769.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/submodules_of_a_matrixspace](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/submodules_of_a_matrixspace)\" to \"[public/linear_algebra/matrix_space_submodules-31995](https://github.com/sagemath/sagetrac-mirror/tree/public/linear_algebra/matrix_space_submodules-31995)\".",
    "created_at": "2021-06-17T06:49:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517769",
    "user": "https://github.com/tscrim"
}
```

**Changing branch** from "[u/mkoeppe/submodules_of_a_matrixspace](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/submodules_of_a_matrixspace)" to "[public/linear_algebra/matrix_space_submodules-31995](https://github.com/sagemath/sagetrac-mirror/tree/public/linear_algebra/matrix_space_submodules-31995)".



---

archive/issue_events_388379.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-06-17T06:49:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388379"
}
```



---

archive/issue_events_388380.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-17T18:21:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388380"
}
```



---

archive/issue_events_388381.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-17T18:21:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388381"
}
```



---

archive/issue_comments_517770.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\nThis seems to work well, thanks very much!\n\n(The way that the submodule prints itself, using the indices, is a bit strange, but that can be improved on another ticket.)",
    "created_at": "2021-06-17T18:21:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517770",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'>**Comment 6:**</a>
This seems to work well, thanks very much!

(The way that the submodule prints itself, using the indices, is a bit strange, but that can be improved on another ticket.)



---

archive/issue_comments_517771.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\nThe example from #30334 (duplicate of this ticket) still fails, with a new error:\n\n```\nsage: M = MatrixSpace(QQ, 3, 3)\nsage: M in ModulesWithBasis(QQ)\nTrue\nsage: A = M([[0, 0, 1], [0, 0, 0], [0, 0, 0]])\nsage: A\n[0 0 1]\n[0 0 0]\n[0 0 0]\nsage: M.submodule([A])\nTypeError: entries must be a list of length 9\n```",
    "created_at": "2021-06-18T20:42:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517771",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'>**Comment 7:**</a>
The example from #30334 (duplicate of this ticket) still fails, with a new error:

```
sage: M = MatrixSpace(QQ, 3, 3)
sage: M in ModulesWithBasis(QQ)
True
sage: A = M([[0, 0, 1], [0, 0, 0], [0, 0, 0]])
sage: A
[0 0 1]
[0 0 0]
[0 0 0]
sage: M.submodule([A])
TypeError: entries must be a list of length 9
```



---

archive/issue_events_388382.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-18T20:42:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388382"
}
```



---

archive/issue_events_388383.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-18T20:42:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388383"
}
```



---

archive/issue_comments_517772.json:
```json
{
    "body": "**Changing commit** from \"[c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f](https://github.com/sagemath/sagetrac-mirror/commit/c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f)\" to \"[e270655ec552abb098a27cb61f3d78ddd2a1886a](https://github.com/sagemath/sagetrac-mirror/commit/e270655ec552abb098a27cb61f3d78ddd2a1886a)\".",
    "created_at": "2021-06-20T23:21:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517772",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f](https://github.com/sagemath/sagetrac-mirror/commit/c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f)" to "[e270655ec552abb098a27cb61f3d78ddd2a1886a](https://github.com/sagemath/sagetrac-mirror/commit/e270655ec552abb098a27cb61f3d78ddd2a1886a)".



---

archive/issue_comments_517773.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e270655ec552abb098a27cb61f3d78ddd2a1886a\">e270655</a></td><td><code>Fixing issue when the support is smaller than the dimension.</code></td></tr></table>\n",
    "created_at": "2021-06-20T23:21:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517773",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'>**Comment 8:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e270655ec552abb098a27cb61f3d78ddd2a1886a">e270655</a></td><td><code>Fixing issue when the support is smaller than the dimension.</code></td></tr></table>




---

archive/issue_comments_517774.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nThis fixes that issue, which came from the category `FiniteDimensionalModulesWithBasis` expecting `order` to have full support. However, I think we don't want this because we want to support more sparse matrices (or, more general, any ordering passed from the user) for taking submodules, and having a `get_order()` would force a conversion to a dense implementation.",
    "created_at": "2021-06-20T23:25:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517774",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'>**Comment 9:**</a>
This fixes that issue, which came from the category `FiniteDimensionalModulesWithBasis` expecting `order` to have full support. However, I think we don't want this because we want to support more sparse matrices (or, more general, any ordering passed from the user) for taking submodules, and having a `get_order()` would force a conversion to a dense implementation.



---

archive/issue_events_388384.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-06-20T23:25:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388384"
}
```



---

archive/issue_events_388385.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-06-20T23:25:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388385"
}
```



---

archive/issue_comments_517775.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\nYes, I agree with this solution.\nThanks!",
    "created_at": "2021-06-21T00:38:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517775",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'>**Comment 10:**</a>
Yes, I agree with this solution.
Thanks!



---

archive/issue_events_388386.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-21T00:38:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388386"
}
```



---

archive/issue_events_388387.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-21T00:38:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388387"
}
```



---

archive/issue_comments_517776.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\nThank you.",
    "created_at": "2021-06-21T01:25:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517776",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'>**Comment 11:**</a>
Thank you.



---

archive/issue_events_388388.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-05T23:23:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388388"
}
```



---

archive/issue_events_388389.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-05T23:23:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388389"
}
```



---

archive/issue_comments_517777.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\n\n```\nsage -t --long --warn-long 42.0 --random-seed=0 src/sage/matrix/matrix_space.py\n**********************************************************************\nFile \"src/sage/matrix/matrix_space.py\", line 1622, in sage.matrix.matrix_space.MatrixSpace.?\nFailed example:\n    Xp = M.submodule([A, B], order=[(0,1), (1,1), (0,0)])\nException raised:\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 996, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:5974)\n        return self.cache[k]\n      File \"sage/misc/weak_dict.pyx\", line 702, in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3712)\n        cdef PyObject* wr = PyDict_GetItemWithError(self, k)\n    TypeError: unhashable type: 'list'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 543, in sage.misc.cachefunc.dict_key (build/cythonized/sage/misc/cachefunc.c:3091)\n        hash(o)\n    TypeError: unhashable type: 'list'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 583, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3295)\n        hash(o)\n    TypeError: unhashable type: 'list'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 583, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3295)\n        hash(o)\n    TypeError: unhashable type: 'list'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 583, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3295)\n        hash(o)\n    TypeError: unhashable type: 'list'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 596, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3699)\n        k = o._cache_key()\n    AttributeError: 'list' object has no attribute '_cache_key'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 718, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 1137, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.matrix.matrix_space.MatrixSpace.?[9]>\", line 1, in <module>\n        Xp = M.submodule([A, B], order=[(Integer(0),Integer(1)), (Integer(1),Integer(1)), (Integer(0),Integer(0))])\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/matrix/matrix_space.py\", line 1647, in submodule\n        return SubmoduleWithBasis(gens, ambient=self,\n      File \"sage/misc/classcall_metaclass.pyx\", line 322, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1761)\n        return cls.classcall(cls, *args, **kwds)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/modules/with_basis/subquotient.py\", line 218, in __classcall_private__\n        return super(SubmoduleWithBasis, cls).__classcall__(cls,\n      File \"sage/misc/cachefunc.pyx\", line 998, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6013)\n        k = dict_key(k)\n      File \"sage/misc/cachefunc.pyx\", line 545, in sage.misc.cachefunc.dict_key (build/cythonized/sage/misc/cachefunc.c:3129)\n        o = (unhashable_key, cache_key_unhashable(o))\n      File \"sage/misc/cachefunc.pyx\", line 594, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3660)\n        return tuple(cache_key(item) for item in o)\n      File \"sage/misc/cachefunc.pyx\", line 594, in genexpr (build/cythonized/sage/misc/cachefunc.c:3551)\n        return tuple(cache_key(item) for item in o)\n      File \"sage/misc/cachefunc.pyx\", line 585, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3333)\n        o = cache_key_unhashable(o)\n      File \"sage/misc/cachefunc.pyx\", line 594, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3660)\n        return tuple(cache_key(item) for item in o)\n      File \"sage/misc/cachefunc.pyx\", line 594, in genexpr (build/cythonized/sage/misc/cachefunc.c:3551)\n        return tuple(cache_key(item) for item in o)\n      File \"sage/misc/cachefunc.pyx\", line 585, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3333)\n        o = cache_key_unhashable(o)\n      File \"sage/misc/cachefunc.pyx\", line 594, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3660)\n        return tuple(cache_key(item) for item in o)\n      File \"sage/misc/cachefunc.pyx\", line 594, in genexpr (build/cythonized/sage/misc/cachefunc.c:3551)\n        return tuple(cache_key(item) for item in o)\n      File \"sage/misc/cachefunc.pyx\", line 585, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3333)\n        o = cache_key_unhashable(o)\n      File \"sage/misc/cachefunc.pyx\", line 598, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3783)\n        raise TypeError(\"unhashable type: {!r}\".format(type(o).__name__))\n    TypeError: unhashable type: 'list'\n**********************************************************************\n```",
    "created_at": "2021-07-05T23:23:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517777",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'>**Comment 12:**</a>

```
sage -t --long --warn-long 42.0 --random-seed=0 src/sage/matrix/matrix_space.py
**********************************************************************
File "src/sage/matrix/matrix_space.py", line 1622, in sage.matrix.matrix_space.MatrixSpace.?
Failed example:
    Xp = M.submodule([A, B], order=[(0,1), (1,1), (0,0)])
Exception raised:
    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 996, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:5974)
        return self.cache[k]
      File "sage/misc/weak_dict.pyx", line 702, in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3712)
        cdef PyObject* wr = PyDict_GetItemWithError(self, k)
    TypeError: unhashable type: 'list'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 543, in sage.misc.cachefunc.dict_key (build/cythonized/sage/misc/cachefunc.c:3091)
        hash(o)
    TypeError: unhashable type: 'list'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 583, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3295)
        hash(o)
    TypeError: unhashable type: 'list'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 583, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3295)
        hash(o)
    TypeError: unhashable type: 'list'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 583, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3295)
        hash(o)
    TypeError: unhashable type: 'list'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 596, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3699)
        k = o._cache_key()
    AttributeError: 'list' object has no attribute '_cache_key'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.matrix.matrix_space.MatrixSpace.?[9]>", line 1, in <module>
        Xp = M.submodule([A, B], order=[(Integer(0),Integer(1)), (Integer(1),Integer(1)), (Integer(0),Integer(0))])
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/matrix/matrix_space.py", line 1647, in submodule
        return SubmoduleWithBasis(gens, ambient=self,
      File "sage/misc/classcall_metaclass.pyx", line 322, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1761)
        return cls.classcall(cls, *args, **kwds)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/modules/with_basis/subquotient.py", line 218, in __classcall_private__
        return super(SubmoduleWithBasis, cls).__classcall__(cls,
      File "sage/misc/cachefunc.pyx", line 998, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6013)
        k = dict_key(k)
      File "sage/misc/cachefunc.pyx", line 545, in sage.misc.cachefunc.dict_key (build/cythonized/sage/misc/cachefunc.c:3129)
        o = (unhashable_key, cache_key_unhashable(o))
      File "sage/misc/cachefunc.pyx", line 594, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3660)
        return tuple(cache_key(item) for item in o)
      File "sage/misc/cachefunc.pyx", line 594, in genexpr (build/cythonized/sage/misc/cachefunc.c:3551)
        return tuple(cache_key(item) for item in o)
      File "sage/misc/cachefunc.pyx", line 585, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3333)
        o = cache_key_unhashable(o)
      File "sage/misc/cachefunc.pyx", line 594, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3660)
        return tuple(cache_key(item) for item in o)
      File "sage/misc/cachefunc.pyx", line 594, in genexpr (build/cythonized/sage/misc/cachefunc.c:3551)
        return tuple(cache_key(item) for item in o)
      File "sage/misc/cachefunc.pyx", line 585, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3333)
        o = cache_key_unhashable(o)
      File "sage/misc/cachefunc.pyx", line 594, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3660)
        return tuple(cache_key(item) for item in o)
      File "sage/misc/cachefunc.pyx", line 594, in genexpr (build/cythonized/sage/misc/cachefunc.c:3551)
        return tuple(cache_key(item) for item in o)
      File "sage/misc/cachefunc.pyx", line 585, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3333)
        o = cache_key_unhashable(o)
      File "sage/misc/cachefunc.pyx", line 598, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3783)
        raise TypeError("unhashable type: {!r}".format(type(o).__name__))
    TypeError: unhashable type: 'list'
**********************************************************************
```



---

archive/issue_comments_517778.json:
```json
{
    "body": "**Changing commit** from \"[e270655ec552abb098a27cb61f3d78ddd2a1886a](https://github.com/sagemath/sagetrac-mirror/commit/e270655ec552abb098a27cb61f3d78ddd2a1886a)\" to \"[2061f10a00a5bfdc53d4473a6a7faa6a16783558](https://github.com/sagemath/sagetrac-mirror/commit/2061f10a00a5bfdc53d4473a6a7faa6a16783558)\".",
    "created_at": "2021-07-06T00:42:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517778",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[e270655ec552abb098a27cb61f3d78ddd2a1886a](https://github.com/sagemath/sagetrac-mirror/commit/e270655ec552abb098a27cb61f3d78ddd2a1886a)" to "[2061f10a00a5bfdc53d4473a6a7faa6a16783558](https://github.com/sagemath/sagetrac-mirror/commit/2061f10a00a5bfdc53d4473a6a7faa6a16783558)".



---

archive/issue_comments_517779.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d9fed04b2ff077a85485754b35e67816b69fbf7b\">d9fed04</a></td><td><code>Merge branch 'public/linear_algebra/matrix_space_submodules-31995' of git://trac.sagemath.org/sage into public/linear_algebra/matrix_space_submodules-31995</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2061f10a00a5bfdc53d4473a6a7faa6a16783558\">2061f10</a></td><td><code>Fixing bad doctests.</code></td></tr></table>\n",
    "created_at": "2021-07-06T00:42:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517779",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:13'>**Comment 13:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d9fed04b2ff077a85485754b35e67816b69fbf7b">d9fed04</a></td><td><code>Merge branch 'public/linear_algebra/matrix_space_submodules-31995' of git://trac.sagemath.org/sage into public/linear_algebra/matrix_space_submodules-31995</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2061f10a00a5bfdc53d4473a6a7faa6a16783558">2061f10</a></td><td><code>Fixing bad doctests.</code></td></tr></table>




---

archive/issue_events_388390.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-07-06T00:43:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388390"
}
```



---

archive/issue_events_388391.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-07-06T00:43:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388391"
}
```



---

archive/issue_comments_517780.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\nI could have sworn I tested this...sorry about that. Fixed the bad doctests.",
    "created_at": "2021-07-06T00:43:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517780",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'>**Comment 14:**</a>
I could have sworn I tested this...sorry about that. Fixed the bad doctests.



---

archive/issue_events_388392.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-06T03:33:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388392"
}
```



---

archive/issue_events_388393.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-06T03:33:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388393"
}
```



---

archive/issue_comments_517781.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\nThank you.",
    "created_at": "2021-07-07T05:11:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517781",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'>**Comment 16:**</a>
Thank you.



---

archive/issue_comments_517782.json:
```json
{
    "body": "**Changing branch** from \"[public/linear_algebra/matrix_space_submodules-31995](https://github.com/sagemath/sagetrac-mirror/tree/public/linear_algebra/matrix_space_submodules-31995)\" to \"[2061f10a00a5bfdc53d4473a6a7faa6a16783558](https://github.com/sagemath/sagetrac-mirror/commit/2061f10a00a5bfdc53d4473a6a7faa6a16783558)\".",
    "created_at": "2021-07-09T20:23:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-517782",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/linear_algebra/matrix_space_submodules-31995](https://github.com/sagemath/sagetrac-mirror/tree/public/linear_algebra/matrix_space_submodules-31995)" to "[2061f10a00a5bfdc53d4473a6a7faa6a16783558](https://github.com/sagemath/sagetrac-mirror/commit/2061f10a00a5bfdc53d4473a6a7faa6a16783558)".



---

archive/issue_events_388394.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-09T20:23:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388394"
}
```



---

archive/issue_events_388395.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "2450eb79050b2eab90c8eeed8a475e6952a64ce0",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-07-09T20:23:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-388395"
}
```
