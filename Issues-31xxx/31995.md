# Issue 31995: Submodules of a MatrixSpace

archive/issues_031758.json:
```json
{
    "assignees": [],
    "body": "`MatrixSpace` does not implement the category `ModulesWithBasis` correctly.\n\n```\nsage: M = MatrixSpace(QQ, 2)\nsage: M.submodule([M.matrix([[1, 2], [3, 4]])])\nAttributeError: 'tuple' object has no attribute 'support'\n```\n\n\nCC:  @tscrim @roed314\n\nBranch/Commit: **[2061f10](https://github.com/sagemath/sagetrac-mirror/commit/2061f10a00a5bfdc53d4473a6a7faa6a16783558)**\n\nReviewer: **Travis Scrimshaw, Matthias Koeppe**\n\nAuthor: **Matthias Koeppe, Travis Scrimshaw**\n\nComponent: **linear algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31995_\n\n",
    "closed_at": "2021-07-09T20:23:34Z",
    "created_at": "2021-06-17T05:14:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Submodules of a MatrixSpace",
    "type": "issue",
    "updated_at": "2021-07-09T20:23:34Z",
    "url": "https://github.com/sagemath/sage/issues/31995",
    "user": "https://github.com/mkoeppe"
}
```
`MatrixSpace` does not implement the category `ModulesWithBasis` correctly.

```
sage: M = MatrixSpace(QQ, 2)
sage: M.submodule([M.matrix([[1, 2], [3, 4]])])
AttributeError: 'tuple' object has no attribute 'support'
```


CC:  @tscrim @roed314

Branch/Commit: **[2061f10](https://github.com/sagemath/sagetrac-mirror/commit/2061f10a00a5bfdc53d4473a6a7faa6a16783558)**

Reviewer: **Travis Scrimshaw, Matthias Koeppe**

Author: **Matthias Koeppe, Travis Scrimshaw**

Component: **linear algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/31995_





---

archive/issue_events_441243.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-17T05:14:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441243"
}
```



---

archive/issue_events_441244.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-17T05:14:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441244"
}
```



---

archive/issue_events_441245.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-17T05:14:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441245"
}
```



---

archive/issue_events_441246.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-17T05:14:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441246"
}
```



---

archive/issue_comments_515088.json:
```json
{
    "body": "Branch: **[u/mkoeppe/submodules_of_a_matrixspace](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/submodules_of_a_matrixspace)**",
    "created_at": "2021-06-17T05:29:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515088",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/submodules_of_a_matrixspace](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/submodules_of_a_matrixspace)**



---

archive/issue_comments_515089.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nHere's a first fix (follow-up from #19448, I think)\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/54915a614fba1f361e7d8e47b87785844a8c165b\">54915a6</a></td><td><code>FiniteDimensionalModulesWithBasis: Fix use of _compute_support_order</code></td></tr></table>\n",
    "created_at": "2021-06-17T05:31:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515089",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">comment:2</div>

Here's a first fix (follow-up from #19448, I think)

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/54915a614fba1f361e7d8e47b87785844a8c165b">54915a6</a></td><td><code>FiniteDimensionalModulesWithBasis: Fix use of _compute_support_order</code></td></tr></table>




---

archive/issue_comments_515090.json:
```json
{
    "body": "Commit: **[54915a6](https://github.com/sagemath/sagetrac-mirror/commit/54915a614fba1f361e7d8e47b87785844a8c165b)**",
    "created_at": "2021-06-17T05:31:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515090",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[54915a6](https://github.com/sagemath/sagetrac-mirror/commit/54915a614fba1f361e7d8e47b87785844a8c165b)**



---

archive/issue_comments_515091.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThis gets a bit farther and now leads to:\n\n```\nTypeError: <class 'sage.sets.family.TrivialFamily_with_category'> is not hashable and does not implement _cache_key()\n```",
    "created_at": "2021-06-17T05:32:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515091",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:3" align="right">comment:3</div>

This gets a bit farther and now leads to:

```
TypeError: <class 'sage.sets.family.TrivialFamily_with_category'> is not hashable and does not implement _cache_key()
```



---

archive/issue_comments_515092.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\n`TrivialFamily` is hashable and even has a doctest:\n\n```\nsage: from sage.sets.family import TrivialFamily\nsage: f = TrivialFamily((3,4,7))\nsage: hash(f) == hash(f)\n```\nThe problem comes from the fact that matrices by default are mutable and not hashable. If you look a little higher up in the error, you get:\n\n```\nTypeError: mutable matrices are unhashable\n```\nThis comes from the fact that `echelon_form` creates mutable matrices:\n\n```\nsage: mat = M.matrix([[1, 2], [3, 4]])\nsage: mat.set_immutable()\nsage: M.echelon_form([mat])[0]\n[1 2]\n[3 4]\nsage: _.is_mutable()\nTrue\n```\nIf we skip this step, then it creates the submodule:\n\n```\nsage: M.submodule([mat], already_echelonized=True)\nFree module generated by {0} over Rational Field\n```",
    "created_at": "2021-06-17T06:35:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515092",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:4" align="right">comment:4</div>

`TrivialFamily` is hashable and even has a doctest:

```
sage: from sage.sets.family import TrivialFamily
sage: f = TrivialFamily((3,4,7))
sage: hash(f) == hash(f)
```
The problem comes from the fact that matrices by default are mutable and not hashable. If you look a little higher up in the error, you get:

```
TypeError: mutable matrices are unhashable
```
This comes from the fact that `echelon_form` creates mutable matrices:

```
sage: mat = M.matrix([[1, 2], [3, 4]])
sage: mat.set_immutable()
sage: M.echelon_form([mat])[0]
[1 2]
[3 4]
sage: _.is_mutable()
True
```
If we skip this step, then it creates the submodule:

```
sage: M.submodule([mat], already_echelonized=True)
Free module generated by {0} over Rational Field
```



---

archive/issue_comments_515093.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThe best way around this IMO is a special case of `submodule` in `MatrixSpace` that just makes the result of `echelon_form` into a set of immutable matrices. This now works for me.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f\">c60bc37</a></td><td><code>Make matrices immutable during the construction of submodule().</code></td></tr></table>\n",
    "created_at": "2021-06-17T06:49:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515093",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

The best way around this IMO is a special case of `submodule` in `MatrixSpace` that just makes the result of `echelon_form` into a set of immutable matrices. This now works for me.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f">c60bc37</a></td><td><code>Make matrices immutable during the construction of submodule().</code></td></tr></table>




---

archive/issue_comments_515094.json:
```json
{
    "body": "Author: **Matthias Koeppe, Travis Scrimshaw**",
    "created_at": "2021-06-17T06:49:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515094",
    "user": "https://github.com/tscrim"
}
```

Author: **Matthias Koeppe, Travis Scrimshaw**



---

archive/issue_comments_515095.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw, Matthias Koeppe**",
    "created_at": "2021-06-17T06:49:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515095",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw, Matthias Koeppe**



---

archive/issue_comments_515096.json:
```json
{
    "body": "Changed commit from **[54915a6](https://github.com/sagemath/sagetrac-mirror/commit/54915a614fba1f361e7d8e47b87785844a8c165b)** to **[c60bc37](https://github.com/sagemath/sagetrac-mirror/commit/c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f)**",
    "created_at": "2021-06-17T06:49:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515096",
    "user": "https://github.com/tscrim"
}
```

Changed commit from **[54915a6](https://github.com/sagemath/sagetrac-mirror/commit/54915a614fba1f361e7d8e47b87785844a8c165b)** to **[c60bc37](https://github.com/sagemath/sagetrac-mirror/commit/c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f)**



---

archive/issue_comments_515097.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/submodules_of_a_matrixspace](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/submodules_of_a_matrixspace)** to **[public/linear_algebra/matrix_space_submodules-31995](https://github.com/sagemath/sagetrac-mirror/tree/public/linear_algebra/matrix_space_submodules-31995)**",
    "created_at": "2021-06-17T06:49:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515097",
    "user": "https://github.com/tscrim"
}
```

Changed branch from **[u/mkoeppe/submodules_of_a_matrixspace](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/submodules_of_a_matrixspace)** to **[public/linear_algebra/matrix_space_submodules-31995](https://github.com/sagemath/sagetrac-mirror/tree/public/linear_algebra/matrix_space_submodules-31995)**



---

archive/issue_events_441247.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-06-17T06:49:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441247"
}
```



---

archive/issue_events_441248.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-17T18:21:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441248"
}
```



---

archive/issue_events_441249.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-17T18:21:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441249"
}
```



---

archive/issue_comments_515098.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThis seems to work well, thanks very much!\n\n(The way that the submodule prints itself, using the indices, is a bit strange, but that can be improved on another ticket.)",
    "created_at": "2021-06-17T18:21:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515098",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">comment:6</div>

This seems to work well, thanks very much!

(The way that the submodule prints itself, using the indices, is a bit strange, but that can be improved on another ticket.)



---

archive/issue_comments_515099.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThe example from #30334 (duplicate of this ticket) still fails, with a new error:\n\n```\nsage: M = MatrixSpace(QQ, 3, 3)\nsage: M in ModulesWithBasis(QQ)\nTrue\nsage: A = M([[0, 0, 1], [0, 0, 0], [0, 0, 0]])\nsage: A\n[0 0 1]\n[0 0 0]\n[0 0 0]\nsage: M.submodule([A])\nTypeError: entries must be a list of length 9\n```",
    "created_at": "2021-06-18T20:42:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515099",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">comment:7</div>

The example from #30334 (duplicate of this ticket) still fails, with a new error:

```
sage: M = MatrixSpace(QQ, 3, 3)
sage: M in ModulesWithBasis(QQ)
True
sage: A = M([[0, 0, 1], [0, 0, 0], [0, 0, 0]])
sage: A
[0 0 1]
[0 0 0]
[0 0 0]
sage: M.submodule([A])
TypeError: entries must be a list of length 9
```



---

archive/issue_events_441250.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-18T20:42:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441250"
}
```



---

archive/issue_events_441251.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-18T20:42:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441251"
}
```



---

archive/issue_comments_515100.json:
```json
{
    "body": "Changed commit from **[c60bc37](https://github.com/sagemath/sagetrac-mirror/commit/c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f)** to **[e270655](https://github.com/sagemath/sagetrac-mirror/commit/e270655ec552abb098a27cb61f3d78ddd2a1886a)**",
    "created_at": "2021-06-20T23:21:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515100",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[c60bc37](https://github.com/sagemath/sagetrac-mirror/commit/c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f)** to **[e270655](https://github.com/sagemath/sagetrac-mirror/commit/e270655ec552abb098a27cb61f3d78ddd2a1886a)**



---

archive/issue_comments_515101.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e270655ec552abb098a27cb61f3d78ddd2a1886a\">e270655</a></td><td><code>Fixing issue when the support is smaller than the dimension.</code></td></tr></table>\n",
    "created_at": "2021-06-20T23:21:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515101",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e270655ec552abb098a27cb61f3d78ddd2a1886a">e270655</a></td><td><code>Fixing issue when the support is smaller than the dimension.</code></td></tr></table>




---

archive/issue_comments_515102.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThis fixes that issue, which came from the category `FiniteDimensionalModulesWithBasis` expecting `order` to have full support. However, I think we don't want this because we want to support more sparse matrices (or, more general, any ordering passed from the user) for taking submodules, and having a `get_order()` would force a conversion to a dense implementation.",
    "created_at": "2021-06-20T23:25:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515102",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:9" align="right">comment:9</div>

This fixes that issue, which came from the category `FiniteDimensionalModulesWithBasis` expecting `order` to have full support. However, I think we don't want this because we want to support more sparse matrices (or, more general, any ordering passed from the user) for taking submodules, and having a `get_order()` would force a conversion to a dense implementation.



---

archive/issue_events_441252.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-06-20T23:25:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441252"
}
```



---

archive/issue_events_441253.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-06-20T23:25:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441253"
}
```



---

archive/issue_comments_515103.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nYes, I agree with this solution.\nThanks!",
    "created_at": "2021-06-21T00:38:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515103",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

Yes, I agree with this solution.
Thanks!



---

archive/issue_events_441254.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-21T00:38:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441254"
}
```



---

archive/issue_events_441255.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-21T00:38:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441255"
}
```



---

archive/issue_comments_515104.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThank you.",
    "created_at": "2021-06-21T01:25:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515104",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:11" align="right">comment:11</div>

Thank you.



---

archive/issue_events_441256.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-05T23:23:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441256"
}
```



---

archive/issue_events_441257.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-05T23:23:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441257"
}
```



---

archive/issue_comments_515105.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\n\n```\nsage -t --long --warn-long 42.0 --random-seed=0 src/sage/matrix/matrix_space.py\n**********************************************************************\nFile \"src/sage/matrix/matrix_space.py\", line 1622, in sage.matrix.matrix_space.MatrixSpace.?\nFailed example:\n    Xp = M.submodule([A, B], order=[(0,1), (1,1), (0,0)])\nException raised:\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 996, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:5974)\n        return self.cache[k]\n      File \"sage/misc/weak_dict.pyx\", line 702, in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3712)\n        cdef PyObject* wr = PyDict_GetItemWithError(self, k)\n    TypeError: unhashable type: 'list'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 543, in sage.misc.cachefunc.dict_key (build/cythonized/sage/misc/cachefunc.c:3091)\n        hash(o)\n    TypeError: unhashable type: 'list'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 583, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3295)\n        hash(o)\n    TypeError: unhashable type: 'list'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 583, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3295)\n        hash(o)\n    TypeError: unhashable type: 'list'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 583, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3295)\n        hash(o)\n    TypeError: unhashable type: 'list'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 596, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3699)\n        k = o._cache_key()\n    AttributeError: 'list' object has no attribute '_cache_key'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 718, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 1137, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.matrix.matrix_space.MatrixSpace.?[9]>\", line 1, in <module>\n        Xp = M.submodule([A, B], order=[(Integer(0),Integer(1)), (Integer(1),Integer(1)), (Integer(0),Integer(0))])\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/matrix/matrix_space.py\", line 1647, in submodule\n        return SubmoduleWithBasis(gens, ambient=self,\n      File \"sage/misc/classcall_metaclass.pyx\", line 322, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1761)\n        return cls.classcall(cls, *args, **kwds)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/modules/with_basis/subquotient.py\", line 218, in __classcall_private__\n        return super(SubmoduleWithBasis, cls).__classcall__(cls,\n      File \"sage/misc/cachefunc.pyx\", line 998, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6013)\n        k = dict_key(k)\n      File \"sage/misc/cachefunc.pyx\", line 545, in sage.misc.cachefunc.dict_key (build/cythonized/sage/misc/cachefunc.c:3129)\n        o = (unhashable_key, cache_key_unhashable(o))\n      File \"sage/misc/cachefunc.pyx\", line 594, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3660)\n        return tuple(cache_key(item) for item in o)\n      File \"sage/misc/cachefunc.pyx\", line 594, in genexpr (build/cythonized/sage/misc/cachefunc.c:3551)\n        return tuple(cache_key(item) for item in o)\n      File \"sage/misc/cachefunc.pyx\", line 585, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3333)\n        o = cache_key_unhashable(o)\n      File \"sage/misc/cachefunc.pyx\", line 594, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3660)\n        return tuple(cache_key(item) for item in o)\n      File \"sage/misc/cachefunc.pyx\", line 594, in genexpr (build/cythonized/sage/misc/cachefunc.c:3551)\n        return tuple(cache_key(item) for item in o)\n      File \"sage/misc/cachefunc.pyx\", line 585, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3333)\n        o = cache_key_unhashable(o)\n      File \"sage/misc/cachefunc.pyx\", line 594, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3660)\n        return tuple(cache_key(item) for item in o)\n      File \"sage/misc/cachefunc.pyx\", line 594, in genexpr (build/cythonized/sage/misc/cachefunc.c:3551)\n        return tuple(cache_key(item) for item in o)\n      File \"sage/misc/cachefunc.pyx\", line 585, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3333)\n        o = cache_key_unhashable(o)\n      File \"sage/misc/cachefunc.pyx\", line 598, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3783)\n        raise TypeError(\"unhashable type: {!r}\".format(type(o).__name__))\n    TypeError: unhashable type: 'list'\n**********************************************************************\n```",
    "created_at": "2021-07-05T23:23:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515105",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:12" align="right">comment:12</div>


```
sage -t --long --warn-long 42.0 --random-seed=0 src/sage/matrix/matrix_space.py
**********************************************************************
File "src/sage/matrix/matrix_space.py", line 1622, in sage.matrix.matrix_space.MatrixSpace.?
Failed example:
    Xp = M.submodule([A, B], order=[(0,1), (1,1), (0,0)])
Exception raised:
    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 996, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:5974)
        return self.cache[k]
      File "sage/misc/weak_dict.pyx", line 702, in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3712)
        cdef PyObject* wr = PyDict_GetItemWithError(self, k)
    TypeError: unhashable type: 'list'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 543, in sage.misc.cachefunc.dict_key (build/cythonized/sage/misc/cachefunc.c:3091)
        hash(o)
    TypeError: unhashable type: 'list'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 583, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3295)
        hash(o)
    TypeError: unhashable type: 'list'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 583, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3295)
        hash(o)
    TypeError: unhashable type: 'list'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 583, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3295)
        hash(o)
    TypeError: unhashable type: 'list'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 596, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3699)
        k = o._cache_key()
    AttributeError: 'list' object has no attribute '_cache_key'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.matrix.matrix_space.MatrixSpace.?[9]>", line 1, in <module>
        Xp = M.submodule([A, B], order=[(Integer(0),Integer(1)), (Integer(1),Integer(1)), (Integer(0),Integer(0))])
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/matrix/matrix_space.py", line 1647, in submodule
        return SubmoduleWithBasis(gens, ambient=self,
      File "sage/misc/classcall_metaclass.pyx", line 322, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1761)
        return cls.classcall(cls, *args, **kwds)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/modules/with_basis/subquotient.py", line 218, in __classcall_private__
        return super(SubmoduleWithBasis, cls).__classcall__(cls,
      File "sage/misc/cachefunc.pyx", line 998, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6013)
        k = dict_key(k)
      File "sage/misc/cachefunc.pyx", line 545, in sage.misc.cachefunc.dict_key (build/cythonized/sage/misc/cachefunc.c:3129)
        o = (unhashable_key, cache_key_unhashable(o))
      File "sage/misc/cachefunc.pyx", line 594, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3660)
        return tuple(cache_key(item) for item in o)
      File "sage/misc/cachefunc.pyx", line 594, in genexpr (build/cythonized/sage/misc/cachefunc.c:3551)
        return tuple(cache_key(item) for item in o)
      File "sage/misc/cachefunc.pyx", line 585, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3333)
        o = cache_key_unhashable(o)
      File "sage/misc/cachefunc.pyx", line 594, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3660)
        return tuple(cache_key(item) for item in o)
      File "sage/misc/cachefunc.pyx", line 594, in genexpr (build/cythonized/sage/misc/cachefunc.c:3551)
        return tuple(cache_key(item) for item in o)
      File "sage/misc/cachefunc.pyx", line 585, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3333)
        o = cache_key_unhashable(o)
      File "sage/misc/cachefunc.pyx", line 594, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3660)
        return tuple(cache_key(item) for item in o)
      File "sage/misc/cachefunc.pyx", line 594, in genexpr (build/cythonized/sage/misc/cachefunc.c:3551)
        return tuple(cache_key(item) for item in o)
      File "sage/misc/cachefunc.pyx", line 585, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3333)
        o = cache_key_unhashable(o)
      File "sage/misc/cachefunc.pyx", line 598, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3783)
        raise TypeError("unhashable type: {!r}".format(type(o).__name__))
    TypeError: unhashable type: 'list'
**********************************************************************
```



---

archive/issue_comments_515106.json:
```json
{
    "body": "Changed commit from **[e270655](https://github.com/sagemath/sagetrac-mirror/commit/e270655ec552abb098a27cb61f3d78ddd2a1886a)** to **[2061f10](https://github.com/sagemath/sagetrac-mirror/commit/2061f10a00a5bfdc53d4473a6a7faa6a16783558)**",
    "created_at": "2021-07-06T00:42:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515106",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e270655](https://github.com/sagemath/sagetrac-mirror/commit/e270655ec552abb098a27cb61f3d78ddd2a1886a)** to **[2061f10](https://github.com/sagemath/sagetrac-mirror/commit/2061f10a00a5bfdc53d4473a6a7faa6a16783558)**



---

archive/issue_comments_515107.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d9fed04b2ff077a85485754b35e67816b69fbf7b\">d9fed04</a></td><td><code>Merge branch 'public/linear_algebra/matrix_space_submodules-31995' of git://trac.sagemath.org/sage into public/linear_algebra/matrix_space_submodules-31995</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2061f10a00a5bfdc53d4473a6a7faa6a16783558\">2061f10</a></td><td><code>Fixing bad doctests.</code></td></tr></table>\n",
    "created_at": "2021-07-06T00:42:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515107",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d9fed04b2ff077a85485754b35e67816b69fbf7b">d9fed04</a></td><td><code>Merge branch 'public/linear_algebra/matrix_space_submodules-31995' of git://trac.sagemath.org/sage into public/linear_algebra/matrix_space_submodules-31995</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2061f10a00a5bfdc53d4473a6a7faa6a16783558">2061f10</a></td><td><code>Fixing bad doctests.</code></td></tr></table>




---

archive/issue_events_441258.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-07-06T00:43:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441258"
}
```



---

archive/issue_events_441259.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-07-06T00:43:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441259"
}
```



---

archive/issue_comments_515108.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI could have sworn I tested this...sorry about that. Fixed the bad doctests.",
    "created_at": "2021-07-06T00:43:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515108",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>

I could have sworn I tested this...sorry about that. Fixed the bad doctests.



---

archive/issue_events_441260.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-06T03:33:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441260"
}
```



---

archive/issue_events_441261.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-06T03:33:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441261"
}
```



---

archive/issue_comments_515109.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThank you.",
    "created_at": "2021-07-07T05:11:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515109",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">comment:16</div>

Thank you.



---

archive/issue_comments_515110.json:
```json
{
    "body": "Changed branch from **[public/linear_algebra/matrix_space_submodules-31995](https://github.com/sagemath/sagetrac-mirror/tree/public/linear_algebra/matrix_space_submodules-31995)** to **[2061f10](https://github.com/sagemath/sagetrac-mirror/commit/2061f10a00a5bfdc53d4473a6a7faa6a16783558)**",
    "created_at": "2021-07-09T20:23:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31995#issuecomment-515110",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/linear_algebra/matrix_space_submodules-31995](https://github.com/sagemath/sagetrac-mirror/tree/public/linear_algebra/matrix_space_submodules-31995)** to **[2061f10](https://github.com/sagemath/sagetrac-mirror/commit/2061f10a00a5bfdc53d4473a6a7faa6a16783558)**



---

archive/issue_events_441262.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-09T20:23:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441262"
}
```



---

archive/issue_events_441263.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "2450eb79050b2eab90c8eeed8a475e6952a64ce0",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-07-09T20:23:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31995",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31995#event-441263"
}
```
