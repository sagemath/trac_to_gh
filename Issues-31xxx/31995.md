# Issue 31995: Submodules of a MatrixSpace

archive/issues_031758.json:
```json
{
    "body": "`MatrixSpace` does not implement the category `ModulesWithBasis` correctly.\n\n```\nsage: M = MatrixSpace(QQ, 2)\nsage: M.submodule([M.matrix([[1, 2], [3, 4]])])\nAttributeError: 'tuple' object has no attribute 'support'\n```\n\n\nCC:  @tscrim @roed314\n\nBranch/Commit: 2061f10a00a5bfdc53d4473a6a7faa6a16783558\n\nReviewer: Travis Scrimshaw, Matthias Koeppe\n\nAuthor: Matthias Koeppe, Travis Scrimshaw\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31995\n\n",
    "closed_at": "2021-07-09T20:23:34Z",
    "created_at": "2021-06-17T05:14:43Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Submodules of a MatrixSpace",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31995",
    "user": "https://github.com/mkoeppe"
}
```
`MatrixSpace` does not implement the category `ModulesWithBasis` correctly.

```
sage: M = MatrixSpace(QQ, 2)
sage: M.submodule([M.matrix([[1, 2], [3, 4]])])
AttributeError: 'tuple' object has no attribute 'support'
```


CC:  @tscrim @roed314

Branch/Commit: 2061f10a00a5bfdc53d4473a6a7faa6a16783558

Reviewer: Travis Scrimshaw, Matthias Koeppe

Author: Matthias Koeppe, Travis Scrimshaw

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31995





---

archive/issue_comments_636571.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/submodules_of_a_matrixspace\"",
    "created_at": "2021-06-17T05:29:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636571",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/submodules_of_a_matrixspace"



---

archive/issue_comments_636572.json:
```json
{
    "body": "<a id='comment:2'></a>\nHere's a first fix (follow-up from #19448, I think)\n\n---\nNew commits:\n|                                                                                                                                          |                                                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|\n|[54915a6](https://git.sagemath.org/sage.git/commit?id=54915a614fba1f361e7d8e47b87785844a8c165b)|`FiniteDimensionalModulesWithBasis: Fix use of _compute_support_order`|",
    "created_at": "2021-06-17T05:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636572",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
Here's a first fix (follow-up from #19448, I think)

---
New commits:
|                                                                                                                                          |                                                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|
|[54915a6](https://git.sagemath.org/sage.git/commit?id=54915a614fba1f361e7d8e47b87785844a8c165b)|`FiniteDimensionalModulesWithBasis: Fix use of _compute_support_order`|



---

archive/issue_comments_636573.json:
```json
{
    "body": "Changing commit from \"\" to \"54915a614fba1f361e7d8e47b87785844a8c165b\"",
    "created_at": "2021-06-17T05:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636573",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "54915a614fba1f361e7d8e47b87785844a8c165b"



---

archive/issue_comments_636574.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis gets a bit farther and now leads to:\n\n```\nTypeError: <class 'sage.sets.family.TrivialFamily_with_category'> is not hashable and does not implement _cache_key()\n```",
    "created_at": "2021-06-17T05:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636574",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
This gets a bit farther and now leads to:

```
TypeError: <class 'sage.sets.family.TrivialFamily_with_category'> is not hashable and does not implement _cache_key()
```



---

archive/issue_comments_636575.json:
```json
{
    "body": "<a id='comment:4'></a>\n`TrivialFamily` is hashable and even has a doctest:\n\n```\nsage: from sage.sets.family import TrivialFamily\nsage: f = TrivialFamily((3,4,7))\nsage: hash(f) == hash(f)\n```\nThe problem comes from the fact that matrices by default are mutable and not hashable. If you look a little higher up in the error, you get:\n\n```\nTypeError: mutable matrices are unhashable\n```\nThis comes from the fact that `echelon_form` creates mutable matrices:\n\n```\nsage: mat = M.matrix([[1, 2], [3, 4]])\nsage: mat.set_immutable()\nsage: M.echelon_form([mat])[0]\n[1 2]\n[3 4]\nsage: _.is_mutable()\nTrue\n```\nIf we skip this step, then it creates the submodule:\n\n```\nsage: M.submodule([mat], already_echelonized=True)\nFree module generated by {0} over Rational Field\n```",
    "created_at": "2021-06-17T06:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636575",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
`TrivialFamily` is hashable and even has a doctest:

```
sage: from sage.sets.family import TrivialFamily
sage: f = TrivialFamily((3,4,7))
sage: hash(f) == hash(f)
```
The problem comes from the fact that matrices by default are mutable and not hashable. If you look a little higher up in the error, you get:

```
TypeError: mutable matrices are unhashable
```
This comes from the fact that `echelon_form` creates mutable matrices:

```
sage: mat = M.matrix([[1, 2], [3, 4]])
sage: mat.set_immutable()
sage: M.echelon_form([mat])[0]
[1 2]
[3 4]
sage: _.is_mutable()
True
```
If we skip this step, then it creates the submodule:

```
sage: M.submodule([mat], already_echelonized=True)
Free module generated by {0} over Rational Field
```



---

archive/issue_comments_636576.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe best way around this IMO is a special case of `submodule` in `MatrixSpace` that just makes the result of `echelon_form` into a set of immutable matrices. This now works for me.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|\n|[c60bc37](https://git.sagemath.org/sage.git/commit?id=c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f)|`Make matrices immutable during the construction of submodule().`|",
    "created_at": "2021-06-17T06:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636576",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
The best way around this IMO is a special case of `submodule` in `MatrixSpace` that just makes the result of `echelon_form` into a set of immutable matrices. This now works for me.

---
New commits:
|                                                                                                                                          |                                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
|[c60bc37](https://git.sagemath.org/sage.git/commit?id=c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f)|`Make matrices immutable during the construction of submodule().`|



---

archive/issue_comments_636577.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe, Travis Scrimshaw\"",
    "created_at": "2021-06-17T06:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636577",
    "user": "https://github.com/tscrim"
}
```

Changing author from "" to "Matthias Koeppe, Travis Scrimshaw"



---

archive/issue_comments_636578.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw, Matthias Koeppe\"",
    "created_at": "2021-06-17T06:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636578",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw, Matthias Koeppe"



---

archive/issue_comments_636579.json:
```json
{
    "body": "Changing commit from \"54915a614fba1f361e7d8e47b87785844a8c165b\" to \"c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f\"",
    "created_at": "2021-06-17T06:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636579",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "54915a614fba1f361e7d8e47b87785844a8c165b" to "c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f"



---

archive/issue_comments_636580.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/submodules_of_a_matrixspace\" to \"public/linear_algebra/matrix_space_submodules-31995\"",
    "created_at": "2021-06-17T06:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636580",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "u/mkoeppe/submodules_of_a_matrixspace" to "public/linear_algebra/matrix_space_submodules-31995"



---

archive/issue_comments_636581.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-17T06:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636581",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_636582.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-17T18:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636582",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_636583.json:
```json
{
    "body": "<a id='comment:6'></a>\nThis seems to work well, thanks very much!\n\n(The way that the submodule prints itself, using the indices, is a bit strange, but that can be improved on another ticket.)",
    "created_at": "2021-06-17T18:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636583",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
This seems to work well, thanks very much!

(The way that the submodule prints itself, using the indices, is a bit strange, but that can be improved on another ticket.)



---

archive/issue_comments_636584.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe example from #30334 (duplicate of this ticket) still fails, with a new error:\n\n```\nsage: M = MatrixSpace(QQ, 3, 3)\nsage: M in ModulesWithBasis(QQ)\nTrue\nsage: A = M([[0, 0, 1], [0, 0, 0], [0, 0, 0]])\nsage: A\n[0 0 1]\n[0 0 0]\n[0 0 0]\nsage: M.submodule([A])\nTypeError: entries must be a list of length 9\n```",
    "created_at": "2021-06-18T20:42:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636584",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
The example from #30334 (duplicate of this ticket) still fails, with a new error:

```
sage: M = MatrixSpace(QQ, 3, 3)
sage: M in ModulesWithBasis(QQ)
True
sage: A = M([[0, 0, 1], [0, 0, 0], [0, 0, 0]])
sage: A
[0 0 1]
[0 0 0]
[0 0 0]
sage: M.submodule([A])
TypeError: entries must be a list of length 9
```



---

archive/issue_comments_636585.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-06-18T20:42:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636585",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_636586.json:
```json
{
    "body": "Changing commit from \"c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f\" to \"e270655ec552abb098a27cb61f3d78ddd2a1886a\"",
    "created_at": "2021-06-20T23:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636586",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c60bc37dcf38ffa99f96ab8670cb1aedf8f95d2f" to "e270655ec552abb098a27cb61f3d78ddd2a1886a"



---

archive/issue_comments_636587.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------|\n|[e270655](https://git.sagemath.org/sage.git/commit/?id=e270655ec552abb098a27cb61f3d78ddd2a1886a)|`Fixing issue when the support is smaller than the dimension.`|",
    "created_at": "2021-06-20T23:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636587",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                              |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------|
|[e270655](https://git.sagemath.org/sage.git/commit/?id=e270655ec552abb098a27cb61f3d78ddd2a1886a)|`Fixing issue when the support is smaller than the dimension.`|



---

archive/issue_comments_636588.json:
```json
{
    "body": "<a id='comment:9'></a>\nThis fixes that issue, which came from the category `FiniteDimensionalModulesWithBasis` expecting `order` to have full support. However, I think we don't want this because we want to support more sparse matrices (or, more general, any ordering passed from the user) for taking submodules, and having a `get_order()` would force a conversion to a dense implementation.",
    "created_at": "2021-06-20T23:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636588",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>
This fixes that issue, which came from the category `FiniteDimensionalModulesWithBasis` expecting `order` to have full support. However, I think we don't want this because we want to support more sparse matrices (or, more general, any ordering passed from the user) for taking submodules, and having a `get_order()` would force a conversion to a dense implementation.



---

archive/issue_comments_636589.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-06-20T23:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636589",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_636590.json:
```json
{
    "body": "<a id='comment:10'></a>\nYes, I agree with this solution.\nThanks!",
    "created_at": "2021-06-21T00:38:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636590",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Yes, I agree with this solution.
Thanks!



---

archive/issue_comments_636591.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-21T00:38:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636591",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_636592.json:
```json
{
    "body": "<a id='comment:11'></a>\nThank you.",
    "created_at": "2021-06-21T01:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636592",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>
Thank you.



---

archive/issue_comments_636593.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-07-05T23:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636593",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_636594.json:
```json
{
    "body": "<a id='comment:12'></a>\n\n```\nsage -t --long --warn-long 42.0 --random-seed=0 src/sage/matrix/matrix_space.py\n**********************************************************************\nFile \"src/sage/matrix/matrix_space.py\", line 1622, in sage.matrix.matrix_space.MatrixSpace.?\nFailed example:\n    Xp = M.submodule([A, B], order=[(0,1), (1,1), (0,0)])\nException raised:\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 996, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:5974)\n        return self.cache[k]\n      File \"sage/misc/weak_dict.pyx\", line 702, in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3712)\n        cdef PyObject* wr = PyDict_GetItemWithError(self, k)\n    TypeError: unhashable type: 'list'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 543, in sage.misc.cachefunc.dict_key (build/cythonized/sage/misc/cachefunc.c:3091)\n        hash(o)\n    TypeError: unhashable type: 'list'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 583, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3295)\n        hash(o)\n    TypeError: unhashable type: 'list'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 583, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3295)\n        hash(o)\n    TypeError: unhashable type: 'list'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 583, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3295)\n        hash(o)\n    TypeError: unhashable type: 'list'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 596, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3699)\n        k = o._cache_key()\n    AttributeError: 'list' object has no attribute '_cache_key'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 718, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 1137, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.matrix.matrix_space.MatrixSpace.?[9]>\", line 1, in <module>\n        Xp = M.submodule([A, B], order=[(Integer(0),Integer(1)), (Integer(1),Integer(1)), (Integer(0),Integer(0))])\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/matrix/matrix_space.py\", line 1647, in submodule\n        return SubmoduleWithBasis(gens, ambient=self,\n      File \"sage/misc/classcall_metaclass.pyx\", line 322, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1761)\n        return cls.classcall(cls, *args, **kwds)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/modules/with_basis/subquotient.py\", line 218, in __classcall_private__\n        return super(SubmoduleWithBasis, cls).__classcall__(cls,\n      File \"sage/misc/cachefunc.pyx\", line 998, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6013)\n        k = dict_key(k)\n      File \"sage/misc/cachefunc.pyx\", line 545, in sage.misc.cachefunc.dict_key (build/cythonized/sage/misc/cachefunc.c:3129)\n        o = (unhashable_key, cache_key_unhashable(o))\n      File \"sage/misc/cachefunc.pyx\", line 594, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3660)\n        return tuple(cache_key(item) for item in o)\n      File \"sage/misc/cachefunc.pyx\", line 594, in genexpr (build/cythonized/sage/misc/cachefunc.c:3551)\n        return tuple(cache_key(item) for item in o)\n      File \"sage/misc/cachefunc.pyx\", line 585, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3333)\n        o = cache_key_unhashable(o)\n      File \"sage/misc/cachefunc.pyx\", line 594, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3660)\n        return tuple(cache_key(item) for item in o)\n      File \"sage/misc/cachefunc.pyx\", line 594, in genexpr (build/cythonized/sage/misc/cachefunc.c:3551)\n        return tuple(cache_key(item) for item in o)\n      File \"sage/misc/cachefunc.pyx\", line 585, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3333)\n        o = cache_key_unhashable(o)\n      File \"sage/misc/cachefunc.pyx\", line 594, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3660)\n        return tuple(cache_key(item) for item in o)\n      File \"sage/misc/cachefunc.pyx\", line 594, in genexpr (build/cythonized/sage/misc/cachefunc.c:3551)\n        return tuple(cache_key(item) for item in o)\n      File \"sage/misc/cachefunc.pyx\", line 585, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3333)\n        o = cache_key_unhashable(o)\n      File \"sage/misc/cachefunc.pyx\", line 598, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3783)\n        raise TypeError(\"unhashable type: {!r}\".format(type(o).__name__))\n    TypeError: unhashable type: 'list'\n**********************************************************************\n```",
    "created_at": "2021-07-05T23:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636594",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'></a>

```
sage -t --long --warn-long 42.0 --random-seed=0 src/sage/matrix/matrix_space.py
**********************************************************************
File "src/sage/matrix/matrix_space.py", line 1622, in sage.matrix.matrix_space.MatrixSpace.?
Failed example:
    Xp = M.submodule([A, B], order=[(0,1), (1,1), (0,0)])
Exception raised:
    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 996, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:5974)
        return self.cache[k]
      File "sage/misc/weak_dict.pyx", line 702, in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3712)
        cdef PyObject* wr = PyDict_GetItemWithError(self, k)
    TypeError: unhashable type: 'list'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 543, in sage.misc.cachefunc.dict_key (build/cythonized/sage/misc/cachefunc.c:3091)
        hash(o)
    TypeError: unhashable type: 'list'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 583, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3295)
        hash(o)
    TypeError: unhashable type: 'list'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 583, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3295)
        hash(o)
    TypeError: unhashable type: 'list'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 583, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3295)
        hash(o)
    TypeError: unhashable type: 'list'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 596, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3699)
        k = o._cache_key()
    AttributeError: 'list' object has no attribute '_cache_key'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.matrix.matrix_space.MatrixSpace.?[9]>", line 1, in <module>
        Xp = M.submodule([A, B], order=[(Integer(0),Integer(1)), (Integer(1),Integer(1)), (Integer(0),Integer(0))])
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/matrix/matrix_space.py", line 1647, in submodule
        return SubmoduleWithBasis(gens, ambient=self,
      File "sage/misc/classcall_metaclass.pyx", line 322, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1761)
        return cls.classcall(cls, *args, **kwds)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/modules/with_basis/subquotient.py", line 218, in __classcall_private__
        return super(SubmoduleWithBasis, cls).__classcall__(cls,
      File "sage/misc/cachefunc.pyx", line 998, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6013)
        k = dict_key(k)
      File "sage/misc/cachefunc.pyx", line 545, in sage.misc.cachefunc.dict_key (build/cythonized/sage/misc/cachefunc.c:3129)
        o = (unhashable_key, cache_key_unhashable(o))
      File "sage/misc/cachefunc.pyx", line 594, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3660)
        return tuple(cache_key(item) for item in o)
      File "sage/misc/cachefunc.pyx", line 594, in genexpr (build/cythonized/sage/misc/cachefunc.c:3551)
        return tuple(cache_key(item) for item in o)
      File "sage/misc/cachefunc.pyx", line 585, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3333)
        o = cache_key_unhashable(o)
      File "sage/misc/cachefunc.pyx", line 594, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3660)
        return tuple(cache_key(item) for item in o)
      File "sage/misc/cachefunc.pyx", line 594, in genexpr (build/cythonized/sage/misc/cachefunc.c:3551)
        return tuple(cache_key(item) for item in o)
      File "sage/misc/cachefunc.pyx", line 585, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3333)
        o = cache_key_unhashable(o)
      File "sage/misc/cachefunc.pyx", line 594, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3660)
        return tuple(cache_key(item) for item in o)
      File "sage/misc/cachefunc.pyx", line 594, in genexpr (build/cythonized/sage/misc/cachefunc.c:3551)
        return tuple(cache_key(item) for item in o)
      File "sage/misc/cachefunc.pyx", line 585, in sage.misc.cachefunc.cache_key (build/cythonized/sage/misc/cachefunc.c:3333)
        o = cache_key_unhashable(o)
      File "sage/misc/cachefunc.pyx", line 598, in sage.misc.cachefunc.cache_key_unhashable (build/cythonized/sage/misc/cachefunc.c:3783)
        raise TypeError("unhashable type: {!r}".format(type(o).__name__))
    TypeError: unhashable type: 'list'
**********************************************************************
```



---

archive/issue_comments_636595.json:
```json
{
    "body": "Changing commit from \"e270655ec552abb098a27cb61f3d78ddd2a1886a\" to \"2061f10a00a5bfdc53d4473a6a7faa6a16783558\"",
    "created_at": "2021-07-06T00:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636595",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e270655ec552abb098a27cb61f3d78ddd2a1886a" to "2061f10a00a5bfdc53d4473a6a7faa6a16783558"



---

archive/issue_comments_636596.json:
```json
{
    "body": "<a id='comment:13'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                                                                             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|\n|[d9fed04](https://git.sagemath.org/sage.git/commit/?id=d9fed04b2ff077a85485754b35e67816b69fbf7b)|`Merge branch 'public/linear_algebra/matrix_space_submodules-31995' of git://trac.sagemath.org/sage into public/linear_algebra/matrix_space_submodules-31995`|\n|[2061f10](https://git.sagemath.org/sage.git/commit/?id=2061f10a00a5bfdc53d4473a6a7faa6a16783558)|`Fixing bad doctests.`|",
    "created_at": "2021-07-06T00:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636596",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                                                                             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
|[d9fed04](https://git.sagemath.org/sage.git/commit/?id=d9fed04b2ff077a85485754b35e67816b69fbf7b)|`Merge branch 'public/linear_algebra/matrix_space_submodules-31995' of git://trac.sagemath.org/sage into public/linear_algebra/matrix_space_submodules-31995`|
|[2061f10](https://git.sagemath.org/sage.git/commit/?id=2061f10a00a5bfdc53d4473a6a7faa6a16783558)|`Fixing bad doctests.`|



---

archive/issue_comments_636597.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-07-06T00:43:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636597",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_636598.json:
```json
{
    "body": "<a id='comment:14'></a>\nI could have sworn I tested this...sorry about that. Fixed the bad doctests.",
    "created_at": "2021-07-06T00:43:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636598",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>
I could have sworn I tested this...sorry about that. Fixed the bad doctests.



---

archive/issue_comments_636599.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-06T03:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636599",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_636600.json:
```json
{
    "body": "<a id='comment:16'></a>\nThank you.",
    "created_at": "2021-07-07T05:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636600",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>
Thank you.



---

archive/issue_comments_636601.json:
```json
{
    "body": "Changing branch from \"public/linear_algebra/matrix_space_submodules-31995\" to \"2061f10a00a5bfdc53d4473a6a7faa6a16783558\"",
    "created_at": "2021-07-09T20:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636601",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/linear_algebra/matrix_space_submodules-31995" to "2061f10a00a5bfdc53d4473a6a7faa6a16783558"



---

archive/issue_events_084625.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-09T20:23:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31995#event-84625"
}
```



---

archive/issue_comments_636602.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-09T20:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31995#issuecomment-636602",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
