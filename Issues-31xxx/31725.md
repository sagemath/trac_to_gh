# Issue 31725: Implement meet, join, etc. methods for posets

archive/issues_031488.json:
```json
{
    "body": "`FinitePoset.meet(x, y)` computes the meet of two elements `x`, `y` in the poset, returning `None` if the meet doesn't exist.\n\nSimilar for `FinitePoset.join(x, y)`.\n\nCurrently, `FinitePoset._hasse_diagram` has ``@`lazy_attribute` `_meet` (resp. `_join`) and method `meet_matrix` (resp. `join_matrix`). However, they don't compute the matrix but raise an Error if the poset is not a meet/join-semilattice.\n\n```\nsage: from sage.combinat.posets.hasse_diagram import HasseDiagram                     \nsage: h = HasseDiagram({0:[2], 1:[2,3], 2:[4], 3:[4], 4:[]})                \nsage: h._meet   \nTraceback (most recent call last)\n...\nValueError: not a meet-semilattice: no bottom element\n```\n\nWe propose to change `HasseDiagram._meet` (resp. `_join`), so that the `(x,y)`-entry of the matrix is `-1` if the meet of `x` and `y` doesn't exist, instead of raising an Error.  Defer the checks to `HasseDiagram.meet_matrix()` (resp. `join_matrix`).\n\nFor the poset `h` above, we expect:\n\n```\nh._meet[2,3]\n1\nh._meet[0,1]\n-1\nsage: h.meet_matrix()   \nTraceback (most recent call last)\n...\nValueError: not a meet-semilattice: no bottom element\n```\n\nThen, we make the method `FinitePoset.meet(x, y)` (resp. `join(x, y)`) by applying the `_element_to_vertex` and `_vertex_to_element` conversions on `poset._hasse_diagram._meet`.\n\nThis extends `meet` of a pair `x, y` in `FiniteMeetSemilattice` to non-semilattice finite poset. \n\n```\nsage: P = Poset({\"a\":[\"b\", \"c\", \"d\"], \"b\":[\"e\", \"f\"], \"c\":[\"f\"], \"d\":[\"f\", \"g\"]}\n....: )                                                                         \nsage: M = MeetSemilattice(P)                                                    \nsage: M.meet(\"f\",\"g\")                                                           \n'd'\nsage: P2 = Poset({\"b\":[\"e\", \"f\"], \"c\":[\"f\"], \"d\":[\"f\", \"g\"]})                    \nsage: M2 = MeetSemilattice(P)  \nTraceback (most recent call last)\n...\nValueError: not a meet-semilattice: no bottom element\n```\nFor the posets `P` and `P2` above, we expect:\n\n```\nsage: P.meet(\"f\",\"g\")                                                           \n'd'\nsage: P2.meet(\"f\",\"g\")\n'd'\n```\n\nIn addition, `FinitePoset` has the method `common_upper_covers`. We propose to implement the method `common_lower_covers` as well, for symmetry and completeness.\n\nCC:  @mkoeppe @fchapoton @tscrim @slel\n\nKeywords: poset, hasse_diagram\n\nBranch/Commit: a19697ff97092b9bd17bd4e01920a6cfa90b8d95\n\nReviewer: Travis Scrimshaw\n\nAuthor: Yuan Zhou\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31725\n\n",
    "closed_at": "2021-06-19T20:58:03Z",
    "created_at": "2021-04-24T23:45:21Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Implement meet, join, etc. methods for posets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31725",
    "user": "https://github.com/yuan-zhou"
}
```
`FinitePoset.meet(x, y)` computes the meet of two elements `x`, `y` in the poset, returning `None` if the meet doesn't exist.

Similar for `FinitePoset.join(x, y)`.

Currently, `FinitePoset._hasse_diagram` has ``@`lazy_attribute` `_meet` (resp. `_join`) and method `meet_matrix` (resp. `join_matrix`). However, they don't compute the matrix but raise an Error if the poset is not a meet/join-semilattice.

```
sage: from sage.combinat.posets.hasse_diagram import HasseDiagram                     
sage: h = HasseDiagram({0:[2], 1:[2,3], 2:[4], 3:[4], 4:[]})                
sage: h._meet   
Traceback (most recent call last)
...
ValueError: not a meet-semilattice: no bottom element
```

We propose to change `HasseDiagram._meet` (resp. `_join`), so that the `(x,y)`-entry of the matrix is `-1` if the meet of `x` and `y` doesn't exist, instead of raising an Error.  Defer the checks to `HasseDiagram.meet_matrix()` (resp. `join_matrix`).

For the poset `h` above, we expect:

```
h._meet[2,3]
1
h._meet[0,1]
-1
sage: h.meet_matrix()   
Traceback (most recent call last)
...
ValueError: not a meet-semilattice: no bottom element
```

Then, we make the method `FinitePoset.meet(x, y)` (resp. `join(x, y)`) by applying the `_element_to_vertex` and `_vertex_to_element` conversions on `poset._hasse_diagram._meet`.

This extends `meet` of a pair `x, y` in `FiniteMeetSemilattice` to non-semilattice finite poset. 

```
sage: P = Poset({"a":["b", "c", "d"], "b":["e", "f"], "c":["f"], "d":["f", "g"]}
....: )                                                                         
sage: M = MeetSemilattice(P)                                                    
sage: M.meet("f","g")                                                           
'd'
sage: P2 = Poset({"b":["e", "f"], "c":["f"], "d":["f", "g"]})                    
sage: M2 = MeetSemilattice(P)  
Traceback (most recent call last)
...
ValueError: not a meet-semilattice: no bottom element
```
For the posets `P` and `P2` above, we expect:

```
sage: P.meet("f","g")                                                           
'd'
sage: P2.meet("f","g")
'd'
```

In addition, `FinitePoset` has the method `common_upper_covers`. We propose to implement the method `common_lower_covers` as well, for symmetry and completeness.

CC:  @mkoeppe @fchapoton @tscrim @slel

Keywords: poset, hasse_diagram

Branch/Commit: a19697ff97092b9bd17bd4e01920a6cfa90b8d95

Reviewer: Travis Scrimshaw

Author: Yuan Zhou

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31725





---

archive/issue_comments_449807.json:
```json
{
    "body": "<a id='comment:4'></a>I don't understand why we need a `_meet` and `_join` method in `FinitePoset`. Those are implementation details in the backend.\n\n+1 for adding a `common_lower_covers` method.\n\n---\nNew commits:",
    "created_at": "2021-04-25T03:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31725#issuecomment-449807",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>I don't understand why we need a `_meet` and `_join` method in `FinitePoset`. Those are implementation details in the backend.

+1 for adding a `common_lower_covers` method.

---
New commits:



---

archive/issue_comments_449808.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 tscrim]:\n> I don't understand why we need a `_meet` and `_join` method in `FinitePoset`. Those are implementation details in the backend.\n> \n> +1 for adding a `common_lower_covers` method.\n\n\nIn fact, I meant `FinitePoset.meet(x, y)` for two given elements x and y in the poset, even for poset such that `poset.has_bottom()` is `False`. Now reading the code more carefully, I realize that this is not exactly the same as `poset._hasse_diagram._meet`, which gives the `meet_matrix` in the case of a meet-semilattice and raises an error otherwise.",
    "created_at": "2021-04-25T04:29:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31725#issuecomment-449808",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:5'></a>Replying to [comment:4 tscrim]:
> I don't understand why we need a `_meet` and `_join` method in `FinitePoset`. Those are implementation details in the backend.
> 
> +1 for adding a `common_lower_covers` method.


In fact, I meant `FinitePoset.meet(x, y)` for two given elements x and y in the poset, even for poset such that `poset.has_bottom()` is `False`. Now reading the code more carefully, I realize that this is not exactly the same as `poset._hasse_diagram._meet`, which gives the `meet_matrix` in the case of a meet-semilattice and raises an error otherwise.



---

archive/issue_comments_449809.json:
```json
{
    "body": "<a id='comment:6'></a>I'm also wondering if ``@`lazy_attribute HasseDiagram._meet` (and also `_join`) raises Error and refuses to compute the matrix too often. I think it would be better to set the xy-entry of the meet matrix to `None` when the meet of x, y doesn't exists, and then push the checks for the `ValueError(\"not a meet-semilattice...\")` and `LatticeError('meet')` to where it needs.",
    "created_at": "2021-04-25T04:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31725#issuecomment-449809",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:6'></a>I'm also wondering if ``@`lazy_attribute HasseDiagram._meet` (and also `_join`) raises Error and refuses to compute the matrix too often. I think it would be better to set the xy-entry of the meet matrix to `None` when the meet of x, y doesn't exists, and then push the checks for the `ValueError("not a meet-semilattice...")` and `LatticeError('meet')` to where it needs.



---

archive/issue_comments_449810.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-25T09:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31725#issuecomment-449810",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449811.json:
```json
{
    "body": "<a id='comment:16'></a>Question: Why is the following not allowed?\n\n```\nsage: E = LatticePoset({})\nsage: Poset({0: [1]}).is_lattice()\nTrue\nsage: P = MeetSemilattice({0: [1]})\nsage: E.is_sublattice(P)\nTraceback (most recent call last):\n...\nTypeError: other is not a lattice\n```",
    "created_at": "2021-04-25T10:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31725#issuecomment-449811",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:16'></a>Question: Why is the following not allowed?

```
sage: E = LatticePoset({})
sage: Poset({0: [1]}).is_lattice()
True
sage: P = MeetSemilattice({0: [1]})
sage: E.is_sublattice(P)
Traceback (most recent call last):
...
TypeError: other is not a lattice
```



---

archive/issue_comments_449812.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-25T11:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31725#issuecomment-449812",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449813.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-04-25T11:25:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31725#issuecomment-449813",
    "user": "https://github.com/yuan-zhou"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_449814.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-25T11:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31725#issuecomment-449814",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449815.json:
```json
{
    "body": "<a id='comment:21'></a>The semilattice check can be quite slow with your proposal as it is done every time the `meet_matrix()` is called. I think you should define a new attribute `_semilattice_failure = None` on initialization. Then when `_meet` is called, it sets this attribute to an invalid pair (and perhaps `()` if successful). Then the check in `meet_matrix()` becomes:\n\n```python\nif (n != 0) and (not self.has_bottom()):\n    raise ValueError(\"not a meet-semilattice: no bottom element\")\n# call the attribute to build the matrix and sets _semilattice_failure\nmt = self._meet\nif self._semilattice_failure:\n    x, y = self._is_meet_semilattice\n    raise LatticeError('meet', x, y)\n```",
    "created_at": "2021-04-26T00:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31725#issuecomment-449815",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>The semilattice check can be quite slow with your proposal as it is done every time the `meet_matrix()` is called. I think you should define a new attribute `_semilattice_failure = None` on initialization. Then when `_meet` is called, it sets this attribute to an invalid pair (and perhaps `()` if successful). Then the check in `meet_matrix()` becomes:

```python
if (n != 0) and (not self.has_bottom()):
    raise ValueError("not a meet-semilattice: no bottom element")
# call the attribute to build the matrix and sets _semilattice_failure
mt = self._meet
if self._semilattice_failure:
    x, y = self._is_meet_semilattice
    raise LatticeError('meet', x, y)
```



---

archive/issue_comments_449816.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-26T03:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31725#issuecomment-449816",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449817.json:
```json
{
    "body": "<a id='comment:23'></a>Thanks, Travis! I made the change according to your suggestion.",
    "created_at": "2021-04-26T03:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31725#issuecomment-449817",
    "user": "https://github.com/yuan-zhou"
}
```

<a id='comment:23'></a>Thanks, Travis! I made the change according to your suggestion.



---

archive/issue_comments_449818.json:
```json
{
    "body": "<a id='comment:24'></a>I like your solution. Thank you. LGTM.",
    "created_at": "2021-04-28T02:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31725#issuecomment-449818",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:24'></a>I like your solution. Thank you. LGTM.



---

archive/issue_comments_449819.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-04-28T02:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31725#issuecomment-449819",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_083654.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-19T20:58:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31725",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31725#event-83654"
}
```



---

archive/issue_comments_449820.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-06-19T20:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31725#issuecomment-449820",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
