# Issue 31196: Code Improvements for Mutability module

archive/issues_030959.json:
```json
{
    "assignees": [],
    "body": "I suggest some code improvements for the documentation (adding a note that an attribute \u00e0 la `_is_immutable` is required to check immutability), an additional method `_require_immutable` (to require immutability in cases like hash functions) and Python 3 compatibility (using `format` instead of `%` as recommended in Python's doc).\n\nDepends on #31181\n\nCC:  @mkoeppe @tscrim\n\nBranch/Commit: **[b9f3c28](https://github.com/sagemath/sagetrac-mirror/commit/b9f3c2837df1fb8d72221e855c87de75058d548e)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Michael Jung**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31196_\n\n",
    "closed_at": "2021-01-31T20:53:38Z",
    "created_at": "2021-01-07T14:49:31Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Code Improvements for Mutability module",
    "type": "issue",
    "updated_at": "2021-01-31T20:53:38Z",
    "url": "https://github.com/sagemath/sage/issues/31196",
    "user": "https://github.com/mjungmath"
}
```
I suggest some code improvements for the documentation (adding a note that an attribute à la `_is_immutable` is required to check immutability), an additional method `_require_immutable` (to require immutability in cases like hash functions) and Python 3 compatibility (using `format` instead of `%` as recommended in Python's doc).

Depends on #31181

CC:  @mkoeppe @tscrim

Branch/Commit: **[b9f3c28](https://github.com/sagemath/sagetrac-mirror/commit/b9f3c2837df1fb8d72221e855c87de75058d548e)**

Reviewer: **Travis Scrimshaw**

Author: **Michael Jung**

_Issue created by migration from https://trac.sagemath.org/ticket/31196_





---

archive/issue_events_397803.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2021-01-07T14:49:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31196#event-397803"
}
```



---

archive/issue_events_397804.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2021-01-07T14:49:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31196#event-397804"
}
```



---

archive/issue_events_397805.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2021-01-07T14:49:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31196#event-397805"
}
```



---

archive/issue_comments_502804.json:
```json
{
    "body": "Branch: **[u/gh-mjungmath/clean_mutibility_code](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/clean_mutibility_code)**",
    "created_at": "2021-01-07T14:50:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502804",
    "user": "https://github.com/mjungmath"
}
```

Branch: **[u/gh-mjungmath/clean_mutibility_code](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/clean_mutibility_code)**



---

archive/issue_comments_502805.json:
```json
{
    "body": "Commit: **[aebc3f4](https://github.com/sagemath/sagetrac-mirror/commit/aebc3f4fb9e0be8cbfc9fe01b5d94ae8c4a92fb7)**",
    "created_at": "2021-01-07T14:51:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502805",
    "user": "https://github.com/mjungmath"
}
```

Commit: **[aebc3f4](https://github.com/sagemath/sagetrac-mirror/commit/aebc3f4fb9e0be8cbfc9fe01b5d94ae8c4a92fb7)**



---

archive/issue_comments_502806.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable`. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for the manifolds module.\n+I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable`. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.\n``````\n",
    "created_at": "2021-01-07T14:51:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502806",
    "user": "https://github.com/mjungmath"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable`. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for the manifolds module.
+I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable`. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.
``````




---

archive/issue_comments_502807.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e918ad562206590220d0bc74d0389183dcf55cd\">2e918ad</a></td><td><code>Trac #31194: rename attribute</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aebc3f4fb9e0be8cbfc9fe01b5d94ae8c4a92fb7\">aebc3f4</a></td><td><code>Trac #31196: code improvements</code></td></tr></table>\n",
    "created_at": "2021-01-07T14:51:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502807",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:2'>Comment 2:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e918ad562206590220d0bc74d0389183dcf55cd">2e918ad</a></td><td><code>Trac #31194: rename attribute</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aebc3f4fb9e0be8cbfc9fe01b5d94ae8c4a92fb7">aebc3f4</a></td><td><code>Trac #31196: code improvements</code></td></tr></table>




---

archive/issue_events_397806.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2021-01-07T14:51:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31196#event-397806"
}
```



---

archive/issue_comments_502808.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable`. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.\n+I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable` for flexibility. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.\n``````\n",
    "created_at": "2021-01-07T14:53:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502808",
    "user": "https://github.com/mjungmath"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable`. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.
+I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable` for flexibility. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.
``````




---

archive/issue_comments_502809.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable` for flexibility. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.\n+I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable` for flexibility. Furthermore, the error message is aligned with that from the method `_require_immutable` and in accordance with preexisting error messages of that kind, so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.\n``````\n",
    "created_at": "2021-01-07T15:01:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502809",
    "user": "https://github.com/mjungmath"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable` for flexibility. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.
+I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable` for flexibility. Furthermore, the error message is aligned with that from the method `_require_immutable` and in accordance with preexisting error messages of that kind, so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.
``````




---

archive/issue_comments_502810.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc8f76b5bec041f17c26d4798fd462f03ef9d9c2\">cc8f76b</a></td><td><code>Trac #31196: code improvements</code></td></tr></table>\n",
    "created_at": "2021-01-07T15:03:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502810",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>Comment 6:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc8f76b5bec041f17c26d4798fd462f03ef9d9c2">cc8f76b</a></td><td><code>Trac #31196: code improvements</code></td></tr></table>




---

archive/issue_comments_502811.json:
```json
{
    "body": "Changed commit from **[aebc3f4](https://github.com/sagemath/sagetrac-mirror/commit/aebc3f4fb9e0be8cbfc9fe01b5d94ae8c4a92fb7)** to **[cc8f76b](https://github.com/sagemath/sagetrac-mirror/commit/cc8f76b5bec041f17c26d4798fd462f03ef9d9c2)**",
    "created_at": "2021-01-07T15:03:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502811",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[aebc3f4](https://github.com/sagemath/sagetrac-mirror/commit/aebc3f4fb9e0be8cbfc9fe01b5d94ae8c4a92fb7)** to **[cc8f76b](https://github.com/sagemath/sagetrac-mirror/commit/cc8f76b5bec041f17c26d4798fd462f03ef9d9c2)**



---

archive/issue_comments_502812.json:
```json
{
    "body": "Changed commit from **[cc8f76b](https://github.com/sagemath/sagetrac-mirror/commit/cc8f76b5bec041f17c26d4798fd462f03ef9d9c2)** to **[1572085](https://github.com/sagemath/sagetrac-mirror/commit/15720856853249d192eb56192ff589d3f88b1892)**",
    "created_at": "2021-01-07T15:32:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502812",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[cc8f76b](https://github.com/sagemath/sagetrac-mirror/commit/cc8f76b5bec041f17c26d4798fd462f03ef9d9c2)** to **[1572085](https://github.com/sagemath/sagetrac-mirror/commit/15720856853249d192eb56192ff589d3f88b1892)**



---

archive/issue_comments_502813.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15720856853249d192eb56192ff589d3f88b1892\">1572085</a></td><td><code>Trac #31196: if logic error</code></td></tr></table>\n",
    "created_at": "2021-01-07T15:32:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502813",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'>Comment 7:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15720856853249d192eb56192ff589d3f88b1892">1572085</a></td><td><code>Trac #31196: if logic error</code></td></tr></table>




---

archive/issue_comments_502814.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nAlternatively, one could ask for the **method** `is_immutable()` instead of the *attribute*? Then it wouldn't matter what happens behind the scenes, that's most flexible.",
    "created_at": "2021-01-07T21:43:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502814",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:8'>Comment 8:</a>
Alternatively, one could ask for the **method** `is_immutable()` instead of the *attribute*? Then it wouldn't matter what happens behind the scenes, that's most flexible.



---

archive/issue_comments_502815.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nI strongly think the attribute name should be standardized and not look for the choice between the two. This will not only be faster but easier to maintain.",
    "created_at": "2021-01-08T00:30:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502815",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'>Comment 9:</a>
I strongly think the attribute name should be standardized and not look for the choice between the two. This will not only be faster but easier to maintain.



---

archive/issue_comments_502816.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nReplying to [@tscrim](#comment%3A9):\n> I strongly think the attribute name should be standardized and not look for the choice between the two. This will not only be faster but easier to maintain.\n\nThat makes sense. What about this instead:\n\n> Alternatively, one could ask for the method is_immutable() instead of the attribute?\n\nThen, the method is standardized, which I would favorize.\n\nAnd what do you think about the change of error message?",
    "created_at": "2021-01-08T09:28:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502816",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:10'>Comment 10:</a>
Replying to [@tscrim](#comment%3A9):
> I strongly think the attribute name should be standardized and not look for the choice between the two. This will not only be faster but easier to maintain.

That makes sense. What about this instead:

> Alternatively, one could ask for the method is_immutable() instead of the attribute?

Then, the method is standardized, which I would favorize.

And what do you think about the change of error message?



---

archive/issue_comments_502817.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df9a54cd7cef639c2875487635706317979b3304\">df9a54c</a></td><td><code>Trac #31196: use \"is_immutable()\" + documentation</code></td></tr></table>\n",
    "created_at": "2021-01-08T10:11:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502817",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:11'>Comment 11:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df9a54cd7cef639c2875487635706317979b3304">df9a54c</a></td><td><code>Trac #31196: use "is_immutable()" + documentation</code></td></tr></table>




---

archive/issue_comments_502818.json:
```json
{
    "body": "Changed commit from **[1572085](https://github.com/sagemath/sagetrac-mirror/commit/15720856853249d192eb56192ff589d3f88b1892)** to **[df9a54c](https://github.com/sagemath/sagetrac-mirror/commit/df9a54cd7cef639c2875487635706317979b3304)**",
    "created_at": "2021-01-08T10:11:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502818",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1572085](https://github.com/sagemath/sagetrac-mirror/commit/15720856853249d192eb56192ff589d3f88b1892)** to **[df9a54c](https://github.com/sagemath/sagetrac-mirror/commit/df9a54cd7cef639c2875487635706317979b3304)**



---

archive/issue_comments_502819.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [git](#comment%3A11):\n> Branch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df9a54cd7cef639c2875487635706317979b3304\">df9a54c</a></td><td><code>Trac #31196: use \"is_immutable()\" + documentation</code></td></tr></table>\n\nI had something like this in mind...\n\nShould be even faster since `getattr` is completely avoided. Moreover, the error message is now much clearer if the object doesn't support mutability.",
    "created_at": "2021-01-08T10:14:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502819",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [git](#comment%3A11):
> Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df9a54cd7cef639c2875487635706317979b3304">df9a54c</a></td><td><code>Trac #31196: use "is_immutable()" + documentation</code></td></tr></table>

I had something like this in mind...

Should be even faster since `getattr` is completely avoided. Moreover, the error message is now much clearer if the object doesn't support mutability.



---

archive/issue_comments_502820.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06b40bfcd0451da94249b73f46cdd29a70c7cb88\">06b40bf</a></td><td><code>Trac #31196: comment indirect doctest</code></td></tr></table>\n",
    "created_at": "2021-01-08T10:19:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502820",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:13'>Comment 13:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06b40bfcd0451da94249b73f46cdd29a70c7cb88">06b40bf</a></td><td><code>Trac #31196: comment indirect doctest</code></td></tr></table>




---

archive/issue_comments_502821.json:
```json
{
    "body": "Changed commit from **[df9a54c](https://github.com/sagemath/sagetrac-mirror/commit/df9a54cd7cef639c2875487635706317979b3304)** to **[06b40bf](https://github.com/sagemath/sagetrac-mirror/commit/06b40bfcd0451da94249b73f46cdd29a70c7cb88)**",
    "created_at": "2021-01-08T10:19:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502821",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[df9a54c](https://github.com/sagemath/sagetrac-mirror/commit/df9a54cd7cef639c2875487635706317979b3304)** to **[06b40bf](https://github.com/sagemath/sagetrac-mirror/commit/06b40bfcd0451da94249b73f46cdd29a70c7cb88)**



---

archive/issue_comments_502822.json:
```json
{
    "body": "Dependencies: **#31181**",
    "created_at": "2021-01-08T10:20:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502822",
    "user": "https://github.com/mjungmath"
}
```

Dependencies: **#31181**



---

archive/issue_comments_502823.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable` for flexibility. Furthermore, the error message is aligned with that from the method `_require_immutable` and in accordance with preexisting error messages of that kind, so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.\n+I suggest some code improvements. For the decorator check, we require a method `\u00ecs_immutable()` to be implemented and avoid `getattr` completely. Furthermore, the error message is aligned with that from the method `_require_immutable` and in accordance with preexisting error messages of that kind, so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.\n``````\n",
    "created_at": "2021-01-08T10:21:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502823",
    "user": "https://github.com/mjungmath"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable` for flexibility. Furthermore, the error message is aligned with that from the method `_require_immutable` and in accordance with preexisting error messages of that kind, so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.
+I suggest some code improvements. For the decorator check, we require a method `ìs_immutable()` to be implemented and avoid `getattr` completely. Furthermore, the error message is aligned with that from the method `_require_immutable` and in accordance with preexisting error messages of that kind, so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.
``````




---

archive/issue_comments_502824.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nThe problem with this approach is that it will raise an attribute error if it is used on a class that does not implement an `is_immutable()` method. Although I mostly agree that it generally should if it is using this feature, but I could conceive of a reason why it wouldn't. I would say it is more likely that things will have some attribute to hold the mutability status than just a method to check it. Ultimately I would leave the check the way it currently is with somethign in the docstring stating that it is a requirement to use the decorator.\n\nI am not 100% convinced the error message is more clear, but I am okay with it (once you remove the trailing period).",
    "created_at": "2021-01-08T23:45:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502824",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'>Comment 16:</a>
The problem with this approach is that it will raise an attribute error if it is used on a class that does not implement an `is_immutable()` method. Although I mostly agree that it generally should if it is using this feature, but I could conceive of a reason why it wouldn't. I would say it is more likely that things will have some attribute to hold the mutability status than just a method to check it. Ultimately I would leave the check the way it currently is with somethign in the docstring stating that it is a requirement to use the decorator.

I am not 100% convinced the error message is more clear, but I am okay with it (once you remove the trailing period).



---

archive/issue_comments_502825.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nReplying to [@tscrim](#comment%3A16):\n> The problem with this approach is that it will raise an attribute error if it is used on a class that does not implement an `is_immutable()` method. Although I mostly agree that it generally should if it is using this feature, but I could conceive of a reason why it wouldn't. I would say it is more likely that things will have some attribute to hold the mutability status than just a method to check it. Ultimately I would leave the check the way it currently is with somethign in the docstring stating that it is a requirement to use the decorator.\n\nI don't get your point entirely. Is your `AttributeError` concern related only to the method or generally speaking? If it's related, I'd say we use the attribute only (even though I personally like methods more, because they are not interested in implementation details), drop the `getattr` (because it's faster) and raise an attribute error if that is not implemented. I think it should definitely raise an attribute error in cases where we cannot say whether the object is immutable or not. The decorator wouldn't make much sense in situations like this, same for the error message.\n\n> I am not 100% convinced the error message is more clear, but I am okay with it (once you remove the trailing period).\n\nAny ideas for a compromise? I think, from a developer's viewpoint, the original error message was more clear. But my plan, so far, is that this decorator should be used for the mutability checks in the manifold setting (after the pickling in #31182 had been solved).",
    "created_at": "2021-01-09T00:06:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502825",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:17'>Comment 17:</a>
Replying to [@tscrim](#comment%3A16):
> The problem with this approach is that it will raise an attribute error if it is used on a class that does not implement an `is_immutable()` method. Although I mostly agree that it generally should if it is using this feature, but I could conceive of a reason why it wouldn't. I would say it is more likely that things will have some attribute to hold the mutability status than just a method to check it. Ultimately I would leave the check the way it currently is with somethign in the docstring stating that it is a requirement to use the decorator.

I don't get your point entirely. Is your `AttributeError` concern related only to the method or generally speaking? If it's related, I'd say we use the attribute only (even though I personally like methods more, because they are not interested in implementation details), drop the `getattr` (because it's faster) and raise an attribute error if that is not implemented. I think it should definitely raise an attribute error in cases where we cannot say whether the object is immutable or not. The decorator wouldn't make much sense in situations like this, same for the error message.

> I am not 100% convinced the error message is more clear, but I am okay with it (once you remove the trailing period).

Any ideas for a compromise? I think, from a developer's viewpoint, the original error message was more clear. But my plan, so far, is that this decorator should be used for the mutability checks in the manifold setting (after the pickling in #31182 had been solved).



---

archive/issue_comments_502826.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nFor the records, I suggested this change because of #31194, to avoid possible incompatibilites in case of slight variations in the implementation.",
    "created_at": "2021-01-09T00:45:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502826",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:18'>Comment 18:</a>
For the records, I suggested this change because of #31194, to avoid possible incompatibilites in case of slight variations in the implementation.



---

archive/issue_comments_502827.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nReplying to [@mjungmath](#comment%3A17):\n> Replying to [@tscrim](#comment%3A16):\n> > The problem with this approach is that it will raise an attribute error if it is used on a class that does not implement an `is_immutable()` method. Although I mostly agree that it generally should if it is using this feature, but I could conceive of a reason why it wouldn't. I would say it is more likely that things will have some attribute to hold the mutability status than just a method to check it. Ultimately I would leave the check the way it currently is with something in the docstring stating that it is a requirement to use the decorator.\n\n> \n> I don't get your point entirely. Is your `AttributeError` concern related only to the method or generally speaking? If it's related, I'd say we use the attribute only (even though I personally like methods more, because they are not interested in implementation details), drop the `getattr` (because it's faster) and raise an attribute error if that is not implemented. I think it should definitely raise an attribute error in cases where we cannot say whether the object is immutable or not. The decorator wouldn't make much sense in situations like this, same for the error message.\n\nI don't understand this distinction you're trying to make. If you use this decorator with a method on a class that does not implement an `is_immutable` method, then you get an `AttributeError`. However, it is potentially reasonable for a class to add an attribute `_is_immutable` when it becomes immutable. I agree with your point on not depending on implementation details, but because we are trying to set the API for implementations, I feel like that is somewhat moot. There is also something to be said for having different error messages, but having more flexibility I think trumps this, although just barely.\n\n> > I am not 100% convinced the error message is more clear, but I am okay with it (once you remove the trailing period).\n\n> \n> Any ideas for a compromise? I think, from a developer's viewpoint, the original error message was more clear. But my plan, so far, is that this decorator should be used for the mutability checks in the manifold setting (after the pickling in #31182 had been solved).\n\nI would generally avoid the decorator and just directly call stuff. It is nearly the same amount of code. While it does make it slightly easier to refactor, it obfuscates the code mode and slows it down. This is good for the more casual user, but for production code, I would avoid the decorator in this case.",
    "created_at": "2021-01-09T01:07:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502827",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'>Comment 19:</a>
Replying to [@mjungmath](#comment%3A17):
> Replying to [@tscrim](#comment%3A16):
> > The problem with this approach is that it will raise an attribute error if it is used on a class that does not implement an `is_immutable()` method. Although I mostly agree that it generally should if it is using this feature, but I could conceive of a reason why it wouldn't. I would say it is more likely that things will have some attribute to hold the mutability status than just a method to check it. Ultimately I would leave the check the way it currently is with something in the docstring stating that it is a requirement to use the decorator.

> 
> I don't get your point entirely. Is your `AttributeError` concern related only to the method or generally speaking? If it's related, I'd say we use the attribute only (even though I personally like methods more, because they are not interested in implementation details), drop the `getattr` (because it's faster) and raise an attribute error if that is not implemented. I think it should definitely raise an attribute error in cases where we cannot say whether the object is immutable or not. The decorator wouldn't make much sense in situations like this, same for the error message.

I don't understand this distinction you're trying to make. If you use this decorator with a method on a class that does not implement an `is_immutable` method, then you get an `AttributeError`. However, it is potentially reasonable for a class to add an attribute `_is_immutable` when it becomes immutable. I agree with your point on not depending on implementation details, but because we are trying to set the API for implementations, I feel like that is somewhat moot. There is also something to be said for having different error messages, but having more flexibility I think trumps this, although just barely.

> > I am not 100% convinced the error message is more clear, but I am okay with it (once you remove the trailing period).

> 
> Any ideas for a compromise? I think, from a developer's viewpoint, the original error message was more clear. But my plan, so far, is that this decorator should be used for the mutability checks in the manifold setting (after the pickling in #31182 had been solved).

I would generally avoid the decorator and just directly call stuff. It is nearly the same amount of code. While it does make it slightly easier to refactor, it obfuscates the code mode and slows it down. This is good for the more casual user, but for production code, I would avoid the decorator in this case.



---

archive/issue_comments_502828.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nReplying to [@tscrim](#comment%3A19):\n> ...\n\nAlright then. I thought it might be convenient. Too much thinking, eh? I'll just add a warning to make clear that such objects require a `_is_immutable` attribute.\n\nAs for the manifold code, I should switch to `_require_immutable` in `Mutability` instead?",
    "created_at": "2021-01-09T01:51:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502828",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:20'>Comment 20:</a>
Replying to [@tscrim](#comment%3A19):
> ...

Alright then. I thought it might be convenient. Too much thinking, eh? I'll just add a warning to make clear that such objects require a `_is_immutable` attribute.

As for the manifold code, I should switch to `_require_immutable` in `Mutability` instead?



---

archive/issue_comments_502829.json:
```json
{
    "body": "Changed commit from **[06b40bf](https://github.com/sagemath/sagetrac-mirror/commit/06b40bfcd0451da94249b73f46cdd29a70c7cb88)** to **[4c33935](https://github.com/sagemath/sagetrac-mirror/commit/4c3393509d75c6a040b312732a1801f190b88142)**",
    "created_at": "2021-01-09T13:05:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502829",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[06b40bf](https://github.com/sagemath/sagetrac-mirror/commit/06b40bfcd0451da94249b73f46cdd29a70c7cb88)** to **[4c33935](https://github.com/sagemath/sagetrac-mirror/commit/4c3393509d75c6a040b312732a1801f190b88142)**



---

archive/issue_comments_502830.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ecbf3a4896e2ccc10f3f16d4100e197de6a6fea\">5ecbf3a</a></td><td><code>Trac #31181: return added</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c3393509d75c6a040b312732a1801f190b88142\">4c33935</a></td><td><code>Trac #31196: minor code improvements, py3 compatibility, documentation improved</code></td></tr></table>\n",
    "created_at": "2021-01-09T13:05:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502830",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:21'>Comment 21:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ecbf3a4896e2ccc10f3f16d4100e197de6a6fea">5ecbf3a</a></td><td><code>Trac #31181: return added</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c3393509d75c6a040b312732a1801f190b88142">4c33935</a></td><td><code>Trac #31196: minor code improvements, py3 compatibility, documentation improved</code></td></tr></table>




---

archive/issue_comments_502831.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-I suggest some code improvements. For the decorator check, we require a method `\u00ecs_immutable()` to be implemented and avoid `getattr` completely. Furthermore, the error message is aligned with that from the method `_require_immutable` and in accordance with preexisting error messages of that kind, so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.\n+I suggest some code improvements for the documentation, an additional method `_require_immutable` and Python 3 compatibility.\n``````\n",
    "created_at": "2021-01-09T13:12:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502831",
    "user": "https://github.com/mjungmath"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-I suggest some code improvements. For the decorator check, we require a method `ìs_immutable()` to be implemented and avoid `getattr` completely. Furthermore, the error message is aligned with that from the method `_require_immutable` and in accordance with preexisting error messages of that kind, so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.
+I suggest some code improvements for the documentation, an additional method `_require_immutable` and Python 3 compatibility.
``````




---

archive/issue_comments_502832.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nLike this?",
    "created_at": "2021-01-09T13:12:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502832",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:22'>Comment 22:</a>
Like this?



---

archive/issue_comments_502833.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-I suggest some code improvements for the documentation, an additional method `_require_immutable` and Python 3 compatibility.\n+I suggest some code improvements for the documentation (adding a note that an attribute \u00e0 la `_is_immutable` is required to check immutability), an additional method `_require_immutable` (to require immutability in cases like hash functions) and Python 3 compatibility (using `format` instead of `%` as recommended in Python's doc).\n``````\n",
    "created_at": "2021-01-09T15:18:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502833",
    "user": "https://github.com/mjungmath"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-I suggest some code improvements for the documentation, an additional method `_require_immutable` and Python 3 compatibility.
+I suggest some code improvements for the documentation (adding a note that an attribute à la `_is_immutable` is required to check immutability), an additional method `_require_immutable` (to require immutability in cases like hash functions) and Python 3 compatibility (using `format` instead of `%` as recommended in Python's doc).
``````




---

archive/issue_comments_502834.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nReplying to [@mjungmath](#comment%3A22):\n> Like this?\n\nI think this is good overall. However I have one question and comment:\n\nWhy is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`? I think you need an `except -1` added too.",
    "created_at": "2021-01-10T12:56:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502834",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:24'>Comment 24:</a>
Replying to [@mjungmath](#comment%3A22):
> Like this?

I think this is good overall. However I have one question and comment:

Why is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`? I think you need an `except -1` added too.



---

archive/issue_comments_502835.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nReplying to [@tscrim](#comment%3A24):\n> I think this is good overall. However I have one question and comment:\n> \n> Why is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`?\n\nI actually don't know. That was the setup I found there. Actually, due to #31182, I think it is better to make this class completely Pythonic. If there is a need for a Cythonic version, I suggest to introduce a `SageObjectWithMutability`. See my [comment](https://github.com/sagemath/sage/issues/31182#comment:12).\n\n> I think you need an `except -1` too.\n\nWhat do you mean?",
    "created_at": "2021-01-10T15:18:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502835",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:25'>Comment 25:</a>
Replying to [@tscrim](#comment%3A24):
> I think this is good overall. However I have one question and comment:
> 
> Why is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`?

I actually don't know. That was the setup I found there. Actually, due to #31182, I think it is better to make this class completely Pythonic. If there is a need for a Cythonic version, I suggest to introduce a `SageObjectWithMutability`. See my [comment](https://github.com/sagemath/sage/issues/31182#comment:12).

> I think you need an `except -1` too.

What do you mean?



---

archive/issue_comments_502836.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nReplying to [@mjungmath](#comment%3A25):\n> Replying to [@tscrim](#comment%3A24):\n> > I think this is good overall. However I have one question and comment:\n> > \n> > Why is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`?\n\n> \n> I actually don't know. That was the setup I found there. Actually, due to #31182, I think it is better to make this class completely Pythonic. If there is a need for a Cythonic version, I suggest to introduce a `SageObjectWithMutability`. See my [comment](https://github.com/sagemath/sage/issues/31182#comment:12).\n\n-1 on this. I will comment on #31182 for more about this.\n\n> > I think you need an `except -1` too.\n\n> \n> What do you mean?\n\nhttps://cython.readthedocs.io/en/latest/src/userguide/language_basics.html#error-return-values",
    "created_at": "2021-01-12T00:14:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502836",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:26'>Comment 26:</a>
Replying to [@mjungmath](#comment%3A25):
> Replying to [@tscrim](#comment%3A24):
> > I think this is good overall. However I have one question and comment:
> > 
> > Why is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`?

> 
> I actually don't know. That was the setup I found there. Actually, due to #31182, I think it is better to make this class completely Pythonic. If there is a need for a Cythonic version, I suggest to introduce a `SageObjectWithMutability`. See my [comment](https://github.com/sagemath/sage/issues/31182#comment:12).

-1 on this. I will comment on #31182 for more about this.

> > I think you need an `except -1` too.

> 
> What do you mean?

https://cython.readthedocs.io/en/latest/src/userguide/language_basics.html#error-return-values



---

archive/issue_comments_502837.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c805199394721b8957e88bebc79bffd9f319c856\">c805199</a></td><td><code>Trac #31196: minor code improvements, py3 compatibility, documentation improved</code></td></tr></table>\n",
    "created_at": "2021-01-17T19:39:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502837",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:27'>Comment 27:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c805199394721b8957e88bebc79bffd9f319c856">c805199</a></td><td><code>Trac #31196: minor code improvements, py3 compatibility, documentation improved</code></td></tr></table>




---

archive/issue_comments_502838.json:
```json
{
    "body": "Changed commit from **[4c33935](https://github.com/sagemath/sagetrac-mirror/commit/4c3393509d75c6a040b312732a1801f190b88142)** to **[c805199](https://github.com/sagemath/sagetrac-mirror/commit/c805199394721b8957e88bebc79bffd9f319c856)**",
    "created_at": "2021-01-17T19:39:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502838",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4c33935](https://github.com/sagemath/sagetrac-mirror/commit/4c3393509d75c6a040b312732a1801f190b88142)** to **[c805199](https://github.com/sagemath/sagetrac-mirror/commit/c805199394721b8957e88bebc79bffd9f319c856)**



---

archive/issue_comments_502839.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ecbf3a4896e2ccc10f3f16d4100e197de6a6fea\">5ecbf3a</a></td><td><code>Trac #31181: return added</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c3393509d75c6a040b312732a1801f190b88142\">4c33935</a></td><td><code>Trac #31196: minor code improvements, py3 compatibility, documentation improved</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65110905c2f11bca8eedacffbca0c9b32786147e\">6511090</a></td><td><code>Trac #31196: cpdef require methods + except *</code></td></tr></table>\n",
    "created_at": "2021-01-17T19:54:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502839",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:28'>Comment 28:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ecbf3a4896e2ccc10f3f16d4100e197de6a6fea">5ecbf3a</a></td><td><code>Trac #31181: return added</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c3393509d75c6a040b312732a1801f190b88142">4c33935</a></td><td><code>Trac #31196: minor code improvements, py3 compatibility, documentation improved</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65110905c2f11bca8eedacffbca0c9b32786147e">6511090</a></td><td><code>Trac #31196: cpdef require methods + except *</code></td></tr></table>




---

archive/issue_comments_502840.json:
```json
{
    "body": "Changed commit from **[c805199](https://github.com/sagemath/sagetrac-mirror/commit/c805199394721b8957e88bebc79bffd9f319c856)** to **[6511090](https://github.com/sagemath/sagetrac-mirror/commit/65110905c2f11bca8eedacffbca0c9b32786147e)**",
    "created_at": "2021-01-17T19:54:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502840",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[c805199](https://github.com/sagemath/sagetrac-mirror/commit/c805199394721b8957e88bebc79bffd9f319c856)** to **[6511090](https://github.com/sagemath/sagetrac-mirror/commit/65110905c2f11bca8eedacffbca0c9b32786147e)**



---

archive/issue_comments_502841.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nReplying to [@tscrim](#comment%3A24):\n> Replying to [@mjungmath](#comment%3A22):\n> > Like this?\n\n> \n> I think this is good overall. However I have one question and comment:\n> \n> Why is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`? I think you need an `except -1` added too.\n\nIs that better? I think, the `except *` syntax is needed since these functions do not return anything.",
    "created_at": "2021-01-17T19:55:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502841",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:29'>Comment 29:</a>
Replying to [@tscrim](#comment%3A24):
> Replying to [@mjungmath](#comment%3A22):
> > Like this?

> 
> I think this is good overall. However I have one question and comment:
> 
> Why is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`? I think you need an `except -1` added too.

Is that better? I think, the `except *` syntax is needed since these functions do not return anything.



---

archive/issue_comments_502842.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nReplying to [@mjungmath](#comment%3A29):\n> Replying to [@tscrim](#comment%3A24):\n> > Replying to [@mjungmath](#comment%3A22):\n> > > Like this?\n\n> > \n> > I think this is good overall. However I have one question and comment:\n> > \n> > Why is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`? I think you need an `except -1` added too.\n\n> \n> Is that better? I think, the `except *` syntax is needed since these functions do not return anything.\n\nBuilt won't work: *Exception clause not allowed for function returning Python object*. You sure that the exception clause is needed here?",
    "created_at": "2021-01-17T20:15:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502842",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:30'>Comment 30:</a>
Replying to [@mjungmath](#comment%3A29):
> Replying to [@tscrim](#comment%3A24):
> > Replying to [@mjungmath](#comment%3A22):
> > > Like this?

> > 
> > I think this is good overall. However I have one question and comment:
> > 
> > Why is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`? I think you need an `except -1` added too.

> 
> Is that better? I think, the `except *` syntax is needed since these functions do not return anything.

Built won't work: *Exception clause not allowed for function returning Python object*. You sure that the exception clause is needed here?



---

archive/issue_comments_502843.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e5228d3b87529167876c09b693f498e636677d49\">e5228d3</a></td><td><code>Trac #31196: cpdef require methods + example added</code></td></tr></table>\n",
    "created_at": "2021-01-17T20:23:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502843",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:31'>Comment 31:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e5228d3b87529167876c09b693f498e636677d49">e5228d3</a></td><td><code>Trac #31196: cpdef require methods + example added</code></td></tr></table>




---

archive/issue_comments_502844.json:
```json
{
    "body": "Changed commit from **[6511090](https://github.com/sagemath/sagetrac-mirror/commit/65110905c2f11bca8eedacffbca0c9b32786147e)** to **[e5228d3](https://github.com/sagemath/sagetrac-mirror/commit/e5228d3b87529167876c09b693f498e636677d49)**",
    "created_at": "2021-01-17T20:23:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502844",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6511090](https://github.com/sagemath/sagetrac-mirror/commit/65110905c2f11bca8eedacffbca0c9b32786147e)** to **[e5228d3](https://github.com/sagemath/sagetrac-mirror/commit/e5228d3b87529167876c09b693f498e636677d49)**



---

archive/issue_comments_502845.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nOkay, I added an example that works perfectly and improved the documentation incidentally. The except clause is apparently not needed.",
    "created_at": "2021-01-17T20:23:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502845",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:32'>Comment 32:</a>
Okay, I added an example that works perfectly and improved the documentation incidentally. The except clause is apparently not needed.



---

archive/issue_comments_502846.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d957f73a5ac9ab8f198e9d6eb0a3cac266e5d8ba\">d957f73</a></td><td><code>Trac #31196: unnecessary line in docstring removed</code></td></tr></table>\n",
    "created_at": "2021-01-17T20:36:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502846",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:33'>Comment 33:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d957f73a5ac9ab8f198e9d6eb0a3cac266e5d8ba">d957f73</a></td><td><code>Trac #31196: unnecessary line in docstring removed</code></td></tr></table>




---

archive/issue_comments_502847.json:
```json
{
    "body": "Changed commit from **[e5228d3](https://github.com/sagemath/sagetrac-mirror/commit/e5228d3b87529167876c09b693f498e636677d49)** to **[d957f73](https://github.com/sagemath/sagetrac-mirror/commit/d957f73a5ac9ab8f198e9d6eb0a3cac266e5d8ba)**",
    "created_at": "2021-01-17T20:36:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502847",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e5228d3](https://github.com/sagemath/sagetrac-mirror/commit/e5228d3b87529167876c09b693f498e636677d49)** to **[d957f73](https://github.com/sagemath/sagetrac-mirror/commit/d957f73a5ac9ab8f198e9d6eb0a3cac266e5d8ba)**



---

archive/issue_comments_502848.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2021-01-18T00:08:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502848",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_502849.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nAh, it's fine because it doesn't have a return value (and hence returns `None`). Let's wait for the patchbot. If that is green, then positive review.",
    "created_at": "2021-01-18T00:08:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502849",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:34'>Comment 34:</a>
Ah, it's fine because it doesn't have a return value (and hence returns `None`). Let's wait for the patchbot. If that is green, then positive review.



---

archive/issue_comments_502850.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nAlso, while it is technically not your responsibility since it existed previously, it would be good add docstrings and tests to all methods, including `cpdef` ones.",
    "created_at": "2021-01-18T09:27:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502850",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:35'>Comment 35:</a>
Also, while it is technically not your responsibility since it existed previously, it would be good add docstrings and tests to all methods, including `cpdef` ones.



---

archive/issue_comments_502851.json:
```json
{
    "body": "Changed commit from **[d957f73](https://github.com/sagemath/sagetrac-mirror/commit/d957f73a5ac9ab8f198e9d6eb0a3cac266e5d8ba)** to **[b9f3c28](https://github.com/sagemath/sagetrac-mirror/commit/b9f3c2837df1fb8d72221e855c87de75058d548e)**",
    "created_at": "2021-01-18T09:51:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502851",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d957f73](https://github.com/sagemath/sagetrac-mirror/commit/d957f73a5ac9ab8f198e9d6eb0a3cac266e5d8ba)** to **[b9f3c28](https://github.com/sagemath/sagetrac-mirror/commit/b9f3c2837df1fb8d72221e855c87de75058d548e)**



---

archive/issue_comments_502852.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9f3c2837df1fb8d72221e855c87de75058d548e\">b9f3c28</a></td><td><code>Trac #31196: coverage</code></td></tr></table>\n",
    "created_at": "2021-01-18T09:51:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502852",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:36'>Comment 36:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9f3c2837df1fb8d72221e855c87de75058d548e">b9f3c28</a></td><td><code>Trac #31196: coverage</code></td></tr></table>




---

archive/issue_comments_502853.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nReplying to [@tscrim](#comment%3A35):\n> Also, while it is technically not your responsibility since it existed previously, it would be good add docstrings and tests to all methods, including `cpdef` ones.\n\nDone.",
    "created_at": "2021-01-18T09:58:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502853",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:37'>Comment 37:</a>
Replying to [@tscrim](#comment%3A35):
> Also, while it is technically not your responsibility since it existed previously, it would be good add docstrings and tests to all methods, including `cpdef` ones.

Done.



---

archive/issue_comments_502854.json:
```json
{
    "body": "<a id='comment:38'>Comment 38:</a>\nPatchbot is satisfied. :)",
    "created_at": "2021-01-18T21:41:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502854",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:38'>Comment 38:</a>
Patchbot is satisfied. :)



---

archive/issue_comments_502855.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nThank you. LGTM.",
    "created_at": "2021-01-20T06:03:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502855",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:39'>Comment 39:</a>
Thank you. LGTM.



---

archive/issue_events_397807.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-01-20T06:03:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31196#event-397807"
}
```



---

archive/issue_events_397808.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-01-20T06:03:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31196#event-397808"
}
```



---

archive/issue_comments_502856.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nThanks for the review!",
    "created_at": "2021-01-20T09:45:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502856",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:40'>Comment 40:</a>
Thanks for the review!



---

archive/issue_comments_502857.json:
```json
{
    "body": "Changed branch from **[u/gh-mjungmath/clean_mutibility_code](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/clean_mutibility_code)** to **[b9f3c28](https://github.com/sagemath/sagetrac-mirror/commit/b9f3c2837df1fb8d72221e855c87de75058d548e)**",
    "created_at": "2021-01-31T20:53:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502857",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gh-mjungmath/clean_mutibility_code](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/clean_mutibility_code)** to **[b9f3c28](https://github.com/sagemath/sagetrac-mirror/commit/b9f3c2837df1fb8d72221e855c87de75058d548e)**



---

archive/issue_events_397809.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-01-31T20:53:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31196#event-397809"
}
```



---

archive/issue_events_397810.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "3925e96e0a29df0b02df0fc16a66d41d38d8b241",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-01-31T20:53:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31196#event-397810"
}
```
