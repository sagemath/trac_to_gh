# Issue 31196: Code Improvements for Mutability module

archive/issues_030959.json:
```json
{
    "body": "I suggest some code improvements for the documentation (adding a note that an attribute \u00e0 la `_is_immutable` is required to check immutability), an additional method `_require_immutable` (to require immutability in cases like hash functions) and Python 3 compatibility (using `format` instead of `%` as recommended in Python's doc).\n\n**CC:**  @mkoeppe @tscrim\n\n**Branch/Commit:** [b9f3c2837df1fb8d72221e855c87de75058d548e](https://github.com/sagemath/sagetrac-mirror/commit/b9f3c2837df1fb8d72221e855c87de75058d548e)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Michael Jung\n\n**Dependencies:** #31181\n\nIssue created by migration from https://trac.sagemath.org/ticket/31196\n\n",
    "closed_at": "2021-01-31T20:53:38Z",
    "created_at": "2021-01-07T14:49:31Z",
    "labels": [
        "component: misc",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "title": "Code Improvements for Mutability module",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/31196",
    "user": "https://github.com/mjungmath"
}
```
I suggest some code improvements for the documentation (adding a note that an attribute Ã  la `_is_immutable` is required to check immutability), an additional method `_require_immutable` (to require immutability in cases like hash functions) and Python 3 compatibility (using `format` instead of `%` as recommended in Python's doc).

**CC:**  @mkoeppe @tscrim

**Branch/Commit:** [b9f3c2837df1fb8d72221e855c87de75058d548e](https://github.com/sagemath/sagetrac-mirror/commit/b9f3c2837df1fb8d72221e855c87de75058d548e)

**Reviewer:** Travis Scrimshaw

**Author:** Michael Jung

**Dependencies:** #31181

Issue created by migration from https://trac.sagemath.org/ticket/31196





---

archive/issue_comments_502572.json:
```json
{
    "body": "**Branch:** [u/gh-mjungmath/clean_mutibility_code](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/clean_mutibility_code)",
    "created_at": "2021-01-07T14:50:09Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502572",
    "user": "https://github.com/mjungmath"
}
```

**Branch:** [u/gh-mjungmath/clean_mutibility_code](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/clean_mutibility_code)



---

archive/issue_comments_502573.json:
```json
{
    "body": "**Commit:** [aebc3f4fb9e0be8cbfc9fe01b5d94ae8c4a92fb7](https://github.com/sagemath/sagetrac-mirror/commit/aebc3f4fb9e0be8cbfc9fe01b5d94ae8c4a92fb7)",
    "created_at": "2021-01-07T14:51:02Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502573",
    "user": "https://github.com/mjungmath"
}
```

**Commit:** [aebc3f4fb9e0be8cbfc9fe01b5d94ae8c4a92fb7](https://github.com/sagemath/sagetrac-mirror/commit/aebc3f4fb9e0be8cbfc9fe01b5d94ae8c4a92fb7)



---

archive/issue_comments_502574.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable`. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for the manifolds module.\n+I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable`. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.\n``````\n",
    "created_at": "2021-01-07T14:51:02Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502574",
    "user": "https://github.com/mjungmath"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable`. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for the manifolds module.
+I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable`. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.
``````




---

archive/issue_comments_502575.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e918ad562206590220d0bc74d0389183dcf55cd\">2e918ad</a></td><td><code>Trac #31194: rename attribute</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aebc3f4fb9e0be8cbfc9fe01b5d94ae8c4a92fb7\">aebc3f4</a></td><td><code>Trac #31196: code improvements</code></td></tr></table>\n",
    "created_at": "2021-01-07T14:51:02Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502575",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e918ad562206590220d0bc74d0389183dcf55cd">2e918ad</a></td><td><code>Trac #31194: rename attribute</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aebc3f4fb9e0be8cbfc9fe01b5d94ae8c4a92fb7">aebc3f4</a></td><td><code>Trac #31196: code improvements</code></td></tr></table>




---

archive/issue_events_279632.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2021-01-07T14:51:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31196#event-279632"
}
```



---

archive/issue_comments_502576.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable`. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.\n+I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable` for flexibility. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.\n``````\n",
    "created_at": "2021-01-07T14:53:09Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502576",
    "user": "https://github.com/mjungmath"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable`. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.
+I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable` for flexibility. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.
``````




---

archive/issue_comments_502577.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable` for flexibility. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.\n+I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable` for flexibility. Furthermore, the error message is aligned with that from the method `_require_immutable` and in accordance with preexisting error messages of that kind, so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.\n``````\n",
    "created_at": "2021-01-07T15:01:06Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502577",
    "user": "https://github.com/mjungmath"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable` for flexibility. Furthermore, the error message is aligned with the method `_require_immutable` so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.
+I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable` for flexibility. Furthermore, the error message is aligned with that from the method `_require_immutable` and in accordance with preexisting error messages of that kind, so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.
``````




---

archive/issue_comments_502578.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc8f76b5bec041f17c26d4798fd462f03ef9d9c2\">cc8f76b</a></td><td><code>Trac #31196: code improvements</code></td></tr></table>\n",
    "created_at": "2021-01-07T15:03:30Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502578",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc8f76b5bec041f17c26d4798fd462f03ef9d9c2">cc8f76b</a></td><td><code>Trac #31196: code improvements</code></td></tr></table>




---

archive/issue_comments_502579.json:
```json
{
    "body": "**Changing commit** from \"[aebc3f4fb9e0be8cbfc9fe01b5d94ae8c4a92fb7](https://github.com/sagemath/sagetrac-mirror/commit/aebc3f4fb9e0be8cbfc9fe01b5d94ae8c4a92fb7)\" to \"[cc8f76b5bec041f17c26d4798fd462f03ef9d9c2](https://github.com/sagemath/sagetrac-mirror/commit/cc8f76b5bec041f17c26d4798fd462f03ef9d9c2)\".",
    "created_at": "2021-01-07T15:03:30Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502579",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[aebc3f4fb9e0be8cbfc9fe01b5d94ae8c4a92fb7](https://github.com/sagemath/sagetrac-mirror/commit/aebc3f4fb9e0be8cbfc9fe01b5d94ae8c4a92fb7)" to "[cc8f76b5bec041f17c26d4798fd462f03ef9d9c2](https://github.com/sagemath/sagetrac-mirror/commit/cc8f76b5bec041f17c26d4798fd462f03ef9d9c2)".



---

archive/issue_comments_502580.json:
```json
{
    "body": "**Changing commit** from \"[cc8f76b5bec041f17c26d4798fd462f03ef9d9c2](https://github.com/sagemath/sagetrac-mirror/commit/cc8f76b5bec041f17c26d4798fd462f03ef9d9c2)\" to \"[15720856853249d192eb56192ff589d3f88b1892](https://github.com/sagemath/sagetrac-mirror/commit/15720856853249d192eb56192ff589d3f88b1892)\".",
    "created_at": "2021-01-07T15:32:33Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502580",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[cc8f76b5bec041f17c26d4798fd462f03ef9d9c2](https://github.com/sagemath/sagetrac-mirror/commit/cc8f76b5bec041f17c26d4798fd462f03ef9d9c2)" to "[15720856853249d192eb56192ff589d3f88b1892](https://github.com/sagemath/sagetrac-mirror/commit/15720856853249d192eb56192ff589d3f88b1892)".



---

archive/issue_comments_502581.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15720856853249d192eb56192ff589d3f88b1892\">1572085</a></td><td><code>Trac #31196: if logic error</code></td></tr></table>\n",
    "created_at": "2021-01-07T15:32:33Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502581",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15720856853249d192eb56192ff589d3f88b1892">1572085</a></td><td><code>Trac #31196: if logic error</code></td></tr></table>




---

archive/issue_comments_502582.json:
```json
{
    "body": "<a id='comment:8'></a>\nAlternatively, one could ask for the **method** `is_immutable()` instead of the *attribute*? Then it wouldn't matter what happens behind the scenes, that's most flexible.",
    "created_at": "2021-01-07T21:43:07Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502582",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:8'></a>
Alternatively, one could ask for the **method** `is_immutable()` instead of the *attribute*? Then it wouldn't matter what happens behind the scenes, that's most flexible.



---

archive/issue_comments_502583.json:
```json
{
    "body": "<a id='comment:9'></a>\nI strongly think the attribute name should be standardized and not look for the choice between the two. This will not only be faster but easier to maintain.",
    "created_at": "2021-01-08T00:30:36Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502583",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>
I strongly think the attribute name should be standardized and not look for the choice between the two. This will not only be faster but easier to maintain.



---

archive/issue_comments_502584.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [tscrim](#comment%3A9):\n> I strongly think the attribute name should be standardized and not look for the choice between the two. This will not only be faster but easier to maintain.\n\n\nThat makes sense. What about this instead:\n\n> Alternatively, one could ask for the method is_immutable() instead of the attribute?\n\n\nThen, the method is standardized, which I would favorize.\n\nAnd what do you think about the change of error message?",
    "created_at": "2021-01-08T09:28:57Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502584",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:10'></a>
Replying to [tscrim](#comment%3A9):
> I strongly think the attribute name should be standardized and not look for the choice between the two. This will not only be faster but easier to maintain.


That makes sense. What about this instead:

> Alternatively, one could ask for the method is_immutable() instead of the attribute?


Then, the method is standardized, which I would favorize.

And what do you think about the change of error message?



---

archive/issue_comments_502585.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df9a54cd7cef639c2875487635706317979b3304\">df9a54c</a></td><td><code>Trac #31196: use \"is_immutable()\" + documentation</code></td></tr></table>\n",
    "created_at": "2021-01-08T10:11:20Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502585",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df9a54cd7cef639c2875487635706317979b3304">df9a54c</a></td><td><code>Trac #31196: use "is_immutable()" + documentation</code></td></tr></table>




---

archive/issue_comments_502586.json:
```json
{
    "body": "**Changing commit** from \"[15720856853249d192eb56192ff589d3f88b1892](https://github.com/sagemath/sagetrac-mirror/commit/15720856853249d192eb56192ff589d3f88b1892)\" to \"[df9a54cd7cef639c2875487635706317979b3304](https://github.com/sagemath/sagetrac-mirror/commit/df9a54cd7cef639c2875487635706317979b3304)\".",
    "created_at": "2021-01-08T10:11:20Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502586",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[15720856853249d192eb56192ff589d3f88b1892](https://github.com/sagemath/sagetrac-mirror/commit/15720856853249d192eb56192ff589d3f88b1892)" to "[df9a54cd7cef639c2875487635706317979b3304](https://github.com/sagemath/sagetrac-mirror/commit/df9a54cd7cef639c2875487635706317979b3304)".



---

archive/issue_comments_502587.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [git](#comment%3A11):\n> Branch pushed to git repo; I updated commit sha1. **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df9a54cd7cef639c2875487635706317979b3304\">df9a54c</a></td><td><code>Trac #31196: use \"is_immutable()\" + documentation</code></td></tr></table>\n\n\nI had something like this in mind...\n\nShould be even faster since `getattr` is completely avoided. Moreover, the error message is now much clearer if the object doesn't support mutability.",
    "created_at": "2021-01-08T10:14:48Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502587",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:12'></a>
Replying to [git](#comment%3A11):
> Branch pushed to git repo; I updated commit sha1. **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df9a54cd7cef639c2875487635706317979b3304">df9a54c</a></td><td><code>Trac #31196: use "is_immutable()" + documentation</code></td></tr></table>


I had something like this in mind...

Should be even faster since `getattr` is completely avoided. Moreover, the error message is now much clearer if the object doesn't support mutability.



---

archive/issue_comments_502588.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06b40bfcd0451da94249b73f46cdd29a70c7cb88\">06b40bf</a></td><td><code>Trac #31196: comment indirect doctest</code></td></tr></table>\n",
    "created_at": "2021-01-08T10:19:08Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502588",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06b40bfcd0451da94249b73f46cdd29a70c7cb88">06b40bf</a></td><td><code>Trac #31196: comment indirect doctest</code></td></tr></table>




---

archive/issue_comments_502589.json:
```json
{
    "body": "**Changing commit** from \"[df9a54cd7cef639c2875487635706317979b3304](https://github.com/sagemath/sagetrac-mirror/commit/df9a54cd7cef639c2875487635706317979b3304)\" to \"[06b40bfcd0451da94249b73f46cdd29a70c7cb88](https://github.com/sagemath/sagetrac-mirror/commit/06b40bfcd0451da94249b73f46cdd29a70c7cb88)\".",
    "created_at": "2021-01-08T10:19:08Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502589",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[df9a54cd7cef639c2875487635706317979b3304](https://github.com/sagemath/sagetrac-mirror/commit/df9a54cd7cef639c2875487635706317979b3304)" to "[06b40bfcd0451da94249b73f46cdd29a70c7cb88](https://github.com/sagemath/sagetrac-mirror/commit/06b40bfcd0451da94249b73f46cdd29a70c7cb88)".



---

archive/issue_comments_502590.json:
```json
{
    "body": "**Dependencies:** #31181",
    "created_at": "2021-01-08T10:20:16Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502590",
    "user": "https://github.com/mjungmath"
}
```

**Dependencies:** #31181



---

archive/issue_comments_502591.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable` for flexibility. Furthermore, the error message is aligned with that from the method `_require_immutable` and in accordance with preexisting error messages of that kind, so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.\n+I suggest some code improvements. For the decorator check, we require a method `\u00ecs_immutable()` to be implemented and avoid `getattr` completely. Furthermore, the error message is aligned with that from the method `_require_immutable` and in accordance with preexisting error messages of that kind, so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.\n``````\n",
    "created_at": "2021-01-08T10:21:23Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502591",
    "user": "https://github.com/mjungmath"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-I suggest some code improvements. For the decorator check, we should allow the attribute `_is_mutable` alongside with `_is_immutable` for flexibility. Furthermore, the error message is aligned with that from the method `_require_immutable` and in accordance with preexisting error messages of that kind, so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.
+I suggest some code improvements. For the decorator check, we require a method `Ã¬s_immutable()` to be implemented and avoid `getattr` completely. Furthermore, the error message is aligned with that from the method `_require_immutable` and in accordance with preexisting error messages of that kind, so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.
``````




---

archive/issue_comments_502592.json:
```json
{
    "body": "<a id='comment:16'></a>\nThe problem with this approach is that it will raise an attribute error if it is used on a class that does not implement an `is_immutable()` method. Although I mostly agree that it generally should if it is using this feature, but I could conceive of a reason why it wouldn't. I would say it is more likely that things will have some attribute to hold the mutability status than just a method to check it. Ultimately I would leave the check the way it currently is with somethign in the docstring stating that it is a requirement to use the decorator.\n\nI am not 100% convinced the error message is more clear, but I am okay with it (once you remove the trailing period).",
    "created_at": "2021-01-08T23:45:54Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502592",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>
The problem with this approach is that it will raise an attribute error if it is used on a class that does not implement an `is_immutable()` method. Although I mostly agree that it generally should if it is using this feature, but I could conceive of a reason why it wouldn't. I would say it is more likely that things will have some attribute to hold the mutability status than just a method to check it. Ultimately I would leave the check the way it currently is with somethign in the docstring stating that it is a requirement to use the decorator.

I am not 100% convinced the error message is more clear, but I am okay with it (once you remove the trailing period).



---

archive/issue_comments_502593.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [tscrim](#comment%3A16):\n> The problem with this approach is that it will raise an attribute error if it is used on a class that does not implement an `is_immutable()` method. Although I mostly agree that it generally should if it is using this feature, but I could conceive of a reason why it wouldn't. I would say it is more likely that things will have some attribute to hold the mutability status than just a method to check it. Ultimately I would leave the check the way it currently is with somethign in the docstring stating that it is a requirement to use the decorator.\n\n\nI don't get your point entirely. Is your `AttributeError` concern related only to the method or generally speaking? If it's related, I'd say we use the attribute only (even though I personally like methods more, because they are not interested in implementation details), drop the `getattr` (because it's faster) and raise an attribute error if that is not implemented. I think it should definitely raise an attribute error in cases where we cannot say whether the object is immutable or not. The decorator wouldn't make much sense in situations like this, same for the error message.\n\n> I am not 100% convinced the error message is more clear, but I am okay with it (once you remove the trailing period).\n\n\nAny ideas for a compromise? I think, from a developer's viewpoint, the original error message was more clear. But my plan, so far, is that this decorator should be used for the mutability checks in the manifold setting (after the pickling in #31182 had been solved).",
    "created_at": "2021-01-09T00:06:10Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502593",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:17'></a>
Replying to [tscrim](#comment%3A16):
> The problem with this approach is that it will raise an attribute error if it is used on a class that does not implement an `is_immutable()` method. Although I mostly agree that it generally should if it is using this feature, but I could conceive of a reason why it wouldn't. I would say it is more likely that things will have some attribute to hold the mutability status than just a method to check it. Ultimately I would leave the check the way it currently is with somethign in the docstring stating that it is a requirement to use the decorator.


I don't get your point entirely. Is your `AttributeError` concern related only to the method or generally speaking? If it's related, I'd say we use the attribute only (even though I personally like methods more, because they are not interested in implementation details), drop the `getattr` (because it's faster) and raise an attribute error if that is not implemented. I think it should definitely raise an attribute error in cases where we cannot say whether the object is immutable or not. The decorator wouldn't make much sense in situations like this, same for the error message.

> I am not 100% convinced the error message is more clear, but I am okay with it (once you remove the trailing period).


Any ideas for a compromise? I think, from a developer's viewpoint, the original error message was more clear. But my plan, so far, is that this decorator should be used for the mutability checks in the manifold setting (after the pickling in #31182 had been solved).



---

archive/issue_comments_502594.json:
```json
{
    "body": "<a id='comment:18'></a>\nFor the records, I suggested this change because of #31194, to avoid possible incompatibilites in case of slight variations in the implementation.",
    "created_at": "2021-01-09T00:45:26Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502594",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:18'></a>
For the records, I suggested this change because of #31194, to avoid possible incompatibilites in case of slight variations in the implementation.



---

archive/issue_comments_502595.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [gh-mjungmath](#comment%3A17):\n> Replying to [tscrim](#comment%3A16):\n> > The problem with this approach is that it will raise an attribute error if it is used on a class that does not implement an `is_immutable()` method. Although I mostly agree that it generally should if it is using this feature, but I could conceive of a reason why it wouldn't. I would say it is more likely that things will have some attribute to hold the mutability status than just a method to check it. Ultimately I would leave the check the way it currently is with something in the docstring stating that it is a requirement to use the decorator.\n\n> \n> I don't get your point entirely. Is your `AttributeError` concern related only to the method or generally speaking? If it's related, I'd say we use the attribute only (even though I personally like methods more, because they are not interested in implementation details), drop the `getattr` (because it's faster) and raise an attribute error if that is not implemented. I think it should definitely raise an attribute error in cases where we cannot say whether the object is immutable or not. The decorator wouldn't make much sense in situations like this, same for the error message.\n\n\nI don't understand this distinction you're trying to make. If you use this decorator with a method on a class that does not implement an `is_immutable` method, then you get an `AttributeError`. However, it is potentially reasonable for a class to add an attribute `_is_immutable` when it becomes immutable. I agree with your point on not depending on implementation details, but because we are trying to set the API for implementations, I feel like that is somewhat moot. There is also something to be said for having different error messages, but having more flexibility I think trumps this, although just barely.\n\n> > I am not 100% convinced the error message is more clear, but I am okay with it (once you remove the trailing period).\n\n> \n> Any ideas for a compromise? I think, from a developer's viewpoint, the original error message was more clear. But my plan, so far, is that this decorator should be used for the mutability checks in the manifold setting (after the pickling in #31182 had been solved).\n\n\nI would generally avoid the decorator and just directly call stuff. It is nearly the same amount of code. While it does make it slightly easier to refactor, it obfuscates the code mode and slows it down. This is good for the more casual user, but for production code, I would avoid the decorator in this case.",
    "created_at": "2021-01-09T01:07:59Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502595",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>
Replying to [gh-mjungmath](#comment%3A17):
> Replying to [tscrim](#comment%3A16):
> > The problem with this approach is that it will raise an attribute error if it is used on a class that does not implement an `is_immutable()` method. Although I mostly agree that it generally should if it is using this feature, but I could conceive of a reason why it wouldn't. I would say it is more likely that things will have some attribute to hold the mutability status than just a method to check it. Ultimately I would leave the check the way it currently is with something in the docstring stating that it is a requirement to use the decorator.

> 
> I don't get your point entirely. Is your `AttributeError` concern related only to the method or generally speaking? If it's related, I'd say we use the attribute only (even though I personally like methods more, because they are not interested in implementation details), drop the `getattr` (because it's faster) and raise an attribute error if that is not implemented. I think it should definitely raise an attribute error in cases where we cannot say whether the object is immutable or not. The decorator wouldn't make much sense in situations like this, same for the error message.


I don't understand this distinction you're trying to make. If you use this decorator with a method on a class that does not implement an `is_immutable` method, then you get an `AttributeError`. However, it is potentially reasonable for a class to add an attribute `_is_immutable` when it becomes immutable. I agree with your point on not depending on implementation details, but because we are trying to set the API for implementations, I feel like that is somewhat moot. There is also something to be said for having different error messages, but having more flexibility I think trumps this, although just barely.

> > I am not 100% convinced the error message is more clear, but I am okay with it (once you remove the trailing period).

> 
> Any ideas for a compromise? I think, from a developer's viewpoint, the original error message was more clear. But my plan, so far, is that this decorator should be used for the mutability checks in the manifold setting (after the pickling in #31182 had been solved).


I would generally avoid the decorator and just directly call stuff. It is nearly the same amount of code. While it does make it slightly easier to refactor, it obfuscates the code mode and slows it down. This is good for the more casual user, but for production code, I would avoid the decorator in this case.



---

archive/issue_comments_502596.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [tscrim](#comment%3A19):\n> ...\n\n\nAlright then. I thought it might be convenient. Too much thinking, eh? I'll just add a warning to make clear that such objects require a `_is_immutable` attribute.\n\nAs for the manifold code, I should switch to `_require_immutable` in `Mutability` instead?",
    "created_at": "2021-01-09T01:51:47Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502596",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:20'></a>
Replying to [tscrim](#comment%3A19):
> ...


Alright then. I thought it might be convenient. Too much thinking, eh? I'll just add a warning to make clear that such objects require a `_is_immutable` attribute.

As for the manifold code, I should switch to `_require_immutable` in `Mutability` instead?



---

archive/issue_comments_502597.json:
```json
{
    "body": "**Changing commit** from \"[06b40bfcd0451da94249b73f46cdd29a70c7cb88](https://github.com/sagemath/sagetrac-mirror/commit/06b40bfcd0451da94249b73f46cdd29a70c7cb88)\" to \"[4c3393509d75c6a040b312732a1801f190b88142](https://github.com/sagemath/sagetrac-mirror/commit/4c3393509d75c6a040b312732a1801f190b88142)\".",
    "created_at": "2021-01-09T13:05:44Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502597",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[06b40bfcd0451da94249b73f46cdd29a70c7cb88](https://github.com/sagemath/sagetrac-mirror/commit/06b40bfcd0451da94249b73f46cdd29a70c7cb88)" to "[4c3393509d75c6a040b312732a1801f190b88142](https://github.com/sagemath/sagetrac-mirror/commit/4c3393509d75c6a040b312732a1801f190b88142)".



---

archive/issue_comments_502598.json:
```json
{
    "body": "<a id='comment:21'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ecbf3a4896e2ccc10f3f16d4100e197de6a6fea\">5ecbf3a</a></td><td><code>Trac #31181: return added</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c3393509d75c6a040b312732a1801f190b88142\">4c33935</a></td><td><code>Trac #31196: minor code improvements, py3 compatibility, documentation improved</code></td></tr></table>\n",
    "created_at": "2021-01-09T13:05:44Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502598",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ecbf3a4896e2ccc10f3f16d4100e197de6a6fea">5ecbf3a</a></td><td><code>Trac #31181: return added</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c3393509d75c6a040b312732a1801f190b88142">4c33935</a></td><td><code>Trac #31196: minor code improvements, py3 compatibility, documentation improved</code></td></tr></table>




---

archive/issue_comments_502599.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-I suggest some code improvements. For the decorator check, we require a method `\u00ecs_immutable()` to be implemented and avoid `getattr` completely. Furthermore, the error message is aligned with that from the method `_require_immutable` and in accordance with preexisting error messages of that kind, so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.\n+I suggest some code improvements for the documentation, an additional method `_require_immutable` and Python 3 compatibility.\n``````\n",
    "created_at": "2021-01-09T13:12:42Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502599",
    "user": "https://github.com/mjungmath"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-I suggest some code improvements. For the decorator check, we require a method `Ã¬s_immutable()` to be implemented and avoid `getattr` completely. Furthermore, the error message is aligned with that from the method `_require_immutable` and in accordance with preexisting error messages of that kind, so that this decorator can conveniently and effortlessly be used for e.g. the manifolds module.
+I suggest some code improvements for the documentation, an additional method `_require_immutable` and Python 3 compatibility.
``````




---

archive/issue_comments_502600.json:
```json
{
    "body": "<a id='comment:22'></a>\nLike this?",
    "created_at": "2021-01-09T13:12:42Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502600",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:22'></a>
Like this?



---

archive/issue_comments_502601.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-I suggest some code improvements for the documentation, an additional method `_require_immutable` and Python 3 compatibility.\n+I suggest some code improvements for the documentation (adding a note that an attribute \u00e0 la `_is_immutable` is required to check immutability), an additional method `_require_immutable` (to require immutability in cases like hash functions) and Python 3 compatibility (using `format` instead of `%` as recommended in Python's doc).\n``````\n",
    "created_at": "2021-01-09T15:18:43Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502601",
    "user": "https://github.com/mjungmath"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-I suggest some code improvements for the documentation, an additional method `_require_immutable` and Python 3 compatibility.
+I suggest some code improvements for the documentation (adding a note that an attribute Ã  la `_is_immutable` is required to check immutability), an additional method `_require_immutable` (to require immutability in cases like hash functions) and Python 3 compatibility (using `format` instead of `%` as recommended in Python's doc).
``````




---

archive/issue_comments_502602.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [gh-mjungmath](#comment%3A22):\n> Like this?\n\n\nI think this is good overall. However I have one question and comment:\n\nWhy is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`? I think you need an `except -1` added too.",
    "created_at": "2021-01-10T12:56:15Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502602",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:24'></a>
Replying to [gh-mjungmath](#comment%3A22):
> Like this?


I think this is good overall. However I have one question and comment:

Why is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`? I think you need an `except -1` added too.



---

archive/issue_comments_502603.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [tscrim](#comment%3A24):\n> I think this is good overall. However I have one question and comment:\n> \n> Why is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`?\n\n\nI actually don't know. That was the setup I found there. Actually, due to #31182, I think it is better to make this class completely Pythonic. If there is a need for a Cythonic version, I suggest to introduce a `SageObjectWithMutability`. See my [ticket:31182#comment:12 comment].\n\n> I think you need an `except -1` too.\n\n\nWhat do you mean?",
    "created_at": "2021-01-10T15:18:56Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502603",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:25'></a>
Replying to [tscrim](#comment%3A24):
> I think this is good overall. However I have one question and comment:
> 
> Why is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`?


I actually don't know. That was the setup I found there. Actually, due to #31182, I think it is better to make this class completely Pythonic. If there is a need for a Cythonic version, I suggest to introduce a `SageObjectWithMutability`. See my [ticket:31182#comment:12 comment].

> I think you need an `except -1` too.


What do you mean?



---

archive/issue_comments_502604.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [gh-mjungmath](#comment%3A25):\n> Replying to [tscrim](#comment%3A24):\n> > I think this is good overall. However I have one question and comment:\n> > \n> > Why is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`?\n\n> \n> I actually don't know. That was the setup I found there. Actually, due to #31182, I think it is better to make this class completely Pythonic. If there is a need for a Cythonic version, I suggest to introduce a `SageObjectWithMutability`. See my [ticket:31182#comment:12 comment].\n\n\n-1 on this. I will comment on #31182 for more about this.\n\n> > I think you need an `except -1` too.\n\n> \n> What do you mean?\n\n\nhttps://cython.readthedocs.io/en/latest/src/userguide/language_basics.html#error-return-values",
    "created_at": "2021-01-12T00:14:32Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502604",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:26'></a>
Replying to [gh-mjungmath](#comment%3A25):
> Replying to [tscrim](#comment%3A24):
> > I think this is good overall. However I have one question and comment:
> > 
> > Why is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`?

> 
> I actually don't know. That was the setup I found there. Actually, due to #31182, I think it is better to make this class completely Pythonic. If there is a need for a Cythonic version, I suggest to introduce a `SageObjectWithMutability`. See my [ticket:31182#comment:12 comment].


-1 on this. I will comment on #31182 for more about this.

> > I think you need an `except -1` too.

> 
> What do you mean?


https://cython.readthedocs.io/en/latest/src/userguide/language_basics.html#error-return-values



---

archive/issue_comments_502605.json:
```json
{
    "body": "<a id='comment:27'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c805199394721b8957e88bebc79bffd9f319c856\">c805199</a></td><td><code>Trac #31196: minor code improvements, py3 compatibility, documentation improved</code></td></tr></table>\n",
    "created_at": "2021-01-17T19:39:40Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502605",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c805199394721b8957e88bebc79bffd9f319c856">c805199</a></td><td><code>Trac #31196: minor code improvements, py3 compatibility, documentation improved</code></td></tr></table>




---

archive/issue_comments_502606.json:
```json
{
    "body": "**Changing commit** from \"[4c3393509d75c6a040b312732a1801f190b88142](https://github.com/sagemath/sagetrac-mirror/commit/4c3393509d75c6a040b312732a1801f190b88142)\" to \"[c805199394721b8957e88bebc79bffd9f319c856](https://github.com/sagemath/sagetrac-mirror/commit/c805199394721b8957e88bebc79bffd9f319c856)\".",
    "created_at": "2021-01-17T19:39:40Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502606",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4c3393509d75c6a040b312732a1801f190b88142](https://github.com/sagemath/sagetrac-mirror/commit/4c3393509d75c6a040b312732a1801f190b88142)" to "[c805199394721b8957e88bebc79bffd9f319c856](https://github.com/sagemath/sagetrac-mirror/commit/c805199394721b8957e88bebc79bffd9f319c856)".



---

archive/issue_comments_502607.json:
```json
{
    "body": "<a id='comment:28'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ecbf3a4896e2ccc10f3f16d4100e197de6a6fea\">5ecbf3a</a></td><td><code>Trac #31181: return added</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c3393509d75c6a040b312732a1801f190b88142\">4c33935</a></td><td><code>Trac #31196: minor code improvements, py3 compatibility, documentation improved</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65110905c2f11bca8eedacffbca0c9b32786147e\">6511090</a></td><td><code>Trac #31196: cpdef require methods + except *</code></td></tr></table>\n",
    "created_at": "2021-01-17T19:54:42Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502607",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ecbf3a4896e2ccc10f3f16d4100e197de6a6fea">5ecbf3a</a></td><td><code>Trac #31181: return added</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c3393509d75c6a040b312732a1801f190b88142">4c33935</a></td><td><code>Trac #31196: minor code improvements, py3 compatibility, documentation improved</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65110905c2f11bca8eedacffbca0c9b32786147e">6511090</a></td><td><code>Trac #31196: cpdef require methods + except *</code></td></tr></table>




---

archive/issue_comments_502608.json:
```json
{
    "body": "**Changing commit** from \"[c805199394721b8957e88bebc79bffd9f319c856](https://github.com/sagemath/sagetrac-mirror/commit/c805199394721b8957e88bebc79bffd9f319c856)\" to \"[65110905c2f11bca8eedacffbca0c9b32786147e](https://github.com/sagemath/sagetrac-mirror/commit/65110905c2f11bca8eedacffbca0c9b32786147e)\".",
    "created_at": "2021-01-17T19:54:42Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502608",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c805199394721b8957e88bebc79bffd9f319c856](https://github.com/sagemath/sagetrac-mirror/commit/c805199394721b8957e88bebc79bffd9f319c856)" to "[65110905c2f11bca8eedacffbca0c9b32786147e](https://github.com/sagemath/sagetrac-mirror/commit/65110905c2f11bca8eedacffbca0c9b32786147e)".



---

archive/issue_comments_502609.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [tscrim](#comment%3A24):\n> Replying to [gh-mjungmath](#comment%3A22):\n> > Like this?\n\n> \n> I think this is good overall. However I have one question and comment:\n> \n> Why is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`? I think you need an `except -1` added too.\n\n\nIs that better? I think, the `except *` syntax is needed since these functions do not return anything.",
    "created_at": "2021-01-17T19:55:43Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502609",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:29'></a>
Replying to [tscrim](#comment%3A24):
> Replying to [gh-mjungmath](#comment%3A22):
> > Like this?

> 
> I think this is good overall. However I have one question and comment:
> 
> Why is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`? I think you need an `except -1` added too.


Is that better? I think, the `except *` syntax is needed since these functions do not return anything.



---

archive/issue_comments_502610.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [gh-mjungmath](#comment%3A29):\n> Replying to [tscrim](#comment%3A24):\n> > Replying to [gh-mjungmath](#comment%3A22):\n> > > Like this?\n\n> > \n> > I think this is good overall. However I have one question and comment:\n> > \n> > Why is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`? I think you need an `except -1` added too.\n\n> \n> Is that better? I think, the `except *` syntax is needed since these functions do not return anything.\n\n\nBuilt won't work: *Exception clause not allowed for function returning Python object*. You sure that the exception clause is needed here?",
    "created_at": "2021-01-17T20:15:03Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502610",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:30'></a>
Replying to [gh-mjungmath](#comment%3A29):
> Replying to [tscrim](#comment%3A24):
> > Replying to [gh-mjungmath](#comment%3A22):
> > > Like this?

> > 
> > I think this is good overall. However I have one question and comment:
> > 
> > Why is the `_require_immutable` not a `cpdef` method but instead a Python and `cdef`? I think you need an `except -1` added too.

> 
> Is that better? I think, the `except *` syntax is needed since these functions do not return anything.


Built won't work: *Exception clause not allowed for function returning Python object*. You sure that the exception clause is needed here?



---

archive/issue_comments_502611.json:
```json
{
    "body": "<a id='comment:31'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e5228d3b87529167876c09b693f498e636677d49\">e5228d3</a></td><td><code>Trac #31196: cpdef require methods + example added</code></td></tr></table>\n",
    "created_at": "2021-01-17T20:23:01Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502611",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e5228d3b87529167876c09b693f498e636677d49">e5228d3</a></td><td><code>Trac #31196: cpdef require methods + example added</code></td></tr></table>




---

archive/issue_comments_502612.json:
```json
{
    "body": "**Changing commit** from \"[65110905c2f11bca8eedacffbca0c9b32786147e](https://github.com/sagemath/sagetrac-mirror/commit/65110905c2f11bca8eedacffbca0c9b32786147e)\" to \"[e5228d3b87529167876c09b693f498e636677d49](https://github.com/sagemath/sagetrac-mirror/commit/e5228d3b87529167876c09b693f498e636677d49)\".",
    "created_at": "2021-01-17T20:23:01Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502612",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[65110905c2f11bca8eedacffbca0c9b32786147e](https://github.com/sagemath/sagetrac-mirror/commit/65110905c2f11bca8eedacffbca0c9b32786147e)" to "[e5228d3b87529167876c09b693f498e636677d49](https://github.com/sagemath/sagetrac-mirror/commit/e5228d3b87529167876c09b693f498e636677d49)".



---

archive/issue_comments_502613.json:
```json
{
    "body": "<a id='comment:32'></a>\nOkay, I added an example that works perfectly and improved the documentation incidentally. The except clause is apparently not needed.",
    "created_at": "2021-01-17T20:23:55Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502613",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:32'></a>
Okay, I added an example that works perfectly and improved the documentation incidentally. The except clause is apparently not needed.



---

archive/issue_comments_502614.json:
```json
{
    "body": "<a id='comment:33'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d957f73a5ac9ab8f198e9d6eb0a3cac266e5d8ba\">d957f73</a></td><td><code>Trac #31196: unnecessary line in docstring removed</code></td></tr></table>\n",
    "created_at": "2021-01-17T20:36:50Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502614",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d957f73a5ac9ab8f198e9d6eb0a3cac266e5d8ba">d957f73</a></td><td><code>Trac #31196: unnecessary line in docstring removed</code></td></tr></table>




---

archive/issue_comments_502615.json:
```json
{
    "body": "**Changing commit** from \"[e5228d3b87529167876c09b693f498e636677d49](https://github.com/sagemath/sagetrac-mirror/commit/e5228d3b87529167876c09b693f498e636677d49)\" to \"[d957f73a5ac9ab8f198e9d6eb0a3cac266e5d8ba](https://github.com/sagemath/sagetrac-mirror/commit/d957f73a5ac9ab8f198e9d6eb0a3cac266e5d8ba)\".",
    "created_at": "2021-01-17T20:36:50Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502615",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e5228d3b87529167876c09b693f498e636677d49](https://github.com/sagemath/sagetrac-mirror/commit/e5228d3b87529167876c09b693f498e636677d49)" to "[d957f73a5ac9ab8f198e9d6eb0a3cac266e5d8ba](https://github.com/sagemath/sagetrac-mirror/commit/d957f73a5ac9ab8f198e9d6eb0a3cac266e5d8ba)".



---

archive/issue_comments_502616.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2021-01-18T00:08:51Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502616",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_502617.json:
```json
{
    "body": "<a id='comment:34'></a>\nAh, it's fine because it doesn't have a return value (and hence returns `None`). Let's wait for the patchbot. If that is green, then positive review.",
    "created_at": "2021-01-18T00:08:51Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502617",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:34'></a>
Ah, it's fine because it doesn't have a return value (and hence returns `None`). Let's wait for the patchbot. If that is green, then positive review.



---

archive/issue_comments_502618.json:
```json
{
    "body": "<a id='comment:35'></a>\nAlso, while it is technically not your responsibility since it existed previously, it would be good add docstrings and tests to all methods, including `cpdef` ones.",
    "created_at": "2021-01-18T09:27:37Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502618",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:35'></a>
Also, while it is technically not your responsibility since it existed previously, it would be good add docstrings and tests to all methods, including `cpdef` ones.



---

archive/issue_comments_502619.json:
```json
{
    "body": "**Changing commit** from \"[d957f73a5ac9ab8f198e9d6eb0a3cac266e5d8ba](https://github.com/sagemath/sagetrac-mirror/commit/d957f73a5ac9ab8f198e9d6eb0a3cac266e5d8ba)\" to \"[b9f3c2837df1fb8d72221e855c87de75058d548e](https://github.com/sagemath/sagetrac-mirror/commit/b9f3c2837df1fb8d72221e855c87de75058d548e)\".",
    "created_at": "2021-01-18T09:51:23Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502619",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d957f73a5ac9ab8f198e9d6eb0a3cac266e5d8ba](https://github.com/sagemath/sagetrac-mirror/commit/d957f73a5ac9ab8f198e9d6eb0a3cac266e5d8ba)" to "[b9f3c2837df1fb8d72221e855c87de75058d548e](https://github.com/sagemath/sagetrac-mirror/commit/b9f3c2837df1fb8d72221e855c87de75058d548e)".



---

archive/issue_comments_502620.json:
```json
{
    "body": "<a id='comment:36'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9f3c2837df1fb8d72221e855c87de75058d548e\">b9f3c28</a></td><td><code>Trac #31196: coverage</code></td></tr></table>\n",
    "created_at": "2021-01-18T09:51:23Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502620",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9f3c2837df1fb8d72221e855c87de75058d548e">b9f3c28</a></td><td><code>Trac #31196: coverage</code></td></tr></table>




---

archive/issue_comments_502621.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [tscrim](#comment%3A35):\n> Also, while it is technically not your responsibility since it existed previously, it would be good add docstrings and tests to all methods, including `cpdef` ones.\n\n\nDone.",
    "created_at": "2021-01-18T09:58:23Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502621",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:37'></a>
Replying to [tscrim](#comment%3A35):
> Also, while it is technically not your responsibility since it existed previously, it would be good add docstrings and tests to all methods, including `cpdef` ones.


Done.



---

archive/issue_comments_502622.json:
```json
{
    "body": "<a id='comment:38'></a>\nPatchbot is satisfied. :)",
    "created_at": "2021-01-18T21:41:17Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502622",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:38'></a>
Patchbot is satisfied. :)



---

archive/issue_comments_502623.json:
```json
{
    "body": "<a id='comment:39'></a>\nThank you. LGTM.",
    "created_at": "2021-01-20T06:03:24Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502623",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:39'></a>
Thank you. LGTM.



---

archive/issue_events_279633.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-01-20T06:03:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31196#event-279633"
}
```



---

archive/issue_events_279634.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-01-20T06:03:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31196#event-279634"
}
```



---

archive/issue_comments_502624.json:
```json
{
    "body": "<a id='comment:40'></a>\nThanks for the review!",
    "created_at": "2021-01-20T09:45:39Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502624",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:40'></a>
Thanks for the review!



---

archive/issue_comments_502625.json:
```json
{
    "body": "**Changing branch** from \"[u/gh-mjungmath/clean_mutibility_code](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/clean_mutibility_code)\" to \"[b9f3c2837df1fb8d72221e855c87de75058d548e](https://github.com/sagemath/sagetrac-mirror/commit/b9f3c2837df1fb8d72221e855c87de75058d548e)\".",
    "created_at": "2021-01-31T20:53:38Z",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31196#issuecomment-502625",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/gh-mjungmath/clean_mutibility_code](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/clean_mutibility_code)" to "[b9f3c2837df1fb8d72221e855c87de75058d548e](https://github.com/sagemath/sagetrac-mirror/commit/b9f3c2837df1fb8d72221e855c87de75058d548e)".



---

archive/issue_events_279635.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-01-31T20:53:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31196#event-279635"
}
```



---

archive/issue_events_279636.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-01-31T20:53:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31196",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31196#event-279636"
}
```
