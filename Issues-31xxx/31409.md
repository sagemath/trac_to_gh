# Issue 31409: Make it possible to disable build of r, rpy2 using ./configure --disable-r

archive/issues_031172.json:
```json
{
    "assignees": [],
    "body": "Prompted by a build failure of `r` on `cygwin-standard` in  https://github.com/mkoeppe/sage/runs/1915093157\n\n```\n  [r-3.6.3]   blas.o: in function `dsymm_':\n  [r-3.6.3]   /opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/var/tmp/sage/build/r-3.6.3/src/src/extra/blas/blas.f:2986:(.text+0x4352): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `xerbla_'\n```\nwe make it possible to disable R using a configure options so that one can get a working Sage installation in this way.\n\n(The original build failure has hopefully resolved been resolved by #29537.)\n\nPrevious tickets and discussions:\n- #29486\n- #29441\n- #29170\n- \u200bhttps://groups.google.com/g/sage-devel/c/IX3niEdmCEM/m/LovmF6gmIwAJ\n- https://wiki.sagemath.org/ReleaseTours/sage-9.2#rpy2_and_R\n- https://groups.google.com/g/sage-devel/c/alkG4veIsBk/m/432cxzpYAQAJ\n\nDepends on #29537\nDepends on #30383\n\nCC:  @embray @dimpase @orlitzky @jhpalmieri @kiwifb @novoselt @EmmanuelCharpentier @videlec @kliem\n\nBranch/Commit: **[`f04c134`](https://github.com/sagemath/sagetrac-mirror/commit/f04c13484c85c5d07e76cc9f306e70553fc74c6c)**\n\nReviewer: **Fran\u00e7ois Bissey, John Palmieri**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **porting: Cygwin**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31409_\n\n",
    "closed_at": "2021-04-02T15:42:50Z",
    "created_at": "2021-02-17T01:53:49Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20cygwin",
        "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make it possible to disable build of r, rpy2 using ./configure --disable-r",
    "type": "issue",
    "updated_at": "2021-04-02T15:42:50Z",
    "url": "https://github.com/sagemath/sage/issues/31409",
    "user": "https://github.com/mkoeppe"
}
```
Prompted by a build failure of `r` on `cygwin-standard` in  https://github.com/mkoeppe/sage/runs/1915093157

```
  [r-3.6.3]   blas.o: in function `dsymm_':
  [r-3.6.3]   /opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/var/tmp/sage/build/r-3.6.3/src/src/extra/blas/blas.f:2986:(.text+0x4352): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `xerbla_'
```
we make it possible to disable R using a configure options so that one can get a working Sage installation in this way.

(The original build failure has hopefully resolved been resolved by #29537.)

Previous tickets and discussions:
- #29486
- #29441
- #29170
- ​https://groups.google.com/g/sage-devel/c/IX3niEdmCEM/m/LovmF6gmIwAJ
- https://wiki.sagemath.org/ReleaseTours/sage-9.2#rpy2_and_R
- https://groups.google.com/g/sage-devel/c/alkG4veIsBk/m/432cxzpYAQAJ

Depends on #29537
Depends on #30383

CC:  @embray @dimpase @orlitzky @jhpalmieri @kiwifb @novoselt @EmmanuelCharpentier @videlec @kliem

Branch/Commit: **[`f04c134`](https://github.com/sagemath/sagetrac-mirror/commit/f04c13484c85c5d07e76cc9f306e70553fc74c6c)**

Reviewer: **François Bissey, John Palmieri**

Author: **Matthias Koeppe**

Component: **porting: Cygwin**

_Issue created by migration from https://trac.sagemath.org/ticket/31409_





---

archive/issue_events_435080.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-17T01:53:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435080"
}
```



---

archive/issue_events_435081.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-17T01:53:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20cygwin",
    "label_color": "000080",
    "label_name": "c: porting: cygwin",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435081"
}
```



---

archive/issue_events_435082.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-17T01:53:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435082"
}
```



---

archive/issue_events_435083.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-17T01:53:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435083"
}
```



---

archive/issue_events_435084.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-17T02:34:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435084"
}
```



---

archive/issue_events_435085.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-17T02:34:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435085"
}
```



---

archive/issue_comments_504199.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAgain we have a problem with `r`. As `cygwin` is one of our supported platforms and `r` is a standard package, this is a blocker.\n\n(More problems with R are around the corner, for wheel builds of Sage - #31396.)\n\n\nThis justifies another round of discussion for the proposal to downgrade the `r` and `rpy2` to \"optional\" packages - after #29486, #29170, https://groups.google.com/g/sage-devel/c/IX3niEdmCEM/m/LovmF6gmIwAJ\n\nIn #29170, @novoselt pointed out that supporting R is important for SageMathCell; and @kiwifb mentioned that \"Suddenly dropping R/rpy2 feels rough. However, we don't have usage data to know how rough it would be.\"\n\nI think that we do need a bit of substantiation here given to make the case of keeping R supported as a standard package - and its cost of maintenance. Note that our R is also nontrivially patched and an update to the 4.x series is overdue, and nobody has stepped up to do this upgrade.",
    "created_at": "2021-02-17T02:34:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504199",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:1" align="right">comment:1</div>

Again we have a problem with `r`. As `cygwin` is one of our supported platforms and `r` is a standard package, this is a blocker.

(More problems with R are around the corner, for wheel builds of Sage - #31396.)


This justifies another round of discussion for the proposal to downgrade the `r` and `rpy2` to "optional" packages - after #29486, #29170, https://groups.google.com/g/sage-devel/c/IX3niEdmCEM/m/LovmF6gmIwAJ

In #29170, @novoselt pointed out that supporting R is important for SageMathCell; and @kiwifb mentioned that "Suddenly dropping R/rpy2 feels rough. However, we don't have usage data to know how rough it would be."

I think that we do need a bit of substantiation here given to make the case of keeping R supported as a standard package - and its cost of maintenance. Note that our R is also nontrivially patched and an update to the 4.x series is overdue, and nobody has stepped up to do this upgrade.



---

archive/issue_events_435086.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-17T02:34:36Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "title_is": "cygwin-standard: r build fails ... downgrade r, rpy2 to optional",
    "title_was": "cygwin-standard: r build fails",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435086"
}
```



---

archive/issue_comments_504200.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nMaybe this is asking for a new type of package: standard on some platforms, optional on others.\n\nI have been \"using\" the system's R for a while now (\"using\" mean that Sage doesn't build it, not that I actually use it for anything). Can we distribute binaries that will use a system R installation? (Maybe this is a bad question, because at least on OS X, can we distribute functioning binaries in the first place?)",
    "created_at": "2021-02-17T03:00:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504200",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:2" align="right">comment:2</div>

Maybe this is asking for a new type of package: standard on some platforms, optional on others.

I have been "using" the system's R for a while now ("using" mean that Sage doesn't build it, not that I actually use it for anything). Can we distribute binaries that will use a system R installation? (Maybe this is a bad question, because at least on OS X, can we distribute functioning binaries in the first place?)



---

archive/issue_comments_504201.json:
```json
{
    "body": "Branch: **[u/mkoeppe/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional)**",
    "created_at": "2021-02-17T04:37:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504201",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional)**



---

archive/issue_comments_504202.json:
```json
{
    "body": "Commit: **[`b2d4ab8`](https://github.com/sagemath/sagetrac-mirror/commit/b2d4ab86a81e57303e911ccfff55a4d331c3145a)**",
    "created_at": "2021-02-17T04:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504202",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`b2d4ab8`](https://github.com/sagemath/sagetrac-mirror/commit/b2d4ab86a81e57303e911ccfff55a4d331c3145a)**



---

archive/issue_comments_504203.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nrpy2 3.4.x has wheels for macOS - https://pypi.org/project/rpy2/#files\n\nWe should find out with what installation of R these wheels are supposed to work - hopefully R's official binary packages that are on CRAN - see https://mirror.las.iastate.edu/CRAN/\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b2d4ab86a81e57303e911ccfff55a4d331c3145a\"><code>b2d4ab8</code></a></td><td><code>build/pkgs/{r,rpy2}: Downgrade to optional</code></td></tr></table>\n",
    "created_at": "2021-02-17T04:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504203",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:4" align="right">comment:4</div>

rpy2 3.4.x has wheels for macOS - https://pypi.org/project/rpy2/#files

We should find out with what installation of R these wheels are supposed to work - hopefully R's official binary packages that are on CRAN - see https://mirror.las.iastate.edu/CRAN/

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b2d4ab86a81e57303e911ccfff55a4d331c3145a"><code>b2d4ab8</code></a></td><td><code>build/pkgs/{r,rpy2}: Downgrade to optional</code></td></tr></table>




---

archive/issue_comments_504204.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@jhpalmieri](#comment:2):\n> (Maybe this is a bad question, because at least on OS X, can we distribute functioning binaries in the first place?)\n\nBinaries have been broken for a long time. I would be in favor of just following Dima's current practice of directing people to just use conda.",
    "created_at": "2021-02-17T05:00:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504204",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@jhpalmieri](#comment:2):
> (Maybe this is a bad question, because at least on OS X, can we distribute functioning binaries in the first place?)

Binaries have been broken for a long time. I would be in favor of just following Dima's current practice of directing people to just use conda.



---

archive/issue_comments_504205.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2021-02-17T17:35:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504205",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_events_435087.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-17T17:35:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435087"
}
```



---

archive/issue_comments_504206.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI am fine with that. But at the very least most of the doctests in `sage/interface/r.py` have to be marked optional. I haven't checked for import of `rpy` at this stage.",
    "created_at": "2021-02-17T18:48:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504206",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:7" align="right">comment:7</div>

I am fine with that. But at the very least most of the doctests in `sage/interface/r.py` have to be marked optional. I haven't checked for import of `rpy` at this stage.



---

archive/issue_comments_504207.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\n`sage/stats/r.py` relies on R being present. All doctests in there should be optional.",
    "created_at": "2021-02-17T20:29:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504207",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:8" align="right">comment:8</div>

`sage/stats/r.py` relies on R being present. All doctests in there should be optional.



---

archive/issue_comments_504208.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThere are two doctests in `sage/repl/ipython_tests.py` that run R.\n\nTests for `_r_init_` in `sage/structure/sage_object.pyx`, I note interfaces for other optional packages (octave, mathematica, polymake...) do not have tests.\n\nThat's all that I can see and think of right now.",
    "created_at": "2021-02-17T20:37:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504208",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:9" align="right">comment:9</div>

There are two doctests in `sage/repl/ipython_tests.py` that run R.

Tests for `_r_init_` in `sage/structure/sage_object.pyx`, I note interfaces for other optional packages (octave, mathematica, polymake...) do not have tests.

That's all that I can see and think of right now.



---

archive/issue_comments_504209.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nInstead of adding an optional tag to all doctests in these files, perhaps we should go through #30778.",
    "created_at": "2021-02-17T21:37:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504209",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

Instead of adding an optional tag to all doctests in these files, perhaps we should go through #30778.



---

archive/issue_comments_504210.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nYes, that would be the right way to go. In the spirit of splitting, r interface stuff should be splitted in its own package eventually. I guess it is now tagged \"early candidate\".",
    "created_at": "2021-02-17T22:57:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504210",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:11" align="right">comment:11</div>

Yes, that would be the right way to go. In the spirit of splitting, r interface stuff should be splitted in its own package eventually. I guess it is now tagged "early candidate".



---

archive/issue_comments_504211.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI have reduced #30778 to a more modest version that just handles \"optional\" tags as file directives instead of using \"sage_setup: distribution\" tags.",
    "created_at": "2021-02-18T00:50:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504211",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

I have reduced #30778 to a more modest version that just handles "optional" tags as file directives instead of using "sage_setup: distribution" tags.



---

archive/issue_comments_504212.json:
```json
{
    "body": "Changed commit from **[`b2d4ab8`](https://github.com/sagemath/sagetrac-mirror/commit/b2d4ab86a81e57303e911ccfff55a4d331c3145a)** to **[`8732076`](https://github.com/sagemath/sagetrac-mirror/commit/8732076b9ba7c01619c2904013997f6f85529115)**",
    "created_at": "2021-02-18T22:47:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504212",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b2d4ab8`](https://github.com/sagemath/sagetrac-mirror/commit/b2d4ab86a81e57303e911ccfff55a4d331c3145a)** to **[`8732076`](https://github.com/sagemath/sagetrac-mirror/commit/8732076b9ba7c01619c2904013997f6f85529115)**



---

archive/issue_comments_504213.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8732076b9ba7c01619c2904013997f6f85529115\"><code>8732076</code></a></td><td><code>src/sage/repl/ipython_tests.py: Mark R interface tests # optional - rpy2</code></td></tr></table>\n",
    "created_at": "2021-02-18T22:47:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504213",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8732076b9ba7c01619c2904013997f6f85529115"><code>8732076</code></a></td><td><code>src/sage/repl/ipython_tests.py: Mark R interface tests # optional - rpy2</code></td></tr></table>




---

archive/issue_comments_504214.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dbdf084cda2175c4d770169af8a45c58ab65c8fa\"><code>dbdf084</code></a></td><td><code>src/sage/structure/sage_object.pyx: Mark R interface test # optional - rpy2</code></td></tr></table>\n",
    "created_at": "2021-02-18T22:49:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504214",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dbdf084cda2175c4d770169af8a45c58ab65c8fa"><code>dbdf084</code></a></td><td><code>src/sage/structure/sage_object.pyx: Mark R interface test # optional - rpy2</code></td></tr></table>




---

archive/issue_comments_504215.json:
```json
{
    "body": "Changed commit from **[`8732076`](https://github.com/sagemath/sagetrac-mirror/commit/8732076b9ba7c01619c2904013997f6f85529115)** to **[`dbdf084`](https://github.com/sagemath/sagetrac-mirror/commit/dbdf084cda2175c4d770169af8a45c58ab65c8fa)**",
    "created_at": "2021-02-18T22:49:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504215",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8732076`](https://github.com/sagemath/sagetrac-mirror/commit/8732076b9ba7c01619c2904013997f6f85529115)** to **[`dbdf084`](https://github.com/sagemath/sagetrac-mirror/commit/dbdf084cda2175c4d770169af8a45c58ab65c8fa)**



---

archive/issue_comments_504216.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/737b21caeeeaa6616c7e25e80aecac8841dbf6e2\"><code>737b21c</code></a></td><td><code>src/sage/stats/r.py: Mark all 2 doctests in this file as # optional - rpy2</code></td></tr></table>\n",
    "created_at": "2021-02-18T22:51:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504216",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/737b21caeeeaa6616c7e25e80aecac8841dbf6e2"><code>737b21c</code></a></td><td><code>src/sage/stats/r.py: Mark all 2 doctests in this file as # optional - rpy2</code></td></tr></table>




---

archive/issue_comments_504217.json:
```json
{
    "body": "Changed commit from **[`dbdf084`](https://github.com/sagemath/sagetrac-mirror/commit/dbdf084cda2175c4d770169af8a45c58ab65c8fa)** to **[`737b21c`](https://github.com/sagemath/sagetrac-mirror/commit/737b21caeeeaa6616c7e25e80aecac8841dbf6e2)**",
    "created_at": "2021-02-18T22:51:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504217",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dbdf084`](https://github.com/sagemath/sagetrac-mirror/commit/dbdf084cda2175c4d770169af8a45c58ab65c8fa)** to **[`737b21c`](https://github.com/sagemath/sagetrac-mirror/commit/737b21caeeeaa6616c7e25e80aecac8841dbf6e2)**



---

archive/issue_comments_504218.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/440392440805bbdf01d42e3d5f487d61231aaabf\"><code>4403924</code></a></td><td><code>src/sage/interfaces/r.py: Mark all tests # optional - rpy2</code></td></tr></table>\n",
    "created_at": "2021-02-18T23:22:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504218",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/440392440805bbdf01d42e3d5f487d61231aaabf"><code>4403924</code></a></td><td><code>src/sage/interfaces/r.py: Mark all tests # optional - rpy2</code></td></tr></table>




---

archive/issue_comments_504219.json:
```json
{
    "body": "Changed commit from **[`737b21c`](https://github.com/sagemath/sagetrac-mirror/commit/737b21caeeeaa6616c7e25e80aecac8841dbf6e2)** to **[`4403924`](https://github.com/sagemath/sagetrac-mirror/commit/440392440805bbdf01d42e3d5f487d61231aaabf)**",
    "created_at": "2021-02-18T23:22:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504219",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`737b21c`](https://github.com/sagemath/sagetrac-mirror/commit/737b21caeeeaa6616c7e25e80aecac8841dbf6e2)** to **[`4403924`](https://github.com/sagemath/sagetrac-mirror/commit/440392440805bbdf01d42e3d5f487d61231aaabf)**



---

archive/issue_comments_504220.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nBecause #30778 appears to be controversial, for the present ticket I have just added the line by line optional tags.  Ready for review.",
    "created_at": "2021-02-18T23:23:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504220",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">comment:17</div>

Because #30778 appears to be controversial, for the present ticket I have just added the line by line optional tags.  Ready for review.



---

archive/issue_comments_504221.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@mkoeppe](#comment:17):\n> Because #30778 appears to be controversial, for the present ticket I have just added the line by line optional tags.  Ready for review.\n> \n\nI feel your pain. Having to do that is kind of terrible. Further checking will have to be with the bots. Let's go with the positive review now.",
    "created_at": "2021-02-18T23:29:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504221",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@mkoeppe](#comment:17):
> Because #30778 appears to be controversial, for the present ticket I have just added the line by line optional tags.  Ready for review.
> 

I feel your pain. Having to do that is kind of terrible. Further checking will have to be with the bots. Let's go with the positive review now.



---

archive/issue_comments_504222.json:
```json
{
    "body": "Reviewer: **Fran\u00e7ois Bissey**",
    "created_at": "2021-02-18T23:29:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504222",
    "user": "https://github.com/kiwifb"
}
```

Reviewer: **François Bissey**



---

archive/issue_events_435088.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2021-02-18T23:29:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435088"
}
```



---

archive/issue_events_435089.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2021-02-18T23:29:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435089"
}
```



---

archive/issue_comments_504223.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThank you!",
    "created_at": "2021-02-18T23:30:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504223",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

Thank you!



---

archive/issue_comments_504224.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nLooks like there are a few more files with R tests (https://github.com/mkoeppe/sage/runs/1942659778):\n\n- src/doc/en/prep/Quickstarts/Statistics-and-Distributions.rst\n- src/sage/interfaces/interface.py\n- src/sage/misc/sageinspect.py",
    "created_at": "2021-02-21T06:51:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504224",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

Looks like there are a few more files with R tests (https://github.com/mkoeppe/sage/runs/1942659778):

- src/doc/en/prep/Quickstarts/Statistics-and-Distributions.rst
- src/sage/interfaces/interface.py
- src/sage/misc/sageinspect.py



---

archive/issue_events_435090.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-21T06:51:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435090"
}
```



---

archive/issue_events_435091.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-21T06:51:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435091"
}
```



---

archive/issue_comments_504225.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/405ebb976c6c8ccffd5b5350f1c7ec660301d797\"><code>405ebb9</code></a></td><td><code>More # optional - rpy2</code></td></tr></table>\n",
    "created_at": "2021-02-21T17:48:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504225",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/405ebb976c6c8ccffd5b5350f1c7ec660301d797"><code>405ebb9</code></a></td><td><code>More # optional - rpy2</code></td></tr></table>




---

archive/issue_comments_504226.json:
```json
{
    "body": "Changed commit from **[`4403924`](https://github.com/sagemath/sagetrac-mirror/commit/440392440805bbdf01d42e3d5f487d61231aaabf)** to **[`405ebb9`](https://github.com/sagemath/sagetrac-mirror/commit/405ebb976c6c8ccffd5b5350f1c7ec660301d797)**",
    "created_at": "2021-02-21T17:48:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504226",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4403924`](https://github.com/sagemath/sagetrac-mirror/commit/440392440805bbdf01d42e3d5f487d61231aaabf)** to **[`405ebb9`](https://github.com/sagemath/sagetrac-mirror/commit/405ebb976c6c8ccffd5b5350f1c7ec660301d797)**



---

archive/issue_events_435092.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-21T17:50:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435092"
}
```



---

archive/issue_events_435093.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-21T17:50:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435093"
}
```



---

archive/issue_comments_504227.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nRight, those were more difficult to spot since they rely on the fact that the R interface is automatically imported in `sage/interfaces/all.py`. That run should have got all of them.",
    "created_at": "2021-02-21T19:03:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504227",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:23" align="right">comment:23</div>

Right, those were more difficult to spot since they rely on the fact that the R interface is automatically imported in `sage/interfaces/all.py`. That run should have got all of them.



---

archive/issue_events_435094.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2021-02-21T19:03:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435094"
}
```



---

archive/issue_events_435095.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2021-02-21T19:03:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435095"
}
```



---

archive/issue_comments_504228.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThanks! I also just ran `make ptestlong-nodoc` and there are no more errors.",
    "created_at": "2021-02-21T19:14:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504228",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

Thanks! I also just ran `make ptestlong-nodoc` and there are no more errors.



---

archive/issue_comments_504229.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nIf addition of standard packages requires a mention on sage-devel then IMHO removal should, too...\n\nAlso, doesn't pass the testsuite:\n\n```\n**********************************************************************\nFile \"src/sage/repl/interpreter.py\", line 242, in sage.repl.interpreter.SageShellOverride.system_raw\nFailed example:\n    shell.system_raw('R --version')\nExpected:\n    R version ...\nGot:\n    /bin/sh: 1: R: not found\n**********************************************************************\nFile \"src/sage/repl/interpreter.py\", line 244, in sage.repl.interpreter.SageShellOverride.system_raw\nFailed example:\n    shell.user_ns['_exit_code']\nExpected:\n    0\nGot:\n    127\n**********************************************************************\n1 item had failures:\n   2 of  10 in sage.repl.interpreter.SageShellOverride.system_raw\n    [141 tests, 2 failures, 3.57 s]\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 578, in sage.tests.cmdline.test_executable\nFailed example:\n    out.find(\"R version \") >= 0\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 580, in sage.tests.cmdline.test_executable\nFailed example:\n    err\nExpected:\n    ''\nGot:\n    '/home/buildbot/slave/sage_git/build/src/bin/sage: line 627: exec: R: not found\\n'\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 582, in sage.tests.cmdline.test_executable\nFailed example:\n    ret\nExpected:\n    0\nGot:\n    127\n**********************************************************************\n1 item had failures:\n   3 of 231 in sage.tests.cmdline.test_executable\n    [230 tests, 3 failures, 29.96 s]\n----------------------------------------------------------------------\nsage -t --long --random-seed=0 src/sage/repl/interpreter.py  # 2 doctests failed\nsage -t --long --random-seed=0 src/sage/tests/cmdline.py  # 3 doctests failed\n----------------------------------------------------------------------\n```",
    "created_at": "2021-03-07T11:24:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504229",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:25" align="right">comment:25</div>

If addition of standard packages requires a mention on sage-devel then IMHO removal should, too...

Also, doesn't pass the testsuite:

```
**********************************************************************
File "src/sage/repl/interpreter.py", line 242, in sage.repl.interpreter.SageShellOverride.system_raw
Failed example:
    shell.system_raw('R --version')
Expected:
    R version ...
Got:
    /bin/sh: 1: R: not found
**********************************************************************
File "src/sage/repl/interpreter.py", line 244, in sage.repl.interpreter.SageShellOverride.system_raw
Failed example:
    shell.user_ns['_exit_code']
Expected:
    0
Got:
    127
**********************************************************************
1 item had failures:
   2 of  10 in sage.repl.interpreter.SageShellOverride.system_raw
    [141 tests, 2 failures, 3.57 s]
**********************************************************************
File "src/sage/tests/cmdline.py", line 578, in sage.tests.cmdline.test_executable
Failed example:
    out.find("R version ") >= 0
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/tests/cmdline.py", line 580, in sage.tests.cmdline.test_executable
Failed example:
    err
Expected:
    ''
Got:
    '/home/buildbot/slave/sage_git/build/src/bin/sage: line 627: exec: R: not found\n'
**********************************************************************
File "src/sage/tests/cmdline.py", line 582, in sage.tests.cmdline.test_executable
Failed example:
    ret
Expected:
    0
Got:
    127
**********************************************************************
1 item had failures:
   3 of 231 in sage.tests.cmdline.test_executable
    [230 tests, 3 failures, 29.96 s]
----------------------------------------------------------------------
sage -t --long --random-seed=0 src/sage/repl/interpreter.py  # 2 doctests failed
sage -t --long --random-seed=0 src/sage/tests/cmdline.py  # 3 doctests failed
----------------------------------------------------------------------
```



---

archive/issue_events_435096.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-07T11:24:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435096"
}
```



---

archive/issue_events_435097.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-07T11:24:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435097"
}
```



---

archive/issue_comments_504230.json:
```json
{
    "body": "Changed commit from **[`405ebb9`](https://github.com/sagemath/sagetrac-mirror/commit/405ebb976c6c8ccffd5b5350f1c7ec660301d797)** to **[`ce3b35f`](https://github.com/sagemath/sagetrac-mirror/commit/ce3b35fea3326528936af448d006119e6405626f)**",
    "created_at": "2021-03-07T23:16:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504230",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`405ebb9`](https://github.com/sagemath/sagetrac-mirror/commit/405ebb976c6c8ccffd5b5350f1c7ec660301d797)** to **[`ce3b35f`](https://github.com/sagemath/sagetrac-mirror/commit/ce3b35fea3326528936af448d006119e6405626f)**



---

archive/issue_comments_504231.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b7c157665b738e2f54a6bf217c0114c4180f7df9\"><code>b7c1576</code></a></td><td><code>Merge tag '9.3.beta8' into t/31409/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce3b35fea3326528936af448d006119e6405626f\"><code>ce3b35f</code></a></td><td><code>More # optional - r</code></td></tr></table>\n",
    "created_at": "2021-03-07T23:16:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504231",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b7c157665b738e2f54a6bf217c0114c4180f7df9"><code>b7c1576</code></a></td><td><code>Merge tag '9.3.beta8' into t/31409/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce3b35fea3326528936af448d006119e6405626f"><code>ce3b35f</code></a></td><td><code>More # optional - r</code></td></tr></table>




---

archive/issue_events_435098.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-07T23:17:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435098"
}
```



---

archive/issue_events_435099.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-07T23:17:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435099"
}
```



---

archive/issue_comments_504232.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@vbraun](#comment:25):\n> If addition of standard packages requires a mention on sage-devel then IMHO removal should, too...\n\nI think this is a good point.",
    "created_at": "2021-03-07T23:51:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504232",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@vbraun](#comment:25):
> If addition of standard packages requires a mention on sage-devel then IMHO removal should, too...

I think this is a good point.



---

archive/issue_comments_504233.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nThere's nothing to discuss; it's trivial to make the packages standard again if someone steps up and fixes the packages.",
    "created_at": "2021-03-07T23:55:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504233",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:29" align="right">comment:29</div>

There's nothing to discuss; it's trivial to make the packages standard again if someone steps up and fixes the packages.



---

archive/issue_comments_504234.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nThe purpose of asking for a sage-devel vote when making a package standard, to my understanding, is that the additional future maintenance burden (and bloat) coming from a standard package should receive more scrutiny than one developer's \"positive review\". None of this applies to the present situation.",
    "created_at": "2021-03-08T00:04:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504234",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">comment:30</div>

The purpose of asking for a sage-devel vote when making a package standard, to my understanding, is that the additional future maintenance burden (and bloat) coming from a standard package should receive more scrutiny than one developer's "positive review". None of this applies to the present situation.



---

archive/issue_comments_504235.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nYou really don't think that people should be made aware that R is being downgraded?",
    "created_at": "2021-03-08T01:32:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504235",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:31" align="right">comment:31</div>

You really don't think that people should be made aware that R is being downgraded?



---

archive/issue_comments_504236.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nThere will be a line in the list of merged tickets for the beta version that merges the ticket. I don't think this has greater urgency.",
    "created_at": "2021-03-08T01:37:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504236",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

There will be a line in the list of merged tickets for the beta version that merges the ticket. I don't think this has greater urgency.



---

archive/issue_comments_504237.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,3 +5,8 @@\n   [r-3.6.3]   /opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/var/tmp/sage/build/r-3.6.3/src/src/extra/blas/blas.f:2986:(.text+0x4352): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `xerbla_'\n ```\n \n+Discussions:\n+- #29486\n+- #29170\n+- \u200bhttps://groups.google.com/g/sage-devel/c/IX3niEdmCEM/m/LovmF6gmIwAJ\n+- https://groups.google.com/g/sage-devel/c/alkG4veIsBk/m/432cxzpYAQAJ\n``````\n",
    "created_at": "2021-03-08T06:39:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504237",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,3 +5,8 @@
   [r-3.6.3]   /opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/var/tmp/sage/build/r-3.6.3/src/src/extra/blas/blas.f:2986:(.text+0x4352): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `xerbla_'
 ```
 
+Discussions:
+- #29486
+- #29170
+- ​https://groups.google.com/g/sage-devel/c/IX3niEdmCEM/m/LovmF6gmIwAJ
+- https://groups.google.com/g/sage-devel/c/alkG4veIsBk/m/432cxzpYAQAJ
``````




---

archive/issue_comments_504238.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nI agree with the ticket, but I also think its common courtesy to give other developers a heads-up here.",
    "created_at": "2021-03-08T08:57:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504238",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:34" align="right">comment:34</div>

I agree with the ticket, but I also think its common courtesy to give other developers a heads-up here.



---

archive/issue_events_435100.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-08T08:57:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435100"
}
```



---

archive/issue_events_435101.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-08T08:57:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435101"
}
```



---

archive/issue_events_435102.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-08T13:05:22Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435102"
}
```



---

archive/issue_events_435103.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-08T13:05:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435103"
}
```



---

archive/issue_comments_504239.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nBlocking 9.3, not 9.4",
    "created_at": "2021-03-08T13:05:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504239",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">comment:35</div>

Blocking 9.3, not 9.4



---

archive/issue_comments_504240.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\n> There will be a line in the list of merged tickets for the beta version that merges the ticket. I don't think this has greater urgency.\n\nYeah, that will *definitely* catch everyone's attention.\n\n---\n\nR is one of the oldest wheels of the car (not the current Python-style wheels, figurative wheels from days of yore).  We all know that once it's not supported, it will be more than broken.  At the very least,  before this is merged there should be some kind of automated message when R is invoked via Sage (via the innumerable examples out in the wild now, including in various books about \"how to use Sage\") that says \"here is a Sage website that will help you install an R that works with our interface, and here is what to do to get Sage to recognize it\".  For **non-POSIX geeks**, but for an ordinary user.  And then these now-optional doctests should be tested.\n\nIn particular, this is another piece of mission creep from \"viable competitor to M, M, M...\"  I do get the desire to decouple and ease upgrade processes for external software.   But for such an important piece of software (not least because of the innumerable packages) there should at the very least be an easy on-ramp to nudging people to install it when needed, and then some kind of testing.  Kind of like how OS X \"reminds\" one if you try to use `git` and don't yet have command line tools.",
    "created_at": "2021-03-09T04:09:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504240",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:36" align="right">comment:36</div>

> There will be a line in the list of merged tickets for the beta version that merges the ticket. I don't think this has greater urgency.

Yeah, that will *definitely* catch everyone's attention.

---

R is one of the oldest wheels of the car (not the current Python-style wheels, figurative wheels from days of yore).  We all know that once it's not supported, it will be more than broken.  At the very least,  before this is merged there should be some kind of automated message when R is invoked via Sage (via the innumerable examples out in the wild now, including in various books about "how to use Sage") that says "here is a Sage website that will help you install an R that works with our interface, and here is what to do to get Sage to recognize it".  For **non-POSIX geeks**, but for an ordinary user.  And then these now-optional doctests should be tested.

In particular, this is another piece of mission creep from "viable competitor to M, M, M..."  I do get the desire to decouple and ease upgrade processes for external software.   But for such an important piece of software (not least because of the innumerable packages) there should at the very least be an easy on-ramp to nudging people to install it when needed, and then some kind of testing.  Kind of like how OS X "reminds" one if you try to use `git` and don't yet have command line tools.



---

archive/issue_comments_504241.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@kcrisman](#comment:36):\n> In particular, this is another piece of mission creep from \"viable competitor to M, M, M...\"  I do get the desire to decouple and ease upgrade processes for external software. \n\nThis ticket is about the very concrete problem that R does not build on one of our standard platforms, Cygwin, and we are not able to use the system R either.\n\nBecause failing standard packages block the entire build, we either need to fix it, or downgrade it from standard before the 9.3 release.",
    "created_at": "2021-03-09T04:22:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504241",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@kcrisman](#comment:36):
> In particular, this is another piece of mission creep from "viable competitor to M, M, M..."  I do get the desire to decouple and ease upgrade processes for external software. 

This ticket is about the very concrete problem that R does not build on one of our standard platforms, Cygwin, and we are not able to use the system R either.

Because failing standard packages block the entire build, we either need to fix it, or downgrade it from standard before the 9.3 release.



---

archive/issue_comments_504242.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@kcrisman](#comment:36):\n> ... when R is invoked via Sage (via the innumerable examples out in the wild now, including in various books about \"how to use Sage\")\n\nDo you have any pointers to such examples?",
    "created_at": "2021-03-09T04:24:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504242",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@kcrisman](#comment:36):
> ... when R is invoked via Sage (via the innumerable examples out in the wild now, including in various books about "how to use Sage")

Do you have any pointers to such examples?



---

archive/issue_comments_504243.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,6 +7,8 @@\n \n Discussions:\n - #29486\n+- #29441\n - #29170\n - \u200bhttps://groups.google.com/g/sage-devel/c/IX3niEdmCEM/m/LovmF6gmIwAJ\n+- https://wiki.sagemath.org/ReleaseTours/sage-9.2#rpy2_and_R\n - https://groups.google.com/g/sage-devel/c/alkG4veIsBk/m/432cxzpYAQAJ\n``````\n",
    "created_at": "2021-03-09T04:54:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504243",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,6 +7,8 @@
 
 Discussions:
 - #29486
+- #29441
 - #29170
 - ​https://groups.google.com/g/sage-devel/c/IX3niEdmCEM/m/LovmF6gmIwAJ
+- https://wiki.sagemath.org/ReleaseTours/sage-9.2#rpy2_and_R
 - https://groups.google.com/g/sage-devel/c/alkG4veIsBk/m/432cxzpYAQAJ
``````




---

archive/issue_comments_504244.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nIIRC correctly, R is not mentioned in http://sagebook.gforge.inria.fr/english.html",
    "created_at": "2021-03-09T09:03:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504244",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:40" align="right">comment:40</div>

IIRC correctly, R is not mentioned in http://sagebook.gforge.inria.fr/english.html



---

archive/issue_comments_504245.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nAs a point of reference, I've twice been in workshops with R experts where both Sage and R were being taught to students.  When I told the R people that since students have already installed Sage, they can use R through Sage.  But this did not interest them as they wanted to have students install RStudio anyways.\n\nDo we know about more than one person who uses R primarily through Sage?",
    "created_at": "2021-03-09T14:54:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504245",
    "user": "https://github.com/embray"
}
```

<div id="comment:41" align="right">comment:41</div>

As a point of reference, I've twice been in workshops with R experts where both Sage and R were being taught to students.  When I told the R people that since students have already installed Sage, they can use R through Sage.  But this did not interest them as they wanted to have students install RStudio anyways.

Do we know about more than one person who uses R primarily through Sage?



---

archive/issue_comments_504246.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nThat said, I haven't really kept up with this issue.  What's the problem with R on cygwin?  Maybe I can just fix it.",
    "created_at": "2021-03-09T14:56:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504246",
    "user": "https://github.com/embray"
}
```

<div id="comment:42" align="right">comment:42</div>

That said, I haven't really kept up with this issue.  What's the problem with R on cygwin?  Maybe I can just fix it.



---

archive/issue_comments_504247.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@embray](#comment:42):\n> What's the problem with R on cygwin? \n\nIt does not build; somehow BLAS-related. See ticket description.\n\nMore generally, we have been unable to use system BLAS and system R. #30163",
    "created_at": "2021-03-09T17:26:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504247",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@embray](#comment:42):
> What's the problem with R on cygwin? 

It does not build; somehow BLAS-related. See ticket description.

More generally, we have been unable to use system BLAS and system R. #30163



---

archive/issue_events_435104.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2021-03-10T13:24:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435104"
}
```



---

archive/issue_events_435105.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2021-03-10T13:24:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435105"
}
```



---

archive/issue_comments_504248.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nWhen did the problem start?  Did we upgrade R at some point?\n\nI'm not against the current proposal to make R optional, though I'm inclined to agree with William's point about having a deprecation period first.  I'll look into the build issue with R.\n\nAlternatively, if the R version was upgraded, resulting in this problem, could we not just revert the upgrade until a later version / when this is able to be fixed?",
    "created_at": "2021-03-10T13:24:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504248",
    "user": "https://github.com/embray"
}
```

<div id="comment:44" align="right">comment:44</div>

When did the problem start?  Did we upgrade R at some point?

I'm not against the current proposal to make R optional, though I'm inclined to agree with William's point about having a deprecation period first.  I'll look into the build issue with R.

Alternatively, if the R version was upgraded, resulting in this problem, could we not just revert the upgrade until a later version / when this is able to be fixed?



---

archive/issue_comments_504249.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nI'm looking at the Sage build on my Windows machine, and it seems I haven't updated it in some time (I think not since 9.3b2).  I already have r-3.6.3 built successfully.  But since I last updated it looks like openblas has been updated, so right now openblas is recompiling, then we'll see about r...",
    "created_at": "2021-03-10T13:58:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504249",
    "user": "https://github.com/embray"
}
```

<div id="comment:45" align="right">comment:45</div>

I'm looking at the Sage build on my Windows machine, and it seems I haven't updated it in some time (I think not since 9.3b2).  I already have r-3.6.3 built successfully.  But since I last updated it looks like openblas has been updated, so right now openblas is recompiling, then we'll see about r...



---

archive/issue_comments_504250.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nAs of now, this issue is causing the CI tests of Cygwin to fail so we cannot even see other issues that affect Cygwin. \n\nSo let's please get this in to the next beta --- it is trivial to revert in a follow-up ticket if you succeed to fix the issue.",
    "created_at": "2021-03-10T15:28:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504250",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:46" align="right">comment:46</div>

As of now, this issue is causing the CI tests of Cygwin to fail so we cannot even see other issues that affect Cygwin. 

So let's please get this in to the next beta --- it is trivial to revert in a follow-up ticket if you succeed to fix the issue.



---

archive/issue_events_435106.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-10T15:28:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435106"
}
```



---

archive/issue_events_435107.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-10T15:28:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435107"
}
```



---

archive/issue_comments_504251.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nLet me at least see if I can reproduce it locally first...\nI wonder if there's some way we could make some packages optional on a platform-specific basis (maybe when running bootstrap?)",
    "created_at": "2021-03-10T15:39:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504251",
    "user": "https://github.com/embray"
}
```

<div id="comment:48" align="right">comment:48</div>

Let me at least see if I can reproduce it locally first...
I wonder if there's some way we could make some packages optional on a platform-specific basis (maybe when running bootstrap?)



---

archive/issue_comments_504252.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@embray](#comment:48):\n> I wonder if there's some way we could make some packages optional on a platform-specific basis\n\nYes, with #30383 (needs review!), which adds infrastructure for disabling standard packages.",
    "created_at": "2021-03-10T20:24:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504252",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@embray](#comment:48):
> I wonder if there's some way we could make some packages optional on a platform-specific basis

Yes, with #30383 (needs review!), which adds infrastructure for disabling standard packages.



---

archive/issue_comments_504253.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [@embray](#comment:48):\n> Let me at least see if I can reproduce it locally first...\n> I wonder if there's some way we could make some packages optional on a platform-specific basis (maybe when running bootstrap?)\n\nAaaaarghhh...\n\nThis would be a documentation nightmare (explaining why a ticket is \"optionally optional\" is awkward at the very minimum...). It would also \"froze\" the idea of Windows 10 being a \"second-class citizen\" as far as Sage is concerned.\n\nI'm starting to consider promoting a WSL2 port as the preffered windows platform,and preparing a deprecation of the Cygwin port, which remains necessary as long as Windows \n versions <10 remain relevant only as rthe \"sanest\" way out of this predicament (\"sane\" being an hyperbole, of course...).\n\nBut this also should be discussed on `sage-devel`. Hence this [post](https://groups.google.com/g/sage-devel/c/alkG4veIsBk/m/AtNQ1KCMBgAJ)...",
    "created_at": "2021-03-10T21:11:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504253",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [@embray](#comment:48):
> Let me at least see if I can reproduce it locally first...
> I wonder if there's some way we could make some packages optional on a platform-specific basis (maybe when running bootstrap?)

Aaaaarghhh...

This would be a documentation nightmare (explaining why a ticket is "optionally optional" is awkward at the very minimum...). It would also "froze" the idea of Windows 10 being a "second-class citizen" as far as Sage is concerned.

I'm starting to consider promoting a WSL2 port as the preffered windows platform,and preparing a deprecation of the Cygwin port, which remains necessary as long as Windows 
 versions <10 remain relevant only as rthe "sanest" way out of this predicament ("sane" being an hyperbole, of course...).

But this also should be discussed on `sage-devel`. Hence this [post](https://groups.google.com/g/sage-devel/c/alkG4veIsBk/m/AtNQ1KCMBgAJ)...



---

archive/issue_comments_504254.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nonline statistics says that among Windows installations, version 10 is approaching 80%. High time to think about WSL2 as a primary platform.",
    "created_at": "2021-03-11T08:35:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504254",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:51" align="right">comment:51</div>

online statistics says that among Windows installations, version 10 is approaching 80%. High time to think about WSL2 as a primary platform.



---

archive/issue_comments_504255.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nMoreover, the 2nd biggest, qua # of installs, is Windows version 7, on 16%, \nwhich is past its EOL, so it's either on very old machines which won't really be capable of running resouce-hungry Sage well, anyway, or on machines having some old, unupgradeable,  soft installed. Windows 8 (EOLed since 2016) is at 1% and 8.1, still supported, on 3.7%. \nhttps://gs.statcounter.com/windows-version-market-share/desktop/worldwide/\n\nI think we should really put more effort in WSL2, and much less effort in Cygwin.",
    "created_at": "2021-03-11T09:28:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504255",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:52" align="right">comment:52</div>

Moreover, the 2nd biggest, qua # of installs, is Windows version 7, on 16%, 
which is past its EOL, so it's either on very old machines which won't really be capable of running resouce-hungry Sage well, anyway, or on machines having some old, unupgradeable,  soft installed. Windows 8 (EOLed since 2016) is at 1% and 8.1, still supported, on 3.7%. 
https://gs.statcounter.com/windows-version-market-share/desktop/worldwide/

I think we should really put more effort in WSL2, and much less effort in Cygwin.



---

archive/issue_comments_504256.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nWSL2 is an installation nightmare for typical users.  But this is off-topic.\n\nI'm not even so sure the problem here has to do much with Cygwin.  I haven't been able to reproduce it on my local Cygwin install.\n\nIs this build also installing the system R?  I have reported problems before with installing the system R resulting in problems linking to the right BLAS.\n\nWSL will just give you a new and different set of problems.",
    "created_at": "2021-03-11T12:04:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504256",
    "user": "https://github.com/embray"
}
```

<div id="comment:53" align="right">comment:53</div>

WSL2 is an installation nightmare for typical users.  But this is off-topic.

I'm not even so sure the problem here has to do much with Cygwin.  I haven't been able to reproduce it on my local Cygwin install.

Is this build also installing the system R?  I have reported problems before with installing the system R resulting in problems linking to the right BLAS.

WSL will just give you a new and different set of problems.



---

archive/issue_comments_504257.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nLooking again at the build log where R failed, it looks like it is installing the system openblas and the system R.  I wonder if that could somehow be part of the problem.\n\nHave you tried modifying the build script to not install them and see if it works?  I know we also want to try getting it working with the system packages, but since they don't work yet anyways maybe we can forego their installation for now.\n\nIn the meantime I'll try a fresh cygwin install and see if I can reproduce the environment being used in the CI.",
    "created_at": "2021-03-11T18:36:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504257",
    "user": "https://github.com/embray"
}
```

<div id="comment:54" align="right">comment:54</div>

Looking again at the build log where R failed, it looks like it is installing the system openblas and the system R.  I wonder if that could somehow be part of the problem.

Have you tried modifying the build script to not install them and see if it works?  I know we also want to try getting it working with the system packages, but since they don't work yet anyways maybe we can forego their installation for now.

In the meantime I'll try a fresh cygwin install and see if I can reproduce the environment being used in the CI.



---

archive/issue_comments_504258.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nReplying to [@embray](#comment:54):\n> In the meantime I'll try a fresh cygwin install and see if I can reproduce the environment being used in the CI.\n\nEasy to do by using `tox -e local-cygwin-choco-standard` in a minimal install of Cygwin + tox",
    "created_at": "2021-03-11T18:47:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504258",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:55" align="right">comment:55</div>

Replying to [@embray](#comment:54):
> In the meantime I'll try a fresh cygwin install and see if I can reproduce the environment being used in the CI.

Easy to do by using `tox -e local-cygwin-choco-standard` in a minimal install of Cygwin + tox



---

archive/issue_comments_504259.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nLet's please not continue discussing WSL etc. here on this technical ticket. I have opened #31485 (Meta-ticket: Sage on WSL (Windows Subsystem for Linux)) for it. It would be helpful if someone could organize the discussion and the existing tickets in this direction there.",
    "created_at": "2021-03-11T18:55:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504259",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:56" align="right">comment:56</div>

Let's please not continue discussing WSL etc. here on this technical ticket. I have opened #31485 (Meta-ticket: Sage on WSL (Windows Subsystem for Linux)) for it. It would be helpful if someone could organize the discussion and the existing tickets in this direction there.



---

archive/issue_comments_504260.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nReplying to [@mkoeppe](#comment:55):\n> Replying to [@embray](#comment:54):\n> > In the meantime I'll try a fresh cygwin install and see if I can reproduce the environment being used in the CI.\n\n> \n> Easy to do by using `tox -e local-cygwin-choco-standard` in a minimal install of Cygwin + tox\n\nCool, thanks for the pointer.  I don't have chocolatey installed, but I did the equivalent using apt-cyg and the (very nice) `sage-get-system-packages` command.\n\nOf course if there's something *very* specific to the way chocolatey is installing the packages then that's a problem and I'll have to dig deeper.  Seems unlikely?",
    "created_at": "2021-03-12T11:37:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504260",
    "user": "https://github.com/embray"
}
```

<div id="comment:57" align="right">comment:57</div>

Replying to [@mkoeppe](#comment:55):
> Replying to [@embray](#comment:54):
> > In the meantime I'll try a fresh cygwin install and see if I can reproduce the environment being used in the CI.

> 
> Easy to do by using `tox -e local-cygwin-choco-standard` in a minimal install of Cygwin + tox

Cool, thanks for the pointer.  I don't have chocolatey installed, but I did the equivalent using apt-cyg and the (very nice) `sage-get-system-packages` command.

Of course if there's something *very* specific to the way chocolatey is installing the packages then that's a problem and I'll have to dig deeper.  Seems unlikely?



---

archive/issue_comments_504261.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nFresh Cygwin install.  I installed all the `:standard:` packages recommended by `sage-get-system-packages`.\n\nRan `./bootstrap` then `./configure` with no additional arguments.  Then ran `make r`.\n\nFirst it builds and installs OpenBLAS.  Several hours later it builds and installs R with no problem.\n\nI am downloading the build artifacts from the [GitHub](../wiki/GitHub) build to see if there are any more detailed logs about the R build there...",
    "created_at": "2021-03-12T15:25:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504261",
    "user": "https://github.com/embray"
}
```

<div id="comment:58" align="right">comment:58</div>

Fresh Cygwin install.  I installed all the `:standard:` packages recommended by `sage-get-system-packages`.

Ran `./bootstrap` then `./configure` with no additional arguments.  Then ran `make r`.

First it builds and installs OpenBLAS.  Several hours later it builds and installs R with no problem.

I am downloading the build artifacts from the [GitHub](../wiki/GitHub) build to see if there are any more detailed logs about the R build there...



---

archive/issue_comments_504262.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nHere's one thing that stands out already.  On [GitHub](../wiki/GitHub):\n\n```\nchecking for dgemm_ in -lopenblas ... yes\nchecking whether double complex BLAS can be used... no\n```\n\nOn my local build it has:\n\n```\nchecking for dgemm_ in -lopenblas ... yes\nchecking whether double complex BLAS can be used... yes\nchecking whether the BLAS is complete... yes\n```\n\nThe [GitHub](../wiki/GitHub) build says no support for \"double complex BLAS\" and does not even mention the third check \"BLAS is complete\"",
    "created_at": "2021-03-12T15:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504262",
    "user": "https://github.com/embray"
}
```

<div id="comment:59" align="right">comment:59</div>

Here's one thing that stands out already.  On [GitHub](../wiki/GitHub):

```
checking for dgemm_ in -lopenblas ... yes
checking whether double complex BLAS can be used... no
```

On my local build it has:

```
checking for dgemm_ in -lopenblas ... yes
checking whether double complex BLAS can be used... yes
checking whether the BLAS is complete... yes
```

The [GitHub](../wiki/GitHub) build says no support for "double complex BLAS" and does not even mention the third check "BLAS is complete"



---

archive/issue_comments_504263.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nSo the end result is on [GitHub](../wiki/GitHub) R is not linking with openblas:\n\n```\n  External libraries:          readline, curl\n  Additional capabilities:     PNG, JPEG, TIFF, NLS, ICU\n  Options enabled:             shared R library, shared BLAS, R profiling\n\n  Capabilities skipped:        cairo\n  Options not enabled:         memory profiling\n```\n\nWhereas on my local build it has:\n\n```\n  External libraries:          readline, BLAS(OpenBLAS), LAPACK(generic), curl\n  Additional capabilities:     PNG, JPEG, TIFF, NLS, ICU\n  Options enabled:             shared R library, R profiling\n\n  Capabilities skipped:        cairo\n  Options not enabled:         shared BLAS, memory profiling\n```\n\nAnd the build error is occurring somewhere related to building R's baseline BLAS which AFAIK I've never tested on Cygwin since it always successfully links with OpenBLAS.\n\nNow the question is just why is the double complex check failing?",
    "created_at": "2021-03-12T15:43:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504263",
    "user": "https://github.com/embray"
}
```

<div id="comment:60" align="right">comment:60</div>

So the end result is on [GitHub](../wiki/GitHub) R is not linking with openblas:

```
  External libraries:          readline, curl
  Additional capabilities:     PNG, JPEG, TIFF, NLS, ICU
  Options enabled:             shared R library, shared BLAS, R profiling

  Capabilities skipped:        cairo
  Options not enabled:         memory profiling
```

Whereas on my local build it has:

```
  External libraries:          readline, BLAS(OpenBLAS), LAPACK(generic), curl
  Additional capabilities:     PNG, JPEG, TIFF, NLS, ICU
  Options enabled:             shared R library, R profiling

  Capabilities skipped:        cairo
  Options not enabled:         shared BLAS, memory profiling
```

And the build error is occurring somewhere related to building R's baseline BLAS which AFAIK I've never tested on Cygwin since it always successfully links with OpenBLAS.

Now the question is just why is the double complex check failing?



---

archive/issue_comments_504264.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nReplying to [@embray](#comment:57):\n> Of course if there's something *very* specific to the way chocolatey is installing the packages then that's a problem and I'll have to dig deeper.  Seems unlikely?\n\nUnlikely. Chocolatey really just calls cygwin's `setup_....exe` many times.",
    "created_at": "2021-03-12T16:05:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504264",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:61" align="right">comment:61</div>

Replying to [@embray](#comment:57):
> Of course if there's something *very* specific to the way chocolatey is installing the packages then that's a problem and I'll have to dig deeper.  Seems unlikely?

Unlikely. Chocolatey really just calls cygwin's `setup_....exe` many times.



---

archive/issue_comments_504265.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nThe openblas logs on [GitHub](../wiki/GitHub) do show successful build an installation, though the `make check` fails with a bunch of things like:\n\n```\ngfortran -O2 -Wall -frecursive -fno-optimize-sibling-calls -m64 -msse3 -mssse3 -msse4.1 -mavx -mavx2 -mfma -march=skylake-avx512 -fno-asynchronous-unwind-tables -mavx2  -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib -Wl,-rpath,/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib  -o sblat1 sblat1.o ../cygopenblas_skylakexp-r0.3.13.a -lgfortran -lgfortran -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/10 -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../lib -L/lib/../lib -L/usr/lib/../lib -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../..  -lcygwin  \n/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: sblat1.o:sblat1.f:(.text+0x67d): undefined reference to `srot_'\nsblat1.o:sblat1.f:(.text+0x67d): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `srot_'\n/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: sblat1.o:sblat1.f:(.text+0xbae): undefined reference to `srot_'\nsblat1.o:sblat1.f:(.text+0xbae): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `srot_'\n/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: sblat1.o:sblat1.f:(.text+0xe99): undefined reference to `sdsdot_'\nsblat1.o:sblat1.f:(.text+0xe99): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `sdsdot_'\n/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: sblat1.o:sblat1.f:(.text+0xfde): undefined reference to `sdot_'\n...\n```\n\nBut this looks more like a problem in the make check.  Why is it trying to link to some `../cygopenblas_skylakexp-r0.3.13.a` when the build produced `cygopenblas_haswellp-r0.3.13.a` not skylake?\n\nProbably not related though...\n\nIt looks like it produced `cygopenblas.dll` just fine:\n\n```\ngcc -O2 -g -march=native -O2 -DMAX_STACK_ALLOC=2048 -Wall -m64 -DF_INTERFACE_GFORT -DNO_AVX512 -DSMP_SERVER -DNO_WARMUP -DMAX_CPU_NUMBER=2 -DMAX_PARALLEL_NUMBER=1 -DUSE_TLS -DBUILD_SINGLE=1 -DBUILD_DOUBLE=1 -DBUILD_COMPLEX=1 -DBUILD_COMPLEX16=1 -DVERSION=\\\"0.3.13\\\" -msse3 -mssse3 -msse4.1 -mavx -mavx2 -mfma -mavx2 -UASMNAME -UASMFNAME -UNAME -UCNAME -UCHAR_NAME -UCHAR_CNAME -DASMNAME= -DASMFNAME=_ -DNAME=_ -DCNAME= -DCHAR_NAME=\\\"_\\\" -DCHAR_CNAME=\\\"\\\" -DNO_AFFINITY -I. -O2 -DMAX_STACK_ALLOC=2048 -Wall -m64 -DF_INTERFACE_GFORT -DNO_AVX512 -DSMP_SERVER -DNO_WARMUP -DMAX_CPU_NUMBER=2 -DMAX_PARALLEL_NUMBER=1 -DUSE_TLS -DBUILD_SINGLE=1 -DBUILD_DOUBLE=1 -DBUILD_COMPLEX=1 -DBUILD_COMPLEX16=1 -DVERSION=\\\"0.3.13\\\" -msse3 -mssse3 -msse4.1 -mavx -mavx2 -mfma -mavx2 -UASMNAME -UASMFNAME -UNAME -UCNAME -UCHAR_NAME -UCHAR_CNAME -DASMNAME= -DASMFNAME=_ -DNAME=_ -DCNAME= -DCHAR_NAME=\\\"_\\\" -DCHAR_CNAME=\\\"\\\" -DNO_AFFINITY -I.. -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib -Wl,-rpath,/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib  cygopenblas.def dllinit.o \\\n-shared -o ../cygopenblas.dll -Wl,--out-implib,../libopenblas.dll.a \\\n-Wl,--whole-archive ../cygopenblas_haswellp-r0.3.13.a -Wl,--no-whole-archive -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/10 -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../lib -L/lib/../lib -L/usr/lib/../lib -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../..  -lgfortran -lquadmath -lm -lcygwin   -lgfortran -lgfortran\n```",
    "created_at": "2021-03-12T16:13:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504265",
    "user": "https://github.com/embray"
}
```

<div id="comment:62" align="right">comment:62</div>

The openblas logs on [GitHub](../wiki/GitHub) do show successful build an installation, though the `make check` fails with a bunch of things like:

```
gfortran -O2 -Wall -frecursive -fno-optimize-sibling-calls -m64 -msse3 -mssse3 -msse4.1 -mavx -mavx2 -mfma -march=skylake-avx512 -fno-asynchronous-unwind-tables -mavx2  -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib -Wl,-rpath,/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib  -o sblat1 sblat1.o ../cygopenblas_skylakexp-r0.3.13.a -lgfortran -lgfortran -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/10 -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../lib -L/lib/../lib -L/usr/lib/../lib -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../..  -lcygwin  
/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: sblat1.o:sblat1.f:(.text+0x67d): undefined reference to `srot_'
sblat1.o:sblat1.f:(.text+0x67d): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `srot_'
/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: sblat1.o:sblat1.f:(.text+0xbae): undefined reference to `srot_'
sblat1.o:sblat1.f:(.text+0xbae): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `srot_'
/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: sblat1.o:sblat1.f:(.text+0xe99): undefined reference to `sdsdot_'
sblat1.o:sblat1.f:(.text+0xe99): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `sdsdot_'
/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: sblat1.o:sblat1.f:(.text+0xfde): undefined reference to `sdot_'
...
```

But this looks more like a problem in the make check.  Why is it trying to link to some `../cygopenblas_skylakexp-r0.3.13.a` when the build produced `cygopenblas_haswellp-r0.3.13.a` not skylake?

Probably not related though...

It looks like it produced `cygopenblas.dll` just fine:

```
gcc -O2 -g -march=native -O2 -DMAX_STACK_ALLOC=2048 -Wall -m64 -DF_INTERFACE_GFORT -DNO_AVX512 -DSMP_SERVER -DNO_WARMUP -DMAX_CPU_NUMBER=2 -DMAX_PARALLEL_NUMBER=1 -DUSE_TLS -DBUILD_SINGLE=1 -DBUILD_DOUBLE=1 -DBUILD_COMPLEX=1 -DBUILD_COMPLEX16=1 -DVERSION=\"0.3.13\" -msse3 -mssse3 -msse4.1 -mavx -mavx2 -mfma -mavx2 -UASMNAME -UASMFNAME -UNAME -UCNAME -UCHAR_NAME -UCHAR_CNAME -DASMNAME= -DASMFNAME=_ -DNAME=_ -DCNAME= -DCHAR_NAME=\"_\" -DCHAR_CNAME=\"\" -DNO_AFFINITY -I. -O2 -DMAX_STACK_ALLOC=2048 -Wall -m64 -DF_INTERFACE_GFORT -DNO_AVX512 -DSMP_SERVER -DNO_WARMUP -DMAX_CPU_NUMBER=2 -DMAX_PARALLEL_NUMBER=1 -DUSE_TLS -DBUILD_SINGLE=1 -DBUILD_DOUBLE=1 -DBUILD_COMPLEX=1 -DBUILD_COMPLEX16=1 -DVERSION=\"0.3.13\" -msse3 -mssse3 -msse4.1 -mavx -mavx2 -mfma -mavx2 -UASMNAME -UASMFNAME -UNAME -UCNAME -UCHAR_NAME -UCHAR_CNAME -DASMNAME= -DASMFNAME=_ -DNAME=_ -DCNAME= -DCHAR_NAME=\"_\" -DCHAR_CNAME=\"\" -DNO_AFFINITY -I.. -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib -Wl,-rpath,/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib  cygopenblas.def dllinit.o \
-shared -o ../cygopenblas.dll -Wl,--out-implib,../libopenblas.dll.a \
-Wl,--whole-archive ../cygopenblas_haswellp-r0.3.13.a -Wl,--no-whole-archive -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/10 -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../lib -L/lib/../lib -L/usr/lib/../lib -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../..  -lgfortran -lquadmath -lm -lcygwin   -lgfortran -lgfortran
```



---

archive/issue_comments_504266.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nHere is the relevant part in the R configure that checks for double complex support in the BLAS lib: https://github.com/wch/r-source/blob/78f3b069d6269ddde40d76515a1eef67df674435/m4/R.m4#L2642\n\nThere is a note in there:\n\n```\ndnl Now check if zdotu works (fails on AMD64 with the wrong compiler;\ndnl also fails on macOS with Accelerate/vecLib and gfortran; \ndnl but in that case we have a work-around using USE_VECLIB_G95FIX)\n```\n\nI don't know what they mean by that.  What is \"the wrong compiler\" in this case?\n\nPerhaps we could just toss in a patch to disable this check and see what happens?",
    "created_at": "2021-03-12T16:21:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504266",
    "user": "https://github.com/embray"
}
```

<div id="comment:63" align="right">comment:63</div>

Here is the relevant part in the R configure that checks for double complex support in the BLAS lib: https://github.com/wch/r-source/blob/78f3b069d6269ddde40d76515a1eef67df674435/m4/R.m4#L2642

There is a note in there:

```
dnl Now check if zdotu works (fails on AMD64 with the wrong compiler;
dnl also fails on macOS with Accelerate/vecLib and gfortran; 
dnl but in that case we have a work-around using USE_VECLIB_G95FIX)
```

I don't know what they mean by that.  What is "the wrong compiler" in this case?

Perhaps we could just toss in a patch to disable this check and see what happens?



---

archive/issue_comments_504267.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nI meant to add, I downloaded the build artifacts from GH and confirmed that the `cygopenblas.dll` is in the correct place and also exports the relevant symbols.",
    "created_at": "2021-03-12T16:21:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504267",
    "user": "https://github.com/embray"
}
```

<div id="comment:64" align="right">comment:64</div>

I meant to add, I downloaded the build artifacts from GH and confirmed that the `cygopenblas.dll` is in the correct place and also exports the relevant symbols.



---

archive/issue_comments_504268.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nAlso in the previous check it did successfully link against `-lopenblas` and find the `dgemm_` symbol, so it's probably not a linking issue, but some problem with compiling and running the test for double complex support which is apparently known to fail sometimes?",
    "created_at": "2021-03-12T16:25:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504268",
    "user": "https://github.com/embray"
}
```

<div id="comment:65" align="right">comment:65</div>

Also in the previous check it did successfully link against `-lopenblas` and find the `dgemm_` symbol, so it's probably not a linking issue, but some problem with compiling and running the test for double complex support which is apparently known to fail sometimes?



---

archive/issue_comments_504269.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nReplying to [@embray](#comment:62):\n> But this looks more like a problem in the make check.  Why is it trying to link to some `../cygopenblas_skylakexp-r0.3.13.a` when the build produced `cygopenblas_haswellp-r0.3.13.a` not skylake?\n> \n> Probably not related though...\n\nLooks like we forgot to update `openblas/spkg-check.in` -- it duplicates an old copy of settings made in `openblas/spkg-install.in`!!\nThis should really go through a common script",
    "created_at": "2021-03-12T16:44:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504269",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:66" align="right">comment:66</div>

Replying to [@embray](#comment:62):
> But this looks more like a problem in the make check.  Why is it trying to link to some `../cygopenblas_skylakexp-r0.3.13.a` when the build produced `cygopenblas_haswellp-r0.3.13.a` not skylake?
> 
> Probably not related though...

Looks like we forgot to update `openblas/spkg-check.in` -- it duplicates an old copy of settings made in `openblas/spkg-install.in`!!
This should really go through a common script



---

archive/issue_comments_504270.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nI tried manually building the `conftest.f` from R's configure check and got this warning:\n\n```\n$ gfortran -c conftest.f\nconftest.f:15:72:\n\n   15 |  10      ztemp = ztemp + zx(i)*zx(i)\n      |                                                                        1\nWarning: Fortran 2018 deleted feature: DO termination statement which is not END DO or CONTINUE with label 10 at (1)\n```\n\nAnd in fact this was fixed upstream just a few months ago: https://github.com/wch/r-source/commit/b2e1bf7ee4a42288b56d77080ad942395b2fe4b0#diff-519bfce994ea1571b861581c2c200f396eb96ad94ba9bc74f20103dc1bda38dc\n\nI applied the upstream fix and the warning went away.  Maybe somewhere `-Werror` is getting set in `FFLAGS`.",
    "created_at": "2021-03-12T16:50:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504270",
    "user": "https://github.com/embray"
}
```

<div id="comment:67" align="right">comment:67</div>

I tried manually building the `conftest.f` from R's configure check and got this warning:

```
$ gfortran -c conftest.f
conftest.f:15:72:

   15 |  10      ztemp = ztemp + zx(i)*zx(i)
      |                                                                        1
Warning: Fortran 2018 deleted feature: DO termination statement which is not END DO or CONTINUE with label 10 at (1)
```

And in fact this was fixed upstream just a few months ago: https://github.com/wch/r-source/commit/b2e1bf7ee4a42288b56d77080ad942395b2fe4b0#diff-519bfce994ea1571b861581c2c200f396eb96ad94ba9bc74f20103dc1bda38dc

I applied the upstream fix and the warning went away.  Maybe somewhere `-Werror` is getting set in `FFLAGS`.



---

archive/issue_comments_504271.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nI figured out that it's possible to download the failed R build artifacts from GH (very nice, thank you).  Unfortunately the `config.log` does not say anything very helpful here:\n\n```\nconfigure:38593: checking whether double complex BLAS can be used\nconftestf.f:15:72:\n\n   15 |  10      ztemp = ztemp + zx(i)*zx(i)\n      |                                                                        1\nWarning: Fortran 2018 deleted feature: DO termination statement which is not END DO or CONTINUE with label 10 at (1)\nconfigure:38674: result: no\n```\n\nSomething the way the test is written it's not producing useful output.  It looks like the fortran compilation succeeds, with the warning, but only as a warning.  Probably the C compilation (or linking?) fails.  But it's not producing any output to the log.  I still can't reproduce a failure in this locally.",
    "created_at": "2021-03-12T17:35:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504271",
    "user": "https://github.com/embray"
}
```

<div id="comment:68" align="right">comment:68</div>

I figured out that it's possible to download the failed R build artifacts from GH (very nice, thank you).  Unfortunately the `config.log` does not say anything very helpful here:

```
configure:38593: checking whether double complex BLAS can be used
conftestf.f:15:72:

   15 |  10      ztemp = ztemp + zx(i)*zx(i)
      |                                                                        1
Warning: Fortran 2018 deleted feature: DO termination statement which is not END DO or CONTINUE with label 10 at (1)
configure:38674: result: no
```

Something the way the test is written it's not producing useful output.  It looks like the fortran compilation succeeds, with the warning, but only as a warning.  Probably the C compilation (or linking?) fails.  But it's not producing any output to the log.  I still can't reproduce a failure in this locally.



---

archive/issue_comments_504272.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nReplying to [@mkoeppe](#comment:66):\n> Replying to [@embray](#comment:62):\n> > But this looks more like a problem in the make check.  Why is it trying to link to some `../cygopenblas_skylakexp-r0.3.13.a` when the build produced `cygopenblas_haswellp-r0.3.13.a` not skylake?\n> > \n> > Probably not related though...\n\n> \n> Looks like we forgot to update `openblas/spkg-check.in` -- it duplicates an old copy of settings made in `openblas/spkg-install.in`!!\n> This should really go through a common script\n> \n\nI rebuilt openblas locally with `SAGE_CHECK=yes` and the checks passed.",
    "created_at": "2021-03-12T17:37:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504272",
    "user": "https://github.com/embray"
}
```

<div id="comment:69" align="right">comment:69</div>

Replying to [@mkoeppe](#comment:66):
> Replying to [@embray](#comment:62):
> > But this looks more like a problem in the make check.  Why is it trying to link to some `../cygopenblas_skylakexp-r0.3.13.a` when the build produced `cygopenblas_haswellp-r0.3.13.a` not skylake?
> > 
> > Probably not related though...

> 
> Looks like we forgot to update `openblas/spkg-check.in` -- it duplicates an old copy of settings made in `openblas/spkg-install.in`!!
> This should really go through a common script
> 

I rebuilt openblas locally with `SAGE_CHECK=yes` and the checks passed.



---

archive/issue_comments_504273.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nReplying to [@embray](#comment:68):\n> \n> ```\n> configure:38593: checking whether double complex BLAS can be used\n> conftestf.f:15:72:\n> \n>    15 |  10      ztemp = ztemp + zx(i)*zx(i)\n>       |                                                                        1\n> Warning: Fortran 2018 deleted feature: DO termination statement which is not END DO or CONTINUE with label 10 at (1)\n> configure:38674: result: no\n> ```\n> \n> Something the way the test is written it's not producing useful output.  It looks like the fortran compilation succeeds, with the warning, but only as a warning.  Probably the C compilation (or linking?) fails.  But it's not producing any output to the log.  I \n\nProbably should run this with CONFIG_SHELL=\"bash -x\"",
    "created_at": "2021-03-12T17:40:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504273",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:70" align="right">comment:70</div>

Replying to [@embray](#comment:68):
> 
> ```
> configure:38593: checking whether double complex BLAS can be used
> conftestf.f:15:72:
> 
>    15 |  10      ztemp = ztemp + zx(i)*zx(i)
>       |                                                                        1
> Warning: Fortran 2018 deleted feature: DO termination statement which is not END DO or CONTINUE with label 10 at (1)
> configure:38674: result: no
> ```
> 
> Something the way the test is written it's not producing useful output.  It looks like the fortran compilation succeeds, with the warning, but only as a warning.  Probably the C compilation (or linking?) fails.  But it's not producing any output to the log.  I 

Probably should run this with CONFIG_SHELL="bash -x"



---

archive/issue_comments_504274.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nLooking at the test code, I think it's likely the run test in https://github.com/wch/r-source/blob/78f3b069d6269ddde40d76515a1eef67df674435/m4/R.m4#L2704 that's failing.",
    "created_at": "2021-03-12T17:44:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504274",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:71" align="right">comment:71</div>

Looking at the test code, I think it's likely the run test in https://github.com/wch/r-source/blob/78f3b069d6269ddde40d76515a1eef67df674435/m4/R.m4#L2704 that's failing.



---

archive/issue_comments_504275.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nReplying to [@mkoeppe](#comment:66):\n> Replying to [@embray](#comment:62):\n> > But this looks more like a problem in the make check.  Why is it trying to link to some `../cygopenblas_skylakexp-r0.3.13.a` when the build produced `cygopenblas_haswellp-r0.3.13.a` not skylake?\n> > \n> > Probably not related though...\n\n> \n> Looks like we forgot to update `openblas/spkg-check.in` -- it duplicates an old copy of settings made in `openblas/spkg-install.in`!!\n> This should really go through a common script\n\nI'll do this in #31490",
    "created_at": "2021-03-12T17:58:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504275",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:72" align="right">comment:72</div>

Replying to [@mkoeppe](#comment:66):
> Replying to [@embray](#comment:62):
> > But this looks more like a problem in the make check.  Why is it trying to link to some `../cygopenblas_skylakexp-r0.3.13.a` when the build produced `cygopenblas_haswellp-r0.3.13.a` not skylake?
> > 
> > Probably not related though...

> 
> Looks like we forgot to update `openblas/spkg-check.in` -- it duplicates an old copy of settings made in `openblas/spkg-install.in`!!
> This should really go through a common script

I'll do this in #31490



---

archive/issue_comments_504276.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nReplying to [@mkoeppe](#comment:71):\n> Looking at the test code, I think it's likely the run test in https://github.com/wch/r-source/blob/78f3b069d6269ddde40d76515a1eef67df674435/m4/R.m4#L2704 that's failing. \n\nNice call!  After trying to manually compile it with what I think are all the right flags I get:\n\n```\n$ ./conftest.exe\nIllegal instruction (core dumped)\n```",
    "created_at": "2021-03-12T18:10:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504276",
    "user": "https://github.com/embray"
}
```

<div id="comment:73" align="right">comment:73</div>

Replying to [@mkoeppe](#comment:71):
> Looking at the test code, I think it's likely the run test in https://github.com/wch/r-source/blob/78f3b069d6269ddde40d76515a1eef67df674435/m4/R.m4#L2704 that's failing. 

Nice call!  After trying to manually compile it with what I think are all the right flags I get:

```
$ ./conftest.exe
Illegal instruction (core dumped)
```



---

archive/issue_comments_504277.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nReplying to [@embray](#comment:73):\n> Replying to [@mkoeppe](#comment:71):\n> > Looking at the test code, I think it's likely the run test in https://github.com/wch/r-source/blob/78f3b069d6269ddde40d76515a1eef67df674435/m4/R.m4#L2704 that's failing. \n\n> \n> Nice call!  After trying to manually compile it with what I think are all the right flags I get:\n> \n> ```\n> $ ./conftest.exe\n> Illegal instruction (core dumped)\n> ```\n\nThis was linking against the OpenBLAS that was included in the build artifacts from [GitHub](../wiki/GitHub).  If I link against my locally built OpenBLAS it works.\n\nSo the problem is again OpenBLAS, and apparently the fact that the OpenBLAS from the stage-i-a build artifacts is not portable, and possibly running on different CPUs between jobs?",
    "created_at": "2021-03-12T18:14:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504277",
    "user": "https://github.com/embray"
}
```

<div id="comment:74" align="right">comment:74</div>

Replying to [@embray](#comment:73):
> Replying to [@mkoeppe](#comment:71):
> > Looking at the test code, I think it's likely the run test in https://github.com/wch/r-source/blob/78f3b069d6269ddde40d76515a1eef67df674435/m4/R.m4#L2704 that's failing. 

> 
> Nice call!  After trying to manually compile it with what I think are all the right flags I get:
> 
> ```
> $ ./conftest.exe
> Illegal instruction (core dumped)
> ```

This was linking against the OpenBLAS that was included in the build artifacts from [GitHub](../wiki/GitHub).  If I link against my locally built OpenBLAS it works.

So the problem is again OpenBLAS, and apparently the fact that the OpenBLAS from the stage-i-a build artifacts is not portable, and possibly running on different CPUs between jobs?



---

archive/issue_comments_504278.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nThat's quite possible...  Would be great if all of our problems could be fixed by making OpenBLAS properly portable!",
    "created_at": "2021-03-12T18:18:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504278",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:75" align="right">comment:75</div>

That's quite possible...  Would be great if all of our problems could be fixed by making OpenBLAS properly portable!



---

archive/issue_comments_504279.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nLooking at the openblas build logs, I see it is not building with `DYNAMIC_ARCH=1`.  Does this mean the GH builds are not using `SAGE_FAT_BINARY`?  Perhaps that would fix all this.",
    "created_at": "2021-03-12T18:21:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504279",
    "user": "https://github.com/embray"
}
```

<div id="comment:76" align="right">comment:76</div>

Looking at the openblas build logs, I see it is not building with `DYNAMIC_ARCH=1`.  Does this mean the GH builds are not using `SAGE_FAT_BINARY`?  Perhaps that would fix all this.



---

archive/issue_comments_504280.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nThey do use SAGE_FAT_BINARY - see top of `ci-cygwin-standard.yml`",
    "created_at": "2021-03-12T18:24:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504280",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:77" align="right">comment:77</div>

They do use SAGE_FAT_BINARY - see top of `ci-cygwin-standard.yml`



---

archive/issue_comments_504281.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nReplying to [@mkoeppe](#comment:77):\n> They do use SAGE_FAT_BINARY - see top of `ci-cygwin-standard.yml`\n\nI see that now.\n\nBut looking again at the openblas build log from GH one of the first lines output, from the `echo` in `spkg-install.in`, is:\n\n```\nBuilding OpenBLAS: make\n```\n\nThis should say:\n\n```\nBuilding OpenBLAS: make DYNAMIC_ARCH=1\n```\n\nSo somewhere along the way the setting is being lost...",
    "created_at": "2021-03-12T18:40:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504281",
    "user": "https://github.com/embray"
}
```

<div id="comment:78" align="right">comment:78</div>

Replying to [@mkoeppe](#comment:77):
> They do use SAGE_FAT_BINARY - see top of `ci-cygwin-standard.yml`

I see that now.

But looking again at the openblas build log from GH one of the first lines output, from the `echo` in `spkg-install.in`, is:

```
Building OpenBLAS: make
```

This should say:

```
Building OpenBLAS: make DYNAMIC_ARCH=1
```

So somewhere along the way the setting is being lost...



---

archive/issue_comments_504282.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\nCan you check what its value in `build/bin/sage-build-env-config` is?",
    "created_at": "2021-03-12T18:42:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504282",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:79" align="right">comment:79</div>

Can you check what its value in `build/bin/sage-build-env-config` is?



---

archive/issue_comments_504283.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nReplying to [@embray](#comment:78):\n> But looking again at the openblas build log [...]\n> This should say:\n> \n> ```\n> Building OpenBLAS: make DYNAMIC_ARCH=1\n> ```\n> \n> So somewhere along the way the setting is being lost...\n\nYou are right, thanks for catching this. I may have a fix for this in https://github.com/mkoeppe/sage/runs/2098475692?check_suite_focus=true",
    "created_at": "2021-03-12T20:39:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504283",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:80" align="right">comment:80</div>

Replying to [@embray](#comment:78):
> But looking again at the openblas build log [...]
> This should say:
> 
> ```
> Building OpenBLAS: make DYNAMIC_ARCH=1
> ```
> 
> So somewhere along the way the setting is being lost...

You are right, thanks for catching this. I may have a fix for this in https://github.com/mkoeppe/sage/runs/2098475692?check_suite_focus=true



---

archive/issue_comments_504284.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nA fix is now in #29537, running in https://github.com/mkoeppe/sage/actions/runs/647547421",
    "created_at": "2021-03-12T21:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504284",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:81" align="right">comment:81</div>

A fix is now in #29537, running in https://github.com/mkoeppe/sage/actions/runs/647547421



---

archive/issue_events_435108.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-12T21:50:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435108"
}
```



---

archive/issue_events_435109.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-12T21:50:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435109"
}
```



---

archive/issue_events_435110.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-12T21:50:04Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "title_is": "cygwin-standard: r build fails ... Make it possible to disable build of r, rpy2 using ./configure --disable-r",
    "title_was": "cygwin-standard: r build fails ... downgrade r, rpy2 to optional",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435110"
}
```



---

archive/issue_comments_504285.json:
```json
{
    "body": "Dependencies: **#29537, #30383**",
    "created_at": "2021-03-12T21:50:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504285",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#29537, #30383**



---

archive/issue_comments_504286.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nI've reduced it from \"blocker\" as I am hopeful that #29537 will fix it.  And instead of making the packages \"optional\", I now propose to keep them as \"standard\" but disablable.",
    "created_at": "2021-03-12T21:50:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504286",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:82" align="right">comment:82</div>

I've reduced it from "blocker" as I am hopeful that #29537 will fix it.  And instead of making the packages "optional", I now propose to keep them as "standard" but disablable.



---

archive/issue_events_435111.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-12T22:03:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435111"
}
```



---

archive/issue_events_435112.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-12T22:03:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435112"
}
```



---

archive/issue_comments_504287.json:
```json
{
    "body": "Changed commit from **[`ce3b35f`](https://github.com/sagemath/sagetrac-mirror/commit/ce3b35fea3326528936af448d006119e6405626f)** to **[`49c10c1`](https://github.com/sagemath/sagetrac-mirror/commit/49c10c18991eed62d800f2fccc422a1a9e7555ce)**",
    "created_at": "2021-03-12T22:15:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504287",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ce3b35f`](https://github.com/sagemath/sagetrac-mirror/commit/ce3b35fea3326528936af448d006119e6405626f)** to **[`49c10c1`](https://github.com/sagemath/sagetrac-mirror/commit/49c10c18991eed62d800f2fccc422a1a9e7555ce)**



---

archive/issue_comments_504288.json:
```json
{
    "body": "<div id=\"comment:84\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/49c10c18991eed62d800f2fccc422a1a9e7555ce\"><code>49c10c1</code></a></td><td><code>Revert \"build/pkgs/{r,rpy2}: Downgrade to optional\"</code></td></tr></table>\n",
    "created_at": "2021-03-12T22:15:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504288",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:84"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/49c10c18991eed62d800f2fccc422a1a9e7555ce"><code>49c10c1</code></a></td><td><code>Revert "build/pkgs/{r,rpy2}: Downgrade to optional"</code></td></tr></table>




---

archive/issue_comments_504289.json:
```json
{
    "body": "Changed commit from **[`49c10c1`](https://github.com/sagemath/sagetrac-mirror/commit/49c10c18991eed62d800f2fccc422a1a9e7555ce)** to **[`f0a5fb5`](https://github.com/sagemath/sagetrac-mirror/commit/f0a5fb5adafd3d4c82c9d736dc95f49c67e15c39)**",
    "created_at": "2021-03-12T22:33:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504289",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`49c10c1`](https://github.com/sagemath/sagetrac-mirror/commit/49c10c18991eed62d800f2fccc422a1a9e7555ce)** to **[`f0a5fb5`](https://github.com/sagemath/sagetrac-mirror/commit/f0a5fb5adafd3d4c82c9d736dc95f49c67e15c39)**



---

archive/issue_comments_504290.json:
```json
{
    "body": "<div id=\"comment:85\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5141bc388f6834f68da8eb09bced2aa7c4641e83\"><code>5141bc3</code></a></td><td><code>build/pkgs/widgetsnbextension: Patch out dependency on notebook (backport from widgetsnbextension-4)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fee837900ba415a41235c712a577a1ded79046ca\"><code>fee8379</code></a></td><td><code>Merge #31278</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82d8030c3c71bb9e5503f77ae42484de47925381\"><code>82d8030</code></a></td><td><code>m4/sage_spkg_enable.m4: Cosmetic change to help strings</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3e929982937143bae88f66917870d39979cc3551\"><code>3e92998</code></a></td><td><code>configure --disable-notebook: Fix up what packages are disabled</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74a83fce03916650dd1574ee04c7f3a3dc6d5848\"><code>74a83fc</code></a></td><td><code>build/pkgs/matplotlib/dependencies: Undo removal of tornado</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/93d31b9bfca2f961b490f83cbf51bfa154a9748c\"><code>93d31b9</code></a></td><td><code>Remove use of unicode superscripts in configure --help</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18fbb8598e362f048ebd8a83f963da5b0d9905f3\"><code>18fbb85</code></a></td><td><code>m4/sage_spkg_collect.m4: Fix description of SAGE_OPTIONAL_CLEANED_PACKAGES</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c3e4093cd6ed304c271890f35f0075a2bacdf99a\"><code>c3e4093</code></a></td><td><code>Rename SAGE_OPTIONAL_CLEANED_PACKAGES to SAGE_OPTIONAL_UNINSTALLED_PACKAGES</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a67300bd66731b67fac776cfde1d8e0157392ef5\"><code>a67300b</code></a></td><td><code>Merge #30383</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0a5fb5adafd3d4c82c9d736dc95f49c67e15c39\"><code>f0a5fb5</code></a></td><td><code>configure.ac: Add option --disable-r</code></td></tr></table>\n",
    "created_at": "2021-03-12T22:33:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504290",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:85"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5141bc388f6834f68da8eb09bced2aa7c4641e83"><code>5141bc3</code></a></td><td><code>build/pkgs/widgetsnbextension: Patch out dependency on notebook (backport from widgetsnbextension-4)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fee837900ba415a41235c712a577a1ded79046ca"><code>fee8379</code></a></td><td><code>Merge #31278</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82d8030c3c71bb9e5503f77ae42484de47925381"><code>82d8030</code></a></td><td><code>m4/sage_spkg_enable.m4: Cosmetic change to help strings</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3e929982937143bae88f66917870d39979cc3551"><code>3e92998</code></a></td><td><code>configure --disable-notebook: Fix up what packages are disabled</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74a83fce03916650dd1574ee04c7f3a3dc6d5848"><code>74a83fc</code></a></td><td><code>build/pkgs/matplotlib/dependencies: Undo removal of tornado</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/93d31b9bfca2f961b490f83cbf51bfa154a9748c"><code>93d31b9</code></a></td><td><code>Remove use of unicode superscripts in configure --help</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18fbb8598e362f048ebd8a83f963da5b0d9905f3"><code>18fbb85</code></a></td><td><code>m4/sage_spkg_collect.m4: Fix description of SAGE_OPTIONAL_CLEANED_PACKAGES</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c3e4093cd6ed304c271890f35f0075a2bacdf99a"><code>c3e4093</code></a></td><td><code>Rename SAGE_OPTIONAL_CLEANED_PACKAGES to SAGE_OPTIONAL_UNINSTALLED_PACKAGES</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a67300bd66731b67fac776cfde1d8e0157392ef5"><code>a67300b</code></a></td><td><code>Merge #30383</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0a5fb5adafd3d4c82c9d736dc95f49c67e15c39"><code>f0a5fb5</code></a></td><td><code>configure.ac: Add option --disable-r</code></td></tr></table>




---

archive/issue_events_435113.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-12T22:37:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435113"
}
```



---

archive/issue_events_435114.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-12T22:37:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435114"
}
```



---

archive/issue_comments_504291.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,11 +1,14 @@\n-https://github.com/mkoeppe/sage/runs/1915093157\n+Prompted by a build failure of `r` on `cygwin-standard` in  https://github.com/mkoeppe/sage/runs/1915093157\n \n ```\n   [r-3.6.3]   blas.o: in function `dsymm_':\n   [r-3.6.3]   /opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/var/tmp/sage/build/r-3.6.3/src/src/extra/blas/blas.f:2986:(.text+0x4352): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `xerbla_'\n ```\n+we make it possible to disable R using a configure options so that one can get a working Sage installation in this way.\n \n-Discussions:\n+(The original build failure has hopefully resolved been resolved by #29537.)\n+\n+Previous tickets and discussions:\n - #29486\n - #29441\n - #29170\n``````\n",
    "created_at": "2021-03-12T22:37:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504291",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,11 +1,14 @@
-https://github.com/mkoeppe/sage/runs/1915093157
+Prompted by a build failure of `r` on `cygwin-standard` in  https://github.com/mkoeppe/sage/runs/1915093157
 
 ```
   [r-3.6.3]   blas.o: in function `dsymm_':
   [r-3.6.3]   /opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/var/tmp/sage/build/r-3.6.3/src/src/extra/blas/blas.f:2986:(.text+0x4352): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `xerbla_'
 ```
+we make it possible to disable R using a configure options so that one can get a working Sage installation in this way.
 
-Discussions:
+(The original build failure has hopefully resolved been resolved by #29537.)
+
+Previous tickets and discussions:
 - #29486
 - #29441
 - #29170
``````




---

archive/issue_events_435115.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-12T22:37:41Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "title_is": "Make it possible to disable build of r, rpy2 using ./configure --disable-r",
    "title_was": "cygwin-standard: r build fails ... Make it possible to disable build of r, rpy2 using ./configure --disable-r",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435115"
}
```



---

archive/issue_comments_504292.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">comment:87</div>\n\nThere seems to be a simpler bug here that I don't think is addressed yet by any of your fixes. I didn't know there was now an `--enable-fat-binary` flag to configure. I'm glad there is, and it makes sense. But perhaps because of that the `SAGE_FAT_BINARY` environment variable is being ignored. I added `set -x` to the splg-install for openblas and can see that its value is getting unset, which is why the CI configuration wasn't picking it up either despite having it in `env`. I think, if set, `SAGE_FAT_BINARY` should still override whatever was passed to configure.",
    "created_at": "2021-03-13T13:33:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504292",
    "user": "https://github.com/embray"
}
```

<div id="comment:87" align="right">comment:87</div>

There seems to be a simpler bug here that I don't think is addressed yet by any of your fixes. I didn't know there was now an `--enable-fat-binary` flag to configure. I'm glad there is, and it makes sense. But perhaps because of that the `SAGE_FAT_BINARY` environment variable is being ignored. I added `set -x` to the splg-install for openblas and can see that its value is getting unset, which is why the CI configuration wasn't picking it up either despite having it in `env`. I think, if set, `SAGE_FAT_BINARY` should still override whatever was passed to configure.



---

archive/issue_comments_504293.json:
```json
{
    "body": "<div id=\"comment:88\" align=\"right\">comment:88</div>\n\nReplying to [@embray](#comment:87):\n> There seems to be a simpler bug here that I don't think is addressed yet by any of your fixes.\n\nThe simple bug was -- as you correctly suspected -- in my CI script. The testing is done through tox, which does not pass through environment variables (except for those explicitly configured to be passed through).",
    "created_at": "2021-03-13T16:47:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504293",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:88" align="right">comment:88</div>

Replying to [@embray](#comment:87):
> There seems to be a simpler bug here that I don't think is addressed yet by any of your fixes.

The simple bug was -- as you correctly suspected -- in my CI script. The testing is done through tox, which does not pass through environment variables (except for those explicitly configured to be passed through).



---

archive/issue_comments_504294.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">comment:89</div>\n\n(see commit 1092d4b in #29537)",
    "created_at": "2021-03-13T16:47:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504294",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:89" align="right">comment:89</div>

(see commit 1092d4b in #29537)



---

archive/issue_comments_504295.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">comment:90</div>\n\nReplying to [@embray](#comment:87):\n> I didn't know there was now an `--enable-fat-binary` flag to configure. I'm glad there is, and it makes sense. But perhaps because of that the `SAGE_FAT_BINARY` environment variable is being ignored. \n\nThis was done in #30375.  Both `SAGE_FAT_BINARY` and the option `--enable-fat-binary` are respected at `configure` time and are made persistent for the build through `build/bin/sage-build-env-config`. Mixing in the environment variable set at `make` time is not done; I don't think this is a problem.",
    "created_at": "2021-03-13T17:07:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504295",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:90" align="right">comment:90</div>

Replying to [@embray](#comment:87):
> I didn't know there was now an `--enable-fat-binary` flag to configure. I'm glad there is, and it makes sense. But perhaps because of that the `SAGE_FAT_BINARY` environment variable is being ignored. 

This was done in #30375.  Both `SAGE_FAT_BINARY` and the option `--enable-fat-binary` are respected at `configure` time and are made persistent for the build through `build/bin/sage-build-env-config`. Mixing in the environment variable set at `make` time is not done; I don't think this is a problem.



---

archive/issue_comments_504296.json:
```json
{
    "body": "Changed commit from **[`f0a5fb5`](https://github.com/sagemath/sagetrac-mirror/commit/f0a5fb5adafd3d4c82c9d736dc95f49c67e15c39)** to **[`f04c134`](https://github.com/sagemath/sagetrac-mirror/commit/f04c13484c85c5d07e76cc9f306e70553fc74c6c)**",
    "created_at": "2021-03-15T00:06:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504296",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f0a5fb5`](https://github.com/sagemath/sagetrac-mirror/commit/f0a5fb5adafd3d4c82c9d736dc95f49c67e15c39)** to **[`f04c134`](https://github.com/sagemath/sagetrac-mirror/commit/f04c13484c85c5d07e76cc9f306e70553fc74c6c)**



---

archive/issue_comments_504297.json:
```json
{
    "body": "<div id=\"comment:91\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4916415408a58e4b715143e5c607972822055790\"><code>4916415</code></a></td><td><code>Merge tag '9.3.beta9' into t/30383/new_package_type__optional_enabled_by_default</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f04c13484c85c5d07e76cc9f306e70553fc74c6c\"><code>f04c134</code></a></td><td><code>Merge branch 't/30383/new_package_type__optional_enabled_by_default' into t/31409/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional</code></td></tr></table>\n",
    "created_at": "2021-03-15T00:06:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504297",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:91"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4916415408a58e4b715143e5c607972822055790"><code>4916415</code></a></td><td><code>Merge tag '9.3.beta9' into t/30383/new_package_type__optional_enabled_by_default</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f04c13484c85c5d07e76cc9f306e70553fc74c6c"><code>f04c134</code></a></td><td><code>Merge branch 't/30383/new_package_type__optional_enabled_by_default' into t/31409/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional</code></td></tr></table>




---

archive/issue_comments_504298.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">comment:92</div>\n\nReplying to [@mkoeppe](#comment:90):\n> Replying to [@embray](#comment:87):\n> > I didn't know there was now an `--enable-fat-binary` flag to configure. I'm glad there is, and it makes sense. But perhaps because of that the `SAGE_FAT_BINARY` environment variable is being ignored. \n\n> \n> This was done in #30375.  Both `SAGE_FAT_BINARY` and the option `--enable-fat-binary` are respected at `configure` time and are made persistent for the build through `build/bin/sage-build-env-config`. Mixing in the environment variable set at `make` time is not done; I don't think this is a problem.\n\nStill, it used to be possible to set it when running `make` as well.  I guess it's not so important, but it feels like a regression, and was confusing to me.",
    "created_at": "2021-03-17T15:51:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504298",
    "user": "https://github.com/embray"
}
```

<div id="comment:92" align="right">comment:92</div>

Replying to [@mkoeppe](#comment:90):
> Replying to [@embray](#comment:87):
> > I didn't know there was now an `--enable-fat-binary` flag to configure. I'm glad there is, and it makes sense. But perhaps because of that the `SAGE_FAT_BINARY` environment variable is being ignored. 

> 
> This was done in #30375.  Both `SAGE_FAT_BINARY` and the option `--enable-fat-binary` are respected at `configure` time and are made persistent for the build through `build/bin/sage-build-env-config`. Mixing in the environment variable set at `make` time is not done; I don't think this is a problem.

Still, it used to be possible to set it when running `make` as well.  I guess it's not so important, but it feels like a regression, and was confusing to me.



---

archive/issue_comments_504299.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">comment:93</div>\n\nReplying to [@embray](#comment:92):\n> it used to be possible to set it when running `make` as well.  I guess it's not so important, but it feels like a regression, and was confusing to me.\n\nI think the reasoning is that -- in contrast to `SAGE_DEBUG` and the compiler flags -- that it is not useful to control `SAGE_FAT_BINARY` for just a few packages -- you get a portable Sage distribution only if all packages are compiled like this. I would have no strong objections though to add it back though (in a separate ticket - it's unrelated to the present ticket).",
    "created_at": "2021-03-20T01:10:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504299",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:93" align="right">comment:93</div>

Replying to [@embray](#comment:92):
> it used to be possible to set it when running `make` as well.  I guess it's not so important, but it feels like a regression, and was confusing to me.

I think the reasoning is that -- in contrast to `SAGE_DEBUG` and the compiler flags -- that it is not useful to control `SAGE_FAT_BINARY` for just a few packages -- you get a portable Sage distribution only if all packages are compiled like this. I would have no strong objections though to add it back though (in a separate ticket - it's unrelated to the present ticket).



---

archive/issue_comments_504300.json:
```json
{
    "body": "<div id=\"comment:94\" align=\"right\">comment:94</div>\n\nThe present ticket needs review - it would be nice to get this into 9.3",
    "created_at": "2021-03-20T01:11:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504300",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:94" align="right">comment:94</div>

The present ticket needs review - it would be nice to get this into 9.3



---

archive/issue_comments_504301.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">comment:95</div>\n\n`./configure --help` does not print `--enable-r` as an option.",
    "created_at": "2021-03-23T21:09:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504301",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:95" align="right">comment:95</div>

`./configure --help` does not print `--enable-r` as an option.



---

archive/issue_comments_504302.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">comment:96</div>\n\nAlthough I see `./configure --disable-r`, so maybe it's not important.",
    "created_at": "2021-03-23T21:17:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504302",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:96" align="right">comment:96</div>

Although I see `./configure --disable-r`, so maybe it's not important.



---

archive/issue_comments_504303.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">comment:97</div>\n\nI think it's common practice to only show one of `--enable-...` and `--disable-...` depending on what is the default. \n\nFor our optional packages, I think we decided to list both because of the perhaps unusual semantics of `--disable-...` uninstalling a previously installed optional package.",
    "created_at": "2021-03-23T21:28:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504303",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:97" align="right">comment:97</div>

I think it's common practice to only show one of `--enable-...` and `--disable-...` depending on what is the default. 

For our optional packages, I think we decided to list both because of the perhaps unusual semantics of `--disable-...` uninstalling a previously installed optional package.



---

archive/issue_comments_504304.json:
```json
{
    "body": "<div id=\"comment:98\" align=\"right\">comment:98</div>\n\nReplying to [@mkoeppe](#comment:97):\n> For our optional packages, I think we decided to list both because of the perhaps unusual semantics of `--disable-...` uninstalling a previously installed optional package.\n\nAnd... of course because our default for optional depends on whether the package is already installed. And this information is not known at bootstrap time (when the help text is put together), only at configure time.",
    "created_at": "2021-03-23T21:30:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504304",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:98" align="right">comment:98</div>

Replying to [@mkoeppe](#comment:97):
> For our optional packages, I think we decided to list both because of the perhaps unusual semantics of `--disable-...` uninstalling a previously installed optional package.

And... of course because our default for optional depends on whether the package is already installed. And this information is not known at bootstrap time (when the help text is put together), only at configure time.



---

archive/issue_comments_504305.json:
```json
{
    "body": "Changed reviewer from **Fran\u00e7ois Bissey** to **Fran\u00e7ois Bissey, John Palmieri**",
    "created_at": "2021-03-24T02:02:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504305",
    "user": "https://github.com/jhpalmieri"
}
```

Changed reviewer from **François Bissey** to **François Bissey, John Palmieri**



---

archive/issue_events_435116.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2021-03-24T02:02:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435116"
}
```



---

archive/issue_events_435117.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2021-03-24T02:02:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435117"
}
```



---

archive/issue_comments_504306.json:
```json
{
    "body": "<div id=\"comment:99\" align=\"right\">comment:99</div>\n\nOkay, that makes sense. It works as advertised, so let's merge it.",
    "created_at": "2021-03-24T02:02:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504306",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:99" align="right">comment:99</div>

Okay, that makes sense. It works as advertised, so let's merge it.



---

archive/issue_comments_504307.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">comment:0</div>\n\nThanks!",
    "created_at": "2021-03-24T02:07:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504307",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:0" align="right">comment:0</div>

Thanks!



---

archive/issue_events_435118.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-29T23:54:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435118"
}
```



---

archive/issue_events_435119.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-29T23:54:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435119"
}
```



---

archive/issue_comments_504308.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nSetting priority to blocker to bring this ticket to the attention of the release bot.",
    "created_at": "2021-03-29T23:54:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504308",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:1" align="right">comment:1</div>

Setting priority to blocker to bring this ticket to the attention of the release bot.



---

archive/issue_comments_504309.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional)** to **[`f04c134`](https://github.com/sagemath/sagetrac-mirror/commit/f04c13484c85c5d07e76cc9f306e70553fc74c6c)**",
    "created_at": "2021-04-02T15:42:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31409#issuecomment-504309",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional)** to **[`f04c134`](https://github.com/sagemath/sagetrac-mirror/commit/f04c13484c85c5d07e76cc9f306e70553fc74c6c)**



---

archive/issue_events_435120.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-04-02T15:42:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435120"
}
```



---

archive/issue_events_435121.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "ad70e647c50976205bfccf33ff174d5d0df909af",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-04-02T15:42:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31409",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31409#event-435121"
}
```
