# Issue 31409: Make it possible to disable build of r, rpy2 using ./configure --disable-r

archive/issues_031172.json:
```json
{
    "body": "Prompted by a build failure of `r` on `cygwin-standard` in  https://github.com/mkoeppe/sage/runs/1915093157\n\n```\n  [r-3.6.3]   blas.o: in function `dsymm_':\n  [r-3.6.3]   /opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/var/tmp/sage/build/r-3.6.3/src/src/extra/blas/blas.f:2986:(.text+0x4352): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `xerbla_'\n```\nwe make it possible to disable R using a configure options so that one can get a working Sage installation in this way.\n\n(The original build failure has hopefully resolved been resolved by #29537.)\n\nPrevious tickets and discussions:\n- #29486\n- #29441\n- #29170\n- \u200bhttps://groups.google.com/g/sage-devel/c/IX3niEdmCEM/m/LovmF6gmIwAJ\n- https://wiki.sagemath.org/ReleaseTours/sage-9.2#rpy2_and_R\n- https://groups.google.com/g/sage-devel/c/alkG4veIsBk/m/432cxzpYAQAJ\n\nCC:  @embray @dimpase @orlitzky @jhpalmieri @kiwifb @novoselt @EmmanuelCharpentier @videlec @kliem\n\nBranch/Commit: f04c13484c85c5d07e76cc9f306e70553fc74c6c\n\nReviewer: Fran\u00e7ois Bissey, John Palmieri\n\nAuthor: Matthias Koeppe\n\nDependencies: #29537, #30383\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31409\n\n",
    "closed_at": "2021-04-02T15:42:50Z",
    "created_at": "2021-02-17T01:53:49Z",
    "labels": [
        "component: porting: cygwin",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Make it possible to disable build of r, rpy2 using ./configure --disable-r",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31409",
    "user": "https://github.com/mkoeppe"
}
```
Prompted by a build failure of `r` on `cygwin-standard` in  https://github.com/mkoeppe/sage/runs/1915093157

```
  [r-3.6.3]   blas.o: in function `dsymm_':
  [r-3.6.3]   /opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/var/tmp/sage/build/r-3.6.3/src/src/extra/blas/blas.f:2986:(.text+0x4352): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `xerbla_'
```
we make it possible to disable R using a configure options so that one can get a working Sage installation in this way.

(The original build failure has hopefully resolved been resolved by #29537.)

Previous tickets and discussions:
- #29486
- #29441
- #29170
- ​https://groups.google.com/g/sage-devel/c/IX3niEdmCEM/m/LovmF6gmIwAJ
- https://wiki.sagemath.org/ReleaseTours/sage-9.2#rpy2_and_R
- https://groups.google.com/g/sage-devel/c/alkG4veIsBk/m/432cxzpYAQAJ

CC:  @embray @dimpase @orlitzky @jhpalmieri @kiwifb @novoselt @EmmanuelCharpentier @videlec @kliem

Branch/Commit: f04c13484c85c5d07e76cc9f306e70553fc74c6c

Reviewer: François Bissey, John Palmieri

Author: Matthias Koeppe

Dependencies: #29537, #30383

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31409





---

archive/issue_comments_475570.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2021-02-17T02:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475570",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_475571.json:
```json
{
    "body": "<a id='comment:1'></a>Again we have a problem with `r`. As `cygwin` is one of our supported platforms and `r` is a standard package, this is a blocker.\n\n(More problems with R are around the corner, for wheel builds of Sage - #31396.)\n\n\nThis justifies another round of discussion for the proposal to downgrade the `r` and `rpy2` to \"optional\" packages - after #29486, #29170, https://groups.google.com/g/sage-devel/c/IX3niEdmCEM/m/LovmF6gmIwAJ\n\nIn #29170, `@`novoselt pointed out that supporting R is important for SageMathCell; and `@`fbissey mentioned that \"Suddenly dropping R/rpy2 feels rough. However, we don't have usage data to know how rough it would be.\"\n\nI think that we do need a bit of substantiation here given to make the case of keeping R supported as a standard package - and its cost of maintenance. Note that our R is also nontrivially patched and an update to the 4.x series is overdue, and nobody has stepped up to do this upgrade.",
    "created_at": "2021-02-17T02:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475571",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>Again we have a problem with `r`. As `cygwin` is one of our supported platforms and `r` is a standard package, this is a blocker.

(More problems with R are around the corner, for wheel builds of Sage - #31396.)


This justifies another round of discussion for the proposal to downgrade the `r` and `rpy2` to "optional" packages - after #29486, #29170, https://groups.google.com/g/sage-devel/c/IX3niEdmCEM/m/LovmF6gmIwAJ

In #29170, `@`novoselt pointed out that supporting R is important for SageMathCell; and `@`fbissey mentioned that "Suddenly dropping R/rpy2 feels rough. However, we don't have usage data to know how rough it would be."

I think that we do need a bit of substantiation here given to make the case of keeping R supported as a standard package - and its cost of maintenance. Note that our R is also nontrivially patched and an update to the 4.x series is overdue, and nobody has stepped up to do this upgrade.



---

archive/issue_comments_475572.json:
```json
{
    "body": "<a id='comment:2'></a>Maybe this is asking for a new type of package: standard on some platforms, optional on others.\n\nI have been \"using\" the system's R for a while now (\"using\" mean that Sage doesn't build it, not that I actually use it for anything). Can we distribute binaries that will use a system R installation? (Maybe this is a bad question, because at least on OS X, can we distribute functioning binaries in the first place?)",
    "created_at": "2021-02-17T03:00:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475572",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>Maybe this is asking for a new type of package: standard on some platforms, optional on others.

I have been "using" the system's R for a while now ("using" mean that Sage doesn't build it, not that I actually use it for anything). Can we distribute binaries that will use a system R installation? (Maybe this is a bad question, because at least on OS X, can we distribute functioning binaries in the first place?)



---

archive/issue_comments_475573.json:
```json
{
    "body": "<a id='comment:4'></a>rpy2 3.4.x has wheels for macOS - https://pypi.org/project/rpy2/#files\n\nWe should find out with what installation of R these wheels are supposed to work - hopefully R's official binary packages that are on CRAN - see https://mirror.las.iastate.edu/CRAN/\n\n---\nNew commits:",
    "created_at": "2021-02-17T04:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475573",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>rpy2 3.4.x has wheels for macOS - https://pypi.org/project/rpy2/#files

We should find out with what installation of R these wheels are supposed to work - hopefully R's official binary packages that are on CRAN - see https://mirror.las.iastate.edu/CRAN/

---
New commits:



---

archive/issue_comments_475574.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:2 jhpalmieri]:\n> (Maybe this is a bad question, because at least on OS X, can we distribute functioning binaries in the first place?)\n\n\nBinaries have been broken for a long time. I would be in favor of just following Dima's current practice of directing people to just use conda.",
    "created_at": "2021-02-17T05:00:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475574",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>Replying to [comment:2 jhpalmieri]:
> (Maybe this is a bad question, because at least on OS X, can we distribute functioning binaries in the first place?)


Binaries have been broken for a long time. I would be in favor of just following Dima's current practice of directing people to just use conda.



---

archive/issue_comments_475575.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-02-17T17:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475575",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_475576.json:
```json
{
    "body": "<a id='comment:7'></a>I am fine with that. But at the very least most of the doctests in `sage/interface/r.py` have to be marked optional. I haven't checked for import of `rpy` at this stage.",
    "created_at": "2021-02-17T18:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475576",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>I am fine with that. But at the very least most of the doctests in `sage/interface/r.py` have to be marked optional. I haven't checked for import of `rpy` at this stage.



---

archive/issue_comments_475577.json:
```json
{
    "body": "<a id='comment:8'></a>`sage/stats/r.py` relies on R being present. All doctests in there should be optional.",
    "created_at": "2021-02-17T20:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475577",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>`sage/stats/r.py` relies on R being present. All doctests in there should be optional.



---

archive/issue_comments_475578.json:
```json
{
    "body": "<a id='comment:9'></a>There are two doctests in `sage/repl/ipython_tests.py` that run R.\n\nTests for `_r_init_` in `sage/structure/sage_object.pyx`, I note interfaces for other optional packages (octave, mathematica, polymake...) do not have tests.\n\nThat's all that I can see and think of right now.",
    "created_at": "2021-02-17T20:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475578",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>There are two doctests in `sage/repl/ipython_tests.py` that run R.

Tests for `_r_init_` in `sage/structure/sage_object.pyx`, I note interfaces for other optional packages (octave, mathematica, polymake...) do not have tests.

That's all that I can see and think of right now.



---

archive/issue_comments_475579.json:
```json
{
    "body": "<a id='comment:10'></a>Instead of adding an optional tag to all doctests in these files, perhaps we should go through #30778.",
    "created_at": "2021-02-17T21:37:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475579",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>Instead of adding an optional tag to all doctests in these files, perhaps we should go through #30778.



---

archive/issue_comments_475580.json:
```json
{
    "body": "<a id='comment:11'></a>Yes, that would be the right way to go. In the spirit of splitting, r interface stuff should be splitted in its own package eventually. I guess it is now tagged \"early candidate\".",
    "created_at": "2021-02-17T22:57:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475580",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>Yes, that would be the right way to go. In the spirit of splitting, r interface stuff should be splitted in its own package eventually. I guess it is now tagged "early candidate".



---

archive/issue_comments_475581.json:
```json
{
    "body": "<a id='comment:12'></a>I have reduced #30778 to a more modest version that just handles \"optional\" tags as file directives instead of using \"sage_setup: distribution\" tags.",
    "created_at": "2021-02-18T00:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475581",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>I have reduced #30778 to a more modest version that just handles "optional" tags as file directives instead of using "sage_setup: distribution" tags.



---

archive/issue_comments_475582.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-18T22:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475582",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475583.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-18T22:49:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475583",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475584.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-18T22:51:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475584",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475585.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-18T23:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475585",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475586.json:
```json
{
    "body": "<a id='comment:17'></a>Because #30778 appears to be controversial, for the present ticket I have just added the line by line optional tags.  Ready for review.",
    "created_at": "2021-02-18T23:23:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475586",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>Because #30778 appears to be controversial, for the present ticket I have just added the line by line optional tags.  Ready for review.



---

archive/issue_comments_475587.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 mkoeppe]:\n> Because #30778 appears to be controversial, for the present ticket I have just added the line by line optional tags.  Ready for review.\n> \n\n\nI feel your pain. Having to do that is kind of terrible. Further checking will have to be with the bots. Let's go with the positive review now.",
    "created_at": "2021-02-18T23:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475587",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:18'></a>Replying to [comment:17 mkoeppe]:
> Because #30778 appears to be controversial, for the present ticket I have just added the line by line optional tags.  Ready for review.
> 


I feel your pain. Having to do that is kind of terrible. Further checking will have to be with the bots. Let's go with the positive review now.



---

archive/issue_comments_475588.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-18T23:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475588",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_475589.json:
```json
{
    "body": "<a id='comment:19'></a>Thank you!",
    "created_at": "2021-02-18T23:30:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475589",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>Thank you!



---

archive/issue_comments_475590.json:
```json
{
    "body": "<a id='comment:20'></a>Looks like there are a few more files with R tests (https://github.com/mkoeppe/sage/runs/1942659778):\n\n- src/doc/en/prep/Quickstarts/Statistics-and-Distributions.rst\n- src/sage/interfaces/interface.py\n- src/sage/misc/sageinspect.py",
    "created_at": "2021-02-21T06:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475590",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>Looks like there are a few more files with R tests (https://github.com/mkoeppe/sage/runs/1942659778):

- src/doc/en/prep/Quickstarts/Statistics-and-Distributions.rst
- src/sage/interfaces/interface.py
- src/sage/misc/sageinspect.py



---

archive/issue_comments_475591.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-02-21T06:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475591",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_475592.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-21T17:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475592",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475593.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-02-21T17:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475593",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_475594.json:
```json
{
    "body": "<a id='comment:23'></a>Right, those were more difficult to spot since they rely on the fact that the R interface is automatically imported in `sage/interfaces/all.py`. That run should have got all of them.",
    "created_at": "2021-02-21T19:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475594",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:23'></a>Right, those were more difficult to spot since they rely on the fact that the R interface is automatically imported in `sage/interfaces/all.py`. That run should have got all of them.



---

archive/issue_comments_475595.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-21T19:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475595",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_475596.json:
```json
{
    "body": "<a id='comment:24'></a>Thanks! I also just ran `make ptestlong-nodoc` and there are no more errors.",
    "created_at": "2021-02-21T19:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475596",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>Thanks! I also just ran `make ptestlong-nodoc` and there are no more errors.



---

archive/issue_comments_475597.json:
```json
{
    "body": "<a id='comment:25'></a>If addition of standard packages requires a mention on sage-devel then IMHO removal should, too...\n\nAlso, doesn't pass the testsuite:\n\n```\n**********************************************************************\nFile \"src/sage/repl/interpreter.py\", line 242, in sage.repl.interpreter.SageShellOverride.system_raw\nFailed example:\n    shell.system_raw('R --version')\nExpected:\n    R version ...\nGot:\n    /bin/sh: 1: R: not found\n**********************************************************************\nFile \"src/sage/repl/interpreter.py\", line 244, in sage.repl.interpreter.SageShellOverride.system_raw\nFailed example:\n    shell.user_ns['_exit_code']\nExpected:\n    0\nGot:\n    127\n**********************************************************************\n1 item had failures:\n   2 of  10 in sage.repl.interpreter.SageShellOverride.system_raw\n    [141 tests, 2 failures, 3.57 s]\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 578, in sage.tests.cmdline.test_executable\nFailed example:\n    out.find(\"R version \") >= 0\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 580, in sage.tests.cmdline.test_executable\nFailed example:\n    err\nExpected:\n    ''\nGot:\n    '/home/buildbot/slave/sage_git/build/src/bin/sage: line 627: exec: R: not found\\n'\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 582, in sage.tests.cmdline.test_executable\nFailed example:\n    ret\nExpected:\n    0\nGot:\n    127\n**********************************************************************\n1 item had failures:\n   3 of 231 in sage.tests.cmdline.test_executable\n    [230 tests, 3 failures, 29.96 s]\n----------------------------------------------------------------------\nsage -t --long --random-seed=0 src/sage/repl/interpreter.py  # 2 doctests failed\nsage -t --long --random-seed=0 src/sage/tests/cmdline.py  # 3 doctests failed\n----------------------------------------------------------------------\n```",
    "created_at": "2021-03-07T11:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475597",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>If addition of standard packages requires a mention on sage-devel then IMHO removal should, too...

Also, doesn't pass the testsuite:

```
**********************************************************************
File "src/sage/repl/interpreter.py", line 242, in sage.repl.interpreter.SageShellOverride.system_raw
Failed example:
    shell.system_raw('R --version')
Expected:
    R version ...
Got:
    /bin/sh: 1: R: not found
**********************************************************************
File "src/sage/repl/interpreter.py", line 244, in sage.repl.interpreter.SageShellOverride.system_raw
Failed example:
    shell.user_ns['_exit_code']
Expected:
    0
Got:
    127
**********************************************************************
1 item had failures:
   2 of  10 in sage.repl.interpreter.SageShellOverride.system_raw
    [141 tests, 2 failures, 3.57 s]
**********************************************************************
File "src/sage/tests/cmdline.py", line 578, in sage.tests.cmdline.test_executable
Failed example:
    out.find("R version ") >= 0
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/tests/cmdline.py", line 580, in sage.tests.cmdline.test_executable
Failed example:
    err
Expected:
    ''
Got:
    '/home/buildbot/slave/sage_git/build/src/bin/sage: line 627: exec: R: not found\n'
**********************************************************************
File "src/sage/tests/cmdline.py", line 582, in sage.tests.cmdline.test_executable
Failed example:
    ret
Expected:
    0
Got:
    127
**********************************************************************
1 item had failures:
   3 of 231 in sage.tests.cmdline.test_executable
    [230 tests, 3 failures, 29.96 s]
----------------------------------------------------------------------
sage -t --long --random-seed=0 src/sage/repl/interpreter.py  # 2 doctests failed
sage -t --long --random-seed=0 src/sage/tests/cmdline.py  # 3 doctests failed
----------------------------------------------------------------------
```



---

archive/issue_comments_475598.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-03-07T11:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475598",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_475599.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-07T23:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475599",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475600.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-03-07T23:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475600",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_475601.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:25 vbraun]:\n> If addition of standard packages requires a mention on sage-devel then IMHO removal should, too...\n\n\nI think this is a good point.",
    "created_at": "2021-03-07T23:51:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475601",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:28'></a>Replying to [comment:25 vbraun]:
> If addition of standard packages requires a mention on sage-devel then IMHO removal should, too...


I think this is a good point.



---

archive/issue_comments_475602.json:
```json
{
    "body": "<a id='comment:29'></a>There's nothing to discuss; it's trivial to make the packages standard again if someone steps up and fixes the packages.",
    "created_at": "2021-03-07T23:55:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475602",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>There's nothing to discuss; it's trivial to make the packages standard again if someone steps up and fixes the packages.



---

archive/issue_comments_475603.json:
```json
{
    "body": "<a id='comment:30'></a>The purpose of asking for a sage-devel vote when making a package standard, to my understanding, is that the additional future maintenance burden (and bloat) coming from a standard package should receive more scrutiny than one developer's \"positive review\". None of this applies to the present situation.",
    "created_at": "2021-03-08T00:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475603",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>The purpose of asking for a sage-devel vote when making a package standard, to my understanding, is that the additional future maintenance burden (and bloat) coming from a standard package should receive more scrutiny than one developer's "positive review". None of this applies to the present situation.



---

archive/issue_comments_475604.json:
```json
{
    "body": "<a id='comment:31'></a>You really don't think that people should be made aware that R is being downgraded?",
    "created_at": "2021-03-08T01:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475604",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:31'></a>You really don't think that people should be made aware that R is being downgraded?



---

archive/issue_comments_475605.json:
```json
{
    "body": "<a id='comment:32'></a>There will be a line in the list of merged tickets for the beta version that merges the ticket. I don't think this has greater urgency.",
    "created_at": "2021-03-08T01:37:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475605",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>There will be a line in the list of merged tickets for the beta version that merges the ticket. I don't think this has greater urgency.



---

archive/issue_comments_475606.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,6 +4,12 @@\n   [r-3.6.3]   blas.o: in function `dsymm_':\n   [r-3.6.3]   /opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/var/tmp/sage/build/r-3.6.3/src/src/extra/blas/blas.f:2986:(.text+0x4352): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `xerbla_'\n ```\n+\n+Discussions:\n+- #29486\n+- #29170\n+- \u200bhttps://groups.google.com/g/sage-devel/c/IX3niEdmCEM/m/LovmF6gmIwAJ\n+- https://groups.google.com/g/sage-devel/c/alkG4veIsBk/m/432cxzpYAQAJ\n \n Priority: critical\n \n``````\n",
    "created_at": "2021-03-08T06:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475606",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,6 +4,12 @@
   [r-3.6.3]   blas.o: in function `dsymm_':
   [r-3.6.3]   /opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/var/tmp/sage/build/r-3.6.3/src/src/extra/blas/blas.f:2986:(.text+0x4352): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `xerbla_'
 ```
+
+Discussions:
+- #29486
+- #29170
+- ​https://groups.google.com/g/sage-devel/c/IX3niEdmCEM/m/LovmF6gmIwAJ
+- https://groups.google.com/g/sage-devel/c/alkG4veIsBk/m/432cxzpYAQAJ
 
 Priority: critical
 
``````




---

archive/issue_comments_475607.json:
```json
{
    "body": "<a id='comment:34'></a>I agree with the ticket, but I also think its common courtesy to give other developers a heads-up here.",
    "created_at": "2021-03-08T08:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475607",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:34'></a>I agree with the ticket, but I also think its common courtesy to give other developers a heads-up here.



---

archive/issue_events_082337.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-08T08:57:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31409#event-82337"
}
```



---

archive/issue_events_082338.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-08T13:05:22Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31409#event-82338"
}
```



---

archive/issue_events_082339.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-08T13:05:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31409#event-82339"
}
```



---

archive/issue_comments_475608.json:
```json
{
    "body": "<a id='comment:35'></a>Blocking 9.3, not 9.4",
    "created_at": "2021-03-08T13:05:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475608",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>Blocking 9.3, not 9.4



---

archive/issue_comments_475609.json:
```json
{
    "body": "<a id='comment:36'></a>> There will be a line in the list of merged tickets for the beta version that merges the ticket. I don't think this has greater urgency.\n\nYeah, that will *definitely* catch everyone's attention.\n\n---\n\nR is one of the oldest wheels of the car (not the current Python-style wheels, figurative wheels from days of yore).  We all know that once it's not supported, it will be more than broken.  At the very least,  before this is merged there should be some kind of automated message when R is invoked via Sage (via the innumerable examples out in the wild now, including in various books about \"how to use Sage\") that says \"here is a Sage website that will help you install an R that works with our interface, and here is what to do to get Sage to recognize it\".  For **non-POSIX geeks**, but for an ordinary user.  And then these now-optional doctests should be tested.\n\nIn particular, this is another piece of mission creep from \"viable competitor to M, M, M...\"  I do get the desire to decouple and ease upgrade processes for external software.   But for such an important piece of software (not least because of the innumerable packages) there should at the very least be an easy on-ramp to nudging people to install it when needed, and then some kind of testing.  Kind of like how OS X \"reminds\" one if you try to use `git` and don't yet have command line tools.",
    "created_at": "2021-03-09T04:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475609",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:36'></a>> There will be a line in the list of merged tickets for the beta version that merges the ticket. I don't think this has greater urgency.

Yeah, that will *definitely* catch everyone's attention.

---

R is one of the oldest wheels of the car (not the current Python-style wheels, figurative wheels from days of yore).  We all know that once it's not supported, it will be more than broken.  At the very least,  before this is merged there should be some kind of automated message when R is invoked via Sage (via the innumerable examples out in the wild now, including in various books about "how to use Sage") that says "here is a Sage website that will help you install an R that works with our interface, and here is what to do to get Sage to recognize it".  For **non-POSIX geeks**, but for an ordinary user.  And then these now-optional doctests should be tested.

In particular, this is another piece of mission creep from "viable competitor to M, M, M..."  I do get the desire to decouple and ease upgrade processes for external software.   But for such an important piece of software (not least because of the innumerable packages) there should at the very least be an easy on-ramp to nudging people to install it when needed, and then some kind of testing.  Kind of like how OS X "reminds" one if you try to use `git` and don't yet have command line tools.



---

archive/issue_comments_475610.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [comment:36 kcrisman]:\n> In particular, this is another piece of mission creep from \"viable competitor to M, M, M...\"  I do get the desire to decouple and ease upgrade processes for external software. \n\n\nThis ticket is about the very concrete problem that R does not build on one of our standard platforms, Cygwin, and we are not able to use the system R either.\n\nBecause failing standard packages block the entire build, we either need to fix it, or downgrade it from standard before the 9.3 release.",
    "created_at": "2021-03-09T04:22:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475610",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>Replying to [comment:36 kcrisman]:
> In particular, this is another piece of mission creep from "viable competitor to M, M, M..."  I do get the desire to decouple and ease upgrade processes for external software. 


This ticket is about the very concrete problem that R does not build on one of our standard platforms, Cygwin, and we are not able to use the system R either.

Because failing standard packages block the entire build, we either need to fix it, or downgrade it from standard before the 9.3 release.



---

archive/issue_comments_475611.json:
```json
{
    "body": "<a id='comment:38'></a>Replying to [comment:36 kcrisman]:\n> ... when R is invoked via Sage (via the innumerable examples out in the wild now, including in various books about \"how to use Sage\")\n\n\nDo you have any pointers to such examples?",
    "created_at": "2021-03-09T04:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475611",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'></a>Replying to [comment:36 kcrisman]:
> ... when R is invoked via Sage (via the innumerable examples out in the wild now, including in various books about "how to use Sage")


Do you have any pointers to such examples?



---

archive/issue_comments_475612.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,17 @@\n+https://github.com/mkoeppe/sage/runs/1915093157\n \n+```\n+  [r-3.6.3]   blas.o: in function `dsymm_':\n+  [r-3.6.3]   /opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/var/tmp/sage/build/r-3.6.3/src/src/extra/blas/blas.f:2986:(.text+0x4352): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `xerbla_'\n+```\n+\n+Discussions:\n+- #29486\n+- #29441\n+- #29170\n+- \u200bhttps://groups.google.com/g/sage-devel/c/IX3niEdmCEM/m/LovmF6gmIwAJ\n+- https://wiki.sagemath.org/ReleaseTours/sage-9.2#rpy2_and_R\n+- https://groups.google.com/g/sage-devel/c/alkG4veIsBk/m/432cxzpYAQAJ\n \n Priority: critical\n \n``````\n",
    "created_at": "2021-03-09T04:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475612",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,17 @@
+https://github.com/mkoeppe/sage/runs/1915093157
 
+```
+  [r-3.6.3]   blas.o: in function `dsymm_':
+  [r-3.6.3]   /opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/var/tmp/sage/build/r-3.6.3/src/src/extra/blas/blas.f:2986:(.text+0x4352): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `xerbla_'
+```
+
+Discussions:
+- #29486
+- #29441
+- #29170
+- ​https://groups.google.com/g/sage-devel/c/IX3niEdmCEM/m/LovmF6gmIwAJ
+- https://wiki.sagemath.org/ReleaseTours/sage-9.2#rpy2_and_R
+- https://groups.google.com/g/sage-devel/c/alkG4veIsBk/m/432cxzpYAQAJ
 
 Priority: critical
 
``````




---

archive/issue_comments_475613.json:
```json
{
    "body": "<a id='comment:40'></a>IIRC correctly, R is not mentioned in http://sagebook.gforge.inria.fr/english.html",
    "created_at": "2021-03-09T09:03:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475613",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:40'></a>IIRC correctly, R is not mentioned in http://sagebook.gforge.inria.fr/english.html



---

archive/issue_comments_475614.json:
```json
{
    "body": "<a id='comment:41'></a>As a point of reference, I've twice been in workshops with R experts where both Sage and R were being taught to students.  When I told the R people that since students have already installed Sage, they can use R through Sage.  But this did not interest them as they wanted to have students install RStudio anyways.\n\nDo we know about more than one person who uses R primarily through Sage?",
    "created_at": "2021-03-09T14:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475614",
    "user": "https://github.com/embray"
}
```

<a id='comment:41'></a>As a point of reference, I've twice been in workshops with R experts where both Sage and R were being taught to students.  When I told the R people that since students have already installed Sage, they can use R through Sage.  But this did not interest them as they wanted to have students install RStudio anyways.

Do we know about more than one person who uses R primarily through Sage?



---

archive/issue_comments_475615.json:
```json
{
    "body": "<a id='comment:42'></a>That said, I haven't really kept up with this issue.  What's the problem with R on cygwin?  Maybe I can just fix it.",
    "created_at": "2021-03-09T14:56:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475615",
    "user": "https://github.com/embray"
}
```

<a id='comment:42'></a>That said, I haven't really kept up with this issue.  What's the problem with R on cygwin?  Maybe I can just fix it.



---

archive/issue_comments_475616.json:
```json
{
    "body": "<a id='comment:43'></a>Replying to [comment:42 embray]:\n> What's the problem with R on cygwin? \n\nIt does not build; somehow BLAS-related. See ticket description.\n\nMore generally, we have been unable to use system BLAS and system R. #30163",
    "created_at": "2021-03-09T17:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475616",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>Replying to [comment:42 embray]:
> What's the problem with R on cygwin? 

It does not build; somehow BLAS-related. See ticket description.

More generally, we have been unable to use system BLAS and system R. #30163



---

archive/issue_comments_475617.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-03-10T13:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475617",
    "user": "https://github.com/embray"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_475618.json:
```json
{
    "body": "<a id='comment:44'></a>When did the problem start?  Did we upgrade R at some point?\n\nI'm not against the current proposal to make R optional, though I'm inclined to agree with William's point about having a deprecation period first.  I'll look into the build issue with R.\n\nAlternatively, if the R version was upgraded, resulting in this problem, could we not just revert the upgrade until a later version / when this is able to be fixed?",
    "created_at": "2021-03-10T13:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475618",
    "user": "https://github.com/embray"
}
```

<a id='comment:44'></a>When did the problem start?  Did we upgrade R at some point?

I'm not against the current proposal to make R optional, though I'm inclined to agree with William's point about having a deprecation period first.  I'll look into the build issue with R.

Alternatively, if the R version was upgraded, resulting in this problem, could we not just revert the upgrade until a later version / when this is able to be fixed?



---

archive/issue_comments_475619.json:
```json
{
    "body": "<a id='comment:45'></a>I'm looking at the Sage build on my Windows machine, and it seems I haven't updated it in some time (I think not since 9.3b2).  I already have r-3.6.3 built successfully.  But since I last updated it looks like openblas has been updated, so right now openblas is recompiling, then we'll see about r...",
    "created_at": "2021-03-10T13:58:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475619",
    "user": "https://github.com/embray"
}
```

<a id='comment:45'></a>I'm looking at the Sage build on my Windows machine, and it seems I haven't updated it in some time (I think not since 9.3b2).  I already have r-3.6.3 built successfully.  But since I last updated it looks like openblas has been updated, so right now openblas is recompiling, then we'll see about r...



---

archive/issue_comments_475620.json:
```json
{
    "body": "<a id='comment:46'></a>As of now, this issue is causing the CI tests of Cygwin to fail so we cannot even see other issues that affect Cygwin. \n\nSo let's please get this in to the next beta --- it is trivial to revert in a follow-up ticket if you succeed to fix the issue.",
    "created_at": "2021-03-10T15:28:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475620",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:46'></a>As of now, this issue is causing the CI tests of Cygwin to fail so we cannot even see other issues that affect Cygwin. 

So let's please get this in to the next beta --- it is trivial to revert in a follow-up ticket if you succeed to fix the issue.



---

archive/issue_comments_475621.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-03-10T15:28:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475621",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_475622.json:
```json
{
    "body": "<a id='comment:48'></a>Let me at least see if I can reproduce it locally first...\nI wonder if there's some way we could make some packages optional on a platform-specific basis (maybe when running bootstrap?)",
    "created_at": "2021-03-10T15:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475622",
    "user": "https://github.com/embray"
}
```

<a id='comment:48'></a>Let me at least see if I can reproduce it locally first...
I wonder if there's some way we could make some packages optional on a platform-specific basis (maybe when running bootstrap?)



---

archive/issue_comments_475623.json:
```json
{
    "body": "<a id='comment:49'></a>Replying to [comment:48 embray]:\n> I wonder if there's some way we could make some packages optional on a platform-specific basis\n\n\nYes, with #30383 (needs review!), which adds infrastructure for disabling standard packages.",
    "created_at": "2021-03-10T20:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475623",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:49'></a>Replying to [comment:48 embray]:
> I wonder if there's some way we could make some packages optional on a platform-specific basis


Yes, with #30383 (needs review!), which adds infrastructure for disabling standard packages.



---

archive/issue_comments_475624.json:
```json
{
    "body": "<a id='comment:50'></a>Replying to [comment:48 embray]:\n> Let me at least see if I can reproduce it locally first...\n> I wonder if there's some way we could make some packages optional on a platform-specific basis (maybe when running bootstrap?)\n\n\nAaaaarghhh...\n\nThis would be a documentation nightmare (explaining why a ticket is \"optionally optional\" is awkward at the very minimum...). It would also \"froze\" the idea of Windows 10 being a \"second-class citizen\" as far as Sage is concerned.\n\nI'm starting to consider promoting a WSL2 port as the preffered windows platform,and preparing a deprecation of the Cygwin port, which remains necessary as long as Windows \n versions <10 remain relevant only as rthe \"sanest\" way out of this predicament (\"sane\" being an hyperbole, of course...).\n\nBut this also should be discussed on `sage-devel`. Hence this [post](https://groups.google.com/g/sage-devel/c/alkG4veIsBk/m/AtNQ1KCMBgAJ)...",
    "created_at": "2021-03-10T21:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475624",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:50'></a>Replying to [comment:48 embray]:
> Let me at least see if I can reproduce it locally first...
> I wonder if there's some way we could make some packages optional on a platform-specific basis (maybe when running bootstrap?)


Aaaaarghhh...

This would be a documentation nightmare (explaining why a ticket is "optionally optional" is awkward at the very minimum...). It would also "froze" the idea of Windows 10 being a "second-class citizen" as far as Sage is concerned.

I'm starting to consider promoting a WSL2 port as the preffered windows platform,and preparing a deprecation of the Cygwin port, which remains necessary as long as Windows 
 versions <10 remain relevant only as rthe "sanest" way out of this predicament ("sane" being an hyperbole, of course...).

But this also should be discussed on `sage-devel`. Hence this [post](https://groups.google.com/g/sage-devel/c/alkG4veIsBk/m/AtNQ1KCMBgAJ)...



---

archive/issue_comments_475625.json:
```json
{
    "body": "<a id='comment:51'></a>online statistics says that among Windows installations, version 10 is approaching 80%. High time to think about WSL2 as a primary platform.",
    "created_at": "2021-03-11T08:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475625",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:51'></a>online statistics says that among Windows installations, version 10 is approaching 80%. High time to think about WSL2 as a primary platform.



---

archive/issue_comments_475626.json:
```json
{
    "body": "<a id='comment:52'></a>Moreover, the 2nd biggest, qua # of installs, is Windows version 7, on 16%, \nwhich is past its EOL, so it's either on very old machines which won't really be capable of running resouce-hungry Sage well, anyway, or on machines having some old, unupgradeable,  soft installed. Windows 8 (EOLed since 2016) is at 1% and 8.1, still supported, on 3.7%. \nhttps://gs.statcounter.com/windows-version-market-share/desktop/worldwide/\n\nI think we should really put more effort in WSL2, and much less effort in Cygwin.",
    "created_at": "2021-03-11T09:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475626",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:52'></a>Moreover, the 2nd biggest, qua # of installs, is Windows version 7, on 16%, 
which is past its EOL, so it's either on very old machines which won't really be capable of running resouce-hungry Sage well, anyway, or on machines having some old, unupgradeable,  soft installed. Windows 8 (EOLed since 2016) is at 1% and 8.1, still supported, on 3.7%. 
https://gs.statcounter.com/windows-version-market-share/desktop/worldwide/

I think we should really put more effort in WSL2, and much less effort in Cygwin.



---

archive/issue_comments_475627.json:
```json
{
    "body": "<a id='comment:53'></a>WSL2 is an installation nightmare for typical users.  But this is off-topic.\n\nI'm not even so sure the problem here has to do much with Cygwin.  I haven't been able to reproduce it on my local Cygwin install.\n\nIs this build also installing the system R?  I have reported problems before with installing the system R resulting in problems linking to the right BLAS.\n\nWSL will just give you a new and different set of problems.",
    "created_at": "2021-03-11T12:04:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475627",
    "user": "https://github.com/embray"
}
```

<a id='comment:53'></a>WSL2 is an installation nightmare for typical users.  But this is off-topic.

I'm not even so sure the problem here has to do much with Cygwin.  I haven't been able to reproduce it on my local Cygwin install.

Is this build also installing the system R?  I have reported problems before with installing the system R resulting in problems linking to the right BLAS.

WSL will just give you a new and different set of problems.



---

archive/issue_comments_475628.json:
```json
{
    "body": "<a id='comment:54'></a>Looking again at the build log where R failed, it looks like it is installing the system openblas and the system R.  I wonder if that could somehow be part of the problem.\n\nHave you tried modifying the build script to not install them and see if it works?  I know we also want to try getting it working with the system packages, but since they don't work yet anyways maybe we can forego their installation for now.\n\nIn the meantime I'll try a fresh cygwin install and see if I can reproduce the environment being used in the CI.",
    "created_at": "2021-03-11T18:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475628",
    "user": "https://github.com/embray"
}
```

<a id='comment:54'></a>Looking again at the build log where R failed, it looks like it is installing the system openblas and the system R.  I wonder if that could somehow be part of the problem.

Have you tried modifying the build script to not install them and see if it works?  I know we also want to try getting it working with the system packages, but since they don't work yet anyways maybe we can forego their installation for now.

In the meantime I'll try a fresh cygwin install and see if I can reproduce the environment being used in the CI.



---

archive/issue_comments_475629.json:
```json
{
    "body": "<a id='comment:55'></a>Replying to [comment:54 embray]:\n> In the meantime I'll try a fresh cygwin install and see if I can reproduce the environment being used in the CI.\n\n\nEasy to do by using `tox -e local-cygwin-choco-standard` in a minimal install of Cygwin + tox",
    "created_at": "2021-03-11T18:47:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475629",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:55'></a>Replying to [comment:54 embray]:
> In the meantime I'll try a fresh cygwin install and see if I can reproduce the environment being used in the CI.


Easy to do by using `tox -e local-cygwin-choco-standard` in a minimal install of Cygwin + tox



---

archive/issue_comments_475630.json:
```json
{
    "body": "<a id='comment:56'></a>Let's please not continue discussing WSL etc. here on this technical ticket. I have opened #31485 (Meta-ticket: Sage on WSL (Windows Subsystem for Linux)) for it. It would be helpful if someone could organize the discussion and the existing tickets in this direction there.",
    "created_at": "2021-03-11T18:55:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475630",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:56'></a>Let's please not continue discussing WSL etc. here on this technical ticket. I have opened #31485 (Meta-ticket: Sage on WSL (Windows Subsystem for Linux)) for it. It would be helpful if someone could organize the discussion and the existing tickets in this direction there.



---

archive/issue_comments_475631.json:
```json
{
    "body": "<a id='comment:57'></a>Replying to [comment:55 mkoeppe]:\n> Replying to [comment:54 embray]:\n> > In the meantime I'll try a fresh cygwin install and see if I can reproduce the environment being used in the CI.\n\n> \n> Easy to do by using `tox -e local-cygwin-choco-standard` in a minimal install of Cygwin + tox\n\n\nCool, thanks for the pointer.  I don't have chocolatey installed, but I did the equivalent using apt-cyg and the (very nice) `sage-get-system-packages` command.\n\nOf course if there's something *very* specific to the way chocolatey is installing the packages then that's a problem and I'll have to dig deeper.  Seems unlikely?",
    "created_at": "2021-03-12T11:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475631",
    "user": "https://github.com/embray"
}
```

<a id='comment:57'></a>Replying to [comment:55 mkoeppe]:
> Replying to [comment:54 embray]:
> > In the meantime I'll try a fresh cygwin install and see if I can reproduce the environment being used in the CI.

> 
> Easy to do by using `tox -e local-cygwin-choco-standard` in a minimal install of Cygwin + tox


Cool, thanks for the pointer.  I don't have chocolatey installed, but I did the equivalent using apt-cyg and the (very nice) `sage-get-system-packages` command.

Of course if there's something *very* specific to the way chocolatey is installing the packages then that's a problem and I'll have to dig deeper.  Seems unlikely?



---

archive/issue_comments_475632.json:
```json
{
    "body": "<a id='comment:58'></a>Fresh Cygwin install.  I installed all the `:standard:` packages recommended by `sage-get-system-packages`.\n\nRan `./bootstrap` then `./configure` with no additional arguments.  Then ran `make r`.\n\nFirst it builds and installs OpenBLAS.  Several hours later it builds and installs R with no problem.\n\nI am downloading the build artifacts from the [GitHub](GitHub) build to see if there are any more detailed logs about the R build there...",
    "created_at": "2021-03-12T15:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475632",
    "user": "https://github.com/embray"
}
```

<a id='comment:58'></a>Fresh Cygwin install.  I installed all the `:standard:` packages recommended by `sage-get-system-packages`.

Ran `./bootstrap` then `./configure` with no additional arguments.  Then ran `make r`.

First it builds and installs OpenBLAS.  Several hours later it builds and installs R with no problem.

I am downloading the build artifacts from the [GitHub](GitHub) build to see if there are any more detailed logs about the R build there...



---

archive/issue_comments_475633.json:
```json
{
    "body": "<a id='comment:59'></a>Here's one thing that stands out already.  On [GitHub](GitHub):\n\n```\nchecking for dgemm_ in -lopenblas ... yes\nchecking whether double complex BLAS can be used... no\n```\n\nOn my local build it has:\n\n```\nchecking for dgemm_ in -lopenblas ... yes\nchecking whether double complex BLAS can be used... yes\nchecking whether the BLAS is complete... yes\n```\n\nThe [GitHub](GitHub) build says no support for \"double complex BLAS\" and does not even mention the third check \"BLAS is complete\"",
    "created_at": "2021-03-12T15:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475633",
    "user": "https://github.com/embray"
}
```

<a id='comment:59'></a>Here's one thing that stands out already.  On [GitHub](GitHub):

```
checking for dgemm_ in -lopenblas ... yes
checking whether double complex BLAS can be used... no
```

On my local build it has:

```
checking for dgemm_ in -lopenblas ... yes
checking whether double complex BLAS can be used... yes
checking whether the BLAS is complete... yes
```

The [GitHub](GitHub) build says no support for "double complex BLAS" and does not even mention the third check "BLAS is complete"



---

archive/issue_comments_475634.json:
```json
{
    "body": "<a id='comment:60'></a>So the end result is on [GitHub](GitHub) R is not linking with openblas:\n\n```\n  External libraries:          readline, curl\n  Additional capabilities:     PNG, JPEG, TIFF, NLS, ICU\n  Options enabled:             shared R library, shared BLAS, R profiling\n\n  Capabilities skipped:        cairo\n  Options not enabled:         memory profiling\n```\n\nWhereas on my local build it has:\n\n```\n  External libraries:          readline, BLAS(OpenBLAS), LAPACK(generic), curl\n  Additional capabilities:     PNG, JPEG, TIFF, NLS, ICU\n  Options enabled:             shared R library, R profiling\n\n  Capabilities skipped:        cairo\n  Options not enabled:         shared BLAS, memory profiling\n```\n\nAnd the build error is occurring somewhere related to building R's baseline BLAS which AFAIK I've never tested on Cygwin since it always successfully links with OpenBLAS.\n\nNow the question is just why is the double complex check failing?",
    "created_at": "2021-03-12T15:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475634",
    "user": "https://github.com/embray"
}
```

<a id='comment:60'></a>So the end result is on [GitHub](GitHub) R is not linking with openblas:

```
  External libraries:          readline, curl
  Additional capabilities:     PNG, JPEG, TIFF, NLS, ICU
  Options enabled:             shared R library, shared BLAS, R profiling

  Capabilities skipped:        cairo
  Options not enabled:         memory profiling
```

Whereas on my local build it has:

```
  External libraries:          readline, BLAS(OpenBLAS), LAPACK(generic), curl
  Additional capabilities:     PNG, JPEG, TIFF, NLS, ICU
  Options enabled:             shared R library, R profiling

  Capabilities skipped:        cairo
  Options not enabled:         shared BLAS, memory profiling
```

And the build error is occurring somewhere related to building R's baseline BLAS which AFAIK I've never tested on Cygwin since it always successfully links with OpenBLAS.

Now the question is just why is the double complex check failing?



---

archive/issue_comments_475635.json:
```json
{
    "body": "<a id='comment:61'></a>Replying to [comment:57 embray]:\n> Of course if there's something *very* specific to the way chocolatey is installing the packages then that's a problem and I'll have to dig deeper.  Seems unlikely?\n\n\nUnlikely. Chocolatey really just calls cygwin's `setup_....exe` many times.",
    "created_at": "2021-03-12T16:05:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475635",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:61'></a>Replying to [comment:57 embray]:
> Of course if there's something *very* specific to the way chocolatey is installing the packages then that's a problem and I'll have to dig deeper.  Seems unlikely?


Unlikely. Chocolatey really just calls cygwin's `setup_....exe` many times.



---

archive/issue_comments_475636.json:
```json
{
    "body": "<a id='comment:62'></a>The openblas logs on [GitHub](GitHub) do show successful build an installation, though the `make check` fails with a bunch of things like:\n\n```\ngfortran -O2 -Wall -frecursive -fno-optimize-sibling-calls -m64 -msse3 -mssse3 -msse4.1 -mavx -mavx2 -mfma -march=skylake-avx512 -fno-asynchronous-unwind-tables -mavx2  -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib -Wl,-rpath,/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib  -o sblat1 sblat1.o ../cygopenblas_skylakexp-r0.3.13.a -lgfortran -lgfortran -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/10 -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../lib -L/lib/../lib -L/usr/lib/../lib -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../..  -lcygwin  \n/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: sblat1.o:sblat1.f:(.text+0x67d): undefined reference to `srot_'\nsblat1.o:sblat1.f:(.text+0x67d): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `srot_'\n/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: sblat1.o:sblat1.f:(.text+0xbae): undefined reference to `srot_'\nsblat1.o:sblat1.f:(.text+0xbae): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `srot_'\n/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: sblat1.o:sblat1.f:(.text+0xe99): undefined reference to `sdsdot_'\nsblat1.o:sblat1.f:(.text+0xe99): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `sdsdot_'\n/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: sblat1.o:sblat1.f:(.text+0xfde): undefined reference to `sdot_'\n...\n```\n\nBut this looks more like a problem in the make check.  Why is it trying to link to some `../cygopenblas_skylakexp-r0.3.13.a` when the build produced `cygopenblas_haswellp-r0.3.13.a` not skylake?\n\nProbably not related though...\n\nIt looks like it produced `cygopenblas.dll` just fine:\n\n```\ngcc -O2 -g -march=native -O2 -DMAX_STACK_ALLOC=2048 -Wall -m64 -DF_INTERFACE_GFORT -DNO_AVX512 -DSMP_SERVER -DNO_WARMUP -DMAX_CPU_NUMBER=2 -DMAX_PARALLEL_NUMBER=1 -DUSE_TLS -DBUILD_SINGLE=1 -DBUILD_DOUBLE=1 -DBUILD_COMPLEX=1 -DBUILD_COMPLEX16=1 -DVERSION=\\\"0.3.13\\\" -msse3 -mssse3 -msse4.1 -mavx -mavx2 -mfma -mavx2 -UASMNAME -UASMFNAME -UNAME -UCNAME -UCHAR_NAME -UCHAR_CNAME -DASMNAME= -DASMFNAME=_ -DNAME=_ -DCNAME= -DCHAR_NAME=\\\"_\\\" -DCHAR_CNAME=\\\"\\\" -DNO_AFFINITY -I. -O2 -DMAX_STACK_ALLOC=2048 -Wall -m64 -DF_INTERFACE_GFORT -DNO_AVX512 -DSMP_SERVER -DNO_WARMUP -DMAX_CPU_NUMBER=2 -DMAX_PARALLEL_NUMBER=1 -DUSE_TLS -DBUILD_SINGLE=1 -DBUILD_DOUBLE=1 -DBUILD_COMPLEX=1 -DBUILD_COMPLEX16=1 -DVERSION=\\\"0.3.13\\\" -msse3 -mssse3 -msse4.1 -mavx -mavx2 -mfma -mavx2 -UASMNAME -UASMFNAME -UNAME -UCNAME -UCHAR_NAME -UCHAR_CNAME -DASMNAME= -DASMFNAME=_ -DNAME=_ -DCNAME= -DCHAR_NAME=\\\"_\\\" -DCHAR_CNAME=\\\"\\\" -DNO_AFFINITY -I.. -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib -Wl,-rpath,/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib  cygopenblas.def dllinit.o \\\n-shared -o ../cygopenblas.dll -Wl,--out-implib,../libopenblas.dll.a \\\n-Wl,--whole-archive ../cygopenblas_haswellp-r0.3.13.a -Wl,--no-whole-archive -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/10 -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../lib -L/lib/../lib -L/usr/lib/../lib -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../..  -lgfortran -lquadmath -lm -lcygwin   -lgfortran -lgfortran\n```",
    "created_at": "2021-03-12T16:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475636",
    "user": "https://github.com/embray"
}
```

<a id='comment:62'></a>The openblas logs on [GitHub](GitHub) do show successful build an installation, though the `make check` fails with a bunch of things like:

```
gfortran -O2 -Wall -frecursive -fno-optimize-sibling-calls -m64 -msse3 -mssse3 -msse4.1 -mavx -mavx2 -mfma -march=skylake-avx512 -fno-asynchronous-unwind-tables -mavx2  -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib -Wl,-rpath,/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib  -o sblat1 sblat1.o ../cygopenblas_skylakexp-r0.3.13.a -lgfortran -lgfortran -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/10 -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../lib -L/lib/../lib -L/usr/lib/../lib -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../..  -lcygwin  
/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: sblat1.o:sblat1.f:(.text+0x67d): undefined reference to `srot_'
sblat1.o:sblat1.f:(.text+0x67d): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `srot_'
/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: sblat1.o:sblat1.f:(.text+0xbae): undefined reference to `srot_'
sblat1.o:sblat1.f:(.text+0xbae): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `srot_'
/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: sblat1.o:sblat1.f:(.text+0xe99): undefined reference to `sdsdot_'
sblat1.o:sblat1.f:(.text+0xe99): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `sdsdot_'
/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: sblat1.o:sblat1.f:(.text+0xfde): undefined reference to `sdot_'
...
```

But this looks more like a problem in the make check.  Why is it trying to link to some `../cygopenblas_skylakexp-r0.3.13.a` when the build produced `cygopenblas_haswellp-r0.3.13.a` not skylake?

Probably not related though...

It looks like it produced `cygopenblas.dll` just fine:

```
gcc -O2 -g -march=native -O2 -DMAX_STACK_ALLOC=2048 -Wall -m64 -DF_INTERFACE_GFORT -DNO_AVX512 -DSMP_SERVER -DNO_WARMUP -DMAX_CPU_NUMBER=2 -DMAX_PARALLEL_NUMBER=1 -DUSE_TLS -DBUILD_SINGLE=1 -DBUILD_DOUBLE=1 -DBUILD_COMPLEX=1 -DBUILD_COMPLEX16=1 -DVERSION=\"0.3.13\" -msse3 -mssse3 -msse4.1 -mavx -mavx2 -mfma -mavx2 -UASMNAME -UASMFNAME -UNAME -UCNAME -UCHAR_NAME -UCHAR_CNAME -DASMNAME= -DASMFNAME=_ -DNAME=_ -DCNAME= -DCHAR_NAME=\"_\" -DCHAR_CNAME=\"\" -DNO_AFFINITY -I. -O2 -DMAX_STACK_ALLOC=2048 -Wall -m64 -DF_INTERFACE_GFORT -DNO_AVX512 -DSMP_SERVER -DNO_WARMUP -DMAX_CPU_NUMBER=2 -DMAX_PARALLEL_NUMBER=1 -DUSE_TLS -DBUILD_SINGLE=1 -DBUILD_DOUBLE=1 -DBUILD_COMPLEX=1 -DBUILD_COMPLEX16=1 -DVERSION=\"0.3.13\" -msse3 -mssse3 -msse4.1 -mavx -mavx2 -mfma -mavx2 -UASMNAME -UASMFNAME -UNAME -UCNAME -UCHAR_NAME -UCHAR_CNAME -DASMNAME= -DASMFNAME=_ -DNAME=_ -DCNAME= -DCHAR_NAME=\"_\" -DCHAR_CNAME=\"\" -DNO_AFFINITY -I.. -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib -Wl,-rpath,/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib  cygopenblas.def dllinit.o \
-shared -o ../cygopenblas.dll -Wl,--out-implib,../libopenblas.dll.a \
-Wl,--whole-archive ../cygopenblas_haswellp-r0.3.13.a -Wl,--no-whole-archive -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/10 -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../lib -L/lib/../lib -L/usr/lib/../lib -L/opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/lib -L/usr/lib/gcc/x86_64-pc-cygwin/10/../../..  -lgfortran -lquadmath -lm -lcygwin   -lgfortran -lgfortran
```



---

archive/issue_comments_475637.json:
```json
{
    "body": "<a id='comment:63'></a>Here is the relevant part in the R configure that checks for double complex support in the BLAS lib: https://github.com/wch/r-source/blob/78f3b069d6269ddde40d76515a1eef67df674435/m4/R.m4#L2642\n\nThere is a note in there:\n\n```\ndnl Now check if zdotu works (fails on AMD64 with the wrong compiler;\ndnl also fails on macOS with Accelerate/vecLib and gfortran; \ndnl but in that case we have a work-around using USE_VECLIB_G95FIX)\n```\n\nI don't know what they mean by that.  What is \"the wrong compiler\" in this case?\n\nPerhaps we could just toss in a patch to disable this check and see what happens?",
    "created_at": "2021-03-12T16:21:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475637",
    "user": "https://github.com/embray"
}
```

<a id='comment:63'></a>Here is the relevant part in the R configure that checks for double complex support in the BLAS lib: https://github.com/wch/r-source/blob/78f3b069d6269ddde40d76515a1eef67df674435/m4/R.m4#L2642

There is a note in there:

```
dnl Now check if zdotu works (fails on AMD64 with the wrong compiler;
dnl also fails on macOS with Accelerate/vecLib and gfortran; 
dnl but in that case we have a work-around using USE_VECLIB_G95FIX)
```

I don't know what they mean by that.  What is "the wrong compiler" in this case?

Perhaps we could just toss in a patch to disable this check and see what happens?



---

archive/issue_comments_475638.json:
```json
{
    "body": "<a id='comment:64'></a>I meant to add, I downloaded the build artifacts from GH and confirmed that the `cygopenblas.dll` is in the correct place and also exports the relevant symbols.",
    "created_at": "2021-03-12T16:21:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475638",
    "user": "https://github.com/embray"
}
```

<a id='comment:64'></a>I meant to add, I downloaded the build artifacts from GH and confirmed that the `cygopenblas.dll` is in the correct place and also exports the relevant symbols.



---

archive/issue_comments_475639.json:
```json
{
    "body": "<a id='comment:65'></a>Also in the previous check it did successfully link against `-lopenblas` and find the `dgemm_` symbol, so it's probably not a linking issue, but some problem with compiling and running the test for double complex support which is apparently known to fail sometimes?",
    "created_at": "2021-03-12T16:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475639",
    "user": "https://github.com/embray"
}
```

<a id='comment:65'></a>Also in the previous check it did successfully link against `-lopenblas` and find the `dgemm_` symbol, so it's probably not a linking issue, but some problem with compiling and running the test for double complex support which is apparently known to fail sometimes?



---

archive/issue_comments_475640.json:
```json
{
    "body": "<a id='comment:66'></a>Replying to [comment:62 embray]:\n> But this looks more like a problem in the make check.  Why is it trying to link to some `../cygopenblas_skylakexp-r0.3.13.a` when the build produced `cygopenblas_haswellp-r0.3.13.a` not skylake?\n> \n> Probably not related though...\n\n\nLooks like we forgot to update `openblas/spkg-check.in` -- it duplicates an old copy of settings made in `openblas/spkg-install.in`!!\nThis should really go through a common script",
    "created_at": "2021-03-12T16:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475640",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:66'></a>Replying to [comment:62 embray]:
> But this looks more like a problem in the make check.  Why is it trying to link to some `../cygopenblas_skylakexp-r0.3.13.a` when the build produced `cygopenblas_haswellp-r0.3.13.a` not skylake?
> 
> Probably not related though...


Looks like we forgot to update `openblas/spkg-check.in` -- it duplicates an old copy of settings made in `openblas/spkg-install.in`!!
This should really go through a common script



---

archive/issue_comments_475641.json:
```json
{
    "body": "<a id='comment:67'></a>I tried manually building the `conftest.f` from R's configure check and got this warning:\n\n```\n$ gfortran -c conftest.f\nconftest.f:15:72:\n\n   15 |  10      ztemp = ztemp + zx(i)*zx(i)\n      |                                                                        1\nWarning: Fortran 2018 deleted feature: DO termination statement which is not END DO or CONTINUE with label 10 at (1)\n```\n\nAnd in fact this was fixed upstream just a few months ago: https://github.com/wch/r-source/commit/b2e1bf7ee4a42288b56d77080ad942395b2fe4b0#diff-519bfce994ea1571b861581c2c200f396eb96ad94ba9bc74f20103dc1bda38dc\n\nI applied the upstream fix and the warning went away.  Maybe somewhere `-Werror` is getting set in `FFLAGS`.",
    "created_at": "2021-03-12T16:50:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475641",
    "user": "https://github.com/embray"
}
```

<a id='comment:67'></a>I tried manually building the `conftest.f` from R's configure check and got this warning:

```
$ gfortran -c conftest.f
conftest.f:15:72:

   15 |  10      ztemp = ztemp + zx(i)*zx(i)
      |                                                                        1
Warning: Fortran 2018 deleted feature: DO termination statement which is not END DO or CONTINUE with label 10 at (1)
```

And in fact this was fixed upstream just a few months ago: https://github.com/wch/r-source/commit/b2e1bf7ee4a42288b56d77080ad942395b2fe4b0#diff-519bfce994ea1571b861581c2c200f396eb96ad94ba9bc74f20103dc1bda38dc

I applied the upstream fix and the warning went away.  Maybe somewhere `-Werror` is getting set in `FFLAGS`.



---

archive/issue_comments_475642.json:
```json
{
    "body": "<a id='comment:68'></a>I figured out that it's possible to download the failed R build artifacts from GH (very nice, thank you).  Unfortunately the `config.log` does not say anything very helpful here:\n\n```\nconfigure:38593: checking whether double complex BLAS can be used\nconftestf.f:15:72:\n\n   15 |  10      ztemp = ztemp + zx(i)*zx(i)\n      |                                                                        1\nWarning: Fortran 2018 deleted feature: DO termination statement which is not END DO or CONTINUE with label 10 at (1)\nconfigure:38674: result: no\n```\n\nSomething the way the test is written it's not producing useful output.  It looks like the fortran compilation succeeds, with the warning, but only as a warning.  Probably the C compilation (or linking?) fails.  But it's not producing any output to the log.  I still can't reproduce a failure in this locally.",
    "created_at": "2021-03-12T17:35:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475642",
    "user": "https://github.com/embray"
}
```

<a id='comment:68'></a>I figured out that it's possible to download the failed R build artifacts from GH (very nice, thank you).  Unfortunately the `config.log` does not say anything very helpful here:

```
configure:38593: checking whether double complex BLAS can be used
conftestf.f:15:72:

   15 |  10      ztemp = ztemp + zx(i)*zx(i)
      |                                                                        1
Warning: Fortran 2018 deleted feature: DO termination statement which is not END DO or CONTINUE with label 10 at (1)
configure:38674: result: no
```

Something the way the test is written it's not producing useful output.  It looks like the fortran compilation succeeds, with the warning, but only as a warning.  Probably the C compilation (or linking?) fails.  But it's not producing any output to the log.  I still can't reproduce a failure in this locally.



---

archive/issue_comments_475643.json:
```json
{
    "body": "<a id='comment:69'></a>Replying to [comment:66 mkoeppe]:\n> Replying to [comment:62 embray]:\n> > But this looks more like a problem in the make check.  Why is it trying to link to some `../cygopenblas_skylakexp-r0.3.13.a` when the build produced `cygopenblas_haswellp-r0.3.13.a` not skylake?\n> > \n> > Probably not related though...\n\n> \n> Looks like we forgot to update `openblas/spkg-check.in` -- it duplicates an old copy of settings made in `openblas/spkg-install.in`!!\n> This should really go through a common script\n> \n\n\nI rebuilt openblas locally with `SAGE_CHECK=yes` and the checks passed.",
    "created_at": "2021-03-12T17:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475643",
    "user": "https://github.com/embray"
}
```

<a id='comment:69'></a>Replying to [comment:66 mkoeppe]:
> Replying to [comment:62 embray]:
> > But this looks more like a problem in the make check.  Why is it trying to link to some `../cygopenblas_skylakexp-r0.3.13.a` when the build produced `cygopenblas_haswellp-r0.3.13.a` not skylake?
> > 
> > Probably not related though...

> 
> Looks like we forgot to update `openblas/spkg-check.in` -- it duplicates an old copy of settings made in `openblas/spkg-install.in`!!
> This should really go through a common script
> 


I rebuilt openblas locally with `SAGE_CHECK=yes` and the checks passed.



---

archive/issue_comments_475644.json:
```json
{
    "body": "<a id='comment:70'></a>Replying to [comment:68 embray]:\n> {{{\n> configure:38593: checking whether double complex BLAS can be used\n> conftestf.f:15:72:\n> \n>    15 |  10      ztemp = ztemp + zx(i)*zx(i)\n>       |                                                                        1\n> Warning: Fortran 2018 deleted feature: DO termination statement which is not END DO or CONTINUE with label 10 at (1)\n> configure:38674: result: no\n> }}}\n> \n> Something the way the test is written it's not producing useful output.  It looks like the fortran compilation succeeds, with the warning, but only as a warning.  Probably the C compilation (or linking?) fails.  But it's not producing any output to the log.  I \n\n\nProbably should run this with CONFIG_SHELL=\"bash -x\"",
    "created_at": "2021-03-12T17:40:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475644",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:70'></a>Replying to [comment:68 embray]:
> {{{
> configure:38593: checking whether double complex BLAS can be used
> conftestf.f:15:72:
> 
>    15 |  10      ztemp = ztemp + zx(i)*zx(i)
>       |                                                                        1
> Warning: Fortran 2018 deleted feature: DO termination statement which is not END DO or CONTINUE with label 10 at (1)
> configure:38674: result: no
> }}}
> 
> Something the way the test is written it's not producing useful output.  It looks like the fortran compilation succeeds, with the warning, but only as a warning.  Probably the C compilation (or linking?) fails.  But it's not producing any output to the log.  I 


Probably should run this with CONFIG_SHELL="bash -x"



---

archive/issue_comments_475645.json:
```json
{
    "body": "<a id='comment:71'></a>Looking at the test code, I think it's likely the run test in https://github.com/wch/r-source/blob/78f3b069d6269ddde40d76515a1eef67df674435/m4/R.m4#L2704 that's failing.",
    "created_at": "2021-03-12T17:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475645",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:71'></a>Looking at the test code, I think it's likely the run test in https://github.com/wch/r-source/blob/78f3b069d6269ddde40d76515a1eef67df674435/m4/R.m4#L2704 that's failing.



---

archive/issue_comments_475646.json:
```json
{
    "body": "<a id='comment:72'></a>Replying to [comment:66 mkoeppe]:\n> Replying to [comment:62 embray]:\n> > But this looks more like a problem in the make check.  Why is it trying to link to some `../cygopenblas_skylakexp-r0.3.13.a` when the build produced `cygopenblas_haswellp-r0.3.13.a` not skylake?\n> > \n> > Probably not related though...\n\n> \n> Looks like we forgot to update `openblas/spkg-check.in` -- it duplicates an old copy of settings made in `openblas/spkg-install.in`!!\n> This should really go through a common script\n\n\nI'll do this in #31490",
    "created_at": "2021-03-12T17:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475646",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:72'></a>Replying to [comment:66 mkoeppe]:
> Replying to [comment:62 embray]:
> > But this looks more like a problem in the make check.  Why is it trying to link to some `../cygopenblas_skylakexp-r0.3.13.a` when the build produced `cygopenblas_haswellp-r0.3.13.a` not skylake?
> > 
> > Probably not related though...

> 
> Looks like we forgot to update `openblas/spkg-check.in` -- it duplicates an old copy of settings made in `openblas/spkg-install.in`!!
> This should really go through a common script


I'll do this in #31490



---

archive/issue_comments_475647.json:
```json
{
    "body": "<a id='comment:73'></a>Replying to [comment:71 mkoeppe]:\n> Looking at the test code, I think it's likely the run test in https://github.com/wch/r-source/blob/78f3b069d6269ddde40d76515a1eef67df674435/m4/R.m4#L2704 that's failing. \n\n\nNice call!  After trying to manually compile it with what I think are all the right flags I get:\n\n```\n$ ./conftest.exe\nIllegal instruction (core dumped)\n```",
    "created_at": "2021-03-12T18:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475647",
    "user": "https://github.com/embray"
}
```

<a id='comment:73'></a>Replying to [comment:71 mkoeppe]:
> Looking at the test code, I think it's likely the run test in https://github.com/wch/r-source/blob/78f3b069d6269ddde40d76515a1eef67df674435/m4/R.m4#L2704 that's failing. 


Nice call!  After trying to manually compile it with what I think are all the right flags I get:

```
$ ./conftest.exe
Illegal instruction (core dumped)
```



---

archive/issue_comments_475648.json:
```json
{
    "body": "<a id='comment:74'></a>Replying to [comment:73 embray]:\n> Replying to [comment:71 mkoeppe]:\n> > Looking at the test code, I think it's likely the run test in https://github.com/wch/r-source/blob/78f3b069d6269ddde40d76515a1eef67df674435/m4/R.m4#L2704 that's failing. \n\n> \n> Nice call!  After trying to manually compile it with what I think are all the right flags I get:\n> \n> \n> ```\n> $ ./conftest.exe\n> Illegal instruction (core dumped)\n> ```\n\n\nThis was linking against the OpenBLAS that was included in the build artifacts from [GitHub](GitHub).  If I link against my locally built OpenBLAS it works.\n\nSo the problem is again OpenBLAS, and apparently the fact that the OpenBLAS from the stage-i-a build artifacts is not portable, and possibly running on different CPUs between jobs?",
    "created_at": "2021-03-12T18:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475648",
    "user": "https://github.com/embray"
}
```

<a id='comment:74'></a>Replying to [comment:73 embray]:
> Replying to [comment:71 mkoeppe]:
> > Looking at the test code, I think it's likely the run test in https://github.com/wch/r-source/blob/78f3b069d6269ddde40d76515a1eef67df674435/m4/R.m4#L2704 that's failing. 

> 
> Nice call!  After trying to manually compile it with what I think are all the right flags I get:
> 
> 
> ```
> $ ./conftest.exe
> Illegal instruction (core dumped)
> ```


This was linking against the OpenBLAS that was included in the build artifacts from [GitHub](GitHub).  If I link against my locally built OpenBLAS it works.

So the problem is again OpenBLAS, and apparently the fact that the OpenBLAS from the stage-i-a build artifacts is not portable, and possibly running on different CPUs between jobs?



---

archive/issue_comments_475649.json:
```json
{
    "body": "<a id='comment:75'></a>That's quite possible...  Would be great if all of our problems could be fixed by making OpenBLAS properly portable!",
    "created_at": "2021-03-12T18:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475649",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:75'></a>That's quite possible...  Would be great if all of our problems could be fixed by making OpenBLAS properly portable!



---

archive/issue_comments_475650.json:
```json
{
    "body": "<a id='comment:76'></a>Looking at the openblas build logs, I see it is not building with `DYNAMIC_ARCH=1`.  Does this mean the GH builds are not using `SAGE_FAT_BINARY`?  Perhaps that would fix all this.",
    "created_at": "2021-03-12T18:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475650",
    "user": "https://github.com/embray"
}
```

<a id='comment:76'></a>Looking at the openblas build logs, I see it is not building with `DYNAMIC_ARCH=1`.  Does this mean the GH builds are not using `SAGE_FAT_BINARY`?  Perhaps that would fix all this.



---

archive/issue_comments_475651.json:
```json
{
    "body": "<a id='comment:77'></a>They do use SAGE_FAT_BINARY - see top of `ci-cygwin-standard.yml`",
    "created_at": "2021-03-12T18:24:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475651",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:77'></a>They do use SAGE_FAT_BINARY - see top of `ci-cygwin-standard.yml`



---

archive/issue_comments_475652.json:
```json
{
    "body": "<a id='comment:78'></a>Replying to [comment:77 mkoeppe]:\n> They do use SAGE_FAT_BINARY - see top of `ci-cygwin-standard.yml`\n\n\nI see that now.\n\nBut looking again at the openblas build log from GH one of the first lines output, from the `echo` in `spkg-install.in`, is:\n\n```\nBuilding OpenBLAS: make\n```\n\nThis should say:\n\n```\nBuilding OpenBLAS: make DYNAMIC_ARCH=1\n```\n\nSo somewhere along the way the setting is being lost...",
    "created_at": "2021-03-12T18:40:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475652",
    "user": "https://github.com/embray"
}
```

<a id='comment:78'></a>Replying to [comment:77 mkoeppe]:
> They do use SAGE_FAT_BINARY - see top of `ci-cygwin-standard.yml`


I see that now.

But looking again at the openblas build log from GH one of the first lines output, from the `echo` in `spkg-install.in`, is:

```
Building OpenBLAS: make
```

This should say:

```
Building OpenBLAS: make DYNAMIC_ARCH=1
```

So somewhere along the way the setting is being lost...



---

archive/issue_comments_475653.json:
```json
{
    "body": "<a id='comment:79'></a>Can you check what its value in `build/bin/sage-build-env-config` is?",
    "created_at": "2021-03-12T18:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475653",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:79'></a>Can you check what its value in `build/bin/sage-build-env-config` is?



---

archive/issue_comments_475654.json:
```json
{
    "body": "<a id='comment:80'></a>Replying to [comment:78 embray]:\n> But looking again at the openblas build log [...]\n> This should say:\n> \n> \n> ```\n> Building OpenBLAS: make DYNAMIC_ARCH=1\n> ```\n> \n> So somewhere along the way the setting is being lost...\n\n\nYou are right, thanks for catching this. I may have a fix for this in https://github.com/mkoeppe/sage/runs/2098475692?check_suite_focus=true",
    "created_at": "2021-03-12T20:39:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475654",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:80'></a>Replying to [comment:78 embray]:
> But looking again at the openblas build log [...]
> This should say:
> 
> 
> ```
> Building OpenBLAS: make DYNAMIC_ARCH=1
> ```
> 
> So somewhere along the way the setting is being lost...


You are right, thanks for catching this. I may have a fix for this in https://github.com/mkoeppe/sage/runs/2098475692?check_suite_focus=true



---

archive/issue_comments_475655.json:
```json
{
    "body": "<a id='comment:81'></a>A fix is now in #29537, running in https://github.com/mkoeppe/sage/actions/runs/647547421",
    "created_at": "2021-03-12T21:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475655",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:81'></a>A fix is now in #29537, running in https://github.com/mkoeppe/sage/actions/runs/647547421



---

archive/issue_comments_475656.json:
```json
{
    "body": "<a id='comment:82'></a>I've reduced it from \"blocker\" as I am hopeful that #29537 will fix it.  And instead of making the packages \"optional\", I now propose to keep them as \"standard\" but disablable.",
    "created_at": "2021-03-12T21:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475656",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:82'></a>I've reduced it from "blocker" as I am hopeful that #29537 will fix it.  And instead of making the packages "optional", I now propose to keep them as "standard" but disablable.



---

archive/issue_comments_475657.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-03-12T22:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475657",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_475658.json:
```json
{
    "body": "<a id='comment:84'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-12T22:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475658",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:84'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475659.json:
```json
{
    "body": "<a id='comment:85'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-03-12T22:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475659",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:85'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_475660.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-03-12T22:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475660",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_475661.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,20 @@\n+Prompted by a build failure of `r` on `cygwin-standard` in  https://github.com/mkoeppe/sage/runs/1915093157\n \n+```\n+  [r-3.6.3]   blas.o: in function `dsymm_':\n+  [r-3.6.3]   /opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/var/tmp/sage/build/r-3.6.3/src/src/extra/blas/blas.f:2986:(.text+0x4352): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `xerbla_'\n+```\n+we make it possible to disable R using a configure options so that one can get a working Sage installation in this way.\n+\n+(The original build failure has hopefully resolved been resolved by #29537.)\n+\n+Previous tickets and discussions:\n+- #29486\n+- #29441\n+- #29170\n+- \u200bhttps://groups.google.com/g/sage-devel/c/IX3niEdmCEM/m/LovmF6gmIwAJ\n+- https://wiki.sagemath.org/ReleaseTours/sage-9.2#rpy2_and_R\n+- https://groups.google.com/g/sage-devel/c/alkG4veIsBk/m/432cxzpYAQAJ\n \n Priority: critical\n \n``````\n",
    "created_at": "2021-03-12T22:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475661",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,20 @@
+Prompted by a build failure of `r` on `cygwin-standard` in  https://github.com/mkoeppe/sage/runs/1915093157
 
+```
+  [r-3.6.3]   blas.o: in function `dsymm_':
+  [r-3.6.3]   /opt/sage-1e693c9ae51a53dad0fe099efc41439dc898f02f/var/tmp/sage/build/r-3.6.3/src/src/extra/blas/blas.f:2986:(.text+0x4352): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `xerbla_'
+```
+we make it possible to disable R using a configure options so that one can get a working Sage installation in this way.
+
+(The original build failure has hopefully resolved been resolved by #29537.)
+
+Previous tickets and discussions:
+- #29486
+- #29441
+- #29170
+- ​https://groups.google.com/g/sage-devel/c/IX3niEdmCEM/m/LovmF6gmIwAJ
+- https://wiki.sagemath.org/ReleaseTours/sage-9.2#rpy2_and_R
+- https://groups.google.com/g/sage-devel/c/alkG4veIsBk/m/432cxzpYAQAJ
 
 Priority: critical
 
``````




---

archive/issue_comments_475662.json:
```json
{
    "body": "<a id='comment:87'></a>There seems to be a simpler bug here that I don't think is addressed yet by any of your fixes. I didn't know there was now an `--enable-fat-binary` flag to configure. I'm glad there is, and it makes sense. But perhaps because of that the `SAGE_FAT_BINARY` environment variable is being ignored. I added `set -x` to the splg-install for openblas and can see that its value is getting unset, which is why the CI configuration wasn't picking it up either despite having it in `env`. I think, if set, `SAGE_FAT_BINARY` should still override whatever was passed to configure.",
    "created_at": "2021-03-13T13:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475662",
    "user": "https://github.com/embray"
}
```

<a id='comment:87'></a>There seems to be a simpler bug here that I don't think is addressed yet by any of your fixes. I didn't know there was now an `--enable-fat-binary` flag to configure. I'm glad there is, and it makes sense. But perhaps because of that the `SAGE_FAT_BINARY` environment variable is being ignored. I added `set -x` to the splg-install for openblas and can see that its value is getting unset, which is why the CI configuration wasn't picking it up either despite having it in `env`. I think, if set, `SAGE_FAT_BINARY` should still override whatever was passed to configure.



---

archive/issue_comments_475663.json:
```json
{
    "body": "<a id='comment:88'></a>Replying to [comment:87 embray]:\n> There seems to be a simpler bug here that I don't think is addressed yet by any of your fixes.\n\nThe simple bug was -- as you correctly suspected -- in my CI script. The testing is done through tox, which does not pass through environment variables (except for those explicitly configured to be passed through).",
    "created_at": "2021-03-13T16:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475663",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:88'></a>Replying to [comment:87 embray]:
> There seems to be a simpler bug here that I don't think is addressed yet by any of your fixes.

The simple bug was -- as you correctly suspected -- in my CI script. The testing is done through tox, which does not pass through environment variables (except for those explicitly configured to be passed through).



---

archive/issue_comments_475664.json:
```json
{
    "body": "<a id='comment:89'></a>(see commit 1092d4b in #29537)",
    "created_at": "2021-03-13T16:47:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475664",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:89'></a>(see commit 1092d4b in #29537)



---

archive/issue_comments_475665.json:
```json
{
    "body": "<a id='comment:90'></a>Replying to [comment:87 embray]:\n> I didn't know there was now an `--enable-fat-binary` flag to configure. I'm glad there is, and it makes sense. But perhaps because of that the `SAGE_FAT_BINARY` environment variable is being ignored. \n\n\nThis was done in #30375.  Both `SAGE_FAT_BINARY` and the option `--enable-fat-binary` are respected at `configure` time and are made persistent for the build through `build/bin/sage-build-env-config`. Mixing in the environment variable set at `make` time is not done; I don't think this is a problem.",
    "created_at": "2021-03-13T17:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475665",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:90'></a>Replying to [comment:87 embray]:
> I didn't know there was now an `--enable-fat-binary` flag to configure. I'm glad there is, and it makes sense. But perhaps because of that the `SAGE_FAT_BINARY` environment variable is being ignored. 


This was done in #30375.  Both `SAGE_FAT_BINARY` and the option `--enable-fat-binary` are respected at `configure` time and are made persistent for the build through `build/bin/sage-build-env-config`. Mixing in the environment variable set at `make` time is not done; I don't think this is a problem.



---

archive/issue_comments_475666.json:
```json
{
    "body": "<a id='comment:91'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-15T00:06:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475666",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:91'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475667.json:
```json
{
    "body": "<a id='comment:92'></a>Replying to [comment:90 mkoeppe]:\n> Replying to [comment:87 embray]:\n> > I didn't know there was now an `--enable-fat-binary` flag to configure. I'm glad there is, and it makes sense. But perhaps because of that the `SAGE_FAT_BINARY` environment variable is being ignored. \n\n> \n> This was done in #30375.  Both `SAGE_FAT_BINARY` and the option `--enable-fat-binary` are respected at `configure` time and are made persistent for the build through `build/bin/sage-build-env-config`. Mixing in the environment variable set at `make` time is not done; I don't think this is a problem.\n\n\nStill, it used to be possible to set it when running `make` as well.  I guess it's not so important, but it feels like a regression, and was confusing to me.",
    "created_at": "2021-03-17T15:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475667",
    "user": "https://github.com/embray"
}
```

<a id='comment:92'></a>Replying to [comment:90 mkoeppe]:
> Replying to [comment:87 embray]:
> > I didn't know there was now an `--enable-fat-binary` flag to configure. I'm glad there is, and it makes sense. But perhaps because of that the `SAGE_FAT_BINARY` environment variable is being ignored. 

> 
> This was done in #30375.  Both `SAGE_FAT_BINARY` and the option `--enable-fat-binary` are respected at `configure` time and are made persistent for the build through `build/bin/sage-build-env-config`. Mixing in the environment variable set at `make` time is not done; I don't think this is a problem.


Still, it used to be possible to set it when running `make` as well.  I guess it's not so important, but it feels like a regression, and was confusing to me.



---

archive/issue_comments_475668.json:
```json
{
    "body": "<a id='comment:93'></a>Replying to [comment:92 embray]:\n> it used to be possible to set it when running `make` as well.  I guess it's not so important, but it feels like a regression, and was confusing to me.\n\n\nI think the reasoning is that -- in contrast to `SAGE_DEBUG` and the compiler flags -- that it is not useful to control `SAGE_FAT_BINARY` for just a few packages -- you get a portable Sage distribution only if all packages are compiled like this. I would have no strong objections though to add it back though (in a separate ticket - it's unrelated to the present ticket).",
    "created_at": "2021-03-20T01:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475668",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:93'></a>Replying to [comment:92 embray]:
> it used to be possible to set it when running `make` as well.  I guess it's not so important, but it feels like a regression, and was confusing to me.


I think the reasoning is that -- in contrast to `SAGE_DEBUG` and the compiler flags -- that it is not useful to control `SAGE_FAT_BINARY` for just a few packages -- you get a portable Sage distribution only if all packages are compiled like this. I would have no strong objections though to add it back though (in a separate ticket - it's unrelated to the present ticket).



---

archive/issue_comments_475669.json:
```json
{
    "body": "<a id='comment:94'></a>The present ticket needs review - it would be nice to get this into 9.3",
    "created_at": "2021-03-20T01:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475669",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:94'></a>The present ticket needs review - it would be nice to get this into 9.3



---

archive/issue_comments_475670.json:
```json
{
    "body": "<a id='comment:95'></a>`./configure --help` does not print `--enable-r` as an option.",
    "created_at": "2021-03-23T21:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475670",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:95'></a>`./configure --help` does not print `--enable-r` as an option.



---

archive/issue_comments_475671.json:
```json
{
    "body": "<a id='comment:96'></a>Although I see `./configure --disable-r`, so maybe it's not important.",
    "created_at": "2021-03-23T21:17:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475671",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:96'></a>Although I see `./configure --disable-r`, so maybe it's not important.



---

archive/issue_comments_475672.json:
```json
{
    "body": "<a id='comment:97'></a>I think it's common practice to only show one of `--enable-...` and `--disable-...` depending on what is the default. \n\nFor our optional packages, I think we decided to list both because of the perhaps unusual semantics of `--disable-...` uninstalling a previously installed optional package.",
    "created_at": "2021-03-23T21:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475672",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:97'></a>I think it's common practice to only show one of `--enable-...` and `--disable-...` depending on what is the default. 

For our optional packages, I think we decided to list both because of the perhaps unusual semantics of `--disable-...` uninstalling a previously installed optional package.



---

archive/issue_comments_475673.json:
```json
{
    "body": "<a id='comment:98'></a>Replying to [comment:97 mkoeppe]:\n> For our optional packages, I think we decided to list both because of the perhaps unusual semantics of `--disable-...` uninstalling a previously installed optional package.\n\n\nAnd... of course because our default for optional depends on whether the package is already installed. And this information is not known at bootstrap time (when the help text is put together), only at configure time.",
    "created_at": "2021-03-23T21:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475673",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:98'></a>Replying to [comment:97 mkoeppe]:
> For our optional packages, I think we decided to list both because of the perhaps unusual semantics of `--disable-...` uninstalling a previously installed optional package.


And... of course because our default for optional depends on whether the package is already installed. And this information is not known at bootstrap time (when the help text is put together), only at configure time.



---

archive/issue_comments_475674.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-03-24T02:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475674",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_475675.json:
```json
{
    "body": "<a id='comment:99'></a>Okay, that makes sense. It works as advertised, so let's merge it.",
    "created_at": "2021-03-24T02:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475675",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:99'></a>Okay, that makes sense. It works as advertised, so let's merge it.



---

archive/issue_comments_475676.json:
```json
{
    "body": "<a id='comment:0'></a>Thanks!",
    "created_at": "2021-03-24T02:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475676",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:0'></a>Thanks!



---

archive/issue_comments_475677.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2021-03-29T23:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475677",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_475678.json:
```json
{
    "body": "<a id='comment:1'></a>Setting priority to blocker to bring this ticket to the attention of the release bot.",
    "created_at": "2021-03-29T23:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475678",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>Setting priority to blocker to bring this ticket to the attention of the release bot.



---

archive/issue_events_082340.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-04-02T15:42:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31409#event-82340"
}
```



---

archive/issue_comments_475679.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-04-02T15:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31409#issuecomment-475679",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
