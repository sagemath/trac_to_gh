# Issue 31401: Segmentation fault when calculating the taylor series of a specific function

archive/issues_031164.json:
```json
{
    "body": "The following code evaluated in Sage 9.2 leads to a segmentation fault\n\n```\nsin(4*arctan(1/(sqrt(3) + 2))-x).taylor(x, 0, 1)\n```\n\nThe error message is\n\n```\n;;;\n;;; Detected access to protected memory, also known as 'bus or segmentation fault'.\n;;; Jumping to the outermost toplevel prompt\n;;;\n```\n\nChanging the constant slightly gives the desired result, e.g.\n\n```\nsin(4*arctan(1/(sqrt(3) + 1))-x).taylor(x, 0, 1)\n```\n\nevaluates to \n\n```\n-x*cos(4*arctan(1/2*sqrt(3) - 1/2)) + sin(4*arctan(1/2*sqrt(3) - 1/2))\n```\n\nUpstream report:\n\n- [Maxima bug 3716](https://sourceforge.net/p/maxima/bugs/3716/)\n\n**Keywords:** maxima, taylor series\n\n**Upstream:** Reported upstream. No feedback yet.\n\n**Status:** new\n\nIssue created by migration from https://trac.sagemath.org/ticket/31401\n\n",
    "created_at": "2021-02-15T14:01:35Z",
    "labels": [
        "component: calculus",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Segmentation fault when calculating the taylor series of a specific function",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31401",
    "user": "https://github.com/frcl"
}
```
The following code evaluated in Sage 9.2 leads to a segmentation fault

```
sin(4*arctan(1/(sqrt(3) + 2))-x).taylor(x, 0, 1)
```

The error message is

```
;;;
;;; Detected access to protected memory, also known as 'bus or segmentation fault'.
;;; Jumping to the outermost toplevel prompt
;;;
```

Changing the constant slightly gives the desired result, e.g.

```
sin(4*arctan(1/(sqrt(3) + 1))-x).taylor(x, 0, 1)
```

evaluates to 

```
-x*cos(4*arctan(1/2*sqrt(3) - 1/2)) + sin(4*arctan(1/2*sqrt(3) - 1/2))
```

Upstream report:

- [Maxima bug 3716](https://sourceforge.net/p/maxima/bugs/3716/)

**Keywords:** maxima, taylor series

**Upstream:** Reported upstream. No feedback yet.

**Status:** new

Issue created by migration from https://trac.sagemath.org/ticket/31401





---

archive/issue_comments_595507.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis is a maxima bug:\n\n```\n(%i1) taylor(sin(atan(1/(sqrt(3) + 2)) - x), x, 0, 1);\n\n      Message from maxima's stderr stream: INFO: Control stack guard page unprotected\n      Control stack guard page temporarily disabled: proceed with caution\n      Control stack guard page temporarily disabled: proceed with caution\n      Maxima encountered a Lisp error:\n       Control stack exhausted (no more space for function call frames).\n      This is probably due to heavily nested or infinitely recursive function\n      calls, or a tail call that SBCL cannot or has not optimized away.\n```\nI tested with some other nonzero integers `a` and `b` in the place of `3` and `2`. It seems that the crash happens whenever `a < b^2` (including all cases where `a < 0`).",
    "created_at": "2021-02-16T07:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31401#issuecomment-595507",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:1'></a>
This is a maxima bug:

```
(%i1) taylor(sin(atan(1/(sqrt(3) + 2)) - x), x, 0, 1);

      Message from maxima's stderr stream: INFO: Control stack guard page unprotected
      Control stack guard page temporarily disabled: proceed with caution
      Control stack guard page temporarily disabled: proceed with caution
      Maxima encountered a Lisp error:
       Control stack exhausted (no more space for function call frames).
      This is probably due to heavily nested or infinitely recursive function
      calls, or a tail call that SBCL cannot or has not optimized away.
```
I tested with some other nonzero integers `a` and `b` in the place of `3` and `2`. It seems that the crash happens whenever `a < b^2` (including all cases where `a < 0`).



---

archive/issue_comments_595508.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"maxima, taylor series\".",
    "created_at": "2021-02-16T07:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31401#issuecomment-595508",
    "user": "https://github.com/DaveWitteMorris"
}
```

**Changing keywords** from "" to "maxima, taylor series".



---

archive/issue_comments_595509.json:
```json
{
    "body": "<a id='comment:2'></a>\nReplying to [gh-DaveWitteMorris](#comment%3A1):\n> I tested with some other nonzero integers `a` and `b` in the place of `3` and `2`. It seems that the crash happens whenever `a < b^2` (including all cases where `a < 0`).\n\n\nThis seems to be the case, except if `a` is a square number. I guess the `sqrt` is evaluated first in that case. This implies that the `sqrt` is somehow involved in triggering the bug.\n\nI will file a bug report on the maxima bug tracker. Should I close the ticket here?",
    "created_at": "2021-02-16T13:51:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31401#issuecomment-595509",
    "user": "https://github.com/frcl"
}
```

<a id='comment:2'></a>
Replying to [gh-DaveWitteMorris](#comment%3A1):
> I tested with some other nonzero integers `a` and `b` in the place of `3` and `2`. It seems that the crash happens whenever `a < b^2` (including all cases where `a < 0`).


This seems to be the case, except if `a` is a square number. I guess the `sqrt` is evaluated first in that case. This implies that the `sqrt` is somehow involved in triggering the bug.

I will file a bug report on the maxima bug tracker. Should I close the ticket here?



---

archive/issue_comments_595510.json:
```json
{
    "body": "<a id='comment:3'></a>\nThanks for volunteering to report the bug to maxima (and for clarifying that `a` should not be a square). \n\nPlease keep this ticket open.  The \"Report Upstream\" field of this ticket should be set to \"Reported upstream. No feedback yet\", and that field can be updated as the situation progresses. It would also be helpful if you can add a comment here with a link to the maxima bug report, so it is easy for sage trac followers to check on the status in maxima.",
    "created_at": "2021-02-16T20:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31401#issuecomment-595510",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:3'></a>
Thanks for volunteering to report the bug to maxima (and for clarifying that `a` should not be a square). 

Please keep this ticket open.  The "Report Upstream" field of this ticket should be set to "Reported upstream. No feedback yet", and that field can be updated as the situation progresses. It would also be helpful if you can add a comment here with a link to the maxima bug report, so it is easy for sage trac followers to check on the status in maxima.



---

archive/issue_comments_595511.json:
```json
{
    "body": "<a id='comment:4'></a>\nPS If you need a workaround for the bug, you can replace `2` with a variable, and then substitute at the end:\n\n```\nsage: var('a');\nsage: sin(4*arctan(1/(sqrt(3) + a))-x).taylor(x, 0, 1).subs(a=2)\n-x*cos(4*arctan(1/(sqrt(3) + 2))) + sin(4*arctan(1/(sqrt(3) + 2)))\n```",
    "created_at": "2021-02-16T20:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31401#issuecomment-595511",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:4'></a>
PS If you need a workaround for the bug, you can replace `2` with a variable, and then substitute at the end:

```
sage: var('a');
sage: sin(4*arctan(1/(sqrt(3) + a))-x).taylor(x, 0, 1).subs(a=2)
-x*cos(4*arctan(1/(sqrt(3) + 2))) + sin(4*arctan(1/(sqrt(3) + 2)))
```



---

archive/issue_comments_595512.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -24,3 +24,7 @@\n ```\n -x*cos(4*arctan(1/2*sqrt(3) - 1/2)) + sin(4*arctan(1/2*sqrt(3) - 1/2))\n ```\n+\n+Upstream report:\n+\n+- [Maxima bug 3716](https://sourceforge.net/p/maxima/bugs/3716/)\n``````\n",
    "created_at": "2021-02-16T23:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31401#issuecomment-595512",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -24,3 +24,7 @@
 ```
 -x*cos(4*arctan(1/2*sqrt(3) - 1/2)) + sin(4*arctan(1/2*sqrt(3) - 1/2))
 ```
+
+Upstream report:
+
+- [Maxima bug 3716](https://sourceforge.net/p/maxima/bugs/3716/)
``````




---

archive/issue_comments_595513.json:
```json
{
    "body": "<a id='comment:5'></a>\nUpstream ticket in the Maxima bug tracker:\n\n- https://sourceforge.net/p/maxima/bugs/3716/",
    "created_at": "2021-02-16T23:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31401#issuecomment-595513",
    "user": "https://github.com/slel"
}
```

<a id='comment:5'></a>
Upstream ticket in the Maxima bug tracker:

- https://sourceforge.net/p/maxima/bugs/3716/



---

archive/issue_comments_595514.json:
```json
{
    "body": "**Changing upstream** from \"N/A\" to \"Reported upstream. No feedback yet.\".",
    "created_at": "2021-02-16T23:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31401#issuecomment-595514",
    "user": "https://github.com/slel"
}
```

**Changing upstream** from "N/A" to "Reported upstream. No feedback yet.".



---

archive/issue_events_092991.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31401",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31401#event-92991"
}
```



---

archive/issue_comments_595515.json:
```json
{
    "body": "<a id='comment:6'></a>\nMoving to 9.4, as 9.3 has been released.",
    "created_at": "2021-05-10T17:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31401#issuecomment-595515",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Moving to 9.4, as 9.3 has been released.



---

archive/issue_events_092992.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31401",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31401#event-92992"
}
```



---

archive/issue_events_092993.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31401",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31401#event-92993"
}
```



---

archive/issue_events_092994.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T20:12:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31401",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31401#event-92994"
}
```



---

archive/issue_events_092995.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T20:12:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31401",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31401#event-92995"
}
```



---

archive/issue_events_092996.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31401",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31401#event-92996"
}
```



---

archive/issue_events_092997.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31401",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31401#event-92997"
}
```



---

archive/issue_events_092998.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31401",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31401#event-92998"
}
```



---

archive/issue_events_092999.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31401",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31401#event-92999"
}
```
