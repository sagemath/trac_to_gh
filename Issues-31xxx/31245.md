# Issue 31245: Implement parallel f-vector for polytopes

archive/issues_031008.json:
```json
{
    "assignees": [],
    "body": "This ticket parallelizes the f-vector for polytopes.\n\nEach thread has its private structure with which it does partial jobs. Depending on the parallelization depth, there is one job per face of fixed codimension (usually 1,2 or 3). After everything has finished, the partial f-vectors will be added.\n\nActually, every face is visited and thus the code could be modified in the future, to explore other properties of faces then just the dimension. The parallelization seems to work well with at least 40 threads (for computations taking long enough such that this pays off, see https://arxiv.org/pdf/1905.01945.pdf).\n\nAlso the algorithm does work in other situations (simplicial complex, lattice of flats of a matroid) and this parallel structure could be used for this as well.\n\nOn the downside, `sig_on()/sig_off()` doesn't work with with multiple threads and has to be replaced by a simple `sig_check()`. Also raising errors in parallel code results in terrible slow down. Hence the errors are replaced by returning the exception value. In case of a bug there won't be any traceback anymore, but at least also no segmenation fault.\n\nBefore:\n\n```\nsage: P = P.base_extend(QQ)                                                                                                                                   \nsage: P = P.base_extend(QQ)                                                                                                                                   \nsage: Q = P.join(P.polar(in_affine_span=True))                                                                                                                \nsage: C = CombinatorialPolyhedron(Q)                                                                                                                          \nsage: %time C.f_vector()                                                                                                                                      \nCPU times: user 111 ms, sys: 186 \u00b5s, total: 111 ms\nWall time: 111 ms\n(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)\n\nsage: P = polytopes.Birkhoff_polytope(5)                                                                                                                      \nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector()                                                                                                                                      \nCPU times: user 584 ms, sys: 25 \u00b5s, total: 584 ms\nWall time: 583 ms\n(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)\n\n# Using the <simple> version of the algorithm.\nsage: P = polytopes.associahedron(['A', 11], backend='normaliz')                                                                                              \nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector()                                                                                                                                      \nCPU times: user 37.9 s, sys: 17.2 ms, total: 37.9 s\nWall time: 37.9 s\n(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)\n```\n\nAfter (machine has 4 cores):\n\n```\nsage: P = polytopes.permutahedron(5)                                                                                                                          \nsage: P = P.base_extend(QQ)                                                                                                                                   \nsage: Q = P.join(P.polar(in_affine_span=True))                                                                                                                \nsage: C = CombinatorialPolyhedron(Q)                                                                                                                          \nsage: %time C.f_vector(num_threads=1)                                                                                                                         \nCPU times: user 107 ms, sys: 0 ns, total: 107 ms\nWall time: 107 ms\n(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)\n\nsage: C = CombinatorialPolyhedron(Q)                                                                                                                          \nsage: %time C.f_vector(num_threads=2)                                                                                                                         \nCPU times: user 108 ms, sys: 0 ns, total: 108 ms\nWall time: 55.6 ms\n(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)\n\nsage: C = CombinatorialPolyhedron(Q)                                                                                                                          \nsage: %time C.f_vector(num_threads=4)                                                                                                                         \nCPU times: user 147 ms, sys: 52 \u00b5s, total: 147 ms\nWall time: 38.6 ms\n(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)\n\nsage: C = CombinatorialPolyhedron(Q)                                                                                                                          \nsage: %time C.f_vector(num_threads=8)                                                                                                                         \nCPU times: user 236 ms, sys: 0 ns, total: 236 ms\nWall time: 31.2 ms\n(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)\n\nsage: P = polytopes.Birkhoff_polytope(5)                                                                                                                      \nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector(num_threads=1)                                                                                                                         \nCPU times: user 354 ms, sys: 0 ns, total: 354 ms\nWall time: 354 ms\n(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)\n\nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector(num_threads=2)                                                                                                                         \nCPU times: user 363 ms, sys: 0 ns, total: 363 ms\nWall time: 181 ms\n(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)\n\nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector(num_threads=4)                                                                                                                         \nCPU times: user 459 ms, sys: 0 ns, total: 459 ms\nWall time: 117 ms\n(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)\n\nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector(num_threads=8)                                                                                                                         \nCPU times: user 776 ms, sys: 154 \u00b5s, total: 776 ms\nWall time: 103 ms\n(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)\n\n\n# Using the <simple> version of the algorithm.\nsage: P = polytopes.associahedron(['A', 11], backend='normaliz')                                                                                              \nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector(num_threads=1)                                                                                                                         \nCPU times: user 33.5 s, sys: 0 ns, total: 33.5 s\nWall time: 33.5 s\n(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)\n\nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector(num_threads=2)                                                                                                                         \nCPU times: user 34.4 s, sys: 3.49 ms, total: 34.4 s\nWall time: 17.2 s\n(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)\n\nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector(num_threads=4)                                                                                                                         \nCPU times: user 35.9 s, sys: 15.5 ms, total: 35.9 s\nWall time: 9 s\n(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)\n\nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector(num_threads=8)                                                                                                                         \nCPU times: user 1min 6s, sys: 31.3 ms, total: 1min 6s\nWall time: 8.44 s\n(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)\n```\n\nCC:  @jplab @LaisRast @stumpc5 @tscrim\n\nKeywords: **parallel f-vector**\n\nBranch/Commit: **[4c0a4ae](https://github.com/sagemath/sagetrac-mirror/commit/4c0a4ae74c28680e48080c39c5e3b171a79a9ad3)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Jonathan Kliem**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31245_\n\n",
    "closed_at": "2021-06-29T17:40:56Z",
    "created_at": "2021-01-15T10:37:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20geometry",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Implement parallel f-vector for polytopes",
    "type": "issue",
    "updated_at": "2021-06-29T17:40:56Z",
    "url": "https://github.com/sagemath/sage/issues/31245",
    "user": "https://github.com/kliem"
}
```
This ticket parallelizes the f-vector for polytopes.

Each thread has its private structure with which it does partial jobs. Depending on the parallelization depth, there is one job per face of fixed codimension (usually 1,2 or 3). After everything has finished, the partial f-vectors will be added.

Actually, every face is visited and thus the code could be modified in the future, to explore other properties of faces then just the dimension. The parallelization seems to work well with at least 40 threads (for computations taking long enough such that this pays off, see https://arxiv.org/pdf/1905.01945.pdf).

Also the algorithm does work in other situations (simplicial complex, lattice of flats of a matroid) and this parallel structure could be used for this as well.

On the downside, `sig_on()/sig_off()` doesn't work with with multiple threads and has to be replaced by a simple `sig_check()`. Also raising errors in parallel code results in terrible slow down. Hence the errors are replaced by returning the exception value. In case of a bug there won't be any traceback anymore, but at least also no segmenation fault.

Before:

```
sage: P = P.base_extend(QQ)                                                                                                                                   
sage: P = P.base_extend(QQ)                                                                                                                                   
sage: Q = P.join(P.polar(in_affine_span=True))                                                                                                                
sage: C = CombinatorialPolyhedron(Q)                                                                                                                          
sage: %time C.f_vector()                                                                                                                                      
CPU times: user 111 ms, sys: 186 µs, total: 111 ms
Wall time: 111 ms
(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)

sage: P = polytopes.Birkhoff_polytope(5)                                                                                                                      
sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector()                                                                                                                                      
CPU times: user 584 ms, sys: 25 µs, total: 584 ms
Wall time: 583 ms
(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)

# Using the <simple> version of the algorithm.
sage: P = polytopes.associahedron(['A', 11], backend='normaliz')                                                                                              
sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector()                                                                                                                                      
CPU times: user 37.9 s, sys: 17.2 ms, total: 37.9 s
Wall time: 37.9 s
(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)
```

After (machine has 4 cores):

```
sage: P = polytopes.permutahedron(5)                                                                                                                          
sage: P = P.base_extend(QQ)                                                                                                                                   
sage: Q = P.join(P.polar(in_affine_span=True))                                                                                                                
sage: C = CombinatorialPolyhedron(Q)                                                                                                                          
sage: %time C.f_vector(num_threads=1)                                                                                                                         
CPU times: user 107 ms, sys: 0 ns, total: 107 ms
Wall time: 107 ms
(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)

sage: C = CombinatorialPolyhedron(Q)                                                                                                                          
sage: %time C.f_vector(num_threads=2)                                                                                                                         
CPU times: user 108 ms, sys: 0 ns, total: 108 ms
Wall time: 55.6 ms
(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)

sage: C = CombinatorialPolyhedron(Q)                                                                                                                          
sage: %time C.f_vector(num_threads=4)                                                                                                                         
CPU times: user 147 ms, sys: 52 µs, total: 147 ms
Wall time: 38.6 ms
(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)

sage: C = CombinatorialPolyhedron(Q)                                                                                                                          
sage: %time C.f_vector(num_threads=8)                                                                                                                         
CPU times: user 236 ms, sys: 0 ns, total: 236 ms
Wall time: 31.2 ms
(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)

sage: P = polytopes.Birkhoff_polytope(5)                                                                                                                      
sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector(num_threads=1)                                                                                                                         
CPU times: user 354 ms, sys: 0 ns, total: 354 ms
Wall time: 354 ms
(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)

sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector(num_threads=2)                                                                                                                         
CPU times: user 363 ms, sys: 0 ns, total: 363 ms
Wall time: 181 ms
(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)

sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector(num_threads=4)                                                                                                                         
CPU times: user 459 ms, sys: 0 ns, total: 459 ms
Wall time: 117 ms
(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)

sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector(num_threads=8)                                                                                                                         
CPU times: user 776 ms, sys: 154 µs, total: 776 ms
Wall time: 103 ms
(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)


# Using the <simple> version of the algorithm.
sage: P = polytopes.associahedron(['A', 11], backend='normaliz')                                                                                              
sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector(num_threads=1)                                                                                                                         
CPU times: user 33.5 s, sys: 0 ns, total: 33.5 s
Wall time: 33.5 s
(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)

sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector(num_threads=2)                                                                                                                         
CPU times: user 34.4 s, sys: 3.49 ms, total: 34.4 s
Wall time: 17.2 s
(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)

sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector(num_threads=4)                                                                                                                         
CPU times: user 35.9 s, sys: 15.5 ms, total: 35.9 s
Wall time: 9 s
(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)

sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector(num_threads=8)                                                                                                                         
CPU times: user 1min 6s, sys: 31.3 ms, total: 1min 6s
Wall time: 8.44 s
(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)
```

CC:  @jplab @LaisRast @stumpc5 @tscrim

Keywords: **parallel f-vector**

Branch/Commit: **[4c0a4ae](https://github.com/sagemath/sagetrac-mirror/commit/4c0a4ae74c28680e48080c39c5e3b171a79a9ad3)**

Reviewer: **Travis Scrimshaw**

Author: **Jonathan Kliem**

_Issue created by migration from https://trac.sagemath.org/ticket/31245_





---

archive/issue_events_412345.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-01-15T10:37:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412345"
}
```



---

archive/issue_events_412346.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-01-15T10:37:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20geometry",
    "label_color": "0000ff",
    "label_name": "component: geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412346"
}
```



---

archive/issue_events_412347.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-01-15T10:37:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412347"
}
```



---

archive/issue_events_412348.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-01-15T10:37:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412348"
}
```



---

archive/issue_events_412349.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-01-15T10:38:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412349"
}
```



---

archive/issue_comments_503710.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n Each thread has its private structure with which it does partial jobs. Depending on the parallelization depth, there is one job per face of fixed codimension (usually 1,2 or 3). After everything has finished, the partial f-vectors will be added.\n \n-Actually, every face is visited and thus the code could be modified in the future, to explore other properties of faces then just the dimension. The parallelization seems to work well with at least 40 threads.\n+Actually, every face is visited and thus the code could be modified in the future, to explore other properties of faces then just the dimension. The parallelization seems to work well with at least 40 threads (for computations taking long enough such that this pays off, see https://arxiv.org/pdf/1905.01945.pdf).\n \n Also the algorithm does work in other situations (simplicial complex, lattice of flats of a matroid) and this parallel structure could be used for this as well.\n \n``````\n",
    "created_at": "2021-01-15T10:40:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503710",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 Each thread has its private structure with which it does partial jobs. Depending on the parallelization depth, there is one job per face of fixed codimension (usually 1,2 or 3). After everything has finished, the partial f-vectors will be added.
 
-Actually, every face is visited and thus the code could be modified in the future, to explore other properties of faces then just the dimension. The parallelization seems to work well with at least 40 threads.
+Actually, every face is visited and thus the code could be modified in the future, to explore other properties of faces then just the dimension. The parallelization seems to work well with at least 40 threads (for computations taking long enough such that this pays off, see https://arxiv.org/pdf/1905.01945.pdf).
 
 Also the algorithm does work in other situations (simplicial complex, lattice of flats of a matroid) and this parallel structure could be used for this as well.
 
``````




---

archive/issue_comments_503711.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nThe `sig_check()` outside the loop is unnecessary:\n\n```diff\n     cdef size_t j\n+    sig_check()\n     for j in range(n_faces):\n+        sig_check()\n         if (is_not_maximal_fused(new_faces, j, algorithm) or  # Step 2\n                 is_contained_in_one_fused(new_faces.faces[j], visited_all, algorithm)):  # Step 3\n             is_not_new_face[j] = True\n```\nLikewise here:\n\n```diff\n         face_list_t visited_all) nogil except -1:\n \n     cdef size_t output\n-    sig_on()\n+    sig_check()\n     if faces.polyhedron_is_simple:\n         output = get_next_level_fused(faces, new_faces, visited_all, <simple> 0)\n     else:\n         output = get_next_level_fused(faces, new_faces, visited_all, <standard> 0)\n-    sig_off()\n     return output\n \n cdef inline size_t bit_rep_to_coatom_rep(face_t face, face_list_t coatoms, size_t *output):\n```\nHere you either need the `sig_on/sig_off` or some more targeted checking. I don't see the point in performing a single check here.\n\nOtherwise LGTM.",
    "created_at": "2021-01-17T02:40:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503711",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:3" align="right">Comment 3</div>

The `sig_check()` outside the loop is unnecessary:

```diff
     cdef size_t j
+    sig_check()
     for j in range(n_faces):
+        sig_check()
         if (is_not_maximal_fused(new_faces, j, algorithm) or  # Step 2
                 is_contained_in_one_fused(new_faces.faces[j], visited_all, algorithm)):  # Step 3
             is_not_new_face[j] = True
```
Likewise here:

```diff
         face_list_t visited_all) nogil except -1:
 
     cdef size_t output
-    sig_on()
+    sig_check()
     if faces.polyhedron_is_simple:
         output = get_next_level_fused(faces, new_faces, visited_all, <simple> 0)
     else:
         output = get_next_level_fused(faces, new_faces, visited_all, <standard> 0)
-    sig_off()
     return output
 
 cdef inline size_t bit_rep_to_coatom_rep(face_t face, face_list_t coatoms, size_t *output):
```
Here you either need the `sig_on/sig_off` or some more targeted checking. I don't see the point in performing a single check here.

Otherwise LGTM.



---

archive/issue_comments_503712.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2021-01-17T02:40:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503712",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_503713.json:
```json
{
    "body": "Changed commit from **[d051f28](https://github.com/sagemath/sagetrac-mirror/commit/d051f283c08d117bd51d2167fb3d0ccf641dd620)** to **[0dae7a0](https://github.com/sagemath/sagetrac-mirror/commit/0dae7a061df9a2f05f9ef2d43602cc04fb351fb0)**",
    "created_at": "2021-01-17T09:37:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503713",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d051f28](https://github.com/sagemath/sagetrac-mirror/commit/d051f283c08d117bd51d2167fb3d0ccf641dd620)** to **[0dae7a0](https://github.com/sagemath/sagetrac-mirror/commit/0dae7a061df9a2f05f9ef2d43602cc04fb351fb0)**



---

archive/issue_comments_503714.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0dae7a061df9a2f05f9ef2d43602cc04fb351fb0\">0dae7a0</a></td><td><code>remove redundant sig_checks</code></td></tr></table>\n",
    "created_at": "2021-01-17T09:37:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503714",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4" align="right">Comment 4</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0dae7a061df9a2f05f9ef2d43602cc04fb351fb0">0dae7a0</a></td><td><code>remove redundant sig_checks</code></td></tr></table>




---

archive/issue_comments_503715.json:
```json
{
    "body": "Changed commit from **[0dae7a0](https://github.com/sagemath/sagetrac-mirror/commit/0dae7a061df9a2f05f9ef2d43602cc04fb351fb0)** to **[e3bdc61](https://github.com/sagemath/sagetrac-mirror/commit/e3bdc617538af4ab8cdcf147fd74f4e62da5ff2a)**",
    "created_at": "2021-01-17T09:43:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503715",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0dae7a0](https://github.com/sagemath/sagetrac-mirror/commit/0dae7a061df9a2f05f9ef2d43602cc04fb351fb0)** to **[e3bdc61](https://github.com/sagemath/sagetrac-mirror/commit/e3bdc617538af4ab8cdcf147fd74f4e62da5ff2a)**



---

archive/issue_comments_503716.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/609bd9225069738f55b3791b8838edaa79113b8f\">609bd92</a></td><td><code>do not delete all duplicates</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5c6ccee119e1c1bd993b9b68027c929658643dee\">5c6ccee</a></td><td><code>fix index</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e3bdc617538af4ab8cdcf147fd74f4e62da5ff2a\">e3bdc61</a></td><td><code>pull in 31226 and fix merge conflict</code></td></tr></table>\n",
    "created_at": "2021-01-17T09:43:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503716",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5" align="right">Comment 5</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/609bd9225069738f55b3791b8838edaa79113b8f">609bd92</a></td><td><code>do not delete all duplicates</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5c6ccee119e1c1bd993b9b68027c929658643dee">5c6ccee</a></td><td><code>fix index</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e3bdc617538af4ab8cdcf147fd74f4e62da5ff2a">e3bdc61</a></td><td><code>pull in 31226 and fix merge conflict</code></td></tr></table>




---

archive/issue_comments_503717.json:
```json
{
    "body": "Dependencies: **#31226**",
    "created_at": "2021-01-17T09:45:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503717",
    "user": "https://github.com/kliem"
}
```

Dependencies: **#31226**



---

archive/issue_comments_503718.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nReplying to [@tscrim](#comment%3A3):\n> The `sig_check()` outside the loop is unnecessary:\n> \n> ```diff\n>      cdef size_t j\n> +    sig_check()\n>      for j in range(n_faces):\n> +        sig_check()\n>          if (is_not_maximal_fused(new_faces, j, algorithm) or  # Step 2\n>                  is_contained_in_one_fused(new_faces.faces[j], visited_all, algorithm)):  # Step 3\n>              is_not_new_face[j] = True\n> ```\n> Likewise here:\n> \n> ```diff\n>          face_list_t visited_all) nogil except -1:\n>  \n>      cdef size_t output\n> -    sig_on()\n> +    sig_check()\n>      if faces.polyhedron_is_simple:\n>          output = get_next_level_fused(faces, new_faces, visited_all, <simple> 0)\n>      else:\n>          output = get_next_level_fused(faces, new_faces, visited_all, <standard> 0)\n> -    sig_off()\n>      return output\n>  \n>  cdef inline size_t bit_rep_to_coatom_rep(face_t face, face_list_t coatoms, size_t *output):\n> ```\n> Here you either need the `sig_on/sig_off` or some more targeted checking. I don't see the point in performing a single check here.\n> \n> Otherwise LGTM.\n\nI removed the redundant sig_checks.\n\nAs mentioned, sig_on, sig_off doesn't work well with parallelization. It crashes hard because sig_on, sig_off doesn't appear in correct order anymore.\n\nWrapping `prange` in sig_on/sig_off has a large performance penalty (8.45 s -> 9 s).\n\nCurrently there is one `sig_check` before checking that a face is inclusion maximal. One can add more sig checks, which wouldn't affect performance much for large examples, but for the small examples there is a penalty of about 50 percent.\n\nI think the current solution should be fine: The largest thing I ever computed with this algorithm, which took about a month on 40 cores, had 11,665,781 vertices and 162 facets. In this case between the sig_checks `A &~ B == 0` is performed for about 2 billion bits. Currently, without intrinsics, I get:\n\n```\nsage: B = Bitset((randint(0,2**20) for _ in range(2**19)))                                                                                                    \nsage: %timeit B.issubset(B)                                                                                                                                   \n6.18 \u00b5s \u00b1 9.8 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\nsage: %timeit B.intersection_update(B)                                                                                                                        \n6.02 \u00b5s \u00b1 2.72 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\n```\n\nOn this rate performing this for 2 billion bits should take about 12 ms. And even if the example has many more coatoms, in the worst case (completely unrealistic, because the dimension is not 1 and more memory is needed for other dimensions and probably for other threads), there are bitwise operations performed twice for the entire RAM. Say, we have 1 TB RAM, this would then take 96 seconds. Okay, that is long, but in any realistic sceanrio it would only take about a second, even with 1 TB RAM.\n\nTo sum up, I think the current amount of `sig_checks` suffices for the next years until more than 1 TB RAM is common (and even then, it doubt that there is an application for such a large example, as it would take forever to compute).",
    "created_at": "2021-01-17T10:16:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503718",
    "user": "https://github.com/kliem"
}
```

<div id="comment:7" align="right">Comment 7</div>

Replying to [@tscrim](#comment%3A3):
> The `sig_check()` outside the loop is unnecessary:
> 
> ```diff
>      cdef size_t j
> +    sig_check()
>      for j in range(n_faces):
> +        sig_check()
>          if (is_not_maximal_fused(new_faces, j, algorithm) or  # Step 2
>                  is_contained_in_one_fused(new_faces.faces[j], visited_all, algorithm)):  # Step 3
>              is_not_new_face[j] = True
> ```
> Likewise here:
> 
> ```diff
>          face_list_t visited_all) nogil except -1:
>  
>      cdef size_t output
> -    sig_on()
> +    sig_check()
>      if faces.polyhedron_is_simple:
>          output = get_next_level_fused(faces, new_faces, visited_all, <simple> 0)
>      else:
>          output = get_next_level_fused(faces, new_faces, visited_all, <standard> 0)
> -    sig_off()
>      return output
>  
>  cdef inline size_t bit_rep_to_coatom_rep(face_t face, face_list_t coatoms, size_t *output):
> ```
> Here you either need the `sig_on/sig_off` or some more targeted checking. I don't see the point in performing a single check here.
> 
> Otherwise LGTM.

I removed the redundant sig_checks.

As mentioned, sig_on, sig_off doesn't work well with parallelization. It crashes hard because sig_on, sig_off doesn't appear in correct order anymore.

Wrapping `prange` in sig_on/sig_off has a large performance penalty (8.45 s -> 9 s).

Currently there is one `sig_check` before checking that a face is inclusion maximal. One can add more sig checks, which wouldn't affect performance much for large examples, but for the small examples there is a penalty of about 50 percent.

I think the current solution should be fine: The largest thing I ever computed with this algorithm, which took about a month on 40 cores, had 11,665,781 vertices and 162 facets. In this case between the sig_checks `A &~ B == 0` is performed for about 2 billion bits. Currently, without intrinsics, I get:

```
sage: B = Bitset((randint(0,2**20) for _ in range(2**19)))                                                                                                    
sage: %timeit B.issubset(B)                                                                                                                                   
6.18 µs ± 9.8 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
sage: %timeit B.intersection_update(B)                                                                                                                        
6.02 µs ± 2.72 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
```

On this rate performing this for 2 billion bits should take about 12 ms. And even if the example has many more coatoms, in the worst case (completely unrealistic, because the dimension is not 1 and more memory is needed for other dimensions and probably for other threads), there are bitwise operations performed twice for the entire RAM. Say, we have 1 TB RAM, this would then take 96 seconds. Okay, that is long, but in any realistic sceanrio it would only take about a second, even with 1 TB RAM.

To sum up, I think the current amount of `sig_checks` suffices for the next years until more than 1 TB RAM is common (and even then, it doubt that there is an application for such a large example, as it would take forever to compute).



---

archive/issue_comments_503719.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nRebased.\n\nI didn't have this ticket here ready when writing #30445.\n\nEventually, one could also store edges/ridges or any sort of face in parallel.\nThis would also help with applications for simplicial complexes and lattice of flats of manifolds.\n\nBut that should be left for another time.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6a2a9b49cb27b849c7fb27093041817684762f8c\">6a2a9b4</a></td><td><code>fix merge conflict with develop in particual #30445</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/928ea608dc56698cd8df3d71b8266e75c28670eb\">928ea60</a></td><td><code>remove redundant allocation</code></td></tr></table>\n",
    "created_at": "2021-01-17T17:21:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503719",
    "user": "https://github.com/kliem"
}
```

<div id="comment:8" align="right">Comment 8</div>

Rebased.

I didn't have this ticket here ready when writing #30445.

Eventually, one could also store edges/ridges or any sort of face in parallel.
This would also help with applications for simplicial complexes and lattice of flats of manifolds.

But that should be left for another time.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6a2a9b49cb27b849c7fb27093041817684762f8c">6a2a9b4</a></td><td><code>fix merge conflict with develop in particual #30445</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/928ea608dc56698cd8df3d71b8266e75c28670eb">928ea60</a></td><td><code>remove redundant allocation</code></td></tr></table>




---

archive/issue_comments_503720.json:
```json
{
    "body": "Changed branch from **[u/gh-kliem/first_parallel_version_of_face_iterator](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/first_parallel_version_of_face_iterator)** to **[u/gh-kliem/first_parallel_version_of_face_iterator_reb](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/first_parallel_version_of_face_iterator_reb)**",
    "created_at": "2021-01-17T17:21:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503720",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[u/gh-kliem/first_parallel_version_of_face_iterator](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/first_parallel_version_of_face_iterator)** to **[u/gh-kliem/first_parallel_version_of_face_iterator_reb](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/first_parallel_version_of_face_iterator_reb)**



---

archive/issue_comments_503721.json:
```json
{
    "body": "Changed commit from **[e3bdc61](https://github.com/sagemath/sagetrac-mirror/commit/e3bdc617538af4ab8cdcf147fd74f4e62da5ff2a)** to **[928ea60](https://github.com/sagemath/sagetrac-mirror/commit/928ea608dc56698cd8df3d71b8266e75c28670eb)**",
    "created_at": "2021-01-17T17:21:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503721",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[e3bdc61](https://github.com/sagemath/sagetrac-mirror/commit/e3bdc617538af4ab8cdcf147fd74f4e62da5ff2a)** to **[928ea60](https://github.com/sagemath/sagetrac-mirror/commit/928ea608dc56698cd8df3d71b8266e75c28670eb)**



---

archive/issue_comments_503722.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nThank you. This is quite a nice improvement.",
    "created_at": "2021-01-18T00:11:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503722",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:9" align="right">Comment 9</div>

Thank you. This is quite a nice improvement.



---

archive/issue_events_412350.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-01-18T00:11:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412350"
}
```



---

archive/issue_events_412351.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-01-18T00:11:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412351"
}
```



---

archive/issue_comments_503723.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nThank you.",
    "created_at": "2021-01-18T06:40:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503723",
    "user": "https://github.com/kliem"
}
```

<div id="comment:10" align="right">Comment 10</div>

Thank you.



---

archive/issue_comments_503724.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nOn the kucalc buildbot:\n\n```\n[sagelib-9.3.beta6] [1/1] gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -march=native -fPIC -I/var/lib/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals -I./sage/data_structures -I./sage/cpython -Isage/cpython -Isage/data_structures -I/var/lib/buildbot/slave/sage_git/build/build/pkgs/sagelib/src -I/var/lib/buildbot/slave/sage_git/build/local/include/python3.9 -I/var/lib/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/core/include -Ibuild/cythonized -I/var/lib/buildbot/slave/sage_git/build/local/include/python3.9 -c build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c -o build/temp.linux-x86_64-3.9/build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -fopenmp -std=c99\n[sagelib-9.3.beta6] In file included from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:660:0:\n[sagelib-9.3.beta6] /var/lib/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals/struct_signals.h:45:1: sorry, unimplemented: \u2018_Atomic\u2019 with OpenMP\n[sagelib-9.3.beta6]  typedef volatile _Atomic int cy_atomic_int;\n[sagelib-9.3.beta6]  ^\n[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function \u2018__pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_13face_iterator_prepare_face_iterator_for_partial_job\u2019:\n[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9035:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n[sagelib-9.3.beta6]    __pyx_t_2 = ((__pyx_v_structure->current_dimension == (__pyx_v_structure->dimension - __pyx_v_parallelization_depth)) != 0);\n[sagelib-9.3.beta6]                                                       ^\n[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9322:84: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n[sagelib-9.3.beta6]      __pyx_t_1 = (((__pyx_v_parallel_struct->current_job_id[__pyx_v_current_depth]) == -1L) != 0);\n[sagelib-9.3.beta6]                                                                                     ^\n[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9673:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n[sagelib-9.3.beta6]    __pyx_t_1 = ((__pyx_v_structure->current_dimension != ((__pyx_v_structure->dimension - __pyx_v_parallelization_depth) - 1)) != 0);\n[sagelib-9.3.beta6]                                                       ^\n[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function \u2018__Pyx_InitGlobals\u2019:\n[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:23283:1: warning: \u2018PyEval_InitThreads\u2019 is deprecated [-Wdeprecated-declarations]\n[sagelib-9.3.beta6]  PyEval_InitThreads();\n[sagelib-9.3.beta6]  ^\n[sagelib-9.3.beta6] In file included from /var/lib/buildbot/slave/sage_git/build/local/include/python3.9/Python.h:145:0,\n[sagelib-9.3.beta6]                  from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:52:\n[sagelib-9.3.beta6] /var/lib/buildbot/slave/sage_git/build/local/include/python3.9/ceval.h:130:37: note: declared here\n[sagelib-9.3.beta6]  Py_DEPRECATED(3.9) PyAPI_FUNC(void) PyEval_InitThreads(void);\n[sagelib-9.3.beta6]                                      ^\n[sagelib-9.3.beta6] error: command '/usr/bin/gcc' failed with exit code 1\n```",
    "created_at": "2021-01-31T13:27:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503724",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:11" align="right">Comment 11</div>

On the kucalc buildbot:

```
[sagelib-9.3.beta6] [1/1] gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -march=native -fPIC -I/var/lib/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals -I./sage/data_structures -I./sage/cpython -Isage/cpython -Isage/data_structures -I/var/lib/buildbot/slave/sage_git/build/build/pkgs/sagelib/src -I/var/lib/buildbot/slave/sage_git/build/local/include/python3.9 -I/var/lib/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/core/include -Ibuild/cythonized -I/var/lib/buildbot/slave/sage_git/build/local/include/python3.9 -c build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c -o build/temp.linux-x86_64-3.9/build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -fopenmp -std=c99
[sagelib-9.3.beta6] In file included from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:660:0:
[sagelib-9.3.beta6] /var/lib/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals/struct_signals.h:45:1: sorry, unimplemented: ‘_Atomic’ with OpenMP
[sagelib-9.3.beta6]  typedef volatile _Atomic int cy_atomic_int;
[sagelib-9.3.beta6]  ^
[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function ‘__pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_13face_iterator_prepare_face_iterator_for_partial_job’:
[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9035:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
[sagelib-9.3.beta6]    __pyx_t_2 = ((__pyx_v_structure->current_dimension == (__pyx_v_structure->dimension - __pyx_v_parallelization_depth)) != 0);
[sagelib-9.3.beta6]                                                       ^
[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9322:84: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
[sagelib-9.3.beta6]      __pyx_t_1 = (((__pyx_v_parallel_struct->current_job_id[__pyx_v_current_depth]) == -1L) != 0);
[sagelib-9.3.beta6]                                                                                     ^
[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9673:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
[sagelib-9.3.beta6]    __pyx_t_1 = ((__pyx_v_structure->current_dimension != ((__pyx_v_structure->dimension - __pyx_v_parallelization_depth) - 1)) != 0);
[sagelib-9.3.beta6]                                                       ^
[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function ‘__Pyx_InitGlobals’:
[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:23283:1: warning: ‘PyEval_InitThreads’ is deprecated [-Wdeprecated-declarations]
[sagelib-9.3.beta6]  PyEval_InitThreads();
[sagelib-9.3.beta6]  ^
[sagelib-9.3.beta6] In file included from /var/lib/buildbot/slave/sage_git/build/local/include/python3.9/Python.h:145:0,
[sagelib-9.3.beta6]                  from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:52:
[sagelib-9.3.beta6] /var/lib/buildbot/slave/sage_git/build/local/include/python3.9/ceval.h:130:37: note: declared here
[sagelib-9.3.beta6]  Py_DEPRECATED(3.9) PyAPI_FUNC(void) PyEval_InitThreads(void);
[sagelib-9.3.beta6]                                      ^
[sagelib-9.3.beta6] error: command '/usr/bin/gcc' failed with exit code 1
```



---

archive/issue_events_412352.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-01-31T13:27:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412352"
}
```



---

archive/issue_events_412353.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-01-31T13:27:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412353"
}
```



---

archive/issue_comments_503725.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nThis appears to be an issue with python 3.5 to 3.7 according to https://bugs.python.org/issue25150\n\nFrom this I get that this can be \"fixed\" by doing this specific module as a C++ extension (or by requiring system python >= 3.8, but that isn't an option for the moment).\n\nI'll check if I can reproduce this with system python 3.7 (need to rebuild first).",
    "created_at": "2021-01-31T14:12:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503725",
    "user": "https://github.com/kliem"
}
```

<div id="comment:13" align="right">Comment 13</div>

This appears to be an issue with python 3.5 to 3.7 according to https://bugs.python.org/issue25150

From this I get that this can be "fixed" by doing this specific module as a C++ extension (or by requiring system python >= 3.8, but that isn't an option for the moment).

I'll check if I can reproduce this with system python 3.7 (need to rebuild first).



---

archive/issue_comments_503726.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nActually, that is a problem with cysignals that should be fixed there.",
    "created_at": "2021-01-31T14:26:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503726",
    "user": "https://github.com/kliem"
}
```

<div id="comment:14" align="right">Comment 14</div>

Actually, that is a problem with cysignals that should be fixed there.



---

archive/issue_comments_503727.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/baf80deaca74b037c11e5eee914009e216f3beed\">baf80de</a></td><td><code>try disabling CYSIGNALS_C_ATOMIC</code></td></tr></table>\n",
    "created_at": "2021-01-31T15:28:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503727",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15" align="right">Comment 15</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/baf80deaca74b037c11e5eee914009e216f3beed">baf80de</a></td><td><code>try disabling CYSIGNALS_C_ATOMIC</code></td></tr></table>




---

archive/issue_comments_503728.json:
```json
{
    "body": "Changed commit from **[928ea60](https://github.com/sagemath/sagetrac-mirror/commit/928ea608dc56698cd8df3d71b8266e75c28670eb)** to **[baf80de](https://github.com/sagemath/sagetrac-mirror/commit/baf80deaca74b037c11e5eee914009e216f3beed)**",
    "created_at": "2021-01-31T15:28:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503728",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[928ea60](https://github.com/sagemath/sagetrac-mirror/commit/928ea608dc56698cd8df3d71b8266e75c28670eb)** to **[baf80de](https://github.com/sagemath/sagetrac-mirror/commit/baf80deaca74b037c11e5eee914009e216f3beed)**



---

archive/issue_comments_503729.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nAccording to \n\nhttps://github.com/sagemath/cysignals/blob/master/src/cysignals/struct_signals.h\n\nand\n\nhttps://github.com/sagemath/cysignals/blob/master/src/cysignals/cysignals_config.h.in\n\njust undefininig `CYSIGNALS_C_ATOMIC` should fix this.",
    "created_at": "2021-01-31T15:30:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503729",
    "user": "https://github.com/kliem"
}
```

<div id="comment:16" align="right">Comment 16</div>

According to 

https://github.com/sagemath/cysignals/blob/master/src/cysignals/struct_signals.h

and

https://github.com/sagemath/cysignals/blob/master/src/cysignals/cysignals_config.h.in

just undefininig `CYSIGNALS_C_ATOMIC` should fix this.



---

archive/issue_events_412354.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-01-31T15:31:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412354"
}
```



---

archive/issue_events_412355.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-01-31T15:31:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412355"
}
```



---

archive/issue_events_412356.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-02-01T00:55:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412356"
}
```



---

archive/issue_events_412357.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-02-01T00:55:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412357"
}
```



---

archive/issue_comments_503730.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nBack off to the builbots.",
    "created_at": "2021-02-01T00:55:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503730",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:18" align="right">Comment 18</div>

Back off to the builbots.



---

archive/issue_comments_503731.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nBuild fails on various buildbots:\n\n```\n[sagelib-9.3.beta7] [1/1] gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -march=native -O2 -g -march=native -fPIC -UCYSIGNALS_C_ATOMIC -I/home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals -I./sage/data_structures -I./sage/cpython -Isage/cpython -I/home/buildbot/slave/sage_git/build/build/pkgs/sagelib/src -I/home/buildbot/slave/sage_git/build/local/include/python3.9 -I/home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/core/include -Ibuild/cythonized -I/home/buildbot/slave/sage_git/build/local/include/python3.9 -c build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c -o build/temp.linux-x86_64-3.9/build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -fopenmp -std=c99\n[sagelib-9.3.beta7] In file included from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:662:0:\n[sagelib-9.3.beta7] /home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals/struct_signals.h:45:1: sorry, unimplemented: \u2018_Atomic\u2019 with OpenMP\n[sagelib-9.3.beta7]  typedef volatile _Atomic int cy_atomic_int;\n[sagelib-9.3.beta7]  ^~~~~~~\n[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function \u2018__pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_13face_iterator_prepare_face_iterator_for_partial_job\u2019:\n[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9037:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n[sagelib-9.3.beta7]    __pyx_t_2 = ((__pyx_v_structure->current_dimension == (__pyx_v_structure->dimension - __pyx_v_parallelization_depth)) != 0);\n[sagelib-9.3.beta7]                                                       ^~\n[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9324:84: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n[sagelib-9.3.beta7]      __pyx_t_1 = (((__pyx_v_parallel_struct->current_job_id[__pyx_v_current_depth]) == -1L) != 0);\n[sagelib-9.3.beta7]                                                                                     ^~\n[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9675:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n[sagelib-9.3.beta7]    __pyx_t_1 = ((__pyx_v_structure->current_dimension != ((__pyx_v_structure->dimension - __pyx_v_parallelization_depth) - 1)) != 0);\n[sagelib-9.3.beta7]                                                       ^~\n[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function \u2018__Pyx_InitGlobals\u2019:\n[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:23285:1: warning: \u2018PyEval_InitThreads\u2019 is deprecated [-Wdeprecated-declarations]\n[sagelib-9.3.beta7]  PyEval_InitThreads();\n[sagelib-9.3.beta7]  ^~~~~~~~~~~~~~~~~~\n[sagelib-9.3.beta7] In file included from /home/buildbot/slave/sage_git/build/local/include/python3.9/Python.h:145:0,\n[sagelib-9.3.beta7]                  from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:54:\n[sagelib-9.3.beta7] /home/buildbot/slave/sage_git/build/local/include/python3.9/ceval.h:130:37: note: declared here\n[sagelib-9.3.beta7]  Py_DEPRECATED(3.9) PyAPI_FUNC(void) PyEval_InitThreads(void);\n[sagelib-9.3.beta7]                                      ^~~~~~~~~~~~~~~~~~\n[sagelib-9.3.beta7] error: command '/usr/bin/gcc' failed with exit code 1\n[sagelib-9.3.beta7] \n[sagelib-9.3.beta7] real\t0m3.325s\n[sagelib-9.3.beta7] user\t0m2.798s\n[sagelib-9.3.beta7] sys\t0m0.563s\nMakefile:2233: recipe for target 'sagelib-no-deps' failed\n```",
    "created_at": "2021-03-05T21:19:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503731",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:19" align="right">Comment 19</div>

Build fails on various buildbots:

```
[sagelib-9.3.beta7] [1/1] gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -march=native -O2 -g -march=native -fPIC -UCYSIGNALS_C_ATOMIC -I/home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals -I./sage/data_structures -I./sage/cpython -Isage/cpython -I/home/buildbot/slave/sage_git/build/build/pkgs/sagelib/src -I/home/buildbot/slave/sage_git/build/local/include/python3.9 -I/home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/core/include -Ibuild/cythonized -I/home/buildbot/slave/sage_git/build/local/include/python3.9 -c build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c -o build/temp.linux-x86_64-3.9/build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -fopenmp -std=c99
[sagelib-9.3.beta7] In file included from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:662:0:
[sagelib-9.3.beta7] /home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals/struct_signals.h:45:1: sorry, unimplemented: ‘_Atomic’ with OpenMP
[sagelib-9.3.beta7]  typedef volatile _Atomic int cy_atomic_int;
[sagelib-9.3.beta7]  ^~~~~~~
[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function ‘__pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_13face_iterator_prepare_face_iterator_for_partial_job’:
[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9037:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
[sagelib-9.3.beta7]    __pyx_t_2 = ((__pyx_v_structure->current_dimension == (__pyx_v_structure->dimension - __pyx_v_parallelization_depth)) != 0);
[sagelib-9.3.beta7]                                                       ^~
[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9324:84: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
[sagelib-9.3.beta7]      __pyx_t_1 = (((__pyx_v_parallel_struct->current_job_id[__pyx_v_current_depth]) == -1L) != 0);
[sagelib-9.3.beta7]                                                                                     ^~
[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9675:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
[sagelib-9.3.beta7]    __pyx_t_1 = ((__pyx_v_structure->current_dimension != ((__pyx_v_structure->dimension - __pyx_v_parallelization_depth) - 1)) != 0);
[sagelib-9.3.beta7]                                                       ^~
[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function ‘__Pyx_InitGlobals’:
[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:23285:1: warning: ‘PyEval_InitThreads’ is deprecated [-Wdeprecated-declarations]
[sagelib-9.3.beta7]  PyEval_InitThreads();
[sagelib-9.3.beta7]  ^~~~~~~~~~~~~~~~~~
[sagelib-9.3.beta7] In file included from /home/buildbot/slave/sage_git/build/local/include/python3.9/Python.h:145:0,
[sagelib-9.3.beta7]                  from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:54:
[sagelib-9.3.beta7] /home/buildbot/slave/sage_git/build/local/include/python3.9/ceval.h:130:37: note: declared here
[sagelib-9.3.beta7]  Py_DEPRECATED(3.9) PyAPI_FUNC(void) PyEval_InitThreads(void);
[sagelib-9.3.beta7]                                      ^~~~~~~~~~~~~~~~~~
[sagelib-9.3.beta7] error: command '/usr/bin/gcc' failed with exit code 1
[sagelib-9.3.beta7] 
[sagelib-9.3.beta7] real	0m3.325s
[sagelib-9.3.beta7] user	0m2.798s
[sagelib-9.3.beta7] sys	0m0.563s
Makefile:2233: recipe for target 'sagelib-no-deps' failed
```



---

archive/issue_comments_503732.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/da65d28f81ddb7a865d0af830d14bb4132c3c1cb\">da65d28</a></td><td><code>Revert \"try disabling CYSIGNALS_C_ATOMIC\"</code></td></tr></table>\n",
    "created_at": "2021-03-05T22:48:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503732",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20" align="right">Comment 20</div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/da65d28f81ddb7a865d0af830d14bb4132c3c1cb">da65d28</a></td><td><code>Revert "try disabling CYSIGNALS_C_ATOMIC"</code></td></tr></table>




---

archive/issue_events_412358.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2021-03-05T22:48:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412358"
}
```



---

archive/issue_events_412359.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2021-03-05T22:48:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412359"
}
```



---

archive/issue_comments_503733.json:
```json
{
    "body": "Changed commit from **[baf80de](https://github.com/sagemath/sagetrac-mirror/commit/baf80deaca74b037c11e5eee914009e216f3beed)** to **[da65d28](https://github.com/sagemath/sagetrac-mirror/commit/da65d28f81ddb7a865d0af830d14bb4132c3c1cb)**",
    "created_at": "2021-03-05T22:48:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503733",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[baf80de](https://github.com/sagemath/sagetrac-mirror/commit/baf80deaca74b037c11e5eee914009e216f3beed)** to **[da65d28](https://github.com/sagemath/sagetrac-mirror/commit/da65d28f81ddb7a865d0af830d14bb4132c3c1cb)**



---

archive/issue_comments_503734.json:
```json
{
    "body": "Changed dependencies from **#31226** to **#31226, #31455**",
    "created_at": "2021-03-05T22:49:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503734",
    "user": "https://github.com/kliem"
}
```

Changed dependencies from **#31226** to **#31226, #31455**



---

archive/issue_comments_503735.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nI don't think this is going to happen with 9.3 anymore, if this is waiting on a cysignals patch/update.",
    "created_at": "2021-03-06T19:56:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503735",
    "user": "https://github.com/kliem"
}
```

<div id="comment:22" align="right">Comment 22</div>

I don't think this is going to happen with 9.3 anymore, if this is waiting on a cysignals patch/update.



---

archive/issue_events_412360.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-06T19:56:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412360"
}
```



---

archive/issue_events_412361.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-06T19:56:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412361"
}
```



---

archive/issue_comments_503736.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/405ef3e3bb65ac1c610727c590daf75c19048c45\">405ef3e</a></td><td><code>Merge branch 'u/gh-kliem/first_parallel_version_of_face_iterator_reb' of git://trac.sagemath.org/sage into u/gh-kliem/first_parallel_version_of_face_iterator_reb2</code></td></tr></table>\n",
    "created_at": "2021-03-09T08:17:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503736",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23" align="right">Comment 23</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/405ef3e3bb65ac1c610727c590daf75c19048c45">405ef3e</a></td><td><code>Merge branch 'u/gh-kliem/first_parallel_version_of_face_iterator_reb' of git://trac.sagemath.org/sage into u/gh-kliem/first_parallel_version_of_face_iterator_reb2</code></td></tr></table>




---

archive/issue_comments_503737.json:
```json
{
    "body": "Changed commit from **[da65d28](https://github.com/sagemath/sagetrac-mirror/commit/da65d28f81ddb7a865d0af830d14bb4132c3c1cb)** to **[405ef3e](https://github.com/sagemath/sagetrac-mirror/commit/405ef3e3bb65ac1c610727c590daf75c19048c45)**",
    "created_at": "2021-03-09T08:17:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503737",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[da65d28](https://github.com/sagemath/sagetrac-mirror/commit/da65d28f81ddb7a865d0af830d14bb4132c3c1cb)** to **[405ef3e](https://github.com/sagemath/sagetrac-mirror/commit/405ef3e3bb65ac1c610727c590daf75c19048c45)**



---

archive/issue_comments_503738.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nThis bug isn't too hard to reproduce actually:\n\nhttps://github.com/kliem/sage/runs/2064520070?check_suite_focus=true\n\nSeems to be connected to older GCC.\n\nReplying to [@vbraun](#comment%3A19):\n> Build fails on various buildbots:\n> \n> ```\n> [sagelib-9.3.beta7] [1/1] gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -march=native -O2 -g -march=native -fPIC -UCYSIGNALS_C_ATOMIC -I/home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals -I./sage/data_structures -I./sage/cpython -Isage/cpython -I/home/buildbot/slave/sage_git/build/build/pkgs/sagelib/src -I/home/buildbot/slave/sage_git/build/local/include/python3.9 -I/home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/core/include -Ibuild/cythonized -I/home/buildbot/slave/sage_git/build/local/include/python3.9 -c build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c -o build/temp.linux-x86_64-3.9/build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -fopenmp -std=c99\n> [sagelib-9.3.beta7] In file included from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:662:0:\n> [sagelib-9.3.beta7] /home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals/struct_signals.h:45:1: sorry, unimplemented: \u2018_Atomic\u2019 with OpenMP\n> [sagelib-9.3.beta7]  typedef volatile _Atomic int cy_atomic_int;\n> [sagelib-9.3.beta7]  ^~~~~~~\n> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function \u2018__pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_13face_iterator_prepare_face_iterator_for_partial_job\u2019:\n> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9037:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n> [sagelib-9.3.beta7]    __pyx_t_2 = ((__pyx_v_structure->current_dimension == (__pyx_v_structure->dimension - __pyx_v_parallelization_depth)) != 0);\n> [sagelib-9.3.beta7]                                                       ^~\n> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9324:84: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n> [sagelib-9.3.beta7]      __pyx_t_1 = (((__pyx_v_parallel_struct->current_job_id[__pyx_v_current_depth]) == -1L) != 0);\n> [sagelib-9.3.beta7]                                                                                     ^~\n> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9675:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n> [sagelib-9.3.beta7]    __pyx_t_1 = ((__pyx_v_structure->current_dimension != ((__pyx_v_structure->dimension - __pyx_v_parallelization_depth) - 1)) != 0);\n> [sagelib-9.3.beta7]                                                       ^~\n> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function \u2018__Pyx_InitGlobals\u2019:\n> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:23285:1: warning: \u2018PyEval_InitThreads\u2019 is deprecated [-Wdeprecated-declarations]\n> [sagelib-9.3.beta7]  PyEval_InitThreads();\n> [sagelib-9.3.beta7]  ^~~~~~~~~~~~~~~~~~\n> [sagelib-9.3.beta7] In file included from /home/buildbot/slave/sage_git/build/local/include/python3.9/Python.h:145:0,\n> [sagelib-9.3.beta7]                  from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:54:\n> [sagelib-9.3.beta7] /home/buildbot/slave/sage_git/build/local/include/python3.9/ceval.h:130:37: note: declared here\n> [sagelib-9.3.beta7]  Py_DEPRECATED(3.9) PyAPI_FUNC(void) PyEval_InitThreads(void);\n> [sagelib-9.3.beta7]                                      ^~~~~~~~~~~~~~~~~~\n> [sagelib-9.3.beta7] error: command '/usr/bin/gcc' failed with exit code 1\n> [sagelib-9.3.beta7] \n> [sagelib-9.3.beta7] real\t0m3.325s\n> [sagelib-9.3.beta7] user\t0m2.798s\n> [sagelib-9.3.beta7] sys\t0m0.563s\n> Makefile:2233: recipe for target 'sagelib-no-deps' failed\n> ```",
    "created_at": "2021-03-09T14:39:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503738",
    "user": "https://github.com/kliem"
}
```

<div id="comment:24" align="right">Comment 24</div>

This bug isn't too hard to reproduce actually:

https://github.com/kliem/sage/runs/2064520070?check_suite_focus=true

Seems to be connected to older GCC.

Replying to [@vbraun](#comment%3A19):
> Build fails on various buildbots:
> 
> ```
> [sagelib-9.3.beta7] [1/1] gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -march=native -O2 -g -march=native -fPIC -UCYSIGNALS_C_ATOMIC -I/home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals -I./sage/data_structures -I./sage/cpython -Isage/cpython -I/home/buildbot/slave/sage_git/build/build/pkgs/sagelib/src -I/home/buildbot/slave/sage_git/build/local/include/python3.9 -I/home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/core/include -Ibuild/cythonized -I/home/buildbot/slave/sage_git/build/local/include/python3.9 -c build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c -o build/temp.linux-x86_64-3.9/build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -fopenmp -std=c99
> [sagelib-9.3.beta7] In file included from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:662:0:
> [sagelib-9.3.beta7] /home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals/struct_signals.h:45:1: sorry, unimplemented: ‘_Atomic’ with OpenMP
> [sagelib-9.3.beta7]  typedef volatile _Atomic int cy_atomic_int;
> [sagelib-9.3.beta7]  ^~~~~~~
> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function ‘__pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_13face_iterator_prepare_face_iterator_for_partial_job’:
> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9037:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
> [sagelib-9.3.beta7]    __pyx_t_2 = ((__pyx_v_structure->current_dimension == (__pyx_v_structure->dimension - __pyx_v_parallelization_depth)) != 0);
> [sagelib-9.3.beta7]                                                       ^~
> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9324:84: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
> [sagelib-9.3.beta7]      __pyx_t_1 = (((__pyx_v_parallel_struct->current_job_id[__pyx_v_current_depth]) == -1L) != 0);
> [sagelib-9.3.beta7]                                                                                     ^~
> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9675:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
> [sagelib-9.3.beta7]    __pyx_t_1 = ((__pyx_v_structure->current_dimension != ((__pyx_v_structure->dimension - __pyx_v_parallelization_depth) - 1)) != 0);
> [sagelib-9.3.beta7]                                                       ^~
> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function ‘__Pyx_InitGlobals’:
> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:23285:1: warning: ‘PyEval_InitThreads’ is deprecated [-Wdeprecated-declarations]
> [sagelib-9.3.beta7]  PyEval_InitThreads();
> [sagelib-9.3.beta7]  ^~~~~~~~~~~~~~~~~~
> [sagelib-9.3.beta7] In file included from /home/buildbot/slave/sage_git/build/local/include/python3.9/Python.h:145:0,
> [sagelib-9.3.beta7]                  from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:54:
> [sagelib-9.3.beta7] /home/buildbot/slave/sage_git/build/local/include/python3.9/ceval.h:130:37: note: declared here
> [sagelib-9.3.beta7]  Py_DEPRECATED(3.9) PyAPI_FUNC(void) PyEval_InitThreads(void);
> [sagelib-9.3.beta7]                                      ^~~~~~~~~~~~~~~~~~
> [sagelib-9.3.beta7] error: command '/usr/bin/gcc' failed with exit code 1
> [sagelib-9.3.beta7] 
> [sagelib-9.3.beta7] real	0m3.325s
> [sagelib-9.3.beta7] user	0m2.798s
> [sagelib-9.3.beta7] sys	0m0.563s
> Makefile:2233: recipe for target 'sagelib-no-deps' failed
> ```



---

archive/issue_comments_503739.json:
```json
{
    "body": "Changed dependencies from **#31226, #31455** to **#31474**",
    "created_at": "2021-03-10T11:46:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503739",
    "user": "https://github.com/kliem"
}
```

Changed dependencies from **#31226, #31455** to **#31474**



---

archive/issue_comments_503740.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nThis might need more work, as the flag `-fopenmp` isn't understood everywhere: https://github.com/kliem/sage/pull/40/checks?check_run_id=2076988665\n\nSo we should probably check out at configure time, whether our compiler supports this, similar to #27122.",
    "created_at": "2021-03-12T13:59:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503740",
    "user": "https://github.com/kliem"
}
```

<div id="comment:26" align="right">Comment 26</div>

This might need more work, as the flag `-fopenmp` isn't understood everywhere: https://github.com/kliem/sage/pull/40/checks?check_run_id=2076988665

So we should probably check out at configure time, whether our compiler supports this, similar to #27122.



---

archive/issue_events_412362.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-12T13:59:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412362"
}
```



---

archive/issue_events_412363.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-12T13:59:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412363"
}
```



---

archive/issue_comments_503741.json:
```json
{
    "body": "Changed dependencies from **#31474** to **#31474, #31499**",
    "created_at": "2021-03-15T11:54:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503741",
    "user": "https://github.com/kliem"
}
```

Changed dependencies from **#31474** to **#31474, #31499**



---

archive/issue_comments_503742.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55a4634e4cfe999e573251b3cc71e5e3b12d7a25\">55a4634</a></td><td><code>merge with current develop</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6edd48bb784048a1a19207e83e2224223156d41d\">6edd48b</a></td><td><code>define cython aliases OPENMP_CFLAGS and OPENMP_CXXFLAGS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/71f8950ab215a3af82ecea00f2b726ddc413ef7b\">71f8950</a></td><td><code>fixes to get the aliases to work</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b76dc3ccf4bbc2715754a9ae2e91bda22e01e54a\">b76dc3c</a></td><td><code>add doctest that shows how use cython.parallel.prange</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07cb470350c8820a4af2f40e7c28d4e685593ca4\">07cb470</a></td><td><code>Merge branch 'u/gh-kliem/check_openmp_at_configuration' of git://trac.sagemath.org/sage into u/gh-kliem/first_parallel_version_of_face_iterator_reb</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27baa071a64d5f93ca49d5ca4c18ae8ca7fa892a\">27baa07</a></td><td><code>use OPENMP_CFLAGS</code></td></tr></table>\n",
    "created_at": "2021-03-15T11:58:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503742",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28" align="right">Comment 28</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55a4634e4cfe999e573251b3cc71e5e3b12d7a25">55a4634</a></td><td><code>merge with current develop</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6edd48bb784048a1a19207e83e2224223156d41d">6edd48b</a></td><td><code>define cython aliases OPENMP_CFLAGS and OPENMP_CXXFLAGS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/71f8950ab215a3af82ecea00f2b726ddc413ef7b">71f8950</a></td><td><code>fixes to get the aliases to work</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b76dc3ccf4bbc2715754a9ae2e91bda22e01e54a">b76dc3c</a></td><td><code>add doctest that shows how use cython.parallel.prange</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07cb470350c8820a4af2f40e7c28d4e685593ca4">07cb470</a></td><td><code>Merge branch 'u/gh-kliem/check_openmp_at_configuration' of git://trac.sagemath.org/sage into u/gh-kliem/first_parallel_version_of_face_iterator_reb</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27baa071a64d5f93ca49d5ca4c18ae8ca7fa892a">27baa07</a></td><td><code>use OPENMP_CFLAGS</code></td></tr></table>




---

archive/issue_comments_503743.json:
```json
{
    "body": "Changed commit from **[405ef3e](https://github.com/sagemath/sagetrac-mirror/commit/405ef3e3bb65ac1c610727c590daf75c19048c45)** to **[27baa07](https://github.com/sagemath/sagetrac-mirror/commit/27baa071a64d5f93ca49d5ca4c18ae8ca7fa892a)**",
    "created_at": "2021-03-15T11:58:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503743",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[405ef3e](https://github.com/sagemath/sagetrac-mirror/commit/405ef3e3bb65ac1c610727c590daf75c19048c45)** to **[27baa07](https://github.com/sagemath/sagetrac-mirror/commit/27baa071a64d5f93ca49d5ca4c18ae8ca7fa892a)**



---

archive/issue_events_412364.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-15T11:59:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412364"
}
```



---

archive/issue_events_412365.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-15T11:59:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412365"
}
```



---

archive/issue_comments_503744.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nTests are running here:\n\nhttps://github.com/kliem/sage/pull/40/checks",
    "created_at": "2021-03-15T12:11:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503744",
    "user": "https://github.com/kliem"
}
```

<div id="comment:30" align="right">Comment 30</div>

Tests are running here:

https://github.com/kliem/sage/pull/40/checks



---

archive/issue_comments_503745.json:
```json
{
    "body": "Changed commit from **[27baa07](https://github.com/sagemath/sagetrac-mirror/commit/27baa071a64d5f93ca49d5ca4c18ae8ca7fa892a)** to **[ae482a4](https://github.com/sagemath/sagetrac-mirror/commit/ae482a4d07ebc5f68fe78b37a32919c85b94aef5)**",
    "created_at": "2021-03-16T08:04:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503745",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[27baa07](https://github.com/sagemath/sagetrac-mirror/commit/27baa071a64d5f93ca49d5ca4c18ae8ca7fa892a)** to **[ae482a4](https://github.com/sagemath/sagetrac-mirror/commit/ae482a4d07ebc5f68fe78b37a32919c85b94aef5)**



---

archive/issue_comments_503746.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a9d3dfed7bf31b9167f5af553751b19a506b4c22\">a9d3dfe</a></td><td><code>split to account for multiple arguments</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ae482a4d07ebc5f68fe78b37a32919c85b94aef5\">ae482a4</a></td><td><code>Merge branch 'u/gh-kliem/check_openmp_at_configuration' of git://trac.sagemath.org/sage into u/gh-kliem/first_parallel_version_of_face_iterator_reb</code></td></tr></table>\n",
    "created_at": "2021-03-16T08:04:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503746",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31" align="right">Comment 31</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a9d3dfed7bf31b9167f5af553751b19a506b4c22">a9d3dfe</a></td><td><code>split to account for multiple arguments</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ae482a4d07ebc5f68fe78b37a32919c85b94aef5">ae482a4</a></td><td><code>Merge branch 'u/gh-kliem/check_openmp_at_configuration' of git://trac.sagemath.org/sage into u/gh-kliem/first_parallel_version_of_face_iterator_reb</code></td></tr></table>




---

archive/issue_events_412366.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-04-11T23:32:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412366"
}
```



---

archive/issue_events_412367.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-04-11T23:32:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412367"
}
```



---

archive/issue_comments_503747.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nThanks again.",
    "created_at": "2021-04-12T06:30:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503747",
    "user": "https://github.com/kliem"
}
```

<div id="comment:33" align="right">Comment 33</div>

Thanks again.



---

archive/issue_events_412368.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-05-13T11:01:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412368"
}
```



---

archive/issue_events_412369.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-05-13T11:01:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412369"
}
```



---

archive/issue_comments_503748.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nMerge conflict",
    "created_at": "2021-05-13T11:01:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503748",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:34" align="right">Comment 34</div>

Merge conflict



---

archive/issue_comments_503749.json:
```json
{
    "body": "Changed branch from **[u/gh-kliem/first_parallel_version_of_face_iterator_reb](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/first_parallel_version_of_face_iterator_reb)** to **[u/gh-kliem/first_parallel_version_of_face_iterator_reb2](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/first_parallel_version_of_face_iterator_reb2)**",
    "created_at": "2021-05-20T08:17:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503749",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[u/gh-kliem/first_parallel_version_of_face_iterator_reb](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/first_parallel_version_of_face_iterator_reb)** to **[u/gh-kliem/first_parallel_version_of_face_iterator_reb2](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/first_parallel_version_of_face_iterator_reb2)**



---

archive/issue_comments_503750.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2474ccc2d1b7fcbead0a5f9eb27470c9ee365e00\">2474ccc</a></td><td><code>Merge branch 'u/gh-kliem/first_parallel_version_of_face_iterator_reb' of git://trac.sagemath.org/sage into u/gh-kliem/first_parallel_version_of_face_iterator_reb2</code></td></tr></table>\n",
    "created_at": "2021-05-20T08:17:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503750",
    "user": "https://github.com/kliem"
}
```

<div id="comment:35" align="right">Comment 35</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2474ccc2d1b7fcbead0a5f9eb27470c9ee365e00">2474ccc</a></td><td><code>Merge branch 'u/gh-kliem/first_parallel_version_of_face_iterator_reb' of git://trac.sagemath.org/sage into u/gh-kliem/first_parallel_version_of_face_iterator_reb2</code></td></tr></table>




---

archive/issue_comments_503751.json:
```json
{
    "body": "Changed commit from **[ae482a4](https://github.com/sagemath/sagetrac-mirror/commit/ae482a4d07ebc5f68fe78b37a32919c85b94aef5)** to **[2474ccc](https://github.com/sagemath/sagetrac-mirror/commit/2474ccc2d1b7fcbead0a5f9eb27470c9ee365e00)**",
    "created_at": "2021-05-20T08:17:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503751",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[ae482a4](https://github.com/sagemath/sagetrac-mirror/commit/ae482a4d07ebc5f68fe78b37a32919c85b94aef5)** to **[2474ccc](https://github.com/sagemath/sagetrac-mirror/commit/2474ccc2d1b7fcbead0a5f9eb27470c9ee365e00)**



---

archive/issue_comments_503752.json:
```json
{
    "body": "Changed commit from **[2474ccc](https://github.com/sagemath/sagetrac-mirror/commit/2474ccc2d1b7fcbead0a5f9eb27470c9ee365e00)** to **[fdbe95f](https://github.com/sagemath/sagetrac-mirror/commit/fdbe95f9cf2b4787a59a459231074a7c528397f3)**",
    "created_at": "2021-05-20T08:53:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503752",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2474ccc](https://github.com/sagemath/sagetrac-mirror/commit/2474ccc2d1b7fcbead0a5f9eb27470c9ee365e00)** to **[fdbe95f](https://github.com/sagemath/sagetrac-mirror/commit/fdbe95f9cf2b4787a59a459231074a7c528397f3)**



---

archive/issue_comments_503753.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/499af5da727a4dc169d270fd6496e6baffc11d06\">499af5d</a></td><td><code>remove SAGE_HAVE_OPENMP</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7b3da2185c0a8c4cc383f43fdcc39ded6546e37d\">7b3da21</a></td><td><code>move to sage_conf.py.in</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/927291f1c19c2ff3d82ec6c77bd367943c27c7b4\">927291f</a></td><td><code>simplifications</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d71c54a7e229c07274147b24712fe79c1b6716d5\">d71c54a</a></td><td><code>set default</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7d3f2307d4cc90b1069a36a6ad93c3b57802fd3b\">7d3f230</a></td><td><code>more solid check</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f4244004e7a2ad1da1f33d5151f77fb1e3137f1\">4f42440</a></td><td><code>sage.env.cython_aliases: Do not fail if one of the listed libraries is not known to pkgconfig</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3cb8f901fc8ce87f8c01e63b0a6768eb6a008d33\">3cb8f90</a></td><td><code>sage.env.cython_aliases: Make module lapack optional; generalize the interface</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c3cc31e29ca6c8c74aec619e422858d97f92e1c5\">c3cc31e</a></td><td><code>merge in 31384</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70a8791eb07df89a7d3e2a40c35516ae93e6e0bb\">70a8791</a></td><td><code>Merge branch 'u/gh-kliem/check_openmp_at_configuration' of git://trac.sagemath.org/sage into u/gh-kliem/first_parallel_version_of_face_iterator_reb2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fdbe95f9cf2b4787a59a459231074a7c528397f3\">fdbe95f</a></td><td><code>use cython.parallel.threadid instead of omp_get_thread_num</code></td></tr></table>\n",
    "created_at": "2021-05-20T08:53:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503753",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:36" align="right">Comment 36</div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/499af5da727a4dc169d270fd6496e6baffc11d06">499af5d</a></td><td><code>remove SAGE_HAVE_OPENMP</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7b3da2185c0a8c4cc383f43fdcc39ded6546e37d">7b3da21</a></td><td><code>move to sage_conf.py.in</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/927291f1c19c2ff3d82ec6c77bd367943c27c7b4">927291f</a></td><td><code>simplifications</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d71c54a7e229c07274147b24712fe79c1b6716d5">d71c54a</a></td><td><code>set default</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7d3f2307d4cc90b1069a36a6ad93c3b57802fd3b">7d3f230</a></td><td><code>more solid check</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f4244004e7a2ad1da1f33d5151f77fb1e3137f1">4f42440</a></td><td><code>sage.env.cython_aliases: Do not fail if one of the listed libraries is not known to pkgconfig</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3cb8f901fc8ce87f8c01e63b0a6768eb6a008d33">3cb8f90</a></td><td><code>sage.env.cython_aliases: Make module lapack optional; generalize the interface</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c3cc31e29ca6c8c74aec619e422858d97f92e1c5">c3cc31e</a></td><td><code>merge in 31384</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70a8791eb07df89a7d3e2a40c35516ae93e6e0bb">70a8791</a></td><td><code>Merge branch 'u/gh-kliem/check_openmp_at_configuration' of git://trac.sagemath.org/sage into u/gh-kliem/first_parallel_version_of_face_iterator_reb2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fdbe95f9cf2b4787a59a459231074a7c528397f3">fdbe95f</a></td><td><code>use cython.parallel.threadid instead of omp_get_thread_num</code></td></tr></table>




---

archive/issue_events_412370.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-05-20T08:55:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412370"
}
```



---

archive/issue_events_412371.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-05-20T08:55:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412371"
}
```



---

archive/issue_comments_503754.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nI'm not sure this was actually a merge conflict.\n\nBut even on my laptop with OPENMP support I got missing symbols. Don't exactly understand this.\n\nHowever, we can't use `openmp.omp_get_num_threads` for obvious reasons, because it doesn't have to be defined. Instead we should use `cython.parallel.threadid`, which takes care of this. It is supposed to work, just like prange.",
    "created_at": "2021-05-20T08:55:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503754",
    "user": "https://github.com/kliem"
}
```

<div id="comment:37" align="right">Comment 37</div>

I'm not sure this was actually a merge conflict.

But even on my laptop with OPENMP support I got missing symbols. Don't exactly understand this.

However, we can't use `openmp.omp_get_num_threads` for obvious reasons, because it doesn't have to be defined. Instead we should use `cython.parallel.threadid`, which takes care of this. It is supposed to work, just like prange.



---

archive/issue_events_412372.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-05-21T00:14:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412372"
}
```



---

archive/issue_events_412373.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-05-21T00:14:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412373"
}
```



---

archive/issue_comments_503755.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nWorks for me. Let's try this again...",
    "created_at": "2021-05-21T00:14:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503755",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:38" align="right">Comment 38</div>

Works for me. Let's try this again...



---

archive/issue_comments_503756.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nMerge conflict",
    "created_at": "2021-05-26T21:51:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503756",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:39" align="right">Comment 39</div>

Merge conflict



---

archive/issue_events_412374.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-05-26T21:51:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412374"
}
```



---

archive/issue_events_412375.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-05-26T21:51:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412375"
}
```



---

archive/issue_comments_503757.json:
```json
{
    "body": "Changed branch from **[u/gh-kliem/first_parallel_version_of_face_iterator_reb2](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/first_parallel_version_of_face_iterator_reb2)** to **[u/mkoeppe/first_parallel_version_of_face_iterator_reb2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/first_parallel_version_of_face_iterator_reb2)**",
    "created_at": "2021-05-26T22:32:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503757",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/gh-kliem/first_parallel_version_of_face_iterator_reb2](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/first_parallel_version_of_face_iterator_reb2)** to **[u/mkoeppe/first_parallel_version_of_face_iterator_reb2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/first_parallel_version_of_face_iterator_reb2)**



---

archive/issue_comments_503758.json:
```json
{
    "body": "Changed commit from **[fdbe95f](https://github.com/sagemath/sagetrac-mirror/commit/fdbe95f9cf2b4787a59a459231074a7c528397f3)** to **[4ae6966](https://github.com/sagemath/sagetrac-mirror/commit/4ae6966e49618739268625fbe5b9767ca6175200)**",
    "created_at": "2021-05-26T22:32:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503758",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[fdbe95f](https://github.com/sagemath/sagetrac-mirror/commit/fdbe95f9cf2b4787a59a459231074a7c528397f3)** to **[4ae6966](https://github.com/sagemath/sagetrac-mirror/commit/4ae6966e49618739268625fbe5b9767ca6175200)**



---

archive/issue_comments_503759.json:
```json
{
    "body": "Changed dependencies from **#31474, #31499** to **#31499**",
    "created_at": "2021-05-26T22:32:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503759",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#31474, #31499** to **#31499**



---

archive/issue_comments_503760.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4ae6966e49618739268625fbe5b9767ca6175200\">4ae6966</a></td><td><code>Merge tag '9.4.beta0' into t/31245/first_parallel_version_of_face_iterator_reb2</code></td></tr></table>\n",
    "created_at": "2021-05-26T22:32:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503760",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:41" align="right">Comment 41</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4ae6966e49618739268625fbe5b9767ca6175200">4ae6966</a></td><td><code>Merge tag '9.4.beta0' into t/31245/first_parallel_version_of_face_iterator_reb2</code></td></tr></table>




---

archive/issue_events_412376.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-26T22:32:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412376"
}
```



---

archive/issue_events_412377.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-26T22:32:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412377"
}
```



---

archive/issue_comments_503761.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\nSegfaults reliably on OSX\n\n```\nsage -t --long --random-seed=0 src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx  # Killed due to segmentation fault\nsage -t --long --random-seed=0 src/sage/geometry/polyhedron/base.py  # Killed due to segmentation fault\n```\nDebugger:\n\n```\n$ sage -sh\n(sage-sh) sudo lldb ./local/bin/python3\n(lldb) target create \"./local/bin/python3\"\nCurrent executable set to '/Users/buildbot-sage/slave/sage_git/build/local/bin/python3' (x86_64).\n(lldb) rfrom\nerror: 'rfrom' is not a valid command.\n(lldb) r\nProcess 81901 launched: '/Users/buildbot-sage/slave/sage_git/build/local/bin/python3' (x86_64)\nPython 3.9.5 (default, Jun  8 2021, 19:13:24) \n[Clang 12.0.5 (clang-1205.0.22.9)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> from sage.all import *\n>>> line = Polyhedron(lines=[[0,1]])\n>>> line.vertex_graph() ## line 7185 ##\nbase.cpython-39-darwin.so was compiled with optimization - stepping may behave oddly; variables may not be available.\nProcess 81901 stopped\n* thread #1, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x0)\n    frame #0: 0x00000001142ae934 base.cpython-39-darwin.so`__pyx_gb_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_24_compute_edges_or_ridges_5generator29(__pyx_generator=0x0000000114562160, __pyx_tstate=0x0000000100508140, __pyx_sent_value=0x00000001003a8580) at base.c:28817:74 [opt]\n   28814\t  __pyx_t_2 = __pyx_t_1;\n   28815\t  for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {\n   28816\t    __pyx_cur_scope->__pyx_v_i = __pyx_t_3;\n-> 28817\t    __pyx_t_4 = ((PyObject *)__pyx_f_4sage_5rings_7integer_smallInteger((__pyx_cur_scope->__pyx_outer_scope->__pyx_v_f_vector[__pyx_cur_scope->__pyx_v_i]))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3071, __pyx_L1_error)\n   28818\t    __Pyx_GOTREF(__pyx_t_4);\n   28819\t    __pyx_r = __pyx_t_4;\n   28820\t    __pyx_t_4 = 0;\nTarget 0: (python3) stopped.\n(lldb) \nerror: No auto repeat.\n(lldb) bt\n* thread #1, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x0)\n  * frame #0: 0x00000001142ae934 base.cpython-39-darwin.so`__pyx_gb_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_24_compute_edges_or_ridges_5generator29(__pyx_generator=0x0000000114562160, __pyx_tstate=0x0000000100508140, __pyx_sent_value=0x00000001003a8580) at base.c:28817:74 [opt]\n    frame #1: 0x00000001033bc4fa cachefunc.cpython-39-darwin.so`__Pyx_Coroutine_SendEx(self=0x0000000114562160, value=0x00000001003a8580, closing=<unavailable>) at cachefunc.c:28545:14 [opt]\n    frame #2: 0x00000001001573c0 libpython3.9.dylib`PySequence_Tuple + 144\n    frame #3: 0x00000001142abde3 base.cpython-39-darwin.so`__pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron__compute_edges_or_ridges(__pyx_v_self=<unavailable>, __pyx_v_dual=<unavailable>, __pyx_v_do_edges=<unavailable>) at base.c:29447:19 [opt]\n    frame #4: 0x00000001142b7aa7 base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_23edges [inlined] __pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron__compute_edges(__pyx_v_self=<unavailable>, __pyx_v_dual=<unavailable>) at base.c:43309:15 [opt]\n    frame #5: 0x00000001142b7a9b base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_23edges [inlined] __pyx_pf_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_22edges(__pyx_v_self=0x0000000114235ca0, __pyx_v_names=0x0000000000000000) at base.c:14187 [opt]\n    frame #6: 0x00000001142b742a base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_23edges(__pyx_v_self=0x0000000114235ca0, __pyx_args=<unavailable>, __pyx_kwds=<unavailable>) at base.c:13668 [opt]\n    frame #7: 0x00000001001ab7c5 libpython3.9.dylib`cfunction_call + 69\n    frame #8: 0x00000001142ca4d7 base.cpython-39-darwin.so`__pyx_gb_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_12vertex_graph_2generator13 [inlined] __Pyx_PyObject_Call(func=0x0000000114569860, arg=<unavailable>, kw=0x0000000100722e80) at base.c:52465:14 [opt]\n    frame #9: 0x00000001142ca49a base.cpython-39-darwin.so`__pyx_gb_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_12vertex_graph_2generator13(__pyx_generator=0x0000000112ae5b80, __pyx_tstate=<unavailable>, __pyx_sent_value=<unavailable>) at base.c:14600 [opt]\n    frame #10: 0x00000001033bc4fa cachefunc.cpython-39-darwin.so`__Pyx_Coroutine_SendEx(self=0x0000000112ae5b80, value=0x00000001003a8580, closing=<unavailable>) at cachefunc.c:28545:14 [opt]\n    frame #11: 0x00000001001573c0 libpython3.9.dylib`PySequence_Tuple + 144\n    frame #12: 0x00000001142b86c8 base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_25vertex_graph [inlined] __pyx_pf_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_24vertex_graph(__pyx_v_self=<unavailable>, __pyx_v_names=0x0000000000000000) at base.c:14808:15 [opt]\n    frame #13: 0x00000001142b85bb base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_25vertex_graph(__pyx_v_self=<unavailable>, __pyx_args=<unavailable>, __pyx_kwds=<unavailable>) at base.c:14515 [opt]\n    frame #14: 0x00000001001759c3 libpython3.9.dylib`method_vectorcall_VARARGS_KEYWORDS + 275\n    frame #15: 0x000000010024bc1b libpython3.9.dylib`call_function + 411\n    frame #16: 0x0000000100248c0b libpython3.9.dylib`_PyEval_EvalFrameDefault + 27147\n    frame #17: 0x000000010016d5b5 libpython3.9.dylib`function_code_fastcall + 229\n    frame #18: 0x000000010016f89c libpython3.9.dylib`method_vectorcall + 204\n    frame #19: 0x000000010024bc1b libpython3.9.dylib`call_function + 411\n    frame #20: 0x0000000100248c2e libpython3.9.dylib`_PyEval_EvalFrameDefault + 27182\n    frame #21: 0x000000010024c9d4 libpython3.9.dylib`_PyEval_EvalCode + 2580\n    frame #22: 0x0000000100242107 libpython3.9.dylib`PyEval_EvalCode + 87\n    frame #23: 0x000000010028c45f libpython3.9.dylib`PyRun_InteractiveOneObjectEx + 847\n    frame #24: 0x000000010028ba59 libpython3.9.dylib`PyRun_InteractiveLoopFlags + 169\n    frame #25: 0x000000010028b97c libpython3.9.dylib`PyRun_AnyFileExFlags + 60\n    frame #26: 0x00000001002a84ea libpython3.9.dylib`Py_RunMain + 2362\n    frame #27: 0x00000001002a87ec libpython3.9.dylib`pymain_main + 348\n    frame #28: 0x00000001002a883b libpython3.9.dylib`Py_BytesMain + 43\n    frame #29: 0x00007fff20394621 libdyld.dylib`start + 1\n    frame #30: 0x00007fff20394621 libdyld.dylib`start + 1\n```",
    "created_at": "2021-06-19T08:50:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503761",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:42" align="right">Comment 42</div>

Segfaults reliably on OSX

```
sage -t --long --random-seed=0 src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx  # Killed due to segmentation fault
sage -t --long --random-seed=0 src/sage/geometry/polyhedron/base.py  # Killed due to segmentation fault
```
Debugger:

```
$ sage -sh
(sage-sh) sudo lldb ./local/bin/python3
(lldb) target create "./local/bin/python3"
Current executable set to '/Users/buildbot-sage/slave/sage_git/build/local/bin/python3' (x86_64).
(lldb) rfrom
error: 'rfrom' is not a valid command.
(lldb) r
Process 81901 launched: '/Users/buildbot-sage/slave/sage_git/build/local/bin/python3' (x86_64)
Python 3.9.5 (default, Jun  8 2021, 19:13:24) 
[Clang 12.0.5 (clang-1205.0.22.9)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> from sage.all import *
>>> line = Polyhedron(lines=[[0,1]])
>>> line.vertex_graph() ## line 7185 ##
base.cpython-39-darwin.so was compiled with optimization - stepping may behave oddly; variables may not be available.
Process 81901 stopped
* thread #1, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x0)
    frame #0: 0x00000001142ae934 base.cpython-39-darwin.so`__pyx_gb_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_24_compute_edges_or_ridges_5generator29(__pyx_generator=0x0000000114562160, __pyx_tstate=0x0000000100508140, __pyx_sent_value=0x00000001003a8580) at base.c:28817:74 [opt]
   28814	  __pyx_t_2 = __pyx_t_1;
   28815	  for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
   28816	    __pyx_cur_scope->__pyx_v_i = __pyx_t_3;
-> 28817	    __pyx_t_4 = ((PyObject *)__pyx_f_4sage_5rings_7integer_smallInteger((__pyx_cur_scope->__pyx_outer_scope->__pyx_v_f_vector[__pyx_cur_scope->__pyx_v_i]))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3071, __pyx_L1_error)
   28818	    __Pyx_GOTREF(__pyx_t_4);
   28819	    __pyx_r = __pyx_t_4;
   28820	    __pyx_t_4 = 0;
Target 0: (python3) stopped.
(lldb) 
error: No auto repeat.
(lldb) bt
* thread #1, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x0)
  * frame #0: 0x00000001142ae934 base.cpython-39-darwin.so`__pyx_gb_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_24_compute_edges_or_ridges_5generator29(__pyx_generator=0x0000000114562160, __pyx_tstate=0x0000000100508140, __pyx_sent_value=0x00000001003a8580) at base.c:28817:74 [opt]
    frame #1: 0x00000001033bc4fa cachefunc.cpython-39-darwin.so`__Pyx_Coroutine_SendEx(self=0x0000000114562160, value=0x00000001003a8580, closing=<unavailable>) at cachefunc.c:28545:14 [opt]
    frame #2: 0x00000001001573c0 libpython3.9.dylib`PySequence_Tuple + 144
    frame #3: 0x00000001142abde3 base.cpython-39-darwin.so`__pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron__compute_edges_or_ridges(__pyx_v_self=<unavailable>, __pyx_v_dual=<unavailable>, __pyx_v_do_edges=<unavailable>) at base.c:29447:19 [opt]
    frame #4: 0x00000001142b7aa7 base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_23edges [inlined] __pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron__compute_edges(__pyx_v_self=<unavailable>, __pyx_v_dual=<unavailable>) at base.c:43309:15 [opt]
    frame #5: 0x00000001142b7a9b base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_23edges [inlined] __pyx_pf_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_22edges(__pyx_v_self=0x0000000114235ca0, __pyx_v_names=0x0000000000000000) at base.c:14187 [opt]
    frame #6: 0x00000001142b742a base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_23edges(__pyx_v_self=0x0000000114235ca0, __pyx_args=<unavailable>, __pyx_kwds=<unavailable>) at base.c:13668 [opt]
    frame #7: 0x00000001001ab7c5 libpython3.9.dylib`cfunction_call + 69
    frame #8: 0x00000001142ca4d7 base.cpython-39-darwin.so`__pyx_gb_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_12vertex_graph_2generator13 [inlined] __Pyx_PyObject_Call(func=0x0000000114569860, arg=<unavailable>, kw=0x0000000100722e80) at base.c:52465:14 [opt]
    frame #9: 0x00000001142ca49a base.cpython-39-darwin.so`__pyx_gb_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_12vertex_graph_2generator13(__pyx_generator=0x0000000112ae5b80, __pyx_tstate=<unavailable>, __pyx_sent_value=<unavailable>) at base.c:14600 [opt]
    frame #10: 0x00000001033bc4fa cachefunc.cpython-39-darwin.so`__Pyx_Coroutine_SendEx(self=0x0000000112ae5b80, value=0x00000001003a8580, closing=<unavailable>) at cachefunc.c:28545:14 [opt]
    frame #11: 0x00000001001573c0 libpython3.9.dylib`PySequence_Tuple + 144
    frame #12: 0x00000001142b86c8 base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_25vertex_graph [inlined] __pyx_pf_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_24vertex_graph(__pyx_v_self=<unavailable>, __pyx_v_names=0x0000000000000000) at base.c:14808:15 [opt]
    frame #13: 0x00000001142b85bb base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_25vertex_graph(__pyx_v_self=<unavailable>, __pyx_args=<unavailable>, __pyx_kwds=<unavailable>) at base.c:14515 [opt]
    frame #14: 0x00000001001759c3 libpython3.9.dylib`method_vectorcall_VARARGS_KEYWORDS + 275
    frame #15: 0x000000010024bc1b libpython3.9.dylib`call_function + 411
    frame #16: 0x0000000100248c0b libpython3.9.dylib`_PyEval_EvalFrameDefault + 27147
    frame #17: 0x000000010016d5b5 libpython3.9.dylib`function_code_fastcall + 229
    frame #18: 0x000000010016f89c libpython3.9.dylib`method_vectorcall + 204
    frame #19: 0x000000010024bc1b libpython3.9.dylib`call_function + 411
    frame #20: 0x0000000100248c2e libpython3.9.dylib`_PyEval_EvalFrameDefault + 27182
    frame #21: 0x000000010024c9d4 libpython3.9.dylib`_PyEval_EvalCode + 2580
    frame #22: 0x0000000100242107 libpython3.9.dylib`PyEval_EvalCode + 87
    frame #23: 0x000000010028c45f libpython3.9.dylib`PyRun_InteractiveOneObjectEx + 847
    frame #24: 0x000000010028ba59 libpython3.9.dylib`PyRun_InteractiveLoopFlags + 169
    frame #25: 0x000000010028b97c libpython3.9.dylib`PyRun_AnyFileExFlags + 60
    frame #26: 0x00000001002a84ea libpython3.9.dylib`Py_RunMain + 2362
    frame #27: 0x00000001002a87ec libpython3.9.dylib`pymain_main + 348
    frame #28: 0x00000001002a883b libpython3.9.dylib`Py_BytesMain + 43
    frame #29: 0x00007fff20394621 libdyld.dylib`start + 1
    frame #30: 0x00007fff20394621 libdyld.dylib`start + 1
```



---

archive/issue_events_412378.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-19T08:50:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412378"
}
```



---

archive/issue_events_412379.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-19T08:50:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412379"
}
```



---

archive/issue_comments_503762.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">Comment 43</div>\n\nThanks Volker for the precise log.\n\nUnfortunately, I neither understand the problem nor can reproduce it. I could just disable OpenMP with clang by default and hope this solves the problem.",
    "created_at": "2021-06-19T09:19:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503762",
    "user": "https://github.com/kliem"
}
```

<div id="comment:43" align="right">Comment 43</div>

Thanks Volker for the precise log.

Unfortunately, I neither understand the problem nor can reproduce it. I could just disable OpenMP with clang by default and hope this solves the problem.



---

archive/issue_events_412380.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-06-19T11:06:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412380"
}
```



---

archive/issue_events_412381.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-06-19T11:06:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412381"
}
```



---

archive/issue_comments_503763.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/first_parallel_version_of_face_iterator_reb2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/first_parallel_version_of_face_iterator_reb2)** to **[u/gh-kliem/first_parallel_version_of_face_iterator_reb3](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/first_parallel_version_of_face_iterator_reb3)**",
    "created_at": "2021-06-19T11:06:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503763",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[u/mkoeppe/first_parallel_version_of_face_iterator_reb2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/first_parallel_version_of_face_iterator_reb2)** to **[u/gh-kliem/first_parallel_version_of_face_iterator_reb3](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/first_parallel_version_of_face_iterator_reb3)**



---

archive/issue_comments_503764.json:
```json
{
    "body": "Changed commit from **[4ae6966](https://github.com/sagemath/sagetrac-mirror/commit/4ae6966e49618739268625fbe5b9767ca6175200)** to **[4c0a4ae](https://github.com/sagemath/sagetrac-mirror/commit/4c0a4ae74c28680e48080c39c5e3b171a79a9ad3)**",
    "created_at": "2021-06-19T11:06:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503764",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[4ae6966](https://github.com/sagemath/sagetrac-mirror/commit/4ae6966e49618739268625fbe5b9767ca6175200)** to **[4c0a4ae](https://github.com/sagemath/sagetrac-mirror/commit/4c0a4ae74c28680e48080c39c5e3b171a79a9ad3)**



---

archive/issue_comments_503765.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">Comment 44</div>\n\nI think I tracked it down. I assumed that\n\n```\ncdef bint do_f_vector\n```\nis initialized to zero, which apparently isn't always the case.\n\nThen Volkers report also makes sense.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bfb4efb24275dd80071451411f71094fe4084710\">bfb4efb</a></td><td><code>Merge branch 'u/mkoeppe/first_parallel_version_of_face_iterator_reb2' of git://trac.sagemath.org/sage into u/mkoeppe/first_parallel_version_of_face_iterator_reb3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c0a4ae74c28680e48080c39c5e3b171a79a9ad3\">4c0a4ae</a></td><td><code>initialize do_f_vector</code></td></tr></table>\n",
    "created_at": "2021-06-19T11:06:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503765",
    "user": "https://github.com/kliem"
}
```

<div id="comment:44" align="right">Comment 44</div>

I think I tracked it down. I assumed that

```
cdef bint do_f_vector
```
is initialized to zero, which apparently isn't always the case.

Then Volkers report also makes sense.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bfb4efb24275dd80071451411f71094fe4084710">bfb4efb</a></td><td><code>Merge branch 'u/mkoeppe/first_parallel_version_of_face_iterator_reb2' of git://trac.sagemath.org/sage into u/mkoeppe/first_parallel_version_of_face_iterator_reb3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c0a4ae74c28680e48080c39c5e3b171a79a9ad3">4c0a4ae</a></td><td><code>initialize do_f_vector</code></td></tr></table>




---

archive/issue_comments_503766.json:
```json
{
    "body": "Changed dependencies from **#31499** to none",
    "created_at": "2021-06-19T11:06:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503766",
    "user": "https://github.com/kliem"
}
```

Changed dependencies from **#31499** to none



---

archive/issue_comments_503767.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">Comment 45</div>\n\nI really don't understand why this pops out just now and not earlier.",
    "created_at": "2021-06-19T11:07:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503767",
    "user": "https://github.com/kliem"
}
```

<div id="comment:45" align="right">Comment 45</div>

I really don't understand why this pops out just now and not earlier.



---

archive/issue_comments_503768.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">Comment 46</div>\n\nUninitialized variables are whatever the RAM content is when they enter scope. However, any RAM region that you get from the OS is zeroed out (so you can't read content from older processes). So uninitialized variables tend to be zero initially, but the longer the program runs the more likely it becomes that the variable occupies a previously-used memory location.\n\nMore precisely, only global and static C variables are guaranteed to be initialized to zero, local variables are not.\n\nValgrind can detect these things for you (i.e. when you read uninitialized memory)",
    "created_at": "2021-06-19T13:53:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503768",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:46" align="right">Comment 46</div>

Uninitialized variables are whatever the RAM content is when they enter scope. However, any RAM region that you get from the OS is zeroed out (so you can't read content from older processes). So uninitialized variables tend to be zero initially, but the longer the program runs the more likely it becomes that the variable occupies a previously-used memory location.

More precisely, only global and static C variables are guaranteed to be initialized to zero, local variables are not.

Valgrind can detect these things for you (i.e. when you read uninitialized memory)



---

archive/issue_comments_503769.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">Comment 47</div>\n\nReplying to [@vbraun](#comment%3A46):\n> Uninitialized variables are whatever the RAM content is when they enter scope. However, any RAM region that you get from the OS is zeroed out (so you can't read content from older processes). So uninitialized variables tend to be zero initially, but the longer the program runs the more likely it becomes that the variable occupies a previously-used memory location.\n> \n> More precisely, only global and static C variables are guaranteed to be initialized to zero, local variables are not.\n> \n> Valgrind can detect these things for you (i.e. when you read uninitialized memory)\n> \n>    \n\nThank you for the explanation.\n\nOnce I found out where the problem lies, I wasn't that confused anymore. I originally thought it had something to do with the current ticket, but it doesn't, it just appears now, probably because it now gets stabely compiled in a slightly different way.\n\nIn this case it is actually a mistake I made (which I in theory knew about, when I made it). I never meant to assume anything on an unitialized `bint`: There where two cases and depending on the case I would set it to `True` and `False` and then I added special handling for corner cases and forgot to initialize the `bint`.\n\nI didn't know that RAM is zeroed out before the process, but once you mention it, of course this is how it ought to be.",
    "created_at": "2021-06-19T18:36:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503769",
    "user": "https://github.com/kliem"
}
```

<div id="comment:47" align="right">Comment 47</div>

Replying to [@vbraun](#comment%3A46):
> Uninitialized variables are whatever the RAM content is when they enter scope. However, any RAM region that you get from the OS is zeroed out (so you can't read content from older processes). So uninitialized variables tend to be zero initially, but the longer the program runs the more likely it becomes that the variable occupies a previously-used memory location.
> 
> More precisely, only global and static C variables are guaranteed to be initialized to zero, local variables are not.
> 
> Valgrind can detect these things for you (i.e. when you read uninitialized memory)
> 
>    

Thank you for the explanation.

Once I found out where the problem lies, I wasn't that confused anymore. I originally thought it had something to do with the current ticket, but it doesn't, it just appears now, probably because it now gets stabely compiled in a slightly different way.

In this case it is actually a mistake I made (which I in theory knew about, when I made it). I never meant to assume anything on an unitialized `bint`: There where two cases and depending on the case I would set it to `True` and `False` and then I added special handling for corner cases and forgot to initialize the `bint`.

I didn't know that RAM is zeroed out before the process, but once you mention it, of course this is how it ought to be.



---

archive/issue_comments_503770.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">Comment 48</div>\n\nHopefully this will be the last iteration of this. Sorry for having to redo this a bunch of times Volker; I just haven't been able to locally recreate any of the issues.",
    "created_at": "2021-06-20T22:53:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503770",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:48" align="right">Comment 48</div>

Hopefully this will be the last iteration of this. Sorry for having to redo this a bunch of times Volker; I just haven't been able to locally recreate any of the issues.



---

archive/issue_events_412382.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-06-20T22:53:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412382"
}
```



---

archive/issue_events_412383.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-06-20T22:53:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412383"
}
```



---

archive/issue_events_412384.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-29T17:40:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412384"
}
```



---

archive/issue_events_412385.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "0b04ecd107ff10f5c745e5543d078925e82fe60d",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-06-29T17:40:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31245#event-412385"
}
```



---

archive/issue_comments_503771.json:
```json
{
    "body": "Changed branch from **[u/gh-kliem/first_parallel_version_of_face_iterator_reb3](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/first_parallel_version_of_face_iterator_reb3)** to **[4c0a4ae](https://github.com/sagemath/sagetrac-mirror/commit/4c0a4ae74c28680e48080c39c5e3b171a79a9ad3)**",
    "created_at": "2021-06-29T17:40:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31245#issuecomment-503771",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gh-kliem/first_parallel_version_of_face_iterator_reb3](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/first_parallel_version_of_face_iterator_reb3)** to **[4c0a4ae](https://github.com/sagemath/sagetrac-mirror/commit/4c0a4ae74c28680e48080c39c5e3b171a79a9ad3)**
