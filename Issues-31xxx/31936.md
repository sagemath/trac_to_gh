# Issue 31936: docbuild: Japanese characters creeping into other parts of Sage documentation

archive/issues_031699.json:
```json
{
    "body": "Japanese characters creep into various parts of Sage documentation. For example, the table of contents in the (English) Sage developer's guide (html) has headings in Japanese, and when building the PDF version of `it/a_tour_of_sage`, I see this error:\n\n```\n    ! Package inputenc Error: Unicode character \u30ea (U+30EA)\n```\nIndeed, the file `local/share/doc/sage/latex/it/a_tour_of_sage/a_tour_of_sage.tex` has the line\n\n```\n    \\renewcommand{\\releasename}{\u30ea\u30ea\u30fc\u30b9}\n```\nand also a few lines earlier\n\n```\n    \\date{2021\u5e7406\u670808\u65e5}\n```\nand at the bottom\n\n```\n    \\renewcommand{\\indexname}{\u7d22\u5f15}\n```\nThese lines are the same as in ja/a_tour_of_sage/a_tour_of_sage.tex.\n\nCC:  @zlscherr @kiwifb @kliem @mkoeppe\n\nDependencies: #31948\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/31936\n\n",
    "closed_at": "2021-06-24T20:15:37Z",
    "created_at": "2021-06-08T21:33:08Z",
    "labels": [
        "component: documentation",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "docbuild: Japanese characters creeping into other parts of Sage documentation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31936",
    "user": "https://github.com/jhpalmieri"
}
```
Japanese characters creep into various parts of Sage documentation. For example, the table of contents in the (English) Sage developer's guide (html) has headings in Japanese, and when building the PDF version of `it/a_tour_of_sage`, I see this error:

```
    ! Package inputenc Error: Unicode character リ (U+30EA)
```
Indeed, the file `local/share/doc/sage/latex/it/a_tour_of_sage/a_tour_of_sage.tex` has the line

```
    \renewcommand{\releasename}{リリース}
```
and also a few lines earlier

```
    \date{2021年06月08日}
```
and at the bottom

```
    \renewcommand{\indexname}{索引}
```
These lines are the same as in ja/a_tour_of_sage/a_tour_of_sage.tex.

CC:  @zlscherr @kiwifb @kliem @mkoeppe

Dependencies: #31948

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/31936





---

archive/issue_comments_635194.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,7 +3,7 @@\n ```\n     ! Package inputenc Error: Unicode character \u30ea (U+30EA)\n ```\n-Indeed, the file `local/share/doc/sage/latex/it/a_tour_of_sage/a_tour_of_sage.tex has the line\n+Indeed, the file `local/share/doc/sage/latex/it/a_tour_of_sage/a_tour_of_sage.tex` has the line\n \n ```\n     \\renewcommand{\\releasename}{\u30ea\u30ea\u30fc\u30b9}\n``````\n",
    "created_at": "2021-06-08T21:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31936#issuecomment-635194",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,7 +3,7 @@
 ```
     ! Package inputenc Error: Unicode character リ (U+30EA)
 ```
-Indeed, the file `local/share/doc/sage/latex/it/a_tour_of_sage/a_tour_of_sage.tex has the line
+Indeed, the file `local/share/doc/sage/latex/it/a_tour_of_sage/a_tour_of_sage.tex` has the line
 
 ```
     \renewcommand{\releasename}{リリース}
``````




---

archive/issue_comments_635195.json:
```json
{
    "body": "<a id='comment:2'></a>Since maybe Sage 9.3, some interface elements of\nthe (English language) (html) developer guide appear\nin Japanese for me in Sage built from source.\n\nComparing the online version and my local version\nof the \"Git setup\" page for instance:\n\n- https://doc.sagemath.org/html/en/developer/git_setup.html\n- file:///path_to_sage/local/share/doc/sage/html/en/developer/git_setup.html\n\nthe correspondence is as follows.\n\nMenu headers in the left menu:\n\n- Table of Contents - \u76ee\u6b21\n- Previous topic - \u524d\u306e\u30c8\u30d4\u30c3\u30af\u3078\n- Next topic - \u6b21\u306e\u30c8\u30d4\u30c3\u30af\u3078\n- This Page - \u3053\u306e\u30da\u30fc\u30b8\n- Quick search - \u30af\u30a4\u30c3\u30af\u691c\u7d22\n\nNavigation menu (top right and bottom right):\n\n- previous - \u524d\u3078\n- next - \u6b21\u3078\n- index - \u7d22\u5f15",
    "created_at": "2021-06-08T22:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31936#issuecomment-635195",
    "user": "https://github.com/slel"
}
```

<a id='comment:2'></a>Since maybe Sage 9.3, some interface elements of
the (English language) (html) developer guide appear
in Japanese for me in Sage built from source.

Comparing the online version and my local version
of the "Git setup" page for instance:

- https://doc.sagemath.org/html/en/developer/git_setup.html
- file:///path_to_sage/local/share/doc/sage/html/en/developer/git_setup.html

the correspondence is as follows.

Menu headers in the left menu:

- Table of Contents - 目次
- Previous topic - 前のトピックへ
- Next topic - 次のトピックへ
- This Page - このページ
- Quick search - クイック検索

Navigation menu (top right and bottom right):

- previous - 前へ
- next - 次へ
- index - 索引



---

archive/issue_comments_635196.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,24 @@\n+Japanese characters creep into various parts of Sage documentation. For example, the table of contents in the (English) Sage developer's guide (html) has headings in Japanese, and when building the PDF version of `it/a_tour_of_sage`, I see this error:\n \n+```\n+    ! Package inputenc Error: Unicode character \u30ea (U+30EA)\n+```\n+Indeed, the file `local/share/doc/sage/latex/it/a_tour_of_sage/a_tour_of_sage.tex` has the line\n+\n+```\n+    \\renewcommand{\\releasename}{\u30ea\u30ea\u30fc\u30b9}\n+```\n+and also a few lines earlier\n+\n+```\n+    \\date{2021\u5e7406\u670808\u65e5}\n+```\n+and at the bottom\n+\n+```\n+    \\renewcommand{\\indexname}{\u7d22\u5f15}\n+```\n+These lines are the same as in ja/a_tour_of_sage/a_tour_of_sage.tex.\n \n Comment: 1\n \n``````\n",
    "created_at": "2021-06-09T00:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31936#issuecomment-635196",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,24 @@
+Japanese characters creep into various parts of Sage documentation. For example, the table of contents in the (English) Sage developer's guide (html) has headings in Japanese, and when building the PDF version of `it/a_tour_of_sage`, I see this error:
 
+```
+    ! Package inputenc Error: Unicode character リ (U+30EA)
+```
+Indeed, the file `local/share/doc/sage/latex/it/a_tour_of_sage/a_tour_of_sage.tex` has the line
+
+```
+    \renewcommand{\releasename}{リリース}
+```
+and also a few lines earlier
+
+```
+    \date{2021年06月08日}
+```
+and at the bottom
+
+```
+    \renewcommand{\indexname}{索引}
+```
+These lines are the same as in ja/a_tour_of_sage/a_tour_of_sage.tex.
 
 Comment: 1
 
``````




---

archive/issue_comments_635197.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2021-06-09T00:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31936#issuecomment-635197",
    "user": "https://github.com/jhpalmieri"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_635198.json:
```json
{
    "body": "<a id='comment:3'></a>Oh, I see that too. Ticket summary changed.",
    "created_at": "2021-06-09T00:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31936#issuecomment-635198",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>Oh, I see that too. Ticket summary changed.



---

archive/issue_comments_635199.json:
```json
{
    "body": "<a id='comment:4'></a>The Sphinx upgrade #31696 doesn't help.",
    "created_at": "2021-06-09T04:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31936#issuecomment-635199",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>The Sphinx upgrade #31696 doesn't help.



---

archive/issue_comments_635200.json:
```json
{
    "body": "<a id='comment:5'></a>I cannot reproduce this on (Gentoo) Linux. Everything looks fine.\nOn the other hand, I see it (Japanese menus) on macOS 11.4, too.",
    "created_at": "2021-06-09T15:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31936#issuecomment-635200",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>I cannot reproduce this on (Gentoo) Linux. Everything looks fine.
On the other hand, I see it (Japanese menus) on macOS 11.4, too.



---

archive/issue_comments_635201.json:
```json
{
    "body": "<a id='comment:6'></a>#30551 changed various locale settings, perhaps it's the culprit.",
    "created_at": "2021-06-09T16:50:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31936#issuecomment-635201",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>#30551 changed various locale settings, perhaps it's the culprit.



---

archive/issue_comments_635202.json:
```json
{
    "body": "<a id='comment:7'></a>The problem is #31344, in particular commit [b4ceee5](https://git.sagemath.org/sage.git/commit/?id=b4ceee5dae4caa7dac7a6fe7ca29538aca2d381a).",
    "created_at": "2021-06-10T02:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31936#issuecomment-635202",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>The problem is #31344, in particular commit [b4ceee5](https://git.sagemath.org/sage.git/commit/?id=b4ceee5dae4caa7dac7a6fe7ca29538aca2d381a).



---

archive/issue_comments_635203.json:
```json
{
    "body": "<a id='comment:9'></a>Do we have some kind of race condition between languages? Does the problem persists when building serially?",
    "created_at": "2021-06-10T02:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31936#issuecomment-635203",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>Do we have some kind of race condition between languages? Does the problem persists when building serially?



---

archive/issue_comments_635204.json:
```json
{
    "body": "<a id='comment:10'></a>If I unset `MAKE`, I think that makes it build serially, and I still see the problem. I wonder if it comes from lines like this in `src/doc/ja/a_tour_of_sage/conf.py`:\n\n```\nfrom sage.docs.conf import release, latex_elements\nfrom sage.docs.conf import *  # NOQA\n```\nand similar lines in other `conf.py` files. Could modifications to configuration variables get passed between different builds?",
    "created_at": "2021-06-10T02:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31936#issuecomment-635204",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>If I unset `MAKE`, I think that makes it build serially, and I still see the problem. I wonder if it comes from lines like this in `src/doc/ja/a_tour_of_sage/conf.py`:

```
from sage.docs.conf import release, latex_elements
from sage.docs.conf import *  # NOQA
```
and similar lines in other `conf.py` files. Could modifications to configuration variables get passed between different builds?



---

archive/issue_comments_635205.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:7 jhpalmieri]:\n> The problem is #31344, in particular commit [b4ceee5](https://git.sagemath.org/sage.git/commit/?id=b4ceee5dae4caa7dac7a6fe7ca29538aca2d381a).\n\nNice catch. Previously the different languages were isolated in separate processes via `build_many`, now they run serially in the same Python process, so there's a potential for state to persist.",
    "created_at": "2021-06-10T03:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31936#issuecomment-635205",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>Replying to [comment:7 jhpalmieri]:
> The problem is #31344, in particular commit [b4ceee5](https://git.sagemath.org/sage.git/commit/?id=b4ceee5dae4caa7dac7a6fe7ca29538aca2d381a).

Nice catch. Previously the different languages were isolated in separate processes via `build_many`, now they run serially in the same Python process, so there's a potential for state to persist.



---

archive/issue_comments_635206.json:
```json
{
    "body": "<a id='comment:12'></a>#31948 (Reimplement parallel docbuild using make) could be a solution; or a simpler workaround using `os.system` (or similar) to run the separate documents serially in separate processes.",
    "created_at": "2021-06-10T03:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31936#issuecomment-635206",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>#31948 (Reimplement parallel docbuild using make) could be a solution; or a simpler workaround using `os.system` (or similar) to run the separate documents serially in separate processes.



---

archive/issue_comments_635207.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#31948\"",
    "created_at": "2021-06-14T06:23:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31936#issuecomment-635207",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#31948"



---

archive/issue_comments_635208.json:
```json
{
    "body": "<a id='comment:14'></a>I think that #31948 fixes this. Once that's merged and tested, we should close this ticket.",
    "created_at": "2021-06-17T16:09:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31936#issuecomment-635208",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>I think that #31948 fixes this. Once that's merged and tested, we should close this ticket.



---

archive/issue_comments_635209.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-23T16:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31936#issuecomment-635209",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_events_084405.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-23T16:00:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31936#event-84405"
}
```



---

archive/issue_comments_635210.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-23T16:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31936#issuecomment-635210",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_635211.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-06-24T20:15:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31936#issuecomment-635211",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid



---

archive/issue_events_084406.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-24T20:15:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31936",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31936#event-84406"
}
```
