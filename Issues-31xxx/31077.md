# Issue 31077: very incorrect "expand" of a symbolic expression

archive/issues_030840.json:
```json
{
    "assignees": [],
    "body": "As discussed on [sagedevel](https://groups.google.com/g/sage-devel/c/cuYVxld88Ng/m/nNfV4jxBBAAJ), the following determinant is 0, but that's not what sage says:\n\n```\nsage: a,b,c,d,e,z = var(\"a b c d e z\") \n....: L = Matrix([\n....:     [-a, 1, 0, 0, 0, -4*d/z, 0, 0, 0], \n....:     [1, a - b - 1, 1, 0, 4*d/z, 0, 0, 0, 0], \n....:     [0, 1, b - c + 2, b, 0, 0, 0, 0, 0], \n....:     [0, 0, b, c - 3, 0, 0, 0, 0, 2*e], \n....:     [0, d*z, 0, 0, a, -1, 0, 0, 0], \n....:     [-d*z, 0, 0, 0, -1, -a + b + 1, -1, 0, 0], \n....:     [0, 0, 0, 0, 0, -1, -b + c - 2, -b, 0], \n....:     [0, 0, 0, 0, 0, 0, -b, -c + 3, -e], \n....:     [0, 0, 0, e, 0, 0, 0, -2*e, 0]]) \n....: L.det().factor() # should be 0, but it's not\n4*a*b^2*d*e^2*(z + 1)*(z - 1)/z\n```\nTo confirm that the determinant is 0, just multiply the matrix by z, which multiplies the determinant by z<sup>9</sup>:\n\n```\nsage: (z*L).det()\n0\n```\n(Calculating in a `LaurentPolynomialRing` also verifies that the determinant is 0.)\n\nEdit: Further investigation seems to reveal that the determinant is calculated correctly by maxima, but then sage's `expand` method introduces an error.\n\nCC:  @orlitzky @fchapoton @burcin @rwst @behackl @kcrisman\n\nKeywords: **expand**\n\nBranch/Commit: **[public/31077v2](https://github.com/sagemath/sagetrac-mirror/tree/public/31077v2) @ [`d05da0b`](https://github.com/sagemath/sagetrac-mirror/commit/d05da0bf665ad4abdc3757aee28245036ee42b4e)**\n\nAuthor: **Dave Morris**\n\nComponent: **symbolics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31077_\n\n",
    "created_at": "2020-12-18T18:56:16Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "very incorrect \"expand\" of a symbolic expression",
    "type": "issue",
    "updated_at": "2023-01-08T09:11:36Z",
    "url": "https://github.com/sagemath/sage/issues/31077",
    "user": "https://github.com/DaveWitteMorris"
}
```
As discussed on [sagedevel](https://groups.google.com/g/sage-devel/c/cuYVxld88Ng/m/nNfV4jxBBAAJ), the following determinant is 0, but that's not what sage says:

```
sage: a,b,c,d,e,z = var("a b c d e z") 
....: L = Matrix([
....:     [-a, 1, 0, 0, 0, -4*d/z, 0, 0, 0], 
....:     [1, a - b - 1, 1, 0, 4*d/z, 0, 0, 0, 0], 
....:     [0, 1, b - c + 2, b, 0, 0, 0, 0, 0], 
....:     [0, 0, b, c - 3, 0, 0, 0, 0, 2*e], 
....:     [0, d*z, 0, 0, a, -1, 0, 0, 0], 
....:     [-d*z, 0, 0, 0, -1, -a + b + 1, -1, 0, 0], 
....:     [0, 0, 0, 0, 0, -1, -b + c - 2, -b, 0], 
....:     [0, 0, 0, 0, 0, 0, -b, -c + 3, -e], 
....:     [0, 0, 0, e, 0, 0, 0, -2*e, 0]]) 
....: L.det().factor() # should be 0, but it's not
4*a*b^2*d*e^2*(z + 1)*(z - 1)/z
```
To confirm that the determinant is 0, just multiply the matrix by z, which multiplies the determinant by z<sup>9</sup>:

```
sage: (z*L).det()
0
```
(Calculating in a `LaurentPolynomialRing` also verifies that the determinant is 0.)

Edit: Further investigation seems to reveal that the determinant is calculated correctly by maxima, but then sage's `expand` method introduces an error.

CC:  @orlitzky @fchapoton @burcin @rwst @behackl @kcrisman

Keywords: **expand**

Branch/Commit: **[public/31077v2](https://github.com/sagemath/sagetrac-mirror/tree/public/31077v2) @ [`d05da0b`](https://github.com/sagemath/sagetrac-mirror/commit/d05da0bf665ad4abdc3757aee28245036ee42b4e)**

Author: **Dave Morris**

Component: **symbolics**

_Issue created by migration from https://trac.sagemath.org/ticket/31077_





---

archive/issue_events_428526.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2020-12-18T18:56:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428526"
}
```



---

archive/issue_events_428527.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2020-12-18T18:56:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428527"
}
```



---

archive/issue_events_428528.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2020-12-18T18:56:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428528"
}
```



---

archive/issue_events_428529.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2020-12-18T18:56:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428529"
}
```



---

archive/issue_comments_498081.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThis seems to be a maxima bug (or a bug in the maxima interface):\n\n```\nsage: f(x) = L._maxima_(maxima).charpoly('x')._sage_().expand()\nsage: f(0).factor()                                                                                                                                         \n4*a*b^2*d*e^2*(z + 1)*(z - 1)/z\n```",
    "created_at": "2020-12-18T19:59:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498081",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:2" align="right">comment:2</div>

This seems to be a maxima bug (or a bug in the maxima interface):

```
sage: f(x) = L._maxima_(maxima).charpoly('x')._sage_().expand()
sage: f(0).factor()                                                                                                                                         
4*a*b^2*d*e^2*(z + 1)*(z - 1)/z
```



---

archive/issue_comments_498082.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nMore precisely, it seems to be within the expand method:\n\n```\nsage: var = 'A0123456789'\nsage: p = L._maxima_(maxima).charpoly(var)._sage_()\nsage: fricas(p).series(A0123456789=0) -  fricas(p.expand()).series(A0123456789=0)\n         2   2 2        2   2        2   2 2      2   2\n  - 4 a b d e z  + 4 a b d e    - 4 b d e z  + 4 b d e\n  --------------------------- + ----------------------- A0123456789\n               z                           z\n+ \n               11\n  O(A0123456789  )\n\n```",
    "created_at": "2020-12-18T20:15:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498082",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:3" align="right">comment:3</div>

More precisely, it seems to be within the expand method:

```
sage: var = 'A0123456789'
sage: p = L._maxima_(maxima).charpoly(var)._sage_()
sage: fricas(p).series(A0123456789=0) -  fricas(p.expand()).series(A0123456789=0)
         2   2 2        2   2        2   2 2      2   2
  - 4 a b d e z  + 4 a b d e    - 4 b d e z  + 4 b d e
  --------------------------- + ----------------------- A0123456789
               z                           z
+ 
               11
  O(A0123456789  )

```



---

archive/issue_comments_498083.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nRight, it seems that the problem is with `expand`, and has nothing to do with determinants.  It shows up if I directly define E to be the expression that is called `f(x)` above.\n\n```\nsage: E1 = \"\"\"-4*(a - x)*b^2*d*e^2*z - (b^2*x + ((b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2\n....: ))*(a - b + x - 1) - 2*e^2 + (c + x - 3)*x)*(a - x) + (2*e^2 - (c + x - 3)*x)*(b - c + x +\n....:  2))*b^2 + (4*b^2*d*e^2*z - ((b^2*x + ((b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(\n....: a - b + x - 1) - 2*e^2 + (c + x - 3)*x)*(a - x) + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))\n....: *b^2 - ((b^2*x + ((b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(a - b + x - 1) - 2*e^\n....: 2 + (c + x - 3)*x)*(a - x) + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(c - x - 3) + 2*(b^2\n....: *e - (b - c + x + 2)*(c + x - 3)*e + ((b^2*e - (b - c + x + 2)*(c + x - 3)*e)*(a - b + x -\n....:  1) + (c + x - 3)*e)*(a - x))*e)*(b - c - x + 2))*(a - b - x - 1) - (b^2*x + ((b^2*x + (2*\n....: e^2 - (c + x - 3)*x)*(b - c + x + 2))*(a - b + x - 1) - 2*e^2 + (c + x - 3)*x)*(a - x) + (\n....: 2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(c - x - 3) - 2*(b^2*e - (b - c + x + 2)*(c + x - \n....: 3)*e + ((b^2*e - (b - c + x + 2)*(c + x - 3)*e)*(a - b + x - 1) + (c + x - 3)*e)*(a - x))*\n....: e + 4*(((b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(a - b + x - 1) - 2*e^2 + (c + x\n....:  - 3)*x)*b^2*d*z + b^2*e^2 - (((b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(a - b + \n....: x - 1) - 2*e^2 + (c + x - 3)*x)*(c - x - 3)*d*z + 2*((b^2*e - (b - c + x + 2)*(c + x - 3)*\n....: e)*(a - b + x - 1) + (c + x - 3)*e)*d*e*z)*(b - c - x + 2))*d/z)*(a + x) + ((b^2*x + ((b^2\n....: *x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(a - b + x - 1) - 2*e^2 + (c + x - 3)*x)*(a \n....: - x) + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(c - x - 3) + 2*(b^2*e - (b - c + x + 2)*(\n....: c + x - \"\"\"                                                                               \nsage: E2 = \"\"\"3)*e + ((b^2*e - (b - c + x + 2)*(c + x - 3)*e)*(a - b + x - 1) + (c + x - 3)*e)*(\n....: a - x))*e)*(b - c - x + 2) - 4*((a - x)*b^2*e^2 - (b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c \n....: + x + 2))*b^2*d*z - (b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(a - x)*(c - x - 3)*\n....: d*z - 2*(b^2*e - (b - c + x + 2)*(c + x - 3)*e)*(a - x)*d*e*z - ((b^2*x + (2*e^2 - (c + x \n....: - 3)*x)*(b - c + x + 2))*(a - x)*b^2*d*z - ((b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + \n....: 2))*(a - x)*(c - x - 3)*d*z + 2*(b^2*e - (b - c + x + 2)*(c + x - 3)*e)*(a - x)*d*e*z)*(b \n....: - c - x + 2))*(a - b - x - 1) + ((b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(c - x \n....: - 3)*d*z + 2*(b^2*e - (b - c + x + 2)*(c + x - 3)*e)*d*e*z)*(b - c - x + 2) + 4*((b^2*x + \n....: (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*b^2*d^2*z^2 - ((b^2*x + (2*e^2 - (c + x - 3)*x)*(\n....: b - c + x + 2))*(c - x - 3)*d^2*z^2 + 2*(b^2*e - (b - c + x + 2)*(c + x - 3)*e)*d^2*e*z^2)\n....: *(b - c - x + 2))*d/z)*d/z + 4*((b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*b^2*d*z \n....: - ((b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(c - x - 3)*d*z + 2*(b^2*e - (b - c +\n....:  x + 2)*(c + x - 3)*e)*d*e*z)*(b - c - x + 2))*d/z\"\"\"                                     \nsage: E = SR(E1 + E2)                                                                           \nsage: E.expand().subs(x=0)                                                                      \n4*a*b^2*d*z*e^2 - 4*a*b^2*d*e^2/z\nsage: E.subs(x=0).expand()                                                                      \n0\n```\nIf that is really true, then we should change the title of this ticket.",
    "created_at": "2020-12-18T22:56:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498083",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:4" align="right">comment:4</div>

Right, it seems that the problem is with `expand`, and has nothing to do with determinants.  It shows up if I directly define E to be the expression that is called `f(x)` above.

```
sage: E1 = """-4*(a - x)*b^2*d*e^2*z - (b^2*x + ((b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2
....: ))*(a - b + x - 1) - 2*e^2 + (c + x - 3)*x)*(a - x) + (2*e^2 - (c + x - 3)*x)*(b - c + x +
....:  2))*b^2 + (4*b^2*d*e^2*z - ((b^2*x + ((b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(
....: a - b + x - 1) - 2*e^2 + (c + x - 3)*x)*(a - x) + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))
....: *b^2 - ((b^2*x + ((b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(a - b + x - 1) - 2*e^
....: 2 + (c + x - 3)*x)*(a - x) + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(c - x - 3) + 2*(b^2
....: *e - (b - c + x + 2)*(c + x - 3)*e + ((b^2*e - (b - c + x + 2)*(c + x - 3)*e)*(a - b + x -
....:  1) + (c + x - 3)*e)*(a - x))*e)*(b - c - x + 2))*(a - b - x - 1) - (b^2*x + ((b^2*x + (2*
....: e^2 - (c + x - 3)*x)*(b - c + x + 2))*(a - b + x - 1) - 2*e^2 + (c + x - 3)*x)*(a - x) + (
....: 2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(c - x - 3) - 2*(b^2*e - (b - c + x + 2)*(c + x - 
....: 3)*e + ((b^2*e - (b - c + x + 2)*(c + x - 3)*e)*(a - b + x - 1) + (c + x - 3)*e)*(a - x))*
....: e + 4*(((b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(a - b + x - 1) - 2*e^2 + (c + x
....:  - 3)*x)*b^2*d*z + b^2*e^2 - (((b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(a - b + 
....: x - 1) - 2*e^2 + (c + x - 3)*x)*(c - x - 3)*d*z + 2*((b^2*e - (b - c + x + 2)*(c + x - 3)*
....: e)*(a - b + x - 1) + (c + x - 3)*e)*d*e*z)*(b - c - x + 2))*d/z)*(a + x) + ((b^2*x + ((b^2
....: *x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(a - b + x - 1) - 2*e^2 + (c + x - 3)*x)*(a 
....: - x) + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(c - x - 3) + 2*(b^2*e - (b - c + x + 2)*(
....: c + x - """                                                                               
sage: E2 = """3)*e + ((b^2*e - (b - c + x + 2)*(c + x - 3)*e)*(a - b + x - 1) + (c + x - 3)*e)*(
....: a - x))*e)*(b - c - x + 2) - 4*((a - x)*b^2*e^2 - (b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c 
....: + x + 2))*b^2*d*z - (b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(a - x)*(c - x - 3)*
....: d*z - 2*(b^2*e - (b - c + x + 2)*(c + x - 3)*e)*(a - x)*d*e*z - ((b^2*x + (2*e^2 - (c + x 
....: - 3)*x)*(b - c + x + 2))*(a - x)*b^2*d*z - ((b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 
....: 2))*(a - x)*(c - x - 3)*d*z + 2*(b^2*e - (b - c + x + 2)*(c + x - 3)*e)*(a - x)*d*e*z)*(b 
....: - c - x + 2))*(a - b - x - 1) + ((b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(c - x 
....: - 3)*d*z + 2*(b^2*e - (b - c + x + 2)*(c + x - 3)*e)*d*e*z)*(b - c - x + 2) + 4*((b^2*x + 
....: (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*b^2*d^2*z^2 - ((b^2*x + (2*e^2 - (c + x - 3)*x)*(
....: b - c + x + 2))*(c - x - 3)*d^2*z^2 + 2*(b^2*e - (b - c + x + 2)*(c + x - 3)*e)*d^2*e*z^2)
....: *(b - c - x + 2))*d/z)*d/z + 4*((b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*b^2*d*z 
....: - ((b^2*x + (2*e^2 - (c + x - 3)*x)*(b - c + x + 2))*(c - x - 3)*d*z + 2*(b^2*e - (b - c +
....:  x + 2)*(c + x - 3)*e)*d*e*z)*(b - c - x + 2))*d/z"""                                     
sage: E = SR(E1 + E2)                                                                           
sage: E.expand().subs(x=0)                                                                      
4*a*b^2*d*z*e^2 - 4*a*b^2*d*e^2/z
sage: E.subs(x=0).expand()                                                                      
0
```
If that is really true, then we should change the title of this ticket.



---

archive/issue_comments_498084.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -22,3 +22,5 @@\n 0\n ```\n (Calculating in a `LaurentPolynomialRing` also verifies that the determinant is 0.)\n+\n+Edit: Further investigation seems to reveal that the determinant is calculated correctly by maxima, but then sage's `expand` method introduces an error.\n``````\n",
    "created_at": "2020-12-19T04:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498084",
    "user": "https://github.com/DaveWitteMorris"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -22,3 +22,5 @@
 0
 ```
 (Calculating in a `LaurentPolynomialRing` also verifies that the determinant is 0.)
+
+Edit: Further investigation seems to reveal that the determinant is calculated correctly by maxima, but then sage's `expand` method introduces an error.
``````




---

archive/issue_events_428530.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2020-12-19T04:49:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428530"
}
```



---

archive/issue_events_428531.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2020-12-19T04:49:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428531"
}
```



---

archive/issue_events_428532.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2020-12-19T04:49:36Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "title_is": "very incorrect \"expand\" of a symbolic expression",
    "title_was": "incorrect determinant of a symbolic matrix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428532"
}
```



---

archive/issue_comments_498085.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nHere is a shorter expression that I think illustrates the bug in `expand`. I was unable to make it any shorter.\n\n```\nsage: var(\"a b c d e x z\")\n(a, b, c, d, e, x, z)\nsage: E = ((((((b^2*x + (e^2 - c)*(b - c + x + 1))*(a - b + x - 1) + (x + 1))*(a - x) + e)\n....: *(c - x - 3) + e)*(b - c - x + 1))*(a - b - x - 1) + (a - b + x - 1 )*d/z)*(a + x)\nsage: E.expand().subs(x=0, a=2, b=0, c=0, e=0)\n2*d*z - 12\nsage: E.expand().subs(x=0) - E.subs(x=0).expand()                                               \na^2*d*z - a*b*d*z - a*d*z - a^2*d/z + a*b*d/z + a*d/z\nsage: E.expand().is_polynomial(z)\nTrue\nsage: E.expand() - E.subs(z = 1/z).expand()\n0\n```\nThe expression `E` is a polynomial in `a,b,c,d,x` and `1/z`, so expanding it cannot yield a term (such as `2*d*z`) with a positive power of `z`. But `expand` actually makes all powers of `z` positive (as indicated by `is_polynomial(z)` being `True`). In fact, the final line seems to indicate that `expand` is somehow confusing `z` with `1/z`.",
    "created_at": "2020-12-19T04:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498085",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:5" align="right">comment:5</div>

Here is a shorter expression that I think illustrates the bug in `expand`. I was unable to make it any shorter.

```
sage: var("a b c d e x z")
(a, b, c, d, e, x, z)
sage: E = ((((((b^2*x + (e^2 - c)*(b - c + x + 1))*(a - b + x - 1) + (x + 1))*(a - x) + e)
....: *(c - x - 3) + e)*(b - c - x + 1))*(a - b - x - 1) + (a - b + x - 1 )*d/z)*(a + x)
sage: E.expand().subs(x=0, a=2, b=0, c=0, e=0)
2*d*z - 12
sage: E.expand().subs(x=0) - E.subs(x=0).expand()                                               
a^2*d*z - a*b*d*z - a*d*z - a^2*d/z + a*b*d/z + a*d/z
sage: E.expand().is_polynomial(z)
True
sage: E.expand() - E.subs(z = 1/z).expand()
0
```
The expression `E` is a polynomial in `a,b,c,d,x` and `1/z`, so expanding it cannot yield a term (such as `2*d*z`) with a positive power of `z`. But `expand` actually makes all powers of `z` positive (as indicated by `is_polynomial(z)` being `True`). In fact, the final line seems to indicate that `expand` is somehow confusing `z` with `1/z`.



---

archive/issue_comments_498086.json:
```json
{
    "body": "Changed keywords from **determinant** to **expand**",
    "created_at": "2020-12-19T04:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498086",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changed keywords from **determinant** to **expand**



---

archive/issue_comments_498087.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThis means that it is a bug in pynac.  I don't know how to report this.\n\nA tiny bit shorter, by setting `d=1`:\n\n```\nsage: F = (((((b^2*x + (e^2 - c)*(b - c + x + 1))*(a - b + x - 1) + x + 1)*(a - x) + e)*(c - x - 3) + e)*(a - b - x - 1)*(b - c - x + 1) + (a - b + x - 1)/z)*(a + x)\nsage: F.expand().is_polynomial(z)\nTrue\nsage: F.is_polynomial(z)\nFalse\n```",
    "created_at": "2020-12-19T12:05:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498087",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:6" align="right">comment:6</div>

This means that it is a bug in pynac.  I don't know how to report this.

A tiny bit shorter, by setting `d=1`:

```
sage: F = (((((b^2*x + (e^2 - c)*(b - c + x + 1))*(a - b + x - 1) + x + 1)*(a - x) + e)*(c - x - 3) + e)*(a - b - x - 1)*(b - c - x + 1) + (a - b + x - 1)/z)*(a + x)
sage: F.expand().is_polynomial(z)
True
sage: F.is_polynomial(z)
False
```



---

archive/issue_comments_498088.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nSlightly simpler:\n\n```\nsage: var(\"A B C x\")\n(A, B, C, x)\nsage: G = ((((((B^2 + C^2)*(B^2 + x) + A + B)*(A + x + 1) + A + 1)*(C^2 + A) + A)*(A + C + 1) + A)*(B^2 + A + 1)*(A + B + x) + (A + B + 1)/x)*(A + 1)\nsage: G.is_polynomial(x)\nFalse\nsage: G.expand().is_polynomial(x)\nTrue\n```",
    "created_at": "2020-12-19T12:38:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498088",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:7" align="right">comment:7</div>

Slightly simpler:

```
sage: var("A B C x")
(A, B, C, x)
sage: G = ((((((B^2 + C^2)*(B^2 + x) + A + B)*(A + x + 1) + A + 1)*(C^2 + A) + A)*(A + C + 1) + A)*(B^2 + A + 1)*(A + B + x) + (A + B + 1)/x)*(A + 1)
sage: G.is_polynomial(x)
False
sage: G.expand().is_polynomial(x)
True
```



---

archive/issue_comments_498089.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nYet a very tiny bit simpler:\n\n```\nsage: var(\"A B C x\")\n(A, B, C, x)\nsage: p = A^2*B^2*C^3*x^2 + A^2*B^2*C^2*x^3 + A^2*B^2*C^2*x^2 + A^2*C^3*x^3 + A^5*B^2 + A^2*B^2*C^3 + A^3*B^2*C*x + A^2*B^2*C^2*x + A^3*B^2*x^2 + A^4*x^3 + A^3*C*x^3 + A^4*C^2 + A^2*B^2*C^2 + A^3*C^3 + A^3*B^2*x + B^2*C^3*x + A^3*C*x^2 + A^2*C^2*x^2 + A*C^3*x^2 + A*C^2*x^3 + C^3*x^3 + A^3*B^2 + A^2*B*C^2 + A*B*C^3 + A*B*C^2*x + B^2*C^2*x + A^3*x^2 + C^3*x^2 + A^2*x^3 + B^2*x^3 + A*C*x^3 + C^2*x^3 + A^4 + A^3*C + A^2*C^2 + B^2*C^2 + A*C^3 + B*C^3 + A^2*B*x + A*B*C*x + A*C*x^2 + B*C*x^2 + C^2*x^2 + A^2*B + B^2*C + B*C^2 + C^3 + A*B*x + A*x^2 + C*x^2 + x^3 + A^2 + B^2 + A*C + B*C + C^2 + B*x + x^2 + B + C + x + 1\nsage: G = (((A + B + x) * (A + B^2 + 1) * p + (A + B + 1)/x)*(A+1))\n\nsage: G.expand().is_polynomial(x) != G.is_polynomial(x)\nTrue\n```",
    "created_at": "2020-12-20T17:45:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498089",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:9" align="right">comment:9</div>

Yet a very tiny bit simpler:

```
sage: var("A B C x")
(A, B, C, x)
sage: p = A^2*B^2*C^3*x^2 + A^2*B^2*C^2*x^3 + A^2*B^2*C^2*x^2 + A^2*C^3*x^3 + A^5*B^2 + A^2*B^2*C^3 + A^3*B^2*C*x + A^2*B^2*C^2*x + A^3*B^2*x^2 + A^4*x^3 + A^3*C*x^3 + A^4*C^2 + A^2*B^2*C^2 + A^3*C^3 + A^3*B^2*x + B^2*C^3*x + A^3*C*x^2 + A^2*C^2*x^2 + A*C^3*x^2 + A*C^2*x^3 + C^3*x^3 + A^3*B^2 + A^2*B*C^2 + A*B*C^3 + A*B*C^2*x + B^2*C^2*x + A^3*x^2 + C^3*x^2 + A^2*x^3 + B^2*x^3 + A*C*x^3 + C^2*x^3 + A^4 + A^3*C + A^2*C^2 + B^2*C^2 + A*C^3 + B*C^3 + A^2*B*x + A*B*C*x + A*C*x^2 + B*C*x^2 + C^2*x^2 + A^2*B + B^2*C + B*C^2 + C^3 + A*B*x + A*x^2 + C*x^2 + x^3 + A^2 + B^2 + A*C + B*C + C^2 + B*x + x^2 + B + C + x + 1
sage: G = (((A + B + x) * (A + B^2 + 1) * p + (A + B + 1)/x)*(A+1))

sage: G.expand().is_polynomial(x) != G.is_polynomial(x)
True
```



---

archive/issue_comments_498090.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\njust in case, it's not fixed by #30446",
    "created_at": "2021-01-24T22:29:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498090",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">comment:10</div>

just in case, it's not fixed by #30446



---

archive/issue_comments_498091.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThis 4x4 symbolic determinant with denominators also goes wrong.\n\nTried the following with Sage 9.3.beta5, 9.3.beta6, 9.3.beta7:\n\n```\nsage: N = 4\nsage: t, x, y, z = (SR.var(s, N) for s in 'txyz')\nsage: f = lambda i, j: (x[i] - x[j])*(y[i] - y[j])*(z[i] - z[j])/(t[i] - t[j])\nsage: A = matrix(SR, N, lambda i, j: f(i, j) if i != j else 0)\nsage: A_det = A.det()\nsage: txyz = t + x + y + z\nsage: vv = dict(zip(txyz, list(range(N))*4))\nsage: A.subs(vv).det(), A_det().subs(vv)\n(0, -3072)\n```\n\nComputing `len(str(A_det))` gave varied results, all near 5.8 million.\n\nRepeating the sequence \"start Sage, define `N`, `t`, `x`, `y`, `z`,\n`f`, `A`, `A_det`, compute that length\" various times gave\n5794243, 5775526, 5783134, 5771824, 5775730, 5810160, 5820599...\n\nComputing `A_det.subs(vv)` after that also gave several values: -3072, 6144, 9216.",
    "created_at": "2021-02-19T03:20:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498091",
    "user": "https://github.com/slel"
}
```

<div id="comment:12" align="right">comment:12</div>

This 4x4 symbolic determinant with denominators also goes wrong.

Tried the following with Sage 9.3.beta5, 9.3.beta6, 9.3.beta7:

```
sage: N = 4
sage: t, x, y, z = (SR.var(s, N) for s in 'txyz')
sage: f = lambda i, j: (x[i] - x[j])*(y[i] - y[j])*(z[i] - z[j])/(t[i] - t[j])
sage: A = matrix(SR, N, lambda i, j: f(i, j) if i != j else 0)
sage: A_det = A.det()
sage: txyz = t + x + y + z
sage: vv = dict(zip(txyz, list(range(N))*4))
sage: A.subs(vv).det(), A_det().subs(vv)
(0, -3072)
```

Computing `len(str(A_det))` gave varied results, all near 5.8 million.

Repeating the sequence "start Sage, define `N`, `t`, `x`, `y`, `z`,
`f`, `A`, `A_det`, compute that length" various times gave
5794243, 5775526, 5783134, 5771824, 5775730, 5810160, 5820599...

Computing `A_det.subs(vv)` after that also gave several values: -3072, 6144, 9216.



---

archive/issue_comments_498092.json:
```json
{
    "body": "patch mul::expand to eliminate call to poly_mul_expand",
    "created_at": "2021-02-22T21:15:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498092",
    "user": "https://github.com/DaveWitteMorris"
}
```

patch mul::expand to eliminate call to poly_mul_expand



---

archive/issue_comments_498093.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAttachment: **[mul_expand.patch.gz](https://github.com/sagemath/sage/files/ticket31077/mul_expand.patch.gz)**\n\nThe attached patch `mul_expand.patch` works for me (and causes no doctest failures).  It solves all of the problems on this ticket and also the bug reported in #31411. If other people have the same experience, then I think it is a viable workaround until we fix the real problem, so perhaps we should make this ticket a blocker.\n\nIn effect, the patch just comments out a call to `poly_mul_expand`, so that seems to be where the problem is. The pynac code for this function is short, so it should be easy to find the bug if that's where it is. But the problem may be upstream in `singular` or `libgiac`.\n\nHere is a more detailed explanation of my experience after the patch is applied.\n\n* For the original issue on this ticket, `L.det()` gives `0`.\n* For `E` as in [comment:5](#comment:5), \n    * `E.expand().subs(x=0, a=2, b=0, c=0, e=0)` gives `2*d/z - 12`\n    * `E.expand().subs(x=0) - E.subs(x=0).expand()` gives `0`\n    * `E.expand().subs(z=1/z).is_polynomial(z)` gives `True`\n* For `A` and `A_det` as in [comment:12](#comment:12), \n    * `A.subs(vv).det(), A_det().subs(vv)` gives `(0, 0)`\n    * `len(str(A_det))` gives `942027`\n* For `A` and `B` as in #31411,\n    * `bool((A*B).expand()==(A*B.expand()).expand())` gives `True`\n    * `((A*B).expand())/((A*B.expand()).expand())` gives `1`",
    "created_at": "2021-02-22T21:18:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498093",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:13" align="right">comment:13</div>

Attachment: **[mul_expand.patch.gz](https://github.com/sagemath/sage/files/ticket31077/mul_expand.patch.gz)**

The attached patch `mul_expand.patch` works for me (and causes no doctest failures).  It solves all of the problems on this ticket and also the bug reported in #31411. If other people have the same experience, then I think it is a viable workaround until we fix the real problem, so perhaps we should make this ticket a blocker.

In effect, the patch just comments out a call to `poly_mul_expand`, so that seems to be where the problem is. The pynac code for this function is short, so it should be easy to find the bug if that's where it is. But the problem may be upstream in `singular` or `libgiac`.

Here is a more detailed explanation of my experience after the patch is applied.

* For the original issue on this ticket, `L.det()` gives `0`.
* For `E` as in [comment:5](#comment:5), 
    * `E.expand().subs(x=0, a=2, b=0, c=0, e=0)` gives `2*d/z - 12`
    * `E.expand().subs(x=0) - E.subs(x=0).expand()` gives `0`
    * `E.expand().subs(z=1/z).is_polynomial(z)` gives `True`
* For `A` and `A_det` as in [comment:12](#comment:12), 
    * `A.subs(vv).det(), A_det().subs(vv)` gives `(0, 0)`
    * `len(str(A_det))` gives `942027`
* For `A` and `B` as in #31411,
    * `bool((A*B).expand()==(A*B.expand()).expand())` gives `True`
    * `((A*B).expand())/((A*B.expand()).expand())` gives `1`



---

archive/issue_comments_498094.json:
```json
{
    "body": "Author: **Dave Morris**",
    "created_at": "2021-02-22T21:18:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498094",
    "user": "https://github.com/DaveWitteMorris"
}
```

Author: **Dave Morris**



---

archive/issue_events_428533.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2021-02-22T21:18:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428533"
}
```



---

archive/issue_events_428534.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2021-02-23T20:19:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428534"
}
```



---

archive/issue_events_428535.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2021-02-23T20:19:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428535"
}
```



---

archive/issue_comments_498095.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThis is a very bad bug, so I am raising the priority to blocker.\n\nSage is silently returning mathematically wrong answers any time it expands a product `A * B` where `A` and `B` are long sums (more than about 400 terms in total) such that one of the sums has a term where at least one of the factors has a negative exponent. The patch `mul_expand.patch` gets rid of the mathematical error by eliminating an incorrect optimization. The drawback is that sage may run slower and use more memory. \n\nIt should be pretty easy to write a better patch that restores the optimization in cases where it is correct, so I will work on that.  But an optimization for the general case might  not be ready for 9.3.\n\n---\n\nExplanation of the bug:\nIn order to take advantage of optimizations in `singular`'s handling of products of large polynomials, pynac converts the product `A * B` into a product of multivariate polynomials, and asks `singular` to do the calculation.\nTo do this, pynac uses the `ex::to_canonical` method, which claims to turn any expression into a polynomial, by replacing some subexpressions with new variables.  (For example, `x^2 + a*cos(y)^3` could be encoded as `x^2 + a*c^3`, where `c` stands for `cos(y)`.) The bug is that the result is sometimes actually a *Laurent* polynomial, not a true polynomial, because some of the exponents could be negative. This causes a problem when the supposed \"polynomial\" is sent to `singular`, which seems to think it is getting a genuine polynomial (i.e., a `CanonicalForm` in `singular`'s terminology). I have not yet checked the details of what has happening, but it seems that `singular` does indeed get a polynomial, because all negative exponents are silently converted to positive. I don't know exactly where this happens, and I don't understand why no error is raised -- I will look into those questions.\n\nMy \"it should be pretty easy\" comment above is the suggestion that we could send the product to `singular` only in cases where none of the exponents are negative. If there is a CAS that optimizes multiplication of multivariate Laurent polynomials over `Q`, then the other cases could also be optimized with very little additional work. (How efficient is `sage`'s code for the `_mul_` method of `LaurentPolynomial_mpair`?)",
    "created_at": "2021-02-23T20:19:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498095",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:15" align="right">comment:15</div>

This is a very bad bug, so I am raising the priority to blocker.

Sage is silently returning mathematically wrong answers any time it expands a product `A * B` where `A` and `B` are long sums (more than about 400 terms in total) such that one of the sums has a term where at least one of the factors has a negative exponent. The patch `mul_expand.patch` gets rid of the mathematical error by eliminating an incorrect optimization. The drawback is that sage may run slower and use more memory. 

It should be pretty easy to write a better patch that restores the optimization in cases where it is correct, so I will work on that.  But an optimization for the general case might  not be ready for 9.3.

---

Explanation of the bug:
In order to take advantage of optimizations in `singular`'s handling of products of large polynomials, pynac converts the product `A * B` into a product of multivariate polynomials, and asks `singular` to do the calculation.
To do this, pynac uses the `ex::to_canonical` method, which claims to turn any expression into a polynomial, by replacing some subexpressions with new variables.  (For example, `x^2 + a*cos(y)^3` could be encoded as `x^2 + a*c^3`, where `c` stands for `cos(y)`.) The bug is that the result is sometimes actually a *Laurent* polynomial, not a true polynomial, because some of the exponents could be negative. This causes a problem when the supposed "polynomial" is sent to `singular`, which seems to think it is getting a genuine polynomial (i.e., a `CanonicalForm` in `singular`'s terminology). I have not yet checked the details of what has happening, but it seems that `singular` does indeed get a polynomial, because all negative exponents are silently converted to positive. I don't know exactly where this happens, and I don't understand why no error is raised -- I will look into those questions.

My "it should be pretty easy" comment above is the suggestion that we could send the product to `singular` only in cases where none of the exponents are negative. If there is a CAS that optimizes multiplication of multivariate Laurent polynomials over `Q`, then the other cases could also be optimized with very little additional work. (How efficient is `sage`'s code for the `_mul_` method of `LaurentPolynomial_mpair`?)



---

archive/issue_comments_498096.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nYou are a true hero!",
    "created_at": "2021-02-23T20:28:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498096",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:16" align="right">comment:16</div>

You are a true hero!



---

archive/issue_comments_498097.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThanks a lot for this fix! Can you turn your patch into a branch?",
    "created_at": "2021-02-23T21:14:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498097",
    "user": "https://github.com/slel"
}
```

<div id="comment:17" align="right">comment:17</div>

Thanks a lot for this fix! Can you turn your patch into a branch?



---

archive/issue_comments_498098.json:
```json
{
    "body": "Branch: **[public/31077](https://github.com/sagemath/sagetrac-mirror/tree/public/31077)**",
    "created_at": "2021-02-23T21:56:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498098",
    "user": "https://github.com/DaveWitteMorris"
}
```

Branch: **[public/31077](https://github.com/sagemath/sagetrac-mirror/tree/public/31077)**



---

archive/issue_comments_498099.json:
```json
{
    "body": "Commit: **[`3d2a2dd`](https://github.com/sagemath/sagetrac-mirror/commit/3d2a2dd9811a7d802c2c9b795f31aa34e6469e32)**",
    "created_at": "2021-02-23T21:57:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498099",
    "user": "https://github.com/DaveWitteMorris"
}
```

Commit: **[`3d2a2dd`](https://github.com/sagemath/sagetrac-mirror/commit/3d2a2dd9811a7d802c2c9b795f31aa34e6469e32)**



---

archive/issue_comments_498100.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThanks (both of you) for the encouragement. I pushed a branch.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3d2a2dd9811a7d802c2c9b795f31aa34e6469e32\">3d2a2dd</a></td><td><code>trac 31077 don't use poly_mul_expand</code></td></tr></table>\n",
    "created_at": "2021-02-23T21:57:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498100",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:19" align="right">comment:19</div>

Thanks (both of you) for the encouragement. I pushed a branch.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3d2a2dd9811a7d802c2c9b795f31aa34e6469e32">3d2a2dd</a></td><td><code>trac 31077 don't use poly_mul_expand</code></td></tr></table>




---

archive/issue_comments_498101.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nWell done - that was a very subtle bug indeed, and finding exactly what happened is great.",
    "created_at": "2021-02-23T22:28:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498101",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:20" align="right">comment:20</div>

Well done - that was a very subtle bug indeed, and finding exactly what happened is great.



---

archive/issue_comments_498102.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@DaveWitteMorris](#comment:15):\n> (How efficient is `sage`'s code for the `_mul_` method of `LaurentPolynomial_mpair`?)\n\nLaurent polynomials in Sage are represented by libsingular polynomials together with an offset exponent vector, so I assume that it would be quite ok.",
    "created_at": "2021-02-24T21:58:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498102",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@DaveWitteMorris](#comment:15):
> (How efficient is `sage`'s code for the `_mul_` method of `LaurentPolynomial_mpair`?)

Laurent polynomials in Sage are represented by libsingular polynomials together with an offset exponent vector, so I assume that it would be quite ok.



---

archive/issue_comments_498103.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThanks, that's good to know. I'll try to find time to write a PR in the next few days.",
    "created_at": "2021-02-24T22:16:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498103",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:22" align="right">comment:22</div>

Thanks, that's good to know. I'll try to find time to write a PR in the next few days.



---

archive/issue_comments_498104.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nWould it make sense to compare with the ginac code?  I do not understand cpp code, but it seems that the two `mul::expand` routines have diverged a fair bit.  I guess a big difference is that ginac doesn't call singular, but given the bug, is it worth it?",
    "created_at": "2021-02-25T09:44:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498104",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:23" align="right">comment:23</div>

Would it make sense to compare with the ginac code?  I do not understand cpp code, but it seems that the two `mul::expand` routines have diverged a fair bit.  I guess a big difference is that ginac doesn't call singular, but given the bug, is it worth it?



---

archive/issue_comments_498105.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nDeterminants are often computed to check whether (or for which\nvalues of parameters) they are zero; factoring would help more\nthan expanding for that.\n\nRegarding denominators and Singular, a solution might be to detect\ndenominators in each row, collect them, ask Singular to compute\na denominatorless determinant, and divide back afterwards.",
    "created_at": "2021-02-25T10:50:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498105",
    "user": "https://github.com/slel"
}
```

<div id="comment:24" align="right">comment:24</div>

Determinants are often computed to check whether (or for which
values of parameters) they are zero; factoring would help more
than expanding for that.

Regarding denominators and Singular, a solution might be to detect
denominators in each row, collect them, ask Singular to compute
a denominatorless determinant, and divide back afterwards.



---

archive/issue_comments_498106.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nEven if a follow-up ticket might restore a fixed optimisation,\nthis should go in -- ideally with doctests.",
    "created_at": "2021-02-25T10:59:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498106",
    "user": "https://github.com/slel"
}
```

<div id="comment:25" align="right">comment:25</div>

Even if a follow-up ticket might restore a fixed optimisation,
this should go in -- ideally with doctests.



---

archive/issue_comments_498107.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nI hope to have a correct fix (with doctests) ready in a few days, so I don't think we should merge the current patch. It was just written to test whether I was on the right track, and to provide a backup plan if a real fix was too hard.\n\n*Correction:* The rationale that I gave for using (Laurent) polynomials was incorrect.  Using a single variable to represent a complicated expression can give a big savings in space and time, even if the handling of (Laurent) polynomials is not particularly efficient. It eliminates the need to copy the expression every time two terms are multiplied (and there are `n^2` multiplications when two sums of length `n` are multiplied). So I think it is worth trying to re-enable this.\n\n---\n\nPS I think I now understand the two issues that I left open at the end of the next-to-last paragraph of [comment:15](#comment:15):\n\n1) The `ex::to_canonical` method uses singular's `CanonicalForm::power` method to calculate a power `a^n`. This `power` method does not allow `n` to be negative, and starts with a check for that. However, the check is `ASSERT( n >= 0, \"illegal exponent\" )`, and I think sage uses compile flags that disable debugging, and therefore disable this `assert` statement. So the check is not performed.  That is why no error is raised.    (My quick impression is that the `singular` source code has hundreds of assert statements that should be raising errors. I don't know whether there is anything we can do about this.)\n\n2) The `CanonicalForm::power` method uses repeated squaring to calculate `a^n`. This will always result in raising `a` to a positive power, even if `n` is negative. That is why the negative exponent turns into a positive one. In fact, the way the code is written means that the result will always be precisely `a^abs(n)`.",
    "created_at": "2021-02-26T03:11:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498107",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:26" align="right">comment:26</div>

I hope to have a correct fix (with doctests) ready in a few days, so I don't think we should merge the current patch. It was just written to test whether I was on the right track, and to provide a backup plan if a real fix was too hard.

*Correction:* The rationale that I gave for using (Laurent) polynomials was incorrect.  Using a single variable to represent a complicated expression can give a big savings in space and time, even if the handling of (Laurent) polynomials is not particularly efficient. It eliminates the need to copy the expression every time two terms are multiplied (and there are `n^2` multiplications when two sums of length `n` are multiplied). So I think it is worth trying to re-enable this.

---

PS I think I now understand the two issues that I left open at the end of the next-to-last paragraph of [comment:15](#comment:15):

1) The `ex::to_canonical` method uses singular's `CanonicalForm::power` method to calculate a power `a^n`. This `power` method does not allow `n` to be negative, and starts with a check for that. However, the check is `ASSERT( n >= 0, "illegal exponent" )`, and I think sage uses compile flags that disable debugging, and therefore disable this `assert` statement. So the check is not performed.  That is why no error is raised.    (My quick impression is that the `singular` source code has hundreds of assert statements that should be raising errors. I don't know whether there is anything we can do about this.)

2) The `CanonicalForm::power` method uses repeated squaring to calculate `a^n`. This will always result in raising `a` to a positive power, even if `n` is negative. That is why the negative exponent turns into a positive one. In fact, the way the code is written means that the result will always be precisely `a^abs(n)`.



---

archive/issue_comments_498108.json:
```json
{
    "body": "Changed branch from **[public/31077](https://github.com/sagemath/sagetrac-mirror/tree/public/31077)** to **[public/31077v2](https://github.com/sagemath/sagetrac-mirror/tree/public/31077v2)**",
    "created_at": "2021-02-27T06:17:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498108",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changed branch from **[public/31077](https://github.com/sagemath/sagetrac-mirror/tree/public/31077)** to **[public/31077v2](https://github.com/sagemath/sagetrac-mirror/tree/public/31077v2)**



---

archive/issue_comments_498109.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nThis simple patch allows the `singular` optimization to be used in the cases where it works (i.e., when the exponents are positive). It would be more work to enable an optimization (by using Laurent series) for negative exponents, so that can be a follow-up ticket. I think that extension would be an enhancement, not a bug fix, so certainly not critical, and I do not intend to work on it soon, but it's great if someone else is interested.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dbf88e228d94d288e13e4e2a71e628cf027364ed\">dbf88e2</a></td><td><code>trac 31077 fix incorrect expansion</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d05da0bf665ad4abdc3757aee28245036ee42b4e\">d05da0b</a></td><td><code>add doctest</code></td></tr></table>\n",
    "created_at": "2021-02-27T06:32:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498109",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:28" align="right">comment:28</div>

This simple patch allows the `singular` optimization to be used in the cases where it works (i.e., when the exponents are positive). It would be more work to enable an optimization (by using Laurent series) for negative exponents, so that can be a follow-up ticket. I think that extension would be an enhancement, not a bug fix, so certainly not critical, and I do not intend to work on it soon, but it's great if someone else is interested.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dbf88e228d94d288e13e4e2a71e628cf027364ed">dbf88e2</a></td><td><code>trac 31077 fix incorrect expansion</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d05da0bf665ad4abdc3757aee28245036ee42b4e">d05da0b</a></td><td><code>add doctest</code></td></tr></table>




---

archive/issue_comments_498110.json:
```json
{
    "body": "Changed commit from **[`3d2a2dd`](https://github.com/sagemath/sagetrac-mirror/commit/3d2a2dd9811a7d802c2c9b795f31aa34e6469e32)** to **[`d05da0b`](https://github.com/sagemath/sagetrac-mirror/commit/d05da0bf665ad4abdc3757aee28245036ee42b4e)**",
    "created_at": "2021-02-27T06:32:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498110",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changed commit from **[`3d2a2dd`](https://github.com/sagemath/sagetrac-mirror/commit/3d2a2dd9811a7d802c2c9b795f31aa34e6469e32)** to **[`d05da0b`](https://github.com/sagemath/sagetrac-mirror/commit/d05da0bf665ad4abdc3757aee28245036ee42b4e)**



---

archive/issue_comments_498111.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nWhy 400 in `if (s > 400) {...` ?\n\nSo this problem is not triggered if `s<401`? Or doesit mean to avoid using this code branch for `s<401`?",
    "created_at": "2021-02-27T11:51:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498111",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:29" align="right">comment:29</div>

Why 400 in `if (s > 400) {...` ?

So this problem is not triggered if `s<401`? Or doesit mean to avoid using this code branch for `s<401`?



---

archive/issue_comments_498112.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\n400 was in the original code.  I think the point is that the overhead of translating to a polynomial is not worth the trouble for short sums, so `poly_mul_expand` should not be called unless `s` is large. A comment in the code says that the condition `s > 400` is \"probably too simple\", but making a more more intelligent choice would be a different ticket.\n\nThe negative-exponent bug arose whenever `poly_mul_expand` was called with a negative exponent. Because of the condition `s > 400`, this only happened for long sums (see [comment:21](#comment:21)). When I was searching for the bug, I changed 400 to 2, so that the problem was visible in very short sums, which made it easier to diagnose.",
    "created_at": "2021-02-27T18:51:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498112",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:30" align="right">comment:30</div>

400 was in the original code.  I think the point is that the overhead of translating to a polynomial is not worth the trouble for short sums, so `poly_mul_expand` should not be called unless `s` is large. A comment in the code says that the condition `s > 400` is "probably too simple", but making a more more intelligent choice would be a different ticket.

The negative-exponent bug arose whenever `poly_mul_expand` was called with a negative exponent. Because of the condition `s > 400`, this only happened for long sums (see [comment:21](#comment:21)). When I was searching for the bug, I changed 400 to 2, so that the problem was visible in very short sums, which made it easier to diagnose.



---

archive/issue_comments_498113.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nA patchbot failed the doctest that I wrote to test the patch. I think it is because the patchbot didn't rebuild pynac after loading the patch (so the patch to pynac didn't do anything). Is there something I can do to get the patchbots to test the patch?",
    "created_at": "2021-02-27T20:48:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498113",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:31" align="right">comment:31</div>

A patchbot failed the doctest that I wrote to test the patch. I think it is because the patchbot didn't rebuild pynac after loading the patch (so the patch to pynac didn't do anything). Is there something I can do to get the patchbots to test the patch?



---

archive/issue_comments_498114.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nFWIW, `sage -t -l --optional=sage --all` doesn't give me any unexpected doctest failures on MacOS 10.15.7 or Ubuntu 20.04 (`CoCalc`).",
    "created_at": "2021-03-01T05:44:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498114",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:32" align="right">comment:32</div>

FWIW, `sage -t -l --optional=sage --all` doesn't give me any unexpected doctest failures on MacOS 10.15.7 or Ubuntu 20.04 (`CoCalc`).



---

archive/issue_events_428536.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2021-03-02T03:20:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428536"
}
```



---

archive/issue_events_428537.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2021-03-02T03:20:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428537"
}
```



---

archive/issue_comments_498115.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nI just noticed that the same problem probably happens in another (nearby) place in the file. I fixed the problem for rational exponents, but I think the same thing could happen for irrational exponents. I plan to upload a fix soon.",
    "created_at": "2021-03-02T03:20:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498115",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:33" align="right">comment:33</div>

I just noticed that the same problem probably happens in another (nearby) place in the file. I fixed the problem for rational exponents, but I think the same thing could happen for irrational exponents. I plan to upload a fix soon.



---

archive/issue_events_428538.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2021-03-10T07:39:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428538"
}
```



---

archive/issue_events_428539.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2021-03-10T07:39:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428539"
}
```



---

archive/issue_comments_498116.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nTicket #31411 reveals two other bugs in `poly_mul_expand`. I opened blocker ticket #31479 to disable the use of this function until all of the bugs have been fixed (and metaticket #31478 to track the progress), so it is not an urgent problem.",
    "created_at": "2021-03-10T07:39:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498116",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:34" align="right">comment:34</div>

Ticket #31411 reveals two other bugs in `poly_mul_expand`. I opened blocker ticket #31479 to disable the use of this function until all of the bugs have been fixed (and metaticket #31478 to track the progress), so it is not an urgent problem.



---

archive/issue_events_428540.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428540"
}
```



---

archive/issue_events_428541.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428541"
}
```



---

archive/issue_comments_498117.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nMoving to 9.4, as 9.3 has been released.",
    "created_at": "2021-05-10T17:42:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31077#issuecomment-498117",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">comment:35</div>

Moving to 9.4, as 9.3 has been released.



---

archive/issue_events_428542.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428542"
}
```



---

archive/issue_events_428543.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428543"
}
```



---

archive/issue_events_428544.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428544"
}
```



---

archive/issue_events_428545.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428545"
}
```



---

archive/issue_events_428546.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:19:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428546"
}
```



---

archive/issue_events_428547.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:19:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428547"
}
```



---

archive/issue_events_428548.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428548"
}
```



---

archive/issue_events_428549.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31077",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31077#event-428549"
}
```
