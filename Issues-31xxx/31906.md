# Issue 31906: Faster point transform matrix

archive/issues_031669.json:
```json
{
    "body": "Currently, the point transform matrix method is slow over fields such as QQbar, and does not work over precision fields such as the reals.\n\nWe implement a different approach based on linear algebra which improves performance over QQbar and works over precision fields. We replace the old approach as our update is an improvement in all cases. As our updated method works over rings, we moved the method to projective space over a ring.\n\nWe also add an optional normalize parameter, which over a field normalizes the last non zero entry of the returned matrix to be 1.\n\n**CC:**  @bhutz\n\n**Keywords:** gsoc2021\n\n**Branch/Commit:** [cd508a025517c28f1028e516a5056d8d11b25587](https://github.com/sagemath/sagetrac-mirror/commit/cd508a025517c28f1028e516a5056d8d11b25587)\n\n**Reviewer:** Ben Hutz\n\n**Author:** Alexander Galarraga\n\nIssue created by migration from https://trac.sagemath.org/ticket/31906\n\n",
    "closed_at": "2021-07-25T13:25:41Z",
    "created_at": "2021-06-04T15:24:44Z",
    "labels": [
        "component: dynamics",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "title": "Faster point transform matrix",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/31906",
    "user": "https://github.com/EnderWannabe"
}
```
Currently, the point transform matrix method is slow over fields such as QQbar, and does not work over precision fields such as the reals.

We implement a different approach based on linear algebra which improves performance over QQbar and works over precision fields. We replace the old approach as our update is an improvement in all cases. As our updated method works over rings, we moved the method to projective space over a ring.

We also add an optional normalize parameter, which over a field normalizes the last non zero entry of the returned matrix to be 1.

**CC:**  @bhutz

**Keywords:** gsoc2021

**Branch/Commit:** [cd508a025517c28f1028e516a5056d8d11b25587](https://github.com/sagemath/sagetrac-mirror/commit/cd508a025517c28f1028e516a5056d8d11b25587)

**Reviewer:** Ben Hutz

**Author:** Alexander Galarraga

Issue created by migration from https://trac.sagemath.org/ticket/31906





---

archive/issue_comments_515845.json:
```json
{
    "body": "**Branch:** [u/gh-EnderWannabe/point_matrix_improvement](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-EnderWannabe/point_matrix_improvement)",
    "created_at": "2021-06-04T15:52:01Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515845",
    "user": "https://github.com/EnderWannabe"
}
```

**Branch:** [u/gh-EnderWannabe/point_matrix_improvement](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-EnderWannabe/point_matrix_improvement)



---

archive/issue_comments_515846.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/85a671a784c0ca8ed7165ab9073b9da12e96b202\">85a671a</a></td><td><code>31906: added tests, moved to be a method for projective space over a ring</code></td></tr></table>\n",
    "created_at": "2021-06-08T18:11:36Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515846",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/85a671a784c0ca8ed7165ab9073b9da12e96b202">85a671a</a></td><td><code>31906: added tests, moved to be a method for projective space over a ring</code></td></tr></table>




---

archive/issue_comments_515847.json:
```json
{
    "body": "**Commit:** [85a671a784c0ca8ed7165ab9073b9da12e96b202](https://github.com/sagemath/sagetrac-mirror/commit/85a671a784c0ca8ed7165ab9073b9da12e96b202)",
    "created_at": "2021-06-08T18:11:36Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515847",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [85a671a784c0ca8ed7165ab9073b9da12e96b202](https://github.com/sagemath/sagetrac-mirror/commit/85a671a784c0ca8ed7165ab9073b9da12e96b202)



---

archive/issue_events_286448.json:
```json
{
    "actor": "https://github.com/EnderWannabe",
    "created_at": "2021-06-08T18:11:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31906#event-286448"
}
```



---

archive/issue_comments_515848.json:
```json
{
    "body": "**Changing commit** from \"[85a671a784c0ca8ed7165ab9073b9da12e96b202](https://github.com/sagemath/sagetrac-mirror/commit/85a671a784c0ca8ed7165ab9073b9da12e96b202)\" to \"[897429b3b029675f11fbb225abc6e283b7f06491](https://github.com/sagemath/sagetrac-mirror/commit/897429b3b029675f11fbb225abc6e283b7f06491)\".",
    "created_at": "2021-06-09T14:22:34Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515848",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[85a671a784c0ca8ed7165ab9073b9da12e96b202](https://github.com/sagemath/sagetrac-mirror/commit/85a671a784c0ca8ed7165ab9073b9da12e96b202)" to "[897429b3b029675f11fbb225abc6e283b7f06491](https://github.com/sagemath/sagetrac-mirror/commit/897429b3b029675f11fbb225abc6e283b7f06491)".



---

archive/issue_comments_515849.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/31cad0f9cf3859dbae98ac910045213c97d2eb81\">31cad0f</a></td><td><code>Merge branch 'develop' of git://trac.sagemath.org/sage into develop</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/11108d231a0f4ecb9ca16f16a988cf79efd25499\">11108d2</a></td><td><code>Merge branch 'develop' into point_matrix_improvement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/897429b3b029675f11fbb225abc6e283b7f06491\">897429b</a></td><td><code>31906: cleaned up code</code></td></tr></table>\n",
    "created_at": "2021-06-09T14:22:34Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515849",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/31cad0f9cf3859dbae98ac910045213c97d2eb81">31cad0f</a></td><td><code>Merge branch 'develop' of git://trac.sagemath.org/sage into develop</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/11108d231a0f4ecb9ca16f16a988cf79efd25499">11108d2</a></td><td><code>Merge branch 'develop' into point_matrix_improvement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/897429b3b029675f11fbb225abc6e283b7f06491">897429b</a></td><td><code>31906: cleaned up code</code></td></tr></table>




---

archive/issue_comments_515850.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n Currently, the point transform matrix method is slow over fields such as QQbar, and does not work over precision fields such as the reals.\n \n We implement a different approach based on linear algebra which improves performance over QQbar and works over precision fields. We replace the old approach as our update is an improvement in all cases.\n+\n+As our updated method works over rings, we moved the method to projective space over a ring.\n``````\n",
    "created_at": "2021-06-09T14:23:29Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515850",
    "user": "https://github.com/EnderWannabe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 Currently, the point transform matrix method is slow over fields such as QQbar, and does not work over precision fields such as the reals.
 
 We implement a different approach based on linear algebra which improves performance over QQbar and works over precision fields. We replace the old approach as our update is an improvement in all cases.
+
+As our updated method works over rings, we moved the method to projective space over a ring.
``````




---

archive/issue_comments_515851.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n Currently, the point transform matrix method is slow over fields such as QQbar, and does not work over precision fields such as the reals.\n \n-We implement a different approach based on linear algebra which improves performance over QQbar and works over precision fields. We replace the old approach as our update is an improvement in all cases.\n+We implement a different approach based on linear algebra which improves performance over QQbar and works over precision fields. We replace the old approach as our update is an improvement in all cases. As our updated method works over rings, we moved the method to projective space over a ring.\n \n-As our updated method works over rings, we moved the method to projective space over a ring.\n+We also add an optional normalize parameter, which over a field normalizes the last non zero entry of the returned matrix to be 1.\n``````\n",
    "created_at": "2021-06-09T14:24:59Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515851",
    "user": "https://github.com/EnderWannabe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 Currently, the point transform matrix method is slow over fields such as QQbar, and does not work over precision fields such as the reals.
 
-We implement a different approach based on linear algebra which improves performance over QQbar and works over precision fields. We replace the old approach as our update is an improvement in all cases.
+We implement a different approach based on linear algebra which improves performance over QQbar and works over precision fields. We replace the old approach as our update is an improvement in all cases. As our updated method works over rings, we moved the method to projective space over a ring.
 
-As our updated method works over rings, we moved the method to projective space over a ring.
+We also add an optional normalize parameter, which over a field normalizes the last non zero entry of the returned matrix to be 1.
``````




---

archive/issue_comments_515852.json:
```json
{
    "body": "<a id='comment:7'></a>\nA few comments here.\n\n- why is this based of off #31896?\n\n- Documentation fixes\n\n`Given a projective space of dimension n -> Given a projective space of dimension n`\n\n`finds -> find`\n\n`If the base ring is a field, the matrix is normalized so that the last nonzero entry in the last row is 1.`\n\n- In the examples, there is a left action defined for matrices on projective points, so you only need to do\n\n```\n[m*points_source[i] == points_target[i] for i in range(4)]\n```\n\n- add some white space to examples like\n\n```\nsage: P1.<a,b,c>=ProjectiveSpace(RR, 2)\nsage: points_source=[P1([1,4,1]),P1([1,2,2]),P1([3,5,1]),P1([1,-1,1])]\nsage: points_target=[P1([5,-2,7]),P1([3,-2,3]),P1([6,-5,9]), P1([3,6,7])]\nsage: P1.point_transformation_matrix(points_source, points_target)\n```\n\n\n- probably worth adding a citation of some kind. This is a standard calculation, but a citation is harder to pin down. I guess you could use my thesis Proposition 2.16 which works out all the details.\n\n```\n@phdthesis{Hutz,\n  author =   {Benjamin Hutz},\n  title =    {Arithmetic Dynamics on Varieties of Dimension Greater Than 1},\n  school =  {Brown University},\n  year =     {2007},\n}\n```\n\n\n-What happened here\n\nworks:\n\n```\nR.<t> = FunctionField(QQ)\nP.<a,b> = ProjectiveSpace(R,1)\npoints_source = [P([-6*t,7]), P([2,4]), P([3,2])]\npoints_target = [P([-1,2*t]), P([0,2]), P([-1,6])]\nP.point_transformation_matrix(points_source, points_target)\n```\n\nZeroDivisionError:\n\n```\nR.<t> = FunctionField(CC)\nP.<a,b> = ProjectiveSpace(R,1)\npoints_source = [P([-6*t,7]), P([2,4]), P([3,2])]\npoints_target = [P([-1,2*t]), P([0,2]), P([-1,6])]\nP.point_transformation_matrix(points_source, points_target)\n```\n\nThis may be part of a larger issue with non-exact fields. \n\n```\nR.<t> = CC[]\nP.<a,b> = ProjectiveSpace(R,1)\npoints_source = [P([-6*t,7]), P([2,4]), P([3,2])]\npoints_target = [P([-1,2*t]), P([0,2]), P([-1,6])]\nm=P.point_transformation_matrix(points_source, points_target, normalize=False)\n[m*points_source[i] == points_target[i] for i in range(3)]\n[False, False, False]\n```\nsame for RR,RIF, CIF (Qp seems ok)\n\neven just plain CC has issues\n\n```\nP.<a,b> = ProjectiveSpace(CC,1)\npoints_source = [P([-6,7]), P([1,4]), P([3,2])]\npoints_target = [P([7,-12]), P([4,2]), P([2,6])]\nm=P.point_transformation_matrix(points_source, points_target)\n[m*points_source[i] == points_target[i] for i in range(3)]\n[False, True, True]\n```\n\nComplex Inteval field just gives weirdness\n\n```\nP.<a,b> = ProjectiveSpace(CIF,1)\npoints_source = [P([-6,7]), P([1,4]), P([3,2])]\npoints_target = [P([7,-12]), P([4,2]), P([2,6])]\nm=P.point_transformation_matrix(points_source, points_target)\n[m*points_source[i] == points_target[i] for i in range(3)]\n[False, True, True]\n```\n\n\nYou may just need to exclude non-exact fields.",
    "created_at": "2021-06-14T15:38:46Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515852",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:7'></a>
A few comments here.

- why is this based of off #31896?

- Documentation fixes

`Given a projective space of dimension n -> Given a projective space of dimension n`

`finds -> find`

`If the base ring is a field, the matrix is normalized so that the last nonzero entry in the last row is 1.`

- In the examples, there is a left action defined for matrices on projective points, so you only need to do

```
[m*points_source[i] == points_target[i] for i in range(4)]
```

- add some white space to examples like

```
sage: P1.<a,b,c>=ProjectiveSpace(RR, 2)
sage: points_source=[P1([1,4,1]),P1([1,2,2]),P1([3,5,1]),P1([1,-1,1])]
sage: points_target=[P1([5,-2,7]),P1([3,-2,3]),P1([6,-5,9]), P1([3,6,7])]
sage: P1.point_transformation_matrix(points_source, points_target)
```


- probably worth adding a citation of some kind. This is a standard calculation, but a citation is harder to pin down. I guess you could use my thesis Proposition 2.16 which works out all the details.

```
@phdthesis{Hutz,
  author =   {Benjamin Hutz},
  title =    {Arithmetic Dynamics on Varieties of Dimension Greater Than 1},
  school =  {Brown University},
  year =     {2007},
}
```


-What happened here

works:

```
R.<t> = FunctionField(QQ)
P.<a,b> = ProjectiveSpace(R,1)
points_source = [P([-6*t,7]), P([2,4]), P([3,2])]
points_target = [P([-1,2*t]), P([0,2]), P([-1,6])]
P.point_transformation_matrix(points_source, points_target)
```

ZeroDivisionError:

```
R.<t> = FunctionField(CC)
P.<a,b> = ProjectiveSpace(R,1)
points_source = [P([-6*t,7]), P([2,4]), P([3,2])]
points_target = [P([-1,2*t]), P([0,2]), P([-1,6])]
P.point_transformation_matrix(points_source, points_target)
```

This may be part of a larger issue with non-exact fields. 

```
R.<t> = CC[]
P.<a,b> = ProjectiveSpace(R,1)
points_source = [P([-6*t,7]), P([2,4]), P([3,2])]
points_target = [P([-1,2*t]), P([0,2]), P([-1,6])]
m=P.point_transformation_matrix(points_source, points_target, normalize=False)
[m*points_source[i] == points_target[i] for i in range(3)]
[False, False, False]
```
same for RR,RIF, CIF (Qp seems ok)

even just plain CC has issues

```
P.<a,b> = ProjectiveSpace(CC,1)
points_source = [P([-6,7]), P([1,4]), P([3,2])]
points_target = [P([7,-12]), P([4,2]), P([2,6])]
m=P.point_transformation_matrix(points_source, points_target)
[m*points_source[i] == points_target[i] for i in range(3)]
[False, True, True]
```

Complex Inteval field just gives weirdness

```
P.<a,b> = ProjectiveSpace(CIF,1)
points_source = [P([-6,7]), P([1,4]), P([3,2])]
points_target = [P([7,-12]), P([4,2]), P([2,6])]
m=P.point_transformation_matrix(points_source, points_target)
[m*points_source[i] == points_target[i] for i in range(3)]
[False, True, True]
```


You may just need to exclude non-exact fields.



---

archive/issue_events_286449.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2021-06-14T15:38:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31906#event-286449"
}
```



---

archive/issue_events_286450.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2021-06-14T15:38:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31906#event-286450"
}
```



---

archive/issue_comments_515853.json:
```json
{
    "body": "**Reviewer:** Ben Hutz",
    "created_at": "2021-06-14T15:38:46Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515853",
    "user": "https://github.com/bhutz"
}
```

**Reviewer:** Ben Hutz



---

archive/issue_comments_515854.json:
```json
{
    "body": "<a id='comment:8'></a>\nFixed the documentation issues.\n\nAs for the issues with non-exact fields, normalizing was causing issues, as CIF can't distinguish 1*10<sup>-13</sup> from 0. I stopped normalizing if the field is not exact. This shouldn't interfere with existing functionality, as this function did not previously work with non-exact fields. This fixes the CIF example:\n\n\n```\nP.<a,b> = ProjectiveSpace(CIF,1)\npoints_source = [P([-6,7]), P([1,4]), P([3,2])]\npoints_target = [P([7,-12]), P([4,2]), P([2,6])]\nm=P.point_transformation_matrix(points_source, points_target); m\n[          0.?e-14 0.33333333333334?]\n[0.66666666666667?           0.?e-14]\n```\n\n\nThe zero division error seems to be caused by CC[] thinking it is an exact field, as function fields do not implement an is_exact() method.\n\nI added a warning saying that over non-exact fields, the matrix may be far from correct.",
    "created_at": "2021-06-15T18:48:06Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515854",
    "user": "https://github.com/EnderWannabe"
}
```

<a id='comment:8'></a>
Fixed the documentation issues.

As for the issues with non-exact fields, normalizing was causing issues, as CIF can't distinguish 1*10<sup>-13</sup> from 0. I stopped normalizing if the field is not exact. This shouldn't interfere with existing functionality, as this function did not previously work with non-exact fields. This fixes the CIF example:


```
P.<a,b> = ProjectiveSpace(CIF,1)
points_source = [P([-6,7]), P([1,4]), P([3,2])]
points_target = [P([7,-12]), P([4,2]), P([2,6])]
m=P.point_transformation_matrix(points_source, points_target); m
[          0.?e-14 0.33333333333334?]
[0.66666666666667?           0.?e-14]
```


The zero division error seems to be caused by CC[] thinking it is an exact field, as function fields do not implement an is_exact() method.

I added a warning saying that over non-exact fields, the matrix may be far from correct.



---

archive/issue_comments_515855.json:
```json
{
    "body": "**Changing commit** from \"[897429b3b029675f11fbb225abc6e283b7f06491](https://github.com/sagemath/sagetrac-mirror/commit/897429b3b029675f11fbb225abc6e283b7f06491)\" to \"[3fbdf2715a6f724968ca532cd036f274d0f60186](https://github.com/sagemath/sagetrac-mirror/commit/3fbdf2715a6f724968ca532cd036f274d0f60186)\".",
    "created_at": "2021-06-15T18:49:19Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515855",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[897429b3b029675f11fbb225abc6e283b7f06491](https://github.com/sagemath/sagetrac-mirror/commit/897429b3b029675f11fbb225abc6e283b7f06491)" to "[3fbdf2715a6f724968ca532cd036f274d0f60186](https://github.com/sagemath/sagetrac-mirror/commit/3fbdf2715a6f724968ca532cd036f274d0f60186)".



---

archive/issue_comments_515856.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e21868f34ba3b96e986c57a29039b52592220ca\">2e21868</a></td><td><code>31906: removed 31896, added whitespace</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/267cb6dd51c3ad9dc7fd9c7f4ba70ea47530a3ef\">267cb6d</a></td><td><code>31906: stopped normalizing for non exact fields, added warning</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3fbdf2715a6f724968ca532cd036f274d0f60186\">3fbdf27</a></td><td><code>31906: non exact to non-exact</code></td></tr></table>\n",
    "created_at": "2021-06-15T18:49:19Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515856",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e21868f34ba3b96e986c57a29039b52592220ca">2e21868</a></td><td><code>31906: removed 31896, added whitespace</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/267cb6dd51c3ad9dc7fd9c7f4ba70ea47530a3ef">267cb6d</a></td><td><code>31906: stopped normalizing for non exact fields, added warning</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3fbdf2715a6f724968ca532cd036f274d0f60186">3fbdf27</a></td><td><code>31906: non exact to non-exact</code></td></tr></table>




---

archive/issue_events_286451.json:
```json
{
    "actor": "https://github.com/EnderWannabe",
    "created_at": "2021-06-15T18:49:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31906#event-286451"
}
```



---

archive/issue_events_286452.json:
```json
{
    "actor": "https://github.com/EnderWannabe",
    "created_at": "2021-06-15T18:49:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31906#event-286452"
}
```



---

archive/issue_comments_515857.json:
```json
{
    "body": "<a id='comment:11'></a>\nThis fixes the issues that are fixable. The ZeroDivisionError seems to not be an issue in any of your code, that is just a problem with .inverse() over that ring. So we'll leave that as is.\n\nThe inexact solution I think is as good as it can get. Checking `==` for these points isn't really the best mechanism. Looking more closely they are differing only be precision errors in the examples I tried. So, I'm ok with the behavior being exhibited.\n\nJust one issue\n- the warning box is not formatting correctly in the documentation. I think it is just the space before the `::`",
    "created_at": "2021-06-16T20:00:39Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515857",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:11'></a>
This fixes the issues that are fixable. The ZeroDivisionError seems to not be an issue in any of your code, that is just a problem with .inverse() over that ring. So we'll leave that as is.

The inexact solution I think is as good as it can get. Checking `==` for these points isn't really the best mechanism. Looking more closely they are differing only be precision errors in the examples I tried. So, I'm ok with the behavior being exhibited.

Just one issue
- the warning box is not formatting correctly in the documentation. I think it is just the space before the `::`



---

archive/issue_events_286453.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2021-06-16T20:00:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31906#event-286453"
}
```



---

archive/issue_events_286454.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2021-06-16T20:00:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31906#event-286454"
}
```



---

archive/issue_comments_515858.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eaa4424537802bf4ef354203b6c151dce7e460cd\">eaa4424</a></td><td><code>31906: fix for docs</code></td></tr></table>\n",
    "created_at": "2021-06-17T16:32:24Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515858",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eaa4424537802bf4ef354203b6c151dce7e460cd">eaa4424</a></td><td><code>31906: fix for docs</code></td></tr></table>




---

archive/issue_comments_515859.json:
```json
{
    "body": "**Changing commit** from \"[3fbdf2715a6f724968ca532cd036f274d0f60186](https://github.com/sagemath/sagetrac-mirror/commit/3fbdf2715a6f724968ca532cd036f274d0f60186)\" to \"[eaa4424537802bf4ef354203b6c151dce7e460cd](https://github.com/sagemath/sagetrac-mirror/commit/eaa4424537802bf4ef354203b6c151dce7e460cd)\".",
    "created_at": "2021-06-17T16:32:24Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515859",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3fbdf2715a6f724968ca532cd036f274d0f60186](https://github.com/sagemath/sagetrac-mirror/commit/3fbdf2715a6f724968ca532cd036f274d0f60186)" to "[eaa4424537802bf4ef354203b6c151dce7e460cd](https://github.com/sagemath/sagetrac-mirror/commit/eaa4424537802bf4ef354203b6c151dce7e460cd)".



---

archive/issue_comments_515860.json:
```json
{
    "body": "<a id='comment:13'></a>\nThis still doesn't work. Take a look at another warning in the code. Looks like it needs to be\n\n```\n.. warning::\n\n   text\n```",
    "created_at": "2021-06-17T18:27:40Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515860",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:13'></a>
This still doesn't work. Take a look at another warning in the code. Looks like it needs to be

```
.. warning::

   text
```



---

archive/issue_comments_515861.json:
```json
{
    "body": "**Changing commit** from \"[eaa4424537802bf4ef354203b6c151dce7e460cd](https://github.com/sagemath/sagetrac-mirror/commit/eaa4424537802bf4ef354203b6c151dce7e460cd)\" to \"[b8ce4b7d83d24e58a3524f924077a90921707759](https://github.com/sagemath/sagetrac-mirror/commit/b8ce4b7d83d24e58a3524f924077a90921707759)\".",
    "created_at": "2021-06-17T19:27:47Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515861",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[eaa4424537802bf4ef354203b6c151dce7e460cd](https://github.com/sagemath/sagetrac-mirror/commit/eaa4424537802bf4ef354203b6c151dce7e460cd)" to "[b8ce4b7d83d24e58a3524f924077a90921707759](https://github.com/sagemath/sagetrac-mirror/commit/b8ce4b7d83d24e58a3524f924077a90921707759)".



---

archive/issue_comments_515862.json:
```json
{
    "body": "<a id='comment:14'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b8ce4b7d83d24e58a3524f924077a90921707759\">b8ce4b7</a></td><td><code>31906: actual fix for warning message</code></td></tr></table>\n",
    "created_at": "2021-06-17T19:27:47Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515862",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b8ce4b7d83d24e58a3524f924077a90921707759">b8ce4b7</a></td><td><code>31906: actual fix for warning message</code></td></tr></table>




---

archive/issue_events_286455.json:
```json
{
    "actor": "https://github.com/EnderWannabe",
    "created_at": "2021-06-17T19:28:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31906#event-286455"
}
```



---

archive/issue_events_286456.json:
```json
{
    "actor": "https://github.com/EnderWannabe",
    "created_at": "2021-06-17T19:28:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31906#event-286456"
}
```



---

archive/issue_events_286457.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2021-06-17T19:37:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31906#event-286457"
}
```



---

archive/issue_events_286458.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2021-06-17T19:37:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31906#event-286458"
}
```



---

archive/issue_events_286459.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2021-07-06T15:10:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31906#event-286459"
}
```



---

archive/issue_events_286460.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2021-07-06T15:10:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31906#event-286460"
}
```



---

archive/issue_comments_515863.json:
```json
{
    "body": "<a id='comment:17'></a>\nFound a fringe case bug that should be fixed.\n\n```\nP.<x,y,z>=ProjectiveSpace(ZZ,2)\npoints_source = [P(1 , 0, 0), P(0 , 1 , 0), P(0 , 0 , 1), P(1 , -1 , -1)]\npoints_target = [P(0 , 1 , 0), P(-2 , 0 , 1), P(0 , 0 , 1), P(1 , -1 , -1)]\nP.point_transformation_matrix(points_source,points_target,normalize=True)\n```",
    "created_at": "2021-07-06T15:10:13Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515863",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:17'></a>
Found a fringe case bug that should be fixed.

```
P.<x,y,z>=ProjectiveSpace(ZZ,2)
points_source = [P(1 , 0, 0), P(0 , 1 , 0), P(0 , 0 , 1), P(1 , -1 , -1)]
points_target = [P(0 , 1 , 0), P(-2 , 0 , 1), P(0 , 0 , 1), P(1 , -1 , -1)]
P.point_transformation_matrix(points_source,points_target,normalize=True)
```



---

archive/issue_comments_515864.json:
```json
{
    "body": "**Changing commit** from \"[b8ce4b7d83d24e58a3524f924077a90921707759](https://github.com/sagemath/sagetrac-mirror/commit/b8ce4b7d83d24e58a3524f924077a90921707759)\" to \"[e7e893071ac99e3d9cd76e5ebf01395b922c198c](https://github.com/sagemath/sagetrac-mirror/commit/e7e893071ac99e3d9cd76e5ebf01395b922c198c)\".",
    "created_at": "2021-07-06T16:25:42Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515864",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b8ce4b7d83d24e58a3524f924077a90921707759](https://github.com/sagemath/sagetrac-mirror/commit/b8ce4b7d83d24e58a3524f924077a90921707759)" to "[e7e893071ac99e3d9cd76e5ebf01395b922c198c](https://github.com/sagemath/sagetrac-mirror/commit/e7e893071ac99e3d9cd76e5ebf01395b922c198c)".



---

archive/issue_comments_515865.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc36d1997650d6d5772027933d98717468731b67\">dc36d19</a></td><td><code>Merge branch 'u/gh-EnderWannabe/point_matrix_improvement' of trac.sagemath.org:sage into point_transformation_improvement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e7e893071ac99e3d9cd76e5ebf01395b922c198c\">e7e8930</a></td><td><code>31906: fixed denominator bug</code></td></tr></table>\n",
    "created_at": "2021-07-06T16:25:42Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515865",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc36d1997650d6d5772027933d98717468731b67">dc36d19</a></td><td><code>Merge branch 'u/gh-EnderWannabe/point_matrix_improvement' of trac.sagemath.org:sage into point_transformation_improvement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e7e893071ac99e3d9cd76e5ebf01395b922c198c">e7e8930</a></td><td><code>31906: fixed denominator bug</code></td></tr></table>




---

archive/issue_comments_515866.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [bhutz](#comment%3A17):\n> Found a fringe case bug that should be fixed.\n> \n\n\nFixed and added as test",
    "created_at": "2021-07-06T16:26:12Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515866",
    "user": "https://github.com/EnderWannabe"
}
```

<a id='comment:19'></a>
Replying to [bhutz](#comment%3A17):
> Found a fringe case bug that should be fixed.
> 


Fixed and added as test



---

archive/issue_events_286461.json:
```json
{
    "actor": "https://github.com/EnderWannabe",
    "created_at": "2021-07-06T16:50:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31906#event-286461"
}
```



---

archive/issue_events_286462.json:
```json
{
    "actor": "https://github.com/EnderWannabe",
    "created_at": "2021-07-06T16:50:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31906#event-286462"
}
```



---

archive/issue_comments_515867.json:
```json
{
    "body": "**Changing branch** from \"[u/gh-EnderWannabe/point_matrix_improvement](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-EnderWannabe/point_matrix_improvement)\" to \"[u/bhutz/point_matrix_improvement](https://github.com/sagemath/sagetrac-mirror/tree/u/bhutz/point_matrix_improvement)\".",
    "created_at": "2021-07-06T17:30:18Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515867",
    "user": "https://github.com/bhutz"
}
```

**Changing branch** from "[u/gh-EnderWannabe/point_matrix_improvement](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-EnderWannabe/point_matrix_improvement)" to "[u/bhutz/point_matrix_improvement](https://github.com/sagemath/sagetrac-mirror/tree/u/bhutz/point_matrix_improvement)".



---

archive/issue_comments_515868.json:
```json
{
    "body": "**Changing commit** from \"[e7e893071ac99e3d9cd76e5ebf01395b922c198c](https://github.com/sagemath/sagetrac-mirror/commit/e7e893071ac99e3d9cd76e5ebf01395b922c198c)\" to \"[cd508a025517c28f1028e516a5056d8d11b25587](https://github.com/sagemath/sagetrac-mirror/commit/cd508a025517c28f1028e516a5056d8d11b25587)\".",
    "created_at": "2021-07-06T17:30:48Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515868",
    "user": "https://github.com/bhutz"
}
```

**Changing commit** from "[e7e893071ac99e3d9cd76e5ebf01395b922c198c](https://github.com/sagemath/sagetrac-mirror/commit/e7e893071ac99e3d9cd76e5ebf01395b922c198c)" to "[cd508a025517c28f1028e516a5056d8d11b25587](https://github.com/sagemath/sagetrac-mirror/commit/cd508a025517c28f1028e516a5056d8d11b25587)".



---

archive/issue_events_286463.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2021-07-06T17:30:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31906#event-286463"
}
```



---

archive/issue_events_286464.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2021-07-06T17:30:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31906#event-286464"
}
```



---

archive/issue_comments_515869.json:
```json
{
    "body": "<a id='comment:22'></a>\nThis fixes the examples. I adjusted the spacing on the added test.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cd508a025517c28f1028e516a5056d8d11b25587\">cd508a0</a></td><td><code>31906 - fix spacing in example</code></td></tr></table>\n",
    "created_at": "2021-07-06T17:30:48Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515869",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:22'></a>
This fixes the examples. I adjusted the spacing on the added test.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cd508a025517c28f1028e516a5056d8d11b25587">cd508a0</a></td><td><code>31906 - fix spacing in example</code></td></tr></table>




---

archive/issue_events_286465.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-25T13:25:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31906#event-286465"
}
```



---

archive/issue_events_286466.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "ebb87463188e45252d6ab622e6098115726874b2",
    "created_at": "2021-07-25T13:25:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31906#event-286466"
}
```



---

archive/issue_comments_515870.json:
```json
{
    "body": "**Changing branch** from \"[u/bhutz/point_matrix_improvement](https://github.com/sagemath/sagetrac-mirror/tree/u/bhutz/point_matrix_improvement)\" to \"[cd508a025517c28f1028e516a5056d8d11b25587](https://github.com/sagemath/sagetrac-mirror/commit/cd508a025517c28f1028e516a5056d8d11b25587)\".",
    "created_at": "2021-07-25T13:25:41Z",
    "issue": "https://github.com/sagemath/sage/issues/31906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31906#issuecomment-515870",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/bhutz/point_matrix_improvement](https://github.com/sagemath/sagetrac-mirror/tree/u/bhutz/point_matrix_improvement)" to "[cd508a025517c28f1028e516a5056d8d11b25587](https://github.com/sagemath/sagetrac-mirror/commit/cd508a025517c28f1028e516a5056d8d11b25587)".
