# Issue 31781: Improve handling of metrics on pseudo-Riemannian submanifolds

archive/issues_031544.json:
```json
{
    "body": "In Sage 9.3.rc5, we have\n\n```\nsage: S2 = manifolds.Sphere(2)                                      \nsage: g = S2.metric()\nsage: g                                    \nRiemannian metric g on the 2-sphere S^2 of radius 1 smoothly embedded \n in the Euclidean space E^3\n```\nSo far so good, but then\n\n```\nsage: g.display()\n...\nValueError: no basis could be found for computing the components\n in the Coordinate frame (A, (d/dtheta,d/dphi))\n```\n\n```\nsage: g.ricci_scalar()\n...\nValueError: no basis could be found for computing the components\n in the Coordinate frame (A, (d/dtheta,d/dphi))\n```\n\nCC:  @mjungmath\n\nBranch/Commit: dc15aff72221572912f47c0ac12f6325ee4da3a7\n\nReviewer: Michael Jung\n\nAuthor: Eric Gourgoulhon\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31781\n\n",
    "closed_at": "2021-08-31T22:00:52Z",
    "created_at": "2021-05-05T15:53:01Z",
    "labels": [
        "component: manifolds",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Improve handling of metrics on pseudo-Riemannian submanifolds",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31781",
    "user": "https://github.com/egourgoulhon"
}
```
In Sage 9.3.rc5, we have

```
sage: S2 = manifolds.Sphere(2)                                      
sage: g = S2.metric()
sage: g                                    
Riemannian metric g on the 2-sphere S^2 of radius 1 smoothly embedded 
 in the Euclidean space E^3
```
So far so good, but then

```
sage: g.display()
...
ValueError: no basis could be found for computing the components
 in the Coordinate frame (A, (d/dtheta,d/dphi))
```

```
sage: g.ricci_scalar()
...
ValueError: no basis could be found for computing the components
 in the Coordinate frame (A, (d/dtheta,d/dphi))
```

CC:  @mjungmath

Branch/Commit: dc15aff72221572912f47c0ac12f6325ee4da3a7

Reviewer: Michael Jung

Author: Eric Gourgoulhon

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31781





---

archive/issue_comments_450279.json:
```json
{
    "body": "<a id='comment:1'></a>Actually, it appears that `g` is not initialized:\n\n```\nsage: S2 = manifolds.Sphere(2)                                             \nsage: g = S2.metric()                                                        \nsage: g._restrictions                                           \n{}\n```",
    "created_at": "2021-05-05T16:03:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450279",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:1'></a>Actually, it appears that `g` is not initialized:

```
sage: S2 = manifolds.Sphere(2)                                             
sage: g = S2.metric()                                                        
sage: g._restrictions                                           
{}
```



---

archive/issue_comments_450280.json:
```json
{
    "body": "<a id='comment:2'></a>Since spheres are implemented as embedded manifolds, they are only endowed with the induced metric from the ambient space.\n\nThus I'd say this is no bug. In particular it could happen that the user wants to endow spheres with metrics different from the induced one.\n\nI'd say we just mention this in the documentation.",
    "created_at": "2021-05-05T17:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450280",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:2'></a>Since spheres are implemented as embedded manifolds, they are only endowed with the induced metric from the ambient space.

Thus I'd say this is no bug. In particular it could happen that the user wants to endow spheres with metrics different from the induced one.

I'd say we just mention this in the documentation.



---

archive/issue_comments_450281.json:
```json
{
    "body": "<a id='comment:3'></a>Wait. We implemented spheres as Riemannian submanifolds which means that `S2.metric()` should certainly give the induced metric.\n\nBut then this is more a bug of `PseudoRiemannianSubmanifold` where `metric()` is not delegating to `induced_metric()`.",
    "created_at": "2021-05-05T17:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450281",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:3'></a>Wait. We implemented spheres as Riemannian submanifolds which means that `S2.metric()` should certainly give the induced metric.

But then this is more a bug of `PseudoRiemannianSubmanifold` where `metric()` is not delegating to `induced_metric()`.



---

archive/issue_comments_450282.json:
```json
{
    "body": "<a id='comment:4'></a>As for my first comment, perhaps it is a good idea to add an optional argument such as `induced_metric=True` or `riemannian=True` for spheres to choose whether the submanifold should inherit the metric or not.",
    "created_at": "2021-05-05T17:12:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450282",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:4'></a>As for my first comment, perhaps it is a good idea to add an optional argument such as `induced_metric=True` or `riemannian=True` for spheres to choose whether the submanifold should inherit the metric or not.



---

archive/issue_comments_450283.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:3 gh-mjungmath]:\n> Wait. We implemented spheres as Riemannian submanifolds which means that `S2.metric()` should certainly give the induced metric.\n\n\nYes!\n\n> \n> But then this is more a bug of `PseudoRiemannianSubmanifold` where `metric()` is not delegating to `induced_metric()`.\n\n\nIndeed!",
    "created_at": "2021-05-05T17:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450283",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:5'></a>Replying to [comment:3 gh-mjungmath]:
> Wait. We implemented spheres as Riemannian submanifolds which means that `S2.metric()` should certainly give the induced metric.


Yes!

> 
> But then this is more a bug of `PseudoRiemannianSubmanifold` where `metric()` is not delegating to `induced_metric()`.


Indeed!



---

archive/issue_comments_450284.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:4 gh-mjungmath]:\n> As for my first comment, perhaps it is a good idea to add an optional argument such as `induced_metric=True` or `riemannian=True` for spheres to choose whether the submanifold should inherit the metric or not.\n\n\nYes, I would vote for `riemannian=True`, such that if the user chooses `riemannian=False`, she/he ends up with a pure differentiable manifold, without any predefined metric. Similarly, we could have `differentiable=True`, so that choosing `differentiable=False` returns a mere topological manifold.",
    "created_at": "2021-05-05T17:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450284",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:6'></a>Replying to [comment:4 gh-mjungmath]:
> As for my first comment, perhaps it is a good idea to add an optional argument such as `induced_metric=True` or `riemannian=True` for spheres to choose whether the submanifold should inherit the metric or not.


Yes, I would vote for `riemannian=True`, such that if the user chooses `riemannian=False`, she/he ends up with a pure differentiable manifold, without any predefined metric. Similarly, we could have `differentiable=True`, so that choosing `differentiable=False` returns a mere topological manifold.



---

archive/issue_comments_450285.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 egourgoulhon]:\n> Replying to [comment:4 gh-mjungmath]:\n> > As for my first comment, perhaps it is a good idea to add an optional argument such as `induced_metric=True` or `riemannian=True` for spheres to choose whether the submanifold should inherit the metric or not.\n\n> \n> Yes, I would vote for `riemannian=True`, such that if the user chooses `riemannian=False`, she/he ends up with a pure differentiable manifold, without any predefined metric. Similarly, we could have `differentiable=True`, so that choosing `differentiable=False` returns a mere topological manifold.  \n\n\nOn a second thought, #31241 might be a better solution for that.",
    "created_at": "2021-05-05T17:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450285",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:7'></a>Replying to [comment:6 egourgoulhon]:
> Replying to [comment:4 gh-mjungmath]:
> > As for my first comment, perhaps it is a good idea to add an optional argument such as `induced_metric=True` or `riemannian=True` for spheres to choose whether the submanifold should inherit the metric or not.

> 
> Yes, I would vote for `riemannian=True`, such that if the user chooses `riemannian=False`, she/he ends up with a pure differentiable manifold, without any predefined metric. Similarly, we could have `differentiable=True`, so that choosing `differentiable=False` returns a mere topological manifold.  


On a second thought, #31241 might be a better solution for that.



---

archive/issue_comments_450286.json:
```json
{
    "body": "<a id='comment:8'></a>Moving to 9.4, as 9.3 has been released.",
    "created_at": "2021-05-10T17:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450286",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Moving to 9.4, as 9.3 has been released.



---

archive/issue_events_083893.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31781#event-83893"
}
```



---

archive/issue_comments_450287.json:
```json
{
    "body": "<a id='comment:9'></a>(see comment:11 below)",
    "created_at": "2021-08-14T13:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450287",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:9'></a>(see comment:11 below)



---

archive/issue_comments_450288.json:
```json
{
    "body": "<a id='comment:10'></a>Should we instead attack the issue with `PseudoRiemannianSubmanifold` and it's `metric()` call?",
    "created_at": "2021-08-14T13:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450288",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:10'></a>Should we instead attack the issue with `PseudoRiemannianSubmanifold` and it's `metric()` call?



---

archive/issue_comments_450289.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:9 gh-mjungmath]:\n> I think we should implement this flag. Ticket #31241 just gives a more natural way to implement this. But I am afraid this ticket is not nearly ready. So I would be fine having a tentative implementation to make the above syntax more convenient for the end-user.\n\n\nThis issue is by the way not restricted to spheres. Also Pseudo-Riemannian manifolds can have different metrics. The current implementation even accommodates this. From that perspective, despite what I said earlier, I actually don't see the need for such a flag because this is in full line with the current way of using Pseudo-Riemannian manifolds.\n\nAt this point it might also worth to mention that differentiable manifolds with imposed metrics are not seen as Pseudo-Riemannian manifolds. We don't even have a category for Pseudo-Riemannian manifolds.",
    "created_at": "2021-08-14T13:28:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450289",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:11'></a>Replying to [comment:9 gh-mjungmath]:
> I think we should implement this flag. Ticket #31241 just gives a more natural way to implement this. But I am afraid this ticket is not nearly ready. So I would be fine having a tentative implementation to make the above syntax more convenient for the end-user.


This issue is by the way not restricted to spheres. Also Pseudo-Riemannian manifolds can have different metrics. The current implementation even accommodates this. From that perspective, despite what I said earlier, I actually don't see the need for such a flag because this is in full line with the current way of using Pseudo-Riemannian manifolds.

At this point it might also worth to mention that differentiable manifolds with imposed metrics are not seen as Pseudo-Riemannian manifolds. We don't even have a category for Pseudo-Riemannian manifolds.



---

archive/issue_comments_450290.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:10 gh-mjungmath]:\n> Should we instead attack the issue with `PseudoRiemannianSubmanifold` and it's `metric()` call?\n\nYes I think so (see comment:13 below).",
    "created_at": "2021-08-14T14:54:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450290",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:12'></a>Replying to [comment:10 gh-mjungmath]:
> Should we instead attack the issue with `PseudoRiemannianSubmanifold` and it's `metric()` call?

Yes I think so (see comment:13 below).



---

archive/issue_comments_450291.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:11 gh-mjungmath]:\n> This issue is by the way not restricted to spheres. Also Pseudo-Riemannian manifolds can have different metrics. The current implementation even accommodates this. From that perspective, despite what I said earlier, I actually don't see the need for such a flag because this is in full line with the current way of using Pseudo-Riemannian manifolds.\n> \n\nIn the current implementation, on any `PseudoRiemannianManifold`, \n- `metric()` returns the default metric\n- `metric('h')` initializes a new metric with name `h`\n\nTo be consistent, on a `PseudoRiemannianSubmanifold`, we should have the following behavior:\n- `metric()` redirects to `induced_metric()`, since this is clearly the default metric on a pseudo-Riemannian submanifold\n- `metric('h')` initializes a new metric with name `h`\n\nTo acheive this, we should redefine `metric()` in the subclass `PseudoRiemannianSubmanifold`.",
    "created_at": "2021-08-14T15:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450291",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:13'></a>Replying to [comment:11 gh-mjungmath]:
> This issue is by the way not restricted to spheres. Also Pseudo-Riemannian manifolds can have different metrics. The current implementation even accommodates this. From that perspective, despite what I said earlier, I actually don't see the need for such a flag because this is in full line with the current way of using Pseudo-Riemannian manifolds.
> 

In the current implementation, on any `PseudoRiemannianManifold`, 
- `metric()` returns the default metric
- `metric('h')` initializes a new metric with name `h`

To be consistent, on a `PseudoRiemannianSubmanifold`, we should have the following behavior:
- `metric()` redirects to `induced_metric()`, since this is clearly the default metric on a pseudo-Riemannian submanifold
- `metric('h')` initializes a new metric with name `h`

To acheive this, we should redefine `metric()` in the subclass `PseudoRiemannianSubmanifold`.



---

archive/issue_comments_450292.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 egourgoulhon]:\n> Replying to [comment:11 gh-mjungmath]:\n> > This issue is by the way not restricted to spheres. Also Pseudo-Riemannian manifolds can have different metrics. The current implementation even accommodates this. From that perspective, despite what I said earlier, I actually don't see the need for such a flag because this is in full line with the current way of using Pseudo-Riemannian manifolds.\n> > \n\n> In the current implementation, on any `PseudoRiemannianManifold`, \n>  - `metric()` returns the default metric\n>  - `metric('h')` initializes a new metric with name `h`\n \n> \n> To be consistent, on a `PseudoRiemannianSubmanifold`, we should have the following behavior:\n> - `metric()` redirects to `induced_metric()`, since this is clearly the default metric on a pseudo-Riemannian submanifold\n> - `metric('h')` initializes a new metric with name `h`\n> \n> To acheive this, we should redefine `metric()` in the subclass `PseudoRiemannianSubmanifold`.\n\n\nMy thought exactly!",
    "created_at": "2021-08-14T15:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450292",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:14'></a>Replying to [comment:13 egourgoulhon]:
> Replying to [comment:11 gh-mjungmath]:
> > This issue is by the way not restricted to spheres. Also Pseudo-Riemannian manifolds can have different metrics. The current implementation even accommodates this. From that perspective, despite what I said earlier, I actually don't see the need for such a flag because this is in full line with the current way of using Pseudo-Riemannian manifolds.
> > 

> In the current implementation, on any `PseudoRiemannianManifold`, 
>  - `metric()` returns the default metric
>  - `metric('h')` initializes a new metric with name `h`
 
> 
> To be consistent, on a `PseudoRiemannianSubmanifold`, we should have the following behavior:
> - `metric()` redirects to `induced_metric()`, since this is clearly the default metric on a pseudo-Riemannian submanifold
> - `metric('h')` initializes a new metric with name `h`
> 
> To acheive this, we should redefine `metric()` in the subclass `PseudoRiemannianSubmanifold`.


My thought exactly!



---

archive/issue_comments_450293.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 gh-mjungmath]:\n> \n> My thought exactly!\n\nVery good. Do you plan to implement this?",
    "created_at": "2021-08-14T15:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450293",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:15'></a>Replying to [comment:14 gh-mjungmath]:
> 
> My thought exactly!

Very good. Do you plan to implement this?



---

archive/issue_comments_450294.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 egourgoulhon]:\n> > My thought exactly!\n\n> Very good. Do you plan to implement this?\n\nI'd prefer to first work on tickets that are needed for my current project. Time is slipping through. As soon as those are done, I could come back to this one.",
    "created_at": "2021-08-14T16:25:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450294",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:16'></a>Replying to [comment:15 egourgoulhon]:
> > My thought exactly!

> Very good. Do you plan to implement this?

I'd prefer to first work on tickets that are needed for my current project. Time is slipping through. As soon as those are done, I could come back to this one.



---

archive/issue_comments_450295.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 gh-mjungmath]:\n> \n> I'd prefer to first work on tickets that are needed for my current project. Time is slipping through. As soon as those are done, I could come back to this one.\n\nNo problem, I'll implement it soon.",
    "created_at": "2021-08-14T18:15:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450295",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:17'></a>Replying to [comment:16 gh-mjungmath]:
> 
> I'd prefer to first work on tickets that are needed for my current project. Time is slipping through. As soon as those are done, I could come back to this one.

No problem, I'll implement it soon.



---

archive/issue_comments_450296.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-08-16T16:17:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450296",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_450297.json:
```json
{
    "body": "<a id='comment:18'></a>According to the discussion in comment:13 and comment:14, the above branch reimplements the method `metric` in the subclass `PseudoRiemannianSubmanifold` of `PseudoRiemannianManifold`. In preparing it, I've realized that the handling of the metric names was somewhat messy and I've reorganized it. I've also made the default name of the metric of spheres in the manifold catalog to be `g` instead of `gamma`, which is more natural, I think. \n\n---\nNew commits:",
    "created_at": "2021-08-16T16:17:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450297",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:18'></a>According to the discussion in comment:13 and comment:14, the above branch reimplements the method `metric` in the subclass `PseudoRiemannianSubmanifold` of `PseudoRiemannianManifold`. In preparing it, I've realized that the handling of the metric names was somewhat messy and I've reorganized it. I've also made the default name of the metric of spheres in the manifold catalog to be `g` instead of `gamma`, which is more natural, I think. 

---
New commits:



---

archive/issue_events_083894.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31781#event-83894"
}
```



---

archive/issue_events_083895.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31781#event-83895"
}
```



---

archive/issue_comments_450298.json:
```json
{
    "body": "<a id='comment:20'></a>Is there a specific reason for this change?\n\n```diff\n@@ -98,12 +98,12 @@ class DegenerateManifold(DifferentiableManifold):\n     - [DB1996]_\n     - [DS2010]_\n     \"\"\"\n-    def __init__(self, n, name, metric_name='g', signature=None, base_manifold=None,\n-                 diff_degree=infinity, latex_name=None,\n+    def __init__(self, n, name, metric_name=None, signature=None,\n+                 base_manifold=None, diff_degree=infinity, latex_name=None,\n                  metric_latex_name=None, start_index=0, category=None,\n                  unique_tag=None):\n         r\"\"\"\n-        Construct a pseudo-Riemannian manifold.\n+        Construct a degenerate manifold.\n \n         TESTS::\n \n@@ -130,7 +130,9 @@ class DegenerateManifold(DifferentiableManifold):\n                                         category=category)\n         self._metric = None # to be initialized by metric()\n         self._metric_signature = signature\n-        if not isinstance(metric_name, str):\n+        if metric_name is None:\n+            metric_name = 'g'\n+        elif not isinstance(metric_name, str):\n             raise TypeError(\"{} is not a string\".format(metric_name))\n         self._metric_name = metric_name\n         if metric_latex_name is None:\n```\n\nOther than that, LGTM. What is wrong with the patchbot?",
    "created_at": "2021-08-23T20:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450298",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:20'></a>Is there a specific reason for this change?

```diff
@@ -98,12 +98,12 @@ class DegenerateManifold(DifferentiableManifold):
     - [DB1996]_
     - [DS2010]_
     """
-    def __init__(self, n, name, metric_name='g', signature=None, base_manifold=None,
-                 diff_degree=infinity, latex_name=None,
+    def __init__(self, n, name, metric_name=None, signature=None,
+                 base_manifold=None, diff_degree=infinity, latex_name=None,
                  metric_latex_name=None, start_index=0, category=None,
                  unique_tag=None):
         r"""
-        Construct a pseudo-Riemannian manifold.
+        Construct a degenerate manifold.
 
         TESTS::
 
@@ -130,7 +130,9 @@ class DegenerateManifold(DifferentiableManifold):
                                         category=category)
         self._metric = None # to be initialized by metric()
         self._metric_signature = signature
-        if not isinstance(metric_name, str):
+        if metric_name is None:
+            metric_name = 'g'
+        elif not isinstance(metric_name, str):
             raise TypeError("{} is not a string".format(metric_name))
         self._metric_name = metric_name
         if metric_latex_name is None:
```

Other than that, LGTM. What is wrong with the patchbot?



---

archive/issue_comments_450299.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 gh-mjungmath]:\n> Is there a specific reason for this change?\n> \n> \n> ```diff\n> -    def __init__(self, n, name, metric_name='g', signature=None, base_manifold=None,\n> -                 diff_degree=infinity, latex_name=None,\n> +    def __init__(self, n, name, metric_name=None, signature=None,\n> +                 base_manifold=None, diff_degree=infinity, latex_name=None,\n> ```\n\n\nThis is to normalize all the manifold `__init__`'s; this is mandory for constructing degenerate submanifolds, which inherit both from `DegenerateManifold` and `DifferentiableSubmanifold`.\n\n> {{{#!diff\n>          r\"\"\"\n> -        Construct a pseudo-Riemannian manifold.\n> +        Construct a degenerate manifold.\n> }}}\n\n\nThis corrects a (copy/paste) error in the docstring. \n\n> {{{#!diff\n> -        if not isinstance(metric_name, str):\n> +        if metric_name is None:\n> +            metric_name = 'g'\n> +        elif not isinstance(metric_name, str):\n>              raise TypeError(\"{} is not a string\".format(metric_name))\n>          self._metric_name = metric_name\n>          if metric_latex_name is None:\n> }}}\n\n\nThis restores `g` as the default metric name, after the `__init__` entry has been normalized with `metric_name=None`. \n\n> \n> Other than that, LGTM. What is wrong with the patchbot?\n\n\nI don't know. At least one of them gave a green light (the only plugin failure is `non_ascii`, but that plugin is no longer relevant and should be removed IMHO).",
    "created_at": "2021-08-24T08:22:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450299",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:21'></a>Replying to [comment:20 gh-mjungmath]:
> Is there a specific reason for this change?
> 
> 
> ```diff
> -    def __init__(self, n, name, metric_name='g', signature=None, base_manifold=None,
> -                 diff_degree=infinity, latex_name=None,
> +    def __init__(self, n, name, metric_name=None, signature=None,
> +                 base_manifold=None, diff_degree=infinity, latex_name=None,
> ```


This is to normalize all the manifold `__init__`'s; this is mandory for constructing degenerate submanifolds, which inherit both from `DegenerateManifold` and `DifferentiableSubmanifold`.

> {{{#!diff
>          r"""
> -        Construct a pseudo-Riemannian manifold.
> +        Construct a degenerate manifold.
> }}}


This corrects a (copy/paste) error in the docstring. 

> {{{#!diff
> -        if not isinstance(metric_name, str):
> +        if metric_name is None:
> +            metric_name = 'g'
> +        elif not isinstance(metric_name, str):
>              raise TypeError("{} is not a string".format(metric_name))
>          self._metric_name = metric_name
>          if metric_latex_name is None:
> }}}


This restores `g` as the default metric name, after the `__init__` entry has been normalized with `metric_name=None`. 

> 
> Other than that, LGTM. What is wrong with the patchbot?


I don't know. At least one of them gave a green light (the only plugin failure is `non_ascii`, but that plugin is no longer relevant and should be removed IMHO).



---

archive/issue_comments_450300.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-24T17:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450300",
    "user": "https://github.com/mjungmath"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_450301.json:
```json
{
    "body": "<a id='comment:22'></a>Alright.",
    "created_at": "2021-08-24T17:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450301",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:22'></a>Alright.



---

archive/issue_comments_450302.json:
```json
{
    "body": "<a id='comment:23'></a>Thank you for the explanation.",
    "created_at": "2021-08-24T17:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450302",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:23'></a>Thank you for the explanation.



---

archive/issue_comments_450303.json:
```json
{
    "body": "<a id='comment:24'></a>Thank you for the review!",
    "created_at": "2021-08-24T21:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450303",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:24'></a>Thank you for the review!



---

archive/issue_events_083896.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-08-31T22:00:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31781#event-83896"
}
```



---

archive/issue_comments_450304.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-08-31T22:00:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31781#issuecomment-450304",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
