# Issue 31781: Improve handling of metrics on pseudo-Riemannian submanifolds

archive/issues_031544.json:
```json
{
    "assignees": [],
    "body": "In Sage 9.3.rc5, we have\n\n```\nsage: S2 = manifolds.Sphere(2)                                      \nsage: g = S2.metric()\nsage: g                                    \nRiemannian metric g on the 2-sphere S^2 of radius 1 smoothly embedded \n in the Euclidean space E^3\n```\nSo far so good, but then\n\n```\nsage: g.display()\n...\nValueError: no basis could be found for computing the components\n in the Coordinate frame (A, (d/dtheta,d/dphi))\n```\n\n```\nsage: g.ricci_scalar()\n...\nValueError: no basis could be found for computing the components\n in the Coordinate frame (A, (d/dtheta,d/dphi))\n```\n\nCC:  @mjungmath\n\nBranch/Commit: **[dc15aff](https://github.com/sagemath/sagetrac-mirror/commit/dc15aff72221572912f47c0ac12f6325ee4da3a7)**\n\nReviewer: **Michael Jung**\n\nAuthor: **Eric Gourgoulhon**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31781_\n\n",
    "closed_at": "2021-08-31T22:00:52Z",
    "created_at": "2021-05-05T15:53:01Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20manifolds",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Improve handling of metrics on pseudo-Riemannian submanifolds",
    "type": "issue",
    "updated_at": "2021-08-31T22:00:52Z",
    "url": "https://github.com/sagemath/sage/issues/31781",
    "user": "https://github.com/egourgoulhon"
}
```
In Sage 9.3.rc5, we have

```
sage: S2 = manifolds.Sphere(2)                                      
sage: g = S2.metric()
sage: g                                    
Riemannian metric g on the 2-sphere S^2 of radius 1 smoothly embedded 
 in the Euclidean space E^3
```
So far so good, but then

```
sage: g.display()
...
ValueError: no basis could be found for computing the components
 in the Coordinate frame (A, (d/dtheta,d/dphi))
```

```
sage: g.ricci_scalar()
...
ValueError: no basis could be found for computing the components
 in the Coordinate frame (A, (d/dtheta,d/dphi))
```

CC:  @mjungmath

Branch/Commit: **[dc15aff](https://github.com/sagemath/sagetrac-mirror/commit/dc15aff72221572912f47c0ac12f6325ee4da3a7)**

Reviewer: **Michael Jung**

Author: **Eric Gourgoulhon**

_Issue created by migration from https://trac.sagemath.org/ticket/31781_





---

archive/issue_events_420065.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2021-05-05T15:53:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31781#event-420065"
}
```



---

archive/issue_events_420066.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2021-05-05T15:53:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20manifolds",
    "label_color": "0000ff",
    "label_name": "component: manifolds",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31781#event-420066"
}
```



---

archive/issue_events_420067.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2021-05-05T15:53:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31781#event-420067"
}
```



---

archive/issue_events_420068.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2021-05-05T15:53:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31781#event-420068"
}
```



---

archive/issue_comments_514087.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nActually, it appears that `g` is not initialized:\n\n```\nsage: S2 = manifolds.Sphere(2)                                             \nsage: g = S2.metric()                                                        \nsage: g._restrictions                                           \n{}\n```",
    "created_at": "2021-05-05T16:03:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514087",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:1" align="right">Comment 1</div>

Actually, it appears that `g` is not initialized:

```
sage: S2 = manifolds.Sphere(2)                                             
sage: g = S2.metric()                                                        
sage: g._restrictions                                           
{}
```



---

archive/issue_comments_514088.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nSince spheres are implemented as embedded manifolds, they are only endowed with the induced metric from the ambient space.\n\nThus I'd say this is no bug. In particular it could happen that the user wants to endow spheres with metrics different from the induced one.\n\nI'd say we just mention this in the documentation.",
    "created_at": "2021-05-05T17:04:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514088",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:2" align="right">Comment 2</div>

Since spheres are implemented as embedded manifolds, they are only endowed with the induced metric from the ambient space.

Thus I'd say this is no bug. In particular it could happen that the user wants to endow spheres with metrics different from the induced one.

I'd say we just mention this in the documentation.



---

archive/issue_comments_514089.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nWait. We implemented spheres as Riemannian submanifolds which means that `S2.metric()` should certainly give the induced metric.\n\nBut then this is more a bug of `PseudoRiemannianSubmanifold` where `metric()` is not delegating to `induced_metric()`.",
    "created_at": "2021-05-05T17:08:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514089",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:3" align="right">Comment 3</div>

Wait. We implemented spheres as Riemannian submanifolds which means that `S2.metric()` should certainly give the induced metric.

But then this is more a bug of `PseudoRiemannianSubmanifold` where `metric()` is not delegating to `induced_metric()`.



---

archive/issue_comments_514090.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nAs for my first comment, perhaps it is a good idea to add an optional argument such as `induced_metric=True` or `riemannian=True` for spheres to choose whether the submanifold should inherit the metric or not.",
    "created_at": "2021-05-05T17:12:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514090",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:4" align="right">Comment 4</div>

As for my first comment, perhaps it is a good idea to add an optional argument such as `induced_metric=True` or `riemannian=True` for spheres to choose whether the submanifold should inherit the metric or not.



---

archive/issue_comments_514091.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nReplying to [@mjungmath](#comment%3A3):\n> Wait. We implemented spheres as Riemannian submanifolds which means that `S2.metric()` should certainly give the induced metric.\n\nYes!\n\n> \n> But then this is more a bug of `PseudoRiemannianSubmanifold` where `metric()` is not delegating to `induced_metric()`.\n\nIndeed!",
    "created_at": "2021-05-05T17:31:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514091",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:5" align="right">Comment 5</div>

Replying to [@mjungmath](#comment%3A3):
> Wait. We implemented spheres as Riemannian submanifolds which means that `S2.metric()` should certainly give the induced metric.

Yes!

> 
> But then this is more a bug of `PseudoRiemannianSubmanifold` where `metric()` is not delegating to `induced_metric()`.

Indeed!



---

archive/issue_comments_514092.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nReplying to [@mjungmath](#comment%3A4):\n> As for my first comment, perhaps it is a good idea to add an optional argument such as `induced_metric=True` or `riemannian=True` for spheres to choose whether the submanifold should inherit the metric or not.\n\nYes, I would vote for `riemannian=True`, such that if the user chooses `riemannian=False`, she/he ends up with a pure differentiable manifold, without any predefined metric. Similarly, we could have `differentiable=True`, so that choosing `differentiable=False` returns a mere topological manifold.",
    "created_at": "2021-05-05T17:38:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514092",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:6" align="right">Comment 6</div>

Replying to [@mjungmath](#comment%3A4):
> As for my first comment, perhaps it is a good idea to add an optional argument such as `induced_metric=True` or `riemannian=True` for spheres to choose whether the submanifold should inherit the metric or not.

Yes, I would vote for `riemannian=True`, such that if the user chooses `riemannian=False`, she/he ends up with a pure differentiable manifold, without any predefined metric. Similarly, we could have `differentiable=True`, so that choosing `differentiable=False` returns a mere topological manifold.



---

archive/issue_comments_514093.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nReplying to [@egourgoulhon](#comment%3A6):\n> Replying to [@mjungmath](#comment%3A4):\n> > As for my first comment, perhaps it is a good idea to add an optional argument such as `induced_metric=True` or `riemannian=True` for spheres to choose whether the submanifold should inherit the metric or not.\n\n> \n> Yes, I would vote for `riemannian=True`, such that if the user chooses `riemannian=False`, she/he ends up with a pure differentiable manifold, without any predefined metric. Similarly, we could have `differentiable=True`, so that choosing `differentiable=False` returns a mere topological manifold.  \n\nOn a second thought, #31241 might be a better solution for that.",
    "created_at": "2021-05-05T17:45:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514093",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:7" align="right">Comment 7</div>

Replying to [@egourgoulhon](#comment%3A6):
> Replying to [@mjungmath](#comment%3A4):
> > As for my first comment, perhaps it is a good idea to add an optional argument such as `induced_metric=True` or `riemannian=True` for spheres to choose whether the submanifold should inherit the metric or not.

> 
> Yes, I would vote for `riemannian=True`, such that if the user chooses `riemannian=False`, she/he ends up with a pure differentiable manifold, without any predefined metric. Similarly, we could have `differentiable=True`, so that choosing `differentiable=False` returns a mere topological manifold.  

On a second thought, #31241 might be a better solution for that.



---

archive/issue_comments_514094.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nMoving to 9.4, as 9.3 has been released.",
    "created_at": "2021-05-10T17:42:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514094",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">Comment 8</div>

Moving to 9.4, as 9.3 has been released.



---

archive/issue_events_420069.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31781#event-420069"
}
```



---

archive/issue_events_420070.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31781#event-420070"
}
```



---

archive/issue_comments_514095.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\n(see [comment:11](#comment%3A11) below)",
    "created_at": "2021-08-14T13:03:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514095",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:9" align="right">Comment 9</div>

(see [comment:11](#comment%3A11) below)



---

archive/issue_comments_514096.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nShould we instead attack the issue with `PseudoRiemannianSubmanifold` and it's `metric()` call?",
    "created_at": "2021-08-14T13:04:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514096",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:10" align="right">Comment 10</div>

Should we instead attack the issue with `PseudoRiemannianSubmanifold` and it's `metric()` call?



---

archive/issue_comments_514097.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nReplying to [@mjungmath](#comment%3A9):\n> I think we should implement this flag. Ticket #31241 just gives a more natural way to implement this. But I am afraid this ticket is not nearly ready. So I would be fine having a tentative implementation to make the above syntax more convenient for the end-user.\n\nThis issue is by the way not restricted to spheres. Also Pseudo-Riemannian manifolds can have different metrics. The current implementation even accommodates this. From that perspective, despite what I said earlier, I actually don't see the need for such a flag because this is in full line with the current way of using Pseudo-Riemannian manifolds.\n\nAt this point it might also worth to mention that differentiable manifolds with imposed metrics are not seen as Pseudo-Riemannian manifolds. We don't even have a category for Pseudo-Riemannian manifolds.",
    "created_at": "2021-08-14T13:28:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514097",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:11" align="right">Comment 11</div>

Replying to [@mjungmath](#comment%3A9):
> I think we should implement this flag. Ticket #31241 just gives a more natural way to implement this. But I am afraid this ticket is not nearly ready. So I would be fine having a tentative implementation to make the above syntax more convenient for the end-user.

This issue is by the way not restricted to spheres. Also Pseudo-Riemannian manifolds can have different metrics. The current implementation even accommodates this. From that perspective, despite what I said earlier, I actually don't see the need for such a flag because this is in full line with the current way of using Pseudo-Riemannian manifolds.

At this point it might also worth to mention that differentiable manifolds with imposed metrics are not seen as Pseudo-Riemannian manifolds. We don't even have a category for Pseudo-Riemannian manifolds.



---

archive/issue_comments_514098.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nReplying to [@mjungmath](#comment%3A10):\n> Should we instead attack the issue with `PseudoRiemannianSubmanifold` and it's `metric()` call?\n\nYes I think so (see [comment:13](#comment%3A13) below).",
    "created_at": "2021-08-14T14:54:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514098",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:12" align="right">Comment 12</div>

Replying to [@mjungmath](#comment%3A10):
> Should we instead attack the issue with `PseudoRiemannianSubmanifold` and it's `metric()` call?

Yes I think so (see [comment:13](#comment%3A13) below).



---

archive/issue_comments_514099.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nReplying to [@mjungmath](#comment%3A11):\n> This issue is by the way not restricted to spheres. Also Pseudo-Riemannian manifolds can have different metrics. The current implementation even accommodates this. From that perspective, despite what I said earlier, I actually don't see the need for such a flag because this is in full line with the current way of using Pseudo-Riemannian manifolds.\n> \n\nIn the current implementation, on any `PseudoRiemannianManifold`, \n- `metric()` returns the default metric\n- `metric('h')` initializes a new metric with name `h`\n\nTo be consistent, on a `PseudoRiemannianSubmanifold`, we should have the following behavior:\n- `metric()` redirects to `induced_metric()`, since this is clearly the default metric on a pseudo-Riemannian submanifold\n- `metric('h')` initializes a new metric with name `h`\n\nTo acheive this, we should redefine `metric()` in the subclass `PseudoRiemannianSubmanifold`.",
    "created_at": "2021-08-14T15:05:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514099",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:13" align="right">Comment 13</div>

Replying to [@mjungmath](#comment%3A11):
> This issue is by the way not restricted to spheres. Also Pseudo-Riemannian manifolds can have different metrics. The current implementation even accommodates this. From that perspective, despite what I said earlier, I actually don't see the need for such a flag because this is in full line with the current way of using Pseudo-Riemannian manifolds.
> 

In the current implementation, on any `PseudoRiemannianManifold`, 
- `metric()` returns the default metric
- `metric('h')` initializes a new metric with name `h`

To be consistent, on a `PseudoRiemannianSubmanifold`, we should have the following behavior:
- `metric()` redirects to `induced_metric()`, since this is clearly the default metric on a pseudo-Riemannian submanifold
- `metric('h')` initializes a new metric with name `h`

To acheive this, we should redefine `metric()` in the subclass `PseudoRiemannianSubmanifold`.



---

archive/issue_comments_514100.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nReplying to [@egourgoulhon](#comment%3A13):\n> Replying to [@mjungmath](#comment%3A11):\n> > This issue is by the way not restricted to spheres. Also Pseudo-Riemannian manifolds can have different metrics. The current implementation even accommodates this. From that perspective, despite what I said earlier, I actually don't see the need for such a flag because this is in full line with the current way of using Pseudo-Riemannian manifolds.\n> > \n\n> In the current implementation, on any `PseudoRiemannianManifold`, \n> - `metric()` returns the default metric\n> - `metric('h')` initializes a new metric with name `h`\n> \n> To be consistent, on a `PseudoRiemannianSubmanifold`, we should have the following behavior:\n> - `metric()` redirects to `induced_metric()`, since this is clearly the default metric on a pseudo-Riemannian submanifold\n> - `metric('h')` initializes a new metric with name `h`\n> \n> To acheive this, we should redefine `metric()` in the subclass `PseudoRiemannianSubmanifold`.\n\nMy thought exactly!",
    "created_at": "2021-08-14T15:07:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514100",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:14" align="right">Comment 14</div>

Replying to [@egourgoulhon](#comment%3A13):
> Replying to [@mjungmath](#comment%3A11):
> > This issue is by the way not restricted to spheres. Also Pseudo-Riemannian manifolds can have different metrics. The current implementation even accommodates this. From that perspective, despite what I said earlier, I actually don't see the need for such a flag because this is in full line with the current way of using Pseudo-Riemannian manifolds.
> > 

> In the current implementation, on any `PseudoRiemannianManifold`, 
> - `metric()` returns the default metric
> - `metric('h')` initializes a new metric with name `h`
> 
> To be consistent, on a `PseudoRiemannianSubmanifold`, we should have the following behavior:
> - `metric()` redirects to `induced_metric()`, since this is clearly the default metric on a pseudo-Riemannian submanifold
> - `metric('h')` initializes a new metric with name `h`
> 
> To acheive this, we should redefine `metric()` in the subclass `PseudoRiemannianSubmanifold`.

My thought exactly!



---

archive/issue_comments_514101.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nReplying to [@mjungmath](#comment%3A14):\n> \n> My thought exactly!\n\nVery good. Do you plan to implement this?",
    "created_at": "2021-08-14T15:37:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514101",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:15" align="right">Comment 15</div>

Replying to [@mjungmath](#comment%3A14):
> 
> My thought exactly!

Very good. Do you plan to implement this?



---

archive/issue_comments_514102.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nReplying to [@egourgoulhon](#comment%3A15):\n> > My thought exactly!\n\n> Very good. Do you plan to implement this?\n\nI'd prefer to first work on tickets that are needed for my current project. Time is slipping through. As soon as those are done, I could come back to this one.",
    "created_at": "2021-08-14T16:25:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514102",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:16" align="right">Comment 16</div>

Replying to [@egourgoulhon](#comment%3A15):
> > My thought exactly!

> Very good. Do you plan to implement this?

I'd prefer to first work on tickets that are needed for my current project. Time is slipping through. As soon as those are done, I could come back to this one.



---

archive/issue_comments_514103.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nReplying to [@mjungmath](#comment%3A16):\n> \n> I'd prefer to first work on tickets that are needed for my current project. Time is slipping through. As soon as those are done, I could come back to this one.\n\nNo problem, I'll implement it soon.",
    "created_at": "2021-08-14T18:15:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514103",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:17" align="right">Comment 17</div>

Replying to [@mjungmath](#comment%3A16):
> 
> I'd prefer to first work on tickets that are needed for my current project. Time is slipping through. As soon as those are done, I could come back to this one.

No problem, I'll implement it soon.



---

archive/issue_events_420071.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2021-08-16T16:17:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31781#event-420071"
}
```



---

archive/issue_comments_514104.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nAccording to the discussion in [comment:13](#comment%3A13) and [comment:14](#comment%3A14), the above branch reimplements the method `metric` in the subclass `PseudoRiemannianSubmanifold` of `PseudoRiemannianManifold`. In preparing it, I've realized that the handling of the metric names was somewhat messy and I've reorganized it. I've also made the default name of the metric of spheres in the manifold catalog to be `g` instead of `gamma`, which is more natural, I think. \n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc15aff72221572912f47c0ac12f6325ee4da3a7\">dc15aff</a></td><td><code>Implement PseudoRiemannianSubmanifold.metric() and various related improvements (Trac #31781)</code></td></tr></table>\n",
    "created_at": "2021-08-16T16:17:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514104",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:18" align="right">Comment 18</div>

According to the discussion in [comment:13](#comment%3A13) and [comment:14](#comment%3A14), the above branch reimplements the method `metric` in the subclass `PseudoRiemannianSubmanifold` of `PseudoRiemannianManifold`. In preparing it, I've realized that the handling of the metric names was somewhat messy and I've reorganized it. I've also made the default name of the metric of spheres in the manifold catalog to be `g` instead of `gamma`, which is more natural, I think. 

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc15aff72221572912f47c0ac12f6325ee4da3a7">dc15aff</a></td><td><code>Implement PseudoRiemannianSubmanifold.metric() and various related improvements (Trac #31781)</code></td></tr></table>




---

archive/issue_comments_514105.json:
```json
{
    "body": "Branch: **[public/manifolds/submanifold_metric-31781](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/submanifold_metric-31781)**",
    "created_at": "2021-08-16T16:17:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514105",
    "user": "https://github.com/egourgoulhon"
}
```

Branch: **[public/manifolds/submanifold_metric-31781](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/submanifold_metric-31781)**



---

archive/issue_comments_514106.json:
```json
{
    "body": "Commit: **[dc15aff](https://github.com/sagemath/sagetrac-mirror/commit/dc15aff72221572912f47c0ac12f6325ee4da3a7)**",
    "created_at": "2021-08-16T16:17:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514106",
    "user": "https://github.com/egourgoulhon"
}
```

Commit: **[dc15aff](https://github.com/sagemath/sagetrac-mirror/commit/dc15aff72221572912f47c0ac12f6325ee4da3a7)**



---

archive/issue_events_420072.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2021-08-16T16:17:16Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "title_is": "Improve handling of metrics on pseudo-Riemannian submanifolds",
    "title_was": "Unusable metric on spheres from the manifold catalog",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31781#event-420072"
}
```



---

archive/issue_comments_514107.json:
```json
{
    "body": "Author: **Eric Gourgoulhon**",
    "created_at": "2021-08-16T16:17:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514107",
    "user": "https://github.com/egourgoulhon"
}
```

Author: **Eric Gourgoulhon**



---

archive/issue_events_420073.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31781#event-420073"
}
```



---

archive/issue_events_420074.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31781#event-420074"
}
```



---

archive/issue_comments_514108.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nIs there a specific reason for this change?\n\n```diff\n@@ -98,12 +98,12 @@ class DegenerateManifold(DifferentiableManifold):\n     - [DB1996]_\n     - [DS2010]_\n     \"\"\"\n-    def __init__(self, n, name, metric_name='g', signature=None, base_manifold=None,\n-                 diff_degree=infinity, latex_name=None,\n+    def __init__(self, n, name, metric_name=None, signature=None,\n+                 base_manifold=None, diff_degree=infinity, latex_name=None,\n                  metric_latex_name=None, start_index=0, category=None,\n                  unique_tag=None):\n         r\"\"\"\n-        Construct a pseudo-Riemannian manifold.\n+        Construct a degenerate manifold.\n \n         TESTS::\n \n@@ -130,7 +130,9 @@ class DegenerateManifold(DifferentiableManifold):\n                                         category=category)\n         self._metric = None # to be initialized by metric()\n         self._metric_signature = signature\n-        if not isinstance(metric_name, str):\n+        if metric_name is None:\n+            metric_name = 'g'\n+        elif not isinstance(metric_name, str):\n             raise TypeError(\"{} is not a string\".format(metric_name))\n         self._metric_name = metric_name\n         if metric_latex_name is None:\n```\n\nOther than that, LGTM. What is wrong with the patchbot?",
    "created_at": "2021-08-23T20:20:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514108",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:20" align="right">Comment 20</div>

Is there a specific reason for this change?

```diff
@@ -98,12 +98,12 @@ class DegenerateManifold(DifferentiableManifold):
     - [DB1996]_
     - [DS2010]_
     """
-    def __init__(self, n, name, metric_name='g', signature=None, base_manifold=None,
-                 diff_degree=infinity, latex_name=None,
+    def __init__(self, n, name, metric_name=None, signature=None,
+                 base_manifold=None, diff_degree=infinity, latex_name=None,
                  metric_latex_name=None, start_index=0, category=None,
                  unique_tag=None):
         r"""
-        Construct a pseudo-Riemannian manifold.
+        Construct a degenerate manifold.
 
         TESTS::
 
@@ -130,7 +130,9 @@ class DegenerateManifold(DifferentiableManifold):
                                         category=category)
         self._metric = None # to be initialized by metric()
         self._metric_signature = signature
-        if not isinstance(metric_name, str):
+        if metric_name is None:
+            metric_name = 'g'
+        elif not isinstance(metric_name, str):
             raise TypeError("{} is not a string".format(metric_name))
         self._metric_name = metric_name
         if metric_latex_name is None:
```

Other than that, LGTM. What is wrong with the patchbot?



---

archive/issue_comments_514109.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nReplying to [@mjungmath](#comment%3A20):\n> Is there a specific reason for this change?\n> \n> ```diff\n> -    def __init__(self, n, name, metric_name='g', signature=None, base_manifold=None,\n> -                 diff_degree=infinity, latex_name=None,\n> +    def __init__(self, n, name, metric_name=None, signature=None,\n> +                 base_manifold=None, diff_degree=infinity, latex_name=None,\n> ```\n\nThis is to normalize all the manifold `__init__`'s; this is mandory for constructing degenerate submanifolds, which inherit both from `DegenerateManifold` and `DifferentiableSubmanifold`.\n\n> ```diff\n>          r\"\"\"\n> -        Construct a pseudo-Riemannian manifold.\n> +        Construct a degenerate manifold.\n> ```\n\nThis corrects a (copy/paste) error in the docstring. \n\n> ```diff\n> -        if not isinstance(metric_name, str):\n> +        if metric_name is None:\n> +            metric_name = 'g'\n> +        elif not isinstance(metric_name, str):\n>              raise TypeError(\"{} is not a string\".format(metric_name))\n>          self._metric_name = metric_name\n>          if metric_latex_name is None:\n> ```\n\nThis restores `g` as the default metric name, after the `__init__` entry has been normalized with `metric_name=None`. \n\n> \n> Other than that, LGTM. What is wrong with the patchbot?\n\nI don't know. At least one of them gave a green light (the only plugin failure is `non_ascii`, but that plugin is no longer relevant and should be removed IMHO).",
    "created_at": "2021-08-24T08:22:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514109",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:21" align="right">Comment 21</div>

Replying to [@mjungmath](#comment%3A20):
> Is there a specific reason for this change?
> 
> ```diff
> -    def __init__(self, n, name, metric_name='g', signature=None, base_manifold=None,
> -                 diff_degree=infinity, latex_name=None,
> +    def __init__(self, n, name, metric_name=None, signature=None,
> +                 base_manifold=None, diff_degree=infinity, latex_name=None,
> ```

This is to normalize all the manifold `__init__`'s; this is mandory for constructing degenerate submanifolds, which inherit both from `DegenerateManifold` and `DifferentiableSubmanifold`.

> ```diff
>          r"""
> -        Construct a pseudo-Riemannian manifold.
> +        Construct a degenerate manifold.
> ```

This corrects a (copy/paste) error in the docstring. 

> ```diff
> -        if not isinstance(metric_name, str):
> +        if metric_name is None:
> +            metric_name = 'g'
> +        elif not isinstance(metric_name, str):
>              raise TypeError("{} is not a string".format(metric_name))
>          self._metric_name = metric_name
>          if metric_latex_name is None:
> ```

This restores `g` as the default metric name, after the `__init__` entry has been normalized with `metric_name=None`. 

> 
> Other than that, LGTM. What is wrong with the patchbot?

I don't know. At least one of them gave a green light (the only plugin failure is `non_ascii`, but that plugin is no longer relevant and should be removed IMHO).



---

archive/issue_events_420075.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2021-08-24T17:43:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31781#event-420075"
}
```



---

archive/issue_events_420076.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2021-08-24T17:43:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31781#event-420076"
}
```



---

archive/issue_comments_514110.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nAlright.",
    "created_at": "2021-08-24T17:43:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514110",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:22" align="right">Comment 22</div>

Alright.



---

archive/issue_comments_514111.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nThank you for the explanation.",
    "created_at": "2021-08-24T17:43:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514111",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:23" align="right">Comment 23</div>

Thank you for the explanation.



---

archive/issue_comments_514112.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nThank you for the review!",
    "created_at": "2021-08-24T21:46:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514112",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:24" align="right">Comment 24</div>

Thank you for the review!



---

archive/issue_comments_514113.json:
```json
{
    "body": "Reviewer: **Michael Jung**",
    "created_at": "2021-08-24T21:46:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514113",
    "user": "https://github.com/egourgoulhon"
}
```

Reviewer: **Michael Jung**



---

archive/issue_events_420077.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-08-31T22:00:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31781#event-420077"
}
```



---

archive/issue_events_420078.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "8baa680eafd99200e5fd2f06f3c3b6a9a87ea0c3",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-08-31T22:00:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31781#event-420078"
}
```



---

archive/issue_comments_514114.json:
```json
{
    "body": "Changed branch from **[public/manifolds/submanifold_metric-31781](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/submanifold_metric-31781)** to **[dc15aff](https://github.com/sagemath/sagetrac-mirror/commit/dc15aff72221572912f47c0ac12f6325ee4da3a7)**",
    "created_at": "2021-08-31T22:00:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31781#issuecomment-514114",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/manifolds/submanifold_metric-31781](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/submanifold_metric-31781)** to **[dc15aff](https://github.com/sagemath/sagetrac-mirror/commit/dc15aff72221572912f47c0ac12f6325ee4da3a7)**
