# Issue 31760: Speedup WordMorphism.growing_letters

archive/issues_031523.json:
```json
{
    "assignees": [],
    "body": "This patch changes the implementation of WordMorphism.growing_letters to be less sophisticated but faster.\n\n```\nsage: m = WordMorphism('a->aa,b->bc,c->def,d->fe,e->df,f->gh,g->hh,h->')\nsage: %timeit m.growing_letters()\n24.7 \u00b5s \u00b1 74.3 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n```\nvs.\n\n```\nsage: %timeit m.growing_letters()\n7.89 ms \u00b1 84 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n```\nIt also adds a method for returning \"immortal\" letters (letter a is mortal for a morphism s if there exists an integer k>0 such that s<sup>k</sup>(a) = \u03b5).\n\n**Keywords:** words\n\n**Branch/Commit:** [35f617b7204db754e702356c7f5901df8797fa69](https://github.com/sagemath/sagetrac-mirror/commit/35f617b7204db754e702356c7f5901df8797fa69)\n\n**Reviewer:** Vincent Delecroix, Travis Scrimshaw\n\n**Author:** Martin Rejmon\n\nIssue created by migration from https://trac.sagemath.org/ticket/31760\n\n",
    "closed_at": "2021-06-19T20:57:52Z",
    "created_at": "2021-05-01T11:41:59Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Speedup WordMorphism.growing_letters",
    "type": "issue",
    "updated_at": "2021-06-19T20:57:52Z",
    "url": "https://github.com/sagemath/sage/issues/31760",
    "user": "https://github.com/mrejmon"
}
```
This patch changes the implementation of WordMorphism.growing_letters to be less sophisticated but faster.

```
sage: m = WordMorphism('a->aa,b->bc,c->def,d->fe,e->df,f->gh,g->hh,h->')
sage: %timeit m.growing_letters()
24.7 µs ± 74.3 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
```
vs.

```
sage: %timeit m.growing_letters()
7.89 ms ± 84 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
```
It also adds a method for returning "immortal" letters (letter a is mortal for a morphism s if there exists an integer k>0 such that s<sup>k</sup>(a) = ε).

**Keywords:** words

**Branch/Commit:** [35f617b7204db754e702356c7f5901df8797fa69](https://github.com/sagemath/sagetrac-mirror/commit/35f617b7204db754e702356c7f5901df8797fa69)

**Reviewer:** Vincent Delecroix, Travis Scrimshaw

**Author:** Martin Rejmon

Issue created by migration from https://trac.sagemath.org/ticket/31760





---

archive/issue_events_385569.json:
```json
{
    "actor": "https://github.com/mrejmon",
    "created_at": "2021-05-01T11:41:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31760#event-385569"
}
```



---

archive/issue_events_385570.json:
```json
{
    "actor": "https://github.com/mrejmon",
    "created_at": "2021-05-01T11:41:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
    "label_color": "08517b",
    "label_name": "component: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31760#event-385570"
}
```



---

archive/issue_events_385571.json:
```json
{
    "actor": "https://github.com/mrejmon",
    "created_at": "2021-05-01T11:41:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31760#event-385571"
}
```



---

archive/issue_events_385572.json:
```json
{
    "actor": "https://github.com/mrejmon",
    "created_at": "2021-05-01T11:43:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31760#event-385572"
}
```



---

archive/issue_comments_513595.json:
```json
{
    "body": "<a id='comment:2'></a>\nYou are not allowed to mutate self in\n\n```\n+        self._morph, new_morph = new_morph, self._morph\n+        result = self.immortal_letters()\n+        self._morph = new_morph\n```\nThe code might be interrupted during the second line (an alaram, a keyboard interrupt, etc). In such situation you would end up with corrupted data.",
    "created_at": "2021-05-01T19:07:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513595",
    "user": "https://github.com/videlec"
}
```

<a id='comment:2'></a>
You are not allowed to mutate self in

```
+        self._morph, new_morph = new_morph, self._morph
+        result = self.immortal_letters()
+        self._morph = new_morph
```
The code might be interrupted during the second line (an alaram, a keyboard interrupt, etc). In such situation you would end up with corrupted data.



---

archive/issue_comments_513596.json:
```json
{
    "body": "**Reviewer:** Vincent Delecroix",
    "created_at": "2021-05-01T19:16:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513596",
    "user": "https://github.com/videlec"
}
```

**Reviewer:** Vincent Delecroix



---

archive/issue_comments_513597.json:
```json
{
    "body": "**Changing commit** from \"[bbf59a23ae600c8b1e834320d606b5d8c3ded66e](https://github.com/sagemath/sagetrac-mirror/commit/bbf59a23ae600c8b1e834320d606b5d8c3ded66e)\" to \"[bd67035c3230c6ae7e6ee9bc641f938075c82199](https://github.com/sagemath/sagetrac-mirror/commit/bd67035c3230c6ae7e6ee9bc641f938075c82199)\".",
    "created_at": "2021-05-02T10:32:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513597",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[bbf59a23ae600c8b1e834320d606b5d8c3ded66e](https://github.com/sagemath/sagetrac-mirror/commit/bbf59a23ae600c8b1e834320d606b5d8c3ded66e)" to "[bd67035c3230c6ae7e6ee9bc641f938075c82199](https://github.com/sagemath/sagetrac-mirror/commit/bd67035c3230c6ae7e6ee9bc641f938075c82199)".



---

archive/issue_comments_513598.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd67035c3230c6ae7e6ee9bc641f938075c82199\">bd67035</a></td><td><code>31760: Don't modify self</code></td></tr></table>\n",
    "created_at": "2021-05-02T10:32:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513598",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd67035c3230c6ae7e6ee9bc641f938075c82199">bd67035</a></td><td><code>31760: Don't modify self</code></td></tr></table>




---

archive/issue_comments_513599.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [@videlec](#comment%3A2):\n> You are not allowed to mutate self in\n> \n> ```\n> +        self._morph, new_morph = new_morph, self._morph\n> +        result = self.immortal_letters()\n> +        self._morph = new_morph\n> ```\n> The code might be interrupted during the second line (an alaram, a keyboard interrupt, etc). In such situation you would end up with corrupted data.\n\nFixed.",
    "created_at": "2021-05-02T10:33:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513599",
    "user": "https://github.com/mrejmon"
}
```

<a id='comment:5'></a>
Replying to [@videlec](#comment%3A2):
> You are not allowed to mutate self in
> 
> ```
> +        self._morph, new_morph = new_morph, self._morph
> +        result = self.immortal_letters()
> +        self._morph = new_morph
> ```
> The code might be interrupted during the second line (an alaram, a keyboard interrupt, etc). In such situation you would end up with corrupted data.

Fixed.



---

archive/issue_comments_513600.json:
```json
{
    "body": "**Changing reviewer** from \"Vincent Delecroix\" to \"Vincent Delecroix, Travis Scrimshaw\".",
    "created_at": "2021-05-05T06:02:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513600",
    "user": "https://github.com/tscrim"
}
```

**Changing reviewer** from "Vincent Delecroix" to "Vincent Delecroix, Travis Scrimshaw".



---

archive/issue_comments_513601.json:
```json
{
    "body": "**Changing commit** from \"[bd67035c3230c6ae7e6ee9bc641f938075c82199](https://github.com/sagemath/sagetrac-mirror/commit/bd67035c3230c6ae7e6ee9bc641f938075c82199)\" to \"[24f3bf96117bbeed8864977081094a9bfd641d53](https://github.com/sagemath/sagetrac-mirror/commit/24f3bf96117bbeed8864977081094a9bfd641d53)\".",
    "created_at": "2021-05-05T06:02:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513601",
    "user": "https://github.com/tscrim"
}
```

**Changing commit** from "[bd67035c3230c6ae7e6ee9bc641f938075c82199](https://github.com/sagemath/sagetrac-mirror/commit/bd67035c3230c6ae7e6ee9bc641f938075c82199)" to "[24f3bf96117bbeed8864977081094a9bfd641d53](https://github.com/sagemath/sagetrac-mirror/commit/24f3bf96117bbeed8864977081094a9bfd641d53)".



---

archive/issue_comments_513602.json:
```json
{
    "body": "**Changing branch** from \"[u/gh-mrejmon/speedup_growing](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mrejmon/speedup_growing)\" to \"[public/combinat/growing_letters_speedup-31760](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/growing_letters_speedup-31760)\".",
    "created_at": "2021-05-05T06:02:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513602",
    "user": "https://github.com/tscrim"
}
```

**Changing branch** from "[u/gh-mrejmon/speedup_growing](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mrejmon/speedup_growing)" to "[public/combinat/growing_letters_speedup-31760](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/growing_letters_speedup-31760)".



---

archive/issue_comments_513603.json:
```json
{
    "body": "<a id='comment:6'></a>\nI made a few trivial tweaks to the code to be a bit easier to read and follow our coding conventions. If my changes are good, then positive review unless Vincent has any more comments.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/61c4f42f17ea0dc64f65caccaa4893b06dcc8cbb\">61c4f42</a></td><td><code>Merge branch 'u/gh-mrejmon/speedup_growing' of git://trac.sagemath.org/sage into public/combinat/growing_letters_speedup-31760</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/24f3bf96117bbeed8864977081094a9bfd641d53\">24f3bf9</a></td><td><code>Small Python tweaks to immortal_letters().</code></td></tr></table>\n",
    "created_at": "2021-05-05T06:02:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513603",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>
I made a few trivial tweaks to the code to be a bit easier to read and follow our coding conventions. If my changes are good, then positive review unless Vincent has any more comments.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/61c4f42f17ea0dc64f65caccaa4893b06dcc8cbb">61c4f42</a></td><td><code>Merge branch 'u/gh-mrejmon/speedup_growing' of git://trac.sagemath.org/sage into public/combinat/growing_letters_speedup-31760</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/24f3bf96117bbeed8864977081094a9bfd641d53">24f3bf9</a></td><td><code>Small Python tweaks to immortal_letters().</code></td></tr></table>




---

archive/issue_comments_513604.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce00ad67f08e0e6a72957a9e4c578adfe9fa1390\">ce00ad6</a></td><td><code>improve growing letters, immortal letters</code></td></tr></table>\n",
    "created_at": "2021-05-05T07:28:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513604",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce00ad67f08e0e6a72957a9e4c578adfe9fa1390">ce00ad6</a></td><td><code>improve growing letters, immortal letters</code></td></tr></table>




---

archive/issue_comments_513605.json:
```json
{
    "body": "**Changing commit** from \"[24f3bf96117bbeed8864977081094a9bfd641d53](https://github.com/sagemath/sagetrac-mirror/commit/24f3bf96117bbeed8864977081094a9bfd641d53)\" to \"[ce00ad67f08e0e6a72957a9e4c578adfe9fa1390](https://github.com/sagemath/sagetrac-mirror/commit/ce00ad67f08e0e6a72957a9e4c578adfe9fa1390)\".",
    "created_at": "2021-05-05T07:28:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513605",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[24f3bf96117bbeed8864977081094a9bfd641d53](https://github.com/sagemath/sagetrac-mirror/commit/24f3bf96117bbeed8864977081094a9bfd641d53)" to "[ce00ad67f08e0e6a72957a9e4c578adfe9fa1390](https://github.com/sagemath/sagetrac-mirror/commit/ce00ad67f08e0e6a72957a9e4c578adfe9fa1390)".



---

archive/issue_comments_513606.json:
```json
{
    "body": "<a id='comment:8'></a>\nI hope my last commit simplifies a bit the code. The ticket can be set to positive review if nobody thinks otherwise.",
    "created_at": "2021-05-05T07:29:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513606",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>
I hope my last commit simplifies a bit the code. The ticket can be set to positive review if nobody thinks otherwise.



---

archive/issue_comments_513607.json:
```json
{
    "body": "**Changing commit** from \"[ce00ad67f08e0e6a72957a9e4c578adfe9fa1390](https://github.com/sagemath/sagetrac-mirror/commit/ce00ad67f08e0e6a72957a9e4c578adfe9fa1390)\" to \"[a6fa7c6325413de0e1f8a7dbeb90799378c9e9e4](https://github.com/sagemath/sagetrac-mirror/commit/a6fa7c6325413de0e1f8a7dbeb90799378c9e9e4)\".",
    "created_at": "2021-05-05T07:34:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513607",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[ce00ad67f08e0e6a72957a9e4c578adfe9fa1390](https://github.com/sagemath/sagetrac-mirror/commit/ce00ad67f08e0e6a72957a9e4c578adfe9fa1390)" to "[a6fa7c6325413de0e1f8a7dbeb90799378c9e9e4](https://github.com/sagemath/sagetrac-mirror/commit/a6fa7c6325413de0e1f8a7dbeb90799378c9e9e4)".



---

archive/issue_comments_513608.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a6fa7c6325413de0e1f8a7dbeb90799378c9e9e4\">a6fa7c6</a></td><td><code>do not build custom domain/codomain</code></td></tr></table>\n",
    "created_at": "2021-05-05T07:34:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513608",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a6fa7c6325413de0e1f8a7dbeb90799378c9e9e4">a6fa7c6</a></td><td><code>do not build custom domain/codomain</code></td></tr></table>




---

archive/issue_comments_513609.json:
```json
{
    "body": "<a id='comment:10'></a>\nIt is a pity that a6fa7c6 makes it faster in practice...",
    "created_at": "2021-05-05T07:35:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513609",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>
It is a pity that a6fa7c6 makes it faster in practice...



---

archive/issue_comments_513610.json:
```json
{
    "body": "**Changing commit** from \"[a6fa7c6325413de0e1f8a7dbeb90799378c9e9e4](https://github.com/sagemath/sagetrac-mirror/commit/a6fa7c6325413de0e1f8a7dbeb90799378c9e9e4)\" to \"[263890855e11b5bf43435e8bc24b3f0666f2b5fc](https://github.com/sagemath/sagetrac-mirror/commit/263890855e11b5bf43435e8bc24b3f0666f2b5fc)\".",
    "created_at": "2021-05-05T08:18:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513610",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[a6fa7c6325413de0e1f8a7dbeb90799378c9e9e4](https://github.com/sagemath/sagetrac-mirror/commit/a6fa7c6325413de0e1f8a7dbeb90799378c9e9e4)" to "[263890855e11b5bf43435e8bc24b3f0666f2b5fc](https://github.com/sagemath/sagetrac-mirror/commit/263890855e11b5bf43435e8bc24b3f0666f2b5fc)".



---

archive/issue_comments_513611.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/263890855e11b5bf43435e8bc24b3f0666f2b5fc\">2638908</a></td><td><code>31760: Add one set() call</code></td></tr></table>\n",
    "created_at": "2021-05-05T08:18:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513611",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/263890855e11b5bf43435e8bc24b3f0666f2b5fc">2638908</a></td><td><code>31760: Add one set() call</code></td></tr></table>




---

archive/issue_comments_513612.json:
```json
{
    "body": "<a id='comment:12'></a>\nThanks for improving the code, I did a last small change.",
    "created_at": "2021-05-05T08:21:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513612",
    "user": "https://github.com/mrejmon"
}
```

<a id='comment:12'></a>
Thanks for improving the code, I did a last small change.



---

archive/issue_comments_513613.json:
```json
{
    "body": "**Changing commit** from \"[263890855e11b5bf43435e8bc24b3f0666f2b5fc](https://github.com/sagemath/sagetrac-mirror/commit/263890855e11b5bf43435e8bc24b3f0666f2b5fc)\" to \"[5aab984e33a165b1a0e6b5a259c8b0c388bf2372](https://github.com/sagemath/sagetrac-mirror/commit/5aab984e33a165b1a0e6b5a259c8b0c388bf2372)\".",
    "created_at": "2021-05-05T09:09:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513613",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[263890855e11b5bf43435e8bc24b3f0666f2b5fc](https://github.com/sagemath/sagetrac-mirror/commit/263890855e11b5bf43435e8bc24b3f0666f2b5fc)" to "[5aab984e33a165b1a0e6b5a259c8b0c388bf2372](https://github.com/sagemath/sagetrac-mirror/commit/5aab984e33a165b1a0e6b5a259c8b0c388bf2372)".



---

archive/issue_comments_513614.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5aab984e33a165b1a0e6b5a259c8b0c388bf2372\">5aab984</a></td><td><code>31760: Replace set with list in docs</code></td></tr></table>\n",
    "created_at": "2021-05-05T09:09:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513614",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5aab984e33a165b1a0e6b5a259c8b0c388bf2372">5aab984</a></td><td><code>31760: Replace set with list in docs</code></td></tr></table>




---

archive/issue_comments_513615.json:
```json
{
    "body": "<a id='comment:14'></a>\nOn second thought, what do you think about replacing:\n\n```\nif not self.is_endomorphism():\n```\nwith something like:\n\n```\nif not set(self.codomain().alphabet()).issubset(self.domain().alphabet()):\n```\nso that one doesn't have to manually specify the codomain in cases like this:\n\n```\nWordMorphism('a->b,b->c,c->d,d->c', codomain=Words('abcd')).growing_letters()\n```",
    "created_at": "2021-05-05T17:08:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513615",
    "user": "https://github.com/mrejmon"
}
```

<a id='comment:14'></a>
On second thought, what do you think about replacing:

```
if not self.is_endomorphism():
```
with something like:

```
if not set(self.codomain().alphabet()).issubset(self.domain().alphabet()):
```
so that one doesn't have to manually specify the codomain in cases like this:

```
WordMorphism('a->b,b->c,c->d,d->c', codomain=Words('abcd')).growing_letters()
```



---

archive/issue_comments_513616.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [@mrejmon](#comment%3A14):\n> On second thought, what do you think about replacing:\n> \n> ```\n> if not self.is_endomorphism():\n> ```\n> with something like:\n> \n> ```\n> if not set(self.codomain().alphabet()).issubset(self.domain().alphabet()):\n> ```\n> so that one doesn't have to manually specify the codomain in cases like this:\n> \n> ```\n> WordMorphism('a->b,b->c,c->d,d->c', codomain=Words('abcd')).growing_letters()\n> ```\n\nIndeed. Is there a name for functions `f: A -> B` with `B` included in `A`?",
    "created_at": "2021-05-05T17:23:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513616",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'></a>
Replying to [@mrejmon](#comment%3A14):
> On second thought, what do you think about replacing:
> 
> ```
> if not self.is_endomorphism():
> ```
> with something like:
> 
> ```
> if not set(self.codomain().alphabet()).issubset(self.domain().alphabet()):
> ```
> so that one doesn't have to manually specify the codomain in cases like this:
> 
> ```
> WordMorphism('a->b,b->c,c->d,d->c', codomain=Words('abcd')).growing_letters()
> ```

Indeed. Is there a name for functions `f: A -> B` with `B` included in `A`?



---

archive/issue_comments_513617.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [@videlec](#comment%3A15):\n> Indeed. Is there a name for functions `f: A -> B` with `B` included in `A`?\n\nI would just call it an endomorphism as the only difference is a promise that the image is smaller than all of `A`.\n\nAlso, doctest failures from the patchbot:\n\n```\n**********************************************************************\nFile \"src/sage/combinat/words/morphism.py\", line 1981, in sage.combinat.words.morphism.WordMorphism.periodic_points\nFailed example:\n    for p in f.periodic_points():\n        print(\"{} , {}\".format(len(p), p[0]))\nExpected:\n    1 , ababaaababaaabaabaababaaababaaabaabaabab...\n    1 , baaabaabaababaaabaababaaabaababaaababaaa...\nGot:\n    1 , baaabaabaababaaabaababaaabaababaaababaaa...\n    1 , ababaaababaaabaabaababaaababaaabaabaabab...\n**********************************************************************\nFile \"src/sage/combinat/words/morphism.py\", line 1987, in sage.combinat.words.morphism.WordMorphism.periodic_points\nFailed example:\n    for p in f.periodic_points():\n        print(\"{} , {}\".format(len(p), p[0]))\nExpected:\n    2 , aababaaaababaababbabaababaababbabaababaa...\nGot:\n    2 , babbabaababaababbabbabbabaababaababbabaa...\n**********************************************************************\n```",
    "created_at": "2021-05-06T04:04:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513617",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>
Replying to [@videlec](#comment%3A15):
> Indeed. Is there a name for functions `f: A -> B` with `B` included in `A`?

I would just call it an endomorphism as the only difference is a promise that the image is smaller than all of `A`.

Also, doctest failures from the patchbot:

```
**********************************************************************
File "src/sage/combinat/words/morphism.py", line 1981, in sage.combinat.words.morphism.WordMorphism.periodic_points
Failed example:
    for p in f.periodic_points():
        print("{} , {}".format(len(p), p[0]))
Expected:
    1 , ababaaababaaabaabaababaaababaaabaabaabab...
    1 , baaabaabaababaaabaababaaabaababaaababaaa...
Got:
    1 , baaabaabaababaaabaababaaabaababaaababaaa...
    1 , ababaaababaaabaabaababaaababaaabaabaabab...
**********************************************************************
File "src/sage/combinat/words/morphism.py", line 1987, in sage.combinat.words.morphism.WordMorphism.periodic_points
Failed example:
    for p in f.periodic_points():
        print("{} , {}".format(len(p), p[0]))
Expected:
    2 , aababaaaababaababbabaababaababbabaababaa...
Got:
    2 , babbabaababaababbabbabbabaababaababbabaa...
**********************************************************************
```



---

archive/issue_comments_513618.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [@tscrim](#comment%3A16):\n> Replying to [@videlec](#comment%3A15):\n> > Indeed. Is there a name for functions `f: A -> B` with `B` included in `A`?\n\n> \n> I would just call it an endomorphism as the only difference is a promise that the image is smaller than all of `A`.\n\nIt is a bit like calling a matrix with more rows than column a square matrix :)\n\n```\nsage: WordMorphism('a->a,b->b,c->a').incidence_matrix()\n[1 0 1]\n[0 1 0]\n```\n\n> Also, doctest failures from the patchbot:\n\nI will see why this is not consistent.",
    "created_at": "2021-05-06T06:59:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513618",
    "user": "https://github.com/videlec"
}
```

<a id='comment:17'></a>
Replying to [@tscrim](#comment%3A16):
> Replying to [@videlec](#comment%3A15):
> > Indeed. Is there a name for functions `f: A -> B` with `B` included in `A`?

> 
> I would just call it an endomorphism as the only difference is a promise that the image is smaller than all of `A`.

It is a bit like calling a matrix with more rows than column a square matrix :)

```
sage: WordMorphism('a->a,b->b,c->a').incidence_matrix()
[1 0 1]
[0 1 0]
```

> Also, doctest failures from the patchbot:

I will see why this is not consistent.



---

archive/issue_comments_513619.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/14001685024278a7917290111cf1ca2a3629ef57\">1400168</a></td><td><code>fix ordering in get_cycles</code></td></tr></table>\n",
    "created_at": "2021-05-06T11:44:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513619",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/14001685024278a7917290111cf1ca2a3629ef57">1400168</a></td><td><code>fix ordering in get_cycles</code></td></tr></table>




---

archive/issue_comments_513620.json:
```json
{
    "body": "**Changing commit** from \"[5aab984e33a165b1a0e6b5a259c8b0c388bf2372](https://github.com/sagemath/sagetrac-mirror/commit/5aab984e33a165b1a0e6b5a259c8b0c388bf2372)\" to \"[14001685024278a7917290111cf1ca2a3629ef57](https://github.com/sagemath/sagetrac-mirror/commit/14001685024278a7917290111cf1ca2a3629ef57)\".",
    "created_at": "2021-05-06T11:44:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513620",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[5aab984e33a165b1a0e6b5a259c8b0c388bf2372](https://github.com/sagemath/sagetrac-mirror/commit/5aab984e33a165b1a0e6b5a259c8b0c388bf2372)" to "[14001685024278a7917290111cf1ca2a3629ef57](https://github.com/sagemath/sagetrac-mirror/commit/14001685024278a7917290111cf1ca2a3629ef57)".



---

archive/issue_comments_513621.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [@videlec](#comment%3A15):\n> Replying to [@mrejmon](#comment%3A14):\n> > On second thought, what do you think about replacing:\n> > \n> > ```\n> > if not self.is_endomorphism():\n> > ```\n> > with something like:\n> > \n> > ```\n> > if not set(self.codomain().alphabet()).issubset(self.domain().alphabet()):\n> > ```\n> > so that one doesn't have to manually specify the codomain in cases like this:\n> > \n> > ```\n> > WordMorphism('a->b,b->c,c->d,d->c', codomain=Words('abcd')).growing_letters()\n> > ```\n\n> \n> Indeed. Is there a name for functions `f: A -> B` with `B` included in `A`?\n\nAlternatively, we can make `WordMorphism` construct so that if the codomain is included in the domain then the default is to set `codomain=domain`.",
    "created_at": "2021-05-06T12:08:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513621",
    "user": "https://github.com/videlec"
}
```

<a id='comment:19'></a>
Replying to [@videlec](#comment%3A15):
> Replying to [@mrejmon](#comment%3A14):
> > On second thought, what do you think about replacing:
> > 
> > ```
> > if not self.is_endomorphism():
> > ```
> > with something like:
> > 
> > ```
> > if not set(self.codomain().alphabet()).issubset(self.domain().alphabet()):
> > ```
> > so that one doesn't have to manually specify the codomain in cases like this:
> > 
> > ```
> > WordMorphism('a->b,b->c,c->d,d->c', codomain=Words('abcd')).growing_letters()
> > ```

> 
> Indeed. Is there a name for functions `f: A -> B` with `B` included in `A`?

Alternatively, we can make `WordMorphism` construct so that if the codomain is included in the domain then the default is to set `codomain=domain`.



---

archive/issue_comments_513622.json:
```json
{
    "body": "**Changing commit** from \"[14001685024278a7917290111cf1ca2a3629ef57](https://github.com/sagemath/sagetrac-mirror/commit/14001685024278a7917290111cf1ca2a3629ef57)\" to \"[35f617b7204db754e702356c7f5901df8797fa69](https://github.com/sagemath/sagetrac-mirror/commit/35f617b7204db754e702356c7f5901df8797fa69)\".",
    "created_at": "2021-05-06T13:13:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513622",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[14001685024278a7917290111cf1ca2a3629ef57](https://github.com/sagemath/sagetrac-mirror/commit/14001685024278a7917290111cf1ca2a3629ef57)" to "[35f617b7204db754e702356c7f5901df8797fa69](https://github.com/sagemath/sagetrac-mirror/commit/35f617b7204db754e702356c7f5901df8797fa69)".



---

archive/issue_comments_513623.json:
```json
{
    "body": "<a id='comment:20'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/35f617b7204db754e702356c7f5901df8797fa69\">35f617b</a></td><td><code>clarify get_cycles</code></td></tr></table>\n",
    "created_at": "2021-05-06T13:13:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513623",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:20'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/35f617b7204db754e702356c7f5901df8797fa69">35f617b</a></td><td><code>clarify get_cycles</code></td></tr></table>




---

archive/issue_comments_513624.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [@videlec](#comment%3A17):\n> Replying to [@tscrim](#comment%3A16):\n> > Replying to [@videlec](#comment%3A15):\n> > > Indeed. Is there a name for functions `f: A -> B` with `B` included in `A`?\n\n> > \n> > I would just call it an endomorphism as the only difference is a promise that the image is smaller than all of `A`.\n\n> \n> It is a bit like calling a matrix with more rows than column a square matrix :)\n> \n> ```\n> sage: WordMorphism('a->a,b->b,c->a').incidence_matrix()\n> [1 0 1]\n> [0 1 0]\n> ```\n\nI agree fundamentally with your point, but not a generic example. I would argue that if there is a canonical way of embedding the image, I think we can allow the abuse. ;)",
    "created_at": "2021-05-07T06:02:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513624",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>
Replying to [@videlec](#comment%3A17):
> Replying to [@tscrim](#comment%3A16):
> > Replying to [@videlec](#comment%3A15):
> > > Indeed. Is there a name for functions `f: A -> B` with `B` included in `A`?

> > 
> > I would just call it an endomorphism as the only difference is a promise that the image is smaller than all of `A`.

> 
> It is a bit like calling a matrix with more rows than column a square matrix :)
> 
> ```
> sage: WordMorphism('a->a,b->b,c->a').incidence_matrix()
> [1 0 1]
> [0 1 0]
> ```

I agree fundamentally with your point, but not a generic example. I would argue that if there is a canonical way of embedding the image, I think we can allow the abuse. ;)



---

archive/issue_comments_513625.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [@videlec](#comment%3A19):\n> Alternatively, we can make `WordMorphism` construct so that if the codomain is included in the domain then the default is to set `codomain=domain`.\n\n-1 on this. This would break the composition `f: A -> B` and `g: B -> C` if `A < B` but `C` is some other unrelated set of words that is not defined on all of `A`.",
    "created_at": "2021-05-07T06:04:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513625",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:22'></a>
Replying to [@videlec](#comment%3A19):
> Alternatively, we can make `WordMorphism` construct so that if the codomain is included in the domain then the default is to set `codomain=domain`.

-1 on this. This would break the composition `f: A -> B` and `g: B -> C` if `A < B` but `C` is some other unrelated set of words that is not defined on all of `A`.



---

archive/issue_comments_513626.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [@tscrim](#comment%3A22):\n> Replying to [@videlec](#comment%3A19):\n> > Alternatively, we can make `WordMorphism` construct so that if the codomain is included in the domain then the default is to set `codomain=domain`.\n\n> \n> -1 on this. This would break the composition `f: A -> B` and `g: B -> C` if `A < B` but `C` is some other unrelated set of words that is not defined on all of `A`.\n\nI don't think it would in practice due to the way `__mul__` is implemented:\n\n```\ndef __mul__(self, other):\n    r\"\"\"\n    Returns the morphism ``self``\\*``other``.\n    ...\n    \"\"\"\nreturn WordMorphism(dict((key, self(w)) for key, w in other._morph.items()), codomain=self.codomain())\n```\nand for example:\n\n```\nsage: f = WordMorphism('a->a,b->a', codomain=FiniteWords('ab'))\nsage: g = WordMorphism('a->0')\nsage: g * f\nWordMorphism: a->0, b->0\n```\n\nAll in all, I don't mind either of these approaches. I also noticed that in the docs of `is_endomorphism` there already is:\n\n```\nReturns ``True`` if the codomain is a subset of the domain.\n```\nAnd hence that `is_endormophism` did work with subsets in some point, but this was changed in #8920 due to not being mathematically accurate.",
    "created_at": "2021-05-07T07:23:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513626",
    "user": "https://github.com/mrejmon"
}
```

<a id='comment:23'></a>
Replying to [@tscrim](#comment%3A22):
> Replying to [@videlec](#comment%3A19):
> > Alternatively, we can make `WordMorphism` construct so that if the codomain is included in the domain then the default is to set `codomain=domain`.

> 
> -1 on this. This would break the composition `f: A -> B` and `g: B -> C` if `A < B` but `C` is some other unrelated set of words that is not defined on all of `A`.

I don't think it would in practice due to the way `__mul__` is implemented:

```
def __mul__(self, other):
    r"""
    Returns the morphism ``self``\*``other``.
    ...
    """
return WordMorphism(dict((key, self(w)) for key, w in other._morph.items()), codomain=self.codomain())
```
and for example:

```
sage: f = WordMorphism('a->a,b->a', codomain=FiniteWords('ab'))
sage: g = WordMorphism('a->0')
sage: g * f
WordMorphism: a->0, b->0
```

All in all, I don't mind either of these approaches. I also noticed that in the docs of `is_endomorphism` there already is:

```
Returns ``True`` if the codomain is a subset of the domain.
```
And hence that `is_endormophism` did work with subsets in some point, but this was changed in #8920 due to not being mathematically accurate.



---

archive/issue_comments_513627.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [@tscrim](#comment%3A22):\n> Replying to [@videlec](#comment%3A19):\n> > Alternatively, we can make `WordMorphism` construct so that if the codomain is included in the domain then the default is to set `codomain=domain`.\n\n> \n> -1 on this. This would break the composition `f: A -> B` and `g: B -> C` if `A < B` but `C` is some other unrelated set of words that is not defined on all of `A`.\n\nMaybe I was unclear. What I suggested is to change\n\n```\nsage: WordMorphism('a->a,b->a').codomain()\nFinite words over {'a'}\n```\nto\n\n```\nsage: WordMorphism('a->a,b->a').codomain()\nFinite words over {'a', 'b'}\n```\n\nThe keyword `codomain` will not disappear and still allows you to build any kind of morphism you want\n\n```\nsage: WordMorphism('a->a,b->a', codomain=FiniteWords('a')).codomain()\nFinite words over {'a'}\n```",
    "created_at": "2021-05-07T08:40:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513627",
    "user": "https://github.com/videlec"
}
```

<a id='comment:24'></a>
Replying to [@tscrim](#comment%3A22):
> Replying to [@videlec](#comment%3A19):
> > Alternatively, we can make `WordMorphism` construct so that if the codomain is included in the domain then the default is to set `codomain=domain`.

> 
> -1 on this. This would break the composition `f: A -> B` and `g: B -> C` if `A < B` but `C` is some other unrelated set of words that is not defined on all of `A`.

Maybe I was unclear. What I suggested is to change

```
sage: WordMorphism('a->a,b->a').codomain()
Finite words over {'a'}
```
to

```
sage: WordMorphism('a->a,b->a').codomain()
Finite words over {'a', 'b'}
```

The keyword `codomain` will not disappear and still allows you to build any kind of morphism you want

```
sage: WordMorphism('a->a,b->a', codomain=FiniteWords('a')).codomain()
Finite words over {'a'}
```



---

archive/issue_comments_513628.json:
```json
{
    "body": "<a id='comment:25'></a>\nThis discussion is not exactly in the scope of the ticket and I suggest that we conclude here and talk about what is an endomorphism elsewhere. What do you think?",
    "created_at": "2021-05-07T08:40:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513628",
    "user": "https://github.com/videlec"
}
```

<a id='comment:25'></a>
This discussion is not exactly in the scope of the ticket and I suggest that we conclude here and talk about what is an endomorphism elsewhere. What do you think?



---

archive/issue_comments_513629.json:
```json
{
    "body": "<a id='comment:26'></a>\nI think it is still somewhat relevant to the ticket at hand, so we should see if we can come to a consensus.\n\nThat is what I understood your proposal to be, but I am thinking of the following situation:\n\n```\nsage: I = WordMorphism('a->a,b->b')  # The identity map\nsage: f = WordMorphism('a->x')                                                            \nsage: I.domain()\nFinite words over {'a', 'b'}\nsage: I.codomain()\nFinite words over {'a', 'b'}\nsage: f.domain()\nFinite words over {'a'}\nsage: f.codomain()\nFinite words over {'x'}\nsage: f * I  # This should not be a valid composition\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\n<ipython-input-7-dc18bb6a87ea> in <module>\n----> 1 f * I\n\n~/sage-build/local/lib/python3.9/site-packages/sage/combinat/words/morphism.py in __mul__(self, other)\n    976             WordMorphism:\n    977         \"\"\"\n--> 978         return WordMorphism(dict((key, self(w)) for key, w in other._morph.items()), codomain=self.codomain())\n    979 \n    980     def __pow__(self, exp):\n\n~/sage-build/local/lib/python3.9/site-packages/sage/combinat/words/morphism.py in <genexpr>(.0)\n    976             WordMorphism:\n    977         \"\"\"\n--> 978         return WordMorphism(dict((key, self(w)) for key, w in other._morph.items()), codomain=self.codomain())\n    979 \n    980     def __pow__(self, exp):\n\n~/sage-build/local/lib/python3.9/site-packages/sage/combinat/words/morphism.py in __call__(self, w, order, datatype)\n    794                 im = C()\n    795                 for a in w:\n--> 796                     im += self._morph[a]\n    797                 if datatype is not None:\n    798                     return C(im, datatype=datatype)\n\nKeyError: 'b'\n```\nNow this is failing, as it should, but not in a meaningful way IMO. The error message is somewhat cryptic, It all works without explicit consideration of the domain/codomain matching because of how it is coded, but it feels a bit fragile to me.",
    "created_at": "2021-05-07T22:01:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513629",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:26'></a>
I think it is still somewhat relevant to the ticket at hand, so we should see if we can come to a consensus.

That is what I understood your proposal to be, but I am thinking of the following situation:

```
sage: I = WordMorphism('a->a,b->b')  # The identity map
sage: f = WordMorphism('a->x')                                                            
sage: I.domain()
Finite words over {'a', 'b'}
sage: I.codomain()
Finite words over {'a', 'b'}
sage: f.domain()
Finite words over {'a'}
sage: f.codomain()
Finite words over {'x'}
sage: f * I  # This should not be a valid composition
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
<ipython-input-7-dc18bb6a87ea> in <module>
----> 1 f * I

~/sage-build/local/lib/python3.9/site-packages/sage/combinat/words/morphism.py in __mul__(self, other)
    976             WordMorphism:
    977         """
--> 978         return WordMorphism(dict((key, self(w)) for key, w in other._morph.items()), codomain=self.codomain())
    979 
    980     def __pow__(self, exp):

~/sage-build/local/lib/python3.9/site-packages/sage/combinat/words/morphism.py in <genexpr>(.0)
    976             WordMorphism:
    977         """
--> 978         return WordMorphism(dict((key, self(w)) for key, w in other._morph.items()), codomain=self.codomain())
    979 
    980     def __pow__(self, exp):

~/sage-build/local/lib/python3.9/site-packages/sage/combinat/words/morphism.py in __call__(self, w, order, datatype)
    794                 im = C()
    795                 for a in w:
--> 796                     im += self._morph[a]
    797                 if datatype is not None:
    798                     return C(im, datatype=datatype)

KeyError: 'b'
```
Now this is failing, as it should, but not in a meaningful way IMO. The error message is somewhat cryptic, It all works without explicit consideration of the domain/codomain matching because of how it is coded, but it feels a bit fragile to me.



---

archive/issue_comments_513630.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [@tscrim](#comment%3A26):\n> I think it is still somewhat relevant to the ticket at hand, so we should see if we can come to a consensus.\n> \n> That is what I understood your proposal to be, but I am thinking of the following situation:\n\n>\n> SNIP\n>\n> Now this is failing, as it should, but not in a meaningful way IMO. The error message is somewhat cryptic, It all works without explicit consideration of the domain/codomain matching because of how it is coded, but it feels a bit fragile to me.\n\nIt looks fragile to me as well but also unrelated to this ticket which is about improving `growing_letters`. [comment:14](#comment%3A14) which is the starting point of the discussion about `is_endomorphism` was complaining about the fact that `growing_letters` (and many other methods) remains valid under the more general assumption that you can iterate the morphism. I opened #31797 for the latter.",
    "created_at": "2021-05-08T19:07:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513630",
    "user": "https://github.com/videlec"
}
```

<a id='comment:27'></a>
Replying to [@tscrim](#comment%3A26):
> I think it is still somewhat relevant to the ticket at hand, so we should see if we can come to a consensus.
> 
> That is what I understood your proposal to be, but I am thinking of the following situation:

>
> SNIP
>
> Now this is failing, as it should, but not in a meaningful way IMO. The error message is somewhat cryptic, It all works without explicit consideration of the domain/codomain matching because of how it is coded, but it feels a bit fragile to me.

It looks fragile to me as well but also unrelated to this ticket which is about improving `growing_letters`. [comment:14](#comment%3A14) which is the starting point of the discussion about `is_endomorphism` was complaining about the fact that `growing_letters` (and many other methods) remains valid under the more general assumption that you can iterate the morphism. I opened #31797 for the latter.



---

archive/issue_comments_513631.json:
```json
{
    "body": "<a id='comment:28'></a>\nAlright, then let's set this to a positive review. Thanks.",
    "created_at": "2021-05-12T07:11:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513631",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:28'></a>
Alright, then let's set this to a positive review. Thanks.



---

archive/issue_events_385573.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-05-12T07:11:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31760#event-385573"
}
```



---

archive/issue_events_385574.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-05-12T07:11:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31760#event-385574"
}
```



---

archive/issue_comments_513632.json:
```json
{
    "body": "**Changing branch** from \"[public/combinat/growing_letters_speedup-31760](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/growing_letters_speedup-31760)\" to \"[35f617b7204db754e702356c7f5901df8797fa69](https://github.com/sagemath/sagetrac-mirror/commit/35f617b7204db754e702356c7f5901df8797fa69)\".",
    "created_at": "2021-06-19T20:57:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31760#issuecomment-513632",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/combinat/growing_letters_speedup-31760](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/growing_letters_speedup-31760)" to "[35f617b7204db754e702356c7f5901df8797fa69](https://github.com/sagemath/sagetrac-mirror/commit/35f617b7204db754e702356c7f5901df8797fa69)".



---

archive/issue_events_385575.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-19T20:57:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31760#event-385575"
}
```



---

archive/issue_events_385576.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b1f2788e4c9e7315f56b4a987d78eff835835e77",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-06-19T20:57:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31760",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31760#event-385576"
}
```
