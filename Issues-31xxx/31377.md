# Issue 31377: ./configure --enable-editable

archive/issues_031140.json:
```json
{
    "assignees": [],
    "body": "This configure switch will install sagelib in \"develop\" (\"editable\", \"in-place\") mode instead of using sagelib's custom incremental build system.\n\nThis will clutter the source directory with build artifacts (which are `.gitignore`'d, of course) but it has the benefit that for changes to Python files, one does not need to run `./sage -b`; restarting Sage is enough.\n\nIt may also have benefits in certain develop environments that get confused by sagelib's nonstandard build system.\n\nThis ticket is based on a subset of the changes in #30371, which developed a version of `setup.py` suitable for the in-place build. This version is `src/setup.py` and distinct from `build/pkgs/sagelib/src/setup.py`.\nThe configure switch switches to this version of the build system.\n\nTo test:\n\n```\n./bootstrap\n./configure --enable-editable\nmake build\n```\nThen use and test as normal. Verify that `local/lib/...site-packages/` no longer contains a copy of `sage` - instead there is an \"egg-link\" back to the source directory.\n\n\nSwitching to a standard build system (getting rid of the sage-specific \"installation cleaner\") will also simplify the next step of the modularization effort (#29705).\n\n\nDepends on #30770\nDepends on #30912\nDepends on #31357\nDepends on #31365\nDepends on #31389\nDepends on #31390\n\nCC:  @tobiasdiez @jhpalmieri @fchapoton @videlec @isuruf @kliem @tscrim\n\nBranch: **[8b3f390](https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02)**\n\nReviewer: **Matthias Koeppe, Tobias Diez, Jonathan Kliem**\n\nAuthor: **Tobias Diez, Matthias Koeppe**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31377_\n\n",
    "closed_at": "2021-03-09T00:00:42Z",
    "created_at": "2021-02-10T20:34:37Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "./configure --enable-editable",
    "type": "issue",
    "updated_at": "2021-03-09T23:42:43Z",
    "url": "https://github.com/sagemath/sage/issues/31377",
    "user": "https://github.com/mkoeppe"
}
```
This configure switch will install sagelib in "develop" ("editable", "in-place") mode instead of using sagelib's custom incremental build system.

This will clutter the source directory with build artifacts (which are `.gitignore`'d, of course) but it has the benefit that for changes to Python files, one does not need to run `./sage -b`; restarting Sage is enough.

It may also have benefits in certain develop environments that get confused by sagelib's nonstandard build system.

This ticket is based on a subset of the changes in #30371, which developed a version of `setup.py` suitable for the in-place build. This version is `src/setup.py` and distinct from `build/pkgs/sagelib/src/setup.py`.
The configure switch switches to this version of the build system.

To test:

```
./bootstrap
./configure --enable-editable
make build
```
Then use and test as normal. Verify that `local/lib/...site-packages/` no longer contains a copy of `sage` - instead there is an "egg-link" back to the source directory.


Switching to a standard build system (getting rid of the sage-specific "installation cleaner") will also simplify the next step of the modularization effort (#29705).


Depends on #30770
Depends on #30912
Depends on #31357
Depends on #31365
Depends on #31389
Depends on #31390

CC:  @tobiasdiez @jhpalmieri @fchapoton @videlec @isuruf @kliem @tscrim

Branch: **[8b3f390](https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02)**

Reviewer: **Matthias Koeppe, Tobias Diez, Jonathan Kliem**

Author: **Tobias Diez, Matthias Koeppe**

_Issue created by migration from https://trac.sagemath.org/ticket/31377_





---

archive/issue_events_414188.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-10T20:34:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414188"
}
```



---

archive/issue_events_414189.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-10T20:34:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "000080",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414189"
}
```



---

archive/issue_events_414190.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-10T20:34:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414190"
}
```



---

archive/issue_events_414191.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-10T20:34:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414191"
}
```



---

archive/issue_comments_506242.json:
```json
{
    "body": "Dependencies: **#30770, #30912, #31357, #31362**",
    "created_at": "2021-02-10T20:41:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506242",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#30770, #30912, #31357, #31362**



---

archive/issue_comments_506243.json:
```json
{
    "body": "Changed dependencies from **#30770, #30912, #31357, #31362** to **#30770, #30912, #31357**",
    "created_at": "2021-02-10T20:46:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506243",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30770, #30912, #31357, #31362** to **#30770, #30912, #31357**



---

archive/issue_comments_506244.json:
```json
{
    "body": "Branch: **[u/mkoeppe/__configure___enable_editable](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/__configure___enable_editable)**",
    "created_at": "2021-02-10T21:01:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506244",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/__configure___enable_editable](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/__configure___enable_editable)**



---

archive/issue_comments_506245.json:
```json
{
    "body": "Commit: **[3dcfbe9](https://github.com/sagemath/sagetrac-mirror/commit/3dcfbe90735023422e4f6a79594b0034290adf96)**",
    "created_at": "2021-02-10T21:20:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506245",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[3dcfbe9](https://github.com/sagemath/sagetrac-mirror/commit/3dcfbe90735023422e4f6a79594b0034290adf96)**



---

archive/issue_comments_506246.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3dcfbe90735023422e4f6a79594b0034290adf96\">3dcfbe9</a></td><td><code>build/pkgs/sagelib: Implement --enable-editable</code></td></tr></table>\n",
    "created_at": "2021-02-10T21:20:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506246",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4" align="right">Comment 4</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3dcfbe90735023422e4f6a79594b0034290adf96">3dcfbe9</a></td><td><code>build/pkgs/sagelib: Implement --enable-editable</code></td></tr></table>




---

archive/issue_comments_506247.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f8ad239bea1847b5008de00b8ac5ebfbced6f122\">f8ad239</a></td><td><code>src/setup.py: Do not look for namespace packages in bin, doc</code></td></tr></table>\n",
    "created_at": "2021-02-10T21:42:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506247",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5" align="right">Comment 5</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f8ad239bea1847b5008de00b8ac5ebfbced6f122">f8ad239</a></td><td><code>src/setup.py: Do not look for namespace packages in bin, doc</code></td></tr></table>




---

archive/issue_comments_506248.json:
```json
{
    "body": "Changed commit from **[3dcfbe9](https://github.com/sagemath/sagetrac-mirror/commit/3dcfbe90735023422e4f6a79594b0034290adf96)** to **[f8ad239](https://github.com/sagemath/sagetrac-mirror/commit/f8ad239bea1847b5008de00b8ac5ebfbced6f122)**",
    "created_at": "2021-02-10T21:42:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506248",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3dcfbe9](https://github.com/sagemath/sagetrac-mirror/commit/3dcfbe90735023422e4f6a79594b0034290adf96)** to **[f8ad239](https://github.com/sagemath/sagetrac-mirror/commit/f8ad239bea1847b5008de00b8ac5ebfbced6f122)**



---

archive/issue_comments_506249.json:
```json
{
    "body": "Changed commit from **[f8ad239](https://github.com/sagemath/sagetrac-mirror/commit/f8ad239bea1847b5008de00b8ac5ebfbced6f122)** to **[edbe3d5](https://github.com/sagemath/sagetrac-mirror/commit/edbe3d5eb69da6d685365be46c7c3d53d242ae54)**",
    "created_at": "2021-02-10T22:08:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506249",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f8ad239](https://github.com/sagemath/sagetrac-mirror/commit/f8ad239bea1847b5008de00b8ac5ebfbced6f122)** to **[edbe3d5](https://github.com/sagemath/sagetrac-mirror/commit/edbe3d5eb69da6d685365be46c7c3d53d242ae54)**



---

archive/issue_comments_506250.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/043d3ab5d754aff9ddd3813087a810cd351fc9e6\">043d3ab</a></td><td><code>Fixup version files/symlinks</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/edbe3d5eb69da6d685365be46c7c3d53d242ae54\">edbe3d5</a></td><td><code>Merge branch 't/31357/fixup_src_version_txt_added_in__30912' into t/31377/__configure___enable_editable</code></td></tr></table>\n",
    "created_at": "2021-02-10T22:08:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506250",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6" align="right">Comment 6</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/043d3ab5d754aff9ddd3813087a810cd351fc9e6">043d3ab</a></td><td><code>Fixup version files/symlinks</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/edbe3d5eb69da6d685365be46c7c3d53d242ae54">edbe3d5</a></td><td><code>Merge branch 't/31357/fixup_src_version_txt_added_in__30912' into t/31377/__configure___enable_editable</code></td></tr></table>




---

archive/issue_comments_506251.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nThis almost works for me, except for some errors building modules:\n\n```\n[sagelib-9.3.beta7]     gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk -O2 -g -march=native -Isage/libs/ntl -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/cysignals -Isage/cpython -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src -I/usr/local/Cellar/python@3.9/3.9.1_8/Frameworks/Python.framework/Versions/3.9/include/python3.9 -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/numpy/core/include -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/include -I/usr/local/Cellar/python@3.9/3.9.1_8/Frameworks/Python.framework/Versions/3.9/include/python3.9 -c sage/libs/ntl/ntl_ZZ.cpp -o build/temp.macosx-10.15-x86_64-3.9/sage/libs/ntl/ntl_ZZ.o\n[sagelib-9.3.beta7]     In file included from sage/libs/ntl/error.cpp:1283:\n[sagelib-9.3.beta7]     ../local/include/NTL/tools.h:1064:1: error: unknown type name 'constexpr'\n[sagelib-9.3.beta7]     constexpr bool Relocate_aux_has_trivial_copy(T*)\n[sagelib-9.3.beta7]     ^\n```\n\nThis is probably coming from the fact that the C++ std options that `sage_build_cython.create_extension` uses are not used by the new build system.",
    "created_at": "2021-02-10T23:12:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506251",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">Comment 7</div>

This almost works for me, except for some errors building modules:

```
[sagelib-9.3.beta7]     gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk -O2 -g -march=native -Isage/libs/ntl -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/cysignals -Isage/cpython -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src -I/usr/local/Cellar/python@3.9/3.9.1_8/Frameworks/Python.framework/Versions/3.9/include/python3.9 -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/numpy/core/include -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/include -I/usr/local/Cellar/python@3.9/3.9.1_8/Frameworks/Python.framework/Versions/3.9/include/python3.9 -c sage/libs/ntl/ntl_ZZ.cpp -o build/temp.macosx-10.15-x86_64-3.9/sage/libs/ntl/ntl_ZZ.o
[sagelib-9.3.beta7]     In file included from sage/libs/ntl/error.cpp:1283:
[sagelib-9.3.beta7]     ../local/include/NTL/tools.h:1064:1: error: unknown type name 'constexpr'
[sagelib-9.3.beta7]     constexpr bool Relocate_aux_has_trivial_copy(T*)
[sagelib-9.3.beta7]     ^
```

This is probably coming from the fact that the C++ std options that `sage_build_cython.create_extension` uses are not used by the new build system.



---

archive/issue_comments_506252.json:
```json
{
    "body": "Changed commit from **[edbe3d5](https://github.com/sagemath/sagetrac-mirror/commit/edbe3d5eb69da6d685365be46c7c3d53d242ae54)** to **[731ff53](https://github.com/sagemath/sagetrac-mirror/commit/731ff530491af9dfcc46a9d9c226485f2f91caa6)**",
    "created_at": "2021-02-11T04:17:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506252",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[edbe3d5](https://github.com/sagemath/sagetrac-mirror/commit/edbe3d5eb69da6d685365be46c7c3d53d242ae54)** to **[731ff53](https://github.com/sagemath/sagetrac-mirror/commit/731ff530491af9dfcc46a9d9c226485f2f91caa6)**



---

archive/issue_comments_506253.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/804ebd7689fe8423e901e8ecf38dd62a7a9b8789\">804ebd7</a></td><td><code>sage_setup.dpcbuild.AllBuilder: Restrict workaround to macOS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4ceee5dae4caa7dac7a6fe7ca29538aca2d381a\">b4ceee5</a></td><td><code>sage_setup.docbuild: In the workaround, do not go through build_many to build serially</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7369a3e90d96862388dc32153e8644a82ebcccde\">7369a3e</a></td><td><code>Merge branch 't/31344/homebrew__docbuild_crashes__libtcl_atforkprepare' into t/31365/add_ntl_to_cython_aliases</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce03e6b8a93777820c94d83eeb42d8b70c222a73\">ce03e6b</a></td><td><code>src/sage/schemes/hyperelliptic_curves/hypellfrob.pyx: Merge distutils directives</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32576b43a0415a9e15d1cbe6beac2dd4c300a745\">32576b4</a></td><td><code>sage.misc.cython: Add NTL aliases, cache result of cython_aliases</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e30e3ac2d891a16fdd1ad89506db767d4edb9e5\">6e30e3a</a></td><td><code>Use variables NTL_INCDIR, NTL_LIBDIR in sage_conf, separate from NTL_PREFIX used in sage-build-env-config; set -std=c++11 in NTL_CFLAGS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7b1e27b96e143d6d44b448692ba266050e667399\">7b1e27b</a></td><td><code>Merge distutils directives for Cython files using ntl</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4d2828df69cd02e128a43a53b32e67cb63caacb9\">4d2828d</a></td><td><code>Switch Cython files that use NTL to language = c++</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/904a494346f51b1d9e5cd6474c75b39278f5fa8f\">904a494</a></td><td><code>Merge branch 't/31365/add_ntl_to_cython_aliases' into t/31377/__configure___enable_editable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/731ff530491af9dfcc46a9d9c226485f2f91caa6\">731ff53</a></td><td><code>Switch some Cython files to c++, add some -std=c++11</code></td></tr></table>\n",
    "created_at": "2021-02-11T04:17:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506253",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8" align="right">Comment 8</div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/804ebd7689fe8423e901e8ecf38dd62a7a9b8789">804ebd7</a></td><td><code>sage_setup.dpcbuild.AllBuilder: Restrict workaround to macOS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4ceee5dae4caa7dac7a6fe7ca29538aca2d381a">b4ceee5</a></td><td><code>sage_setup.docbuild: In the workaround, do not go through build_many to build serially</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7369a3e90d96862388dc32153e8644a82ebcccde">7369a3e</a></td><td><code>Merge branch 't/31344/homebrew__docbuild_crashes__libtcl_atforkprepare' into t/31365/add_ntl_to_cython_aliases</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce03e6b8a93777820c94d83eeb42d8b70c222a73">ce03e6b</a></td><td><code>src/sage/schemes/hyperelliptic_curves/hypellfrob.pyx: Merge distutils directives</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32576b43a0415a9e15d1cbe6beac2dd4c300a745">32576b4</a></td><td><code>sage.misc.cython: Add NTL aliases, cache result of cython_aliases</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e30e3ac2d891a16fdd1ad89506db767d4edb9e5">6e30e3a</a></td><td><code>Use variables NTL_INCDIR, NTL_LIBDIR in sage_conf, separate from NTL_PREFIX used in sage-build-env-config; set -std=c++11 in NTL_CFLAGS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7b1e27b96e143d6d44b448692ba266050e667399">7b1e27b</a></td><td><code>Merge distutils directives for Cython files using ntl</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4d2828df69cd02e128a43a53b32e67cb63caacb9">4d2828d</a></td><td><code>Switch Cython files that use NTL to language = c++</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/904a494346f51b1d9e5cd6474c75b39278f5fa8f">904a494</a></td><td><code>Merge branch 't/31365/add_ntl_to_cython_aliases' into t/31377/__configure___enable_editable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/731ff530491af9dfcc46a9d9c226485f2f91caa6">731ff53</a></td><td><code>Switch some Cython files to c++, add some -std=c++11</code></td></tr></table>




---

archive/issue_comments_506254.json:
```json
{
    "body": "Changed dependencies from **#30770, #30912, #31357** to **#30770, #30912, #31357, #31365**",
    "created_at": "2021-02-11T04:19:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506254",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30770, #30912, #31357** to **#30770, #30912, #31357, #31365**



---

archive/issue_comments_506255.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nI have merged #31365, which adds directives to files using NTL; and added a few more distutils directives so that things don't depend so much on the code in `sage_build_cython.create_extension`.",
    "created_at": "2021-02-11T04:19:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506255",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">Comment 9</div>

I have merged #31365, which adds directives to files using NTL; and added a few more distutils directives so that things don't depend so much on the code in `sage_build_cython.create_extension`.



---

archive/issue_events_414192.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-11T04:19:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414192"
}
```



---

archive/issue_comments_506256.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This configure switch will install sagelib in \"develop\" (\"editable\", \"in-place\") mode instead of using the traditional incremental build system.\n+This configure switch will install sagelib in \"develop\" (\"editable\", \"in-place\") mode instead of using sagelib's custom incremental build system.\n \n This will clutter the source directory with build artifacts (which are `.gitignore`'d, of course) but it has the benefit that for changes to Python files, one does not need to run `./sage -b`; restarting Sage is enough.\n \n``````\n",
    "created_at": "2021-02-11T04:19:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506256",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This configure switch will install sagelib in "develop" ("editable", "in-place") mode instead of using the traditional incremental build system.
+This configure switch will install sagelib in "develop" ("editable", "in-place") mode instead of using sagelib's custom incremental build system.
 
 This will clutter the source directory with build artifacts (which are `.gitignore`'d, of course) but it has the benefit that for changes to Python files, one does not need to run `./sage -b`; restarting Sage is enough.
 
``````




---

archive/issue_comments_506257.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,3 +8,5 @@\n The configure switch switches to this version of the build system.\n \n \n+Switching to a standard build system (getting rid of the sage-specific \"installation cleaner\") will also simplify the next step of the modularization effort (#29705).\n+\n``````\n",
    "created_at": "2021-02-11T04:22:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506257",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,3 +8,5 @@
 The configure switch switches to this version of the build system.
 
 
+Switching to a standard build system (getting rid of the sage-specific "installation cleaner") will also simplify the next step of the modularization effort (#29705).
+
``````




---

archive/issue_comments_506258.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n \n It may also have benefits in certain develop environments that get confused by sagelib's nonstandard build system.\n \n-This ticket is based on #30371, which developed a version of `setup.py` suitable for the in-place build. This version is `src/setup.py` and distinct from `build/pkgs/sagelib/src/setup.py`.\n+This ticket is based on a subset of the changes in #30371, which developed a version of `setup.py` suitable for the in-place build. This version is `src/setup.py` and distinct from `build/pkgs/sagelib/src/setup.py`.\n The configure switch switches to this version of the build system.\n \n \n``````\n",
    "created_at": "2021-02-11T04:37:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506258",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 
 It may also have benefits in certain develop environments that get confused by sagelib's nonstandard build system.
 
-This ticket is based on #30371, which developed a version of `setup.py` suitable for the in-place build. This version is `src/setup.py` and distinct from `build/pkgs/sagelib/src/setup.py`.
+This ticket is based on a subset of the changes in #30371, which developed a version of `setup.py` suitable for the in-place build. This version is `src/setup.py` and distinct from `build/pkgs/sagelib/src/setup.py`.
 The configure switch switches to this version of the build system.
 
 
``````




---

archive/issue_comments_506259.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nThis seems to reasonably work well here on macOS. There are a small number of doctest failures.\n\n```\nsage -t --random-seed=0 src/sage/misc/sagedoc.py  # 2 doctests failed\nsage -t --random-seed=0 src/sage/misc/sageinspect.py  # 13 doctests failed\nsage -t --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/categories/primer.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/repl/ipython_tests.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/sets/set_from_iterator.py  # 2 doctests failed\nsage -t --random-seed=0 src/sage/interacts/debugger.py  # 2 doctests failed\nsage -t --random-seed=0 src/sage/misc/lazy_attribute.pyx  # 1 doctest failed\nsage -t --random-seed=0 src/sage/misc/nested_class.pyx  # 1 doctest failed\nsage -t --random-seed=0 src/sage/structure/dynamic_class.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/all.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/misc/edit_module.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/cpython/dict_del_by_value.pyx  # 2 doctests failed\nsage -t --random-seed=0 src/sage/graphs/graph_decompositions/tree_decomposition.pyx  # 35 doctests failed\n```\nThe last one is due to the fact that in the editable install all `.pyx` files, even when the modules are not compiled, are available and used for doctesting. \n\nThis will need a new solution to suppress the doctests of such modules - see #30778 (`sage.doctest.control`: Exclude doctests in files from non-installed distributions).",
    "created_at": "2021-02-11T05:54:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506259",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">Comment 13</div>

This seems to reasonably work well here on macOS. There are a small number of doctest failures.

```
sage -t --random-seed=0 src/sage/misc/sagedoc.py  # 2 doctests failed
sage -t --random-seed=0 src/sage/misc/sageinspect.py  # 13 doctests failed
sage -t --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/categories/primer.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/repl/ipython_tests.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/sets/set_from_iterator.py  # 2 doctests failed
sage -t --random-seed=0 src/sage/interacts/debugger.py  # 2 doctests failed
sage -t --random-seed=0 src/sage/misc/lazy_attribute.pyx  # 1 doctest failed
sage -t --random-seed=0 src/sage/misc/nested_class.pyx  # 1 doctest failed
sage -t --random-seed=0 src/sage/structure/dynamic_class.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/all.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/misc/edit_module.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/cpython/dict_del_by_value.pyx  # 2 doctests failed
sage -t --random-seed=0 src/sage/graphs/graph_decompositions/tree_decomposition.pyx  # 35 doctests failed
```
The last one is due to the fact that in the editable install all `.pyx` files, even when the modules are not compiled, are available and used for doctesting. 

This will need a new solution to suppress the doctests of such modules - see #30778 (`sage.doctest.control`: Exclude doctests in files from non-installed distributions).



---

archive/issue_comments_506260.json:
```json
{
    "body": "Changed commit from **[731ff53](https://github.com/sagemath/sagetrac-mirror/commit/731ff530491af9dfcc46a9d9c226485f2f91caa6)** to **[18df2dc](https://github.com/sagemath/sagetrac-mirror/commit/18df2dc7c27d8e583d5ccdc6acfa39c955b8fa51)**",
    "created_at": "2021-02-11T07:26:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506260",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[731ff53](https://github.com/sagemath/sagetrac-mirror/commit/731ff530491af9dfcc46a9d9c226485f2f91caa6)** to **[18df2dc](https://github.com/sagemath/sagetrac-mirror/commit/18df2dc7c27d8e583d5ccdc6acfa39c955b8fa51)**



---

archive/issue_comments_506261.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1cb260a86baaf0124514782a32888d6ce4e37c4f\">1cb260a</a></td><td><code>build/pkgs/sagelib/spkg-install: Remove --ignore-installed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/36bbd6cc2fd99635bf39f49f76cef2afb3e72591\">36bbd6c</a></td><td><code>build/make/Makefile.in (sagelib-clean): Remove .so files in editable installs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/993c35c931f9c9f2b459e66619cac7d587a4a08f\">993c35c</a></td><td><code>build/pkgs/ntl/spkg-configure.m4: Fix up</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18df2dc7c27d8e583d5ccdc6acfa39c955b8fa51\">18df2dc</a></td><td><code>Merge branch 't/31365/add_ntl_to_cython_aliases' into t/31377/__configure___enable_editable</code></td></tr></table>\n",
    "created_at": "2021-02-11T07:26:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506261",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15" align="right">Comment 15</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1cb260a86baaf0124514782a32888d6ce4e37c4f">1cb260a</a></td><td><code>build/pkgs/sagelib/spkg-install: Remove --ignore-installed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/36bbd6cc2fd99635bf39f49f76cef2afb3e72591">36bbd6c</a></td><td><code>build/make/Makefile.in (sagelib-clean): Remove .so files in editable installs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/993c35c931f9c9f2b459e66619cac7d587a4a08f">993c35c</a></td><td><code>build/pkgs/ntl/spkg-configure.m4: Fix up</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18df2dc7c27d8e583d5ccdc6acfa39c955b8fa51">18df2dc</a></td><td><code>Merge branch 't/31365/add_ntl_to_cython_aliases' into t/31377/__configure___enable_editable</code></td></tr></table>




---

archive/issue_comments_506262.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nplease stop adding me in cc",
    "created_at": "2021-02-11T08:12:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506262",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:16" align="right">Comment 16</div>

please stop adding me in cc



---

archive/issue_comments_506263.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nSo how does one test this?",
    "created_at": "2021-02-11T21:25:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506263",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:17" align="right">Comment 17</div>

So how does one test this?



---

archive/issue_comments_506264.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,6 +7,14 @@\n This ticket is based on a subset of the changes in #30371, which developed a version of `setup.py` suitable for the in-place build. This version is `src/setup.py` and distinct from `build/pkgs/sagelib/src/setup.py`.\n The configure switch switches to this version of the build system.\n \n+To test:\n+\n+```\n+./configure --enable-editable\n+make build\n+```\n+Then use and test as normal. Verify that `local/lib/...site-packages/` no longer contains a copy of `sage` - instead there is an \"egg-link\" back to the source directory.\n+\n \n Switching to a standard build system (getting rid of the sage-specific \"installation cleaner\") will also simplify the next step of the modularization effort (#29705).\n \n``````\n",
    "created_at": "2021-02-11T21:42:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506264",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,6 +7,14 @@
 This ticket is based on a subset of the changes in #30371, which developed a version of `setup.py` suitable for the in-place build. This version is `src/setup.py` and distinct from `build/pkgs/sagelib/src/setup.py`.
 The configure switch switches to this version of the build system.
 
+To test:
+
+```
+./configure --enable-editable
+make build
+```
+Then use and test as normal. Verify that `local/lib/...site-packages/` no longer contains a copy of `sage` - instead there is an "egg-link" back to the source directory.
+
 
 Switching to a standard build system (getting rid of the sage-specific "installation cleaner") will also simplify the next step of the modularization effort (#29705).
 
``````




---

archive/issue_comments_506265.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nI've added quick instructions to the ticket description",
    "created_at": "2021-02-11T21:43:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506265",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">Comment 19</div>

I've added quick instructions to the ticket description



---

archive/issue_comments_506266.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe, ...**",
    "created_at": "2021-02-11T22:13:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506266",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe, ...**



---

archive/issue_events_414193.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-12T16:20:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414193"
}
```



---

archive/issue_events_414194.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-12T16:20:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414194"
}
```



---

archive/issue_comments_506267.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nThe installation of the Jupyter kernel is missing - done by `sage_setup.command.sage_install`",
    "created_at": "2021-02-12T17:47:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506267",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">Comment 22</div>

The installation of the Jupyter kernel is missing - done by `sage_setup.command.sage_install`



---

archive/issue_comments_506268.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nReplying to [@mkoeppe](#comment%3A13):\n> This seems to reasonably work well here on macOS. There are a small number of doctest failures.\n> \n> ```\n> ...\n> sage -t --random-seed=0 src/sage/graphs/graph_decompositions/tree_decomposition.pyx  # 35 doctests failed\n> ```\n> The last one is due to the fact that in the editable install all `.pyx` files, even when the modules are not compiled, are available and used for doctesting. \n\nWrong guess, this is actually #31389.",
    "created_at": "2021-02-12T19:10:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506268",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">Comment 23</div>

Replying to [@mkoeppe](#comment%3A13):
> This seems to reasonably work well here on macOS. There are a small number of doctest failures.
> 
> ```
> ...
> sage -t --random-seed=0 src/sage/graphs/graph_decompositions/tree_decomposition.pyx  # 35 doctests failed
> ```
> The last one is due to the fact that in the editable install all `.pyx` files, even when the modules are not compiled, are available and used for doctesting. 

Wrong guess, this is actually #31389.



---

archive/issue_comments_506269.json:
```json
{
    "body": "Changed dependencies from **#30770, #30912, #31357, #31365** to **#30770, #30912, #31357, #31365, #31389**",
    "created_at": "2021-02-12T19:22:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506269",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30770, #30912, #31357, #31365** to **#30770, #30912, #31357, #31365, #31389**



---

archive/issue_comments_506270.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/19ca17aa08c610e1ed900b39662fb2ba1ec8455e\">19ca17a</a></td><td><code>src/sage/graphs/graph_decompositions/tdlib/sage_tdlib.cpp: Move one directory level higher</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f02963b28d939a7f409914a246d74dce7bfc41d4\">f02963b</a></td><td><code>Merge branch 't/31389/remove_clash_of_tdlib__with_tdlib_pyx_in__src_sage_graphs_graph_decompositions' into t/31377/__configure___enable_editable</code></td></tr></table>\n",
    "created_at": "2021-02-12T19:23:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506270",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25" align="right">Comment 25</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/19ca17aa08c610e1ed900b39662fb2ba1ec8455e">19ca17a</a></td><td><code>src/sage/graphs/graph_decompositions/tdlib/sage_tdlib.cpp: Move one directory level higher</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f02963b28d939a7f409914a246d74dce7bfc41d4">f02963b</a></td><td><code>Merge branch 't/31389/remove_clash_of_tdlib__with_tdlib_pyx_in__src_sage_graphs_graph_decompositions' into t/31377/__configure___enable_editable</code></td></tr></table>




---

archive/issue_comments_506271.json:
```json
{
    "body": "Changed commit from **[18df2dc](https://github.com/sagemath/sagetrac-mirror/commit/18df2dc7c27d8e583d5ccdc6acfa39c955b8fa51)** to **[f02963b](https://github.com/sagemath/sagetrac-mirror/commit/f02963b28d939a7f409914a246d74dce7bfc41d4)**",
    "created_at": "2021-02-12T19:23:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506271",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[18df2dc](https://github.com/sagemath/sagetrac-mirror/commit/18df2dc7c27d8e583d5ccdc6acfa39c955b8fa51)** to **[f02963b](https://github.com/sagemath/sagetrac-mirror/commit/f02963b28d939a7f409914a246d74dce7bfc41d4)**



---

archive/issue_comments_506272.json:
```json
{
    "body": "Changed commit from **[f02963b](https://github.com/sagemath/sagetrac-mirror/commit/f02963b28d939a7f409914a246d74dce7bfc41d4)** to **[2b293f8](https://github.com/sagemath/sagetrac-mirror/commit/2b293f889f827ec5769ad6ca601294284d9a1f24)**",
    "created_at": "2021-02-12T22:14:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506272",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f02963b](https://github.com/sagemath/sagetrac-mirror/commit/f02963b28d939a7f409914a246d74dce7bfc41d4)** to **[2b293f8](https://github.com/sagemath/sagetrac-mirror/commit/2b293f889f827ec5769ad6ca601294284d9a1f24)**



---

archive/issue_comments_506273.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2b293f889f827ec5769ad6ca601294284d9a1f24\">2b293f8</a></td><td><code>src/setup.py: Install the jupyter kernel using sage_install</code></td></tr></table>\n",
    "created_at": "2021-02-12T22:14:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506273",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26" align="right">Comment 26</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2b293f889f827ec5769ad6ca601294284d9a1f24">2b293f8</a></td><td><code>src/setup.py: Install the jupyter kernel using sage_install</code></td></tr></table>




---

archive/issue_comments_506274.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\n``sage.misc.sageinspect`` is broken in an editable build, which causes the docbuild to fail.",
    "created_at": "2021-02-13T00:30:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506274",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">Comment 27</div>

``sage.misc.sageinspect`` is broken in an editable build, which causes the docbuild to fail.



---

archive/issue_events_414195.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T00:30:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414195"
}
```



---

archive/issue_events_414196.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T00:30:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414196"
}
```



---

archive/issue_comments_506275.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b05e4ba3e981959a0ce39ff39e56d5d5e0b16971\">b05e4ba</a></td><td><code>build/make/Makefile.in (sagelib-clean): Remove generated .c and .cpp files</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/271d42733078659c963550e07970440101a73ab7\">271d427</a></td><td><code>src/setup.py: Fix sage.misc.sageinspect by setting Cython.Compiler.Options.embed_pos_in_docstring</code></td></tr></table>\n",
    "created_at": "2021-02-13T01:20:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506275",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28" align="right">Comment 28</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b05e4ba3e981959a0ce39ff39e56d5d5e0b16971">b05e4ba</a></td><td><code>build/make/Makefile.in (sagelib-clean): Remove generated .c and .cpp files</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/271d42733078659c963550e07970440101a73ab7">271d427</a></td><td><code>src/setup.py: Fix sage.misc.sageinspect by setting Cython.Compiler.Options.embed_pos_in_docstring</code></td></tr></table>




---

archive/issue_comments_506276.json:
```json
{
    "body": "Changed commit from **[2b293f8](https://github.com/sagemath/sagetrac-mirror/commit/2b293f889f827ec5769ad6ca601294284d9a1f24)** to **[271d427](https://github.com/sagemath/sagetrac-mirror/commit/271d42733078659c963550e07970440101a73ab7)**",
    "created_at": "2021-02-13T01:20:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506276",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2b293f8](https://github.com/sagemath/sagetrac-mirror/commit/2b293f889f827ec5769ad6ca601294284d9a1f24)** to **[271d427](https://github.com/sagemath/sagetrac-mirror/commit/271d42733078659c963550e07970440101a73ab7)**



---

archive/issue_comments_506277.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6b2fc4f0f461b2f18aedf49ba238db7a7fdc8b3\">f6b2fc4</a></td><td><code>src/sage/repl/interpreter.py: Fix a doctest for editable installs of sagelib</code></td></tr></table>\n",
    "created_at": "2021-02-13T02:02:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506277",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29" align="right">Comment 29</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6b2fc4f0f461b2f18aedf49ba238db7a7fdc8b3">f6b2fc4</a></td><td><code>src/sage/repl/interpreter.py: Fix a doctest for editable installs of sagelib</code></td></tr></table>




---

archive/issue_comments_506278.json:
```json
{
    "body": "Changed commit from **[271d427](https://github.com/sagemath/sagetrac-mirror/commit/271d42733078659c963550e07970440101a73ab7)** to **[f6b2fc4](https://github.com/sagemath/sagetrac-mirror/commit/f6b2fc4f0f461b2f18aedf49ba238db7a7fdc8b3)**",
    "created_at": "2021-02-13T02:02:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506278",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[271d427](https://github.com/sagemath/sagetrac-mirror/commit/271d42733078659c963550e07970440101a73ab7)** to **[f6b2fc4](https://github.com/sagemath/sagetrac-mirror/commit/f6b2fc4f0f461b2f18aedf49ba238db7a7fdc8b3)**



---

archive/issue_events_414197.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T02:02:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414197"
}
```



---

archive/issue_events_414198.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T02:02:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414198"
}
```



---

archive/issue_comments_506279.json:
```json
{
    "body": "Changed dependencies from **#30770, #30912, #31357, #31365, #31389** to **#30770, #30912, #31357, #31365, #31389, #31390**",
    "created_at": "2021-02-13T02:07:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506279",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30770, #30912, #31357, #31365, #31389** to **#30770, #30912, #31357, #31365, #31389, #31390**



---

archive/issue_comments_506280.json:
```json
{
    "body": "Changed commit from **[f6b2fc4](https://github.com/sagemath/sagetrac-mirror/commit/f6b2fc4f0f461b2f18aedf49ba238db7a7fdc8b3)** to **[e5d47ce](https://github.com/sagemath/sagetrac-mirror/commit/e5d47ce731d44f099d635172b34654481eb7e13b)**",
    "created_at": "2021-02-13T02:09:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506280",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f6b2fc4](https://github.com/sagemath/sagetrac-mirror/commit/f6b2fc4f0f461b2f18aedf49ba238db7a7fdc8b3)** to **[e5d47ce](https://github.com/sagemath/sagetrac-mirror/commit/e5d47ce731d44f099d635172b34654481eb7e13b)**



---

archive/issue_comments_506281.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9a0731aa00a6eace3b4c779b3399df898286d112\">9a0731a</a></td><td><code>sage.interacs.debugger: Remove deprecated module</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e5d47ce731d44f099d635172b34654481eb7e13b\">e5d47ce</a></td><td><code>Merge branch 't/31390/remove_deprecated_sage_interacts_debugger' into t/31377/__configure___enable_editable</code></td></tr></table>\n",
    "created_at": "2021-02-13T02:09:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506281",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32" align="right">Comment 32</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9a0731aa00a6eace3b4c779b3399df898286d112">9a0731a</a></td><td><code>sage.interacs.debugger: Remove deprecated module</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e5d47ce731d44f099d635172b34654481eb7e13b">e5d47ce</a></td><td><code>Merge branch 't/31390/remove_deprecated_sage_interacts_debugger' into t/31377/__configure___enable_editable</code></td></tr></table>




---

archive/issue_comments_506282.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nNow the documentation builds OK and also `make ptest` is fine.",
    "created_at": "2021-02-13T02:10:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506282",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:33" align="right">Comment 33</div>

Now the documentation builds OK and also `make ptest` is fine.



---

archive/issue_comments_506283.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nCan you please include the most recent version of setup.py from #30371. Thanks!",
    "created_at": "2021-02-13T09:24:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506283",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:34" align="right">Comment 34</div>

Can you please include the most recent version of setup.py from #30371. Thanks!



---

archive/issue_events_414199.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-02-13T09:24:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414199"
}
```



---

archive/issue_events_414200.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-02-13T09:24:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414200"
}
```



---

archive/issue_comments_506284.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nThe changes there conflict with the changes done and tested here already.",
    "created_at": "2021-02-13T18:24:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506284",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">Comment 35</div>

The changes there conflict with the changes done and tested here already.



---

archive/issue_events_414201.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T18:24:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414201"
}
```



---

archive/issue_events_414202.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T18:24:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414202"
}
```



---

archive/issue_comments_506285.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\n(Let's please get this in - unless there are problems on this ticket that need solving here. Otherwise please merge this branch into #30371, resolving the conflicts, and let me know)",
    "created_at": "2021-02-13T18:39:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506285",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:36" align="right">Comment 36</div>

(Let's please get this in - unless there are problems on this ticket that need solving here. Otherwise please merge this branch into #30371, resolving the conflicts, and let me know)



---

archive/issue_comments_506286.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nReplying to [@mkoeppe](#comment%3A35):\n> The changes there conflict with the changes done and tested here already.\n\nWhat conflicts do you mean?\nI was referring to the improvements to this code:\n\n```\n+# Exclude a few files if the corresponding distribution is not loaded\n+optional_packages = ['mcqd', 'bliss', 'tdlib', 'primecount',\n+                     'coxeter3', 'fes', 'sirocco', 'meataxe']\n+not_installed_packages = [package for package in optional_packages\n+                          if not is_package_installed_and_updated(package)]\n+\n+distributions_to_exclude = [f\"sage-{pkg}\"\n+                            for pkg in not_installed_packages]\n+files_to_exclude = filter_cython_sources(SAGE_SRC, distributions_to_exclude)\n+\n+log.debug(f\"files_to_exclude = {files_to_exclude}\")\n+\n+python_packages = find_namespace_packages(where=SAGE_SRC, exclude=['bin', 'doc'])\n+log.debug(f\"python_packages = {python_packages}\")\n+\n+log.info(f\"Discovered Python/Cython sources, time: {(time.time() - t):.2f} seconds.\")\n+\n+# from sage_build_cython:\n+import Cython.Compiler.Options\n+Cython.Compiler.Options.embed_pos_in_docstring = True\n+\n+try:\n+    log.info(\"Generating auto-generated sources\")\n+    from sage_setup.autogen import autogen_all\n+    autogen_all()\n+\n+    from Cython.Build import cythonize\n+    from sage.env import cython_aliases, sage_include_directories\n+    extensions = cythonize(\n+        [\"**/*.pyx\"],\n+        exclude=files_to_exclude,\n+        include_path=sage_include_directories(use_sources=True) + ['.'],\n+        compile_time_env=compile_time_env_variables(),\n+        compiler_directives=compiler_directives(False),\n+        aliases=cython_aliases(),\n+        create_extension=create_extension,\n+        nthreads=4)\n+except Exception as exception:\n+    log.warn(f\"Exception while generating and cythonizing source files: {exception}\")\n+    extensions = None\n```\n\nThis has a few problems/issues:\n- The first few lines still raise an exception if Cython (and maybe other packages) are not installed.\n- You want to auto-generate code before filtering it / excluding parts of it.\n- The exception catch is to general and was meant to only capture module import errors.\n\nAll these things are fixed in #30371.\n-",
    "created_at": "2021-02-13T18:50:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506286",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:38" align="right">Comment 38</div>

Replying to [@mkoeppe](#comment%3A35):
> The changes there conflict with the changes done and tested here already.

What conflicts do you mean?
I was referring to the improvements to this code:

```
+# Exclude a few files if the corresponding distribution is not loaded
+optional_packages = ['mcqd', 'bliss', 'tdlib', 'primecount',
+                     'coxeter3', 'fes', 'sirocco', 'meataxe']
+not_installed_packages = [package for package in optional_packages
+                          if not is_package_installed_and_updated(package)]
+
+distributions_to_exclude = [f"sage-{pkg}"
+                            for pkg in not_installed_packages]
+files_to_exclude = filter_cython_sources(SAGE_SRC, distributions_to_exclude)
+
+log.debug(f"files_to_exclude = {files_to_exclude}")
+
+python_packages = find_namespace_packages(where=SAGE_SRC, exclude=['bin', 'doc'])
+log.debug(f"python_packages = {python_packages}")
+
+log.info(f"Discovered Python/Cython sources, time: {(time.time() - t):.2f} seconds.")
+
+# from sage_build_cython:
+import Cython.Compiler.Options
+Cython.Compiler.Options.embed_pos_in_docstring = True
+
+try:
+    log.info("Generating auto-generated sources")
+    from sage_setup.autogen import autogen_all
+    autogen_all()
+
+    from Cython.Build import cythonize
+    from sage.env import cython_aliases, sage_include_directories
+    extensions = cythonize(
+        ["**/*.pyx"],
+        exclude=files_to_exclude,
+        include_path=sage_include_directories(use_sources=True) + ['.'],
+        compile_time_env=compile_time_env_variables(),
+        compiler_directives=compiler_directives(False),
+        aliases=cython_aliases(),
+        create_extension=create_extension,
+        nthreads=4)
+except Exception as exception:
+    log.warn(f"Exception while generating and cythonizing source files: {exception}")
+    extensions = None
```

This has a few problems/issues:
- The first few lines still raise an exception if Cython (and maybe other packages) are not installed.
- You want to auto-generate code before filtering it / excluding parts of it.
- The exception catch is to general and was meant to only capture module import errors.

All these things are fixed in #30371.
-



---

archive/issue_comments_506287.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nOK, fine, I'll do the merging.",
    "created_at": "2021-02-13T19:07:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506287",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:39" align="right">Comment 39</div>

OK, fine, I'll do the merging.



---

archive/issue_comments_506288.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nConcerning this change:\n\n```\n # distutils: language = c++\n+# distutils: extra_compile_args = -std=c++11\n```\nWoudn't it make sense to specify `-std=c++11` automatically once `language = c++` is set? In fact there is code that looks like it is doing this job in sage_build_cython.\n\nI think also the cython files in libs/singular need similar changes (at least in #30371 errors are thrown otherwise).",
    "created_at": "2021-02-13T19:08:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506288",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:40" align="right">Comment 40</div>

Concerning this change:

```
 # distutils: language = c++
+# distutils: extra_compile_args = -std=c++11
```
Woudn't it make sense to specify `-std=c++11` automatically once `language = c++` is set? In fact there is code that looks like it is doing this job in sage_build_cython.

I think also the cython files in libs/singular need similar changes (at least in #30371 errors are thrown otherwise).



---

archive/issue_comments_506289.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nReplying to [@tobiasdiez](#comment%3A40):\n> Concerning this change:\n> \n> ```\n>  # distutils: language = c++\n> +# distutils: extra_compile_args = -std=c++11\n> ```\n> Woudn't it make sense to specify `-std=c++11` automatically once `language = c++` is set? In fact there is code that looks like it is doing this job in sage_build_cython.\n\nOf course, but you decided not to use the existing code. So I have made the changes that make it work.",
    "created_at": "2021-02-13T19:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506289",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:41" align="right">Comment 41</div>

Replying to [@tobiasdiez](#comment%3A40):
> Concerning this change:
> 
> ```
>  # distutils: language = c++
> +# distutils: extra_compile_args = -std=c++11
> ```
> Woudn't it make sense to specify `-std=c++11` automatically once `language = c++` is set? In fact there is code that looks like it is doing this job in sage_build_cython.

Of course, but you decided not to use the existing code. So I have made the changes that make it work.



---

archive/issue_comments_506290.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\nImportant to keep in mind that I have created this ticket so that we can ship something in Sage 9.3 that works. So let's please keep focused on what is described here on the ticket description.\n\nReplying to [@tobiasdiez](#comment%3A38):\n> - The first few lines still raise an exception if Cython (and maybe other packages) are not installed.\n\nNot important for this ticket; we do have Cython. \n\n> - You want to auto-generate code before filtering it / excluding parts of it.\n\nWhy? Even after modularization, there will be exactly 1 module that will contain the autogenerated files.",
    "created_at": "2021-02-13T19:18:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506290",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:42" align="right">Comment 42</div>

Important to keep in mind that I have created this ticket so that we can ship something in Sage 9.3 that works. So let's please keep focused on what is described here on the ticket description.

Replying to [@tobiasdiez](#comment%3A38):
> - The first few lines still raise an exception if Cython (and maybe other packages) are not installed.

Not important for this ticket; we do have Cython. 

> - You want to auto-generate code before filtering it / excluding parts of it.

Why? Even after modularization, there will be exactly 1 module that will contain the autogenerated files.



---

archive/issue_comments_506291.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">Comment 43</div>\n\nReplying to [@mkoeppe](#comment%3A41):\n> Replying to [@tobiasdiez](#comment%3A40):\n> > Concerning this change:\n> > \n> > ```\n> >  # distutils: language = c++\n> > +# distutils: extra_compile_args = -std=c++11\n> > ```\n> > Woudn't it make sense to specify `-std=c++11` automatically once `language = c++` is set? In fact there is code that looks like it is doing this job in sage_build_cython.\n\n> \n> Of course, but you decided not to use the existing code. So I have made the changes that make it work.\n> \n\nI couldn't make it work with the sage_build_cython command, yes. So changing `create_extension` in `sage_setup/extensions.py` would be a better solution then?",
    "created_at": "2021-02-13T19:36:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506291",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:43" align="right">Comment 43</div>

Replying to [@mkoeppe](#comment%3A41):
> Replying to [@tobiasdiez](#comment%3A40):
> > Concerning this change:
> > 
> > ```
> >  # distutils: language = c++
> > +# distutils: extra_compile_args = -std=c++11
> > ```
> > Woudn't it make sense to specify `-std=c++11` automatically once `language = c++` is set? In fact there is code that looks like it is doing this job in sage_build_cython.

> 
> Of course, but you decided not to use the existing code. So I have made the changes that make it work.
> 

I couldn't make it work with the sage_build_cython command, yes. So changing `create_extension` in `sage_setup/extensions.py` would be a better solution then?



---

archive/issue_comments_506292.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">Comment 44</div>\n\nYour approach of starting the build system from scratch has certainly been valuable, so that we can see what parts of the code are needed.\n\nIn terms of complexity of code, I think adding the small of number of explicit directives to the files may actually be preferable to the more complex code regarding the `-std` flags in `sage_build_cython`.\nLet's try it out as is. \n\nIn some follow-up ticket, a more general solution may be needed at some point. Especially when use of c++14/17 becomes more widespread, then fixing things to `std=c++11` may no longer be the right thing.\nLet's do this when it becomes an issue; not now.",
    "created_at": "2021-02-13T19:53:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506292",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:44" align="right">Comment 44</div>

Your approach of starting the build system from scratch has certainly been valuable, so that we can see what parts of the code are needed.

In terms of complexity of code, I think adding the small of number of explicit directives to the files may actually be preferable to the more complex code regarding the `-std` flags in `sage_build_cython`.
Let's try it out as is. 

In some follow-up ticket, a more general solution may be needed at some point. Especially when use of c++14/17 becomes more widespread, then fixing things to `std=c++11` may no longer be the right thing.
Let's do this when it becomes an issue; not now.



---

archive/issue_comments_506293.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">Comment 47</div>\n\nDoes this now instead implement `./configure --enable-build-as-root`? It sounds like that's related to `sudo make`; is that what's intended?",
    "created_at": "2021-02-16T19:41:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506293",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:47" align="right">Comment 47</div>

Does this now instead implement `./configure --enable-build-as-root`? It sounds like that's related to `sudo make`; is that what's intended?



---

archive/issue_comments_506294.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">Comment 48</div>\n\nThanks for catching the typo in the help string.",
    "created_at": "2021-02-16T19:45:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506294",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:48" align="right">Comment 48</div>

Thanks for catching the typo in the help string.



---

archive/issue_comments_506295.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">Comment 49</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50f5010883bee3f2fc459848f2dac68d699bce87\">50f5010</a></td><td><code>build/pkgs/sagelib/spkg-configure.m4: Fix help string of --enable-editable</code></td></tr></table>\n",
    "created_at": "2021-02-16T19:47:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506295",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:49" align="right">Comment 49</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50f5010883bee3f2fc459848f2dac68d699bce87">50f5010</a></td><td><code>build/pkgs/sagelib/spkg-configure.m4: Fix help string of --enable-editable</code></td></tr></table>




---

archive/issue_comments_506296.json:
```json
{
    "body": "Changed commit from **[e5d47ce](https://github.com/sagemath/sagetrac-mirror/commit/e5d47ce731d44f099d635172b34654481eb7e13b)** to **[50f5010](https://github.com/sagemath/sagetrac-mirror/commit/50f5010883bee3f2fc459848f2dac68d699bce87)**",
    "created_at": "2021-02-16T19:47:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506296",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e5d47ce](https://github.com/sagemath/sagetrac-mirror/commit/e5d47ce731d44f099d635172b34654481eb7e13b)** to **[50f5010](https://github.com/sagemath/sagetrac-mirror/commit/50f5010883bee3f2fc459848f2dac68d699bce87)**



---

archive/issue_comments_506297.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">Comment 50</div>\n\nI like it. Sometimes, I wanted to look into a C/C++ file that cython generated and I just couldn't locate it recently. No it's sitting all there for you.\n\nWhat vanished though is the progress report, how many files yet need to be compiled. I like this feature, because it tells you whether you should wait on it or whether you should carry on and do something else.",
    "created_at": "2021-02-16T20:07:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506297",
    "user": "https://github.com/kliem"
}
```

<div id="comment:50" align="right">Comment 50</div>

I like it. Sometimes, I wanted to look into a C/C++ file that cython generated and I just couldn't locate it recently. No it's sitting all there for you.

What vanished though is the progress report, how many files yet need to be compiled. I like this feature, because it tells you whether you should wait on it or whether you should carry on and do something else.



---

archive/issue_comments_506298.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">Comment 51</div>\n\nReplying to [@kliem](#comment%3A50):\n> What vanished though is the progress report, how many files yet need to be compiled. I like this feature, because it tells you whether you should wait on it or whether you should carry on and do something else.\n\nTobias wrote this as a minimal version using standard setuptools + cython. Let's keep adding additional features of this kind in mind for possible follow-up tickets.",
    "created_at": "2021-02-16T20:10:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506298",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:51" align="right">Comment 51</div>

Replying to [@kliem](#comment%3A50):
> What vanished though is the progress report, how many files yet need to be compiled. I like this feature, because it tells you whether you should wait on it or whether you should carry on and do something else.

Tobias wrote this as a minimal version using standard setuptools + cython. Let's keep adding additional features of this kind in mind for possible follow-up tickets.



---

archive/issue_comments_506299.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">Comment 52</div>\n\nOk. Just mentioned that this is missing and I like it back, if possible. I think I would even switch to this, without the counter. Just because it is nice to have the files where you think the should be.\n\nYou introduced a trailing whitespace in `src/sage_setup/find.py`.",
    "created_at": "2021-02-16T20:24:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506299",
    "user": "https://github.com/kliem"
}
```

<div id="comment:52" align="right">Comment 52</div>

Ok. Just mentioned that this is missing and I like it back, if possible. I think I would even switch to this, without the counter. Just because it is nice to have the files where you think the should be.

You introduced a trailing whitespace in `src/sage_setup/find.py`.



---

archive/issue_comments_506300.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">Comment 53</div>\n\nWhy is it `python3` and not `$PYTHON`?\n\n```diff\n+if [ \"$SAGE_EDITABLE\" = yes ]; then\n+    time python3 -m pip install --verbose --no-deps --no-index --no-build-isolation --isolated --editable . || exit 1\n+else\n+    time \"$PYTHON\" -u setup.py --no-user-cfg build install || exit 1\n+fi\n+\n```",
    "created_at": "2021-02-16T20:30:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506300",
    "user": "https://github.com/kliem"
}
```

<div id="comment:53" align="right">Comment 53</div>

Why is it `python3` and not `$PYTHON`?

```diff
+if [ "$SAGE_EDITABLE" = yes ]; then
+    time python3 -m pip install --verbose --no-deps --no-index --no-build-isolation --isolated --editable . || exit 1
+else
+    time "$PYTHON" -u setup.py --no-user-cfg build install || exit 1
+fi
+
```



---

archive/issue_comments_506301.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">Comment 54</div>\n\nYou freshly introduced `from distutils.command.build_ext import build_ext` in `/src/sage_setup/command/sage_build_ext_minimal.py`.\nI think this should be replaced by setuptools somehow or at least import setuptools before as to get rid of setuptools.",
    "created_at": "2021-02-16T20:40:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506301",
    "user": "https://github.com/kliem"
}
```

<div id="comment:54" align="right">Comment 54</div>

You freshly introduced `from distutils.command.build_ext import build_ext` in `/src/sage_setup/command/sage_build_ext_minimal.py`.
I think this should be replaced by setuptools somehow or at least import setuptools before as to get rid of setuptools.



---

archive/issue_comments_506302.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">Comment 55</div>\n\nWe should probably merge #30984 too.",
    "created_at": "2021-02-16T20:55:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506302",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:55" align="right">Comment 55</div>

We should probably merge #30984 too.



---

archive/issue_comments_506303.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">Comment 56</div>\n\nReplying to [@kliem](#comment%3A53):\n> Why is it `python3` and not `$PYTHON`?\n> \n> ```diff\n> +if [ \"$SAGE_EDITABLE\" = yes ]; then\n> +    time python3 -m pip install --verbose --no-deps --no-index --no-build-isolation --isolated --editable . || exit 1\n> +else\n> +    time \"$PYTHON\" -u setup.py --no-user-cfg build install || exit 1\n> +fi\n> +\n> ```\n\nThanks for spotting this inconsistency. Actually, both should be `python3` (since #30731, which replaced `sage-python23`).",
    "created_at": "2021-02-16T20:58:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506303",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:56" align="right">Comment 56</div>

Replying to [@kliem](#comment%3A53):
> Why is it `python3` and not `$PYTHON`?
> 
> ```diff
> +if [ "$SAGE_EDITABLE" = yes ]; then
> +    time python3 -m pip install --verbose --no-deps --no-index --no-build-isolation --isolated --editable . || exit 1
> +else
> +    time "$PYTHON" -u setup.py --no-user-cfg build install || exit 1
> +fi
> +
> ```

Thanks for spotting this inconsistency. Actually, both should be `python3` (since #30731, which replaced `sage-python23`).



---

archive/issue_comments_506304.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">Comment 57</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c5e9c3b56070a9a1ef1040555da83365908f286\">8c5e9c3</a></td><td><code>build/pkgs/sagelib/spkg-install: python3, not $PYTHON</code></td></tr></table>\n",
    "created_at": "2021-02-16T20:58:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506304",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:57" align="right">Comment 57</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c5e9c3b56070a9a1ef1040555da83365908f286">8c5e9c3</a></td><td><code>build/pkgs/sagelib/spkg-install: python3, not $PYTHON</code></td></tr></table>




---

archive/issue_comments_506305.json:
```json
{
    "body": "Changed commit from **[50f5010](https://github.com/sagemath/sagetrac-mirror/commit/50f5010883bee3f2fc459848f2dac68d699bce87)** to **[8c5e9c3](https://github.com/sagemath/sagetrac-mirror/commit/8c5e9c3b56070a9a1ef1040555da83365908f286)**",
    "created_at": "2021-02-16T20:58:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506305",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[50f5010](https://github.com/sagemath/sagetrac-mirror/commit/50f5010883bee3f2fc459848f2dac68d699bce87)** to **[8c5e9c3](https://github.com/sagemath/sagetrac-mirror/commit/8c5e9c3b56070a9a1ef1040555da83365908f286)**



---

archive/issue_comments_506306.json:
```json
{
    "body": "Changed commit from **[8c5e9c3](https://github.com/sagemath/sagetrac-mirror/commit/8c5e9c3b56070a9a1ef1040555da83365908f286)** to **[0df54f7](https://github.com/sagemath/sagetrac-mirror/commit/0df54f76dee2089b5c14e3db8f5ef8c5a2d04796)**",
    "created_at": "2021-02-16T21:01:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506306",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8c5e9c3](https://github.com/sagemath/sagetrac-mirror/commit/8c5e9c3b56070a9a1ef1040555da83365908f286)** to **[0df54f7](https://github.com/sagemath/sagetrac-mirror/commit/0df54f76dee2089b5c14e3db8f5ef8c5a2d04796)**



---

archive/issue_comments_506307.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">Comment 58</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0df54f76dee2089b5c14e3db8f5ef8c5a2d04796\">0df54f7</a></td><td><code>src/sage_setup/find.py: Fix whitespace</code></td></tr></table>\n",
    "created_at": "2021-02-16T21:01:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506307",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:58" align="right">Comment 58</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0df54f76dee2089b5c14e3db8f5ef8c5a2d04796">0df54f7</a></td><td><code>src/sage_setup/find.py: Fix whitespace</code></td></tr></table>




---

archive/issue_comments_506308.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">Comment 59</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/acd7e312d4d802ee9e80c7faa0548434bf51c146\">acd7e31</a></td><td><code>sage_setup/command/sage_build_ext_minimal.py: Use setuptools instead of distutils, as in #30984</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a63e6157874d8be7e29b078d646936142f4bdcea\">a63e615</a></td><td><code>src/setup.py: Import setuptools before distutils, as in #30984</code></td></tr></table>\n",
    "created_at": "2021-02-16T21:09:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506308",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:59" align="right">Comment 59</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/acd7e312d4d802ee9e80c7faa0548434bf51c146">acd7e31</a></td><td><code>sage_setup/command/sage_build_ext_minimal.py: Use setuptools instead of distutils, as in #30984</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a63e6157874d8be7e29b078d646936142f4bdcea">a63e615</a></td><td><code>src/setup.py: Import setuptools before distutils, as in #30984</code></td></tr></table>




---

archive/issue_comments_506309.json:
```json
{
    "body": "Changed commit from **[0df54f7](https://github.com/sagemath/sagetrac-mirror/commit/0df54f76dee2089b5c14e3db8f5ef8c5a2d04796)** to **[a63e615](https://github.com/sagemath/sagetrac-mirror/commit/a63e6157874d8be7e29b078d646936142f4bdcea)**",
    "created_at": "2021-02-16T21:09:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506309",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0df54f7](https://github.com/sagemath/sagetrac-mirror/commit/0df54f76dee2089b5c14e3db8f5ef8c5a2d04796)** to **[a63e615](https://github.com/sagemath/sagetrac-mirror/commit/a63e6157874d8be7e29b078d646936142f4bdcea)**



---

archive/issue_comments_506310.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">Comment 60</div>\n\nReplying to [@kliem](#comment%3A50):\n> What vanished though is the progress report, how many files yet need to be compiled. I like this feature, because it tells you whether you should wait on it or whether you should carry on and do something else.\n\nI think a progress bar will not be easy. The new version directly uses the cythonize method, which doesn't seem to have any configuration in this direction, see https://cython.readthedocs.io/en/latest/src/userguide/source_files_and_compilation.html?highlight=cythonize#cythonize-arguments.",
    "created_at": "2021-02-16T21:14:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506310",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:60" align="right">Comment 60</div>

Replying to [@kliem](#comment%3A50):
> What vanished though is the progress report, how many files yet need to be compiled. I like this feature, because it tells you whether you should wait on it or whether you should carry on and do something else.

I think a progress bar will not be easy. The new version directly uses the cythonize method, which doesn't seem to have any configuration in this direction, see https://cython.readthedocs.io/en/latest/src/userguide/source_files_and_compilation.html?highlight=cythonize#cythonize-arguments.



---

archive/issue_comments_506311.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">Comment 61</div>\n\nI have created #31406 as a place for follow-up items.",
    "created_at": "2021-02-16T21:16:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506311",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:61" align="right">Comment 61</div>

I have created #31406 as a place for follow-up items.



---

archive/issue_comments_506312.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">Comment 62</div>\n\nReplying to [@mkoeppe](#comment%3A44):\n\n> In terms of complexity of code, I think adding the small of number of explicit directives to the files may actually be preferable to the more complex code regarding the `-std` flags in `sage_build_cython`.\n> Let's try it out as is. \n\nOk, sounds good to me. But notice that explicitly specifying the `std` changes the behavior on cygwin (for a \"normal\" build) since the following code in sage_build_cython is no longer invoked:\n\n```\n            if sys.platform == 'cygwin':\n                # Cygwin (particularly newlib, Cygwin's libc) has some bugs\n                # with strict ANSI C/C++ in some headers; using the GNU\n                # extensions typically fares better:\n                # https://trac.sagemath.org/ticket/24192\n                if cplusplus:\n                    cflags.append(\"-std=gnu++11\")\n                else:\n                    cflags.append(\"-std=gnu99\")\n\n```\nI don't know if this may have negative side effects.",
    "created_at": "2021-02-16T21:19:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506312",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:62" align="right">Comment 62</div>

Replying to [@mkoeppe](#comment%3A44):

> In terms of complexity of code, I think adding the small of number of explicit directives to the files may actually be preferable to the more complex code regarding the `-std` flags in `sage_build_cython`.
> Let's try it out as is. 

Ok, sounds good to me. But notice that explicitly specifying the `std` changes the behavior on cygwin (for a "normal" build) since the following code in sage_build_cython is no longer invoked:

```
            if sys.platform == 'cygwin':
                # Cygwin (particularly newlib, Cygwin's libc) has some bugs
                # with strict ANSI C/C++ in some headers; using the GNU
                # extensions typically fares better:
                # https://trac.sagemath.org/ticket/24192
                if cplusplus:
                    cflags.append("-std=gnu++11")
                else:
                    cflags.append("-std=gnu99")

```
I don't know if this may have negative side effects.



---

archive/issue_comments_506313.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">Comment 63</div>\n\nThanks for pointing this out; we'll see when we add automated tests for `--enable-editable` to the Cygwin GH Actions. (in a ticket after #31064 is merged)",
    "created_at": "2021-02-16T21:40:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506313",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:63" align="right">Comment 63</div>

Thanks for pointing this out; we'll see when we add automated tests for `--enable-editable` to the Cygwin GH Actions. (in a ticket after #31064 is merged)



---

archive/issue_comments_506314.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">Comment 64</div>\n\nA few more observations:\n- There is currently no documentation for how to use the inplace install (and why).\n- Running the configure command yields the following warning at the end:\n\n```\n....\nconfig.status: creating directory local/var/lib/sage/installed\nconfigure: WARNING: unrecognized options: --enable-editable\nconfigure:\n\n    notice: the following SPKGs did not find equivalent system packages\n...\n```\n- My only means to test this on mac is with the github action added in #30371. Admittedly, this is using a lightly different setup, but since the sage inplace install fails, I wanted to point this out. First of all, the files in `sage/libs/singular` don't specify that they should be compiled with `language=c++` and `std=c++11`. Secondly, there are many errors of the form\n\n```\n /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/usr/include/nl_types.h:97:1: error: unknown type name 'nl_catd'\n    nl_catd  catopen(const char *, int);\n    ^\n```\nSee e.g. https://github.com/tobiasdiez/sage/runs/1893534204?check_suite_focus=true\n\n- On Linux (with wsl), the make build fails with\n\n```\n[pplpy-0.8.6] Copying package files from temporary location /mnt/d/Programming/sage/local/var/tmp/sage/build/pplpy-0.8.6/inst to /mnt/d/Programming/sage/local\n[pplpy-0.8.6] Running post-install script for pplpy-0.8.6.\n[pplpy-0.8.6] Traceback (most recent call last):\n[pplpy-0.8.6]   File \"/mnt/d/Programming/sage/local/bin/sphinx-build\", line 5, in <module>\n[pplpy-0.8.6]     from sphinx.cmd.build import main\n[pplpy-0.8.6]   File \"/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/cmd/build.py\", line 25, in <module>\n[pplpy-0.8.6]     from sphinx.application import Sphinx\n[pplpy-0.8.6]   File \"/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/application.py\", line 31, in <module>\n[pplpy-0.8.6]     from sphinx.config import Config\n[pplpy-0.8.6]   File \"/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/config.py\", line 28, in <module>\n[pplpy-0.8.6]     from sphinx.util.tags import Tags\n[pplpy-0.8.6]   File \"/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/util/tags.py\", line 11, in <module>\n[pplpy-0.8.6]     from jinja2 import nodes\n[pplpy-0.8.6]   File \"/mnt/d/Programming/sage/local/lib/python3.8/site-packages/jinja2/__init__.py\", line 6, in <module>\n[pplpy-0.8.6]     from markupsafe import escape\n[pplpy-0.8.6] ValueError: source code string cannot contain null bytes\n[pplpy-0.8.6] make[5]: *** [Makefile:21: html] Error 1\n[pplpy-0.8.6] cp: cannot stat 'build/html/*': No such file or directory\n```\nThat's probably not related to this ticket, but prevents me from testing it.",
    "created_at": "2021-02-16T22:09:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506314",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:64" align="right">Comment 64</div>

A few more observations:
- There is currently no documentation for how to use the inplace install (and why).
- Running the configure command yields the following warning at the end:

```
....
config.status: creating directory local/var/lib/sage/installed
configure: WARNING: unrecognized options: --enable-editable
configure:

    notice: the following SPKGs did not find equivalent system packages
...
```
- My only means to test this on mac is with the github action added in #30371. Admittedly, this is using a lightly different setup, but since the sage inplace install fails, I wanted to point this out. First of all, the files in `sage/libs/singular` don't specify that they should be compiled with `language=c++` and `std=c++11`. Secondly, there are many errors of the form

```
 /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/usr/include/nl_types.h:97:1: error: unknown type name 'nl_catd'
    nl_catd  catopen(const char *, int);
    ^
```
See e.g. https://github.com/tobiasdiez/sage/runs/1893534204?check_suite_focus=true

- On Linux (with wsl), the make build fails with

```
[pplpy-0.8.6] Copying package files from temporary location /mnt/d/Programming/sage/local/var/tmp/sage/build/pplpy-0.8.6/inst to /mnt/d/Programming/sage/local
[pplpy-0.8.6] Running post-install script for pplpy-0.8.6.
[pplpy-0.8.6] Traceback (most recent call last):
[pplpy-0.8.6]   File "/mnt/d/Programming/sage/local/bin/sphinx-build", line 5, in <module>
[pplpy-0.8.6]     from sphinx.cmd.build import main
[pplpy-0.8.6]   File "/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/cmd/build.py", line 25, in <module>
[pplpy-0.8.6]     from sphinx.application import Sphinx
[pplpy-0.8.6]   File "/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/application.py", line 31, in <module>
[pplpy-0.8.6]     from sphinx.config import Config
[pplpy-0.8.6]   File "/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/config.py", line 28, in <module>
[pplpy-0.8.6]     from sphinx.util.tags import Tags
[pplpy-0.8.6]   File "/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/util/tags.py", line 11, in <module>
[pplpy-0.8.6]     from jinja2 import nodes
[pplpy-0.8.6]   File "/mnt/d/Programming/sage/local/lib/python3.8/site-packages/jinja2/__init__.py", line 6, in <module>
[pplpy-0.8.6]     from markupsafe import escape
[pplpy-0.8.6] ValueError: source code string cannot contain null bytes
[pplpy-0.8.6] make[5]: *** [Makefile:21: html] Error 1
[pplpy-0.8.6] cp: cannot stat 'build/html/*': No such file or directory
```
That's probably not related to this ticket, but prevents me from testing it.



---

archive/issue_comments_506315.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">Comment 65</div>\n\nReplying to [@mkoeppe](#comment%3A63):\n> Thanks for pointing this out; we'll see when we add automated tests for `--enable-editable` to the Cygwin GH Actions. (in a ticket after #31064 is merged)\n\nThe point is that explicitly specifying `std` in the cython file also overrides it for the sage-distribution compilation, i.e. the one using the setup.py in build.",
    "created_at": "2021-02-16T22:12:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506315",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:65" align="right">Comment 65</div>

Replying to [@mkoeppe](#comment%3A63):
> Thanks for pointing this out; we'll see when we add automated tests for `--enable-editable` to the Cygwin GH Actions. (in a ticket after #31064 is merged)

The point is that explicitly specifying `std` in the cython file also overrides it for the sage-distribution compilation, i.e. the one using the setup.py in build.



---

archive/issue_comments_506316.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">Comment 66</div>\n\nReplying to [@tobiasdiez](#comment%3A64):\n> - Running the configure command yields the following warning at the end:\n> \n> ```\n> ....\n> config.status: creating directory local/var/lib/sage/installed\n> configure: WARNING: unrecognized options: --enable-editable\n> ```\n\n>\n\nForgot to run `./bootstrap`?",
    "created_at": "2021-02-16T22:26:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506316",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:66" align="right">Comment 66</div>

Replying to [@tobiasdiez](#comment%3A64):
> - Running the configure command yields the following warning at the end:
> 
> ```
> ....
> config.status: creating directory local/var/lib/sage/installed
> configure: WARNING: unrecognized options: --enable-editable
> ```

>

Forgot to run `./bootstrap`?



---

archive/issue_comments_506317.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">Comment 67</div>\n\nReplying to [@tobiasdiez](#comment%3A64):\n> - My only means to test this on mac is with the github action added in #30371.\n\nLet's please not pull a discussion of these experimental GH actions from #30371 into this ticket.\n\nIf we add automatic testing, we will do it on the basis of the existing GH actions.",
    "created_at": "2021-02-16T22:30:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506317",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:67" align="right">Comment 67</div>

Replying to [@tobiasdiez](#comment%3A64):
> - My only means to test this on mac is with the github action added in #30371.

Let's please not pull a discussion of these experimental GH actions from #30371 into this ticket.

If we add automatic testing, we will do it on the basis of the existing GH actions.



---

archive/issue_comments_506318.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">Comment 68</div>\n\nReplying to [@tobiasdiez](#comment%3A65):\n> Replying to [@mkoeppe](#comment%3A63):\n> > Thanks for pointing this out; we'll see when we add automated tests for `--enable-editable` to the Cygwin GH Actions. (in a ticket after #31064 is merged)\n\n> \n> The point is that explicitly specifying `std` in the cython file also overrides it for the sage-distribution compilation, i.e. the one using the setup.py in build. \n\nYes, it is a change and we are using portability testing to make sure that it does not break anything on the supported platforms.",
    "created_at": "2021-02-16T22:32:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506318",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:68" align="right">Comment 68</div>

Replying to [@tobiasdiez](#comment%3A65):
> Replying to [@mkoeppe](#comment%3A63):
> > Thanks for pointing this out; we'll see when we add automated tests for `--enable-editable` to the Cygwin GH Actions. (in a ticket after #31064 is merged)

> 
> The point is that explicitly specifying `std` in the cython file also overrides it for the sage-distribution compilation, i.e. the one using the setup.py in build. 

Yes, it is a change and we are using portability testing to make sure that it does not break anything on the supported platforms.



---

archive/issue_comments_506319.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">Comment 69</div>\n\nReplying to [@tobiasdiez](#comment%3A64):\n> A few more observations:\n> - There is currently no documentation for how to use the inplace install (and why).\n\nWell, I hope we can merge this ticket into the next beta and then ask developers to try it. We can document it in a follow-up ticket.",
    "created_at": "2021-02-16T22:34:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506319",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:69" align="right">Comment 69</div>

Replying to [@tobiasdiez](#comment%3A64):
> A few more observations:
> - There is currently no documentation for how to use the inplace install (and why).

Well, I hope we can merge this ticket into the next beta and then ask developers to try it. We can document it in a follow-up ticket.



---

archive/issue_comments_506320.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">Comment 70</div>\n\nReplying to [@tobiasdiez](#comment%3A64):\n> - On Linux (with wsl), the make build fails with\n> \n> ```\n> [pplpy-0.8.6] Copying package files from temporary location /mnt/d/Programming/sage/local/var/tmp/sage/build/pplpy-0.8.6/inst to /mnt/d/Programming/sage/local\n> [pplpy-0.8.6] Running post-install script for pplpy-0.8.6.\n> [pplpy-0.8.6]     from markupsafe import escape\n> [pplpy-0.8.6] ValueError: source code string cannot contain null bytes\n> [pplpy-0.8.6] make[5]: *** [Makefile:21: html] Error 1\n> [pplpy-0.8.6] cp: cannot stat 'build/html/*': No such file or directory\n> ```\n> That's probably not related to this ticket, but prevents me from testing it.\n\nI have not seen this before and I don't think it has anything to with the present ticket.\nPlease check if this also occurs with 9.3.beta7 and open a separate ticket if this problem is reproducible.",
    "created_at": "2021-02-16T22:37:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506320",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:70" align="right">Comment 70</div>

Replying to [@tobiasdiez](#comment%3A64):
> - On Linux (with wsl), the make build fails with
> 
> ```
> [pplpy-0.8.6] Copying package files from temporary location /mnt/d/Programming/sage/local/var/tmp/sage/build/pplpy-0.8.6/inst to /mnt/d/Programming/sage/local
> [pplpy-0.8.6] Running post-install script for pplpy-0.8.6.
> [pplpy-0.8.6]     from markupsafe import escape
> [pplpy-0.8.6] ValueError: source code string cannot contain null bytes
> [pplpy-0.8.6] make[5]: *** [Makefile:21: html] Error 1
> [pplpy-0.8.6] cp: cannot stat 'build/html/*': No such file or directory
> ```
> That's probably not related to this ticket, but prevents me from testing it.

I have not seen this before and I don't think it has anything to with the present ticket.
Please check if this also occurs with 9.3.beta7 and open a separate ticket if this problem is reproducible.



---

archive/issue_comments_506321.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">Comment 71</div>\n\nReplying to [@mkoeppe](#comment%3A66):\n> Forgot to run `./bootstrap`?\n\nThat fixed it indeed. \n\nThe pplpy error occurs also with the recent develop branch, so this is indeed unrelated to these changes. I've opened #31407 for this.",
    "created_at": "2021-02-16T22:45:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506321",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:71" align="right">Comment 71</div>

Replying to [@mkoeppe](#comment%3A66):
> Forgot to run `./bootstrap`?

That fixed it indeed. 

The pplpy error occurs also with the recent develop branch, so this is indeed unrelated to these changes. I've opened #31407 for this.



---

archive/issue_comments_506322.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">Comment 72</div>\n\nI'm getting a few doctest failures:\n\n```\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py\n**********************************************************************\nFile \"src/sage/repl/interpreter.py\", line 77, in sage.repl.interpreter\nFailed example:\n    print(\"dummy line\"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test\nExpected:\n    dummy line\n    ...\n    ZeroDivisionError...Traceback (most recent call last)\n    <ipython-input-...> in <module>...\n    ----> 1 Integer(1)/Integer(0)\n    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()\n    ...\n    -> ...                  raise ZeroDivisionError(\"rational division by zero\")\n       ...            x = <Rational> Rational.__new__(Rational)\n       ...            mpq_div_zz(x.value, ....value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\nGot:\n    dummy line\n    ---------------------------------------------------------------------------\n    ZeroDivisionError                         Traceback (most recent call last)\n    <ipython-input-1-72ac74c5f414> in <module>\n    ----> 1 Integer(1)/Integer(0)\n    <BLANKLINE>\n    /srv/public/kliem/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__truediv__()\n       2038         if type(left) is type(right):\n       2039             if mpz_sgn((<Integer>right).value) == 0:\n    -> 2040                 raise ZeroDivisionError(\"rational division by zero\")\n       2041             x = <Rational> Rational.__new__(Rational)\n       2042             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\n**********************************************************************\n1 item had failures:\n   1 of  20 in sage.repl.interpreter\n    [141 tests, 1 failure, 1.97 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 7.4 seconds\n    cpu time: 0.6 seconds\n    cumulative wall time: 2.0 seconds\nkliem@lech:~/localhome/sage$ sage -t --long --random-seed=0 src/sage/stats/hmm/hmm.pyx  # 1 doctest failed\nRunning doctests with ID 2021-02-17-08-07-40-53dddc3c.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx\n**********************************************************************\nFile \"src/sage/stats/hmm/hmm.pyx\", line 1234, in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch\nFailed example:\n    m.baum_welch(v,fix_emissions=True)\nExpected:\n    (-66.98630856918774, 100)\nGot:\n    (-66.98630856918776, 100)\n**********************************************************************\n1 item had failures:\n   1 of  14 in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch\n    [121 tests, 1 failure, 0.32 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.4 seconds\n    cpu time: 0.3 seconds\n    cumulative wall time: 0.3 seconds\nkliem@lech:~/localhome/sage$ sage -t --long --random-seed=0 src/sage_setup/find.py  # 6 doctests failed\nRunning doctests with ID 2021-02-17-08-07-42-447cd574.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 199, in sage_setup.find.filter_cython_sources\nFailed example:\n    'sage/graphs/graph_decompositions/tdlib.pyx' in cython_modules\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 264, in sage_setup.find.find_extra_files\nFailed example:\n    extras[\"sage/ext/interpreters\"]\nExpected:\n    ['.../src/sage/ext/interpreters/wrapper_cdf.pxd', ...wrapper_cdf.h...]\nGot:\n    ['/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pxd']\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 324, in sage_setup.find.installed_files_by_module\nFailed example:\n    (f,) = files_by_module['sage.structure.sage_object']; f\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_setup.find.installed_files_by_module[5]>\", line 1, in <module>\n        (f,) = files_by_module['sage.structure.sage_object']; f\n    ValueError: not enough values to unpack (expected 1, got 0)\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 326, in sage_setup.find.installed_files_by_module\nFailed example:\n    (f1, f2) = sorted(files_by_module['sage.structure'])\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_setup.find.installed_files_by_module[6]>\", line 1, in <module>\n        (f1, f2) = sorted(files_by_module['sage.structure'])\n    ValueError: not enough values to unpack (expected 2, got 0)\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 327, in sage_setup.find.installed_files_by_module\nFailed example:\n    f1\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_setup.find.installed_files_by_module[7]>\", line 1, in <module>\n        f1\n    NameError: name 'f1' is not defined\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 329, in sage_setup.find.installed_files_by_module\nFailed example:\n    f2\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_setup.find.installed_files_by_module[8]>\", line 1, in <module>\n        f2\n    NameError: name 'f2' is not defined\n**********************************************************************\n3 items had failures:\n   1 of   7 in sage_setup.find.filter_cython_sources\n   1 of   7 in sage_setup.find.find_extra_files\n   4 of  11 in sage_setup.find.installed_files_by_module\n    [42 tests, 6 failures, 0.40 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py  # 6 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.4 seconds\n    cpu time: 0.4 seconds\n    cumulative wall time: 0.4 seconds\n```\n\n```\nkliem@lech:~/localhome/sage$ sage -t --long --random-seed=0 src/sage/tests/cmdline.py  # 3 doctests failed\nRunning doctests with ID 2021-02-17-08-07-44-7353eba5.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/tests/cmdline.py\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 586, in sage.tests.cmdline.test_executable\nFailed example:\n    out.startswith(\"3.\")\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 588, in sage.tests.cmdline.test_executable\nFailed example:\n    err\nExpected:\n    ''\nGot:\n    '/srv/public/kliem/sage/src/bin/sage: line 588: exec: sqlite3: not found\\n'\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 590, in sage.tests.cmdline.test_executable\nFailed example:\n    ret\nExpected:\n    0\nGot:\n    127\n**********************************************************************\n1 item had failures:\n   3 of 231 in sage.tests.cmdline.test_executable\n    [230 tests, 3 failures, 21.87 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/tests/cmdline.py  # 3 doctests failed\n----------------------------------------------------------------------\n```\n\nThe test in `src/sage/tests/cmdline.py` is just there for completeness and can be ignored.",
    "created_at": "2021-02-17T07:15:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506322",
    "user": "https://github.com/kliem"
}
```

<div id="comment:72" align="right">Comment 72</div>

I'm getting a few doctest failures:

```
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py
**********************************************************************
File "src/sage/repl/interpreter.py", line 77, in sage.repl.interpreter
Failed example:
    print("dummy line"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test
Expected:
    dummy line
    ...
    ZeroDivisionError...Traceback (most recent call last)
    <ipython-input-...> in <module>...
    ----> 1 Integer(1)/Integer(0)
    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()
    ...
    -> ...                  raise ZeroDivisionError("rational division by zero")
       ...            x = <Rational> Rational.__new__(Rational)
       ...            mpq_div_zz(x.value, ....value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
Got:
    dummy line
    ---------------------------------------------------------------------------
    ZeroDivisionError                         Traceback (most recent call last)
    <ipython-input-1-72ac74c5f414> in <module>
    ----> 1 Integer(1)/Integer(0)
    <BLANKLINE>
    /srv/public/kliem/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__truediv__()
       2038         if type(left) is type(right):
       2039             if mpz_sgn((<Integer>right).value) == 0:
    -> 2040                 raise ZeroDivisionError("rational division by zero")
       2041             x = <Rational> Rational.__new__(Rational)
       2042             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
**********************************************************************
1 item had failures:
   1 of  20 in sage.repl.interpreter
    [141 tests, 1 failure, 1.97 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 7.4 seconds
    cpu time: 0.6 seconds
    cumulative wall time: 2.0 seconds
kliem@lech:~/localhome/sage$ sage -t --long --random-seed=0 src/sage/stats/hmm/hmm.pyx  # 1 doctest failed
Running doctests with ID 2021-02-17-08-07-40-53dddc3c.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx
**********************************************************************
File "src/sage/stats/hmm/hmm.pyx", line 1234, in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch
Failed example:
    m.baum_welch(v,fix_emissions=True)
Expected:
    (-66.98630856918774, 100)
Got:
    (-66.98630856918776, 100)
**********************************************************************
1 item had failures:
   1 of  14 in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch
    [121 tests, 1 failure, 0.32 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 0.4 seconds
    cpu time: 0.3 seconds
    cumulative wall time: 0.3 seconds
kliem@lech:~/localhome/sage$ sage -t --long --random-seed=0 src/sage_setup/find.py  # 6 doctests failed
Running doctests with ID 2021-02-17-08-07-42-447cd574.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py
**********************************************************************
File "src/sage_setup/find.py", line 199, in sage_setup.find.filter_cython_sources
Failed example:
    'sage/graphs/graph_decompositions/tdlib.pyx' in cython_modules
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage_setup/find.py", line 264, in sage_setup.find.find_extra_files
Failed example:
    extras["sage/ext/interpreters"]
Expected:
    ['.../src/sage/ext/interpreters/wrapper_cdf.pxd', ...wrapper_cdf.h...]
Got:
    ['/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pxd']
**********************************************************************
File "src/sage_setup/find.py", line 324, in sage_setup.find.installed_files_by_module
Failed example:
    (f,) = files_by_module['sage.structure.sage_object']; f
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_setup.find.installed_files_by_module[5]>", line 1, in <module>
        (f,) = files_by_module['sage.structure.sage_object']; f
    ValueError: not enough values to unpack (expected 1, got 0)
**********************************************************************
File "src/sage_setup/find.py", line 326, in sage_setup.find.installed_files_by_module
Failed example:
    (f1, f2) = sorted(files_by_module['sage.structure'])
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_setup.find.installed_files_by_module[6]>", line 1, in <module>
        (f1, f2) = sorted(files_by_module['sage.structure'])
    ValueError: not enough values to unpack (expected 2, got 0)
**********************************************************************
File "src/sage_setup/find.py", line 327, in sage_setup.find.installed_files_by_module
Failed example:
    f1
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_setup.find.installed_files_by_module[7]>", line 1, in <module>
        f1
    NameError: name 'f1' is not defined
**********************************************************************
File "src/sage_setup/find.py", line 329, in sage_setup.find.installed_files_by_module
Failed example:
    f2
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_setup.find.installed_files_by_module[8]>", line 1, in <module>
        f2
    NameError: name 'f2' is not defined
**********************************************************************
3 items had failures:
   1 of   7 in sage_setup.find.filter_cython_sources
   1 of   7 in sage_setup.find.find_extra_files
   4 of  11 in sage_setup.find.installed_files_by_module
    [42 tests, 6 failures, 0.40 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py  # 6 doctests failed
----------------------------------------------------------------------
Total time for all tests: 0.4 seconds
    cpu time: 0.4 seconds
    cumulative wall time: 0.4 seconds
```

```
kliem@lech:~/localhome/sage$ sage -t --long --random-seed=0 src/sage/tests/cmdline.py  # 3 doctests failed
Running doctests with ID 2021-02-17-08-07-44-7353eba5.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/tests/cmdline.py
**********************************************************************
File "src/sage/tests/cmdline.py", line 586, in sage.tests.cmdline.test_executable
Failed example:
    out.startswith("3.")
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/tests/cmdline.py", line 588, in sage.tests.cmdline.test_executable
Failed example:
    err
Expected:
    ''
Got:
    '/srv/public/kliem/sage/src/bin/sage: line 588: exec: sqlite3: not found\n'
**********************************************************************
File "src/sage/tests/cmdline.py", line 590, in sage.tests.cmdline.test_executable
Failed example:
    ret
Expected:
    0
Got:
    127
**********************************************************************
1 item had failures:
   3 of 231 in sage.tests.cmdline.test_executable
    [230 tests, 3 failures, 21.87 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/tests/cmdline.py  # 3 doctests failed
----------------------------------------------------------------------
```

The test in `src/sage/tests/cmdline.py` is just there for completeness and can be ignored.



---

archive/issue_comments_506323.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">Comment 73</div>\n\nI got failures in `repl/interpreter.py` and `sage_setup/find.py`.",
    "created_at": "2021-02-18T01:19:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506323",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:73" align="right">Comment 73</div>

I got failures in `repl/interpreter.py` and `sage_setup/find.py`.



---

archive/issue_comments_506324.json:
```json
{
    "body": "Changed commit from **[a63e615](https://github.com/sagemath/sagetrac-mirror/commit/a63e6157874d8be7e29b078d646936142f4bdcea)** to **[78a1587](https://github.com/sagemath/sagetrac-mirror/commit/78a1587c275e5528a9e020f926302851647da6d4)**",
    "created_at": "2021-02-18T01:37:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506324",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a63e615](https://github.com/sagemath/sagetrac-mirror/commit/a63e6157874d8be7e29b078d646936142f4bdcea)** to **[78a1587](https://github.com/sagemath/sagetrac-mirror/commit/78a1587c275e5528a9e020f926302851647da6d4)**



---

archive/issue_comments_506325.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">Comment 74</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78a1587c275e5528a9e020f926302851647da6d4\">78a1587</a></td><td><code>src/setup.py: Add . to sys.path so that pyproject.toml from #30913 does not break the build</code></td></tr></table>\n",
    "created_at": "2021-02-18T01:37:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506325",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:74" align="right">Comment 74</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78a1587c275e5528a9e020f926302851647da6d4">78a1587</a></td><td><code>src/setup.py: Add . to sys.path so that pyproject.toml from #30913 does not break the build</code></td></tr></table>




---

archive/issue_comments_506326.json:
```json
{
    "body": "Changed commit from **[78a1587](https://github.com/sagemath/sagetrac-mirror/commit/78a1587c275e5528a9e020f926302851647da6d4)** to **[ccce09e](https://github.com/sagemath/sagetrac-mirror/commit/ccce09e2c8cc7fa802ed18450778096f76364da7)**",
    "created_at": "2021-02-18T02:32:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506326",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[78a1587](https://github.com/sagemath/sagetrac-mirror/commit/78a1587c275e5528a9e020f926302851647da6d4)** to **[ccce09e](https://github.com/sagemath/sagetrac-mirror/commit/ccce09e2c8cc7fa802ed18450778096f76364da7)**



---

archive/issue_comments_506327.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">Comment 75</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ccce09e2c8cc7fa802ed18450778096f76364da7\">ccce09e</a></td><td><code>build/pkgs/sagelib/spkg-install [SAGE_EDITABLE=yes]: Uninstall distutils-installed sagelib</code></td></tr></table>\n",
    "created_at": "2021-02-18T02:32:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506327",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:75" align="right">Comment 75</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ccce09e2c8cc7fa802ed18450778096f76364da7">ccce09e</a></td><td><code>build/pkgs/sagelib/spkg-install [SAGE_EDITABLE=yes]: Uninstall distutils-installed sagelib</code></td></tr></table>




---

archive/issue_comments_506328.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">Comment 76</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5a918778123e677c2209425bdc9905b45699ab6e\">5a91877</a></td><td><code>sage_setup.find: Fix filter_cython_sources doctests</code></td></tr></table>\n",
    "created_at": "2021-02-18T02:43:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506328",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:76" align="right">Comment 76</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5a918778123e677c2209425bdc9905b45699ab6e">5a91877</a></td><td><code>sage_setup.find: Fix filter_cython_sources doctests</code></td></tr></table>




---

archive/issue_comments_506329.json:
```json
{
    "body": "Changed commit from **[ccce09e](https://github.com/sagemath/sagetrac-mirror/commit/ccce09e2c8cc7fa802ed18450778096f76364da7)** to **[5a91877](https://github.com/sagemath/sagetrac-mirror/commit/5a918778123e677c2209425bdc9905b45699ab6e)**",
    "created_at": "2021-02-18T02:43:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506329",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ccce09e](https://github.com/sagemath/sagetrac-mirror/commit/ccce09e2c8cc7fa802ed18450778096f76364da7)** to **[5a91877](https://github.com/sagemath/sagetrac-mirror/commit/5a918778123e677c2209425bdc9905b45699ab6e)**



---

archive/issue_comments_506330.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">Comment 77</div>\n\nThe remaining failures in `sage_setup/find.py` are now all about `installed_files_by_module`; I'll have to see what to do about them (this function is only needed for the old build system).\n\nThe failure in `sage/repl/interpreter.py` seems to indicate that the C source information (`sage/rings/integer.c`) is missing.",
    "created_at": "2021-02-18T03:03:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506330",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:77" align="right">Comment 77</div>

The remaining failures in `sage_setup/find.py` are now all about `installed_files_by_module`; I'll have to see what to do about them (this function is only needed for the old build system).

The failure in `sage/repl/interpreter.py` seems to indicate that the C source information (`sage/rings/integer.c`) is missing.



---

archive/issue_comments_506331.json:
```json
{
    "body": "Changed commit from **[5a91877](https://github.com/sagemath/sagetrac-mirror/commit/5a918778123e677c2209425bdc9905b45699ab6e)** to **[e272614](https://github.com/sagemath/sagetrac-mirror/commit/e272614fd26ceb3992754a014099fc644d470f06)**",
    "created_at": "2021-02-18T03:16:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506331",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5a91877](https://github.com/sagemath/sagetrac-mirror/commit/5a918778123e677c2209425bdc9905b45699ab6e)** to **[e272614](https://github.com/sagemath/sagetrac-mirror/commit/e272614fd26ceb3992754a014099fc644d470f06)**



---

archive/issue_comments_506332.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">Comment 78</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/66fa8c0ab21beaca1bf13ccc97fb9f765af3fda1\">66fa8c0</a></td><td><code>src/setup.py: Add . to sys.path earlier</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e272614fd26ceb3992754a014099fc644d470f06\">e272614</a></td><td><code>src/setup.py: Pass gdb_debug to cythonize, as in sage_build_cython</code></td></tr></table>\n",
    "created_at": "2021-02-18T03:16:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506332",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:78" align="right">Comment 78</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/66fa8c0ab21beaca1bf13ccc97fb9f765af3fda1">66fa8c0</a></td><td><code>src/setup.py: Add . to sys.path earlier</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e272614fd26ceb3992754a014099fc644d470f06">e272614</a></td><td><code>src/setup.py: Pass gdb_debug to cythonize, as in sage_build_cython</code></td></tr></table>




---

archive/issue_comments_506333.json:
```json
{
    "body": "Changed commit from **[e272614](https://github.com/sagemath/sagetrac-mirror/commit/e272614fd26ceb3992754a014099fc644d470f06)** to **[67072f3](https://github.com/sagemath/sagetrac-mirror/commit/67072f34146e7ed547f241854755a462660b53cf)**",
    "created_at": "2021-02-18T03:29:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506333",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e272614](https://github.com/sagemath/sagetrac-mirror/commit/e272614fd26ceb3992754a014099fc644d470f06)** to **[67072f3](https://github.com/sagemath/sagetrac-mirror/commit/67072f34146e7ed547f241854755a462660b53cf)**



---

archive/issue_comments_506334.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">Comment 79</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/67072f34146e7ed547f241854755a462660b53cf\">67072f3</a></td><td><code>src/setup.py: Use include, not exclude in find_namespace_packages to get top_level info right</code></td></tr></table>\n",
    "created_at": "2021-02-18T03:29:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506334",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:79" align="right">Comment 79</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/67072f34146e7ed547f241854755a462660b53cf">67072f3</a></td><td><code>src/setup.py: Use include, not exclude in find_namespace_packages to get top_level info right</code></td></tr></table>




---

archive/issue_comments_506335.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">Comment 80</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0bcf8a40008300ad2fca24310a052b0b2fc6b510\">0bcf8a4</a></td><td><code>build/pkgs/sagelib/spkg-install: When switching from editable install to traditional install, remove the egg-link</code></td></tr></table>\n",
    "created_at": "2021-02-18T04:12:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506335",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:80" align="right">Comment 80</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0bcf8a40008300ad2fca24310a052b0b2fc6b510">0bcf8a4</a></td><td><code>build/pkgs/sagelib/spkg-install: When switching from editable install to traditional install, remove the egg-link</code></td></tr></table>




---

archive/issue_comments_506336.json:
```json
{
    "body": "Changed commit from **[67072f3](https://github.com/sagemath/sagetrac-mirror/commit/67072f34146e7ed547f241854755a462660b53cf)** to **[0bcf8a4](https://github.com/sagemath/sagetrac-mirror/commit/0bcf8a40008300ad2fca24310a052b0b2fc6b510)**",
    "created_at": "2021-02-18T04:12:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506336",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[67072f3](https://github.com/sagemath/sagetrac-mirror/commit/67072f34146e7ed547f241854755a462660b53cf)** to **[0bcf8a4](https://github.com/sagemath/sagetrac-mirror/commit/0bcf8a40008300ad2fca24310a052b0b2fc6b510)**



---

archive/issue_comments_506337.json:
```json
{
    "body": "Changed commit from **[0bcf8a4](https://github.com/sagemath/sagetrac-mirror/commit/0bcf8a40008300ad2fca24310a052b0b2fc6b510)** to **[981124c](https://github.com/sagemath/sagetrac-mirror/commit/981124cd020eaa4127a9ae0e6c9009269e45a2ff)**",
    "created_at": "2021-02-18T06:45:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506337",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0bcf8a4](https://github.com/sagemath/sagetrac-mirror/commit/0bcf8a40008300ad2fca24310a052b0b2fc6b510)** to **[981124c](https://github.com/sagemath/sagetrac-mirror/commit/981124cd020eaa4127a9ae0e6c9009269e45a2ff)**



---

archive/issue_comments_506338.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">Comment 81</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/981124cd020eaa4127a9ae0e6c9009269e45a2ff\">981124c</a></td><td><code>sage_setup.find.installed_files_by_module: Make doctest work for editable installs too</code></td></tr></table>\n",
    "created_at": "2021-02-18T06:45:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506338",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:81" align="right">Comment 81</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/981124cd020eaa4127a9ae0e6c9009269e45a2ff">981124c</a></td><td><code>sage_setup.find.installed_files_by_module: Make doctest work for editable installs too</code></td></tr></table>




---

archive/issue_comments_506339.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">Comment 82</div>\n\nThis fixes the remaining doctests for me.",
    "created_at": "2021-02-18T06:47:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506339",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:82" align="right">Comment 82</div>

This fixes the remaining doctests for me.



---

archive/issue_comments_506340.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">Comment 83</div>\n\nNot for me:\n\nI still get `src/sage/tests/cmdline.py`, which can be ignored.\n\nOn top:\n\n```\nkliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py\nRunning doctests with ID 2021-02-18-07-50-51-5ae2b230.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py\n**********************************************************************\nFile \"src/sage/repl/interpreter.py\", line 77, in sage.repl.interpreter\nFailed example:\n    print(\"dummy line\"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test\nExpected:\n    dummy line\n    ...\n    ZeroDivisionError...Traceback (most recent call last)\n    <ipython-input-...> in <module>...\n    ----> 1 Integer(1)/Integer(0)\n    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()\n    ...\n    -> ...                  raise ZeroDivisionError(\"rational division by zero\")\n       ...            x = <Rational> Rational.__new__(Rational)\n       ...            mpq_div_zz(x.value, ....value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\nGot:\n    dummy line\n    ---------------------------------------------------------------------------\n    ZeroDivisionError                         Traceback (most recent call last)\n    <ipython-input-1-72ac74c5f414> in <module>\n    ----> 1 Integer(1)/Integer(0)\n    <BLANKLINE>\n    /srv/public/kliem/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__truediv__()\n       2038         if type(left) is type(right):\n       2039             if mpz_sgn((<Integer>right).value) == 0:\n    -> 2040                 raise ZeroDivisionError(\"rational division by zero\")\n       2041             x = <Rational> Rational.__new__(Rational)\n       2042             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\n**********************************************************************\n1 item had failures:\n   1 of  20 in sage.repl.interpreter\n    [141 tests, 1 failure, 1.94 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 7.3 seconds\n    cpu time: 0.6 seconds\n    cumulative wall time: 1.9 seconds\nkliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx\nRunning doctests with ID 2021-02-18-07-51-08-57678760.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx\n**********************************************************************\nFile \"src/sage/stats/hmm/hmm.pyx\", line 1234, in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch\nFailed example:\n    m.baum_welch(v,fix_emissions=True)\nExpected:\n    (-66.98630856918774, 100)\nGot:\n    (-66.98630856918776, 100)\n**********************************************************************\n1 item had failures:\n   1 of  14 in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch\n    [121 tests, 1 failure, 0.33 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.4 seconds\n    cpu time: 0.3 seconds\n    cumulative wall time: 0.3 seconds\nkliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py\nRunning doctests with ID 2021-02-18-07-51-21-d3281c6c.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 264, in sage_setup.find.find_extra_files\nFailed example:\n    extras[\"sage/ext/interpreters\"]\nExpected:\n    ['.../src/sage/ext/interpreters/wrapper_cdf.pxd', ...wrapper_cdf.h...]\nGot:\n    ['/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pxd']\n**********************************************************************\n1 item had failures:\n   1 of   7 in sage_setup.find.find_extra_files\n    [41 tests, 1 failure, 0.47 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.5 seconds\n    cpu time: 0.5 seconds\n    cumulative wall time: 0.5 seconds\n```",
    "created_at": "2021-02-18T06:53:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506340",
    "user": "https://github.com/kliem"
}
```

<div id="comment:83" align="right">Comment 83</div>

Not for me:

I still get `src/sage/tests/cmdline.py`, which can be ignored.

On top:

```
kliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py
Running doctests with ID 2021-02-18-07-50-51-5ae2b230.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py
**********************************************************************
File "src/sage/repl/interpreter.py", line 77, in sage.repl.interpreter
Failed example:
    print("dummy line"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test
Expected:
    dummy line
    ...
    ZeroDivisionError...Traceback (most recent call last)
    <ipython-input-...> in <module>...
    ----> 1 Integer(1)/Integer(0)
    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()
    ...
    -> ...                  raise ZeroDivisionError("rational division by zero")
       ...            x = <Rational> Rational.__new__(Rational)
       ...            mpq_div_zz(x.value, ....value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
Got:
    dummy line
    ---------------------------------------------------------------------------
    ZeroDivisionError                         Traceback (most recent call last)
    <ipython-input-1-72ac74c5f414> in <module>
    ----> 1 Integer(1)/Integer(0)
    <BLANKLINE>
    /srv/public/kliem/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__truediv__()
       2038         if type(left) is type(right):
       2039             if mpz_sgn((<Integer>right).value) == 0:
    -> 2040                 raise ZeroDivisionError("rational division by zero")
       2041             x = <Rational> Rational.__new__(Rational)
       2042             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
**********************************************************************
1 item had failures:
   1 of  20 in sage.repl.interpreter
    [141 tests, 1 failure, 1.94 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 7.3 seconds
    cpu time: 0.6 seconds
    cumulative wall time: 1.9 seconds
kliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx
Running doctests with ID 2021-02-18-07-51-08-57678760.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx
**********************************************************************
File "src/sage/stats/hmm/hmm.pyx", line 1234, in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch
Failed example:
    m.baum_welch(v,fix_emissions=True)
Expected:
    (-66.98630856918774, 100)
Got:
    (-66.98630856918776, 100)
**********************************************************************
1 item had failures:
   1 of  14 in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch
    [121 tests, 1 failure, 0.33 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 0.4 seconds
    cpu time: 0.3 seconds
    cumulative wall time: 0.3 seconds
kliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py
Running doctests with ID 2021-02-18-07-51-21-d3281c6c.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py
**********************************************************************
File "src/sage_setup/find.py", line 264, in sage_setup.find.find_extra_files
Failed example:
    extras["sage/ext/interpreters"]
Expected:
    ['.../src/sage/ext/interpreters/wrapper_cdf.pxd', ...wrapper_cdf.h...]
Got:
    ['/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pxd']
**********************************************************************
1 item had failures:
   1 of   7 in sage_setup.find.find_extra_files
    [41 tests, 1 failure, 0.47 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 0.5 seconds
    cpu time: 0.5 seconds
    cumulative wall time: 0.5 seconds
```



---

archive/issue_comments_506341.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">Comment 84</div>\n\n`find_extra_files` does exactly what the documentation claims it does, it lists all `pyx, pxd, pxi` files.",
    "created_at": "2021-02-18T06:58:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506341",
    "user": "https://github.com/kliem"
}
```

<div id="comment:84" align="right">Comment 84</div>

`find_extra_files` does exactly what the documentation claims it does, it lists all `pyx, pxd, pxi` files.



---

archive/issue_comments_506342.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">Comment 85</div>\n\nAfter `make sagelib-clean sagelib` I can reproduce this error too. the `.h` files are missing in the list.",
    "created_at": "2021-02-18T07:06:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506342",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:85" align="right">Comment 85</div>

After `make sagelib-clean sagelib` I can reproduce this error too. the `.h` files are missing in the list.



---

archive/issue_comments_506343.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">Comment 86</div>\n\nMy guess is that the doctest failure in `src/sage/repl/interpreter.py` will go away if you do `make sagelib-clean`",
    "created_at": "2021-02-18T07:07:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506343",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:86" align="right">Comment 86</div>

My guess is that the doctest failure in `src/sage/repl/interpreter.py` will go away if you do `make sagelib-clean`



---

archive/issue_comments_506344.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">Comment 87</div>\n\nThe missing `.h` files are by design. This function gives only `.h.` files in `cythonized`, which is pointless now. I don't know what would be the best way to deal with this.\n\nCan you fix the precision error in `src/sage/stats/hmm/hmm.pyx` as well (`# abs tol 1e-13`). It seems pointless to have an extra ticket for this.",
    "created_at": "2021-02-18T07:27:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506344",
    "user": "https://github.com/kliem"
}
```

<div id="comment:87" align="right">Comment 87</div>

The missing `.h` files are by design. This function gives only `.h.` files in `cythonized`, which is pointless now. I don't know what would be the best way to deal with this.

Can you fix the precision error in `src/sage/stats/hmm/hmm.pyx` as well (`# abs tol 1e-13`). It seems pointless to have an extra ticket for this.



---

archive/issue_comments_506345.json:
```json
{
    "body": "<div id=\"comment:88\" align=\"right\">Comment 88</div>\n\nRan `make sagelib-clean sagelib` and `make build` and it still persists:\n\n```\nkliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py\nRunning doctests with ID 2021-02-18-08-59-13-9182572c.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py\n**********************************************************************\nFile \"src/sage/repl/interpreter.py\", line 77, in sage.repl.interpreter\nFailed example:\n    print(\"dummy line\"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test\nExpected:\n    dummy line\n    ...\n    ZeroDivisionError...Traceback (most recent call last)\n    <ipython-input-...> in <module>...\n    ----> 1 Integer(1)/Integer(0)\n    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()\n    ...\n    -> ...                  raise ZeroDivisionError(\"rational division by zero\")\n       ...            x = <Rational> Rational.__new__(Rational)\n       ...            mpq_div_zz(x.value, ....value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\nGot:\n    dummy line\n    ---------------------------------------------------------------------------\n    ZeroDivisionError                         Traceback (most recent call last)\n    <ipython-input-1-72ac74c5f414> in <module>\n    ----> 1 Integer(1)/Integer(0)\n    <BLANKLINE>\n    /srv/public/kliem/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__truediv__()\n       2038         if type(left) is type(right):\n       2039             if mpz_sgn((<Integer>right).value) == 0:\n    -> 2040                 raise ZeroDivisionError(\"rational division by zero\")\n       2041             x = <Rational> Rational.__new__(Rational)\n       2042             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\n**********************************************************************\n1 item had failures:\n   1 of  20 in sage.repl.interpreter\n    [141 tests, 1 failure, 2.90 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 8.4 seconds\n    cpu time: 0.6 seconds\n    cumulative wall time: 2.9 seconds\n```",
    "created_at": "2021-02-18T08:00:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506345",
    "user": "https://github.com/kliem"
}
```

<div id="comment:88" align="right">Comment 88</div>

Ran `make sagelib-clean sagelib` and `make build` and it still persists:

```
kliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py
Running doctests with ID 2021-02-18-08-59-13-9182572c.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py
**********************************************************************
File "src/sage/repl/interpreter.py", line 77, in sage.repl.interpreter
Failed example:
    print("dummy line"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test
Expected:
    dummy line
    ...
    ZeroDivisionError...Traceback (most recent call last)
    <ipython-input-...> in <module>...
    ----> 1 Integer(1)/Integer(0)
    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()
    ...
    -> ...                  raise ZeroDivisionError("rational division by zero")
       ...            x = <Rational> Rational.__new__(Rational)
       ...            mpq_div_zz(x.value, ....value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
Got:
    dummy line
    ---------------------------------------------------------------------------
    ZeroDivisionError                         Traceback (most recent call last)
    <ipython-input-1-72ac74c5f414> in <module>
    ----> 1 Integer(1)/Integer(0)
    <BLANKLINE>
    /srv/public/kliem/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__truediv__()
       2038         if type(left) is type(right):
       2039             if mpz_sgn((<Integer>right).value) == 0:
    -> 2040                 raise ZeroDivisionError("rational division by zero")
       2041             x = <Rational> Rational.__new__(Rational)
       2042             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
**********************************************************************
1 item had failures:
   1 of  20 in sage.repl.interpreter
    [141 tests, 1 failure, 2.90 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 8.4 seconds
    cpu time: 0.6 seconds
    cumulative wall time: 2.9 seconds
```



---

archive/issue_comments_506346.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">Comment 89</div>\n\nI mean it makes completely sense that the cythonized file is no longer written in parenthesis, because it is in the obvious location. So no need to specify this anymore.",
    "created_at": "2021-02-18T08:01:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506346",
    "user": "https://github.com/kliem"
}
```

<div id="comment:89" align="right">Comment 89</div>

I mean it makes completely sense that the cythonized file is no longer written in parenthesis, because it is in the obvious location. So no need to specify this anymore.



---

archive/issue_comments_506347.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">Comment 90</div>\n\nReplying to [@mkoeppe](#comment%3A86):\n> My guess is that the doctest failure in `src/sage/repl/interpreter.py` will go away if you do `make sagelib-clean`\n\nI think this problem comes from the fact that currently find_packages is called before the autogeneration. Thus, the auto-generated files are not included in the cythonization step. This is fixed in the setup.py in #30371.",
    "created_at": "2021-02-18T08:34:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506347",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:90" align="right">Comment 90</div>

Replying to [@mkoeppe](#comment%3A86):
> My guess is that the doctest failure in `src/sage/repl/interpreter.py` will go away if you do `make sagelib-clean`

I think this problem comes from the fact that currently find_packages is called before the autogeneration. Thus, the auto-generated files are not included in the cythonization step. This is fixed in the setup.py in #30371.



---

archive/issue_comments_506348.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">Comment 91</div>\n\nI think we can leave those failures for later fix, as long as we take care of them at some point.\n\nNone of the doctest failures is serious.\n\nI guess this isn't ready yet for being used for patchbots.",
    "created_at": "2021-02-18T08:37:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506348",
    "user": "https://github.com/kliem"
}
```

<div id="comment:91" align="right">Comment 91</div>

I think we can leave those failures for later fix, as long as we take care of them at some point.

None of the doctest failures is serious.

I guess this isn't ready yet for being used for patchbots.



---

archive/issue_comments_506349.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">Comment 92</div>\n\nReplying to [@kliem](#comment%3A88):\n> Ran `make sagelib-clean sagelib` and `make build` and it still persists:\n\nI'm pretty sure I fixed this with e272614; perhaps `make sagelib-clean` still does not clean enough?",
    "created_at": "2021-02-18T16:35:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506349",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:92" align="right">Comment 92</div>

Replying to [@kliem](#comment%3A88):
> Ran `make sagelib-clean sagelib` and `make build` and it still persists:

I'm pretty sure I fixed this with e272614; perhaps `make sagelib-clean` still does not clean enough?



---

archive/issue_comments_506350.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">Comment 93</div>\n\nReplying to [@tobiasdiez](#comment%3A90):\n> Replying to [@mkoeppe](#comment%3A86):\n> > My guess is that the doctest failure in `src/sage/repl/interpreter.py` will go away if you do `make sagelib-clean`\n\n> \n> I think this problem comes from the fact that currently find_packages is called before the autogeneration. Thus, the auto-generated files are not included in the cythonization step. This is fixed in the setup.py in #30371.\n\nNo, calling autogen earlier does not help.",
    "created_at": "2021-02-18T16:49:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506350",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:93" align="right">Comment 93</div>

Replying to [@tobiasdiez](#comment%3A90):
> Replying to [@mkoeppe](#comment%3A86):
> > My guess is that the doctest failure in `src/sage/repl/interpreter.py` will go away if you do `make sagelib-clean`

> 
> I think this problem comes from the fact that currently find_packages is called before the autogeneration. Thus, the auto-generated files are not included in the cythonization step. This is fixed in the setup.py in #30371.

No, calling autogen earlier does not help.



---

archive/issue_comments_506351.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,6 +10,7 @@\n To test:\n \n ```\n+./bootstrap\n ./configure --enable-editable\n make build\n ```\n``````\n",
    "created_at": "2021-02-18T17:25:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506351",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,6 +10,7 @@
 To test:
 
 ```
+./bootstrap
 ./configure --enable-editable
 make build
 ```
``````




---

archive/issue_comments_506352.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">Comment 95</div>\n\nFor changes in Python source, one might even use `importlib` and not restart sage at all!",
    "created_at": "2021-02-18T17:31:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506352",
    "user": "https://github.com/videlec"
}
```

<div id="comment:95" align="right">Comment 95</div>

For changes in Python source, one might even use `importlib` and not restart sage at all!



---

archive/issue_comments_506353.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">Comment 96</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b5d51bd0ff4823972f95f0728eba485d3443afe\">8b5d51b</a></td><td><code>src/sage_setup: Generalize doctests to editable install using new function _cythonized_dir</code></td></tr></table>\n",
    "created_at": "2021-02-18T17:31:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506353",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:96" align="right">Comment 96</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b5d51bd0ff4823972f95f0728eba485d3443afe">8b5d51b</a></td><td><code>src/sage_setup: Generalize doctests to editable install using new function _cythonized_dir</code></td></tr></table>




---

archive/issue_comments_506354.json:
```json
{
    "body": "Changed commit from **[981124c](https://github.com/sagemath/sagetrac-mirror/commit/981124cd020eaa4127a9ae0e6c9009269e45a2ff)** to **[8b5d51b](https://github.com/sagemath/sagetrac-mirror/commit/8b5d51bd0ff4823972f95f0728eba485d3443afe)**",
    "created_at": "2021-02-18T17:31:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506354",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[981124c](https://github.com/sagemath/sagetrac-mirror/commit/981124cd020eaa4127a9ae0e6c9009269e45a2ff)** to **[8b5d51b](https://github.com/sagemath/sagetrac-mirror/commit/8b5d51bd0ff4823972f95f0728eba485d3443afe)**



---

archive/issue_comments_506355.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">Comment 97</div>\n\nReplying to [@videlec](#comment%3A95):\n> For changes in Python source, one might even use `importlib` and not restart sage at all!\n\nTrue, but let's not document this -- too many possible pitfalls related to class redefinitions",
    "created_at": "2021-02-18T17:33:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506355",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:97" align="right">Comment 97</div>

Replying to [@videlec](#comment%3A95):
> For changes in Python source, one might even use `importlib` and not restart sage at all!

True, but let's not document this -- too many possible pitfalls related to class redefinitions



---

archive/issue_comments_506356.json:
```json
{
    "body": "<div id=\"comment:98\" align=\"right\">Comment 98</div>\n\n(Too bad that Python does not have `UPDATE-INSTANCE-FOR-REDEFINED-CLASS` http://clhs.lisp.se/Body/f_upda_1.htm)",
    "created_at": "2021-02-18T17:37:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506356",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:98" align="right">Comment 98</div>

(Too bad that Python does not have `UPDATE-INSTANCE-FOR-REDEFINED-CLASS` http://clhs.lisp.se/Body/f_upda_1.htm)



---

archive/issue_comments_506357.json:
```json
{
    "body": "<div id=\"comment:99\" align=\"right\">Comment 99</div>\n\nReady for another round of testing. (I won't do the unrelated `hmm.pyx` doctest fix on this ticket)",
    "created_at": "2021-02-18T17:45:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506357",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:99" align="right">Comment 99</div>

Ready for another round of testing. (I won't do the unrelated `hmm.pyx` doctest fix on this ticket)



---

archive/issue_comments_506358.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">Comment 0</div>\n\nAfter deleting everything and reinstalling it, I still get the failure in `src/sage/repl/interpreter.py`. The `find.py` thing is gone now.",
    "created_at": "2021-02-18T18:04:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506358",
    "user": "https://github.com/kliem"
}
```

<div id="comment:0" align="right">Comment 0</div>

After deleting everything and reinstalling it, I still get the failure in `src/sage/repl/interpreter.py`. The `find.py` thing is gone now.



---

archive/issue_comments_506359.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nI'm getting the `src/sage/repl/interpreter.py` failure now too again... any help with tracking this down is welcome...",
    "created_at": "2021-02-18T18:33:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506359",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:1" align="right">Comment 1</div>

I'm getting the `src/sage/repl/interpreter.py` failure now too again... any help with tracking this down is welcome...



---

archive/issue_comments_506360.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nOr we can leave this issue for the follow-up ticket #31406, that would be fine with me too.",
    "created_at": "2021-02-18T18:51:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506360",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">Comment 2</div>

Or we can leave this issue for the follow-up ticket #31406, that would be fine with me too.



---

archive/issue_comments_506361.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nIf we're to believe the doctest language (\"Check that Cython source code appears in tracebacks\"), then this is functioning properly, it's just missing \"(.../cythonized/sage/rings/integer.c:...)()\". Can we just replace that part of the doctest with \"...\", or is it important?\n\n```diff\ndiff --git a/src/sage/repl/interpreter.py b/src/sage/repl/interpreter.py\nindex befa75fc38..3bd894851d 100644\n--- a/src/sage/repl/interpreter.py\n+++ b/src/sage/repl/interpreter.py\n@@ -80,7 +80,7 @@ Check that Cython source code appears in tracebacks::\n     ZeroDivisionError...Traceback (most recent call last)\n     <ipython-input-...> in <module>...\n     ----> 1 Integer(1)/Integer(0)\n-    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()\n+    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div...\n     ...\n     -> ...                  raise ZeroDivisionError(\"rational division by zero\")\n        ....:            x = <Rational> Rational.__new__(Rational)\n```\nBy the way, `git status` tells me\n\n```\nUntracked files:\n  (use \"git add <file>...\" to include in what will be committed)\n\tsrc/cython_debug/\n```",
    "created_at": "2021-02-18T19:59:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506361",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:3" align="right">Comment 3</div>

If we're to believe the doctest language ("Check that Cython source code appears in tracebacks"), then this is functioning properly, it's just missing "(.../cythonized/sage/rings/integer.c:...)()". Can we just replace that part of the doctest with "...", or is it important?

```diff
diff --git a/src/sage/repl/interpreter.py b/src/sage/repl/interpreter.py
index befa75fc38..3bd894851d 100644
--- a/src/sage/repl/interpreter.py
+++ b/src/sage/repl/interpreter.py
@@ -80,7 +80,7 @@ Check that Cython source code appears in tracebacks::
     ZeroDivisionError...Traceback (most recent call last)
     <ipython-input-...> in <module>...
     ----> 1 Integer(1)/Integer(0)
-    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()
+    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div...
     ...
     -> ...                  raise ZeroDivisionError("rational division by zero")
        ....:            x = <Rational> Rational.__new__(Rational)
```
By the way, `git status` tells me

```
Untracked files:
  (use "git add <file>..." to include in what will be committed)
	src/cython_debug/
```



---

archive/issue_comments_506362.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nI had also these untracked files in src/cython_debug.\n\nThe tests seem to pass in general for me. However, they need a lot of ram, like > 25GB which sometimes leads to a crash of the system. In particular, the tests around sage/plot seem to very memeroy intensive (but the memory doesn't go down afterwards). Is this normal? I could also reproduce this on the github actions in #30371 which also crash reproducible after about 2 hours of doctesting.",
    "created_at": "2021-02-18T20:12:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506362",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:4" align="right">Comment 4</div>

I had also these untracked files in src/cython_debug.

The tests seem to pass in general for me. However, they need a lot of ram, like > 25GB which sometimes leads to a crash of the system. In particular, the tests around sage/plot seem to very memeroy intensive (but the memory doesn't go down afterwards). Is this normal? I could also reproduce this on the github actions in #30371 which also crash reproducible after about 2 hours of doctesting.



---

archive/issue_comments_506363.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89969bf6bd90d68861a85f5d91cf7756a5ae7229\">89969bf</a></td><td><code>.gitignore: Ignore src/cython_debug</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eb631b23bc8f207a57da1550cf799de86983bd94\">eb631b2</a></td><td><code>build/make/Makefile.in: Remove src/cython_debug</code></td></tr></table>\n",
    "created_at": "2021-02-18T20:28:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506363",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5" align="right">Comment 5</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89969bf6bd90d68861a85f5d91cf7756a5ae7229">89969bf</a></td><td><code>.gitignore: Ignore src/cython_debug</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eb631b23bc8f207a57da1550cf799de86983bd94">eb631b2</a></td><td><code>build/make/Makefile.in: Remove src/cython_debug</code></td></tr></table>




---

archive/issue_comments_506364.json:
```json
{
    "body": "Changed commit from **[8b5d51b](https://github.com/sagemath/sagetrac-mirror/commit/8b5d51bd0ff4823972f95f0728eba485d3443afe)** to **[eb631b2](https://github.com/sagemath/sagetrac-mirror/commit/eb631b23bc8f207a57da1550cf799de86983bd94)**",
    "created_at": "2021-02-18T20:28:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506364",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8b5d51b](https://github.com/sagemath/sagetrac-mirror/commit/8b5d51bd0ff4823972f95f0728eba485d3443afe)** to **[eb631b2](https://github.com/sagemath/sagetrac-mirror/commit/eb631b23bc8f207a57da1550cf799de86983bd94)**



---

archive/issue_comments_506365.json:
```json
{
    "body": "<div id=\"comment:106\" align=\"right\">Comment 106</div>\n\nReplying to [@jhpalmieri](#comment%3A103):\n> it's just missing \"(.../cythonized/sage/rings/integer.c:...)()\". Can we just replace that part of the doctest with \"...\", or is it important?\n\nI don't know if this information is important, perhaps someone who programs Cython can tell us?",
    "created_at": "2021-02-18T20:29:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506365",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:106" align="right">Comment 106</div>

Replying to [@jhpalmieri](#comment%3A103):
> it's just missing "(.../cythonized/sage/rings/integer.c:...)()". Can we just replace that part of the doctest with "...", or is it important?

I don't know if this information is important, perhaps someone who programs Cython can tell us?



---

archive/issue_comments_506366.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nUsing git blame, this doctest was introduced in commit `6e7ad656ba3307ff67949e251550c101758f9963`. In this commit Jeroen Demeyer added a IPython patch. Of course this patch has long merged upstream and has now changed several times and I failed to located the place, where things are happening.\n\nHowever, things are out of our control.\n\nI think the reason why \"(.../cythonized/sage/rings/integer.c:...)()\" appears is that the cythonized file is located at a different location then the source file. So this might be important, when you are debugging. However, if the cythonized files are no longer hidden somewhere else, then it appears pointless to print this information and this is probably why IPython doesn't do it. I mean the file is right next to the other file. It is redundant information in this case.\n\nLong story short, I think this can go. It is an IPython feature of which we do not have control anyway. What is important, is that the corresponding `pyx` file appears correctly, which is the case.",
    "created_at": "2021-02-18T20:40:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506366",
    "user": "https://github.com/kliem"
}
```

<div id="comment:7" align="right">Comment 7</div>

Using git blame, this doctest was introduced in commit `6e7ad656ba3307ff67949e251550c101758f9963`. In this commit Jeroen Demeyer added a IPython patch. Of course this patch has long merged upstream and has now changed several times and I failed to located the place, where things are happening.

However, things are out of our control.

I think the reason why "(.../cythonized/sage/rings/integer.c:...)()" appears is that the cythonized file is located at a different location then the source file. So this might be important, when you are debugging. However, if the cythonized files are no longer hidden somewhere else, then it appears pointless to print this information and this is probably why IPython doesn't do it. I mean the file is right next to the other file. It is redundant information in this case.

Long story short, I think this can go. It is an IPython feature of which we do not have control anyway. What is important, is that the corresponding `pyx` file appears correctly, which is the case.



---

archive/issue_comments_506367.json:
```json
{
    "body": "Changed commit from **[eb631b2](https://github.com/sagemath/sagetrac-mirror/commit/eb631b23bc8f207a57da1550cf799de86983bd94)** to **[daec3e8](https://github.com/sagemath/sagetrac-mirror/commit/daec3e803e8f6a6de8e717459c31b2b7de7a8906)**",
    "created_at": "2021-02-18T20:50:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506367",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[eb631b2](https://github.com/sagemath/sagetrac-mirror/commit/eb631b23bc8f207a57da1550cf799de86983bd94)** to **[daec3e8](https://github.com/sagemath/sagetrac-mirror/commit/daec3e803e8f6a6de8e717459c31b2b7de7a8906)**



---

archive/issue_comments_506368.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/daec3e803e8f6a6de8e717459c31b2b7de7a8906\">daec3e8</a></td><td><code>src/sage/repl/interpreter.py: Do not test that IPython displays the location of the Cython-generated .c file</code></td></tr></table>\n",
    "created_at": "2021-02-18T20:50:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506368",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8" align="right">Comment 8</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/daec3e803e8f6a6de8e717459c31b2b7de7a8906">daec3e8</a></td><td><code>src/sage/repl/interpreter.py: Do not test that IPython displays the location of the Cython-generated .c file</code></td></tr></table>




---

archive/issue_comments_506369.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nThanks for investigating. This is sufficiently convincing, so I have removed the test.",
    "created_at": "2021-02-18T20:50:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506369",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">Comment 9</div>

Thanks for investigating. This is sufficiently convincing, so I have removed the test.



---

archive/issue_comments_506370.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">Comment 0</div>\n\nOk, all tests pass now (except for those two unrelated tests).",
    "created_at": "2021-02-19T15:34:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506370",
    "user": "https://github.com/kliem"
}
```

<div id="comment:0" align="right">Comment 0</div>

Ok, all tests pass now (except for those two unrelated tests).



---

archive/issue_comments_506371.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nAny further concerns, or can we get this in?",
    "created_at": "2021-02-20T18:10:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506371",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:1" align="right">Comment 1</div>

Any further concerns, or can we get this in?



---

archive/issue_comments_506372.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nFrom my side this looks good.",
    "created_at": "2021-02-20T18:49:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506372",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:2" align="right">Comment 2</div>

From my side this looks good.



---

archive/issue_comments_506373.json:
```json
{
    "body": "Changed reviewer from **Matthias Koeppe, ...** to **Matthias Koeppe, Tobias Diez, ...**",
    "created_at": "2021-02-20T18:49:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506373",
    "user": "https://github.com/tobiasdiez"
}
```

Changed reviewer from **Matthias Koeppe, ...** to **Matthias Koeppe, Tobias Diez, ...**



---

archive/issue_comments_506374.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nI'm happy with it, but didn't have the time to understand everything yet.",
    "created_at": "2021-02-20T19:07:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506374",
    "user": "https://github.com/kliem"
}
```

<div id="comment:3" align="right">Comment 3</div>

I'm happy with it, but didn't have the time to understand everything yet.



---

archive/issue_events_414203.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-02-24T09:25:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414203"
}
```



---

archive/issue_events_414204.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-02-24T09:25:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414204"
}
```



---

archive/issue_comments_506375.json:
```json
{
    "body": "Changed reviewer from **Matthias Koeppe, Tobias Diez, ...** to **Matthias Koeppe, Tobias Diez, Jonathan Kliem**",
    "created_at": "2021-02-24T09:25:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506375",
    "user": "https://github.com/kliem"
}
```

Changed reviewer from **Matthias Koeppe, Tobias Diez, ...** to **Matthias Koeppe, Tobias Diez, Jonathan Kliem**



---

archive/issue_comments_506376.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nLGTM.\n\nI don't know if setting `nthreads=4` for cythonizing is perfect. Maybe this could be picked up somewhere in a follow up ticket. E.g. if the environment variable `MAKE` is set to `make ... -jN ...` we should probably respect this.",
    "created_at": "2021-02-24T09:25:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506376",
    "user": "https://github.com/kliem"
}
```

<div id="comment:4" align="right">Comment 4</div>

LGTM.

I don't know if setting `nthreads=4` for cythonizing is perfect. Maybe this could be picked up somewhere in a follow up ticket. E.g. if the environment variable `MAKE` is set to `make ... -jN ...` we should probably respect this.



---

archive/issue_comments_506377.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nThanks! I've added your suggestion to #31406.",
    "created_at": "2021-02-24T15:19:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506377",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:5" align="right">Comment 5</div>

Thanks! I've added your suggestion to #31406.



---

archive/issue_comments_506378.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nThanks for the review!",
    "created_at": "2021-02-24T18:21:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506378",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">Comment 6</div>

Thanks for the review!



---

archive/issue_comments_506379.json:
```json
{
    "body": "Changed commit from **[daec3e8](https://github.com/sagemath/sagetrac-mirror/commit/daec3e803e8f6a6de8e717459c31b2b7de7a8906)** to **[8b3f390](https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02)**",
    "created_at": "2021-03-07T21:07:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506379",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[daec3e8](https://github.com/sagemath/sagetrac-mirror/commit/daec3e803e8f6a6de8e717459c31b2b7de7a8906)** to **[8b3f390](https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02)**



---

archive/issue_comments_506380.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02\">8b3f390</a></td><td><code>Merge tag '9.3.beta8' into t/31377/__configure___enable_editable</code></td></tr></table>\n",
    "created_at": "2021-03-07T21:07:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506380",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7" align="right">Comment 7</div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02">8b3f390</a></td><td><code>Merge tag '9.3.beta8' into t/31377/__configure___enable_editable</code></td></tr></table>




---

archive/issue_events_414205.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2021-03-07T21:07:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414205"
}
```



---

archive/issue_events_414206.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2021-03-07T21:07:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414206"
}
```



---

archive/issue_events_414207.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-07T21:08:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414207"
}
```



---

archive/issue_events_414208.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-07T21:08:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414208"
}
```



---

archive/issue_comments_506381.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/__configure___enable_editable](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/__configure___enable_editable)** to **[8b3f390](https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02)**",
    "created_at": "2021-03-09T00:00:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506381",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/__configure___enable_editable](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/__configure___enable_editable)** to **[8b3f390](https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02)**



---

archive/issue_events_414209.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-09T00:00:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414209"
}
```



---

archive/issue_events_414210.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "6c5c6b4386710960335d21041f8484ffc11ed632",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-03-09T00:00:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-414210"
}
```



---

archive/issue_comments_506382.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">Comment 0</div>\n\nI finally tracked this ticket has the breaking point of the way I build the documentation in sage-on-gentoo. This ticket not #30010. \n\nUnlike the current philosophy pursued by vanilla sage in distro we usually build documentation before installing. There are philosophy discussions to be had about the approaches. I am sometimes not even completely sure how things work. But here the reason is simple, before this ticket, all the sources where copied under `build/lib/` during the build process. After this ticket only the final compiled cython modules are found under `build/lib/`. Historically during the documentation building in sage-on-gentoo the just compiled copy of sagelib under `build/lib/` was used. This is not possible anymore.\n\nIs there a switch to pass to `setup.py` that would copy the source in `build/lib` after this ticket?",
    "created_at": "2021-03-09T21:57:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506382",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:0" align="right">Comment 0</div>

I finally tracked this ticket has the breaking point of the way I build the documentation in sage-on-gentoo. This ticket not #30010. 

Unlike the current philosophy pursued by vanilla sage in distro we usually build documentation before installing. There are philosophy discussions to be had about the approaches. I am sometimes not even completely sure how things work. But here the reason is simple, before this ticket, all the sources where copied under `build/lib/` during the build process. After this ticket only the final compiled cython modules are found under `build/lib/`. Historically during the documentation building in sage-on-gentoo the just compiled copy of sagelib under `build/lib/` was used. This is not possible anymore.

Is there a switch to pass to `setup.py` that would copy the source in `build/lib` after this ticket?



---

archive/issue_comments_506383.json:
```json
{
    "body": "Changed commit from **[8b3f390](https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02)** to none",
    "created_at": "2021-03-09T21:57:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506383",
    "user": "https://github.com/kiwifb"
}
```

Changed commit from **[8b3f390](https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02)** to none



---

archive/issue_comments_506384.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nI don't think this ticket changes anything if you don't use `configure --enable-editable`.",
    "created_at": "2021-03-09T22:10:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506384",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:1" align="right">Comment 1</div>

I don't think this ticket changes anything if you don't use `configure --enable-editable`.



---

archive/issue_comments_506385.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nJust be sure to use `build/pkgs/sagelib/src/setup.py`, not `src/setup.py`. This builds in `build/pkgs/sagelib/src/build/`.",
    "created_at": "2021-03-09T22:12:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506385",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">Comment 2</div>

Just be sure to use `build/pkgs/sagelib/src/setup.py`, not `src/setup.py`. This builds in `build/pkgs/sagelib/src/build/`.



---

archive/issue_comments_506386.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nI am working on top of Volker's merging branch to figure issues before they hit me when a beta is released. When the beta, rc or final release arrive I usually have worked out the issues. I have bisected the change of behavior to this ticket. By the sound of it, the change of behavior is accidental and you have no idea or care about it.\n\nOn a side note since you are mentioning it, I am not currently using `build/pkgs/sagelib/src/setup.py`, links to sources have proved troublesome so far. I am hoping to switch to that at some point when some packaging dust settles. But I should point out that it severely hamper my ability to build the documentation in the same package. Which is a point our current philosophy of building sage are getting divergent. But those are discussions we should have in another space than this ticket.",
    "created_at": "2021-03-09T22:30:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506386",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:3" align="right">Comment 3</div>

I am working on top of Volker's merging branch to figure issues before they hit me when a beta is released. When the beta, rc or final release arrive I usually have worked out the issues. I have bisected the change of behavior to this ticket. By the sound of it, the change of behavior is accidental and you have no idea or care about it.

On a side note since you are mentioning it, I am not currently using `build/pkgs/sagelib/src/setup.py`, links to sources have proved troublesome so far. I am hoping to switch to that at some point when some packaging dust settles. But I should point out that it severely hamper my ability to build the documentation in the same package. Which is a point our current philosophy of building sage are getting divergent. But those are discussions we should have in another space than this ticket.



---

archive/issue_comments_506387.json:
```json
{
    "body": "<div id=\"comment:124\" align=\"right\">Comment 124</div>\n\nReplying to [@kiwifb](#comment%3A123):\n> By the sound of it, the change of behavior is accidental\n\nNo. Since #30779, the Sage distribution has no longer used `src/setup.py`. It switched to using `build/pkgs/sagelib/src/setup.py`. You should do the same.",
    "created_at": "2021-03-09T22:36:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506387",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:124" align="right">Comment 124</div>

Replying to [@kiwifb](#comment%3A123):
> By the sound of it, the change of behavior is accidental

No. Since #30779, the Sage distribution has no longer used `src/setup.py`. It switched to using `build/pkgs/sagelib/src/setup.py`. You should do the same.



---

archive/issue_comments_506388.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nBy the way, if you want to discuss philosophy of docbuilding, --> #31356, #29868.",
    "created_at": "2021-03-09T22:41:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506388",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">Comment 5</div>

By the way, if you want to discuss philosophy of docbuilding, --> #31356, #29868.



---

archive/issue_comments_506389.json:
```json
{
    "body": "<div id=\"comment:126\" align=\"right\">Comment 126</div>\n\nReplying to [@mkoeppe](#comment%3A124):\n> Replying to [@kiwifb](#comment%3A123):\n> > By the sound of it, the change of behavior is accidental\n\n> \n> No. Since #30779, the Sage distribution has no longer used `src/setup.py`. It switched to using `build/pkgs/sagelib/src/setup.py`. You should do the same.\n\nI hadn't realised how much they diverged from each other. It feels like some tickets patch one but not the other and so on. Regardless of my issues and divergence in philosophy, as I called it, if the version in `src/setup.py` shouldn't be used or developed against we need to remove it and quickly.",
    "created_at": "2021-03-09T22:52:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506389",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:126" align="right">Comment 126</div>

Replying to [@mkoeppe](#comment%3A124):
> Replying to [@kiwifb](#comment%3A123):
> > By the sound of it, the change of behavior is accidental

> 
> No. Since #30779, the Sage distribution has no longer used `src/setup.py`. It switched to using `build/pkgs/sagelib/src/setup.py`. You should do the same.

I hadn't realised how much they diverged from each other. It feels like some tickets patch one but not the other and so on. Regardless of my issues and divergence in philosophy, as I called it, if the version in `src/setup.py` shouldn't be used or developed against we need to remove it and quickly.



---

archive/issue_comments_506390.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nNo, as of this ticket, it's used for `./configure --enable-editable`.",
    "created_at": "2021-03-09T22:58:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506390",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">Comment 7</div>

No, as of this ticket, it's used for `./configure --enable-editable`.



---

archive/issue_comments_506391.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nI think I am starting to get the picture. So those large looking differences are on purpose?",
    "created_at": "2021-03-09T23:04:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506391",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:8" align="right">Comment 8</div>

I think I am starting to get the picture. So those large looking differences are on purpose?



---

archive/issue_comments_506392.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nIt sounds like it would be good to add some explanatory comments at the top of `src/setup.py` (not by me, since I don't understand the situation).",
    "created_at": "2021-03-09T23:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506392",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:9" align="right">Comment 9</div>

It sounds like it would be good to add some explanatory comments at the top of `src/setup.py` (not by me, since I don't understand the situation).



---

archive/issue_comments_506393.json:
```json
{
    "body": "<div id=\"comment:130\" align=\"right\">Comment 130</div>\n\nReplying to [@kiwifb](#comment%3A128):\n> So those large looking differences are on purpose?\n\nYes! And yes, we'll have to add some documentation. I'll do this in #31386 (which will reduce the amount of duplication between the two `setup.py` files); this ticket is waiting for another big build system ticket, #30913.",
    "created_at": "2021-03-09T23:42:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506393",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:130" align="right">Comment 130</div>

Replying to [@kiwifb](#comment%3A128):
> So those large looking differences are on purpose?

Yes! And yes, we'll have to add some documentation. I'll do this in #31386 (which will reduce the amount of duplication between the two `setup.py` files); this ticket is waiting for another big build system ticket, #30913.
