# Issue 31377: ./configure --enable-editable

archive/issues_031140.json:
```json
{
    "assignees": [],
    "body": "This configure switch will install sagelib in \"develop\" (\"editable\", \"in-place\") mode instead of using sagelib's custom incremental build system.\n\nThis will clutter the source directory with build artifacts (which are `.gitignore`'d, of course) but it has the benefit that for changes to Python files, one does not need to run `./sage -b`; restarting Sage is enough.\n\nIt may also have benefits in certain develop environments that get confused by sagelib's nonstandard build system.\n\nThis ticket is based on a subset of the changes in #30371, which developed a version of `setup.py` suitable for the in-place build. This version is `src/setup.py` and distinct from `build/pkgs/sagelib/src/setup.py`.\nThe configure switch switches to this version of the build system.\n\nTo test:\n\n```\n./bootstrap\n./configure --enable-editable\nmake build\n```\nThen use and test as normal. Verify that `local/lib/...site-packages/` no longer contains a copy of `sage` - instead there is an \"egg-link\" back to the source directory.\n\n\nSwitching to a standard build system (getting rid of the sage-specific \"installation cleaner\") will also simplify the next step of the modularization effort (#29705).\n\n\nDepends on #30770\n\nDepends on #30912\n\nDepends on #31357\n\nDepends on #31365\n\nDepends on #31389\n\nDepends on #31390\n\n**CC:**  @tobiasdiez @jhpalmieri @fchapoton @videlec @isuruf @kliem @tscrim\n\n**Branch:** [8b3f3905c884f86293f103fe5bbb7a78c3d7ce02](https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02)\n\n**Reviewer:** Matthias Koeppe, Tobias Diez, Jonathan Kliem\n\n**Author:** Tobias Diez, Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/31377\n\n",
    "closed_at": "2021-03-09T00:00:42Z",
    "created_at": "2021-02-10T20:34:37Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/critical",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "./configure --enable-editable",
    "type": "issue",
    "updated_at": "2021-03-09T23:42:43Z",
    "url": "https://github.com/sagemath/sage/issues/31377",
    "user": "https://github.com/mkoeppe"
}
```
This configure switch will install sagelib in "develop" ("editable", "in-place") mode instead of using sagelib's custom incremental build system.

This will clutter the source directory with build artifacts (which are `.gitignore`'d, of course) but it has the benefit that for changes to Python files, one does not need to run `./sage -b`; restarting Sage is enough.

It may also have benefits in certain develop environments that get confused by sagelib's nonstandard build system.

This ticket is based on a subset of the changes in #30371, which developed a version of `setup.py` suitable for the in-place build. This version is `src/setup.py` and distinct from `build/pkgs/sagelib/src/setup.py`.
The configure switch switches to this version of the build system.

To test:

```
./bootstrap
./configure --enable-editable
make build
```
Then use and test as normal. Verify that `local/lib/...site-packages/` no longer contains a copy of `sage` - instead there is an "egg-link" back to the source directory.


Switching to a standard build system (getting rid of the sage-specific "installation cleaner") will also simplify the next step of the modularization effort (#29705).


Depends on #30770

Depends on #30912

Depends on #31357

Depends on #31365

Depends on #31389

Depends on #31390

**CC:**  @tobiasdiez @jhpalmieri @fchapoton @videlec @isuruf @kliem @tscrim

**Branch:** [8b3f3905c884f86293f103fe5bbb7a78c3d7ce02](https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02)

**Reviewer:** Matthias Koeppe, Tobias Diez, Jonathan Kliem

**Author:** Tobias Diez, Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/31377





---

archive/issue_events_380428.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-10T20:34:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380428"
}
```



---

archive/issue_events_380429.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-10T20:34:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "08517b",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380429"
}
```



---

archive/issue_events_380430.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-10T20:34:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380430"
}
```



---

archive/issue_comments_506035.json:
```json
{
    "body": "**Dependencies:** #30770, #30912, #31357, #31362",
    "created_at": "2021-02-10T20:41:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506035",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #30770, #30912, #31357, #31362



---

archive/issue_comments_506036.json:
```json
{
    "body": "**Changing dependencies** from \"#30770, #30912, #31357, #31362\" to \"#30770, #30912, #31357\".",
    "created_at": "2021-02-10T20:46:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506036",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#30770, #30912, #31357, #31362" to "#30770, #30912, #31357".



---

archive/issue_comments_506037.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/__configure___enable_editable](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/__configure___enable_editable)",
    "created_at": "2021-02-10T21:01:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506037",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/__configure___enable_editable](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/__configure___enable_editable)



---

archive/issue_comments_506038.json:
```json
{
    "body": "**Commit:** [3dcfbe90735023422e4f6a79594b0034290adf96](https://github.com/sagemath/sagetrac-mirror/commit/3dcfbe90735023422e4f6a79594b0034290adf96)",
    "created_at": "2021-02-10T21:20:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506038",
    "user": "https://github.com/sagetrac-git"
}
```

**Commit:** [3dcfbe90735023422e4f6a79594b0034290adf96](https://github.com/sagemath/sagetrac-mirror/commit/3dcfbe90735023422e4f6a79594b0034290adf96)



---

archive/issue_comments_506039.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3dcfbe90735023422e4f6a79594b0034290adf96\">3dcfbe9</a></td><td><code>build/pkgs/sagelib: Implement --enable-editable</code></td></tr></table>\n",
    "created_at": "2021-02-10T21:20:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506039",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:4'>**Comment 4:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3dcfbe90735023422e4f6a79594b0034290adf96">3dcfbe9</a></td><td><code>build/pkgs/sagelib: Implement --enable-editable</code></td></tr></table>




---

archive/issue_comments_506040.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f8ad239bea1847b5008de00b8ac5ebfbced6f122\">f8ad239</a></td><td><code>src/setup.py: Do not look for namespace packages in bin, doc</code></td></tr></table>\n",
    "created_at": "2021-02-10T21:42:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506040",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:5'>**Comment 5:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f8ad239bea1847b5008de00b8ac5ebfbced6f122">f8ad239</a></td><td><code>src/setup.py: Do not look for namespace packages in bin, doc</code></td></tr></table>




---

archive/issue_comments_506041.json:
```json
{
    "body": "**Changing commit** from \"[3dcfbe90735023422e4f6a79594b0034290adf96](https://github.com/sagemath/sagetrac-mirror/commit/3dcfbe90735023422e4f6a79594b0034290adf96)\" to \"[f8ad239bea1847b5008de00b8ac5ebfbced6f122](https://github.com/sagemath/sagetrac-mirror/commit/f8ad239bea1847b5008de00b8ac5ebfbced6f122)\".",
    "created_at": "2021-02-10T21:42:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506041",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[3dcfbe90735023422e4f6a79594b0034290adf96](https://github.com/sagemath/sagetrac-mirror/commit/3dcfbe90735023422e4f6a79594b0034290adf96)" to "[f8ad239bea1847b5008de00b8ac5ebfbced6f122](https://github.com/sagemath/sagetrac-mirror/commit/f8ad239bea1847b5008de00b8ac5ebfbced6f122)".



---

archive/issue_comments_506042.json:
```json
{
    "body": "**Changing commit** from \"[f8ad239bea1847b5008de00b8ac5ebfbced6f122](https://github.com/sagemath/sagetrac-mirror/commit/f8ad239bea1847b5008de00b8ac5ebfbced6f122)\" to \"[edbe3d5eb69da6d685365be46c7c3d53d242ae54](https://github.com/sagemath/sagetrac-mirror/commit/edbe3d5eb69da6d685365be46c7c3d53d242ae54)\".",
    "created_at": "2021-02-10T22:08:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506042",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[f8ad239bea1847b5008de00b8ac5ebfbced6f122](https://github.com/sagemath/sagetrac-mirror/commit/f8ad239bea1847b5008de00b8ac5ebfbced6f122)" to "[edbe3d5eb69da6d685365be46c7c3d53d242ae54](https://github.com/sagemath/sagetrac-mirror/commit/edbe3d5eb69da6d685365be46c7c3d53d242ae54)".



---

archive/issue_comments_506043.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/043d3ab5d754aff9ddd3813087a810cd351fc9e6\">043d3ab</a></td><td><code>Fixup version files/symlinks</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/edbe3d5eb69da6d685365be46c7c3d53d242ae54\">edbe3d5</a></td><td><code>Merge branch 't/31357/fixup_src_version_txt_added_in__30912' into t/31377/__configure___enable_editable</code></td></tr></table>\n",
    "created_at": "2021-02-10T22:08:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506043",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>**Comment 6:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/043d3ab5d754aff9ddd3813087a810cd351fc9e6">043d3ab</a></td><td><code>Fixup version files/symlinks</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/edbe3d5eb69da6d685365be46c7c3d53d242ae54">edbe3d5</a></td><td><code>Merge branch 't/31357/fixup_src_version_txt_added_in__30912' into t/31377/__configure___enable_editable</code></td></tr></table>




---

archive/issue_comments_506044.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\nThis almost works for me, except for some errors building modules:\n\n```\n[sagelib-9.3.beta7]     gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk -O2 -g -march=native -Isage/libs/ntl -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/cysignals -Isage/cpython -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src -I/usr/local/Cellar/python@3.9/3.9.1_8/Frameworks/Python.framework/Versions/3.9/include/python3.9 -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/numpy/core/include -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/include -I/usr/local/Cellar/python@3.9/3.9.1_8/Frameworks/Python.framework/Versions/3.9/include/python3.9 -c sage/libs/ntl/ntl_ZZ.cpp -o build/temp.macosx-10.15-x86_64-3.9/sage/libs/ntl/ntl_ZZ.o\n[sagelib-9.3.beta7]     In file included from sage/libs/ntl/error.cpp:1283:\n[sagelib-9.3.beta7]     ../local/include/NTL/tools.h:1064:1: error: unknown type name 'constexpr'\n[sagelib-9.3.beta7]     constexpr bool Relocate_aux_has_trivial_copy(T*)\n[sagelib-9.3.beta7]     ^\n```\n\nThis is probably coming from the fact that the C++ std options that `sage_build_cython.create_extension` uses are not used by the new build system.",
    "created_at": "2021-02-10T23:12:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506044",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'>**Comment 7:**</a>
This almost works for me, except for some errors building modules:

```
[sagelib-9.3.beta7]     gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk -O2 -g -march=native -Isage/libs/ntl -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/cysignals -Isage/cpython -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src -I/usr/local/Cellar/python@3.9/3.9.1_8/Frameworks/Python.framework/Versions/3.9/include/python3.9 -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/numpy/core/include -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/include -I/usr/local/Cellar/python@3.9/3.9.1_8/Frameworks/Python.framework/Versions/3.9/include/python3.9 -c sage/libs/ntl/ntl_ZZ.cpp -o build/temp.macosx-10.15-x86_64-3.9/sage/libs/ntl/ntl_ZZ.o
[sagelib-9.3.beta7]     In file included from sage/libs/ntl/error.cpp:1283:
[sagelib-9.3.beta7]     ../local/include/NTL/tools.h:1064:1: error: unknown type name 'constexpr'
[sagelib-9.3.beta7]     constexpr bool Relocate_aux_has_trivial_copy(T*)
[sagelib-9.3.beta7]     ^
```

This is probably coming from the fact that the C++ std options that `sage_build_cython.create_extension` uses are not used by the new build system.



---

archive/issue_comments_506045.json:
```json
{
    "body": "**Changing commit** from \"[edbe3d5eb69da6d685365be46c7c3d53d242ae54](https://github.com/sagemath/sagetrac-mirror/commit/edbe3d5eb69da6d685365be46c7c3d53d242ae54)\" to \"[731ff530491af9dfcc46a9d9c226485f2f91caa6](https://github.com/sagemath/sagetrac-mirror/commit/731ff530491af9dfcc46a9d9c226485f2f91caa6)\".",
    "created_at": "2021-02-11T04:17:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506045",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[edbe3d5eb69da6d685365be46c7c3d53d242ae54](https://github.com/sagemath/sagetrac-mirror/commit/edbe3d5eb69da6d685365be46c7c3d53d242ae54)" to "[731ff530491af9dfcc46a9d9c226485f2f91caa6](https://github.com/sagemath/sagetrac-mirror/commit/731ff530491af9dfcc46a9d9c226485f2f91caa6)".



---

archive/issue_comments_506046.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/804ebd7689fe8423e901e8ecf38dd62a7a9b8789\">804ebd7</a></td><td><code>sage_setup.dpcbuild.AllBuilder: Restrict workaround to macOS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4ceee5dae4caa7dac7a6fe7ca29538aca2d381a\">b4ceee5</a></td><td><code>sage_setup.docbuild: In the workaround, do not go through build_many to build serially</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7369a3e90d96862388dc32153e8644a82ebcccde\">7369a3e</a></td><td><code>Merge branch 't/31344/homebrew__docbuild_crashes__libtcl_atforkprepare' into t/31365/add_ntl_to_cython_aliases</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce03e6b8a93777820c94d83eeb42d8b70c222a73\">ce03e6b</a></td><td><code>src/sage/schemes/hyperelliptic_curves/hypellfrob.pyx: Merge distutils directives</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32576b43a0415a9e15d1cbe6beac2dd4c300a745\">32576b4</a></td><td><code>sage.misc.cython: Add NTL aliases, cache result of cython_aliases</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e30e3ac2d891a16fdd1ad89506db767d4edb9e5\">6e30e3a</a></td><td><code>Use variables NTL_INCDIR, NTL_LIBDIR in sage_conf, separate from NTL_PREFIX used in sage-build-env-config; set -std=c++11 in NTL_CFLAGS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7b1e27b96e143d6d44b448692ba266050e667399\">7b1e27b</a></td><td><code>Merge distutils directives for Cython files using ntl</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4d2828df69cd02e128a43a53b32e67cb63caacb9\">4d2828d</a></td><td><code>Switch Cython files that use NTL to language = c++</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/904a494346f51b1d9e5cd6474c75b39278f5fa8f\">904a494</a></td><td><code>Merge branch 't/31365/add_ntl_to_cython_aliases' into t/31377/__configure___enable_editable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/731ff530491af9dfcc46a9d9c226485f2f91caa6\">731ff53</a></td><td><code>Switch some Cython files to c++, add some -std=c++11</code></td></tr></table>\n",
    "created_at": "2021-02-11T04:17:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506046",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'>**Comment 8:**</a>
**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/804ebd7689fe8423e901e8ecf38dd62a7a9b8789">804ebd7</a></td><td><code>sage_setup.dpcbuild.AllBuilder: Restrict workaround to macOS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4ceee5dae4caa7dac7a6fe7ca29538aca2d381a">b4ceee5</a></td><td><code>sage_setup.docbuild: In the workaround, do not go through build_many to build serially</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7369a3e90d96862388dc32153e8644a82ebcccde">7369a3e</a></td><td><code>Merge branch 't/31344/homebrew__docbuild_crashes__libtcl_atforkprepare' into t/31365/add_ntl_to_cython_aliases</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce03e6b8a93777820c94d83eeb42d8b70c222a73">ce03e6b</a></td><td><code>src/sage/schemes/hyperelliptic_curves/hypellfrob.pyx: Merge distutils directives</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32576b43a0415a9e15d1cbe6beac2dd4c300a745">32576b4</a></td><td><code>sage.misc.cython: Add NTL aliases, cache result of cython_aliases</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e30e3ac2d891a16fdd1ad89506db767d4edb9e5">6e30e3a</a></td><td><code>Use variables NTL_INCDIR, NTL_LIBDIR in sage_conf, separate from NTL_PREFIX used in sage-build-env-config; set -std=c++11 in NTL_CFLAGS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7b1e27b96e143d6d44b448692ba266050e667399">7b1e27b</a></td><td><code>Merge distutils directives for Cython files using ntl</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4d2828df69cd02e128a43a53b32e67cb63caacb9">4d2828d</a></td><td><code>Switch Cython files that use NTL to language = c++</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/904a494346f51b1d9e5cd6474c75b39278f5fa8f">904a494</a></td><td><code>Merge branch 't/31365/add_ntl_to_cython_aliases' into t/31377/__configure___enable_editable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/731ff530491af9dfcc46a9d9c226485f2f91caa6">731ff53</a></td><td><code>Switch some Cython files to c++, add some -std=c++11</code></td></tr></table>




---

archive/issue_comments_506047.json:
```json
{
    "body": "**Changing dependencies** from \"#30770, #30912, #31357\" to \"#30770, #30912, #31357, #31365\".",
    "created_at": "2021-02-11T04:19:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506047",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#30770, #30912, #31357" to "#30770, #30912, #31357, #31365".



---

archive/issue_comments_506048.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nI have merged #31365, which adds directives to files using NTL; and added a few more distutils directives so that things don't depend so much on the code in `sage_build_cython.create_extension`.",
    "created_at": "2021-02-11T04:19:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506048",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'>**Comment 9:**</a>
I have merged #31365, which adds directives to files using NTL; and added a few more distutils directives so that things don't depend so much on the code in `sage_build_cython.create_extension`.



---

archive/issue_events_380431.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-11T04:19:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380431"
}
```



---

archive/issue_comments_506049.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This configure switch will install sagelib in \"develop\" (\"editable\", \"in-place\") mode instead of using the traditional incremental build system.\n+This configure switch will install sagelib in \"develop\" (\"editable\", \"in-place\") mode instead of using sagelib's custom incremental build system.\n \n This will clutter the source directory with build artifacts (which are `.gitignore`'d, of course) but it has the benefit that for changes to Python files, one does not need to run `./sage -b`; restarting Sage is enough.\n \n``````\n",
    "created_at": "2021-02-11T04:19:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506049",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This configure switch will install sagelib in "develop" ("editable", "in-place") mode instead of using the traditional incremental build system.
+This configure switch will install sagelib in "develop" ("editable", "in-place") mode instead of using sagelib's custom incremental build system.
 
 This will clutter the source directory with build artifacts (which are `.gitignore`'d, of course) but it has the benefit that for changes to Python files, one does not need to run `./sage -b`; restarting Sage is enough.
 
``````




---

archive/issue_comments_506050.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,3 +8,5 @@\n The configure switch switches to this version of the build system.\n \n \n+Switching to a standard build system (getting rid of the sage-specific \"installation cleaner\") will also simplify the next step of the modularization effort (#29705).\n+\n``````\n",
    "created_at": "2021-02-11T04:22:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506050",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,3 +8,5 @@
 The configure switch switches to this version of the build system.
 
 
+Switching to a standard build system (getting rid of the sage-specific "installation cleaner") will also simplify the next step of the modularization effort (#29705).
+
``````




---

archive/issue_comments_506051.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n \n It may also have benefits in certain develop environments that get confused by sagelib's nonstandard build system.\n \n-This ticket is based on #30371, which developed a version of `setup.py` suitable for the in-place build. This version is `src/setup.py` and distinct from `build/pkgs/sagelib/src/setup.py`.\n+This ticket is based on a subset of the changes in #30371, which developed a version of `setup.py` suitable for the in-place build. This version is `src/setup.py` and distinct from `build/pkgs/sagelib/src/setup.py`.\n The configure switch switches to this version of the build system.\n \n \n``````\n",
    "created_at": "2021-02-11T04:37:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506051",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 
 It may also have benefits in certain develop environments that get confused by sagelib's nonstandard build system.
 
-This ticket is based on #30371, which developed a version of `setup.py` suitable for the in-place build. This version is `src/setup.py` and distinct from `build/pkgs/sagelib/src/setup.py`.
+This ticket is based on a subset of the changes in #30371, which developed a version of `setup.py` suitable for the in-place build. This version is `src/setup.py` and distinct from `build/pkgs/sagelib/src/setup.py`.
 The configure switch switches to this version of the build system.
 
 
``````




---

archive/issue_comments_506052.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\nThis seems to reasonably work well here on macOS. There are a small number of doctest failures.\n\n```\nsage -t --random-seed=0 src/sage/misc/sagedoc.py  # 2 doctests failed\nsage -t --random-seed=0 src/sage/misc/sageinspect.py  # 13 doctests failed\nsage -t --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/categories/primer.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/repl/ipython_tests.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/sets/set_from_iterator.py  # 2 doctests failed\nsage -t --random-seed=0 src/sage/interacts/debugger.py  # 2 doctests failed\nsage -t --random-seed=0 src/sage/misc/lazy_attribute.pyx  # 1 doctest failed\nsage -t --random-seed=0 src/sage/misc/nested_class.pyx  # 1 doctest failed\nsage -t --random-seed=0 src/sage/structure/dynamic_class.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/all.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/misc/edit_module.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/cpython/dict_del_by_value.pyx  # 2 doctests failed\nsage -t --random-seed=0 src/sage/graphs/graph_decompositions/tree_decomposition.pyx  # 35 doctests failed\n```\nThe last one is due to the fact that in the editable install all `.pyx` files, even when the modules are not compiled, are available and used for doctesting. \n\nThis will need a new solution to suppress the doctests of such modules - see #30778 (`sage.doctest.control`: Exclude doctests in files from non-installed distributions).",
    "created_at": "2021-02-11T05:54:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506052",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'>**Comment 13:**</a>
This seems to reasonably work well here on macOS. There are a small number of doctest failures.

```
sage -t --random-seed=0 src/sage/misc/sagedoc.py  # 2 doctests failed
sage -t --random-seed=0 src/sage/misc/sageinspect.py  # 13 doctests failed
sage -t --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/categories/primer.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/repl/ipython_tests.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/sets/set_from_iterator.py  # 2 doctests failed
sage -t --random-seed=0 src/sage/interacts/debugger.py  # 2 doctests failed
sage -t --random-seed=0 src/sage/misc/lazy_attribute.pyx  # 1 doctest failed
sage -t --random-seed=0 src/sage/misc/nested_class.pyx  # 1 doctest failed
sage -t --random-seed=0 src/sage/structure/dynamic_class.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/all.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/misc/edit_module.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/cpython/dict_del_by_value.pyx  # 2 doctests failed
sage -t --random-seed=0 src/sage/graphs/graph_decompositions/tree_decomposition.pyx  # 35 doctests failed
```
The last one is due to the fact that in the editable install all `.pyx` files, even when the modules are not compiled, are available and used for doctesting. 

This will need a new solution to suppress the doctests of such modules - see #30778 (`sage.doctest.control`: Exclude doctests in files from non-installed distributions).



---

archive/issue_comments_506053.json:
```json
{
    "body": "**Changing commit** from \"[731ff530491af9dfcc46a9d9c226485f2f91caa6](https://github.com/sagemath/sagetrac-mirror/commit/731ff530491af9dfcc46a9d9c226485f2f91caa6)\" to \"[18df2dc7c27d8e583d5ccdc6acfa39c955b8fa51](https://github.com/sagemath/sagetrac-mirror/commit/18df2dc7c27d8e583d5ccdc6acfa39c955b8fa51)\".",
    "created_at": "2021-02-11T07:26:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506053",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[731ff530491af9dfcc46a9d9c226485f2f91caa6](https://github.com/sagemath/sagetrac-mirror/commit/731ff530491af9dfcc46a9d9c226485f2f91caa6)" to "[18df2dc7c27d8e583d5ccdc6acfa39c955b8fa51](https://github.com/sagemath/sagetrac-mirror/commit/18df2dc7c27d8e583d5ccdc6acfa39c955b8fa51)".



---

archive/issue_comments_506054.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1cb260a86baaf0124514782a32888d6ce4e37c4f\">1cb260a</a></td><td><code>build/pkgs/sagelib/spkg-install: Remove --ignore-installed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/36bbd6cc2fd99635bf39f49f76cef2afb3e72591\">36bbd6c</a></td><td><code>build/make/Makefile.in (sagelib-clean): Remove .so files in editable installs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/993c35c931f9c9f2b459e66619cac7d587a4a08f\">993c35c</a></td><td><code>build/pkgs/ntl/spkg-configure.m4: Fix up</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18df2dc7c27d8e583d5ccdc6acfa39c955b8fa51\">18df2dc</a></td><td><code>Merge branch 't/31365/add_ntl_to_cython_aliases' into t/31377/__configure___enable_editable</code></td></tr></table>\n",
    "created_at": "2021-02-11T07:26:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506054",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:15'>**Comment 15:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1cb260a86baaf0124514782a32888d6ce4e37c4f">1cb260a</a></td><td><code>build/pkgs/sagelib/spkg-install: Remove --ignore-installed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/36bbd6cc2fd99635bf39f49f76cef2afb3e72591">36bbd6c</a></td><td><code>build/make/Makefile.in (sagelib-clean): Remove .so files in editable installs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/993c35c931f9c9f2b459e66619cac7d587a4a08f">993c35c</a></td><td><code>build/pkgs/ntl/spkg-configure.m4: Fix up</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18df2dc7c27d8e583d5ccdc6acfa39c955b8fa51">18df2dc</a></td><td><code>Merge branch 't/31365/add_ntl_to_cython_aliases' into t/31377/__configure___enable_editable</code></td></tr></table>




---

archive/issue_comments_506055.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\nplease stop adding me in cc",
    "created_at": "2021-02-11T08:12:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506055",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'>**Comment 16:**</a>
please stop adding me in cc



---

archive/issue_comments_506056.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\nSo how does one test this?",
    "created_at": "2021-02-11T21:25:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506056",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:17'>**Comment 17:**</a>
So how does one test this?



---

archive/issue_comments_506057.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,6 +7,14 @@\n This ticket is based on a subset of the changes in #30371, which developed a version of `setup.py` suitable for the in-place build. This version is `src/setup.py` and distinct from `build/pkgs/sagelib/src/setup.py`.\n The configure switch switches to this version of the build system.\n \n+To test:\n+\n+```\n+./configure --enable-editable\n+make build\n+```\n+Then use and test as normal. Verify that `local/lib/...site-packages/` no longer contains a copy of `sage` - instead there is an \"egg-link\" back to the source directory.\n+\n \n Switching to a standard build system (getting rid of the sage-specific \"installation cleaner\") will also simplify the next step of the modularization effort (#29705).\n \n``````\n",
    "created_at": "2021-02-11T21:42:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506057",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,6 +7,14 @@
 This ticket is based on a subset of the changes in #30371, which developed a version of `setup.py` suitable for the in-place build. This version is `src/setup.py` and distinct from `build/pkgs/sagelib/src/setup.py`.
 The configure switch switches to this version of the build system.
 
+To test:
+
+```
+./configure --enable-editable
+make build
+```
+Then use and test as normal. Verify that `local/lib/...site-packages/` no longer contains a copy of `sage` - instead there is an "egg-link" back to the source directory.
+
 
 Switching to a standard build system (getting rid of the sage-specific "installation cleaner") will also simplify the next step of the modularization effort (#29705).
 
``````




---

archive/issue_comments_506058.json:
```json
{
    "body": "<a id='comment:19'>**Comment 19:**</a>\nI've added quick instructions to the ticket description",
    "created_at": "2021-02-11T21:43:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506058",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'>**Comment 19:**</a>
I've added quick instructions to the ticket description



---

archive/issue_comments_506059.json:
```json
{
    "body": "**Reviewer:** Matthias Koeppe, ...",
    "created_at": "2021-02-11T22:13:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506059",
    "user": "https://github.com/mkoeppe"
}
```

**Reviewer:** Matthias Koeppe, ...



---

archive/issue_events_380432.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-12T16:20:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/critical",
    "label_color": "ff0000",
    "label_name": "critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380432"
}
```



---

archive/issue_comments_506060.json:
```json
{
    "body": "<a id='comment:22'>**Comment 22:**</a>\nThe installation of the Jupyter kernel is missing - done by `sage_setup.command.sage_install`",
    "created_at": "2021-02-12T17:47:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506060",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'>**Comment 22:**</a>
The installation of the Jupyter kernel is missing - done by `sage_setup.command.sage_install`



---

archive/issue_comments_506061.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\nReplying to [@mkoeppe](#comment%3A13):\n> This seems to reasonably work well here on macOS. There are a small number of doctest failures.\n> \n> ```\n> ...\n> sage -t --random-seed=0 src/sage/graphs/graph_decompositions/tree_decomposition.pyx  # 35 doctests failed\n> ```\n> The last one is due to the fact that in the editable install all `.pyx` files, even when the modules are not compiled, are available and used for doctesting. \n\nWrong guess, this is actually #31389.",
    "created_at": "2021-02-12T19:10:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506061",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'>**Comment 23:**</a>
Replying to [@mkoeppe](#comment%3A13):
> This seems to reasonably work well here on macOS. There are a small number of doctest failures.
> 
> ```
> ...
> sage -t --random-seed=0 src/sage/graphs/graph_decompositions/tree_decomposition.pyx  # 35 doctests failed
> ```
> The last one is due to the fact that in the editable install all `.pyx` files, even when the modules are not compiled, are available and used for doctesting. 

Wrong guess, this is actually #31389.



---

archive/issue_comments_506062.json:
```json
{
    "body": "**Changing dependencies** from \"#30770, #30912, #31357, #31365\" to \"#30770, #30912, #31357, #31365, #31389\".",
    "created_at": "2021-02-12T19:22:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506062",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#30770, #30912, #31357, #31365" to "#30770, #30912, #31357, #31365, #31389".



---

archive/issue_comments_506063.json:
```json
{
    "body": "<a id='comment:25'>**Comment 25:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/19ca17aa08c610e1ed900b39662fb2ba1ec8455e\">19ca17a</a></td><td><code>src/sage/graphs/graph_decompositions/tdlib/sage_tdlib.cpp: Move one directory level higher</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f02963b28d939a7f409914a246d74dce7bfc41d4\">f02963b</a></td><td><code>Merge branch 't/31389/remove_clash_of_tdlib__with_tdlib_pyx_in__src_sage_graphs_graph_decompositions' into t/31377/__configure___enable_editable</code></td></tr></table>\n",
    "created_at": "2021-02-12T19:23:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506063",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:25'>**Comment 25:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/19ca17aa08c610e1ed900b39662fb2ba1ec8455e">19ca17a</a></td><td><code>src/sage/graphs/graph_decompositions/tdlib/sage_tdlib.cpp: Move one directory level higher</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f02963b28d939a7f409914a246d74dce7bfc41d4">f02963b</a></td><td><code>Merge branch 't/31389/remove_clash_of_tdlib__with_tdlib_pyx_in__src_sage_graphs_graph_decompositions' into t/31377/__configure___enable_editable</code></td></tr></table>




---

archive/issue_comments_506064.json:
```json
{
    "body": "**Changing commit** from \"[18df2dc7c27d8e583d5ccdc6acfa39c955b8fa51](https://github.com/sagemath/sagetrac-mirror/commit/18df2dc7c27d8e583d5ccdc6acfa39c955b8fa51)\" to \"[f02963b28d939a7f409914a246d74dce7bfc41d4](https://github.com/sagemath/sagetrac-mirror/commit/f02963b28d939a7f409914a246d74dce7bfc41d4)\".",
    "created_at": "2021-02-12T19:23:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506064",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[18df2dc7c27d8e583d5ccdc6acfa39c955b8fa51](https://github.com/sagemath/sagetrac-mirror/commit/18df2dc7c27d8e583d5ccdc6acfa39c955b8fa51)" to "[f02963b28d939a7f409914a246d74dce7bfc41d4](https://github.com/sagemath/sagetrac-mirror/commit/f02963b28d939a7f409914a246d74dce7bfc41d4)".



---

archive/issue_comments_506065.json:
```json
{
    "body": "**Changing commit** from \"[f02963b28d939a7f409914a246d74dce7bfc41d4](https://github.com/sagemath/sagetrac-mirror/commit/f02963b28d939a7f409914a246d74dce7bfc41d4)\" to \"[2b293f889f827ec5769ad6ca601294284d9a1f24](https://github.com/sagemath/sagetrac-mirror/commit/2b293f889f827ec5769ad6ca601294284d9a1f24)\".",
    "created_at": "2021-02-12T22:14:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506065",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[f02963b28d939a7f409914a246d74dce7bfc41d4](https://github.com/sagemath/sagetrac-mirror/commit/f02963b28d939a7f409914a246d74dce7bfc41d4)" to "[2b293f889f827ec5769ad6ca601294284d9a1f24](https://github.com/sagemath/sagetrac-mirror/commit/2b293f889f827ec5769ad6ca601294284d9a1f24)".



---

archive/issue_comments_506066.json:
```json
{
    "body": "<a id='comment:26'>**Comment 26:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2b293f889f827ec5769ad6ca601294284d9a1f24\">2b293f8</a></td><td><code>src/setup.py: Install the jupyter kernel using sage_install</code></td></tr></table>\n",
    "created_at": "2021-02-12T22:14:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506066",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:26'>**Comment 26:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2b293f889f827ec5769ad6ca601294284d9a1f24">2b293f8</a></td><td><code>src/setup.py: Install the jupyter kernel using sage_install</code></td></tr></table>




---

archive/issue_comments_506067.json:
```json
{
    "body": "<a id='comment:27'>**Comment 27:**</a>\n``sage.misc.sageinspect`` is broken in an editable build, which causes the docbuild to fail.",
    "created_at": "2021-02-13T00:30:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506067",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'>**Comment 27:**</a>
``sage.misc.sageinspect`` is broken in an editable build, which causes the docbuild to fail.



---

archive/issue_events_380433.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T00:30:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380433"
}
```



---

archive/issue_events_380434.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T00:30:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380434"
}
```



---

archive/issue_comments_506068.json:
```json
{
    "body": "<a id='comment:28'>**Comment 28:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b05e4ba3e981959a0ce39ff39e56d5d5e0b16971\">b05e4ba</a></td><td><code>build/make/Makefile.in (sagelib-clean): Remove generated .c and .cpp files</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/271d42733078659c963550e07970440101a73ab7\">271d427</a></td><td><code>src/setup.py: Fix sage.misc.sageinspect by setting Cython.Compiler.Options.embed_pos_in_docstring</code></td></tr></table>\n",
    "created_at": "2021-02-13T01:20:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506068",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:28'>**Comment 28:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b05e4ba3e981959a0ce39ff39e56d5d5e0b16971">b05e4ba</a></td><td><code>build/make/Makefile.in (sagelib-clean): Remove generated .c and .cpp files</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/271d42733078659c963550e07970440101a73ab7">271d427</a></td><td><code>src/setup.py: Fix sage.misc.sageinspect by setting Cython.Compiler.Options.embed_pos_in_docstring</code></td></tr></table>




---

archive/issue_comments_506069.json:
```json
{
    "body": "**Changing commit** from \"[2b293f889f827ec5769ad6ca601294284d9a1f24](https://github.com/sagemath/sagetrac-mirror/commit/2b293f889f827ec5769ad6ca601294284d9a1f24)\" to \"[271d42733078659c963550e07970440101a73ab7](https://github.com/sagemath/sagetrac-mirror/commit/271d42733078659c963550e07970440101a73ab7)\".",
    "created_at": "2021-02-13T01:20:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506069",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[2b293f889f827ec5769ad6ca601294284d9a1f24](https://github.com/sagemath/sagetrac-mirror/commit/2b293f889f827ec5769ad6ca601294284d9a1f24)" to "[271d42733078659c963550e07970440101a73ab7](https://github.com/sagemath/sagetrac-mirror/commit/271d42733078659c963550e07970440101a73ab7)".



---

archive/issue_comments_506070.json:
```json
{
    "body": "<a id='comment:29'>**Comment 29:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6b2fc4f0f461b2f18aedf49ba238db7a7fdc8b3\">f6b2fc4</a></td><td><code>src/sage/repl/interpreter.py: Fix a doctest for editable installs of sagelib</code></td></tr></table>\n",
    "created_at": "2021-02-13T02:02:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506070",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:29'>**Comment 29:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6b2fc4f0f461b2f18aedf49ba238db7a7fdc8b3">f6b2fc4</a></td><td><code>src/sage/repl/interpreter.py: Fix a doctest for editable installs of sagelib</code></td></tr></table>




---

archive/issue_comments_506071.json:
```json
{
    "body": "**Changing commit** from \"[271d42733078659c963550e07970440101a73ab7](https://github.com/sagemath/sagetrac-mirror/commit/271d42733078659c963550e07970440101a73ab7)\" to \"[f6b2fc4f0f461b2f18aedf49ba238db7a7fdc8b3](https://github.com/sagemath/sagetrac-mirror/commit/f6b2fc4f0f461b2f18aedf49ba238db7a7fdc8b3)\".",
    "created_at": "2021-02-13T02:02:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506071",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[271d42733078659c963550e07970440101a73ab7](https://github.com/sagemath/sagetrac-mirror/commit/271d42733078659c963550e07970440101a73ab7)" to "[f6b2fc4f0f461b2f18aedf49ba238db7a7fdc8b3](https://github.com/sagemath/sagetrac-mirror/commit/f6b2fc4f0f461b2f18aedf49ba238db7a7fdc8b3)".



---

archive/issue_events_380435.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T02:02:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380435"
}
```



---

archive/issue_events_380436.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T02:02:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380436"
}
```



---

archive/issue_comments_506072.json:
```json
{
    "body": "**Changing dependencies** from \"#30770, #30912, #31357, #31365, #31389\" to \"#30770, #30912, #31357, #31365, #31389, #31390\".",
    "created_at": "2021-02-13T02:07:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506072",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#30770, #30912, #31357, #31365, #31389" to "#30770, #30912, #31357, #31365, #31389, #31390".



---

archive/issue_comments_506073.json:
```json
{
    "body": "**Changing commit** from \"[f6b2fc4f0f461b2f18aedf49ba238db7a7fdc8b3](https://github.com/sagemath/sagetrac-mirror/commit/f6b2fc4f0f461b2f18aedf49ba238db7a7fdc8b3)\" to \"[e5d47ce731d44f099d635172b34654481eb7e13b](https://github.com/sagemath/sagetrac-mirror/commit/e5d47ce731d44f099d635172b34654481eb7e13b)\".",
    "created_at": "2021-02-13T02:09:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506073",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[f6b2fc4f0f461b2f18aedf49ba238db7a7fdc8b3](https://github.com/sagemath/sagetrac-mirror/commit/f6b2fc4f0f461b2f18aedf49ba238db7a7fdc8b3)" to "[e5d47ce731d44f099d635172b34654481eb7e13b](https://github.com/sagemath/sagetrac-mirror/commit/e5d47ce731d44f099d635172b34654481eb7e13b)".



---

archive/issue_comments_506074.json:
```json
{
    "body": "<a id='comment:32'>**Comment 32:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9a0731aa00a6eace3b4c779b3399df898286d112\">9a0731a</a></td><td><code>sage.interacs.debugger: Remove deprecated module</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e5d47ce731d44f099d635172b34654481eb7e13b\">e5d47ce</a></td><td><code>Merge branch 't/31390/remove_deprecated_sage_interacts_debugger' into t/31377/__configure___enable_editable</code></td></tr></table>\n",
    "created_at": "2021-02-13T02:09:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506074",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:32'>**Comment 32:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9a0731aa00a6eace3b4c779b3399df898286d112">9a0731a</a></td><td><code>sage.interacs.debugger: Remove deprecated module</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e5d47ce731d44f099d635172b34654481eb7e13b">e5d47ce</a></td><td><code>Merge branch 't/31390/remove_deprecated_sage_interacts_debugger' into t/31377/__configure___enable_editable</code></td></tr></table>




---

archive/issue_comments_506075.json:
```json
{
    "body": "<a id='comment:33'>**Comment 33:**</a>\nNow the documentation builds OK and also `make ptest` is fine.",
    "created_at": "2021-02-13T02:10:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506075",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'>**Comment 33:**</a>
Now the documentation builds OK and also `make ptest` is fine.



---

archive/issue_comments_506076.json:
```json
{
    "body": "<a id='comment:34'>**Comment 34:**</a>\nCan you please include the most recent version of setup.py from #30371. Thanks!",
    "created_at": "2021-02-13T09:24:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506076",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:34'>**Comment 34:**</a>
Can you please include the most recent version of setup.py from #30371. Thanks!



---

archive/issue_events_380437.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-02-13T09:24:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380437"
}
```



---

archive/issue_events_380438.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-02-13T09:24:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380438"
}
```



---

archive/issue_comments_506077.json:
```json
{
    "body": "<a id='comment:35'>**Comment 35:**</a>\nThe changes there conflict with the changes done and tested here already.",
    "created_at": "2021-02-13T18:24:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506077",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'>**Comment 35:**</a>
The changes there conflict with the changes done and tested here already.



---

archive/issue_events_380439.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T18:24:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380439"
}
```



---

archive/issue_events_380440.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T18:24:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380440"
}
```



---

archive/issue_comments_506078.json:
```json
{
    "body": "<a id='comment:36'>**Comment 36:**</a>\n(Let's please get this in - unless there are problems on this ticket that need solving here. Otherwise please merge this branch into #30371, resolving the conflicts, and let me know)",
    "created_at": "2021-02-13T18:39:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506078",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'>**Comment 36:**</a>
(Let's please get this in - unless there are problems on this ticket that need solving here. Otherwise please merge this branch into #30371, resolving the conflicts, and let me know)



---

archive/issue_comments_506079.json:
```json
{
    "body": "<a id='comment:38'>**Comment 38:**</a>\nReplying to [@mkoeppe](#comment%3A35):\n> The changes there conflict with the changes done and tested here already.\n\nWhat conflicts do you mean?\nI was referring to the improvements to this code:\n\n```\n+# Exclude a few files if the corresponding distribution is not loaded\n+optional_packages = ['mcqd', 'bliss', 'tdlib', 'primecount',\n+                     'coxeter3', 'fes', 'sirocco', 'meataxe']\n+not_installed_packages = [package for package in optional_packages\n+                          if not is_package_installed_and_updated(package)]\n+\n+distributions_to_exclude = [f\"sage-{pkg}\"\n+                            for pkg in not_installed_packages]\n+files_to_exclude = filter_cython_sources(SAGE_SRC, distributions_to_exclude)\n+\n+log.debug(f\"files_to_exclude = {files_to_exclude}\")\n+\n+python_packages = find_namespace_packages(where=SAGE_SRC, exclude=['bin', 'doc'])\n+log.debug(f\"python_packages = {python_packages}\")\n+\n+log.info(f\"Discovered Python/Cython sources, time: {(time.time() - t):.2f} seconds.\")\n+\n+# from sage_build_cython:\n+import Cython.Compiler.Options\n+Cython.Compiler.Options.embed_pos_in_docstring = True\n+\n+try:\n+    log.info(\"Generating auto-generated sources\")\n+    from sage_setup.autogen import autogen_all\n+    autogen_all()\n+\n+    from Cython.Build import cythonize\n+    from sage.env import cython_aliases, sage_include_directories\n+    extensions = cythonize(\n+        [\"**/*.pyx\"],\n+        exclude=files_to_exclude,\n+        include_path=sage_include_directories(use_sources=True) + ['.'],\n+        compile_time_env=compile_time_env_variables(),\n+        compiler_directives=compiler_directives(False),\n+        aliases=cython_aliases(),\n+        create_extension=create_extension,\n+        nthreads=4)\n+except Exception as exception:\n+    log.warn(f\"Exception while generating and cythonizing source files: {exception}\")\n+    extensions = None\n```\n\nThis has a few problems/issues:\n- The first few lines still raise an exception if Cython (and maybe other packages) are not installed.\n- You want to auto-generate code before filtering it / excluding parts of it.\n- The exception catch is to general and was meant to only capture module import errors.\n\nAll these things are fixed in #30371.\n-",
    "created_at": "2021-02-13T18:50:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506079",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:38'>**Comment 38:**</a>
Replying to [@mkoeppe](#comment%3A35):
> The changes there conflict with the changes done and tested here already.

What conflicts do you mean?
I was referring to the improvements to this code:

```
+# Exclude a few files if the corresponding distribution is not loaded
+optional_packages = ['mcqd', 'bliss', 'tdlib', 'primecount',
+                     'coxeter3', 'fes', 'sirocco', 'meataxe']
+not_installed_packages = [package for package in optional_packages
+                          if not is_package_installed_and_updated(package)]
+
+distributions_to_exclude = [f"sage-{pkg}"
+                            for pkg in not_installed_packages]
+files_to_exclude = filter_cython_sources(SAGE_SRC, distributions_to_exclude)
+
+log.debug(f"files_to_exclude = {files_to_exclude}")
+
+python_packages = find_namespace_packages(where=SAGE_SRC, exclude=['bin', 'doc'])
+log.debug(f"python_packages = {python_packages}")
+
+log.info(f"Discovered Python/Cython sources, time: {(time.time() - t):.2f} seconds.")
+
+# from sage_build_cython:
+import Cython.Compiler.Options
+Cython.Compiler.Options.embed_pos_in_docstring = True
+
+try:
+    log.info("Generating auto-generated sources")
+    from sage_setup.autogen import autogen_all
+    autogen_all()
+
+    from Cython.Build import cythonize
+    from sage.env import cython_aliases, sage_include_directories
+    extensions = cythonize(
+        ["**/*.pyx"],
+        exclude=files_to_exclude,
+        include_path=sage_include_directories(use_sources=True) + ['.'],
+        compile_time_env=compile_time_env_variables(),
+        compiler_directives=compiler_directives(False),
+        aliases=cython_aliases(),
+        create_extension=create_extension,
+        nthreads=4)
+except Exception as exception:
+    log.warn(f"Exception while generating and cythonizing source files: {exception}")
+    extensions = None
```

This has a few problems/issues:
- The first few lines still raise an exception if Cython (and maybe other packages) are not installed.
- You want to auto-generate code before filtering it / excluding parts of it.
- The exception catch is to general and was meant to only capture module import errors.

All these things are fixed in #30371.
-



---

archive/issue_comments_506080.json:
```json
{
    "body": "<a id='comment:39'>**Comment 39:**</a>\nOK, fine, I'll do the merging.",
    "created_at": "2021-02-13T19:07:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506080",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'>**Comment 39:**</a>
OK, fine, I'll do the merging.



---

archive/issue_comments_506081.json:
```json
{
    "body": "<a id='comment:40'>**Comment 40:**</a>\nConcerning this change:\n\n```\n # distutils: language = c++\n+# distutils: extra_compile_args = -std=c++11\n```\nWoudn't it make sense to specify `-std=c++11` automatically once `language = c++` is set? In fact there is code that looks like it is doing this job in sage_build_cython.\n\nI think also the cython files in libs/singular need similar changes (at least in #30371 errors are thrown otherwise).",
    "created_at": "2021-02-13T19:08:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506081",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:40'>**Comment 40:**</a>
Concerning this change:

```
 # distutils: language = c++
+# distutils: extra_compile_args = -std=c++11
```
Woudn't it make sense to specify `-std=c++11` automatically once `language = c++` is set? In fact there is code that looks like it is doing this job in sage_build_cython.

I think also the cython files in libs/singular need similar changes (at least in #30371 errors are thrown otherwise).



---

archive/issue_comments_506082.json:
```json
{
    "body": "<a id='comment:41'>**Comment 41:**</a>\nReplying to [@tobiasdiez](#comment%3A40):\n> Concerning this change:\n> \n> ```\n>  # distutils: language = c++\n> +# distutils: extra_compile_args = -std=c++11\n> ```\n> Woudn't it make sense to specify `-std=c++11` automatically once `language = c++` is set? In fact there is code that looks like it is doing this job in sage_build_cython.\n\nOf course, but you decided not to use the existing code. So I have made the changes that make it work.",
    "created_at": "2021-02-13T19:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506082",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'>**Comment 41:**</a>
Replying to [@tobiasdiez](#comment%3A40):
> Concerning this change:
> 
> ```
>  # distutils: language = c++
> +# distutils: extra_compile_args = -std=c++11
> ```
> Woudn't it make sense to specify `-std=c++11` automatically once `language = c++` is set? In fact there is code that looks like it is doing this job in sage_build_cython.

Of course, but you decided not to use the existing code. So I have made the changes that make it work.



---

archive/issue_comments_506083.json:
```json
{
    "body": "<a id='comment:42'>**Comment 42:**</a>\nImportant to keep in mind that I have created this ticket so that we can ship something in Sage 9.3 that works. So let's please keep focused on what is described here on the ticket description.\n\nReplying to [@tobiasdiez](#comment%3A38):\n> - The first few lines still raise an exception if Cython (and maybe other packages) are not installed.\n\nNot important for this ticket; we do have Cython. \n\n> - You want to auto-generate code before filtering it / excluding parts of it.\n\nWhy? Even after modularization, there will be exactly 1 module that will contain the autogenerated files.",
    "created_at": "2021-02-13T19:18:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506083",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'>**Comment 42:**</a>
Important to keep in mind that I have created this ticket so that we can ship something in Sage 9.3 that works. So let's please keep focused on what is described here on the ticket description.

Replying to [@tobiasdiez](#comment%3A38):
> - The first few lines still raise an exception if Cython (and maybe other packages) are not installed.

Not important for this ticket; we do have Cython. 

> - You want to auto-generate code before filtering it / excluding parts of it.

Why? Even after modularization, there will be exactly 1 module that will contain the autogenerated files.



---

archive/issue_comments_506084.json:
```json
{
    "body": "<a id='comment:43'>**Comment 43:**</a>\nReplying to [@mkoeppe](#comment%3A41):\n> Replying to [@tobiasdiez](#comment%3A40):\n> > Concerning this change:\n> > \n> > ```\n> >  # distutils: language = c++\n> > +# distutils: extra_compile_args = -std=c++11\n> > ```\n> > Woudn't it make sense to specify `-std=c++11` automatically once `language = c++` is set? In fact there is code that looks like it is doing this job in sage_build_cython.\n\n> \n> Of course, but you decided not to use the existing code. So I have made the changes that make it work.\n> \n\nI couldn't make it work with the sage_build_cython command, yes. So changing `create_extension` in `sage_setup/extensions.py` would be a better solution then?",
    "created_at": "2021-02-13T19:36:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506084",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:43'>**Comment 43:**</a>
Replying to [@mkoeppe](#comment%3A41):
> Replying to [@tobiasdiez](#comment%3A40):
> > Concerning this change:
> > 
> > ```
> >  # distutils: language = c++
> > +# distutils: extra_compile_args = -std=c++11
> > ```
> > Woudn't it make sense to specify `-std=c++11` automatically once `language = c++` is set? In fact there is code that looks like it is doing this job in sage_build_cython.

> 
> Of course, but you decided not to use the existing code. So I have made the changes that make it work.
> 

I couldn't make it work with the sage_build_cython command, yes. So changing `create_extension` in `sage_setup/extensions.py` would be a better solution then?



---

archive/issue_comments_506085.json:
```json
{
    "body": "<a id='comment:44'>**Comment 44:**</a>\nYour approach of starting the build system from scratch has certainly been valuable, so that we can see what parts of the code are needed.\n\nIn terms of complexity of code, I think adding the small of number of explicit directives to the files may actually be preferable to the more complex code regarding the `-std` flags in `sage_build_cython`.\nLet's try it out as is. \n\nIn some follow-up ticket, a more general solution may be needed at some point. Especially when use of c++14/17 becomes more widespread, then fixing things to `std=c++11` may no longer be the right thing.\nLet's do this when it becomes an issue; not now.",
    "created_at": "2021-02-13T19:53:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506085",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'>**Comment 44:**</a>
Your approach of starting the build system from scratch has certainly been valuable, so that we can see what parts of the code are needed.

In terms of complexity of code, I think adding the small of number of explicit directives to the files may actually be preferable to the more complex code regarding the `-std` flags in `sage_build_cython`.
Let's try it out as is. 

In some follow-up ticket, a more general solution may be needed at some point. Especially when use of c++14/17 becomes more widespread, then fixing things to `std=c++11` may no longer be the right thing.
Let's do this when it becomes an issue; not now.



---

archive/issue_comments_506086.json:
```json
{
    "body": "<a id='comment:47'>**Comment 47:**</a>\nDoes this now instead implement `./configure --enable-build-as-root`? It sounds like that's related to `sudo make`; is that what's intended?",
    "created_at": "2021-02-16T19:41:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506086",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:47'>**Comment 47:**</a>
Does this now instead implement `./configure --enable-build-as-root`? It sounds like that's related to `sudo make`; is that what's intended?



---

archive/issue_comments_506087.json:
```json
{
    "body": "<a id='comment:48'>**Comment 48:**</a>\nThanks for catching the typo in the help string.",
    "created_at": "2021-02-16T19:45:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506087",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'>**Comment 48:**</a>
Thanks for catching the typo in the help string.



---

archive/issue_comments_506088.json:
```json
{
    "body": "<a id='comment:49'>**Comment 49:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50f5010883bee3f2fc459848f2dac68d699bce87\">50f5010</a></td><td><code>build/pkgs/sagelib/spkg-configure.m4: Fix help string of --enable-editable</code></td></tr></table>\n",
    "created_at": "2021-02-16T19:47:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506088",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:49'>**Comment 49:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50f5010883bee3f2fc459848f2dac68d699bce87">50f5010</a></td><td><code>build/pkgs/sagelib/spkg-configure.m4: Fix help string of --enable-editable</code></td></tr></table>




---

archive/issue_comments_506089.json:
```json
{
    "body": "**Changing commit** from \"[e5d47ce731d44f099d635172b34654481eb7e13b](https://github.com/sagemath/sagetrac-mirror/commit/e5d47ce731d44f099d635172b34654481eb7e13b)\" to \"[50f5010883bee3f2fc459848f2dac68d699bce87](https://github.com/sagemath/sagetrac-mirror/commit/50f5010883bee3f2fc459848f2dac68d699bce87)\".",
    "created_at": "2021-02-16T19:47:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506089",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[e5d47ce731d44f099d635172b34654481eb7e13b](https://github.com/sagemath/sagetrac-mirror/commit/e5d47ce731d44f099d635172b34654481eb7e13b)" to "[50f5010883bee3f2fc459848f2dac68d699bce87](https://github.com/sagemath/sagetrac-mirror/commit/50f5010883bee3f2fc459848f2dac68d699bce87)".



---

archive/issue_comments_506090.json:
```json
{
    "body": "<a id='comment:50'>**Comment 50:**</a>\nI like it. Sometimes, I wanted to look into a C/C++ file that cython generated and I just couldn't locate it recently. No it's sitting all there for you.\n\nWhat vanished though is the progress report, how many files yet need to be compiled. I like this feature, because it tells you whether you should wait on it or whether you should carry on and do something else.",
    "created_at": "2021-02-16T20:07:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506090",
    "user": "https://github.com/kliem"
}
```

<a id='comment:50'>**Comment 50:**</a>
I like it. Sometimes, I wanted to look into a C/C++ file that cython generated and I just couldn't locate it recently. No it's sitting all there for you.

What vanished though is the progress report, how many files yet need to be compiled. I like this feature, because it tells you whether you should wait on it or whether you should carry on and do something else.



---

archive/issue_comments_506091.json:
```json
{
    "body": "<a id='comment:51'>**Comment 51:**</a>\nReplying to [@kliem](#comment%3A50):\n> What vanished though is the progress report, how many files yet need to be compiled. I like this feature, because it tells you whether you should wait on it or whether you should carry on and do something else.\n\nTobias wrote this as a minimal version using standard setuptools + cython. Let's keep adding additional features of this kind in mind for possible follow-up tickets.",
    "created_at": "2021-02-16T20:10:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506091",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:51'>**Comment 51:**</a>
Replying to [@kliem](#comment%3A50):
> What vanished though is the progress report, how many files yet need to be compiled. I like this feature, because it tells you whether you should wait on it or whether you should carry on and do something else.

Tobias wrote this as a minimal version using standard setuptools + cython. Let's keep adding additional features of this kind in mind for possible follow-up tickets.



---

archive/issue_comments_506092.json:
```json
{
    "body": "<a id='comment:52'>**Comment 52:**</a>\nOk. Just mentioned that this is missing and I like it back, if possible. I think I would even switch to this, without the counter. Just because it is nice to have the files where you think the should be.\n\nYou introduced a trailing whitespace in `src/sage_setup/find.py`.",
    "created_at": "2021-02-16T20:24:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506092",
    "user": "https://github.com/kliem"
}
```

<a id='comment:52'>**Comment 52:**</a>
Ok. Just mentioned that this is missing and I like it back, if possible. I think I would even switch to this, without the counter. Just because it is nice to have the files where you think the should be.

You introduced a trailing whitespace in `src/sage_setup/find.py`.



---

archive/issue_comments_506093.json:
```json
{
    "body": "<a id='comment:53'>**Comment 53:**</a>\nWhy is it `python3` and not `$PYTHON`?\n\n```diff\n+if [ \"$SAGE_EDITABLE\" = yes ]; then\n+    time python3 -m pip install --verbose --no-deps --no-index --no-build-isolation --isolated --editable . || exit 1\n+else\n+    time \"$PYTHON\" -u setup.py --no-user-cfg build install || exit 1\n+fi\n+\n```",
    "created_at": "2021-02-16T20:30:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506093",
    "user": "https://github.com/kliem"
}
```

<a id='comment:53'>**Comment 53:**</a>
Why is it `python3` and not `$PYTHON`?

```diff
+if [ "$SAGE_EDITABLE" = yes ]; then
+    time python3 -m pip install --verbose --no-deps --no-index --no-build-isolation --isolated --editable . || exit 1
+else
+    time "$PYTHON" -u setup.py --no-user-cfg build install || exit 1
+fi
+
```



---

archive/issue_comments_506094.json:
```json
{
    "body": "<a id='comment:54'>**Comment 54:**</a>\nYou freshly introduced `from distutils.command.build_ext import build_ext` in `/src/sage_setup/command/sage_build_ext_minimal.py`.\nI think this should be replaced by setuptools somehow or at least import setuptools before as to get rid of setuptools.",
    "created_at": "2021-02-16T20:40:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506094",
    "user": "https://github.com/kliem"
}
```

<a id='comment:54'>**Comment 54:**</a>
You freshly introduced `from distutils.command.build_ext import build_ext` in `/src/sage_setup/command/sage_build_ext_minimal.py`.
I think this should be replaced by setuptools somehow or at least import setuptools before as to get rid of setuptools.



---

archive/issue_comments_506095.json:
```json
{
    "body": "<a id='comment:55'>**Comment 55:**</a>\nWe should probably merge #30984 too.",
    "created_at": "2021-02-16T20:55:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506095",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:55'>**Comment 55:**</a>
We should probably merge #30984 too.



---

archive/issue_comments_506096.json:
```json
{
    "body": "<a id='comment:56'>**Comment 56:**</a>\nReplying to [@kliem](#comment%3A53):\n> Why is it `python3` and not `$PYTHON`?\n> \n> ```diff\n> +if [ \"$SAGE_EDITABLE\" = yes ]; then\n> +    time python3 -m pip install --verbose --no-deps --no-index --no-build-isolation --isolated --editable . || exit 1\n> +else\n> +    time \"$PYTHON\" -u setup.py --no-user-cfg build install || exit 1\n> +fi\n> +\n> ```\n\nThanks for spotting this inconsistency. Actually, both should be `python3` (since #30731, which replaced `sage-python23`).",
    "created_at": "2021-02-16T20:58:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506096",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:56'>**Comment 56:**</a>
Replying to [@kliem](#comment%3A53):
> Why is it `python3` and not `$PYTHON`?
> 
> ```diff
> +if [ "$SAGE_EDITABLE" = yes ]; then
> +    time python3 -m pip install --verbose --no-deps --no-index --no-build-isolation --isolated --editable . || exit 1
> +else
> +    time "$PYTHON" -u setup.py --no-user-cfg build install || exit 1
> +fi
> +
> ```

Thanks for spotting this inconsistency. Actually, both should be `python3` (since #30731, which replaced `sage-python23`).



---

archive/issue_comments_506097.json:
```json
{
    "body": "<a id='comment:57'>**Comment 57:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c5e9c3b56070a9a1ef1040555da83365908f286\">8c5e9c3</a></td><td><code>build/pkgs/sagelib/spkg-install: python3, not $PYTHON</code></td></tr></table>\n",
    "created_at": "2021-02-16T20:58:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506097",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:57'>**Comment 57:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c5e9c3b56070a9a1ef1040555da83365908f286">8c5e9c3</a></td><td><code>build/pkgs/sagelib/spkg-install: python3, not $PYTHON</code></td></tr></table>




---

archive/issue_comments_506098.json:
```json
{
    "body": "**Changing commit** from \"[50f5010883bee3f2fc459848f2dac68d699bce87](https://github.com/sagemath/sagetrac-mirror/commit/50f5010883bee3f2fc459848f2dac68d699bce87)\" to \"[8c5e9c3b56070a9a1ef1040555da83365908f286](https://github.com/sagemath/sagetrac-mirror/commit/8c5e9c3b56070a9a1ef1040555da83365908f286)\".",
    "created_at": "2021-02-16T20:58:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506098",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[50f5010883bee3f2fc459848f2dac68d699bce87](https://github.com/sagemath/sagetrac-mirror/commit/50f5010883bee3f2fc459848f2dac68d699bce87)" to "[8c5e9c3b56070a9a1ef1040555da83365908f286](https://github.com/sagemath/sagetrac-mirror/commit/8c5e9c3b56070a9a1ef1040555da83365908f286)".



---

archive/issue_comments_506099.json:
```json
{
    "body": "**Changing commit** from \"[8c5e9c3b56070a9a1ef1040555da83365908f286](https://github.com/sagemath/sagetrac-mirror/commit/8c5e9c3b56070a9a1ef1040555da83365908f286)\" to \"[0df54f76dee2089b5c14e3db8f5ef8c5a2d04796](https://github.com/sagemath/sagetrac-mirror/commit/0df54f76dee2089b5c14e3db8f5ef8c5a2d04796)\".",
    "created_at": "2021-02-16T21:01:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506099",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[8c5e9c3b56070a9a1ef1040555da83365908f286](https://github.com/sagemath/sagetrac-mirror/commit/8c5e9c3b56070a9a1ef1040555da83365908f286)" to "[0df54f76dee2089b5c14e3db8f5ef8c5a2d04796](https://github.com/sagemath/sagetrac-mirror/commit/0df54f76dee2089b5c14e3db8f5ef8c5a2d04796)".



---

archive/issue_comments_506100.json:
```json
{
    "body": "<a id='comment:58'>**Comment 58:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0df54f76dee2089b5c14e3db8f5ef8c5a2d04796\">0df54f7</a></td><td><code>src/sage_setup/find.py: Fix whitespace</code></td></tr></table>\n",
    "created_at": "2021-02-16T21:01:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506100",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:58'>**Comment 58:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0df54f76dee2089b5c14e3db8f5ef8c5a2d04796">0df54f7</a></td><td><code>src/sage_setup/find.py: Fix whitespace</code></td></tr></table>




---

archive/issue_comments_506101.json:
```json
{
    "body": "<a id='comment:59'>**Comment 59:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/acd7e312d4d802ee9e80c7faa0548434bf51c146\">acd7e31</a></td><td><code>sage_setup/command/sage_build_ext_minimal.py: Use setuptools instead of distutils, as in #30984</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a63e6157874d8be7e29b078d646936142f4bdcea\">a63e615</a></td><td><code>src/setup.py: Import setuptools before distutils, as in #30984</code></td></tr></table>\n",
    "created_at": "2021-02-16T21:09:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506101",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:59'>**Comment 59:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/acd7e312d4d802ee9e80c7faa0548434bf51c146">acd7e31</a></td><td><code>sage_setup/command/sage_build_ext_minimal.py: Use setuptools instead of distutils, as in #30984</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a63e6157874d8be7e29b078d646936142f4bdcea">a63e615</a></td><td><code>src/setup.py: Import setuptools before distutils, as in #30984</code></td></tr></table>




---

archive/issue_comments_506102.json:
```json
{
    "body": "**Changing commit** from \"[0df54f76dee2089b5c14e3db8f5ef8c5a2d04796](https://github.com/sagemath/sagetrac-mirror/commit/0df54f76dee2089b5c14e3db8f5ef8c5a2d04796)\" to \"[a63e6157874d8be7e29b078d646936142f4bdcea](https://github.com/sagemath/sagetrac-mirror/commit/a63e6157874d8be7e29b078d646936142f4bdcea)\".",
    "created_at": "2021-02-16T21:09:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506102",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[0df54f76dee2089b5c14e3db8f5ef8c5a2d04796](https://github.com/sagemath/sagetrac-mirror/commit/0df54f76dee2089b5c14e3db8f5ef8c5a2d04796)" to "[a63e6157874d8be7e29b078d646936142f4bdcea](https://github.com/sagemath/sagetrac-mirror/commit/a63e6157874d8be7e29b078d646936142f4bdcea)".



---

archive/issue_comments_506103.json:
```json
{
    "body": "<a id='comment:60'>**Comment 60:**</a>\nReplying to [@kliem](#comment%3A50):\n> What vanished though is the progress report, how many files yet need to be compiled. I like this feature, because it tells you whether you should wait on it or whether you should carry on and do something else.\n\nI think a progress bar will not be easy. The new version directly uses the cythonize method, which doesn't seem to have any configuration in this direction, see https://cython.readthedocs.io/en/latest/src/userguide/source_files_and_compilation.html?highlight=cythonize#cythonize-arguments.",
    "created_at": "2021-02-16T21:14:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506103",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:60'>**Comment 60:**</a>
Replying to [@kliem](#comment%3A50):
> What vanished though is the progress report, how many files yet need to be compiled. I like this feature, because it tells you whether you should wait on it or whether you should carry on and do something else.

I think a progress bar will not be easy. The new version directly uses the cythonize method, which doesn't seem to have any configuration in this direction, see https://cython.readthedocs.io/en/latest/src/userguide/source_files_and_compilation.html?highlight=cythonize#cythonize-arguments.



---

archive/issue_comments_506104.json:
```json
{
    "body": "<a id='comment:61'>**Comment 61:**</a>\nI have created #31406 as a place for follow-up items.",
    "created_at": "2021-02-16T21:16:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506104",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:61'>**Comment 61:**</a>
I have created #31406 as a place for follow-up items.



---

archive/issue_comments_506105.json:
```json
{
    "body": "<a id='comment:62'>**Comment 62:**</a>\nReplying to [@mkoeppe](#comment%3A44):\n\n> In terms of complexity of code, I think adding the small of number of explicit directives to the files may actually be preferable to the more complex code regarding the `-std` flags in `sage_build_cython`.\n> Let's try it out as is. \n\nOk, sounds good to me. But notice that explicitly specifying the `std` changes the behavior on cygwin (for a \"normal\" build) since the following code in sage_build_cython is no longer invoked:\n\n```\n            if sys.platform == 'cygwin':\n                # Cygwin (particularly newlib, Cygwin's libc) has some bugs\n                # with strict ANSI C/C++ in some headers; using the GNU\n                # extensions typically fares better:\n                # https://trac.sagemath.org/ticket/24192\n                if cplusplus:\n                    cflags.append(\"-std=gnu++11\")\n                else:\n                    cflags.append(\"-std=gnu99\")\n\n```\nI don't know if this may have negative side effects.",
    "created_at": "2021-02-16T21:19:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506105",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:62'>**Comment 62:**</a>
Replying to [@mkoeppe](#comment%3A44):

> In terms of complexity of code, I think adding the small of number of explicit directives to the files may actually be preferable to the more complex code regarding the `-std` flags in `sage_build_cython`.
> Let's try it out as is. 

Ok, sounds good to me. But notice that explicitly specifying the `std` changes the behavior on cygwin (for a "normal" build) since the following code in sage_build_cython is no longer invoked:

```
            if sys.platform == 'cygwin':
                # Cygwin (particularly newlib, Cygwin's libc) has some bugs
                # with strict ANSI C/C++ in some headers; using the GNU
                # extensions typically fares better:
                # https://trac.sagemath.org/ticket/24192
                if cplusplus:
                    cflags.append("-std=gnu++11")
                else:
                    cflags.append("-std=gnu99")

```
I don't know if this may have negative side effects.



---

archive/issue_comments_506106.json:
```json
{
    "body": "<a id='comment:63'>**Comment 63:**</a>\nThanks for pointing this out; we'll see when we add automated tests for `--enable-editable` to the Cygwin GH Actions. (in a ticket after #31064 is merged)",
    "created_at": "2021-02-16T21:40:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506106",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:63'>**Comment 63:**</a>
Thanks for pointing this out; we'll see when we add automated tests for `--enable-editable` to the Cygwin GH Actions. (in a ticket after #31064 is merged)



---

archive/issue_comments_506107.json:
```json
{
    "body": "<a id='comment:64'>**Comment 64:**</a>\nA few more observations:\n- There is currently no documentation for how to use the inplace install (and why).\n- Running the configure command yields the following warning at the end:\n\n```\n....\nconfig.status: creating directory local/var/lib/sage/installed\nconfigure: WARNING: unrecognized options: --enable-editable\nconfigure:\n\n    notice: the following SPKGs did not find equivalent system packages\n...\n```\n- My only means to test this on mac is with the github action added in #30371. Admittedly, this is using a lightly different setup, but since the sage inplace install fails, I wanted to point this out. First of all, the files in `sage/libs/singular` don't specify that they should be compiled with `language=c++` and `std=c++11`. Secondly, there are many errors of the form\n\n```\n /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/usr/include/nl_types.h:97:1: error: unknown type name 'nl_catd'\n    nl_catd  catopen(const char *, int);\n    ^\n```\nSee e.g. https://github.com/tobiasdiez/sage/runs/1893534204?check_suite_focus=true\n\n- On Linux (with wsl), the make build fails with\n\n```\n[pplpy-0.8.6] Copying package files from temporary location /mnt/d/Programming/sage/local/var/tmp/sage/build/pplpy-0.8.6/inst to /mnt/d/Programming/sage/local\n[pplpy-0.8.6] Running post-install script for pplpy-0.8.6.\n[pplpy-0.8.6] Traceback (most recent call last):\n[pplpy-0.8.6]   File \"/mnt/d/Programming/sage/local/bin/sphinx-build\", line 5, in <module>\n[pplpy-0.8.6]     from sphinx.cmd.build import main\n[pplpy-0.8.6]   File \"/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/cmd/build.py\", line 25, in <module>\n[pplpy-0.8.6]     from sphinx.application import Sphinx\n[pplpy-0.8.6]   File \"/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/application.py\", line 31, in <module>\n[pplpy-0.8.6]     from sphinx.config import Config\n[pplpy-0.8.6]   File \"/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/config.py\", line 28, in <module>\n[pplpy-0.8.6]     from sphinx.util.tags import Tags\n[pplpy-0.8.6]   File \"/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/util/tags.py\", line 11, in <module>\n[pplpy-0.8.6]     from jinja2 import nodes\n[pplpy-0.8.6]   File \"/mnt/d/Programming/sage/local/lib/python3.8/site-packages/jinja2/__init__.py\", line 6, in <module>\n[pplpy-0.8.6]     from markupsafe import escape\n[pplpy-0.8.6] ValueError: source code string cannot contain null bytes\n[pplpy-0.8.6] make[5]: *** [Makefile:21: html] Error 1\n[pplpy-0.8.6] cp: cannot stat 'build/html/*': No such file or directory\n```\nThat's probably not related to this ticket, but prevents me from testing it.",
    "created_at": "2021-02-16T22:09:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506107",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:64'>**Comment 64:**</a>
A few more observations:
- There is currently no documentation for how to use the inplace install (and why).
- Running the configure command yields the following warning at the end:

```
....
config.status: creating directory local/var/lib/sage/installed
configure: WARNING: unrecognized options: --enable-editable
configure:

    notice: the following SPKGs did not find equivalent system packages
...
```
- My only means to test this on mac is with the github action added in #30371. Admittedly, this is using a lightly different setup, but since the sage inplace install fails, I wanted to point this out. First of all, the files in `sage/libs/singular` don't specify that they should be compiled with `language=c++` and `std=c++11`. Secondly, there are many errors of the form

```
 /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/usr/include/nl_types.h:97:1: error: unknown type name 'nl_catd'
    nl_catd  catopen(const char *, int);
    ^
```
See e.g. https://github.com/tobiasdiez/sage/runs/1893534204?check_suite_focus=true

- On Linux (with wsl), the make build fails with

```
[pplpy-0.8.6] Copying package files from temporary location /mnt/d/Programming/sage/local/var/tmp/sage/build/pplpy-0.8.6/inst to /mnt/d/Programming/sage/local
[pplpy-0.8.6] Running post-install script for pplpy-0.8.6.
[pplpy-0.8.6] Traceback (most recent call last):
[pplpy-0.8.6]   File "/mnt/d/Programming/sage/local/bin/sphinx-build", line 5, in <module>
[pplpy-0.8.6]     from sphinx.cmd.build import main
[pplpy-0.8.6]   File "/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/cmd/build.py", line 25, in <module>
[pplpy-0.8.6]     from sphinx.application import Sphinx
[pplpy-0.8.6]   File "/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/application.py", line 31, in <module>
[pplpy-0.8.6]     from sphinx.config import Config
[pplpy-0.8.6]   File "/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/config.py", line 28, in <module>
[pplpy-0.8.6]     from sphinx.util.tags import Tags
[pplpy-0.8.6]   File "/mnt/d/Programming/sage/local/lib/python3.8/site-packages/sphinx/util/tags.py", line 11, in <module>
[pplpy-0.8.6]     from jinja2 import nodes
[pplpy-0.8.6]   File "/mnt/d/Programming/sage/local/lib/python3.8/site-packages/jinja2/__init__.py", line 6, in <module>
[pplpy-0.8.6]     from markupsafe import escape
[pplpy-0.8.6] ValueError: source code string cannot contain null bytes
[pplpy-0.8.6] make[5]: *** [Makefile:21: html] Error 1
[pplpy-0.8.6] cp: cannot stat 'build/html/*': No such file or directory
```
That's probably not related to this ticket, but prevents me from testing it.



---

archive/issue_comments_506108.json:
```json
{
    "body": "<a id='comment:65'>**Comment 65:**</a>\nReplying to [@mkoeppe](#comment%3A63):\n> Thanks for pointing this out; we'll see when we add automated tests for `--enable-editable` to the Cygwin GH Actions. (in a ticket after #31064 is merged)\n\nThe point is that explicitly specifying `std` in the cython file also overrides it for the sage-distribution compilation, i.e. the one using the setup.py in build.",
    "created_at": "2021-02-16T22:12:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506108",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:65'>**Comment 65:**</a>
Replying to [@mkoeppe](#comment%3A63):
> Thanks for pointing this out; we'll see when we add automated tests for `--enable-editable` to the Cygwin GH Actions. (in a ticket after #31064 is merged)

The point is that explicitly specifying `std` in the cython file also overrides it for the sage-distribution compilation, i.e. the one using the setup.py in build.



---

archive/issue_comments_506109.json:
```json
{
    "body": "<a id='comment:66'>**Comment 66:**</a>\nReplying to [@tobiasdiez](#comment%3A64):\n> - Running the configure command yields the following warning at the end:\n> \n> ```\n> ....\n> config.status: creating directory local/var/lib/sage/installed\n> configure: WARNING: unrecognized options: --enable-editable\n> ```\n\n>\n\nForgot to run `./bootstrap`?",
    "created_at": "2021-02-16T22:26:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506109",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:66'>**Comment 66:**</a>
Replying to [@tobiasdiez](#comment%3A64):
> - Running the configure command yields the following warning at the end:
> 
> ```
> ....
> config.status: creating directory local/var/lib/sage/installed
> configure: WARNING: unrecognized options: --enable-editable
> ```

>

Forgot to run `./bootstrap`?



---

archive/issue_comments_506110.json:
```json
{
    "body": "<a id='comment:67'>**Comment 67:**</a>\nReplying to [@tobiasdiez](#comment%3A64):\n> - My only means to test this on mac is with the github action added in #30371.\n\nLet's please not pull a discussion of these experimental GH actions from #30371 into this ticket.\n\nIf we add automatic testing, we will do it on the basis of the existing GH actions.",
    "created_at": "2021-02-16T22:30:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506110",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:67'>**Comment 67:**</a>
Replying to [@tobiasdiez](#comment%3A64):
> - My only means to test this on mac is with the github action added in #30371.

Let's please not pull a discussion of these experimental GH actions from #30371 into this ticket.

If we add automatic testing, we will do it on the basis of the existing GH actions.



---

archive/issue_comments_506111.json:
```json
{
    "body": "<a id='comment:68'>**Comment 68:**</a>\nReplying to [@tobiasdiez](#comment%3A65):\n> Replying to [@mkoeppe](#comment%3A63):\n> > Thanks for pointing this out; we'll see when we add automated tests for `--enable-editable` to the Cygwin GH Actions. (in a ticket after #31064 is merged)\n\n> \n> The point is that explicitly specifying `std` in the cython file also overrides it for the sage-distribution compilation, i.e. the one using the setup.py in build. \n\nYes, it is a change and we are using portability testing to make sure that it does not break anything on the supported platforms.",
    "created_at": "2021-02-16T22:32:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506111",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:68'>**Comment 68:**</a>
Replying to [@tobiasdiez](#comment%3A65):
> Replying to [@mkoeppe](#comment%3A63):
> > Thanks for pointing this out; we'll see when we add automated tests for `--enable-editable` to the Cygwin GH Actions. (in a ticket after #31064 is merged)

> 
> The point is that explicitly specifying `std` in the cython file also overrides it for the sage-distribution compilation, i.e. the one using the setup.py in build. 

Yes, it is a change and we are using portability testing to make sure that it does not break anything on the supported platforms.



---

archive/issue_comments_506112.json:
```json
{
    "body": "<a id='comment:69'>**Comment 69:**</a>\nReplying to [@tobiasdiez](#comment%3A64):\n> A few more observations:\n> - There is currently no documentation for how to use the inplace install (and why).\n\nWell, I hope we can merge this ticket into the next beta and then ask developers to try it. We can document it in a follow-up ticket.",
    "created_at": "2021-02-16T22:34:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506112",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:69'>**Comment 69:**</a>
Replying to [@tobiasdiez](#comment%3A64):
> A few more observations:
> - There is currently no documentation for how to use the inplace install (and why).

Well, I hope we can merge this ticket into the next beta and then ask developers to try it. We can document it in a follow-up ticket.



---

archive/issue_comments_506113.json:
```json
{
    "body": "<a id='comment:70'>**Comment 70:**</a>\nReplying to [@tobiasdiez](#comment%3A64):\n> - On Linux (with wsl), the make build fails with\n> \n> ```\n> [pplpy-0.8.6] Copying package files from temporary location /mnt/d/Programming/sage/local/var/tmp/sage/build/pplpy-0.8.6/inst to /mnt/d/Programming/sage/local\n> [pplpy-0.8.6] Running post-install script for pplpy-0.8.6.\n> [pplpy-0.8.6]     from markupsafe import escape\n> [pplpy-0.8.6] ValueError: source code string cannot contain null bytes\n> [pplpy-0.8.6] make[5]: *** [Makefile:21: html] Error 1\n> [pplpy-0.8.6] cp: cannot stat 'build/html/*': No such file or directory\n> ```\n> That's probably not related to this ticket, but prevents me from testing it.\n\nI have not seen this before and I don't think it has anything to with the present ticket.\nPlease check if this also occurs with 9.3.beta7 and open a separate ticket if this problem is reproducible.",
    "created_at": "2021-02-16T22:37:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506113",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:70'>**Comment 70:**</a>
Replying to [@tobiasdiez](#comment%3A64):
> - On Linux (with wsl), the make build fails with
> 
> ```
> [pplpy-0.8.6] Copying package files from temporary location /mnt/d/Programming/sage/local/var/tmp/sage/build/pplpy-0.8.6/inst to /mnt/d/Programming/sage/local
> [pplpy-0.8.6] Running post-install script for pplpy-0.8.6.
> [pplpy-0.8.6]     from markupsafe import escape
> [pplpy-0.8.6] ValueError: source code string cannot contain null bytes
> [pplpy-0.8.6] make[5]: *** [Makefile:21: html] Error 1
> [pplpy-0.8.6] cp: cannot stat 'build/html/*': No such file or directory
> ```
> That's probably not related to this ticket, but prevents me from testing it.

I have not seen this before and I don't think it has anything to with the present ticket.
Please check if this also occurs with 9.3.beta7 and open a separate ticket if this problem is reproducible.



---

archive/issue_comments_506114.json:
```json
{
    "body": "<a id='comment:71'>**Comment 71:**</a>\nReplying to [@mkoeppe](#comment%3A66):\n> Forgot to run `./bootstrap`?\n\nThat fixed it indeed. \n\nThe pplpy error occurs also with the recent develop branch, so this is indeed unrelated to these changes. I've opened #31407 for this.",
    "created_at": "2021-02-16T22:45:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506114",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:71'>**Comment 71:**</a>
Replying to [@mkoeppe](#comment%3A66):
> Forgot to run `./bootstrap`?

That fixed it indeed. 

The pplpy error occurs also with the recent develop branch, so this is indeed unrelated to these changes. I've opened #31407 for this.



---

archive/issue_comments_506115.json:
```json
{
    "body": "<a id='comment:72'>**Comment 72:**</a>\nI'm getting a few doctest failures:\n\n```\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py\n**********************************************************************\nFile \"src/sage/repl/interpreter.py\", line 77, in sage.repl.interpreter\nFailed example:\n    print(\"dummy line\"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test\nExpected:\n    dummy line\n    ...\n    ZeroDivisionError...Traceback (most recent call last)\n    <ipython-input-...> in <module>...\n    ----> 1 Integer(1)/Integer(0)\n    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()\n    ...\n    -> ...                  raise ZeroDivisionError(\"rational division by zero\")\n       ...            x = <Rational> Rational.__new__(Rational)\n       ...            mpq_div_zz(x.value, ....value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\nGot:\n    dummy line\n    ---------------------------------------------------------------------------\n    ZeroDivisionError                         Traceback (most recent call last)\n    <ipython-input-1-72ac74c5f414> in <module>\n    ----> 1 Integer(1)/Integer(0)\n    <BLANKLINE>\n    /srv/public/kliem/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__truediv__()\n       2038         if type(left) is type(right):\n       2039             if mpz_sgn((<Integer>right).value) == 0:\n    -> 2040                 raise ZeroDivisionError(\"rational division by zero\")\n       2041             x = <Rational> Rational.__new__(Rational)\n       2042             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\n**********************************************************************\n1 item had failures:\n   1 of  20 in sage.repl.interpreter\n    [141 tests, 1 failure, 1.97 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 7.4 seconds\n    cpu time: 0.6 seconds\n    cumulative wall time: 2.0 seconds\nkliem@lech:~/localhome/sage$ sage -t --long --random-seed=0 src/sage/stats/hmm/hmm.pyx  # 1 doctest failed\nRunning doctests with ID 2021-02-17-08-07-40-53dddc3c.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx\n**********************************************************************\nFile \"src/sage/stats/hmm/hmm.pyx\", line 1234, in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch\nFailed example:\n    m.baum_welch(v,fix_emissions=True)\nExpected:\n    (-66.98630856918774, 100)\nGot:\n    (-66.98630856918776, 100)\n**********************************************************************\n1 item had failures:\n   1 of  14 in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch\n    [121 tests, 1 failure, 0.32 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.4 seconds\n    cpu time: 0.3 seconds\n    cumulative wall time: 0.3 seconds\nkliem@lech:~/localhome/sage$ sage -t --long --random-seed=0 src/sage_setup/find.py  # 6 doctests failed\nRunning doctests with ID 2021-02-17-08-07-42-447cd574.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 199, in sage_setup.find.filter_cython_sources\nFailed example:\n    'sage/graphs/graph_decompositions/tdlib.pyx' in cython_modules\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 264, in sage_setup.find.find_extra_files\nFailed example:\n    extras[\"sage/ext/interpreters\"]\nExpected:\n    ['.../src/sage/ext/interpreters/wrapper_cdf.pxd', ...wrapper_cdf.h...]\nGot:\n    ['/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pxd']\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 324, in sage_setup.find.installed_files_by_module\nFailed example:\n    (f,) = files_by_module['sage.structure.sage_object']; f\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_setup.find.installed_files_by_module[5]>\", line 1, in <module>\n        (f,) = files_by_module['sage.structure.sage_object']; f\n    ValueError: not enough values to unpack (expected 1, got 0)\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 326, in sage_setup.find.installed_files_by_module\nFailed example:\n    (f1, f2) = sorted(files_by_module['sage.structure'])\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_setup.find.installed_files_by_module[6]>\", line 1, in <module>\n        (f1, f2) = sorted(files_by_module['sage.structure'])\n    ValueError: not enough values to unpack (expected 2, got 0)\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 327, in sage_setup.find.installed_files_by_module\nFailed example:\n    f1\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_setup.find.installed_files_by_module[7]>\", line 1, in <module>\n        f1\n    NameError: name 'f1' is not defined\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 329, in sage_setup.find.installed_files_by_module\nFailed example:\n    f2\nException raised:\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/src/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_setup.find.installed_files_by_module[8]>\", line 1, in <module>\n        f2\n    NameError: name 'f2' is not defined\n**********************************************************************\n3 items had failures:\n   1 of   7 in sage_setup.find.filter_cython_sources\n   1 of   7 in sage_setup.find.find_extra_files\n   4 of  11 in sage_setup.find.installed_files_by_module\n    [42 tests, 6 failures, 0.40 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py  # 6 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.4 seconds\n    cpu time: 0.4 seconds\n    cumulative wall time: 0.4 seconds\n```\n\n```\nkliem@lech:~/localhome/sage$ sage -t --long --random-seed=0 src/sage/tests/cmdline.py  # 3 doctests failed\nRunning doctests with ID 2021-02-17-08-07-44-7353eba5.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/tests/cmdline.py\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 586, in sage.tests.cmdline.test_executable\nFailed example:\n    out.startswith(\"3.\")\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 588, in sage.tests.cmdline.test_executable\nFailed example:\n    err\nExpected:\n    ''\nGot:\n    '/srv/public/kliem/sage/src/bin/sage: line 588: exec: sqlite3: not found\\n'\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 590, in sage.tests.cmdline.test_executable\nFailed example:\n    ret\nExpected:\n    0\nGot:\n    127\n**********************************************************************\n1 item had failures:\n   3 of 231 in sage.tests.cmdline.test_executable\n    [230 tests, 3 failures, 21.87 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/tests/cmdline.py  # 3 doctests failed\n----------------------------------------------------------------------\n```\n\nThe test in `src/sage/tests/cmdline.py` is just there for completeness and can be ignored.",
    "created_at": "2021-02-17T07:15:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506115",
    "user": "https://github.com/kliem"
}
```

<a id='comment:72'>**Comment 72:**</a>
I'm getting a few doctest failures:

```
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py
**********************************************************************
File "src/sage/repl/interpreter.py", line 77, in sage.repl.interpreter
Failed example:
    print("dummy line"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test
Expected:
    dummy line
    ...
    ZeroDivisionError...Traceback (most recent call last)
    <ipython-input-...> in <module>...
    ----> 1 Integer(1)/Integer(0)
    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()
    ...
    -> ...                  raise ZeroDivisionError("rational division by zero")
       ...            x = <Rational> Rational.__new__(Rational)
       ...            mpq_div_zz(x.value, ....value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
Got:
    dummy line
    ---------------------------------------------------------------------------
    ZeroDivisionError                         Traceback (most recent call last)
    <ipython-input-1-72ac74c5f414> in <module>
    ----> 1 Integer(1)/Integer(0)
    <BLANKLINE>
    /srv/public/kliem/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__truediv__()
       2038         if type(left) is type(right):
       2039             if mpz_sgn((<Integer>right).value) == 0:
    -> 2040                 raise ZeroDivisionError("rational division by zero")
       2041             x = <Rational> Rational.__new__(Rational)
       2042             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
**********************************************************************
1 item had failures:
   1 of  20 in sage.repl.interpreter
    [141 tests, 1 failure, 1.97 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 7.4 seconds
    cpu time: 0.6 seconds
    cumulative wall time: 2.0 seconds
kliem@lech:~/localhome/sage$ sage -t --long --random-seed=0 src/sage/stats/hmm/hmm.pyx  # 1 doctest failed
Running doctests with ID 2021-02-17-08-07-40-53dddc3c.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx
**********************************************************************
File "src/sage/stats/hmm/hmm.pyx", line 1234, in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch
Failed example:
    m.baum_welch(v,fix_emissions=True)
Expected:
    (-66.98630856918774, 100)
Got:
    (-66.98630856918776, 100)
**********************************************************************
1 item had failures:
   1 of  14 in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch
    [121 tests, 1 failure, 0.32 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 0.4 seconds
    cpu time: 0.3 seconds
    cumulative wall time: 0.3 seconds
kliem@lech:~/localhome/sage$ sage -t --long --random-seed=0 src/sage_setup/find.py  # 6 doctests failed
Running doctests with ID 2021-02-17-08-07-42-447cd574.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py
**********************************************************************
File "src/sage_setup/find.py", line 199, in sage_setup.find.filter_cython_sources
Failed example:
    'sage/graphs/graph_decompositions/tdlib.pyx' in cython_modules
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage_setup/find.py", line 264, in sage_setup.find.find_extra_files
Failed example:
    extras["sage/ext/interpreters"]
Expected:
    ['.../src/sage/ext/interpreters/wrapper_cdf.pxd', ...wrapper_cdf.h...]
Got:
    ['/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pxd']
**********************************************************************
File "src/sage_setup/find.py", line 324, in sage_setup.find.installed_files_by_module
Failed example:
    (f,) = files_by_module['sage.structure.sage_object']; f
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_setup.find.installed_files_by_module[5]>", line 1, in <module>
        (f,) = files_by_module['sage.structure.sage_object']; f
    ValueError: not enough values to unpack (expected 1, got 0)
**********************************************************************
File "src/sage_setup/find.py", line 326, in sage_setup.find.installed_files_by_module
Failed example:
    (f1, f2) = sorted(files_by_module['sage.structure'])
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_setup.find.installed_files_by_module[6]>", line 1, in <module>
        (f1, f2) = sorted(files_by_module['sage.structure'])
    ValueError: not enough values to unpack (expected 2, got 0)
**********************************************************************
File "src/sage_setup/find.py", line 327, in sage_setup.find.installed_files_by_module
Failed example:
    f1
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_setup.find.installed_files_by_module[7]>", line 1, in <module>
        f1
    NameError: name 'f1' is not defined
**********************************************************************
File "src/sage_setup/find.py", line 329, in sage_setup.find.installed_files_by_module
Failed example:
    f2
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/src/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_setup.find.installed_files_by_module[8]>", line 1, in <module>
        f2
    NameError: name 'f2' is not defined
**********************************************************************
3 items had failures:
   1 of   7 in sage_setup.find.filter_cython_sources
   1 of   7 in sage_setup.find.find_extra_files
   4 of  11 in sage_setup.find.installed_files_by_module
    [42 tests, 6 failures, 0.40 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py  # 6 doctests failed
----------------------------------------------------------------------
Total time for all tests: 0.4 seconds
    cpu time: 0.4 seconds
    cumulative wall time: 0.4 seconds
```

```
kliem@lech:~/localhome/sage$ sage -t --long --random-seed=0 src/sage/tests/cmdline.py  # 3 doctests failed
Running doctests with ID 2021-02-17-08-07-44-7353eba5.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/tests/cmdline.py
**********************************************************************
File "src/sage/tests/cmdline.py", line 586, in sage.tests.cmdline.test_executable
Failed example:
    out.startswith("3.")
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/tests/cmdline.py", line 588, in sage.tests.cmdline.test_executable
Failed example:
    err
Expected:
    ''
Got:
    '/srv/public/kliem/sage/src/bin/sage: line 588: exec: sqlite3: not found\n'
**********************************************************************
File "src/sage/tests/cmdline.py", line 590, in sage.tests.cmdline.test_executable
Failed example:
    ret
Expected:
    0
Got:
    127
**********************************************************************
1 item had failures:
   3 of 231 in sage.tests.cmdline.test_executable
    [230 tests, 3 failures, 21.87 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/tests/cmdline.py  # 3 doctests failed
----------------------------------------------------------------------
```

The test in `src/sage/tests/cmdline.py` is just there for completeness and can be ignored.



---

archive/issue_comments_506116.json:
```json
{
    "body": "<a id='comment:73'>**Comment 73:**</a>\nI got failures in `repl/interpreter.py` and `sage_setup/find.py`.",
    "created_at": "2021-02-18T01:19:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506116",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:73'>**Comment 73:**</a>
I got failures in `repl/interpreter.py` and `sage_setup/find.py`.



---

archive/issue_comments_506117.json:
```json
{
    "body": "**Changing commit** from \"[a63e6157874d8be7e29b078d646936142f4bdcea](https://github.com/sagemath/sagetrac-mirror/commit/a63e6157874d8be7e29b078d646936142f4bdcea)\" to \"[78a1587c275e5528a9e020f926302851647da6d4](https://github.com/sagemath/sagetrac-mirror/commit/78a1587c275e5528a9e020f926302851647da6d4)\".",
    "created_at": "2021-02-18T01:37:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506117",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[a63e6157874d8be7e29b078d646936142f4bdcea](https://github.com/sagemath/sagetrac-mirror/commit/a63e6157874d8be7e29b078d646936142f4bdcea)" to "[78a1587c275e5528a9e020f926302851647da6d4](https://github.com/sagemath/sagetrac-mirror/commit/78a1587c275e5528a9e020f926302851647da6d4)".



---

archive/issue_comments_506118.json:
```json
{
    "body": "<a id='comment:74'>**Comment 74:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78a1587c275e5528a9e020f926302851647da6d4\">78a1587</a></td><td><code>src/setup.py: Add . to sys.path so that pyproject.toml from #30913 does not break the build</code></td></tr></table>\n",
    "created_at": "2021-02-18T01:37:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506118",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:74'>**Comment 74:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78a1587c275e5528a9e020f926302851647da6d4">78a1587</a></td><td><code>src/setup.py: Add . to sys.path so that pyproject.toml from #30913 does not break the build</code></td></tr></table>




---

archive/issue_comments_506119.json:
```json
{
    "body": "**Changing commit** from \"[78a1587c275e5528a9e020f926302851647da6d4](https://github.com/sagemath/sagetrac-mirror/commit/78a1587c275e5528a9e020f926302851647da6d4)\" to \"[ccce09e2c8cc7fa802ed18450778096f76364da7](https://github.com/sagemath/sagetrac-mirror/commit/ccce09e2c8cc7fa802ed18450778096f76364da7)\".",
    "created_at": "2021-02-18T02:32:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506119",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[78a1587c275e5528a9e020f926302851647da6d4](https://github.com/sagemath/sagetrac-mirror/commit/78a1587c275e5528a9e020f926302851647da6d4)" to "[ccce09e2c8cc7fa802ed18450778096f76364da7](https://github.com/sagemath/sagetrac-mirror/commit/ccce09e2c8cc7fa802ed18450778096f76364da7)".



---

archive/issue_comments_506120.json:
```json
{
    "body": "<a id='comment:75'>**Comment 75:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ccce09e2c8cc7fa802ed18450778096f76364da7\">ccce09e</a></td><td><code>build/pkgs/sagelib/spkg-install [SAGE_EDITABLE=yes]: Uninstall distutils-installed sagelib</code></td></tr></table>\n",
    "created_at": "2021-02-18T02:32:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506120",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:75'>**Comment 75:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ccce09e2c8cc7fa802ed18450778096f76364da7">ccce09e</a></td><td><code>build/pkgs/sagelib/spkg-install [SAGE_EDITABLE=yes]: Uninstall distutils-installed sagelib</code></td></tr></table>




---

archive/issue_comments_506121.json:
```json
{
    "body": "<a id='comment:76'>**Comment 76:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5a918778123e677c2209425bdc9905b45699ab6e\">5a91877</a></td><td><code>sage_setup.find: Fix filter_cython_sources doctests</code></td></tr></table>\n",
    "created_at": "2021-02-18T02:43:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506121",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:76'>**Comment 76:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5a918778123e677c2209425bdc9905b45699ab6e">5a91877</a></td><td><code>sage_setup.find: Fix filter_cython_sources doctests</code></td></tr></table>




---

archive/issue_comments_506122.json:
```json
{
    "body": "**Changing commit** from \"[ccce09e2c8cc7fa802ed18450778096f76364da7](https://github.com/sagemath/sagetrac-mirror/commit/ccce09e2c8cc7fa802ed18450778096f76364da7)\" to \"[5a918778123e677c2209425bdc9905b45699ab6e](https://github.com/sagemath/sagetrac-mirror/commit/5a918778123e677c2209425bdc9905b45699ab6e)\".",
    "created_at": "2021-02-18T02:43:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506122",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[ccce09e2c8cc7fa802ed18450778096f76364da7](https://github.com/sagemath/sagetrac-mirror/commit/ccce09e2c8cc7fa802ed18450778096f76364da7)" to "[5a918778123e677c2209425bdc9905b45699ab6e](https://github.com/sagemath/sagetrac-mirror/commit/5a918778123e677c2209425bdc9905b45699ab6e)".



---

archive/issue_comments_506123.json:
```json
{
    "body": "<a id='comment:77'>**Comment 77:**</a>\nThe remaining failures in `sage_setup/find.py` are now all about `installed_files_by_module`; I'll have to see what to do about them (this function is only needed for the old build system).\n\nThe failure in `sage/repl/interpreter.py` seems to indicate that the C source information (`sage/rings/integer.c`) is missing.",
    "created_at": "2021-02-18T03:03:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506123",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:77'>**Comment 77:**</a>
The remaining failures in `sage_setup/find.py` are now all about `installed_files_by_module`; I'll have to see what to do about them (this function is only needed for the old build system).

The failure in `sage/repl/interpreter.py` seems to indicate that the C source information (`sage/rings/integer.c`) is missing.



---

archive/issue_comments_506124.json:
```json
{
    "body": "**Changing commit** from \"[5a918778123e677c2209425bdc9905b45699ab6e](https://github.com/sagemath/sagetrac-mirror/commit/5a918778123e677c2209425bdc9905b45699ab6e)\" to \"[e272614fd26ceb3992754a014099fc644d470f06](https://github.com/sagemath/sagetrac-mirror/commit/e272614fd26ceb3992754a014099fc644d470f06)\".",
    "created_at": "2021-02-18T03:16:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506124",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[5a918778123e677c2209425bdc9905b45699ab6e](https://github.com/sagemath/sagetrac-mirror/commit/5a918778123e677c2209425bdc9905b45699ab6e)" to "[e272614fd26ceb3992754a014099fc644d470f06](https://github.com/sagemath/sagetrac-mirror/commit/e272614fd26ceb3992754a014099fc644d470f06)".



---

archive/issue_comments_506125.json:
```json
{
    "body": "<a id='comment:78'>**Comment 78:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/66fa8c0ab21beaca1bf13ccc97fb9f765af3fda1\">66fa8c0</a></td><td><code>src/setup.py: Add . to sys.path earlier</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e272614fd26ceb3992754a014099fc644d470f06\">e272614</a></td><td><code>src/setup.py: Pass gdb_debug to cythonize, as in sage_build_cython</code></td></tr></table>\n",
    "created_at": "2021-02-18T03:16:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506125",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:78'>**Comment 78:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/66fa8c0ab21beaca1bf13ccc97fb9f765af3fda1">66fa8c0</a></td><td><code>src/setup.py: Add . to sys.path earlier</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e272614fd26ceb3992754a014099fc644d470f06">e272614</a></td><td><code>src/setup.py: Pass gdb_debug to cythonize, as in sage_build_cython</code></td></tr></table>




---

archive/issue_comments_506126.json:
```json
{
    "body": "**Changing commit** from \"[e272614fd26ceb3992754a014099fc644d470f06](https://github.com/sagemath/sagetrac-mirror/commit/e272614fd26ceb3992754a014099fc644d470f06)\" to \"[67072f34146e7ed547f241854755a462660b53cf](https://github.com/sagemath/sagetrac-mirror/commit/67072f34146e7ed547f241854755a462660b53cf)\".",
    "created_at": "2021-02-18T03:29:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506126",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[e272614fd26ceb3992754a014099fc644d470f06](https://github.com/sagemath/sagetrac-mirror/commit/e272614fd26ceb3992754a014099fc644d470f06)" to "[67072f34146e7ed547f241854755a462660b53cf](https://github.com/sagemath/sagetrac-mirror/commit/67072f34146e7ed547f241854755a462660b53cf)".



---

archive/issue_comments_506127.json:
```json
{
    "body": "<a id='comment:79'>**Comment 79:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/67072f34146e7ed547f241854755a462660b53cf\">67072f3</a></td><td><code>src/setup.py: Use include, not exclude in find_namespace_packages to get top_level info right</code></td></tr></table>\n",
    "created_at": "2021-02-18T03:29:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506127",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:79'>**Comment 79:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/67072f34146e7ed547f241854755a462660b53cf">67072f3</a></td><td><code>src/setup.py: Use include, not exclude in find_namespace_packages to get top_level info right</code></td></tr></table>




---

archive/issue_comments_506128.json:
```json
{
    "body": "<a id='comment:80'>**Comment 80:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0bcf8a40008300ad2fca24310a052b0b2fc6b510\">0bcf8a4</a></td><td><code>build/pkgs/sagelib/spkg-install: When switching from editable install to traditional install, remove the egg-link</code></td></tr></table>\n",
    "created_at": "2021-02-18T04:12:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506128",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:80'>**Comment 80:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0bcf8a40008300ad2fca24310a052b0b2fc6b510">0bcf8a4</a></td><td><code>build/pkgs/sagelib/spkg-install: When switching from editable install to traditional install, remove the egg-link</code></td></tr></table>




---

archive/issue_comments_506129.json:
```json
{
    "body": "**Changing commit** from \"[67072f34146e7ed547f241854755a462660b53cf](https://github.com/sagemath/sagetrac-mirror/commit/67072f34146e7ed547f241854755a462660b53cf)\" to \"[0bcf8a40008300ad2fca24310a052b0b2fc6b510](https://github.com/sagemath/sagetrac-mirror/commit/0bcf8a40008300ad2fca24310a052b0b2fc6b510)\".",
    "created_at": "2021-02-18T04:12:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506129",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[67072f34146e7ed547f241854755a462660b53cf](https://github.com/sagemath/sagetrac-mirror/commit/67072f34146e7ed547f241854755a462660b53cf)" to "[0bcf8a40008300ad2fca24310a052b0b2fc6b510](https://github.com/sagemath/sagetrac-mirror/commit/0bcf8a40008300ad2fca24310a052b0b2fc6b510)".



---

archive/issue_comments_506130.json:
```json
{
    "body": "**Changing commit** from \"[0bcf8a40008300ad2fca24310a052b0b2fc6b510](https://github.com/sagemath/sagetrac-mirror/commit/0bcf8a40008300ad2fca24310a052b0b2fc6b510)\" to \"[981124cd020eaa4127a9ae0e6c9009269e45a2ff](https://github.com/sagemath/sagetrac-mirror/commit/981124cd020eaa4127a9ae0e6c9009269e45a2ff)\".",
    "created_at": "2021-02-18T06:45:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506130",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[0bcf8a40008300ad2fca24310a052b0b2fc6b510](https://github.com/sagemath/sagetrac-mirror/commit/0bcf8a40008300ad2fca24310a052b0b2fc6b510)" to "[981124cd020eaa4127a9ae0e6c9009269e45a2ff](https://github.com/sagemath/sagetrac-mirror/commit/981124cd020eaa4127a9ae0e6c9009269e45a2ff)".



---

archive/issue_comments_506131.json:
```json
{
    "body": "<a id='comment:81'>**Comment 81:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/981124cd020eaa4127a9ae0e6c9009269e45a2ff\">981124c</a></td><td><code>sage_setup.find.installed_files_by_module: Make doctest work for editable installs too</code></td></tr></table>\n",
    "created_at": "2021-02-18T06:45:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506131",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:81'>**Comment 81:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/981124cd020eaa4127a9ae0e6c9009269e45a2ff">981124c</a></td><td><code>sage_setup.find.installed_files_by_module: Make doctest work for editable installs too</code></td></tr></table>




---

archive/issue_comments_506132.json:
```json
{
    "body": "<a id='comment:82'>**Comment 82:**</a>\nThis fixes the remaining doctests for me.",
    "created_at": "2021-02-18T06:47:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506132",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:82'>**Comment 82:**</a>
This fixes the remaining doctests for me.



---

archive/issue_comments_506133.json:
```json
{
    "body": "<a id='comment:83'>**Comment 83:**</a>\nNot for me:\n\nI still get `src/sage/tests/cmdline.py`, which can be ignored.\n\nOn top:\n\n```\nkliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py\nRunning doctests with ID 2021-02-18-07-50-51-5ae2b230.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py\n**********************************************************************\nFile \"src/sage/repl/interpreter.py\", line 77, in sage.repl.interpreter\nFailed example:\n    print(\"dummy line\"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test\nExpected:\n    dummy line\n    ...\n    ZeroDivisionError...Traceback (most recent call last)\n    <ipython-input-...> in <module>...\n    ----> 1 Integer(1)/Integer(0)\n    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()\n    ...\n    -> ...                  raise ZeroDivisionError(\"rational division by zero\")\n       ...            x = <Rational> Rational.__new__(Rational)\n       ...            mpq_div_zz(x.value, ....value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\nGot:\n    dummy line\n    ---------------------------------------------------------------------------\n    ZeroDivisionError                         Traceback (most recent call last)\n    <ipython-input-1-72ac74c5f414> in <module>\n    ----> 1 Integer(1)/Integer(0)\n    <BLANKLINE>\n    /srv/public/kliem/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__truediv__()\n       2038         if type(left) is type(right):\n       2039             if mpz_sgn((<Integer>right).value) == 0:\n    -> 2040                 raise ZeroDivisionError(\"rational division by zero\")\n       2041             x = <Rational> Rational.__new__(Rational)\n       2042             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\n**********************************************************************\n1 item had failures:\n   1 of  20 in sage.repl.interpreter\n    [141 tests, 1 failure, 1.94 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 7.3 seconds\n    cpu time: 0.6 seconds\n    cumulative wall time: 1.9 seconds\nkliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx\nRunning doctests with ID 2021-02-18-07-51-08-57678760.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx\n**********************************************************************\nFile \"src/sage/stats/hmm/hmm.pyx\", line 1234, in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch\nFailed example:\n    m.baum_welch(v,fix_emissions=True)\nExpected:\n    (-66.98630856918774, 100)\nGot:\n    (-66.98630856918776, 100)\n**********************************************************************\n1 item had failures:\n   1 of  14 in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch\n    [121 tests, 1 failure, 0.33 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.4 seconds\n    cpu time: 0.3 seconds\n    cumulative wall time: 0.3 seconds\nkliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py\nRunning doctests with ID 2021-02-18-07-51-21-d3281c6c.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 264, in sage_setup.find.find_extra_files\nFailed example:\n    extras[\"sage/ext/interpreters\"]\nExpected:\n    ['.../src/sage/ext/interpreters/wrapper_cdf.pxd', ...wrapper_cdf.h...]\nGot:\n    ['/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pyx',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pxd',\n     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pxd']\n**********************************************************************\n1 item had failures:\n   1 of   7 in sage_setup.find.find_extra_files\n    [41 tests, 1 failure, 0.47 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.5 seconds\n    cpu time: 0.5 seconds\n    cumulative wall time: 0.5 seconds\n```",
    "created_at": "2021-02-18T06:53:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506133",
    "user": "https://github.com/kliem"
}
```

<a id='comment:83'>**Comment 83:**</a>
Not for me:

I still get `src/sage/tests/cmdline.py`, which can be ignored.

On top:

```
kliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py
Running doctests with ID 2021-02-18-07-50-51-5ae2b230.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py
**********************************************************************
File "src/sage/repl/interpreter.py", line 77, in sage.repl.interpreter
Failed example:
    print("dummy line"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test
Expected:
    dummy line
    ...
    ZeroDivisionError...Traceback (most recent call last)
    <ipython-input-...> in <module>...
    ----> 1 Integer(1)/Integer(0)
    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()
    ...
    -> ...                  raise ZeroDivisionError("rational division by zero")
       ...            x = <Rational> Rational.__new__(Rational)
       ...            mpq_div_zz(x.value, ....value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
Got:
    dummy line
    ---------------------------------------------------------------------------
    ZeroDivisionError                         Traceback (most recent call last)
    <ipython-input-1-72ac74c5f414> in <module>
    ----> 1 Integer(1)/Integer(0)
    <BLANKLINE>
    /srv/public/kliem/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__truediv__()
       2038         if type(left) is type(right):
       2039             if mpz_sgn((<Integer>right).value) == 0:
    -> 2040                 raise ZeroDivisionError("rational division by zero")
       2041             x = <Rational> Rational.__new__(Rational)
       2042             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
**********************************************************************
1 item had failures:
   1 of  20 in sage.repl.interpreter
    [141 tests, 1 failure, 1.94 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 7.3 seconds
    cpu time: 0.6 seconds
    cumulative wall time: 1.9 seconds
kliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx
Running doctests with ID 2021-02-18-07-51-08-57678760.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx
**********************************************************************
File "src/sage/stats/hmm/hmm.pyx", line 1234, in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch
Failed example:
    m.baum_welch(v,fix_emissions=True)
Expected:
    (-66.98630856918774, 100)
Got:
    (-66.98630856918776, 100)
**********************************************************************
1 item had failures:
   1 of  14 in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.baum_welch
    [121 tests, 1 failure, 0.33 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/stats/hmm/hmm.pyx  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 0.4 seconds
    cpu time: 0.3 seconds
    cumulative wall time: 0.3 seconds
kliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py
Running doctests with ID 2021-02-18-07-51-21-d3281c6c.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py
**********************************************************************
File "src/sage_setup/find.py", line 264, in sage_setup.find.find_extra_files
Failed example:
    extras["sage/ext/interpreters"]
Expected:
    ['.../src/sage/ext/interpreters/wrapper_cdf.pxd', ...wrapper_cdf.h...]
Got:
    ['/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_py.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cdf.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rr.pyx',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_rdf.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_cc.pxd',
     '/srv/public/kliem/sage/src/sage/ext/interpreters/wrapper_el.pxd']
**********************************************************************
1 item had failures:
   1 of   7 in sage_setup.find.find_extra_files
    [41 tests, 1 failure, 0.47 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage_setup/find.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 0.5 seconds
    cpu time: 0.5 seconds
    cumulative wall time: 0.5 seconds
```



---

archive/issue_comments_506134.json:
```json
{
    "body": "<a id='comment:84'>**Comment 84:**</a>\n`find_extra_files` does exactly what the documentation claims it does, it lists all `pyx, pxd, pxi` files.",
    "created_at": "2021-02-18T06:58:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506134",
    "user": "https://github.com/kliem"
}
```

<a id='comment:84'>**Comment 84:**</a>
`find_extra_files` does exactly what the documentation claims it does, it lists all `pyx, pxd, pxi` files.



---

archive/issue_comments_506135.json:
```json
{
    "body": "<a id='comment:85'>**Comment 85:**</a>\nAfter `make sagelib-clean sagelib` I can reproduce this error too. the `.h` files are missing in the list.",
    "created_at": "2021-02-18T07:06:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506135",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:85'>**Comment 85:**</a>
After `make sagelib-clean sagelib` I can reproduce this error too. the `.h` files are missing in the list.



---

archive/issue_comments_506136.json:
```json
{
    "body": "<a id='comment:86'>**Comment 86:**</a>\nMy guess is that the doctest failure in `src/sage/repl/interpreter.py` will go away if you do `make sagelib-clean`",
    "created_at": "2021-02-18T07:07:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506136",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:86'>**Comment 86:**</a>
My guess is that the doctest failure in `src/sage/repl/interpreter.py` will go away if you do `make sagelib-clean`



---

archive/issue_comments_506137.json:
```json
{
    "body": "<a id='comment:87'>**Comment 87:**</a>\nThe missing `.h` files are by design. This function gives only `.h.` files in `cythonized`, which is pointless now. I don't know what would be the best way to deal with this.\n\nCan you fix the precision error in `src/sage/stats/hmm/hmm.pyx` as well (`# abs tol 1e-13`). It seems pointless to have an extra ticket for this.",
    "created_at": "2021-02-18T07:27:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506137",
    "user": "https://github.com/kliem"
}
```

<a id='comment:87'>**Comment 87:**</a>
The missing `.h` files are by design. This function gives only `.h.` files in `cythonized`, which is pointless now. I don't know what would be the best way to deal with this.

Can you fix the precision error in `src/sage/stats/hmm/hmm.pyx` as well (`# abs tol 1e-13`). It seems pointless to have an extra ticket for this.



---

archive/issue_comments_506138.json:
```json
{
    "body": "<a id='comment:88'>**Comment 88:**</a>\nRan `make sagelib-clean sagelib` and `make build` and it still persists:\n\n```\nkliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py\nRunning doctests with ID 2021-02-18-08-59-13-9182572c.\nGit branch: test_31377\nUsing --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py\n**********************************************************************\nFile \"src/sage/repl/interpreter.py\", line 77, in sage.repl.interpreter\nFailed example:\n    print(\"dummy line\"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test\nExpected:\n    dummy line\n    ...\n    ZeroDivisionError...Traceback (most recent call last)\n    <ipython-input-...> in <module>...\n    ----> 1 Integer(1)/Integer(0)\n    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()\n    ...\n    -> ...                  raise ZeroDivisionError(\"rational division by zero\")\n       ...            x = <Rational> Rational.__new__(Rational)\n       ...            mpq_div_zz(x.value, ....value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\nGot:\n    dummy line\n    ---------------------------------------------------------------------------\n    ZeroDivisionError                         Traceback (most recent call last)\n    <ipython-input-1-72ac74c5f414> in <module>\n    ----> 1 Integer(1)/Integer(0)\n    <BLANKLINE>\n    /srv/public/kliem/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__truediv__()\n       2038         if type(left) is type(right):\n       2039             if mpz_sgn((<Integer>right).value) == 0:\n    -> 2040                 raise ZeroDivisionError(\"rational division by zero\")\n       2041             x = <Rational> Rational.__new__(Rational)\n       2042             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\n**********************************************************************\n1 item had failures:\n   1 of  20 in sage.repl.interpreter\n    [141 tests, 1 failure, 2.90 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 8.4 seconds\n    cpu time: 0.6 seconds\n    cumulative wall time: 2.9 seconds\n```",
    "created_at": "2021-02-18T08:00:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506138",
    "user": "https://github.com/kliem"
}
```

<a id='comment:88'>**Comment 88:**</a>
Ran `make sagelib-clean sagelib` and `make build` and it still persists:

```
kliem@lech:~/localhome/sage$ sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py
Running doctests with ID 2021-02-18-08-59-13-9182572c.
Git branch: test_31377
Using --optional=build,debian,dochtml,memlimit,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py
**********************************************************************
File "src/sage/repl/interpreter.py", line 77, in sage.repl.interpreter
Failed example:
    print("dummy line"); shell.run_cell('1/0') # see #25320 for the reason of the `...` and the dummy line in this test
Expected:
    dummy line
    ...
    ZeroDivisionError...Traceback (most recent call last)
    <ipython-input-...> in <module>...
    ----> 1 Integer(1)/Integer(0)
    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()
    ...
    -> ...                  raise ZeroDivisionError("rational division by zero")
       ...            x = <Rational> Rational.__new__(Rational)
       ...            mpq_div_zz(x.value, ....value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
Got:
    dummy line
    ---------------------------------------------------------------------------
    ZeroDivisionError                         Traceback (most recent call last)
    <ipython-input-1-72ac74c5f414> in <module>
    ----> 1 Integer(1)/Integer(0)
    <BLANKLINE>
    /srv/public/kliem/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__truediv__()
       2038         if type(left) is type(right):
       2039             if mpz_sgn((<Integer>right).value) == 0:
    -> 2040                 raise ZeroDivisionError("rational division by zero")
       2041             x = <Rational> Rational.__new__(Rational)
       2042             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
**********************************************************************
1 item had failures:
   1 of  20 in sage.repl.interpreter
    [141 tests, 1 failure, 2.90 s]
----------------------------------------------------------------------
sage -t --long --warn-long 62.2 --random-seed=0 src/sage/repl/interpreter.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 8.4 seconds
    cpu time: 0.6 seconds
    cumulative wall time: 2.9 seconds
```



---

archive/issue_comments_506139.json:
```json
{
    "body": "<a id='comment:89'>**Comment 89:**</a>\nI mean it makes completely sense that the cythonized file is no longer written in parenthesis, because it is in the obvious location. So no need to specify this anymore.",
    "created_at": "2021-02-18T08:01:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506139",
    "user": "https://github.com/kliem"
}
```

<a id='comment:89'>**Comment 89:**</a>
I mean it makes completely sense that the cythonized file is no longer written in parenthesis, because it is in the obvious location. So no need to specify this anymore.



---

archive/issue_comments_506140.json:
```json
{
    "body": "<a id='comment:90'>**Comment 90:**</a>\nReplying to [@mkoeppe](#comment%3A86):\n> My guess is that the doctest failure in `src/sage/repl/interpreter.py` will go away if you do `make sagelib-clean`\n\nI think this problem comes from the fact that currently find_packages is called before the autogeneration. Thus, the auto-generated files are not included in the cythonization step. This is fixed in the setup.py in #30371.",
    "created_at": "2021-02-18T08:34:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506140",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:90'>**Comment 90:**</a>
Replying to [@mkoeppe](#comment%3A86):
> My guess is that the doctest failure in `src/sage/repl/interpreter.py` will go away if you do `make sagelib-clean`

I think this problem comes from the fact that currently find_packages is called before the autogeneration. Thus, the auto-generated files are not included in the cythonization step. This is fixed in the setup.py in #30371.



---

archive/issue_comments_506141.json:
```json
{
    "body": "<a id='comment:91'>**Comment 91:**</a>\nI think we can leave those failures for later fix, as long as we take care of them at some point.\n\nNone of the doctest failures is serious.\n\nI guess this isn't ready yet for being used for patchbots.",
    "created_at": "2021-02-18T08:37:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506141",
    "user": "https://github.com/kliem"
}
```

<a id='comment:91'>**Comment 91:**</a>
I think we can leave those failures for later fix, as long as we take care of them at some point.

None of the doctest failures is serious.

I guess this isn't ready yet for being used for patchbots.



---

archive/issue_comments_506142.json:
```json
{
    "body": "<a id='comment:92'>**Comment 92:**</a>\nReplying to [@kliem](#comment%3A88):\n> Ran `make sagelib-clean sagelib` and `make build` and it still persists:\n\nI'm pretty sure I fixed this with e272614; perhaps `make sagelib-clean` still does not clean enough?",
    "created_at": "2021-02-18T16:35:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506142",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:92'>**Comment 92:**</a>
Replying to [@kliem](#comment%3A88):
> Ran `make sagelib-clean sagelib` and `make build` and it still persists:

I'm pretty sure I fixed this with e272614; perhaps `make sagelib-clean` still does not clean enough?



---

archive/issue_comments_506143.json:
```json
{
    "body": "<a id='comment:93'>**Comment 93:**</a>\nReplying to [@tobiasdiez](#comment%3A90):\n> Replying to [@mkoeppe](#comment%3A86):\n> > My guess is that the doctest failure in `src/sage/repl/interpreter.py` will go away if you do `make sagelib-clean`\n\n> \n> I think this problem comes from the fact that currently find_packages is called before the autogeneration. Thus, the auto-generated files are not included in the cythonization step. This is fixed in the setup.py in #30371.\n\nNo, calling autogen earlier does not help.",
    "created_at": "2021-02-18T16:49:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506143",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:93'>**Comment 93:**</a>
Replying to [@tobiasdiez](#comment%3A90):
> Replying to [@mkoeppe](#comment%3A86):
> > My guess is that the doctest failure in `src/sage/repl/interpreter.py` will go away if you do `make sagelib-clean`

> 
> I think this problem comes from the fact that currently find_packages is called before the autogeneration. Thus, the auto-generated files are not included in the cythonization step. This is fixed in the setup.py in #30371.

No, calling autogen earlier does not help.



---

archive/issue_comments_506144.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,6 +10,7 @@\n To test:\n \n ```\n+./bootstrap\n ./configure --enable-editable\n make build\n ```\n``````\n",
    "created_at": "2021-02-18T17:25:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506144",
    "user": "https://github.com/tobiasdiez"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,6 +10,7 @@
 To test:
 
 ```
+./bootstrap
 ./configure --enable-editable
 make build
 ```
``````




---

archive/issue_comments_506145.json:
```json
{
    "body": "<a id='comment:95'>**Comment 95:**</a>\nFor changes in Python source, one might even use `importlib` and not restart sage at all!",
    "created_at": "2021-02-18T17:31:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506145",
    "user": "https://github.com/videlec"
}
```

<a id='comment:95'>**Comment 95:**</a>
For changes in Python source, one might even use `importlib` and not restart sage at all!



---

archive/issue_comments_506146.json:
```json
{
    "body": "<a id='comment:96'>**Comment 96:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b5d51bd0ff4823972f95f0728eba485d3443afe\">8b5d51b</a></td><td><code>src/sage_setup: Generalize doctests to editable install using new function _cythonized_dir</code></td></tr></table>\n",
    "created_at": "2021-02-18T17:31:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506146",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:96'>**Comment 96:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b5d51bd0ff4823972f95f0728eba485d3443afe">8b5d51b</a></td><td><code>src/sage_setup: Generalize doctests to editable install using new function _cythonized_dir</code></td></tr></table>




---

archive/issue_comments_506147.json:
```json
{
    "body": "**Changing commit** from \"[981124cd020eaa4127a9ae0e6c9009269e45a2ff](https://github.com/sagemath/sagetrac-mirror/commit/981124cd020eaa4127a9ae0e6c9009269e45a2ff)\" to \"[8b5d51bd0ff4823972f95f0728eba485d3443afe](https://github.com/sagemath/sagetrac-mirror/commit/8b5d51bd0ff4823972f95f0728eba485d3443afe)\".",
    "created_at": "2021-02-18T17:31:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506147",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[981124cd020eaa4127a9ae0e6c9009269e45a2ff](https://github.com/sagemath/sagetrac-mirror/commit/981124cd020eaa4127a9ae0e6c9009269e45a2ff)" to "[8b5d51bd0ff4823972f95f0728eba485d3443afe](https://github.com/sagemath/sagetrac-mirror/commit/8b5d51bd0ff4823972f95f0728eba485d3443afe)".



---

archive/issue_comments_506148.json:
```json
{
    "body": "<a id='comment:97'>**Comment 97:**</a>\nReplying to [@videlec](#comment%3A95):\n> For changes in Python source, one might even use `importlib` and not restart sage at all!\n\nTrue, but let's not document this -- too many possible pitfalls related to class redefinitions",
    "created_at": "2021-02-18T17:33:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506148",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:97'>**Comment 97:**</a>
Replying to [@videlec](#comment%3A95):
> For changes in Python source, one might even use `importlib` and not restart sage at all!

True, but let's not document this -- too many possible pitfalls related to class redefinitions



---

archive/issue_comments_506149.json:
```json
{
    "body": "<a id='comment:98'>**Comment 98:**</a>\n(Too bad that Python does not have `UPDATE-INSTANCE-FOR-REDEFINED-CLASS` http://clhs.lisp.se/Body/f_upda_1.htm)",
    "created_at": "2021-02-18T17:37:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506149",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:98'>**Comment 98:**</a>
(Too bad that Python does not have `UPDATE-INSTANCE-FOR-REDEFINED-CLASS` http://clhs.lisp.se/Body/f_upda_1.htm)



---

archive/issue_comments_506150.json:
```json
{
    "body": "<a id='comment:99'>**Comment 99:**</a>\nReady for another round of testing. (I won't do the unrelated `hmm.pyx` doctest fix on this ticket)",
    "created_at": "2021-02-18T17:45:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506150",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:99'>**Comment 99:**</a>
Ready for another round of testing. (I won't do the unrelated `hmm.pyx` doctest fix on this ticket)



---

archive/issue_comments_506151.json:
```json
{
    "body": "<a id='comment:0'>**Comment 0:**</a>\nAfter deleting everything and reinstalling it, I still get the failure in `src/sage/repl/interpreter.py`. The `find.py` thing is gone now.",
    "created_at": "2021-02-18T18:04:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506151",
    "user": "https://github.com/kliem"
}
```

<a id='comment:0'>**Comment 0:**</a>
After deleting everything and reinstalling it, I still get the failure in `src/sage/repl/interpreter.py`. The `find.py` thing is gone now.



---

archive/issue_comments_506152.json:
```json
{
    "body": "<a id='comment:1'>**Comment 1:**</a>\nI'm getting the `src/sage/repl/interpreter.py` failure now too again... any help with tracking this down is welcome...",
    "created_at": "2021-02-18T18:33:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506152",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'>**Comment 1:**</a>
I'm getting the `src/sage/repl/interpreter.py` failure now too again... any help with tracking this down is welcome...



---

archive/issue_comments_506153.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\nOr we can leave this issue for the follow-up ticket #31406, that would be fine with me too.",
    "created_at": "2021-02-18T18:51:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506153",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'>**Comment 2:**</a>
Or we can leave this issue for the follow-up ticket #31406, that would be fine with me too.



---

archive/issue_comments_506154.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nIf we're to believe the doctest language (\"Check that Cython source code appears in tracebacks\"), then this is functioning properly, it's just missing \"(.../cythonized/sage/rings/integer.c:...)()\". Can we just replace that part of the doctest with \"...\", or is it important?\n\n```diff\ndiff --git a/src/sage/repl/interpreter.py b/src/sage/repl/interpreter.py\nindex befa75fc38..3bd894851d 100644\n--- a/src/sage/repl/interpreter.py\n+++ b/src/sage/repl/interpreter.py\n@@ -80,7 +80,7 @@ Check that Cython source code appears in tracebacks::\n     ZeroDivisionError...Traceback (most recent call last)\n     <ipython-input-...> in <module>...\n     ----> 1 Integer(1)/Integer(0)\n-    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()\n+    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div...\n     ...\n     -> ...                  raise ZeroDivisionError(\"rational division by zero\")\n        ....:            x = <Rational> Rational.__new__(Rational)\n```\nBy the way, `git status` tells me\n\n```\nUntracked files:\n  (use \"git add <file>...\" to include in what will be committed)\n\tsrc/cython_debug/\n```",
    "created_at": "2021-02-18T19:59:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506154",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'>**Comment 3:**</a>
If we're to believe the doctest language ("Check that Cython source code appears in tracebacks"), then this is functioning properly, it's just missing "(.../cythonized/sage/rings/integer.c:...)()". Can we just replace that part of the doctest with "...", or is it important?

```diff
diff --git a/src/sage/repl/interpreter.py b/src/sage/repl/interpreter.py
index befa75fc38..3bd894851d 100644
--- a/src/sage/repl/interpreter.py
+++ b/src/sage/repl/interpreter.py
@@ -80,7 +80,7 @@ Check that Cython source code appears in tracebacks::
     ZeroDivisionError...Traceback (most recent call last)
     <ipython-input-...> in <module>...
     ----> 1 Integer(1)/Integer(0)
-    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div... (.../sage/rings/integer.c:...)()
+    .../sage/rings/integer.pyx in sage.rings.integer.Integer...div...
     ...
     -> ...                  raise ZeroDivisionError("rational division by zero")
        ....:            x = <Rational> Rational.__new__(Rational)
```
By the way, `git status` tells me

```
Untracked files:
  (use "git add <file>..." to include in what will be committed)
	src/cython_debug/
```



---

archive/issue_comments_506155.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\nI had also these untracked files in src/cython_debug.\n\nThe tests seem to pass in general for me. However, they need a lot of ram, like > 25GB which sometimes leads to a crash of the system. In particular, the tests around sage/plot seem to very memeroy intensive (but the memory doesn't go down afterwards). Is this normal? I could also reproduce this on the github actions in #30371 which also crash reproducible after about 2 hours of doctesting.",
    "created_at": "2021-02-18T20:12:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506155",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:4'>**Comment 4:**</a>
I had also these untracked files in src/cython_debug.

The tests seem to pass in general for me. However, they need a lot of ram, like > 25GB which sometimes leads to a crash of the system. In particular, the tests around sage/plot seem to very memeroy intensive (but the memory doesn't go down afterwards). Is this normal? I could also reproduce this on the github actions in #30371 which also crash reproducible after about 2 hours of doctesting.



---

archive/issue_comments_506156.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89969bf6bd90d68861a85f5d91cf7756a5ae7229\">89969bf</a></td><td><code>.gitignore: Ignore src/cython_debug</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eb631b23bc8f207a57da1550cf799de86983bd94\">eb631b2</a></td><td><code>build/make/Makefile.in: Remove src/cython_debug</code></td></tr></table>\n",
    "created_at": "2021-02-18T20:28:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506156",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:5'>**Comment 5:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89969bf6bd90d68861a85f5d91cf7756a5ae7229">89969bf</a></td><td><code>.gitignore: Ignore src/cython_debug</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eb631b23bc8f207a57da1550cf799de86983bd94">eb631b2</a></td><td><code>build/make/Makefile.in: Remove src/cython_debug</code></td></tr></table>




---

archive/issue_comments_506157.json:
```json
{
    "body": "**Changing commit** from \"[8b5d51bd0ff4823972f95f0728eba485d3443afe](https://github.com/sagemath/sagetrac-mirror/commit/8b5d51bd0ff4823972f95f0728eba485d3443afe)\" to \"[eb631b23bc8f207a57da1550cf799de86983bd94](https://github.com/sagemath/sagetrac-mirror/commit/eb631b23bc8f207a57da1550cf799de86983bd94)\".",
    "created_at": "2021-02-18T20:28:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506157",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[8b5d51bd0ff4823972f95f0728eba485d3443afe](https://github.com/sagemath/sagetrac-mirror/commit/8b5d51bd0ff4823972f95f0728eba485d3443afe)" to "[eb631b23bc8f207a57da1550cf799de86983bd94](https://github.com/sagemath/sagetrac-mirror/commit/eb631b23bc8f207a57da1550cf799de86983bd94)".



---

archive/issue_comments_506158.json:
```json
{
    "body": "<a id='comment:106'>**Comment 106:**</a>\nReplying to [@jhpalmieri](#comment%3A103):\n> it's just missing \"(.../cythonized/sage/rings/integer.c:...)()\". Can we just replace that part of the doctest with \"...\", or is it important?\n\nI don't know if this information is important, perhaps someone who programs Cython can tell us?",
    "created_at": "2021-02-18T20:29:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506158",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:106'>**Comment 106:**</a>
Replying to [@jhpalmieri](#comment%3A103):
> it's just missing "(.../cythonized/sage/rings/integer.c:...)()". Can we just replace that part of the doctest with "...", or is it important?

I don't know if this information is important, perhaps someone who programs Cython can tell us?



---

archive/issue_comments_506159.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\nUsing git blame, this doctest was introduced in commit `6e7ad656ba3307ff67949e251550c101758f9963`. In this commit Jeroen Demeyer added a IPython patch. Of course this patch has long merged upstream and has now changed several times and I failed to located the place, where things are happening.\n\nHowever, things are out of our control.\n\nI think the reason why \"(.../cythonized/sage/rings/integer.c:...)()\" appears is that the cythonized file is located at a different location then the source file. So this might be important, when you are debugging. However, if the cythonized files are no longer hidden somewhere else, then it appears pointless to print this information and this is probably why IPython doesn't do it. I mean the file is right next to the other file. It is redundant information in this case.\n\nLong story short, I think this can go. It is an IPython feature of which we do not have control anyway. What is important, is that the corresponding `pyx` file appears correctly, which is the case.",
    "created_at": "2021-02-18T20:40:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506159",
    "user": "https://github.com/kliem"
}
```

<a id='comment:7'>**Comment 7:**</a>
Using git blame, this doctest was introduced in commit `6e7ad656ba3307ff67949e251550c101758f9963`. In this commit Jeroen Demeyer added a IPython patch. Of course this patch has long merged upstream and has now changed several times and I failed to located the place, where things are happening.

However, things are out of our control.

I think the reason why "(.../cythonized/sage/rings/integer.c:...)()" appears is that the cythonized file is located at a different location then the source file. So this might be important, when you are debugging. However, if the cythonized files are no longer hidden somewhere else, then it appears pointless to print this information and this is probably why IPython doesn't do it. I mean the file is right next to the other file. It is redundant information in this case.

Long story short, I think this can go. It is an IPython feature of which we do not have control anyway. What is important, is that the corresponding `pyx` file appears correctly, which is the case.



---

archive/issue_comments_506160.json:
```json
{
    "body": "**Changing commit** from \"[eb631b23bc8f207a57da1550cf799de86983bd94](https://github.com/sagemath/sagetrac-mirror/commit/eb631b23bc8f207a57da1550cf799de86983bd94)\" to \"[daec3e803e8f6a6de8e717459c31b2b7de7a8906](https://github.com/sagemath/sagetrac-mirror/commit/daec3e803e8f6a6de8e717459c31b2b7de7a8906)\".",
    "created_at": "2021-02-18T20:50:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506160",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[eb631b23bc8f207a57da1550cf799de86983bd94](https://github.com/sagemath/sagetrac-mirror/commit/eb631b23bc8f207a57da1550cf799de86983bd94)" to "[daec3e803e8f6a6de8e717459c31b2b7de7a8906](https://github.com/sagemath/sagetrac-mirror/commit/daec3e803e8f6a6de8e717459c31b2b7de7a8906)".



---

archive/issue_comments_506161.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/daec3e803e8f6a6de8e717459c31b2b7de7a8906\">daec3e8</a></td><td><code>src/sage/repl/interpreter.py: Do not test that IPython displays the location of the Cython-generated .c file</code></td></tr></table>\n",
    "created_at": "2021-02-18T20:50:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506161",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'>**Comment 8:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/daec3e803e8f6a6de8e717459c31b2b7de7a8906">daec3e8</a></td><td><code>src/sage/repl/interpreter.py: Do not test that IPython displays the location of the Cython-generated .c file</code></td></tr></table>




---

archive/issue_comments_506162.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nThanks for investigating. This is sufficiently convincing, so I have removed the test.",
    "created_at": "2021-02-18T20:50:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506162",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'>**Comment 9:**</a>
Thanks for investigating. This is sufficiently convincing, so I have removed the test.



---

archive/issue_comments_506163.json:
```json
{
    "body": "<a id='comment:0'>**Comment 0:**</a>\nOk, all tests pass now (except for those two unrelated tests).",
    "created_at": "2021-02-19T15:34:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506163",
    "user": "https://github.com/kliem"
}
```

<a id='comment:0'>**Comment 0:**</a>
Ok, all tests pass now (except for those two unrelated tests).



---

archive/issue_comments_506164.json:
```json
{
    "body": "<a id='comment:1'>**Comment 1:**</a>\nAny further concerns, or can we get this in?",
    "created_at": "2021-02-20T18:10:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506164",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'>**Comment 1:**</a>
Any further concerns, or can we get this in?



---

archive/issue_comments_506165.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\nFrom my side this looks good.",
    "created_at": "2021-02-20T18:49:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506165",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:2'>**Comment 2:**</a>
From my side this looks good.



---

archive/issue_comments_506166.json:
```json
{
    "body": "**Changing reviewer** from \"Matthias Koeppe, ...\" to \"Matthias Koeppe, Tobias Diez, ...\".",
    "created_at": "2021-02-20T18:49:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506166",
    "user": "https://github.com/tobiasdiez"
}
```

**Changing reviewer** from "Matthias Koeppe, ..." to "Matthias Koeppe, Tobias Diez, ...".



---

archive/issue_comments_506167.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nI'm happy with it, but didn't have the time to understand everything yet.",
    "created_at": "2021-02-20T19:07:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506167",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'>**Comment 3:**</a>
I'm happy with it, but didn't have the time to understand everything yet.



---

archive/issue_events_380441.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-02-24T09:25:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380441"
}
```



---

archive/issue_events_380442.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-02-24T09:25:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380442"
}
```



---

archive/issue_comments_506168.json:
```json
{
    "body": "**Changing reviewer** from \"Matthias Koeppe, Tobias Diez, ...\" to \"Matthias Koeppe, Tobias Diez, Jonathan Kliem\".",
    "created_at": "2021-02-24T09:25:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506168",
    "user": "https://github.com/kliem"
}
```

**Changing reviewer** from "Matthias Koeppe, Tobias Diez, ..." to "Matthias Koeppe, Tobias Diez, Jonathan Kliem".



---

archive/issue_comments_506169.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\nLGTM.\n\nI don't know if setting `nthreads=4` for cythonizing is perfect. Maybe this could be picked up somewhere in a follow up ticket. E.g. if the environment variable `MAKE` is set to `make ... -jN ...` we should probably respect this.",
    "created_at": "2021-02-24T09:25:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506169",
    "user": "https://github.com/kliem"
}
```

<a id='comment:4'>**Comment 4:**</a>
LGTM.

I don't know if setting `nthreads=4` for cythonizing is perfect. Maybe this could be picked up somewhere in a follow up ticket. E.g. if the environment variable `MAKE` is set to `make ... -jN ...` we should probably respect this.



---

archive/issue_comments_506170.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nThanks! I've added your suggestion to #31406.",
    "created_at": "2021-02-24T15:19:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506170",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:5'>**Comment 5:**</a>
Thanks! I've added your suggestion to #31406.



---

archive/issue_comments_506171.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\nThanks for the review!",
    "created_at": "2021-02-24T18:21:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506171",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'>**Comment 6:**</a>
Thanks for the review!



---

archive/issue_comments_506172.json:
```json
{
    "body": "**Changing commit** from \"[daec3e803e8f6a6de8e717459c31b2b7de7a8906](https://github.com/sagemath/sagetrac-mirror/commit/daec3e803e8f6a6de8e717459c31b2b7de7a8906)\" to \"[8b3f3905c884f86293f103fe5bbb7a78c3d7ce02](https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02)\".",
    "created_at": "2021-03-07T21:07:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506172",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[daec3e803e8f6a6de8e717459c31b2b7de7a8906](https://github.com/sagemath/sagetrac-mirror/commit/daec3e803e8f6a6de8e717459c31b2b7de7a8906)" to "[8b3f3905c884f86293f103fe5bbb7a78c3d7ce02](https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02)".



---

archive/issue_comments_506173.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\n**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02\">8b3f390</a></td><td><code>Merge tag '9.3.beta8' into t/31377/__configure___enable_editable</code></td></tr></table>\n",
    "created_at": "2021-03-07T21:07:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506173",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'>**Comment 7:**</a>
**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02">8b3f390</a></td><td><code>Merge tag '9.3.beta8' into t/31377/__configure___enable_editable</code></td></tr></table>




---

archive/issue_events_380443.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2021-03-07T21:07:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380443"
}
```



---

archive/issue_events_380444.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2021-03-07T21:07:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380444"
}
```



---

archive/issue_events_380445.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-07T21:08:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380445"
}
```



---

archive/issue_events_380446.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-07T21:08:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380446"
}
```



---

archive/issue_comments_506174.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/__configure___enable_editable](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/__configure___enable_editable)\" to \"[8b3f3905c884f86293f103fe5bbb7a78c3d7ce02](https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02)\".",
    "created_at": "2021-03-09T00:00:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506174",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/__configure___enable_editable](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/__configure___enable_editable)" to "[8b3f3905c884f86293f103fe5bbb7a78c3d7ce02](https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02)".



---

archive/issue_events_380447.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-09T00:00:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380447"
}
```



---

archive/issue_events_380448.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "6c5c6b4386710960335d21041f8484ffc11ed632",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-03-09T00:00:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31377#event-380448"
}
```



---

archive/issue_comments_506175.json:
```json
{
    "body": "<a id='comment:0'>**Comment 0:**</a>\nI finally tracked this ticket has the breaking point of the way I build the documentation in sage-on-gentoo. This ticket not #30010. \n\nUnlike the current philosophy pursued by vanilla sage in distro we usually build documentation before installing. There are philosophy discussions to be had about the approaches. I am sometimes not even completely sure how things work. But here the reason is simple, before this ticket, all the sources where copied under `build/lib/` during the build process. After this ticket only the final compiled cython modules are found under `build/lib/`. Historically during the documentation building in sage-on-gentoo the just compiled copy of sagelib under `build/lib/` was used. This is not possible anymore.\n\nIs there a switch to pass to `setup.py` that would copy the source in `build/lib` after this ticket?",
    "created_at": "2021-03-09T21:57:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506175",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:0'>**Comment 0:**</a>
I finally tracked this ticket has the breaking point of the way I build the documentation in sage-on-gentoo. This ticket not #30010. 

Unlike the current philosophy pursued by vanilla sage in distro we usually build documentation before installing. There are philosophy discussions to be had about the approaches. I am sometimes not even completely sure how things work. But here the reason is simple, before this ticket, all the sources where copied under `build/lib/` during the build process. After this ticket only the final compiled cython modules are found under `build/lib/`. Historically during the documentation building in sage-on-gentoo the just compiled copy of sagelib under `build/lib/` was used. This is not possible anymore.

Is there a switch to pass to `setup.py` that would copy the source in `build/lib` after this ticket?



---

archive/issue_comments_506176.json:
```json
{
    "body": "**Changing commit** from \"[8b3f3905c884f86293f103fe5bbb7a78c3d7ce02](https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02)\" to \"\".",
    "created_at": "2021-03-09T21:57:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506176",
    "user": "https://github.com/kiwifb"
}
```

**Changing commit** from "[8b3f3905c884f86293f103fe5bbb7a78c3d7ce02](https://github.com/sagemath/sagetrac-mirror/commit/8b3f3905c884f86293f103fe5bbb7a78c3d7ce02)" to "".



---

archive/issue_comments_506177.json:
```json
{
    "body": "<a id='comment:1'>**Comment 1:**</a>\nI don't think this ticket changes anything if you don't use `configure --enable-editable`.",
    "created_at": "2021-03-09T22:10:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506177",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'>**Comment 1:**</a>
I don't think this ticket changes anything if you don't use `configure --enable-editable`.



---

archive/issue_comments_506178.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\nJust be sure to use `build/pkgs/sagelib/src/setup.py`, not `src/setup.py`. This builds in `build/pkgs/sagelib/src/build/`.",
    "created_at": "2021-03-09T22:12:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506178",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'>**Comment 2:**</a>
Just be sure to use `build/pkgs/sagelib/src/setup.py`, not `src/setup.py`. This builds in `build/pkgs/sagelib/src/build/`.



---

archive/issue_comments_506179.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nI am working on top of Volker's merging branch to figure issues before they hit me when a beta is released. When the beta, rc or final release arrive I usually have worked out the issues. I have bisected the change of behavior to this ticket. By the sound of it, the change of behavior is accidental and you have no idea or care about it.\n\nOn a side note since you are mentioning it, I am not currently using `build/pkgs/sagelib/src/setup.py`, links to sources have proved troublesome so far. I am hoping to switch to that at some point when some packaging dust settles. But I should point out that it severely hamper my ability to build the documentation in the same package. Which is a point our current philosophy of building sage are getting divergent. But those are discussions we should have in another space than this ticket.",
    "created_at": "2021-03-09T22:30:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506179",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'>**Comment 3:**</a>
I am working on top of Volker's merging branch to figure issues before they hit me when a beta is released. When the beta, rc or final release arrive I usually have worked out the issues. I have bisected the change of behavior to this ticket. By the sound of it, the change of behavior is accidental and you have no idea or care about it.

On a side note since you are mentioning it, I am not currently using `build/pkgs/sagelib/src/setup.py`, links to sources have proved troublesome so far. I am hoping to switch to that at some point when some packaging dust settles. But I should point out that it severely hamper my ability to build the documentation in the same package. Which is a point our current philosophy of building sage are getting divergent. But those are discussions we should have in another space than this ticket.



---

archive/issue_comments_506180.json:
```json
{
    "body": "<a id='comment:124'>**Comment 124:**</a>\nReplying to [@kiwifb](#comment%3A123):\n> By the sound of it, the change of behavior is accidental\n\nNo. Since #30779, the Sage distribution has no longer used `src/setup.py`. It switched to using `build/pkgs/sagelib/src/setup.py`. You should do the same.",
    "created_at": "2021-03-09T22:36:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506180",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:124'>**Comment 124:**</a>
Replying to [@kiwifb](#comment%3A123):
> By the sound of it, the change of behavior is accidental

No. Since #30779, the Sage distribution has no longer used `src/setup.py`. It switched to using `build/pkgs/sagelib/src/setup.py`. You should do the same.



---

archive/issue_comments_506181.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nBy the way, if you want to discuss philosophy of docbuilding, --> #31356, #29868.",
    "created_at": "2021-03-09T22:41:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506181",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'>**Comment 5:**</a>
By the way, if you want to discuss philosophy of docbuilding, --> #31356, #29868.



---

archive/issue_comments_506182.json:
```json
{
    "body": "<a id='comment:126'>**Comment 126:**</a>\nReplying to [@mkoeppe](#comment%3A124):\n> Replying to [@kiwifb](#comment%3A123):\n> > By the sound of it, the change of behavior is accidental\n\n> \n> No. Since #30779, the Sage distribution has no longer used `src/setup.py`. It switched to using `build/pkgs/sagelib/src/setup.py`. You should do the same.\n\nI hadn't realised how much they diverged from each other. It feels like some tickets patch one but not the other and so on. Regardless of my issues and divergence in philosophy, as I called it, if the version in `src/setup.py` shouldn't be used or developed against we need to remove it and quickly.",
    "created_at": "2021-03-09T22:52:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506182",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:126'>**Comment 126:**</a>
Replying to [@mkoeppe](#comment%3A124):
> Replying to [@kiwifb](#comment%3A123):
> > By the sound of it, the change of behavior is accidental

> 
> No. Since #30779, the Sage distribution has no longer used `src/setup.py`. It switched to using `build/pkgs/sagelib/src/setup.py`. You should do the same.

I hadn't realised how much they diverged from each other. It feels like some tickets patch one but not the other and so on. Regardless of my issues and divergence in philosophy, as I called it, if the version in `src/setup.py` shouldn't be used or developed against we need to remove it and quickly.



---

archive/issue_comments_506183.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\nNo, as of this ticket, it's used for `./configure --enable-editable`.",
    "created_at": "2021-03-09T22:58:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506183",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'>**Comment 7:**</a>
No, as of this ticket, it's used for `./configure --enable-editable`.



---

archive/issue_comments_506184.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\nI think I am starting to get the picture. So those large looking differences are on purpose?",
    "created_at": "2021-03-09T23:04:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506184",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'>**Comment 8:**</a>
I think I am starting to get the picture. So those large looking differences are on purpose?



---

archive/issue_comments_506185.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nIt sounds like it would be good to add some explanatory comments at the top of `src/setup.py` (not by me, since I don't understand the situation).",
    "created_at": "2021-03-09T23:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506185",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'>**Comment 9:**</a>
It sounds like it would be good to add some explanatory comments at the top of `src/setup.py` (not by me, since I don't understand the situation).



---

archive/issue_comments_506186.json:
```json
{
    "body": "<a id='comment:130'>**Comment 130:**</a>\nReplying to [@kiwifb](#comment%3A128):\n> So those large looking differences are on purpose?\n\nYes! And yes, we'll have to add some documentation. I'll do this in #31386 (which will reduce the amount of duplication between the two `setup.py` files); this ticket is waiting for another big build system ticket, #30913.",
    "created_at": "2021-03-09T23:42:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31377#issuecomment-506186",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:130'>**Comment 130:**</a>
Replying to [@kiwifb](#comment%3A128):
> So those large looking differences are on purpose?

Yes! And yes, we'll have to add some documentation. I'll do this in #31386 (which will reduce the amount of duplication between the two `setup.py` files); this ticket is waiting for another big build system ticket, #30913.
