# Issue 31365: Add NTL to cython_aliases and sage.misc.cython library search dirs

archive/issues_031128.json:
```json
{
    "body": "(from #31348)\n\n... using `SAGE_NTL_PREFIX` via `sage_conf`.\n\nThis is for macOS with configurations in which Python extensions no longer have access to `/usr/local` due to the use of `-isysroot` in the compiler configuration from sysconfig.\n\nIn particular, we add handling for `ntl` to the `.homebrew-build-env` script -- so that after `brew install ntl; brew unlink ntl`, our `./configure` still finds NTL.\n\n\n\n\n\nCC:  @zlscherr @dimpase @orlitzky @videlec @kliem @jhpalmieri @kiwifb\n\nBranch/Commit: dbcbf792927c4aa92fb2a60c528c830a2920c175\n\nReviewer: Jonathan Kliem\n\nAuthor: Matthias Koeppe\n\nDependencies: #30770, #31344\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31365\n\n",
    "closed_at": "2021-03-09T00:01:40Z",
    "created_at": "2021-02-09T02:54:06Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Add NTL to cython_aliases and sage.misc.cython library search dirs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31365",
    "user": "https://github.com/mkoeppe"
}
```
(from #31348)

... using `SAGE_NTL_PREFIX` via `sage_conf`.

This is for macOS with configurations in which Python extensions no longer have access to `/usr/local` due to the use of `-isysroot` in the compiler configuration from sysconfig.

In particular, we add handling for `ntl` to the `.homebrew-build-env` script -- so that after `brew install ntl; brew unlink ntl`, our `./configure` still finds NTL.





CC:  @zlscherr @dimpase @orlitzky @videlec @kliem @jhpalmieri @kiwifb

Branch/Commit: dbcbf792927c4aa92fb2a60c528c830a2920c175

Reviewer: Jonathan Kliem

Author: Matthias Koeppe

Dependencies: #30770, #31344

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31365





---

archive/issue_comments_474592.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-09T06:22:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474592",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474593.json:
```json
{
    "body": "<a id='comment:6'></a>Actually `spkg-configure.m4` needs some work too - need to use `AX_ABSOLUTE_HEADER` to set `SAGE_NTL_PREFIX`",
    "created_at": "2021-02-09T06:24:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474593",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Actually `spkg-configure.m4` needs some work too - need to use `AX_ABSOLUTE_HEADER` to set `SAGE_NTL_PREFIX`



---

archive/issue_comments_474594.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-11T03:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474594",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474595.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-02-11T04:28:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474595",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_474596.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,6 +1,10 @@\n (from #31348)\n \n ... using `SAGE_NTL_PREFIX` via `sage_conf`.\n+\n+This is for macOS with configurations in which Python extensions no longer have access to `/usr/local` due to the use of `-isysroot` in the compiler configuration from sysconfig.\n+\n+\n \n Comment: 1\n \n```\n",
    "created_at": "2021-02-11T04:28:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474596",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,6 +1,10 @@
 (from #31348)
 
 ... using `SAGE_NTL_PREFIX` via `sage_conf`.
+
+This is for macOS with configurations in which Python extensions no longer have access to `/usr/local` due to the use of `-isysroot` in the compiler configuration from sysconfig.
+
+
 
 Comment: 1
 
```




---

archive/issue_comments_474597.json:
```json
{
    "body": "<a id='comment:9'></a>NTL_INCDIR, NTL_LIBDIR needs more work.\n\n```\nNTL_INCDIR = \".\n.\n///usr/include/NTL\"\n```",
    "created_at": "2021-02-11T06:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474597",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>NTL_INCDIR, NTL_LIBDIR needs more work.

```
NTL_INCDIR = ".
.
///usr/include/NTL"
```



---

archive/issue_comments_474598.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-02-11T06:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474598",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_474599.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-11T07:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474599",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474600.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-02-11T07:27:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474600",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_474601.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-12T00:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474601",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474602.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,13 @@\n+(from #31348)\n+\n+... using `SAGE_NTL_PREFIX` via `sage_conf`.\n+\n+This is for macOS with configurations in which Python extensions no longer have access to `/usr/local` due to the use of `-isysroot` in the compiler configuration from sysconfig.\n+\n+In particular, we add handling for `ntl` to the `.homebrew-build-env` script -- so that after `brew install ntl; brew unlink ntl`, our `./configure` still finds NTL.\n+\n+\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2021-02-12T00:47:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474602",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,13 @@
+(from #31348)
+
+... using `SAGE_NTL_PREFIX` via `sage_conf`.
+
+This is for macOS with configurations in which Python extensions no longer have access to `/usr/local` due to the use of `-isysroot` in the compiler configuration from sysconfig.
+
+In particular, we add handling for `ntl` to the `.homebrew-build-env` script -- so that after `brew install ntl; brew unlink ntl`, our `./configure` still finds NTL.
+
+
+
 
 
 Comment: 1
```




---

archive/issue_comments_474603.json:
```json
{
    "body": "<a id='comment:16'></a>You changed `src/sage/rings/rational.pyx` and `src/sage/matrix/matrix_rational_dense.pyx` to language `c++`. Is there a reason for this?",
    "created_at": "2021-02-16T10:45:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474603",
    "user": "https://github.com/kliem"
}
```

<a id='comment:16'></a>You changed `src/sage/rings/rational.pyx` and `src/sage/matrix/matrix_rational_dense.pyx` to language `c++`. Is there a reason for this?



---

archive/issue_comments_474604.json:
```json
{
    "body": "<a id='comment:17'></a>I'm a bit confused:\n\nIn `src/sage/misc/cython.py` we add `NTL_LIBDIR` to `standard_libdirs` and likewise we add `NTL_INCDIR` to `standard_incdirs`. Why do we need to add this to every file again that uses ntl?",
    "created_at": "2021-02-16T10:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474604",
    "user": "https://github.com/kliem"
}
```

<a id='comment:17'></a>I'm a bit confused:

In `src/sage/misc/cython.py` we add `NTL_LIBDIR` to `standard_libdirs` and likewise we add `NTL_INCDIR` to `standard_incdirs`. Why do we need to add this to every file again that uses ntl?



---

archive/issue_comments_474605.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:16 gh-kliem]:\n> You changed `src/sage/rings/rational.pyx` and `src/sage/matrix/matrix_rational_dense.pyx` to language `c++`. Is there a reason for this?\n\n\nOk, I see:\n\n```\n[sagelib-9.3.beta7] cc1: warning: command line option \u2018-std=c++11\u2019 is valid for C++/ObjC++ but not for C\n[sagelib-9.3.beta7] cc1: warning: command line option \u2018-std=c++11\u2019 is valid for C++/ObjC++ but not for C\n```\n\nWhich raises a bit the question, why its called `NTL_CFLAGS` and not `NTL_CXXFLAGS`.",
    "created_at": "2021-02-16T12:08:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474605",
    "user": "https://github.com/kliem"
}
```

<a id='comment:19'></a>Replying to [comment:16 gh-kliem]:
> You changed `src/sage/rings/rational.pyx` and `src/sage/matrix/matrix_rational_dense.pyx` to language `c++`. Is there a reason for this?


Ok, I see:

```
[sagelib-9.3.beta7] cc1: warning: command line option ‘-std=c++11’ is valid for C++/ObjC++ but not for C
[sagelib-9.3.beta7] cc1: warning: command line option ‘-std=c++11’ is valid for C++/ObjC++ but not for C
```

Which raises a bit the question, why its called `NTL_CFLAGS` and not `NTL_CXXFLAGS`.



---

archive/issue_comments_474606.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:17 gh-kliem]:\n> In `src/sage/misc/cython.py` we add `NTL_LIBDIR` to `standard_libdirs` and likewise we add `NTL_INCDIR` to `standard_incdirs`. Why do we need to add this to every file again that uses ntl?\n\n\n`sage.misc.cython` is only for runtime use of Cython; it is not used by the sagelib build system.",
    "created_at": "2021-02-16T15:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474606",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>Replying to [comment:17 gh-kliem]:
> In `src/sage/misc/cython.py` we add `NTL_LIBDIR` to `standard_libdirs` and likewise we add `NTL_INCDIR` to `standard_incdirs`. Why do we need to add this to every file again that uses ntl?


`sage.misc.cython` is only for runtime use of Cython; it is not used by the sagelib build system.



---

archive/issue_comments_474607.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:19 gh-kliem]:\n> Which raises a bit the question, why its called `NTL_CFLAGS` and not `NTL_CXXFLAGS`.\n\n\nThe names follow the conventions of `pkg-config` - which does not make this distinction.",
    "created_at": "2021-02-16T15:11:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474607",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>Replying to [comment:19 gh-kliem]:
> Which raises a bit the question, why its called `NTL_CFLAGS` and not `NTL_CXXFLAGS`.


The names follow the conventions of `pkg-config` - which does not make this distinction.



---

archive/issue_comments_474608.json:
```json
{
    "body": "<a id='comment:22'></a>Ok. LGTM.",
    "created_at": "2021-02-16T15:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474608",
    "user": "https://github.com/kliem"
}
```

<a id='comment:22'></a>Ok. LGTM.



---

archive/issue_comments_474609.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-16T15:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474609",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_474610.json:
```json
{
    "body": "<a id='comment:23'></a>Thank you!",
    "created_at": "2021-02-16T15:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474610",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>Thank you!



---

archive/issue_events_082174.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-09T00:01:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31365#event-82174"
}
```



---

archive/issue_comments_474611.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-03-09T00:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31365#issuecomment-474611",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
