# Issue 31222: Many integrals fail now using sagemath 9.2 using giac algorithm

archive/issues_030985.json:
```json
{
    "assignees": [],
    "body": "*Edit*: the root cause of the problem described here is very high \nsensitivity of giac to the form of the input to its integrator: e.g.\ndifferent order of terms in a product to be integrated may lead to \nhuge slowdowns/hands,cf Example 8, and Sage does rewriting of terms before passing them to an\nexternal integrator. Namely, if `F` is the original input then giac\ngets `F._giac_init_()`, which is often not exacly `F`, although equavalent to `F`. In this sense, passing a string to giac might be more robust.\n\n---\n\nHello. I am working on a new build and new reports for the independent CAS integration tests [https://www.12000.org/my_notes/CAS_integration_tests/index.htm](https://www.12000.org/my_notes/CAS_integration_tests/index.htm). \n\nNow using sagemath 9.2 on Linux to test thousands of integrals using fricas, maxima and giac among other CAS systems. \n\nI found that hundreds of integrals now fail when using giac version 1.6, which all work on giac itself, and also which all worked using sagemath 8.9 using giac 1.5 which I did last year.\n\nIt fails either by now hanging or not evaluating. The ones that hang in sagemath, complete immediately in giac. \n\nSince there so many integrals that now fail, I will only show few examples below. Hopefully the cause of the failure is the same for all. If not, I can provide more examples.\n\n**Example 1, do not evaluate any more**\n\n```\n>sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.2, Release Date: 2020-10-24                     \u2502\n\u2502 Using Python 3.8.6. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nsage: x,a = var('x a')\nsage: integrate(sin(2*x)/(a^2-4*sin(x)^2)^(1/3),x, algorithm=\"giac\")\nintegrate(sin(2*x)/(a^2 - 4*sin(x)^2)^(1/3), x)\nsage: \n\nUsing giac directly\n\n>giac\n// Using locale /usr/share/locale/\n// en_US.utf8\n// /usr/share/locale/\n// giac\n// UTF-8\n// Maximum number of parallel threads 2\nHelp file /usr/share/giac/doc/en/aide_cas not found\nAdded 26 synonyms\nWelcome to giac readline interface\n(c) 2001,2020 B. Parisse & others\nHomepage http://www-fourier.ujf-grenoble.fr/~parisse/giac.html\nReleased under the GPL license 3.0 or above\nSee http://www.gnu.org for license details\nMay contain BSD licensed software parts (lapack, atlas, tinymt)\n-------------------------------------------------\nPress CTRL and D simultaneously to finish session\nType ?commandname for help\n0>> integrate(sin(2*x)/(a^2-4*sin(x)^2)^(1/3),x)\n-3/4*((a^2-2*(-2*cos(2*x)/2+1))^(1/3))^2/2\n// Time 0.01\n1>> \n\n```\n\n**Example 2. Hangs now in sagemath**\n\n\n```\nsage: x,a,b = var('x a b')\nsage: integrate(x^(5/2)/(b*x+a)^(5/2),x, algorithm=\"giac\")\n\n\nWhile in giac, completes right away\n\n>> integrate(x^(5/2)/(b*x+a)^(5/2),x)\n2*(2*((9*b^4*a*1/36/b^5/a*sqrt(x)*sqrt(x)+60*b^3*a^2*1/36/b^5/a)*sqrt(x)*sqrt(x)+45*b^2*a^3*1/36/b^5/a)*sqrt(x)*sqrt(a+b*x)/(a+b*x)^2+10*a/4/b^3/sqrt(b)*ln(abs(sqrt(a+b*x)-sqrt(b)*sqrt(x))))\n// Time 0.02\n\n\n```\n\n\n**Example 3, hangs**\n\n\n```\n\nintegrate(x^(3/2)/(b*x+a)^(5/2),x, algorithm=\"giac\")\n\nUsing giac directly, it completes right away\n\n14>> integrate(x^(3/2)/(b*x+a)^(5/2),x)\n2*(2*(-12*b^2*a*1/18/b^3/a*sqrt(x)*sqrt(x)-9*b*a^2*1/18/b^3/a)*sqrt(x)*sqrt(a+b*x)/(a+b*x)^2-1/b^2/sqrt(b)*ln(abs(sqrt(a+b*x)-sqrt(b)*sqrt(x))))\n// Time 0.03\n\n```\n\nMost of the ones that fail now looks like due to hang. But also some fail because the integral do not evaluate in sagemath, but it does using giac directly.\n\n**Version information**\n\n\n```\nwhich giac\n/bin/giac\n>\n>\n>giac --version\n// Using locale /usr/share/locale/\n// en_US.utf8\n// /usr/share/locale/\n// giac\n// UTF-8\n// Maximum number of parallel threads 2\n// (c) 2001, 2018 B. Parisse & others\n1.6.0\n>\n>\n\n\n>which sage\n/bin/sage\n>sage --version\nSageMath version 9.2, Release Date: 2020-10-24\n>\n\nLinux Manjaro running inside Oracle Virtual Box\n\n>uname -r\n5.4.80-2-MANJARO\n>uname -a\nLinux me-virtualbox 5.4.80-2-MANJARO #1 SMP PREEMPT Sat Nov 28 09:58:18 UTC 2020 x86_64 GNU/Linux\n>\n\n>lsb_release -a\nLSB Version:\tn/a\nDistributor ID:\tManjaroLinux\nDescription:\tManjaro Linux\nRelease:\t20.2\nCodename:\tNibia\n\n\n\n```\n\nBecause of this, I stopped the tests. And will wait for next version of sagemath, hopefully it have a fix for this, as giac result are now looking not good due to this.\n\nPlease feel free to add any fields for the ticket if needed. I filled the ones I know about. \n\nThank you,\n--Nasser\n\n**Adding more examples**\n\n\n**EXAMPLE 4 (hangs in sagemath)**\n\n\n```\n>giac\n// Using locale /usr/share/locale/\n// en_US.utf8\n// /usr/share/locale/\n// giac\n// UTF-8\n// Maximum number of parallel threads 2\nHelp file /usr/share/giac/doc/en/aide_cas not found\nAdded 26 synonyms\nWelcome to giac readline interface\n(c) 2001,2020 B. Parisse & others\nHomepage http://www-fourier.ujf-grenoble.fr/~parisse/giac.html\nReleased under the GPL license 3.0 or above\nSee http://www.gnu.org for license details\nMay contain BSD licensed software parts (lapack, atlas, tinymt)\n-------------------------------------------------\nPress CTRL and D simultaneously to finish session\nType ?commandname for help\n0>> integrate(x*(b*x^2+a)*(B*x^2+A),x)\n1/2*(1/3*x^6*b*B+1/2*x^4*b*A+1/2*x^4*a*B+x^2*a*A)\n// Time 0\n\n\n>sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.2, Release Date: 2020-10-24                     \u2502\n\u2502 Using Python 3.8.6. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nsage: x,a,b,B,A = var('x a b B A')\nsage: integrate(x*(b*x^2+a)*(B*x^2+A),x, algorithm=\"giac\")\n\n\n```\n\n\n**EXAMPLE 5 (hangs in sagemath)**\n\n\n```\nGIAC:\n\n3>> integrate(x^m*(b*x^2+a)^3*(B*x^2+A),x)\n(A*a^3*m^4*x*exp(m*ln(x))+24*A*a^3*m^3*x*exp(m*ln(x))+206*A*a^3*m^2*x*exp(m*ln(x))+744*A*a^3*m*x*exp(m*ln(x))+945*A*a^3*x*exp(m*ln(x))+3*A*a^2*b*m^4*x^3*exp(m*ln(x))+66*A*a^2*b*m^3*x^3*exp(m*ln(x))+492*A*a^2*b*m^2*x^3*exp(m*ln(x))+1374*A*a^2*b*m*x^3*exp(m*ln(x))+945*A*a^2*b*x^3*exp(m*ln(x))+3*A*a*b^2*m^4*x^5*exp(m*ln(x))+60*A*a*b^2*m^3*x^5*exp(m*ln(x))+390*A*a*b^2*m^2*x^5*exp(m*ln(x))+900*A*a*b^2*m*x^5*exp(m*ln(x))+567*A*a*b^2*x^5*exp(m*ln(x))+A*b^3*m^4*x^7*exp(m*ln(x))+18*A*b^3*m^3*x^7*exp(m*ln(x))+104*A*b^3*m^2*x^7*exp(m*ln(x))+222*A*b^3*m*x^7*exp(m*ln(x))+135*A*b^3*x^7*exp(m*ln(x))+B*a^3*m^4*x^3*exp(m*ln(x))+22*B*a^3*m^3*x^3*exp(m*ln(x))+164*B*a^3*m^2*x^3*exp(m*ln(x))+458*B*a^3*m*x^3*exp(m*ln(x))+315*B*a^3*x^3*exp(m*ln(x))+3*B*a^2*b*m^4*x^5*exp(m*ln(x))+60*B*a^2*b*m^3*x^5*exp(m*ln(x))+390*B*a^2*b*m^2*x^5*exp(m*ln(x))+900*B*a^2*b*m*x^5*exp(m*ln(x))+567*B*a^2*b*x^5*exp(m*ln(x))+3*B*a*b^2*m^4*x^7*exp(m*ln(x))+54*B*a*b^2*m^3*x^7*exp(m*ln(x))+312*B*a*b^2*m^2*x^7*exp(m*ln(x))+666*B*a*b^2*m*x^7*exp(m*ln(x))+405*B*a*b^2*x^7*exp(m*ln(x))+B*b^3*m^4*x^9*exp(m*ln(x))+16*B*b^3*m^3*x^9*exp(m*ln(x))+86*B*b^3*m^2*x^9*exp(m*ln(x))+176*B*b^3*m*x^9*exp(m*ln(x))+105*B*b^3*x^9*exp(m*ln(x)))/(m^5+25*m^4+230*m^3+950*m^2+1689*m+945)\n// Time 0.01\n4>> \n\n\nSAGEMATH:\n\nsage: x,a,b,B,A,m = var('x a b B A m')\nsage: integrate(x^m*(b*x^2+a)^3*(B*x^2+A),x, algorithm=\"giac\")\n\n\n```\n\n\n**EXAMPLE 6 (hangs in sagemath)**\n\n\n```\nGIAC:\n\n4>> integrate(x^4*log(d*(c*x^2+b*x+a)^n),x)\n(-2/25*n+1/5*ln(d))*x^5+b*n/(20*c)*x^4+(2*a*c*n-b^2*n)/(15*c^2)*x^3+(-3*a*b*c*n+b^3*n)/(10*c^3)*x^2+(-2*a^2*c^2*n+4*a*b^2*c*n-b^4*n)/(5*c^4)*x+1/5*n*x^5*ln(a+b*x+c*x^2)+integrate((x*n*b^5-5*x*n*b^3*c*a+5*x*n*b*c^2*a^2+n*b^4*a-4*n*b^2*c*a^2+2*n*c^2*a^3)/(5*x^2*c^5+5*x*b*c^4+5*c^4*a),x)\n// Time 0.01\n5>> \n\nSAGEMATH:\n\nsage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')\nsage: integrate(x^4*log(d*(c*x^2+b*x+a)^n),x, algorithm=\"giac\")\n\n\n```\n\n**EXAMPLE 7 (hangs in sagemath)**\n\n\n```\n\n5>> integrate(x^3*log(d*(c*x^2+b*x+a)^n),x)\n(-1/8*n+1/4*ln(d))*x^4+b*n/(12*c)*x^3+(2*a*c*n-b^2*n)/(8*c^2)*x^2+(-3*a*b*c*n+b^3*n)/(4*c^3)*x+1/4*n*x^4*ln(a+b*x+c*x^2)+integrate((-x*n*b^4+4*x*n*b^2*c*a-2*x*n*c^2*a^2-n*b^3*a+3*n*b*c*a^2)/(4*x^2*c^4+4*x*b*c^3+4*c^3*a),x)\n// Time 0.02\n\nsage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')\nsage: integrate(x^3*log(d*(c*x^2+b*x+a)^n),x, algorithm=\"giac\")\n\n\n```\n\n\n**EXAMPLE 8 (hangs in sagemath)**\n\n\n```\n\n0>> integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3,x)\nDone\n// Time 0.01\n\nsage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')\nsage: integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3,x, algorithm=\"giac\")\n\n\n```\n\n**EXAMPLE 9 (hangs in sagemath)**\n\n```\n\n1>> integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c),x)\n(-x^5*d*b^9-4*x^4*a*d*b^8-x^4*c*b^9-5*x^4*d*b^8-6*x^3*a^2*d*b^7-4*x^3*a*c*b^8-16*x^3*a*d*b^7-4*x^3*c*b^8-20*x^3*d*b^7-4*x^2*a^3*d*b^6-6*x^2*a^2*c*b^7-18*x^2*a^2*d*b^6-12*x^2*a*c*b^7-48*x^2*a*d*b^6-12*x^2*c*b^7-60*x^2*d*b^6-x*a^4*d*b^5-4*x*a^3*c*b^6-8*x*a^3*d*b^5-12*x*a^2*c*b^6-36*x*a^2*d*b^5-24*x*a*c*b^6-96*x*a*d*b^5-24*x*c*b^6-120*x*d*b^5-a^4*c*b^5-a^4*d*b^4-4*a^3*c*b^5-8*a^3*d*b^4-12*a^2*c*b^5-36*a^2*d*b^4-24*a*c*b^5-96*a*d*b^4-24*c*b^5-120*d*b^4)/b^6*exp(-(a+b*x))\n// Time 0\n\nsage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')\nsage: integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c),x, algorithm=\"giac\")\n\n\n```\n\n\n\n\n\nCC:  @fchapoton @EmmanuelCharpentier @frederichan-IMJPRG @mwageringel @nasser1 @slel\n\nKeywords: **integrate, giac, interface**\n\nUpstream: **Reported upstream. Developers acknowledge bug.**\n\nComponent: **symbolics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31222_\n\n",
    "created_at": "2021-01-10T19:26:52Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Many integrals fail now using sagemath 9.2 using giac algorithm",
    "type": "issue",
    "updated_at": "2023-01-08T10:43:00Z",
    "url": "https://github.com/sagemath/sage/issues/31222",
    "user": "https://github.com/nasser1"
}
```
*Edit*: the root cause of the problem described here is very high 
sensitivity of giac to the form of the input to its integrator: e.g.
different order of terms in a product to be integrated may lead to 
huge slowdowns/hands,cf Example 8, and Sage does rewriting of terms before passing them to an
external integrator. Namely, if `F` is the original input then giac
gets `F._giac_init_()`, which is often not exacly `F`, although equavalent to `F`. In this sense, passing a string to giac might be more robust.

---

Hello. I am working on a new build and new reports for the independent CAS integration tests [https://www.12000.org/my_notes/CAS_integration_tests/index.htm](https://www.12000.org/my_notes/CAS_integration_tests/index.htm). 

Now using sagemath 9.2 on Linux to test thousands of integrals using fricas, maxima and giac among other CAS systems. 

I found that hundreds of integrals now fail when using giac version 1.6, which all work on giac itself, and also which all worked using sagemath 8.9 using giac 1.5 which I did last year.

It fails either by now hanging or not evaluating. The ones that hang in sagemath, complete immediately in giac. 

Since there so many integrals that now fail, I will only show few examples below. Hopefully the cause of the failure is the same for all. If not, I can provide more examples.

**Example 1, do not evaluate any more**

```
>sage
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.2, Release Date: 2020-10-24                     │
│ Using Python 3.8.6. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
sage: x,a = var('x a')
sage: integrate(sin(2*x)/(a^2-4*sin(x)^2)^(1/3),x, algorithm="giac")
integrate(sin(2*x)/(a^2 - 4*sin(x)^2)^(1/3), x)
sage: 

Using giac directly

>giac
// Using locale /usr/share/locale/
// en_US.utf8
// /usr/share/locale/
// giac
// UTF-8
// Maximum number of parallel threads 2
Help file /usr/share/giac/doc/en/aide_cas not found
Added 26 synonyms
Welcome to giac readline interface
(c) 2001,2020 B. Parisse & others
Homepage http://www-fourier.ujf-grenoble.fr/~parisse/giac.html
Released under the GPL license 3.0 or above
See http://www.gnu.org for license details
May contain BSD licensed software parts (lapack, atlas, tinymt)
-------------------------------------------------
Press CTRL and D simultaneously to finish session
Type ?commandname for help
0>> integrate(sin(2*x)/(a^2-4*sin(x)^2)^(1/3),x)
-3/4*((a^2-2*(-2*cos(2*x)/2+1))^(1/3))^2/2
// Time 0.01
1>> 

```

**Example 2. Hangs now in sagemath**


```
sage: x,a,b = var('x a b')
sage: integrate(x^(5/2)/(b*x+a)^(5/2),x, algorithm="giac")


While in giac, completes right away

>> integrate(x^(5/2)/(b*x+a)^(5/2),x)
2*(2*((9*b^4*a*1/36/b^5/a*sqrt(x)*sqrt(x)+60*b^3*a^2*1/36/b^5/a)*sqrt(x)*sqrt(x)+45*b^2*a^3*1/36/b^5/a)*sqrt(x)*sqrt(a+b*x)/(a+b*x)^2+10*a/4/b^3/sqrt(b)*ln(abs(sqrt(a+b*x)-sqrt(b)*sqrt(x))))
// Time 0.02


```


**Example 3, hangs**


```

integrate(x^(3/2)/(b*x+a)^(5/2),x, algorithm="giac")

Using giac directly, it completes right away

14>> integrate(x^(3/2)/(b*x+a)^(5/2),x)
2*(2*(-12*b^2*a*1/18/b^3/a*sqrt(x)*sqrt(x)-9*b*a^2*1/18/b^3/a)*sqrt(x)*sqrt(a+b*x)/(a+b*x)^2-1/b^2/sqrt(b)*ln(abs(sqrt(a+b*x)-sqrt(b)*sqrt(x))))
// Time 0.03

```

Most of the ones that fail now looks like due to hang. But also some fail because the integral do not evaluate in sagemath, but it does using giac directly.

**Version information**


```
which giac
/bin/giac
>
>
>giac --version
// Using locale /usr/share/locale/
// en_US.utf8
// /usr/share/locale/
// giac
// UTF-8
// Maximum number of parallel threads 2
// (c) 2001, 2018 B. Parisse & others
1.6.0
>
>


>which sage
/bin/sage
>sage --version
SageMath version 9.2, Release Date: 2020-10-24
>

Linux Manjaro running inside Oracle Virtual Box

>uname -r
5.4.80-2-MANJARO
>uname -a
Linux me-virtualbox 5.4.80-2-MANJARO #1 SMP PREEMPT Sat Nov 28 09:58:18 UTC 2020 x86_64 GNU/Linux
>

>lsb_release -a
LSB Version:	n/a
Distributor ID:	ManjaroLinux
Description:	Manjaro Linux
Release:	20.2
Codename:	Nibia



```

Because of this, I stopped the tests. And will wait for next version of sagemath, hopefully it have a fix for this, as giac result are now looking not good due to this.

Please feel free to add any fields for the ticket if needed. I filled the ones I know about. 

Thank you,
--Nasser

**Adding more examples**


**EXAMPLE 4 (hangs in sagemath)**


```
>giac
// Using locale /usr/share/locale/
// en_US.utf8
// /usr/share/locale/
// giac
// UTF-8
// Maximum number of parallel threads 2
Help file /usr/share/giac/doc/en/aide_cas not found
Added 26 synonyms
Welcome to giac readline interface
(c) 2001,2020 B. Parisse & others
Homepage http://www-fourier.ujf-grenoble.fr/~parisse/giac.html
Released under the GPL license 3.0 or above
See http://www.gnu.org for license details
May contain BSD licensed software parts (lapack, atlas, tinymt)
-------------------------------------------------
Press CTRL and D simultaneously to finish session
Type ?commandname for help
0>> integrate(x*(b*x^2+a)*(B*x^2+A),x)
1/2*(1/3*x^6*b*B+1/2*x^4*b*A+1/2*x^4*a*B+x^2*a*A)
// Time 0


>sage
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.2, Release Date: 2020-10-24                     │
│ Using Python 3.8.6. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
sage: x,a,b,B,A = var('x a b B A')
sage: integrate(x*(b*x^2+a)*(B*x^2+A),x, algorithm="giac")


```


**EXAMPLE 5 (hangs in sagemath)**


```
GIAC:

3>> integrate(x^m*(b*x^2+a)^3*(B*x^2+A),x)
(A*a^3*m^4*x*exp(m*ln(x))+24*A*a^3*m^3*x*exp(m*ln(x))+206*A*a^3*m^2*x*exp(m*ln(x))+744*A*a^3*m*x*exp(m*ln(x))+945*A*a^3*x*exp(m*ln(x))+3*A*a^2*b*m^4*x^3*exp(m*ln(x))+66*A*a^2*b*m^3*x^3*exp(m*ln(x))+492*A*a^2*b*m^2*x^3*exp(m*ln(x))+1374*A*a^2*b*m*x^3*exp(m*ln(x))+945*A*a^2*b*x^3*exp(m*ln(x))+3*A*a*b^2*m^4*x^5*exp(m*ln(x))+60*A*a*b^2*m^3*x^5*exp(m*ln(x))+390*A*a*b^2*m^2*x^5*exp(m*ln(x))+900*A*a*b^2*m*x^5*exp(m*ln(x))+567*A*a*b^2*x^5*exp(m*ln(x))+A*b^3*m^4*x^7*exp(m*ln(x))+18*A*b^3*m^3*x^7*exp(m*ln(x))+104*A*b^3*m^2*x^7*exp(m*ln(x))+222*A*b^3*m*x^7*exp(m*ln(x))+135*A*b^3*x^7*exp(m*ln(x))+B*a^3*m^4*x^3*exp(m*ln(x))+22*B*a^3*m^3*x^3*exp(m*ln(x))+164*B*a^3*m^2*x^3*exp(m*ln(x))+458*B*a^3*m*x^3*exp(m*ln(x))+315*B*a^3*x^3*exp(m*ln(x))+3*B*a^2*b*m^4*x^5*exp(m*ln(x))+60*B*a^2*b*m^3*x^5*exp(m*ln(x))+390*B*a^2*b*m^2*x^5*exp(m*ln(x))+900*B*a^2*b*m*x^5*exp(m*ln(x))+567*B*a^2*b*x^5*exp(m*ln(x))+3*B*a*b^2*m^4*x^7*exp(m*ln(x))+54*B*a*b^2*m^3*x^7*exp(m*ln(x))+312*B*a*b^2*m^2*x^7*exp(m*ln(x))+666*B*a*b^2*m*x^7*exp(m*ln(x))+405*B*a*b^2*x^7*exp(m*ln(x))+B*b^3*m^4*x^9*exp(m*ln(x))+16*B*b^3*m^3*x^9*exp(m*ln(x))+86*B*b^3*m^2*x^9*exp(m*ln(x))+176*B*b^3*m*x^9*exp(m*ln(x))+105*B*b^3*x^9*exp(m*ln(x)))/(m^5+25*m^4+230*m^3+950*m^2+1689*m+945)
// Time 0.01
4>> 


SAGEMATH:

sage: x,a,b,B,A,m = var('x a b B A m')
sage: integrate(x^m*(b*x^2+a)^3*(B*x^2+A),x, algorithm="giac")


```


**EXAMPLE 6 (hangs in sagemath)**


```
GIAC:

4>> integrate(x^4*log(d*(c*x^2+b*x+a)^n),x)
(-2/25*n+1/5*ln(d))*x^5+b*n/(20*c)*x^4+(2*a*c*n-b^2*n)/(15*c^2)*x^3+(-3*a*b*c*n+b^3*n)/(10*c^3)*x^2+(-2*a^2*c^2*n+4*a*b^2*c*n-b^4*n)/(5*c^4)*x+1/5*n*x^5*ln(a+b*x+c*x^2)+integrate((x*n*b^5-5*x*n*b^3*c*a+5*x*n*b*c^2*a^2+n*b^4*a-4*n*b^2*c*a^2+2*n*c^2*a^3)/(5*x^2*c^5+5*x*b*c^4+5*c^4*a),x)
// Time 0.01
5>> 

SAGEMATH:

sage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')
sage: integrate(x^4*log(d*(c*x^2+b*x+a)^n),x, algorithm="giac")


```

**EXAMPLE 7 (hangs in sagemath)**


```

5>> integrate(x^3*log(d*(c*x^2+b*x+a)^n),x)
(-1/8*n+1/4*ln(d))*x^4+b*n/(12*c)*x^3+(2*a*c*n-b^2*n)/(8*c^2)*x^2+(-3*a*b*c*n+b^3*n)/(4*c^3)*x+1/4*n*x^4*ln(a+b*x+c*x^2)+integrate((-x*n*b^4+4*x*n*b^2*c*a-2*x*n*c^2*a^2-n*b^3*a+3*n*b*c*a^2)/(4*x^2*c^4+4*x*b*c^3+4*c^3*a),x)
// Time 0.02

sage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')
sage: integrate(x^3*log(d*(c*x^2+b*x+a)^n),x, algorithm="giac")


```


**EXAMPLE 8 (hangs in sagemath)**


```

0>> integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3,x)
Done
// Time 0.01

sage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')
sage: integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3,x, algorithm="giac")


```

**EXAMPLE 9 (hangs in sagemath)**

```

1>> integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c),x)
(-x^5*d*b^9-4*x^4*a*d*b^8-x^4*c*b^9-5*x^4*d*b^8-6*x^3*a^2*d*b^7-4*x^3*a*c*b^8-16*x^3*a*d*b^7-4*x^3*c*b^8-20*x^3*d*b^7-4*x^2*a^3*d*b^6-6*x^2*a^2*c*b^7-18*x^2*a^2*d*b^6-12*x^2*a*c*b^7-48*x^2*a*d*b^6-12*x^2*c*b^7-60*x^2*d*b^6-x*a^4*d*b^5-4*x*a^3*c*b^6-8*x*a^3*d*b^5-12*x*a^2*c*b^6-36*x*a^2*d*b^5-24*x*a*c*b^6-96*x*a*d*b^5-24*x*c*b^6-120*x*d*b^5-a^4*c*b^5-a^4*d*b^4-4*a^3*c*b^5-8*a^3*d*b^4-12*a^2*c*b^5-36*a^2*d*b^4-24*a*c*b^5-96*a*d*b^4-24*c*b^5-120*d*b^4)/b^6*exp(-(a+b*x))
// Time 0

sage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')
sage: integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c),x, algorithm="giac")


```





CC:  @fchapoton @EmmanuelCharpentier @frederichan-IMJPRG @mwageringel @nasser1 @slel

Keywords: **integrate, giac, interface**

Upstream: **Reported upstream. Developers acknowledge bug.**

Component: **symbolics**

_Issue created by migration from https://trac.sagemath.org/ticket/31222_





---

archive/issue_events_430315.json:
```json
{
    "actor": "https://github.com/nasser1",
    "created_at": "2021-01-10T19:26:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31222#event-430315"
}
```



---

archive/issue_events_430316.json:
```json
{
    "actor": "https://github.com/nasser1",
    "created_at": "2021-01-10T19:26:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31222#event-430316"
}
```



---

archive/issue_events_430317.json:
```json
{
    "actor": "https://github.com/nasser1",
    "created_at": "2021-01-10T19:26:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31222#event-430317"
}
```



---

archive/issue_comments_500292.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n-Hello. I am woking on a new build and new reports for CAS integration tests [https://www.12000.org/my_notes/CAS_integration_tests/index.htm](https://www.12000.org/my_notes/CAS_integration_tests/index.htm). \n+Hello. I am working on a new build and new reports for the independent CAS integration tests [https://www.12000.org/my_notes/CAS_integration_tests/index.htm](https://www.12000.org/my_notes/CAS_integration_tests/index.htm). \n \n-Now using sagemath 9.2 on Linux to test thousands of integrals using fricas, maxima and giac among other CAS systems.\n+Now using sagemath 9.2 on Linux to test thousands of integrals using fricas, maxima and giac among other CAS systems. \n \n I found that hundreds of integrals now fail when using giac version 1.6, which all work on giac itself, and also which all worked using sagemath 8.9 using giac 1.5 which I did last year.\n \n``````\n",
    "created_at": "2021-01-10T19:29:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500292",
    "user": "https://github.com/nasser1"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
-Hello. I am woking on a new build and new reports for CAS integration tests [https://www.12000.org/my_notes/CAS_integration_tests/index.htm](https://www.12000.org/my_notes/CAS_integration_tests/index.htm). 
+Hello. I am working on a new build and new reports for the independent CAS integration tests [https://www.12000.org/my_notes/CAS_integration_tests/index.htm](https://www.12000.org/my_notes/CAS_integration_tests/index.htm). 
 
-Now using sagemath 9.2 on Linux to test thousands of integrals using fricas, maxima and giac among other CAS systems.
+Now using sagemath 9.2 on Linux to test thousands of integrals using fricas, maxima and giac among other CAS systems. 
 
 I found that hundreds of integrals now fail when using giac version 1.6, which all work on giac itself, and also which all worked using sagemath 8.9 using giac 1.5 which I did last year.
 
``````




---

archive/issue_events_430318.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-01-10T22:00:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31222#event-430318"
}
```



---

archive/issue_comments_500293.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\neverything works in the current beta. I guess your Sage install is broken.\n\n```\n\u2502 SageMath version 9.3.beta5, Release Date: 2020-12-27               \u2502\n\u2502 Using Python 3.7.7. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: sage: x,a = var('x a')                                                                                                                                                                                                                                            \nsage: sage: integrate(sin(2*x)/(a^2-4*sin(x)^2)^(1/3),x, algorithm=\"giac\")                                                                                                                                                                                              \n-3/8*(a^2 - 16*tan(1/2*x)^2/(tan(1/2*x)^2 + 1)^2)^(2/3)\nsage:             \n```",
    "created_at": "2021-01-11T09:50:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500293",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3" align="right">comment:3</div>

everything works in the current beta. I guess your Sage install is broken.

```
│ SageMath version 9.3.beta5, Release Date: 2020-12-27               │
│ Using Python 3.7.7. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: sage: x,a = var('x a')                                                                                                                                                                                                                                            
sage: sage: integrate(sin(2*x)/(a^2-4*sin(x)^2)^(1/3),x, algorithm="giac")                                                                                                                                                                                              
-3/8*(a^2 - 16*tan(1/2*x)^2/(tan(1/2*x)^2 + 1)^2)^(2/3)
sage:             
```



---

archive/issue_comments_500294.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nIt looks like this is about Sage 9.2 installed, as a system package, on a particular Linux, what is Linux in question?",
    "created_at": "2021-01-11T10:13:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500294",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">comment:4</div>

It looks like this is about Sage 9.2 installed, as a system package, on a particular Linux, what is Linux in question?



---

archive/issue_comments_500295.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nversion information for linux\n\n\n```\n>uname -a\nLinux me-virtualbox 5.4.80-2-MANJARO #1 SMP PREEMPT Sat Nov 28 09:58:18 UTC 2020 x86_64 GNU/Linux\n>uname -r\n5.4.80-2-MANJARO\n\n```\n\nI installed 9.2 via Linux package manager and all was installed correctly. sagemath works fine.",
    "created_at": "2021-01-11T10:18:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500295",
    "user": "https://github.com/nasser1"
}
```

<div id="comment:5" align="right">comment:5</div>

version information for linux


```
>uname -a
Linux me-virtualbox 5.4.80-2-MANJARO #1 SMP PREEMPT Sat Nov 28 09:58:18 UTC 2020 x86_64 GNU/Linux
>uname -r
5.4.80-2-MANJARO

```

I installed 9.2 via Linux package manager and all was installed correctly. sagemath works fine.



---

archive/issue_comments_500296.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nyour report indicates that Sage's interface with giac is broken in your installation.",
    "created_at": "2021-01-11T10:36:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500296",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

your report indicates that Sage's interface with giac is broken in your installation.



---

archive/issue_comments_500297.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\n@dimpase could you please try the other examples ? On my computer (Sage `9.3.beta5`, compiled by myself, Debian buster), the first example works, but not the other ones.",
    "created_at": "2021-01-11T17:36:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500297",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:7" align="right">comment:7</div>

@dimpase could you please try the other examples ? On my computer (Sage `9.3.beta5`, compiled by myself, Debian buster), the first example works, but not the other ones.



---

archive/issue_comments_500298.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\n@nasser1 if you have interesting examples, you should add them as doctests within Sage so that we could see regressions immediately.",
    "created_at": "2021-01-11T17:37:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500298",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:8" align="right">comment:8</div>

@nasser1 if you have interesting examples, you should add them as doctests within Sage so that we could see regressions immediately.



---

archive/issue_comments_500299.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThe second example seems to hand in giac 1.5 itself. Maybe giac 1.6 makes a difference.",
    "created_at": "2021-01-11T18:26:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500299",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:9" align="right">comment:9</div>

The second example seems to hand in giac 1.5 itself. Maybe giac 1.6 makes a difference.



---

archive/issue_comments_500300.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nFWIW: My experience matches that of tmonteil in [comment:7](#comment:7). This is with 9.3.beta5 on MacOS 10.15.7. \n\n(The result for the 1st integral is the same as reported by dimpase in [comment:3](#comment:3). It looks different from what is reported in the ticket description, but I believe the two expressions are equal, so that is not a problem.)",
    "created_at": "2021-01-11T18:40:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500300",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:10" align="right">comment:10</div>

FWIW: My experience matches that of tmonteil in [comment:7](#comment:7). This is with 9.3.beta5 on MacOS 10.15.7. 

(The result for the 1st integral is the same as reported by dimpase in [comment:3](#comment:3). It looks different from what is reported in the ticket description, but I believe the two expressions are equal, so that is not a problem.)



---

archive/issue_comments_500301.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\n@nasser1: Thanks for reporting this problem. It seems to be serious, but I hope it will have an easy solution.\n\nIt seems that you have translated the rubi tests to sagemath format. If so, would you be willing to share the zip file, perhaps as an attachment to this ticket?",
    "created_at": "2021-01-11T19:11:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500301",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:11" align="right">comment:11</div>

@nasser1: Thanks for reporting this problem. It seems to be serious, but I hope it will have an easy solution.

It seems that you have translated the rubi tests to sagemath format. If so, would you be willing to share the zip file, perhaps as an attachment to this ticket?



---

archive/issue_comments_500302.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -110,11 +110,21 @@\n SageMath version 9.2, Release Date: 2020-10-24\n >\n \n->which sage\n-/bin/sage\n->sage --version\n-SageMath version 9.2, Release Date: 2020-10-24\n->\n+Linux Manjaro running inside Oracle Virtual Box\n+\n+>uname -r\n+5.4.80-2-MANJARO\n+>uname -a\n+Linux me-virtualbox 5.4.80-2-MANJARO #1 SMP PREEMPT Sat Nov 28 09:58:18 UTC 2020 x86_64 GNU/Linux\n+>\n+\n+>lsb_release -a\n+LSB Version:\tn/a\n+Distributor ID:\tManjaroLinux\n+Description:\tManjaro Linux\n+Release:\t20.2\n+Codename:\tNibia\n+\n \n \n ```\n@@ -126,3 +136,133 @@\n Thank you,\n --Nasser\n \n+**Adding more examples**\n+\n+\n+**EXAMPLE 4 (hangs in sagemath)**\n+\n+\n+```\n+>giac\n+// Using locale /usr/share/locale/\n+// en_US.utf8\n+// /usr/share/locale/\n+// giac\n+// UTF-8\n+// Maximum number of parallel threads 2\n+Help file /usr/share/giac/doc/en/aide_cas not found\n+Added 26 synonyms\n+Welcome to giac readline interface\n+(c) 2001,2020 B. Parisse & others\n+Homepage http://www-fourier.ujf-grenoble.fr/~parisse/giac.html\n+Released under the GPL license 3.0 or above\n+See http://www.gnu.org for license details\n+May contain BSD licensed software parts (lapack, atlas, tinymt)\n+-------------------------------------------------\n+Press CTRL and D simultaneously to finish session\n+Type ?commandname for help\n+0>> integrate(x*(b*x^2+a)*(B*x^2+A),x)\n+1/2*(1/3*x^6*b*B+1/2*x^4*b*A+1/2*x^4*a*B+x^2*a*A)\n+// Time 0\n+\n+\n+>sage\n+\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n+\u2502 SageMath version 9.2, Release Date: 2020-10-24                     \u2502\n+\u2502 Using Python 3.8.6. Type \"help()\" for help.                        \u2502\n+\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n+sage: x,a,b,B,A = var('x a b B A')\n+sage: integrate(x*(b*x^2+a)*(B*x^2+A),x, algorithm=\"giac\")\n+\n+\n+```\n+\n+\n+**EXAMPLE 5 (hangs in sagemath)**\n+\n+\n+```\n+GIAC:\n+\n+3>> integrate(x^m*(b*x^2+a)^3*(B*x^2+A),x)\n+(A*a^3*m^4*x*exp(m*ln(x))+24*A*a^3*m^3*x*exp(m*ln(x))+206*A*a^3*m^2*x*exp(m*ln(x))+744*A*a^3*m*x*exp(m*ln(x))+945*A*a^3*x*exp(m*ln(x))+3*A*a^2*b*m^4*x^3*exp(m*ln(x))+66*A*a^2*b*m^3*x^3*exp(m*ln(x))+492*A*a^2*b*m^2*x^3*exp(m*ln(x))+1374*A*a^2*b*m*x^3*exp(m*ln(x))+945*A*a^2*b*x^3*exp(m*ln(x))+3*A*a*b^2*m^4*x^5*exp(m*ln(x))+60*A*a*b^2*m^3*x^5*exp(m*ln(x))+390*A*a*b^2*m^2*x^5*exp(m*ln(x))+900*A*a*b^2*m*x^5*exp(m*ln(x))+567*A*a*b^2*x^5*exp(m*ln(x))+A*b^3*m^4*x^7*exp(m*ln(x))+18*A*b^3*m^3*x^7*exp(m*ln(x))+104*A*b^3*m^2*x^7*exp(m*ln(x))+222*A*b^3*m*x^7*exp(m*ln(x))+135*A*b^3*x^7*exp(m*ln(x))+B*a^3*m^4*x^3*exp(m*ln(x))+22*B*a^3*m^3*x^3*exp(m*ln(x))+164*B*a^3*m^2*x^3*exp(m*ln(x))+458*B*a^3*m*x^3*exp(m*ln(x))+315*B*a^3*x^3*exp(m*ln(x))+3*B*a^2*b*m^4*x^5*exp(m*ln(x))+60*B*a^2*b*m^3*x^5*exp(m*ln(x))+390*B*a^2*b*m^2*x^5*exp(m*ln(x))+900*B*a^2*b*m*x^5*exp(m*ln(x))+567*B*a^2*b*x^5*exp(m*ln(x))+3*B*a*b^2*m^4*x^7*exp(m*ln(x))+54*B*a*b^2*m^3*x^7*exp(m*ln(x))+312*B*a*b^2*m^2*x^7*exp(m*ln(x))+666*B*a*b^2*m*x^7*exp(m*ln(x))+405*B*a*b^2*x^7*exp(m*ln(x))+B*b^3*m^4*x^9*exp(m*ln(x))+16*B*b^3*m^3*x^9*exp(m*ln(x))+86*B*b^3*m^2*x^9*exp(m*ln(x))+176*B*b^3*m*x^9*exp(m*ln(x))+105*B*b^3*x^9*exp(m*ln(x)))/(m^5+25*m^4+230*m^3+950*m^2+1689*m+945)\n+// Time 0.01\n+4>> \n+\n+\n+SAGEMATH:\n+\n+sage: x,a,b,B,A,m = var('x a b B A m')\n+sage: integrate(x^m*(b*x^2+a)^3*(B*x^2+A),x, algorithm=\"giac\")\n+\n+\n+```\n+\n+\n+**EXAMPLE 6 (hangs in sagemath)**\n+\n+\n+```\n+GIAC:\n+\n+4>> integrate(x^4*log(d*(c*x^2+b*x+a)^n),x)\n+(-2/25*n+1/5*ln(d))*x^5+b*n/(20*c)*x^4+(2*a*c*n-b^2*n)/(15*c^2)*x^3+(-3*a*b*c*n+b^3*n)/(10*c^3)*x^2+(-2*a^2*c^2*n+4*a*b^2*c*n-b^4*n)/(5*c^4)*x+1/5*n*x^5*ln(a+b*x+c*x^2)+integrate((x*n*b^5-5*x*n*b^3*c*a+5*x*n*b*c^2*a^2+n*b^4*a-4*n*b^2*c*a^2+2*n*c^2*a^3)/(5*x^2*c^5+5*x*b*c^4+5*c^4*a),x)\n+// Time 0.01\n+5>> \n+\n+SAGEMATH:\n+\n+sage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')\n+sage: integrate(x^4*log(d*(c*x^2+b*x+a)^n),x, algorithm=\"giac\")\n+\n+\n+```\n+\n+**EXAMPLE 7 (hangs in sagemath)**\n+\n+\n+```\n+\n+5>> integrate(x^3*log(d*(c*x^2+b*x+a)^n),x)\n+(-1/8*n+1/4*ln(d))*x^4+b*n/(12*c)*x^3+(2*a*c*n-b^2*n)/(8*c^2)*x^2+(-3*a*b*c*n+b^3*n)/(4*c^3)*x+1/4*n*x^4*ln(a+b*x+c*x^2)+integrate((-x*n*b^4+4*x*n*b^2*c*a-2*x*n*c^2*a^2-n*b^3*a+3*n*b*c*a^2)/(4*x^2*c^4+4*x*b*c^3+4*c^3*a),x)\n+// Time 0.02\n+\n+sage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')\n+sage: integrate(x^3*log(d*(c*x^2+b*x+a)^n),x, algorithm=\"giac\")\n+\n+\n+```\n+\n+\n+**EXAMPLE 8 (hangs in sagemath)**\n+\n+\n+```\n+\n+0>> integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3,x)\n+Done\n+// Time 0.01\n+\n+sage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')\n+sage: integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3,x, algorithm=\"giac\")\n+\n+\n+```\n+\n+**EXAMPLE 9 (hangs in sagemath)**\n+\n+```\n+\n+1>> integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c),x)\n+(-x^5*d*b^9-4*x^4*a*d*b^8-x^4*c*b^9-5*x^4*d*b^8-6*x^3*a^2*d*b^7-4*x^3*a*c*b^8-16*x^3*a*d*b^7-4*x^3*c*b^8-20*x^3*d*b^7-4*x^2*a^3*d*b^6-6*x^2*a^2*c*b^7-18*x^2*a^2*d*b^6-12*x^2*a*c*b^7-48*x^2*a*d*b^6-12*x^2*c*b^7-60*x^2*d*b^6-x*a^4*d*b^5-4*x*a^3*c*b^6-8*x*a^3*d*b^5-12*x*a^2*c*b^6-36*x*a^2*d*b^5-24*x*a*c*b^6-96*x*a*d*b^5-24*x*c*b^6-120*x*d*b^5-a^4*c*b^5-a^4*d*b^4-4*a^3*c*b^5-8*a^3*d*b^4-12*a^2*c*b^5-36*a^2*d*b^4-24*a*c*b^5-96*a*d*b^4-24*c*b^5-120*d*b^4)/b^6*exp(-(a+b*x))\n+// Time 0\n+\n+sage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')\n+sage: integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c),x, algorithm=\"giac\")\n+\n+\n+```\n+\n+\n+\n+\n``````\n",
    "created_at": "2021-01-11T20:31:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500302",
    "user": "https://github.com/nasser1"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -110,11 +110,21 @@
 SageMath version 9.2, Release Date: 2020-10-24
 >
 
->which sage
-/bin/sage
->sage --version
-SageMath version 9.2, Release Date: 2020-10-24
->
+Linux Manjaro running inside Oracle Virtual Box
+
+>uname -r
+5.4.80-2-MANJARO
+>uname -a
+Linux me-virtualbox 5.4.80-2-MANJARO #1 SMP PREEMPT Sat Nov 28 09:58:18 UTC 2020 x86_64 GNU/Linux
+>
+
+>lsb_release -a
+LSB Version:	n/a
+Distributor ID:	ManjaroLinux
+Description:	Manjaro Linux
+Release:	20.2
+Codename:	Nibia
+
 
 
 ```
@@ -126,3 +136,133 @@
 Thank you,
 --Nasser
 
+**Adding more examples**
+
+
+**EXAMPLE 4 (hangs in sagemath)**
+
+
+```
+>giac
+// Using locale /usr/share/locale/
+// en_US.utf8
+// /usr/share/locale/
+// giac
+// UTF-8
+// Maximum number of parallel threads 2
+Help file /usr/share/giac/doc/en/aide_cas not found
+Added 26 synonyms
+Welcome to giac readline interface
+(c) 2001,2020 B. Parisse & others
+Homepage http://www-fourier.ujf-grenoble.fr/~parisse/giac.html
+Released under the GPL license 3.0 or above
+See http://www.gnu.org for license details
+May contain BSD licensed software parts (lapack, atlas, tinymt)
+-------------------------------------------------
+Press CTRL and D simultaneously to finish session
+Type ?commandname for help
+0>> integrate(x*(b*x^2+a)*(B*x^2+A),x)
+1/2*(1/3*x^6*b*B+1/2*x^4*b*A+1/2*x^4*a*B+x^2*a*A)
+// Time 0
+
+
+>sage
+┌────────────────────────────────────────────────────────────────────┐
+│ SageMath version 9.2, Release Date: 2020-10-24                     │
+│ Using Python 3.8.6. Type "help()" for help.                        │
+└────────────────────────────────────────────────────────────────────┘
+sage: x,a,b,B,A = var('x a b B A')
+sage: integrate(x*(b*x^2+a)*(B*x^2+A),x, algorithm="giac")
+
+
+```
+
+
+**EXAMPLE 5 (hangs in sagemath)**
+
+
+```
+GIAC:
+
+3>> integrate(x^m*(b*x^2+a)^3*(B*x^2+A),x)
+(A*a^3*m^4*x*exp(m*ln(x))+24*A*a^3*m^3*x*exp(m*ln(x))+206*A*a^3*m^2*x*exp(m*ln(x))+744*A*a^3*m*x*exp(m*ln(x))+945*A*a^3*x*exp(m*ln(x))+3*A*a^2*b*m^4*x^3*exp(m*ln(x))+66*A*a^2*b*m^3*x^3*exp(m*ln(x))+492*A*a^2*b*m^2*x^3*exp(m*ln(x))+1374*A*a^2*b*m*x^3*exp(m*ln(x))+945*A*a^2*b*x^3*exp(m*ln(x))+3*A*a*b^2*m^4*x^5*exp(m*ln(x))+60*A*a*b^2*m^3*x^5*exp(m*ln(x))+390*A*a*b^2*m^2*x^5*exp(m*ln(x))+900*A*a*b^2*m*x^5*exp(m*ln(x))+567*A*a*b^2*x^5*exp(m*ln(x))+A*b^3*m^4*x^7*exp(m*ln(x))+18*A*b^3*m^3*x^7*exp(m*ln(x))+104*A*b^3*m^2*x^7*exp(m*ln(x))+222*A*b^3*m*x^7*exp(m*ln(x))+135*A*b^3*x^7*exp(m*ln(x))+B*a^3*m^4*x^3*exp(m*ln(x))+22*B*a^3*m^3*x^3*exp(m*ln(x))+164*B*a^3*m^2*x^3*exp(m*ln(x))+458*B*a^3*m*x^3*exp(m*ln(x))+315*B*a^3*x^3*exp(m*ln(x))+3*B*a^2*b*m^4*x^5*exp(m*ln(x))+60*B*a^2*b*m^3*x^5*exp(m*ln(x))+390*B*a^2*b*m^2*x^5*exp(m*ln(x))+900*B*a^2*b*m*x^5*exp(m*ln(x))+567*B*a^2*b*x^5*exp(m*ln(x))+3*B*a*b^2*m^4*x^7*exp(m*ln(x))+54*B*a*b^2*m^3*x^7*exp(m*ln(x))+312*B*a*b^2*m^2*x^7*exp(m*ln(x))+666*B*a*b^2*m*x^7*exp(m*ln(x))+405*B*a*b^2*x^7*exp(m*ln(x))+B*b^3*m^4*x^9*exp(m*ln(x))+16*B*b^3*m^3*x^9*exp(m*ln(x))+86*B*b^3*m^2*x^9*exp(m*ln(x))+176*B*b^3*m*x^9*exp(m*ln(x))+105*B*b^3*x^9*exp(m*ln(x)))/(m^5+25*m^4+230*m^3+950*m^2+1689*m+945)
+// Time 0.01
+4>> 
+
+
+SAGEMATH:
+
+sage: x,a,b,B,A,m = var('x a b B A m')
+sage: integrate(x^m*(b*x^2+a)^3*(B*x^2+A),x, algorithm="giac")
+
+
+```
+
+
+**EXAMPLE 6 (hangs in sagemath)**
+
+
+```
+GIAC:
+
+4>> integrate(x^4*log(d*(c*x^2+b*x+a)^n),x)
+(-2/25*n+1/5*ln(d))*x^5+b*n/(20*c)*x^4+(2*a*c*n-b^2*n)/(15*c^2)*x^3+(-3*a*b*c*n+b^3*n)/(10*c^3)*x^2+(-2*a^2*c^2*n+4*a*b^2*c*n-b^4*n)/(5*c^4)*x+1/5*n*x^5*ln(a+b*x+c*x^2)+integrate((x*n*b^5-5*x*n*b^3*c*a+5*x*n*b*c^2*a^2+n*b^4*a-4*n*b^2*c*a^2+2*n*c^2*a^3)/(5*x^2*c^5+5*x*b*c^4+5*c^4*a),x)
+// Time 0.01
+5>> 
+
+SAGEMATH:
+
+sage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')
+sage: integrate(x^4*log(d*(c*x^2+b*x+a)^n),x, algorithm="giac")
+
+
+```
+
+**EXAMPLE 7 (hangs in sagemath)**
+
+
+```
+
+5>> integrate(x^3*log(d*(c*x^2+b*x+a)^n),x)
+(-1/8*n+1/4*ln(d))*x^4+b*n/(12*c)*x^3+(2*a*c*n-b^2*n)/(8*c^2)*x^2+(-3*a*b*c*n+b^3*n)/(4*c^3)*x+1/4*n*x^4*ln(a+b*x+c*x^2)+integrate((-x*n*b^4+4*x*n*b^2*c*a-2*x*n*c^2*a^2-n*b^3*a+3*n*b*c*a^2)/(4*x^2*c^4+4*x*b*c^3+4*c^3*a),x)
+// Time 0.02
+
+sage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')
+sage: integrate(x^3*log(d*(c*x^2+b*x+a)^n),x, algorithm="giac")
+
+
+```
+
+
+**EXAMPLE 8 (hangs in sagemath)**
+
+
+```
+
+0>> integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3,x)
+Done
+// Time 0.01
+
+sage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')
+sage: integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3,x, algorithm="giac")
+
+
+```
+
+**EXAMPLE 9 (hangs in sagemath)**
+
+```
+
+1>> integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c),x)
+(-x^5*d*b^9-4*x^4*a*d*b^8-x^4*c*b^9-5*x^4*d*b^8-6*x^3*a^2*d*b^7-4*x^3*a*c*b^8-16*x^3*a*d*b^7-4*x^3*c*b^8-20*x^3*d*b^7-4*x^2*a^3*d*b^6-6*x^2*a^2*c*b^7-18*x^2*a^2*d*b^6-12*x^2*a*c*b^7-48*x^2*a*d*b^6-12*x^2*c*b^7-60*x^2*d*b^6-x*a^4*d*b^5-4*x*a^3*c*b^6-8*x*a^3*d*b^5-12*x*a^2*c*b^6-36*x*a^2*d*b^5-24*x*a*c*b^6-96*x*a*d*b^5-24*x*c*b^6-120*x*d*b^5-a^4*c*b^5-a^4*d*b^4-4*a^3*c*b^5-8*a^3*d*b^4-12*a^2*c*b^5-36*a^2*d*b^4-24*a*c*b^5-96*a*d*b^4-24*c*b^5-120*d*b^4)/b^6*exp(-(a+b*x))
+// Time 0
+
+sage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')
+sage: integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c),x, algorithm="giac")
+
+
+```
+
+
+
+
``````




---

archive/issue_comments_500303.json:
```json
{
    "body": "Contains RUBI integration problems in sagemath synyax",
    "created_at": "2021-01-11T21:31:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500303",
    "user": "https://github.com/nasser1"
}
```

Contains RUBI integration problems in sagemath synyax



---

archive/issue_comments_500304.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAttachment: **[SAGE.zip](https://github.com/sagemath/sage/files/ticket31222/SAGE.zip)**\n\nReplying to [@DaveWitteMorris](#comment:11):\n> @nasser1: Thanks for reporting this problem. It seems to be serious, but I hope it will have an easy solution.\n> \n> It seems that you have translated the rubi tests to sagemath format. If so, would you be willing to share the zip file, perhaps as an attachment to this ticket? \n\n\nI seem to have lost what I wrote here. WIll try again.\n\nI attached zip file to the ticket. Each file in the zip file, say \"Hebisch_Problems.sage\" has first line as the `var` command, followed by `lis` which is a list that contains all the integrals for that specific test.\n\nTo run one file you could do\n\n\n```\nfileName = \"Hebisch_Problems.sage\"\nload(fileName) #read the problems into variable lis. This also contains the var('') statement.\nfor problem in lst: #problem[0] is the integrand, problem[1] is the integration variable.\n    integrate(SR(problem[0]),problem[1],algorithm=\"giac\")\n\n```\n\nEach row in the list has as first field the integrand (as a string) and the second field is the integration variable.\n\nOf you could simply copy the integral from the files and past it to sagemath.   \n\nHere is an example of one small complete file. There are about 200 files, some contains thousands of integrals. But they all have this format:\n\n\n```\nvar('x ')\nlst=[[\"(x^6-x^5+x^4-x^3+1)*exp(x)\",x,25,\"871*exp(x)-870*exp(x)*x+435*exp(x)*x^2-145*exp(x)*x^3+36*exp(x)*x^4-7*exp(x)*x^5+exp(x)*x^6\"],\n[\"(-x^2+2)*exp(x/(x^2+2))/(x^3+2*x)\",x,-5,\"Ei(x/(x^2+2))\"],\n[\"(2*x^4-x^3+3*x^2+2*x+2)*exp(x/(x^2+2))/(x^3+2*x)\",x,-5,\"exp(x/(x^2+2))*(x^2+2)+Ei(x/(x^2+2))\"],\n[\"(1+exp(x))*exp(x+exp(x))/(x+exp(x))\",x,2,\"Ei(x+exp(x))\"],\n[\"(x^3-x^2-3*x+1)*exp(1/(x^2-1))/(x^3-x^2-x+1)\",x,-6,\"exp(1/(x^2-1))*(1+x)\"],\n[\"exp(1+1/log(x))*(-1+log(x)^2)/log(x)^2\",x,1,\"exp(1+1/log(x))*x\"],\n[\"exp(x+1/log(x))*(-1+(1+x)*log(x)^2)/log(x)^2\",x,-2,\"exp(x+1/log(x))*x\"]]\n\n```\n\n\n--Nasser",
    "created_at": "2021-01-11T21:36:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500304",
    "user": "https://github.com/nasser1"
}
```

<div id="comment:13" align="right">comment:13</div>

Attachment: **[SAGE.zip](https://github.com/sagemath/sage/files/ticket31222/SAGE.zip)**

Replying to [@DaveWitteMorris](#comment:11):
> @nasser1: Thanks for reporting this problem. It seems to be serious, but I hope it will have an easy solution.
> 
> It seems that you have translated the rubi tests to sagemath format. If so, would you be willing to share the zip file, perhaps as an attachment to this ticket? 


I seem to have lost what I wrote here. WIll try again.

I attached zip file to the ticket. Each file in the zip file, say "Hebisch_Problems.sage" has first line as the `var` command, followed by `lis` which is a list that contains all the integrals for that specific test.

To run one file you could do


```
fileName = "Hebisch_Problems.sage"
load(fileName) #read the problems into variable lis. This also contains the var('') statement.
for problem in lst: #problem[0] is the integrand, problem[1] is the integration variable.
    integrate(SR(problem[0]),problem[1],algorithm="giac")

```

Each row in the list has as first field the integrand (as a string) and the second field is the integration variable.

Of you could simply copy the integral from the files and past it to sagemath.   

Here is an example of one small complete file. There are about 200 files, some contains thousands of integrals. But they all have this format:


```
var('x ')
lst=[["(x^6-x^5+x^4-x^3+1)*exp(x)",x,25,"871*exp(x)-870*exp(x)*x+435*exp(x)*x^2-145*exp(x)*x^3+36*exp(x)*x^4-7*exp(x)*x^5+exp(x)*x^6"],
["(-x^2+2)*exp(x/(x^2+2))/(x^3+2*x)",x,-5,"Ei(x/(x^2+2))"],
["(2*x^4-x^3+3*x^2+2*x+2)*exp(x/(x^2+2))/(x^3+2*x)",x,-5,"exp(x/(x^2+2))*(x^2+2)+Ei(x/(x^2+2))"],
["(1+exp(x))*exp(x+exp(x))/(x+exp(x))",x,2,"Ei(x+exp(x))"],
["(x^3-x^2-3*x+1)*exp(1/(x^2-1))/(x^3-x^2-x+1)",x,-6,"exp(1/(x^2-1))*(1+x)"],
["exp(1+1/log(x))*(-1+log(x)^2)/log(x)^2",x,1,"exp(1+1/log(x))*x"],
["exp(x+1/log(x))*(-1+(1+x)*log(x)^2)/log(x)^2",x,-2,"exp(x+1/log(x))*x"]]

```


--Nasser



---

archive/issue_comments_500305.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@nasser1](#comment:13):\n> I attached zip file to the ticket...\n\nThanks! Your instructions were very clear, so I had no problem running some tests (until I ran into one that hangs). As suggested by tmonteil in [comment:8](#comment:8), I think a bunch of these should be added to the testing framework after this bug is cleared up.",
    "created_at": "2021-01-12T01:29:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500305",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@nasser1](#comment:13):
> I attached zip file to the ticket...

Thanks! Your instructions were very clear, so I had no problem running some tests (until I ran into one that hangs). As suggested by tmonteil in [comment:8](#comment:8), I think a bunch of these should be added to the testing framework after this bug is cleared up.



---

archive/issue_comments_500306.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@sagetrac-tmonteil](#comment:7):\n> @dimpase could you please try the other examples ? On my computer (Sage `9.3.beta5`, compiled by myself, Debian buster), the first example works, but not the other ones.\n\noops, indeed, while the 1st example works for me, the 2nd one hangs. Sorry for noise.",
    "created_at": "2021-01-12T09:38:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500306",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@sagetrac-tmonteil](#comment:7):
> @dimpase could you please try the other examples ? On my computer (Sage `9.3.beta5`, compiled by myself, Debian buster), the first example works, but not the other ones.

oops, indeed, while the 1st example works for me, the 2nd one hangs. Sorry for noise.



---

archive/issue_comments_500307.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nSomething silly is happening where the expression to pass to giac is formed.\nI've added \n\n```diff\n--- a/src/sage/interfaces/giac.py\n+++ b/src/sage/interfaces/giac.py\n@@ -1154,6 +1154,9 @@ class GiacElement(ExpectElement):\n             sage: x,y=giac('x'),giac('y');integrate(cos(x+y),'x=0..pi').simplify()\n             -2*sin(y)\n         \"\"\"\n+        print(self.name())\n+        print(self)\n+        print(var)\n         if min is None:\n             return giac('int(%s,%s)' % (self.name(), var))\n         else:\n```\n\nand as you see, the expression is malformed, e.g. there is no terminating `)`\nso giac just waits for the end of the expression, which never comes, thus the hang.\n\n```\nsage: sage: x,a,b = var('x a b') \n....: sage: integrate((x/(b*x+a))^(5/2),x, algorithm=\"giac\")                                                                                                                                                                                                                      \nsage4\nsqrt((b*x+a)^-1*x)*((b*x+a)^-1*x)^2\nx\n^CInterrupting Giac...\n```",
    "created_at": "2021-01-12T09:52:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500307",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:16" align="right">comment:16</div>

Something silly is happening where the expression to pass to giac is formed.
I've added 

```diff
--- a/src/sage/interfaces/giac.py
+++ b/src/sage/interfaces/giac.py
@@ -1154,6 +1154,9 @@ class GiacElement(ExpectElement):
             sage: x,y=giac('x'),giac('y');integrate(cos(x+y),'x=0..pi').simplify()
             -2*sin(y)
         """
+        print(self.name())
+        print(self)
+        print(var)
         if min is None:
             return giac('int(%s,%s)' % (self.name(), var))
         else:
```

and as you see, the expression is malformed, e.g. there is no terminating `)`
so giac just waits for the end of the expression, which never comes, thus the hang.

```
sage: sage: x,a,b = var('x a b') 
....: sage: integrate((x/(b*x+a))^(5/2),x, algorithm="giac")                                                                                                                                                                                                                      
sage4
sqrt((b*x+a)^-1*x)*((b*x+a)^-1*x)^2
x
^CInterrupting Giac...
```



---

archive/issue_comments_500308.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nand here is the malformed giac input for Example 2 as given in the ticket description\n\n```\nsage: sage: x,a,b = var('x a b') \n....: sage: integrate(x^(5/2)/(b*x+a)^(5/2),x, algorithm=\"giac\")                                                                                                                                                                                                                  \nsage0\n(sqrt(b*x+a))^-1*(b*x+a)^-2*sqrt(x)*x^2\nx\n^CInterrupting Giac...\n```\n\nsomebody has damaged handling of non-integer exponents (for giac only?) since Sage 8.9, it seems.",
    "created_at": "2021-01-12T09:59:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500308",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">comment:17</div>

and here is the malformed giac input for Example 2 as given in the ticket description

```
sage: sage: x,a,b = var('x a b') 
....: sage: integrate(x^(5/2)/(b*x+a)^(5/2),x, algorithm="giac")                                                                                                                                                                                                                  
sage0
(sqrt(b*x+a))^-1*(b*x+a)^-2*sqrt(x)*x^2
x
^CInterrupting Giac...
```

somebody has damaged handling of non-integer exponents (for giac only?) since Sage 8.9, it seems.



---

archive/issue_comments_500309.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nOn the other hand, `integrate(x<sup>(5/2)/(b*x+a)</sup>(5/2),x, algorithm=\"fricas\")` works, which gives hope that the bug is specific to giac interface.",
    "created_at": "2021-01-12T10:06:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500309",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">comment:18</div>

On the other hand, `integrate(x<sup>(5/2)/(b*x+a)</sup>(5/2),x, algorithm="fricas")` works, which gives hope that the bug is specific to giac interface.



---

archive/issue_comments_500310.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nsorry, but where do you see a missing parenthesis ? The following works fine:\n\n```\nsage: x,a,b = var('x a b')                                                      \nsage: F=(x/(b*x+a))^(5/2)                                                       \nsage: F._fricas_init_() == F._giac_init_()                                      \nTrue\nsage: giac(F).diff()                                                            \n1/2*(-b*(b*x+a)^-2*x+(b*x+a)^-1)*(sqrt((b*x+a)^-1*x))^-1*((b*x+a)^-1*x)^2+2*sqrt((b*x+a)^-1*x)*(-b*(b*x+a)^-2*x+(b*x+a)^-1)*(b*x+a)^-1*x\nsage: giac(F).sage()                                                            \nx^2*sqrt(x/(b*x + a))/(b*x + a)^2\n\n```",
    "created_at": "2021-01-12T10:31:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500310",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:19" align="right">comment:19</div>

sorry, but where do you see a missing parenthesis ? The following works fine:

```
sage: x,a,b = var('x a b')                                                      
sage: F=(x/(b*x+a))^(5/2)                                                       
sage: F._fricas_init_() == F._giac_init_()                                      
True
sage: giac(F).diff()                                                            
1/2*(-b*(b*x+a)^-2*x+(b*x+a)^-1)*(sqrt((b*x+a)^-1*x))^-1*((b*x+a)^-1*x)^2+2*sqrt((b*x+a)^-1*x)*(-b*(b*x+a)^-2*x+(b*x+a)^-1)*(b*x+a)^-1*x
sage: giac(F).sage()                                                            
x^2*sqrt(x/(b*x + a))/(b*x + a)^2

```



---

archive/issue_comments_500311.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@fchapoton](#comment:19):\n> sorry, but where do you see a missing parenthesis ? The following works fine:\n> \n> ```\n> sage: x,a,b = var('x a b')                                                      \n> sage: F=(x/(b*x+a))^(5/2)                                                       \n> sage: F._fricas_init_() == F._giac_init_()                                      \n> True\n> sage: giac(F).diff()                                                            \n> 1/2*(-b*(b*x+a)^-2*x+(b*x+a)^-1)*(sqrt((b*x+a)^-1*x))^-1*((b*x+a)^-1*x)^2+2*sqrt((b*x+a)^-1*x)*(-b*(b*x+a)^-2*x+(b*x+a)^-1)*(b*x+a)^-1*x\n> sage: giac(F).sage()                                                            \n> x^2*sqrt(x/(b*x + a))/(b*x + a)^2\n> \n> ```\n\nsee the output of the debugging print I inserted:\n\n```\nsage: integral(F,x,algorithm=\"giac\")                                                                                                                                                                                                                                              \nsage0\nsqrt((b*x+a)^-1*x)*((b*x+a)^-1*x)^2\nx\n```\n\nthere is an attempted conversion to an expression involving `sqrt()`, but it does not go through!\n\nWhere the hell this is happening in the code, I don't know.",
    "created_at": "2021-01-12T10:39:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500311",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@fchapoton](#comment:19):
> sorry, but where do you see a missing parenthesis ? The following works fine:
> 
> ```
> sage: x,a,b = var('x a b')                                                      
> sage: F=(x/(b*x+a))^(5/2)                                                       
> sage: F._fricas_init_() == F._giac_init_()                                      
> True
> sage: giac(F).diff()                                                            
> 1/2*(-b*(b*x+a)^-2*x+(b*x+a)^-1)*(sqrt((b*x+a)^-1*x))^-1*((b*x+a)^-1*x)^2+2*sqrt((b*x+a)^-1*x)*(-b*(b*x+a)^-2*x+(b*x+a)^-1)*(b*x+a)^-1*x
> sage: giac(F).sage()                                                            
> x^2*sqrt(x/(b*x + a))/(b*x + a)^2
> 
> ```

see the output of the debugging print I inserted:

```
sage: integral(F,x,algorithm="giac")                                                                                                                                                                                                                                              
sage0
sqrt((b*x+a)^-1*x)*((b*x+a)^-1*x)^2
x
```

there is an attempted conversion to an expression involving `sqrt()`, but it does not go through!

Where the hell this is happening in the code, I don't know.



---

archive/issue_comments_500312.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nonce again: `sqrt((b*x+a)<sup>-1*x)*((b*x+a)</sup>-1*x)^2` is what's being passed to giac, and of course this does not fly.",
    "created_at": "2021-01-12T10:44:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500312",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:21" align="right">comment:21</div>

once again: `sqrt((b*x+a)<sup>-1*x)*((b*x+a)</sup>-1*x)^2` is what's being passed to giac, and of course this does not fly.



---

archive/issue_comments_500313.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nHere it is, in another way:\n\n```\nsage: F._giac_()                                                                                                                                                                                                                                                                  \nsqrt((b*x+a)^-1*x)*((b*x+a)^-1*x)^2\n```\nI don't know where this is happening, but it is obviously very wrong.\n\nby the way\n\n```\nsage: F._fricas_()                                                                                                                                                                                                                                                                \n       +-------+\n     2 |   x\n    x  |-------\n      \\|b x + a\n-------------------\n 2 2              2\nb x  + 2 a b x + a\n```",
    "created_at": "2021-01-12T10:52:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500313",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:22" align="right">comment:22</div>

Here it is, in another way:

```
sage: F._giac_()                                                                                                                                                                                                                                                                  
sqrt((b*x+a)^-1*x)*((b*x+a)^-1*x)^2
```
I don't know where this is happening, but it is obviously very wrong.

by the way

```
sage: F._fricas_()                                                                                                                                                                                                                                                                
       +-------+
     2 |   x
    x  |-------
      \|b x + a
-------------------
 2 2              2
b x  + 2 a b x + a
```



---

archive/issue_comments_500314.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThere is indeed a filter between Expression and giac used to convert some keywords so giac(F) may not be the same as giac(str(F))\nI guess it is in\n`sage.symbolic.expression_conversions`",
    "created_at": "2021-01-12T11:09:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500314",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

<div id="comment:23" align="right">comment:23</div>

There is indeed a filter between Expression and giac used to convert some keywords so giac(F) may not be the same as giac(str(F))
I guess it is in
`sage.symbolic.expression_conversions`



---

archive/issue_comments_500315.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@dimpase](#comment:21):\n> once again: `sqrt((b*x+a)<sup>-1*x)*((b*x+a)</sup>-1*x)^2` is what's being passed to giac, and of course this does not fly.\n\nNo, I do not think so. This is what giac is printing. What giac gets is the string given by `_giac_init_`, which is fine.",
    "created_at": "2021-01-12T11:10:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500315",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@dimpase](#comment:21):
> once again: `sqrt((b*x+a)<sup>-1*x)*((b*x+a)</sup>-1*x)^2` is what's being passed to giac, and of course this does not fly.

No, I do not think so. This is what giac is printing. What giac gets is the string given by `_giac_init_`, which is fine.



---

archive/issue_comments_500316.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@fchapoton](#comment:24):\n> Replying to [@dimpase](#comment:21):\n> > once again: `sqrt((b*x+a)<sup>-1*x)*((b*x+a)</sup>-1*x)^2` is what's being passed to giac, and of course this does not fly.\n\n> \n> No, I do not think so. This is what giac is printing. What giac gets is the string given by `_giac_init_`, which is fine.\n\n\"passing\" means \"what giac tries to integrate\".\nIMHO it is what Sage prepares to pass to giac, giac is not yet involved at this point.\n\n \ngiac is perfectly capable to take this `_giac_init_` and integrate it.",
    "created_at": "2021-01-12T11:17:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500316",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@fchapoton](#comment:24):
> Replying to [@dimpase](#comment:21):
> > once again: `sqrt((b*x+a)<sup>-1*x)*((b*x+a)</sup>-1*x)^2` is what's being passed to giac, and of course this does not fly.

> 
> No, I do not think so. This is what giac is printing. What giac gets is the string given by `_giac_init_`, which is fine.

"passing" means "what giac tries to integrate".
IMHO it is what Sage prepares to pass to giac, giac is not yet involved at this point.

 
giac is perfectly capable to take this `_giac_init_` and integrate it.



---

archive/issue_comments_500317.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nmeanwhile I looked at Example 8. The trouble there is that giac is highly sensitive to \nthe expression format; we shuffle the terms around, and all of a sudden it has trouble integrating the expression.\n\n```\n0>> integrate((b*x+a)^4*(d*x+c)^3*exp(-b*x-a),x)\n^CCtrl-C pressed (pid 21354)\nStopped by user interruption. Error: Bad Argument Value\n\nEvaluation time: 50.4\n\"Stopped by user interruption. Error: Bad Argument Value\"\n// Time 50.4\n1>> integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3,x)\nDone\n```\n\nand the first of these forms is what you get by doing \n\n```\nsage: F=exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3\nsage: F._giac_()\n```\nso that's why this particular example is stuck in Sage.\n\nSo it's more of a giac problem/bug for this example.",
    "created_at": "2021-01-12T11:22:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500317",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

meanwhile I looked at Example 8. The trouble there is that giac is highly sensitive to 
the expression format; we shuffle the terms around, and all of a sudden it has trouble integrating the expression.

```
0>> integrate((b*x+a)^4*(d*x+c)^3*exp(-b*x-a),x)
^CCtrl-C pressed (pid 21354)
Stopped by user interruption. Error: Bad Argument Value

Evaluation time: 50.4
"Stopped by user interruption. Error: Bad Argument Value"
// Time 50.4
1>> integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3,x)
Done
```

and the first of these forms is what you get by doing 

```
sage: F=exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3
sage: F._giac_()
```
so that's why this particular example is stuck in Sage.

So it's more of a giac problem/bug for this example.



---

archive/issue_comments_500318.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nOops, sorry, you're right, Example 2 is more of a giac problem, too (I took that `_giac_init_()` form):\n\n```\n0>> integrate((((((b)*(x))+(a))^(-1))*(x))^(5/2),x)\nWarning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):\nCheck [abs(b*x+a)]\n^CCtrl-C pressed (pid 32350)\n```",
    "created_at": "2021-01-12T11:31:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500318",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:27" align="right">comment:27</div>

Oops, sorry, you're right, Example 2 is more of a giac problem, too (I took that `_giac_init_()` form):

```
0>> integrate((((((b)*(x))+(a))^(-1))*(x))^(5/2),x)
Warning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):
Check [abs(b*x+a)]
^CCtrl-C pressed (pid 32350)
```



---

archive/issue_comments_500319.json:
```json
{
    "body": "Upstream: **Reported upstream. No feedback yet.**",
    "created_at": "2021-01-12T12:47:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500319",
    "user": "https://github.com/dimpase"
}
```

Upstream: **Reported upstream. No feedback yet.**



---

archive/issue_comments_500320.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nUpstream notified in https://xcas.univ-grenoble-alpes.fr/forum/viewtopic.php?f=3&t=2600",
    "created_at": "2021-01-12T12:47:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500320",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:28" align="right">comment:28</div>

Upstream notified in https://xcas.univ-grenoble-alpes.fr/forum/viewtopic.php?f=3&t=2600



---

archive/issue_comments_500321.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,13 @@\n+*Edit*: the root cause of the problem described here is very high \n+sensitivity of giac to the form of the input to its integrator: e.g.\n+different order of terms in a product to be integrated may lead to \n+huge slowdowns/hands,cf Example 8.\n+- and Sage does rewriting of terms before passing them to an\n+external integrator. Namely, if `F` is the original input then giac\n+gets `F._giac_init_()`, which is often not exacly `F`, although equavalent to `F`. In this sense, passing a string to giac might be more robust.\n+\n+---\n+\n Hello. I am working on a new build and new reports for the independent CAS integration tests [https://www.12000.org/my_notes/CAS_integration_tests/index.htm](https://www.12000.org/my_notes/CAS_integration_tests/index.htm). \n \n Now using sagemath 9.2 on Linux to test thousands of integrals using fricas, maxima and giac among other CAS systems. \n``````\n",
    "created_at": "2021-01-12T13:09:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500321",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,13 @@
+*Edit*: the root cause of the problem described here is very high 
+sensitivity of giac to the form of the input to its integrator: e.g.
+different order of terms in a product to be integrated may lead to 
+huge slowdowns/hands,cf Example 8.
+- and Sage does rewriting of terms before passing them to an
+external integrator. Namely, if `F` is the original input then giac
+gets `F._giac_init_()`, which is often not exacly `F`, although equavalent to `F`. In this sense, passing a string to giac might be more robust.
+
+---
+
 Hello. I am working on a new build and new reports for the independent CAS integration tests [https://www.12000.org/my_notes/CAS_integration_tests/index.htm](https://www.12000.org/my_notes/CAS_integration_tests/index.htm). 
 
 Now using sagemath 9.2 on Linux to test thousands of integrals using fricas, maxima and giac among other CAS systems. 
``````




---

archive/issue_comments_500322.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,7 @@\n *Edit*: the root cause of the problem described here is very high \n sensitivity of giac to the form of the input to its integrator: e.g.\n different order of terms in a product to be integrated may lead to \n-huge slowdowns/hands,cf Example 8.\n-- and Sage does rewriting of terms before passing them to an\n+huge slowdowns/hands,cf Example 8, and Sage does rewriting of terms before passing them to an\n external integrator. Namely, if `F` is the original input then giac\n gets `F._giac_init_()`, which is often not exacly `F`, although equavalent to `F`. In this sense, passing a string to giac might be more robust.\n \n``````\n",
    "created_at": "2021-01-12T13:09:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500322",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,7 @@
 *Edit*: the root cause of the problem described here is very high 
 sensitivity of giac to the form of the input to its integrator: e.g.
 different order of terms in a product to be integrated may lead to 
-huge slowdowns/hands,cf Example 8.
-- and Sage does rewriting of terms before passing them to an
+huge slowdowns/hands,cf Example 8, and Sage does rewriting of terms before passing them to an
 external integrator. Namely, if `F` is the original input then giac
 gets `F._giac_init_()`, which is often not exacly `F`, although equavalent to `F`. In this sense, passing a string to giac might be more robust.
 
``````




---

archive/issue_comments_500323.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@DaveWitteMorris](#comment:11):\n> @nasser1: Thanks for reporting this problem. It seems to be serious, but I hope it will have an easy solution.\n\nAn easy solution, making sure that giac called from Sage does exactly the same as giac called stanadlone, is to bypass rewriting done by Sage, by using `giac.eval()`. E.g.\n\n```\nsage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')                                                                                                                                           \nsage: F='exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3'                                                                                                                                                    \nsage: giac.eval(F+',x')                                                                                                                                                                      \n'exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3,x'\nsage: giac.eval('integrate('+F+',x)')                                                                                                                                                        \n'(-x^7*d^3*b^11-4*x^6*...'\n```\nSo you pass giac a string and get a string back.\nOne can convert strings to Sage's symbolic expressions then, by calling `SR()`.",
    "created_at": "2021-01-12T13:22:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500323",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@DaveWitteMorris](#comment:11):
> @nasser1: Thanks for reporting this problem. It seems to be serious, but I hope it will have an easy solution.

An easy solution, making sure that giac called from Sage does exactly the same as giac called stanadlone, is to bypass rewriting done by Sage, by using `giac.eval()`. E.g.

```
sage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')                                                                                                                                           
sage: F='exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3'                                                                                                                                                    
sage: giac.eval(F+',x')                                                                                                                                                                      
'exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3,x'
sage: giac.eval('integrate('+F+',x)')                                                                                                                                                        
'(-x^7*d^3*b^11-4*x^6*...'
```
So you pass giac a string and get a string back.
One can convert strings to Sage's symbolic expressions then, by calling `SR()`.



---

archive/issue_comments_500324.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nthe problem of Ex.8 has been fixed upstream:\nhttps://dev.geogebra.org/trac/changeset/69729/",
    "created_at": "2021-01-13T18:58:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500324",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:32" align="right">comment:32</div>

the problem of Ex.8 has been fixed upstream:
https://dev.geogebra.org/trac/changeset/69729/



---

archive/issue_comments_500325.json:
```json
{
    "body": "Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers acknowledge bug.**",
    "created_at": "2021-01-13T18:58:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500325",
    "user": "https://github.com/dimpase"
}
```

Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers acknowledge bug.**



---

archive/issue_events_430319.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-02T20:21:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31222#event-430319"
}
```



---

archive/issue_events_430320.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-02T20:21:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31222#event-430320"
}
```



---

archive/issue_comments_500326.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nMoving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage",
    "created_at": "2021-04-02T20:21:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500326",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:33" align="right">comment:33</div>

Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage



---

archive/issue_comments_500327.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nExamples 2, 3, 5, 6, 7 have `ln` in Giac's output.\nEmmanuel Charpentier's answer to\n\n- [Ask Sage question 57145: integrating via Giac can give \"Malformed expression\"](https://ask.sagemath.org/question/57145)\n\npoints to the absence of conversion from\nGiac's `ln` to Sage's `log` being a problem.",
    "created_at": "2021-05-18T12:40:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500327",
    "user": "https://github.com/slel"
}
```

<div id="comment:34" align="right">comment:34</div>

Examples 2, 3, 5, 6, 7 have `ln` in Giac's output.
Emmanuel Charpentier's answer to

- [Ask Sage question 57145: integrating via Giac can give "Malformed expression"](https://ask.sagemath.org/question/57145)

points to the absence of conversion from
Giac's `ln` to Sage's `log` being a problem.



---

archive/issue_comments_500328.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nno example [1..9] hangs anymore:\n\nhttps://asciinema.org/a/kPLdynWBPFraIDEJLvHOKP7xq\n\ntry it yourself with https://github.com/sheerluck/ticket-31222",
    "created_at": "2021-07-03T10:48:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31222#issuecomment-500328",
    "user": "https://github.com/sheerluck"
}
```

<div id="comment:35" align="right">comment:35</div>

no example [1..9] hangs anymore:

https://asciinema.org/a/kPLdynWBPFraIDEJLvHOKP7xq

try it yourself with https://github.com/sheerluck/ticket-31222



---

archive/issue_events_430321.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31222#event-430321"
}
```



---

archive/issue_events_430322.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31222#event-430322"
}
```



---

archive/issue_events_430323.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T20:12:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31222#event-430323"
}
```



---

archive/issue_events_430324.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T20:12:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31222#event-430324"
}
```



---

archive/issue_events_430325.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31222#event-430325"
}
```



---

archive/issue_events_430326.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31222#event-430326"
}
```



---

archive/issue_events_430327.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31222#event-430327"
}
```



---

archive/issue_events_430328.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31222",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31222#event-430328"
}
```
