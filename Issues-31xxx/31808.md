# Issue 31808: AA cannot convert real elements from a quadratic field

archive/issues_031571.json:
```json
{
    "body": "Broken by #31628:\n\n```\nsage: C.<I> = QuadraticField(-1)\nsage: AA(C.one())\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-4-175efcbd0268> in <module>\n----> 1 AA(C.one())\n\n~/sage-build/local/lib/python3.9/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9335)()\n    896         if mor is not None:\n    897             if no_extra_args:\n--> 898                 return mor._call_(x)\n    899             else:\n    900                 return mor._call_with_args(x, args, kwds)\n\n~/sage-build/local/lib/python3.9/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4622)()\n    159                 print(type(C), C)\n    160                 print(type(C._element_constructor), C._element_constructor)\n--> 161             raise\n    162 \n    163     cpdef Element _call_with_args(self, x, args=(), kwds={}):\n\n~/sage-build/local/lib/python3.9/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4514)()\n    154         cdef Parent C = self._codomain\n    155         try:\n--> 156             return C._element_constructor(x)\n    157         except Exception:\n    158             if print_warnings:\n\n~/sage-build/local/lib/python3.9/site-packages/sage/rings/qqbar.py in _element_constructor_(self, x)\n   1108                 raise ValueError(\"Cannot coerce algebraic number with non-zero imaginary part to algebraic real\")\n   1109         elif hasattr(x, '_algebraic_'):\n-> 1110             return x._algebraic_(AA)\n   1111         return AlgebraicReal(x)\n   1112 \n\n~/sage-build/local/lib/python3.9/site-packages/sage/rings/number_field/number_field_element_quadratic.pyx in sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_gaussian._algebraic_ (build/cythonized/sage/rings/number_field/number_field_element_quadratic.cpp:19840)()\n   2419             return qqbar.AlgebraicNumber(self)\n   2420         elif parent is qqbar.AA and self[1].is_zero():\n-> 2421             return qqbar.AlgebraicReal(self)\n   2422         else:\n   2423             raise ValueError(f\"unable to convert {self!r} to an element of {parent!r}\")\n\n~/sage-build/local/lib/python3.9/site-packages/sage/rings/qqbar.py in __init__(self, x)\n   5178             -1.414213562373095?\n   5179         \"\"\"\n-> 5180         AlgebraicNumber_base.__init__(self, AA, x)\n   5181         self._ensure_real()\n   5182 \n\n~/sage-build/local/lib/python3.9/site-packages/sage/rings/qqbar.py in __init__(self, parent, x)\n   3501                 self._descr = ANExtensionElement(QQbar_I_generator, QQbar_I_nf([x[0], -x[1]]))\n   3502         else:\n-> 3503             raise TypeError(\"Illegal initializer for algebraic number\")\n   3504 \n   3505         prec = 64\n\nTypeError: Illegal initializer for algebraic number\n```\n\nCC:  @videlec @mezzarobba @orlitzky\n\nKeywords: AA, conversion\n\nBranch/Commit: 157c5253b1fd8e9bc2331302b5e5dd48653cba50\n\nReviewer: Marc Mezzarobba\n\nAuthor: Travis Scrimshaw\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31808\n\n",
    "closed_at": "2021-05-27T20:29:30Z",
    "created_at": "2021-05-11T00:39:07Z",
    "labels": [
        "component: coercion",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "AA cannot convert real elements from a quadratic field",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31808",
    "user": "https://github.com/tscrim"
}
```
Broken by #31628:

```
sage: C.<I> = QuadraticField(-1)
sage: AA(C.one())
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-175efcbd0268> in <module>
----> 1 AA(C.one())

~/sage-build/local/lib/python3.9/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9335)()
    896         if mor is not None:
    897             if no_extra_args:
--> 898                 return mor._call_(x)
    899             else:
    900                 return mor._call_with_args(x, args, kwds)

~/sage-build/local/lib/python3.9/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4622)()
    159                 print(type(C), C)
    160                 print(type(C._element_constructor), C._element_constructor)
--> 161             raise
    162 
    163     cpdef Element _call_with_args(self, x, args=(), kwds={}):

~/sage-build/local/lib/python3.9/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4514)()
    154         cdef Parent C = self._codomain
    155         try:
--> 156             return C._element_constructor(x)
    157         except Exception:
    158             if print_warnings:

~/sage-build/local/lib/python3.9/site-packages/sage/rings/qqbar.py in _element_constructor_(self, x)
   1108                 raise ValueError("Cannot coerce algebraic number with non-zero imaginary part to algebraic real")
   1109         elif hasattr(x, '_algebraic_'):
-> 1110             return x._algebraic_(AA)
   1111         return AlgebraicReal(x)
   1112 

~/sage-build/local/lib/python3.9/site-packages/sage/rings/number_field/number_field_element_quadratic.pyx in sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_gaussian._algebraic_ (build/cythonized/sage/rings/number_field/number_field_element_quadratic.cpp:19840)()
   2419             return qqbar.AlgebraicNumber(self)
   2420         elif parent is qqbar.AA and self[1].is_zero():
-> 2421             return qqbar.AlgebraicReal(self)
   2422         else:
   2423             raise ValueError(f"unable to convert {self!r} to an element of {parent!r}")

~/sage-build/local/lib/python3.9/site-packages/sage/rings/qqbar.py in __init__(self, x)
   5178             -1.414213562373095?
   5179         """
-> 5180         AlgebraicNumber_base.__init__(self, AA, x)
   5181         self._ensure_real()
   5182 

~/sage-build/local/lib/python3.9/site-packages/sage/rings/qqbar.py in __init__(self, parent, x)
   3501                 self._descr = ANExtensionElement(QQbar_I_generator, QQbar_I_nf([x[0], -x[1]]))
   3502         else:
-> 3503             raise TypeError("Illegal initializer for algebraic number")
   3504 
   3505         prec = 64

TypeError: Illegal initializer for algebraic number
```

CC:  @videlec @mezzarobba @orlitzky

Keywords: AA, conversion

Branch/Commit: 157c5253b1fd8e9bc2331302b5e5dd48653cba50

Reviewer: Marc Mezzarobba

Author: Travis Scrimshaw

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31808





---

archive/issue_comments_632440.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-05-11T00:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31808#issuecomment-632440",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_632441.json:
```json
{
    "body": "Changing branch from \"\" to \"public/coercion/fix_guassian_aa-31808\"",
    "created_at": "2021-05-11T00:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31808#issuecomment-632441",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "" to "public/coercion/fix_guassian_aa-31808"



---

archive/issue_comments_632442.json:
```json
{
    "body": "<a id='comment:1'></a>\nWe should just split off the real part to `AA`. Simple fix.\n\n---\nNew commits:\n|                                                                                                                                          |                                                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|\n|[71bc68b](https://git.sagemath.org/sage.git/commit?id=71bc68b1ff2d2672215d739c908120d3c92b11f6)|`Fix conversion of Gaussian number field elements to AA.`|",
    "created_at": "2021-05-11T00:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31808#issuecomment-632442",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>
We should just split off the real part to `AA`. Simple fix.

---
New commits:
|                                                                                                                                          |                                                         |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
|[71bc68b](https://git.sagemath.org/sage.git/commit?id=71bc68b1ff2d2672215d739c908120d3c92b11f6)|`Fix conversion of Gaussian number field elements to AA.`|



---

archive/issue_comments_632443.json:
```json
{
    "body": "Changing author from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2021-05-11T00:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31808#issuecomment-632443",
    "user": "https://github.com/tscrim"
}
```

Changing author from "" to "Travis Scrimshaw"



---

archive/issue_comments_632444.json:
```json
{
    "body": "Changing commit from \"\" to \"71bc68b1ff2d2672215d739c908120d3c92b11f6\"",
    "created_at": "2021-05-11T00:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31808#issuecomment-632444",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "" to "71bc68b1ff2d2672215d739c908120d3c92b11f6"



---

archive/issue_comments_632445.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|\n|[bec8cc5](https://git.sagemath.org/sage.git/commit/?id=bec8cc51af6ccf6685cfac6aff4dff66ed53e8bc)|`Fix conversion of Gaussian number field elements to AA.`|",
    "created_at": "2021-05-11T01:11:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31808#issuecomment-632445",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
|[bec8cc5](https://git.sagemath.org/sage.git/commit/?id=bec8cc51af6ccf6685cfac6aff4dff66ed53e8bc)|`Fix conversion of Gaussian number field elements to AA.`|



---

archive/issue_comments_632446.json:
```json
{
    "body": "Changing commit from \"71bc68b1ff2d2672215d739c908120d3c92b11f6\" to \"bec8cc51af6ccf6685cfac6aff4dff66ed53e8bc\"",
    "created_at": "2021-05-11T01:11:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31808#issuecomment-632446",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "71bc68b1ff2d2672215d739c908120d3c92b11f6" to "bec8cc51af6ccf6685cfac6aff4dff66ed53e8bc"



---

archive/issue_comments_632447.json:
```json
{
    "body": "Changing commit from \"bec8cc51af6ccf6685cfac6aff4dff66ed53e8bc\" to \"97c2a0e68d8acc8cfef9037a2b12dfb6683e436f\"",
    "created_at": "2021-05-11T01:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31808#issuecomment-632447",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "bec8cc51af6ccf6685cfac6aff4dff66ed53e8bc" to "97c2a0e68d8acc8cfef9037a2b12dfb6683e436f"



---

archive/issue_comments_632448.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|\n|[97c2a0e](https://git.sagemath.org/sage.git/commit/?id=97c2a0e68d8acc8cfef9037a2b12dfb6683e436f)|`Fix conversion of Gaussian number field elements to AA.`|",
    "created_at": "2021-05-11T01:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31808#issuecomment-632448",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
|[97c2a0e](https://git.sagemath.org/sage.git/commit/?id=97c2a0e68d8acc8cfef9037a2b12dfb6683e436f)|`Fix conversion of Gaussian number field elements to AA.`|



---

archive/issue_comments_632449.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|\n|[157c525](https://git.sagemath.org/sage.git/commit/?id=157c5253b1fd8e9bc2331302b5e5dd48653cba50)|`Fix conversion of Gaussian number field elements to AA.`|",
    "created_at": "2021-05-11T01:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31808#issuecomment-632449",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
|[157c525](https://git.sagemath.org/sage.git/commit/?id=157c5253b1fd8e9bc2331302b5e5dd48653cba50)|`Fix conversion of Gaussian number field elements to AA.`|



---

archive/issue_comments_632450.json:
```json
{
    "body": "Changing commit from \"97c2a0e68d8acc8cfef9037a2b12dfb6683e436f\" to \"157c5253b1fd8e9bc2331302b5e5dd48653cba50\"",
    "created_at": "2021-05-11T01:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31808#issuecomment-632450",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "97c2a0e68d8acc8cfef9037a2b12dfb6683e436f" to "157c5253b1fd8e9bc2331302b5e5dd48653cba50"



---

archive/issue_comments_632451.json:
```json
{
    "body": "<a id='comment:5'></a>\nI redid it to use `parts`, which is guaranteed to have a pair of rational numbers as output.",
    "created_at": "2021-05-11T01:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31808#issuecomment-632451",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
I redid it to use `parts`, which is guaranteed to have a pair of rational numbers as output.



---

archive/issue_comments_632452.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-05-11T07:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31808#issuecomment-632452",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_632453.json:
```json
{
    "body": "<a id='comment:6'></a>\nThank you!",
    "created_at": "2021-05-11T07:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31808#issuecomment-632453",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:6'></a>
Thank you!



---

archive/issue_comments_632454.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Marc Mezzarobba\"",
    "created_at": "2021-05-11T07:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31808#issuecomment-632454",
    "user": "https://github.com/mezzarobba"
}
```

Changing reviewer from "" to "Marc Mezzarobba"



---

archive/issue_comments_632455.json:
```json
{
    "body": "Changing branch from \"public/coercion/fix_guassian_aa-31808\" to \"157c5253b1fd8e9bc2331302b5e5dd48653cba50\"",
    "created_at": "2021-05-27T20:29:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31808#issuecomment-632455",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/coercion/fix_guassian_aa-31808" to "157c5253b1fd8e9bc2331302b5e5dd48653cba50"



---

archive/issue_events_084014.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-05-27T20:29:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31808",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31808#event-84014"
}
```



---

archive/issue_comments_632456.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-05-27T20:29:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31808#issuecomment-632456",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
