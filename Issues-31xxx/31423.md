# Issue 31423: Do not use sage-pip-uninstall for PEP-517 packages, do not give up if sage-pip-uninstall fails

archive/issues_031186.json:
```json
{
    "body": "`sage-pip-uninstall` is invoked before installing a Python package to \"force-uninstall\" an existing installation. This (1) predates the use of the staging install (`DESTDIR`), which we use for all Python packages; (2) depends on packages supporting `setup.py --name`.\n\nAs a step toward retiring this mechanism, we \n- do not call `sage-pip-uninstall` for PEP-517 packages without `setup.py`\n- make it only a warning if the `sage-pip-uninstall` script fails.\n\nThis is necessary for some upgrades attempted in #31280 and also works around a failure observed on `cygwin-standard` (likely because `setup.py --name` printed extra output that the script cannot parse) -https://github.com/mkoeppe/sage/runs/1943937811\n\n```\n  [scipy-1.5.4]   Package 'scipy' is currently not installed\n  [scipy-1.5.4]   No legacy uninstaller found for 'scipy'; nothing to do\n  [scipy-1.5.4]   Note: CFLAGS, CXXFLAGS and SHAREDFLAGS are taken from distutils,\n  [scipy-1.5.4]         so their current settings are ignored.\n  [scipy-1.5.4]   Installing scipy-1.5.4\n  [scipy-1.5.4]   Error: could not determine package name\n  [scipy-1.5.4]   ********************************************************************************\n  [scipy-1.5.4]   Error uninstalling a previous version of scipy-1.5.4\n  [scipy-1.5.4]   ********************************************************************************\n  [scipy-1.5.4]   \n  [scipy-1.5.4]   real\t0m2.368s\n  [scipy-1.5.4]   user\t0m0.590s\n  [scipy-1.5.4]   sys\t0m0.928s\n  [scipy-1.5.4]   ************************************************************************\n  [scipy-1.5.4]   Error installing package scipy-1.5.4\n```\n\nCC:  @embray @jhpalmieri @dimpase @kliem\n\nBranch/Commit: efe7523c40f1cc0321900e9f410e0dfaf17fa914\n\nReviewer: Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31423\n\n",
    "closed_at": "2021-03-18T22:32:26Z",
    "created_at": "2021-02-21T07:10:25Z",
    "labels": [
        "component: build",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Do not use sage-pip-uninstall for PEP-517 packages, do not give up if sage-pip-uninstall fails",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31423",
    "user": "https://github.com/mkoeppe"
}
```
`sage-pip-uninstall` is invoked before installing a Python package to "force-uninstall" an existing installation. This (1) predates the use of the staging install (`DESTDIR`), which we use for all Python packages; (2) depends on packages supporting `setup.py --name`.

As a step toward retiring this mechanism, we 
- do not call `sage-pip-uninstall` for PEP-517 packages without `setup.py`
- make it only a warning if the `sage-pip-uninstall` script fails.

This is necessary for some upgrades attempted in #31280 and also works around a failure observed on `cygwin-standard` (likely because `setup.py --name` printed extra output that the script cannot parse) -https://github.com/mkoeppe/sage/runs/1943937811

```
  [scipy-1.5.4]   Package 'scipy' is currently not installed
  [scipy-1.5.4]   No legacy uninstaller found for 'scipy'; nothing to do
  [scipy-1.5.4]   Note: CFLAGS, CXXFLAGS and SHAREDFLAGS are taken from distutils,
  [scipy-1.5.4]         so their current settings are ignored.
  [scipy-1.5.4]   Installing scipy-1.5.4
  [scipy-1.5.4]   Error: could not determine package name
  [scipy-1.5.4]   ********************************************************************************
  [scipy-1.5.4]   Error uninstalling a previous version of scipy-1.5.4
  [scipy-1.5.4]   ********************************************************************************
  [scipy-1.5.4]   
  [scipy-1.5.4]   real	0m2.368s
  [scipy-1.5.4]   user	0m0.590s
  [scipy-1.5.4]   sys	0m0.928s
  [scipy-1.5.4]   ************************************************************************
  [scipy-1.5.4]   Error installing package scipy-1.5.4
```

CC:  @embray @jhpalmieri @dimpase @kliem

Branch/Commit: efe7523c40f1cc0321900e9f410e0dfaf17fa914

Reviewer: Dima Pasechnik

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31423





---

archive/issue_comments_475861.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-02-27T19:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31423#issuecomment-475861",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_475862.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,8 @@\n-On cygwin-standard - https://github.com/mkoeppe/sage/runs/1943937811\n+`sage-pip-uninstall` is invoked before installing a Python package to \"force-uninstall\" an existing installation. This (1) predates the use of the staging install (`DESTDIR`), which we use for all Python packages; (2) depends on packages supporting `setup.py --name`.\n+\n+As a step toward retiring this mechanism, we make it only a warning if the `sage-pip-uninstall` script fails.\n+\n+This works around a failure observed on `cygwin-standard` (likely because `setup.py --name` printed extra output that the script cannot parse) -https://github.com/mkoeppe/sage/runs/1943937811\n \n ```\n   [scipy-1.5.4]   Package 'scipy' is currently not installed\n``````\n",
    "created_at": "2021-02-27T19:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31423#issuecomment-475862",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,8 @@
-On cygwin-standard - https://github.com/mkoeppe/sage/runs/1943937811
+`sage-pip-uninstall` is invoked before installing a Python package to "force-uninstall" an existing installation. This (1) predates the use of the staging install (`DESTDIR`), which we use for all Python packages; (2) depends on packages supporting `setup.py --name`.
+
+As a step toward retiring this mechanism, we make it only a warning if the `sage-pip-uninstall` script fails.
+
+This works around a failure observed on `cygwin-standard` (likely because `setup.py --name` printed extra output that the script cannot parse) -https://github.com/mkoeppe/sage/runs/1943937811
 
 ```
   [scipy-1.5.4]   Package 'scipy' is currently not installed
``````




---

archive/issue_comments_475863.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2021-02-27T19:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31423#issuecomment-475863",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_475864.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2021-02-27T19:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31423#issuecomment-475864",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_475865.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,28 @@\n+`sage-pip-uninstall` is invoked before installing a Python package to \"force-uninstall\" an existing installation. This (1) predates the use of the staging install (`DESTDIR`), which we use for all Python packages; (2) depends on packages supporting `setup.py --name`.\n \n+As a step toward retiring this mechanism, we \n+- do not call `sage-pip-uninstall` for PEP-517 packages\n+- make it only a warning if the `sage-pip-uninstall` script fails.\n+\n+This is necessary for some upgrades attempted in #31280 and also works around a failure observed on `cygwin-standard` (likely because `setup.py --name` printed extra output that the script cannot parse) -https://github.com/mkoeppe/sage/runs/1943937811\n+\n+```\n+  [scipy-1.5.4]   Package 'scipy' is currently not installed\n+  [scipy-1.5.4]   No legacy uninstaller found for 'scipy'; nothing to do\n+  [scipy-1.5.4]   Note: CFLAGS, CXXFLAGS and SHAREDFLAGS are taken from distutils,\n+  [scipy-1.5.4]         so their current settings are ignored.\n+  [scipy-1.5.4]   Installing scipy-1.5.4\n+  [scipy-1.5.4]   Error: could not determine package name\n+  [scipy-1.5.4]   ********************************************************************************\n+  [scipy-1.5.4]   Error uninstalling a previous version of scipy-1.5.4\n+  [scipy-1.5.4]   ********************************************************************************\n+  [scipy-1.5.4]   \n+  [scipy-1.5.4]   real\t0m2.368s\n+  [scipy-1.5.4]   user\t0m0.590s\n+  [scipy-1.5.4]   sys\t0m0.928s\n+  [scipy-1.5.4]   ************************************************************************\n+  [scipy-1.5.4]   Error installing package scipy-1.5.4\n+```\n \n Comment: 1\n \n``````\n",
    "created_at": "2021-03-10T02:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31423#issuecomment-475865",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,28 @@
+`sage-pip-uninstall` is invoked before installing a Python package to "force-uninstall" an existing installation. This (1) predates the use of the staging install (`DESTDIR`), which we use for all Python packages; (2) depends on packages supporting `setup.py --name`.
 
+As a step toward retiring this mechanism, we 
+- do not call `sage-pip-uninstall` for PEP-517 packages
+- make it only a warning if the `sage-pip-uninstall` script fails.
+
+This is necessary for some upgrades attempted in #31280 and also works around a failure observed on `cygwin-standard` (likely because `setup.py --name` printed extra output that the script cannot parse) -https://github.com/mkoeppe/sage/runs/1943937811
+
+```
+  [scipy-1.5.4]   Package 'scipy' is currently not installed
+  [scipy-1.5.4]   No legacy uninstaller found for 'scipy'; nothing to do
+  [scipy-1.5.4]   Note: CFLAGS, CXXFLAGS and SHAREDFLAGS are taken from distutils,
+  [scipy-1.5.4]         so their current settings are ignored.
+  [scipy-1.5.4]   Installing scipy-1.5.4
+  [scipy-1.5.4]   Error: could not determine package name
+  [scipy-1.5.4]   ********************************************************************************
+  [scipy-1.5.4]   Error uninstalling a previous version of scipy-1.5.4
+  [scipy-1.5.4]   ********************************************************************************
+  [scipy-1.5.4]   
+  [scipy-1.5.4]   real	0m2.368s
+  [scipy-1.5.4]   user	0m0.590s
+  [scipy-1.5.4]   sys	0m0.928s
+  [scipy-1.5.4]   ************************************************************************
+  [scipy-1.5.4]   Error installing package scipy-1.5.4
+```
 
 Comment: 1
 
``````




---

archive/issue_comments_475866.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-03-10T02:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31423#issuecomment-475866",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_475867.json:
```json
{
    "body": "<a id='comment:6'></a>(Commit efe7523 was previously on the branch of #31280.)",
    "created_at": "2021-03-10T02:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31423#issuecomment-475867",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>(Commit efe7523 was previously on the branch of #31280.)



---

archive/issue_comments_475868.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,28 @@\n+`sage-pip-uninstall` is invoked before installing a Python package to \"force-uninstall\" an existing installation. This (1) predates the use of the staging install (`DESTDIR`), which we use for all Python packages; (2) depends on packages supporting `setup.py --name`.\n \n+As a step toward retiring this mechanism, we \n+- do not call `sage-pip-uninstall` for PEP-517 packages without `setup.py`\n+- make it only a warning if the `sage-pip-uninstall` script fails.\n+\n+This is necessary for some upgrades attempted in #31280 and also works around a failure observed on `cygwin-standard` (likely because `setup.py --name` printed extra output that the script cannot parse) -https://github.com/mkoeppe/sage/runs/1943937811\n+\n+```\n+  [scipy-1.5.4]   Package 'scipy' is currently not installed\n+  [scipy-1.5.4]   No legacy uninstaller found for 'scipy'; nothing to do\n+  [scipy-1.5.4]   Note: CFLAGS, CXXFLAGS and SHAREDFLAGS are taken from distutils,\n+  [scipy-1.5.4]         so their current settings are ignored.\n+  [scipy-1.5.4]   Installing scipy-1.5.4\n+  [scipy-1.5.4]   Error: could not determine package name\n+  [scipy-1.5.4]   ********************************************************************************\n+  [scipy-1.5.4]   Error uninstalling a previous version of scipy-1.5.4\n+  [scipy-1.5.4]   ********************************************************************************\n+  [scipy-1.5.4]   \n+  [scipy-1.5.4]   real\t0m2.368s\n+  [scipy-1.5.4]   user\t0m0.590s\n+  [scipy-1.5.4]   sys\t0m0.928s\n+  [scipy-1.5.4]   ************************************************************************\n+  [scipy-1.5.4]   Error installing package scipy-1.5.4\n+```\n \n Comment: 1\n \n``````\n",
    "created_at": "2021-03-10T02:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31423#issuecomment-475868",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,28 @@
+`sage-pip-uninstall` is invoked before installing a Python package to "force-uninstall" an existing installation. This (1) predates the use of the staging install (`DESTDIR`), which we use for all Python packages; (2) depends on packages supporting `setup.py --name`.
 
+As a step toward retiring this mechanism, we 
+- do not call `sage-pip-uninstall` for PEP-517 packages without `setup.py`
+- make it only a warning if the `sage-pip-uninstall` script fails.
+
+This is necessary for some upgrades attempted in #31280 and also works around a failure observed on `cygwin-standard` (likely because `setup.py --name` printed extra output that the script cannot parse) -https://github.com/mkoeppe/sage/runs/1943937811
+
+```
+  [scipy-1.5.4]   Package 'scipy' is currently not installed
+  [scipy-1.5.4]   No legacy uninstaller found for 'scipy'; nothing to do
+  [scipy-1.5.4]   Note: CFLAGS, CXXFLAGS and SHAREDFLAGS are taken from distutils,
+  [scipy-1.5.4]         so their current settings are ignored.
+  [scipy-1.5.4]   Installing scipy-1.5.4
+  [scipy-1.5.4]   Error: could not determine package name
+  [scipy-1.5.4]   ********************************************************************************
+  [scipy-1.5.4]   Error uninstalling a previous version of scipy-1.5.4
+  [scipy-1.5.4]   ********************************************************************************
+  [scipy-1.5.4]   
+  [scipy-1.5.4]   real	0m2.368s
+  [scipy-1.5.4]   user	0m0.590s
+  [scipy-1.5.4]   sys	0m0.928s
+  [scipy-1.5.4]   ************************************************************************
+  [scipy-1.5.4]   Error installing package scipy-1.5.4
+```
 
 Comment: 1
 
``````




---

archive/issue_comments_475869.json:
```json
{
    "body": "<a id='comment:8'></a>Again seen in https://github.com/sagemath/sage/runs/2115956504\n\nLet's get this in, please.",
    "created_at": "2021-03-16T02:27:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31423#issuecomment-475869",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Again seen in https://github.com/sagemath/sage/runs/2115956504

Let's get this in, please.



---

archive/issue_comments_475870.json:
```json
{
    "body": "<a id='comment:9'></a>OK, https://github.com/mkoeppe/sage/actions/runs/606112478 looks OK",
    "created_at": "2021-03-16T10:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31423#issuecomment-475870",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>OK, https://github.com/mkoeppe/sage/actions/runs/606112478 looks OK



---

archive/issue_comments_475871.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-03-16T10:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31423#issuecomment-475871",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_475872.json:
```json
{
    "body": "<a id='comment:10'></a>Thank you!",
    "created_at": "2021-03-16T17:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31423#issuecomment-475872",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>Thank you!



---

archive/issue_events_082419.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-18T22:32:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31423",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31423#event-82419"
}
```



---

archive/issue_comments_475873.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-03-18T22:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31423",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31423#issuecomment-475873",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
