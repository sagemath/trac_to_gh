# Issue 31271: MR52: upgrade ubuntu system in docker image

archive/issues_031034.json:
```json
{
    "body": "Julian R\u00fcth ([`@`saraedum](https://gitlab.com/saraedum)) opened a merge request at https://gitlab.com/sagemath/sage/-/merge_requests/52:\n\n---\n\n```markdown\nthis fixes an issue with line endings in CI. The old version of\ngit on ubuntu xenial does not understand our .gitattributes or it does\nnot understand the .git directory that we copy into the docker build\ncontext from a much newer version of git. Anyway, the broken line\nendings are gone now.\n```\n\n\n\nBranch/Commit: 0a96413fee4736d6a02ef04110f55e284d50e72b\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Julian R\u00fcth\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31271\n\n",
    "closed_at": "2021-01-31T20:53:52Z",
    "created_at": "2021-01-21T02:51:24Z",
    "labels": [
        "component: docker",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "MR52: upgrade ubuntu system in docker image",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31271",
    "user": "https://trac.sagemath.org/admin/accounts/users/galois"
}
```
Julian Rüth ([`@`saraedum](https://gitlab.com/saraedum)) opened a merge request at https://gitlab.com/sagemath/sage/-/merge_requests/52:

---

```markdown
this fixes an issue with line endings in CI. The old version of
git on ubuntu xenial does not understand our .gitattributes or it does
not understand the .git directory that we copy into the docker build
context from a much newer version of git. Anyway, the broken line
endings are gone now.
```



Branch/Commit: 0a96413fee4736d6a02ef04110f55e284d50e72b

Reviewer: Frédéric Chapoton

Author: Julian Rüth

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31271





---

archive/issue_comments_620900.json:
```json
{
    "body": "<a id='comment:1'></a>\nstill fails on gitlab\n\nhere: https://gitlab.com/sagemath/dev/trac/-/pipelines/244687774",
    "created_at": "2021-01-21T08:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620900",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
still fails on gitlab

here: https://gitlab.com/sagemath/dev/trac/-/pipelines/244687774



---

archive/issue_comments_620901.json:
```json
{
    "body": "Description changed:\n``````diff\n\n``````\n",
    "created_at": "2021-01-21T08:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620901",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff

``````




---

archive/issue_comments_620902.json:
```json
{
    "body": "<a id='comment:2'></a>\nmaybe because latest is stuck at 9.0, though",
    "created_at": "2021-01-21T08:27:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620902",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>
maybe because latest is stuck at 9.0, though



---

archive/issue_comments_620903.json:
```json
{
    "body": "<a id='comment:3'></a>\nThe CI run for this branch is here: https://gitlab.com/sagemath/dev/sage/-/jobs/976444339\n\nIt seems to work since `git status --porcelain` does not report any pending changes anymore.",
    "created_at": "2021-01-21T11:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620903",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:3'></a>
The CI run for this branch is here: https://gitlab.com/sagemath/dev/sage/-/jobs/976444339

It seems to work since `git status --porcelain` does not report any pending changes anymore.



---

archive/issue_comments_620904.json:
```json
{
    "body": "<a id='comment:4'></a>\nWhile this fixes one problem, we now have a `[dochtml] Illegal instruction (core dumped)` in another CI step.",
    "created_at": "2021-01-21T12:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620904",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:4'></a>
While this fixes one problem, we now have a `[dochtml] Illegal instruction (core dumped)` in another CI step.



---

archive/issue_comments_620905.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-01-21T12:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620905",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_620906.json:
```json
{
    "body": "<a id='comment:5'></a>\nProbably happens because the image was built on Skylake and the tests ran on Sandy Bridge.",
    "created_at": "2021-01-21T12:07:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620906",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:5'></a>
Probably happens because the image was built on Skylake and the tests ran on Sandy Bridge.



---

archive/issue_comments_620907.json:
```json
{
    "body": "<a id='comment:6'></a>\nNew commits added to merge request.  I updated the commit SHA-1.  New commits:\n|                                                                                                                                          |                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|\n|[07fb9bf](https://github.com/sagemath/sagetrac-mirror/commit/07fb9bf6545961176e09561188534dce82e8882c)|`build docker image without CPU specific flags`|",
    "created_at": "2021-01-21T12:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620907",
    "user": "https://trac.sagemath.org/admin/accounts/users/galois"
}
```

<a id='comment:6'></a>
New commits added to merge request.  I updated the commit SHA-1.  New commits:
|                                                                                                                                          |                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|
|[07fb9bf](https://github.com/sagemath/sagetrac-mirror/commit/07fb9bf6545961176e09561188534dce82e8882c)|`build docker image without CPU specific flags`|



---

archive/issue_comments_620908.json:
```json
{
    "body": "Changing commit from \"27564533f7bd96abf89fb387e14ddf08bc99ff63\" to \"07fb9bf6545961176e09561188534dce82e8882c\"",
    "created_at": "2021-01-21T12:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620908",
    "user": "https://trac.sagemath.org/admin/accounts/users/galois"
}
```

Changing commit from "27564533f7bd96abf89fb387e14ddf08bc99ff63" to "07fb9bf6545961176e09561188534dce82e8882c"



---

archive/issue_comments_620909.json:
```json
{
    "body": "<a id='comment:7'></a>\nso needs review ?",
    "created_at": "2021-01-21T17:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620909",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>
so needs review ?



---

archive/issue_comments_620910.json:
```json
{
    "body": "<a id='comment:8'></a>\nYou already had `ENV SAGE_FAT_BINARY yes`, but you might be running into #29537 here",
    "created_at": "2021-01-21T17:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620910",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
You already had `ENV SAGE_FAT_BINARY yes`, but you might be running into #29537 here



---

archive/issue_comments_620911.json:
```json
{
    "body": "<a id='comment:9'></a>\nNew commits added to merge request.  I updated the commit SHA-1.  New commits:\n|                                                                                                                                          |                                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|\n|[0a96413](https://github.com/sagemath/sagetrac-mirror/commit/0a96413fee4736d6a02ef04110f55e284d50e72b)|`Revert \"build docker image without CPU specific flags\"`|",
    "created_at": "2021-01-21T20:04:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620911",
    "user": "https://trac.sagemath.org/admin/accounts/users/galois"
}
```

<a id='comment:9'></a>
New commits added to merge request.  I updated the commit SHA-1.  New commits:
|                                                                                                                                          |                                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|
|[0a96413](https://github.com/sagemath/sagetrac-mirror/commit/0a96413fee4736d6a02ef04110f55e284d50e72b)|`Revert "build docker image without CPU specific flags"`|



---

archive/issue_comments_620912.json:
```json
{
    "body": "Changing commit from \"07fb9bf6545961176e09561188534dce82e8882c\" to \"0a96413fee4736d6a02ef04110f55e284d50e72b\"",
    "created_at": "2021-01-21T20:04:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620912",
    "user": "https://trac.sagemath.org/admin/accounts/users/galois"
}
```

Changing commit from "07fb9bf6545961176e09561188534dce82e8882c" to "0a96413fee4736d6a02ef04110f55e284d50e72b"



---

archive/issue_comments_620913.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [chapoton](#comment%3A2):\n> maybe because latest is stuck at 9.0, though\n\n\nIt fails on gitlab because the sagemath-dev:develop image is broken. (due to this very issue.)\n\nI ran it in a separate pipeline and it seemed to work.",
    "created_at": "2021-01-21T20:05:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620913",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:10'></a>
Replying to [chapoton](#comment%3A2):
> maybe because latest is stuck at 9.0, though


It fails on gitlab because the sagemath-dev:develop image is broken. (due to this very issue.)

I ran it in a separate pipeline and it seemed to work.



---

archive/issue_comments_620914.json:
```json
{
    "body": "<a id='comment:11'></a>\nLet's not worry about the SAGE_FAT_BINARY issue here. That's a different problem.",
    "created_at": "2021-01-21T20:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620914",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:11'></a>
Let's not worry about the SAGE_FAT_BINARY issue here. That's a different problem.



---

archive/issue_comments_620915.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-01-21T20:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620915",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_620916.json:
```json
{
    "body": "<a id='comment:12'></a>\nok, let's move on",
    "created_at": "2021-01-21T20:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620916",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>
ok, let's move on



---

archive/issue_comments_620917.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2021-01-21T20:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620917",
    "user": "https://github.com/fchapoton"
}
```

Changing reviewer from "" to "Frédéric Chapoton"



---

archive/issue_comments_620918.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-01-21T20:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620918",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_092100.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-01-31T20:53:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31271#event-92100"
}
```



---

archive/issue_comments_620919.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-01-31T20:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620919",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_620920.json:
```json
{
    "body": "Changing branch from \"u/galois/mrs/52/docker-attributes\" to \"0a96413fee4736d6a02ef04110f55e284d50e72b\"",
    "created_at": "2021-01-31T20:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31271#issuecomment-620920",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/galois/mrs/52/docker-attributes" to "0a96413fee4736d6a02ef04110f55e284d50e72b"
