# Issue 31002: Specify bdist temp folder for WSL compatibility

archive/issues_030765.json:
```json
{
    "body": "On WSL, `bdist_wheel` sometimes encounters strange permission errors (when the source folder is a Windows folder mounted in WSL), see https://github.com/pypa/packaging-problems/issues/258. In the linked issue, a solution is described by changing the permissions for authenticated users, but it didn't work for me. Thus I've implemented the workaround mentioned in https://github.com/pypa/packaging-problems/issues/258#issuecomment-548148041 and specified an explicit bdist directory in the Linux system. \n\nCC:  @mkoeppe\n\nKeywords: sd111\n\nBranch/Commit: fb10429b974d649741c67077ed50a00815880932\n\nReviewer: Matthias Koeppe, Tobias Diez\n\nAuthor: Tobias Diez, Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31002\n\n",
    "closed_at": "2020-12-13T20:31:20Z",
    "created_at": "2020-12-04T10:46:26Z",
    "labels": [
        "component: build",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Specify bdist temp folder for WSL compatibility",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31002",
    "user": "https://github.com/tobiasdiez"
}
```
On WSL, `bdist_wheel` sometimes encounters strange permission errors (when the source folder is a Windows folder mounted in WSL), see https://github.com/pypa/packaging-problems/issues/258. In the linked issue, a solution is described by changing the permissions for authenticated users, but it didn't work for me. Thus I've implemented the workaround mentioned in https://github.com/pypa/packaging-problems/issues/258#issuecomment-548148041 and specified an explicit bdist directory in the Linux system. 

CC:  @mkoeppe

Keywords: sd111

Branch/Commit: fb10429b974d649741c67077ed50a00815880932

Reviewer: Matthias Koeppe, Tobias Diez

Author: Tobias Diez, Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31002





---

archive/issue_comments_607410.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-12-04T10:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607410",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_607411.json:
```json
{
    "body": "<a id='comment:2'></a>\nThanks for tracking down this problem. \n\nI don't think using `~/temp/` is a good idea, though.\nI think a better solution would be to use the command `mktemp -d` to create a directory in the system directory for temporary files.",
    "created_at": "2020-12-04T18:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607411",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
Thanks for tracking down this problem. 

I don't think using `~/temp/` is a good idea, though.
I think a better solution would be to use the command `mktemp -d` to create a directory in the system directory for temporary files.



---

archive/issue_comments_607412.json:
```json
{
    "body": "Changing commit from \"a8e0364dc6ff16a799b64670e75f05a4dfac3b1e\" to \"a3077c71f488ddb2b6fe4058cbbc981d02d7ba95\"",
    "created_at": "2020-12-05T13:56:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607412",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a8e0364dc6ff16a799b64670e75f05a4dfac3b1e" to "a3077c71f488ddb2b6fe4058cbbc981d02d7ba95"



---

archive/issue_comments_607413.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------|\n|[a3077c7](https://github.com/sagemath/sagetrac-mirror/commit/a3077c71f488ddb2b6fe4058cbbc981d02d7ba95)|`Use mktemp`|",
    "created_at": "2020-12-05T13:56:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607413",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |            |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------|
|[a3077c7](https://github.com/sagemath/sagetrac-mirror/commit/a3077c71f488ddb2b6fe4058cbbc981d02d7ba95)|`Use mktemp`|



---

archive/issue_comments_607414.json:
```json
{
    "body": "<a id='comment:4'></a>\nok done",
    "created_at": "2020-12-05T13:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607414",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:4'></a>
ok done



---

archive/issue_comments_607415.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe temporary directory should probably be removed afterwards...\n\nProbably best to create a new function `sdh_setup_bdist_wheel` in `build/bin/sage-dist-helpers` for that",
    "created_at": "2020-12-05T17:51:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607415",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
The temporary directory should probably be removed afterwards...

Probably best to create a new function `sdh_setup_bdist_wheel` in `build/bin/sage-dist-helpers` for that



---

archive/issue_comments_607416.json:
```json
{
    "body": "<a id='comment:6'></a>\nUnless `--keep-temp` is specified, the bdist directory is cleaned up anyway. https://setuptools.readthedocs.io/en/latest/userguide/commands.html#bdist-egg-create-a-python-egg-for-the-project",
    "created_at": "2020-12-05T19:32:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607416",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:6'></a>
Unless `--keep-temp` is specified, the bdist directory is cleaned up anyway. https://setuptools.readthedocs.io/en/latest/userguide/commands.html#bdist-egg-create-a-python-egg-for-the-project



---

archive/issue_comments_607417.json:
```json
{
    "body": "<a id='comment:7'></a>\nBut the directory is not removed as far as I can see",
    "created_at": "2020-12-05T19:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607417",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
But the directory is not removed as far as I can see



---

archive/issue_comments_607418.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [mkoeppe](#comment%3A7):\n> But the directory is not removed as far as I can see\n\n\nProbably. If you think this is a problem, I would like to ask you to implement your suggestion with the `sage-dist-helpers`. My shell knowledge is sadly not good enough for this.",
    "created_at": "2020-12-05T20:18:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607418",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:8'></a>
Replying to [mkoeppe](#comment%3A7):
> But the directory is not removed as far as I can see


Probably. If you think this is a problem, I would like to ask you to implement your suggestion with the `sage-dist-helpers`. My shell knowledge is sadly not good enough for this.



---

archive/issue_comments_607419.json:
```json
{
    "body": "<a id='comment:9'></a>\nOK, will do",
    "created_at": "2020-12-05T20:44:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607419",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
OK, will do



---

archive/issue_comments_607420.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-12-05T20:44:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607420",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_607421.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|\n|[c5a14a3](https://github.com/sagemath/sagetrac-mirror/commit/c5a14a396fd1f1cd2de0d6fd465e546b7ff0b33b)|`build/bin/sage-dist-helpers (sdh_setup_bdist_wheel): New`|",
    "created_at": "2020-12-05T21:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607421",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|
|[c5a14a3](https://github.com/sagemath/sagetrac-mirror/commit/c5a14a396fd1f1cd2de0d6fd465e546b7ff0b33b)|`build/bin/sage-dist-helpers (sdh_setup_bdist_wheel): New`|



---

archive/issue_comments_607422.json:
```json
{
    "body": "Changing commit from \"a3077c71f488ddb2b6fe4058cbbc981d02d7ba95\" to \"c5a14a396fd1f1cd2de0d6fd465e546b7ff0b33b\"",
    "created_at": "2020-12-05T21:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607422",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a3077c71f488ddb2b6fe4058cbbc981d02d7ba95" to "c5a14a396fd1f1cd2de0d6fd465e546b7ff0b33b"



---

archive/issue_comments_607423.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [mkoeppe](#comment%3A7):\n> But the directory is not removed as far as I can see\n\n\nActually I was wrong about this",
    "created_at": "2020-12-05T21:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607423",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
Replying to [mkoeppe](#comment%3A7):
> But the directory is not removed as far as I can see


Actually I was wrong about this



---

archive/issue_comments_607424.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [gh-tobiasdiez](#comment%3A8):\n> I would like to ask you to implement your suggestion with the `sage-dist-helpers`.\n\n\nNevertheless I have implemented this function. Better to have it in one place.\n\nI have only changed it in the pillow install script, where it seems to work.\n\nCould you change the other ones?",
    "created_at": "2020-12-05T21:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607424",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
Replying to [gh-tobiasdiez](#comment%3A8):
> I would like to ask you to implement your suggestion with the `sage-dist-helpers`.


Nevertheless I have implemented this function. Better to have it in one place.

I have only changed it in the pillow install script, where it seems to work.

Could you change the other ones?



---

archive/issue_comments_607425.json:
```json
{
    "body": "<a id='comment:13'></a>\nHoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607425",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_comments_607426.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd111\".",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607426",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "" to "sd111".



---

archive/issue_comments_607427.json:
```json
{
    "body": "<a id='comment:14'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|\n|[fb10429](https://github.com/sagemath/sagetrac-mirror/commit/fb10429b974d649741c67077ed50a00815880932)|`build/pkgs/*/spkg-install.in: Use new function sdh_setup_bdist_wheel`|",
    "created_at": "2020-12-07T04:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607427",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|
|[fb10429](https://github.com/sagemath/sagetrac-mirror/commit/fb10429b974d649741c67077ed50a00815880932)|`build/pkgs/*/spkg-install.in: Use new function sdh_setup_bdist_wheel`|



---

archive/issue_comments_607428.json:
```json
{
    "body": "Changing commit from \"c5a14a396fd1f1cd2de0d6fd465e546b7ff0b33b\" to \"fb10429b974d649741c67077ed50a00815880932\"",
    "created_at": "2020-12-07T04:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607428",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c5a14a396fd1f1cd2de0d6fd465e546b7ff0b33b" to "fb10429b974d649741c67077ed50a00815880932"



---

archive/issue_comments_607429.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe, ...\"",
    "created_at": "2020-12-07T04:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607429",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Matthias Koeppe, ..."



---

archive/issue_comments_607430.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-12-07T04:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607430",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_607431.json:
```json
{
    "body": "Changing author from \"Tobias Diez\" to \"Tobias Diez, Matthias Koeppe\"",
    "created_at": "2020-12-07T04:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607431",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "Tobias Diez" to "Tobias Diez, Matthias Koeppe"



---

archive/issue_comments_607432.json:
```json
{
    "body": "<a id='comment:15'></a>\nChanged the remaining ones.",
    "created_at": "2020-12-07T04:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607432",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
Changed the remaining ones.



---

archive/issue_comments_607433.json:
```json
{
    "body": "<a id='comment:16'></a>\nThanks! LGTM",
    "created_at": "2020-12-07T12:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607433",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:16'></a>
Thanks! LGTM



---

archive/issue_comments_607434.json:
```json
{
    "body": "Changing reviewer from \"Matthias Koeppe, ...\" to \"Matthias Koeppe, Tobias Diez\"",
    "created_at": "2020-12-07T12:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607434",
    "user": "https://github.com/tobiasdiez"
}
```

Changing reviewer from "Matthias Koeppe, ..." to "Matthias Koeppe, Tobias Diez"



---

archive/issue_comments_607435.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-12-07T12:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607435",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_607436.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-On WSL, `bdist_wheel` sometimes encounters strange permission errors (when the source folder is a Windows folder mounted in WSL), see https://github.com/pypa/packaging-problems/issues/258. In the linked issue, a solution is described by changing the permissions for authenticated users, but it didn't worked for me. Thus I've implemented the workaround mentioned in https://github.com/pypa/packaging-problems/issues/258#issuecomment-548148041 and specified an explicit bdist directory in the Linux system. \n+On WSL, `bdist_wheel` sometimes encounters strange permission errors (when the source folder is a Windows folder mounted in WSL), see https://github.com/pypa/packaging-problems/issues/258. In the linked issue, a solution is described by changing the permissions for authenticated users, but it didn't work for me. Thus I've implemented the workaround mentioned in https://github.com/pypa/packaging-problems/issues/258#issuecomment-548148041 and specified an explicit bdist directory in the Linux system. \n``````\n",
    "created_at": "2020-12-10T02:19:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607436",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-On WSL, `bdist_wheel` sometimes encounters strange permission errors (when the source folder is a Windows folder mounted in WSL), see https://github.com/pypa/packaging-problems/issues/258. In the linked issue, a solution is described by changing the permissions for authenticated users, but it didn't worked for me. Thus I've implemented the workaround mentioned in https://github.com/pypa/packaging-problems/issues/258#issuecomment-548148041 and specified an explicit bdist directory in the Linux system. 
+On WSL, `bdist_wheel` sometimes encounters strange permission errors (when the source folder is a Windows folder mounted in WSL), see https://github.com/pypa/packaging-problems/issues/258. In the linked issue, a solution is described by changing the permissions for authenticated users, but it didn't work for me. Thus I've implemented the workaround mentioned in https://github.com/pypa/packaging-problems/issues/258#issuecomment-548148041 and specified an explicit bdist directory in the Linux system. 
``````




---

archive/issue_events_099114.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-13T20:31:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31002#event-99114"
}
```



---

archive/issue_comments_607437.json:
```json
{
    "body": "Changing branch from \"public/build/bdist_wsl\" to \"fb10429b974d649741c67077ed50a00815880932\"",
    "created_at": "2020-12-13T20:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607437",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/build/bdist_wsl" to "fb10429b974d649741c67077ed50a00815880932"



---

archive/issue_comments_607438.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-12-13T20:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31002#issuecomment-607438",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
