# Issue 31554: Wrong answer when evaluating a series inside a hold context

archive/issues_031317.json:
```json
{
    "body": "Analysis of the bug reported in #31530 revealed that evaluating a series inside a hold context can yield incorrect results or a crash:\n\n```\nsage: a,b,c = var(\"a b c\")\nsage: f(x) = (a + b*x).series(x, 2)\nsage: print(f\"f(c) = {f(c)},    f(1) = {f(1)}\")\nf(c) = b*c + a,    f(1) = a + b\nsage: with hold: \n....:     print(f(c)) \nb*(c)\nsage: with hold: \n....:     print(f(1))\n\n<segmentation fault>\n```\nThis bug was present at least as far back as v9.1. The segmentation fault seems to be from running out of memory. \n\nCC:  @dimpase @egourgoulhon\n\nKeywords: series, hold, segmentation fault\n\nReviewer: Dave Morris\n\nDependencies: #31479\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/31554\n\n",
    "closed_at": "2021-06-24T20:15:37Z",
    "created_at": "2021-03-25T01:46:27Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Wrong answer when evaluating a series inside a hold context",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31554",
    "user": "https://github.com/DaveWitteMorris"
}
```
Analysis of the bug reported in #31530 revealed that evaluating a series inside a hold context can yield incorrect results or a crash:

```
sage: a,b,c = var("a b c")
sage: f(x) = (a + b*x).series(x, 2)
sage: print(f"f(c) = {f(c)},    f(1) = {f(1)}")
f(c) = b*c + a,    f(1) = a + b
sage: with hold: 
....:     print(f(c)) 
b*(c)
sage: with hold: 
....:     print(f(1))

<segmentation fault>
```
This bug was present at least as far back as v9.1. The segmentation fault seems to be from running out of memory. 

CC:  @dimpase @egourgoulhon

Keywords: series, hold, segmentation fault

Reviewer: Dave Morris

Dependencies: #31479

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/31554





---

archive/issue_comments_619428.json:
```json
{
    "body": "<a id='comment:1'></a>\nHere is an example that seems very strange to me. Does the `()` in the final line mean that something returned `None` instead of `0`?\n\n```\nsage: f(x) = (cos(a + x) + b*x).series(x,2)\nsage: f\nx |--> (cos(a)) + (b - sin(a))*x + Order(x^2)\nsage: with hold: \n....:     print(f(0))\n(b - sin(a))*()\n```\nI have tentatively rated this ticket as a blocker because it gives wrong results in a quite simple situation, but perhaps we will soon see that its impact is limited.",
    "created_at": "2021-03-25T02:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619428",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:1'></a>
Here is an example that seems very strange to me. Does the `()` in the final line mean that something returned `None` instead of `0`?

```
sage: f(x) = (cos(a + x) + b*x).series(x,2)
sage: f
x |--> (cos(a)) + (b - sin(a))*x + Order(x^2)
sage: with hold: 
....:     print(f(0))
(b - sin(a))*()
```
I have tentatively rated this ticket as a blocker because it gives wrong results in a quite simple situation, but perhaps we will soon see that its impact is limited.



---

archive/issue_comments_619429.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe disappearance of `a` has nothing to do with series. There is a bug in the handling of `x^0`:\n\n```\nsage: a,b,c = var(\"a b c\")\nsage: with hold:\n....:    print((a*x^0).subs({x:c}))\n....:    print((a*x^0 + b*x^1).subs({x:c}))\n0*a\nb*c\n```",
    "created_at": "2021-03-26T06:41:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619429",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:2'></a>
The disappearance of `a` has nothing to do with series. There is a bug in the handling of `x^0`:

```
sage: a,b,c = var("a b c")
sage: with hold:
....:    print((a*x^0).subs({x:c}))
....:    print((a*x^0 + b*x^1).subs({x:c}))
0*a
b*c
```



---

archive/issue_comments_619430.json:
```json
{
    "body": "<a id='comment:3'></a>\nI know how to fix the `print(f(c))` example on this ticket. (The problem is that pynac's `handle_factor` method does not handle `x^0` correctly.) However, the same issue arises in three other (nearby) places in the code, so I have to do a bit more work before I upload a PR.\n\nAfter fixing this bug, I found another pynac method that does not handle `x^0` correctly. I opened  #31599 for this bug, and I opened #31597 to squash any other pynac bugs that arise in a hold context. I opened #31598 for the printing bug that was pointed out in[comment:1](#comment%3A1).\n\nI haven't yet tracked down the cause of the crash in the ticket description, but I don't expect it to be difficult.",
    "created_at": "2021-04-03T05:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619430",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:3'></a>
I know how to fix the `print(f(c))` example on this ticket. (The problem is that pynac's `handle_factor` method does not handle `x^0` correctly.) However, the same issue arises in three other (nearby) places in the code, so I have to do a bit more work before I upload a PR.

After fixing this bug, I found another pynac method that does not handle `x^0` correctly. I opened  #31599 for this bug, and I opened #31597 to squash any other pynac bugs that arise in a hold context. I opened #31598 for the printing bug that was pointed out in[comment:1](#comment%3A1).

I haven't yet tracked down the cause of the crash in the ticket description, but I don't expect it to be difficult.



---

archive/issue_comments_619431.json:
```json
{
    "body": "Changing branch from \"\" to \"public/31554\"",
    "created_at": "2021-04-05T00:26:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619431",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing branch from "" to "public/31554"



---

archive/issue_comments_619432.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe purpose of pynac's `handle_factor` method is to help convert `0*x` to `0` and `x^0` to `1`. The `print(f(c))` bug in the ticket description is a result of the fact that `handle_factor` erroneously converts `x^0` to `0`, instead of `1`.  The PR fixes the two places where this problem occurs, by eliminating the call to `handle_factor`.  \n\nThe other three calls to `handle_factor` in the pynac source code are essentially no-ops, so they should be removed.  I opened #31608 for this.\n\nI opened #31607 for fixing the `f(1)` segmentation fault.\n\n---\nNew commits:\n|                                                                                                                                          |                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|\n|[4bacd76](https://github.com/sagemath/sagetrac-mirror/commit/4bacd765e297f33ba67ed02b67fcdbf5729f0b29)|`trac 31554 do not use handle_factor`|\n|[00b44eb](https://github.com/sagemath/sagetrac-mirror/commit/00b44eb082cf37308879b28dd81c8ba37824511b)|`add doctest`|\n|[707560a](https://github.com/sagemath/sagetrac-mirror/commit/707560af492648a95db55271917374bfeffe9996)|`increment pynac patch number`|",
    "created_at": "2021-04-05T00:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619432",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:5'></a>
The purpose of pynac's `handle_factor` method is to help convert `0*x` to `0` and `x^0` to `1`. The `print(f(c))` bug in the ticket description is a result of the fact that `handle_factor` erroneously converts `x^0` to `0`, instead of `1`.  The PR fixes the two places where this problem occurs, by eliminating the call to `handle_factor`.  

The other three calls to `handle_factor` in the pynac source code are essentially no-ops, so they should be removed.  I opened #31608 for this.

I opened #31607 for fixing the `f(1)` segmentation fault.

---
New commits:
|                                                                                                                                          |                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
|[4bacd76](https://github.com/sagemath/sagetrac-mirror/commit/4bacd765e297f33ba67ed02b67fcdbf5729f0b29)|`trac 31554 do not use handle_factor`|
|[00b44eb](https://github.com/sagemath/sagetrac-mirror/commit/00b44eb082cf37308879b28dd81c8ba37824511b)|`add doctest`|
|[707560a](https://github.com/sagemath/sagetrac-mirror/commit/707560af492648a95db55271917374bfeffe9996)|`increment pynac patch number`|



---

archive/issue_comments_619433.json:
```json
{
    "body": "Changing author from \"\" to \"Dave Morris\"",
    "created_at": "2021-04-05T00:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619433",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing author from "" to "Dave Morris"



---

archive/issue_comments_619434.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-04-05T00:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619434",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_619435.json:
```json
{
    "body": "Changing commit from \"\" to \"707560af492648a95db55271917374bfeffe9996\"",
    "created_at": "2021-04-05T00:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619435",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing commit from "" to "707560af492648a95db55271917374bfeffe9996"



---

archive/issue_comments_619436.json:
```json
{
    "body": "Changing commit from \"707560af492648a95db55271917374bfeffe9996\" to \"82843fe4baefd24072af0ab8fdd16ff4b15ca30d\"",
    "created_at": "2021-04-05T00:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619436",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "707560af492648a95db55271917374bfeffe9996" to "82843fe4baefd24072af0ab8fdd16ff4b15ca30d"



---

archive/issue_comments_619437.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|\n|[82843fe](https://github.com/sagemath/sagetrac-mirror/commit/82843fe4baefd24072af0ab8fdd16ff4b15ca30d)|`remove debugging code`|",
    "created_at": "2021-04-05T00:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619437",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
|[82843fe](https://github.com/sagemath/sagetrac-mirror/commit/82843fe4baefd24072af0ab8fdd16ff4b15ca30d)|`remove debugging code`|



---

archive/issue_comments_619438.json:
```json
{
    "body": "<a id='comment:7'></a>\nOops! The branch I pushed had some test code (print statements) in the pynac patch.",
    "created_at": "2021-04-05T00:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619438",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:7'></a>
Oops! The branch I pushed had some test code (print statements) in the pynac patch.



---

archive/issue_comments_619439.json:
```json
{
    "body": "<a id='comment:8'></a>\nLGTM. Note all of these pynac patches should really become PRs to pynac, but it's fine as is for 9.3",
    "created_at": "2021-04-05T17:07:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619439",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
LGTM. Note all of these pynac patches should really become PRs to pynac, but it's fine as is for 9.3



---

archive/issue_comments_619440.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-04-05T17:07:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619440",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_619441.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-04-05T19:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619441",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_619442.json:
```json
{
    "body": "<a id='comment:9'></a>\nReviewer name missing",
    "created_at": "2021-04-05T19:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619442",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>
Reviewer name missing



---

archive/issue_comments_619443.json:
```json
{
    "body": "<a id='comment:10'></a>\nThanks for the review!",
    "created_at": "2021-04-05T21:53:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619443",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:10'></a>
Thanks for the review!



---

archive/issue_comments_619444.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe\"",
    "created_at": "2021-04-05T21:53:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619444",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing reviewer from "" to "Matthias Koeppe"



---

archive/issue_comments_619445.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-04-05T21:53:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619445",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_619446.json:
```json
{
    "body": "<a id='comment:11'></a>\nMerge conflict",
    "created_at": "2021-04-06T22:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619446",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>
Merge conflict



---

archive/issue_comments_619447.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-04-06T22:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619447",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_619448.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#31479\"",
    "created_at": "2021-04-06T23:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619448",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#31479"



---

archive/issue_comments_619449.json:
```json
{
    "body": "Changing commit from \"82843fe4baefd24072af0ab8fdd16ff4b15ca30d\" to \"b0b074e5bbd1ac31c29af7b08a274a7c313a28af\"",
    "created_at": "2021-04-06T23:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619449",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "82843fe4baefd24072af0ab8fdd16ff4b15ca30d" to "b0b074e5bbd1ac31c29af7b08a274a7c313a28af"



---

archive/issue_comments_619450.json:
```json
{
    "body": "<a id='comment:13'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|\n|[0f6dcc9](https://github.com/sagemath/sagetrac-mirror/commit/0f6dcc93996d4f6bb23256b7c7811a1c0e81ed70)|`Merge tag '9.3.rc2' into t/31554/public/31554`|\n|[270a2f9](https://github.com/sagemath/sagetrac-mirror/commit/270a2f96d6f5b1cc4ea540372c9e86858b2e045b)|`trac 31479: pynac's poly_mul_expand`|\n|[a2ebbeb](https://github.com/sagemath/sagetrac-mirror/commit/a2ebbeb60aaa48521b938eb98d7a2d061c7a20b1)|`add doctests`|\n|[b6f9170](https://github.com/sagemath/sagetrac-mirror/commit/b6f91708881e26205e362c3461614d2e5b88fc78)|`increment package version`|\n|[96b0f8b](https://github.com/sagemath/sagetrac-mirror/commit/96b0f8bd3c791f533989d92d026e9558fa880a5c)|`add 32-bit known bug tags`|\n|[ed6cac2](https://github.com/sagemath/sagetrac-mirror/commit/ed6cac27827b1c3c29014c8e6ebcd63bd736d889)|`Merge branch 'public/31554' of git://trac.sagemath.org/sage into t/31479/public/31479v2`|\n|[2364860](https://github.com/sagemath/sagetrac-mirror/commit/23648607ab7d56187c8da7baa1ca16ac782f5244)|`build/pkgs/pynac/package-version.txt: Bump patch level`|\n|[b0b074e](https://github.com/sagemath/sagetrac-mirror/commit/b0b074e5bbd1ac31c29af7b08a274a7c313a28af)|`Merge #31479`|",
    "created_at": "2021-04-06T23:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619450",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|
|[0f6dcc9](https://github.com/sagemath/sagetrac-mirror/commit/0f6dcc93996d4f6bb23256b7c7811a1c0e81ed70)|`Merge tag '9.3.rc2' into t/31554/public/31554`|
|[270a2f9](https://github.com/sagemath/sagetrac-mirror/commit/270a2f96d6f5b1cc4ea540372c9e86858b2e045b)|`trac 31479: pynac's poly_mul_expand`|
|[a2ebbeb](https://github.com/sagemath/sagetrac-mirror/commit/a2ebbeb60aaa48521b938eb98d7a2d061c7a20b1)|`add doctests`|
|[b6f9170](https://github.com/sagemath/sagetrac-mirror/commit/b6f91708881e26205e362c3461614d2e5b88fc78)|`increment package version`|
|[96b0f8b](https://github.com/sagemath/sagetrac-mirror/commit/96b0f8bd3c791f533989d92d026e9558fa880a5c)|`add 32-bit known bug tags`|
|[ed6cac2](https://github.com/sagemath/sagetrac-mirror/commit/ed6cac27827b1c3c29014c8e6ebcd63bd736d889)|`Merge branch 'public/31554' of git://trac.sagemath.org/sage into t/31479/public/31479v2`|
|[2364860](https://github.com/sagemath/sagetrac-mirror/commit/23648607ab7d56187c8da7baa1ca16ac782f5244)|`build/pkgs/pynac/package-version.txt: Bump patch level`|
|[b0b074e](https://github.com/sagemath/sagetrac-mirror/commit/b0b074e5bbd1ac31c29af7b08a274a7c313a28af)|`Merge #31479`|



---

archive/issue_comments_619451.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-04-07T00:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619451",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_619452.json:
```json
{
    "body": "<a id='comment:15'></a>\nCircular dependency",
    "created_at": "2021-04-10T11:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619452",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>
Circular dependency



---

archive/issue_comments_619453.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-04-10T11:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619453",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_619454.json:
```json
{
    "body": "Changing commit from \"b0b074e5bbd1ac31c29af7b08a274a7c313a28af\" to \"04d0090e3a36f4cee0868990ca9024b8d5dce5cd\"",
    "created_at": "2021-04-10T16:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619454",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b0b074e5bbd1ac31c29af7b08a274a7c313a28af" to "04d0090e3a36f4cee0868990ca9024b8d5dce5cd"



---

archive/issue_comments_619455.json:
```json
{
    "body": "<a id='comment:16'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|\n|[eeb6cc2](https://github.com/sagemath/sagetrac-mirror/commit/eeb6cc28b30923aeaaf26a4375683e20ee5c27df)|`build/pkgs/pynac/package-version.txt: Bump patch level`|\n|[04d0090](https://github.com/sagemath/sagetrac-mirror/commit/04d0090e3a36f4cee0868990ca9024b8d5dce5cd)|`Merge branch 'public/31479v2' of git://trac.sagemath.org/sage into t/31554/public/31554`|",
    "created_at": "2021-04-10T16:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619455",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|
|[eeb6cc2](https://github.com/sagemath/sagetrac-mirror/commit/eeb6cc28b30923aeaaf26a4375683e20ee5c27df)|`build/pkgs/pynac/package-version.txt: Bump patch level`|
|[04d0090](https://github.com/sagemath/sagetrac-mirror/commit/04d0090e3a36f4cee0868990ca9024b8d5dce5cd)|`Merge branch 'public/31479v2' of git://trac.sagemath.org/sage into t/31554/public/31554`|



---

archive/issue_comments_619456.json:
```json
{
    "body": "<a id='comment:17'></a>\nSorry for messing this up. I think I've got it right now.",
    "created_at": "2021-04-10T16:27:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619456",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Sorry for messing this up. I think I've got it right now.



---

archive/issue_comments_619457.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-04-10T16:27:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619457",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_619458.json:
```json
{
    "body": "<a id='comment:18'></a>\nOn 32-bit:\n\n```\n**********************************************************************\nFile \"src/sage/symbolic/expression.pyx\", line 4882, in sage.symbolic.expression.Expression.expand\nFailed example:\n    ((a + b + c)^30 * (3*b + d - 5/d)^3).expand().subs(a=0,b=2,c=-1)\nExpected:\n    d^3 + 18*d^2 + 93*d - 465/d + 450/d^2 - 125/d^3 + 36  \nGot:\n    d^3 + 18*d^2 + 1739461754973*d - 8697308774865/d + 450/d^2 - 125/d^3 + 36\n**********************************************************************\n1 item had failures:\n   1 of  43 in sage.symbolic.expression.Expression.expand\n    [2941 tests, 1 failure, 43.02 s]\n----------------------------------------------------------------------\nsage -t --long --random-seed=0 src/sage/symbolic/expression.pyx  # 1 doctest failed\n----------------------------------------------------------------------\n```",
    "created_at": "2021-04-12T21:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619458",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>
On 32-bit:

```
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 4882, in sage.symbolic.expression.Expression.expand
Failed example:
    ((a + b + c)^30 * (3*b + d - 5/d)^3).expand().subs(a=0,b=2,c=-1)
Expected:
    d^3 + 18*d^2 + 93*d - 465/d + 450/d^2 - 125/d^3 + 36  
Got:
    d^3 + 18*d^2 + 1739461754973*d - 8697308774865/d + 450/d^2 - 125/d^3 + 36
**********************************************************************
1 item had failures:
   1 of  43 in sage.symbolic.expression.Expression.expand
    [2941 tests, 1 failure, 43.02 s]
----------------------------------------------------------------------
sage -t --long --random-seed=0 src/sage/symbolic/expression.pyx  # 1 doctest failed
----------------------------------------------------------------------
```



---

archive/issue_comments_619459.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-04-12T21:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619459",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_619460.json:
```json
{
    "body": "<a id='comment:20'></a>\nThis is a known bug on 32-bit.  (See #31585.)  In commit [96b0f8b](https://github.com/sagemath/sagetrac-mirror/commit/96b0f8bd3c791f533989d92d026e9558fa880a5c) of ticket #31479, I added a `# 32-bit # known bug` tag to this line of the output. (And the tag shows up in the branch of this ticket, even though it's not in the expected output of the failed doctest.) Was that the wrong thing to do? I don't know much about doctesting and I couldn't find any examples to emulate in the sage source code.\n\nHow are we supposed to handle the doctest in this situation where 32-bit gives a wrong answer? (64-bit works correctly.)",
    "created_at": "2021-04-17T03:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619460",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:20'></a>
This is a known bug on 32-bit.  (See #31585.)  In commit [96b0f8b](https://github.com/sagemath/sagetrac-mirror/commit/96b0f8bd3c791f533989d92d026e9558fa880a5c) of ticket #31479, I added a `# 32-bit # known bug` tag to this line of the output. (And the tag shows up in the branch of this ticket, even though it's not in the expected output of the failed doctest.) Was that the wrong thing to do? I don't know much about doctesting and I couldn't find any examples to emulate in the sage source code.

How are we supposed to handle the doctest in this situation where 32-bit gives a wrong answer? (64-bit works correctly.)



---

archive/issue_comments_619461.json:
```json
{
    "body": "<a id='comment:21'></a>\nSorry, it looks like I lost this commit when I rebased #31479.  It's not in 9.3.rc3 as far as I can see.",
    "created_at": "2021-04-17T03:51:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619461",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
Sorry, it looks like I lost this commit when I rebased #31479.  It's not in 9.3.rc3 as far as I can see.



---

archive/issue_comments_619462.json:
```json
{
    "body": "<a id='comment:22'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|\n|[3fde2ac](https://github.com/sagemath/sagetrac-mirror/commit/3fde2acf9f76c5c4f9eabb2e2a4accaa0dbd834f)|`trac 31479: pynac's poly_mul_expand`|\n|[5501577](https://github.com/sagemath/sagetrac-mirror/commit/550157780d8f7b5119290dda26672644666699ae)|`add doctests`|\n|[6bf6ec0](https://github.com/sagemath/sagetrac-mirror/commit/6bf6ec0b17fb1d492964678dda39a34430463fb8)|`increment package version`|\n|[296d4c7](https://github.com/sagemath/sagetrac-mirror/commit/296d4c76c67df66e7d8d1deb45a9dcda1ef5c327)|`add 32-bit known bug tags`|",
    "created_at": "2021-04-17T07:29:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619462",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
|[3fde2ac](https://github.com/sagemath/sagetrac-mirror/commit/3fde2acf9f76c5c4f9eabb2e2a4accaa0dbd834f)|`trac 31479: pynac's poly_mul_expand`|
|[5501577](https://github.com/sagemath/sagetrac-mirror/commit/550157780d8f7b5119290dda26672644666699ae)|`add doctests`|
|[6bf6ec0](https://github.com/sagemath/sagetrac-mirror/commit/6bf6ec0b17fb1d492964678dda39a34430463fb8)|`increment package version`|
|[296d4c7](https://github.com/sagemath/sagetrac-mirror/commit/296d4c76c67df66e7d8d1deb45a9dcda1ef5c327)|`add 32-bit known bug tags`|



---

archive/issue_comments_619463.json:
```json
{
    "body": "Changing commit from \"04d0090e3a36f4cee0868990ca9024b8d5dce5cd\" to \"296d4c76c67df66e7d8d1deb45a9dcda1ef5c327\"",
    "created_at": "2021-04-17T07:29:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619463",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "04d0090e3a36f4cee0868990ca9024b8d5dce5cd" to "296d4c76c67df66e7d8d1deb45a9dcda1ef5c327"



---

archive/issue_comments_619464.json:
```json
{
    "body": "<a id='comment:23'></a>\nSomehow the branches of #31479 and #31554 were switched.\n\nAnyway here's the rebase of what's missing in 9.3.rc3...",
    "created_at": "2021-04-17T07:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619464",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>
Somehow the branches of #31479 and #31554 were switched.

Anyway here's the rebase of what's missing in 9.3.rc3...



---

archive/issue_comments_619465.json:
```json
{
    "body": "<a id='comment:24'></a>\nI have put the branch on the new ticket #31679 now to clean up the confusion.",
    "created_at": "2021-04-17T18:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619465",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>
I have put the branch on the new ticket #31679 now to clean up the confusion.



---

archive/issue_events_101277.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-17T18:44:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31554#event-101277"
}
```



---

archive/issue_comments_619466.json:
```json
{
    "body": "Changing reviewer from \"Matthias Koeppe\" to \"\"",
    "created_at": "2021-04-17T18:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619466",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "Matthias Koeppe" to ""



---

archive/issue_comments_619467.json:
```json
{
    "body": "Changing author from \"Dave Morris\" to \"\"",
    "created_at": "2021-04-17T18:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619467",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "Dave Morris" to ""



---

archive/issue_comments_619468.json:
```json
{
    "body": "Changing branch from \"public/31554\" to \"\"",
    "created_at": "2021-04-17T18:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619468",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "public/31554" to ""



---

archive/issue_comments_619469.json:
```json
{
    "body": "Changing commit from \"296d4c76c67df66e7d8d1deb45a9dcda1ef5c327\" to \"\"",
    "created_at": "2021-04-17T18:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619469",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "296d4c76c67df66e7d8d1deb45a9dcda1ef5c327" to ""



---

archive/issue_comments_619470.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-04-17T18:45:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619470",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_619471.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-04-18T05:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619471",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_619472.json:
```json
{
    "body": "<a id='comment:26'></a>\nThe branch has been moved to #31679, so this ticket can be closed as a duplicate.",
    "created_at": "2021-04-18T05:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619472",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:26'></a>
The branch has been moved to #31679, so this ticket can be closed as a duplicate.



---

archive/issue_comments_619473.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dave Morris\"",
    "created_at": "2021-04-18T21:53:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619473",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing reviewer from "" to "Dave Morris"



---

archive/issue_comments_619474.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-06-24T20:15:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31554#issuecomment-619474",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid



---

archive/issue_events_101278.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-24T20:15:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31554",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31554#event-101278"
}
```
