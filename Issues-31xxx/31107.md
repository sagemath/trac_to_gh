# Issue 31107: using libgap for word problem in abelian group

archive/issues_030870.json:
```json
{
    "assignees": [],
    "body": "instead of pexpect gap\n\nmuch cleaner code\n\nCC:  @tscrim @slel\n\nComponent: **group theory**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nBranch/Commit: **[`4402c71`](https://github.com/sagemath/sagetrac-mirror/commit/4402c71b2625606486cf1aff68ed05e19abbe420)**\n\nReviewer: **Samuel Leli\u00e8vre**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31107_\n\n",
    "closed_at": "2021-01-03T12:15:29Z",
    "created_at": "2020-12-25T15:30:40Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20group%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "using libgap for word problem in abelian group",
    "type": "issue",
    "updated_at": "2021-01-03T12:15:29Z",
    "url": "https://github.com/sagemath/sage/issues/31107",
    "user": "https://github.com/fchapoton"
}
```
instead of pexpect gap

much cleaner code

CC:  @tscrim @slel

Component: **group theory**

Author: **Frédéric Chapoton**

Branch/Commit: **[`4402c71`](https://github.com/sagemath/sagetrac-mirror/commit/4402c71b2625606486cf1aff68ed05e19abbe420)**

Reviewer: **Samuel Lelièvre**

_Issue created by migration from https://trac.sagemath.org/ticket/31107_





---

archive/issue_events_425773.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-12-25T15:30:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31107#event-425773"
}
```



---

archive/issue_events_425774.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-12-25T15:30:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20group%20theory",
    "label_color": "0000ff",
    "label_name": "c: group theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31107#event-425774"
}
```



---

archive/issue_events_425775.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-12-25T15:30:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31107#event-425775"
}
```



---

archive/issue_events_425776.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-12-25T15:30:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31107#event-425776"
}
```



---

archive/issue_events_425777.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-12-25T15:31:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31107#event-425777"
}
```



---

archive/issue_comments_498432.json:
```json
{
    "body": "Commit: **[`1ef6a7f`](https://github.com/sagemath/sagetrac-mirror/commit/1ef6a7f2d72fa938da6498d2be35dcf631b3406c)**",
    "created_at": "2020-12-25T15:31:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31107#issuecomment-498432",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`1ef6a7f`](https://github.com/sagemath/sagetrac-mirror/commit/1ef6a7f2d72fa938da6498d2be35dcf631b3406c)**



---

archive/issue_comments_498433.json:
```json
{
    "body": "Branch: **[u/chapoton/31107](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/31107)**",
    "created_at": "2020-12-25T15:31:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31107#issuecomment-498433",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/31107](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/31107)**



---

archive/issue_comments_498434.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n instead of pexpect gap\n+\n+much cleaner code\n``````\n",
    "created_at": "2020-12-25T15:31:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31107#issuecomment-498434",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 instead of pexpect gap
+
+much cleaner code
``````




---

archive/issue_comments_498435.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1ef6a7f2d72fa938da6498d2be35dcf631b3406c\"><code>1ef6a7f</code></a></td><td><code>using libgap for worb_problem in abelian groups</code></td></tr></table>\n",
    "created_at": "2020-12-25T15:31:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31107#issuecomment-498435",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1ef6a7f2d72fa938da6498d2be35dcf631b3406c"><code>1ef6a7f</code></a></td><td><code>using libgap for worb_problem in abelian groups</code></td></tr></table>




---

archive/issue_comments_498436.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\ngreen bot, please review",
    "created_at": "2020-12-25T18:16:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31107#issuecomment-498436",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:2" align="right">comment:2</div>

green bot, please review



---

archive/issue_comments_498437.json:
```json
{
    "body": "Changed commit from **[`1ef6a7f`](https://github.com/sagemath/sagetrac-mirror/commit/1ef6a7f2d72fa938da6498d2be35dcf631b3406c)** to **[`4402c71`](https://github.com/sagemath/sagetrac-mirror/commit/4402c71b2625606486cf1aff68ed05e19abbe420)**",
    "created_at": "2020-12-25T20:33:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31107#issuecomment-498437",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1ef6a7f`](https://github.com/sagemath/sagetrac-mirror/commit/1ef6a7f2d72fa938da6498d2be35dcf631b3406c)** to **[`4402c71`](https://github.com/sagemath/sagetrac-mirror/commit/4402c71b2625606486cf1aff68ed05e19abbe420)**



---

archive/issue_comments_498438.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4402c71b2625606486cf1aff68ed05e19abbe420\"><code>4402c71</code></a></td><td><code>more libgap in abelian groups</code></td></tr></table>\n",
    "created_at": "2020-12-25T20:33:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31107#issuecomment-498438",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4402c71b2625606486cf1aff68ed05e19abbe420"><code>4402c71</code></a></td><td><code>more libgap in abelian groups</code></td></tr></table>




---

archive/issue_comments_498439.json:
```json
{
    "body": "Reviewer: **Samuel Leli\u00e8vre**",
    "created_at": "2020-12-26T17:06:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31107#issuecomment-498439",
    "user": "https://github.com/slel"
}
```

Reviewer: **Samuel Lelièvre**



---

archive/issue_comments_498440.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nBeaucoup plus propre en effet!\n\nQuelques retouches cosm\u00e9tiques optionnelles:\n\n```diff\n     from sage.libs.gap.libgap import libgap\n     A = libgap.AbelianGroup(g.parent().gens_orders())\n     gens = libgap.GeneratorsOfGroup(A)\n-\n     gap_g = libgap.Product([gi**Li for gi, Li in zip(gens, g.list())])\n-\n     gensH = [libgap.Product([gi**Li for gi, Li in zip(gens, w.list())])\n              for w in words]\n     H = libgap.Group(gensH)\n-\n     x = libgap.Factorization(H, gap_g)\n-\n-    resu = libgap.ExtRepOfObj(x).sage()  # (indice, power, indice, power, etc)\n+    ipipip = libgap.ExtRepOfObj(x).sage()  # (index, power, index, power, etc)\n-    indices = resu[0::2]\n-    powers = resu[1::2]\n+    # Want ((index, power), (index), power), etc) with indices shifted by one\n+    indpow = zip(((i - 1) for i in ipipip[0::2]), ipipip[1::2])\n     if verbose:\n-        v = '*'.join('(%s)^%s' % (words[indi - 1], powi)\n-                     for indi, powi in zip(indices, powers))\n+        v = '*'.join('(%s)^%s' % (words[indi], powi) for indi, powi in indpow)\n         print('%s = %s' % (g, v))\n-    return [[words[indi - 1], powi] for indi, powi in zip(indices, powers)]\n+    return [[words[indi], powi] for indi, powi in indpow]\n```\n\nou m\u00eame pour la fin:\n\n```diff\n-    resu = libgap.ExtRepOfObj(x).sage()  # (indice, power, indice, power, etc)\n+    ipipip = libgap.ExtRepOfObj(x).sage()  # (index, power, index, power, etc)\n-    indices = resu[0::2]\n-    powers = resu[1::2]\n+    # Want ((word, power), (word, power), etc)\n+    wordpow = zip(words[i - 1] for i in ipipip[0::2]), ipipip[1::2])\n     if verbose:\n-        v = '*'.join('(%s)^%s' % (words[indi - 1], powi)\n-                     for indi, powi in zip(indices, powers))\n+        v = '*'.join(f\"{wordi}^{powi}}\" for wordi, powi in wordpow)\n         print(f\"{g} = {v}\")\n-    return [[words[indi - 1], powi] for indi, powi in zip(indices, powers)]\n+    return [[wordi, powi] for wordi, powi in wordpow]\n```\n\nauquel cas la derni\u00e8re ligne pourrait aussi \u00eatre:\n\n```diff\n+    return [list(wp) for wp in wordpow]\n```\n\nPour le d\u00e9but on pourrait aussi proposer:\n\n```diff\n-    gap_g = libgap.Product([gi**Li for gi, Li in zip(gens, g.list())])\n-    gensH = [libgap.Product([gi**Li for gi, Li in zip(gens, w.list())])\n-             for w in words]\n+    gili = lambda h: libgap.Product([gi**Li for gi, Li in zip(gens, h.list())])\n+    gap_g = gili(g)\n+    gensH = [gili(w) for w in words]\n```\n\nRevue favorable de ma part avec ou sans ces modifications.",
    "created_at": "2020-12-26T17:06:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31107#issuecomment-498440",
    "user": "https://github.com/slel"
}
```

<div id="comment:4" align="right">comment:4</div>

Beaucoup plus propre en effet!

Quelques retouches cosmétiques optionnelles:

```diff
     from sage.libs.gap.libgap import libgap
     A = libgap.AbelianGroup(g.parent().gens_orders())
     gens = libgap.GeneratorsOfGroup(A)
-
     gap_g = libgap.Product([gi**Li for gi, Li in zip(gens, g.list())])
-
     gensH = [libgap.Product([gi**Li for gi, Li in zip(gens, w.list())])
              for w in words]
     H = libgap.Group(gensH)
-
     x = libgap.Factorization(H, gap_g)
-
-    resu = libgap.ExtRepOfObj(x).sage()  # (indice, power, indice, power, etc)
+    ipipip = libgap.ExtRepOfObj(x).sage()  # (index, power, index, power, etc)
-    indices = resu[0::2]
-    powers = resu[1::2]
+    # Want ((index, power), (index), power), etc) with indices shifted by one
+    indpow = zip(((i - 1) for i in ipipip[0::2]), ipipip[1::2])
     if verbose:
-        v = '*'.join('(%s)^%s' % (words[indi - 1], powi)
-                     for indi, powi in zip(indices, powers))
+        v = '*'.join('(%s)^%s' % (words[indi], powi) for indi, powi in indpow)
         print('%s = %s' % (g, v))
-    return [[words[indi - 1], powi] for indi, powi in zip(indices, powers)]
+    return [[words[indi], powi] for indi, powi in indpow]
```

ou même pour la fin:

```diff
-    resu = libgap.ExtRepOfObj(x).sage()  # (indice, power, indice, power, etc)
+    ipipip = libgap.ExtRepOfObj(x).sage()  # (index, power, index, power, etc)
-    indices = resu[0::2]
-    powers = resu[1::2]
+    # Want ((word, power), (word, power), etc)
+    wordpow = zip(words[i - 1] for i in ipipip[0::2]), ipipip[1::2])
     if verbose:
-        v = '*'.join('(%s)^%s' % (words[indi - 1], powi)
-                     for indi, powi in zip(indices, powers))
+        v = '*'.join(f"{wordi}^{powi}}" for wordi, powi in wordpow)
         print(f"{g} = {v}")
-    return [[words[indi - 1], powi] for indi, powi in zip(indices, powers)]
+    return [[wordi, powi] for wordi, powi in wordpow]
```

auquel cas la dernière ligne pourrait aussi être:

```diff
+    return [list(wp) for wp in wordpow]
```

Pour le début on pourrait aussi proposer:

```diff
-    gap_g = libgap.Product([gi**Li for gi, Li in zip(gens, g.list())])
-    gensH = [libgap.Product([gi**Li for gi, Li in zip(gens, w.list())])
-             for w in words]
+    gili = lambda h: libgap.Product([gi**Li for gi, Li in zip(gens, h.list())])
+    gap_g = gili(g)
+    gensH = [gili(w) for w in words]
```

Revue favorable de ma part avec ou sans ces modifications.



---

archive/issue_events_425778.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-12-27T08:56:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31107#event-425778"
}
```



---

archive/issue_events_425779.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-12-27T08:56:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31107#event-425779"
}
```



---

archive/issue_comments_498441.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nok, suggestions valables, mais j'ai pas trop envie de passer plus de temps sur ca.\n\ndonc je passe en \"positif\" dans l'etat actuel",
    "created_at": "2020-12-27T08:56:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31107#issuecomment-498441",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:5" align="right">comment:5</div>

ok, suggestions valables, mais j'ai pas trop envie de passer plus de temps sur ca.

donc je passe en "positif" dans l'etat actuel



---

archive/issue_events_425780.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-01-03T12:15:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31107#event-425780"
}
```



---

archive/issue_events_425781.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "79b9a681ec9aae5d488facd360dbc237e1784f5a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-01-03T12:15:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31107#event-425781"
}
```



---

archive/issue_comments_498442.json:
```json
{
    "body": "Changed branch from **[u/chapoton/31107](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/31107)** to **[`4402c71`](https://github.com/sagemath/sagetrac-mirror/commit/4402c71b2625606486cf1aff68ed05e19abbe420)**",
    "created_at": "2021-01-03T12:15:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31107#issuecomment-498442",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/31107](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/31107)** to **[`4402c71`](https://github.com/sagemath/sagetrac-mirror/commit/4402c71b2625606486cf1aff68ed05e19abbe420)**
