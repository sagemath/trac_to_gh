# Issue 31567: tox.ini: Add local-macos-nohomebrew environments, deployment targets 10.14, 10.15, 11.1

archive/issues_031330.json:
```json
{
    "body": "This will do a \"best effort\" isolation to avoid using a homebrew installation in `/usr/local` for anything except bootstrapping and unpacking xz tarballs + a little trick for liblzma.h, which is missing on macOS.\n\nTo test:\n\n```\n$ EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-nohomebrew-python3_xcode\n```\nIt can then be checked that no libraries from /usr/local leak in, using\n\n```\nfind prefix/lib -name \"*.so\" -o -name \"*.dylib*\" -exec otool -L {} \\;\n```\n(Building R is disabled because the R package build still pokes around in /usr/local and finds libintl and liblzma.)\n\nTo set specific deployment targets, use:\n\n```\n$ EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-10.14-nohomebrew-python3_xcode -- config.status\n$ EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-10.15-nohomebrew-python3_xcode -- config.status\n$ EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status\n```\n\n... and with python3.7 from XCode:\n\n```\n$ tox -e local-macos-10.14-nohomebrew-python3_xcode-python3.7 -- config.status\n```\n(Remove `config.status` from the end of these lines to have the actual build done.)\n\nThese environments allow building Sage for older macOS versions, for example for building a 10.14 distribution on a 10.15 machine. The wheels are then correctly tagged, for example `pplpy-0.8.6-cp38-cp38-macosx_10_14_x86_64.whl`.\n\nCannot go in the opposite direction (building for 11 on a 10.15 machine) -- because pip will refuse to install a previously built wheel that is tagged for 11.)\n\n\nCC:  @jhpalmieri @zlscherr\n\nBranch/Commit: [ed1a089963e3215ddfe1216ad01237396364519b](https://github.com/sagemath/sagetrac-mirror/commit/ed1a089963e3215ddfe1216ad01237396364519b)\n\nReviewer: John Palmieri\n\nAuthor: Matthias Koeppe\n\nDependencies: #31552, #31562, #31409, #31584\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31567\n\n",
    "closed_at": "2021-05-27T20:28:46Z",
    "created_at": "2021-03-26T21:36:43Z",
    "labels": [
        "component: porting",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "tox.ini: Add local-macos-nohomebrew environments, deployment targets 10.14, 10.15, 11.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31567",
    "user": "https://github.com/mkoeppe"
}
```
This will do a "best effort" isolation to avoid using a homebrew installation in `/usr/local` for anything except bootstrapping and unpacking xz tarballs + a little trick for liblzma.h, which is missing on macOS.

To test:

```
$ EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-nohomebrew-python3_xcode
```
It can then be checked that no libraries from /usr/local leak in, using

```
find prefix/lib -name "*.so" -o -name "*.dylib*" -exec otool -L {} \;
```
(Building R is disabled because the R package build still pokes around in /usr/local and finds libintl and liblzma.)

To set specific deployment targets, use:

```
$ EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-10.14-nohomebrew-python3_xcode -- config.status
$ EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-10.15-nohomebrew-python3_xcode -- config.status
$ EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status
```

... and with python3.7 from XCode:

```
$ tox -e local-macos-10.14-nohomebrew-python3_xcode-python3.7 -- config.status
```
(Remove `config.status` from the end of these lines to have the actual build done.)

These environments allow building Sage for older macOS versions, for example for building a 10.14 distribution on a 10.15 machine. The wheels are then correctly tagged, for example `pplpy-0.8.6-cp38-cp38-macosx_10_14_x86_64.whl`.

Cannot go in the opposite direction (building for 11 on a 10.15 machine) -- because pip will refuse to install a previously built wheel that is tagged for 11.)


CC:  @jhpalmieri @zlscherr

Branch/Commit: [ed1a089963e3215ddfe1216ad01237396364519b](https://github.com/sagemath/sagetrac-mirror/commit/ed1a089963e3215ddfe1216ad01237396364519b)

Reviewer: John Palmieri

Author: Matthias Koeppe

Dependencies: #31552, #31562, #31409, #31584

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31567





---

archive/issue_comments_628062.json:
```json
{
    "body": "Branch: [u/mkoeppe/tox_ini__add_local_macos_nohomebrew_environments](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/tox_ini__add_local_macos_nohomebrew_environments)",
    "created_at": "2021-03-26T23:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628062",
    "user": "https://github.com/mkoeppe"
}
```

Branch: [u/mkoeppe/tox_ini__add_local_macos_nohomebrew_environments](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/tox_ini__add_local_macos_nohomebrew_environments)



---

archive/issue_comments_628063.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|\n|[87e2dba](https://github.com/sagemath/sagetrac-mirror/commit/87e2dbaea7bf8a59d1ecb082871219e530218366)|`tox.ini: Add local-macos-nohomebrew and configuration facors macos-{10.14,10.15,11.1`}|",
    "created_at": "2021-03-27T00:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628063",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|
|[87e2dba](https://github.com/sagemath/sagetrac-mirror/commit/87e2dbaea7bf8a59d1ecb082871219e530218366)|`tox.ini: Add local-macos-nohomebrew and configuration facors macos-{10.14,10.15,11.1`}|



---

archive/issue_comments_628064.json:
```json
{
    "body": "Commit: [87e2dbaea7bf8a59d1ecb082871219e530218366](https://github.com/sagemath/sagetrac-mirror/commit/87e2dbaea7bf8a59d1ecb082871219e530218366)",
    "created_at": "2021-03-27T00:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628064",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Commit: [87e2dbaea7bf8a59d1ecb082871219e530218366](https://github.com/sagemath/sagetrac-mirror/commit/87e2dbaea7bf8a59d1ecb082871219e530218366)



---

archive/issue_events_093435.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "rename": {
        "from": "tox.ini: Add local-macos-nohomebrew environments",
        "to": "tox.ini: Add local-macos-nohomebrew environments, deployment targets 10.14, 10.15, 11.1"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31567#event-93435"
}
```



---

archive/issue_comments_628065.json:
```json
{
    "body": "Author: Matthias Koeppe",
    "created_at": "2021-03-27T00:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628065",
    "user": "https://github.com/mkoeppe"
}
```

Author: Matthias Koeppe



---

archive/issue_comments_628066.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,16 @@\n This will do a \"best effort\" isolation to avoid using a homebrew installation in `/usr/local` for anythings except bootstrapping and perhaps unpacking xz tarballs.\n \n+To test:\n \n+```\n+$ tox -e local-macos-nohomebrew-python3_xcode -- config.status\n+```\n+\n+To set specific deployment targets, use:\n+\n+```\n+$ tox -e local-macos-10.14-nohomebrew-python3_xcode -- config.status\n+$ tox -e local-macos-10.15-nohomebrew-python3_xcode -- config.status\n+$ tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status\n+```\n+\n``````\n",
    "created_at": "2021-03-27T00:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628066",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,16 @@
 This will do a "best effort" isolation to avoid using a homebrew installation in `/usr/local` for anythings except bootstrapping and perhaps unpacking xz tarballs.
 
+To test:
 
+```
+$ tox -e local-macos-nohomebrew-python3_xcode -- config.status
+```
+
+To set specific deployment targets, use:
+
+```
+$ tox -e local-macos-10.14-nohomebrew-python3_xcode -- config.status
+$ tox -e local-macos-10.15-nohomebrew-python3_xcode -- config.status
+$ tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status
+```
+
``````




---

archive/issue_comments_628067.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,3 +14,7 @@\n $ tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status\n ```\n \n+These environments allow building Sage for older macOS versions, for example for building a 10.14 distribution on a 10.15 machine. The wheels are then correctly tagged, for example `pplpy-0.8.6-cp38-cp38-macosx_10_14_x86_64.whl`.\n+\n+Cannot go in the opposite direction (building for 11 on a 10.15 machine) -- because pip will refuse to install a previously built wheel that is tagged for 11.)\n+\n``````\n",
    "created_at": "2021-03-27T01:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628067",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,3 +14,7 @@
 $ tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status
 ```
 
+These environments allow building Sage for older macOS versions, for example for building a 10.14 distribution on a 10.15 machine. The wheels are then correctly tagged, for example `pplpy-0.8.6-cp38-cp38-macosx_10_14_x86_64.whl`.
+
+Cannot go in the opposite direction (building for 11 on a 10.15 machine) -- because pip will refuse to install a previously built wheel that is tagged for 11.)
+
``````




---

archive/issue_comments_628068.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|\n|[1ed9302](https://github.com/sagemath/sagetrac-mirror/commit/1ed930292280bd3baa7cb3b72492c966fa204030)|`tox.ini: Add macos-{python3_xcode,nohomebrew}-python{3.7,3.8`}|",
    "created_at": "2021-03-27T02:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628068",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|
|[1ed9302](https://github.com/sagemath/sagetrac-mirror/commit/1ed930292280bd3baa7cb3b72492c966fa204030)|`tox.ini: Add macos-{python3_xcode,nohomebrew}-python{3.7,3.8`}|



---

archive/issue_comments_628069.json:
```json
{
    "body": "Changing commit from \"[87e2dbaea7bf8a59d1ecb082871219e530218366](https://github.com/sagemath/sagetrac-mirror/commit/87e2dbaea7bf8a59d1ecb082871219e530218366)\" to \"[1ed930292280bd3baa7cb3b72492c966fa204030](https://github.com/sagemath/sagetrac-mirror/commit/1ed930292280bd3baa7cb3b72492c966fa204030)\"",
    "created_at": "2021-03-27T02:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628069",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[87e2dbaea7bf8a59d1ecb082871219e530218366](https://github.com/sagemath/sagetrac-mirror/commit/87e2dbaea7bf8a59d1ecb082871219e530218366)" to "[1ed930292280bd3baa7cb3b72492c966fa204030](https://github.com/sagemath/sagetrac-mirror/commit/1ed930292280bd3baa7cb3b72492c966fa204030)"



---

archive/issue_comments_628070.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|\n|[0458f23](https://github.com/sagemath/sagetrac-mirror/commit/0458f2309b3f30a9445dd0196a130f4d41dafe44)|`tox.ini: Add macos-{python3_xcode,nohomebrew}-python{3.7,3.8`}|",
    "created_at": "2021-03-27T02:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628070",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|
|[0458f23](https://github.com/sagemath/sagetrac-mirror/commit/0458f2309b3f30a9445dd0196a130f4d41dafe44)|`tox.ini: Add macos-{python3_xcode,nohomebrew}-python{3.7,3.8`}|



---

archive/issue_comments_628071.json:
```json
{
    "body": "Changing commit from \"[1ed930292280bd3baa7cb3b72492c966fa204030](https://github.com/sagemath/sagetrac-mirror/commit/1ed930292280bd3baa7cb3b72492c966fa204030)\" to \"[0458f2309b3f30a9445dd0196a130f4d41dafe44](https://github.com/sagemath/sagetrac-mirror/commit/0458f2309b3f30a9445dd0196a130f4d41dafe44)\"",
    "created_at": "2021-03-27T02:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628071",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[1ed930292280bd3baa7cb3b72492c966fa204030](https://github.com/sagemath/sagetrac-mirror/commit/1ed930292280bd3baa7cb3b72492c966fa204030)" to "[0458f2309b3f30a9445dd0196a130f4d41dafe44](https://github.com/sagemath/sagetrac-mirror/commit/0458f2309b3f30a9445dd0196a130f4d41dafe44)"



---

archive/issue_comments_628072.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This will do a \"best effort\" isolation to avoid using a homebrew installation in `/usr/local` for anythings except bootstrapping and perhaps unpacking xz tarballs.\n+This will do a \"best effort\" isolation to avoid using a homebrew installation in `/usr/local` for anything except bootstrapping and unpacking xz tarballs + a little trick for liblzma.h, which is missing on macOS.\n \n To test:\n \n``````\n",
    "created_at": "2021-03-27T02:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628072",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This will do a "best effort" isolation to avoid using a homebrew installation in `/usr/local` for anythings except bootstrapping and perhaps unpacking xz tarballs.
+This will do a "best effort" isolation to avoid using a homebrew installation in `/usr/local` for anything except bootstrapping and unpacking xz tarballs + a little trick for liblzma.h, which is missing on macOS.
 
 To test:
 
``````




---

archive/issue_comments_628073.json:
```json
{
    "body": "<a id='comment:8'></a>\nThis is best tested together with #31552, #31562, which do some of the necessary isolation work.\n\nMore isolation work is needed at least for `pillow` and `freetype` - as observed in #31396#comment:32",
    "created_at": "2021-03-27T02:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628073",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
This is best tested together with #31552, #31562, which do some of the necessary isolation work.

More isolation work is needed at least for `pillow` and `freetype` - as observed in #31396#comment:32



---

archive/issue_comments_628074.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,6 +14,13 @@\n $ tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status\n ```\n \n+... and with python3.7 from XCode:\n+\n+```\n+tox -e local-macos-10.14-nohomebrew-python3_xcode-python3.7 -- config.status\n+```\n+(Remove `config.status` from the end of these lines to have the actual build done.)\n+\n These environments allow building Sage for older macOS versions, for example for building a 10.14 distribution on a 10.15 machine. The wheels are then correctly tagged, for example `pplpy-0.8.6-cp38-cp38-macosx_10_14_x86_64.whl`.\n \n Cannot go in the opposite direction (building for 11 on a 10.15 machine) -- because pip will refuse to install a previously built wheel that is tagged for 11.)\n``````\n",
    "created_at": "2021-03-27T02:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628074",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,6 +14,13 @@
 $ tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status
 ```
 
+... and with python3.7 from XCode:
+
+```
+tox -e local-macos-10.14-nohomebrew-python3_xcode-python3.7 -- config.status
+```
+(Remove `config.status` from the end of these lines to have the actual build done.)
+
 These environments allow building Sage for older macOS versions, for example for building a 10.14 distribution on a 10.15 machine. The wheels are then correctly tagged, for example `pplpy-0.8.6-cp38-cp38-macosx_10_14_x86_64.whl`.
 
 Cannot go in the opposite direction (building for 11 on a 10.15 machine) -- because pip will refuse to install a previously built wheel that is tagged for 11.)
``````




---

archive/issue_comments_628075.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,7 +17,7 @@\n ... and with python3.7 from XCode:\n \n ```\n-tox -e local-macos-10.14-nohomebrew-python3_xcode-python3.7 -- config.status\n+$ tox -e local-macos-10.14-nohomebrew-python3_xcode-python3.7 -- config.status\n ```\n (Remove `config.status` from the end of these lines to have the actual build done.)\n \n``````\n",
    "created_at": "2021-03-27T02:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628075",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,7 +17,7 @@
 ... and with python3.7 from XCode:
 
 ```
-tox -e local-macos-10.14-nohomebrew-python3_xcode-python3.7 -- config.status
+$ tox -e local-macos-10.14-nohomebrew-python3_xcode-python3.7 -- config.status
 ```
 (Remove `config.status` from the end of these lines to have the actual build done.)
 
``````




---

archive/issue_comments_628076.json:
```json
{
    "body": "Dependencies: #31552, #31562",
    "created_at": "2021-03-27T03:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628076",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: #31552, #31562



---

archive/issue_comments_628077.json:
```json
{
    "body": "Changing commit from \"[0458f2309b3f30a9445dd0196a130f4d41dafe44](https://github.com/sagemath/sagetrac-mirror/commit/0458f2309b3f30a9445dd0196a130f4d41dafe44)\" to \"[9d9c562060e86156064f3647e7b223054218c93d](https://github.com/sagemath/sagetrac-mirror/commit/9d9c562060e86156064f3647e7b223054218c93d)\"",
    "created_at": "2021-03-27T03:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628077",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[0458f2309b3f30a9445dd0196a130f4d41dafe44](https://github.com/sagemath/sagetrac-mirror/commit/0458f2309b3f30a9445dd0196a130f4d41dafe44)" to "[9d9c562060e86156064f3647e7b223054218c93d](https://github.com/sagemath/sagetrac-mirror/commit/9d9c562060e86156064f3647e7b223054218c93d)"



---

archive/issue_comments_628078.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------|\n|[8b5b273](https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827)|`build/pkgs/singular/checksums.ini: Use 4.2.0p1+2021-03-24+sage-2`|\n|[39629dd](https://github.com/sagemath/sagetrac-mirror/commit/39629dde5cecd74a30b102f25dfef9178546a2d0)|`Merge #31552`|\n|[1ef46d0](https://github.com/sagemath/sagetrac-mirror/commit/1ef46d0e96f00d9e7ba26f235950e90511aa2305)|`build/pkgs/giac: Add another patch in patches/autotools`|\n|[89f61d2](https://github.com/sagemath/sagetrac-mirror/commit/89f61d2acd527c659fd1a04239661c1bb172106d)|`build/pkgs/giac: Update to 1.6.0.47p3`|\n|[9d9c562](https://github.com/sagemath/sagetrac-mirror/commit/9d9c562060e86156064f3647e7b223054218c93d)|`Merge #31562`|",
    "created_at": "2021-03-27T03:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628078",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------|
|[8b5b273](https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827)|`build/pkgs/singular/checksums.ini: Use 4.2.0p1+2021-03-24+sage-2`|
|[39629dd](https://github.com/sagemath/sagetrac-mirror/commit/39629dde5cecd74a30b102f25dfef9178546a2d0)|`Merge #31552`|
|[1ef46d0](https://github.com/sagemath/sagetrac-mirror/commit/1ef46d0e96f00d9e7ba26f235950e90511aa2305)|`build/pkgs/giac: Add another patch in patches/autotools`|
|[89f61d2](https://github.com/sagemath/sagetrac-mirror/commit/89f61d2acd527c659fd1a04239661c1bb172106d)|`build/pkgs/giac: Update to 1.6.0.47p3`|
|[9d9c562](https://github.com/sagemath/sagetrac-mirror/commit/9d9c562060e86156064f3647e7b223054218c93d)|`Merge #31562`|



---

archive/issue_comments_628079.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-03-27T03:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628079",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_628080.json:
```json
{
    "body": "<a id='comment:14'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|\n|[236ea3c](https://github.com/sagemath/sagetrac-mirror/commit/236ea3c0219e5418d244c62d3289e13d14afeee1)|`tox.ini (macos-nohomebrew): Pass compiler configuration to configure using variables other than CC, CXX.`|",
    "created_at": "2021-03-28T00:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628080",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|
|[236ea3c](https://github.com/sagemath/sagetrac-mirror/commit/236ea3c0219e5418d244c62d3289e13d14afeee1)|`tox.ini (macos-nohomebrew): Pass compiler configuration to configure using variables other than CC, CXX.`|



---

archive/issue_comments_628081.json:
```json
{
    "body": "Changing commit from \"[9d9c562060e86156064f3647e7b223054218c93d](https://github.com/sagemath/sagetrac-mirror/commit/9d9c562060e86156064f3647e7b223054218c93d)\" to \"[236ea3c0219e5418d244c62d3289e13d14afeee1](https://github.com/sagemath/sagetrac-mirror/commit/236ea3c0219e5418d244c62d3289e13d14afeee1)\"",
    "created_at": "2021-03-28T00:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628081",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[9d9c562060e86156064f3647e7b223054218c93d](https://github.com/sagemath/sagetrac-mirror/commit/9d9c562060e86156064f3647e7b223054218c93d)" to "[236ea3c0219e5418d244c62d3289e13d14afeee1](https://github.com/sagemath/sagetrac-mirror/commit/236ea3c0219e5418d244c62d3289e13d14afeee1)"



---

archive/issue_comments_628082.json:
```json
{
    "body": "Changing commit from \"[236ea3c0219e5418d244c62d3289e13d14afeee1](https://github.com/sagemath/sagetrac-mirror/commit/236ea3c0219e5418d244c62d3289e13d14afeee1)\" to \"[92db4e40bf40a73be4570e159c4e5b36c1955451](https://github.com/sagemath/sagetrac-mirror/commit/92db4e40bf40a73be4570e159c4e5b36c1955451)\"",
    "created_at": "2021-03-28T00:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628082",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[236ea3c0219e5418d244c62d3289e13d14afeee1](https://github.com/sagemath/sagetrac-mirror/commit/236ea3c0219e5418d244c62d3289e13d14afeee1)" to "[92db4e40bf40a73be4570e159c4e5b36c1955451](https://github.com/sagemath/sagetrac-mirror/commit/92db4e40bf40a73be4570e159c4e5b36c1955451)"



---

archive/issue_comments_628083.json:
```json
{
    "body": "<a id='comment:15'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|\n|[92db4e4](https://github.com/sagemath/sagetrac-mirror/commit/92db4e40bf40a73be4570e159c4e5b36c1955451)|`tox.ini (macos-nohomebrew): Pass compiler configuration to configure using variables other than CC, CXX.`|",
    "created_at": "2021-03-28T00:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628083",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|
|[92db4e4](https://github.com/sagemath/sagetrac-mirror/commit/92db4e40bf40a73be4570e159c4e5b36c1955451)|`tox.ini (macos-nohomebrew): Pass compiler configuration to configure using variables other than CC, CXX.`|



---

archive/issue_comments_628084.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,15 +3,21 @@\n To test:\n \n ```\n-$ tox -e local-macos-nohomebrew-python3_xcode -- config.status\n+$ EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-nohomebrew-python3_xcode\n ```\n+It can then be checked that no libraries from /usr/local leak in, using\n+\n+```\n+find prefix/lib -name \"*.so\" -o -name \"*.dylib*\" -exec otool -L {} \\;\n+```\n+(Building R is disabled because the R package build still pokes around in /usr/local and finds libintl and liblzma.)\n \n To set specific deployment targets, use:\n \n ```\n-$ tox -e local-macos-10.14-nohomebrew-python3_xcode -- config.status\n-$ tox -e local-macos-10.15-nohomebrew-python3_xcode -- config.status\n-$ tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status\n+$ EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-10.14-nohomebrew-python3_xcode -- config.status\n+$ EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-10.15-nohomebrew-python3_xcode -- config.status\n+$ EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status\n ```\n \n ... and with python3.7 from XCode:\n``````\n",
    "created_at": "2021-03-28T01:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628084",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,15 +3,21 @@
 To test:
 
 ```
-$ tox -e local-macos-nohomebrew-python3_xcode -- config.status
+$ EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-nohomebrew-python3_xcode
 ```
+It can then be checked that no libraries from /usr/local leak in, using
+
+```
+find prefix/lib -name "*.so" -o -name "*.dylib*" -exec otool -L {} \;
+```
+(Building R is disabled because the R package build still pokes around in /usr/local and finds libintl and liblzma.)
 
 To set specific deployment targets, use:
 
 ```
-$ tox -e local-macos-10.14-nohomebrew-python3_xcode -- config.status
-$ tox -e local-macos-10.15-nohomebrew-python3_xcode -- config.status
-$ tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status
+$ EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-10.14-nohomebrew-python3_xcode -- config.status
+$ EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-10.15-nohomebrew-python3_xcode -- config.status
+$ EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status
 ```
 
 ... and with python3.7 from XCode:
``````




---

archive/issue_comments_628085.json:
```json
{
    "body": "Changing dependencies from \"#31552, #31562\" to \"#31552, #31562, #31409\"",
    "created_at": "2021-03-28T01:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628085",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#31552, #31562" to "#31552, #31562, #31409"



---

archive/issue_comments_628086.json:
```json
{
    "body": "<a id='comment:17'></a>\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n|                                                                                                                                           |                                                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|\n|[737b21c](https://github.com/sagemath/sagetrac-mirror/commit/737b21caeeeaa6616c7e25e80aecac8841dbf6e2)|`src/sage/stats/r.py: Mark all 2 doctests in this file as # optional - rpy2`|\n|[4403924](https://github.com/sagemath/sagetrac-mirror/commit/440392440805bbdf01d42e3d5f487d61231aaabf)|`src/sage/interfaces/r.py: Mark all tests # optional - rpy2`|\n|[405ebb9](https://github.com/sagemath/sagetrac-mirror/commit/405ebb976c6c8ccffd5b5350f1c7ec660301d797)|`More # optional - rpy2`|\n|[b7c1576](https://github.com/sagemath/sagetrac-mirror/commit/b7c157665b738e2f54a6bf217c0114c4180f7df9)|`Merge tag '9.3.beta8' into t/31409/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional`|\n|[ce3b35f](https://github.com/sagemath/sagetrac-mirror/commit/ce3b35fea3326528936af448d006119e6405626f)|`More # optional - r`|\n|[49c10c1](https://github.com/sagemath/sagetrac-mirror/commit/49c10c18991eed62d800f2fccc422a1a9e7555ce)|`Revert \"build/pkgs/{r,rpy2}: Downgrade to optional\"`|\n|[a67300b](https://github.com/sagemath/sagetrac-mirror/commit/a67300bd66731b67fac776cfde1d8e0157392ef5)|`Merge #30383`|\n|[f0a5fb5](https://github.com/sagemath/sagetrac-mirror/commit/f0a5fb5adafd3d4c82c9d736dc95f49c67e15c39)|`configure.ac: Add option --disable-r`|\n|[f04c134](https://github.com/sagemath/sagetrac-mirror/commit/f04c13484c85c5d07e76cc9f306e70553fc74c6c)|`Merge branch 't/30383/new_package_type__optional_enabled_by_default' into t/31409/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional`|\n|[7966b66](https://github.com/sagemath/sagetrac-mirror/commit/7966b662147c5f58807e0f9492b35c95e9322b36)|`Merge #31409`|",
    "created_at": "2021-03-28T01:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628086",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
|                                                                                                                                           |                                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|
|[737b21c](https://github.com/sagemath/sagetrac-mirror/commit/737b21caeeeaa6616c7e25e80aecac8841dbf6e2)|`src/sage/stats/r.py: Mark all 2 doctests in this file as # optional - rpy2`|
|[4403924](https://github.com/sagemath/sagetrac-mirror/commit/440392440805bbdf01d42e3d5f487d61231aaabf)|`src/sage/interfaces/r.py: Mark all tests # optional - rpy2`|
|[405ebb9](https://github.com/sagemath/sagetrac-mirror/commit/405ebb976c6c8ccffd5b5350f1c7ec660301d797)|`More # optional - rpy2`|
|[b7c1576](https://github.com/sagemath/sagetrac-mirror/commit/b7c157665b738e2f54a6bf217c0114c4180f7df9)|`Merge tag '9.3.beta8' into t/31409/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional`|
|[ce3b35f](https://github.com/sagemath/sagetrac-mirror/commit/ce3b35fea3326528936af448d006119e6405626f)|`More # optional - r`|
|[49c10c1](https://github.com/sagemath/sagetrac-mirror/commit/49c10c18991eed62d800f2fccc422a1a9e7555ce)|`Revert "build/pkgs/{r,rpy2}: Downgrade to optional"`|
|[a67300b](https://github.com/sagemath/sagetrac-mirror/commit/a67300bd66731b67fac776cfde1d8e0157392ef5)|`Merge #30383`|
|[f0a5fb5](https://github.com/sagemath/sagetrac-mirror/commit/f0a5fb5adafd3d4c82c9d736dc95f49c67e15c39)|`configure.ac: Add option --disable-r`|
|[f04c134](https://github.com/sagemath/sagetrac-mirror/commit/f04c13484c85c5d07e76cc9f306e70553fc74c6c)|`Merge branch 't/30383/new_package_type__optional_enabled_by_default' into t/31409/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional`|
|[7966b66](https://github.com/sagemath/sagetrac-mirror/commit/7966b662147c5f58807e0f9492b35c95e9322b36)|`Merge #31409`|



---

archive/issue_comments_628087.json:
```json
{
    "body": "Changing commit from \"[92db4e40bf40a73be4570e159c4e5b36c1955451](https://github.com/sagemath/sagetrac-mirror/commit/92db4e40bf40a73be4570e159c4e5b36c1955451)\" to \"[7966b662147c5f58807e0f9492b35c95e9322b36](https://github.com/sagemath/sagetrac-mirror/commit/7966b662147c5f58807e0f9492b35c95e9322b36)\"",
    "created_at": "2021-03-28T01:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628087",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[92db4e40bf40a73be4570e159c4e5b36c1955451](https://github.com/sagemath/sagetrac-mirror/commit/92db4e40bf40a73be4570e159c4e5b36c1955451)" to "[7966b662147c5f58807e0f9492b35c95e9322b36](https://github.com/sagemath/sagetrac-mirror/commit/7966b662147c5f58807e0f9492b35c95e9322b36)"



---

archive/issue_comments_628088.json:
```json
{
    "body": "<a id='comment:19'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|\n|[b5edde2](https://github.com/sagemath/sagetrac-mirror/commit/b5edde2e54cc58bd151880293e6454c3f92150fe)|`tox.ini (macos-nohomebrew): Fix typo in PILLOW_...`|",
    "created_at": "2021-03-28T05:50:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628088",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|
|[b5edde2](https://github.com/sagemath/sagetrac-mirror/commit/b5edde2e54cc58bd151880293e6454c3f92150fe)|`tox.ini (macos-nohomebrew): Fix typo in PILLOW_...`|



---

archive/issue_comments_628089.json:
```json
{
    "body": "Changing commit from \"[7966b662147c5f58807e0f9492b35c95e9322b36](https://github.com/sagemath/sagetrac-mirror/commit/7966b662147c5f58807e0f9492b35c95e9322b36)\" to \"[b5edde2e54cc58bd151880293e6454c3f92150fe](https://github.com/sagemath/sagetrac-mirror/commit/b5edde2e54cc58bd151880293e6454c3f92150fe)\"",
    "created_at": "2021-03-28T05:50:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628089",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[7966b662147c5f58807e0f9492b35c95e9322b36](https://github.com/sagemath/sagetrac-mirror/commit/7966b662147c5f58807e0f9492b35c95e9322b36)" to "[b5edde2e54cc58bd151880293e6454c3f92150fe](https://github.com/sagemath/sagetrac-mirror/commit/b5edde2e54cc58bd151880293e6454c3f92150fe)"



---

archive/issue_comments_628090.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-03-28T06:02:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628090",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_628091.json:
```json
{
    "body": "<a id='comment:20'></a>\nNow pillow does not find zlib",
    "created_at": "2021-03-28T06:02:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628091",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>
Now pillow does not find zlib



---

archive/issue_comments_628092.json:
```json
{
    "body": "<a id='comment:21'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|\n|[dffcdbc](https://github.com/sagemath/sagetrac-mirror/commit/dffcdbc75e46d08bcb1fd2ac9a5677a7a7312e2f)|`tox.ini (macos-nohomebrew): Fix up pillow build by setting ZLIB_ROOT`|",
    "created_at": "2021-03-28T06:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628092",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|
|[dffcdbc](https://github.com/sagemath/sagetrac-mirror/commit/dffcdbc75e46d08bcb1fd2ac9a5677a7a7312e2f)|`tox.ini (macos-nohomebrew): Fix up pillow build by setting ZLIB_ROOT`|



---

archive/issue_comments_628093.json:
```json
{
    "body": "Changing commit from \"[b5edde2e54cc58bd151880293e6454c3f92150fe](https://github.com/sagemath/sagetrac-mirror/commit/b5edde2e54cc58bd151880293e6454c3f92150fe)\" to \"[dffcdbc75e46d08bcb1fd2ac9a5677a7a7312e2f](https://github.com/sagemath/sagetrac-mirror/commit/dffcdbc75e46d08bcb1fd2ac9a5677a7a7312e2f)\"",
    "created_at": "2021-03-28T06:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628093",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[b5edde2e54cc58bd151880293e6454c3f92150fe](https://github.com/sagemath/sagetrac-mirror/commit/b5edde2e54cc58bd151880293e6454c3f92150fe)" to "[dffcdbc75e46d08bcb1fd2ac9a5677a7a7312e2f](https://github.com/sagemath/sagetrac-mirror/commit/dffcdbc75e46d08bcb1fd2ac9a5677a7a7312e2f)"



---

archive/issue_comments_628094.json:
```json
{
    "body": "<a id='comment:22'></a>\npillow still finds various libraries in `/usr/local` because of very creative discovery code that finds everything in `/usr/local` because we told it that it can have `/usr/local/opt/xz/include` - see `_add_directory` (https://github.com/python-pillow/Pillow/blob/8.1.x/setup.py#L197)",
    "created_at": "2021-03-29T01:26:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628094",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
pillow still finds various libraries in `/usr/local` because of very creative discovery code that finds everything in `/usr/local` because we told it that it can have `/usr/local/opt/xz/include` - see `_add_directory` (https://github.com/python-pillow/Pillow/blob/8.1.x/setup.py#L197)



---

archive/issue_comments_628095.json:
```json
{
    "body": "<a id='comment:23'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|\n|[3779a25](https://github.com/sagemath/sagetrac-mirror/commit/3779a2525d5bbf0987a1d4ad0e42b73fb5769bc0)|`tox.ini (macos-nohomebrew): Disable more libraries to remove dependencies on homebrew`|",
    "created_at": "2021-03-29T01:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628095",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|
|[3779a25](https://github.com/sagemath/sagetrac-mirror/commit/3779a2525d5bbf0987a1d4ad0e42b73fb5769bc0)|`tox.ini (macos-nohomebrew): Disable more libraries to remove dependencies on homebrew`|



---

archive/issue_comments_628096.json:
```json
{
    "body": "Changing commit from \"[dffcdbc75e46d08bcb1fd2ac9a5677a7a7312e2f](https://github.com/sagemath/sagetrac-mirror/commit/dffcdbc75e46d08bcb1fd2ac9a5677a7a7312e2f)\" to \"[3779a2525d5bbf0987a1d4ad0e42b73fb5769bc0](https://github.com/sagemath/sagetrac-mirror/commit/3779a2525d5bbf0987a1d4ad0e42b73fb5769bc0)\"",
    "created_at": "2021-03-29T01:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628096",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[dffcdbc75e46d08bcb1fd2ac9a5677a7a7312e2f](https://github.com/sagemath/sagetrac-mirror/commit/dffcdbc75e46d08bcb1fd2ac9a5677a7a7312e2f)" to "[3779a2525d5bbf0987a1d4ad0e42b73fb5769bc0](https://github.com/sagemath/sagetrac-mirror/commit/3779a2525d5bbf0987a1d4ad0e42b73fb5769bc0)"



---

archive/issue_comments_628097.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-03-29T02:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628097",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_628098.json:
```json
{
    "body": "<a id='comment:24'></a>\nFixed pillow. Now I can build a wheel in #31396 that does not have any dependencies on shared libraries in `/usr/local`.",
    "created_at": "2021-03-29T02:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628098",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>
Fixed pillow. Now I can build a wheel in #31396 that does not have any dependencies on shared libraries in `/usr/local`.



---

archive/issue_comments_628099.json:
```json
{
    "body": "<a id='comment:25'></a>\nFor what it's worth, I see a few suspicious items in the log files. (This is on a system with homebrew and with `source .homebrew-build-env` in my shell init file. That may be causing some of these.)\n\n- cvxopt includes flags `-L/usr/local/lib` and `-I/usr/local/include` when calling `gcc`\n- pillow says `Appending path /usr/local/Cellar/xz/5.2.5/include` and then the `gcc` flag `-I/usr/local/Cellar/xz/5.2.5/include`.",
    "created_at": "2021-03-30T22:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628099",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:25'></a>
For what it's worth, I see a few suspicious items in the log files. (This is on a system with homebrew and with `source .homebrew-build-env` in my shell init file. That may be causing some of these.)

- cvxopt includes flags `-L/usr/local/lib` and `-I/usr/local/include` when calling `gcc`
- pillow says `Appending path /usr/local/Cellar/xz/5.2.5/include` and then the `gcc` flag `-I/usr/local/Cellar/xz/5.2.5/include`.



---

archive/issue_comments_628100.json:
```json
{
    "body": "<a id='comment:26'></a>\nThe xz include is on purpose -- see comment added in `tox.ini`",
    "created_at": "2021-03-30T22:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628100",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>
The xz include is on purpose -- see comment added in `tox.ini`



---

archive/issue_comments_628101.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [jhpalmieri](#comment%3A25):\n> For what it's worth, I see a few suspicious items in the log files. (This is on a system with homebrew and with `source .homebrew-build-env` in my shell init file. That may be causing some of these.)\n\n\nYes, this a good setting for testing this ticket. The build using tox is designed to be isolated from the effects of `.homebrew-build-env`. \n\n> - cvxopt includes flags `-L/usr/local/lib` and `-I/usr/local/include` when calling `gcc`\n\n\nThis is probably https://github.com/cvxopt/cvxopt/blob/master/setup.py#L55 in combination with a bug in our build system - #31584.",
    "created_at": "2021-03-30T22:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628101",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
Replying to [jhpalmieri](#comment%3A25):
> For what it's worth, I see a few suspicious items in the log files. (This is on a system with homebrew and with `source .homebrew-build-env` in my shell init file. That may be causing some of these.)


Yes, this a good setting for testing this ticket. The build using tox is designed to be isolated from the effects of `.homebrew-build-env`. 

> - cvxopt includes flags `-L/usr/local/lib` and `-I/usr/local/include` when calling `gcc`


This is probably https://github.com/cvxopt/cvxopt/blob/master/setup.py#L55 in combination with a bug in our build system - #31584.



---

archive/issue_comments_628102.json:
```json
{
    "body": "Changing dependencies from \"#31552, #31562, #31409\" to \"#31552, #31562, #31409, #31584\"",
    "created_at": "2021-03-30T22:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628102",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#31552, #31562, #31409" to "#31552, #31562, #31409, #31584"



---

archive/issue_comments_628103.json:
```json
{
    "body": "Changing commit from \"[3779a2525d5bbf0987a1d4ad0e42b73fb5769bc0](https://github.com/sagemath/sagetrac-mirror/commit/3779a2525d5bbf0987a1d4ad0e42b73fb5769bc0)\" to \"[ed1a089963e3215ddfe1216ad01237396364519b](https://github.com/sagemath/sagetrac-mirror/commit/ed1a089963e3215ddfe1216ad01237396364519b)\"",
    "created_at": "2021-03-30T22:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628103",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[3779a2525d5bbf0987a1d4ad0e42b73fb5769bc0](https://github.com/sagemath/sagetrac-mirror/commit/3779a2525d5bbf0987a1d4ad0e42b73fb5769bc0)" to "[ed1a089963e3215ddfe1216ad01237396364519b](https://github.com/sagemath/sagetrac-mirror/commit/ed1a089963e3215ddfe1216ad01237396364519b)"



---

archive/issue_comments_628104.json:
```json
{
    "body": "<a id='comment:29'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|\n|[7ff26df](https://github.com/sagemath/sagetrac-mirror/commit/7ff26dfad2f33fe2d020580a01db20efea20716f)|`git grep -l SAGE_SUITESPARSE | xargs sed -i .bak s/SAGE_SUITESPARSE_LOCALINSTALL/SAGE_SUITESPARSE_PREFIX/g`|\n|[52537d1](https://github.com/sagemath/sagetrac-mirror/commit/52537d120927ed57ce9659683fed15c405b1d1c7)|`build/pkgs/cvxopt/spkg-install.in: Actually use the value of SAGE_SUITESPARSE_PREFIX`|\n|[ed1a089](https://github.com/sagemath/sagetrac-mirror/commit/ed1a089963e3215ddfe1216ad01237396364519b)|`Merge #31584`|",
    "created_at": "2021-03-30T22:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628104",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|
|[7ff26df](https://github.com/sagemath/sagetrac-mirror/commit/7ff26dfad2f33fe2d020580a01db20efea20716f)|`git grep -l SAGE_SUITESPARSE | xargs sed -i .bak s/SAGE_SUITESPARSE_LOCALINSTALL/SAGE_SUITESPARSE_PREFIX/g`|
|[52537d1](https://github.com/sagemath/sagetrac-mirror/commit/52537d120927ed57ce9659683fed15c405b1d1c7)|`build/pkgs/cvxopt/spkg-install.in: Actually use the value of SAGE_SUITESPARSE_PREFIX`|
|[ed1a089](https://github.com/sagemath/sagetrac-mirror/commit/ed1a089963e3215ddfe1216ad01237396364519b)|`Merge #31584`|



---

archive/issue_comments_628105.json:
```json
{
    "body": "Reviewer: John Palmieri",
    "created_at": "2021-03-31T02:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628105",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: John Palmieri



---

archive/issue_comments_628106.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-03-31T02:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628106",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_628107.json:
```json
{
    "body": "<a id='comment:30'></a>\nOkay, this looks good to me.",
    "created_at": "2021-03-31T02:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628107",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:30'></a>
Okay, this looks good to me.



---

archive/issue_comments_628108.json:
```json
{
    "body": "<a id='comment:31'></a>\nThanks!",
    "created_at": "2021-03-31T02:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628108",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
Thanks!



---

archive/issue_comments_628109.json:
```json
{
    "body": "<a id='comment:32'></a>\nBy the way, should commands like `make distclean` also clean the `.tox` directory?",
    "created_at": "2021-03-31T02:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628109",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:32'></a>
By the way, should commands like `make distclean` also clean the `.tox` directory?



---

archive/issue_comments_628110.json:
```json
{
    "body": "<a id='comment:33'></a>\nI think it should not because `.tox` is not a \"build artifact\" - if this reasoning makes sense.",
    "created_at": "2021-03-31T02:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628110",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>
I think it should not because `.tox` is not a "build artifact" - if this reasoning makes sense.



---

archive/issue_comments_628111.json:
```json
{
    "body": "<a id='comment:34'></a>\nThat makes sense. Maybe I need to learn more about tox. What command should I use if I want to restart `EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-nohomebrew-python3_xcode` from scratch? Just delete `.tox/local-macos-nohomebrew-python3`?",
    "created_at": "2021-03-31T16:49:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628111",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:34'></a>
That makes sense. Maybe I need to learn more about tox. What command should I use if I want to restart `EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-nohomebrew-python3_xcode` from scratch? Just delete `.tox/local-macos-nohomebrew-python3`?



---

archive/issue_comments_628112.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [jhpalmieri](#comment%3A34):\n> That makes sense. Maybe I need to learn more about tox. What command should I use if I want to restart `EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-nohomebrew-python3_xcode` from scratch? Just delete `.tox/local-macos-nohomebrew-python3`?\n\n\nThat works, but you can also pass the `-r` option to `tox`, which will start from scratch.",
    "created_at": "2021-03-31T16:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628112",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>
Replying to [jhpalmieri](#comment%3A34):
> That makes sense. Maybe I need to learn more about tox. What command should I use if I want to restart `EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-nohomebrew-python3_xcode` from scratch? Just delete `.tox/local-macos-nohomebrew-python3`?


That works, but you can also pass the `-r` option to `tox`, which will start from scratch.



---

archive/issue_comments_628113.json:
```json
{
    "body": "<a id='comment:36'></a>\nGreat, thanks!",
    "created_at": "2021-03-31T17:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628113",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:36'></a>
Great, thanks!



---

archive/issue_events_093436.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-18T16:17:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31567#event-93436"
}
```



---

archive/issue_comments_628114.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-05-27T20:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628114",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_628115.json:
```json
{
    "body": "Changing branch from \"[u/mkoeppe/tox_ini__add_local_macos_nohomebrew_environments](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/tox_ini__add_local_macos_nohomebrew_environments)\" to \"[ed1a089963e3215ddfe1216ad01237396364519b](https://github.com/sagemath/sagetrac-mirror/commit/ed1a089963e3215ddfe1216ad01237396364519b)\"",
    "created_at": "2021-05-27T20:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31567#issuecomment-628115",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[u/mkoeppe/tox_ini__add_local_macos_nohomebrew_environments](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/tox_ini__add_local_macos_nohomebrew_environments)" to "[ed1a089963e3215ddfe1216ad01237396364519b](https://github.com/sagemath/sagetrac-mirror/commit/ed1a089963e3215ddfe1216ad01237396364519b)"



---

archive/issue_events_093437.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-05-27T20:28:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31567",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31567#event-93437"
}
```
