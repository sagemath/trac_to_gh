# Issue 31567: tox.ini: Add local-macos-nohomebrew environments, deployment targets 10.14, 10.15, 11.1

archive/issues_031330.json:
```json
{
    "assignees": [],
    "body": "This will do a \"best effort\" isolation to avoid using a homebrew installation in `/usr/local` for anything except bootstrapping and unpacking xz tarballs + a little trick for liblzma.h, which is missing on macOS.\n\nTo test:\n\n```\n$ EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-nohomebrew-python3_xcode\n```\nIt can then be checked that no libraries from /usr/local leak in, using\n\n```\nfind prefix/lib -name \"*.so\" -o -name \"*.dylib*\" -exec otool -L {} \\;\n```\n(Building R is disabled because the R package build still pokes around in /usr/local and finds libintl and liblzma.)\n\nTo set specific deployment targets, use:\n\n```\n$ EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-10.14-nohomebrew-python3_xcode -- config.status\n$ EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-10.15-nohomebrew-python3_xcode -- config.status\n$ EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status\n```\n\n... and with python3.7 from XCode:\n\n```\n$ tox -e local-macos-10.14-nohomebrew-python3_xcode-python3.7 -- config.status\n```\n(Remove `config.status` from the end of these lines to have the actual build done.)\n\nThese environments allow building Sage for older macOS versions, for example for building a 10.14 distribution on a 10.15 machine. The wheels are then correctly tagged, for example `pplpy-0.8.6-cp38-cp38-macosx_10_14_x86_64.whl`.\n\nCannot go in the opposite direction (building for 11 on a 10.15 machine) -- because pip will refuse to install a previously built wheel that is tagged for 11.)\n\n\nDepends on #31552\nDepends on #31562\nDepends on #31409\nDepends on #31584\n\nCC:  @jhpalmieri @zlscherr\n\nBranch/Commit: **[ed1a089](https://github.com/sagemath/sagetrac-mirror/commit/ed1a089963e3215ddfe1216ad01237396364519b)**\n\nReviewer: **John Palmieri**\n\nAuthor: **Matthias Koeppe**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31567_\n\n",
    "closed_at": "2021-05-27T20:28:46Z",
    "created_at": "2021-03-26T21:36:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20porting",
        "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "tox.ini: Add local-macos-nohomebrew environments, deployment targets 10.14, 10.15, 11.1",
    "type": "issue",
    "updated_at": "2021-05-27T20:28:46Z",
    "url": "https://github.com/sagemath/sage/issues/31567",
    "user": "https://github.com/mkoeppe"
}
```
This will do a "best effort" isolation to avoid using a homebrew installation in `/usr/local` for anything except bootstrapping and unpacking xz tarballs + a little trick for liblzma.h, which is missing on macOS.

To test:

```
$ EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-nohomebrew-python3_xcode
```
It can then be checked that no libraries from /usr/local leak in, using

```
find prefix/lib -name "*.so" -o -name "*.dylib*" -exec otool -L {} \;
```
(Building R is disabled because the R package build still pokes around in /usr/local and finds libintl and liblzma.)

To set specific deployment targets, use:

```
$ EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-10.14-nohomebrew-python3_xcode -- config.status
$ EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-10.15-nohomebrew-python3_xcode -- config.status
$ EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status
```

... and with python3.7 from XCode:

```
$ tox -e local-macos-10.14-nohomebrew-python3_xcode-python3.7 -- config.status
```
(Remove `config.status` from the end of these lines to have the actual build done.)

These environments allow building Sage for older macOS versions, for example for building a 10.14 distribution on a 10.15 machine. The wheels are then correctly tagged, for example `pplpy-0.8.6-cp38-cp38-macosx_10_14_x86_64.whl`.

Cannot go in the opposite direction (building for 11 on a 10.15 machine) -- because pip will refuse to install a previously built wheel that is tagged for 11.)


Depends on #31552
Depends on #31562
Depends on #31409
Depends on #31584

CC:  @jhpalmieri @zlscherr

Branch/Commit: **[ed1a089](https://github.com/sagemath/sagetrac-mirror/commit/ed1a089963e3215ddfe1216ad01237396364519b)**

Reviewer: **John Palmieri**

Author: **Matthias Koeppe**

_Issue created by migration from https://trac.sagemath.org/ticket/31567_





---

archive/issue_events_417055.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-26T21:36:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31567#event-417055"
}
```



---

archive/issue_events_417056.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-26T21:36:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20porting",
    "label_color": "000080",
    "label_name": "component: porting",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31567#event-417056"
}
```



---

archive/issue_events_417057.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-26T21:36:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31567#event-417057"
}
```



---

archive/issue_events_417058.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-26T21:36:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31567#event-417058"
}
```



---

archive/issue_comments_510441.json:
```json
{
    "body": "Branch: **[u/mkoeppe/tox_ini__add_local_macos_nohomebrew_environments](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/tox_ini__add_local_macos_nohomebrew_environments)**",
    "created_at": "2021-03-26T23:33:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510441",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/tox_ini__add_local_macos_nohomebrew_environments](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/tox_ini__add_local_macos_nohomebrew_environments)**



---

archive/issue_comments_510442.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td>[87e2dba](https://github.com/sagemath/sagetrac-mirror/commit/87e2dbaea7bf8a59d1ecb082871219e530218366)</td><td><code>`tox.ini: Add local-macos-nohomebrew and configuration facors macos-{10.14,10.15,11.1`}</code></td></tr></table>\n",
    "created_at": "2021-03-27T00:16:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510442",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:2'>Comment 2:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td>[87e2dba](https://github.com/sagemath/sagetrac-mirror/commit/87e2dbaea7bf8a59d1ecb082871219e530218366)</td><td><code>`tox.ini: Add local-macos-nohomebrew and configuration facors macos-{10.14,10.15,11.1`}</code></td></tr></table>




---

archive/issue_comments_510443.json:
```json
{
    "body": "Commit: **[87e2dba](https://github.com/sagemath/sagetrac-mirror/commit/87e2dbaea7bf8a59d1ecb082871219e530218366)**",
    "created_at": "2021-03-27T00:16:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510443",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[87e2dba](https://github.com/sagemath/sagetrac-mirror/commit/87e2dbaea7bf8a59d1ecb082871219e530218366)**



---

archive/issue_events_417059.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-27T00:22:57Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "title_is": "tox.ini: Add local-macos-nohomebrew environments, deployment targets 10.14, 10.15, 11.1",
    "title_was": "tox.ini: Add local-macos-nohomebrew environments",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31567#event-417059"
}
```



---

archive/issue_comments_510444.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2021-03-27T00:28:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510444",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_510445.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,16 @@\n This will do a \"best effort\" isolation to avoid using a homebrew installation in `/usr/local` for anythings except bootstrapping and perhaps unpacking xz tarballs.\n \n+To test:\n \n+```\n+$ tox -e local-macos-nohomebrew-python3_xcode -- config.status\n+```\n+\n+To set specific deployment targets, use:\n+\n+```\n+$ tox -e local-macos-10.14-nohomebrew-python3_xcode -- config.status\n+$ tox -e local-macos-10.15-nohomebrew-python3_xcode -- config.status\n+$ tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status\n+```\n+\n``````\n",
    "created_at": "2021-03-27T00:28:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510445",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,16 @@
 This will do a "best effort" isolation to avoid using a homebrew installation in `/usr/local` for anythings except bootstrapping and perhaps unpacking xz tarballs.
 
+To test:
 
+```
+$ tox -e local-macos-nohomebrew-python3_xcode -- config.status
+```
+
+To set specific deployment targets, use:
+
+```
+$ tox -e local-macos-10.14-nohomebrew-python3_xcode -- config.status
+$ tox -e local-macos-10.15-nohomebrew-python3_xcode -- config.status
+$ tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status
+```
+
``````




---

archive/issue_comments_510446.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,3 +14,7 @@\n $ tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status\n ```\n \n+These environments allow building Sage for older macOS versions, for example for building a 10.14 distribution on a 10.15 machine. The wheels are then correctly tagged, for example `pplpy-0.8.6-cp38-cp38-macosx_10_14_x86_64.whl`.\n+\n+Cannot go in the opposite direction (building for 11 on a 10.15 machine) -- because pip will refuse to install a previously built wheel that is tagged for 11.)\n+\n``````\n",
    "created_at": "2021-03-27T01:45:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510446",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,3 +14,7 @@
 $ tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status
 ```
 
+These environments allow building Sage for older macOS versions, for example for building a 10.14 distribution on a 10.15 machine. The wheels are then correctly tagged, for example `pplpy-0.8.6-cp38-cp38-macosx_10_14_x86_64.whl`.
+
+Cannot go in the opposite direction (building for 11 on a 10.15 machine) -- because pip will refuse to install a previously built wheel that is tagged for 11.)
+
``````




---

archive/issue_comments_510447.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td>[1ed9302](https://github.com/sagemath/sagetrac-mirror/commit/1ed930292280bd3baa7cb3b72492c966fa204030)</td><td><code>`tox.ini: Add macos-{python3_xcode,nohomebrew}-python{3.7,3.8`}</code></td></tr></table>\n",
    "created_at": "2021-03-27T02:21:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510447",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>Comment 6:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td>[1ed9302](https://github.com/sagemath/sagetrac-mirror/commit/1ed930292280bd3baa7cb3b72492c966fa204030)</td><td><code>`tox.ini: Add macos-{python3_xcode,nohomebrew}-python{3.7,3.8`}</code></td></tr></table>




---

archive/issue_comments_510448.json:
```json
{
    "body": "Changed commit from **[87e2dba](https://github.com/sagemath/sagetrac-mirror/commit/87e2dbaea7bf8a59d1ecb082871219e530218366)** to **[1ed9302](https://github.com/sagemath/sagetrac-mirror/commit/1ed930292280bd3baa7cb3b72492c966fa204030)**",
    "created_at": "2021-03-27T02:21:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510448",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[87e2dba](https://github.com/sagemath/sagetrac-mirror/commit/87e2dbaea7bf8a59d1ecb082871219e530218366)** to **[1ed9302](https://github.com/sagemath/sagetrac-mirror/commit/1ed930292280bd3baa7cb3b72492c966fa204030)**



---

archive/issue_comments_510449.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td>[0458f23](https://github.com/sagemath/sagetrac-mirror/commit/0458f2309b3f30a9445dd0196a130f4d41dafe44)</td><td><code>`tox.ini: Add macos-{python3_xcode,nohomebrew}-python{3.7,3.8`}</code></td></tr></table>\n",
    "created_at": "2021-03-27T02:21:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510449",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'>Comment 7:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td>[0458f23](https://github.com/sagemath/sagetrac-mirror/commit/0458f2309b3f30a9445dd0196a130f4d41dafe44)</td><td><code>`tox.ini: Add macos-{python3_xcode,nohomebrew}-python{3.7,3.8`}</code></td></tr></table>




---

archive/issue_comments_510450.json:
```json
{
    "body": "Changed commit from **[1ed9302](https://github.com/sagemath/sagetrac-mirror/commit/1ed930292280bd3baa7cb3b72492c966fa204030)** to **[0458f23](https://github.com/sagemath/sagetrac-mirror/commit/0458f2309b3f30a9445dd0196a130f4d41dafe44)**",
    "created_at": "2021-03-27T02:21:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510450",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1ed9302](https://github.com/sagemath/sagetrac-mirror/commit/1ed930292280bd3baa7cb3b72492c966fa204030)** to **[0458f23](https://github.com/sagemath/sagetrac-mirror/commit/0458f2309b3f30a9445dd0196a130f4d41dafe44)**



---

archive/issue_comments_510451.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This will do a \"best effort\" isolation to avoid using a homebrew installation in `/usr/local` for anythings except bootstrapping and perhaps unpacking xz tarballs.\n+This will do a \"best effort\" isolation to avoid using a homebrew installation in `/usr/local` for anything except bootstrapping and unpacking xz tarballs + a little trick for liblzma.h, which is missing on macOS.\n \n To test:\n \n``````\n",
    "created_at": "2021-03-27T02:49:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510451",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This will do a "best effort" isolation to avoid using a homebrew installation in `/usr/local` for anythings except bootstrapping and perhaps unpacking xz tarballs.
+This will do a "best effort" isolation to avoid using a homebrew installation in `/usr/local` for anything except bootstrapping and unpacking xz tarballs + a little trick for liblzma.h, which is missing on macOS.
 
 To test:
 
``````




---

archive/issue_comments_510452.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nThis is best tested together with #31552, #31562, which do some of the necessary isolation work.\n\nMore isolation work is needed at least for `pillow` and `freetype` - as observed in [#31396 comment:32](https://github.com/sagemath/sage/issues/31396#comment:32)",
    "created_at": "2021-03-27T02:49:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510452",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'>Comment 8:</a>
This is best tested together with #31552, #31562, which do some of the necessary isolation work.

More isolation work is needed at least for `pillow` and `freetype` - as observed in [#31396 comment:32](https://github.com/sagemath/sage/issues/31396#comment:32)



---

archive/issue_comments_510453.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,6 +14,13 @@\n $ tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status\n ```\n \n+... and with python3.7 from XCode:\n+\n+```\n+tox -e local-macos-10.14-nohomebrew-python3_xcode-python3.7 -- config.status\n+```\n+(Remove `config.status` from the end of these lines to have the actual build done.)\n+\n These environments allow building Sage for older macOS versions, for example for building a 10.14 distribution on a 10.15 machine. The wheels are then correctly tagged, for example `pplpy-0.8.6-cp38-cp38-macosx_10_14_x86_64.whl`.\n \n Cannot go in the opposite direction (building for 11 on a 10.15 machine) -- because pip will refuse to install a previously built wheel that is tagged for 11.)\n``````\n",
    "created_at": "2021-03-27T02:51:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510453",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,6 +14,13 @@
 $ tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status
 ```
 
+... and with python3.7 from XCode:
+
+```
+tox -e local-macos-10.14-nohomebrew-python3_xcode-python3.7 -- config.status
+```
+(Remove `config.status` from the end of these lines to have the actual build done.)
+
 These environments allow building Sage for older macOS versions, for example for building a 10.14 distribution on a 10.15 machine. The wheels are then correctly tagged, for example `pplpy-0.8.6-cp38-cp38-macosx_10_14_x86_64.whl`.
 
 Cannot go in the opposite direction (building for 11 on a 10.15 machine) -- because pip will refuse to install a previously built wheel that is tagged for 11.)
``````




---

archive/issue_comments_510454.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,7 +17,7 @@\n ... and with python3.7 from XCode:\n \n ```\n-tox -e local-macos-10.14-nohomebrew-python3_xcode-python3.7 -- config.status\n+$ tox -e local-macos-10.14-nohomebrew-python3_xcode-python3.7 -- config.status\n ```\n (Remove `config.status` from the end of these lines to have the actual build done.)\n \n``````\n",
    "created_at": "2021-03-27T02:52:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510454",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,7 +17,7 @@
 ... and with python3.7 from XCode:
 
 ```
-tox -e local-macos-10.14-nohomebrew-python3_xcode-python3.7 -- config.status
+$ tox -e local-macos-10.14-nohomebrew-python3_xcode-python3.7 -- config.status
 ```
 (Remove `config.status` from the end of these lines to have the actual build done.)
 
``````




---

archive/issue_comments_510455.json:
```json
{
    "body": "Dependencies: **#31552, #31562**",
    "created_at": "2021-03-27T03:00:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510455",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#31552, #31562**



---

archive/issue_comments_510456.json:
```json
{
    "body": "Changed commit from **[0458f23](https://github.com/sagemath/sagetrac-mirror/commit/0458f2309b3f30a9445dd0196a130f4d41dafe44)** to **[9d9c562](https://github.com/sagemath/sagetrac-mirror/commit/9d9c562060e86156064f3647e7b223054218c93d)**",
    "created_at": "2021-03-27T03:01:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510456",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0458f23](https://github.com/sagemath/sagetrac-mirror/commit/0458f2309b3f30a9445dd0196a130f4d41dafe44)** to **[9d9c562](https://github.com/sagemath/sagetrac-mirror/commit/9d9c562060e86156064f3647e7b223054218c93d)**



---

archive/issue_comments_510457.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827\">8b5b273</a></td><td><code>build/pkgs/singular/checksums.ini: Use 4.2.0p1+2021-03-24+sage-2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39629dde5cecd74a30b102f25dfef9178546a2d0\">39629dd</a></td><td><code>Merge #31552</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1ef46d0e96f00d9e7ba26f235950e90511aa2305\">1ef46d0</a></td><td><code>build/pkgs/giac: Add another patch in patches/autotools</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89f61d2acd527c659fd1a04239661c1bb172106d\">89f61d2</a></td><td><code>build/pkgs/giac: Update to 1.6.0.47p3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d9c562060e86156064f3647e7b223054218c93d\">9d9c562</a></td><td><code>Merge #31562</code></td></tr></table>\n",
    "created_at": "2021-03-27T03:01:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510457",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:12'>Comment 12:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827">8b5b273</a></td><td><code>build/pkgs/singular/checksums.ini: Use 4.2.0p1+2021-03-24+sage-2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39629dde5cecd74a30b102f25dfef9178546a2d0">39629dd</a></td><td><code>Merge #31552</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1ef46d0e96f00d9e7ba26f235950e90511aa2305">1ef46d0</a></td><td><code>build/pkgs/giac: Add another patch in patches/autotools</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89f61d2acd527c659fd1a04239661c1bb172106d">89f61d2</a></td><td><code>build/pkgs/giac: Update to 1.6.0.47p3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d9c562060e86156064f3647e7b223054218c93d">9d9c562</a></td><td><code>Merge #31562</code></td></tr></table>




---

archive/issue_events_417060.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-27T03:09:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31567#event-417060"
}
```



---

archive/issue_comments_510458.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/236ea3c0219e5418d244c62d3289e13d14afeee1\">236ea3c</a></td><td><code>tox.ini (macos-nohomebrew): Pass compiler configuration to configure using variables other than CC, CXX.</code></td></tr></table>\n",
    "created_at": "2021-03-28T00:54:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510458",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:14'>Comment 14:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/236ea3c0219e5418d244c62d3289e13d14afeee1">236ea3c</a></td><td><code>tox.ini (macos-nohomebrew): Pass compiler configuration to configure using variables other than CC, CXX.</code></td></tr></table>




---

archive/issue_comments_510459.json:
```json
{
    "body": "Changed commit from **[9d9c562](https://github.com/sagemath/sagetrac-mirror/commit/9d9c562060e86156064f3647e7b223054218c93d)** to **[236ea3c](https://github.com/sagemath/sagetrac-mirror/commit/236ea3c0219e5418d244c62d3289e13d14afeee1)**",
    "created_at": "2021-03-28T00:54:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510459",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9d9c562](https://github.com/sagemath/sagetrac-mirror/commit/9d9c562060e86156064f3647e7b223054218c93d)** to **[236ea3c](https://github.com/sagemath/sagetrac-mirror/commit/236ea3c0219e5418d244c62d3289e13d14afeee1)**



---

archive/issue_comments_510460.json:
```json
{
    "body": "Changed commit from **[236ea3c](https://github.com/sagemath/sagetrac-mirror/commit/236ea3c0219e5418d244c62d3289e13d14afeee1)** to **[92db4e4](https://github.com/sagemath/sagetrac-mirror/commit/92db4e40bf40a73be4570e159c4e5b36c1955451)**",
    "created_at": "2021-03-28T00:55:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510460",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[236ea3c](https://github.com/sagemath/sagetrac-mirror/commit/236ea3c0219e5418d244c62d3289e13d14afeee1)** to **[92db4e4](https://github.com/sagemath/sagetrac-mirror/commit/92db4e40bf40a73be4570e159c4e5b36c1955451)**



---

archive/issue_comments_510461.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/92db4e40bf40a73be4570e159c4e5b36c1955451\">92db4e4</a></td><td><code>tox.ini (macos-nohomebrew): Pass compiler configuration to configure using variables other than CC, CXX.</code></td></tr></table>\n",
    "created_at": "2021-03-28T00:55:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510461",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:15'>Comment 15:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/92db4e40bf40a73be4570e159c4e5b36c1955451">92db4e4</a></td><td><code>tox.ini (macos-nohomebrew): Pass compiler configuration to configure using variables other than CC, CXX.</code></td></tr></table>




---

archive/issue_comments_510462.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,15 +3,21 @@\n To test:\n \n ```\n-$ tox -e local-macos-nohomebrew-python3_xcode -- config.status\n+$ EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-nohomebrew-python3_xcode\n ```\n+It can then be checked that no libraries from /usr/local leak in, using\n+\n+```\n+find prefix/lib -name \"*.so\" -o -name \"*.dylib*\" -exec otool -L {} \\;\n+```\n+(Building R is disabled because the R package build still pokes around in /usr/local and finds libintl and liblzma.)\n \n To set specific deployment targets, use:\n \n ```\n-$ tox -e local-macos-10.14-nohomebrew-python3_xcode -- config.status\n-$ tox -e local-macos-10.15-nohomebrew-python3_xcode -- config.status\n-$ tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status\n+$ EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-10.14-nohomebrew-python3_xcode -- config.status\n+$ EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-10.15-nohomebrew-python3_xcode -- config.status\n+$ EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status\n ```\n \n ... and with python3.7 from XCode:\n``````\n",
    "created_at": "2021-03-28T01:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510462",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,15 +3,21 @@
 To test:
 
 ```
-$ tox -e local-macos-nohomebrew-python3_xcode -- config.status
+$ EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-nohomebrew-python3_xcode
 ```
+It can then be checked that no libraries from /usr/local leak in, using
+
+```
+find prefix/lib -name "*.so" -o -name "*.dylib*" -exec otool -L {} \;
+```
+(Building R is disabled because the R package build still pokes around in /usr/local and finds libintl and liblzma.)
 
 To set specific deployment targets, use:
 
 ```
-$ tox -e local-macos-10.14-nohomebrew-python3_xcode -- config.status
-$ tox -e local-macos-10.15-nohomebrew-python3_xcode -- config.status
-$ tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status
+$ EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-10.14-nohomebrew-python3_xcode -- config.status
+$ EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-10.15-nohomebrew-python3_xcode -- config.status
+$ EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-11.1-nohomebrew-python3_xcode -- config.status
 ```
 
 ... and with python3.7 from XCode:
``````




---

archive/issue_comments_510463.json:
```json
{
    "body": "Changed dependencies from **#31552, #31562** to **#31552, #31562, #31409**",
    "created_at": "2021-03-28T01:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510463",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#31552, #31562** to **#31552, #31562, #31409**



---

archive/issue_comments_510464.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/737b21caeeeaa6616c7e25e80aecac8841dbf6e2\">737b21c</a></td><td><code>src/sage/stats/r.py: Mark all 2 doctests in this file as # optional - rpy2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/440392440805bbdf01d42e3d5f487d61231aaabf\">4403924</a></td><td><code>src/sage/interfaces/r.py: Mark all tests # optional - rpy2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/405ebb976c6c8ccffd5b5350f1c7ec660301d797\">405ebb9</a></td><td><code>More # optional - rpy2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b7c157665b738e2f54a6bf217c0114c4180f7df9\">b7c1576</a></td><td><code>Merge tag '9.3.beta8' into t/31409/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce3b35fea3326528936af448d006119e6405626f\">ce3b35f</a></td><td><code>More # optional - r</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/49c10c18991eed62d800f2fccc422a1a9e7555ce\">49c10c1</a></td><td><code>Revert \"build/pkgs/{r,rpy2}: Downgrade to optional\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a67300bd66731b67fac776cfde1d8e0157392ef5\">a67300b</a></td><td><code>Merge #30383</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0a5fb5adafd3d4c82c9d736dc95f49c67e15c39\">f0a5fb5</a></td><td><code>configure.ac: Add option --disable-r</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f04c13484c85c5d07e76cc9f306e70553fc74c6c\">f04c134</a></td><td><code>Merge branch 't/30383/new_package_type__optional_enabled_by_default' into t/31409/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7966b662147c5f58807e0f9492b35c95e9322b36\">7966b66</a></td><td><code>Merge #31409</code></td></tr></table>\n",
    "created_at": "2021-03-28T01:54:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510464",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:17'>Comment 17:</a>
Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/737b21caeeeaa6616c7e25e80aecac8841dbf6e2">737b21c</a></td><td><code>src/sage/stats/r.py: Mark all 2 doctests in this file as # optional - rpy2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/440392440805bbdf01d42e3d5f487d61231aaabf">4403924</a></td><td><code>src/sage/interfaces/r.py: Mark all tests # optional - rpy2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/405ebb976c6c8ccffd5b5350f1c7ec660301d797">405ebb9</a></td><td><code>More # optional - rpy2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b7c157665b738e2f54a6bf217c0114c4180f7df9">b7c1576</a></td><td><code>Merge tag '9.3.beta8' into t/31409/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce3b35fea3326528936af448d006119e6405626f">ce3b35f</a></td><td><code>More # optional - r</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/49c10c18991eed62d800f2fccc422a1a9e7555ce">49c10c1</a></td><td><code>Revert "build/pkgs/{r,rpy2}: Downgrade to optional"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a67300bd66731b67fac776cfde1d8e0157392ef5">a67300b</a></td><td><code>Merge #30383</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0a5fb5adafd3d4c82c9d736dc95f49c67e15c39">f0a5fb5</a></td><td><code>configure.ac: Add option --disable-r</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f04c13484c85c5d07e76cc9f306e70553fc74c6c">f04c134</a></td><td><code>Merge branch 't/30383/new_package_type__optional_enabled_by_default' into t/31409/cygwin_standard__r_build_fails_____downgrade_r__rpy2_to_optional</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7966b662147c5f58807e0f9492b35c95e9322b36">7966b66</a></td><td><code>Merge #31409</code></td></tr></table>




---

archive/issue_comments_510465.json:
```json
{
    "body": "Changed commit from **[92db4e4](https://github.com/sagemath/sagetrac-mirror/commit/92db4e40bf40a73be4570e159c4e5b36c1955451)** to **[7966b66](https://github.com/sagemath/sagetrac-mirror/commit/7966b662147c5f58807e0f9492b35c95e9322b36)**",
    "created_at": "2021-03-28T01:54:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510465",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[92db4e4](https://github.com/sagemath/sagetrac-mirror/commit/92db4e40bf40a73be4570e159c4e5b36c1955451)** to **[7966b66](https://github.com/sagemath/sagetrac-mirror/commit/7966b662147c5f58807e0f9492b35c95e9322b36)**



---

archive/issue_events_417061.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-28T01:58:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31567#event-417061"
}
```



---

archive/issue_events_417062.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-28T01:58:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "label": "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31567#event-417062"
}
```



---

archive/issue_comments_510466.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b5edde2e54cc58bd151880293e6454c3f92150fe\">b5edde2</a></td><td><code>tox.ini (macos-nohomebrew): Fix typo in PILLOW_...</code></td></tr></table>\n",
    "created_at": "2021-03-28T05:50:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510466",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:19'>Comment 19:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b5edde2e54cc58bd151880293e6454c3f92150fe">b5edde2</a></td><td><code>tox.ini (macos-nohomebrew): Fix typo in PILLOW_...</code></td></tr></table>




---

archive/issue_comments_510467.json:
```json
{
    "body": "Changed commit from **[7966b66](https://github.com/sagemath/sagetrac-mirror/commit/7966b662147c5f58807e0f9492b35c95e9322b36)** to **[b5edde2](https://github.com/sagemath/sagetrac-mirror/commit/b5edde2e54cc58bd151880293e6454c3f92150fe)**",
    "created_at": "2021-03-28T05:50:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510467",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7966b66](https://github.com/sagemath/sagetrac-mirror/commit/7966b662147c5f58807e0f9492b35c95e9322b36)** to **[b5edde2](https://github.com/sagemath/sagetrac-mirror/commit/b5edde2e54cc58bd151880293e6454c3f92150fe)**



---

archive/issue_events_417063.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-28T06:02:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31567#event-417063"
}
```



---

archive/issue_events_417064.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-28T06:02:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31567#event-417064"
}
```



---

archive/issue_comments_510468.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nNow pillow does not find zlib",
    "created_at": "2021-03-28T06:02:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510468",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'>Comment 20:</a>
Now pillow does not find zlib



---

archive/issue_comments_510469.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dffcdbc75e46d08bcb1fd2ac9a5677a7a7312e2f\">dffcdbc</a></td><td><code>tox.ini (macos-nohomebrew): Fix up pillow build by setting ZLIB_ROOT</code></td></tr></table>\n",
    "created_at": "2021-03-28T06:43:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510469",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:21'>Comment 21:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dffcdbc75e46d08bcb1fd2ac9a5677a7a7312e2f">dffcdbc</a></td><td><code>tox.ini (macos-nohomebrew): Fix up pillow build by setting ZLIB_ROOT</code></td></tr></table>




---

archive/issue_comments_510470.json:
```json
{
    "body": "Changed commit from **[b5edde2](https://github.com/sagemath/sagetrac-mirror/commit/b5edde2e54cc58bd151880293e6454c3f92150fe)** to **[dffcdbc](https://github.com/sagemath/sagetrac-mirror/commit/dffcdbc75e46d08bcb1fd2ac9a5677a7a7312e2f)**",
    "created_at": "2021-03-28T06:43:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510470",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b5edde2](https://github.com/sagemath/sagetrac-mirror/commit/b5edde2e54cc58bd151880293e6454c3f92150fe)** to **[dffcdbc](https://github.com/sagemath/sagetrac-mirror/commit/dffcdbc75e46d08bcb1fd2ac9a5677a7a7312e2f)**



---

archive/issue_comments_510471.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\npillow still finds various libraries in `/usr/local` because of very creative discovery code that finds everything in `/usr/local` because we told it that it can have `/usr/local/opt/xz/include` - see `_add_directory` (https://github.com/python-pillow/Pillow/blob/8.1.x/setup.py#L197)",
    "created_at": "2021-03-29T01:26:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510471",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'>Comment 22:</a>
pillow still finds various libraries in `/usr/local` because of very creative discovery code that finds everything in `/usr/local` because we told it that it can have `/usr/local/opt/xz/include` - see `_add_directory` (https://github.com/python-pillow/Pillow/blob/8.1.x/setup.py#L197)



---

archive/issue_comments_510472.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3779a2525d5bbf0987a1d4ad0e42b73fb5769bc0\">3779a25</a></td><td><code>tox.ini (macos-nohomebrew): Disable more libraries to remove dependencies on homebrew</code></td></tr></table>\n",
    "created_at": "2021-03-29T01:59:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510472",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:23'>Comment 23:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3779a2525d5bbf0987a1d4ad0e42b73fb5769bc0">3779a25</a></td><td><code>tox.ini (macos-nohomebrew): Disable more libraries to remove dependencies on homebrew</code></td></tr></table>




---

archive/issue_comments_510473.json:
```json
{
    "body": "Changed commit from **[dffcdbc](https://github.com/sagemath/sagetrac-mirror/commit/dffcdbc75e46d08bcb1fd2ac9a5677a7a7312e2f)** to **[3779a25](https://github.com/sagemath/sagetrac-mirror/commit/3779a2525d5bbf0987a1d4ad0e42b73fb5769bc0)**",
    "created_at": "2021-03-29T01:59:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510473",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[dffcdbc](https://github.com/sagemath/sagetrac-mirror/commit/dffcdbc75e46d08bcb1fd2ac9a5677a7a7312e2f)** to **[3779a25](https://github.com/sagemath/sagetrac-mirror/commit/3779a2525d5bbf0987a1d4ad0e42b73fb5769bc0)**



---

archive/issue_events_417065.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-29T02:08:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31567#event-417065"
}
```



---

archive/issue_events_417066.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-29T02:08:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31567#event-417066"
}
```



---

archive/issue_comments_510474.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nFixed pillow. Now I can build a wheel in #31396 that does not have any dependencies on shared libraries in `/usr/local`.",
    "created_at": "2021-03-29T02:08:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510474",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'>Comment 24:</a>
Fixed pillow. Now I can build a wheel in #31396 that does not have any dependencies on shared libraries in `/usr/local`.



---

archive/issue_comments_510475.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nFor what it's worth, I see a few suspicious items in the log files. (This is on a system with homebrew and with `source .homebrew-build-env` in my shell init file. That may be causing some of these.)\n\n- cvxopt includes flags `-L/usr/local/lib` and `-I/usr/local/include` when calling `gcc`\n- pillow says `Appending path /usr/local/Cellar/xz/5.2.5/include` and then the `gcc` flag `-I/usr/local/Cellar/xz/5.2.5/include`.",
    "created_at": "2021-03-30T22:02:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510475",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:25'>Comment 25:</a>
For what it's worth, I see a few suspicious items in the log files. (This is on a system with homebrew and with `source .homebrew-build-env` in my shell init file. That may be causing some of these.)

- cvxopt includes flags `-L/usr/local/lib` and `-I/usr/local/include` when calling `gcc`
- pillow says `Appending path /usr/local/Cellar/xz/5.2.5/include` and then the `gcc` flag `-I/usr/local/Cellar/xz/5.2.5/include`.



---

archive/issue_comments_510476.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nThe xz include is on purpose -- see comment added in `tox.ini`",
    "created_at": "2021-03-30T22:12:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510476",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'>Comment 26:</a>
The xz include is on purpose -- see comment added in `tox.ini`



---

archive/issue_comments_510477.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nReplying to [@jhpalmieri](#comment%3A25):\n> For what it's worth, I see a few suspicious items in the log files. (This is on a system with homebrew and with `source .homebrew-build-env` in my shell init file. That may be causing some of these.)\n\nYes, this a good setting for testing this ticket. The build using tox is designed to be isolated from the effects of `.homebrew-build-env`. \n\n> - cvxopt includes flags `-L/usr/local/lib` and `-I/usr/local/include` when calling `gcc`\n\nThis is probably https://github.com/cvxopt/cvxopt/blob/master/setup.py#L55 in combination with a bug in our build system - #31584.",
    "created_at": "2021-03-30T22:39:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510477",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'>Comment 27:</a>
Replying to [@jhpalmieri](#comment%3A25):
> For what it's worth, I see a few suspicious items in the log files. (This is on a system with homebrew and with `source .homebrew-build-env` in my shell init file. That may be causing some of these.)

Yes, this a good setting for testing this ticket. The build using tox is designed to be isolated from the effects of `.homebrew-build-env`. 

> - cvxopt includes flags `-L/usr/local/lib` and `-I/usr/local/include` when calling `gcc`

This is probably https://github.com/cvxopt/cvxopt/blob/master/setup.py#L55 in combination with a bug in our build system - #31584.



---

archive/issue_comments_510478.json:
```json
{
    "body": "Changed dependencies from **#31552, #31562, #31409** to **#31552, #31562, #31409, #31584**",
    "created_at": "2021-03-30T22:46:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510478",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#31552, #31562, #31409** to **#31552, #31562, #31409, #31584**



---

archive/issue_comments_510479.json:
```json
{
    "body": "Changed commit from **[3779a25](https://github.com/sagemath/sagetrac-mirror/commit/3779a2525d5bbf0987a1d4ad0e42b73fb5769bc0)** to **[ed1a089](https://github.com/sagemath/sagetrac-mirror/commit/ed1a089963e3215ddfe1216ad01237396364519b)**",
    "created_at": "2021-03-30T22:56:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510479",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3779a25](https://github.com/sagemath/sagetrac-mirror/commit/3779a2525d5bbf0987a1d4ad0e42b73fb5769bc0)** to **[ed1a089](https://github.com/sagemath/sagetrac-mirror/commit/ed1a089963e3215ddfe1216ad01237396364519b)**



---

archive/issue_comments_510480.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7ff26dfad2f33fe2d020580a01db20efea20716f\">7ff26df</a></td><td><code>git grep -l SAGE_SUITESPARSE | xargs sed -i .bak s/SAGE_SUITESPARSE_LOCALINSTALL/SAGE_SUITESPARSE_PREFIX/g</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/52537d120927ed57ce9659683fed15c405b1d1c7\">52537d1</a></td><td><code>build/pkgs/cvxopt/spkg-install.in: Actually use the value of SAGE_SUITESPARSE_PREFIX</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ed1a089963e3215ddfe1216ad01237396364519b\">ed1a089</a></td><td><code>Merge #31584</code></td></tr></table>\n",
    "created_at": "2021-03-30T22:56:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510480",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:29'>Comment 29:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7ff26dfad2f33fe2d020580a01db20efea20716f">7ff26df</a></td><td><code>git grep -l SAGE_SUITESPARSE | xargs sed -i .bak s/SAGE_SUITESPARSE_LOCALINSTALL/SAGE_SUITESPARSE_PREFIX/g</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/52537d120927ed57ce9659683fed15c405b1d1c7">52537d1</a></td><td><code>build/pkgs/cvxopt/spkg-install.in: Actually use the value of SAGE_SUITESPARSE_PREFIX</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ed1a089963e3215ddfe1216ad01237396364519b">ed1a089</a></td><td><code>Merge #31584</code></td></tr></table>




---

archive/issue_comments_510481.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2021-03-31T02:04:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510481",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri**



---

archive/issue_events_417067.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2021-03-31T02:04:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31567#event-417067"
}
```



---

archive/issue_events_417068.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2021-03-31T02:04:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31567#event-417068"
}
```



---

archive/issue_comments_510482.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nOkay, this looks good to me.",
    "created_at": "2021-03-31T02:04:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510482",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:30'>Comment 30:</a>
Okay, this looks good to me.



---

archive/issue_comments_510483.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nThanks!",
    "created_at": "2021-03-31T02:11:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510483",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'>Comment 31:</a>
Thanks!



---

archive/issue_comments_510484.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nBy the way, should commands like `make distclean` also clean the `.tox` directory?",
    "created_at": "2021-03-31T02:35:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510484",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:32'>Comment 32:</a>
By the way, should commands like `make distclean` also clean the `.tox` directory?



---

archive/issue_comments_510485.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nI think it should not because `.tox` is not a \"build artifact\" - if this reasoning makes sense.",
    "created_at": "2021-03-31T02:59:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510485",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'>Comment 33:</a>
I think it should not because `.tox` is not a "build artifact" - if this reasoning makes sense.



---

archive/issue_comments_510486.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nThat makes sense. Maybe I need to learn more about tox. What command should I use if I want to restart `EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-nohomebrew-python3_xcode` from scratch? Just delete `.tox/local-macos-nohomebrew-python3`?",
    "created_at": "2021-03-31T16:49:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510486",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:34'>Comment 34:</a>
That makes sense. Maybe I need to learn more about tox. What command should I use if I want to restart `EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-nohomebrew-python3_xcode` from scratch? Just delete `.tox/local-macos-nohomebrew-python3`?



---

archive/issue_comments_510487.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nReplying to [@jhpalmieri](#comment%3A34):\n> That makes sense. Maybe I need to learn more about tox. What command should I use if I want to restart `EXTRA_CONFIGURE_ARGS=\"--disable-r\" tox -e local-macos-nohomebrew-python3_xcode` from scratch? Just delete `.tox/local-macos-nohomebrew-python3`?\n\nThat works, but you can also pass the `-r` option to `tox`, which will start from scratch.",
    "created_at": "2021-03-31T16:52:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510487",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'>Comment 35:</a>
Replying to [@jhpalmieri](#comment%3A34):
> That makes sense. Maybe I need to learn more about tox. What command should I use if I want to restart `EXTRA_CONFIGURE_ARGS="--disable-r" tox -e local-macos-nohomebrew-python3_xcode` from scratch? Just delete `.tox/local-macos-nohomebrew-python3`?

That works, but you can also pass the `-r` option to `tox`, which will start from scratch.



---

archive/issue_comments_510488.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nGreat, thanks!",
    "created_at": "2021-03-31T17:21:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510488",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:36'>Comment 36:</a>
Great, thanks!



---

archive/issue_events_417069.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-18T16:17:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31567#event-417069"
}
```



---

archive/issue_events_417070.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-18T16:17:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31567#event-417070"
}
```



---

archive/issue_comments_510489.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/tox_ini__add_local_macos_nohomebrew_environments](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/tox_ini__add_local_macos_nohomebrew_environments)** to **[ed1a089](https://github.com/sagemath/sagetrac-mirror/commit/ed1a089963e3215ddfe1216ad01237396364519b)**",
    "created_at": "2021-05-27T20:28:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31567#issuecomment-510489",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/tox_ini__add_local_macos_nohomebrew_environments](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/tox_ini__add_local_macos_nohomebrew_environments)** to **[ed1a089](https://github.com/sagemath/sagetrac-mirror/commit/ed1a089963e3215ddfe1216ad01237396364519b)**



---

archive/issue_events_417071.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-05-27T20:28:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31567#event-417071"
}
```



---

archive/issue_events_417072.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "9e7b0bd3124630ebf368909dbcea7c2480ea1f27",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-05-27T20:28:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31567",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31567#event-417072"
}
```
