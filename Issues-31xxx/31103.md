# Issue 31103: sage.numerical.backends: Replace use of TestSuite by pytest

archive/issues_030866.json:
```json
{
    "assignees": [],
    "body": "`sage.numerical.backends` provides an opportunity to study use of `pytest` as a replacement for `TestSuite` (proposed in #30738) in a small self-contained codebase.\n\n`GenericBackend` defines an API and a small number of `_test_` methods to check that the API is implemented correctly by the backend implementations. We do this at the example of `_test_ncols_nonnegative`, leaving the other test methods for follow-up tickets.\n\nImportant design constraint:\n- The testing framework must be extensible by user-defined classes (or classes from separately installed Python packages - such as the existing `sage_numerical_backends_coin`).\n\n\nThis is accomplished by introducing a new `GenericBackendTests` class which defines the checks that should hold for all backend implementations. Then for each backend we introduce a class that derives from `GenericBackendTests` and returns in the `backend` test fixture the backend under test.\n\nThe pytests are now also executed in `sage -t` after the doctests, e.g. `bin/sage-runtests --verbose .` prints at the end\n\n```\n===================================================================================================================== test session starts ======================================================================================================================\nplatform linux -- Python 3.8.6, pytest-6.2.1, py-1.10.0, pluggy-0.13.1 -- /mnt/d/Programming/sage/src/.venv/bin/python3\ncachedir: .pytest_cache\nrootdir: /mnt/d/Programming/sage/src\ncollected 10 items                                                                                                                                                                                                                                             \n\nsage/numerical/backends/cvxopt_backend_test.py::TestCVXOPTBackend::test_old_testsuite PASSED                                                                                                                                                             [ 10%]\nsage/numerical/backends/cvxopt_backend_test.py::TestCVXOPTBackend::test_ncols_nonnegative PASSED                                                                                                                                                         [ 20%]\nsage/numerical/backends/glpk_backend_test.py::TestGLPKBackend::test_ncols_nonnegative PASSED                                                                                                                                                             [ 30%]\nsage/numerical/backends/glpk_backend_test.py::TestGLPKBackend::test_old_testsuite PASSED                                                                                                                                                                 [ 40%]\nsage/numerical/backends/glpk_exact_backend_test.py::TestGLPKExactBackend::test_ncols_nonnegative PASSED                                                                                                                                                  [ 50%]\nsage/numerical/backends/glpk_exact_backend_test.py::TestGLPKExactBackend::test_old_testsuite PASSED                                                                                                                                                      [ 60%]\nsage/numerical/backends/interactivelp_backend_test.py::TestInteractiveLPBackend::test_ncols_nonnegative PASSED                                                                                                                                           [ 70%]\nsage/numerical/backends/interactivelp_backend_test.py::TestInteractiveLPBackend::test_old_testsuite PASSED                                                                                                                                               [ 80%]\nsage/numerical/backends/ppl_backend_test.py::TestPPLBackend::test_ncols_nonnegative PASSED                                                                                                                                                               [ 90%]\nsage/numerical/backends/ppl_backend_test.py::TestPPLBackend::test_old_testsuite PASSED                                                                                                                                                                   [100%]\n```\n\nDepends on #30901\nDepends on #31003\nDepends on #30551\n\nCC:  @tobiasdiez @nthiery @tscrim @fchapoton @yuan-zhou\n\nBranch: **[`0592226`](https://github.com/sagemath/sagetrac-mirror/commit/0592226745971878657539a740fa54b065c9d0bb)**\n\nReviewer: **Matthias Koeppe, Tobias Diez**\n\nAuthor: **Tobias Diez, Matthias Koeppe**\n\nComponent: **doctest framework**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31103_\n\n",
    "closed_at": "2021-05-27T20:30:05Z",
    "created_at": "2020-12-24T20:01:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "sage.numerical.backends: Replace use of TestSuite by pytest",
    "type": "issue",
    "updated_at": "2021-11-17T21:30:24Z",
    "url": "https://github.com/sagemath/sage/issues/31103",
    "user": "https://github.com/mkoeppe"
}
```
`sage.numerical.backends` provides an opportunity to study use of `pytest` as a replacement for `TestSuite` (proposed in #30738) in a small self-contained codebase.

`GenericBackend` defines an API and a small number of `_test_` methods to check that the API is implemented correctly by the backend implementations. We do this at the example of `_test_ncols_nonnegative`, leaving the other test methods for follow-up tickets.

Important design constraint:
- The testing framework must be extensible by user-defined classes (or classes from separately installed Python packages - such as the existing `sage_numerical_backends_coin`).


This is accomplished by introducing a new `GenericBackendTests` class which defines the checks that should hold for all backend implementations. Then for each backend we introduce a class that derives from `GenericBackendTests` and returns in the `backend` test fixture the backend under test.

The pytests are now also executed in `sage -t` after the doctests, e.g. `bin/sage-runtests --verbose .` prints at the end

```
===================================================================================================================== test session starts ======================================================================================================================
platform linux -- Python 3.8.6, pytest-6.2.1, py-1.10.0, pluggy-0.13.1 -- /mnt/d/Programming/sage/src/.venv/bin/python3
cachedir: .pytest_cache
rootdir: /mnt/d/Programming/sage/src
collected 10 items                                                                                                                                                                                                                                             

sage/numerical/backends/cvxopt_backend_test.py::TestCVXOPTBackend::test_old_testsuite PASSED                                                                                                                                                             [ 10%]
sage/numerical/backends/cvxopt_backend_test.py::TestCVXOPTBackend::test_ncols_nonnegative PASSED                                                                                                                                                         [ 20%]
sage/numerical/backends/glpk_backend_test.py::TestGLPKBackend::test_ncols_nonnegative PASSED                                                                                                                                                             [ 30%]
sage/numerical/backends/glpk_backend_test.py::TestGLPKBackend::test_old_testsuite PASSED                                                                                                                                                                 [ 40%]
sage/numerical/backends/glpk_exact_backend_test.py::TestGLPKExactBackend::test_ncols_nonnegative PASSED                                                                                                                                                  [ 50%]
sage/numerical/backends/glpk_exact_backend_test.py::TestGLPKExactBackend::test_old_testsuite PASSED                                                                                                                                                      [ 60%]
sage/numerical/backends/interactivelp_backend_test.py::TestInteractiveLPBackend::test_ncols_nonnegative PASSED                                                                                                                                           [ 70%]
sage/numerical/backends/interactivelp_backend_test.py::TestInteractiveLPBackend::test_old_testsuite PASSED                                                                                                                                               [ 80%]
sage/numerical/backends/ppl_backend_test.py::TestPPLBackend::test_ncols_nonnegative PASSED                                                                                                                                                               [ 90%]
sage/numerical/backends/ppl_backend_test.py::TestPPLBackend::test_old_testsuite PASSED                                                                                                                                                                   [100%]
```

Depends on #30901
Depends on #31003
Depends on #30551

CC:  @tobiasdiez @nthiery @tscrim @fchapoton @yuan-zhou

Branch: **[`0592226`](https://github.com/sagemath/sagetrac-mirror/commit/0592226745971878657539a740fa54b065c9d0bb)**

Reviewer: **Matthias Koeppe, Tobias Diez**

Author: **Tobias Diez, Matthias Koeppe**

Component: **doctest framework**

_Issue created by migration from https://trac.sagemath.org/ticket/31103_





---

archive/issue_events_430989.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-24T20:01:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
    "label_color": "000080",
    "label_name": "c: doctest framework",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31103#event-430989"
}
```



---

archive/issue_events_430990.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-24T20:01:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31103#event-430990"
}
```



---

archive/issue_events_430991.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-24T20:01:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31103#event-430991"
}
```



---

archive/issue_events_430992.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-24T20:01:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31103#event-430992"
}
```



---

archive/issue_comments_498346.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nWhat should happen with the generic tests methods like `_test_new, _test_not_implemented_methods, _test_category, _test_pickling` that sadly make the \"small self-contained\" part hard?",
    "created_at": "2020-12-25T11:12:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498346",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:1" align="right">comment:1</div>

What should happen with the generic tests methods like `_test_new, _test_not_implemented_methods, _test_category, _test_pickling` that sadly make the "small self-contained" part hard?



---

archive/issue_comments_498347.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nGreat point. This brings me to the question whether it would be possible to either\n- invoke the existing `TestSuite` as one pytest method or\n- dynamically generate adapter methods that invoke the existing `_test` methods.",
    "created_at": "2020-12-25T18:26:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498347",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">comment:2</div>

Great point. This brings me to the question whether it would be possible to either
- invoke the existing `TestSuite` as one pytest method or
- dynamically generate adapter methods that invoke the existing `_test` methods.



---

archive/issue_events_430993.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-12-26T15:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31103#event-430993"
}
```



---

archive/issue_events_430994.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-12-26T15:15:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31103#event-430994"
}
```



---

archive/issue_comments_498348.json:
```json
{
    "body": "Dependencies: **#30901, #31003**",
    "created_at": "2020-12-26T15:15:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498348",
    "user": "https://github.com/tobiasdiez"
}
```

Dependencies: **#30901, #31003**



---

archive/issue_comments_498349.json:
```json
{
    "body": "Branch: **[public/refactoring/pytest-numerical-backends](https://github.com/sagemath/sagetrac-mirror/tree/public/refactoring/pytest-numerical-backends)**",
    "created_at": "2020-12-26T15:15:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498349",
    "user": "https://github.com/tobiasdiez"
}
```

Branch: **[public/refactoring/pytest-numerical-backends](https://github.com/sagemath/sagetrac-mirror/tree/public/refactoring/pytest-numerical-backends)**



---

archive/issue_comments_498350.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,3 +7,26 @@\n Important design constraint:\n - The testing framework must be extensible by user-defined classes (or classes from separately installed Python packages - such as the existing `sage_numerical_backends_coin`).\n \n+\n+This is accomplished by introducing a new `GenericBackendTests` class which defines the checks that should hold for all backend implementations. Then for each backend we introduce a class that derives from `GenericBackendTests` and returns in the `backend` test fixture the backend under test.\n+\n+The pytests are now also executed in `sage -t` after the doctests, e.g. `bin/sage-runtests --verbose .` prints at the end\n+\n+```\n+===================================================================================================================== test session starts ======================================================================================================================\n+platform linux -- Python 3.8.6, pytest-6.2.1, py-1.10.0, pluggy-0.13.1 -- /mnt/d/Programming/sage/src/.venv/bin/python3\n+cachedir: .pytest_cache\n+rootdir: /mnt/d/Programming/sage/src\n+collected 10 items                                                                                                                                                                                                                                             \n+\n+sage/numerical/backends/cvxopt_backend_test.py::TestCVXOPTBackend::test_old_testsuite PASSED                                                                                                                                                             [ 10%]\n+sage/numerical/backends/cvxopt_backend_test.py::TestCVXOPTBackend::test_ncols_nonnegative PASSED                                                                                                                                                         [ 20%]\n+sage/numerical/backends/glpk_backend_test.py::TestGLPKBackend::test_ncols_nonnegative PASSED                                                                                                                                                             [ 30%]\n+sage/numerical/backends/glpk_backend_test.py::TestGLPKBackend::test_old_testsuite PASSED                                                                                                                                                                 [ 40%]\n+sage/numerical/backends/glpk_exact_backend_test.py::TestGLPKExactBackend::test_ncols_nonnegative PASSED                                                                                                                                                  [ 50%]\n+sage/numerical/backends/glpk_exact_backend_test.py::TestGLPKExactBackend::test_old_testsuite PASSED                                                                                                                                                      [ 60%]\n+sage/numerical/backends/interactivelp_backend_test.py::TestInteractiveLPBackend::test_ncols_nonnegative PASSED                                                                                                                                           [ 70%]\n+sage/numerical/backends/interactivelp_backend_test.py::TestInteractiveLPBackend::test_old_testsuite PASSED                                                                                                                                               [ 80%]\n+sage/numerical/backends/ppl_backend_test.py::TestPPLBackend::test_ncols_nonnegative PASSED                                                                                                                                                               [ 90%]\n+sage/numerical/backends/ppl_backend_test.py::TestPPLBackend::test_old_testsuite PASSED                                                                                                                                                                   [100%]\n+```\n``````\n",
    "created_at": "2020-12-26T15:15:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498350",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,3 +7,26 @@
 Important design constraint:
 - The testing framework must be extensible by user-defined classes (or classes from separately installed Python packages - such as the existing `sage_numerical_backends_coin`).
 
+
+This is accomplished by introducing a new `GenericBackendTests` class which defines the checks that should hold for all backend implementations. Then for each backend we introduce a class that derives from `GenericBackendTests` and returns in the `backend` test fixture the backend under test.
+
+The pytests are now also executed in `sage -t` after the doctests, e.g. `bin/sage-runtests --verbose .` prints at the end
+
+```
+===================================================================================================================== test session starts ======================================================================================================================
+platform linux -- Python 3.8.6, pytest-6.2.1, py-1.10.0, pluggy-0.13.1 -- /mnt/d/Programming/sage/src/.venv/bin/python3
+cachedir: .pytest_cache
+rootdir: /mnt/d/Programming/sage/src
+collected 10 items                                                                                                                                                                                                                                             
+
+sage/numerical/backends/cvxopt_backend_test.py::TestCVXOPTBackend::test_old_testsuite PASSED                                                                                                                                                             [ 10%]
+sage/numerical/backends/cvxopt_backend_test.py::TestCVXOPTBackend::test_ncols_nonnegative PASSED                                                                                                                                                         [ 20%]
+sage/numerical/backends/glpk_backend_test.py::TestGLPKBackend::test_ncols_nonnegative PASSED                                                                                                                                                             [ 30%]
+sage/numerical/backends/glpk_backend_test.py::TestGLPKBackend::test_old_testsuite PASSED                                                                                                                                                                 [ 40%]
+sage/numerical/backends/glpk_exact_backend_test.py::TestGLPKExactBackend::test_ncols_nonnegative PASSED                                                                                                                                                  [ 50%]
+sage/numerical/backends/glpk_exact_backend_test.py::TestGLPKExactBackend::test_old_testsuite PASSED                                                                                                                                                      [ 60%]
+sage/numerical/backends/interactivelp_backend_test.py::TestInteractiveLPBackend::test_ncols_nonnegative PASSED                                                                                                                                           [ 70%]
+sage/numerical/backends/interactivelp_backend_test.py::TestInteractiveLPBackend::test_old_testsuite PASSED                                                                                                                                               [ 80%]
+sage/numerical/backends/ppl_backend_test.py::TestPPLBackend::test_ncols_nonnegative PASSED                                                                                                                                                               [ 90%]
+sage/numerical/backends/ppl_backend_test.py::TestPPLBackend::test_old_testsuite PASSED                                                                                                                                                                   [100%]
+```
``````




---

archive/issue_events_430995.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-12-26T15:15:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31103#event-430995"
}
```



---

archive/issue_comments_498351.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6dd6e5cc427b056efc3a4a65d59234493a95f04c\"><code>6dd6e5c</code></a></td><td><code>Fix compilation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eceefb3713d7dc87d0e81cc44b21d150a07d4ee1\"><code>eceefb3</code></a></td><td><code>Remove string wrap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d345bff9596c5e513aba8076a6c531fc9a366092\"><code>d345bff</code></a></td><td><code>Fix test</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c47c4bf7352b13764a0ec1aa497a6f24f3913ad9\"><code>c47c4bf</code></a></td><td><code>Correct indent</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3fcaf5f4408c946f5423d42facb5bb666635db35\"><code>3fcaf5f</code></a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into public/build/multiarchsimple</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/090e6f10f1135062d1f65a1f1fa7a366e51ac388\"><code>090e6f1</code></a></td><td><code>Simplify code</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa4556ac2815bffa2d7866d94b3e061ba787d816\"><code>fa4556a</code></a></td><td><code>Remove _get_sage_local</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4cdf94db9f2e8212ecc8edea74d73620b0593e96\"><code>4cdf94d</code></a></td><td><code>Merge branch 'public/build/multiarchsimple' of git://trac.sagemath.org/sage into public/refactoring/pytest-numerical-backends</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5fd49b716529d6e7a7a94f1302897f2fbd17e6b5\"><code>5fd49b7</code></a></td><td><code>Migrate some tests to pytest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/719e442e5d3a3eaadab28bc835b68d46a4a2d12d\"><code>719e442</code></a></td><td><code>Run pytest as part of sage -t</code></td></tr></table>\n",
    "created_at": "2020-12-26T15:15:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498351",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6dd6e5cc427b056efc3a4a65d59234493a95f04c"><code>6dd6e5c</code></a></td><td><code>Fix compilation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eceefb3713d7dc87d0e81cc44b21d150a07d4ee1"><code>eceefb3</code></a></td><td><code>Remove string wrap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d345bff9596c5e513aba8076a6c531fc9a366092"><code>d345bff</code></a></td><td><code>Fix test</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c47c4bf7352b13764a0ec1aa497a6f24f3913ad9"><code>c47c4bf</code></a></td><td><code>Correct indent</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3fcaf5f4408c946f5423d42facb5bb666635db35"><code>3fcaf5f</code></a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into public/build/multiarchsimple</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/090e6f10f1135062d1f65a1f1fa7a366e51ac388"><code>090e6f1</code></a></td><td><code>Simplify code</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa4556ac2815bffa2d7866d94b3e061ba787d816"><code>fa4556a</code></a></td><td><code>Remove _get_sage_local</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4cdf94db9f2e8212ecc8edea74d73620b0593e96"><code>4cdf94d</code></a></td><td><code>Merge branch 'public/build/multiarchsimple' of git://trac.sagemath.org/sage into public/refactoring/pytest-numerical-backends</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5fd49b716529d6e7a7a94f1302897f2fbd17e6b5"><code>5fd49b7</code></a></td><td><code>Migrate some tests to pytest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/719e442e5d3a3eaadab28bc835b68d46a4a2d12d"><code>719e442</code></a></td><td><code>Run pytest as part of sage -t</code></td></tr></table>




---

archive/issue_comments_498352.json:
```json
{
    "body": "Commit: **[`719e442`](https://github.com/sagemath/sagetrac-mirror/commit/719e442e5d3a3eaadab28bc835b68d46a4a2d12d)**",
    "created_at": "2020-12-26T15:15:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498352",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`719e442`](https://github.com/sagemath/sagetrac-mirror/commit/719e442e5d3a3eaadab28bc835b68d46a4a2d12d)**



---

archive/issue_comments_498353.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,6 @@\n `sage.numerical.backends` provides an opportunity to study use of `pytest` as a replacement for `TestSuite` (proposed in #30738) in a small self-contained codebase.\n \n-`GenericBackend` defines an API and a small number of `_test_` methods to check that the API is implemented correctly by the backend implementations. \n-\n-Apart from converting from `TestSuite` to pytest, this would be a good opportunity to expand the tests to replace what is currently tested using copy-pasted doctests.\n+`GenericBackend` defines an API and a small number of `_test_` methods to check that the API is implemented correctly by the backend implementations. We do this at the example of `_test_ncols_nonnegative`, leaving the other test methods for follow-up tickets.\n \n Important design constraint:\n - The testing framework must be extensible by user-defined classes (or classes from separately installed Python packages - such as the existing `sage_numerical_backends_coin`).\n``````\n",
    "created_at": "2020-12-26T15:17:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498353",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,6 @@
 `sage.numerical.backends` provides an opportunity to study use of `pytest` as a replacement for `TestSuite` (proposed in #30738) in a small self-contained codebase.
 
-`GenericBackend` defines an API and a small number of `_test_` methods to check that the API is implemented correctly by the backend implementations. 
-
-Apart from converting from `TestSuite` to pytest, this would be a good opportunity to expand the tests to replace what is currently tested using copy-pasted doctests.
+`GenericBackend` defines an API and a small number of `_test_` methods to check that the API is implemented correctly by the backend implementations. We do this at the example of `_test_ncols_nonnegative`, leaving the other test methods for follow-up tickets.
 
 Important design constraint:
 - The testing framework must be extensible by user-defined classes (or classes from separately installed Python packages - such as the existing `sage_numerical_backends_coin`).
``````




---

archive/issue_comments_498354.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@mkoeppe](#comment:2):\n> - invoke the existing `TestSuite` as one pytest method or\n\nThat's a great idea, making it possible to step-by-step migrate more test methods without the need to do everything at once! I've used it now.\n\n> - dynamically generate adapter methods that invoke the existing `_test` methods.\n\nThat might also work, but is more work since the `_test` methods are instance methods, and for pytest the adapter method would need to be provided with the instance (which in the current design is passed to the `TestSuite`). It's probably easier to simply rewrite the test method in pytest.",
    "created_at": "2020-12-26T15:22:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498354",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@mkoeppe](#comment:2):
> - invoke the existing `TestSuite` as one pytest method or

That's a great idea, making it possible to step-by-step migrate more test methods without the need to do everything at once! I've used it now.

> - dynamically generate adapter methods that invoke the existing `_test` methods.

That might also work, but is more work since the `_test` methods are instance methods, and for pytest the adapter method would need to be provided with the instance (which in the current design is passed to the `TestSuite`). It's probably easier to simply rewrite the test method in pytest.



---

archive/issue_comments_498355.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThanks a lot!",
    "created_at": "2020-12-26T18:33:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498355",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">comment:7</div>

Thanks a lot!



---

archive/issue_comments_498356.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nSome quick remarks (I haven't had a chance to test it yet):\n- I'd suggest to rename `test_old_testsuite` to something more specific like `test_sage_unittest_testsuite`.\n- In the addition to `src/bin/sage-runtests` - this needs to work without error if `pytest` is not installed (currently it is only an optional package - see #31110)",
    "created_at": "2020-12-26T18:40:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498356",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

Some quick remarks (I haven't had a chance to test it yet):
- I'd suggest to rename `test_old_testsuite` to something more specific like `test_sage_unittest_testsuite`.
- In the addition to `src/bin/sage-runtests` - this needs to work without error if `pytest` is not installed (currently it is only an optional package - see #31110)



---

archive/issue_comments_498357.json:
```json
{
    "body": "Author: **Tobias Diez**",
    "created_at": "2020-12-26T18:40:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498357",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Tobias Diez**



---

archive/issue_comments_498358.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nAlso, perhaps `src/bin/sage-runtests` should only invoke `pytest` if it is testing directories/packages that contain pytest tests (any heuristic for checking this is fine).",
    "created_at": "2020-12-26T18:42:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498358",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

Also, perhaps `src/bin/sage-runtests` should only invoke `pytest` if it is testing directories/packages that contain pytest tests (any heuristic for checking this is fine).



---

archive/issue_comments_498359.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d1f14f011c23a1a218400af7400edb7e1c613c0b\"><code>d1f14f0</code></a></td><td><code>Incorporate feedback</code></td></tr></table>\n",
    "created_at": "2020-12-26T19:27:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498359",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d1f14f011c23a1a218400af7400edb7e1c613c0b"><code>d1f14f0</code></a></td><td><code>Incorporate feedback</code></td></tr></table>




---

archive/issue_comments_498360.json:
```json
{
    "body": "Changed commit from **[`719e442`](https://github.com/sagemath/sagetrac-mirror/commit/719e442e5d3a3eaadab28bc835b68d46a4a2d12d)** to **[`d1f14f0`](https://github.com/sagemath/sagetrac-mirror/commit/d1f14f011c23a1a218400af7400edb7e1c613c0b)**",
    "created_at": "2020-12-26T19:27:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498360",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`719e442`](https://github.com/sagemath/sagetrac-mirror/commit/719e442e5d3a3eaadab28bc835b68d46a4a2d12d)** to **[`d1f14f0`](https://github.com/sagemath/sagetrac-mirror/commit/d1f14f011c23a1a218400af7400edb7e1c613c0b)**



---

archive/issue_comments_498361.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@mkoeppe](#comment:8):\n> Some quick remarks (I haven't had a chance to test it yet):\n> - I'd suggest to rename `test_old_testsuite` to something more specific like `test_sage_unittest_testsuite`.\n> - In the addition to `src/bin/sage-runtests` - this needs to work without error if `pytest` is not installed (currently it is only an optional package - see #31110)\n\nThanks! Done.",
    "created_at": "2020-12-26T19:27:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498361",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@mkoeppe](#comment:8):
> Some quick remarks (I haven't had a chance to test it yet):
> - I'd suggest to rename `test_old_testsuite` to something more specific like `test_sage_unittest_testsuite`.
> - In the addition to `src/bin/sage-runtests` - this needs to work without error if `pytest` is not installed (currently it is only an optional package - see #31110)

Thanks! Done.



---

archive/issue_comments_498362.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@mkoeppe](#comment:10):\n> Also, perhaps `src/bin/sage-runtests` should only invoke `pytest` if it is testing directories/packages that contain pytest tests (any heuristic for checking this is fine). \n\nMhh, pytest has its own test discovery bult-in, so I think its fine to just pass the path to it and let it look for the files. What advantages do you see of using a custom heuristic beforehand?",
    "created_at": "2020-12-26T19:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498362",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@mkoeppe](#comment:10):
> Also, perhaps `src/bin/sage-runtests` should only invoke `pytest` if it is testing directories/packages that contain pytest tests (any heuristic for checking this is fine). 

Mhh, pytest has its own test discovery bult-in, so I think its fine to just pass the path to it and let it look for the files. What advantages do you see of using a custom heuristic beforehand?



---

archive/issue_comments_498363.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@tobiasdiez](#comment:13):\n> What advantages do you see of using a custom heuristic beforehand?\n\nWhen pytest is not installed and you run `sage -t` on all of Sage, it should warn that the pytest-dependent tests are not run. (Your latest commit does that.)\n\nBut it should probably not warn if a user invokes `sage -t` on a part of Sage that does not use pytest yet -- to be less annoying.",
    "created_at": "2020-12-26T19:50:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498363",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@tobiasdiez](#comment:13):
> What advantages do you see of using a custom heuristic beforehand?

When pytest is not installed and you run `sage -t` on all of Sage, it should warn that the pytest-dependent tests are not run. (Your latest commit does that.)

But it should probably not warn if a user invokes `sage -t` on a part of Sage that does not use pytest yet -- to be less annoying.



---

archive/issue_comments_498364.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nShouldn't `test_sage_unittest_testsuite` be provided by something more general than `GenericBackendTests`? (in other words, should `GenericBackendTests` not derive from some other class?)",
    "created_at": "2020-12-26T19:56:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498364",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

Shouldn't `test_sage_unittest_testsuite` be provided by something more general than `GenericBackendTests`? (in other words, should `GenericBackendTests` not derive from some other class?)



---

archive/issue_comments_498365.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@mkoeppe](#comment:15):\n> Shouldn't `test_sage_unittest_testsuite` be provided by something more general than `GenericBackendTests`? (in other words, should `GenericBackendTests` not derive from some other class?)\n\nGood idea for later purposes. However, it doesn't remove the test_sage_unittest_testsuite method in GenericBackendTests since all backend tests ignore test_pickling, so this still has to be done there.",
    "created_at": "2020-12-26T20:17:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498365",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@mkoeppe](#comment:15):
> Shouldn't `test_sage_unittest_testsuite` be provided by something more general than `GenericBackendTests`? (in other words, should `GenericBackendTests` not derive from some other class?)

Good idea for later purposes. However, it doesn't remove the test_sage_unittest_testsuite method in GenericBackendTests since all backend tests ignore test_pickling, so this still has to be done there.



---

archive/issue_comments_498366.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4a0c4a19b7cb07df3cb95295fc5d3b794e0c7d5\"><code>f4a0c4a</code></a></td><td><code>Create SageObJectTest</code></td></tr></table>\n",
    "created_at": "2020-12-26T20:19:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498366",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4a0c4a19b7cb07df3cb95295fc5d3b794e0c7d5"><code>f4a0c4a</code></a></td><td><code>Create SageObJectTest</code></td></tr></table>




---

archive/issue_comments_498367.json:
```json
{
    "body": "Changed commit from **[`d1f14f0`](https://github.com/sagemath/sagetrac-mirror/commit/d1f14f011c23a1a218400af7400edb7e1c613c0b)** to **[`f4a0c4a`](https://github.com/sagemath/sagetrac-mirror/commit/f4a0c4a19b7cb07df3cb95295fc5d3b794e0c7d5)**",
    "created_at": "2020-12-26T20:19:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498367",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d1f14f0`](https://github.com/sagemath/sagetrac-mirror/commit/d1f14f011c23a1a218400af7400edb7e1c613c0b)** to **[`f4a0c4a`](https://github.com/sagemath/sagetrac-mirror/commit/f4a0c4a19b7cb07df3cb95295fc5d3b794e0c7d5)**



---

archive/issue_comments_498368.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nGreat. Could you add a docstring for `test_sage_unittest_testsuite` to explain that \"subclasses can override this method if they need to skip some tests\".\n\nWe should also clarify whether `..._test.py` should be exempt from our rule that every function needs a docstring and a doctest. If so, probably the patchbot will need some adjustments so it will not complain.",
    "created_at": "2020-12-27T03:24:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498368",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

Great. Could you add a docstring for `test_sage_unittest_testsuite` to explain that "subclasses can override this method if they need to skip some tests".

We should also clarify whether `..._test.py` should be exempt from our rule that every function needs a docstring and a doctest. If so, probably the patchbot will need some adjustments so it will not complain.



---

archive/issue_comments_498369.json:
```json
{
    "body": "Changed commit from **[`f4a0c4a`](https://github.com/sagemath/sagetrac-mirror/commit/f4a0c4a19b7cb07df3cb95295fc5d3b794e0c7d5)** to **[`3c06234`](https://github.com/sagemath/sagetrac-mirror/commit/3c06234e703737f5ddaeb09caa4161ab26578ba7)**",
    "created_at": "2020-12-27T09:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498369",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f4a0c4a`](https://github.com/sagemath/sagetrac-mirror/commit/f4a0c4a19b7cb07df3cb95295fc5d3b794e0c7d5)** to **[`3c06234`](https://github.com/sagemath/sagetrac-mirror/commit/3c06234e703737f5ddaeb09caa4161ab26578ba7)**



---

archive/issue_comments_498370.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c06234e703737f5ddaeb09caa4161ab26578ba7\"><code>3c06234</code></a></td><td><code>Add docstring</code></td></tr></table>\n",
    "created_at": "2020-12-27T09:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498370",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c06234e703737f5ddaeb09caa4161ab26578ba7"><code>3c06234</code></a></td><td><code>Add docstring</code></td></tr></table>




---

archive/issue_comments_498371.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@mkoeppe](#comment:18):\n> We should also clarify whether `..._test.py` should be exempt from our rule that every function needs a docstring and a doctest. If so, probably the patchbot will need some adjustments so it will not complain.\n> \n\nThat's a good idea. Tests indeed usually don't have docstrings (because they are only supposed to test one thing, which can be described by the name of the test method).\n\nI think we also should fix our convention concerning the naming of the test files. There are three possibilities:\n\n- `object_test.py` in the same folder as the module `object.py` (advantage: group test with object)\n- `test_object.py` in the same folder as the module `object.py` (advantage: group tests)\n- either of the above but in a new `test` folder (advantage: clear separation of tests and source)",
    "created_at": "2020-12-27T09:49:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498371",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@mkoeppe](#comment:18):
> We should also clarify whether `..._test.py` should be exempt from our rule that every function needs a docstring and a doctest. If so, probably the patchbot will need some adjustments so it will not complain.
> 

That's a good idea. Tests indeed usually don't have docstrings (because they are only supposed to test one thing, which can be described by the name of the test method).

I think we also should fix our convention concerning the naming of the test files. There are three possibilities:

- `object_test.py` in the same folder as the module `object.py` (advantage: group test with object)
- `test_object.py` in the same folder as the module `object.py` (advantage: group tests)
- either of the above but in a new `test` folder (advantage: clear separation of tests and source)



---

archive/issue_comments_498372.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI have a strong preference for the first option, `object_test.py` in the same folder... because somehow it is the closest to our current practice of keeping tests as close as possible to the module.",
    "created_at": "2020-12-27T17:31:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498372",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

I have a strong preference for the first option, `object_test.py` in the same folder... because somehow it is the closest to our current practice of keeping tests as close as possible to the module.



---

archive/issue_comments_498373.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nOk, I've added this convention to #31003.",
    "created_at": "2020-12-27T18:17:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498373",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:22" align="right">comment:22</div>

Ok, I've added this convention to #31003.



---

archive/issue_comments_498374.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThis and #31003 still need review.",
    "created_at": "2021-01-15T12:16:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498374",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:23" align="right">comment:23</div>

This and #31003 still need review.



---

archive/issue_comments_498375.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nMatthias, do you encounter the same cython module issue if you run `sage-runtests` from this branch (you can exit the normal doctests with Ctrl+C)?",
    "created_at": "2021-01-23T23:05:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498375",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:24" align="right">comment:24</div>

Matthias, do you encounter the same cython module issue if you run `sage-runtests` from this branch (you can exit the normal doctests with Ctrl+C)?



---

archive/issue_comments_498376.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nYes\n\n```\n(sage-sh) mkoeppe@egret:worktree-algebraic-2018-spring$ pytest src\n=========================================================================== test session starts ===========================================================================\nplatform darwin -- Python 3.9.1, pytest-6.2.1, py-1.10.0, pluggy-0.13.1\nrootdir: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src\ncollected 0 items / 8 errors                                                                                                                                              \n\n================================================================================= ERRORS ==================================================================================\n_____________________________________________________ ERROR collecting sage/numerical/backends/cvxopt_backend_test.py _____________________________________________________\nImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/cvxopt_backend_test.py'.\nHint: make sure your test modules/packages have valid Python names.\nTraceback:\n/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py:127: in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\nsrc/sage/numerical/backends/cvxopt_backend_test.py:2: in <module>\n    from sage.numerical.backends.generic_backend_test import GenericBackendTests\nsrc/sage/numerical/backends/generic_backend_test.py:2: in <module>\n    from .generic_backend import GenericBackend\nE   ModuleNotFoundError: No module named 'sage.numerical.backends.generic_backend'\n____________________________________________________ ERROR collecting sage/numerical/backends/generic_backend_test.py _____________________________________________________\nImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/generic_backend_test.py'.\nHint: make sure your test modules/packages have valid Python names.\nTraceback:\n/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py:127: in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\nsrc/sage/numerical/backends/generic_backend_test.py:2: in <module>\n    from .generic_backend import GenericBackend\nE   ModuleNotFoundError: No module named 'sage.numerical.backends.generic_backend'\n______________________________________________________ ERROR collecting sage/numerical/backends/glpk_backend_test.py ______________________________________________________\nImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/glpk_backend_test.py'.\nHint: make sure your test modules/packages have valid Python names.\nTraceback:\n/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py:127: in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\nsrc/sage/numerical/backends/glpk_backend_test.py:2: in <module>\n    from sage.numerical.backends.generic_backend_test import GenericBackendTests\nsrc/sage/numerical/backends/generic_backend_test.py:2: in <module>\n    from .generic_backend import GenericBackend\nE   ModuleNotFoundError: No module named 'sage.numerical.backends.generic_backend'\n___________________________________________________ ERROR collecting sage/numerical/backends/glpk_exact_backend_test.py ___________________________________________________\nImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/glpk_exact_backend_test.py'.\nHint: make sure your test modules/packages have valid Python names.\nTraceback:\n/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py:127: in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\nsrc/sage/numerical/backends/glpk_exact_backend_test.py:2: in <module>\n    from sage.numerical.backends.generic_backend_test import GenericBackendTests\nsrc/sage/numerical/backends/generic_backend_test.py:2: in <module>\n    from .generic_backend import GenericBackend\nE   ModuleNotFoundError: No module named 'sage.numerical.backends.generic_backend'\n_________________________________________________ ERROR collecting sage/numerical/backends/interactivelp_backend_test.py __________________________________________________\nImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/interactivelp_backend_test.py'.\nHint: make sure your test modules/packages have valid Python names.\nTraceback:\n/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py:127: in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\nsrc/sage/numerical/backends/interactivelp_backend_test.py:2: in <module>\n    from sage.numerical.backends.generic_backend_test import GenericBackendTests\nsrc/sage/numerical/backends/generic_backend_test.py:2: in <module>\n    from .generic_backend import GenericBackend\nE   ModuleNotFoundError: No module named 'sage.numerical.backends.generic_backend'\n______________________________________________________ ERROR collecting sage/numerical/backends/ppl_backend_test.py _______________________________________________________\nImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/ppl_backend_test.py'.\nHint: make sure your test modules/packages have valid Python names.\nTraceback:\n/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py:127: in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\nsrc/sage/numerical/backends/ppl_backend_test.py:2: in <module>\n    from sage.numerical.backends.generic_backend_test import GenericBackendTests\nsrc/sage/numerical/backends/generic_backend_test.py:2: in <module>\n    from .generic_backend import GenericBackend\nE   ModuleNotFoundError: No module named 'sage.numerical.backends.generic_backend'\n___________________________________________________________ ERROR collecting sage/structure/sage_object_test.py ___________________________________________________________\nImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/structure/sage_object_test.py'.\nHint: make sure your test modules/packages have valid Python names.\nTraceback:\n/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py:127: in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\nsrc/sage/structure/__init__.py:2: in <module>\n    import sage.structure.element\nE   ModuleNotFoundError: No module named 'sage.structure.element'\n_____________________________________________________________ ERROR collecting sage/tests/deprecation_test.py _____________________________________________________________\nImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/tests/deprecation_test.py'.\nHint: make sure your test modules/packages have valid Python names.\nTraceback:\n/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py:127: in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\nsrc/sage/tests/deprecation_test.py:12: in <module>\n    from sage.misc.superseded import deprecated_function_alias\nsrc/sage/misc/superseded.py:29: in <module>\n    from sage.misc.lazy_attribute import lazy_attribute\nE   ModuleNotFoundError: No module named 'sage.misc.lazy_attribute'\n========================================================================= short test summary info =========================================================================\nERROR src/sage/numerical/backends/cvxopt_backend_test.py\nERROR src/sage/numerical/backends/generic_backend_test.py\nERROR src/sage/numerical/backends/glpk_backend_test.py\nERROR src/sage/numerical/backends/glpk_exact_backend_test.py\nERROR src/sage/numerical/backends/interactivelp_backend_test.py\nERROR src/sage/numerical/backends/ppl_backend_test.py\nERROR src/sage/structure/sage_object_test.py\nERROR src/sage/tests/deprecation_test.py\n```",
    "created_at": "2021-01-24T01:11:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498376",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

Yes

```
(sage-sh) mkoeppe@egret:worktree-algebraic-2018-spring$ pytest src
=========================================================================== test session starts ===========================================================================
platform darwin -- Python 3.9.1, pytest-6.2.1, py-1.10.0, pluggy-0.13.1
rootdir: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src
collected 0 items / 8 errors                                                                                                                                              

================================================================================= ERRORS ==================================================================================
_____________________________________________________ ERROR collecting sage/numerical/backends/cvxopt_backend_test.py _____________________________________________________
ImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/cvxopt_backend_test.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py:127: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
src/sage/numerical/backends/cvxopt_backend_test.py:2: in <module>
    from sage.numerical.backends.generic_backend_test import GenericBackendTests
src/sage/numerical/backends/generic_backend_test.py:2: in <module>
    from .generic_backend import GenericBackend
E   ModuleNotFoundError: No module named 'sage.numerical.backends.generic_backend'
____________________________________________________ ERROR collecting sage/numerical/backends/generic_backend_test.py _____________________________________________________
ImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/generic_backend_test.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py:127: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
src/sage/numerical/backends/generic_backend_test.py:2: in <module>
    from .generic_backend import GenericBackend
E   ModuleNotFoundError: No module named 'sage.numerical.backends.generic_backend'
______________________________________________________ ERROR collecting sage/numerical/backends/glpk_backend_test.py ______________________________________________________
ImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/glpk_backend_test.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py:127: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
src/sage/numerical/backends/glpk_backend_test.py:2: in <module>
    from sage.numerical.backends.generic_backend_test import GenericBackendTests
src/sage/numerical/backends/generic_backend_test.py:2: in <module>
    from .generic_backend import GenericBackend
E   ModuleNotFoundError: No module named 'sage.numerical.backends.generic_backend'
___________________________________________________ ERROR collecting sage/numerical/backends/glpk_exact_backend_test.py ___________________________________________________
ImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/glpk_exact_backend_test.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py:127: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
src/sage/numerical/backends/glpk_exact_backend_test.py:2: in <module>
    from sage.numerical.backends.generic_backend_test import GenericBackendTests
src/sage/numerical/backends/generic_backend_test.py:2: in <module>
    from .generic_backend import GenericBackend
E   ModuleNotFoundError: No module named 'sage.numerical.backends.generic_backend'
_________________________________________________ ERROR collecting sage/numerical/backends/interactivelp_backend_test.py __________________________________________________
ImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/interactivelp_backend_test.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py:127: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
src/sage/numerical/backends/interactivelp_backend_test.py:2: in <module>
    from sage.numerical.backends.generic_backend_test import GenericBackendTests
src/sage/numerical/backends/generic_backend_test.py:2: in <module>
    from .generic_backend import GenericBackend
E   ModuleNotFoundError: No module named 'sage.numerical.backends.generic_backend'
______________________________________________________ ERROR collecting sage/numerical/backends/ppl_backend_test.py _______________________________________________________
ImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/ppl_backend_test.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py:127: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
src/sage/numerical/backends/ppl_backend_test.py:2: in <module>
    from sage.numerical.backends.generic_backend_test import GenericBackendTests
src/sage/numerical/backends/generic_backend_test.py:2: in <module>
    from .generic_backend import GenericBackend
E   ModuleNotFoundError: No module named 'sage.numerical.backends.generic_backend'
___________________________________________________________ ERROR collecting sage/structure/sage_object_test.py ___________________________________________________________
ImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/structure/sage_object_test.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py:127: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
src/sage/structure/__init__.py:2: in <module>
    import sage.structure.element
E   ModuleNotFoundError: No module named 'sage.structure.element'
_____________________________________________________________ ERROR collecting sage/tests/deprecation_test.py _____________________________________________________________
ImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/tests/deprecation_test.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py:127: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
src/sage/tests/deprecation_test.py:12: in <module>
    from sage.misc.superseded import deprecated_function_alias
src/sage/misc/superseded.py:29: in <module>
    from sage.misc.lazy_attribute import lazy_attribute
E   ModuleNotFoundError: No module named 'sage.misc.lazy_attribute'
========================================================================= short test summary info =========================================================================
ERROR src/sage/numerical/backends/cvxopt_backend_test.py
ERROR src/sage/numerical/backends/generic_backend_test.py
ERROR src/sage/numerical/backends/glpk_backend_test.py
ERROR src/sage/numerical/backends/glpk_exact_backend_test.py
ERROR src/sage/numerical/backends/interactivelp_backend_test.py
ERROR src/sage/numerical/backends/ppl_backend_test.py
ERROR src/sage/structure/sage_object_test.py
ERROR src/sage/tests/deprecation_test.py
```



---

archive/issue_comments_498377.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nRunning `pytest` directly only works if you have an editable install, so that's not a surprise. But does it work if you run `sage-runtests` which now invokes pytest (using python code). From what I read, this should work.",
    "created_at": "2021-01-24T12:24:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498377",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:26" align="right">comment:26</div>

Running `pytest` directly only works if you have an editable install, so that's not a surprise. But does it work if you run `sage-runtests` which now invokes pytest (using python code). From what I read, this should work.



---

archive/issue_events_430996.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-24T18:28:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31103#event-430996"
}
```



---

archive/issue_events_430997.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-24T18:28:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31103#event-430997"
}
```



---

archive/issue_events_430998.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-24T18:28:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31103#event-430998"
}
```



---

archive/issue_events_430999.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-24T18:28:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31103#event-430999"
}
```



---

archive/issue_comments_498378.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nSorry, I missed that.\n\n```\n$ ./sage -tp src/sage/numerical/backends/\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2021-01-24-10-26-16-7200536b.\nUsing --optional=build,ccache,dochtml,homebrew,pip,saclib,sage,sage_spkg\nSorting sources by runtime so that slower doctests are run first....\nDoctesting 25 files using 8 threads.\nsage -t --random-seed=0 src/sage/numerical/backends/interactivelp_backend.pxd\n    [0 tests, 0.00 s]\n[...]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 4.4 seconds\n    cpu time: 7.3 seconds\n    cumulative wall time: 12.9 seconds\n=========================================================================== test session starts ===========================================================================\nplatform darwin -- Python 3.9.1, pytest-6.2.1, py-1.10.0, pluggy-0.13.1\nrootdir: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src, configfile: tox.ini\ncollected 0 items / 6 errors                                                                                                                                              \n\n================================================================================= ERRORS ==================================================================================\n_____________________________________________________ ERROR collecting sage/numerical/backends/cvxopt_backend_test.py _____________________________________________________\n/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py:127: in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\n<frozen importlib._bootstrap>:1030: in _gcd_import\n    ???\n<frozen importlib._bootstrap>:1007: in _find_and_load\n    ???\n<frozen importlib._bootstrap>:986: in _find_and_load_unlocked\n    ???\n<frozen importlib._bootstrap>:680: in _load_unlocked\n    ???\nlocal/lib/python3.9/site-packages/_pytest/assertion/rewrite.py:170: in exec_module\n    exec(co, module.__dict__)\nlocal/lib/python3.9/site-packages/sage/numerical/backends/cvxopt_backend_test.py:6: in <module>\n    class TestCVXOPTBackend(GenericBackendTests):\nlocal/lib/python3.9/site-packages/sage/numerical/backends/cvxopt_backend_test.py:12: in TestCVXOPTBackend\n    def test_sage_unittest_testsuite(self, sage_object: SageObject):\nE   NameError: name 'SageObject' is not defined\n____________________________________________________ ERROR collecting sage/numerical/backends/generic_backend_test.py _____________________________________________________\nimport file mismatch:\nimported module 'sage.numerical.backends.generic_backend_test' has this __file__ attribute:\n  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/sage/numerical/backends/generic_backend_test.py\nwhich is not the same as the test file we want to collect:\n  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/generic_backend_test.py\nHINT: remove __pycache__ / .pyc files and/or use a unique basename for your test file modules\n______________________________________________________ ERROR collecting sage/numerical/backends/glpk_backend_test.py ______________________________________________________\nimport file mismatch:\nimported module 'sage.numerical.backends.glpk_backend_test' has this __file__ attribute:\n  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/sage/numerical/backends/glpk_backend_test.py\nwhich is not the same as the test file we want to collect:\n  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/glpk_backend_test.py\nHINT: remove __pycache__ / .pyc files and/or use a unique basename for your test file modules\n___________________________________________________ ERROR collecting sage/numerical/backends/glpk_exact_backend_test.py ___________________________________________________\nimport file mismatch:\nimported module 'sage.numerical.backends.glpk_exact_backend_test' has this __file__ attribute:\n  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/sage/numerical/backends/glpk_exact_backend_test.py\nwhich is not the same as the test file we want to collect:\n  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/glpk_exact_backend_test.py\nHINT: remove __pycache__ / .pyc files and/or use a unique basename for your test file modules\n_________________________________________________ ERROR collecting sage/numerical/backends/interactivelp_backend_test.py __________________________________________________\nimport file mismatch:\nimported module 'sage.numerical.backends.interactivelp_backend_test' has this __file__ attribute:\n  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/sage/numerical/backends/interactivelp_backend_test.py\nwhich is not the same as the test file we want to collect:\n  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/interactivelp_backend_test.py\nHINT: remove __pycache__ / .pyc files and/or use a unique basename for your test file modules\n______________________________________________________ ERROR collecting sage/numerical/backends/ppl_backend_test.py _______________________________________________________\nimport file mismatch:\nimported module 'sage.numerical.backends.ppl_backend_test' has this __file__ attribute:\n  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/sage/numerical/backends/ppl_backend_test.py\nwhich is not the same as the test file we want to collect:\n  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/ppl_backend_test.py\nHINT: remove __pycache__ / .pyc files and/or use a unique basename for your test file modules\n========================================================================= short test summary info =========================================================================\nERROR src/sage/numerical/backends/cvxopt_backend_test.py - NameError: name 'SageObject' is not defined\nERROR src/sage/numerical/backends/generic_backend_test.py\nERROR src/sage/numerical/backends/glpk_backend_test.py\nERROR src/sage/numerical/backends/glpk_exact_backend_test.py\nERROR src/sage/numerical/backends/interactivelp_backend_test.py\nERROR src/sage/numerical/backends/ppl_backend_test.py\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n============================================================================ 6 errors in 0.55s ============================================================================\n```",
    "created_at": "2021-01-24T18:28:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498378",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

Sorry, I missed that.

```
$ ./sage -tp src/sage/numerical/backends/
too many failed tests, not using stored timings
Running doctests with ID 2021-01-24-10-26-16-7200536b.
Using --optional=build,ccache,dochtml,homebrew,pip,saclib,sage,sage_spkg
Sorting sources by runtime so that slower doctests are run first....
Doctesting 25 files using 8 threads.
sage -t --random-seed=0 src/sage/numerical/backends/interactivelp_backend.pxd
    [0 tests, 0.00 s]
[...]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 4.4 seconds
    cpu time: 7.3 seconds
    cumulative wall time: 12.9 seconds
=========================================================================== test session starts ===========================================================================
platform darwin -- Python 3.9.1, pytest-6.2.1, py-1.10.0, pluggy-0.13.1
rootdir: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src, configfile: tox.ini
collected 0 items / 6 errors                                                                                                                                              

================================================================================= ERRORS ==================================================================================
_____________________________________________________ ERROR collecting sage/numerical/backends/cvxopt_backend_test.py _____________________________________________________
/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py:127: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
<frozen importlib._bootstrap>:1030: in _gcd_import
    ???
<frozen importlib._bootstrap>:1007: in _find_and_load
    ???
<frozen importlib._bootstrap>:986: in _find_and_load_unlocked
    ???
<frozen importlib._bootstrap>:680: in _load_unlocked
    ???
local/lib/python3.9/site-packages/_pytest/assertion/rewrite.py:170: in exec_module
    exec(co, module.__dict__)
local/lib/python3.9/site-packages/sage/numerical/backends/cvxopt_backend_test.py:6: in <module>
    class TestCVXOPTBackend(GenericBackendTests):
local/lib/python3.9/site-packages/sage/numerical/backends/cvxopt_backend_test.py:12: in TestCVXOPTBackend
    def test_sage_unittest_testsuite(self, sage_object: SageObject):
E   NameError: name 'SageObject' is not defined
____________________________________________________ ERROR collecting sage/numerical/backends/generic_backend_test.py _____________________________________________________
import file mismatch:
imported module 'sage.numerical.backends.generic_backend_test' has this __file__ attribute:
  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/sage/numerical/backends/generic_backend_test.py
which is not the same as the test file we want to collect:
  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/generic_backend_test.py
HINT: remove __pycache__ / .pyc files and/or use a unique basename for your test file modules
______________________________________________________ ERROR collecting sage/numerical/backends/glpk_backend_test.py ______________________________________________________
import file mismatch:
imported module 'sage.numerical.backends.glpk_backend_test' has this __file__ attribute:
  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/sage/numerical/backends/glpk_backend_test.py
which is not the same as the test file we want to collect:
  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/glpk_backend_test.py
HINT: remove __pycache__ / .pyc files and/or use a unique basename for your test file modules
___________________________________________________ ERROR collecting sage/numerical/backends/glpk_exact_backend_test.py ___________________________________________________
import file mismatch:
imported module 'sage.numerical.backends.glpk_exact_backend_test' has this __file__ attribute:
  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/sage/numerical/backends/glpk_exact_backend_test.py
which is not the same as the test file we want to collect:
  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/glpk_exact_backend_test.py
HINT: remove __pycache__ / .pyc files and/or use a unique basename for your test file modules
_________________________________________________ ERROR collecting sage/numerical/backends/interactivelp_backend_test.py __________________________________________________
import file mismatch:
imported module 'sage.numerical.backends.interactivelp_backend_test' has this __file__ attribute:
  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/sage/numerical/backends/interactivelp_backend_test.py
which is not the same as the test file we want to collect:
  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/interactivelp_backend_test.py
HINT: remove __pycache__ / .pyc files and/or use a unique basename for your test file modules
______________________________________________________ ERROR collecting sage/numerical/backends/ppl_backend_test.py _______________________________________________________
import file mismatch:
imported module 'sage.numerical.backends.ppl_backend_test' has this __file__ attribute:
  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/sage/numerical/backends/ppl_backend_test.py
which is not the same as the test file we want to collect:
  /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/numerical/backends/ppl_backend_test.py
HINT: remove __pycache__ / .pyc files and/or use a unique basename for your test file modules
========================================================================= short test summary info =========================================================================
ERROR src/sage/numerical/backends/cvxopt_backend_test.py - NameError: name 'SageObject' is not defined
ERROR src/sage/numerical/backends/generic_backend_test.py
ERROR src/sage/numerical/backends/glpk_backend_test.py
ERROR src/sage/numerical/backends/glpk_exact_backend_test.py
ERROR src/sage/numerical/backends/interactivelp_backend_test.py
ERROR src/sage/numerical/backends/ppl_backend_test.py
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
============================================================================ 6 errors in 0.55s ============================================================================
```



---

archive/issue_comments_498379.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nOk, thanks for the feedback. I'll have a look.",
    "created_at": "2021-01-24T18:42:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498379",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:28" align="right">comment:28</div>

Ok, thanks for the feedback. I'll have a look.



---

archive/issue_comments_498380.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nAny progress here? There's some momentum to add more tests to generic_backend, and it would be great if they could be done in the new framework already",
    "created_at": "2021-01-31T22:18:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498380",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:29" align="right">comment:29</div>

Any progress here? There's some momentum to add more tests to generic_backend, and it would be great if they could be done in the new framework already



---

archive/issue_comments_498381.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nBy default, pytest expects the compiled cython files to be in the same folder (inplace install). To support sage's build system, one needs to modify `sys.path` in the conftest file as shown here: https://stackoverflow.com/questions/20971619/ensuring-py-test-includes-the-application-directory-in-sys-path\nWhat is the correct SAGE_XYZ folder to specify there? SAGE_LOCAL?\n\nMoreover, it could be a problem that the test files are present twice (in local and src), which I think leads to the other errors above. Maybe https://docs.pytest.org/en/stable/pythonpath.html helps.\n\nI will have a look at these things, but it will take some time as I have to destroy my nicely working inplace install for this. Feel free to play around with the above linked code.",
    "created_at": "2021-01-31T23:51:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498381",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:30" align="right">comment:30</div>

By default, pytest expects the compiled cython files to be in the same folder (inplace install). To support sage's build system, one needs to modify `sys.path` in the conftest file as shown here: https://stackoverflow.com/questions/20971619/ensuring-py-test-includes-the-application-directory-in-sys-path
What is the correct SAGE_XYZ folder to specify there? SAGE_LOCAL?

Moreover, it could be a problem that the test files are present twice (in local and src), which I think leads to the other errors above. Maybe https://docs.pytest.org/en/stable/pythonpath.html helps.

I will have a look at these things, but it will take some time as I have to destroy my nicely working inplace install for this. Feel free to play around with the above linked code.



---

archive/issue_comments_498382.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nIn an install without pytest, I am getting:\n\n```\n./sage -t src/sage/numerical/backends/\n...\nPytest is not installed, skip checking tests that rely on it.\nTraceback (most recent call last):\n  File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/bin/sage-runtests\", line 196, in <module>\n    sys.exit(exit_code_pytest)\nNameError: name 'exit_code_pytest' is not defined\n```",
    "created_at": "2021-02-01T02:43:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498382",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:31" align="right">comment:31</div>

In an install without pytest, I am getting:

```
./sage -t src/sage/numerical/backends/
...
Pytest is not installed, skip checking tests that rely on it.
Traceback (most recent call last):
  File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/bin/sage-runtests", line 196, in <module>
    sys.exit(exit_code_pytest)
NameError: name 'exit_code_pytest' is not defined
```



---

archive/issue_comments_498383.json:
```json
{
    "body": "Changed commit from **[`3c06234`](https://github.com/sagemath/sagetrac-mirror/commit/3c06234e703737f5ddaeb09caa4161ab26578ba7)** to **[`7935ecf`](https://github.com/sagemath/sagetrac-mirror/commit/7935ecf70803e16dbd10f1b7a179f50083c20cbb)**",
    "created_at": "2021-02-01T02:46:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498383",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3c06234`](https://github.com/sagemath/sagetrac-mirror/commit/3c06234e703737f5ddaeb09caa4161ab26578ba7)** to **[`7935ecf`](https://github.com/sagemath/sagetrac-mirror/commit/7935ecf70803e16dbd10f1b7a179f50083c20cbb)**



---

archive/issue_comments_498384.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf014ba98eddf0ee6289581de40d50dce894a422\"><code>bf014ba</code></a></td><td><code>Enforce that test files need to end on _test.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/38e210e6fe21f5f49e066142533f3f7794c6dfb6\"><code>38e210e</code></a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into public/build/pytest_config</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6880e1d997b020c9c23a490fb768c52ad18a58b1\"><code>6880e1d</code></a></td><td><code>Merge tag '9.3.beta6' into t/31003/public/build/pytest_config</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/62b1c6177607b85a8d2cc5136bc23d660f0d9931\"><code>62b1c61</code></a></td><td><code>Igonre deprecation_test as well</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/da37e146c993523efa2871ee77a64c1e7eb1b5b2\"><code>da37e14</code></a></td><td><code>Merge branch 'public/build/pytest_config' of git://trac.sagemath.org/sage into t/31003/public/build/pytest_config</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15c48da48a2c368406b007a17e1a8829113de453\"><code>15c48da</code></a></td><td><code>Merge branch 't/31003/public/build/pytest_config' into t/31103/public/refactoring/pytest-numerical-backends</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7935ecf70803e16dbd10f1b7a179f50083c20cbb\"><code>7935ecf</code></a></td><td><code>src/bin/sage-runtests: No error when pytest cannot be imported</code></td></tr></table>\n",
    "created_at": "2021-02-01T02:46:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498384",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf014ba98eddf0ee6289581de40d50dce894a422"><code>bf014ba</code></a></td><td><code>Enforce that test files need to end on _test.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/38e210e6fe21f5f49e066142533f3f7794c6dfb6"><code>38e210e</code></a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into public/build/pytest_config</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6880e1d997b020c9c23a490fb768c52ad18a58b1"><code>6880e1d</code></a></td><td><code>Merge tag '9.3.beta6' into t/31003/public/build/pytest_config</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/62b1c6177607b85a8d2cc5136bc23d660f0d9931"><code>62b1c61</code></a></td><td><code>Igonre deprecation_test as well</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/da37e146c993523efa2871ee77a64c1e7eb1b5b2"><code>da37e14</code></a></td><td><code>Merge branch 'public/build/pytest_config' of git://trac.sagemath.org/sage into t/31003/public/build/pytest_config</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15c48da48a2c368406b007a17e1a8829113de453"><code>15c48da</code></a></td><td><code>Merge branch 't/31003/public/build/pytest_config' into t/31103/public/refactoring/pytest-numerical-backends</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7935ecf70803e16dbd10f1b7a179f50083c20cbb"><code>7935ecf</code></a></td><td><code>src/bin/sage-runtests: No error when pytest cannot be imported</code></td></tr></table>




---

archive/issue_comments_498385.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc31289631e549030df64eb14f6fdc8235890b78\"><code>cc31289</code></a></td><td><code>src/bin/sage-runtests: Use pytest --import-mode importlib</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c81c8db12aee63238cedac4a05a526f3d121fe43\"><code>c81c8db</code></a></td><td><code>src/sage/numerical/backends/*_test.py: fix imports</code></td></tr></table>\n",
    "created_at": "2021-02-01T02:58:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498385",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc31289631e549030df64eb14f6fdc8235890b78"><code>cc31289</code></a></td><td><code>src/bin/sage-runtests: Use pytest --import-mode importlib</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c81c8db12aee63238cedac4a05a526f3d121fe43"><code>c81c8db</code></a></td><td><code>src/sage/numerical/backends/*_test.py: fix imports</code></td></tr></table>




---

archive/issue_comments_498386.json:
```json
{
    "body": "Changed commit from **[`7935ecf`](https://github.com/sagemath/sagetrac-mirror/commit/7935ecf70803e16dbd10f1b7a179f50083c20cbb)** to **[`c81c8db`](https://github.com/sagemath/sagetrac-mirror/commit/c81c8db12aee63238cedac4a05a526f3d121fe43)**",
    "created_at": "2021-02-01T02:58:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498386",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7935ecf`](https://github.com/sagemath/sagetrac-mirror/commit/7935ecf70803e16dbd10f1b7a179f50083c20cbb)** to **[`c81c8db`](https://github.com/sagemath/sagetrac-mirror/commit/c81c8db12aee63238cedac4a05a526f3d121fe43)**



---

archive/issue_comments_498387.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nThis version works for me",
    "created_at": "2021-02-01T02:59:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498387",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:34" align="right">comment:34</div>

This version works for me



---

archive/issue_comments_498388.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@tobiasdiez](#comment:30):\n> Maybe https://docs.pytest.org/en/stable/pythonpath.html helps.\n\nYes, it did!",
    "created_at": "2021-02-01T03:03:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498388",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@tobiasdiez](#comment:30):
> Maybe https://docs.pytest.org/en/stable/pythonpath.html helps.

Yes, it did!



---

archive/issue_comments_498389.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nThe only remaining problem that I have is that I need to update the 3 standalone packages providing additional backends (https://github.com/mkoeppe/sage-numerical-backends-coin, ...) to also invoke pytest - and to do make sure this does not cause errors on older Sage versions.",
    "created_at": "2021-02-01T03:16:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498389",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">comment:37</div>

The only remaining problem that I have is that I need to update the 3 standalone packages providing additional backends (https://github.com/mkoeppe/sage-numerical-backends-coin, ...) to also invoke pytest - and to do make sure this does not cause errors on older Sage versions.



---

archive/issue_comments_498390.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nTo keep the work limited, perhaps it's best to keep the old `_test_` methods so that the test coverage of the backend packages is not sacrificed.  We will delete the `_test_` methods later.",
    "created_at": "2021-02-01T03:23:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498390",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:38" align="right">comment:38</div>

To keep the work limited, perhaps it's best to keep the old `_test_` methods so that the test coverage of the backend packages is not sacrificed.  We will delete the `_test_` methods later.



---

archive/issue_comments_498391.json:
```json
{
    "body": "Changed commit from **[`c81c8db`](https://github.com/sagemath/sagetrac-mirror/commit/c81c8db12aee63238cedac4a05a526f3d121fe43)** to **[`0592226`](https://github.com/sagemath/sagetrac-mirror/commit/0592226745971878657539a740fa54b065c9d0bb)**",
    "created_at": "2021-02-01T03:26:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498391",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c81c8db`](https://github.com/sagemath/sagetrac-mirror/commit/c81c8db12aee63238cedac4a05a526f3d121fe43)** to **[`0592226`](https://github.com/sagemath/sagetrac-mirror/commit/0592226745971878657539a740fa54b065c9d0bb)**



---

archive/issue_comments_498392.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0592226745971878657539a740fa54b065c9d0bb\"><code>0592226</code></a></td><td><code>src/sage/numerical/backends/generic_backend.pyx: Restore _test_ncols_nonnegative, with comment</code></td></tr></table>\n",
    "created_at": "2021-02-01T03:26:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498392",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0592226745971878657539a740fa54b065c9d0bb"><code>0592226</code></a></td><td><code>src/sage/numerical/backends/generic_backend.pyx: Restore _test_ncols_nonnegative, with comment</code></td></tr></table>




---

archive/issue_events_431000.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-01T03:27:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31103#event-431000"
}
```



---

archive/issue_events_431001.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-01T03:27:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31103#event-431001"
}
```



---

archive/issue_comments_498393.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe, ...**",
    "created_at": "2021-02-01T03:27:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498393",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe, ...**



---

archive/issue_comments_498394.json:
```json
{
    "body": "Changed author from **Tobias Diez** to **Tobias Diez, Matthias Koeppe**",
    "created_at": "2021-02-01T03:27:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498394",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Tobias Diez** to **Tobias Diez, Matthias Koeppe**



---

archive/issue_comments_498395.json:
```json
{
    "body": "Changed reviewer from **Matthias Koeppe, ...** to **Matthias Koeppe, Tobias Diez**",
    "created_at": "2021-02-01T09:27:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498395",
    "user": "https://github.com/tobiasdiez"
}
```

Changed reviewer from **Matthias Koeppe, ...** to **Matthias Koeppe, Tobias Diez**



---

archive/issue_events_431002.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-02-01T09:27:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31103#event-431002"
}
```



---

archive/issue_events_431003.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-02-01T09:27:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31103#event-431003"
}
```



---

archive/issue_comments_498396.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nThanks a lot for having a look at this. Your changes look good to me!",
    "created_at": "2021-02-01T09:27:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498396",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:41" align="right">comment:41</div>

Thanks a lot for having a look at this. Your changes look good to me!



---

archive/issue_comments_498397.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nAdding #30551 as a dependency because of `from `__future__` import annotations`. Or can we avoid it?",
    "created_at": "2021-02-01T16:48:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498397",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:42" align="right">comment:42</div>

Adding #30551 as a dependency because of `from `__future__` import annotations`. Or can we avoid it?



---

archive/issue_comments_498398.json:
```json
{
    "body": "Changed dependencies from **#30901, #31003** to **#30901, #31003, #30551**",
    "created_at": "2021-02-01T16:48:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498398",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30901, #31003** to **#30901, #31003, #30551**



---

archive/issue_events_431004.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-05-27T20:30:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31103#event-431004"
}
```



---

archive/issue_events_431005.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "08eadb587f7d67628b837340be9c690e1d9cf24f",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-05-27T20:30:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31103#event-431005"
}
```



---

archive/issue_comments_498399.json:
```json
{
    "body": "Changed branch from **[public/refactoring/pytest-numerical-backends](https://github.com/sagemath/sagetrac-mirror/tree/public/refactoring/pytest-numerical-backends)** to **[`0592226`](https://github.com/sagemath/sagetrac-mirror/commit/0592226745971878657539a740fa54b065c9d0bb)**",
    "created_at": "2021-05-27T20:30:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498399",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/refactoring/pytest-numerical-backends](https://github.com/sagemath/sagetrac-mirror/tree/public/refactoring/pytest-numerical-backends)** to **[`0592226`](https://github.com/sagemath/sagetrac-mirror/commit/0592226745971878657539a740fa54b065c9d0bb)**



---

archive/issue_comments_498400.json:
```json
{
    "body": "Changed commit from **[`0592226`](https://github.com/sagemath/sagetrac-mirror/commit/0592226745971878657539a740fa54b065c9d0bb)** to none",
    "created_at": "2021-09-20T16:08:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498400",
    "user": "https://github.com/saraedum"
}
```

Changed commit from **[`0592226`](https://github.com/sagemath/sagetrac-mirror/commit/0592226745971878657539a740fa54b065c9d0bb)** to none



---

archive/issue_comments_498401.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nThis seems to break our workflow at https://github.com/flatsurf/e-antic. We are running some [SageMath](../wiki/SageMath) doctests with `sage-runtests`. The tests all pass and then we see:\n\n```\ncollected 0 items\n\n====================================================== no tests ran in 0.00s ======================================================\n```\n\nThe problem is that this now returns with exit code 5, i.e., the CI assumes that the tests have failed.",
    "created_at": "2021-09-20T16:08:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498401",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:44" align="right">comment:44</div>

This seems to break our workflow at https://github.com/flatsurf/e-antic. We are running some [SageMath](../wiki/SageMath) doctests with `sage-runtests`. The tests all pass and then we see:

```
collected 0 items

====================================================== no tests ran in 0.00s ======================================================
```

The problem is that this now returns with exit code 5, i.e., the CI assumes that the tests have failed.



---

archive/issue_comments_498402.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nA workaround is to drop a `test_nothing.py` file in the directory where the doctests are run:\n\n```\ndef test_nothing():pass\n```",
    "created_at": "2021-09-20T16:22:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498402",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:45" align="right">comment:45</div>

A workaround is to drop a `test_nothing.py` file in the directory where the doctests are run:

```
def test_nothing():pass
```



---

archive/issue_comments_498403.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nHelp with fixing this properly is welcome. The developer who worked on the pytest stuff has disappeared",
    "created_at": "2021-09-20T16:30:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498403",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:46" align="right">comment:46</div>

Help with fixing this properly is welcome. The developer who worked on the pytest stuff has disappeared



---

archive/issue_comments_498404.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nA proper fix would probably be to add an additional if check if the pytest return code is 5 here:\n\n```\n+    if err == 0:\n+        sys.exit(exit_code_pytest)\n+    else:\n+        sys.exit(err)\n```\nSee also the discussion in https://github.com/pytest-dev/pytest/issues/2393.\n\nI sadly don't have the time to implement it though.",
    "created_at": "2021-09-21T11:58:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498404",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:47" align="right">comment:47</div>

A proper fix would probably be to add an additional if check if the pytest return code is 5 here:

```
+    if err == 0:
+        sys.exit(exit_code_pytest)
+    else:
+        sys.exit(err)
```
See also the discussion in https://github.com/pytest-dev/pytest/issues/2393.

I sadly don't have the time to implement it though.



---

archive/issue_comments_498405.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nThe workaround in [#31103 comment:45](https://github.com/sagemath/sage/issues/31103#comment:45) does not work if the tested module contains some sage metaclass machinery since pytest is unvoked with `--import-mode importlib`, there is an error because the module is not in `sys.modules` and this confuses `nested_class.pyx`.\n\nIn that case, there is an error and not only an error code 5.\n\n```\n  ==================================== ERRORS ====================================\n  ____________________ ERROR collecting pyflatsurf/vector.py _____________________\n  ../src/pyflatsurf/vector.py:285: in <module>\n      class Vectors(UniqueRepresentation, Parent):\n  sage/misc/nested_class.pyx:318: in sage.misc.nested_class.NestedClassMetaclass.__init__ (build/cythonized/sage/misc/nested_class.c:2314)\n      ???\n  E   KeyError: 'vector'\n```",
    "created_at": "2021-11-13T02:20:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498405",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:48" align="right">comment:48</div>

The workaround in [#31103 comment:45](https://github.com/sagemath/sage/issues/31103#comment:45) does not work if the tested module contains some sage metaclass machinery since pytest is unvoked with `--import-mode importlib`, there is an error because the module is not in `sys.modules` and this confuses `nested_class.pyx`.

In that case, there is an error and not only an error code 5.

```
  ==================================== ERRORS ====================================
  ____________________ ERROR collecting pyflatsurf/vector.py _____________________
  ../src/pyflatsurf/vector.py:285: in <module>
      class Vectors(UniqueRepresentation, Parent):
  sage/misc/nested_class.pyx:318: in sage.misc.nested_class.NestedClassMetaclass.__init__ (build/cythonized/sage/misc/nested_class.c:2314)
      ???
  E   KeyError: 'vector'
```



---

archive/issue_comments_498406.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nAnother workaround is to just pretend that pytest is not installed:\n\n```\n$ cat no-pytest/pytest.py\nraise ModuleNotFoundError\n$ PYTHONPATH=no-pytest:$PYTHONPATH sage -tp ...\n```\n\nBut I actually think we should make this a bit more convenient than having to hack the module search path.",
    "created_at": "2021-11-13T02:29:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498406",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:49" align="right">comment:49</div>

Another workaround is to just pretend that pytest is not installed:

```
$ cat no-pytest/pytest.py
raise ModuleNotFoundError
$ PYTHONPATH=no-pytest:$PYTHONPATH sage -tp ...
```

But I actually think we should make this a bit more convenient than having to hack the module search path.



---

archive/issue_comments_498407.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nI guess the issue with the modules is the same as #31924.",
    "created_at": "2021-11-17T21:12:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498407",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:50" align="right">comment:50</div>

I guess the issue with the modules is the same as #31924.



---

archive/issue_comments_498408.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nAnd the exit code 5 issue should be fixed with #32892.",
    "created_at": "2021-11-17T21:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31103",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31103#issuecomment-498408",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:51" align="right">comment:51</div>

And the exit code 5 issue should be fixed with #32892.
