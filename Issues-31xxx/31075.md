# Issue 31075: Add configuration and documentation for code formatter "black"

archive/issues_030838.json:
```json
{
    "assignees": [],
    "body": "The code formatter \"black\" is probably the most popular one for Python. We add basic configuration and documentation for it.\n\nI would actually propose to reformat the whole code base with black, and then require that people use it before checkin their code (checked via the official github action). In this way one could get rid of all the formatting problems once and for all. This global reformat probably needs to be done by the release manager to prevent merge conflicts.\n\nCC:  @mkoeppe @fchapoton\n\nBranch/Commit: **[public/build/black](https://github.com/sagemath/sagetrac-mirror/tree/public/build/black) @ [79249c2](https://github.com/sagemath/sagetrac-mirror/commit/79249c2c3c3b7ebcbd632dfa8830e0a745306dbc)**\n\nAuthor: **Tobias Diez**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31075_\n\n",
    "created_at": "2020-12-18T14:23:31Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/wishlist%20item",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add configuration and documentation for code formatter \"black\"",
    "type": "issue",
    "updated_at": "2021-07-19T00:39:27Z",
    "url": "https://github.com/sagemath/sage/issues/31075",
    "user": "https://github.com/tobiasdiez"
}
```
The code formatter "black" is probably the most popular one for Python. We add basic configuration and documentation for it.

I would actually propose to reformat the whole code base with black, and then require that people use it before checkin their code (checked via the official github action). In this way one could get rid of all the formatting problems once and for all. This global reformat probably needs to be done by the release manager to prevent merge conflicts.

CC:  @mkoeppe @fchapoton

Branch/Commit: **[public/build/black](https://github.com/sagemath/sagetrac-mirror/tree/public/build/black) @ [79249c2](https://github.com/sagemath/sagetrac-mirror/commit/79249c2c3c3b7ebcbd632dfa8830e0a745306dbc)**

Author: **Tobias Diez**

_Issue created by migration from https://trac.sagemath.org/ticket/31075_





---

archive/issue_events_396334.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-12-18T14:23:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "000080",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-396334"
}
```



---

archive/issue_events_396335.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-12-18T14:23:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-396335"
}
```



---

archive/issue_events_396336.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-12-18T14:23:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-396336"
}
```



---

archive/issue_events_396337.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-12-18T14:23:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-396337"
}
```



---

archive/issue_events_396338.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-12-18T14:23:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-396338"
}
```



---

archive/issue_comments_500946.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nThe section in the documentation should probably mention how to run it through `sage -tox`. In this case, no installation with pip is necessary - pip takes care of it",
    "created_at": "2020-12-18T18:46:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-500946",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'>Comment 2:</a>
The section in the documentation should probably mention how to run it through `sage -tox`. In this case, no installation with pip is necessary - pip takes care of it



---

archive/issue_comments_500947.json:
```json
{
    "body": "Changed commit from **[b1f4ca2](https://github.com/sagemath/sagetrac-mirror/commit/b1f4ca2dc3c5c9fc1d49bbce32bba1809fe61b74)** to **[79249c2](https://github.com/sagemath/sagetrac-mirror/commit/79249c2c3c3b7ebcbd632dfa8830e0a745306dbc)**",
    "created_at": "2020-12-18T21:47:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-500947",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b1f4ca2](https://github.com/sagemath/sagetrac-mirror/commit/b1f4ca2dc3c5c9fc1d49bbce32bba1809fe61b74)** to **[79249c2](https://github.com/sagemath/sagetrac-mirror/commit/79249c2c3c3b7ebcbd632dfa8830e0a745306dbc)**



---

archive/issue_comments_500948.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/79249c2c3c3b7ebcbd632dfa8830e0a745306dbc\">79249c2</a></td><td><code>Add tox instructions</code></td></tr></table>\n",
    "created_at": "2020-12-18T21:47:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-500948",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:3'>Comment 3:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/79249c2c3c3b7ebcbd632dfa8830e0a745306dbc">79249c2</a></td><td><code>Add tox instructions</code></td></tr></table>




---

archive/issue_comments_500949.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nReplying to [@mkoeppe](#comment%3A2):\n> The section in the documentation should probably mention how to run it through `sage -tox`. In this case, no installation with pip is necessary - pip takes care of it\n\nGood idea. Added, also for pycodestyle.",
    "created_at": "2020-12-18T21:48:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-500949",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:4'>Comment 4:</a>
Replying to [@mkoeppe](#comment%3A2):
> The section in the documentation should probably mention how to run it through `sage -tox`. In this case, no installation with pip is necessary - pip takes care of it

Good idea. Added, also for pycodestyle.



---

archive/issue_comments_500950.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nPerhaps @fchapoton could comment on the current status and plans regarding code style in sagelib.  There seems to be a plan but I don't know if it is written anywhere.",
    "created_at": "2020-12-19T17:48:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-500950",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'>Comment 5:</a>
Perhaps @fchapoton could comment on the current status and plans regarding code style in sagelib.  There seems to be a plan but I don't know if it is written anywhere.



---

archive/issue_comments_500951.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nComments concerning a plan how to proceed with the code style are welcome indeed.",
    "created_at": "2021-01-06T12:31:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-500951",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:6'>Comment 6:</a>
Comments concerning a plan how to proceed with the code style are welcome indeed.



---

archive/issue_comments_500952.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-500952",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'>Comment 7:</a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_396339.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-396339"
}
```



---

archive/issue_events_396340.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-396340"
}
```



---

archive/issue_comments_500953.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nI think requiring black's code formatting style should be discussed on sage-devel.  I'm personally against various choices they make (mainly the excessive newlines).",
    "created_at": "2021-04-28T08:26:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-500953",
    "user": "https://github.com/roed314"
}
```

<a id='comment:8'>Comment 8:</a>
I think requiring black's code formatting style should be discussed on sage-devel.  I'm personally against various choices they make (mainly the excessive newlines).



---

archive/issue_comments_500954.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\n@mkoeppe, chapoton, how should we proceed with this?",
    "created_at": "2021-05-18T07:38:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-500954",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:9'>Comment 9:</a>
@mkoeppe, chapoton, how should we proceed with this?



---

archive/issue_comments_500955.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nfrom me, a **strong negative vote** on using black",
    "created_at": "2021-05-18T07:46:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-500955",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'>Comment 10:</a>
from me, a **strong negative vote** on using black



---

archive/issue_comments_500956.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nI agree: I would prefer not to use black as a commit hook.  I find that it adds a lot of unnecessary whitespace.  As an example, here's a diff produced by black that I find makes the code less readable:\n\n```\n-verbose(\"Approximants of %r on %r towards %r\"%(self, self.domain(), G), level=3)\n+verbose(\n+    \"Approximants of %r on %r towards %r\" % (self, self.domain(), G), level=3\n+)\n```\n\nI also don't think it's worth making a change across Sage that will break everyone's outstanding branches.",
    "created_at": "2021-05-18T20:24:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-500956",
    "user": "https://github.com/roed314"
}
```

<a id='comment:11'>Comment 11:</a>
I agree: I would prefer not to use black as a commit hook.  I find that it adds a lot of unnecessary whitespace.  As an example, here's a diff produced by black that I find makes the code less readable:

```
-verbose("Approximants of %r on %r towards %r"%(self, self.domain(), G), level=3)
+verbose(
+    "Approximants of %r on %r towards %r" % (self, self.domain(), G), level=3
+)
```

I also don't think it's worth making a change across Sage that will break everyone's outstanding branches.



---

archive/issue_comments_500957.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nAlso, the branch on this ticket gives a merge failure.",
    "created_at": "2021-05-18T20:26:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-500957",
    "user": "https://github.com/roed314"
}
```

<a id='comment:12'>Comment 12:</a>
Also, the branch on this ticket gives a merge failure.



---

archive/issue_events_396341.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-05-20T15:30:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-396341"
}
```



---

archive/issue_events_396342.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-05-20T15:30:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-396342"
}
```



---

archive/issue_comments_500958.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nred branch => needs work",
    "created_at": "2021-05-20T15:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-500958",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'>Comment 13:</a>
red branch => needs work



---

archive/issue_events_396343.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:39:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-396343"
}
```
