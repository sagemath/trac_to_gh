# Issue 31075: Add configuration and documentation for code formatter "black"

archive/issues_030838.json:
```json
{
    "assignees": [],
    "body": "The code formatter \"black\" is probably the most popular one for Python. We add basic configuration and documentation for it.\n\nI would actually propose to reformat the whole code base with black, and then require that people use it before checkin their code (checked via the official github action). In this way one could get rid of all the formatting problems once and for all. This global reformat probably needs to be done by the release manager to prevent merge conflicts.\n\nCC:  @mkoeppe @fchapoton\n\nBranch/Commit: **[public/build/black](https://github.com/sagemath/sagetrac-mirror/tree/public/build/black) @ [79249c2](https://github.com/sagemath/sagetrac-mirror/commit/79249c2c3c3b7ebcbd632dfa8830e0a745306dbc)**\n\nAuthor: **Tobias Diez**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31075_\n\n",
    "created_at": "2020-12-18T14:23:31Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/wishlist%20item",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add configuration and documentation for code formatter \"black\"",
    "type": "issue",
    "updated_at": "2021-07-19T00:39:27Z",
    "url": "https://github.com/sagemath/sage/issues/31075",
    "user": "https://github.com/tobiasdiez"
}
```
The code formatter "black" is probably the most popular one for Python. We add basic configuration and documentation for it.

I would actually propose to reformat the whole code base with black, and then require that people use it before checkin their code (checked via the official github action). In this way one could get rid of all the formatting problems once and for all. This global reformat probably needs to be done by the release manager to prevent merge conflicts.

CC:  @mkoeppe @fchapoton

Branch/Commit: **[public/build/black](https://github.com/sagemath/sagetrac-mirror/tree/public/build/black) @ [79249c2](https://github.com/sagemath/sagetrac-mirror/commit/79249c2c3c3b7ebcbd632dfa8830e0a745306dbc)**

Author: **Tobias Diez**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/31075_





---

archive/issue_events_428499.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-12-18T14:23:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-428499"
}
```



---

archive/issue_events_428500.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-12-18T14:23:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-428500"
}
```



---

archive/issue_events_428501.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-12-18T14:23:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-428501"
}
```



---

archive/issue_events_428502.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-12-18T14:23:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-428502"
}
```



---

archive/issue_events_428503.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-12-18T14:23:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-428503"
}
```



---

archive/issue_comments_498036.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThe section in the documentation should probably mention how to run it through `sage -tox`. In this case, no installation with pip is necessary - pip takes care of it",
    "created_at": "2020-12-18T18:46:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-498036",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">comment:2</div>

The section in the documentation should probably mention how to run it through `sage -tox`. In this case, no installation with pip is necessary - pip takes care of it



---

archive/issue_comments_498037.json:
```json
{
    "body": "Changed commit from **[b1f4ca2](https://github.com/sagemath/sagetrac-mirror/commit/b1f4ca2dc3c5c9fc1d49bbce32bba1809fe61b74)** to **[79249c2](https://github.com/sagemath/sagetrac-mirror/commit/79249c2c3c3b7ebcbd632dfa8830e0a745306dbc)**",
    "created_at": "2020-12-18T21:47:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-498037",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b1f4ca2](https://github.com/sagemath/sagetrac-mirror/commit/b1f4ca2dc3c5c9fc1d49bbce32bba1809fe61b74)** to **[79249c2](https://github.com/sagemath/sagetrac-mirror/commit/79249c2c3c3b7ebcbd632dfa8830e0a745306dbc)**



---

archive/issue_comments_498038.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/79249c2c3c3b7ebcbd632dfa8830e0a745306dbc\">79249c2</a></td><td><code>Add tox instructions</code></td></tr></table>\n",
    "created_at": "2020-12-18T21:47:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-498038",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/79249c2c3c3b7ebcbd632dfa8830e0a745306dbc">79249c2</a></td><td><code>Add tox instructions</code></td></tr></table>




---

archive/issue_comments_498039.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@mkoeppe](#comment:2):\n> The section in the documentation should probably mention how to run it through `sage -tox`. In this case, no installation with pip is necessary - pip takes care of it\n\nGood idea. Added, also for pycodestyle.",
    "created_at": "2020-12-18T21:48:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-498039",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@mkoeppe](#comment:2):
> The section in the documentation should probably mention how to run it through `sage -tox`. In this case, no installation with pip is necessary - pip takes care of it

Good idea. Added, also for pycodestyle.



---

archive/issue_comments_498040.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nPerhaps @fchapoton could comment on the current status and plans regarding code style in sagelib.  There seems to be a plan but I don't know if it is written anywhere.",
    "created_at": "2020-12-19T17:48:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-498040",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>

Perhaps @fchapoton could comment on the current status and plans regarding code style in sagelib.  There seems to be a plan but I don't know if it is written anywhere.



---

archive/issue_comments_498041.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nComments concerning a plan how to proceed with the code style are welcome indeed.",
    "created_at": "2021-01-06T12:31:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-498041",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:6" align="right">comment:6</div>

Comments concerning a plan how to proceed with the code style are welcome indeed.



---

archive/issue_comments_498042.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-498042",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">comment:7</div>

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_428504.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-428504"
}
```



---

archive/issue_events_428505.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-428505"
}
```



---

archive/issue_comments_498043.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI think requiring black's code formatting style should be discussed on sage-devel.  I'm personally against various choices they make (mainly the excessive newlines).",
    "created_at": "2021-04-28T08:26:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-498043",
    "user": "https://github.com/roed314"
}
```

<div id="comment:8" align="right">comment:8</div>

I think requiring black's code formatting style should be discussed on sage-devel.  I'm personally against various choices they make (mainly the excessive newlines).



---

archive/issue_comments_498044.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n@mkoeppe, chapoton, how should we proceed with this?",
    "created_at": "2021-05-18T07:38:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-498044",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:9" align="right">comment:9</div>

@mkoeppe, chapoton, how should we proceed with this?



---

archive/issue_comments_498045.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nfrom me, a **strong negative vote** on using black",
    "created_at": "2021-05-18T07:46:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-498045",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:10" align="right">comment:10</div>

from me, a **strong negative vote** on using black



---

archive/issue_comments_498046.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI agree: I would prefer not to use black as a commit hook.  I find that it adds a lot of unnecessary whitespace.  As an example, here's a diff produced by black that I find makes the code less readable:\n\n```\n-verbose(\"Approximants of %r on %r towards %r\"%(self, self.domain(), G), level=3)\n+verbose(\n+    \"Approximants of %r on %r towards %r\" % (self, self.domain(), G), level=3\n+)\n```\n\nI also don't think it's worth making a change across Sage that will break everyone's outstanding branches.",
    "created_at": "2021-05-18T20:24:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-498046",
    "user": "https://github.com/roed314"
}
```

<div id="comment:11" align="right">comment:11</div>

I agree: I would prefer not to use black as a commit hook.  I find that it adds a lot of unnecessary whitespace.  As an example, here's a diff produced by black that I find makes the code less readable:

```
-verbose("Approximants of %r on %r towards %r"%(self, self.domain(), G), level=3)
+verbose(
+    "Approximants of %r on %r towards %r" % (self, self.domain(), G), level=3
+)
```

I also don't think it's worth making a change across Sage that will break everyone's outstanding branches.



---

archive/issue_comments_498047.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAlso, the branch on this ticket gives a merge failure.",
    "created_at": "2021-05-18T20:26:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-498047",
    "user": "https://github.com/roed314"
}
```

<div id="comment:12" align="right">comment:12</div>

Also, the branch on this ticket gives a merge failure.



---

archive/issue_events_428506.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-05-20T15:30:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-428506"
}
```



---

archive/issue_events_428507.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-05-20T15:30:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-428507"
}
```



---

archive/issue_comments_498048.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nred branch => needs work",
    "created_at": "2021-05-20T15:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31075#issuecomment-498048",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:13" align="right">comment:13</div>

red branch => needs work



---

archive/issue_events_428508.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:39:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-428508"
}
```



---

archive/issue_events_428509.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:39:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31075",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31075#event-428509"
}
```
