# Issue 31391: crystals.HighestWeight constructs wrong crystal for given weight

archive/issues_031154.json:
```json
{
    "assignees": [],
    "body": "As illustrated by the following code, constructing a crystal of tableaux given a fundamental weight using `crystals.HighestWeight` does not always work.  Specifically, it fails for the spin representations, and for Cartan types `F_4`, `E_6`, `E_7` and `E_8`.\n\n```\nfrom sage.databases.findstat import _finite_irreducible_cartan_types_by_rank as cartan_types\nsage: for n in range(1,9):\n....:    for ct in cartan_types(n):\n....:        L = ct.root_system().weight_lattice()\n....:        La = L.fundamental_weights()\n....:        for wt in La:\n....:            for model in ['Tableaux', 'NakajimaMonomials', 'AlcovePaths', 'RiggedConfigurations']:\n....:                try:\n....:                    C = crystals.HighestWeight(wt, model=model)\n....:                    if not L.weyl_dimension(wt) == C.cardinality():\n....:                        print(ct, wt, model, \"bad cardinality\")\n....:                except Exception as e:\n....:                    print(ct, wt, model, e)\n\n['B', 2] Lambda[2] Tableaux bad cardinality\n['B', 3] Lambda[3] Tableaux bad cardinality\n['B', 4] Lambda[4] Tableaux bad cardinality\n['D', 4] Lambda[3] Tableaux bad cardinality\n['D', 4] Lambda[4] Tableaux bad cardinality\n['F', 4] Lambda[1] Tableaux not an element in the crystal\n['F', 4] Lambda[2] Tableaux not an element in the crystal\n['F', 4] Lambda[3] Tableaux not an element in the crystal\n['F', 4] Lambda[4] Tableaux not an element in the crystal\n['B', 5] Lambda[5] Tableaux bad cardinality\n['D', 5] Lambda[4] Tableaux bad cardinality\n['D', 5] Lambda[5] Tableaux bad cardinality\n['B', 6] Lambda[6] Tableaux bad cardinality\n['D', 6] Lambda[5] Tableaux bad cardinality\n['D', 6] Lambda[6] Tableaux bad cardinality\n['E', 6] Lambda[1] Tableaux Argument 'value' has incorrect type (expected tuple, got int)\n['E', 6] Lambda[2] Tableaux Argument 'value' has incorrect type (expected tuple, got int)\n['E', 6] Lambda[3] Tableaux Argument 'value' has incorrect type (expected tuple, got int)\n['E', 6] Lambda[4] Tableaux Argument 'value' has incorrect type (expected tuple, got int)\n['E', 6] Lambda[5] Tableaux Argument 'value' has incorrect type (expected tuple, got int)\n['E', 6] Lambda[6] Tableaux Argument 'value' has incorrect type (expected tuple, got int)\n['B', 7] Lambda[7] Tableaux bad cardinality\n['D', 7] Lambda[6] Tableaux bad cardinality\n['D', 7] Lambda[7] Tableaux bad cardinality\n['E', 7] Lambda[1] Tableaux Argument 'value' has incorrect type (expected tuple, got int)\n['E', 7] Lambda[2] Tableaux Argument 'value' has incorrect type (expected tuple, got int)\n['E', 7] Lambda[3] Tableaux Argument 'value' has incorrect type (expected tuple, got int)\n['E', 7] Lambda[4] Tableaux Argument 'value' has incorrect type (expected tuple, got int)\n['E', 7] Lambda[5] Tableaux Argument 'value' has incorrect type (expected tuple, got int)\n['E', 7] Lambda[6] Tableaux Argument 'value' has incorrect type (expected tuple, got int)\n['E', 7] Lambda[7] Tableaux Argument 'value' has incorrect type (expected tuple, got int)\n['B', 8] Lambda[8] Tableaux bad cardinality\n['D', 8] Lambda[7] Tableaux bad cardinality\n['D', 8] Lambda[8] Tableaux bad cardinality\n['E', 8] Lambda[1] Tableaux not an element in the crystal\n['E', 8] Lambda[2] Tableaux not an element in the crystal\n['E', 8] Lambda[3] Tableaux not an element in the crystal\n['E', 8] Lambda[4] Tableaux not an element in the crystal\n['E', 8] Lambda[5] Tableaux not an element in the crystal\n['E', 8] Lambda[6] Tableaux not an element in the crystal\n['E', 8] Lambda[7] Tableaux not an element in the crystal\n['E', 8] Lambda[8] Tableaux not an element in the crystal\n```\n\nCC:  @sagetrac-sage-combinat @dwbump @anneschilling @tscrim @nthiery\n\nBranch/Commit: **[`178edd7`](https://github.com/sagemath/sagetrac-mirror/commit/178edd721084cf8366a4dbbca8fa722a937bcdc7)**\n\nReviewer: **Travis Scrimshaw, Anne Schilling**\n\nAuthor: **Martin Rubey**\n\nComponent: **combinatorics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31391_\n\n",
    "closed_at": "2021-03-09T00:01:24Z",
    "created_at": "2021-02-13T14:52:34Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "crystals.HighestWeight constructs wrong crystal for given weight",
    "type": "issue",
    "updated_at": "2021-03-09T00:01:24Z",
    "url": "https://github.com/sagemath/sage/issues/31391",
    "user": "https://github.com/mantepse"
}
```
As illustrated by the following code, constructing a crystal of tableaux given a fundamental weight using `crystals.HighestWeight` does not always work.  Specifically, it fails for the spin representations, and for Cartan types `F_4`, `E_6`, `E_7` and `E_8`.

```
from sage.databases.findstat import _finite_irreducible_cartan_types_by_rank as cartan_types
sage: for n in range(1,9):
....:    for ct in cartan_types(n):
....:        L = ct.root_system().weight_lattice()
....:        La = L.fundamental_weights()
....:        for wt in La:
....:            for model in ['Tableaux', 'NakajimaMonomials', 'AlcovePaths', 'RiggedConfigurations']:
....:                try:
....:                    C = crystals.HighestWeight(wt, model=model)
....:                    if not L.weyl_dimension(wt) == C.cardinality():
....:                        print(ct, wt, model, "bad cardinality")
....:                except Exception as e:
....:                    print(ct, wt, model, e)

['B', 2] Lambda[2] Tableaux bad cardinality
['B', 3] Lambda[3] Tableaux bad cardinality
['B', 4] Lambda[4] Tableaux bad cardinality
['D', 4] Lambda[3] Tableaux bad cardinality
['D', 4] Lambda[4] Tableaux bad cardinality
['F', 4] Lambda[1] Tableaux not an element in the crystal
['F', 4] Lambda[2] Tableaux not an element in the crystal
['F', 4] Lambda[3] Tableaux not an element in the crystal
['F', 4] Lambda[4] Tableaux not an element in the crystal
['B', 5] Lambda[5] Tableaux bad cardinality
['D', 5] Lambda[4] Tableaux bad cardinality
['D', 5] Lambda[5] Tableaux bad cardinality
['B', 6] Lambda[6] Tableaux bad cardinality
['D', 6] Lambda[5] Tableaux bad cardinality
['D', 6] Lambda[6] Tableaux bad cardinality
['E', 6] Lambda[1] Tableaux Argument 'value' has incorrect type (expected tuple, got int)
['E', 6] Lambda[2] Tableaux Argument 'value' has incorrect type (expected tuple, got int)
['E', 6] Lambda[3] Tableaux Argument 'value' has incorrect type (expected tuple, got int)
['E', 6] Lambda[4] Tableaux Argument 'value' has incorrect type (expected tuple, got int)
['E', 6] Lambda[5] Tableaux Argument 'value' has incorrect type (expected tuple, got int)
['E', 6] Lambda[6] Tableaux Argument 'value' has incorrect type (expected tuple, got int)
['B', 7] Lambda[7] Tableaux bad cardinality
['D', 7] Lambda[6] Tableaux bad cardinality
['D', 7] Lambda[7] Tableaux bad cardinality
['E', 7] Lambda[1] Tableaux Argument 'value' has incorrect type (expected tuple, got int)
['E', 7] Lambda[2] Tableaux Argument 'value' has incorrect type (expected tuple, got int)
['E', 7] Lambda[3] Tableaux Argument 'value' has incorrect type (expected tuple, got int)
['E', 7] Lambda[4] Tableaux Argument 'value' has incorrect type (expected tuple, got int)
['E', 7] Lambda[5] Tableaux Argument 'value' has incorrect type (expected tuple, got int)
['E', 7] Lambda[6] Tableaux Argument 'value' has incorrect type (expected tuple, got int)
['E', 7] Lambda[7] Tableaux Argument 'value' has incorrect type (expected tuple, got int)
['B', 8] Lambda[8] Tableaux bad cardinality
['D', 8] Lambda[7] Tableaux bad cardinality
['D', 8] Lambda[8] Tableaux bad cardinality
['E', 8] Lambda[1] Tableaux not an element in the crystal
['E', 8] Lambda[2] Tableaux not an element in the crystal
['E', 8] Lambda[3] Tableaux not an element in the crystal
['E', 8] Lambda[4] Tableaux not an element in the crystal
['E', 8] Lambda[5] Tableaux not an element in the crystal
['E', 8] Lambda[6] Tableaux not an element in the crystal
['E', 8] Lambda[7] Tableaux not an element in the crystal
['E', 8] Lambda[8] Tableaux not an element in the crystal
```

CC:  @sagetrac-sage-combinat @dwbump @anneschilling @tscrim @nthiery

Branch/Commit: **[`178edd7`](https://github.com/sagemath/sagetrac-mirror/commit/178edd721084cf8366a4dbbca8fa722a937bcdc7)**

Reviewer: **Travis Scrimshaw, Anne Schilling**

Author: **Martin Rubey**

Component: **combinatorics**

_Issue created by migration from https://trac.sagemath.org/ticket/31391_





---

archive/issue_events_432657.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2021-02-13T14:52:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31391#event-432657"
}
```



---

archive/issue_events_432658.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2021-02-13T14:52:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31391#event-432658"
}
```



---

archive/issue_events_432659.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2021-02-13T14:52:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31391#event-432659"
}
```



---

archive/issue_events_432660.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2021-02-13T14:52:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31391#event-432660"
}
```



---

archive/issue_comments_503761.json:
```json
{
    "body": "Branch: **[u/mantepse/crystals_highestweight_constructs_wrong_crystal_for_given_weight](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/crystals_highestweight_constructs_wrong_crystal_for_given_weight)**",
    "created_at": "2021-02-13T18:10:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503761",
    "user": "https://github.com/mantepse"
}
```

Branch: **[u/mantepse/crystals_highestweight_constructs_wrong_crystal_for_given_weight](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/crystals_highestweight_constructs_wrong_crystal_for_given_weight)**



---

archive/issue_events_432661.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2021-02-13T18:13:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31391#event-432661"
}
```



---

archive/issue_comments_503762.json:
```json
{
    "body": "Author: **Martin Rubey**",
    "created_at": "2021-02-13T18:13:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503762",
    "user": "https://github.com/mantepse"
}
```

Author: **Martin Rubey**



---

archive/issue_comments_503763.json:
```json
{
    "body": "Commit: **[`dbbb3aa`](https://github.com/sagemath/sagetrac-mirror/commit/dbbb3aa6bcb67e6aa02941203968b8a33bfea971)**",
    "created_at": "2021-02-13T18:13:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503763",
    "user": "https://github.com/mantepse"
}
```

Commit: **[`dbbb3aa`](https://github.com/sagemath/sagetrac-mirror/commit/dbbb3aa6bcb67e6aa02941203968b8a33bfea971)**



---

archive/issue_comments_503764.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThis is only a tentative fix.  The special case `G2` looks silly to me.  Also, I think we should raise an error for type `E` and `F` and `model=\"Tableaux\"`, or do something better.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dbbb3aa6bcb67e6aa02941203968b8a33bfea971\">dbbb3aa</a></td><td><code>tentative fix for crystals.Highestweight producing the wrong crystal</code></td></tr></table>\n",
    "created_at": "2021-02-13T18:13:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503764",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:3" align="right">comment:3</div>

This is only a tentative fix.  The special case `G2` looks silly to me.  Also, I think we should raise an error for type `E` and `F` and `model="Tableaux"`, or do something better.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dbbb3aa6bcb67e6aa02941203968b8a33bfea971">dbbb3aa</a></td><td><code>tentative fix for crystals.Highestweight producing the wrong crystal</code></td></tr></table>




---

archive/issue_comments_503765.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThis looks good to me as a fix. Do you mean the construction of the G2 tableaux crystal looks silly?",
    "created_at": "2021-02-13T23:51:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503765",
    "user": "https://github.com/anneschilling"
}
```

<div id="comment:5" align="right">comment:5</div>

This looks good to me as a fix. Do you mean the construction of the G2 tableaux crystal looks silly?



---

archive/issue_comments_503766.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nHi Anne!\n\nWhat I mean is that the special casing of `G2` looks silly.  \n\n```\n+         if cartan_type.type() == \"G\":\n+            sh = sum([[i]*c for i, c in dominant_weight], [])\n+            sh = Partition(reversed(sh)).conjugate()\n+            return CrystalOfTableaux(cartan_type, shape=sh)\n+\n```\nI.e., in all cases but `G2` we use the ambient space to contruct the shape.\n\nPut differently, would you say that the following code is better, worse, or about equally good?\n\n```\n    if model == 'Tableaux':\n        if cartan_type.type() in [\"A\", \"C\", \"G\"]:\n            sh = sum([[i]*c for i,c in dominant_weight], [])\n            sh = Partition(reversed(sh)).conjugate()\n        elif cartan_type.type() in [\"B\", \"D\"]:\n            sh = dominant_weight.to_ambient().to_vector()\n            from sage.rings.integer_ring import ZZ\n            if sh[-1] in ZZ:\n                sh = Partition(sh)\n        else:\n            raise ValueError(\"invalid model\")\n        return CrystalOfTableaux(cartan_type, shape=sh)\n```",
    "created_at": "2021-02-14T21:18:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503766",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:6" align="right">comment:6</div>

Hi Anne!

What I mean is that the special casing of `G2` looks silly.  

```
+         if cartan_type.type() == "G":
+            sh = sum([[i]*c for i, c in dominant_weight], [])
+            sh = Partition(reversed(sh)).conjugate()
+            return CrystalOfTableaux(cartan_type, shape=sh)
+
```
I.e., in all cases but `G2` we use the ambient space to contruct the shape.

Put differently, would you say that the following code is better, worse, or about equally good?

```
    if model == 'Tableaux':
        if cartan_type.type() in ["A", "C", "G"]:
            sh = sum([[i]*c for i,c in dominant_weight], [])
            sh = Partition(reversed(sh)).conjugate()
        elif cartan_type.type() in ["B", "D"]:
            sh = dominant_weight.to_ambient().to_vector()
            from sage.rings.integer_ring import ZZ
            if sh[-1] in ZZ:
                sh = Partition(sh)
        else:
            raise ValueError("invalid model")
        return CrystalOfTableaux(cartan_type, shape=sh)
```



---

archive/issue_comments_503767.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI don't know anything about type `Q`, but the following also doesn't look quite right, does it?\n\n```\nsage: ct = CartanType(\"Q4\")\nsage: L = ct.root_system().weight_lattice()\nsage: La = L.fundamental_weights()\nsage: C = crystals.Tableaux(ct, shape=[3,1]); (C.highest_weight_vectors()[0].weight(), C.cardinality())\n((3, 1, 0, 0), 80)\nsage: C = crystals.HighestWeight(2*La[1]+La[2]); (C.highest_weight_vector().weight(), C.cardinality())\n((3, 1, 0, 0), 45)\n\nsage: L\nWeight lattice of the Root system of type ['A', 3]\n```",
    "created_at": "2021-02-14T21:30:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503767",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:7" align="right">comment:7</div>

I don't know anything about type `Q`, but the following also doesn't look quite right, does it?

```
sage: ct = CartanType("Q4")
sage: L = ct.root_system().weight_lattice()
sage: La = L.fundamental_weights()
sage: C = crystals.Tableaux(ct, shape=[3,1]); (C.highest_weight_vectors()[0].weight(), C.cardinality())
((3, 1, 0, 0), 80)
sage: C = crystals.HighestWeight(2*La[1]+La[2]); (C.highest_weight_vector().weight(), C.cardinality())
((3, 1, 0, 0), 45)

sage: L
Weight lattice of the Root system of type ['A', 3]
```



---

archive/issue_comments_503768.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nOne major issue for using the ambient space for G<sub>2</sub> is the realization of the fundamental weights are not naturally partitions like for the other types:\n\n```\nsage: RootSystem('G2').ambient_space().fundamental_weights()\nFinite family {1: (1, 0, -1), 2: (2, -1, -1)}\nsage: RootSystem('D4').ambient_space().fundamental_weights()\nFinite family {1: (1, 0, 0, 0), 2: (1, 1, 0, 0), 3: (1/2, 1/2, 1/2, -1/2), 4: (1/2, 1/2, 1/2, 1/2)}\n```\nHowever, I think your idea of converting to the ambient space is good. You also don't need to convert the list to a partition. Thus, the last `if` statement is unnecessary.\n\nThe type EF failures are expected as there is no (canonical) tableau realization and should be removed from the ticket description.\n\nAdditionally, I think the added doctest should be more tailored to the failure of the ticket, namely the spin representations in type BD.",
    "created_at": "2021-02-14T23:56:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503768",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:8" align="right">comment:8</div>

One major issue for using the ambient space for G<sub>2</sub> is the realization of the fundamental weights are not naturally partitions like for the other types:

```
sage: RootSystem('G2').ambient_space().fundamental_weights()
Finite family {1: (1, 0, -1), 2: (2, -1, -1)}
sage: RootSystem('D4').ambient_space().fundamental_weights()
Finite family {1: (1, 0, 0, 0), 2: (1, 1, 0, 0), 3: (1/2, 1/2, 1/2, -1/2), 4: (1/2, 1/2, 1/2, 1/2)}
```
However, I think your idea of converting to the ambient space is good. You also don't need to convert the list to a partition. Thus, the last `if` statement is unnecessary.

The type EF failures are expected as there is no (canonical) tableau realization and should be removed from the ticket description.

Additionally, I think the added doctest should be more tailored to the failure of the ticket, namely the spin representations in type BD.



---

archive/issue_comments_503769.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nHi Martin,\n\n> What I mean is that the special casing of `G2` looks silly.  \n> \n> ```\n> +         if cartan_type.type() == \"G\":\n> +            sh = sum([[i]*c for i, c in dominant_weight], [])\n> +            sh = Partition(reversed(sh)).conjugate()\n> +            return CrystalOfTableaux(cartan_type, shape=sh)\n> +\n> ```\n> I.e., in all cases but `G2` we use the ambient space to contruct the shape.\n> \n> Put differently, would you say that the following code is better, worse, or about equally good?\n> \n> ```\n>     if model == 'Tableaux':\n>         if cartan_type.type() in [\"A\", \"C\", \"G\"]:\n>             sh = sum([[i]*c for i,c in dominant_weight], [])\n>             sh = Partition(reversed(sh)).conjugate()\n>         elif cartan_type.type() in [\"B\", \"D\"]:\n>             sh = dominant_weight.to_ambient().to_vector()\n>             from sage.rings.integer_ring import ZZ\n>             if sh[-1] in ZZ:\n>                 sh = Partition(sh)\n>         else:\n>             raise ValueError(\"invalid model\")\n>         return CrystalOfTableaux(cartan_type, shape=sh)\n> ```\n\nI think either is fine as long as it is correct! I slightly like it better to use the conversion to the ambient lattice for most types.\n\nRegarding type Q, I do not think the tableaux model was ever implemented for this type, so I think it should not be used!\n\nBest,\n\nAnne",
    "created_at": "2021-02-15T02:14:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503769",
    "user": "https://github.com/anneschilling"
}
```

<div id="comment:9" align="right">comment:9</div>

Hi Martin,

> What I mean is that the special casing of `G2` looks silly.  
> 
> ```
> +         if cartan_type.type() == "G":
> +            sh = sum([[i]*c for i, c in dominant_weight], [])
> +            sh = Partition(reversed(sh)).conjugate()
> +            return CrystalOfTableaux(cartan_type, shape=sh)
> +
> ```
> I.e., in all cases but `G2` we use the ambient space to contruct the shape.
> 
> Put differently, would you say that the following code is better, worse, or about equally good?
> 
> ```
>     if model == 'Tableaux':
>         if cartan_type.type() in ["A", "C", "G"]:
>             sh = sum([[i]*c for i,c in dominant_weight], [])
>             sh = Partition(reversed(sh)).conjugate()
>         elif cartan_type.type() in ["B", "D"]:
>             sh = dominant_weight.to_ambient().to_vector()
>             from sage.rings.integer_ring import ZZ
>             if sh[-1] in ZZ:
>                 sh = Partition(sh)
>         else:
>             raise ValueError("invalid model")
>         return CrystalOfTableaux(cartan_type, shape=sh)
> ```

I think either is fine as long as it is correct! I slightly like it better to use the conversion to the ambient lattice for most types.

Regarding type Q, I do not think the tableaux model was ever implemented for this type, so I think it should not be used!

Best,

Anne



---

archive/issue_comments_503770.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@anneschilling](#comment:9):\n> Regarding type Q, I do not think the tableaux model was ever implemented for this type, so I think it should not be used!\n\nI have implemented it:\n\n```\nsage: C = crystals.Tableaux(['Q',3], shape=[3,1])                                                                 \nsage: C.cardinality()                                                                                             \n24\n```\n\nThe difference you are getting Martin is the fact the root system for the **q**<sub>n</sub> Lie superalgebra is the same as for **gl**<sub>n</sub>. So the weights do not know to distinguish themselves from the two Lie algebras. I don't think there is a reason for them to because root systems are not Lie algebras. We might want to revisit this decision though as `crystals.HighestWeight` will not be able to distinguish between the two types because of this.",
    "created_at": "2021-02-15T03:06:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503770",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@anneschilling](#comment:9):
> Regarding type Q, I do not think the tableaux model was ever implemented for this type, so I think it should not be used!

I have implemented it:

```
sage: C = crystals.Tableaux(['Q',3], shape=[3,1])                                                                 
sage: C.cardinality()                                                                                             
24
```

The difference you are getting Martin is the fact the root system for the **q**<sub>n</sub> Lie superalgebra is the same as for **gl**<sub>n</sub>. So the weights do not know to distinguish themselves from the two Lie algebras. I don't think there is a reason for them to because root systems are not Lie algebras. We might want to revisit this decision though as `crystals.HighestWeight` will not be able to distinguish between the two types because of this.



---

archive/issue_comments_503771.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nDear Anne, Daniel and Travis (I guess that T is a good approximation to E)!\n\nMy thought about *not* using the ambient space was that the choice of positive roots is quite arbitrary, and it might be more correct to (at least try to) avoid dependence on a specific choice.  So here is another version of the same code:\n\n```\n        n = cartan_type.rank()\n        from sage.modules.free_module_element import vector\n        from sage.rings.integer_ring import ZZ\n        from sage.rings.rational_field import QQ\n        d = {i: vector(QQ, [1]*i + [0]*(n-i)) for i in range(1, n+1)}\n        if cartan_type.type() == \"B\":\n            d[n] = vector(QQ, [1/2 for i in range(n)])\n        elif cartan_type.type() == \"D\":\n            d[n-1] = vector(QQ, [1/2 for i in range(n-1)] + [-1/2])\n            d[n] = vector(QQ, [1/2 for i in range(n)])\n        sh = sum((c*d[i] for i, c in dominant_weight), vector(QQ, n))\n        if sh[-1] in ZZ:\n            sh = Partition(sh)\n        return CrystalOfTableaux(cartan_type, shape=sh)\n```\nThe call to `Partition` should not be avoided, or probably done in `crystals.Tableaux`, because\n\n```\nsage: C1 = crystals.Tableaux(\"A4\", shape=[2,1]); C1\nThe crystal of tableaux of type ['A', 4] and shape(s) [[2, 1]]\nsage: C2 = crystals.Tableaux(\"A4\", shape=[2,1,0,0]); C2\nThe crystal of tableaux of type ['A', 4] and shape(s) [[2, 1, 0, 0]]\nsage: C1 == C2\nFalse\n```\n\nAlternatively, here is a code which always relies on the chosen set of positive roots, but in a quirky way:\n\n```\n        sh = dominant_weight.to_ambient().to_vector()\n        if cartan_type.type() == \"G\":\n            sh = (-sh)[2:0:-1]\n        from sage.rings.integer_ring import ZZ\n        if cartan_type.type() in [\"B\", \"D\"] and sh[-1] not in ZZ:\n            return CrystalOfTableaux(cartan_type, shape=sh)\n\n        return CrystalOfTableaux(cartan_type, shape=Partition(sh))\n```\nNote that moving the call to `Partition` to the individual `crystals.Tableaux` classes would save three more lines, including the import statement.\n\nI assume that it's out of the question to change the choice of positive roots for `G_2`, right?\n\nConcerning the test, I must say that I like to have one (more or less) systematic test.  It would have saved me a day if something like it would have been available.",
    "created_at": "2021-02-15T09:22:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503771",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:11" align="right">comment:11</div>

Dear Anne, Daniel and Travis (I guess that T is a good approximation to E)!

My thought about *not* using the ambient space was that the choice of positive roots is quite arbitrary, and it might be more correct to (at least try to) avoid dependence on a specific choice.  So here is another version of the same code:

```
        n = cartan_type.rank()
        from sage.modules.free_module_element import vector
        from sage.rings.integer_ring import ZZ
        from sage.rings.rational_field import QQ
        d = {i: vector(QQ, [1]*i + [0]*(n-i)) for i in range(1, n+1)}
        if cartan_type.type() == "B":
            d[n] = vector(QQ, [1/2 for i in range(n)])
        elif cartan_type.type() == "D":
            d[n-1] = vector(QQ, [1/2 for i in range(n-1)] + [-1/2])
            d[n] = vector(QQ, [1/2 for i in range(n)])
        sh = sum((c*d[i] for i, c in dominant_weight), vector(QQ, n))
        if sh[-1] in ZZ:
            sh = Partition(sh)
        return CrystalOfTableaux(cartan_type, shape=sh)
```
The call to `Partition` should not be avoided, or probably done in `crystals.Tableaux`, because

```
sage: C1 = crystals.Tableaux("A4", shape=[2,1]); C1
The crystal of tableaux of type ['A', 4] and shape(s) [[2, 1]]
sage: C2 = crystals.Tableaux("A4", shape=[2,1,0,0]); C2
The crystal of tableaux of type ['A', 4] and shape(s) [[2, 1, 0, 0]]
sage: C1 == C2
False
```

Alternatively, here is a code which always relies on the chosen set of positive roots, but in a quirky way:

```
        sh = dominant_weight.to_ambient().to_vector()
        if cartan_type.type() == "G":
            sh = (-sh)[2:0:-1]
        from sage.rings.integer_ring import ZZ
        if cartan_type.type() in ["B", "D"] and sh[-1] not in ZZ:
            return CrystalOfTableaux(cartan_type, shape=sh)

        return CrystalOfTableaux(cartan_type, shape=Partition(sh))
```
Note that moving the call to `Partition` to the individual `crystals.Tableaux` classes would save three more lines, including the import statement.

I assume that it's out of the question to change the choice of positive roots for `G_2`, right?

Concerning the test, I must say that I like to have one (more or less) systematic test.  It would have saved me a day if something like it would have been available.



---

archive/issue_comments_503772.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nDear Martin,\n\nI would vote for this option:\n\n\n> Alternatively, here is a code which always relies on the chosen set of positive roots, but in a quirky way:\n> \n> ```\n>         sh = dominant_weight.to_ambient().to_vector()\n>         if cartan_type.type() == \"G\":\n>             sh = (-sh)[2:0:-1]\n>         from sage.rings.integer_ring import ZZ\n>         if cartan_type.type() in [\"B\", \"D\"] and sh[-1] not in ZZ:\n>             return CrystalOfTableaux(cartan_type, shape=sh)\n> \n>         return CrystalOfTableaux(cartan_type, shape=Partition(sh))\n> ```\n> Note that moving the call to `Partition` to the individual `crystals.Tableaux` classes would save three more lines, including the import statement.\n> \n> I assume that it's out of the question to change the choice of positive roots for `G_2`, right?\n\nWell, I would not do it for this ticket, but Dan or Travis might have other opinions.\n\nAnne",
    "created_at": "2021-02-15T23:37:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503772",
    "user": "https://github.com/anneschilling"
}
```

<div id="comment:12" align="right">comment:12</div>

Dear Martin,

I would vote for this option:


> Alternatively, here is a code which always relies on the chosen set of positive roots, but in a quirky way:
> 
> ```
>         sh = dominant_weight.to_ambient().to_vector()
>         if cartan_type.type() == "G":
>             sh = (-sh)[2:0:-1]
>         from sage.rings.integer_ring import ZZ
>         if cartan_type.type() in ["B", "D"] and sh[-1] not in ZZ:
>             return CrystalOfTableaux(cartan_type, shape=sh)
> 
>         return CrystalOfTableaux(cartan_type, shape=Partition(sh))
> ```
> Note that moving the call to `Partition` to the individual `crystals.Tableaux` classes would save three more lines, including the import statement.
> 
> I assume that it's out of the question to change the choice of positive roots for `G_2`, right?

Well, I would not do it for this ticket, but Dan or Travis might have other opinions.

Anne



---

archive/issue_comments_503773.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@mantepse](#comment:11):\n> My thought about *not* using the ambient space was that the choice of positive roots is quite arbitrary, and it might be more correct to (at least try to) avoid dependence on a specific choice.\n\nI don't think it was that arbitrary. Nicolas, were you the one who did the root system implementation? Do you have any comments on this?\n\n> The call to `Partition` should not be avoided, or probably done in `crystals.Tableaux`, because\n> \n> ```\n> sage: C1 = crystals.Tableaux(\"A4\", shape=[2,1]); C1\n> The crystal of tableaux of type ['A', 4] and shape(s) [[2, 1]]\n> sage: C2 = crystals.Tableaux(\"A4\", shape=[2,1,0,0]); C2\n> The crystal of tableaux of type ['A', 4] and shape(s) [[2, 1, 0, 0]]\n> sage: C1 == C2\n> False\n> ```\n\nYes, it should be avoided *here* in the highest weight crystals code. That is an issue with the `CrystalOfTableaux` code not sufficiently standardizing itself. There is also a strong argument for padding the list to have length `n`.\n\n> Alternatively, here is a code which always relies on the chosen set of positive roots, but in a quirky way:\n> \n> ```\n>         sh = dominant_weight.to_ambient().to_vector()\n>         if cartan_type.type() == \"G\":\n>             sh = (-sh)[2:0:-1]\n>         from sage.rings.integer_ring import ZZ\n>         if cartan_type.type() in [\"B\", \"D\"] and sh[-1] not in ZZ:\n>             return CrystalOfTableaux(cartan_type, shape=sh)\n> \n>         return CrystalOfTableaux(cartan_type, shape=Partition(sh))\n> ```\n> Note that moving the call to `Partition` to the individual `crystals.Tableaux` classes would save three more lines, including the import statement.\n\nI also like this option except for the call to `Partition`.\n\n> I assume that it's out of the question to change the choice of positive roots for `G_2`, right?\n\nI agree with Anne that definitely not on this ticket.\n\n> Concerning the test, I must say that I like to have one (more or less) systematic test.  It would have saved me a day if something like it would have been available.\n\nIf you want a systematic test, I would explicitly write something in. My second option would be to use `CartanType.samples(finite=True)`. I don't like depending on something that is essentially downstream.",
    "created_at": "2021-02-16T03:59:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503773",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@mantepse](#comment:11):
> My thought about *not* using the ambient space was that the choice of positive roots is quite arbitrary, and it might be more correct to (at least try to) avoid dependence on a specific choice.

I don't think it was that arbitrary. Nicolas, were you the one who did the root system implementation? Do you have any comments on this?

> The call to `Partition` should not be avoided, or probably done in `crystals.Tableaux`, because
> 
> ```
> sage: C1 = crystals.Tableaux("A4", shape=[2,1]); C1
> The crystal of tableaux of type ['A', 4] and shape(s) [[2, 1]]
> sage: C2 = crystals.Tableaux("A4", shape=[2,1,0,0]); C2
> The crystal of tableaux of type ['A', 4] and shape(s) [[2, 1, 0, 0]]
> sage: C1 == C2
> False
> ```

Yes, it should be avoided *here* in the highest weight crystals code. That is an issue with the `CrystalOfTableaux` code not sufficiently standardizing itself. There is also a strong argument for padding the list to have length `n`.

> Alternatively, here is a code which always relies on the chosen set of positive roots, but in a quirky way:
> 
> ```
>         sh = dominant_weight.to_ambient().to_vector()
>         if cartan_type.type() == "G":
>             sh = (-sh)[2:0:-1]
>         from sage.rings.integer_ring import ZZ
>         if cartan_type.type() in ["B", "D"] and sh[-1] not in ZZ:
>             return CrystalOfTableaux(cartan_type, shape=sh)
> 
>         return CrystalOfTableaux(cartan_type, shape=Partition(sh))
> ```
> Note that moving the call to `Partition` to the individual `crystals.Tableaux` classes would save three more lines, including the import statement.

I also like this option except for the call to `Partition`.

> I assume that it's out of the question to change the choice of positive roots for `G_2`, right?

I agree with Anne that definitely not on this ticket.

> Concerning the test, I must say that I like to have one (more or less) systematic test.  It would have saved me a day if something like it would have been available.

If you want a systematic test, I would explicitly write something in. My second option would be to use `CartanType.samples(finite=True)`. I don't like depending on something that is essentially downstream.



---

archive/issue_comments_503774.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa564476ed346b02976ce93f7a6bb8925f37c11d\">fa56447</a></td><td><code>improve standardization of shape(s) in CrystalOfTableaux</code></td></tr></table>\n",
    "created_at": "2021-02-17T22:07:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503774",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa564476ed346b02976ce93f7a6bb8925f37c11d">fa56447</a></td><td><code>improve standardization of shape(s) in CrystalOfTableaux</code></td></tr></table>




---

archive/issue_comments_503775.json:
```json
{
    "body": "Changed commit from **[`dbbb3aa`](https://github.com/sagemath/sagetrac-mirror/commit/dbbb3aa6bcb67e6aa02941203968b8a33bfea971)** to **[`fa56447`](https://github.com/sagemath/sagetrac-mirror/commit/fa564476ed346b02976ce93f7a6bb8925f37c11d)**",
    "created_at": "2021-02-17T22:07:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503775",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dbbb3aa`](https://github.com/sagemath/sagetrac-mirror/commit/dbbb3aa6bcb67e6aa02941203968b8a33bfea971)** to **[`fa56447`](https://github.com/sagemath/sagetrac-mirror/commit/fa564476ed346b02976ce93f7a6bb8925f37c11d)**



---

archive/issue_comments_503776.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e8c7fffaad7dca4cc85ba9b254a2ccd7e4c688e2\">e8c7fff</a></td><td><code>remove leftover print</code></td></tr></table>\n",
    "created_at": "2021-02-17T22:10:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503776",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e8c7fffaad7dca4cc85ba9b254a2ccd7e4c688e2">e8c7fff</a></td><td><code>remove leftover print</code></td></tr></table>




---

archive/issue_comments_503777.json:
```json
{
    "body": "Changed commit from **[`fa56447`](https://github.com/sagemath/sagetrac-mirror/commit/fa564476ed346b02976ce93f7a6bb8925f37c11d)** to **[`e8c7fff`](https://github.com/sagemath/sagetrac-mirror/commit/e8c7fffaad7dca4cc85ba9b254a2ccd7e4c688e2)**",
    "created_at": "2021-02-17T22:10:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503777",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fa56447`](https://github.com/sagemath/sagetrac-mirror/commit/fa564476ed346b02976ce93f7a6bb8925f37c11d)** to **[`e8c7fff`](https://github.com/sagemath/sagetrac-mirror/commit/e8c7fffaad7dca4cc85ba9b254a2ccd7e4c688e2)**



---

archive/issue_comments_503778.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f604a4fbdeb736e1d5de4ff952ab62905be07e22\">f604a4f</a></td><td><code>redo wrong commit</code></td></tr></table>\n",
    "created_at": "2021-02-17T22:14:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503778",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f604a4fbdeb736e1d5de4ff952ab62905be07e22">f604a4f</a></td><td><code>redo wrong commit</code></td></tr></table>




---

archive/issue_comments_503779.json:
```json
{
    "body": "Changed commit from **[`e8c7fff`](https://github.com/sagemath/sagetrac-mirror/commit/e8c7fffaad7dca4cc85ba9b254a2ccd7e4c688e2)** to **[`f604a4f`](https://github.com/sagemath/sagetrac-mirror/commit/f604a4fbdeb736e1d5de4ff952ab62905be07e22)**",
    "created_at": "2021-02-17T22:14:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503779",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e8c7fff`](https://github.com/sagemath/sagetrac-mirror/commit/e8c7fffaad7dca4cc85ba9b254a2ccd7e4c688e2)** to **[`f604a4f`](https://github.com/sagemath/sagetrac-mirror/commit/f604a4fbdeb736e1d5de4ff952ab62905be07e22)**



---

archive/issue_comments_503780.json:
```json
{
    "body": "Changed commit from **[`f604a4f`](https://github.com/sagemath/sagetrac-mirror/commit/f604a4fbdeb736e1d5de4ff952ab62905be07e22)** to **[`46dd5a2`](https://github.com/sagemath/sagetrac-mirror/commit/46dd5a29b9691e87c674689bafb1eb360be3afda)**",
    "created_at": "2021-02-17T22:17:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503780",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f604a4f`](https://github.com/sagemath/sagetrac-mirror/commit/f604a4fbdeb736e1d5de4ff952ab62905be07e22)** to **[`46dd5a2`](https://github.com/sagemath/sagetrac-mirror/commit/46dd5a29b9691e87c674689bafb1eb360be3afda)**



---

archive/issue_comments_503781.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/46dd5a29b9691e87c674689bafb1eb360be3afda\">46dd5a2</a></td><td><code>fix leftovers</code></td></tr></table>\n",
    "created_at": "2021-02-17T22:17:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503781",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/46dd5a29b9691e87c674689bafb1eb360be3afda">46dd5a2</a></td><td><code>fix leftovers</code></td></tr></table>




---

archive/issue_comments_503782.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI tried to follow your recommendations.  Is it correct that type A is the only exception to the rule that the \"shape\" should have length at most n?  (I think that, in type A, removing the redundant columns is not a good idea.)\n\n(I don't know anything about the affine case, so please pay attention to it)",
    "created_at": "2021-02-17T22:27:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503782",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:18" align="right">comment:18</div>

I tried to follow your recommendations.  Is it correct that type A is the only exception to the rule that the "shape" should have length at most n?  (I think that, in type A, removing the redundant columns is not a good idea.)

(I don't know anything about the affine case, so please pay attention to it)



---

archive/issue_comments_503783.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/93f0a80c0f5fc2ac0240ba3bf74126d621bf0839\">93f0a80</a></td><td><code>fix sanity check</code></td></tr></table>\n",
    "created_at": "2021-02-17T22:27:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503783",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/93f0a80c0f5fc2ac0240ba3bf74126d621bf0839">93f0a80</a></td><td><code>fix sanity check</code></td></tr></table>




---

archive/issue_comments_503784.json:
```json
{
    "body": "Changed commit from **[`46dd5a2`](https://github.com/sagemath/sagetrac-mirror/commit/46dd5a29b9691e87c674689bafb1eb360be3afda)** to **[`93f0a80`](https://github.com/sagemath/sagetrac-mirror/commit/93f0a80c0f5fc2ac0240ba3bf74126d621bf0839)**",
    "created_at": "2021-02-17T22:27:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503784",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`46dd5a2`](https://github.com/sagemath/sagetrac-mirror/commit/46dd5a29b9691e87c674689bafb1eb360be3afda)** to **[`93f0a80`](https://github.com/sagemath/sagetrac-mirror/commit/93f0a80c0f5fc2ac0240ba3bf74126d621bf0839)**



---

archive/issue_comments_503785.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nNow that I am looking at the code and the changes, it seems more like we should standardize the shape to actually be a partition and strip the trailing zeros there. Plus, they are accessible via the `shapes` attribute. Sorry for the back-and-forth on this; the code has spoken.\n\nIn answer to [your question](#comment:18), type A is the only exception to the rule, and I agree we should not remove height n columns to make it a **gl**<sub>n</sub> object, which it more naturally is IMO.\n\nSince we are also fixing the input for `CrystalsOfTableaux` here, there is also this one:\n\n```\nsage: crystals.Tableaux(['D',4], shape=[-1/2,1/2,1/2,-1/2])\nThe crystal of tableaux of type ['D', 4] and shape(s) [[-1/2, 1/2, 1/2, -1/2]]\n```\nI think the check is lacking and the fact we force the spins to all be plus or minus is artificial and can be removed.",
    "created_at": "2021-02-17T23:17:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503785",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:20" align="right">comment:20</div>

Now that I am looking at the code and the changes, it seems more like we should standardize the shape to actually be a partition and strip the trailing zeros there. Plus, they are accessible via the `shapes` attribute. Sorry for the back-and-forth on this; the code has spoken.

In answer to [your question](#comment:18), type A is the only exception to the rule, and I agree we should not remove height n columns to make it a **gl**<sub>n</sub> object, which it more naturally is IMO.

Since we are also fixing the input for `CrystalsOfTableaux` here, there is also this one:

```
sage: crystals.Tableaux(['D',4], shape=[-1/2,1/2,1/2,-1/2])
The crystal of tableaux of type ['D', 4] and shape(s) [[-1/2, 1/2, 1/2, -1/2]]
```
I think the check is lacking and the fact we force the spins to all be plus or minus is artificial and can be removed.



---

archive/issue_comments_503786.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI agree with Travis' comments. Other than that the code looks good to me!",
    "created_at": "2021-02-18T05:49:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503786",
    "user": "https://github.com/anneschilling"
}
```

<div id="comment:21" align="right">comment:21</div>

I agree with Travis' comments. Other than that the code looks good to me!



---

archive/issue_comments_503787.json:
```json
{
    "body": "Changed commit from **[`93f0a80`](https://github.com/sagemath/sagetrac-mirror/commit/93f0a80c0f5fc2ac0240ba3bf74126d621bf0839)** to **[`4bda411`](https://github.com/sagemath/sagetrac-mirror/commit/4bda4113730f22710ca1d725fed78f89df48707c)**",
    "created_at": "2021-02-18T07:28:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503787",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`93f0a80`](https://github.com/sagemath/sagetrac-mirror/commit/93f0a80c0f5fc2ac0240ba3bf74126d621bf0839)** to **[`4bda411`](https://github.com/sagemath/sagetrac-mirror/commit/4bda4113730f22710ca1d725fed78f89df48707c)**



---

archive/issue_comments_503788.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4bda4113730f22710ca1d725fed78f89df48707c\">4bda411</a></td><td><code>standardize to partitions whenever possible</code></td></tr></table>\n",
    "created_at": "2021-02-18T07:28:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503788",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4bda4113730f22710ca1d725fed78f89df48707c">4bda411</a></td><td><code>standardize to partitions whenever possible</code></td></tr></table>




---

archive/issue_comments_503789.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI changed the code to convert to partitions whenever possible.\n\nCould you please be more explicit with your comment about\n\n```\nsage: crystals.Tableaux(['D',4], shape=[-1/2,1/2,1/2,-1/2])\nThe crystal of tableaux of type ['D', 4] and shape(s) [[-1/2, 1/2, 1/2, -1/2]]\n```\nIt is unclear to me what input is OK and what should be rejected.",
    "created_at": "2021-02-18T07:33:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503789",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:23" align="right">comment:23</div>

I changed the code to convert to partitions whenever possible.

Could you please be more explicit with your comment about

```
sage: crystals.Tableaux(['D',4], shape=[-1/2,1/2,1/2,-1/2])
The crystal of tableaux of type ['D', 4] and shape(s) [[-1/2, 1/2, 1/2, -1/2]]
```
It is unclear to me what input is OK and what should be rejected.



---

archive/issue_comments_503790.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI just realized that I am still confused:\n\n```\nsage: ct = CartanType([\"A\", 3])\nsage: La = RootSystem(ct).weight_lattice().fundamental_weights()\nsage: La[1].to_ambient()\n(1, 0, 0, 0)\nsage: R = RootSystem(ct).root_space()\nsage: La = RootSystem(ct).root_space().fundamental_weights_from_simple_roots()\nsage: La[1].to_ambient()\n(3/4, -1/4, -1/4, -1/4)\n```",
    "created_at": "2021-02-18T11:59:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503790",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:24" align="right">comment:24</div>

I just realized that I am still confused:

```
sage: ct = CartanType(["A", 3])
sage: La = RootSystem(ct).weight_lattice().fundamental_weights()
sage: La[1].to_ambient()
(1, 0, 0, 0)
sage: R = RootSystem(ct).root_space()
sage: La = RootSystem(ct).root_space().fundamental_weights_from_simple_roots()
sage: La[1].to_ambient()
(3/4, -1/4, -1/4, -1/4)
```



---

archive/issue_comments_503791.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@mantepse](#comment:23):\n> I changed the code to convert to partitions whenever possible.\n> \n> Could you please be more explicit with your comment about\n> \n> ```\n> sage: crystals.Tableaux(['D',4], shape=[-1/2,1/2,1/2,-1/2])\n> The crystal of tableaux of type ['D', 4] and shape(s) [[-1/2, 1/2, 1/2, -1/2]]\n> ```\n> It is unclear to me what input is OK and what should be rejected.\n\nIt says in the documentation:\n\n   If the type is D_r, the shape is permitted to have a negative value\n   in the r-th position. Thus if the shape equals [s_1,...,s_r],\n   then s_r may be negative but in any case s_1 >= ... >=\n   s_{r-1} >= |s_r|. This crystal is related to that of shape\n   [s_1,...,|s_r|] by the outer automorphism of SO(2r).\n\nSo negative entries should not be allowed except in the r-th entry.",
    "created_at": "2021-02-18T17:10:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503791",
    "user": "https://github.com/anneschilling"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@mantepse](#comment:23):
> I changed the code to convert to partitions whenever possible.
> 
> Could you please be more explicit with your comment about
> 
> ```
> sage: crystals.Tableaux(['D',4], shape=[-1/2,1/2,1/2,-1/2])
> The crystal of tableaux of type ['D', 4] and shape(s) [[-1/2, 1/2, 1/2, -1/2]]
> ```
> It is unclear to me what input is OK and what should be rejected.

It says in the documentation:

   If the type is D_r, the shape is permitted to have a negative value
   in the r-th position. Thus if the shape equals [s_1,...,s_r],
   then s_r may be negative but in any case s_1 >= ... >=
   s_{r-1} >= |s_r|. This crystal is related to that of shape
   [s_1,...,|s_r|] by the outer automorphism of SO(2r).

So negative entries should not be allowed except in the r-th entry.



---

archive/issue_comments_503792.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw, Anne Schilling**",
    "created_at": "2021-02-18T17:11:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503792",
    "user": "https://github.com/anneschilling"
}
```

Reviewer: **Travis Scrimshaw, Anne Schilling**



---

archive/issue_comments_503793.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nSo, Travis, with\n\n> I think the check is lacking and the fact we force the spins to all be plus or minus is artificial and can be removed. \n\nyou are referring to the fact that `[1/2, ..., 1/2, -1/2]` is allowed?",
    "created_at": "2021-02-18T18:39:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503793",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:27" align="right">comment:27</div>

So, Travis, with

> I think the check is lacking and the fact we force the spins to all be plus or minus is artificial and can be removed. 

you are referring to the fact that `[1/2, ..., 1/2, -1/2]` is allowed?



---

archive/issue_comments_503794.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@mantepse](#comment:27):\n> So, Travis, with\n> \n> > I think the check is lacking and the fact we force the spins to all be plus or minus is artificial and can be removed. \n\n> \n> you are referring to the fact that `[1/2, ..., 1/2, -1/2]` is allowed?\n\nYes, `[1/2, ..., 1/2, -1/2]` is allowed.",
    "created_at": "2021-02-18T21:29:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503794",
    "user": "https://github.com/anneschilling"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@mantepse](#comment:27):
> So, Travis, with
> 
> > I think the check is lacking and the fact we force the spins to all be plus or minus is artificial and can be removed. 

> 
> you are referring to the fact that `[1/2, ..., 1/2, -1/2]` is allowed?

Yes, `[1/2, ..., 1/2, -1/2]` is allowed.



---

archive/issue_comments_503795.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@anneschilling](#comment:28):\n> Replying to [@mantepse](#comment:27):\n> > So, Travis, with\n> > \n> > > I think the check is lacking and the fact we force the spins to all be plus or minus is artificial and can be removed. \n\n> > \n> > you are referring to the fact that `[1/2, ..., 1/2, -1/2]` is allowed?\n\n> \n> Yes, `[1/2, ..., 1/2, -1/2]` is allowed.\n\nWhat I mean is you cannot mix `[1/2, ..., 1/2, -1/2]` with `[1/2, ..., 1/2, 1/2]`:\n\n```\nsage: crystals.Tableaux(['D',4], [[1/2,1/2,1/2,-1/2],[1/2,1/2,1/2,1/2]])\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\nValueError: in type D spins should all be positive or negative\n```",
    "created_at": "2021-02-19T23:40:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503795",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@anneschilling](#comment:28):
> Replying to [@mantepse](#comment:27):
> > So, Travis, with
> > 
> > > I think the check is lacking and the fact we force the spins to all be plus or minus is artificial and can be removed. 

> > 
> > you are referring to the fact that `[1/2, ..., 1/2, -1/2]` is allowed?

> 
> Yes, `[1/2, ..., 1/2, -1/2]` is allowed.

What I mean is you cannot mix `[1/2, ..., 1/2, -1/2]` with `[1/2, ..., 1/2, 1/2]`:

```
sage: crystals.Tableaux(['D',4], [[1/2,1/2,1/2,-1/2],[1/2,1/2,1/2,1/2]])
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: in type D spins should all be positive or negative
```



---

archive/issue_comments_503796.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@mantepse](#comment:24):\n> I just realized that I am still confused:\n> \n> ```\n> sage: ct = CartanType([\"A\", 3])\n> sage: La = RootSystem(ct).weight_lattice().fundamental_weights()\n> sage: La[1].to_ambient()\n> (1, 0, 0, 0)\n> sage: R = RootSystem(ct).root_space()\n> sage: La = RootSystem(ct).root_space().fundamental_weights_from_simple_roots()\n> sage: La[1].to_ambient()\n> (3/4, -1/4, -1/4, -1/4)\n> ```\n\nEverything in the type A root system can be considered up to scalar multiples of the `(1, 1, ..., 1)` vector. So these two can be considered to be the same element because it really lives in a quotient space.",
    "created_at": "2021-02-19T23:43:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503796",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@mantepse](#comment:24):
> I just realized that I am still confused:
> 
> ```
> sage: ct = CartanType(["A", 3])
> sage: La = RootSystem(ct).weight_lattice().fundamental_weights()
> sage: La[1].to_ambient()
> (1, 0, 0, 0)
> sage: R = RootSystem(ct).root_space()
> sage: La = RootSystem(ct).root_space().fundamental_weights_from_simple_roots()
> sage: La[1].to_ambient()
> (3/4, -1/4, -1/4, -1/4)
> ```

Everything in the type A root system can be considered up to scalar multiples of the `(1, 1, ..., 1)` vector. So these two can be considered to be the same element because it really lives in a quotient space.



---

archive/issue_comments_503797.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nThank you for both explanations! I think the special SLn / GLn feature should not be ignored in `crystals.HighestWeight`, so I'll make another special case.",
    "created_at": "2021-02-20T07:47:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503797",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:31" align="right">comment:31</div>

Thank you for both explanations! I think the special SLn / GLn feature should not be ignored in `crystals.HighestWeight`, so I'll make another special case.



---

archive/issue_comments_503798.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c94ee8696c1327726096870fdeeb494987adc0a\">1c94ee8</a></td><td><code>always normalize to weight space, and test this</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/178edd721084cf8366a4dbbca8fa722a937bcdc7\">178edd7</a></td><td><code>raise ValueError for weights which are not dominant also in the the spin case</code></td></tr></table>\n",
    "created_at": "2021-02-20T20:55:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503798",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c94ee8696c1327726096870fdeeb494987adc0a">1c94ee8</a></td><td><code>always normalize to weight space, and test this</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/178edd721084cf8366a4dbbca8fa722a937bcdc7">178edd7</a></td><td><code>raise ValueError for weights which are not dominant also in the the spin case</code></td></tr></table>




---

archive/issue_comments_503799.json:
```json
{
    "body": "Changed commit from **[`4bda411`](https://github.com/sagemath/sagetrac-mirror/commit/4bda4113730f22710ca1d725fed78f89df48707c)** to **[`178edd7`](https://github.com/sagemath/sagetrac-mirror/commit/178edd721084cf8366a4dbbca8fa722a937bcdc7)**",
    "created_at": "2021-02-20T20:55:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503799",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4bda411`](https://github.com/sagemath/sagetrac-mirror/commit/4bda4113730f22710ca1d725fed78f89df48707c)** to **[`178edd7`](https://github.com/sagemath/sagetrac-mirror/commit/178edd721084cf8366a4dbbca8fa722a937bcdc7)**



---

archive/issue_comments_503800.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nI could not see how to change the code to accomodate Travis' comment\n\n> the fact we force the spins to all be plus or minus is artificial and can be removed\n\nbut apart from this, I think it should be (slightly) better now.",
    "created_at": "2021-02-20T20:57:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503800",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:33" align="right">comment:33</div>

I could not see how to change the code to accomodate Travis' comment

> the fact we force the spins to all be plus or minus is artificial and can be removed

but apart from this, I think it should be (slightly) better now.



---

archive/issue_comments_503801.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@mantepse](#comment:33):\n> I could not see how to change the code to accomodate Travis' comment\n> \n> > the fact we force the spins to all be plus or minus is artificial and can be removed\n\n> \n> but apart from this, I think it should be (slightly) better now.\n\nI see. That is a bit tricky to remove that. So let's just leave that in.",
    "created_at": "2021-02-22T01:02:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503801",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@mantepse](#comment:33):
> I could not see how to change the code to accomodate Travis' comment
> 
> > the fact we force the spins to all be plus or minus is artificial and can be removed

> 
> but apart from this, I think it should be (slightly) better now.

I see. That is a bit tricky to remove that. So let's just leave that in.



---

archive/issue_events_432662.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-02-22T01:02:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31391#event-432662"
}
```



---

archive/issue_events_432663.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-02-22T01:02:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31391#event-432663"
}
```



---

archive/issue_comments_503802.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nThank you for looking at the code!\n\nOne more question: I currently do\n\n```\ndominant_weight = dominant_weight.to_ambient().to_weight_space(ZZ)\n```\ndo obtain a weight in the weight lattice.\n\nMaybe it would make sense to add a method `to_weight_space` to `RootSpace`, so we could just say\n\n```\ndominant_weight = dominant_weight.to_weight_space()\n```\n(`WeightSpaceElement` has a method `to_weight_space` which just returns `self`, whereas `dominant_weight.to_ambient().to_weight_space(ZZ)` has to do some real work)",
    "created_at": "2021-02-22T11:19:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503802",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:35" align="right">comment:35</div>

Thank you for looking at the code!

One more question: I currently do

```
dominant_weight = dominant_weight.to_ambient().to_weight_space(ZZ)
```
do obtain a weight in the weight lattice.

Maybe it would make sense to add a method `to_weight_space` to `RootSpace`, so we could just say

```
dominant_weight = dominant_weight.to_weight_space()
```
(`WeightSpaceElement` has a method `to_weight_space` which just returns `self`, whereas `dominant_weight.to_ambient().to_weight_space(ZZ)` has to do some real work)



---

archive/issue_comments_503803.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nNo, it does not because the Cartan matrix is not invertible in general. For example, in affine type since there is a nullspace that is spanned by the null root.",
    "created_at": "2021-02-22T23:14:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503803",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:36" align="right">comment:36</div>

No, it does not because the Cartan matrix is not invertible in general. For example, in affine type since there is a nullspace that is spanned by the null root.



---

archive/issue_comments_503804.json:
```json
{
    "body": "Changed branch from **[u/mantepse/crystals_highestweight_constructs_wrong_crystal_for_given_weight](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/crystals_highestweight_constructs_wrong_crystal_for_given_weight)** to **[`178edd7`](https://github.com/sagemath/sagetrac-mirror/commit/178edd721084cf8366a4dbbca8fa722a937bcdc7)**",
    "created_at": "2021-03-09T00:01:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31391#issuecomment-503804",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mantepse/crystals_highestweight_constructs_wrong_crystal_for_given_weight](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/crystals_highestweight_constructs_wrong_crystal_for_given_weight)** to **[`178edd7`](https://github.com/sagemath/sagetrac-mirror/commit/178edd721084cf8366a4dbbca8fa722a937bcdc7)**



---

archive/issue_events_432664.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-09T00:01:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31391#event-432664"
}
```



---

archive/issue_events_432665.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "851b382927397d4d433eaeb5f409a9d64a903e1f",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-03-09T00:01:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31391",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31391#event-432665"
}
```
