# Issue 31064: ci-cygwin*.yml: delegate to tox, add more stages, use more specific SAGE_LOCAL

archive/issues_030827.json:
```json
{
    "body": "We revise the CI workflows for Cygwin, now going through `SAGE_ROOT/tox.ini` for the package installation and invoking the new system package scripts from there.\n\nWe also add more stages to make the workflow more robust; this was originally done in #29152.\n\nWe also make another improvement that was easy to do:\nThe build now uses `SAGE_LOCAL=/opt/sage-$COMMIT` instead of `/sage/local`.\nThis will make it easier to download and install several versions of Sage.\n\n\n\n**CC:**  @seblabbe @kliem @antonio-rojas @embray @slel\n\n**Branch/Commit:** [42f4458e3ae857f82759b3c9490ab34306a15f4d](https://github.com/sagemath/sagetrac-mirror/commit/42f4458e3ae857f82759b3c9490ab34306a15f4d)\n\n**Reviewer:** Dima Pasechnik\n\n**Author:** Matthias Koeppe\n\n**Dependencies:** #29124, #30944, #31062, #31084\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31064\n\n",
    "closed_at": "2021-02-20T10:46:44Z",
    "created_at": "2020-12-16T22:28:04Z",
    "labels": [
        "component: porting: cygwin",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "ci-cygwin*.yml: delegate to tox, add more stages, use more specific SAGE_LOCAL",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31064",
    "user": "https://github.com/mkoeppe"
}
```
We revise the CI workflows for Cygwin, now going through `SAGE_ROOT/tox.ini` for the package installation and invoking the new system package scripts from there.

We also add more stages to make the workflow more robust; this was originally done in #29152.

We also make another improvement that was easy to do:
The build now uses `SAGE_LOCAL=/opt/sage-$COMMIT` instead of `/sage/local`.
This will make it easier to download and install several versions of Sage.



**CC:**  @seblabbe @kliem @antonio-rojas @embray @slel

**Branch/Commit:** [42f4458e3ae857f82759b3c9490ab34306a15f4d](https://github.com/sagemath/sagetrac-mirror/commit/42f4458e3ae857f82759b3c9490ab34306a15f4d)

**Reviewer:** Dima Pasechnik

**Author:** Matthias Koeppe

**Dependencies:** #29124, #30944, #31062, #31084

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/31064





---

archive/issue_comments_616793.json:
```json
{
    "body": "**Changing dependencies** from \"#29124\" to \"#29124, #30944\".",
    "created_at": "2020-12-16T23:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616793",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#29124" to "#29124, #30944".



---

archive/issue_comments_616794.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq)",
    "created_at": "2020-12-17T05:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616794",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq)



---

archive/issue_comments_616795.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,4 +7,4 @@\n Package name is required. Please pass at least one package name to install.\n Error: Process completed with exit code 1.\n ```\n-We fix it in this ticket.\n+We fix it in this ticket by going through `SAGE_ROOT/tox.ini` for the package installation and invoking the new system package scripts from there.\n``````\n",
    "created_at": "2020-12-17T05:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616795",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,4 +7,4 @@
 Package name is required. Please pass at least one package name to install.
 Error: Process completed with exit code 1.
 ```
-We fix it in this ticket.
+We fix it in this ticket by going through `SAGE_ROOT/tox.ini` for the package installation and invoking the new system package scripts from there.
``````




---

archive/issue_comments_616796.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2020-12-17T05:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616796",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_616797.json:
```json
{
    "body": "**Commit:** [b2ae68aea3cb706650731b0488b59ce992234e7b](https://github.com/sagemath/sagetrac-mirror/commit/b2ae68aea3cb706650731b0488b59ce992234e7b)",
    "created_at": "2020-12-17T05:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616797",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [b2ae68aea3cb706650731b0488b59ce992234e7b](https://github.com/sagemath/sagetrac-mirror/commit/b2ae68aea3cb706650731b0488b59ce992234e7b)



---

archive/issue_comments_616798.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/898758da497ca4b57c5e8b609cf2439d215018a7\">898758d</a></td><td><code>tox.ini: Add local-root</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/559dd8e7acd647224b2b320a9e77e95e0737bc04\">559dd8e</a></td><td><code>tox.ini (local-root): Pass --enable-build-as-root to configure</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a85f41c9220d9b71f0033faf1cb9010a8626ede1\">a85f41c</a></td><td><code>tox.ini (local): Do not build the toolchain when posargs = config.status or posargs = configure</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1de912a69f441c80e4d4c64a627f0707e5807442\">1de912a</a></td><td><code>tox.ini (local-sudo): Run apt-get update with sudo</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c7e5c482e1c54ba140c3d134ebfc909bd943a3d\">3c7e5c4</a></td><td><code>tox.ini (local-root, local-sudo): Run output of sage-print-system-package-command through eval</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7ff30c92e59308d84377411ea4edd9173c4cd75\">f7ff30c</a></td><td><code>Merge branch 't/29124/script-packages-prereq-toolchain-bootstrap' into t/30944/tox__improve_local_sudo_ubuntu_standard</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e9ca2c1d848708c0a626bc412844043b005c985a\">e9ca2c1</a></td><td><code>Merge branch 't/29124/script-packages-prereq-toolchain-bootstrap' into t/30944/tox__improve_local_sudo_ubuntu_standard</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be4177bfda9f1c5473aa1e1616ec9bfe62365ae3\">be4177b</a></td><td><code>Merge branch 't/30944/tox__improve_local_sudo_ubuntu_standard' into t/31064/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f74fe3d8c93f194a24b45681cbc217ddc89b70e3\">f74fe3d</a></td><td><code>tox.ini (local-cygwin-choco): New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b2ae68aea3cb706650731b0488b59ce992234e7b\">b2ae68a</a></td><td><code>.github/workflows/ci-cygwin*.yml: Install cygwin packages via tox</code></td></tr></table>\n",
    "created_at": "2020-12-17T05:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616798",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
**Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/898758da497ca4b57c5e8b609cf2439d215018a7">898758d</a></td><td><code>tox.ini: Add local-root</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/559dd8e7acd647224b2b320a9e77e95e0737bc04">559dd8e</a></td><td><code>tox.ini (local-root): Pass --enable-build-as-root to configure</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a85f41c9220d9b71f0033faf1cb9010a8626ede1">a85f41c</a></td><td><code>tox.ini (local): Do not build the toolchain when posargs = config.status or posargs = configure</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1de912a69f441c80e4d4c64a627f0707e5807442">1de912a</a></td><td><code>tox.ini (local-sudo): Run apt-get update with sudo</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c7e5c482e1c54ba140c3d134ebfc909bd943a3d">3c7e5c4</a></td><td><code>tox.ini (local-root, local-sudo): Run output of sage-print-system-package-command through eval</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7ff30c92e59308d84377411ea4edd9173c4cd75">f7ff30c</a></td><td><code>Merge branch 't/29124/script-packages-prereq-toolchain-bootstrap' into t/30944/tox__improve_local_sudo_ubuntu_standard</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e9ca2c1d848708c0a626bc412844043b005c985a">e9ca2c1</a></td><td><code>Merge branch 't/29124/script-packages-prereq-toolchain-bootstrap' into t/30944/tox__improve_local_sudo_ubuntu_standard</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be4177bfda9f1c5473aa1e1616ec9bfe62365ae3">be4177b</a></td><td><code>Merge branch 't/30944/tox__improve_local_sudo_ubuntu_standard' into t/31064/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f74fe3d8c93f194a24b45681cbc217ddc89b70e3">f74fe3d</a></td><td><code>tox.ini (local-cygwin-choco): New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b2ae68aea3cb706650731b0488b59ce992234e7b">b2ae68a</a></td><td><code>.github/workflows/ci-cygwin*.yml: Install cygwin packages via tox</code></td></tr></table>




---

archive/issue_comments_616799.json:
```json
{
    "body": "**Reviewer:** https://github.com/mkoeppe/sage/actions/runs/427378215",
    "created_at": "2020-12-17T05:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616799",
    "user": "https://github.com/mkoeppe"
}
```

**Reviewer:** https://github.com/mkoeppe/sage/actions/runs/427378215



---

archive/issue_comments_616800.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2020-12-17T05:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616800",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_616801.json:
```json
{
    "body": "**Work_Issues:** SAGE_LOCAL",
    "created_at": "2020-12-17T18:44:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616801",
    "user": "https://github.com/mkoeppe"
}
```

**Work_Issues:** SAGE_LOCAL



---

archive/issue_comments_616802.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2020-12-17T18:44:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616802",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_616803.json:
```json
{
    "body": "**Changing commit** from \"[b2ae68aea3cb706650731b0488b59ce992234e7b](https://github.com/sagemath/sagetrac-mirror/commit/b2ae68aea3cb706650731b0488b59ce992234e7b)\" to \"[11cf8db0b49607b83c66d0d0d49ec52ea0069f39](https://github.com/sagemath/sagetrac-mirror/commit/11cf8db0b49607b83c66d0d0d49ec52ea0069f39)\".",
    "created_at": "2020-12-18T00:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616803",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b2ae68aea3cb706650731b0488b59ce992234e7b](https://github.com/sagemath/sagetrac-mirror/commit/b2ae68aea3cb706650731b0488b59ce992234e7b)" to "[11cf8db0b49607b83c66d0d0d49ec52ea0069f39](https://github.com/sagemath/sagetrac-mirror/commit/11cf8db0b49607b83c66d0d0d49ec52ea0069f39)".



---

archive/issue_comments_616804.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/11cf8db0b49607b83c66d0d0d49ec52ea0069f39\">11cf8db</a></td><td><code>.github/workflows/ci-cygwin*.yml: Use SAGE_LOCAL as set by tox</code></td></tr></table>\n",
    "created_at": "2020-12-18T00:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616804",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/11cf8db0b49607b83c66d0d0d49ec52ea0069f39">11cf8db</a></td><td><code>.github/workflows/ci-cygwin*.yml: Use SAGE_LOCAL as set by tox</code></td></tr></table>




---

archive/issue_comments_616805.json:
```json
{
    "body": "**Changing work_issues** from \"SAGE_LOCAL\" to \"\".",
    "created_at": "2020-12-18T00:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616805",
    "user": "https://github.com/mkoeppe"
}
```

**Changing work_issues** from "SAGE_LOCAL" to "".



---

archive/issue_comments_616806.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/actions/runs/427378215\" to \"https://github.com/mkoeppe/sage/actions/runs/429356144\".",
    "created_at": "2020-12-18T00:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616806",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/actions/runs/427378215" to "https://github.com/mkoeppe/sage/actions/runs/429356144".



---

archive/issue_comments_616807.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2020-12-18T00:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616807",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_616808.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2020-12-18T06:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616808",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_616809.json:
```json
{
    "body": "**Work_Issues:** update extract-sage-local.sh",
    "created_at": "2020-12-18T06:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616809",
    "user": "https://github.com/mkoeppe"
}
```

**Work_Issues:** update extract-sage-local.sh



---

archive/issue_comments_616810.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05d57c0bf907fb91f229325f5cfa0e35b001fea2\">05d57c0</a></td><td><code>.github/workflows/ci-cygwin-*.yml: Pass PREFIX to tox</code></td></tr></table>\n",
    "created_at": "2020-12-18T18:15:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616810",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05d57c0bf907fb91f229325f5cfa0e35b001fea2">05d57c0</a></td><td><code>.github/workflows/ci-cygwin-*.yml: Pass PREFIX to tox</code></td></tr></table>




---

archive/issue_comments_616811.json:
```json
{
    "body": "**Changing commit** from \"[11cf8db0b49607b83c66d0d0d49ec52ea0069f39](https://github.com/sagemath/sagetrac-mirror/commit/11cf8db0b49607b83c66d0d0d49ec52ea0069f39)\" to \"[05d57c0bf907fb91f229325f5cfa0e35b001fea2](https://github.com/sagemath/sagetrac-mirror/commit/05d57c0bf907fb91f229325f5cfa0e35b001fea2)\".",
    "created_at": "2020-12-18T18:15:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616811",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[11cf8db0b49607b83c66d0d0d49ec52ea0069f39](https://github.com/sagemath/sagetrac-mirror/commit/11cf8db0b49607b83c66d0d0d49ec52ea0069f39)" to "[05d57c0bf907fb91f229325f5cfa0e35b001fea2](https://github.com/sagemath/sagetrac-mirror/commit/05d57c0bf907fb91f229325f5cfa0e35b001fea2)".



---

archive/issue_comments_616812.json:
```json
{
    "body": "**Changing commit** from \"[05d57c0bf907fb91f229325f5cfa0e35b001fea2](https://github.com/sagemath/sagetrac-mirror/commit/05d57c0bf907fb91f229325f5cfa0e35b001fea2)\" to \"[d87e1604ba0c6a27ffc0e048d1bb351fadc54d90](https://github.com/sagemath/sagetrac-mirror/commit/d87e1604ba0c6a27ffc0e048d1bb351fadc54d90)\".",
    "created_at": "2020-12-18T21:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616812",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[05d57c0bf907fb91f229325f5cfa0e35b001fea2](https://github.com/sagemath/sagetrac-mirror/commit/05d57c0bf907fb91f229325f5cfa0e35b001fea2)" to "[d87e1604ba0c6a27ffc0e048d1bb351fadc54d90](https://github.com/sagemath/sagetrac-mirror/commit/d87e1604ba0c6a27ffc0e048d1bb351fadc54d90)".



---

archive/issue_comments_616813.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d87e1604ba0c6a27ffc0e048d1bb351fadc54d90\">d87e160</a></td><td><code>.github/workflows/extract-sage-local.sh: Use PREFIX</code></td></tr></table>\n",
    "created_at": "2020-12-18T21:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616813",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d87e1604ba0c6a27ffc0e048d1bb351fadc54d90">d87e160</a></td><td><code>.github/workflows/extract-sage-local.sh: Use PREFIX</code></td></tr></table>




---

archive/issue_comments_616814.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/actions/runs/429356144\" to \"https://github.com/mkoeppe/sage/actions/runs/431265667\".",
    "created_at": "2020-12-18T21:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616814",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/actions/runs/429356144" to "https://github.com/mkoeppe/sage/actions/runs/431265667".



---

archive/issue_comments_616815.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0827c85bd73c3564739118d01d76af8554354835\">0827c85</a></td><td><code>Quoting fixes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/00a91828b237f983428611617784a71f2146eb33\">00a9182</a></td><td><code>Just use github.sha</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b327031d96686ead49e2386c180fedabd09d2a4e\">b327031</a></td><td><code>.github/workflows/extract-sage-local.sh: Fix up path</code></td></tr></table>\n",
    "created_at": "2020-12-19T03:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616815",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0827c85bd73c3564739118d01d76af8554354835">0827c85</a></td><td><code>Quoting fixes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/00a91828b237f983428611617784a71f2146eb33">00a9182</a></td><td><code>Just use github.sha</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b327031d96686ead49e2386c180fedabd09d2a4e">b327031</a></td><td><code>.github/workflows/extract-sage-local.sh: Fix up path</code></td></tr></table>




---

archive/issue_comments_616816.json:
```json
{
    "body": "**Changing commit** from \"[d87e1604ba0c6a27ffc0e048d1bb351fadc54d90](https://github.com/sagemath/sagetrac-mirror/commit/d87e1604ba0c6a27ffc0e048d1bb351fadc54d90)\" to \"[b327031d96686ead49e2386c180fedabd09d2a4e](https://github.com/sagemath/sagetrac-mirror/commit/b327031d96686ead49e2386c180fedabd09d2a4e)\".",
    "created_at": "2020-12-19T03:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616816",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d87e1604ba0c6a27ffc0e048d1bb351fadc54d90](https://github.com/sagemath/sagetrac-mirror/commit/d87e1604ba0c6a27ffc0e048d1bb351fadc54d90)" to "[b327031d96686ead49e2386c180fedabd09d2a4e](https://github.com/sagemath/sagetrac-mirror/commit/b327031d96686ead49e2386c180fedabd09d2a4e)".



---

archive/issue_comments_616817.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2020-12-19T03:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616817",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_616818.json:
```json
{
    "body": "**Changing work_issues** from \"update extract-sage-local.sh\" to \"\".",
    "created_at": "2020-12-19T03:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616818",
    "user": "https://github.com/mkoeppe"
}
```

**Changing work_issues** from "update extract-sage-local.sh" to "".



---

archive/issue_comments_616819.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/actions/runs/431265667\" to \"https://github.com/mkoeppe/sage/runs/1580222034\".",
    "created_at": "2020-12-19T03:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616819",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/actions/runs/431265667" to "https://github.com/mkoeppe/sage/runs/1580222034".



---

archive/issue_comments_616820.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,3 +8,9 @@\n Error: Process completed with exit code 1.\n ```\n We fix it in this ticket by going through `SAGE_ROOT/tox.ini` for the package installation and invoking the new system package scripts from there.\n+\n+We also make another improvement that was easy to do:\n+The build now uses `SAGE_LOCAL=/opt/sage-$COMMIT` instead of `/sage/local`.\n+This will make it easier to download and install several versions of Sage.\n+\n+\n``````\n",
    "created_at": "2020-12-19T03:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616820",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,3 +8,9 @@
 Error: Process completed with exit code 1.
 ```
 We fix it in this ticket by going through `SAGE_ROOT/tox.ini` for the package installation and invoking the new system package scripts from there.
+
+We also make another improvement that was easy to do:
+The build now uses `SAGE_LOCAL=/opt/sage-$COMMIT` instead of `/sage/local`.
+This will make it easier to download and install several versions of Sage.
+
+
``````




---

archive/issue_comments_616821.json:
```json
{
    "body": "**Changing dependencies** from \"#29124, #30944\" to \"#29124, #30944, #31062\".",
    "created_at": "2020-12-19T17:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616821",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#29124, #30944" to "#29124, #30944, #31062".



---

archive/issue_comments_616822.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9ad611dfab4c1121e3da078e250c9671f6dd5122\">9ad611d</a></td><td><code>tox.ini, build/bin/write-dockerfile.sh: Add !sage_sws2rst, !rpy2 to SAGE_CHECK_PACKAGES</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48657d2c4fdcee552a019aba8c0c9d06c87f7df6\">48657d2</a></td><td><code>build/pkgs/sage_sws2rst/dependencies: Fix typo - use SAGE_CHECK_sage_sws2rst</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/380c718c885018749301cc0761f234598bd0dd19\">380c718</a></td><td><code>Merge branch 't/30944/tox__improve_local_sudo_ubuntu_standard' into t/31062/tox___gh_actions__disable_testsuites_of_packages_depending_on_pip_packages__pytest_______if_there_is_no_ssl</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b25ea3bf32025a9e26fb214ed710b2aa6986a2f4\">b25ea3b</a></td><td><code>build/pkgs/rpy2/dependencies: If SAGE_CHECK=yes, depend on ipython</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a0d99d78c0d268552f2cf57ed86cef3548995521\">a0d99d7</a></td><td><code>Merge branch 't/31062/tox___gh_actions__disable_testsuites_of_packages_depending_on_pip_packages__pytest_______if_there_is_no_ssl' into t/31064/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq</code></td></tr></table>\n",
    "created_at": "2020-12-19T17:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616822",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9ad611dfab4c1121e3da078e250c9671f6dd5122">9ad611d</a></td><td><code>tox.ini, build/bin/write-dockerfile.sh: Add !sage_sws2rst, !rpy2 to SAGE_CHECK_PACKAGES</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48657d2c4fdcee552a019aba8c0c9d06c87f7df6">48657d2</a></td><td><code>build/pkgs/sage_sws2rst/dependencies: Fix typo - use SAGE_CHECK_sage_sws2rst</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/380c718c885018749301cc0761f234598bd0dd19">380c718</a></td><td><code>Merge branch 't/30944/tox__improve_local_sudo_ubuntu_standard' into t/31062/tox___gh_actions__disable_testsuites_of_packages_depending_on_pip_packages__pytest_______if_there_is_no_ssl</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b25ea3bf32025a9e26fb214ed710b2aa6986a2f4">b25ea3b</a></td><td><code>build/pkgs/rpy2/dependencies: If SAGE_CHECK=yes, depend on ipython</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a0d99d78c0d268552f2cf57ed86cef3548995521">a0d99d7</a></td><td><code>Merge branch 't/31062/tox___gh_actions__disable_testsuites_of_packages_depending_on_pip_packages__pytest_______if_there_is_no_ssl' into t/31064/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq</code></td></tr></table>




---

archive/issue_comments_616823.json:
```json
{
    "body": "**Changing commit** from \"[b327031d96686ead49e2386c180fedabd09d2a4e](https://github.com/sagemath/sagetrac-mirror/commit/b327031d96686ead49e2386c180fedabd09d2a4e)\" to \"[a0d99d78c0d268552f2cf57ed86cef3548995521](https://github.com/sagemath/sagetrac-mirror/commit/a0d99d78c0d268552f2cf57ed86cef3548995521)\".",
    "created_at": "2020-12-19T17:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616823",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b327031d96686ead49e2386c180fedabd09d2a4e](https://github.com/sagemath/sagetrac-mirror/commit/b327031d96686ead49e2386c180fedabd09d2a4e)" to "[a0d99d78c0d268552f2cf57ed86cef3548995521](https://github.com/sagemath/sagetrac-mirror/commit/a0d99d78c0d268552f2cf57ed86cef3548995521)".



---

archive/issue_comments_616824.json:
```json
{
    "body": "<a id='comment:16'></a>\nMerged #31062 to fix a merge conflict",
    "created_at": "2020-12-19T17:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616824",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
Merged #31062 to fix a merge conflict



---

archive/issue_comments_616825.json:
```json
{
    "body": "**Changing commit** from \"[a0d99d78c0d268552f2cf57ed86cef3548995521](https://github.com/sagemath/sagetrac-mirror/commit/a0d99d78c0d268552f2cf57ed86cef3548995521)\" to \"[cf31b79036db96b5fd9e0b22f44c3692bc22356b](https://github.com/sagemath/sagetrac-mirror/commit/cf31b79036db96b5fd9e0b22f44c3692bc22356b)\".",
    "created_at": "2020-12-19T18:10:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616825",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a0d99d78c0d268552f2cf57ed86cef3548995521](https://github.com/sagemath/sagetrac-mirror/commit/a0d99d78c0d268552f2cf57ed86cef3548995521)" to "[cf31b79036db96b5fd9e0b22f44c3692bc22356b](https://github.com/sagemath/sagetrac-mirror/commit/cf31b79036db96b5fd9e0b22f44c3692bc22356b)".



---

archive/issue_comments_616826.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cea4cd5aed351f19c0d6129e1e508c1d7179c751\">cea4cd5</a></td><td><code>ci-cygwin-standard.yml: More stages, continue-on-error: true</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cf31b79036db96b5fd9e0b22f44c3692bc22356b\">cf31b79</a></td><td><code>Fixup after cherry-pick</code></td></tr></table>\n",
    "created_at": "2020-12-19T18:10:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616826",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cea4cd5aed351f19c0d6129e1e508c1d7179c751">cea4cd5</a></td><td><code>ci-cygwin-standard.yml: More stages, continue-on-error: true</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cf31b79036db96b5fd9e0b22f44c3692bc22356b">cf31b79</a></td><td><code>Fixup after cherry-pick</code></td></tr></table>




---

archive/issue_comments_616827.json:
```json
{
    "body": "<a id='comment:18'></a>\nIntegrated the workflow changes from #29152",
    "created_at": "2020-12-19T18:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616827",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
Integrated the workflow changes from #29152



---

archive/issue_comments_616828.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/runs/1580222034\" to \"https://github.com/mkoeppe/sage/actions/runs/432758069\".",
    "created_at": "2020-12-19T18:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616828",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/runs/1580222034" to "https://github.com/mkoeppe/sage/actions/runs/432758069".



---

archive/issue_comments_616829.json:
```json
{
    "body": "**Changing dependencies** from \"#29124, #30944, #31062\" to \"#29124, #30944, #31062, #31084\".",
    "created_at": "2020-12-19T19:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616829",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#29124, #30944, #31062" to "#29124, #30944, #31062, #31084".



---

archive/issue_comments_616830.json:
```json
{
    "body": "**Changing commit** from \"[cf31b79036db96b5fd9e0b22f44c3692bc22356b](https://github.com/sagemath/sagetrac-mirror/commit/cf31b79036db96b5fd9e0b22f44c3692bc22356b)\" to \"[8769bd66363a757f8917f8b59c149b4807649234](https://github.com/sagemath/sagetrac-mirror/commit/8769bd66363a757f8917f8b59c149b4807649234)\".",
    "created_at": "2020-12-19T19:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616830",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[cf31b79036db96b5fd9e0b22f44c3692bc22356b](https://github.com/sagemath/sagetrac-mirror/commit/cf31b79036db96b5fd9e0b22f44c3692bc22356b)" to "[8769bd66363a757f8917f8b59c149b4807649234](https://github.com/sagemath/sagetrac-mirror/commit/8769bd66363a757f8917f8b59c149b4807649234)".



---

archive/issue_comments_616831.json:
```json
{
    "body": "<a id='comment:21'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/09d1737b45d1b29c768f49ae5284392a5917a32b\">09d1737</a></td><td><code>Makefile: Add targets ptest-nodoc etc.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0dca7763f5c63ba15bbe96322aa67d384c65e776\">0dca776</a></td><td><code>Merge branch 't/29124/script-packages-prereq-toolchain-bootstrap' into t/31084/makefile__add__ptest__targets_that_do_not_depend_on_the_docbuild</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/073124cb21874ec02071377adcde9e5cbe895426\">073124c</a></td><td><code>Merge branch 't/31084/makefile__add__ptest__targets_that_do_not_depend_on_the_docbuild' into t/31064/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8769bd66363a757f8917f8b59c149b4807649234\">8769bd6</a></td><td><code>.github/workflows/ci-cygwin-*.yml: Separate docbuild and ptest</code></td></tr></table>\n",
    "created_at": "2020-12-19T19:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616831",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/09d1737b45d1b29c768f49ae5284392a5917a32b">09d1737</a></td><td><code>Makefile: Add targets ptest-nodoc etc.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0dca7763f5c63ba15bbe96322aa67d384c65e776">0dca776</a></td><td><code>Merge branch 't/29124/script-packages-prereq-toolchain-bootstrap' into t/31084/makefile__add__ptest__targets_that_do_not_depend_on_the_docbuild</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/073124cb21874ec02071377adcde9e5cbe895426">073124c</a></td><td><code>Merge branch 't/31084/makefile__add__ptest__targets_that_do_not_depend_on_the_docbuild' into t/31064/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8769bd66363a757f8917f8b59c149b4807649234">8769bd6</a></td><td><code>.github/workflows/ci-cygwin-*.yml: Separate docbuild and ptest</code></td></tr></table>




---

archive/issue_comments_616832.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2e4b830e489e11a9c6f1d530b417c996bd1662d\">d2e4b83</a></td><td><code>Fix up stage iv</code></td></tr></table>\n",
    "created_at": "2020-12-20T18:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616832",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2e4b830e489e11a9c6f1d530b417c996bd1662d">d2e4b83</a></td><td><code>Fix up stage iv</code></td></tr></table>




---

archive/issue_comments_616833.json:
```json
{
    "body": "**Changing commit** from \"[8769bd66363a757f8917f8b59c149b4807649234](https://github.com/sagemath/sagetrac-mirror/commit/8769bd66363a757f8917f8b59c149b4807649234)\" to \"[d2e4b830e489e11a9c6f1d530b417c996bd1662d](https://github.com/sagemath/sagetrac-mirror/commit/d2e4b830e489e11a9c6f1d530b417c996bd1662d)\".",
    "created_at": "2020-12-20T18:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616833",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[8769bd66363a757f8917f8b59c149b4807649234](https://github.com/sagemath/sagetrac-mirror/commit/8769bd66363a757f8917f8b59c149b4807649234)" to "[d2e4b830e489e11a9c6f1d530b417c996bd1662d](https://github.com/sagemath/sagetrac-mirror/commit/d2e4b830e489e11a9c6f1d530b417c996bd1662d)".



---

archive/issue_comments_616834.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/38262228db0391e9bc8cda5bf06982d6d0db12ca\">3826222</a></td><td><code>Fix up stage iv</code></td></tr></table>\n",
    "created_at": "2020-12-20T18:31:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616834",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/38262228db0391e9bc8cda5bf06982d6d0db12ca">3826222</a></td><td><code>Fix up stage iv</code></td></tr></table>




---

archive/issue_comments_616835.json:
```json
{
    "body": "**Changing commit** from \"[d2e4b830e489e11a9c6f1d530b417c996bd1662d](https://github.com/sagemath/sagetrac-mirror/commit/d2e4b830e489e11a9c6f1d530b417c996bd1662d)\" to \"[38262228db0391e9bc8cda5bf06982d6d0db12ca](https://github.com/sagemath/sagetrac-mirror/commit/38262228db0391e9bc8cda5bf06982d6d0db12ca)\".",
    "created_at": "2020-12-20T18:31:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616835",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d2e4b830e489e11a9c6f1d530b417c996bd1662d](https://github.com/sagemath/sagetrac-mirror/commit/d2e4b830e489e11a9c6f1d530b417c996bd1662d)" to "[38262228db0391e9bc8cda5bf06982d6d0db12ca](https://github.com/sagemath/sagetrac-mirror/commit/38262228db0391e9bc8cda5bf06982d6d0db12ca)".



---

archive/issue_events_091369.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "rename": {
        "from": "ci-cygwin*.yml: Adjust to new script packages _bootstrap, _prereq",
        "to": "ci-cygwin*.yml: Adjust to new script packages _bootstrap, _prereq, delegate to tox"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31064#event-91369"
}
```



---

archive/issue_comments_616836.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/actions/runs/432758069\" to \"https://github.com/mkoeppe/sage/actions/runs/434342215\".",
    "created_at": "2020-12-20T19:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616836",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/actions/runs/432758069" to "https://github.com/mkoeppe/sage/actions/runs/434342215".



---

archive/issue_comments_616837.json:
```json
{
    "body": "**Work_Issues:** cygwin-minimal: don't pick up mingw tools",
    "created_at": "2020-12-21T18:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616837",
    "user": "https://github.com/mkoeppe"
}
```

**Work_Issues:** cygwin-minimal: don't pick up mingw tools



---

archive/issue_comments_616838.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2020-12-21T18:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616838",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_616839.json:
```json
{
    "body": "**Changing work_issues** from \"cygwin-minimal: don't pick up mingw tools\" to \"\".",
    "created_at": "2020-12-22T01:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616839",
    "user": "https://github.com/mkoeppe"
}
```

**Changing work_issues** from "cygwin-minimal: don't pick up mingw tools" to "".



---

archive/issue_comments_616840.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2020-12-22T01:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616840",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_616841.json:
```json
{
    "body": "<a id='comment:30'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/598b0c233a501dba64b66c26577d533c826d9ad5\">598b0c2</a></td><td><code>local-cygwin-choco: Do not pass through PATH, use full pathname of choco instead</code></td></tr></table>\n",
    "created_at": "2020-12-22T07:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616841",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/598b0c233a501dba64b66c26577d533c826d9ad5">598b0c2</a></td><td><code>local-cygwin-choco: Do not pass through PATH, use full pathname of choco instead</code></td></tr></table>




---

archive/issue_comments_616842.json:
```json
{
    "body": "**Changing commit** from \"[38262228db0391e9bc8cda5bf06982d6d0db12ca](https://github.com/sagemath/sagetrac-mirror/commit/38262228db0391e9bc8cda5bf06982d6d0db12ca)\" to \"[598b0c233a501dba64b66c26577d533c826d9ad5](https://github.com/sagemath/sagetrac-mirror/commit/598b0c233a501dba64b66c26577d533c826d9ad5)\".",
    "created_at": "2020-12-22T07:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616842",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[38262228db0391e9bc8cda5bf06982d6d0db12ca](https://github.com/sagemath/sagetrac-mirror/commit/38262228db0391e9bc8cda5bf06982d6d0db12ca)" to "[598b0c233a501dba64b66c26577d533c826d9ad5](https://github.com/sagemath/sagetrac-mirror/commit/598b0c233a501dba64b66c26577d533c826d9ad5)".



---

archive/issue_comments_616843.json:
```json
{
    "body": "<a id='comment:31'></a>\n**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3cf5ee46cde574170859d9d8ce90abef990e7969\">3cf5ee4</a></td><td><code>Merge commit 'a50ddf88975086b14a49895e371477df00fd57b5' of git://trac.sagemath.org/sage into t/30940/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4927e1574e6f856f5dda78b888713f0358b16da\">b4927e1</a></td><td><code>sage.misc.package: Remove/adjust non-robust doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e5fe7522a2ad03b23553d696e7a941e9f4fa3271\">e5fe752</a></td><td><code>Merge tag '9.3.beta4' into t/30940/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78ff9d580f5f0c1396e1f8a5421858170999957a\">78ff9d5</a></td><td><code>src/sage/misc/package.py: Add one more # optional - build</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a44042f86577431358fb3ea95875cd949f971984\">a44042f</a></td><td><code>Merge branch 't/30940/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available' into t/29124/script-packages-prereq-toolchain-bootstrap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64bde5f887ac115b1e40b7905ad30cc00d8de363\">64bde5f</a></td><td><code>Merge tag '9.3.beta5' into t/30940/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e9a7572a37b228f4a74c35f680190e6b237f48d8\">e9a7572</a></td><td><code>src/sage/misc/package.py: Improve source formatting</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c7bcda971b925201891d60d13c6b6e879c888301\">c7bcda9</a></td><td><code>Merge branch 't/30940/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available' into t/29124/script-packages-prereq-toolchain-bootstrap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9988c5fab43adc6f5784a124248887637475d67c\">9988c5f</a></td><td><code>ci-cygwin*.yml: Adjust to new script packages _bootstrap, _prereq</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d65299c666b9ed71a8f93cfb0b830c15d9e923f8\">d65299c</a></td><td><code>Merge branch 't/29124/script-packages-prereq-toolchain-bootstrap' into t/31064/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq</code></td></tr></table>\n",
    "created_at": "2020-12-29T19:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616843",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>
**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3cf5ee46cde574170859d9d8ce90abef990e7969">3cf5ee4</a></td><td><code>Merge commit 'a50ddf88975086b14a49895e371477df00fd57b5' of git://trac.sagemath.org/sage into t/30940/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4927e1574e6f856f5dda78b888713f0358b16da">b4927e1</a></td><td><code>sage.misc.package: Remove/adjust non-robust doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e5fe7522a2ad03b23553d696e7a941e9f4fa3271">e5fe752</a></td><td><code>Merge tag '9.3.beta4' into t/30940/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78ff9d580f5f0c1396e1f8a5421858170999957a">78ff9d5</a></td><td><code>src/sage/misc/package.py: Add one more # optional - build</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a44042f86577431358fb3ea95875cd949f971984">a44042f</a></td><td><code>Merge branch 't/30940/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available' into t/29124/script-packages-prereq-toolchain-bootstrap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64bde5f887ac115b1e40b7905ad30cc00d8de363">64bde5f</a></td><td><code>Merge tag '9.3.beta5' into t/30940/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e9a7572a37b228f4a74c35f680190e6b237f48d8">e9a7572</a></td><td><code>src/sage/misc/package.py: Improve source formatting</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c7bcda971b925201891d60d13c6b6e879c888301">c7bcda9</a></td><td><code>Merge branch 't/30940/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available' into t/29124/script-packages-prereq-toolchain-bootstrap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9988c5fab43adc6f5784a124248887637475d67c">9988c5f</a></td><td><code>ci-cygwin*.yml: Adjust to new script packages _bootstrap, _prereq</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d65299c666b9ed71a8f93cfb0b830c15d9e923f8">d65299c</a></td><td><code>Merge branch 't/29124/script-packages-prereq-toolchain-bootstrap' into t/31064/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq</code></td></tr></table>




---

archive/issue_comments_616844.json:
```json
{
    "body": "**Changing commit** from \"[598b0c233a501dba64b66c26577d533c826d9ad5](https://github.com/sagemath/sagetrac-mirror/commit/598b0c233a501dba64b66c26577d533c826d9ad5)\" to \"[d65299c666b9ed71a8f93cfb0b830c15d9e923f8](https://github.com/sagemath/sagetrac-mirror/commit/d65299c666b9ed71a8f93cfb0b830c15d9e923f8)\".",
    "created_at": "2020-12-29T19:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616844",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[598b0c233a501dba64b66c26577d533c826d9ad5](https://github.com/sagemath/sagetrac-mirror/commit/598b0c233a501dba64b66c26577d533c826d9ad5)" to "[d65299c666b9ed71a8f93cfb0b830c15d9e923f8](https://github.com/sagemath/sagetrac-mirror/commit/d65299c666b9ed71a8f93cfb0b830c15d9e923f8)".



---

archive/issue_comments_616845.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,13 +1,6 @@\n-#29124 moved the files `build/pkgs/*.txt` to new locations but forgot to update the CI scripts for Cygwin, leading to failures like this (https://github.com/mkoeppe/sage/runs/1561097256):\n+We revise the CI workflows for Cygwin, now going through `SAGE_ROOT/tox.ini` for the package installation and invoking the new system package scripts from there.\n \n-```\n-sed: can't read ./build/pkgs/cygwin.txt: No such file or directory\n-sed: can't read ./build/pkgs/cygwin-bootstrap.txt: No such file or directory\n-Chocolatey v0.10.15\n-Package name is required. Please pass at least one package name to install.\n-Error: Process completed with exit code 1.\n-```\n-We fix it in this ticket by going through `SAGE_ROOT/tox.ini` for the package installation and invoking the new system package scripts from there.\n+We also add more stages to make the workflow more robust; this was originally done in #29152.\n \n We also make another improvement that was easy to do:\n The build now uses `SAGE_LOCAL=/opt/sage-$COMMIT` instead of `/sage/local`.\n``````\n",
    "created_at": "2020-12-29T19:19:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616845",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,13 +1,6 @@
-#29124 moved the files `build/pkgs/*.txt` to new locations but forgot to update the CI scripts for Cygwin, leading to failures like this (https://github.com/mkoeppe/sage/runs/1561097256):
+We revise the CI workflows for Cygwin, now going through `SAGE_ROOT/tox.ini` for the package installation and invoking the new system package scripts from there.
 
-```
-sed: can't read ./build/pkgs/cygwin.txt: No such file or directory
-sed: can't read ./build/pkgs/cygwin-bootstrap.txt: No such file or directory
-Chocolatey v0.10.15
-Package name is required. Please pass at least one package name to install.
-Error: Process completed with exit code 1.
-```
-We fix it in this ticket by going through `SAGE_ROOT/tox.ini` for the package installation and invoking the new system package scripts from there.
+We also add more stages to make the workflow more robust; this was originally done in #29152.
 
 We also make another improvement that was easy to do:
 The build now uses `SAGE_LOCAL=/opt/sage-$COMMIT` instead of `/sage/local`.
``````




---

archive/issue_events_091370.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "rename": {
        "from": "ci-cygwin*.yml: Adjust to new script packages _bootstrap, _prereq, delegate to tox",
        "to": "ci-cygwin*.yml: delegate to tox, add more stages, use more specific SAGE_LOCAL"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31064#event-91370"
}
```



---

archive/issue_comments_616846.json:
```json
{
    "body": "**Changing commit** from \"[d65299c666b9ed71a8f93cfb0b830c15d9e923f8](https://github.com/sagemath/sagetrac-mirror/commit/d65299c666b9ed71a8f93cfb0b830c15d9e923f8)\" to \"[a5e405116fa41c9afb3c5f46fbde2489616d267f](https://github.com/sagemath/sagetrac-mirror/commit/a5e405116fa41c9afb3c5f46fbde2489616d267f)\".",
    "created_at": "2020-12-29T19:19:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616846",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d65299c666b9ed71a8f93cfb0b830c15d9e923f8](https://github.com/sagemath/sagetrac-mirror/commit/d65299c666b9ed71a8f93cfb0b830c15d9e923f8)" to "[a5e405116fa41c9afb3c5f46fbde2489616d267f](https://github.com/sagemath/sagetrac-mirror/commit/a5e405116fa41c9afb3c5f46fbde2489616d267f)".



---

archive/issue_comments_616847.json:
```json
{
    "body": "<a id='comment:33'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ab191339dfa275b3466f530a59268c756f5d1b05\">ab19133</a></td><td><code>Merge branch 't/29124/script-packages-prereq-toolchain-bootstrap' into t/30944/tox__improve_local_sudo_ubuntu_standard</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a5e405116fa41c9afb3c5f46fbde2489616d267f\">a5e4051</a></td><td><code>Merge branch 't/30944/tox__improve_local_sudo_ubuntu_standard' into t/31064/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq</code></td></tr></table>\n",
    "created_at": "2020-12-29T19:19:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616847",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ab191339dfa275b3466f530a59268c756f5d1b05">ab19133</a></td><td><code>Merge branch 't/29124/script-packages-prereq-toolchain-bootstrap' into t/30944/tox__improve_local_sudo_ubuntu_standard</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a5e405116fa41c9afb3c5f46fbde2489616d267f">a5e4051</a></td><td><code>Merge branch 't/30944/tox__improve_local_sudo_ubuntu_standard' into t/31064/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq</code></td></tr></table>




---

archive/issue_comments_616848.json:
```json
{
    "body": "<a id='comment:34'></a>\nFollow-up: #31211",
    "created_at": "2021-01-08T18:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616848",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>
Follow-up: #31211



---

archive/issue_comments_616849.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2021-01-09T12:46:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616849",
    "user": "https://github.com/tobiasdiez"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_616850.json:
```json
{
    "body": "<a id='comment:35'></a>\nA few remarks after skimming the changes:\n\n> +        PACKAGES=\"python38 python38-pip\"\n\n\nI think it's better to install python using the python action, which brings a few goodies along: https://github.com/marketplace/actions/setup-python\n\n> +        C:\\tools\\cygwin\\bin\\bash -l -x -c\n\nCan you try to put this as `shell: C:\\\\tools\\\\cygwin\\\\bin\\\\bash -l -x -c {0}`? Would make the workflow easier to read.\n\n\nAnd then my usual rant about using tox for this ;-). I know you are a big fan of using tox, and this is fine. But I still think it's not the best tool for github workflows. You are cramping a lot of things into one command, which makes it hard to see at which stake the workflow fails. I would propose to add helper scripts so that the workflow looks like\n- Install dependencies:\n  `choco install (build/bin/get-dependencies cygwin) --source cygwin`\n- Build: \n  `build/bin/build-local` (with the script that is currently in tox: local, running bootstrap, configure and make)\n- Test:\n  `tox` (running all python tests)\n\nThe scripts can of course be reused in `tox.ini` still giving you the chance to locally use tox for this (although I find it counterintuitive that tox might change my system installation).",
    "created_at": "2021-01-09T12:46:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616850",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:35'></a>
A few remarks after skimming the changes:

> +        PACKAGES="python38 python38-pip"


I think it's better to install python using the python action, which brings a few goodies along: https://github.com/marketplace/actions/setup-python

> +        C:\tools\cygwin\bin\bash -l -x -c

Can you try to put this as `shell: C:\\tools\\cygwin\\bin\\bash -l -x -c {0}`? Would make the workflow easier to read.


And then my usual rant about using tox for this ;-). I know you are a big fan of using tox, and this is fine. But I still think it's not the best tool for github workflows. You are cramping a lot of things into one command, which makes it hard to see at which stake the workflow fails. I would propose to add helper scripts so that the workflow looks like
- Install dependencies:
  `choco install (build/bin/get-dependencies cygwin) --source cygwin`
- Build: 
  `build/bin/build-local` (with the script that is currently in tox: local, running bootstrap, configure and make)
- Test:
  `tox` (running all python tests)

The scripts can of course be reused in `tox.ini` still giving you the chance to locally use tox for this (although I find it counterintuitive that tox might change my system installation).



---

archive/issue_comments_616851.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [gh-tobiasdiez](#comment%3A35):\n> > +        C:\\tools\\cygwin\\bin\\bash -l -x -c\n\n> Can you try to put this as `shell: C:\\\\tools\\\\cygwin\\\\bin\\\\bash -l -x -c {0}`? Would make the workflow easier to read.\n\nI'm pretty sure I went through several iterations, including use of the shell directive, before settling on something that actually works",
    "created_at": "2021-01-09T18:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616851",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>
Replying to [gh-tobiasdiez](#comment%3A35):
> > +        C:\tools\cygwin\bin\bash -l -x -c

> Can you try to put this as `shell: C:\\tools\\cygwin\\bin\\bash -l -x -c {0}`? Would make the workflow easier to read.

I'm pretty sure I went through several iterations, including use of the shell directive, before settling on something that actually works



---

archive/issue_comments_616852.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [gh-tobiasdiez](#comment%3A35):\n> You are cramping a lot of things into one command, which makes it hard to see at which stake the workflow fails. \n\n\nThis has not been a problem in my experience.",
    "created_at": "2021-01-09T18:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616852",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>
Replying to [gh-tobiasdiez](#comment%3A35):
> You are cramping a lot of things into one command, which makes it hard to see at which stake the workflow fails. 


This has not been a problem in my experience.



---

archive/issue_comments_616853.json:
```json
{
    "body": "<a id='comment:38'></a>\nLet me explain again why I like to use `tox` to drive as much as possible in our CI. `tox` is a stable tool that has been under long term maintenance.  For context, before we (well, I) started to use GH Actions, we (well, individual developers many of whom no longer have sufficient time) used buildbot, Circle CI, Travis CI, [GitLab](GitLab) pipelines, ... Because our project is surfing on \"free compute\", the available technologies are changing faster than our project can sustain. Therefore it is important not to spend too much effort on development specific to the CI platform. \n\nThe present ticket consolidates GH Actions-specific code for installing Cygwin to just become part of the tox workflow. It is not enough to just factor through scripts that \"could\" also be run by developers on a local Windows machine: We currently do not even have any developers who do that. By using tox inside the GH Actions workflow, we actually make sure that these scripts are usable (and remain usable when changes are made) outside of a GH Actions environment.",
    "created_at": "2021-01-09T18:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616853",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'></a>
Let me explain again why I like to use `tox` to drive as much as possible in our CI. `tox` is a stable tool that has been under long term maintenance.  For context, before we (well, I) started to use GH Actions, we (well, individual developers many of whom no longer have sufficient time) used buildbot, Circle CI, Travis CI, [GitLab](GitLab) pipelines, ... Because our project is surfing on "free compute", the available technologies are changing faster than our project can sustain. Therefore it is important not to spend too much effort on development specific to the CI platform. 

The present ticket consolidates GH Actions-specific code for installing Cygwin to just become part of the tox workflow. It is not enough to just factor through scripts that "could" also be run by developers on a local Windows machine: We currently do not even have any developers who do that. By using tox inside the GH Actions workflow, we actually make sure that these scripts are usable (and remain usable when changes are made) outside of a GH Actions environment.



---

archive/issue_comments_616854.json:
```json
{
    "body": "<a id='comment:39'></a>\nReplying to [gh-tobiasdiez](#comment%3A35):\n> A few remarks after skimming the changes:\n> \n> > +        PACKAGES=\"python38 python38-pip\"\n\n> \n> I think it's better to install python using the python action, which brings a few goodies along: https://github.com/marketplace/actions/setup-python\n\n\nThis is used in `choco install $PACKAGES --source cygwin` to install Cygwin and then these package in Cygwin.\n\nI don't think the setup-python action can do that.",
    "created_at": "2021-01-09T18:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616854",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'></a>
Replying to [gh-tobiasdiez](#comment%3A35):
> A few remarks after skimming the changes:
> 
> > +        PACKAGES="python38 python38-pip"

> 
> I think it's better to install python using the python action, which brings a few goodies along: https://github.com/marketplace/actions/setup-python


This is used in `choco install $PACKAGES --source cygwin` to install Cygwin and then these package in Cygwin.

I don't think the setup-python action can do that.



---

archive/issue_comments_616855.json:
```json
{
    "body": "<a id='comment:40'></a>\nThanks for the explanation. That's indeed something I understand and appreciate. My only problem is that managing the user system locally using tox is not very handy in my experience.\n\nHere is an example I was experiencing the last few hours:\nThe tox run encountered problems in the docbuild stage. The reason was/is a that ecl under wsl 1 has some problems and I needed to play around installing/deinstalling it combined with other changes. However, I couldn't use the tox command that the GH workflow uses since this installs ecl again. What I ended up doing was to copy & paste the commands printed by the tox run on github. That worked to some extend, but was a rather awful experience.\n\nI think it is good to have an easy way for developers to investigate problems in the GH workflow on their local system. And for this, it is in my opinion crucial that they can quickly recreate the state that is used. In my opinion a clearer separation in system-setup, build and test is helpful in this regard. If this can be done using tox, sure why not.",
    "created_at": "2021-01-09T18:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616855",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:40'></a>
Thanks for the explanation. That's indeed something I understand and appreciate. My only problem is that managing the user system locally using tox is not very handy in my experience.

Here is an example I was experiencing the last few hours:
The tox run encountered problems in the docbuild stage. The reason was/is a that ecl under wsl 1 has some problems and I needed to play around installing/deinstalling it combined with other changes. However, I couldn't use the tox command that the GH workflow uses since this installs ecl again. What I ended up doing was to copy & paste the commands printed by the tox run on github. That worked to some extend, but was a rather awful experience.

I think it is good to have an easy way for developers to investigate problems in the GH workflow on their local system. And for this, it is in my opinion crucial that they can quickly recreate the state that is used. In my opinion a clearer separation in system-setup, build and test is helpful in this regard. If this can be done using tox, sure why not.



---

archive/issue_comments_616856.json:
```json
{
    "body": "<a id='comment:41'></a>\nReplying to [gh-tobiasdiez](#comment%3A40):\n> managing the user system locally using tox is not very handy in my experience.\n\n\nRight. Managing the global installation of Cygwin is not the final form of this development. What I would actually prefer (but have not had time to figure out -- any help is welcome) is to have the `local-cygwin` tox environment make an isolated installation of Cygwin. (I do this for the `local-conda` and `local-homebrew` environments.)",
    "created_at": "2021-01-09T18:53:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616856",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>
Replying to [gh-tobiasdiez](#comment%3A40):
> managing the user system locally using tox is not very handy in my experience.


Right. Managing the global installation of Cygwin is not the final form of this development. What I would actually prefer (but have not had time to figure out -- any help is welcome) is to have the `local-cygwin` tox environment make an isolated installation of Cygwin. (I do this for the `local-conda` and `local-homebrew` environments.)



---

archive/issue_comments_616857.json:
```json
{
    "body": "<a id='comment:42'></a>\nReplying to [gh-tobiasdiez](#comment%3A40):\n> Here is an example I was experiencing the last few hours:\n> The tox run encountered problems in the docbuild stage. The reason was/is a that ecl under wsl 1 has some problems and I needed to play around installing/deinstalling it combined with other changes. However, I couldn't use the tox command that the GH workflow uses since this installs ecl again. What I ended up doing was to copy & paste the commands printed by the tox run on github. That worked to some extend, but was a rather awful experience.\n\n\nOK, I have run into this situation too. I think what is needed for the `local-...` environments is:\n- an environment variable that can be passed to tox to disable system package installs\n- a target or environment variable to give an interactive shell.\n\nI will open a ticket for this.",
    "created_at": "2021-01-09T19:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616857",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>
Replying to [gh-tobiasdiez](#comment%3A40):
> Here is an example I was experiencing the last few hours:
> The tox run encountered problems in the docbuild stage. The reason was/is a that ecl under wsl 1 has some problems and I needed to play around installing/deinstalling it combined with other changes. However, I couldn't use the tox command that the GH workflow uses since this installs ecl again. What I ended up doing was to copy & paste the commands printed by the tox run on github. That worked to some extend, but was a rather awful experience.


OK, I have run into this situation too. I think what is needed for the `local-...` environments is:
- an environment variable that can be passed to tox to disable system package installs
- a target or environment variable to give an interactive shell.

I will open a ticket for this.



---

archive/issue_comments_616858.json:
```json
{
    "body": "<a id='comment:43'></a>\nThat would also work, thanks! Please also give a thought to my suggestion to extract some of the scripts in tox.ini to scripts that can be called independently of tox.",
    "created_at": "2021-01-09T19:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616858",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:43'></a>
That would also work, thanks! Please also give a thought to my suggestion to extract some of the scripts in tox.ini to scripts that can be called independently of tox.



---

archive/issue_comments_616859.json:
```json
{
    "body": "<a id='comment:44'></a>\nThis is now #31216",
    "created_at": "2021-01-09T19:19:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616859",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'></a>
This is now #31216



---

archive/issue_comments_616860.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-01-09T19:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616860",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_616861.json:
```json
{
    "body": "<a id='comment:46'></a>\nReplying to [gh-tobiasdiez](#comment%3A43):\n> Please also give a thought to my suggestion to extract some of the scripts in tox.ini to scripts that can be called independently of tox.\n\n\nI see two directions of improvement here:\n- Moving stuff from `tox.ini` (for `tox -e local-...`) and `build/bin/write-dockerfile.sh` (for `tox -e docker-...`) into our top-level `Makefile`. For example, the complicated rule for the commands of `local` consists entirely of workarounds for things that should really be fixed/improved there.\n- Improving the system package information scripts such as `sage-print-system-package-command` further.\nMeta-ticket #29146 keeps track of such improvements, let's continue there.\n\nOn the other hand, I would be reluctant to add more scripts that developers can use to set up their system automatically. As I have written elsewhere, I think the current approach of printing command lines to educate developers about how to do things on their system is better for the Sage community than trying to provide scripts that do things automagically.",
    "created_at": "2021-01-10T00:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616861",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:46'></a>
Replying to [gh-tobiasdiez](#comment%3A43):
> Please also give a thought to my suggestion to extract some of the scripts in tox.ini to scripts that can be called independently of tox.


I see two directions of improvement here:
- Moving stuff from `tox.ini` (for `tox -e local-...`) and `build/bin/write-dockerfile.sh` (for `tox -e docker-...`) into our top-level `Makefile`. For example, the complicated rule for the commands of `local` consists entirely of workarounds for things that should really be fixed/improved there.
- Improving the system package information scripts such as `sage-print-system-package-command` further.
Meta-ticket #29146 keeps track of such improvements, let's continue there.

On the other hand, I would be reluctant to add more scripts that developers can use to set up their system automatically. As I have written elsewhere, I think the current approach of printing command lines to educate developers about how to do things on their system is better for the Sage community than trying to provide scripts that do things automagically.



---

archive/issue_comments_616862.json:
```json
{
    "body": "<a id='comment:47'></a>\nReplying to [mkoeppe](#comment%3A46):\n> I see two directions of improvement here: \n> Meta-ticket #29146 keeps track of such improvements, let's continue there.\n\n\nSounds good to me! Sorry for starting this somewhat off-topic discussion, but I very much appreciate your detailed explanations. It's always good to learn more about sage's inner workings ;-). I'll review this ticket as soon as the dependencies are merged (as it's hard to see right now which changes are coming from this ticket).",
    "created_at": "2021-01-10T12:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616862",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:47'></a>
Replying to [mkoeppe](#comment%3A46):
> I see two directions of improvement here: 
> Meta-ticket #29146 keeps track of such improvements, let's continue there.


Sounds good to me! Sorry for starting this somewhat off-topic discussion, but I very much appreciate your detailed explanations. It's always good to learn more about sage's inner workings ;-). I'll review this ticket as soon as the dependencies are merged (as it's hard to see right now which changes are coming from this ticket).



---

archive/issue_comments_616863.json:
```json
{
    "body": "<a id='comment:48'></a>\nGreat, and thanks for the discussion.",
    "created_at": "2021-01-10T18:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616863",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'></a>
Great, and thanks for the discussion.



---

archive/issue_comments_616864.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/actions/runs/434342215\" to \"Dima Pasechnik\".",
    "created_at": "2021-02-02T16:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616864",
    "user": "https://github.com/dimpase"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/actions/runs/434342215" to "Dima Pasechnik".



---

archive/issue_comments_616865.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-02-02T16:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616865",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_616866.json:
```json
{
    "body": "<a id='comment:49'></a>\nlgtm",
    "created_at": "2021-02-02T16:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616866",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:49'></a>
lgtm



---

archive/issue_comments_616867.json:
```json
{
    "body": "<a id='comment:50'></a>\nThank you!",
    "created_at": "2021-02-02T17:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616867",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'></a>
Thank you!



---

archive/issue_comments_616868.json:
```json
{
    "body": "<a id='comment:51'></a>\n**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/42f4458e3ae857f82759b3c9490ab34306a15f4d\">42f4458</a></td><td><code>Merge tag '9.3.beta7' into t/31064/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq</code></td></tr></table>\n",
    "created_at": "2021-02-07T20:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616868",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:51'></a>
**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/42f4458e3ae857f82759b3c9490ab34306a15f4d">42f4458</a></td><td><code>Merge tag '9.3.beta7' into t/31064/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq</code></td></tr></table>




---

archive/issue_comments_616869.json:
```json
{
    "body": "**Changing status** from positive_review to needs_review.",
    "created_at": "2021-02-07T20:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616869",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing status** from positive_review to needs_review.



---

archive/issue_comments_616870.json:
```json
{
    "body": "**Changing commit** from \"[a5e405116fa41c9afb3c5f46fbde2489616d267f](https://github.com/sagemath/sagetrac-mirror/commit/a5e405116fa41c9afb3c5f46fbde2489616d267f)\" to \"[42f4458e3ae857f82759b3c9490ab34306a15f4d](https://github.com/sagemath/sagetrac-mirror/commit/42f4458e3ae857f82759b3c9490ab34306a15f4d)\".",
    "created_at": "2021-02-07T20:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616870",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a5e405116fa41c9afb3c5f46fbde2489616d267f](https://github.com/sagemath/sagetrac-mirror/commit/a5e405116fa41c9afb3c5f46fbde2489616d267f)" to "[42f4458e3ae857f82759b3c9490ab34306a15f4d](https://github.com/sagemath/sagetrac-mirror/commit/42f4458e3ae857f82759b3c9490ab34306a15f4d)".



---

archive/issue_comments_616871.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-02-07T20:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616871",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_616872.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq)\" to \"[42f4458e3ae857f82759b3c9490ab34306a15f4d](https://github.com/sagemath/sagetrac-mirror/commit/42f4458e3ae857f82759b3c9490ab34306a15f4d)\".",
    "created_at": "2021-02-20T10:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616872",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ci_cygwin__yml__adjust_to_new_script_packages__bootstrap___prereq)" to "[42f4458e3ae857f82759b3c9490ab34306a15f4d](https://github.com/sagemath/sagetrac-mirror/commit/42f4458e3ae857f82759b3c9490ab34306a15f4d)".



---

archive/issue_comments_616873.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2021-02-20T10:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31064#issuecomment-616873",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_events_091371.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-02-20T10:46:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31064",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31064#event-91371"
}
```
