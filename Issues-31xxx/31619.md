# Issue 31619: Cholesky factorization and positive-definite testing over inexact rings

archive/issues_031382.json:
```json
{
    "body": "As promised in #13674, I refactor some things to support `cholesky()` and `is_positive_definite()` over inexact rings. The main idea is to use the `block_ldlt()` method that supports inexact rings instead of `indefinite_factorization()` which does not.\n\nControversial bits:\n\n1. The `certificate` argument to `is_positive_definite()` has been removed. This lets us unify the interface and implementation with `is_positive_semidefinite()`. If the user wants the factorization (which is all the certificate was), he can still ask for it directly.\n\n2. I've left the `indefinite_factorization` method alone even though it is largely superseded by `block_ldlt(classical=True)`. Does anyone want to factorize complex matrices that are symmetric but not hermitian? How about symmetric matrices over finite fields where \"conjugate\" is meaningless? If not, we could deprecate/remove `indefinite_factorization()`. But I know little about what people do with matrices over finite fields.\n\n3. I've declared that every constant, non-relational symbolic expression is a square in `SR`. This is not really principled; it just sounds true, and makes `cholesky()` work with symbolic matrices whose entries are \"numbers\".\n\n\nCC:  @dimpase @videlec @rbeezer @mwageringel @mezzarobba\n\nBranch/Commit: 8986d7cc441c9876c58910873c048849564706b1\n\nReviewer: Travis Scrimshaw, Dima Pasechnik\n\nAuthor: Michael Orlitzky\n\nDependencies: #31808\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31619\n\n",
    "closed_at": "2021-06-06T13:18:19Z",
    "created_at": "2021-04-08T13:09:03Z",
    "labels": [
        "component: linear algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Cholesky factorization and positive-definite testing over inexact rings",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31619",
    "user": "https://github.com/orlitzky"
}
```
As promised in #13674, I refactor some things to support `cholesky()` and `is_positive_definite()` over inexact rings. The main idea is to use the `block_ldlt()` method that supports inexact rings instead of `indefinite_factorization()` which does not.

Controversial bits:

1. The `certificate` argument to `is_positive_definite()` has been removed. This lets us unify the interface and implementation with `is_positive_semidefinite()`. If the user wants the factorization (which is all the certificate was), he can still ask for it directly.

2. I've left the `indefinite_factorization` method alone even though it is largely superseded by `block_ldlt(classical=True)`. Does anyone want to factorize complex matrices that are symmetric but not hermitian? How about symmetric matrices over finite fields where "conjugate" is meaningless? If not, we could deprecate/remove `indefinite_factorization()`. But I know little about what people do with matrices over finite fields.

3. I've declared that every constant, non-relational symbolic expression is a square in `SR`. This is not really principled; it just sounds true, and makes `cholesky()` work with symbolic matrices whose entries are "numbers".


CC:  @dimpase @videlec @rbeezer @mwageringel @mezzarobba

Branch/Commit: 8986d7cc441c9876c58910873c048849564706b1

Reviewer: Travis Scrimshaw, Dima Pasechnik

Author: Michael Orlitzky

Dependencies: #31808

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31619





---

archive/issue_comments_629259.json:
```json
{
    "body": "<a id='comment:1'></a>\nI still need to go through the documentation carefully, but any early feedback would be welcome.",
    "created_at": "2021-04-08T13:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629259",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:1'></a>
I still need to go through the documentation carefully, but any early feedback would be welcome.



---

archive/issue_comments_629260.json:
```json
{
    "body": "Changing commit from \"\" to \"36b53ced10bd195e038323a713964a6a9d6bbe28\"",
    "created_at": "2021-04-08T13:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629260",
    "user": "https://github.com/orlitzky"
}
```

Changing commit from "" to "36b53ced10bd195e038323a713964a6a9d6bbe28"



---

archive/issue_comments_629261.json:
```json
{
    "body": "Changing author from \"\" to \"Michael Orlitzky\"",
    "created_at": "2021-04-08T13:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629261",
    "user": "https://github.com/orlitzky"
}
```

Changing author from "" to "Michael Orlitzky"



---

archive/issue_comments_629262.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mjo/ticket/31619\"",
    "created_at": "2021-04-08T13:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629262",
    "user": "https://github.com/orlitzky"
}
```

Changing branch from "" to "u/mjo/ticket/31619"



---

archive/issue_comments_629263.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-04-08T13:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629263",
    "user": "https://github.com/orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_629264.json:
```json
{
    "body": "<a id='comment:2'></a>\nI am not sure about dropping the `certificate` from `is_positive_definite()`. I would lean towards adding one for `is_positive_semidefinite()` to make it consistent. At the very least, it will require a deprecation.\n\nI cannot comment on 2 or 3.\n\nI would change this block:\n\n```\n-        for d_i in d:\n-            if d_i.nrows() == 1:\n-                if semi:\n-                    if d_i < 0:\n-                        return False\n-                else:\n-                    if d_i <= 0:\n-                        return False\n-            else:\n-                # There's a 2x2 block\n-                return False\n-        return True\n+        if semi:\n+            return not any(d_i.nrows() > 1 or d_i < 0 for d_i in d)\n+        else:\n+            return not any(d_i.nrows() > 1 or d_i <= 0 for d_i in d)\n```\nAlso, would it be better to do `d_i[0,0]` so the actual entry is checked? Another alternative would be\n\n```\nreturn all(d_i.nrows() == 1 and d_i >= 0 for d_i in d)\n```\nand similarly for the positive definite case. IMO this is a more clear than the negative test.",
    "created_at": "2021-04-11T23:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629264",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>
I am not sure about dropping the `certificate` from `is_positive_definite()`. I would lean towards adding one for `is_positive_semidefinite()` to make it consistent. At the very least, it will require a deprecation.

I cannot comment on 2 or 3.

I would change this block:

```
-        for d_i in d:
-            if d_i.nrows() == 1:
-                if semi:
-                    if d_i < 0:
-                        return False
-                else:
-                    if d_i <= 0:
-                        return False
-            else:
-                # There's a 2x2 block
-                return False
-        return True
+        if semi:
+            return not any(d_i.nrows() > 1 or d_i < 0 for d_i in d)
+        else:
+            return not any(d_i.nrows() > 1 or d_i <= 0 for d_i in d)
```
Also, would it be better to do `d_i[0,0]` so the actual entry is checked? Another alternative would be

```
return all(d_i.nrows() == 1 and d_i >= 0 for d_i in d)
```
and similarly for the positive definite case. IMO this is a more clear than the negative test.



---

archive/issue_comments_629265.json:
```json
{
    "body": "<a id='comment:3'></a>\n2 - factorising symmetrical complex matrices might make sense over exact fields.\n\nFor finite fields conjugate often makes sense, e.g. if characteristic is p then taking p-th power is a field automorphism.",
    "created_at": "2021-04-12T00:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629265",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>
2 - factorising symmetrical complex matrices might make sense over exact fields.

For finite fields conjugate often makes sense, e.g. if characteristic is p then taking p-th power is a field automorphism.



---

archive/issue_comments_629266.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [tscrim](#comment%3A2):\n> I am not sure about dropping the `certificate` from `is_positive_definite()`. I would lean towards adding one for `is_positive_semidefinite()` to make it consistent. At the very least, it will require a deprecation.\n> \n\n\nThe real problem here is that `certificate` is returning an implementation detail, namely the `indefinite_factorization()` that was computed to check the eigenvalues.In order to make `is_positive_definite()` numerically stable, I've already changed that implementation detail -- there's no indefinite factorization to return. I could return the `block_ldlt()` factorization, but if anyone is actually using the certificate, that's still going to mess them up. So the interface is broken either way. (And if no one was using `certificate`, it makes a lot more sense in the future for users to compute the factorization themselves.)\n\nA related problem is that the `certificate` argument to the superclass method can't always be honored in subclasses. There is no `certificate` argument for `RDF` or `CDF` matrices, for example. If `is_positive_definite()` is ever implemented for some other subclass using a C library, that C library is certainly not going to return an `indefinite_factorization()`, so what can we do if the user wants a certificate?\n\nIf we have to deprecate it first, then we have to continue using `indefinite_factorization()`, which means we can't make it numerically stable (or work with rings like `SR` and `RR`) until the deprecation period is over.",
    "created_at": "2021-04-14T13:13:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629266",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:4'></a>
Replying to [tscrim](#comment%3A2):
> I am not sure about dropping the `certificate` from `is_positive_definite()`. I would lean towards adding one for `is_positive_semidefinite()` to make it consistent. At the very least, it will require a deprecation.
> 


The real problem here is that `certificate` is returning an implementation detail, namely the `indefinite_factorization()` that was computed to check the eigenvalues.In order to make `is_positive_definite()` numerically stable, I've already changed that implementation detail -- there's no indefinite factorization to return. I could return the `block_ldlt()` factorization, but if anyone is actually using the certificate, that's still going to mess them up. So the interface is broken either way. (And if no one was using `certificate`, it makes a lot more sense in the future for users to compute the factorization themselves.)

A related problem is that the `certificate` argument to the superclass method can't always be honored in subclasses. There is no `certificate` argument for `RDF` or `CDF` matrices, for example. If `is_positive_definite()` is ever implemented for some other subclass using a C library, that C library is certainly not going to return an `indefinite_factorization()`, so what can we do if the user wants a certificate?

If we have to deprecate it first, then we have to continue using `indefinite_factorization()`, which means we can't make it numerically stable (or work with rings like `SR` and `RR`) until the deprecation period is over.



---

archive/issue_comments_629267.json:
```json
{
    "body": "<a id='comment:5'></a>\nI would not be worried about `certificate`. The existing functionality is next to useless, so I don't expect any real uses out there.",
    "created_at": "2021-04-14T13:48:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629267",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
I would not be worried about `certificate`. The existing functionality is next to useless, so I don't expect any real uses out there.



---

archive/issue_comments_629268.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|\n|[527dd57](https://github.com/sagemath/sagetrac-mirror/commit/527dd57bbe91f2501b5fd5eea91a123b23bc9735)|`Trac #31619: clarify matrix _is_positive_definite_or_semidefinite().`|",
    "created_at": "2021-04-15T01:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629268",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|
|[527dd57](https://github.com/sagemath/sagetrac-mirror/commit/527dd57bbe91f2501b5fd5eea91a123b23bc9735)|`Trac #31619: clarify matrix _is_positive_definite_or_semidefinite().`|



---

archive/issue_comments_629269.json:
```json
{
    "body": "Changing commit from \"36b53ced10bd195e038323a713964a6a9d6bbe28\" to \"527dd57bbe91f2501b5fd5eea91a123b23bc9735\"",
    "created_at": "2021-04-15T01:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629269",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "36b53ced10bd195e038323a713964a6a9d6bbe28" to "527dd57bbe91f2501b5fd5eea91a123b23bc9735"



---

archive/issue_comments_629270.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [tscrim](#comment%3A2):\n>\n> Also, would it be better to do `d_i[0,0]` so the actual entry is checked?\n\n\nThat wasn't intentional so I'm glad you noticed it.\n\n\n> Another alternative would be\n> \n> ```\n> return all(d_i.nrows() == 1 and d_i >= 0 for d_i in d)\n> ```\n> and similarly for the positive definite case. IMO this is a more clear than the negative test.\n\n\nI went one further and replaced this with\n\n```python\n       import operator\n       op = operator.gt\n       if semi:\n           op = operator.ge\n       return all(d_i.nrows() == 1 and op(d_i[0,0], 0) for d_i in d)\n```\n\nto minimize duplication. It's a lot clearer now, thanks.",
    "created_at": "2021-04-15T01:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629270",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:7'></a>
Replying to [tscrim](#comment%3A2):
>
> Also, would it be better to do `d_i[0,0]` so the actual entry is checked?


That wasn't intentional so I'm glad you noticed it.


> Another alternative would be
> 
> ```
> return all(d_i.nrows() == 1 and d_i >= 0 for d_i in d)
> ```
> and similarly for the positive definite case. IMO this is a more clear than the negative test.


I went one further and replaced this with

```python
       import operator
       op = operator.gt
       if semi:
           op = operator.ge
       return all(d_i.nrows() == 1 and op(d_i[0,0], 0) for d_i in d)
```

to minimize duplication. It's a lot clearer now, thanks.



---

archive/issue_comments_629271.json:
```json
{
    "body": "<a id='comment:8'></a>\nOkay, I agree that we should remove the certificate. I would suggest making the `certificate=True` return a pair as before, but just return the `block_ldlt()` as the certificate with the deprecation message saying we changed. This is at least the minimal breakage and intrusive change to the current branch. How does that sound?",
    "created_at": "2021-04-15T07:28:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629271",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
Okay, I agree that we should remove the certificate. I would suggest making the `certificate=True` return a pair as before, but just return the `block_ldlt()` as the certificate with the deprecation message saying we changed. This is at least the minimal breakage and intrusive change to the current branch. How does that sound?



---

archive/issue_comments_629272.json:
```json
{
    "body": "Changing commit from \"527dd57bbe91f2501b5fd5eea91a123b23bc9735\" to \"ec32dead7bfdff03a0d69a731449bce950cf8c78\"",
    "created_at": "2021-04-27T00:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629272",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "527dd57bbe91f2501b5fd5eea91a123b23bc9735" to "ec32dead7bfdff03a0d69a731449bce950cf8c78"



---

archive/issue_comments_629273.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n|                                                                                                                                           |                                                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|\n|[e9d434d](https://github.com/sagemath/sagetrac-mirror/commit/e9d434d9b4975a5cad7c6c6f27e7d74c3f8d8ca5)|`Trac #31619: add \"classical\" argument to matrix block_ldlt().`|\n|[7fa50ba](https://github.com/sagemath/sagetrac-mirror/commit/7fa50ba5be99e75bfa2158ef5dbb8f7f3aa510cb)|`Trac #31619: use block_ldlt() for inverse_positive_definite().`|\n|[14b3be3](https://github.com/sagemath/sagetrac-mirror/commit/14b3be31497b47f096f4f3bb9f70455069c5ebc4)|`Trac #31619: support is_square() for constant non-relational expressions.`|\n|[538681d](https://github.com/sagemath/sagetrac-mirror/commit/538681d87dd2844574edb4a3dbc9c8ea09806873)|`Trac #31619: implement cholesky() using block_ldlt().`|\n|[085b5bb](https://github.com/sagemath/sagetrac-mirror/commit/085b5bb4a4eea204fc70116659026ca7b3b13a46)|`Trac #31619: cache the result of _block_ldlt().`|\n|[ba37459](https://github.com/sagemath/sagetrac-mirror/commit/ba37459dbf2c66bcb7eeb93cf3859bd020237209)|`Trac #31619: make _block_ldlt() a C method.`|\n|[f673b5c](https://github.com/sagemath/sagetrac-mirror/commit/f673b5c242a2b83fabc1a5273aa822f5a526015e)|`Trac #31619: clarify matrix _is_positive_definite_or_semidefinite().`|\n|[0ee32f7](https://github.com/sagemath/sagetrac-mirror/commit/0ee32f71a0a911ee42a8d40c9ddc3d73a1175325)|`Trac #31619: clean up documentation for is_positive_definite().`|\n|[8ed1c44](https://github.com/sagemath/sagetrac-mirror/commit/8ed1c44a56125dd9c2800051356aaf9ac4916f44)|`Trac #31619: clean up cholesky() documentation.`|\n|[ec32dea](https://github.com/sagemath/sagetrac-mirror/commit/ec32dead7bfdff03a0d69a731449bce950cf8c78)|`Trac #31619: replace is_positive_definite(certificate=True).`|",
    "created_at": "2021-04-27T00:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629273",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
|                                                                                                                                           |                                                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|
|[e9d434d](https://github.com/sagemath/sagetrac-mirror/commit/e9d434d9b4975a5cad7c6c6f27e7d74c3f8d8ca5)|`Trac #31619: add "classical" argument to matrix block_ldlt().`|
|[7fa50ba](https://github.com/sagemath/sagetrac-mirror/commit/7fa50ba5be99e75bfa2158ef5dbb8f7f3aa510cb)|`Trac #31619: use block_ldlt() for inverse_positive_definite().`|
|[14b3be3](https://github.com/sagemath/sagetrac-mirror/commit/14b3be31497b47f096f4f3bb9f70455069c5ebc4)|`Trac #31619: support is_square() for constant non-relational expressions.`|
|[538681d](https://github.com/sagemath/sagetrac-mirror/commit/538681d87dd2844574edb4a3dbc9c8ea09806873)|`Trac #31619: implement cholesky() using block_ldlt().`|
|[085b5bb](https://github.com/sagemath/sagetrac-mirror/commit/085b5bb4a4eea204fc70116659026ca7b3b13a46)|`Trac #31619: cache the result of _block_ldlt().`|
|[ba37459](https://github.com/sagemath/sagetrac-mirror/commit/ba37459dbf2c66bcb7eeb93cf3859bd020237209)|`Trac #31619: make _block_ldlt() a C method.`|
|[f673b5c](https://github.com/sagemath/sagetrac-mirror/commit/f673b5c242a2b83fabc1a5273aa822f5a526015e)|`Trac #31619: clarify matrix _is_positive_definite_or_semidefinite().`|
|[0ee32f7](https://github.com/sagemath/sagetrac-mirror/commit/0ee32f71a0a911ee42a8d40c9ddc3d73a1175325)|`Trac #31619: clean up documentation for is_positive_definite().`|
|[8ed1c44](https://github.com/sagemath/sagetrac-mirror/commit/8ed1c44a56125dd9c2800051356aaf9ac4916f44)|`Trac #31619: clean up cholesky() documentation.`|
|[ec32dea](https://github.com/sagemath/sagetrac-mirror/commit/ec32dead7bfdff03a0d69a731449bce950cf8c78)|`Trac #31619: replace is_positive_definite(certificate=True).`|



---

archive/issue_comments_629274.json:
```json
{
    "body": "<a id='comment:10'></a>\nMaking this depend on #31594 so that I don't have to rebuild the copy of giac I already have installed.",
    "created_at": "2021-04-27T00:04:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629274",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:10'></a>
Making this depend on #31594 so that I don't have to rebuild the copy of giac I already have installed.



---

archive/issue_comments_629275.json:
```json
{
    "body": "Changing dependencies from \"\" to \"31594\"",
    "created_at": "2021-04-27T00:04:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629275",
    "user": "https://github.com/orlitzky"
}
```

Changing dependencies from "" to "31594"



---

archive/issue_comments_629276.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [tscrim](#comment%3A8):\n> Okay, I agree that we should remove the certificate. I would suggest making the `certificate=True` return a pair as before, but just return the `block_ldlt()` as the certificate with the deprecation message saying we changed. This is at least the minimal breakage and intrusive change to the current branch. How does that sound?\n\n\nI don't really like it, but I've added a commit that implements this to minimize the amount of back-and-forth that we have to do. I feel like a two-stage deprecation/removal cycle is just going to annoy people *twice* -- once when the format of the certificate changes on them, and then again when it goes away for real.\n\nI've also finally taken the time to go over the documentation of `is_positive_definite()` and `cholesky()`, updated in two new commits.",
    "created_at": "2021-04-27T00:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629276",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:11'></a>
Replying to [tscrim](#comment%3A8):
> Okay, I agree that we should remove the certificate. I would suggest making the `certificate=True` return a pair as before, but just return the `block_ldlt()` as the certificate with the deprecation message saying we changed. This is at least the minimal breakage and intrusive change to the current branch. How does that sound?


I don't really like it, but I've added a commit that implements this to minimize the amount of back-and-forth that we have to do. I feel like a two-stage deprecation/removal cycle is just going to annoy people *twice* -- once when the format of the certificate changes on them, and then again when it goes away for real.

I've also finally taken the time to go over the documentation of `is_positive_definite()` and `cholesky()`, updated in two new commits.



---

archive/issue_comments_629277.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [dimpase](#comment%3A3):\n> 2 - factorising symmetrical complex matrices might make sense over exact fields.\n> \n> For finite fields conjugate often makes sense, e.g. if characteristic is p then taking p-th power is a field automorphism.\n> \n\n\nI'm not sure what to do about this. I agree that it makes sense, but I really don't want to make  `block_ldlt()` as awkward as `indefinite_factorization()` without a good reason.",
    "created_at": "2021-04-27T00:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629277",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:12'></a>
Replying to [dimpase](#comment%3A3):
> 2 - factorising symmetrical complex matrices might make sense over exact fields.
> 
> For finite fields conjugate often makes sense, e.g. if characteristic is p then taking p-th power is a field automorphism.
> 


I'm not sure what to do about this. I agree that it makes sense, but I really don't want to make  `block_ldlt()` as awkward as `indefinite_factorization()` without a good reason.



---

archive/issue_comments_629278.json:
```json
{
    "body": "<a id='comment:13'></a>\n`block_ldlt()` does work with many finite fields... the only issue is that you can't force it to use the standard transpose when the conjugate-transpose doesn't exist (when there's no `conjugate()` in the field).",
    "created_at": "2021-04-27T00:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629278",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:13'></a>
`block_ldlt()` does work with many finite fields... the only issue is that you can't force it to use the standard transpose when the conjugate-transpose doesn't exist (when there's no `conjugate()` in the field).



---

archive/issue_comments_629279.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [mjo](#comment%3A11):\n> Replying to [tscrim](#comment%3A8):\n> > Okay, I agree that we should remove the certificate. I would suggest making the `certificate=True` return a pair as before, but just return the `block_ldlt()` as the certificate with the deprecation message saying we changed. This is at least the minimal breakage and intrusive change to the current branch. How does that sound?\n\n> \n> I don't really like it, but I've added a commit that implements this to minimize the amount of back-and-forth that we have to do. I feel like a two-stage deprecation/removal cycle is just going to annoy people *twice* -- once when the format of the certificate changes on them, and then again when it goes away for real.\n\n\nThank you. If they get annoyed twice, then they didn't read the deprecation message and it is their own fault IMO.\n\nI am happy with the current patch. Dima, how about you? (If I really wanted to quibble, we could change the `Returns` -> `Return` in `cholesky()` since we are modifying its docstring anyways. However, that can be done only if there is another commit.)",
    "created_at": "2021-04-28T02:32:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629279",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>
Replying to [mjo](#comment%3A11):
> Replying to [tscrim](#comment%3A8):
> > Okay, I agree that we should remove the certificate. I would suggest making the `certificate=True` return a pair as before, but just return the `block_ldlt()` as the certificate with the deprecation message saying we changed. This is at least the minimal breakage and intrusive change to the current branch. How does that sound?

> 
> I don't really like it, but I've added a commit that implements this to minimize the amount of back-and-forth that we have to do. I feel like a two-stage deprecation/removal cycle is just going to annoy people *twice* -- once when the format of the certificate changes on them, and then again when it goes away for real.


Thank you. If they get annoyed twice, then they didn't read the deprecation message and it is their own fault IMO.

I am happy with the current patch. Dima, how about you? (If I really wanted to quibble, we could change the `Returns` -> `Return` in `cholesky()` since we are modifying its docstring anyways. However, that can be done only if there is another commit.)



---

archive/issue_comments_629280.json:
```json
{
    "body": "Changing dependencies from \"31594\" to \"#31594\"",
    "created_at": "2021-04-28T02:32:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629280",
    "user": "https://github.com/tscrim"
}
```

Changing dependencies from "31594" to "#31594"



---

archive/issue_comments_629281.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2021-04-28T02:32:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629281",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_629282.json:
```json
{
    "body": "Changing reviewer from \"Travis Scrimshaw\" to \"Travis Scrimshaw, Dima Pasechnik\"",
    "created_at": "2021-04-28T17:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629282",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "Travis Scrimshaw" to "Travis Scrimshaw, Dima Pasechnik"



---

archive/issue_comments_629283.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-04-28T17:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629283",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_629284.json:
```json
{
    "body": "<a id='comment:15'></a>\nlgtm",
    "created_at": "2021-04-28T17:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629284",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>
lgtm



---

archive/issue_comments_629285.json:
```json
{
    "body": "<a id='comment:16'></a>\nThanks!",
    "created_at": "2021-04-29T00:28:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629285",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:16'></a>
Thanks!



---

archive/issue_events_093693.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-08T16:08:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31619#event-93693"
}
```



---

archive/issue_comments_629286.json:
```json
{
    "body": "Changing commit from \"ec32dead7bfdff03a0d69a731449bce950cf8c78\" to \"8986d7cc441c9876c58910873c048849564706b1\"",
    "created_at": "2021-05-09T11:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629286",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ec32dead7bfdff03a0d69a731449bce950cf8c78" to "8986d7cc441c9876c58910873c048849564706b1"



---

archive/issue_comments_629287.json:
```json
{
    "body": "<a id='comment:18'></a>\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. Last 10 new commits:\n|                                                                                                                                           |                                                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|\n|[25f1588](https://github.com/sagemath/sagetrac-mirror/commit/25f1588022beb67cab4bcb3631979726d2d2d6a5)|`Trac #31619: add \"classical\" argument to matrix block_ldlt().`|\n|[2af6d9d](https://github.com/sagemath/sagetrac-mirror/commit/2af6d9d2e6883697429c48bd59718e20e5bdd07e)|`Trac #31619: use block_ldlt() for inverse_positive_definite().`|\n|[e5adbac](https://github.com/sagemath/sagetrac-mirror/commit/e5adbac3780fd965a0fb4f40edf2b7061ef80fae)|`Trac #31619: support is_square() for constant non-relational expressions.`|\n|[5ac2754](https://github.com/sagemath/sagetrac-mirror/commit/5ac2754ea9354a7f8e2edf39890c52b5ebbf8465)|`Trac #31619: implement cholesky() using block_ldlt().`|\n|[7d40c7e](https://github.com/sagemath/sagetrac-mirror/commit/7d40c7e0959ceaa616809b0b4513ee003f0bd934)|`Trac #31619: cache the result of _block_ldlt().`|\n|[6994645](https://github.com/sagemath/sagetrac-mirror/commit/69946458bc2cecb1a0e3df62586375793bd87f1b)|`Trac #31619: make _block_ldlt() a C method.`|\n|[8ba2be7](https://github.com/sagemath/sagetrac-mirror/commit/8ba2be7faa15232232e04c54adc449f06e14b9fb)|`Trac #31619: clarify matrix _is_positive_definite_or_semidefinite().`|\n|[4a883de](https://github.com/sagemath/sagetrac-mirror/commit/4a883de3e231dd74257d96bad767aaa3e44ebe57)|`Trac #31619: clean up documentation for is_positive_definite().`|\n|[63e26e4](https://github.com/sagemath/sagetrac-mirror/commit/63e26e49c68072d814850be40ce12e88f2c1922d)|`Trac #31619: clean up cholesky() documentation.`|\n|[8986d7c](https://github.com/sagemath/sagetrac-mirror/commit/8986d7cc441c9876c58910873c048849564706b1)|`Trac #31619: replace is_positive_definite(certificate=True).`|",
    "created_at": "2021-05-09T11:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629287",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. Last 10 new commits:
|                                                                                                                                           |                                                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|
|[25f1588](https://github.com/sagemath/sagetrac-mirror/commit/25f1588022beb67cab4bcb3631979726d2d2d6a5)|`Trac #31619: add "classical" argument to matrix block_ldlt().`|
|[2af6d9d](https://github.com/sagemath/sagetrac-mirror/commit/2af6d9d2e6883697429c48bd59718e20e5bdd07e)|`Trac #31619: use block_ldlt() for inverse_positive_definite().`|
|[e5adbac](https://github.com/sagemath/sagetrac-mirror/commit/e5adbac3780fd965a0fb4f40edf2b7061ef80fae)|`Trac #31619: support is_square() for constant non-relational expressions.`|
|[5ac2754](https://github.com/sagemath/sagetrac-mirror/commit/5ac2754ea9354a7f8e2edf39890c52b5ebbf8465)|`Trac #31619: implement cholesky() using block_ldlt().`|
|[7d40c7e](https://github.com/sagemath/sagetrac-mirror/commit/7d40c7e0959ceaa616809b0b4513ee003f0bd934)|`Trac #31619: cache the result of _block_ldlt().`|
|[6994645](https://github.com/sagemath/sagetrac-mirror/commit/69946458bc2cecb1a0e3df62586375793bd87f1b)|`Trac #31619: make _block_ldlt() a C method.`|
|[8ba2be7](https://github.com/sagemath/sagetrac-mirror/commit/8ba2be7faa15232232e04c54adc449f06e14b9fb)|`Trac #31619: clarify matrix _is_positive_definite_or_semidefinite().`|
|[4a883de](https://github.com/sagemath/sagetrac-mirror/commit/4a883de3e231dd74257d96bad767aaa3e44ebe57)|`Trac #31619: clean up documentation for is_positive_definite().`|
|[63e26e4](https://github.com/sagemath/sagetrac-mirror/commit/63e26e49c68072d814850be40ce12e88f2c1922d)|`Trac #31619: clean up cholesky() documentation.`|
|[8986d7c](https://github.com/sagemath/sagetrac-mirror/commit/8986d7cc441c9876c58910873c048849564706b1)|`Trac #31619: replace is_positive_definite(certificate=True).`|



---

archive/issue_comments_629288.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-05-09T11:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629288",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_629289.json:
```json
{
    "body": "Changing dependencies from \"#31594\" to \"\"",
    "created_at": "2021-05-09T11:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629289",
    "user": "https://github.com/orlitzky"
}
```

Changing dependencies from "#31594" to ""



---

archive/issue_comments_629290.json:
```json
{
    "body": "<a id='comment:19'></a>\nI dropped the dependency on #31594 because new (impossible to detect) giac versions are going to break some tests.",
    "created_at": "2021-05-09T11:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629290",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:19'></a>
I dropped the dependency on #31594 because new (impossible to detect) giac versions are going to break some tests.



---

archive/issue_comments_629291.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-05-11T00:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629291",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_629292.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-05-11T00:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629292",
    "user": "https://github.com/tscrim"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_629293.json:
```json
{
    "body": "<a id='comment:21'></a>\nSorry, I was too quick. Looks like there is an issue on 9.3.rc5 (that was not on 9.3.rc4) with the matrix constructed in line  12338, which causes the subsequent failures. This was almost certainly caused by #31628.",
    "created_at": "2021-05-11T00:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629293",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>
Sorry, I was too quick. Looks like there is an issue on 9.3.rc5 (that was not on 9.3.rc4) with the matrix constructed in line  12338, which causes the subsequent failures. This was almost certainly caused by #31628.



---

archive/issue_comments_629294.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-05-11T00:39:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629294",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_629295.json:
```json
{
    "body": "<a id='comment:22'></a>\nThe issue is from #31808. So this ticket is good, but we need to solve #31808 before this is merged.",
    "created_at": "2021-05-11T00:39:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629295",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:22'></a>
The issue is from #31808. So this ticket is good, but we need to solve #31808 before this is merged.



---

archive/issue_comments_629296.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#31808\"",
    "created_at": "2021-05-11T00:39:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629296",
    "user": "https://github.com/tscrim"
}
```

Changing dependencies from "" to "#31808"



---

archive/issue_comments_629297.json:
```json
{
    "body": "<a id='comment:23'></a>\nThanks for taking care of that! The giac issues should now also be fixed, but there's no reason to mess with this ticket further.",
    "created_at": "2021-05-11T14:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629297",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:23'></a>
Thanks for taking care of that! The giac issues should now also be fixed, but there's no reason to mess with this ticket further.



---

archive/issue_comments_629298.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-06-06T13:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629298",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_093694.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-06T13:18:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31619#event-93694"
}
```



---

archive/issue_comments_629299.json:
```json
{
    "body": "Changing branch from \"u/mjo/ticket/31619\" to \"8986d7cc441c9876c58910873c048849564706b1\"",
    "created_at": "2021-06-06T13:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31619#issuecomment-629299",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mjo/ticket/31619" to "8986d7cc441c9876c58910873c048849564706b1"
