# Issue 31053: MR49: Register sorted dict pprinter earlier in doctest forker

archive/issues_030816.json:
```json
{
    "body": "Mauricio Collares ([`@`collares](https://gitlab.com/collares)) opened a merge request at https://gitlab.com/sagemath/sage/-/merge_requests/49:\n\n---\n\n```markdown\nCurrently, the pprinter gets registered after controller.load_environment(). This is fine if a lazy import cache exists in ~/.sage/cache, because in this case sandpile.py doesn't get immediately executed. However, if there's no such cache, then the line\n\n```\npretty.for_type(SandpileConfig, pretty.for_type(dict, None))\n```\n\nin sandpiles.py gets to run before the new dict pretty printer gets registered, causing the unsorted pretty printer to be registered for SandpileConfig (and similarly for SandpileDivisor). This leads to test failures in the absence of the lazy import cache.\n```\n\n\nReviewer: Dima Pasechnik\n\nAuthor: Mauricio Collares\n\nBranch: d658230ce06ca19f4a3b3a4576297ee82f2d2151\n\nCommit: d658230ce06ca19f4a3b3a4576297ee82f2d2151\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31053\n\n",
    "closed_at": "2021-01-03T12:15:33Z",
    "created_at": "2020-12-15T16:28:07Z",
    "labels": [
        "component: doctest framework",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "MR49: Register sorted dict pprinter earlier in doctest forker",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31053",
    "user": "https://trac.sagemath.org/admin/accounts/users/galois"
}
```
Mauricio Collares ([`@`collares](https://gitlab.com/collares)) opened a merge request at https://gitlab.com/sagemath/sage/-/merge_requests/49:

---

```markdown
Currently, the pprinter gets registered after controller.load_environment(). This is fine if a lazy import cache exists in ~/.sage/cache, because in this case sandpile.py doesn't get immediately executed. However, if there's no such cache, then the line

```
pretty.for_type(SandpileConfig, pretty.for_type(dict, None))
```

in sandpiles.py gets to run before the new dict pretty printer gets registered, causing the unsorted pretty printer to be registered for SandpileConfig (and similarly for SandpileDivisor). This leads to test failures in the absence of the lazy import cache.
```


Reviewer: Dima Pasechnik

Author: Mauricio Collares

Branch: d658230ce06ca19f4a3b3a4576297ee82f2d2151

Commit: d658230ce06ca19f4a3b3a4576297ee82f2d2151

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31053





---

archive/issue_comments_439988.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to doctest framework.",
    "created_at": "2021-01-02T10:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31053#issuecomment-439988",
    "user": "https://github.com/dimpase"
}
```

Changing component from PLEASE CHANGE to doctest framework.



---

archive/issue_comments_439989.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2021-01-02T10:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31053#issuecomment-439989",
    "user": "https://github.com/dimpase"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_439990.json:
```json
{
    "body": "<a id='comment:2'></a>Good catch. LGTM",
    "created_at": "2021-01-02T10:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31053#issuecomment-439990",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>Good catch. LGTM



---

archive/issue_comments_439991.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-01-02T10:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31053#issuecomment-439991",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_439992.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-01-03T12:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31053#issuecomment-439992",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_081090.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-01-03T12:15:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31053",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31053#event-81090"
}
```
