# Issue 31565: Build still non-portable despite SAGE_FAT_BINARY=yes because of numpy

archive/issues_031328.json:
```json
{
    "body": "Follow-up from #29537, #31521.\n\nObserved on `cygwin-standard` but likely also affects the Docker images and the Sage binary distribution.\n\nWith the upgrade to numpy 1.20.x (#31008), the non-portability shows as an error message instead of a crash:\n\n```\n  [sagelib-9.4.beta0]       from numpy.core._multiarray_umath import (\n  [sagelib-9.4.beta0]   RuntimeError: NumPy was built with baseline optimizations: \n  [sagelib-9.4.beta0]   (SSE SSE2 SSE3 SSSE3 SSE41 POPCNT SSE42 AVX F16C FMA3 AVX2 AVX512F AVX512CD AVX512_SKX) but your machine doesn't support:\n  [sagelib-9.4.beta0]   (AVX512F).\n  [sagelib-9.4.beta0]   ************************************************************************\n  [sagelib-9.4.beta0]   Error building the Sage library\n  [sagelib-9.4.beta0]   ************************************************************************\n  [sagelib-9.4.beta0] Full log file: /cygdrive/d/a/sage/sage/logs/pkgs/sagelib-9.4.beta0.log\n```\n\nReport withs the 9.3 Linux binary: \n- https://groups.google.com/g/sage-devel/c/Lj-wx4xm0N4/m/9IiDtu4_CgAJ\n- https://groups.google.com/g/sage-support/c/KZFZBoI6xJk/m/aBY9ZIxoBwAJ\n\n\n\n\n**CC:**  @embray @kliem @dimpase @vbraun @kiwifb @slel\n\n**Keywords:** sdl\n\n**Branch/Commit:** [49e531d3c24ca5bf3f6dff54ce54687256cc429f](https://github.com/sagemath/sagetrac-mirror/commit/49e531d3c24ca5bf3f6dff54ce54687256cc429f)\n\n**Reviewer:** Thierry Monteil\n\n**Author:** Jonathan Kliem\n\n**Dependencies:** #32257\n\nIssue created by migration from https://trac.sagemath.org/ticket/31565\n\n",
    "closed_at": "2021-08-08T15:37:02Z",
    "created_at": "2021-03-26T16:24:28Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Build still non-portable despite SAGE_FAT_BINARY=yes because of numpy",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31565",
    "user": "https://github.com/mkoeppe"
}
```
Follow-up from #29537, #31521.

Observed on `cygwin-standard` but likely also affects the Docker images and the Sage binary distribution.

With the upgrade to numpy 1.20.x (#31008), the non-portability shows as an error message instead of a crash:

```
  [sagelib-9.4.beta0]       from numpy.core._multiarray_umath import (
  [sagelib-9.4.beta0]   RuntimeError: NumPy was built with baseline optimizations: 
  [sagelib-9.4.beta0]   (SSE SSE2 SSE3 SSSE3 SSE41 POPCNT SSE42 AVX F16C FMA3 AVX2 AVX512F AVX512CD AVX512_SKX) but your machine doesn't support:
  [sagelib-9.4.beta0]   (AVX512F).
  [sagelib-9.4.beta0]   ************************************************************************
  [sagelib-9.4.beta0]   Error building the Sage library
  [sagelib-9.4.beta0]   ************************************************************************
  [sagelib-9.4.beta0] Full log file: /cygdrive/d/a/sage/sage/logs/pkgs/sagelib-9.4.beta0.log
```

Report withs the 9.3 Linux binary: 
- https://groups.google.com/g/sage-devel/c/Lj-wx4xm0N4/m/9IiDtu4_CgAJ
- https://groups.google.com/g/sage-support/c/KZFZBoI6xJk/m/aBY9ZIxoBwAJ




**CC:**  @embray @kliem @dimpase @vbraun @kiwifb @slel

**Keywords:** sdl

**Branch/Commit:** [49e531d3c24ca5bf3f6dff54ce54687256cc429f](https://github.com/sagemath/sagetrac-mirror/commit/49e531d3c24ca5bf3f6dff54ce54687256cc429f)

**Reviewer:** Thierry Monteil

**Author:** Jonathan Kliem

**Dependencies:** #32257

Issue created by migration from https://trac.sagemath.org/ticket/31565





---

archive/issue_comments_599169.json:
```json
{
    "body": "<a id='comment:2'></a>\nWhat are the symptoms? I don't really do cygwin but I may do docker one day.",
    "created_at": "2021-03-29T03:31:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599169",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
What are the symptoms? I don't really do cygwin but I may do docker one day.



---

archive/issue_comments_599170.json:
```json
{
    "body": "<a id='comment:3'></a>\nThe symptom is that something you build on one machine does not run on another machine, aborting with SIGILL.",
    "created_at": "2021-04-03T01:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599170",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
The symptom is that something you build on one machine does not run on another machine, aborting with SIGILL.



---

archive/issue_comments_599171.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,4 @@\n Follow-up from #29537, #31521.\n \n-Observed on `cygwin-standard` but likely also affects the Docker images.\n+Observed on `cygwin-standard` but likely also affects the Docker images and the Sage binary distribution.\n+\n``````\n",
    "created_at": "2021-04-03T01:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599171",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,4 @@
 Follow-up from #29537, #31521.
 
-Observed on `cygwin-standard` but likely also affects the Docker images.
+Observed on `cygwin-standard` but likely also affects the Docker images and the Sage binary distribution.
+
``````




---

archive/issue_comments_599172.json:
```json
{
    "body": "<a id='comment:5'></a>\nMoving to 9.4, as 9.3 has been released.",
    "created_at": "2021-05-10T17:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599172",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Moving to 9.4, as 9.3 has been released.



---

archive/issue_events_093774.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31565#event-93774"
}
```



---

archive/issue_comments_599173.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,3 +2,17 @@\n \n Observed on `cygwin-standard` but likely also affects the Docker images and the Sage binary distribution.\n \n+With the upgrade to numpy 1.20.x (#31008), the non-portability shows as an error message instead of a crash:\n+\n+```\n+  [sagelib-9.4.beta0]       from numpy.core._multiarray_umath import (\n+  [sagelib-9.4.beta0]   RuntimeError: NumPy was built with baseline optimizations: \n+  [sagelib-9.4.beta0]   (SSE SSE2 SSE3 SSSE3 SSE41 POPCNT SSE42 AVX F16C FMA3 AVX2 AVX512F AVX512CD AVX512_SKX) but your machine doesn't support:\n+  [sagelib-9.4.beta0]   (AVX512F).\n+  [sagelib-9.4.beta0]   ************************************************************************\n+  [sagelib-9.4.beta0]   Error building the Sage library\n+  [sagelib-9.4.beta0]   ************************************************************************\n+  [sagelib-9.4.beta0] Full log file: /cygdrive/d/a/sage/sage/logs/pkgs/sagelib-9.4.beta0.log\n+```\n+\n+\n``````\n",
    "created_at": "2021-06-04T18:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599173",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,3 +2,17 @@
 
 Observed on `cygwin-standard` but likely also affects the Docker images and the Sage binary distribution.
 
+With the upgrade to numpy 1.20.x (#31008), the non-portability shows as an error message instead of a crash:
+
+```
+  [sagelib-9.4.beta0]       from numpy.core._multiarray_umath import (
+  [sagelib-9.4.beta0]   RuntimeError: NumPy was built with baseline optimizations: 
+  [sagelib-9.4.beta0]   (SSE SSE2 SSE3 SSSE3 SSE41 POPCNT SSE42 AVX F16C FMA3 AVX2 AVX512F AVX512CD AVX512_SKX) but your machine doesn't support:
+  [sagelib-9.4.beta0]   (AVX512F).
+  [sagelib-9.4.beta0]   ************************************************************************
+  [sagelib-9.4.beta0]   Error building the Sage library
+  [sagelib-9.4.beta0]   ************************************************************************
+  [sagelib-9.4.beta0] Full log file: /cygdrive/d/a/sage/sage/logs/pkgs/sagelib-9.4.beta0.log
+```
+
+
``````




---

archive/issue_comments_599174.json:
```json
{
    "body": "**Dependencies:** #31008",
    "created_at": "2021-06-04T18:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599174",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #31008



---

archive/issue_comments_599175.json:
```json
{
    "body": "<a id='comment:7'></a>\nI guess we need to unwind #31521 now??",
    "created_at": "2021-06-04T18:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599175",
    "user": "https://github.com/kliem"
}
```

<a id='comment:7'></a>
I guess we need to unwind #31521 now??



---

archive/issue_comments_599176.json:
```json
{
    "body": "<a id='comment:8'></a>\nAh, that's right!",
    "created_at": "2021-06-04T20:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599176",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
Ah, that's right!



---

archive/issue_comments_599177.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -15,4 +15,7 @@\n   [sagelib-9.4.beta0] Full log file: /cygdrive/d/a/sage/sage/logs/pkgs/sagelib-9.4.beta0.log\n ```\n \n+Report with the 9.3 Linux binary: https://groups.google.com/g/sage-devel/c/Lj-wx4xm0N4/m/9IiDtu4_CgAJ\n \n+\n+\n``````\n",
    "created_at": "2021-06-04T20:34:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599177",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -15,4 +15,7 @@
   [sagelib-9.4.beta0] Full log file: /cygdrive/d/a/sage/sage/logs/pkgs/sagelib-9.4.beta0.log
 ```
 
+Report with the 9.3 Linux binary: https://groups.google.com/g/sage-devel/c/Lj-wx4xm0N4/m/9IiDtu4_CgAJ
 
+
+
``````




---

archive/issue_comments_599178.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -15,7 +15,9 @@\n   [sagelib-9.4.beta0] Full log file: /cygdrive/d/a/sage/sage/logs/pkgs/sagelib-9.4.beta0.log\n ```\n \n-Report with the 9.3 Linux binary: https://groups.google.com/g/sage-devel/c/Lj-wx4xm0N4/m/9IiDtu4_CgAJ\n+Report withs the 9.3 Linux binary: \n+- https://groups.google.com/g/sage-devel/c/Lj-wx4xm0N4/m/9IiDtu4_CgAJ\n+- https://groups.google.com/g/sage-support/c/KZFZBoI6xJk/m/aBY9ZIxoBwAJ\n \n \n \n``````\n",
    "created_at": "2021-06-19T01:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599178",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -15,7 +15,9 @@
   [sagelib-9.4.beta0] Full log file: /cygdrive/d/a/sage/sage/logs/pkgs/sagelib-9.4.beta0.log
 ```
 
-Report with the 9.3 Linux binary: https://groups.google.com/g/sage-devel/c/Lj-wx4xm0N4/m/9IiDtu4_CgAJ
+Report withs the 9.3 Linux binary: 
+- https://groups.google.com/g/sage-devel/c/Lj-wx4xm0N4/m/9IiDtu4_CgAJ
+- https://groups.google.com/g/sage-support/c/KZFZBoI6xJk/m/aBY9ZIxoBwAJ
 
 
 
``````




---

archive/issue_comments_599179.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/build_still_non_portable_despite_sage_fat_binary_yes_because_of_numpy](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_still_non_portable_despite_sage_fat_binary_yes_because_of_numpy)",
    "created_at": "2021-06-19T18:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599179",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/build_still_non_portable_despite_sage_fat_binary_yes_because_of_numpy](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_still_non_portable_despite_sage_fat_binary_yes_because_of_numpy)



---

archive/issue_comments_599180.json:
```json
{
    "body": "<a id='comment:12'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b249c4750f510ba18a36b0306a15914325059398\">b249c47</a></td><td><code>Revert \"Revert \"do not allow numpy intrinsics when building fat binary\"\"</code></td></tr></table>\n",
    "created_at": "2021-06-19T18:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599180",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b249c4750f510ba18a36b0306a15914325059398">b249c47</a></td><td><code>Revert "Revert "do not allow numpy intrinsics when building fat binary""</code></td></tr></table>




---

archive/issue_comments_599181.json:
```json
{
    "body": "**Author:** Jonathan Kliem",
    "created_at": "2021-06-19T18:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599181",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Jonathan Kliem



---

archive/issue_comments_599182.json:
```json
{
    "body": "**Commit:** [b249c4750f510ba18a36b0306a15914325059398](https://github.com/sagemath/sagetrac-mirror/commit/b249c4750f510ba18a36b0306a15914325059398)",
    "created_at": "2021-06-19T18:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599182",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [b249c4750f510ba18a36b0306a15914325059398](https://github.com/sagemath/sagetrac-mirror/commit/b249c4750f510ba18a36b0306a15914325059398)



---

archive/issue_comments_599183.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2021-06-19T18:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599183",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_599184.json:
```json
{
    "body": "**Reviewer:** https://github.com/mkoeppe/sage/actions/runs/952966309",
    "created_at": "2021-06-19T18:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599184",
    "user": "https://github.com/mkoeppe"
}
```

**Reviewer:** https://github.com/mkoeppe/sage/actions/runs/952966309



---

archive/issue_comments_599185.json:
```json
{
    "body": "<a id='comment:14'></a>\nThanks for taking care of this.",
    "created_at": "2021-06-19T20:48:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599185",
    "user": "https://github.com/kliem"
}
```

<a id='comment:14'></a>
Thanks for taking care of this.



---

archive/issue_comments_599186.json:
```json
{
    "body": "<a id='comment:15'></a>\nThe `cygwin-standard` build looked rather promising (no \"baseline optimizations\" message, no crash when just importing numpy) but I am getting crashes again https://github.com/mkoeppe/sage/runs/2867645468 when the doctests do any plotting.",
    "created_at": "2021-06-20T15:52:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599186",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
The `cygwin-standard` build looked rather promising (no "baseline optimizations" message, no crash when just importing numpy) but I am getting crashes again https://github.com/mkoeppe/sage/runs/2867645468 when the doctests do any plotting.



---

archive/issue_comments_599187.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-06-20T15:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599187",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_599188.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/actions/runs/952966309\" to \"Matthias Koeppe\".",
    "created_at": "2021-06-20T15:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599188",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/actions/runs/952966309" to "Matthias Koeppe".



---

archive/issue_comments_599189.json:
```json
{
    "body": "<a id='comment:16'></a>\nThe other runs at https://github.com/mkoeppe/sage/runs/2865933225?check_suite_focus=true look clean.\n\nSo I consider this ticket already an improvement. We'll have to chase the crash on cygwin when switching CPUs between build stages in ... yet another ... follow-up ticket.",
    "created_at": "2021-06-20T15:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599189",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
The other runs at https://github.com/mkoeppe/sage/runs/2865933225?check_suite_focus=true look clean.

So I consider this ticket already an improvement. We'll have to chase the crash on cygwin when switching CPUs between build stages in ... yet another ... follow-up ticket.



---

archive/issue_comments_599190.json:
```json
{
    "body": "<a id='comment:17'></a>\nMore numpy-related trouble, looking as e.g. from  https://groups.google.com/d/msgid/sage-devel/763f8650-9803-4bba-a0ec-46744204fc22n%40googlegroups.com. (there are more reports like this)\n\n```\n[sagelib-9.4.beta2]   File \"/home/chapoton/sage/local/lib/python3.8/site-packages/numpy/core/overrides.py\", line 7, in <module>\n[sagelib-9.4.beta2]     from numpy.core._multiarray_umath import (\n[sagelib-9.4.beta2] RuntimeError: NumPy was built with baseline optimizations: \n[sagelib-9.4.beta2] (SSE SSE2 SSE3 SSSE3 SSE41 POPCNT SSE42) but your machine doesn't support:\n[sagelib-9.4.beta2] (POPCNT).\n```\nSo somehow CPU changes its state, and refuses to say yes to features tested as yes during the Numpy build?!\nIs it due to some CPU flags manipulations happening during sagelib build?",
    "created_at": "2021-06-21T12:30:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599190",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>
More numpy-related trouble, looking as e.g. from  https://groups.google.com/d/msgid/sage-devel/763f8650-9803-4bba-a0ec-46744204fc22n%40googlegroups.com. (there are more reports like this)

```
[sagelib-9.4.beta2]   File "/home/chapoton/sage/local/lib/python3.8/site-packages/numpy/core/overrides.py", line 7, in <module>
[sagelib-9.4.beta2]     from numpy.core._multiarray_umath import (
[sagelib-9.4.beta2] RuntimeError: NumPy was built with baseline optimizations: 
[sagelib-9.4.beta2] (SSE SSE2 SSE3 SSSE3 SSE41 POPCNT SSE42) but your machine doesn't support:
[sagelib-9.4.beta2] (POPCNT).
```
So somehow CPU changes its state, and refuses to say yes to features tested as yes during the Numpy build?!
Is it due to some CPU flags manipulations happening during sagelib build?



---

archive/issue_comments_599191.json:
```json
{
    "body": "<a id='comment:18'></a>\nI've opened #32021 to deal with that `RuntimeError: NumPy was built with baseline optimizations:` thing.",
    "created_at": "2021-06-21T12:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599191",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
I've opened #32021 to deal with that `RuntimeError: NumPy was built with baseline optimizations:` thing.



---

archive/issue_comments_599192.json:
```json
{
    "body": "<a id='comment:19'></a>\nAcutally the definition of `cpu-dispatch` in `NUMPY_FCONFIG` isn't clean. However, only the vallue will be passed and not the variable `NUMPY_FCONFIG`.",
    "created_at": "2021-06-22T11:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599192",
    "user": "https://github.com/kliem"
}
```

<a id='comment:19'></a>
Acutally the definition of `cpu-dispatch` in `NUMPY_FCONFIG` isn't clean. However, only the vallue will be passed and not the variable `NUMPY_FCONFIG`.



---

archive/issue_comments_599193.json:
```json
{
    "body": "<a id='comment:20'></a>\nThis doesn't work. See ticket:32021#comment:10.\n\nIt's a build option not a configure option.",
    "created_at": "2021-06-22T18:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599193",
    "user": "https://github.com/kliem"
}
```

<a id='comment:20'></a>
This doesn't work. See ticket:32021#comment:10.

It's a build option not a configure option.



---

archive/issue_comments_599194.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2021-06-22T18:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599194",
    "user": "https://github.com/kliem"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_599195.json:
```json
{
    "body": "<a id='comment:21'></a>\nActually the place to do it is correct however:\n\n> The command arguments are available in build, build_clib, and build_ext. if build_clib or build_ext are not specified by the user, the arguments of build will be used instead, which also holds the default values.\n\n\nSo this does not work for `bdist_wheel` and this is what we use.",
    "created_at": "2021-06-22T19:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599195",
    "user": "https://github.com/kliem"
}
```

<a id='comment:21'></a>
Actually the place to do it is correct however:

> The command arguments are available in build, build_clib, and build_ext. if build_clib or build_ext are not specified by the user, the arguments of build will be used instead, which also holds the default values.


So this does not work for `bdist_wheel` and this is what we use.



---

archive/issue_comments_599196.json:
```json
{
    "body": "<a id='comment:22'></a>\nYou can do `setup.py bdist_wheel build [...build-options...]`, see for example build/pkgs/jupyter_jsmol/spkg-install.in",
    "created_at": "2021-06-22T20:03:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599196",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
You can do `setup.py bdist_wheel build [...build-options...]`, see for example build/pkgs/jupyter_jsmol/spkg-install.in



---

archive/issue_comments_599197.json:
```json
{
    "body": "<a id='comment:23'></a>\nThanks. This seems to do the trick.\n\nActually this itself might even work for this ticket here.",
    "created_at": "2021-06-22T20:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599197",
    "user": "https://github.com/kliem"
}
```

<a id='comment:23'></a>
Thanks. This seems to do the trick.

Actually this itself might even work for this ticket here.



---

archive/issue_comments_599198.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/build_still_non_portable_despite_sage_fat_binary_yes_because_of_numpy](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_still_non_portable_despite_sage_fat_binary_yes_because_of_numpy)\" to \"[public/31565](https://github.com/sagemath/sagetrac-mirror/tree/public/31565)\".",
    "created_at": "2021-06-23T11:24:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599198",
    "user": "https://github.com/kliem"
}
```

**Changing branch** from "[u/mkoeppe/build_still_non_portable_despite_sage_fat_binary_yes_because_of_numpy](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_still_non_portable_despite_sage_fat_binary_yes_because_of_numpy)" to "[public/31565](https://github.com/sagemath/sagetrac-mirror/tree/public/31565)".



---

archive/issue_comments_599199.json:
```json
{
    "body": "**Changing commit** from \"[b249c4750f510ba18a36b0306a15914325059398](https://github.com/sagemath/sagetrac-mirror/commit/b249c4750f510ba18a36b0306a15914325059398)\" to \"[82ae48525b377032296f7f83cdc70e7acf5cd533](https://github.com/sagemath/sagetrac-mirror/commit/82ae48525b377032296f7f83cdc70e7acf5cd533)\".",
    "created_at": "2021-06-23T11:24:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599199",
    "user": "https://github.com/kliem"
}
```

**Changing commit** from "[b249c4750f510ba18a36b0306a15914325059398](https://github.com/sagemath/sagetrac-mirror/commit/b249c4750f510ba18a36b0306a15914325059398)" to "[82ae48525b377032296f7f83cdc70e7acf5cd533](https://github.com/sagemath/sagetrac-mirror/commit/82ae48525b377032296f7f83cdc70e7acf5cd533)".



---

archive/issue_comments_599200.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-06-23T11:24:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599200",
    "user": "https://github.com/kliem"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_599201.json:
```json
{
    "body": "<a id='comment:24'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82ae48525b377032296f7f83cdc70e7acf5cd533\">82ae485</a></td><td><code>disable baseline in case of SAGE_FAT_BINARY</code></td></tr></table>\n",
    "created_at": "2021-06-23T11:24:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599201",
    "user": "https://github.com/kliem"
}
```

<a id='comment:24'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82ae48525b377032296f7f83cdc70e7acf5cd533">82ae485</a></td><td><code>disable baseline in case of SAGE_FAT_BINARY</code></td></tr></table>




---

archive/issue_comments_599202.json:
```json
{
    "body": "<a id='comment:25'></a>\nhttps://github.com/kliem/sage/pull/46/checks",
    "created_at": "2021-06-23T11:25:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599202",
    "user": "https://github.com/kliem"
}
```

<a id='comment:25'></a>
https://github.com/kliem/sage/pull/46/checks



---

archive/issue_comments_599203.json:
```json
{
    "body": "**Changing status** from needs_review to needs_info.",
    "created_at": "2021-07-19T03:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599203",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_review to needs_info.



---

archive/issue_comments_599204.json:
```json
{
    "body": "<a id='comment:26'></a>\nUnclear whether this is still needed now that #32021 is merged in 9.4.beta5",
    "created_at": "2021-07-19T03:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599204",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>
Unclear whether this is still needed now that #32021 is merged in 9.4.beta5



---

archive/issue_comments_599205.json:
```json
{
    "body": "**Changing dependencies** from \"#31008\" to \"#32257\".",
    "created_at": "2021-07-21T22:55:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599205",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#31008" to "#32257".



---

archive/issue_comments_599206.json:
```json
{
    "body": "<a id='comment:28'></a>\nWith #32021 and the `pynac` build failure fixed by #32257, we are back to being able to build and run the testsuite on Cygwin. https://github.com/mkoeppe/sage/runs/3126612760?check_suite_focus=true\n\nNumerous SIGSEGVs whenever plotting is involved point to more trouble with numpy.\n\nI'll try out the branch of the present ticket on top of #32257.",
    "created_at": "2021-07-21T22:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599206",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
With #32021 and the `pynac` build failure fixed by #32257, we are back to being able to build and run the testsuite on Cygwin. https://github.com/mkoeppe/sage/runs/3126612760?check_suite_focus=true

Numerous SIGSEGVs whenever plotting is involved point to more trouble with numpy.

I'll try out the branch of the present ticket on top of #32257.



---

archive/issue_comments_599207.json:
```json
{
    "body": "<a id='comment:29'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4156f754ca211962bd58057a547a1c726d60e33\">d4156f7</a></td><td><code>build/pkgs/singular/patches/0001-factory-canonicalform.h-Add-more-FACTORY_PUBLIC.patch: New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/49e531d3c24ca5bf3f6dff54ce54687256cc429f\">49e531d</a></td><td><code>disable baseline in case of SAGE_FAT_BINARY</code></td></tr></table>\n",
    "created_at": "2021-07-21T22:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599207",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4156f754ca211962bd58057a547a1c726d60e33">d4156f7</a></td><td><code>build/pkgs/singular/patches/0001-factory-canonicalform.h-Add-more-FACTORY_PUBLIC.patch: New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/49e531d3c24ca5bf3f6dff54ce54687256cc429f">49e531d</a></td><td><code>disable baseline in case of SAGE_FAT_BINARY</code></td></tr></table>




---

archive/issue_comments_599208.json:
```json
{
    "body": "**Changing commit** from \"[82ae48525b377032296f7f83cdc70e7acf5cd533](https://github.com/sagemath/sagetrac-mirror/commit/82ae48525b377032296f7f83cdc70e7acf5cd533)\" to \"[49e531d3c24ca5bf3f6dff54ce54687256cc429f](https://github.com/sagemath/sagetrac-mirror/commit/49e531d3c24ca5bf3f6dff54ce54687256cc429f)\".",
    "created_at": "2021-07-21T22:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599208",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[82ae48525b377032296f7f83cdc70e7acf5cd533](https://github.com/sagemath/sagetrac-mirror/commit/82ae48525b377032296f7f83cdc70e7acf5cd533)" to "[49e531d3c24ca5bf3f6dff54ce54687256cc429f](https://github.com/sagemath/sagetrac-mirror/commit/49e531d3c24ca5bf3f6dff54ce54687256cc429f)".



---

archive/issue_comments_599209.json:
```json
{
    "body": "**Changing reviewer** from \"Matthias Koeppe\" to \"https://github.com/mkoeppe/sage/actions/runs/1054288431\".",
    "created_at": "2021-07-21T23:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599209",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "Matthias Koeppe" to "https://github.com/mkoeppe/sage/actions/runs/1054288431".



---

archive/issue_comments_599210.json:
```json
{
    "body": "<a id='comment:30'></a>\nThat's now running at https://github.com/mkoeppe/sage/actions/runs/1054288431",
    "created_at": "2021-07-21T23:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599210",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
That's now running at https://github.com/mkoeppe/sage/actions/runs/1054288431



---

archive/issue_comments_599211.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [mkoeppe](#comment%3A28):\n> Numerous SIGSEGVs whenever plotting is involved point to more trouble with numpy.\n> \n> I'll try out the branch of the present ticket on top of #32257.\n\n\nSame issues as before.",
    "created_at": "2021-07-22T14:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599211",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
Replying to [mkoeppe](#comment%3A28):
> Numerous SIGSEGVs whenever plotting is involved point to more trouble with numpy.
> 
> I'll try out the branch of the present ticket on top of #32257.


Same issues as before.



---

archive/issue_comments_599212.json:
```json
{
    "body": "<a id='comment:32'></a>\nTesting with #32080 merged at https://github.com/mkoeppe/sage/actions/runs/1056686451",
    "created_at": "2021-07-22T15:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599212",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>
Testing with #32080 merged at https://github.com/mkoeppe/sage/actions/runs/1056686451



---

archive/issue_comments_599213.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/actions/runs/1054288431\" to \"\".",
    "created_at": "2021-07-22T15:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599213",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/actions/runs/1054288431" to "".



---

archive/issue_comments_599214.json:
```json
{
    "body": "<a id='comment:33'></a>\nAlso with #32080 no change. Segfaults on every plot.\n\nNext step would be to try to reproduce this in a local installation in Cygwin.",
    "created_at": "2021-07-23T22:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599214",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>
Also with #32080 no change. Segfaults on every plot.

Next step would be to try to reproduce this in a local installation in Cygwin.



---

archive/issue_comments_599215.json:
```json
{
    "body": "**Changing status** from needs_info to needs_work.",
    "created_at": "2021-07-23T22:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599215",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_info to needs_work.



---

archive/issue_events_093775.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31565#event-93775"
}
```



---

archive/issue_comments_599216.json:
```json
{
    "body": "<a id='comment:35'></a>\nReduced to critical - see https://groups.google.com/g/sage-release/c/91CGN0cra2k/m/1WwPZNshBQAJ",
    "created_at": "2021-07-26T17:06:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599216",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>
Reduced to critical - see https://groups.google.com/g/sage-release/c/91CGN0cra2k/m/1WwPZNshBQAJ



---

archive/issue_comments_599217.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sdl\".",
    "created_at": "2021-08-03T10:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599217",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Changing keywords** from "" to "sdl".



---

archive/issue_comments_599218.json:
```json
{
    "body": "**Reviewer:** Thierry Monteil",
    "created_at": "2021-08-03T10:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599218",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Reviewer:** Thierry Monteil



---

archive/issue_comments_599219.json:
```json
{
    "body": "<a id='comment:36'></a>\nI confirm that this branch fixes SSE2 bug for numpy in a quemulated Pentium 3. Note however that the error appeared at run time not build time.\n\nAs this will allow me to rebuild 32bit patchbots and a new SDL for bullseye release (which i did not do for a while), i am +1 for setting this ticket a blocker and get it merged in 9.4.",
    "created_at": "2021-08-03T10:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599219",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:36'></a>
I confirm that this branch fixes SSE2 bug for numpy in a quemulated Pentium 3. Note however that the error appeared at run time not build time.

As this will allow me to rebuild 32bit patchbots and a new SDL for bullseye release (which i did not do for a while), i am +1 for setting this ticket a blocker and get it merged in 9.4.



---

archive/issue_comments_599220.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2021-08-03T21:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599220",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_events_093776.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31565#event-93776"
}
```



---

archive/issue_comments_599221.json:
```json
{
    "body": "<a id='comment:37'></a>\nIf nobody complains.",
    "created_at": "2021-08-03T21:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599221",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:37'></a>
If nobody complains.



---

archive/issue_events_093777.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-08-08T15:37:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31565#event-93777"
}
```



---

archive/issue_comments_599222.json:
```json
{
    "body": "**Changing branch** from \"[public/31565](https://github.com/sagemath/sagetrac-mirror/tree/public/31565)\" to \"[49e531d3c24ca5bf3f6dff54ce54687256cc429f](https://github.com/sagemath/sagetrac-mirror/commit/49e531d3c24ca5bf3f6dff54ce54687256cc429f)\".",
    "created_at": "2021-08-08T15:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31565#issuecomment-599222",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/31565](https://github.com/sagemath/sagetrac-mirror/tree/public/31565)" to "[49e531d3c24ca5bf3f6dff54ce54687256cc429f](https://github.com/sagemath/sagetrac-mirror/commit/49e531d3c24ca5bf3f6dff54ce54687256cc429f)".
