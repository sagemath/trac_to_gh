# Issue 31396: relocatable wheel version of package sage_conf

archive/issues_031159.json:
```json
{
    "body": "This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n\nThe `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n\n\nSo far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n\nThe wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \nhttps://github.com/sagemath/sage-wheels/releases/tag/9.5.rc2, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \nHence, the pip invocation needs to use a URL.\n\n(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)\n\n**Instructions for testing:**\n\n1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:\n\n```\n$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin\n```\n\n2. Install the wheel in the user scheme:\n\n```\n$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n```\n\n3. Run the installed sage.\n\n```\n$ sage\n``` \n\n**Procedure for building the sage_conf wheel and compatible wheels:**\n\n\nFor building wheels on macOS Catalina that uses XCode python 3.8:\n\n```\n$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n```\nor\n\n```\ntox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n```\n\nThis creates (uploaded to https://github.com/sagemath/sage-wheels/releases/tag/9.5.rc2)\n- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n\nBuild for macOS Big Sur (requires a machine running Big Sur or Monterey) (uploaded to https://github.com/sagemath/sage-wheels/releases/tag/9.5.rc2)\n\n```\ntox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n```\n\nBuild for macOS Monterey (requires a machine running Monterey)\n\n```\ntox -e local-macos-12.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n```\n\n\nBuild for Linux (does not work yet):\n\n```\n$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels\n\n```\n\n**Follow-up steps:** \n- also build a **sagemath-standard** wheel\n- build wheels for `manylinux` using `tox -e docker-manylinux....`\n  - wheel is much too big: 2.3GB\n  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`\n- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible -- for example by storing a tar file `sage_root.tar` (with symlinks) instead of including the sage root as a directory - https://docs.python.org/3/library/tarfile.html#tarfile.open \n- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n\n\nCC:  @culler @kliem @dimpase @jhpalmieri @slel @kiwifb\n\nReviewer: Julian R\u00fcth\n\nAuthor: Matthias Koeppe\n\nBranch: u/mkoeppe/relocatable_wheel_version_of_package_sage_conf\n\nStatus: needs_work\n\nDependencies: #33817\n\nCommit: 1b2d4be32dbaa52ca5183872fde4702b58ef4165\n\nIssue created by migration from https://trac.sagemath.org/ticket/31396\n\n",
    "created_at": "2021-02-14T22:06:47Z",
    "labels": [
        "component: relocation"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "relocatable wheel version of package sage_conf",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31396",
    "user": "https://github.com/mkoeppe"
}
```
This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).

The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.


So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  

The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
https://github.com/sagemath/sage-wheels/releases/tag/9.5.rc2, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
Hence, the pip invocation needs to use a URL.

(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)

**Instructions for testing:**

1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:

```
$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin
```

2. Install the wheel in the user scheme:

```
$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
```

3. Run the installed sage.

```
$ sage
``` 

**Procedure for building the sage_conf wheel and compatible wheels:**


For building wheels on macOS Catalina that uses XCode python 3.8:

```
$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
```
or

```
tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
```

This creates (uploaded to https://github.com/sagemath/sage-wheels/releases/tag/9.5.rc2)
- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl

Build for macOS Big Sur (requires a machine running Big Sur or Monterey) (uploaded to https://github.com/sagemath/sage-wheels/releases/tag/9.5.rc2)

```
tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
```

Build for macOS Monterey (requires a machine running Monterey)

```
tox -e local-macos-12.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
```


Build for Linux (does not work yet):

```
$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels

```

**Follow-up steps:** 
- also build a **sagemath-standard** wheel
- build wheels for `manylinux` using `tox -e docker-manylinux....`
  - wheel is much too big: 2.3GB
  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`
- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible -- for example by storing a tar file `sage_root.tar` (with symlinks) instead of including the sage root as a directory - https://docs.python.org/3/library/tarfile.html#tarfile.open 
- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.


CC:  @culler @kliem @dimpase @jhpalmieri @slel @kiwifb

Reviewer: Julian RÃ¼th

Author: Matthias Koeppe

Branch: u/mkoeppe/relocatable_wheel_version_of_package_sage_conf

Status: needs_work

Dependencies: #33817

Commit: 1b2d4be32dbaa52ca5183872fde4702b58ef4165

Issue created by migration from https://trac.sagemath.org/ticket/31396





---

archive/issue_comments_475188.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-15T06:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475188",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475189.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,6 +1,10 @@\n This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_LOCAL` relocatable using the method proposed in #31076, using `SAGE_LOCAL=/var/tmp/sage-...` and a symlink.\n \n The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+Optional steps:\n+- Also build the wheelhouse (`local/var/lib/sage/wheels`), at least for tricky packages...\n+\n \n Dependencies: #29039\n \n```\n",
    "created_at": "2021-02-15T06:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475189",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,6 +1,10 @@
 This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_LOCAL` relocatable using the method proposed in #31076, using `SAGE_LOCAL=/var/tmp/sage-...` and a symlink.
 
 The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+Optional steps:
+- Also build the wheelhouse (`local/var/lib/sage/wheels`), at least for tricky packages...
+
 
 Dependencies: #29039
 
```




---

archive/issue_comments_475190.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,16 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_LOCAL` relocatable using the method proposed in #31076, using `SAGE_LOCAL=/var/tmp/sage-...` and a symlink.\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+To test:\n+\n+```\n+(cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)\n+```\n+On macOS, this builds a 750MB wheel, an order of magnitude above the standard file size limit on PyPI.\n+\n+Optional steps:\n+- Also build the wheelhouse (`local/var/lib/sage/wheels`), at least for tricky packages...\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-02-15T07:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475190",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,16 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_LOCAL` relocatable using the method proposed in #31076, using `SAGE_LOCAL=/var/tmp/sage-...` and a symlink.
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+To test:
+
+```
+(cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)
+```
+On macOS, this builds a 750MB wheel, an order of magnitude above the standard file size limit on PyPI.
+
+Optional steps:
+- Also build the wheelhouse (`local/var/lib/sage/wheels`), at least for tricky packages...
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475191.json:
```json
{
    "body": "<a id='comment:4'></a>On macOS, some shared libraries from homebrew still leak into the build:\n\n```\nfind src/pkgs/sage_conf-relocatable/.tox/python/lib/python3.9/site-packages/sage_root -name \"*.so\" -o -name \"*.dylib\" | xargs otool -L\nlibgiac.dylib:\n/usr/local/opt/gettext/lib/libintl.8.dylib\nR/library/cluster/libs/*.dylib:\n\t/usr/local/opt/gettext/lib/libintl.8.dylib (compatibility version 11.0.0, current version 11.0.0)\n\t/usr/local/opt/pcre/lib/libpcre.1.dylib (compatibility version 4.0.0, current version 4.12.0)\n\t/usr/local/opt/xz/lib/liblzma.5.dylib (compatibility version 8.0.0, current version 8.5.0)\n```\nDefinitely should disable the R build (#30383).\n\nAlso check whether setting CC=`gcc -sysroot....` helps getting rid of `/usr/local` leaking in.\n\nAlso need to add `--enable-fat-binary`.\n\n`setup.py build_py` should probably use a symlink from `/var/tmp...` into `~/.sage` as well so that it is easy to test relocation after removing the symlink.\nAlso `copytree` from `sage_root_source` should be changed so it overwrites (updates) the existing contents of SAGE_ROOT.\n\nthe tox test should include the test with `otool` for self-containedness.",
    "created_at": "2021-02-15T07:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475191",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>On macOS, some shared libraries from homebrew still leak into the build:

```
find src/pkgs/sage_conf-relocatable/.tox/python/lib/python3.9/site-packages/sage_root -name "*.so" -o -name "*.dylib" | xargs otool -L
libgiac.dylib:
/usr/local/opt/gettext/lib/libintl.8.dylib
R/library/cluster/libs/*.dylib:
	/usr/local/opt/gettext/lib/libintl.8.dylib (compatibility version 11.0.0, current version 11.0.0)
	/usr/local/opt/pcre/lib/libpcre.1.dylib (compatibility version 4.0.0, current version 4.12.0)
	/usr/local/opt/xz/lib/liblzma.5.dylib (compatibility version 8.0.0, current version 8.5.0)
```
Definitely should disable the R build (#30383).

Also check whether setting CC=`gcc -sysroot....` helps getting rid of `/usr/local` leaking in.

Also need to add `--enable-fat-binary`.

`setup.py build_py` should probably use a symlink from `/var/tmp...` into `~/.sage` as well so that it is easy to test relocation after removing the symlink.
Also `copytree` from `sage_root_source` should be changed so it overwrites (updates) the existing contents of SAGE_ROOT.

the tox test should include the test with `otool` for self-containedness.



---

archive/issue_comments_475192.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-16T02:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475192",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475193.json:
```json
{
    "body": "<a id='comment:6'></a>Using -isysroot helps but giac configuration needs more work - #31403",
    "created_at": "2021-02-16T02:58:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475193",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Using -isysroot helps but giac configuration needs more work - #31403



---

archive/issue_comments_475194.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:4 mkoeppe]:\n> `setup.py build_py` should probably use a symlink from `/var/tmp...` into `~/.sage` as well so that it is easy to test relocation after removing the symlink.\n\nDoes not work because sage resolves symlinks when it determines SAGE_ROOT.",
    "created_at": "2021-02-16T03:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475194",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>Replying to [comment:4 mkoeppe]:
> `setup.py build_py` should probably use a symlink from `/var/tmp...` into `~/.sage` as well so that it is easy to test relocation after removing the symlink.

Does not work because sage resolves symlinks when it determines SAGE_ROOT.



---

archive/issue_comments_475195.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-19T00:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475195",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475196.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-19T02:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475196",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475197.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-19T03:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475197",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475198.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-02-19T06:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475198",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_475199.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,21 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_LOCAL` relocatable using the method proposed in #31076, using `SAGE_LOCAL=/var/tmp/sage-...` and a symlink.\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+To test:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)\n+```\n+Specifically for building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v -e python-macos-10.15-python3.8)\n+```\n+This builds a 750MB wheel, an order of magnitude above the standard file size limit on PyPI.\n+\n+Optional steps:\n+- Also build the wheelhouse (`local/var/lib/sage/wheels`), at least for tricky packages...\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-02-19T06:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475199",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,21 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_LOCAL` relocatable using the method proposed in #31076, using `SAGE_LOCAL=/var/tmp/sage-...` and a symlink.
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+To test:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)
+```
+Specifically for building a wheel on macOS that uses XCode python 3.8:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v -e python-macos-10.15-python3.8)
+```
+This builds a 750MB wheel, an order of magnitude above the standard file size limit on PyPI.
+
+Optional steps:
+- Also build the wheelhouse (`local/var/lib/sage/wheels`), at least for tricky packages...
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475200.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-19T06:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475200",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475201.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,21 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+To test:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)\n+```\n+Specifically for building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v -e python-macos-10.15-python3.8)\n+```\n+This builds a 750MB wheel, an order of magnitude above the standard file size limit on PyPI.\n+\n+Optional steps:\n+- Also build the wheelhouse (`local/var/lib/sage/wheels`), at least for tricky packages...\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-02-20T05:07:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475201",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,21 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+To test:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)
+```
+Specifically for building a wheel on macOS that uses XCode python 3.8:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v -e python-macos-10.15-python3.8)
+```
+This builds a 750MB wheel, an order of magnitude above the standard file size limit on PyPI.
+
+Optional steps:
+- Also build the wheelhouse (`local/var/lib/sage/wheels`), at least for tricky packages...
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475202.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-03-15T06:02:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475202",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_475203.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-03-24T17:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475203",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_475204.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-24T17:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475204",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475205.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,19 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+To test:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)\n+```\n+Specifically for building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v -e python-macos-10.15-python3.8)\n+```\n+This builds a 750MB wheel, an order of magnitude above the standard file size limit on PyPI.\n+\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-03-24T17:51:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475205",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,19 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+To test:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)
+```
+Specifically for building a wheel on macOS that uses XCode python 3.8:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v -e python-macos-10.15-python3.8)
+```
+This builds a 750MB wheel, an order of magnitude above the standard file size limit on PyPI.
+
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475206.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,20 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.\n \n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+To test:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)\n+```\n+Specifically for building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v -e python-macos-10.15-python3.8)\n+```\n+This builds a 750MB wheel, an order of magnitude above the standard file size limit on PyPI.\n+\n+Follow-up step: Do not package up the wheel-building venv.\n \n Dependencies: #29039\n \n```\n",
    "created_at": "2021-03-24T17:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475206",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,20 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.
 
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+To test:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)
+```
+Specifically for building a wheel on macOS that uses XCode python 3.8:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v -e python-macos-10.15-python3.8)
+```
+This builds a 750MB wheel, an order of magnitude above the standard file size limit on PyPI.
+
+Follow-up step: Do not package up the wheel-building venv.
 
 Dependencies: #29039
 
```




---

archive/issue_comments_475207.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-24T19:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475207",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475208.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-24T20:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475208",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475209.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,20 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.\n \n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+To test:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)\n+```\n+Specifically for building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v -e python-macos-10.15-python3.8)\n+```\n+This builds a 900MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985\n+\n+Follow-up step: Do not package up the wheel-building venv.\n \n Dependencies: #29039\n \n```\n",
    "created_at": "2021-03-25T00:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475209",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,20 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.
 
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+To test:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)
+```
+Specifically for building a wheel on macOS that uses XCode python 3.8:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v -e python-macos-10.15-python3.8)
+```
+This builds a 900MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985
+
+Follow-up step: Do not package up the wheel-building venv.
 
 Dependencies: #29039
 
```




---

archive/issue_comments_475210.json:
```json
{
    "body": "<a id='comment:26'></a>`delocate-listdeps` reports the following library dependencies:\n\n```\n/usr/local/Cellar/gettext/0.21/lib/libintl.8.dylib\n/usr/local/Cellar/gmp/6.2.1/lib/libgmp.10.dylib\n/usr/local/Cellar/harfbuzz/2.8.0/lib/libharfbuzz.0.dylib\n/usr/local/Cellar/libtiff/4.2.0/lib/libtiff.5.dylib\n/usr/local/Cellar/libxcb/1.14_1/lib/libxcb.1.1.0.dylib\n/usr/local/Cellar/little-cms2/2.12/lib/liblcms2.2.dylib\n/usr/local/Cellar/mpfr/4.1.0/lib/libmpfr.6.dylib\n/usr/local/Cellar/openjpeg/2.4.0/lib/libopenjp2.2.4.0.dylib\n/usr/local/Cellar/readline/8.1/lib/libreadline.8.1.dylib\n/usr/local/Cellar/webp/1.2.0/lib/libwebp.7.dylib\n/usr/local/Cellar/webp/1.2.0/lib/libwebpdemux.2.dylib\n/usr/local/Cellar/webp/1.2.0/lib/libwebpmux.3.dylib\n/usr/local/Cellar/zeromq/4.3.3/lib/libzmq.5.dylib\n/usr/local/Cellar/zlib/1.2.11/lib/libz.1.2.11.dylib\n@executable_path/../../../../Python3\nliba.dylib\nlibb.dylib\nlibc.dylib\n```",
    "created_at": "2021-03-25T01:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475210",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>`delocate-listdeps` reports the following library dependencies:

```
/usr/local/Cellar/gettext/0.21/lib/libintl.8.dylib
/usr/local/Cellar/gmp/6.2.1/lib/libgmp.10.dylib
/usr/local/Cellar/harfbuzz/2.8.0/lib/libharfbuzz.0.dylib
/usr/local/Cellar/libtiff/4.2.0/lib/libtiff.5.dylib
/usr/local/Cellar/libxcb/1.14_1/lib/libxcb.1.1.0.dylib
/usr/local/Cellar/little-cms2/2.12/lib/liblcms2.2.dylib
/usr/local/Cellar/mpfr/4.1.0/lib/libmpfr.6.dylib
/usr/local/Cellar/openjpeg/2.4.0/lib/libopenjp2.2.4.0.dylib
/usr/local/Cellar/readline/8.1/lib/libreadline.8.1.dylib
/usr/local/Cellar/webp/1.2.0/lib/libwebp.7.dylib
/usr/local/Cellar/webp/1.2.0/lib/libwebpdemux.2.dylib
/usr/local/Cellar/webp/1.2.0/lib/libwebpmux.3.dylib
/usr/local/Cellar/zeromq/4.3.3/lib/libzmq.5.dylib
/usr/local/Cellar/zlib/1.2.11/lib/libz.1.2.11.dylib
@executable_path/../../../../Python3
liba.dylib
libb.dylib
libc.dylib
```



---

archive/issue_comments_475211.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-25T01:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475211",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475212.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-25T05:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475212",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475213.json:
```json
{
    "body": "<a id='comment:29'></a>\n```\n/usr/local/Cellar/gettext/0.21/lib/libintl.8.dylib\n/usr/local/Cellar/harfbuzz/2.8.0/lib/libharfbuzz.0.dylib\n/usr/local/Cellar/libtiff/4.2.0/lib/libtiff.5.dylib\n/usr/local/Cellar/libxcb/1.14_1/lib/libxcb.1.1.0.dylib\n/usr/local/Cellar/little-cms2/2.12/lib/liblcms2.2.dylib\n/usr/local/Cellar/openjpeg/2.4.0/lib/libopenjp2.2.4.0.dylib\n/usr/local/Cellar/webp/1.2.0/lib/libwebp.7.dylib\n/usr/local/Cellar/webp/1.2.0/lib/libwebpdemux.2.dylib\n/usr/local/Cellar/webp/1.2.0/lib/libwebpmux.3.dylib\n/usr/local/Cellar/zlib/1.2.11/lib/libz.1.2.11.dylib\n@executable_path/../../../../Python3\nliba.dylib\nlibb.dylib\nlibc.dylib\n```",
    "created_at": "2021-03-25T06:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475213",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>
```
/usr/local/Cellar/gettext/0.21/lib/libintl.8.dylib
/usr/local/Cellar/harfbuzz/2.8.0/lib/libharfbuzz.0.dylib
/usr/local/Cellar/libtiff/4.2.0/lib/libtiff.5.dylib
/usr/local/Cellar/libxcb/1.14_1/lib/libxcb.1.1.0.dylib
/usr/local/Cellar/little-cms2/2.12/lib/liblcms2.2.dylib
/usr/local/Cellar/openjpeg/2.4.0/lib/libopenjp2.2.4.0.dylib
/usr/local/Cellar/webp/1.2.0/lib/libwebp.7.dylib
/usr/local/Cellar/webp/1.2.0/lib/libwebpdemux.2.dylib
/usr/local/Cellar/webp/1.2.0/lib/libwebpmux.3.dylib
/usr/local/Cellar/zlib/1.2.11/lib/libz.1.2.11.dylib
@executable_path/../../../../Python3
liba.dylib
libb.dylib
libc.dylib
```



---

archive/issue_comments_475214.json:
```json
{
    "body": "<a id='comment:30'></a>`libintl` is still coming in through giac",
    "created_at": "2021-03-25T07:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475214",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>`libintl` is still coming in through giac



---

archive/issue_comments_475215.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-25T18:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475215",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475216.json:
```json
{
    "body": "<a id='comment:32'></a>The remaining shared libraries from `/usr/local` come in through our `freetype` (which uses libharfbuzz from `/usr/local`), `libgd` (which uses libtiff), and `pillow` (libtiff and everything else).\n\nWe could try not to ship `matplotlib` at all in the wheelhouse - it is responsible for pulling in `freetype` and `pillow` - but it still shares one shared library with some of our packages - `libpng`.",
    "created_at": "2021-03-25T23:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475216",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>The remaining shared libraries from `/usr/local` come in through our `freetype` (which uses libharfbuzz from `/usr/local`), `libgd` (which uses libtiff), and `pillow` (libtiff and everything else).

We could try not to ship `matplotlib` at all in the wheelhouse - it is responsible for pulling in `freetype` and `pillow` - but it still shares one shared library with some of our packages - `libpng`.



---

archive/issue_comments_475217.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-03-26T01:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475217",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_475218.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-03-26T02:03:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475218",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_475219.json:
```json
{
    "body": "<a id='comment:36'></a>Replying to [comment:30 mkoeppe]:\n> `libintl` is still coming in through giac\n\nSolved now via #31562.",
    "created_at": "2021-03-26T02:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475219",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>Replying to [comment:30 mkoeppe]:
> `libintl` is still coming in through giac

Solved now via #31562.



---

archive/issue_comments_475220.json:
```json
{
    "body": "<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-26T19:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475220",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475221.json:
```json
{
    "body": "<a id='comment:39'></a>Replying to [comment:32 mkoeppe]:\n> The remaining shared libraries from `/usr/local` come in through our `freetype` (which uses libharfbuzz from `/usr/local`)\n\n\nfreetype checks for harfbuzz using pkg-config, accepts `configure --without-harfbuzz`. https://github.com/freetype/freetype/blob/f9f6adb625c48ef15b5d61a3ac1709a068ea95a3/builds/unix/configure.raw#L504",
    "created_at": "2021-03-27T04:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475221",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'></a>Replying to [comment:32 mkoeppe]:
> The remaining shared libraries from `/usr/local` come in through our `freetype` (which uses libharfbuzz from `/usr/local`)


freetype checks for harfbuzz using pkg-config, accepts `configure --without-harfbuzz`. https://github.com/freetype/freetype/blob/f9f6adb625c48ef15b5d61a3ac1709a068ea95a3/builds/unix/configure.raw#L504



---

archive/issue_comments_475222.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,21 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+To test:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)\n+```\n+Specifically for building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+$ tox -e local-macos-local-macos-10.15-nohomebrew-python3_xcode -- bash\n+[tox -e ...] $ (cd src/pkgs/sage_conf-relocatable/ && /usr/local/bin/tox -v -v -v)\n+```\n+This builds a 900MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985\n+\n+Follow-up step: Do not package up the wheel-building venv.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-03-27T05:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475222",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,21 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+To test:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)
+```
+Specifically for building a wheel on macOS that uses XCode python 3.8:
+
+```
+$ tox -e local-macos-local-macos-10.15-nohomebrew-python3_xcode -- bash
+[tox -e ...] $ (cd src/pkgs/sage_conf-relocatable/ && /usr/local/bin/tox -v -v -v)
+```
+This builds a 900MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985
+
+Follow-up step: Do not package up the wheel-building venv.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475223.json:
```json
{
    "body": "<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-27T05:08:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475223",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475224.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,21 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+To test:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)\n+```\n+Specifically for building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+$ tox -e local-macos-local-macos-10.15-nohomebrew-python3_xcode -- bash\n+[tox -e ...] $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)\n+```\n+This builds a 900MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985\n+\n+Follow-up step: Do not package up the wheel-building venv.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-03-27T05:56:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475224",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,21 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+To test:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)
+```
+Specifically for building a wheel on macOS that uses XCode python 3.8:
+
+```
+$ tox -e local-macos-local-macos-10.15-nohomebrew-python3_xcode -- bash
+[tox -e ...] $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)
+```
+This builds a 900MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985
+
+Follow-up step: Do not package up the wheel-building venv.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475225.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,21 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+To test:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)\n+```\n+Specifically for building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+$ tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)\n+```\n+This builds a 900MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985\n+\n+Follow-up step: Do not package up the wheel-building venv.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-03-28T02:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475225",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,21 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+To test:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)
+```
+Specifically for building a wheel on macOS that uses XCode python 3.8:
+
+```
+$ tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)
+```
+This builds a 900MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985
+
+Follow-up step: Do not package up the wheel-building venv.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475226.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,21 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+To test:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)\n+```\n+Specifically for building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)\n+```\n+This builds a 900MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985\n+\n+Follow-up step: Do not package up the wheel-building venv.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-03-28T04:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475226",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,21 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+To test:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)
+```
+Specifically for building a wheel on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)
+```
+This builds a 900MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985
+
+Follow-up step: Do not package up the wheel-building venv.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475227.json:
```json
{
    "body": "<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-03-28T06:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475227",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_475228.json:
```json
{
    "body": "<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-29T02:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475228",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475229.json:
```json
{
    "body": "<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-29T04:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475229",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475230.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,21 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+To test:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)\n+```\n+Specifically for building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)\n+```\n+This builds a 850MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985\n+\n+Follow-up step: Do not package up the wheel-building venv.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-03-29T04:46:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475230",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,21 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+To test:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)
+```
+Specifically for building a wheel on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)
+```
+This builds a 850MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985
+
+Follow-up step: Do not package up the wheel-building venv.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475231.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,21 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+To test:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)\n+```\n+Specifically for building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)\n+```\n+This builds a 850MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985\n+\n+Follow-up step: Do not package up the wheel-building venv (247MB in `sage_root/local/lib/python3.8/site-packages/`); disable all sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-03-29T06:10:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475231",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,21 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+To test:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)
+```
+Specifically for building a wheel on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)
+```
+This builds a 850MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985
+
+Follow-up step: Do not package up the wheel-building venv (247MB in `sage_root/local/lib/python3.8/site-packages/`); disable all sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475232.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,21 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+To test:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)\n+```\n+Specifically for building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)\n+```\n+This builds a 850MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985\n+\n+**Follow-up steps:** Do not package up the wheel-building venv (247MB in `sage_root/local/lib/python3.8/site-packages/`); do not ship any `any` wheels; do not ship the Cython wheel; disable building all sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-03-29T06:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475232",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,21 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink.
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+To test:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)
+```
+Specifically for building a wheel on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)
+```
+This builds a 850MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985
+
+**Follow-up steps:** Do not package up the wheel-building venv (247MB in `sage_root/local/lib/python3.8/site-packages/`); do not ship any `any` wheels; do not ship the Cython wheel; disable building all sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475233.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-03-29T16:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475233",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_475234.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,30 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's `/var/tmp` surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+To test:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)\n+```\n+Specifically for building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)\n+```\n+This builds a 850MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985\n+\n+In the meantime, you can use a prebuilt wheel (so far, macOS python3.8 x86_64 only) made available at https://github.com/mkoeppe/sage/releases;\n+install the wheel using\n+\n+```\n+pip install https://github.com/mkoeppe/sage/releases/download/9.3.rc0%2Btrac31396-2021-03-28/sage_conf-9.3rc0-cp38-cp38-macosx_10_14_6_x86_64.whl\n+```\n+Then proceed with the same instructions as https://pypi.org/project/sage-conf/\n+\n+\n+**Follow-up steps:** Do not package up the wheel-building venv (247MB in `sage_root/local/lib/python3.8/site-packages/`); do not ship any `any` wheels; do not ship the Cython wheel; disable building all sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-03-29T17:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475234",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,30 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's `/var/tmp` surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+To test:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)
+```
+Specifically for building a wheel on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)
+```
+This builds a 850MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985
+
+In the meantime, you can use a prebuilt wheel (so far, macOS python3.8 x86_64 only) made available at https://github.com/mkoeppe/sage/releases;
+install the wheel using
+
+```
+pip install https://github.com/mkoeppe/sage/releases/download/9.3.rc0%2Btrac31396-2021-03-28/sage_conf-9.3rc0-cp38-cp38-macosx_10_14_6_x86_64.whl
+```
+Then proceed with the same instructions as https://pypi.org/project/sage-conf/
+
+
+**Follow-up steps:** Do not package up the wheel-building venv (247MB in `sage_root/local/lib/python3.8/site-packages/`); do not ship any `any` wheels; do not ship the Cython wheel; disable building all sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475235.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,30 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's `/var/tmp` surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+To test:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)\n+```\n+Specifically for building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)\n+```\n+This builds a 850MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985\n+\n+In the meantime, you can use a prebuilt wheel (so far, macOS python3.8 x86_64 only) made available at https://github.com/mkoeppe/sage/releases;\n+install the wheel using\n+\n+```\n+/usr/bin/python3 -m pip install --user https://github.com/mkoeppe/sage/releases/download/9.3.rc0%2Btrac31396-2021-03-28/sage_conf-9.3rc0-cp38-cp38-macosx_10_14_6_x86_64.whl\n+```\n+Then proceed with the same instructions as https://pypi.org/project/sage-conf/\n+\n+\n+**Follow-up steps:** Do not package up the wheel-building venv (247MB in `sage_root/local/lib/python3.8/site-packages/`); do not ship any `any` wheels; do not ship the Cython wheel; disable building all sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-03-29T17:12:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475235",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,30 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's `/var/tmp` surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+To test:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)
+```
+Specifically for building a wheel on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)
+```
+This builds a 850MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985
+
+In the meantime, you can use a prebuilt wheel (so far, macOS python3.8 x86_64 only) made available at https://github.com/mkoeppe/sage/releases;
+install the wheel using
+
+```
+/usr/bin/python3 -m pip install --user https://github.com/mkoeppe/sage/releases/download/9.3.rc0%2Btrac31396-2021-03-28/sage_conf-9.3rc0-cp38-cp38-macosx_10_14_6_x86_64.whl
+```
+Then proceed with the same instructions as https://pypi.org/project/sage-conf/
+
+
+**Follow-up steps:** Do not package up the wheel-building venv (247MB in `sage_root/local/lib/python3.8/site-packages/`); do not ship any `any` wheels; do not ship the Cython wheel; disable building all sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475236.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-03-30T16:45:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475236",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_475237.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,32 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's `/var/tmp` surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+To test:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)\n+```\n+Specifically for building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)\n+```\n+This builds a 850MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985\n+\n+In the meantime, you can use a prebuilt wheel (so far, macOS python3.8 x86_64 only) made available at https://github.com/mkoeppe/sage/releases;\n+install the wheel using\n+\n+```\n+/usr/bin/python3 -m pip install --user https://github.com/mkoeppe/sage/releases/download/9.3.rc0%2Btrac31396-2021-03-28/sage_conf-9.3rc0-cp38-cp38-macosx_10_14_6_x86_64.whl\n+```\n+Then proceed with the same instructions as https://pypi.org/project/sage-conf/\n+\n+\n+**Follow-up steps:** \n+- Do not package up the wheel-building venv (247MB in `sage_root/local/lib/python3.8/site-packages/`); do not ship any `any` wheels; do not ship the Cython wheel; disable building all sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- split out `sage_local` from `sage_conf` and use install-requires in the `sage_conf` wheels with `@` links to GH releases to the `sage_local` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-03-30T16:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475237",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,32 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's `/var/tmp` surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+To test:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)
+```
+Specifically for building a wheel on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)
+```
+This builds a 850MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985
+
+In the meantime, you can use a prebuilt wheel (so far, macOS python3.8 x86_64 only) made available at https://github.com/mkoeppe/sage/releases;
+install the wheel using
+
+```
+/usr/bin/python3 -m pip install --user https://github.com/mkoeppe/sage/releases/download/9.3.rc0%2Btrac31396-2021-03-28/sage_conf-9.3rc0-cp38-cp38-macosx_10_14_6_x86_64.whl
+```
+Then proceed with the same instructions as https://pypi.org/project/sage-conf/
+
+
+**Follow-up steps:** 
+- Do not package up the wheel-building venv (247MB in `sage_root/local/lib/python3.8/site-packages/`); do not ship any `any` wheels; do not ship the Cython wheel; disable building all sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- split out `sage_local` from `sage_conf` and use install-requires in the `sage_conf` wheels with `@` links to GH releases to the `sage_local` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_events_082250.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-30T17:19:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31396#event-82250"
}
```



---

archive/issue_comments_475238.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,32 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's `/var/tmp` surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+To test:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)\n+```\n+Specifically for building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)\n+```\n+This builds a 850MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985\n+\n+In the meantime, you can use a prebuilt wheel (so far, macOS python3.8 x86_64 only) made available at https://github.com/mkoeppe/sage/releases;\n+install the wheel using\n+\n+```\n+/usr/bin/python3 -m pip install --user https://github.com/mkoeppe/sage/releases/download/9.3.rc0%2Btrac31396-2021-03-28/sage_conf-9.3rc0-cp38-cp38-macosx_10_14_6_x86_64.whl\n+```\n+Then proceed with the same instructions as https://pypi.org/project/sage-conf/\n+\n+\n+**Follow-up steps:** \n+- Do not package up the wheel-building venv (247MB in `sage_root/local/lib/python3.8/site-packages/`) (#29013); do not ship any `any` wheels; do not ship the Cython wheel; disable building all sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- split out `sage_local` from `sage_conf` and use install-requires in the `sage_conf` wheels with `@` links to GH releases to the `sage_local` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-03-31T01:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475238",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,32 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's `/var/tmp` surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+To test:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)
+```
+Specifically for building a wheel on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)
+```
+This builds a 850MB wheel, an order of magnitude above the standard file size limit on PyPI. Opened a PR to request a file size limit increase: https://github.com/pypa/pypi-support/issues/985
+
+In the meantime, you can use a prebuilt wheel (so far, macOS python3.8 x86_64 only) made available at https://github.com/mkoeppe/sage/releases;
+install the wheel using
+
+```
+/usr/bin/python3 -m pip install --user https://github.com/mkoeppe/sage/releases/download/9.3.rc0%2Btrac31396-2021-03-28/sage_conf-9.3rc0-cp38-cp38-macosx_10_14_6_x86_64.whl
+```
+Then proceed with the same instructions as https://pypi.org/project/sage-conf/
+
+
+**Follow-up steps:** 
+- Do not package up the wheel-building venv (247MB in `sage_root/local/lib/python3.8/site-packages/`) (#29013); do not ship any `any` wheels; do not ship the Cython wheel; disable building all sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- split out `sage_local` from `sage_conf` and use install-requires in the `sage_conf` wheels with `@` links to GH releases to the `sage_local` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475239.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,32 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's `/var/tmp` surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+To test:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)\n+```\n+Specifically for building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)\n+```\n+This builds a 850MB wheel, an order of magnitude above the standard file size limit on PyPI; a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has been granted by the PyPI team.\n+\n+In the meantime, you can use a prebuilt wheel (so far, macOS python3.8 x86_64 only) made available at https://github.com/mkoeppe/sage/releases;\n+install the wheel using\n+\n+```\n+/usr/bin/python3 -m pip install --user https://github.com/mkoeppe/sage/releases/download/9.3.rc0%2Btrac31396-2021-03-28/sage_conf-9.3rc0-cp38-cp38-macosx_10_14_6_x86_64.whl\n+```\n+Then proceed with the same instructions as https://pypi.org/project/sage-conf/\n+\n+\n+**Follow-up steps:** \n+- Do not package up the wheel-building venv (247MB in `sage_root/local/lib/python3.8/site-packages/`) (#29013); do not ship any `any` wheels; do not ship the Cython wheel; disable building all sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-04-03T16:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475239",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,32 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's `/var/tmp` surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+To test:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)
+```
+Specifically for building a wheel on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel)
+```
+This builds a 850MB wheel, an order of magnitude above the standard file size limit on PyPI; a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has been granted by the PyPI team.
+
+In the meantime, you can use a prebuilt wheel (so far, macOS python3.8 x86_64 only) made available at https://github.com/mkoeppe/sage/releases;
+install the wheel using
+
+```
+/usr/bin/python3 -m pip install --user https://github.com/mkoeppe/sage/releases/download/9.3.rc0%2Btrac31396-2021-03-28/sage_conf-9.3rc0-cp38-cp38-macosx_10_14_6_x86_64.whl
+```
+Then proceed with the same instructions as https://pypi.org/project/sage-conf/
+
+
+**Follow-up steps:** 
+- Do not package up the wheel-building venv (247MB in `sage_root/local/lib/python3.8/site-packages/`) (#29013); do not ship any `any` wheels; do not ship the Cython wheel; disable building all sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475240.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,32 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's `/var/tmp` surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+To test:\n+\n+```\n+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)\n+```\n+Specifically for building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+This builds a 850MB wheel, an order of magnitude above the standard file size limit on PyPI; a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has been granted by the PyPI team.\n+\n+In the meantime, you can use a prebuilt wheel (so far, macOS python3.8 x86_64 only) made available at https://github.com/mkoeppe/sage/releases;\n+install the wheel using\n+\n+```\n+/usr/bin/python3 -m pip install --user https://github.com/mkoeppe/sage/releases/download/9.3.rc0%2Btrac31396-2021-03-28/sage_conf-9.3rc0-cp38-cp38-macosx_10_14_6_x86_64.whl\n+```\n+Then proceed with the same instructions as https://pypi.org/project/sage-conf/\n+\n+\n+**Follow-up steps:** \n+- Do not package up the wheel-building venv (247MB in `sage_root/local/lib/python3.8/site-packages/`) (#29013); do not ship any `any` wheels; do not ship the Cython wheel; disable building all sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-04-03T21:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475240",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,32 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution (and the wheelhouse `local/var/lib/sage/wheels`), making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's `/var/tmp` surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+To test:
+
+```
+./bootstrap && (cd src/pkgs/sage_conf-relocatable/ && tox -v -v -v)
+```
+Specifically for building a wheel on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+This builds a 850MB wheel, an order of magnitude above the standard file size limit on PyPI; a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has been granted by the PyPI team.
+
+In the meantime, you can use a prebuilt wheel (so far, macOS python3.8 x86_64 only) made available at https://github.com/mkoeppe/sage/releases;
+install the wheel using
+
+```
+/usr/bin/python3 -m pip install --user https://github.com/mkoeppe/sage/releases/download/9.3.rc0%2Btrac31396-2021-03-28/sage_conf-9.3rc0-cp38-cp38-macosx_10_14_6_x86_64.whl
+```
+Then proceed with the same instructions as https://pypi.org/project/sage-conf/
+
+
+**Follow-up steps:** 
+- Do not package up the wheel-building venv (247MB in `sage_root/local/lib/python3.8/site-packages/`) (#29013); do not ship any `any` wheels; do not ship the Cython wheel; disable building all sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475241.json:
```json
{
    "body": "<a id='comment:64'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-04-03T21:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475241",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:64'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_475242.json:
```json
{
    "body": "<a id='comment:65'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-04T00:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475242",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:65'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475243.json:
```json
{
    "body": "<a id='comment:66'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-04T02:15:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475243",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:66'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475244.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,35 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.\n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.\n+\n+**Instructions for testing:**\n+\n+```\n+$ /usr/bin/python3 -m pip install -U --user sage-conf\n+``` \n+\n+\n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+\n+\n+\n+**Follow-up steps:** \n+- do not ship the Cython wheel; disable building all sphinx packages; build sagelib too; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-04-04T02:37:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475244",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,35 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.
+
+**Instructions for testing:**
+
+```
+$ /usr/bin/python3 -m pip install -U --user sage-conf
+``` 
+
+
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building a wheel on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+
+
+
+**Follow-up steps:** 
+- do not ship the Cython wheel; disable building all sphinx packages; build sagelib too; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475245.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,35 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.\n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.\n+\n+**Instructions for testing:**\n+\n+```\n+$ /usr/bin/python3 -m pip install -U --user --only-binary sage-conf sage-conf\n+``` \n+\n+\n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+\n+\n+\n+**Follow-up steps:** \n+- do not ship the Cython wheel; disable building all sphinx packages; build sagelib too; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-04-04T02:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475245",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,35 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.
+
+**Instructions for testing:**
+
+```
+$ /usr/bin/python3 -m pip install -U --user --only-binary sage-conf sage-conf
+``` 
+
+
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building a wheel on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+
+
+
+**Follow-up steps:** 
+- do not ship the Cython wheel; disable building all sphinx packages; build sagelib too; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475246.json:
```json
{
    "body": "<a id='comment:69'></a>Unfortunately it turns out that PyPI does not allow `@` references in install requires (see https://github.com/pypa/pip/issues/6301)\n\n```\nHTTPError: 400 Bad Request from https://upload.pypi.org/legacy/\nInvalid value for requires_dist. Error: Can't have direct dependency: 'Cython @ https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/Cython-0.29.21-cp38-cp38-macosx_10_15_x86_64.whl'\n```",
    "created_at": "2021-04-04T04:53:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475246",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:69'></a>Unfortunately it turns out that PyPI does not allow `@` references in install requires (see https://github.com/pypa/pip/issues/6301)

```
HTTPError: 400 Bad Request from https://upload.pypi.org/legacy/
Invalid value for requires_dist. Error: Can't have direct dependency: 'Cython @ https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/Cython-0.29.21-cp38-cp38-macosx_10_15_x86_64.whl'
```



---

archive/issue_comments_475247.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,35 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.\n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.\n+\n+**Instructions for testing:**\n+\n+```\n+$ /usr/bin/python3 -m pip install -U --user --only-binary sage-conf https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+``` \n+\n+\n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+\n+\n+\n+**Follow-up steps:** \n+- do not ship the Cython wheel; disable building all sphinx packages; build sagelib too; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-04-04T05:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475247",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,35 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.
+
+**Instructions for testing:**
+
+```
+$ /usr/bin/python3 -m pip install -U --user --only-binary sage-conf https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+``` 
+
+
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building a wheel on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+
+
+
+**Follow-up steps:** 
+- do not ship the Cython wheel; disable building all sphinx packages; build sagelib too; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475248.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,36 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+**Instructions for testing:**\n+\n+```\n+$ /usr/bin/python3 -m pip install -U --user --only-binary sage-conf https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+``` \n+\n+\n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building a wheel on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+\n+\n+\n+**Follow-up steps:** \n+- do not ship the Cython wheel; disable building all sphinx packages; build sagelib too; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-04-04T05:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475248",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,36 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+**Instructions for testing:**
+
+```
+$ /usr/bin/python3 -m pip install -U --user --only-binary sage-conf https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+``` 
+
+
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building a wheel on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+
+
+
+**Follow-up steps:** 
+- do not ship the Cython wheel; disable building all sphinx packages; build sagelib too; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475249.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,38 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+**Instructions for testing:**\n+\n+```\n+$ /usr/bin/python3 -m pip install -U --user --only-binary sage-conf https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+``` \n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building wheels on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+\n+This creates:\n+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n+\n+\n+\n+**Follow-up steps:** \n+- do not ship the Cython wheel; disable building all sphinx packages; build sagelib too; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-04-04T21:15:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475249",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,38 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+**Instructions for testing:**
+
+```
+$ /usr/bin/python3 -m pip install -U --user --only-binary sage-conf https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+``` 
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building wheels on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+
+This creates:
+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl
+
+
+
+**Follow-up steps:** 
+- do not ship the Cython wheel; disable building all sphinx packages; build sagelib too; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475250.json:
```json
{
    "body": "<a id='comment:73'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-04T21:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475250",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:73'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475251.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,39 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+**Instructions for testing:**\n+\n+```\n+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin\n+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+$ sage\n+``` \n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building wheels on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+\n+This creates:\n+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n+\n+\n+**Follow-up steps:** \n+- do not ship the Cython wheel; disable building all sphinx packages; build sagelib too; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-04-04T23:49:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475251",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,39 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+**Instructions for testing:**
+
+```
+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin
+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+$ sage
+``` 
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building wheels on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+
+This creates:
+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl
+
+
+**Follow-up steps:** 
+- do not ship the Cython wheel; disable building all sphinx packages; build sagelib too; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475252.json:
```json
{
    "body": "<a id='comment:75'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-04T23:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475252",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:75'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475253.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,40 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+**Instructions for testing:**\n+\n+```\n+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin\n+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+$ sage\n+``` \n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building wheels on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+\n+This creates:\n+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n+\n+\n+**Follow-up steps:** \n+- build wheels for `manylinux` using `tox -e docker-manylinux....`\n+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-04-05T00:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475253",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,40 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+**Instructions for testing:**
+
+```
+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin
+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+$ sage
+``` 
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building wheels on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+
+This creates:
+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl
+
+
+**Follow-up steps:** 
+- build wheels for `manylinux` using `tox -e docker-manylinux....`
+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475254.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-04-05T02:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475254",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_475255.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,42 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)\n+\n+**Instructions for testing:**\n+\n+```\n+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin\n+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+$ sage\n+``` \n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building wheels on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+\n+This creates:\n+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n+\n+\n+**Follow-up steps:** \n+- build wheels for `manylinux` using `tox -e docker-manylinux....`\n+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-04-05T05:47:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475255",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,42 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)
+
+**Instructions for testing:**
+
+```
+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin
+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+$ sage
+``` 
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building wheels on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+
+This creates:
+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl
+
+
+**Follow-up steps:** 
+- build wheels for `manylinux` using `tox -e docker-manylinux....`
+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475256.json:
```json
{
    "body": "<a id='comment:79'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-06T04:20:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475256",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:79'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475257.json:
```json
{
    "body": "<a id='comment:80'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-06T04:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475257",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:80'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475258.json:
```json
{
    "body": "<a id='comment:82'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-07T00:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475258",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:82'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475259.json:
```json
{
    "body": "<a id='comment:83'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-07T00:43:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475259",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:83'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475260.json:
```json
{
    "body": "<a id='comment:85'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-07T02:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475260",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:85'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475261.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,53 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)\n+\n+**Instructions for testing:**\n+\n+```\n+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin\n+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+$ sage\n+``` \n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building wheels on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+or\n+\n+```\n+tox -e local-macos-10.15-nohomebrew-python3_xcode -- sage-wheels\n+```\n+\n+This creates:\n+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n+\n+Build for Linux:\n+\n+```\n+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels\n+\n+```\n+\n+**Follow-up steps:** \n+- build wheels for `manylinux` using `tox -e docker-manylinux....`\n+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-04-07T05:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475261",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,53 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)
+
+**Instructions for testing:**
+
+```
+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin
+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+$ sage
+``` 
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building wheels on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+or
+
+```
+tox -e local-macos-10.15-nohomebrew-python3_xcode -- sage-wheels
+```
+
+This creates:
+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl
+
+Build for Linux:
+
+```
+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels
+
+```
+
+**Follow-up steps:** 
+- build wheels for `manylinux` using `tox -e docker-manylinux....`
+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475262.json:
```json
{
    "body": "<a id='comment:88'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-08T19:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475262",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:88'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475263.json:
```json
{
    "body": "<a id='comment:89'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-08T22:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475263",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:89'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475264.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,54 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)\n+\n+**Instructions for testing:**\n+\n+```\n+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin\n+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+$ sage\n+``` \n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building wheels on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+or\n+\n+```\n+tox -e local-macos-10.15-nohomebrew-python3_xcode -- sage-wheels\n+```\n+\n+This creates:\n+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n+\n+Build for Linux:\n+\n+```\n+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels\n+\n+```\n+\n+**Follow-up steps:** \n+- build wheels for `manylinux` using `tox -e docker-manylinux....`\n+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`)\n+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-04-09T01:51:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475264",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,54 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)
+
+**Instructions for testing:**
+
+```
+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin
+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+$ sage
+``` 
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building wheels on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+or
+
+```
+tox -e local-macos-10.15-nohomebrew-python3_xcode -- sage-wheels
+```
+
+This creates:
+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl
+
+Build for Linux:
+
+```
+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels
+
+```
+
+**Follow-up steps:** 
+- build wheels for `manylinux` using `tox -e docker-manylinux....`
+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`)
+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475265.json:
```json
{
    "body": "<a id='comment:91'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-09T02:08:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475265",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:91'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475266.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,55 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)\n+\n+**Instructions for testing:**\n+\n+```\n+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin\n+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+$ sage\n+``` \n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building wheels on macOS that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+or\n+\n+```\n+tox -e local-macos-10.15-nohomebrew-python3_xcode -- sage-wheels\n+```\n+\n+This creates:\n+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n+\n+Build for Linux:\n+\n+```\n+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels\n+\n+```\n+\n+**Follow-up steps:** \n+- build wheels for `manylinux` using `tox -e docker-manylinux....`\n+  - wheel is much too big: 2.3GB\n+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`)\n+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-04-09T02:08:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475266",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,55 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)
+
+**Instructions for testing:**
+
+```
+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin
+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+$ sage
+``` 
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building wheels on macOS that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+or
+
+```
+tox -e local-macos-10.15-nohomebrew-python3_xcode -- sage-wheels
+```
+
+This creates:
+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl
+
+Build for Linux:
+
+```
+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels
+
+```
+
+**Follow-up steps:** 
+- build wheels for `manylinux` using `tox -e docker-manylinux....`
+  - wheel is much too big: 2.3GB
+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`)
+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475267.json:
```json
{
    "body": "<a id='comment:93'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-10T18:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475267",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:93'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475268.json:
```json
{
    "body": "<a id='comment:94'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-11T16:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475268",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:94'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475269.json:
```json
{
    "body": "<a id='comment:96'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-11T17:02:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475269",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:96'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475270.json:
```json
{
    "body": "<a id='comment:97'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-11T17:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475270",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:97'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475271.json:
```json
{
    "body": "<a id='comment:98'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-11T03:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475271",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:98'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475272.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-06-06T20:18:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475272",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_475273.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-07T02:04:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475273",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475274.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-07T02:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475274",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475275.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-07T18:35:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475275",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475276.json:
```json
{
    "body": "<a id='comment:5'></a>Installation with `/usr/bin/python3 -m pip install -I --user https://github.com/sagemath/sage-wheels/releases/download/9.4.beta1/sage_conf-9.4b1-cp38-cp38-macosx_11_0_x86_64.whl https://github.com/sagemath/sage-wheels/releases/download/9.4.beta1/sagemath_standard-9.4b1-cp38-cp38-macosx_11_0_x86_64.whl` fails with:\n\n```\nCollecting argon2-cffi (from notebook>=4.4.1->widgetsnbextension~=3.5.0->ipywidgets>=7.5.1->sagemath-standard==9.4b1)\n  Downloading https://files.pythonhosted.org/packages/74/fd/d78e003a79c453e8454197092fce9d1c6099445b7e7da0b04eb4fe1dbab7/argon2-cffi-20.1.0.tar.gz (1.8MB)\n[...]\nFailed to build argon2-cffi\n```",
    "created_at": "2021-06-07T23:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475276",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>Installation with `/usr/bin/python3 -m pip install -I --user https://github.com/sagemath/sage-wheels/releases/download/9.4.beta1/sage_conf-9.4b1-cp38-cp38-macosx_11_0_x86_64.whl https://github.com/sagemath/sage-wheels/releases/download/9.4.beta1/sagemath_standard-9.4b1-cp38-cp38-macosx_11_0_x86_64.whl` fails with:

```
Collecting argon2-cffi (from notebook>=4.4.1->widgetsnbextension~=3.5.0->ipywidgets>=7.5.1->sagemath-standard==9.4b1)
  Downloading https://files.pythonhosted.org/packages/74/fd/d78e003a79c453e8454197092fce9d1c6099445b7e7da0b04eb4fe1dbab7/argon2-cffi-20.1.0.tar.gz (1.8MB)
[...]
Failed to build argon2-cffi
```



---

archive/issue_comments_475277.json:
```json
{
    "body": "<a id='comment:6'></a>#29039 is listed as a dependency, is it an error?",
    "created_at": "2021-06-08T11:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475277",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>#29039 is listed as a dependency, is it an error?



---

archive/issue_comments_475278.json:
```json
{
    "body": "<a id='comment:7'></a>No, that's correct",
    "created_at": "2021-06-09T13:00:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475278",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>No, that's correct



---

archive/issue_comments_475279.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-06-25T07:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475279",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_475280.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-06-25T19:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475280",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_475281.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-06-25T19:37:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475281",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_475282.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-06-25T20:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475282",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_475283.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,63 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)\n+\n+**Instructions for testing:**\n+\n+```\n+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin\n+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+$ sage\n+``` \n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building wheels on macOS Catalina that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+or\n+\n+```\n+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+This creates:\n+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n+\n+\n+Build for macOS Big Sur:\n+\n+```\n+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+\n+Build for Linux:\n+\n+```\n+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels\n+\n+```\n+\n+**Follow-up steps:** \n+- build wheels for `manylinux` using `tox -e docker-manylinux....`\n+  - wheel is much too big: 2.3GB\n+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`)\n+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-06-26T13:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475283",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,63 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)
+
+**Instructions for testing:**
+
+```
+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin
+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+$ sage
+``` 
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building wheels on macOS Catalina that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+or
+
+```
+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+This creates:
+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl
+
+
+Build for macOS Big Sur:
+
+```
+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+
+Build for Linux:
+
+```
+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels
+
+```
+
+**Follow-up steps:** 
+- build wheels for `manylinux` using `tox -e docker-manylinux....`
+  - wheel is much too big: 2.3GB
+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`)
+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475284.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-26T18:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475284",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475285.json:
```json
{
    "body": "<a id='comment:5'></a><deleted - meant to be on #31456>",
    "created_at": "2021-06-27T10:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475285",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a><deleted - meant to be on #31456>



---

archive/issue_comments_475286.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-07-24T19:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475286",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_events_082251.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-24T19:59:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31396#event-82251"
}
```



---

archive/issue_events_082252.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-24T19:59:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31396#event-82252"
}
```



---

archive/issue_comments_475287.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-12T21:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475287",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475288.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,63 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)\n+\n+**Instructions for testing:**\n+\n+```\n+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin\n+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+$ sage\n+``` \n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building wheels on macOS Catalina that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+or\n+\n+```\n+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+This creates:\n+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n+\n+\n+Build for macOS Big Sur:\n+\n+```\n+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+\n+Build for Linux:\n+\n+```\n+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels\n+\n+```\n+\n+**Follow-up steps:** \n+- build wheels for `manylinux` using `tox -e docker-manylinux....`\n+  - wheel is much too big: 2.3GB\n+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`)\n+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-08-12T21:50:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475288",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,63 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)
+
+**Instructions for testing:**
+
+```
+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin
+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+$ sage
+``` 
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building wheels on macOS Catalina that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+or
+
+```
+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+This creates:
+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl
+
+
+Build for macOS Big Sur:
+
+```
+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+
+Build for Linux:
+
+```
+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels
+
+```
+
+**Follow-up steps:** 
+- build wheels for `manylinux` using `tox -e docker-manylinux....`
+  - wheel is much too big: 2.3GB
+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`)
+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475289.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-12T22:19:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475289",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475290.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-09-27T04:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475290",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_475291.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-28T01:31:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475291",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475292.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,63 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)\n+\n+**Instructions for testing:**\n+\n+```\n+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin\n+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+$ sage\n+``` \n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building wheels on macOS Catalina that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+or\n+\n+```\n+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+This creates:\n+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n+\n+\n+Build for macOS Big Sur:\n+\n+```\n+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+\n+Build for Linux:\n+\n+```\n+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels\n+\n+```\n+\n+**Follow-up steps:** \n+- build wheels for `manylinux` using `tox -e docker-manylinux....`\n+  - wheel is much too big: 2.3GB\n+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`\n+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-10-10T06:07:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475292",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,63 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)
+
+**Instructions for testing:**
+
+```
+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin
+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+$ sage
+``` 
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building wheels on macOS Catalina that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+or
+
+```
+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+This creates:
+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl
+
+
+Build for macOS Big Sur:
+
+```
+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+
+Build for Linux:
+
+```
+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels
+
+```
+
+**Follow-up steps:** 
+- build wheels for `manylinux` using `tox -e docker-manylinux....`
+  - wheel is much too big: 2.3GB
+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`
+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475293.json:
```json
{
    "body": "<a id='comment:4'></a>On Linux, `PATH` in testing instructions should start from `$HOME/.local/lib/python3.8` or something like this. There is no `~/Library`, that's macOS-only.",
    "created_at": "2021-10-14T10:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475293",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>On Linux, `PATH` in testing instructions should start from `$HOME/.local/lib/python3.8` or something like this. There is no `~/Library`, that's macOS-only.



---

archive/issue_comments_475294.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,75 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)\n+\n+**Instructions for testing:**\n+\n+1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:\n+\n+```\n+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin\n+```\n+\n+2. Install the wheel in the user scheme:\n+\n+```\n+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+```\n+\n+3. Run the installed sage.\n+\n+```\n+$ sage\n+``` \n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building wheels on macOS Catalina that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+or\n+\n+```\n+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+This creates:\n+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n+\n+\n+Build for macOS Big Sur:\n+\n+```\n+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+\n+Build for Linux:\n+\n+```\n+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels\n+\n+```\n+\n+**Follow-up steps:** \n+- build wheels for `manylinux` using `tox -e docker-manylinux....`\n+  - wheel is much too big: 2.3GB\n+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`\n+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2021-10-23T17:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475294",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,75 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)
+
+**Instructions for testing:**
+
+1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:
+
+```
+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin
+```
+
+2. Install the wheel in the user scheme:
+
+```
+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+```
+
+3. Run the installed sage.
+
+```
+$ sage
+``` 
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building wheels on macOS Catalina that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+or
+
+```
+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+This creates:
+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl
+
+
+Build for macOS Big Sur:
+
+```
+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+
+Build for Linux:
+
+```
+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels
+
+```
+
+**Follow-up steps:** 
+- build wheels for `manylinux` using `tox -e docker-manylinux....`
+  - wheel is much too big: 2.3GB
+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`
+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475295.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-25T03:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475295",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475296.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-11-13T06:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475296",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_475297.json:
```json
{
    "body": "<a id='comment:8'></a>Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475297",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.



---

archive/issue_events_082253.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31396#event-82253"
}
```



---

archive/issue_events_082254.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31396#event-82254"
}
```



---

archive/issue_comments_475298.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-01-01T01:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475298",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_475299.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-01-01T01:43:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475299",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_475300.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-01T02:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475300",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475301.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-01T02:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475301",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475302.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-01T03:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475302",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475303.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-01T05:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475303",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475304.json:
```json
{
    "body": "<a id='comment:7'></a>To avoid the duplication between the two versions of `sage_conf.py.in`, could do what was suggested in #29039#comment:148 - split module `sage_conf` into several modules of a `sage_conf` package",
    "created_at": "2022-01-01T06:01:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475304",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>To avoid the duplication between the two versions of `sage_conf.py.in`, could do what was suggested in #29039#comment:148 - split module `sage_conf` into several modules of a `sage_conf` package



---

archive/issue_comments_475305.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-01T19:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475305",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475306.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,78 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+**We also refactor `sage_conf` to make it easier to maintain variants of it, both the now 3 in-tree variants and downstream variants.**\n+\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)\n+\n+**Instructions for testing:**\n+\n+1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:\n+\n+```\n+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin\n+```\n+\n+2. Install the wheel in the user scheme:\n+\n+```\n+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+```\n+\n+3. Run the installed sage.\n+\n+```\n+$ sage\n+``` \n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building wheels on macOS Catalina that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+or\n+\n+```\n+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+This creates:\n+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n+\n+\n+Build for macOS Big Sur:\n+\n+```\n+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+\n+Build for Linux:\n+\n+```\n+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels\n+\n+```\n+\n+**Follow-up steps:** \n+- build wheels for `manylinux` using `tox -e docker-manylinux....`\n+  - wheel is much too big: 2.3GB\n+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`\n+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2022-01-01T19:50:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475306",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,78 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+**We also refactor `sage_conf` to make it easier to maintain variants of it, both the now 3 in-tree variants and downstream variants.**
+
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)
+
+**Instructions for testing:**
+
+1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:
+
+```
+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin
+```
+
+2. Install the wheel in the user scheme:
+
+```
+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+```
+
+3. Run the installed sage.
+
+```
+$ sage
+``` 
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building wheels on macOS Catalina that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+or
+
+```
+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+This creates:
+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl
+
+
+Build for macOS Big Sur:
+
+```
+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+
+Build for Linux:
+
+```
+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels
+
+```
+
+**Follow-up steps:** 
+- build wheels for `manylinux` using `tox -e docker-manylinux....`
+  - wheel is much too big: 2.3GB
+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`
+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475307.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-01-02T19:37:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475307",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_475308.json:
```json
{
    "body": "<a id='comment:0'></a>Need to get uninstallation of script package `sage_conf` fixed, or switching between branches with `sage_conf.py` and branches with `sage_conf/` will be tricky",
    "created_at": "2022-01-02T19:37:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475308",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:0'></a>Need to get uninstallation of script package `sage_conf` fixed, or switching between branches with `sage_conf.py` and branches with `sage_conf/` will be tricky



---

archive/issue_comments_475309.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-11T17:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475309",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475310.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-11T20:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475310",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475311.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,80 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+**We also refactor `sage_conf` to make it easier to maintain variants of it, both the now 3 in-tree variants and downstream variants:**\n+- The `configure`-generated configuration file is now `pkgs/sage-conf/_sage_conf/_conf.py`\n+- The file `pkgs/sage-conf/sage_conf.py` is now static\n+\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)\n+\n+**Instructions for testing:**\n+\n+1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:\n+\n+```\n+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin\n+```\n+\n+2. Install the wheel in the user scheme:\n+\n+```\n+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+```\n+\n+3. Run the installed sage.\n+\n+```\n+$ sage\n+``` \n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building wheels on macOS Catalina that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+or\n+\n+```\n+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+This creates:\n+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n+\n+\n+Build for macOS Big Sur:\n+\n+```\n+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+\n+Build for Linux:\n+\n+```\n+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels\n+\n+```\n+\n+**Follow-up steps:** \n+- build wheels for `manylinux` using `tox -e docker-manylinux....`\n+  - wheel is much too big: 2.3GB\n+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`\n+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2022-01-11T20:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475311",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,80 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+**We also refactor `sage_conf` to make it easier to maintain variants of it, both the now 3 in-tree variants and downstream variants:**
+- The `configure`-generated configuration file is now `pkgs/sage-conf/_sage_conf/_conf.py`
+- The file `pkgs/sage-conf/sage_conf.py` is now static
+
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)
+
+**Instructions for testing:**
+
+1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:
+
+```
+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin
+```
+
+2. Install the wheel in the user scheme:
+
+```
+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+```
+
+3. Run the installed sage.
+
+```
+$ sage
+``` 
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building wheels on macOS Catalina that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+or
+
+```
+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+This creates:
+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl
+
+
+Build for macOS Big Sur:
+
+```
+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+
+Build for Linux:
+
+```
+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels
+
+```
+
+**Follow-up steps:** 
+- build wheels for `manylinux` using `tox -e docker-manylinux....`
+  - wheel is much too big: 2.3GB
+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`
+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible; 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475312.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-01-11T20:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475312",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_475313.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-01-11T20:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475313",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_475314.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-01-11T20:53:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475314",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_475315.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-01-11T21:02:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475315",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_475316.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-01-11T21:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475316",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_475317.json:
```json
{
    "body": "<a id='comment:0'></a>`tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels`\ncurrently builds a mistagged `sage_conf-9.5rc0-cp38-cp38-macosx_11_0_x86_64.whl`",
    "created_at": "2022-01-12T00:08:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475317",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:0'></a>`tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels`
currently builds a mistagged `sage_conf-9.5rc0-cp38-cp38-macosx_11_0_x86_64.whl`



---

archive/issue_comments_475318.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-16T20:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475318",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475319.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-16T20:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475319",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475320.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-17T00:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475320",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475321.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-17T01:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475321",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475322.json:
```json
{
    "body": "<a id='comment:156'></a>Replying to [comment:150 mkoeppe]:\n> `tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels`\n> currently builds a mistagged `sage_conf-9.5rc0-cp38-cp38-macosx_11_0_x86_64.whl`\n\n\nThat was caused by trash in `pkgs/sage-conf_relocatable/build/`",
    "created_at": "2022-01-17T01:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475322",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:156'></a>Replying to [comment:150 mkoeppe]:
> `tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels`
> currently builds a mistagged `sage_conf-9.5rc0-cp38-cp38-macosx_11_0_x86_64.whl`


That was caused by trash in `pkgs/sage-conf_relocatable/build/`



---

archive/issue_comments_475323.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,80 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+**We also refactor `sage_conf` to make it easier to maintain variants of it, both the now 3 in-tree variants and downstream variants:**\n+- The `configure`-generated configuration file is now `pkgs/sage-conf/_sage_conf/_conf.py`\n+- The file `pkgs/sage-conf/sage_conf.py` is now static\n+\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)\n+\n+**Instructions for testing:**\n+\n+1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:\n+\n+```\n+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin\n+```\n+\n+2. Install the wheel in the user scheme:\n+\n+```\n+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+```\n+\n+3. Run the installed sage.\n+\n+```\n+$ sage\n+``` \n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building wheels on macOS Catalina that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+or\n+\n+```\n+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+This creates:\n+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n+\n+\n+Build for macOS Big Sur:\n+\n+```\n+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+\n+Build for Linux:\n+\n+```\n+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels\n+\n+```\n+\n+**Follow-up steps:** \n+- build wheels for `manylinux` using `tox -e docker-manylinux....`\n+  - wheel is much too big: 2.3GB\n+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`\n+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible -- for example by storing a tar file `sage_root.tar` (with symlinks) instead of including the sage root as a directory - https://docs.python.org/3/library/tarfile.html#tarfile.open \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2022-01-17T01:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475323",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,80 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+**We also refactor `sage_conf` to make it easier to maintain variants of it, both the now 3 in-tree variants and downstream variants:**
+- The `configure`-generated configuration file is now `pkgs/sage-conf/_sage_conf/_conf.py`
+- The file `pkgs/sage-conf/sage_conf.py` is now static
+
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)
+
+**Instructions for testing:**
+
+1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:
+
+```
+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin
+```
+
+2. Install the wheel in the user scheme:
+
+```
+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+```
+
+3. Run the installed sage.
+
+```
+$ sage
+``` 
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building wheels on macOS Catalina that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+or
+
+```
+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+This creates:
+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl
+
+
+Build for macOS Big Sur:
+
+```
+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+
+Build for Linux:
+
+```
+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels
+
+```
+
+**Follow-up steps:** 
+- build wheels for `manylinux` using `tox -e docker-manylinux....`
+  - wheel is much too big: 2.3GB
+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`
+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible -- for example by storing a tar file `sage_root.tar` (with symlinks) instead of including the sage root as a directory - https://docs.python.org/3/library/tarfile.html#tarfile.open 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475324.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,85 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+**We also refactor `sage_conf` to make it easier to maintain variants of it, both the now 3 in-tree variants and downstream variants:**\n+- The `configure`-generated configuration file is now `pkgs/sage-conf/_sage_conf/_conf.py`\n+- The file `pkgs/sage-conf/sage_conf.py` is now static\n+\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)\n+\n+**Instructions for testing:**\n+\n+1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:\n+\n+```\n+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin\n+```\n+\n+2. Install the wheel in the user scheme:\n+\n+```\n+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+```\n+\n+3. Run the installed sage.\n+\n+```\n+$ sage\n+``` \n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building wheels on macOS Catalina that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+or\n+\n+```\n+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+This creates:\n+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n+\n+Build for macOS Big Sur:\n+\n+```\n+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+Build for macOS Monterey:\n+\n+```\n+tox -e local-macos-12.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+\n+Build for Linux:\n+\n+```\n+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels\n+\n+```\n+\n+**Follow-up steps:** \n+- build wheels for `manylinux` using `tox -e docker-manylinux....`\n+  - wheel is much too big: 2.3GB\n+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`\n+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible -- for example by storing a tar file `sage_root.tar` (with symlinks) instead of including the sage root as a directory - https://docs.python.org/3/library/tarfile.html#tarfile.open \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2022-01-17T04:12:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475324",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,85 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+**We also refactor `sage_conf` to make it easier to maintain variants of it, both the now 3 in-tree variants and downstream variants:**
+- The `configure`-generated configuration file is now `pkgs/sage-conf/_sage_conf/_conf.py`
+- The file `pkgs/sage-conf/sage_conf.py` is now static
+
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)
+
+**Instructions for testing:**
+
+1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:
+
+```
+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin
+```
+
+2. Install the wheel in the user scheme:
+
+```
+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+```
+
+3. Run the installed sage.
+
+```
+$ sage
+``` 
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building wheels on macOS Catalina that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+or
+
+```
+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+This creates:
+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl
+
+Build for macOS Big Sur:
+
+```
+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+Build for macOS Monterey:
+
+```
+tox -e local-macos-12.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+
+Build for Linux:
+
+```
+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels
+
+```
+
+**Follow-up steps:** 
+- build wheels for `manylinux` using `tox -e docker-manylinux....`
+  - wheel is much too big: 2.3GB
+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`
+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible -- for example by storing a tar file `sage_root.tar` (with symlinks) instead of including the sage root as a directory - https://docs.python.org/3/library/tarfile.html#tarfile.open 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475325.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,85 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+**We also refactor `sage_conf` to make it easier to maintain variants of it, both the now 3 in-tree variants and downstream variants:**\n+- The `configure`-generated configuration file is now `pkgs/sage-conf/_sage_conf/_conf.py`\n+- The file `pkgs/sage-conf/sage_conf.py` is now static\n+\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)\n+\n+**Instructions for testing:**\n+\n+1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:\n+\n+```\n+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin\n+```\n+\n+2. Install the wheel in the user scheme:\n+\n+```\n+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+```\n+\n+3. Run the installed sage.\n+\n+```\n+$ sage\n+``` \n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building wheels on macOS Catalina that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+or\n+\n+```\n+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+This creates:\n+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n+\n+Build for macOS Big Sur (requires a machine running Big Sur or Monterey):\n+\n+```\n+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+Build for macOS Monterey (requires a machine running Monterey)\n+\n+```\n+tox -e local-macos-12.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+\n+Build for Linux:\n+\n+```\n+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels\n+\n+```\n+\n+**Follow-up steps:** \n+- build wheels for `manylinux` using `tox -e docker-manylinux....`\n+  - wheel is much too big: 2.3GB\n+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`\n+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible -- for example by storing a tar file `sage_root.tar` (with symlinks) instead of including the sage root as a directory - https://docs.python.org/3/library/tarfile.html#tarfile.open \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2022-01-17T04:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475325",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,85 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+**We also refactor `sage_conf` to make it easier to maintain variants of it, both the now 3 in-tree variants and downstream variants:**
+- The `configure`-generated configuration file is now `pkgs/sage-conf/_sage_conf/_conf.py`
+- The file `pkgs/sage-conf/sage_conf.py` is now static
+
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)
+
+**Instructions for testing:**
+
+1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:
+
+```
+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin
+```
+
+2. Install the wheel in the user scheme:
+
+```
+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+```
+
+3. Run the installed sage.
+
+```
+$ sage
+``` 
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building wheels on macOS Catalina that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+or
+
+```
+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+This creates:
+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl
+
+Build for macOS Big Sur (requires a machine running Big Sur or Monterey):
+
+```
+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+Build for macOS Monterey (requires a machine running Monterey)
+
+```
+tox -e local-macos-12.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+
+Build for Linux:
+
+```
+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels
+
+```
+
+**Follow-up steps:** 
+- build wheels for `manylinux` using `tox -e docker-manylinux....`
+  - wheel is much too big: 2.3GB
+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`
+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible -- for example by storing a tar file `sage_root.tar` (with symlinks) instead of including the sage root as a directory - https://docs.python.org/3/library/tarfile.html#tarfile.open 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475326.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-17T07:38:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475326",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475327.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,86 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+**We also refactor `sage_conf` to make it easier to maintain variants of it, both the now 3 in-tree variants and downstream variants:**\n+- The `configure`-generated configuration file is now `pkgs/sage-conf/_sage_conf/_conf.py`\n+- The file `pkgs/sage-conf/sage_conf.py` is now static\n+\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)\n+\n+**Instructions for testing:**\n+\n+1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:\n+\n+```\n+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin\n+```\n+\n+2. Install the wheel in the user scheme:\n+\n+```\n+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+```\n+\n+3. Run the installed sage.\n+\n+```\n+$ sage\n+``` \n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building wheels on macOS Catalina that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+or\n+\n+```\n+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+This creates:\n+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n+\n+Build for macOS Big Sur (requires a machine running Big Sur or Monterey):\n+\n+```\n+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+Build for macOS Monterey (requires a machine running Monterey)\n+\n+```\n+tox -e local-macos-12.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+\n+Build for Linux:\n+\n+```\n+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels\n+\n+```\n+\n+**Follow-up steps:** \n+- also build a **sagemath-standard** wheel\n+- build wheels for `manylinux` using `tox -e docker-manylinux....`\n+  - wheel is much too big: 2.3GB\n+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`\n+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible -- for example by storing a tar file `sage_root.tar` (with symlinks) instead of including the sage root as a directory - https://docs.python.org/3/library/tarfile.html#tarfile.open \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2022-01-18T18:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475327",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,86 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+**We also refactor `sage_conf` to make it easier to maintain variants of it, both the now 3 in-tree variants and downstream variants:**
+- The `configure`-generated configuration file is now `pkgs/sage-conf/_sage_conf/_conf.py`
+- The file `pkgs/sage-conf/sage_conf.py` is now static
+
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)
+
+**Instructions for testing:**
+
+1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:
+
+```
+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin
+```
+
+2. Install the wheel in the user scheme:
+
+```
+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+```
+
+3. Run the installed sage.
+
+```
+$ sage
+``` 
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building wheels on macOS Catalina that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+or
+
+```
+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+This creates:
+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl
+
+Build for macOS Big Sur (requires a machine running Big Sur or Monterey):
+
+```
+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+Build for macOS Monterey (requires a machine running Monterey)
+
+```
+tox -e local-macos-12.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+
+Build for Linux:
+
+```
+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels
+
+```
+
+**Follow-up steps:** 
+- also build a **sagemath-standard** wheel
+- build wheels for `manylinux` using `tox -e docker-manylinux....`
+  - wheel is much too big: 2.3GB
+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`
+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible -- for example by storing a tar file `sage_root.tar` (with symlinks) instead of including the sage root as a directory - https://docs.python.org/3/library/tarfile.html#tarfile.open 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475328.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,86 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+**We also refactor `sage_conf` to make it easier to maintain variants of it, both the now 3 in-tree variants and downstream variants:**\n+- The `configure`-generated configuration file is now `pkgs/sage-conf/_sage_conf/_conf.py`\n+- The file `pkgs/sage-conf/sage_conf.py` is now static\n+\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/tag/9.5.rc2, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)\n+\n+**Instructions for testing:**\n+\n+1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:\n+\n+```\n+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin\n+```\n+\n+2. Install the wheel in the user scheme:\n+\n+```\n+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+```\n+\n+3. Run the installed sage.\n+\n+```\n+$ sage\n+``` \n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building wheels on macOS Catalina that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+or\n+\n+```\n+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+This creates (uploaded to https://github.com/sagemath/sage-wheels/releases/tag/9.5.rc2)\n+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n+\n+Build for macOS Big Sur (requires a machine running Big Sur or Monterey) (uploaded to https://github.com/sagemath/sage-wheels/releases/tag/9.5.rc2)\n+\n+```\n+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+Build for macOS Monterey (requires a machine running Monterey)\n+\n+```\n+tox -e local-macos-12.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+\n+Build for Linux (does not work yet):\n+\n+```\n+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels\n+\n+```\n+\n+**Follow-up steps:** \n+- also build a **sagemath-standard** wheel\n+- build wheels for `manylinux` using `tox -e docker-manylinux....`\n+  - wheel is much too big: 2.3GB\n+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`\n+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible -- for example by storing a tar file `sage_root.tar` (with symlinks) instead of including the sage root as a directory - https://docs.python.org/3/library/tarfile.html#tarfile.open \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2022-01-18T22:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475328",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,86 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+**We also refactor `sage_conf` to make it easier to maintain variants of it, both the now 3 in-tree variants and downstream variants:**
+- The `configure`-generated configuration file is now `pkgs/sage-conf/_sage_conf/_conf.py`
+- The file `pkgs/sage-conf/sage_conf.py` is now static
+
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/tag/9.5.rc2, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)
+
+**Instructions for testing:**
+
+1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:
+
+```
+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin
+```
+
+2. Install the wheel in the user scheme:
+
+```
+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+```
+
+3. Run the installed sage.
+
+```
+$ sage
+``` 
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building wheels on macOS Catalina that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+or
+
+```
+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+This creates (uploaded to https://github.com/sagemath/sage-wheels/releases/tag/9.5.rc2)
+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl
+
+Build for macOS Big Sur (requires a machine running Big Sur or Monterey) (uploaded to https://github.com/sagemath/sage-wheels/releases/tag/9.5.rc2)
+
+```
+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+Build for macOS Monterey (requires a machine running Monterey)
+
+```
+tox -e local-macos-12.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+
+Build for Linux (does not work yet):
+
+```
+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels
+
+```
+
+**Follow-up steps:** 
+- also build a **sagemath-standard** wheel
+- build wheels for `manylinux` using `tox -e docker-manylinux....`
+  - wheel is much too big: 2.3GB
+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`
+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible -- for example by storing a tar file `sage_root.tar` (with symlinks) instead of including the sage root as a directory - https://docs.python.org/3/library/tarfile.html#tarfile.open 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475329.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-01-18T22:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475329",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_475330.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-05T17:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475330",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475331.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-05T17:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475331",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_082255.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T17:54:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31396#event-82255"
}
```



---

archive/issue_events_082256.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T17:54:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31396#event-82256"
}
```



---

archive/issue_comments_475332.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-03T01:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475332",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475333.json:
```json
{
    "body": "<a id='comment:0'></a>There seem to be merge conflicts.",
    "created_at": "2022-06-16T18:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475333",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:0'></a>There seem to be merge conflicts.



---

archive/issue_comments_475334.json:
```json
{
    "body": "<a id='comment:1'></a>Do you want this to be reviewed & merged even though it does not work on Linux yet? Or does it work by now?",
    "created_at": "2022-06-16T18:01:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475334",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:1'></a>Do you want this to be reviewed & merged even though it does not work on Linux yet? Or does it work by now?



---

archive/issue_comments_475335.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-06-16T18:01:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475335",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_475336.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-17T18:58:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475336",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475337.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-06-17T18:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475337",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_475338.json:
```json
{
    "body": "<a id='comment:174'></a>Replying to [comment:171 saraedum]:\n> Do you want this to be reviewed & merged even though it does not work on Linux yet?\n\n\nYes, that would be great!",
    "created_at": "2022-06-17T18:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475338",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:174'></a>Replying to [comment:171 saraedum]:
> Do you want this to be reviewed & merged even though it does not work on Linux yet?


Yes, that would be great!



---

archive/issue_comments_475339.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-01T02:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475339",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475340.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-07-11T00:32:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475340",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_475341.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-11T03:48:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475341",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475342.json:
```json
{
    "body": "<a id='comment:9'></a>There's an isolated\n\n```\n+        #\n```\n\nIs a comment missing there?",
    "created_at": "2022-07-14T20:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475342",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:9'></a>There's an isolated

```
+        #
```

Is a comment missing there?



---

archive/issue_comments_475343.json:
```json
{
    "body": "<a id='comment:0'></a>I don't understand the `STICKY` business. Why is there a hardcoded `/var/tmp` there?",
    "created_at": "2022-07-14T20:25:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475343",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:0'></a>I don't understand the `STICKY` business. Why is there a hardcoded `/var/tmp` there?



---

archive/issue_comments_475344.json:
```json
{
    "body": "<a id='comment:1'></a>Is the plan to eventually make these wheels available on PyPI?",
    "created_at": "2022-07-14T20:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475344",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:1'></a>Is the plan to eventually make these wheels available on PyPI?



---

archive/issue_comments_475345.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2022-07-14T20:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475345",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_475346.json:
```json
{
    "body": "<a id='comment:2'></a>Note to self. I don't really understand what `pkgs/sage-conf_relocatable/setup.py` does because of the above. The rest looks fine.",
    "created_at": "2022-07-14T20:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475346",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:2'></a>Note to self. I don't really understand what `pkgs/sage-conf_relocatable/setup.py` does because of the above. The rest looks fine.



---

archive/issue_comments_475347.json:
```json
{
    "body": "<a id='comment:3'></a>/var/tmp is a sticky directory, meaning every user can create a new subdirectory, which then securely belongs to them.\n\nThe README of https://pypi.org/project/sage-conf/ (section \"sage_conf wheels\") explains more",
    "created_at": "2022-07-14T20:38:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475347",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>/var/tmp is a sticky directory, meaning every user can create a new subdirectory, which then securely belongs to them.

The README of https://pypi.org/project/sage-conf/ (section "sage_conf wheels") explains more



---

archive/issue_comments_475348.json:
```json
{
    "body": "<a id='comment:184'></a>Replying to [comment:181 saraedum]:\n> Is the plan to eventually make these wheels available on PyPI?\n\n\nTicket description explains why they can't go to PyPI.",
    "created_at": "2022-07-14T20:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475348",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:184'></a>Replying to [comment:181 saraedum]:
> Is the plan to eventually make these wheels available on PyPI?


Ticket description explains why they can't go to PyPI.



---

archive/issue_comments_475349.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,82 @@\n+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).\n+\n+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.\n+\n+\n+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  \n+\n+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on \n+https://github.com/sagemath/sage-wheels/releases/tag/9.5.rc2, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. \n+Hence, the pip invocation needs to use a URL.\n+\n+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)\n+\n+**Instructions for testing:**\n+\n+1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:\n+\n+```\n+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin\n+```\n+\n+2. Install the wheel in the user scheme:\n+\n+```\n+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+```\n+\n+3. Run the installed sage.\n+\n+```\n+$ sage\n+``` \n+\n+**Procedure for building the sage_conf wheel and compatible wheels:**\n+\n+\n+For building wheels on macOS Catalina that uses XCode python 3.8:\n+\n+```\n+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash\n+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)\n+```\n+or\n+\n+```\n+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+This creates (uploaded to https://github.com/sagemath/sage-wheels/releases/tag/9.5.rc2)\n+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl\n+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl\n+\n+Build for macOS Big Sur (requires a machine running Big Sur or Monterey) (uploaded to https://github.com/sagemath/sage-wheels/releases/tag/9.5.rc2)\n+\n+```\n+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+Build for macOS Monterey (requires a machine running Monterey)\n+\n+```\n+tox -e local-macos-12.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels\n+```\n+\n+\n+Build for Linux (does not work yet):\n+\n+```\n+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels\n+\n+```\n+\n+**Follow-up steps:** \n+- also build a **sagemath-standard** wheel\n+- build wheels for `manylinux` using `tox -e docker-manylinux....`\n+  - wheel is much too big: 2.3GB\n+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`\n+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible -- for example by storing a tar file `sage_root.tar` (with symlinks) instead of including the sage root as a directory - https://docs.python.org/3/library/tarfile.html#tarfile.open \n+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.\n \n \n Dependencies: #29039\n```\n",
    "created_at": "2022-07-14T20:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475349",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,82 @@
+This version of `sage_conf` is for making a wheel that packages the precompiled non-Python bits of the Sage distribution, making `SAGE_ROOT` (and thus `SAGE_LOCAL=$SAGE_ROOT/local`) relocatable using Marc Culler's symbolic link surgery (the method proposed in #31076, using `SAGE_ROOT=/var/tmp/sage-...` and a symlink).
+
+The `sage` script invokes `sage-config` to determine `SAGE_ROOT` and `SAGE_LOCAL`. In the version of `sage-config` supplied by this version of `sage_conf`, we ensure that the symlink from `/var/tmp/sage-....` to the actual install location is set.
+
+
+So far, a wheel has been built for XCode python 3.8 on macOS 10.15.  The wheel is 670MB in size, an order of magnitude above the standard file size limit on PyPI; but a file size limit increase (requested in  https://github.com/pypa/pypi-support/issues/985) has kindly been granted by the PyPI team.  
+
+The wheel declares dependencies (`install-requires`) to all Python packages in the Sage distribution that have extension modules.  The dependencies are specific using ``@`` to URLs on 
+https://github.com/sagemath/sage-wheels/releases/tag/9.5.rc2, where I have uploaded the binary wheels.  Unfortunately, by PyPI policy, such ``@`` references are not allowed for packages on PyPI. 
+Hence, the pip invocation needs to use a URL.
+
+(See also https://twitter.com/mkoeppe_math/status/1378860285537054723)
+
+**Instructions for testing:**
+
+1. Make sure that the `bin` directory of the user installation scheme is in `PATH`. For example, on macOS:
+
+```
+$ export PATH=$HOME/Library/Python/3.8/bin:/usr/bin:/bin:/usr/sbin:/sbin
+```
+
+2. Install the wheel in the user scheme:
+
+```
+$ /usr/bin/python3 -m pip install -U --user  https://github.com/sagemath/sage-wheels/releases/download/9.3.rc1/sagemath_standard-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+```
+
+3. Run the installed sage.
+
+```
+$ sage
+``` 
+
+**Procedure for building the sage_conf wheel and compatible wheels:**
+
+
+For building wheels on macOS Catalina that uses XCode python 3.8:
+
+```
+$ SKIP_CONFIGURE=1 tox -e local-macos-10.15-nohomebrew-python3_xcode -- bash
+(tox -e ...) $ (cd src/pkgs/sage_conf-relocatable/ && python3 setup.py bdist_wheel --plat-name macosx_10_15_x86_64)
+```
+or
+
+```
+tox -e local-macos-10.15-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+This creates (uploaded to https://github.com/sagemath/sage-wheels/releases/tag/9.5.rc2)
+- src/pkgs/sage_conf-relocatable/dist/sage_conf-9.3rc1-cp38-cp38-macosx_10_15_x86_64.whl
+- src/pkgs/sage_conf-relocatable/sage_root/venv-cpython-38-darwin-macosx_10_15_x86_64/var/lib/sage/wheels/*.whl
+
+Build for macOS Big Sur (requires a machine running Big Sur or Monterey) (uploaded to https://github.com/sagemath/sage-wheels/releases/tag/9.5.rc2)
+
+```
+tox -e local-macos-11.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+Build for macOS Monterey (requires a machine running Monterey)
+
+```
+tox -e local-macos-12.1-nohomebrew-python3_xcode -- SAGE_CHECK=no sage-wheels
+```
+
+
+Build for Linux (does not work yet):
+
+```
+$ TARGETS_PRE=Makefile tox -e docker-manylinux-2_24-minimal-python3.9 -- sage-wheels
+
+```
+
+**Follow-up steps:** 
+- also build a **sagemath-standard** wheel
+- build wheels for `manylinux` using `tox -e docker-manylinux....`
+  - wheel is much too big: 2.3GB
+  - auditwheel complains: `RuntimeError: Invalid binary wheel, found the following shared library/libraries in purelib folder:`; so we should replace our current abuse of package data (`install_data`) by platlib (`install_lib`). https://github.com/pypa/packaging-problems/issues/542#issuecomment-912838470: subclass `build_ext` instead of `build_py`
+- disable building the dependencies of the sphinx packages; remove unneeded static libraries; remove duplicated/triplicated shared libraries if possible -- for example by storing a tar file `sage_root.tar` (with symlinks) instead of including the sage root as a directory - https://docs.python.org/3/library/tarfile.html#tarfile.open 
+- #31602: split out `sage_root` from `sage_conf` and use install-requires in the `sage_conf` sdist/wheel with `@` links to GH releases to the `sage_root` wheel and the built non-`any` wheels.
 
 
 Dependencies: #29039
```




---

archive/issue_comments_475350.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-27T01:53:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475350",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475351.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2022-07-27T03:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475351",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_events_082257.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31396#event-82257"
}
```



---

archive/issue_events_082258.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31396#event-82258"
}
```



---

archive/issue_comments_475352.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-12-14T22:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475352",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_475353.json:
```json
{
    "body": "<a id='comment:9'></a>Sorry for not having a look at this ticket for a while. There are merge conflicts now btw.",
    "created_at": "2022-12-14T22:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475353",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:9'></a>Sorry for not having a look at this ticket for a while. There are merge conflicts now btw.



---

archive/issue_comments_475354.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-15T01:16:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31396#issuecomment-475354",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:
