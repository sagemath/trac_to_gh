# Issue 31005: Add traceback information to exceptions during docbuild

archive/issues_030768.json:
```json
{
    "body": "The docbuild was failing for me, and it was hard to track down where the original error occurred because there was no (proper) traceback information. In this ticket, such a traceback information is added for exceptions in the docbuild worker following the approach taken in https://bugs.python.org/issue13831.\n\nExample output:\n\n```\nsage_setup.docbuild.utils.RemoteException: \n\"\"\"\nTraceback (most recent call last):\n  File \"/mnt/d/Programming/sage/src/sage_setup/docbuild/utils.py\", line 179, in run_worker\n    result = target(task)\n  File \"/mnt/d/Programming/sage/src/a_test_docbuild_exc.py\", line 7, in target\n    1 / 0\nZeroDivisionError: division by zero\n\"\"\"\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/mnt/d/Programming/sage/src/a_test_docbuild_exc.py\", line 12, in <module>\n    build_many(target, range(8), processes=8)\n  File \"/mnt/d/Programming/sage/src/sage_setup/docbuild/utils.py\", line 336, in build_many\n    raise worker_exc.original_exception\nZeroDivisionError: division by zero\n```\nfor the test file\n\n```\nfrom sage_setup.docbuild.utils import build_many\n\ndef target(N):\n    import time, os, signal\n    if N == 1:\n        # Task 4 is a poison pill\n        1 / 0\n    else:\n        time.sleep(0.5)\n        print('Processed task %s' % N)\n\nbuild_many(target, range(8), processes=8)\n```\n\nCC:  @dimpase @jhpalmieri @seblabbe @slel @orlitzky\n\nBranch/Commit: c37d055673bb573423a3200a6a715db567de436f\n\nReviewer: Michael Orlitzky\n\nAuthor: Tobias Diez\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31005\n\n",
    "closed_at": "2022-02-16T23:56:48Z",
    "created_at": "2020-12-04T12:32:58Z",
    "labels": [
        "component: documentation",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Add traceback information to exceptions during docbuild",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31005",
    "user": "https://github.com/tobiasdiez"
}
```
The docbuild was failing for me, and it was hard to track down where the original error occurred because there was no (proper) traceback information. In this ticket, such a traceback information is added for exceptions in the docbuild worker following the approach taken in https://bugs.python.org/issue13831.

Example output:

```
sage_setup.docbuild.utils.RemoteException: 
"""
Traceback (most recent call last):
  File "/mnt/d/Programming/sage/src/sage_setup/docbuild/utils.py", line 179, in run_worker
    result = target(task)
  File "/mnt/d/Programming/sage/src/a_test_docbuild_exc.py", line 7, in target
    1 / 0
ZeroDivisionError: division by zero
"""

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/mnt/d/Programming/sage/src/a_test_docbuild_exc.py", line 12, in <module>
    build_many(target, range(8), processes=8)
  File "/mnt/d/Programming/sage/src/sage_setup/docbuild/utils.py", line 336, in build_many
    raise worker_exc.original_exception
ZeroDivisionError: division by zero
```
for the test file

```
from sage_setup.docbuild.utils import build_many

def target(N):
    import time, os, signal
    if N == 1:
        # Task 4 is a poison pill
        1 / 0
    else:
        time.sleep(0.5)
        print('Processed task %s' % N)

build_many(target, range(8), processes=8)
```

CC:  @dimpase @jhpalmieri @seblabbe @slel @orlitzky

Branch/Commit: c37d055673bb573423a3200a6a715db567de436f

Reviewer: Michael Orlitzky

Author: Tobias Diez

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31005





---

archive/issue_comments_615664.json:
```json
{
    "body": "Changing author from \"\" to \"Tobias Diez\"",
    "created_at": "2020-12-04T12:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615664",
    "user": "https://github.com/tobiasdiez"
}
```

Changing author from "" to "Tobias Diez"



---

archive/issue_comments_615665.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-12-04T12:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615665",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_615666.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-12-09T11:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615666",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_615667.json:
```json
{
    "body": "<a id='comment:3'></a>\nThe patchbot reports failures for the files that are changed by the branch:\n\n```\n----------------------------------------------------------------------\nsage -t --long --warn-long 40.9 --random-seed=0 src/sage_setup/docbuild/utils.py  # 1 doctest failed\nsage -t --long --warn-long 40.9 --random-seed=0 src/sage_setup/docbuild/__init__.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n\nTo help the review, may you add an example in the description field of the kind of new information printed in the dochtml.log when an error (warning) occurs?",
    "created_at": "2020-12-09T11:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615667",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:3'></a>
The patchbot reports failures for the files that are changed by the branch:

```
----------------------------------------------------------------------
sage -t --long --warn-long 40.9 --random-seed=0 src/sage_setup/docbuild/utils.py  # 1 doctest failed
sage -t --long --warn-long 40.9 --random-seed=0 src/sage_setup/docbuild/__init__.py  # 1 doctest failed
----------------------------------------------------------------------
```

To help the review, may you add an example in the description field of the kind of new information printed in the dochtml.log when an error (warning) occurs?



---

archive/issue_comments_615668.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|\n|[d70709f](https://github.com/sagemath/sagetrac-mirror/commit/d70709f902940df149ce85083b4c5c7a45a87b67)|`Merge branch 'develop' of git://github.com/sagemath/sage into public/documentation/add_traceback`|\n|[f10a30c](https://github.com/sagemath/sagetrac-mirror/commit/f10a30c28aff52988557a461f80af6234fd24535)|`Don't try to prickle the complete traceback`|",
    "created_at": "2021-01-09T15:18:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615668",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|
|[d70709f](https://github.com/sagemath/sagetrac-mirror/commit/d70709f902940df149ce85083b4c5c7a45a87b67)|`Merge branch 'develop' of git://github.com/sagemath/sage into public/documentation/add_traceback`|
|[f10a30c](https://github.com/sagemath/sagetrac-mirror/commit/f10a30c28aff52988557a461f80af6234fd24535)|`Don't try to prickle the complete traceback`|



---

archive/issue_comments_615669.json:
```json
{
    "body": "Changing commit from \"612e0c1aa08d6500cff0e7c3f6d44d573329d932\" to \"f10a30c28aff52988557a461f80af6234fd24535\"",
    "created_at": "2021-01-09T15:18:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615669",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "612e0c1aa08d6500cff0e7c3f6d44d573329d932" to "f10a30c28aff52988557a461f80af6234fd24535"



---

archive/issue_comments_615670.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,40 @@\n-The docbuild was failing for me, and it was hard to track down where the original error occurred because there was no (proper) traceback information. In this ticket, such a traceback information is added for exceptions in the docbuild worker.\n+The docbuild was failing for me, and it was hard to track down where the original error occurred because there was no (proper) traceback information. In this ticket, such a traceback information is added for exceptions in the docbuild worker following the approach taken in https://bugs.python.org/issue13831.\n+\n+Example output:\n+\n+```\n+sage_setup.docbuild.utils.RemoteException: \n+\"\"\"\n+Traceback (most recent call last):\n+  File \"/mnt/d/Programming/sage/src/sage_setup/docbuild/utils.py\", line 179, in run_worker\n+    result = target(task)\n+  File \"/mnt/d/Programming/sage/src/a_test_docbuild_exc.py\", line 7, in target\n+    1 / 0\n+ZeroDivisionError: division by zero\n+\"\"\"\n+\n+The above exception was the direct cause of the following exception:\n+\n+Traceback (most recent call last):\n+  File \"/mnt/d/Programming/sage/src/a_test_docbuild_exc.py\", line 12, in <module>\n+    build_many(target, range(8), processes=8)\n+  File \"/mnt/d/Programming/sage/src/sage_setup/docbuild/utils.py\", line 336, in build_many\n+    raise worker_exc.original_exception\n+ZeroDivisionError: division by zero\n+```\n+for the test file\n+\n+```\n+from sage_setup.docbuild.utils import build_many\n+\n+def target(N):\n+    import time, os, signal\n+    if N == 1:\n+        # Task 4 is a poison pill\n+        1 / 0\n+    else:\n+        time.sleep(0.5)\n+        print('Processed task %s' % N)\n+\n+build_many(target, range(8), processes=8)\n+```\n``````\n",
    "created_at": "2021-01-09T15:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615670",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,40 @@
-The docbuild was failing for me, and it was hard to track down where the original error occurred because there was no (proper) traceback information. In this ticket, such a traceback information is added for exceptions in the docbuild worker.
+The docbuild was failing for me, and it was hard to track down where the original error occurred because there was no (proper) traceback information. In this ticket, such a traceback information is added for exceptions in the docbuild worker following the approach taken in https://bugs.python.org/issue13831.
+
+Example output:
+
+```
+sage_setup.docbuild.utils.RemoteException: 
+"""
+Traceback (most recent call last):
+  File "/mnt/d/Programming/sage/src/sage_setup/docbuild/utils.py", line 179, in run_worker
+    result = target(task)
+  File "/mnt/d/Programming/sage/src/a_test_docbuild_exc.py", line 7, in target
+    1 / 0
+ZeroDivisionError: division by zero
+"""
+
+The above exception was the direct cause of the following exception:
+
+Traceback (most recent call last):
+  File "/mnt/d/Programming/sage/src/a_test_docbuild_exc.py", line 12, in <module>
+    build_many(target, range(8), processes=8)
+  File "/mnt/d/Programming/sage/src/sage_setup/docbuild/utils.py", line 336, in build_many
+    raise worker_exc.original_exception
+ZeroDivisionError: division by zero
+```
+for the test file
+
+```
+from sage_setup.docbuild.utils import build_many
+
+def target(N):
+    import time, os, signal
+    if N == 1:
+        # Task 4 is a poison pill
+        1 / 0
+    else:
+        time.sleep(0.5)
+        print('Processed task %s' % N)
+
+build_many(target, range(8), processes=8)
+```
``````




---

archive/issue_comments_615671.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-01-09T15:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615671",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_615672.json:
```json
{
    "body": "<a id='comment:5'></a>\nThanks for the review. I've now extended the ticket description and fixed the doctests.",
    "created_at": "2021-01-09T15:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615672",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:5'></a>
Thanks for the review. I've now extended the ticket description and fixed the doctests.



---

archive/issue_comments_615673.json:
```json
{
    "body": "Changing reviewer from \"\" to \"https://github.com/mkoeppe/sage/actions/runs/524223614, https://github.com/mkoeppe/sage/actions/runs/524223611\"",
    "created_at": "2021-01-30T23:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615673",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "https://github.com/mkoeppe/sage/actions/runs/524223614, https://github.com/mkoeppe/sage/actions/runs/524223611"



---

archive/issue_comments_615674.json:
```json
{
    "body": "<a id='comment:6'></a>\nLet's see if this can help shed some light on previously reported docbuild failures such as #30640, #30796, #30825",
    "created_at": "2021-01-30T23:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615674",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Let's see if this can help shed some light on previously reported docbuild failures such as #30640, #30796, #30825



---

archive/issue_comments_615675.json:
```json
{
    "body": "<a id='comment:7'></a>\nI've been having problems building the documentation on OS X Big Sur with the latest Xcode + homebrew. This ticket didn't have any apparent effect on the traceback.",
    "created_at": "2021-01-31T02:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615675",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>
I've been having problems building the documentation on OS X Big Sur with the latest Xcode + homebrew. This ticket didn't have any apparent effect on the traceback.



---

archive/issue_comments_615676.json:
```json
{
    "body": "<a id='comment:8'></a>\n`@`jhpalmieri: So you mean you got an exception in one of the workers, but the traceback still didn't included the proper origin of the exception? That's a bit strange, it's working for me.",
    "created_at": "2021-02-13T09:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615676",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:8'></a>
`@`jhpalmieri: So you mean you got an exception in one of the workers, but the traceback still didn't included the proper origin of the exception? That's a bit strange, it's working for me.



---

archive/issue_comments_615677.json:
```json
{
    "body": "<a id='comment:9'></a>\nYes, with the failure in #31344.",
    "created_at": "2021-02-21T03:20:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615677",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
Yes, with the failure in #31344.



---

archive/issue_comments_615678.json:
```json
{
    "body": "<a id='comment:10'></a>\nThat makes sense. In #31344, no exception is thrown but the process ends with an error code, which then triggers \n\n```\n        if exitcode != 0:\n            raise WorkerDiedException(f\"worker for {task[1]} died with non-zero exit code {w.exitcode}\")\n```\nIn this case, no stacktrac is added since this information is simply not available. The worker needs to throw an exception (including a stacktrace) so that the exception handler in\n\n```\n         try:\n             result = target(task)\n         except BaseException as exc:\n             queue.put((None, exc))\n             queue.put((None, RemoteExceptionWrapper(exc)))\n```\nis invoked. This needs changes to the particular worker, and should be done in a follow-up issue.",
    "created_at": "2021-03-01T12:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615678",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:10'></a>
That makes sense. In #31344, no exception is thrown but the process ends with an error code, which then triggers 

```
        if exitcode != 0:
            raise WorkerDiedException(f"worker for {task[1]} died with non-zero exit code {w.exitcode}")
```
In this case, no stacktrac is added since this information is simply not available. The worker needs to throw an exception (including a stacktrace) so that the exception handler in

```
         try:
             result = target(task)
         except BaseException as exc:
             queue.put((None, exc))
             queue.put((None, RemoteExceptionWrapper(exc)))
```
is invoked. This needs changes to the particular worker, and should be done in a follow-up issue.



---

archive/issue_comments_615679.json:
```json
{
    "body": "<a id='comment:11'></a>\nSage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615679",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_091214.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31005#event-91214"
}
```



---

archive/issue_events_091215.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31005#event-91215"
}
```



---

archive/issue_events_091216.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31005#event-91216"
}
```



---

archive/issue_comments_615680.json:
```json
{
    "body": "<a id='comment:12'></a>\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615680",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_615681.json:
```json
{
    "body": "Changing commit from \"f10a30c28aff52988557a461f80af6234fd24535\" to \"d93695dd98a36db9428d3a6088a9e15e49502986\"",
    "created_at": "2021-11-28T20:05:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615681",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f10a30c28aff52988557a461f80af6234fd24535" to "d93695dd98a36db9428d3a6088a9e15e49502986"



---

archive/issue_comments_615682.json:
```json
{
    "body": "<a id='comment:13'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|\n|[d93695d](https://github.com/sagemath/sagetrac-mirror/commit/d93695dd98a36db9428d3a6088a9e15e49502986)|`Merge branch 'develop' of https://github.com/sagemath/sage into public/documentation/add_traceback`|",
    "created_at": "2021-11-28T20:05:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615682",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|
|[d93695d](https://github.com/sagemath/sagetrac-mirror/commit/d93695dd98a36db9428d3a6088a9e15e49502986)|`Merge branch 'develop' of https://github.com/sagemath/sage into public/documentation/add_traceback`|



---

archive/issue_comments_615683.json:
```json
{
    "body": "Changing reviewer from \"https://github.com/mkoeppe/sage/actions/runs/524223614, https://github.com/mkoeppe/sage/actions/runs/524223611\" to \"\"",
    "created_at": "2021-11-28T20:49:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615683",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "https://github.com/mkoeppe/sage/actions/runs/524223614, https://github.com/mkoeppe/sage/actions/runs/524223611" to ""



---

archive/issue_comments_615684.json:
```json
{
    "body": "<a id='comment:15'></a>\nDid the GH actions pass? My only suggestion would be to make `_rebuild_exc` a class method instead of a top-level function, but it's not important. This is a great improvement. Trying to track down all of the docbuild failures with `--underscore` and `--include-tests-blocks` is always a nightmare.",
    "created_at": "2021-12-01T01:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615684",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:15'></a>
Did the GH actions pass? My only suggestion would be to make `_rebuild_exc` a class method instead of a top-level function, but it's not important. This is a great improvement. Trying to track down all of the docbuild failures with `--underscore` and `--include-tests-blocks` is always a nightmare.



---

archive/issue_comments_615685.json:
```json
{
    "body": "Changing commit from \"d93695dd98a36db9428d3a6088a9e15e49502986\" to \"37f1d0c8011322058e1e6881d8ebd46446b700e0\"",
    "created_at": "2021-12-04T18:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615685",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d93695dd98a36db9428d3a6088a9e15e49502986" to "37f1d0c8011322058e1e6881d8ebd46446b700e0"



---

archive/issue_comments_615686.json:
```json
{
    "body": "<a id='comment:16'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|\n|[37f1d0c](https://github.com/sagemath/sagetrac-mirror/commit/37f1d0c8011322058e1e6881d8ebd46446b700e0)|`Move _rebuild_exc and cleanup code`|",
    "created_at": "2021-12-04T18:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615686",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|
|[37f1d0c](https://github.com/sagemath/sagetrac-mirror/commit/37f1d0c8011322058e1e6881d8ebd46446b700e0)|`Move _rebuild_exc and cleanup code`|



---

archive/issue_comments_615687.json:
```json
{
    "body": "<a id='comment:17'></a>\nThanks for the review. I've now moved _rebuild_exc to a local method in __reduce__.\nNot sure if the tests passed but patch bot seems to be green.",
    "created_at": "2021-12-04T18:59:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615687",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:17'></a>
Thanks for the review. I've now moved _rebuild_exc to a local method in __reduce__.
Not sure if the tests passed but patch bot seems to be green.



---

archive/issue_comments_615688.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [gh-tobiasdiez](#comment%3A17):\n> Thanks for the review. I've now moved _rebuild_exc to a local method in __reduce__.\n> Not sure if the tests passed but patch bot seems to be green.\n\n\nHm, this is even better. But now another refactoring is suggesting itself. Instead of,\n\n```python\ndef __reduce__(self):\n    def _rebuild_exc(exc: BaseException, tb: str):\n        \"\"\"\n        Reconstructs the exception, putting the original exception as cause.\n        \"\"\"\n        exc.__cause__ = RemoteException(tb)\n        return exc\n\n    return _rebuild_exc, (self.exc, self.tb)\n```\n\ncouldn't we just do\n\n```python\ndef __reduce__(self):\n    self.exc.__cause__ =  RemoteException(self.tb)\n    return self.exc\n```\n\n?\n\nI also think we'll need doctests for the new classes/methods even if they're pretty trivial. Otherwise our coverage goes down.",
    "created_at": "2021-12-06T13:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615688",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:18'></a>
Replying to [gh-tobiasdiez](#comment%3A17):
> Thanks for the review. I've now moved _rebuild_exc to a local method in __reduce__.
> Not sure if the tests passed but patch bot seems to be green.


Hm, this is even better. But now another refactoring is suggesting itself. Instead of,

```python
def __reduce__(self):
    def _rebuild_exc(exc: BaseException, tb: str):
        """
        Reconstructs the exception, putting the original exception as cause.
        """
        exc.__cause__ = RemoteException(tb)
        return exc

    return _rebuild_exc, (self.exc, self.tb)
```

couldn't we just do

```python
def __reduce__(self):
    self.exc.__cause__ =  RemoteException(self.tb)
    return self.exc
```

?

I also think we'll need doctests for the new classes/methods even if they're pretty trivial. Otherwise our coverage goes down.



---

archive/issue_comments_615689.json:
```json
{
    "body": "<a id='comment:19'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[45ef9e3](https://github.com/sagemath/sagetrac-mirror/commit/45ef9e34f138ce14c96646d7e5a31d5455d19b82)|`Fix code and add doctest`|",
    "created_at": "2021-12-06T20:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615689",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[45ef9e3](https://github.com/sagemath/sagetrac-mirror/commit/45ef9e34f138ce14c96646d7e5a31d5455d19b82)|`Fix code and add doctest`|



---

archive/issue_comments_615690.json:
```json
{
    "body": "Changing commit from \"37f1d0c8011322058e1e6881d8ebd46446b700e0\" to \"45ef9e34f138ce14c96646d7e5a31d5455d19b82\"",
    "created_at": "2021-12-06T20:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615690",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "37f1d0c8011322058e1e6881d8ebd46446b700e0" to "45ef9e34f138ce14c96646d7e5a31d5455d19b82"



---

archive/issue_comments_615691.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [mjo](#comment%3A18):\n> {{{#!python\n> def __reduce__(self):\n>     self.exc.__cause__ =  RemoteException(self.tb)\n>     return self.exc\n> }}}\n\n\nI don't have much experience with pickling, but https://docs.python.org/3/library/pickle.html#object.__reduce__ says that either a string or tuple should be returned.\n\nMy solution also didn't worked as `__reduce__` cannot return locally defined methods. So I've converted it to a static instance method as you initially suggested.\n\n> I also think we'll need doctests for the new classes/methods even if they're pretty trivial. Otherwise our coverage goes down.\n\n\nI've added a doctest for the reduce method. The other methods are still covered by the existing doctests.",
    "created_at": "2021-12-06T20:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615691",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:20'></a>
Replying to [mjo](#comment%3A18):
> {{{#!python
> def __reduce__(self):
>     self.exc.__cause__ =  RemoteException(self.tb)
>     return self.exc
> }}}


I don't have much experience with pickling, but https://docs.python.org/3/library/pickle.html#object.__reduce__ says that either a string or tuple should be returned.

My solution also didn't worked as `__reduce__` cannot return locally defined methods. So I've converted it to a static instance method as you initially suggested.

> I also think we'll need doctests for the new classes/methods even if they're pretty trivial. Otherwise our coverage goes down.


I've added a doctest for the reduce method. The other methods are still covered by the existing doctests.



---

archive/issue_comments_615692.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [gh-tobiasdiez](#comment%3A20):\n> \n> > I also think we'll need doctests for the new classes/methods even if they're pretty trivial. Otherwise our coverage goes down.\n\n> \n> I've added a doctest for the reduce method. The other methods are still covered by the existing doctests.\n\n\nI know, I was referring specifically to (before):\n\n```\n$ sage -coverage src/sage_docbuild/utils.py \n------------------------------------------------------------------------\nSCORE src/sage_docbuild/utils.py: 50.0% (1 of 2)\n\nMissing documentation:\n     * line 10: def __init__(self, message, original_exception=None)\n------------------------------------------------------------------------\n```\n\nand (after):\n\n```\n$ sage -coverage src/sage_docbuild/utils.py \n------------------------------------------------------------------------\nSCORE src/sage_docbuild/utils.py: 28.6% (2 of 7)\n\nMissing documentation:\n     * line 16: def __init__(self, tb:str)\n     * line 19: def __str__(self)\n     * line 32: def __init__(self, exc:BaseException)\n     * line 65: def __init__(self, message:Optional[str], original_exception:Optional[BaseException]=None)\n\nMissing doctests:\n     * line 42: def _rebuild_exc(exc:BaseException, tb:str)\n------------------------------------------------------------------------\n```\n\nNormally the patchbots would have complained (see the \"coverage\" plugin), but in this case I think the special nature of the sage_docbuild package avoided it.\n\nI've been on the other side of this argument more than once, so I feel for you, but the developer's guide still states that every function needs a docstring: https://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings",
    "created_at": "2021-12-15T02:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615692",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:21'></a>
Replying to [gh-tobiasdiez](#comment%3A20):
> 
> > I also think we'll need doctests for the new classes/methods even if they're pretty trivial. Otherwise our coverage goes down.

> 
> I've added a doctest for the reduce method. The other methods are still covered by the existing doctests.


I know, I was referring specifically to (before):

```
$ sage -coverage src/sage_docbuild/utils.py 
------------------------------------------------------------------------
SCORE src/sage_docbuild/utils.py: 50.0% (1 of 2)

Missing documentation:
     * line 10: def __init__(self, message, original_exception=None)
------------------------------------------------------------------------
```

and (after):

```
$ sage -coverage src/sage_docbuild/utils.py 
------------------------------------------------------------------------
SCORE src/sage_docbuild/utils.py: 28.6% (2 of 7)

Missing documentation:
     * line 16: def __init__(self, tb:str)
     * line 19: def __str__(self)
     * line 32: def __init__(self, exc:BaseException)
     * line 65: def __init__(self, message:Optional[str], original_exception:Optional[BaseException]=None)

Missing doctests:
     * line 42: def _rebuild_exc(exc:BaseException, tb:str)
------------------------------------------------------------------------
```

Normally the patchbots would have complained (see the "coverage" plugin), but in this case I think the special nature of the sage_docbuild package avoided it.

I've been on the other side of this argument more than once, so I feel for you, but the developer's guide still states that every function needs a docstring: https://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings



---

archive/issue_comments_615693.json:
```json
{
    "body": "Changing commit from \"45ef9e34f138ce14c96646d7e5a31d5455d19b82\" to \"c37d055673bb573423a3200a6a715db567de436f\"",
    "created_at": "2021-12-15T20:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615693",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "45ef9e34f138ce14c96646d7e5a31d5455d19b82" to "c37d055673bb573423a3200a6a715db567de436f"



---

archive/issue_comments_615694.json:
```json
{
    "body": "<a id='comment:22'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|\n|[756a79d](https://github.com/sagemath/sagetrac-mirror/commit/756a79d10f9b64450360c09999838ccc98fd8c4b)|`Merge branch 'develop' of https://github.com/sagemath/sage into public/documentation/add_traceback`|\n|[c37d055](https://github.com/sagemath/sagetrac-mirror/commit/c37d055673bb573423a3200a6a715db567de436f)|`Add docstrings`|",
    "created_at": "2021-12-15T20:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615694",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|
|[756a79d](https://github.com/sagemath/sagetrac-mirror/commit/756a79d10f9b64450360c09999838ccc98fd8c4b)|`Merge branch 'develop' of https://github.com/sagemath/sage into public/documentation/add_traceback`|
|[c37d055](https://github.com/sagemath/sagetrac-mirror/commit/c37d055673bb573423a3200a6a715db567de436f)|`Add docstrings`|



---

archive/issue_comments_615695.json:
```json
{
    "body": "<a id='comment:23'></a>\nI've added the missing docstrings. But since none of the methods in this class have any tests, I don't have that much motivation to add tests for trivial constructor / properties ;-)",
    "created_at": "2021-12-15T20:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615695",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:23'></a>
I've added the missing docstrings. But since none of the methods in this class have any tests, I don't have that much motivation to add tests for trivial constructor / properties ;-)



---

archive/issue_comments_615696.json:
```json
{
    "body": "<a id='comment:24'></a>\nTest bot is green, anything else to do?",
    "created_at": "2022-01-03T12:18:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615696",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:24'></a>
Test bot is green, anything else to do?



---

archive/issue_comments_615697.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-01-04T01:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615697",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_615698.json:
```json
{
    "body": "<a id='comment:25'></a>\nI forgot what I was waiting for, so it must be OK.",
    "created_at": "2022-01-04T01:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615698",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:25'></a>
I forgot what I was waiting for, so it must be OK.



---

archive/issue_comments_615699.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Michael Orlitzky\"",
    "created_at": "2022-01-04T01:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615699",
    "user": "https://github.com/orlitzky"
}
```

Changing reviewer from "" to "Michael Orlitzky"



---

archive/issue_comments_615700.json:
```json
{
    "body": "<a id='comment:26'></a>\nThanks!",
    "created_at": "2022-01-04T12:00:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615700",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:26'></a>
Thanks!



---

archive/issue_events_091217.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-28T23:03:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31005#event-91217"
}
```



---

archive/issue_events_091218.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-28T23:03:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31005#event-91218"
}
```



---

archive/issue_comments_615701.json:
```json
{
    "body": "Changing branch from \"public/documentation/add_traceback\" to \"c37d055673bb573423a3200a6a715db567de436f\"",
    "created_at": "2022-02-16T23:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615701",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/documentation/add_traceback" to "c37d055673bb573423a3200a6a715db567de436f"



---

archive/issue_events_091219.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-16T23:56:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31005#event-91219"
}
```



---

archive/issue_comments_615702.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-16T23:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-615702",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
