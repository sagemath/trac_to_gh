# Issue 31005: Add traceback information to exceptions during docbuild

archive/issues_030768.json:
```json
{
    "body": "The docbuild was failing for me, and it was hard to track down where the original error occurred because there was no (proper) traceback information. In this ticket, such a traceback information is added for exceptions in the docbuild worker following the approach taken in https://bugs.python.org/issue13831.\n\nExample output:\n\n```\nsage_setup.docbuild.utils.RemoteException: \n\"\"\"\nTraceback (most recent call last):\n  File \"/mnt/d/Programming/sage/src/sage_setup/docbuild/utils.py\", line 179, in run_worker\n    result = target(task)\n  File \"/mnt/d/Programming/sage/src/a_test_docbuild_exc.py\", line 7, in target\n    1 / 0\nZeroDivisionError: division by zero\n\"\"\"\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/mnt/d/Programming/sage/src/a_test_docbuild_exc.py\", line 12, in <module>\n    build_many(target, range(8), processes=8)\n  File \"/mnt/d/Programming/sage/src/sage_setup/docbuild/utils.py\", line 336, in build_many\n    raise worker_exc.original_exception\nZeroDivisionError: division by zero\n```\nfor the test file\n\n```\nfrom sage_setup.docbuild.utils import build_many\n\ndef target(N):\n    import time, os, signal\n    if N == 1:\n        # Task 4 is a poison pill\n        1 / 0\n    else:\n        time.sleep(0.5)\n        print('Processed task %s' % N)\n\nbuild_many(target, range(8), processes=8)\n```\n\nCC:  @dimpase @jhpalmieri @seblabbe @slel @orlitzky\n\nBranch/Commit: c37d055673bb573423a3200a6a715db567de436f\n\nReviewer: Michael Orlitzky\n\nAuthor: Tobias Diez\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31005\n\n",
    "closed_at": "2022-02-16T23:56:48Z",
    "created_at": "2020-12-04T12:32:58Z",
    "labels": [
        "component: documentation",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Add traceback information to exceptions during docbuild",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31005",
    "user": "https://github.com/tobiasdiez"
}
```
The docbuild was failing for me, and it was hard to track down where the original error occurred because there was no (proper) traceback information. In this ticket, such a traceback information is added for exceptions in the docbuild worker following the approach taken in https://bugs.python.org/issue13831.

Example output:

```
sage_setup.docbuild.utils.RemoteException: 
"""
Traceback (most recent call last):
  File "/mnt/d/Programming/sage/src/sage_setup/docbuild/utils.py", line 179, in run_worker
    result = target(task)
  File "/mnt/d/Programming/sage/src/a_test_docbuild_exc.py", line 7, in target
    1 / 0
ZeroDivisionError: division by zero
"""

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/mnt/d/Programming/sage/src/a_test_docbuild_exc.py", line 12, in <module>
    build_many(target, range(8), processes=8)
  File "/mnt/d/Programming/sage/src/sage_setup/docbuild/utils.py", line 336, in build_many
    raise worker_exc.original_exception
ZeroDivisionError: division by zero
```
for the test file

```
from sage_setup.docbuild.utils import build_many

def target(N):
    import time, os, signal
    if N == 1:
        # Task 4 is a poison pill
        1 / 0
    else:
        time.sleep(0.5)
        print('Processed task %s' % N)

build_many(target, range(8), processes=8)
```

CC:  @dimpase @jhpalmieri @seblabbe @slel @orlitzky

Branch/Commit: c37d055673bb573423a3200a6a715db567de436f

Reviewer: Michael Orlitzky

Author: Tobias Diez

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31005





---

archive/issue_comments_469219.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-12-04T12:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469219",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_469220.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-12-09T11:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469220",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_469221.json:
```json
{
    "body": "<a id='comment:3'></a>The patchbot reports failures for the files that are changed by the branch:\n\n```\n----------------------------------------------------------------------\nsage -t --long --warn-long 40.9 --random-seed=0 src/sage_setup/docbuild/utils.py  # 1 doctest failed\nsage -t --long --warn-long 40.9 --random-seed=0 src/sage_setup/docbuild/__init__.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n\nTo help the review, may you add an example in the description field of the kind of new information printed in the dochtml.log when an error (warning) occurs?",
    "created_at": "2020-12-09T11:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469221",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:3'></a>The patchbot reports failures for the files that are changed by the branch:

```
----------------------------------------------------------------------
sage -t --long --warn-long 40.9 --random-seed=0 src/sage_setup/docbuild/utils.py  # 1 doctest failed
sage -t --long --warn-long 40.9 --random-seed=0 src/sage_setup/docbuild/__init__.py  # 1 doctest failed
----------------------------------------------------------------------
```

To help the review, may you add an example in the description field of the kind of new information printed in the dochtml.log when an error (warning) occurs?



---

archive/issue_comments_469222.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-09T15:18:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469222",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_469223.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,43 @@\n-The docbuild was failing for me, and it was hard to track down where the original error occurred because there was no (proper) traceback information. In this ticket, such a traceback information is added for exceptions in the docbuild worker.\n+The docbuild was failing for me, and it was hard to track down where the original error occurred because there was no (proper) traceback information. In this ticket, such a traceback information is added for exceptions in the docbuild worker following the approach taken in https://bugs.python.org/issue13831.\n+\n+Example output:\n+\n+```\n+sage_setup.docbuild.utils.RemoteException: \n+\"\"\"\n+Traceback (most recent call last):\n+  File \"/mnt/d/Programming/sage/src/sage_setup/docbuild/utils.py\", line 179, in run_worker\n+    result = target(task)\n+  File \"/mnt/d/Programming/sage/src/a_test_docbuild_exc.py\", line 7, in target\n+    1 / 0\n+ZeroDivisionError: division by zero\n+\"\"\"\n+\n+The above exception was the direct cause of the following exception:\n+\n+Traceback (most recent call last):\n+  File \"/mnt/d/Programming/sage/src/a_test_docbuild_exc.py\", line 12, in <module>\n+    build_many(target, range(8), processes=8)\n+  File \"/mnt/d/Programming/sage/src/sage_setup/docbuild/utils.py\", line 336, in build_many\n+    raise worker_exc.original_exception\n+ZeroDivisionError: division by zero\n+```\n+for the test file\n+\n+```\n+from sage_setup.docbuild.utils import build_many\n+\n+def target(N):\n+    import time, os, signal\n+    if N == 1:\n+        # Task 4 is a poison pill\n+        1 / 0\n+    else:\n+        time.sleep(0.5)\n+        print('Processed task %s' % N)\n+\n+build_many(target, range(8), processes=8)\n+```\n \n Comment: 1\n \n``````\n",
    "created_at": "2021-01-09T15:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469223",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,43 @@
-The docbuild was failing for me, and it was hard to track down where the original error occurred because there was no (proper) traceback information. In this ticket, such a traceback information is added for exceptions in the docbuild worker.
+The docbuild was failing for me, and it was hard to track down where the original error occurred because there was no (proper) traceback information. In this ticket, such a traceback information is added for exceptions in the docbuild worker following the approach taken in https://bugs.python.org/issue13831.
+
+Example output:
+
+```
+sage_setup.docbuild.utils.RemoteException: 
+"""
+Traceback (most recent call last):
+  File "/mnt/d/Programming/sage/src/sage_setup/docbuild/utils.py", line 179, in run_worker
+    result = target(task)
+  File "/mnt/d/Programming/sage/src/a_test_docbuild_exc.py", line 7, in target
+    1 / 0
+ZeroDivisionError: division by zero
+"""
+
+The above exception was the direct cause of the following exception:
+
+Traceback (most recent call last):
+  File "/mnt/d/Programming/sage/src/a_test_docbuild_exc.py", line 12, in <module>
+    build_many(target, range(8), processes=8)
+  File "/mnt/d/Programming/sage/src/sage_setup/docbuild/utils.py", line 336, in build_many
+    raise worker_exc.original_exception
+ZeroDivisionError: division by zero
+```
+for the test file
+
+```
+from sage_setup.docbuild.utils import build_many
+
+def target(N):
+    import time, os, signal
+    if N == 1:
+        # Task 4 is a poison pill
+        1 / 0
+    else:
+        time.sleep(0.5)
+        print('Processed task %s' % N)
+
+build_many(target, range(8), processes=8)
+```
 
 Comment: 1
 
``````




---

archive/issue_comments_469224.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-01-09T15:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469224",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_469225.json:
```json
{
    "body": "<a id='comment:5'></a>Thanks for the review. I've now extended the ticket description and fixed the doctests.",
    "created_at": "2021-01-09T15:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469225",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:5'></a>Thanks for the review. I've now extended the ticket description and fixed the doctests.



---

archive/issue_comments_469226.json:
```json
{
    "body": "<a id='comment:6'></a>Let's see if this can help shed some light on previously reported docbuild failures such as #30640, #30796, #30825",
    "created_at": "2021-01-30T23:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469226",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Let's see if this can help shed some light on previously reported docbuild failures such as #30640, #30796, #30825



---

archive/issue_comments_469227.json:
```json
{
    "body": "<a id='comment:7'></a>I've been having problems building the documentation on OS X Big Sur with the latest Xcode + homebrew. This ticket didn't have any apparent effect on the traceback.",
    "created_at": "2021-01-31T02:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469227",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>I've been having problems building the documentation on OS X Big Sur with the latest Xcode + homebrew. This ticket didn't have any apparent effect on the traceback.



---

archive/issue_comments_469228.json:
```json
{
    "body": "<a id='comment:8'></a>`@`jhpalmieri: So you mean you got an exception in one of the workers, but the traceback still didn't included the proper origin of the exception? That's a bit strange, it's working for me.",
    "created_at": "2021-02-13T09:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469228",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:8'></a>`@`jhpalmieri: So you mean you got an exception in one of the workers, but the traceback still didn't included the proper origin of the exception? That's a bit strange, it's working for me.



---

archive/issue_comments_469229.json:
```json
{
    "body": "<a id='comment:9'></a>Yes, with the failure in #31344.",
    "created_at": "2021-02-21T03:20:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469229",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>Yes, with the failure in #31344.



---

archive/issue_comments_469230.json:
```json
{
    "body": "<a id='comment:10'></a>That makes sense. In #31344, no exception is thrown but the process ends with an error code, which then triggers \n\n```\n        if exitcode != 0:\n            raise WorkerDiedException(f\"worker for {task[1]} died with non-zero exit code {w.exitcode}\")\n```\nIn this case, no stacktrac is added since this information is simply not available. The worker needs to throw an exception (including a stacktrace) so that the exception handler in\n\n```\n         try:\n             result = target(task)\n         except BaseException as exc:\n             queue.put((None, exc))\n             queue.put((None, RemoteExceptionWrapper(exc)))\n```\nis invoked. This needs changes to the particular worker, and should be done in a follow-up issue.",
    "created_at": "2021-03-01T12:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469230",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:10'></a>That makes sense. In #31344, no exception is thrown but the process ends with an error code, which then triggers 

```
        if exitcode != 0:
            raise WorkerDiedException(f"worker for {task[1]} died with non-zero exit code {w.exitcode}")
```
In this case, no stacktrac is added since this information is simply not available. The worker needs to throw an exception (including a stacktrace) so that the exception handler in

```
         try:
             result = target(task)
         except BaseException as exc:
             queue.put((None, exc))
             queue.put((None, RemoteExceptionWrapper(exc)))
```
is invoked. This needs changes to the particular worker, and should be done in a follow-up issue.



---

archive/issue_comments_469231.json:
```json
{
    "body": "<a id='comment:11'></a>Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469231",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_080967.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31005#event-80967"
}
```



---

archive/issue_events_080968.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31005#event-80968"
}
```



---

archive/issue_events_080969.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31005#event-80969"
}
```



---

archive/issue_comments_469232.json:
```json
{
    "body": "<a id='comment:12'></a>Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469232",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_469233.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-28T20:05:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469233",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_469234.json:
```json
{
    "body": "<a id='comment:15'></a>Did the GH actions pass? My only suggestion would be to make `_rebuild_exc` a class method instead of a top-level function, but it's not important. This is a great improvement. Trying to track down all of the docbuild failures with `--underscore` and `--include-tests-blocks` is always a nightmare.",
    "created_at": "2021-12-01T01:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469234",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:15'></a>Did the GH actions pass? My only suggestion would be to make `_rebuild_exc` a class method instead of a top-level function, but it's not important. This is a great improvement. Trying to track down all of the docbuild failures with `--underscore` and `--include-tests-blocks` is always a nightmare.



---

archive/issue_comments_469235.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-04T18:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469235",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_469236.json:
```json
{
    "body": "<a id='comment:17'></a>Thanks for the review. I've now moved _rebuild_exc to a local method in __reduce__.\nNot sure if the tests passed but patch bot seems to be green.",
    "created_at": "2021-12-04T18:59:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469236",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:17'></a>Thanks for the review. I've now moved _rebuild_exc to a local method in __reduce__.
Not sure if the tests passed but patch bot seems to be green.



---

archive/issue_comments_469237.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 gh-tobiasdiez]:\n> Thanks for the review. I've now moved _rebuild_exc to a local method in __reduce__.\n> Not sure if the tests passed but patch bot seems to be green.\n\n\nHm, this is even better. But now another refactoring is suggesting itself. Instead of,\n\n```python\ndef __reduce__(self):\n    def _rebuild_exc(exc: BaseException, tb: str):\n        \"\"\"\n        Reconstructs the exception, putting the original exception as cause.\n        \"\"\"\n        exc.__cause__ = RemoteException(tb)\n        return exc\n\n    return _rebuild_exc, (self.exc, self.tb)\n```\n\ncouldn't we just do\n\n```python\ndef __reduce__(self):\n    self.exc.__cause__ =  RemoteException(self.tb)\n    return self.exc\n```\n\n?\n\nI also think we'll need doctests for the new classes/methods even if they're pretty trivial. Otherwise our coverage goes down.",
    "created_at": "2021-12-06T13:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469237",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:18'></a>Replying to [comment:17 gh-tobiasdiez]:
> Thanks for the review. I've now moved _rebuild_exc to a local method in __reduce__.
> Not sure if the tests passed but patch bot seems to be green.


Hm, this is even better. But now another refactoring is suggesting itself. Instead of,

```python
def __reduce__(self):
    def _rebuild_exc(exc: BaseException, tb: str):
        """
        Reconstructs the exception, putting the original exception as cause.
        """
        exc.__cause__ = RemoteException(tb)
        return exc

    return _rebuild_exc, (self.exc, self.tb)
```

couldn't we just do

```python
def __reduce__(self):
    self.exc.__cause__ =  RemoteException(self.tb)
    return self.exc
```

?

I also think we'll need doctests for the new classes/methods even if they're pretty trivial. Otherwise our coverage goes down.



---

archive/issue_comments_469238.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-06T20:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469238",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_469239.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:18 mjo]:\n> {{{#!python\n> def __reduce__(self):\n>     self.exc.__cause__ =  RemoteException(self.tb)\n>     return self.exc\n> }}}\n\n\nI don't have much experience with pickling, but https://docs.python.org/3/library/pickle.html#object.__reduce__ says that either a string or tuple should be returned.\n\nMy solution also didn't worked as `__reduce__` cannot return locally defined methods. So I've converted it to a static instance method as you initially suggested.\n\n> I also think we'll need doctests for the new classes/methods even if they're pretty trivial. Otherwise our coverage goes down.\n\n\nI've added a doctest for the reduce method. The other methods are still covered by the existing doctests.",
    "created_at": "2021-12-06T20:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469239",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:20'></a>Replying to [comment:18 mjo]:
> {{{#!python
> def __reduce__(self):
>     self.exc.__cause__ =  RemoteException(self.tb)
>     return self.exc
> }}}


I don't have much experience with pickling, but https://docs.python.org/3/library/pickle.html#object.__reduce__ says that either a string or tuple should be returned.

My solution also didn't worked as `__reduce__` cannot return locally defined methods. So I've converted it to a static instance method as you initially suggested.

> I also think we'll need doctests for the new classes/methods even if they're pretty trivial. Otherwise our coverage goes down.


I've added a doctest for the reduce method. The other methods are still covered by the existing doctests.



---

archive/issue_comments_469240.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 gh-tobiasdiez]:\n> \n> > I also think we'll need doctests for the new classes/methods even if they're pretty trivial. Otherwise our coverage goes down.\n\n> \n> I've added a doctest for the reduce method. The other methods are still covered by the existing doctests.\n\n\nI know, I was referring specifically to (before):\n\n```\n$ sage -coverage src/sage_docbuild/utils.py \n------------------------------------------------------------------------\nSCORE src/sage_docbuild/utils.py: 50.0% (1 of 2)\n\nMissing documentation:\n     * line 10: def __init__(self, message, original_exception=None)\n------------------------------------------------------------------------\n```\n\nand (after):\n\n```\n$ sage -coverage src/sage_docbuild/utils.py \n------------------------------------------------------------------------\nSCORE src/sage_docbuild/utils.py: 28.6% (2 of 7)\n\nMissing documentation:\n     * line 16: def __init__(self, tb:str)\n     * line 19: def __str__(self)\n     * line 32: def __init__(self, exc:BaseException)\n     * line 65: def __init__(self, message:Optional[str], original_exception:Optional[BaseException]=None)\n\nMissing doctests:\n     * line 42: def _rebuild_exc(exc:BaseException, tb:str)\n------------------------------------------------------------------------\n```\n\nNormally the patchbots would have complained (see the \"coverage\" plugin), but in this case I think the special nature of the sage_docbuild package avoided it.\n\nI've been on the other side of this argument more than once, so I feel for you, but the developer's guide still states that every function needs a docstring: https://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings",
    "created_at": "2021-12-15T02:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469240",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:21'></a>Replying to [comment:20 gh-tobiasdiez]:
> 
> > I also think we'll need doctests for the new classes/methods even if they're pretty trivial. Otherwise our coverage goes down.

> 
> I've added a doctest for the reduce method. The other methods are still covered by the existing doctests.


I know, I was referring specifically to (before):

```
$ sage -coverage src/sage_docbuild/utils.py 
------------------------------------------------------------------------
SCORE src/sage_docbuild/utils.py: 50.0% (1 of 2)

Missing documentation:
     * line 10: def __init__(self, message, original_exception=None)
------------------------------------------------------------------------
```

and (after):

```
$ sage -coverage src/sage_docbuild/utils.py 
------------------------------------------------------------------------
SCORE src/sage_docbuild/utils.py: 28.6% (2 of 7)

Missing documentation:
     * line 16: def __init__(self, tb:str)
     * line 19: def __str__(self)
     * line 32: def __init__(self, exc:BaseException)
     * line 65: def __init__(self, message:Optional[str], original_exception:Optional[BaseException]=None)

Missing doctests:
     * line 42: def _rebuild_exc(exc:BaseException, tb:str)
------------------------------------------------------------------------
```

Normally the patchbots would have complained (see the "coverage" plugin), but in this case I think the special nature of the sage_docbuild package avoided it.

I've been on the other side of this argument more than once, so I feel for you, but the developer's guide still states that every function needs a docstring: https://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings



---

archive/issue_comments_469241.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-15T20:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469241",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_469242.json:
```json
{
    "body": "<a id='comment:23'></a>I've added the missing docstrings. But since none of the methods in this class have any tests, I don't have that much motivation to add tests for trivial constructor / properties ;-)",
    "created_at": "2021-12-15T20:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469242",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:23'></a>I've added the missing docstrings. But since none of the methods in this class have any tests, I don't have that much motivation to add tests for trivial constructor / properties ;-)



---

archive/issue_comments_469243.json:
```json
{
    "body": "<a id='comment:24'></a>Test bot is green, anything else to do?",
    "created_at": "2022-01-03T12:18:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469243",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:24'></a>Test bot is green, anything else to do?



---

archive/issue_comments_469244.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-01-04T01:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469244",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_469245.json:
```json
{
    "body": "<a id='comment:25'></a>I forgot what I was waiting for, so it must be OK.",
    "created_at": "2022-01-04T01:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469245",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:25'></a>I forgot what I was waiting for, so it must be OK.



---

archive/issue_comments_469246.json:
```json
{
    "body": "<a id='comment:26'></a>Thanks!",
    "created_at": "2022-01-04T12:00:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469246",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:26'></a>Thanks!



---

archive/issue_events_080970.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-28T23:03:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31005#event-80970"
}
```



---

archive/issue_events_080971.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-28T23:03:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31005#event-80971"
}
```



---

archive/issue_events_080972.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-16T23:56:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31005#event-80972"
}
```



---

archive/issue_comments_469247.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-16T23:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31005",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31005#issuecomment-469247",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
