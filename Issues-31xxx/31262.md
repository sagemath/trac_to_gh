# Issue 31262: Implement non zero chunks for sparse bitsets

archive/issues_031025.json:
```json
{
    "assignees": [],
    "body": "For very large and challenging computations, most of the elements of the face lattice contain rather few atoms/bits. With little changes to the code, we can just collect the non zero chunks (64,128 or 256 bits).\n\nRoaringBitmap performs better (starting with maybe 100,000 bits, but not with less, as container contain 64k bits), but that would add an extra dependency and make things more complicated.\n\nTo avoid code duplications, we also gather some functions in `bitset_intrinsics.h` that work just the same (e.g. intersection and union).\n(This actually accounts for most changes by this ticket.)\n\nBefore (on #27103):\n\n```\nsage: P = polytopes.Birkhoff_polytope(5)                                                                                                                                                                                                                                                                                                                                   \nsage: C = CombinatorialPolyhedron(P)                                                                                                                                                                                                                                                                                                                                       \nsage: %time _ = C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \nCPU times: user 468 ms, sys: 0 ns, total: 468 ms\nWall time: 467 ms\n\nsage: P = polytopes.Birkhoff_polytope(5)                                                                                                                                                                                                                                                                                                                                   \nsage: C = CombinatorialPolyhedron(P)                                                                                                                                                                                                                                                                                                                                       \nsage: %time _ = C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \nCPU times: user 440 ms, sys: 0 ns, total: 440 ms\nWall time: 439 ms\n\nsage: P = polytopes.hypercube(14)                                                                                                                                                                                                                                                                                                                                          \nsage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              \nsage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      \nsage: %time _ = C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \nCPU times: user 5.13 s, sys: 4.03 ms, total: 5.14 s\nWall time: 5.13 s\nsage: P = polytopes.hypercube(15)                                                                                                                                                                                                                                                                                                                                          \nsage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              \nsage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      \nsage: %time _ = C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \nCPU times: user 30 s, sys: 32 ms, total: 30 s\nWall time: 30 s\n\nsage: P = polytopes.permutahedron(6)                                                                                                                                                                                                                                                                                                                                       \nsage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              \nsage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      \nsage: %time _ = C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \nCPU times: user 1.68 ms, sys: 6 \u00b5s, total: 1.68 ms\nWall time: 1.69 ms\nsage: P = polytopes.permutahedron(7)                                                                                                                                                                                                                                                                                                                                       \nsage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              \nsage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      \nsage: %time _ = C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \nCPU times: user 89.1 ms, sys: 4 \u00b5s, total: 89.1 ms\nWall time: 88.9 ms\n\nsage: P = polytopes.permutahedron(8, backend='normaliz')                                                                                                                                                                                                                                                                                                                   \nsage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              \nsage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      \nsage: %time _ = C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \nCPU times: user 14.2 s, sys: 8 ms, total: 14.2 s\nWall time: 14.2 s\n\nsage: P = polytopes.associahedron(['A', 11], backend='normaliz')                                                                                                                                                                                                                                                                                                           \nsage: C = CombinatorialPolyhedron(P)                                                                                                                                                                                                                                                                                                                                       \nsage: %time _ = C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \nCPU times: user 24.3 s, sys: 8.01 ms, total: 24.3 s\nWall time: 24.3 s\n```\n\nAfter:\n\n```\n# Slight slowdown for few atoms.\nsage: P = polytopes.Birkhoff_polytope(5)                                                                                                                                                                                                                                                                                                                                   \nsage: C = CombinatorialPolyhedron(P)                                                                                                                                                                                                                                                                                                                                       \nsage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \nCPU times: user 475 ms, sys: 0 ns, total: 475 ms\nWall time: 474 ms\n(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)\n\nsage: P = polytopes.hypercube(14)                                                                                                                                                                                                                                                                                                                                          \nsage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              \nsage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      \nsage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \nCPU times: user 1.67 s, sys: 0 ns, total: 1.67 s\nWall time: 1.66 s\n(1, 16385, 131069, 487383, 1117948, 1769482, 2047331, 1788501, 1200342, 622908, 248963, 75361, 16640, 2470, 197, 1)\nsage: P = polytopes.hypercube(15)                                                                                                                                                                                                                                                                                                                                          \nsage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              \nsage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      \nsage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \nCPU times: user 7.28 s, sys: 8 ms, total: 7.28 s\nWall time: 7.28 s\n(1, 32769, 278525, 1105876, 2723539, 4657926, 5866861, 5629624, 4196907, 2454738, 1128127, 404404, 110929, 22386, 3059, 226, 1)\n\nsage: P = polytopes.permutahedron(6)                                                                                                                                                                                                                                                                                                                                       \nsage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              \nsage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      \nsage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \nCPU times: user 1.44 ms, sys: 79 \u00b5s, total: 1.52 ms\nWall time: 1.52 ms\n(1, 721, 1987, 1956, 808, 120, 1)\nsage: P = polytopes.permutahedron(7)                                                                                                                                                                                                                                                                                                                                       \nsage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              \nsage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      \nsage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \nCPU times: user 20.8 ms, sys: 0 ns, total: 20.8 ms\nWall time: 20.9 ms\n(1, 5041, 16251, 19761, 11144, 2860, 267, 1)\nsage: P = polytopes.permutahedron(8, backend='normaliz')                                                                                                                                                                                                                                                                                                                   \nsage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              \nsage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      \nsage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \nCPU times: user 616 ms, sys: 8 ms, total: 624 ms\nWall time: 623 ms\n(1, 40321, 148899, 215690, 154215, 56022, 9489, 572, 1)\n\n# No change for simplicial/simple polytopes.\nsage: P = polytopes.associahedron(['A', 11], backend='normaliz')                                                                                                                                                                                                                                                                                                           \nsage: C = CombinatorialPolyhedron(P)                                                                                                                                                                                                                                                                                                                                       \nsage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \nCPU times: user 24.3 s, sys: 16.3 ms, total: 24.3 s\nWall time: 24.3 s\n(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)\n```\n\nThis is the last subsequent improvement in comparison to sage 8.9 mentioned in https://arxiv.org/abs/1905.01945.\n\nFollow ups:\n- Move things from `geometry/polyhedron/combinatorial_polyhedron` to a more general location.\n- Some renamings for lattices in general `face` -> `element`.\n- Expose to simplical complexes.\n- Expose to lattice of flats of matroids.\n\nDepends on #27103\n\nCC:  @stumpc5 @tscrim\n\nKeywords: **combinatorial polyhedron, sparse bitsets**\n\nBranch/Commit: **[`b3212d0`](https://github.com/sagemath/sagetrac-mirror/commit/b3212d0bb74109461114b23d63fc26e604c121f2)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Jonathan Kliem**\n\nComponent: **geometry**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31262_\n\n",
    "closed_at": "2021-01-31T20:53:15Z",
    "created_at": "2021-01-18T23:27:27Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20geometry",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Implement non zero chunks for sparse bitsets",
    "type": "issue",
    "updated_at": "2021-01-31T20:53:15Z",
    "url": "https://github.com/sagemath/sage/issues/31262",
    "user": "https://github.com/kliem"
}
```
For very large and challenging computations, most of the elements of the face lattice contain rather few atoms/bits. With little changes to the code, we can just collect the non zero chunks (64,128 or 256 bits).

RoaringBitmap performs better (starting with maybe 100,000 bits, but not with less, as container contain 64k bits), but that would add an extra dependency and make things more complicated.

To avoid code duplications, we also gather some functions in `bitset_intrinsics.h` that work just the same (e.g. intersection and union).
(This actually accounts for most changes by this ticket.)

Before (on #27103):

```
sage: P = polytopes.Birkhoff_polytope(5)                                                                                                                                                                                                                                                                                                                                   
sage: C = CombinatorialPolyhedron(P)                                                                                                                                                                                                                                                                                                                                       
sage: %time _ = C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
CPU times: user 468 ms, sys: 0 ns, total: 468 ms
Wall time: 467 ms

sage: P = polytopes.Birkhoff_polytope(5)                                                                                                                                                                                                                                                                                                                                   
sage: C = CombinatorialPolyhedron(P)                                                                                                                                                                                                                                                                                                                                       
sage: %time _ = C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
CPU times: user 440 ms, sys: 0 ns, total: 440 ms
Wall time: 439 ms

sage: P = polytopes.hypercube(14)                                                                                                                                                                                                                                                                                                                                          
sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              
sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      
sage: %time _ = C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
CPU times: user 5.13 s, sys: 4.03 ms, total: 5.14 s
Wall time: 5.13 s
sage: P = polytopes.hypercube(15)                                                                                                                                                                                                                                                                                                                                          
sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              
sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      
sage: %time _ = C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
CPU times: user 30 s, sys: 32 ms, total: 30 s
Wall time: 30 s

sage: P = polytopes.permutahedron(6)                                                                                                                                                                                                                                                                                                                                       
sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              
sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      
sage: %time _ = C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
CPU times: user 1.68 ms, sys: 6 µs, total: 1.68 ms
Wall time: 1.69 ms
sage: P = polytopes.permutahedron(7)                                                                                                                                                                                                                                                                                                                                       
sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              
sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      
sage: %time _ = C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
CPU times: user 89.1 ms, sys: 4 µs, total: 89.1 ms
Wall time: 88.9 ms

sage: P = polytopes.permutahedron(8, backend='normaliz')                                                                                                                                                                                                                                                                                                                   
sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              
sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      
sage: %time _ = C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
CPU times: user 14.2 s, sys: 8 ms, total: 14.2 s
Wall time: 14.2 s

sage: P = polytopes.associahedron(['A', 11], backend='normaliz')                                                                                                                                                                                                                                                                                                           
sage: C = CombinatorialPolyhedron(P)                                                                                                                                                                                                                                                                                                                                       
sage: %time _ = C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
CPU times: user 24.3 s, sys: 8.01 ms, total: 24.3 s
Wall time: 24.3 s
```

After:

```
# Slight slowdown for few atoms.
sage: P = polytopes.Birkhoff_polytope(5)                                                                                                                                                                                                                                                                                                                                   
sage: C = CombinatorialPolyhedron(P)                                                                                                                                                                                                                                                                                                                                       
sage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
CPU times: user 475 ms, sys: 0 ns, total: 475 ms
Wall time: 474 ms
(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)

sage: P = polytopes.hypercube(14)                                                                                                                                                                                                                                                                                                                                          
sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              
sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      
sage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
CPU times: user 1.67 s, sys: 0 ns, total: 1.67 s
Wall time: 1.66 s
(1, 16385, 131069, 487383, 1117948, 1769482, 2047331, 1788501, 1200342, 622908, 248963, 75361, 16640, 2470, 197, 1)
sage: P = polytopes.hypercube(15)                                                                                                                                                                                                                                                                                                                                          
sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              
sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      
sage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
CPU times: user 7.28 s, sys: 8 ms, total: 7.28 s
Wall time: 7.28 s
(1, 32769, 278525, 1105876, 2723539, 4657926, 5866861, 5629624, 4196907, 2454738, 1128127, 404404, 110929, 22386, 3059, 226, 1)

sage: P = polytopes.permutahedron(6)                                                                                                                                                                                                                                                                                                                                       
sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              
sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      
sage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
CPU times: user 1.44 ms, sys: 79 µs, total: 1.52 ms
Wall time: 1.52 ms
(1, 721, 1987, 1956, 808, 120, 1)
sage: P = polytopes.permutahedron(7)                                                                                                                                                                                                                                                                                                                                       
sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              
sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      
sage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
CPU times: user 20.8 ms, sys: 0 ns, total: 20.8 ms
Wall time: 20.9 ms
(1, 5041, 16251, 19761, 11144, 2860, 267, 1)
sage: P = polytopes.permutahedron(8, backend='normaliz')                                                                                                                                                                                                                                                                                                                   
sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              
sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      
sage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
CPU times: user 616 ms, sys: 8 ms, total: 624 ms
Wall time: 623 ms
(1, 40321, 148899, 215690, 154215, 56022, 9489, 572, 1)

# No change for simplicial/simple polytopes.
sage: P = polytopes.associahedron(['A', 11], backend='normaliz')                                                                                                                                                                                                                                                                                                           
sage: C = CombinatorialPolyhedron(P)                                                                                                                                                                                                                                                                                                                                       
sage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
CPU times: user 24.3 s, sys: 16.3 ms, total: 24.3 s
Wall time: 24.3 s
(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)
```

This is the last subsequent improvement in comparison to sage 8.9 mentioned in https://arxiv.org/abs/1905.01945.

Follow ups:
- Move things from `geometry/polyhedron/combinatorial_polyhedron` to a more general location.
- Some renamings for lattices in general `face` -> `element`.
- Expose to simplical complexes.
- Expose to lattice of flats of matroids.

Depends on #27103

CC:  @stumpc5 @tscrim

Keywords: **combinatorial polyhedron, sparse bitsets**

Branch/Commit: **[`b3212d0`](https://github.com/sagemath/sagetrac-mirror/commit/b3212d0bb74109461114b23d63fc26e604c121f2)**

Reviewer: **Travis Scrimshaw**

Author: **Jonathan Kliem**

Component: **geometry**

_Issue created by migration from https://trac.sagemath.org/ticket/31262_





---

archive/issue_events_432973.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-01-18T23:27:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31262#event-432973"
}
```



---

archive/issue_events_432974.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-01-18T23:27:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20geometry",
    "label_color": "0000ff",
    "label_name": "c: geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31262#event-432974"
}
```



---

archive/issue_events_432975.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-01-18T23:27:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31262#event-432975"
}
```



---

archive/issue_events_432976.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-01-18T23:27:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31262#event-432976"
}
```



---

archive/issue_events_432977.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-01-18T23:27:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31262#event-432977"
}
```



---

archive/issue_events_432978.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-01-19T06:58:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31262#event-432978"
}
```



---

archive/issue_events_432979.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-01-19T06:58:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31262#event-432979"
}
```



---

archive/issue_comments_501015.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nFailing doctests.",
    "created_at": "2021-01-19T06:58:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31262#issuecomment-501015",
    "user": "https://github.com/kliem"
}
```

<div id="comment:2" align="right">comment:2</div>

Failing doctests.



---

archive/issue_comments_501016.json:
```json
{
    "body": "Changed commit from **[`24ff7cc`](https://github.com/sagemath/sagetrac-mirror/commit/24ff7ccf96a970655e2ce4c4db37cce343bd9c40)** to **[`eb6046e`](https://github.com/sagemath/sagetrac-mirror/commit/eb6046e8eed53d2511f9a3d4fcf95f034df39108)**",
    "created_at": "2021-01-19T11:31:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31262#issuecomment-501016",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`24ff7cc`](https://github.com/sagemath/sagetrac-mirror/commit/24ff7ccf96a970655e2ce4c4db37cce343bd9c40)** to **[`eb6046e`](https://github.com/sagemath/sagetrac-mirror/commit/eb6046e8eed53d2511f9a3d4fcf95f034df39108)**



---

archive/issue_comments_501017.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eb6046e8eed53d2511f9a3d4fcf95f034df39108\"><code>eb6046e</code></a></td><td><code>improved documentation and fixed error</code></td></tr></table>\n",
    "created_at": "2021-01-19T11:31:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31262#issuecomment-501017",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eb6046e8eed53d2511f9a3d4fcf95f034df39108"><code>eb6046e</code></a></td><td><code>improved documentation and fixed error</code></td></tr></table>




---

archive/issue_events_432980.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-01-19T11:31:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31262#event-432980"
}
```



---

archive/issue_events_432981.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-01-19T11:31:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31262#event-432981"
}
```



---

archive/issue_comments_501018.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nPossibly it might make sense to factor this ticket in two:\n\n- One that removes duplicates in `bitset_intrinsics.h`.\n- One that actually adds the slight modifications for sparse bitsets.",
    "created_at": "2021-01-19T12:14:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31262#issuecomment-501018",
    "user": "https://github.com/kliem"
}
```

<div id="comment:5" align="right">comment:5</div>

Possibly it might make sense to factor this ticket in two:

- One that removes duplicates in `bitset_intrinsics.h`.
- One that actually adds the slight modifications for sparse bitsets.



---

archive/issue_comments_501019.json:
```json
{
    "body": "Changed commit from **[`eb6046e`](https://github.com/sagemath/sagetrac-mirror/commit/eb6046e8eed53d2511f9a3d4fcf95f034df39108)** to **[`4362e2c`](https://github.com/sagemath/sagetrac-mirror/commit/4362e2ce0a52f8480793d34667a582d90163bc78)**",
    "created_at": "2021-01-19T15:09:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31262#issuecomment-501019",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`eb6046e`](https://github.com/sagemath/sagetrac-mirror/commit/eb6046e8eed53d2511f9a3d4fcf95f034df39108)** to **[`4362e2c`](https://github.com/sagemath/sagetrac-mirror/commit/4362e2ce0a52f8480793d34667a582d90163bc78)**



---

archive/issue_comments_501020.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4362e2ce0a52f8480793d34667a582d90163bc78\"><code>4362e2c</code></a></td><td><code>use enum to make code a bit more canonical</code></td></tr></table>\n",
    "created_at": "2021-01-19T15:09:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31262#issuecomment-501020",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4362e2ce0a52f8480793d34667a582d90163bc78"><code>4362e2c</code></a></td><td><code>use enum to make code a bit more canonical</code></td></tr></table>




---

archive/issue_comments_501021.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fc0f1d96ff897f1897125956d9495e5536888dac\"><code>fc0f1d9</code></a></td><td><code>resolve slow down comparison</code></td></tr></table>\n",
    "created_at": "2021-01-19T15:43:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31262#issuecomment-501021",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fc0f1d96ff897f1897125956d9495e5536888dac"><code>fc0f1d9</code></a></td><td><code>resolve slow down comparison</code></td></tr></table>




---

archive/issue_comments_501022.json:
```json
{
    "body": "Changed commit from **[`4362e2c`](https://github.com/sagemath/sagetrac-mirror/commit/4362e2ce0a52f8480793d34667a582d90163bc78)** to **[`fc0f1d9`](https://github.com/sagemath/sagetrac-mirror/commit/fc0f1d96ff897f1897125956d9495e5536888dac)**",
    "created_at": "2021-01-19T15:43:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31262#issuecomment-501022",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4362e2c`](https://github.com/sagemath/sagetrac-mirror/commit/4362e2ce0a52f8480793d34667a582d90163bc78)** to **[`fc0f1d9`](https://github.com/sagemath/sagetrac-mirror/commit/fc0f1d96ff897f1897125956d9495e5536888dac)**



---

archive/issue_comments_501023.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -75,37 +75,37 @@\n sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              \n sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      \n sage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \n-CPU times: user 1.71 s, sys: 0 ns, total: 1.71 s\n-Wall time: 1.71 s\n+CPU times: user 1.67 s, sys: 0 ns, total: 1.67 s\n+Wall time: 1.66 s\n (1, 16385, 131069, 487383, 1117948, 1769482, 2047331, 1788501, 1200342, 622908, 248963, 75361, 16640, 2470, 197, 1)\n sage: P = polytopes.hypercube(15)                                                                                                                                                                                                                                                                                                                                          \n sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              \n sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      \n sage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \n-CPU times: user 7.54 s, sys: 4 ms, total: 7.54 s\n-Wall time: 7.54 s\n+CPU times: user 7.28 s, sys: 8 ms, total: 7.28 s\n+Wall time: 7.28 s\n (1, 32769, 278525, 1105876, 2723539, 4657926, 5866861, 5629624, 4196907, 2454738, 1128127, 404404, 110929, 22386, 3059, 226, 1)\n \n sage: P = polytopes.permutahedron(6)                                                                                                                                                                                                                                                                                                                                       \n sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              \n sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      \n sage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \n-CPU times: user 1.45 ms, sys: 0 ns, total: 1.45 ms\n-Wall time: 1.55 ms\n+CPU times: user 1.44 ms, sys: 79 \u00b5s, total: 1.52 ms\n+Wall time: 1.52 ms\n (1, 721, 1987, 1956, 808, 120, 1)\n sage: P = polytopes.permutahedron(7)                                                                                                                                                                                                                                                                                                                                       \n sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              \n sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      \n sage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \n-CPU times: user 20.8 ms, sys: 27 \u00b5s, total: 20.8 ms\n-Wall time: 20.7 ms\n+CPU times: user 20.8 ms, sys: 0 ns, total: 20.8 ms\n+Wall time: 20.9 ms\n (1, 5041, 16251, 19761, 11144, 2860, 267, 1)\n sage: P = polytopes.permutahedron(8, backend='normaliz')                                                                                                                                                                                                                                                                                                                   \n sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              \n sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      \n sage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   \n-CPU times: user 665 ms, sys: 4 \u00b5s, total: 665 ms\n-Wall time: 664 ms\n+CPU times: user 616 ms, sys: 8 ms, total: 624 ms\n+Wall time: 623 ms\n (1, 40321, 148899, 215690, 154215, 56022, 9489, 572, 1)\n \n # No change for simplicial/simple polytopes.\n``````\n",
    "created_at": "2021-01-19T15:45:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31262#issuecomment-501023",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -75,37 +75,37 @@
 sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              
 sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      
 sage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
-CPU times: user 1.71 s, sys: 0 ns, total: 1.71 s
-Wall time: 1.71 s
+CPU times: user 1.67 s, sys: 0 ns, total: 1.67 s
+Wall time: 1.66 s
 (1, 16385, 131069, 487383, 1117948, 1769482, 2047331, 1788501, 1200342, 622908, 248963, 75361, 16640, 2470, 197, 1)
 sage: P = polytopes.hypercube(15)                                                                                                                                                                                                                                                                                                                                          
 sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              
 sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      
 sage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
-CPU times: user 7.54 s, sys: 4 ms, total: 7.54 s
-Wall time: 7.54 s
+CPU times: user 7.28 s, sys: 8 ms, total: 7.28 s
+Wall time: 7.28 s
 (1, 32769, 278525, 1105876, 2723539, 4657926, 5866861, 5629624, 4196907, 2454738, 1128127, 404404, 110929, 22386, 3059, 226, 1)
 
 sage: P = polytopes.permutahedron(6)                                                                                                                                                                                                                                                                                                                                       
 sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              
 sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      
 sage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
-CPU times: user 1.45 ms, sys: 0 ns, total: 1.45 ms
-Wall time: 1.55 ms
+CPU times: user 1.44 ms, sys: 79 µs, total: 1.52 ms
+Wall time: 1.52 ms
 (1, 721, 1987, 1956, 808, 120, 1)
 sage: P = polytopes.permutahedron(7)                                                                                                                                                                                                                                                                                                                                       
 sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              
 sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      
 sage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
-CPU times: user 20.8 ms, sys: 27 µs, total: 20.8 ms
-Wall time: 20.7 ms
+CPU times: user 20.8 ms, sys: 0 ns, total: 20.8 ms
+Wall time: 20.9 ms
 (1, 5041, 16251, 19761, 11144, 2860, 267, 1)
 sage: P = polytopes.permutahedron(8, backend='normaliz')                                                                                                                                                                                                                                                                                                                   
 sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                                                                                                                                                                                                              
 sage: C = CombinatorialPolyhedron(P1)                                                                                                                                                                                                                                                                                                                                      
 sage: %time C.f_vector()                                                                                                                                                                                                                                                                                                                                                   
-CPU times: user 665 ms, sys: 4 µs, total: 665 ms
-Wall time: 664 ms
+CPU times: user 616 ms, sys: 8 ms, total: 624 ms
+Wall time: 623 ms
 (1, 40321, 148899, 215690, 154215, 56022, 9489, 572, 1)
 
 # No change for simplicial/simple polytopes.
``````




---

archive/issue_comments_501024.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nCleaner code makes things a bit faster, I suppose.",
    "created_at": "2021-01-19T15:45:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31262#issuecomment-501024",
    "user": "https://github.com/kliem"
}
```

<div id="comment:8" align="right">comment:8</div>

Cleaner code makes things a bit faster, I suppose.



---

archive/issue_comments_501025.json:
```json
{
    "body": "Changed commit from **[`fc0f1d9`](https://github.com/sagemath/sagetrac-mirror/commit/fc0f1d96ff897f1897125956d9495e5536888dac)** to **[`b3212d0`](https://github.com/sagemath/sagetrac-mirror/commit/b3212d0bb74109461114b23d63fc26e604c121f2)**",
    "created_at": "2021-01-19T18:49:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31262#issuecomment-501025",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fc0f1d9`](https://github.com/sagemath/sagetrac-mirror/commit/fc0f1d96ff897f1897125956d9495e5536888dac)** to **[`b3212d0`](https://github.com/sagemath/sagetrac-mirror/commit/b3212d0bb74109461114b23d63fc26e604c121f2)**



---

archive/issue_comments_501026.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b3212d0bb74109461114b23d63fc26e604c121f2\"><code>b3212d0</code></a></td><td><code>two mistakes with no intrinsics</code></td></tr></table>\n",
    "created_at": "2021-01-19T18:49:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31262#issuecomment-501026",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b3212d0bb74109461114b23d63fc26e604c121f2"><code>b3212d0</code></a></td><td><code>two mistakes with no intrinsics</code></td></tr></table>




---

archive/issue_comments_501027.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nAll doctests pass on my side. With the current setup:\n\n- AVX2, AVX, SSE4.1\n- AVX, SSE4.1 (only `geometry/polyhedron` and `data_structure/` tested)\n- SSE4.1\n- no intrinsics.",
    "created_at": "2021-01-19T19:30:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31262#issuecomment-501027",
    "user": "https://github.com/kliem"
}
```

<div id="comment:10" align="right">comment:10</div>

All doctests pass on my side. With the current setup:

- AVX2, AVX, SSE4.1
- AVX, SSE4.1 (only `geometry/polyhedron` and `data_structure/` tested)
- SSE4.1
- no intrinsics.



---

archive/issue_comments_501028.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nLGTM.",
    "created_at": "2021-01-20T06:12:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31262#issuecomment-501028",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:11" align="right">comment:11</div>

LGTM.



---

archive/issue_comments_501029.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2021-01-20T06:12:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31262#issuecomment-501029",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_events_432982.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-01-20T06:12:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31262#event-432982"
}
```



---

archive/issue_events_432983.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-01-20T06:12:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31262#event-432983"
}
```



---

archive/issue_comments_501030.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThank you.",
    "created_at": "2021-01-20T09:46:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31262#issuecomment-501030",
    "user": "https://github.com/kliem"
}
```

<div id="comment:12" align="right">comment:12</div>

Thank you.



---

archive/issue_events_432984.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-01-31T20:53:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31262#event-432984"
}
```



---

archive/issue_events_432985.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "9c39188e60ef2cb95f19cf3c4c0468d5e1c2d116",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-01-31T20:53:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31262#event-432985"
}
```



---

archive/issue_comments_501031.json:
```json
{
    "body": "Changed branch from **[u/gh-kliem/small_improvements_for_sparse_bitsets](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/small_improvements_for_sparse_bitsets)** to **[`b3212d0`](https://github.com/sagemath/sagetrac-mirror/commit/b3212d0bb74109461114b23d63fc26e604c121f2)**",
    "created_at": "2021-01-31T20:53:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31262#issuecomment-501031",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gh-kliem/small_improvements_for_sparse_bitsets](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/small_improvements_for_sparse_bitsets)** to **[`b3212d0`](https://github.com/sagemath/sagetrac-mirror/commit/b3212d0bb74109461114b23d63fc26e604c121f2)**
