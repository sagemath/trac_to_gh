# Issue 31410: fix symmetric_form for type B and F

archive/issues_031173.json:
```json
{
    "body": "Currently, we have\n\n```\ndef s1(ct):\n   L = RootSystem(ct).weight_space()\n   P = L.positive_roots()\n   rho = L.rho()\n   return [beta.symmetric_form(rho) for beta in P]\n\ndef s2(ct):\n   R = RootSystem(ct).root_space()\n   P = R.positive_roots()\n   rho = 1/2*sum(P)\n   return [beta.symmetric_form(rho) for beta in P]\n\nsage: cartan_types = sage.databases.findstat._finite_irreducible_cartan_types_by_rank\nsage: [(ct, s1(ct), s2(ct)) for n in range(1,9) for ct in cartan_types(n) if s1(ct) != s2(ct)]\n[['B', 2], ['B', 3], ['B', 4], ['F', 4], ['B', 5], ['B', 6], ['B', 7], ['B', 8]]\n```\n\nSpecifically, for these it seems that I have to multiply everything by 2 if I am computing in the weight lattice.\n\n```\nsage: ct = CartanType([\"B\", 2]); [2*x for x in s1(ct)] == s2(ct)  \nTrue\nsage: ct = CartanType([\"F\", 4]); [2*x for x in s1(ct)] == s2(ct)\nTrue\n```\n\nAs Travis points out:\n\nThe issue comes from the diagonalization:\n\n```\nsage: cm = CartanMatrix(['B',3])                                                                                  \nsage: cm.is_symmetrizable(True)                                                                                   \n[1, 1, 1/2]\nsage: CartanMatrix(['F',4]).is_symmetrizable(True)                                                                \n[1, 1, 1/2, 1/2]\n```\nThe diagonal matrix is built from the integer valued version. This accounts for the factor of 2. So in `_symmetric_form_matrix`, the `cm.symmetrizer()` should be used instead of `cm.is_symmetrizable(True)` (or copy the scalar factor from the `symmetrizer()` implementation).\n\nCC:  @tscrim\n\nBranch/Commit: c94efb097958ecc23f63461ae560b7c69cbcaa05\n\nReviewer: Travis Scrimshaw\n\nAuthor: Martin Rubey\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31410\n\n",
    "closed_at": "2021-03-09T00:01:19Z",
    "created_at": "2021-02-17T09:41:54Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "fix symmetric_form for type B and F",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31410",
    "user": "https://github.com/mantepse"
}
```
Currently, we have

```
def s1(ct):
   L = RootSystem(ct).weight_space()
   P = L.positive_roots()
   rho = L.rho()
   return [beta.symmetric_form(rho) for beta in P]

def s2(ct):
   R = RootSystem(ct).root_space()
   P = R.positive_roots()
   rho = 1/2*sum(P)
   return [beta.symmetric_form(rho) for beta in P]

sage: cartan_types = sage.databases.findstat._finite_irreducible_cartan_types_by_rank
sage: [(ct, s1(ct), s2(ct)) for n in range(1,9) for ct in cartan_types(n) if s1(ct) != s2(ct)]
[['B', 2], ['B', 3], ['B', 4], ['F', 4], ['B', 5], ['B', 6], ['B', 7], ['B', 8]]
```

Specifically, for these it seems that I have to multiply everything by 2 if I am computing in the weight lattice.

```
sage: ct = CartanType(["B", 2]); [2*x for x in s1(ct)] == s2(ct)  
True
sage: ct = CartanType(["F", 4]); [2*x for x in s1(ct)] == s2(ct)
True
```

As Travis points out:

The issue comes from the diagonalization:

```
sage: cm = CartanMatrix(['B',3])                                                                                  
sage: cm.is_symmetrizable(True)                                                                                   
[1, 1, 1/2]
sage: CartanMatrix(['F',4]).is_symmetrizable(True)                                                                
[1, 1, 1/2, 1/2]
```
The diagonal matrix is built from the integer valued version. This accounts for the factor of 2. So in `_symmetric_form_matrix`, the `cm.symmetrizer()` should be used instead of `cm.is_symmetrizable(True)` (or copy the scalar factor from the `symmetrizer()` implementation).

CC:  @tscrim

Branch/Commit: c94efb097958ecc23f63461ae560b7c69cbcaa05

Reviewer: Travis Scrimshaw

Author: Martin Rubey

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31410





---

archive/issue_comments_624102.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mantepse/fix_symmetric_form_for_type_b_and_f\"",
    "created_at": "2021-02-17T10:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31410#issuecomment-624102",
    "user": "https://github.com/mantepse"
}
```

Changing branch from "" to "u/mantepse/fix_symmetric_form_for_type_b_and_f"



---

archive/issue_comments_624103.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2021-02-17T10:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31410#issuecomment-624103",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_624104.json:
```json
{
    "body": "Changing author from \"\" to \"Martin Rubey\"",
    "created_at": "2021-02-17T10:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31410#issuecomment-624104",
    "user": "https://github.com/mantepse"
}
```

Changing author from "" to "Martin Rubey"



---

archive/issue_comments_624105.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-02-17T10:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31410#issuecomment-624105",
    "user": "https://github.com/mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_624106.json:
```json
{
    "body": "Changing commit from \"\" to \"e80c0b3dfac26e53a5bee24b1849c46a138d439c\"",
    "created_at": "2021-02-17T10:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31410#issuecomment-624106",
    "user": "https://github.com/mantepse"
}
```

Changing commit from "" to "e80c0b3dfac26e53a5bee24b1849c46a138d439c"



---

archive/issue_comments_624107.json:
```json
{
    "body": "<a id='comment:3'></a>Thank you for the fix. Please revert this change as it is not Sage's convention for the documentation:\n\n```diff\n-            r\"\"\"\n-            Return the symmetric form of ``self`` with ``la``.\n+            r\"\"\"Return the symmetric form of ``self`` with ``la``.\n```\nOnce that is done, you can set a positive review on my behalf.",
    "created_at": "2021-02-17T15:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31410#issuecomment-624107",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>Thank you for the fix. Please revert this change as it is not Sage's convention for the documentation:

```diff
-            r"""
-            Return the symmetric form of ``self`` with ``la``.
+            r"""Return the symmetric form of ``self`` with ``la``.
```
Once that is done, you can set a positive review on my behalf.



---

archive/issue_comments_624108.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2021-02-17T15:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31410#issuecomment-624108",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_624109.json:
```json
{
    "body": "Changing commit from \"e80c0b3dfac26e53a5bee24b1849c46a138d439c\" to \"c94efb097958ecc23f63461ae560b7c69cbcaa05\"",
    "created_at": "2021-02-17T15:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31410#issuecomment-624109",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e80c0b3dfac26e53a5bee24b1849c46a138d439c" to "c94efb097958ecc23f63461ae560b7c69cbcaa05"



---

archive/issue_comments_624110.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-17T15:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31410#issuecomment-624110",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_624111.json:
```json
{
    "body": "<a id='comment:5'></a>Thank you!\n\nFinal question: should we provide `rho` also for the root space (the precise interaction between root space and weight space is unclear to me).",
    "created_at": "2021-02-17T15:20:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31410#issuecomment-624111",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:5'></a>Thank you!

Final question: should we provide `rho` also for the root space (the precise interaction between root space and weight space is unclear to me).



---

archive/issue_comments_624112.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-17T15:20:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31410#issuecomment-624112",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_624113.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [mantepse](#comment%3A5):\n> Final question: should we provide `rho` also for the root space\n\n\nhmm...I am not sure. I am leaning towards no because it is something special for finite type and it would make a difference between the root lattice and root space. Although that is not a very strong opinion.\n\n> (the precise interaction between root space and weight space is unclear to me). \n\n\nThe Cartan matrix defines the coercion `root -> weight`.",
    "created_at": "2021-02-17T22:36:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31410#issuecomment-624113",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>Replying to [mantepse](#comment%3A5):
> Final question: should we provide `rho` also for the root space


hmm...I am not sure. I am leaning towards no because it is something special for finite type and it would make a difference between the root lattice and root space. Although that is not a very strong opinion.

> (the precise interaction between root space and weight space is unclear to me). 


The Cartan matrix defines the coercion `root -> weight`.



---

archive/issue_events_082341.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-09T00:01:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31410",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31410#event-82341"
}
```



---

archive/issue_comments_624114.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-03-09T00:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31410#issuecomment-624114",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_624115.json:
```json
{
    "body": "Changing branch from \"u/mantepse/fix_symmetric_form_for_type_b_and_f\" to \"c94efb097958ecc23f63461ae560b7c69cbcaa05\"",
    "created_at": "2021-03-09T00:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31410#issuecomment-624115",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mantepse/fix_symmetric_form_for_type_b_and_f" to "c94efb097958ecc23f63461ae560b7c69cbcaa05"
