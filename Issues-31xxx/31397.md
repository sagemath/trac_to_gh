# Issue 31397: Work around LaTeX bug for building pdf documentation

archive/issues_031160.json:
```json
{
    "body": "Very recent versions of LaTeX won't build the PDF documentation for `en/reference/stats/`, instead yielding an error:\n\n```\nChapter 8.\n! TeX capacity exceeded, sorry [input stack size=5000].\n\\non@alpherr #1->\\@latex@error {\\string #1\n                                          allowed only in math mode}\\@ehd \nl.2922 ...Samplers for \\protect\\(\\ZZ[x]\\protect\\)}                                           \n```\nWe should find a workaround.\n\n(Split off from #31387 \u2014\u00a0some more discussion there.)\n\nLaTeX bug is fixed at https://github.com/latex3/latex2e/pull/503.\n\nBranch/Commit: be986486a526fc52606182f79353457e9e6a90cf\n\nUpstream: Fixed upstream, in a later stable release.\n\nReviewer: Dave Morris\n\nAuthor: John Palmieri\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31397\n\n",
    "closed_at": "2021-03-01T00:21:10Z",
    "created_at": "2021-02-14T22:34:27Z",
    "labels": [
        "component: documentation",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Work around LaTeX bug for building pdf documentation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31397",
    "user": "https://github.com/jhpalmieri"
}
```
Very recent versions of LaTeX won't build the PDF documentation for `en/reference/stats/`, instead yielding an error:

```
Chapter 8.
! TeX capacity exceeded, sorry [input stack size=5000].
\non@alpherr #1->\@latex@error {\string #1
                                          allowed only in math mode}\@ehd 
l.2922 ...Samplers for \protect\(\ZZ[x]\protect\)}                                           
```
We should find a workaround.

(Split off from #31387 — some more discussion there.)

LaTeX bug is fixed at https://github.com/latex3/latex2e/pull/503.

Branch/Commit: be986486a526fc52606182f79353457e9e6a90cf

Upstream: Fixed upstream, in a later stable release.

Reviewer: Dave Morris

Author: John Palmieri

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31397





---

archive/issue_comments_444866.json:
```json
{
    "body": "<a id='comment:1'></a>This is under discussion at \u200bhttps://tex.stackexchange.com/questions/583391/mactex-2020-error-with-report-hyperref-mathbf-in-chapter and has been proposed as a bug at \u200bhttps://github.com/latex3/latex2e/issues/501.",
    "created_at": "2021-02-14T22:35:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31397#issuecomment-444866",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'></a>This is under discussion at ​https://tex.stackexchange.com/questions/583391/mactex-2020-error-with-report-hyperref-mathbf-in-chapter and has been proposed as a bug at ​https://github.com/latex3/latex2e/issues/501.



---

archive/issue_comments_444867.json:
```json
{
    "body": "<a id='comment:4'></a>This works for me (taken from one of the answers at tex.stackexchange.com).\n\n---\nNew commits:",
    "created_at": "2021-02-14T23:21:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31397#issuecomment-444867",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>This works for me (taken from one of the answers at tex.stackexchange.com).

---
New commits:



---

archive/issue_comments_444868.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-02-14T23:21:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31397#issuecomment-444868",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_444869.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-16T05:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31397#issuecomment-444869",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_444870.json:
```json
{
    "body": "<a id='comment:6'></a>Works for me, too. Thanks for fixing this. \n\nBy the way, I don't think `\\makeatletter` and `\\makeatother` are necessary, because the definition of `\\pdfstringdefDisableCommands` in hyperref.sty already includes `\\makeatletter`:\n\n```\n\\def\\pdfstringdefDisableCommands{%\n  \\begingroup\n    \\makeatletter\n    \\HyPsd@DisableCommands\n}\n```\nHowever, I don't see any harm in adding the extra lines, and it seems possible that old versions of hyperref might not have this, so the extra lines may be safer.",
    "created_at": "2021-02-16T05:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31397#issuecomment-444870",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:6'></a>Works for me, too. Thanks for fixing this. 

By the way, I don't think `\makeatletter` and `\makeatother` are necessary, because the definition of `\pdfstringdefDisableCommands` in hyperref.sty already includes `\makeatletter`:

```
\def\pdfstringdefDisableCommands{%
  \begingroup
    \makeatletter
    \HyPsd@DisableCommands
}
```
However, I don't see any harm in adding the extra lines, and it seems possible that old versions of hyperref might not have this, so the extra lines may be safer.



---

archive/issue_comments_444871.json:
```json
{
    "body": "<a id='comment:7'></a>Great, thank you!",
    "created_at": "2021-02-16T06:04:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31397#issuecomment-444871",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>Great, thank you!



---

archive/issue_events_082259.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-01T00:21:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31397",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31397#event-82259"
}
```



---

archive/issue_comments_444872.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-03-01T00:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31397#issuecomment-444872",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
