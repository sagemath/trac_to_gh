# Issue 31397: Work around LaTeX bug for building pdf documentation

archive/issues_031160.json:
```json
{
    "assignees": [],
    "body": "Very recent versions of LaTeX won't build the PDF documentation for `en/reference/stats/`, instead yielding an error:\n\n```\nChapter 8.\n! TeX capacity exceeded, sorry [input stack size=5000].\n\\non@alpherr #1->\\@latex@error {\\string #1\n                                          allowed only in math mode}\\@ehd \nl.2922 ...Samplers for \\protect\\(\\ZZ[x]\\protect\\)}                                           \n```\nWe should find a workaround.\n\n(Split off from #31387 \u2014\u00a0some more discussion there.)\n\nLaTeX bug is fixed at https://github.com/latex3/latex2e/pull/503.\n\nBranch/Commit: **[be98648](https://github.com/sagemath/sagetrac-mirror/commit/be986486a526fc52606182f79353457e9e6a90cf)**\n\nUpstream: **Fixed upstream, in a later stable release.**\n\nReviewer: **Dave Morris**\n\nAuthor: **John Palmieri**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31397_\n\n",
    "closed_at": "2021-03-01T00:21:10Z",
    "created_at": "2021-02-14T22:34:27Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20documentation",
        "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Work around LaTeX bug for building pdf documentation",
    "type": "issue",
    "updated_at": "2021-03-01T00:21:10Z",
    "url": "https://github.com/sagemath/sage/issues/31397",
    "user": "https://github.com/jhpalmieri"
}
```
Very recent versions of LaTeX won't build the PDF documentation for `en/reference/stats/`, instead yielding an error:

```
Chapter 8.
! TeX capacity exceeded, sorry [input stack size=5000].
\non@alpherr #1->\@latex@error {\string #1
                                          allowed only in math mode}\@ehd 
l.2922 ...Samplers for \protect\(\ZZ[x]\protect\)}                                           
```
We should find a workaround.

(Split off from #31387 — some more discussion there.)

LaTeX bug is fixed at https://github.com/latex3/latex2e/pull/503.

Branch/Commit: **[be98648](https://github.com/sagemath/sagetrac-mirror/commit/be986486a526fc52606182f79353457e9e6a90cf)**

Upstream: **Fixed upstream, in a later stable release.**

Reviewer: **Dave Morris**

Author: **John Palmieri**

_Issue created by migration from https://trac.sagemath.org/ticket/31397_





---

archive/issue_events_414494.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2021-02-14T22:34:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31397#event-414494"
}
```



---

archive/issue_events_414495.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2021-02-14T22:34:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20documentation",
    "label_color": "0075ca",
    "label_name": "component: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31397#event-414495"
}
```



---

archive/issue_events_414496.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2021-02-14T22:34:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "label": "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31397#event-414496"
}
```



---

archive/issue_events_414497.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2021-02-14T22:34:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31397#event-414497"
}
```



---

archive/issue_comments_507036.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nThis is under discussion at \u200bhttps://tex.stackexchange.com/questions/583391/mactex-2020-error-with-report-hyperref-mathbf-in-chapter and has been proposed as a bug at \u200bhttps://github.com/latex3/latex2e/issues/501.",
    "created_at": "2021-02-14T22:35:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31397#issuecomment-507036",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:1" align="right">Comment 1</div>

This is under discussion at ​https://tex.stackexchange.com/questions/583391/mactex-2020-error-with-report-hyperref-mathbf-in-chapter and has been proposed as a bug at ​https://github.com/latex3/latex2e/issues/501.



---

archive/issue_comments_507037.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,3 +8,5 @@\n l.2922 ...Samplers for \\protect\\(\\ZZ[x]\\protect\\)}                                           \n ```\n We should find a workaround.\n+\n+(Split off from #31387 \u2014\u00a0some more discussion there.)\n``````\n",
    "created_at": "2021-02-14T22:36:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31397#issuecomment-507037",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,3 +8,5 @@
 l.2922 ...Samplers for \protect\(\ZZ[x]\protect\)}                                           
 ```
 We should find a workaround.
+
+(Split off from #31387 — some more discussion there.)
``````




---

archive/issue_comments_507038.json:
```json
{
    "body": "Branch: **[u/jhpalmieri/pdf-docbuild-fix](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/pdf-docbuild-fix)**",
    "created_at": "2021-02-14T23:20:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31397#issuecomment-507038",
    "user": "https://github.com/jhpalmieri"
}
```

Branch: **[u/jhpalmieri/pdf-docbuild-fix](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/pdf-docbuild-fix)**



---

archive/issue_comments_507039.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nThis works for me (taken from one of the answers at tex.stackexchange.com).\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be986486a526fc52606182f79353457e9e6a90cf\">be98648</a></td><td><code>trac 31397: workaround for LaTeX bug when building PDF documentation</code></td></tr></table>\n",
    "created_at": "2021-02-14T23:21:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31397#issuecomment-507039",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:4" align="right">Comment 4</div>

This works for me (taken from one of the answers at tex.stackexchange.com).

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be986486a526fc52606182f79353457e9e6a90cf">be98648</a></td><td><code>trac 31397: workaround for LaTeX bug when building PDF documentation</code></td></tr></table>




---

archive/issue_comments_507040.json:
```json
{
    "body": "Author: **John Palmieri**",
    "created_at": "2021-02-14T23:21:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31397#issuecomment-507040",
    "user": "https://github.com/jhpalmieri"
}
```

Author: **John Palmieri**



---

archive/issue_comments_507041.json:
```json
{
    "body": "Commit: **[be98648](https://github.com/sagemath/sagetrac-mirror/commit/be986486a526fc52606182f79353457e9e6a90cf)**",
    "created_at": "2021-02-14T23:21:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31397#issuecomment-507041",
    "user": "https://github.com/jhpalmieri"
}
```

Commit: **[be98648](https://github.com/sagemath/sagetrac-mirror/commit/be986486a526fc52606182f79353457e9e6a90cf)**



---

archive/issue_events_414498.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2021-02-14T23:21:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31397#event-414498"
}
```



---

archive/issue_comments_507042.json:
```json
{
    "body": "Upstream: **Fixed upstream, in a later stable release.**",
    "created_at": "2021-02-15T16:59:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31397#issuecomment-507042",
    "user": "https://github.com/jhpalmieri"
}
```

Upstream: **Fixed upstream, in a later stable release.**



---

archive/issue_comments_507043.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,3 +10,5 @@\n We should find a workaround.\n \n (Split off from #31387 \u2014\u00a0some more discussion there.)\n+\n+LaTeX bug is fixed at https://github.com/latex3/latex2e/pull/503.\n``````\n",
    "created_at": "2021-02-15T16:59:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31397#issuecomment-507043",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,3 +10,5 @@
 We should find a workaround.
 
 (Split off from #31387 — some more discussion there.)
+
+LaTeX bug is fixed at https://github.com/latex3/latex2e/pull/503.
``````




---

archive/issue_comments_507044.json:
```json
{
    "body": "Reviewer: **Dave Morris**",
    "created_at": "2021-02-16T05:36:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31397#issuecomment-507044",
    "user": "https://github.com/DaveWitteMorris"
}
```

Reviewer: **Dave Morris**



---

archive/issue_events_414499.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2021-02-16T05:36:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31397#event-414499"
}
```



---

archive/issue_events_414500.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2021-02-16T05:36:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31397#event-414500"
}
```



---

archive/issue_comments_507045.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nWorks for me, too. Thanks for fixing this. \n\nBy the way, I don't think `\\makeatletter` and `\\makeatother` are necessary, because the definition of `\\pdfstringdefDisableCommands` in hyperref.sty already includes `\\makeatletter`:\n\n```\n\\def\\pdfstringdefDisableCommands{%\n  \\begingroup\n    \\makeatletter\n    \\HyPsd@DisableCommands\n}\n```\nHowever, I don't see any harm in adding the extra lines, and it seems possible that old versions of hyperref might not have this, so the extra lines may be safer.",
    "created_at": "2021-02-16T05:36:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31397#issuecomment-507045",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:6" align="right">Comment 6</div>

Works for me, too. Thanks for fixing this. 

By the way, I don't think `\makeatletter` and `\makeatother` are necessary, because the definition of `\pdfstringdefDisableCommands` in hyperref.sty already includes `\makeatletter`:

```
\def\pdfstringdefDisableCommands{%
  \begingroup
    \makeatletter
    \HyPsd@DisableCommands
}
```
However, I don't see any harm in adding the extra lines, and it seems possible that old versions of hyperref might not have this, so the extra lines may be safer.



---

archive/issue_comments_507046.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nGreat, thank you!",
    "created_at": "2021-02-16T06:04:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31397#issuecomment-507046",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:7" align="right">Comment 7</div>

Great, thank you!



---

archive/issue_events_414501.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-01T00:21:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31397#event-414501"
}
```



---

archive/issue_events_414502.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "df91b09b67a0b23c255aadb73926883aa81796fd",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-03-01T00:21:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31397#event-414502"
}
```



---

archive/issue_comments_507047.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/pdf-docbuild-fix](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/pdf-docbuild-fix)** to **[be98648](https://github.com/sagemath/sagetrac-mirror/commit/be986486a526fc52606182f79353457e9e6a90cf)**",
    "created_at": "2021-03-01T00:21:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31397#issuecomment-507047",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jhpalmieri/pdf-docbuild-fix](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/pdf-docbuild-fix)** to **[be98648](https://github.com/sagemath/sagetrac-mirror/commit/be986486a526fc52606182f79353457e9e6a90cf)**
