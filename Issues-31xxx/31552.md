# Issue 31552: Update singular to stop /usr/local from leaking into Singular build

archive/issues_031315.json:
```json
{
    "body": "On macOS, even when using `gcc -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk` (which disables use of `/usr/local`), Singular's `configure` script sneaks in `/usr/local/include` and `/usr/local/lib`.\n\n```\nIt was created by singular configure 4.2.0p1+2021-03-13+sage, which was\ngenerated by GNU Autoconf 2.69.  Invocation command line was\n\n  $ ./configure --prefix=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local --libdir=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local/lib --disable-maintainer-mode\n --disable-dependency-tracking --exec-prefix=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local --bindir=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local/bin --wit\nh-ntl=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local --with-flint=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local --enable-gfanlib --enable-Singular --enable-\nfactory --disable-doc --disable-polymake --without-python --without-pythonmodule --disable-python --disable-python_module --disable-python-module --disable\n-static\n\nPATH: /private/var/tmp/sage-9.3.rc0-cpython-38-darwin/build/bin\nPATH: /private/var/tmp/sage-9.3.rc0-cpython-38-darwin/src/bin\nPATH: /var/tmp/sage-9.3.rc0-cpython-38-darwin/local/bin\nPATH: /private/var/tmp/sage-9.3.rc0-cpython-38-darwin/build/bin\nPATH: /private/var/tmp/sage-9.3.rc0-cpython-38-darwin/src/bin\nPATH: /var/tmp/sage-9.3.rc0-cpython-38-darwin/local/bin\nPATH: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-build-env-dcsf70hx/overlay/bin\nPATH: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-build-env-dcsf70hx/normal/bin\nPATH: /Users/mkoeppe/s/sage/sage-rebasing/worktree-dist/src/pkgs/sage_conf-relocatable/.tox/python-macos-10.15-python3.8/bin\nPATH: /usr/local/opt/xz/bin\nPATH: /usr/local/opt/gpatch/bin\nPATH: /usr/bin\nPATH: /bin\nPATH: /usr/sbin\nPATH: /sbin\n\nconfigure:20714: checking gmp.h usability\nconfigure:20714: gcc -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk -c -O2 -g  -pipe -fno-common -g0 -O3 -Wno-unused-function -Wno-trigraphs -Wno-unused-parameter -Wunknown-pragmas -Wno-unused-variable -fomit-frame-pointer -fwrapv -fvisibility=default -finline-functions -fno-exceptions -fno-threadsafe-statics -funroll-loops -fno-delete-null-pointer-checks -Qunused-arguments -pthread -I/usr/local/include  conftest.c >&5\nconfigure:20714: $? = 0\nconfigure:20714: result: yes\n```\nIf NTL from homebrew is installed, this can lead to an NTL threading mismatch:\n\n```\n    [singular-4.2.0p1+2021-03-13+sage]   ld: illegal thread local variable reference to regular symbol __ZN3NTL13ErrorCallbackE for architecture x86_64\n    [singular-4.2.0p1+2021-03-13+sage]   clang: error: linker command failed with exit code 1 (use -v to see invocation)\n```\n\n\nPR: https://github.com/Singular/Singular/pull/1066\n\n\nSee also: #31348 `build/pkgs/{mpir,mpfr}/spkg-configure.m4`: Check pkg-config first\n\n\n**CC:**  @dimpase @slel @jhpalmieri @zlscherr @kiwifb @videlec @antonio-rojas\n\n**Branch/Commit:** [8b5b2739d107271f8477cee8cd941bec8b255827](https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827)\n\n**Upstream:** Fixed upstream, but not in a stable release.\n\n**Reviewer:** Fran\u00e7ois Bissey\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/31552\n\n",
    "closed_at": "2021-04-02T22:56:41Z",
    "created_at": "2021-03-24T18:42:44Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "title": "Update singular to stop /usr/local from leaking into Singular build",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/31552",
    "user": "https://github.com/mkoeppe"
}
```
On macOS, even when using `gcc -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk` (which disables use of `/usr/local`), Singular's `configure` script sneaks in `/usr/local/include` and `/usr/local/lib`.

```
It was created by singular configure 4.2.0p1+2021-03-13+sage, which was
generated by GNU Autoconf 2.69.  Invocation command line was

  $ ./configure --prefix=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local --libdir=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local/lib --disable-maintainer-mode
 --disable-dependency-tracking --exec-prefix=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local --bindir=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local/bin --wit
h-ntl=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local --with-flint=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local --enable-gfanlib --enable-Singular --enable-
factory --disable-doc --disable-polymake --without-python --without-pythonmodule --disable-python --disable-python_module --disable-python-module --disable
-static

PATH: /private/var/tmp/sage-9.3.rc0-cpython-38-darwin/build/bin
PATH: /private/var/tmp/sage-9.3.rc0-cpython-38-darwin/src/bin
PATH: /var/tmp/sage-9.3.rc0-cpython-38-darwin/local/bin
PATH: /private/var/tmp/sage-9.3.rc0-cpython-38-darwin/build/bin
PATH: /private/var/tmp/sage-9.3.rc0-cpython-38-darwin/src/bin
PATH: /var/tmp/sage-9.3.rc0-cpython-38-darwin/local/bin
PATH: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-build-env-dcsf70hx/overlay/bin
PATH: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-build-env-dcsf70hx/normal/bin
PATH: /Users/mkoeppe/s/sage/sage-rebasing/worktree-dist/src/pkgs/sage_conf-relocatable/.tox/python-macos-10.15-python3.8/bin
PATH: /usr/local/opt/xz/bin
PATH: /usr/local/opt/gpatch/bin
PATH: /usr/bin
PATH: /bin
PATH: /usr/sbin
PATH: /sbin

configure:20714: checking gmp.h usability
configure:20714: gcc -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk -c -O2 -g  -pipe -fno-common -g0 -O3 -Wno-unused-function -Wno-trigraphs -Wno-unused-parameter -Wunknown-pragmas -Wno-unused-variable -fomit-frame-pointer -fwrapv -fvisibility=default -finline-functions -fno-exceptions -fno-threadsafe-statics -funroll-loops -fno-delete-null-pointer-checks -Qunused-arguments -pthread -I/usr/local/include  conftest.c >&5
configure:20714: $? = 0
configure:20714: result: yes
```
If NTL from homebrew is installed, this can lead to an NTL threading mismatch:

```
    [singular-4.2.0p1+2021-03-13+sage]   ld: illegal thread local variable reference to regular symbol __ZN3NTL13ErrorCallbackE for architecture x86_64
    [singular-4.2.0p1+2021-03-13+sage]   clang: error: linker command failed with exit code 1 (use -v to see invocation)
```


PR: https://github.com/Singular/Singular/pull/1066


See also: #31348 `build/pkgs/{mpir,mpfr}/spkg-configure.m4`: Check pkg-config first


**CC:**  @dimpase @slel @jhpalmieri @zlscherr @kiwifb @videlec @antonio-rojas

**Branch/Commit:** [8b5b2739d107271f8477cee8cd941bec8b255827](https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827)

**Upstream:** Fixed upstream, but not in a stable release.

**Reviewer:** Fran√ßois Bissey

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/31552





---

archive/issue_comments_509732.json:
```json
{
    "body": "<a id='comment:1'></a>\nActually, driver error, I ran into #29620 again",
    "created_at": "2021-03-24T19:10:27Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509732",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>
Actually, driver error, I ran into #29620 again



---

archive/issue_comments_509733.json:
```json
{
    "body": "<a id='comment:2'></a>\nBut the problem is real - Singular will not use gmp that can be found by compiler and linker if it finds `/usr/local/include/gmp.h`\nThis ought to be fixed upstream.",
    "created_at": "2021-03-24T19:37:09Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509733",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
But the problem is real - Singular will not use gmp that can be found by compiler and linker if it finds `/usr/local/include/gmp.h`
This ought to be fixed upstream.



---

archive/issue_events_283094.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T19:37:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-283094"
}
```



---

archive/issue_comments_509734.json:
```json
{
    "body": "<a id='comment:3'></a>\nIt also ignores an explicitly passed gmp directory (using --with-gmp=...) when there is an installation in `/usr/local` because the search loop is missing a `break`. https://github.com/Singular/Singular/blob/spielwiese/m4/gfanlib-check.m4#L40\n\nThis can only be fixed by making a PR + new singular tarball.",
    "created_at": "2021-03-24T21:28:48Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509734",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
It also ignores an explicitly passed gmp directory (using --with-gmp=...) when there is an installation in `/usr/local` because the search loop is missing a `break`. https://github.com/Singular/Singular/blob/spielwiese/m4/gfanlib-check.m4#L40

This can only be fixed by making a PR + new singular tarball.



---

archive/issue_comments_509735.json:
```json
{
    "body": "**Upstream:** Reported upstream. No feedback yet.",
    "created_at": "2021-03-24T21:52:55Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509735",
    "user": "https://github.com/mkoeppe"
}
```

**Upstream:** Reported upstream. No feedback yet.



---

archive/issue_comments_509736.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -39,7 +39,8 @@\n ```\n \n \n-We fix this by passing gmp configuration to the Singular configure script.\n+PR: https://github.com/Singular/Singular/pull/1066\n+\n \n See also: #31348 `build/pkgs/{mpir,mpfr}/spkg-configure.m4`: Check pkg-config first\n \n``````\n",
    "created_at": "2021-03-24T21:52:55Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509736",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -39,7 +39,8 @@
 ```
 
 
-We fix this by passing gmp configuration to the Singular configure script.
+PR: https://github.com/Singular/Singular/pull/1066
+
 
 See also: #31348 `build/pkgs/{mpir,mpfr}/spkg-configure.m4`: Check pkg-config first
 
``````




---

archive/issue_events_283095.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T21:53:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-283095"
}
```



---

archive/attachments_022215.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "singular-4.2.0p1+2021-03-24+sage-2.tar.gz",
    "asset_url": "tarball://root/attachments/ticket31552/8bc49f535f26400657efa51e26f7f124.gz",
    "created_at": "2021-03-25T00:05:58Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket31552/8bc49f535f26400657efa51e26f7f124.gz",
    "user": "https://github.com/mkoeppe"
}
```



---

archive/issue_comments_509737.json:
```json
{
    "body": "**Attachment:** [singular-4.2.0p1+2021-03-24+sage-2.tar.gz](https://github.com/sagemath/sage/files/ticket31552/8bc49f535f26400657efa51e26f7f124.gz)",
    "created_at": "2021-03-25T00:05:58Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509737",
    "user": "https://github.com/mkoeppe"
}
```

**Attachment:** [singular-4.2.0p1+2021-03-24+sage-2.tar.gz](https://github.com/sagemath/sage/files/ticket31552/8bc49f535f26400657efa51e26f7f124.gz)



---

archive/issue_comments_509738.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/_usr_local_leaks_into_singular_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/_usr_local_leaks_into_singular_build)",
    "created_at": "2021-03-25T00:10:51Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509738",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/_usr_local_leaks_into_singular_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/_usr_local_leaks_into_singular_build)



---

archive/issue_comments_509739.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2021-03-25T00:59:40Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509739",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_509740.json:
```json
{
    "body": "**Commit:** [8b5b2739d107271f8477cee8cd941bec8b255827](https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827)",
    "created_at": "2021-03-25T00:59:40Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509740",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [8b5b2739d107271f8477cee8cd941bec8b255827](https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827)



---

archive/issue_comments_509741.json:
```json
{
    "body": "<a id='comment:7'></a>\nPicking up a newer upstream spielwiese HEAD (which contains a few new commits that look like bugfixes) plus two new PRs: https://github.com/Singular/Singular/pull/1066 and https://github.com/Singular/Singular/pull/1067; the new tarball is made from tag  https://github.com/mkoeppe/Singular/tree/singular-4.2.0p1+2021-03-24%2Bsage-2\n\nRecipe for making the tarball: From within a Sage shell, I used `./configure --with-ntl=/usr/local --with-gmp=/usr/local --disable-pyobject-module --enable-doc-build --with-libparse && make && make dist`\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827\">8b5b273</a></td><td><code>build/pkgs/singular/checksums.ini: Use 4.2.0p1+2021-03-24+sage-2</code></td></tr></table>\n",
    "created_at": "2021-03-25T00:59:40Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509741",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Picking up a newer upstream spielwiese HEAD (which contains a few new commits that look like bugfixes) plus two new PRs: https://github.com/Singular/Singular/pull/1066 and https://github.com/Singular/Singular/pull/1067; the new tarball is made from tag  https://github.com/mkoeppe/Singular/tree/singular-4.2.0p1+2021-03-24%2Bsage-2

Recipe for making the tarball: From within a Sage shell, I used `./configure --with-ntl=/usr/local --with-gmp=/usr/local --disable-pyobject-module --enable-doc-build --with-libparse && make && make dist`

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827">8b5b273</a></td><td><code>build/pkgs/singular/checksums.ini: Use 4.2.0p1+2021-03-24+sage-2</code></td></tr></table>




---

archive/issue_events_283096.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-25T00:59:40Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "rename": {
        "from": "/usr/local leaks into Singular build",
        "to": "Update singular to stop /usr/local from leaking into Singular build"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-283096"
}
```



---

archive/issue_events_283097.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-25T00:59:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-283097"
}
```



---

archive/issue_comments_509742.json:
```json
{
    "body": "<a id='comment:8'></a>\nUpstream has merged the two PRs.\n\nNeeds review",
    "created_at": "2021-03-25T17:38:28Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509742",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
Upstream has merged the two PRs.

Needs review



---

archive/issue_comments_509743.json:
```json
{
    "body": "<a id='comment:9'></a>\nHow to review this?",
    "created_at": "2021-03-25T22:55:41Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509743",
    "user": "https://github.com/slel"
}
```

<a id='comment:9'></a>
How to review this?



---

archive/issue_comments_509744.json:
```json
{
    "body": "**Changing upstream** from \"Reported upstream. No feedback yet.\" to \"Fixed upstream, but not in a stable release.\".",
    "created_at": "2021-03-25T22:55:41Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509744",
    "user": "https://github.com/slel"
}
```

**Changing upstream** from "Reported upstream. No feedback yet." to "Fixed upstream, but not in a stable release.".



---

archive/issue_comments_509745.json:
```json
{
    "body": "<a id='comment:10'></a>\nThis is a tiny increment over the update done in #25993.\nIf it builds, it ships, I'd think",
    "created_at": "2021-03-25T23:02:44Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509745",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
This is a tiny increment over the update done in #25993.
If it builds, it ships, I'd think



---

archive/issue_comments_509746.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [mkoeppe](#comment%3A10):\n> This is a tiny increment over the update done in #25993.\n> If it builds, it ships, I'd think\n\n\nI'd agree with that. I have been thinking of giving the detection of other libraries the treatment I gave to flint and I decided to give up because I don't need that kind of problem right now. I like the simplicity of your minimal fix.",
    "created_at": "2021-03-25T23:28:09Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509746",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>
Replying to [mkoeppe](#comment%3A10):
> This is a tiny increment over the update done in #25993.
> If it builds, it ships, I'd think


I'd agree with that. I have been thinking of giving the detection of other libraries the treatment I gave to flint and I decided to give up because I don't need that kind of problem right now. I like the simplicity of your minimal fix.



---

archive/issue_comments_509747.json:
```json
{
    "body": "**Reviewer:** https://github.com/mkoeppe/sage/runs/2197735803",
    "created_at": "2021-03-26T05:52:15Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509747",
    "user": "https://github.com/mkoeppe"
}
```

**Reviewer:** https://github.com/mkoeppe/sage/runs/2197735803



---

archive/issue_comments_509748.json:
```json
{
    "body": "<a id='comment:12'></a>\nTests have been running at https://github.com/mkoeppe/sage/runs/2197735803",
    "created_at": "2021-03-26T05:52:15Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509748",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
Tests have been running at https://github.com/mkoeppe/sage/runs/2197735803



---

archive/issue_comments_509749.json:
```json
{
    "body": "<a id='comment:13'></a>\nRather than using our own tarball, it's more common to use patches (and then delete the patches when they're merged in a stable upstream release). Why not do that here?",
    "created_at": "2021-03-29T01:30:56Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509749",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>
Rather than using our own tarball, it's more common to use patches (and then delete the patches when they're merged in a stable upstream release). Why not do that here?



---

archive/issue_comments_509750.json:
```json
{
    "body": "<a id='comment:14'></a>\nhttps://doc.sagemath.org/html/en/developer/packaging.html#when-to-patch-when-to-repackage-when-to-autoconfiscate explains why patching is not always possible.\n(In short: Changes to the autotooling are done, and thus the build system is regenerated)",
    "created_at": "2021-03-29T01:46:29Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509750",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
https://doc.sagemath.org/html/en/developer/packaging.html#when-to-patch-when-to-repackage-when-to-autoconfiscate explains why patching is not always possible.
(In short: Changes to the autotooling are done, and thus the build system is regenerated)



---

archive/issue_comments_509751.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [mkoeppe](#comment%3A14):\n> https://doc.sagemath.org/html/en/developer/packaging.html#when-to-patch-when-to-repackage-when-to-autoconfiscate explains why patching is not always possible.\n> (In short: Changes to the autotooling are done, and thus the build system is regenerated)\n\n\nThe fact that autotools files need to be regenerated is one of the strongest point in favor of cmake compared to autotools for downstream re-packagers in my opinion.",
    "created_at": "2021-03-29T03:08:58Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509751",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>
Replying to [mkoeppe](#comment%3A14):
> https://doc.sagemath.org/html/en/developer/packaging.html#when-to-patch-when-to-repackage-when-to-autoconfiscate explains why patching is not always possible.
> (In short: Changes to the autotooling are done, and thus the build system is regenerated)


The fact that autotools files need to be regenerated is one of the strongest point in favor of cmake compared to autotools for downstream re-packagers in my opinion.



---

archive/issue_comments_509752.json:
```json
{
    "body": "<a id='comment:16'></a>\nBeyond the scope of this ticket to switch upstream to another build system.",
    "created_at": "2021-03-29T03:49:45Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509752",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
Beyond the scope of this ticket to switch upstream to another build system.



---

archive/issue_comments_509753.json:
```json
{
    "body": "<a id='comment:17'></a>\nThat was just a general comment. Is there anything holding that ticket? It mostly looks good to me, some of your testruns appear to have failed, one at least for lack of space. Anything more serious?",
    "created_at": "2021-03-29T03:56:59Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509753",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>
That was just a general comment. Is there anything holding that ticket? It mostly looks good to me, some of your testruns appear to have failed, one at least for lack of space. Anything more serious?



---

archive/issue_comments_509754.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [fbissey](#comment%3A17):\n> Is there anything holding that ticket?\n\nNot as far as I can see",
    "created_at": "2021-03-29T03:58:27Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509754",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
Replying to [fbissey](#comment%3A17):
> Is there anything holding that ticket?

Not as far as I can see



---

archive/issue_comments_509755.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/runs/2197735803\" to \"Fran\u00e7ois Bissey\".",
    "created_at": "2021-03-29T04:00:07Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509755",
    "user": "https://github.com/kiwifb"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/runs/2197735803" to "Fran√ßois Bissey".



---

archive/issue_events_283098.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2021-03-29T04:00:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-283098"
}
```



---

archive/issue_events_283099.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2021-03-29T04:00:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-283099"
}
```



---

archive/issue_comments_509756.json:
```json
{
    "body": "<a id='comment:19'></a>\nI am putting my name on the reviewer field then. Ship it.",
    "created_at": "2021-03-29T04:00:07Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509756",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>
I am putting my name on the reviewer field then. Ship it.



---

archive/issue_comments_509757.json:
```json
{
    "body": "<a id='comment:20'></a>\nThanks!",
    "created_at": "2021-03-29T04:00:46Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509757",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>
Thanks!



---

archive/issue_comments_509758.json:
```json
{
    "body": "<a id='comment:21'></a>\nNext ticket in the same direction: #31562",
    "created_at": "2021-03-29T04:05:24Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509758",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
Next ticket in the same direction: #31562



---

archive/issue_events_283100.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-29T23:54:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-283100"
}
```



---

archive/issue_events_283101.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-29T23:54:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-283101"
}
```



---

archive/issue_comments_509759.json:
```json
{
    "body": "<a id='comment:22'></a>\nSetting priority to blocker to bring this ticket to the attention of the release bot.",
    "created_at": "2021-03-29T23:54:39Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509759",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
Setting priority to blocker to bring this ticket to the attention of the release bot.



---

archive/issue_comments_509760.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/_usr_local_leaks_into_singular_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/_usr_local_leaks_into_singular_build)\" to \"[8b5b2739d107271f8477cee8cd941bec8b255827](https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827)\".",
    "created_at": "2021-04-02T22:56:41Z",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-509760",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/_usr_local_leaks_into_singular_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/_usr_local_leaks_into_singular_build)" to "[8b5b2739d107271f8477cee8cd941bec8b255827](https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827)".



---

archive/issue_events_283102.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-04-02T22:56:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-283102"
}
```



---

archive/issue_events_283103.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "22a11999f2c923bf4851e54d1072c875f8b8be8e",
    "created_at": "2021-04-02T22:56:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-283103"
}
```
