# Issue 31552: Update singular to stop /usr/local from leaking into Singular build

archive/issues_031315.json:
```json
{
    "assignees": [],
    "body": "On macOS, even when using `gcc -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk` (which disables use of `/usr/local`), Singular's `configure` script sneaks in `/usr/local/include` and `/usr/local/lib`.\n\n```\nIt was created by singular configure 4.2.0p1+2021-03-13+sage, which was\ngenerated by GNU Autoconf 2.69.  Invocation command line was\n\n  $ ./configure --prefix=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local --libdir=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local/lib --disable-maintainer-mode\n --disable-dependency-tracking --exec-prefix=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local --bindir=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local/bin --wit\nh-ntl=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local --with-flint=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local --enable-gfanlib --enable-Singular --enable-\nfactory --disable-doc --disable-polymake --without-python --without-pythonmodule --disable-python --disable-python_module --disable-python-module --disable\n-static\n\nPATH: /private/var/tmp/sage-9.3.rc0-cpython-38-darwin/build/bin\nPATH: /private/var/tmp/sage-9.3.rc0-cpython-38-darwin/src/bin\nPATH: /var/tmp/sage-9.3.rc0-cpython-38-darwin/local/bin\nPATH: /private/var/tmp/sage-9.3.rc0-cpython-38-darwin/build/bin\nPATH: /private/var/tmp/sage-9.3.rc0-cpython-38-darwin/src/bin\nPATH: /var/tmp/sage-9.3.rc0-cpython-38-darwin/local/bin\nPATH: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-build-env-dcsf70hx/overlay/bin\nPATH: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-build-env-dcsf70hx/normal/bin\nPATH: /Users/mkoeppe/s/sage/sage-rebasing/worktree-dist/src/pkgs/sage_conf-relocatable/.tox/python-macos-10.15-python3.8/bin\nPATH: /usr/local/opt/xz/bin\nPATH: /usr/local/opt/gpatch/bin\nPATH: /usr/bin\nPATH: /bin\nPATH: /usr/sbin\nPATH: /sbin\n\nconfigure:20714: checking gmp.h usability\nconfigure:20714: gcc -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk -c -O2 -g  -pipe -fno-common -g0 -O3 -Wno-unused-function -Wno-trigraphs -Wno-unused-parameter -Wunknown-pragmas -Wno-unused-variable -fomit-frame-pointer -fwrapv -fvisibility=default -finline-functions -fno-exceptions -fno-threadsafe-statics -funroll-loops -fno-delete-null-pointer-checks -Qunused-arguments -pthread -I/usr/local/include  conftest.c >&5\nconfigure:20714: $? = 0\nconfigure:20714: result: yes\n```\nIf NTL from homebrew is installed, this can lead to an NTL threading mismatch:\n\n```\n    [singular-4.2.0p1+2021-03-13+sage]   ld: illegal thread local variable reference to regular symbol __ZN3NTL13ErrorCallbackE for architecture x86_64\n    [singular-4.2.0p1+2021-03-13+sage]   clang: error: linker command failed with exit code 1 (use -v to see invocation)\n```\n\n\nPR: https://github.com/Singular/Singular/pull/1066\n\n\nSee also: #31348 `build/pkgs/{mpir,mpfr}/spkg-configure.m4`: Check pkg-config first\n\n\nCC:  @dimpase @slel @jhpalmieri @zlscherr @kiwifb @videlec @antonio-rojas\n\nBranch/Commit: **[`8b5b273`](https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827)**\n\nUpstream: **Fixed upstream, but not in a stable release.**\n\nReviewer: **Fran\u00e7ois Bissey**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31552_\n\n",
    "closed_at": "2021-04-02T22:56:41Z",
    "created_at": "2021-03-24T18:42:44Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Update singular to stop /usr/local from leaking into Singular build",
    "type": "issue",
    "updated_at": "2021-04-02T22:56:41Z",
    "url": "https://github.com/sagemath/sage/issues/31552",
    "user": "https://github.com/mkoeppe"
}
```
On macOS, even when using `gcc -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk` (which disables use of `/usr/local`), Singular's `configure` script sneaks in `/usr/local/include` and `/usr/local/lib`.

```
It was created by singular configure 4.2.0p1+2021-03-13+sage, which was
generated by GNU Autoconf 2.69.  Invocation command line was

  $ ./configure --prefix=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local --libdir=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local/lib --disable-maintainer-mode
 --disable-dependency-tracking --exec-prefix=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local --bindir=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local/bin --wit
h-ntl=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local --with-flint=/var/tmp/sage-9.3.rc0-cpython-38-darwin/local --enable-gfanlib --enable-Singular --enable-
factory --disable-doc --disable-polymake --without-python --without-pythonmodule --disable-python --disable-python_module --disable-python-module --disable
-static

PATH: /private/var/tmp/sage-9.3.rc0-cpython-38-darwin/build/bin
PATH: /private/var/tmp/sage-9.3.rc0-cpython-38-darwin/src/bin
PATH: /var/tmp/sage-9.3.rc0-cpython-38-darwin/local/bin
PATH: /private/var/tmp/sage-9.3.rc0-cpython-38-darwin/build/bin
PATH: /private/var/tmp/sage-9.3.rc0-cpython-38-darwin/src/bin
PATH: /var/tmp/sage-9.3.rc0-cpython-38-darwin/local/bin
PATH: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-build-env-dcsf70hx/overlay/bin
PATH: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-build-env-dcsf70hx/normal/bin
PATH: /Users/mkoeppe/s/sage/sage-rebasing/worktree-dist/src/pkgs/sage_conf-relocatable/.tox/python-macos-10.15-python3.8/bin
PATH: /usr/local/opt/xz/bin
PATH: /usr/local/opt/gpatch/bin
PATH: /usr/bin
PATH: /bin
PATH: /usr/sbin
PATH: /sbin

configure:20714: checking gmp.h usability
configure:20714: gcc -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk -c -O2 -g  -pipe -fno-common -g0 -O3 -Wno-unused-function -Wno-trigraphs -Wno-unused-parameter -Wunknown-pragmas -Wno-unused-variable -fomit-frame-pointer -fwrapv -fvisibility=default -finline-functions -fno-exceptions -fno-threadsafe-statics -funroll-loops -fno-delete-null-pointer-checks -Qunused-arguments -pthread -I/usr/local/include  conftest.c >&5
configure:20714: $? = 0
configure:20714: result: yes
```
If NTL from homebrew is installed, this can lead to an NTL threading mismatch:

```
    [singular-4.2.0p1+2021-03-13+sage]   ld: illegal thread local variable reference to regular symbol __ZN3NTL13ErrorCallbackE for architecture x86_64
    [singular-4.2.0p1+2021-03-13+sage]   clang: error: linker command failed with exit code 1 (use -v to see invocation)
```


PR: https://github.com/Singular/Singular/pull/1066


See also: #31348 `build/pkgs/{mpir,mpfr}/spkg-configure.m4`: Check pkg-config first


CC:  @dimpase @slel @jhpalmieri @zlscherr @kiwifb @videlec @antonio-rojas

Branch/Commit: **[`8b5b273`](https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827)**

Upstream: **Fixed upstream, but not in a stable release.**

Reviewer: **Fran√ßois Bissey**

Author: **Matthias Koeppe**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/31552_





---

archive/issue_events_435044.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T18:42:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-435044"
}
```



---

archive/issue_events_435045.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T18:42:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-435045"
}
```



---

archive/issue_events_435046.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T18:42:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-435046"
}
```



---

archive/issue_events_435047.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T18:42:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-435047"
}
```



---

archive/issue_comments_507027.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nActually, driver error, I ran into #29620 again",
    "created_at": "2021-03-24T19:10:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507027",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:1" align="right">comment:1</div>

Actually, driver error, I ran into #29620 again



---

archive/issue_comments_507028.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nBut the problem is real - Singular will not use gmp that can be found by compiler and linker if it finds `/usr/local/include/gmp.h`\nThis ought to be fixed upstream.",
    "created_at": "2021-03-24T19:37:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507028",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">comment:2</div>

But the problem is real - Singular will not use gmp that can be found by compiler and linker if it finds `/usr/local/include/gmp.h`
This ought to be fixed upstream.



---

archive/issue_events_435048.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T19:37:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-435048"
}
```



---

archive/issue_events_435049.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T19:37:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-435049"
}
```



---

archive/issue_comments_507029.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nIt also ignores an explicitly passed gmp directory (using --with-gmp=...) when there is an installation in `/usr/local` because the search loop is missing a `break`. https://github.com/Singular/Singular/blob/spielwiese/m4/gfanlib-check.m4#L40\n\nThis can only be fixed by making a PR + new singular tarball.",
    "created_at": "2021-03-24T21:28:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507029",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:3" align="right">comment:3</div>

It also ignores an explicitly passed gmp directory (using --with-gmp=...) when there is an installation in `/usr/local` because the search loop is missing a `break`. https://github.com/Singular/Singular/blob/spielwiese/m4/gfanlib-check.m4#L40

This can only be fixed by making a PR + new singular tarball.



---

archive/issue_comments_507030.json:
```json
{
    "body": "Upstream: **Reported upstream. No feedback yet.**",
    "created_at": "2021-03-24T21:52:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507030",
    "user": "https://github.com/mkoeppe"
}
```

Upstream: **Reported upstream. No feedback yet.**



---

archive/issue_comments_507031.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -39,7 +39,8 @@\n ```\n \n \n-We fix this by passing gmp configuration to the Singular configure script.\n+PR: https://github.com/Singular/Singular/pull/1066\n+\n \n See also: #31348 `build/pkgs/{mpir,mpfr}/spkg-configure.m4`: Check pkg-config first\n \n``````\n",
    "created_at": "2021-03-24T21:52:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507031",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -39,7 +39,8 @@
 ```
 
 
-We fix this by passing gmp configuration to the Singular configure script.
+PR: https://github.com/Singular/Singular/pull/1066
+
 
 See also: #31348 `build/pkgs/{mpir,mpfr}/spkg-configure.m4`: Check pkg-config first
 
``````




---

archive/issue_events_435050.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T21:53:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-435050"
}
```



---

archive/issue_events_435051.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T21:53:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-435051"
}
```



---

archive/issue_comments_507032.json:
```json
{
    "body": "Attachment: **[singular-4.2.0p1+2021-03-24+sage-2.tar.gz](https://github.com/sagemath/sage/files/ticket31552/8bc49f535f26400657efa51e26f7f124.gz)**",
    "created_at": "2021-03-25T00:05:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507032",
    "user": "https://github.com/mkoeppe"
}
```

Attachment: **[singular-4.2.0p1+2021-03-24+sage-2.tar.gz](https://github.com/sagemath/sage/files/ticket31552/8bc49f535f26400657efa51e26f7f124.gz)**



---

archive/issue_comments_507033.json:
```json
{
    "body": "Branch: **[u/mkoeppe/_usr_local_leaks_into_singular_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/_usr_local_leaks_into_singular_build)**",
    "created_at": "2021-03-25T00:10:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507033",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/_usr_local_leaks_into_singular_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/_usr_local_leaks_into_singular_build)**



---

archive/issue_comments_507034.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2021-03-25T00:59:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507034",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_507035.json:
```json
{
    "body": "Commit: **[`8b5b273`](https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827)**",
    "created_at": "2021-03-25T00:59:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507035",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`8b5b273`](https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827)**



---

archive/issue_comments_507036.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nPicking up a newer upstream spielwiese HEAD (which contains a few new commits that look like bugfixes) plus two new PRs: https://github.com/Singular/Singular/pull/1066 and https://github.com/Singular/Singular/pull/1067; the new tarball is made from tag  https://github.com/mkoeppe/Singular/tree/singular-4.2.0p1+2021-03-24%2Bsage-2\n\nRecipe for making the tarball: From within a Sage shell, I used `./configure --with-ntl=/usr/local --with-gmp=/usr/local --disable-pyobject-module --enable-doc-build --with-libparse && make && make dist`\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827\"><code>8b5b273</code></a></td><td><code>build/pkgs/singular/checksums.ini: Use 4.2.0p1+2021-03-24+sage-2</code></td></tr></table>\n",
    "created_at": "2021-03-25T00:59:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507036",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">comment:7</div>

Picking up a newer upstream spielwiese HEAD (which contains a few new commits that look like bugfixes) plus two new PRs: https://github.com/Singular/Singular/pull/1066 and https://github.com/Singular/Singular/pull/1067; the new tarball is made from tag  https://github.com/mkoeppe/Singular/tree/singular-4.2.0p1+2021-03-24%2Bsage-2

Recipe for making the tarball: From within a Sage shell, I used `./configure --with-ntl=/usr/local --with-gmp=/usr/local --disable-pyobject-module --enable-doc-build --with-libparse && make && make dist`

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827"><code>8b5b273</code></a></td><td><code>build/pkgs/singular/checksums.ini: Use 4.2.0p1+2021-03-24+sage-2</code></td></tr></table>




---

archive/issue_events_435052.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-25T00:59:40Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "title_is": "Update singular to stop /usr/local from leaking into Singular build",
    "title_was": "/usr/local leaks into Singular build",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-435052"
}
```



---

archive/issue_events_435053.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-25T00:59:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-435053"
}
```



---

archive/issue_comments_507037.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nUpstream has merged the two PRs.\n\nNeeds review",
    "created_at": "2021-03-25T17:38:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507037",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

Upstream has merged the two PRs.

Needs review



---

archive/issue_comments_507038.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nHow to review this?",
    "created_at": "2021-03-25T22:55:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507038",
    "user": "https://github.com/slel"
}
```

<div id="comment:9" align="right">comment:9</div>

How to review this?



---

archive/issue_comments_507039.json:
```json
{
    "body": "Changed upstream from **Reported upstream. No feedback yet.** to **Fixed upstream, but not in a stable release.**",
    "created_at": "2021-03-25T22:55:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507039",
    "user": "https://github.com/slel"
}
```

Changed upstream from **Reported upstream. No feedback yet.** to **Fixed upstream, but not in a stable release.**



---

archive/issue_comments_507040.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThis is a tiny increment over the update done in #25993.\nIf it builds, it ships, I'd think",
    "created_at": "2021-03-25T23:02:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507040",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

This is a tiny increment over the update done in #25993.
If it builds, it ships, I'd think



---

archive/issue_comments_507041.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@mkoeppe](#comment:10):\n> This is a tiny increment over the update done in #25993.\n> If it builds, it ships, I'd think\n\nI'd agree with that. I have been thinking of giving the detection of other libraries the treatment I gave to flint and I decided to give up because I don't need that kind of problem right now. I like the simplicity of your minimal fix.",
    "created_at": "2021-03-25T23:28:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507041",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@mkoeppe](#comment:10):
> This is a tiny increment over the update done in #25993.
> If it builds, it ships, I'd think

I'd agree with that. I have been thinking of giving the detection of other libraries the treatment I gave to flint and I decided to give up because I don't need that kind of problem right now. I like the simplicity of your minimal fix.



---

archive/issue_comments_507042.json:
```json
{
    "body": "Reviewer: **https://github.com/mkoeppe/sage/runs/2197735803**",
    "created_at": "2021-03-26T05:52:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507042",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **https://github.com/mkoeppe/sage/runs/2197735803**



---

archive/issue_comments_507043.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nTests have been running at https://github.com/mkoeppe/sage/runs/2197735803",
    "created_at": "2021-03-26T05:52:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507043",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

Tests have been running at https://github.com/mkoeppe/sage/runs/2197735803



---

archive/issue_comments_507044.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nRather than using our own tarball, it's more common to use patches (and then delete the patches when they're merged in a stable upstream release). Why not do that here?",
    "created_at": "2021-03-29T01:30:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507044",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:13" align="right">comment:13</div>

Rather than using our own tarball, it's more common to use patches (and then delete the patches when they're merged in a stable upstream release). Why not do that here?



---

archive/issue_comments_507045.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nhttps://doc.sagemath.org/html/en/developer/packaging.html#when-to-patch-when-to-repackage-when-to-autoconfiscate explains why patching is not always possible.\n(In short: Changes to the autotooling are done, and thus the build system is regenerated)",
    "created_at": "2021-03-29T01:46:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507045",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:14" align="right">comment:14</div>

https://doc.sagemath.org/html/en/developer/packaging.html#when-to-patch-when-to-repackage-when-to-autoconfiscate explains why patching is not always possible.
(In short: Changes to the autotooling are done, and thus the build system is regenerated)



---

archive/issue_comments_507046.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@mkoeppe](#comment:14):\n> https://doc.sagemath.org/html/en/developer/packaging.html#when-to-patch-when-to-repackage-when-to-autoconfiscate explains why patching is not always possible.\n> (In short: Changes to the autotooling are done, and thus the build system is regenerated)\n\nThe fact that autotools files need to be regenerated is one of the strongest point in favor of cmake compared to autotools for downstream re-packagers in my opinion.",
    "created_at": "2021-03-29T03:08:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507046",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@mkoeppe](#comment:14):
> https://doc.sagemath.org/html/en/developer/packaging.html#when-to-patch-when-to-repackage-when-to-autoconfiscate explains why patching is not always possible.
> (In short: Changes to the autotooling are done, and thus the build system is regenerated)

The fact that autotools files need to be regenerated is one of the strongest point in favor of cmake compared to autotools for downstream re-packagers in my opinion.



---

archive/issue_comments_507047.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nBeyond the scope of this ticket to switch upstream to another build system.",
    "created_at": "2021-03-29T03:49:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507047",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:16" align="right">comment:16</div>

Beyond the scope of this ticket to switch upstream to another build system.



---

archive/issue_comments_507048.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThat was just a general comment. Is there anything holding that ticket? It mostly looks good to me, some of your testruns appear to have failed, one at least for lack of space. Anything more serious?",
    "created_at": "2021-03-29T03:56:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507048",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:17" align="right">comment:17</div>

That was just a general comment. Is there anything holding that ticket? It mostly looks good to me, some of your testruns appear to have failed, one at least for lack of space. Anything more serious?



---

archive/issue_comments_507049.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@kiwifb](#comment:17):\n> Is there anything holding that ticket?\n\nNot as far as I can see",
    "created_at": "2021-03-29T03:58:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507049",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@kiwifb](#comment:17):
> Is there anything holding that ticket?

Not as far as I can see



---

archive/issue_comments_507050.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/runs/2197735803** to **Fran\u00e7ois Bissey**",
    "created_at": "2021-03-29T04:00:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507050",
    "user": "https://github.com/kiwifb"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/runs/2197735803** to **Fran√ßois Bissey**



---

archive/issue_events_435054.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2021-03-29T04:00:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-435054"
}
```



---

archive/issue_events_435055.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2021-03-29T04:00:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-435055"
}
```



---

archive/issue_comments_507051.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI am putting my name on the reviewer field then. Ship it.",
    "created_at": "2021-03-29T04:00:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507051",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:19" align="right">comment:19</div>

I am putting my name on the reviewer field then. Ship it.



---

archive/issue_comments_507052.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThanks!",
    "created_at": "2021-03-29T04:00:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507052",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

Thanks!



---

archive/issue_comments_507053.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nNext ticket in the same direction: #31562",
    "created_at": "2021-03-29T04:05:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507053",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

Next ticket in the same direction: #31562



---

archive/issue_events_435056.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-29T23:54:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-435056"
}
```



---

archive/issue_events_435057.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-29T23:54:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-435057"
}
```



---

archive/issue_comments_507054.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nSetting priority to blocker to bring this ticket to the attention of the release bot.",
    "created_at": "2021-03-29T23:54:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507054",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

Setting priority to blocker to bring this ticket to the attention of the release bot.



---

archive/issue_comments_507055.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/_usr_local_leaks_into_singular_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/_usr_local_leaks_into_singular_build)** to **[`8b5b273`](https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827)**",
    "created_at": "2021-04-02T22:56:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31552#issuecomment-507055",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/_usr_local_leaks_into_singular_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/_usr_local_leaks_into_singular_build)** to **[`8b5b273`](https://github.com/sagemath/sagetrac-mirror/commit/8b5b2739d107271f8477cee8cd941bec8b255827)**



---

archive/issue_events_435058.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-04-02T22:56:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-435058"
}
```



---

archive/issue_events_435059.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "22a11999f2c923bf4851e54d1072c875f8b8be8e",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-04-02T22:56:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31552",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31552#event-435059"
}
```
