# Issue 31054: 2 internet doctests failing in findstat.py

archive/issues_030817.json:
```json
{
    "body": "On Ubuntu 18.04 with `9.3.beta4, Release Date: 2020-12-14` the command\n\n```\nsage -t --optional=sage,internet src/sage/databases/findstat.py\n```\n\ngives\n\n```\nsage -t --warn-long 72.7 --random-seed=0 src/sage/databases/findstat.py\n**********************************************************************\nFile \"src/sage/databases/findstat.py\", line 118, in sage.databases.findstat\nFailed example:\n    r = findstat(Permutations, lambda pi: pi.saliances()[0], depth=2); r  # optional -- internet\nExpected:\n    0: St000476oMp00099oMp00127 (quality [100, 100])\n    1: St001497oMp00119oMp00127 with offset 1 (quality [100, 100])\n    2: St000147oMp00027oMp00127 (quality [96, 100])\n    3: St000054oMp00064oMp00062 with offset 1 (quality [88, 100])\n    4: St000740oMp00062 with offset 1 (quality [87, 100])\n    ...\nGot:\n     0: St000740oMp00066 with offset 1 (quality [100, 100])\n     1: St000476oMp00099oMp00127 (quality [100, 100])\n     2: St001497oMp00119oMp00127 with offset 1 (quality [100, 100])\n     3: St000147oMp00027oMp00127 (quality [96, 100])\n     4: St000054oMp00066oMp00149 with offset 1 (quality [89, 100])\n     5: St000141oMp00025oMp00127 (quality [87, 100])\n     6: St001291oMp00127 with offset 1 (quality [87, 86])\n     7: St000051oMp00061oMp00069 (quality [87, 86])\n     8: St000316oMp00025oMp00127 (quality [87, 86])\n     9: St000653oMp00129oMp00127 (quality [87, 86])\n    10: St001184oMp00127oMp00064 with offset 1 (quality [87, 86])\n    11: St001227oMp00028oMp00127 (quality [87, 86])\n    12: St001480oMp00032oMp00127 (quality [87, 86])\n    13: St000066oMp00063oMp00149 with offset 1 (quality [54, 86])\n    14: St000840oMp00146oMp00127 (quality [18, 86])\n    15: St000199oMp00063 with offset 1 (quality [15, 71])\n    16: St000193oMp00004oMp00063 with offset 1 (quality [15, 71])\n    17: St000200oMp00063oMp00062 with offset 1 (quality [15, 71])\n**********************************************************************\nFile \"src/sage/databases/findstat.py\", line 129, in sage.databases.findstat\nFailed example:\n    r[4].info()                                                           # optional -- internet\nExpected:\n    after adding 1 to every value\n    and applying\n        Mp00062: Lehmer-code to major-code bijection: Permutations -> Permutations\n    to the objects (see `.compound_map()` for details)\n    <BLANKLINE>\n    your input matches\n        St000740: The last entry of a permutation.\n    <BLANKLINE>\n    among the values you sent, 87 percent are actually in the database,\n    among the distinct values you sent, 100 percent are actually in the database\nGot:\n    after adding 1 to every value\n    and applying\n        Mp00149: Lehmer code rotation: Permutations -> Permutations\n        Mp00066: inverse: Permutations -> Permutations\n    to the objects (see `.compound_map()` for details)\n    <BLANKLINE>\n    your input matches\n        St000054: The first entry of the permutation.\n    <BLANKLINE>\n    among the values you sent, 89 percent are actually in the database,\n    among the distinct values you sent, 100 percent are actually in the database\n**********************************************************************\n1 item had failures:\n   2 of  16 in sage.databases.findstat\n    [392 tests, 2 failures, 42.52 s]\n----------------------------------------------------------------------\nsage -t --warn-long 72.7 --random-seed=0 src/sage/databases/findstat.py  # 2 doctests failed\n----------------------------------------------------------------------\n```\n\nKeywords: findstat\n\nBranch/Commit: [88d7a844b5bb4ff8ce556d711d5d2668537c5fed](https://github.com/sagemath/sagetrac-mirror/commit/88d7a844b5bb4ff8ce556d711d5d2668537c5fed)\n\nUpstream: Reported upstream. Developers acknowledge bug.\n\nReviewer: S\u00e9bastien Labb\u00e9\n\nAuthor: Martin Rubey\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31054\n\n",
    "closed_at": "2021-01-03T12:15:31Z",
    "created_at": "2020-12-15T18:52:09Z",
    "labels": [
        "component: doctest coverage",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "2 internet doctests failing in findstat.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31054",
    "user": "https://github.com/seblabbe"
}
```
On Ubuntu 18.04 with `9.3.beta4, Release Date: 2020-12-14` the command

```
sage -t --optional=sage,internet src/sage/databases/findstat.py
```

gives

```
sage -t --warn-long 72.7 --random-seed=0 src/sage/databases/findstat.py
**********************************************************************
File "src/sage/databases/findstat.py", line 118, in sage.databases.findstat
Failed example:
    r = findstat(Permutations, lambda pi: pi.saliances()[0], depth=2); r  # optional -- internet
Expected:
    0: St000476oMp00099oMp00127 (quality [100, 100])
    1: St001497oMp00119oMp00127 with offset 1 (quality [100, 100])
    2: St000147oMp00027oMp00127 (quality [96, 100])
    3: St000054oMp00064oMp00062 with offset 1 (quality [88, 100])
    4: St000740oMp00062 with offset 1 (quality [87, 100])
    ...
Got:
     0: St000740oMp00066 with offset 1 (quality [100, 100])
     1: St000476oMp00099oMp00127 (quality [100, 100])
     2: St001497oMp00119oMp00127 with offset 1 (quality [100, 100])
     3: St000147oMp00027oMp00127 (quality [96, 100])
     4: St000054oMp00066oMp00149 with offset 1 (quality [89, 100])
     5: St000141oMp00025oMp00127 (quality [87, 100])
     6: St001291oMp00127 with offset 1 (quality [87, 86])
     7: St000051oMp00061oMp00069 (quality [87, 86])
     8: St000316oMp00025oMp00127 (quality [87, 86])
     9: St000653oMp00129oMp00127 (quality [87, 86])
    10: St001184oMp00127oMp00064 with offset 1 (quality [87, 86])
    11: St001227oMp00028oMp00127 (quality [87, 86])
    12: St001480oMp00032oMp00127 (quality [87, 86])
    13: St000066oMp00063oMp00149 with offset 1 (quality [54, 86])
    14: St000840oMp00146oMp00127 (quality [18, 86])
    15: St000199oMp00063 with offset 1 (quality [15, 71])
    16: St000193oMp00004oMp00063 with offset 1 (quality [15, 71])
    17: St000200oMp00063oMp00062 with offset 1 (quality [15, 71])
**********************************************************************
File "src/sage/databases/findstat.py", line 129, in sage.databases.findstat
Failed example:
    r[4].info()                                                           # optional -- internet
Expected:
    after adding 1 to every value
    and applying
        Mp00062: Lehmer-code to major-code bijection: Permutations -> Permutations
    to the objects (see `.compound_map()` for details)
    <BLANKLINE>
    your input matches
        St000740: The last entry of a permutation.
    <BLANKLINE>
    among the values you sent, 87 percent are actually in the database,
    among the distinct values you sent, 100 percent are actually in the database
Got:
    after adding 1 to every value
    and applying
        Mp00149: Lehmer code rotation: Permutations -> Permutations
        Mp00066: inverse: Permutations -> Permutations
    to the objects (see `.compound_map()` for details)
    <BLANKLINE>
    your input matches
        St000054: The first entry of the permutation.
    <BLANKLINE>
    among the values you sent, 89 percent are actually in the database,
    among the distinct values you sent, 100 percent are actually in the database
**********************************************************************
1 item had failures:
   2 of  16 in sage.databases.findstat
    [392 tests, 2 failures, 42.52 s]
----------------------------------------------------------------------
sage -t --warn-long 72.7 --random-seed=0 src/sage/databases/findstat.py  # 2 doctests failed
----------------------------------------------------------------------
```

Keywords: findstat

Branch/Commit: [88d7a844b5bb4ff8ce556d711d5d2668537c5fed](https://github.com/sagemath/sagetrac-mirror/commit/88d7a844b5bb4ff8ce556d711d5d2668537c5fed)

Upstream: Reported upstream. Developers acknowledge bug.

Reviewer: Sébastien Labbé

Author: Martin Rubey

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31054





---

archive/issue_comments_616688.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Reported upstream. No feedback yet.\"",
    "created_at": "2020-12-16T11:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31054#issuecomment-616688",
    "user": "https://github.com/mantepse"
}
```

Changing upstream from "N/A" to "Reported upstream. No feedback yet."



---

archive/issue_comments_616689.json:
```json
{
    "body": "<a id='comment:1'></a>\nIt is a bit strange that St000740oMp00062 is not among the hits anymore.  This may happen, since St000740oMp00062 and St000740oMp00066 are identical, but should be investigated anyway.",
    "created_at": "2020-12-16T11:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31054#issuecomment-616689",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:1'></a>
It is a bit strange that St000740oMp00062 is not among the hits anymore.  This may happen, since St000740oMp00062 and St000740oMp00066 are identical, but should be investigated anyway.



---

archive/issue_comments_616690.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mantepse/2_internet_doctests_failing_in_findstat_py\"",
    "created_at": "2020-12-17T12:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31054#issuecomment-616690",
    "user": "https://github.com/mantepse"
}
```

Changing branch from "" to "u/mantepse/2_internet_doctests_failing_in_findstat_py"



---

archive/issue_comments_616691.json:
```json
{
    "body": "Changing commit from \"\" to \"913f1b78d43b7c69fbe2ae381ce8f5f56b80944f\"",
    "created_at": "2020-12-17T12:40:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31054#issuecomment-616691",
    "user": "https://github.com/mantepse"
}
```

Changing commit from "" to "913f1b78d43b7c69fbe2ae381ce8f5f56b80944f"



---

archive/issue_comments_616692.json:
```json
{
    "body": "<a id='comment:3'></a>\nThe reason for St000740oMp00062 not being among the results anymore is a (known) shortcoming of the findstat search engine: it only keeps only the set of hits with different statistics (ignoring the maps)!  The reason for this is that otherwise the result set would often be huge (more than 1000 hits), with most hits not being interesting.  Finding a good solution to this problem is being worked on.\n\n---\nNew commits:\n|                                                                                                                                          |                                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|\n|[913f1b7](https://github.com/sagemath/sagetrac-mirror/commit/913f1b78d43b7c69fbe2ae381ce8f5f56b80944f)|`adapt a doctest, cleanup usage of FINDSTAT_MAP_SEPARATOR`|",
    "created_at": "2020-12-17T12:40:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31054#issuecomment-616692",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:3'></a>
The reason for St000740oMp00062 not being among the results anymore is a (known) shortcoming of the findstat search engine: it only keeps only the set of hits with different statistics (ignoring the maps)!  The reason for this is that otherwise the result set would often be huge (more than 1000 hits), with most hits not being interesting.  Finding a good solution to this problem is being worked on.

---
New commits:
|                                                                                                                                          |                                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|
|[913f1b7](https://github.com/sagemath/sagetrac-mirror/commit/913f1b78d43b7c69fbe2ae381ce8f5f56b80944f)|`adapt a doctest, cleanup usage of FINDSTAT_MAP_SEPARATOR`|



---

archive/issue_comments_616693.json:
```json
{
    "body": "Changing upstream from \"Reported upstream. No feedback yet.\" to \"Reported upstream. Developers acknowledge bug.\"",
    "created_at": "2020-12-17T12:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31054#issuecomment-616693",
    "user": "https://github.com/mantepse"
}
```

Changing upstream from "Reported upstream. No feedback yet." to "Reported upstream. Developers acknowledge bug."



---

archive/issue_comments_616694.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-12-17T12:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31054#issuecomment-616694",
    "user": "https://github.com/mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_616695.json:
```json
{
    "body": "Changing author from \"\" to \"Martin Rubey\"",
    "created_at": "2020-12-17T12:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31054#issuecomment-616695",
    "user": "https://github.com/mantepse"
}
```

Changing author from "" to "Martin Rubey"



---

archive/issue_comments_616696.json:
```json
{
    "body": "Changing keywords from \"\" to \"findstat\".",
    "created_at": "2020-12-17T12:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31054#issuecomment-616696",
    "user": "https://github.com/mantepse"
}
```

Changing keywords from "" to "findstat".



---

archive/issue_comments_616697.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------|\n|[0ff9533](https://github.com/sagemath/sagetrac-mirror/commit/0ff95333df0cc444c284c33b3e5b5c18ba13b08b)|`forgot # optional`|",
    "created_at": "2020-12-17T17:37:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31054#issuecomment-616697",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------|
|[0ff9533](https://github.com/sagemath/sagetrac-mirror/commit/0ff95333df0cc444c284c33b3e5b5c18ba13b08b)|`forgot # optional`|



---

archive/issue_comments_616698.json:
```json
{
    "body": "Changing commit from \"913f1b78d43b7c69fbe2ae381ce8f5f56b80944f\" to \"0ff95333df0cc444c284c33b3e5b5c18ba13b08b\"",
    "created_at": "2020-12-17T17:37:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31054#issuecomment-616698",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "913f1b78d43b7c69fbe2ae381ce8f5f56b80944f" to "0ff95333df0cc444c284c33b3e5b5c18ba13b08b"



---

archive/issue_comments_616699.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|\n|[88d7a84](https://github.com/sagemath/sagetrac-mirror/commit/88d7a844b5bb4ff8ce556d711d5d2668537c5fed)|`fix erroneous check whether any maps are applied`|",
    "created_at": "2020-12-22T11:04:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31054#issuecomment-616699",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|
|[88d7a84](https://github.com/sagemath/sagetrac-mirror/commit/88d7a844b5bb4ff8ce556d711d5d2668537c5fed)|`fix erroneous check whether any maps are applied`|



---

archive/issue_comments_616700.json:
```json
{
    "body": "Changing commit from \"0ff95333df0cc444c284c33b3e5b5c18ba13b08b\" to \"88d7a844b5bb4ff8ce556d711d5d2668537c5fed\"",
    "created_at": "2020-12-22T11:04:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31054#issuecomment-616700",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0ff95333df0cc444c284c33b3e5b5c18ba13b08b" to "88d7a844b5bb4ff8ce556d711d5d2668537c5fed"



---

archive/issue_comments_616701.json:
```json
{
    "body": "<a id='comment:8'></a>\nWith the branch on top of beta5, I now get:\n\n```\nRunning doctests with ID 2020-12-30-09-59-26-49919bff.\nGit branch: 31054\nUsing --optional=internet,memlimit,sage\nDoctesting 1 file.\nsage -t --warn-long 72.1 --random-seed=0 src/sage/databases/findstat.py\n    [395 tests, 42.75 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\n```",
    "created_at": "2020-12-30T09:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31054#issuecomment-616701",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:8'></a>
With the branch on top of beta5, I now get:

```
Running doctests with ID 2020-12-30-09-59-26-49919bff.
Git branch: 31054
Using --optional=internet,memlimit,sage
Doctesting 1 file.
sage -t --warn-long 72.1 --random-seed=0 src/sage/databases/findstat.py
    [395 tests, 42.75 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```



---

archive/issue_comments_616702.json:
```json
{
    "body": "Changing reviewer from \"\" to \"S\u00e9bastien Labb\u00e9\"",
    "created_at": "2020-12-30T09:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31054#issuecomment-616702",
    "user": "https://github.com/seblabbe"
}
```

Changing reviewer from "" to "Sébastien Labbé"



---

archive/issue_comments_616703.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-12-30T09:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31054#issuecomment-616703",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_616704.json:
```json
{
    "body": "Changing branch from \"u/mantepse/2_internet_doctests_failing_in_findstat_py\" to \"88d7a844b5bb4ff8ce556d711d5d2668537c5fed\"",
    "created_at": "2021-01-03T12:15:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31054#issuecomment-616704",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mantepse/2_internet_doctests_failing_in_findstat_py" to "88d7a844b5bb4ff8ce556d711d5d2668537c5fed"



---

archive/issue_events_091356.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-01-03T12:15:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31054",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31054#event-91356"
}
```



---

archive/issue_comments_616705.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-01-03T12:15:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31054#issuecomment-616705",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
