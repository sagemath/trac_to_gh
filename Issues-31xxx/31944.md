# Issue 31944: Minimal Periodic/Preperiodic Scheme

archive/issues_031707.json:
```json
{
    "body": "Currently, attempting to use periodic points or preperiodic points to compute the scheme defining the minimal periodic or preperiodic points throws a Not Implemented error. We implement this functionality.\n\nWe also add a formal parameter to the periodic and preperiodic functions to facilitate the computation of the formal periodic or formal preperiodic points.\n\n**CC:**  @bhutz\n\n**Keywords:** gsoc2021\n\n**Branch:** [6f2857f21394f0c242f9180f57f45ac565b618ed](https://github.com/sagemath/sagetrac-mirror/commit/6f2857f21394f0c242f9180f57f45ac565b618ed)\n\n**Reviewer:** Ben Hutz\n\n**Author:** Alexander Galarraga\n\n**Dependencies:** #31954, #31906, #32166\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31944\n\n",
    "closed_at": "2021-07-25T18:51:50Z",
    "created_at": "2021-06-09T18:38:26Z",
    "labels": [
        "component: dynamics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Minimal Periodic/Preperiodic Scheme",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31944",
    "user": "https://github.com/EnderWannabe"
}
```
Currently, attempting to use periodic points or preperiodic points to compute the scheme defining the minimal periodic or preperiodic points throws a Not Implemented error. We implement this functionality.

We also add a formal parameter to the periodic and preperiodic functions to facilitate the computation of the formal periodic or formal preperiodic points.

**CC:**  @bhutz

**Keywords:** gsoc2021

**Branch:** [6f2857f21394f0c242f9180f57f45ac565b618ed](https://github.com/sagemath/sagetrac-mirror/commit/6f2857f21394f0c242f9180f57f45ac565b618ed)

**Reviewer:** Ben Hutz

**Author:** Alexander Galarraga

**Dependencies:** #31954, #31906, #32166

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/31944





---

archive/issue_comments_635647.json:
```json
{
    "body": "**Branch:** [u/gh-EnderWannabe/periodic_points_improvement](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-EnderWannabe/periodic_points_improvement)",
    "created_at": "2021-06-09T19:41:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635647",
    "user": "https://github.com/EnderWannabe"
}
```

**Branch:** [u/gh-EnderWannabe/periodic_points_improvement](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-EnderWannabe/periodic_points_improvement)



---

archive/issue_comments_635648.json:
```json
{
    "body": "**Commit:** [c324844ce2d9f02e791d9834fc2e95933a28ee59](https://github.com/sagemath/sagetrac-mirror/commit/c324844ce2d9f02e791d9834fc2e95933a28ee59)",
    "created_at": "2021-06-11T18:29:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635648",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [c324844ce2d9f02e791d9834fc2e95933a28ee59](https://github.com/sagemath/sagetrac-mirror/commit/c324844ce2d9f02e791d9834fc2e95933a28ee59)



---

archive/issue_comments_635649.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27888da37be54a90055d3ec7871e294622bfbd11\">27888da</a></td><td><code>31954: initial commit with working code and examples</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/22201d79eb0516c44d912f4d4f5cf689ca1ab574\">22201d7</a></td><td><code>Merge branch 'hyperplane_transform' into periodic_points_improvement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c324844ce2d9f02e791d9834fc2e95933a28ee59\">c324844</a></td><td><code>31944: added computation for formal periodic points</code></td></tr></table>\n",
    "created_at": "2021-06-11T18:29:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635649",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27888da37be54a90055d3ec7871e294622bfbd11">27888da</a></td><td><code>31954: initial commit with working code and examples</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/22201d79eb0516c44d912f4d4f5cf689ca1ab574">22201d7</a></td><td><code>Merge branch 'hyperplane_transform' into periodic_points_improvement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c324844ce2d9f02e791d9834fc2e95933a28ee59">c324844</a></td><td><code>31944: added computation for formal periodic points</code></td></tr></table>




---

archive/issue_comments_635650.json:
```json
{
    "body": "**Dependencies:** #31954",
    "created_at": "2021-06-11T18:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635650",
    "user": "https://github.com/EnderWannabe"
}
```

**Dependencies:** #31954



---

archive/issue_comments_635651.json:
```json
{
    "body": "**Changing commit** from \"[c324844ce2d9f02e791d9834fc2e95933a28ee59](https://github.com/sagemath/sagetrac-mirror/commit/c324844ce2d9f02e791d9834fc2e95933a28ee59)\" to \"[5d142bf1c05c377d1459de1acc884d613cebc28e](https://github.com/sagemath/sagetrac-mirror/commit/5d142bf1c05c377d1459de1acc884d613cebc28e)\".",
    "created_at": "2021-06-15T17:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635651",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c324844ce2d9f02e791d9834fc2e95933a28ee59](https://github.com/sagemath/sagetrac-mirror/commit/c324844ce2d9f02e791d9834fc2e95933a28ee59)" to "[5d142bf1c05c377d1459de1acc884d613cebc28e](https://github.com/sagemath/sagetrac-mirror/commit/5d142bf1c05c377d1459de1acc884d613cebc28e)".



---

archive/issue_comments_635652.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/91ebb22e635bb058dd21d0d31cae9e635eecf804\">91ebb22</a></td><td><code>31944: removed changes in tickets 31906 and 31896 from this ticket</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df038ca4e0dd4e510323ed714233ee55c0b327b4\">df038ca</a></td><td><code>31944: initial formal preperiodic points</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d142bf1c05c377d1459de1acc884d613cebc28e\">5d142bf</a></td><td><code>31944: examples for formal preperiodic points, fixed return scheme for formal preperiodic points</code></td></tr></table>\n",
    "created_at": "2021-06-15T17:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635652",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/91ebb22e635bb058dd21d0d31cae9e635eecf804">91ebb22</a></td><td><code>31944: removed changes in tickets 31906 and 31896 from this ticket</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df038ca4e0dd4e510323ed714233ee55c0b327b4">df038ca</a></td><td><code>31944: initial formal preperiodic points</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d142bf1c05c377d1459de1acc884d613cebc28e">5d142bf</a></td><td><code>31944: examples for formal preperiodic points, fixed return scheme for formal preperiodic points</code></td></tr></table>




---

archive/issue_comments_635653.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2021-06-15T17:30:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635653",
    "user": "https://github.com/EnderWannabe"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_635654.json:
```json
{
    "body": "**Changing commit** from \"[5d142bf1c05c377d1459de1acc884d613cebc28e](https://github.com/sagemath/sagetrac-mirror/commit/5d142bf1c05c377d1459de1acc884d613cebc28e)\" to \"[50179a3a2351738f9b7a81995acc9152c611fc0a](https://github.com/sagemath/sagetrac-mirror/commit/50179a3a2351738f9b7a81995acc9152c611fc0a)\".",
    "created_at": "2021-06-22T18:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635654",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5d142bf1c05c377d1459de1acc884d613cebc28e](https://github.com/sagemath/sagetrac-mirror/commit/5d142bf1c05c377d1459de1acc884d613cebc28e)" to "[50179a3a2351738f9b7a81995acc9152c611fc0a](https://github.com/sagemath/sagetrac-mirror/commit/50179a3a2351738f9b7a81995acc9152c611fc0a)".



---

archive/issue_comments_635655.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/267cb6dd51c3ad9dc7fd9c7f4ba70ea47530a3ef\">267cb6d</a></td><td><code>31906: stopped normalizing for non exact fields, added warning</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3fbdf2715a6f724968ca532cd036f274d0f60186\">3fbdf27</a></td><td><code>31906: non exact to non-exact</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eaa4424537802bf4ef354203b6c151dce7e460cd\">eaa4424</a></td><td><code>31906: fix for docs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc0ff91ee1109d34ee19f1e3192ef10515bd5fa1\">cc0ff91</a></td><td><code>Merge branch 'point_matrix_improvement' into ring_hyperplane_transform</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3d59310b06423435f2c4ec464c009fca3cabb7f0\">3d59310</a></td><td><code>31954: moved method to projective space over a ring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d1476d8568f280022d31a382921279f92b18a766\">d1476d8</a></td><td><code>31954: added sanity check with error message</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27dea9472ab0e424a7a5d96c656e7b3cb9475c58\">27dea94</a></td><td><code>31954: added examples for finite fields and polynomial rings</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/312b538b4edad3af77bd41952f32709c1d954b37\">312b538</a></td><td><code>Merge branch 'u/gh-EnderWannabe/hyperplane_transform' of trac.sagemath.org:sage into hyperplane_transform</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b31b6344072754a76b765f1829a7baed9c970be3\">b31b634</a></td><td><code>Merge branch 'hyperplane_transform' into periodic_points_improvement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50179a3a2351738f9b7a81995acc9152c611fc0a\">50179a3</a></td><td><code>31944: cleaned up code, added example</code></td></tr></table>\n",
    "created_at": "2021-06-22T18:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635655",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/267cb6dd51c3ad9dc7fd9c7f4ba70ea47530a3ef">267cb6d</a></td><td><code>31906: stopped normalizing for non exact fields, added warning</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3fbdf2715a6f724968ca532cd036f274d0f60186">3fbdf27</a></td><td><code>31906: non exact to non-exact</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eaa4424537802bf4ef354203b6c151dce7e460cd">eaa4424</a></td><td><code>31906: fix for docs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc0ff91ee1109d34ee19f1e3192ef10515bd5fa1">cc0ff91</a></td><td><code>Merge branch 'point_matrix_improvement' into ring_hyperplane_transform</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3d59310b06423435f2c4ec464c009fca3cabb7f0">3d59310</a></td><td><code>31954: moved method to projective space over a ring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d1476d8568f280022d31a382921279f92b18a766">d1476d8</a></td><td><code>31954: added sanity check with error message</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27dea9472ab0e424a7a5d96c656e7b3cb9475c58">27dea94</a></td><td><code>31954: added examples for finite fields and polynomial rings</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/312b538b4edad3af77bd41952f32709c1d954b37">312b538</a></td><td><code>Merge branch 'u/gh-EnderWannabe/hyperplane_transform' of trac.sagemath.org:sage into hyperplane_transform</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b31b6344072754a76b765f1829a7baed9c970be3">b31b634</a></td><td><code>Merge branch 'hyperplane_transform' into periodic_points_improvement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50179a3a2351738f9b7a81995acc9152c611fc0a">50179a3</a></td><td><code>31944: cleaned up code, added example</code></td></tr></table>




---

archive/issue_comments_635656.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2021-06-24T14:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635656",
    "user": "https://github.com/bhutz"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_635657.json:
```json
{
    "body": "<a id='comment:7'></a>\nAll my versions of sage are compiling, so this is a code review only without functionality testing. It looks like there will be issues with subschemes.\n\n- formal and dimension 1 are missing the subscheme equations in X\n\n- f_deformed: this is now defined over projective space rather than the subscheme. So the X you eventually get does not include the defining equations of the subscheme. \n\n- This line is perhaps worth a comment\n\n```\nIdeal = f_deformed.preperiodic_points(m, n, return_scheme=True).defining_ideal()\n```\nthat minimal=True and Formal=False does in fact get the formal periodic points for the deformed map (since all (relevant) multiplicities are 1).\n\n- Don't capitalize the variable Ideal\n\n\n- The same comments about subscheme issues for periodic points version.\n\n\n- 31906 is included by not listed as a dependency. This doesn't really seem to be a dependency.",
    "created_at": "2021-06-24T14:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635657",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:7'></a>
All my versions of sage are compiling, so this is a code review only without functionality testing. It looks like there will be issues with subschemes.

- formal and dimension 1 are missing the subscheme equations in X

- f_deformed: this is now defined over projective space rather than the subscheme. So the X you eventually get does not include the defining equations of the subscheme. 

- This line is perhaps worth a comment

```
Ideal = f_deformed.preperiodic_points(m, n, return_scheme=True).defining_ideal()
```
that minimal=True and Formal=False does in fact get the formal periodic points for the deformed map (since all (relevant) multiplicities are 1).

- Don't capitalize the variable Ideal


- The same comments about subscheme issues for periodic points version.


- 31906 is included by not listed as a dependency. This doesn't really seem to be a dependency.



---

archive/issue_comments_635658.json:
```json
{
    "body": "**Reviewer:** Ben Hutz",
    "created_at": "2021-06-24T14:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635658",
    "user": "https://github.com/bhutz"
}
```

**Reviewer:** Ben Hutz



---

archive/issue_comments_635659.json:
```json
{
    "body": "**Changing commit** from \"[50179a3a2351738f9b7a81995acc9152c611fc0a](https://github.com/sagemath/sagetrac-mirror/commit/50179a3a2351738f9b7a81995acc9152c611fc0a)\" to \"[aaecd466a9bf718969228839c987f65c7a598576](https://github.com/sagemath/sagetrac-mirror/commit/aaecd466a9bf718969228839c987f65c7a598576)\".",
    "created_at": "2021-06-24T16:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635659",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[50179a3a2351738f9b7a81995acc9152c611fc0a](https://github.com/sagemath/sagetrac-mirror/commit/50179a3a2351738f9b7a81995acc9152c611fc0a)" to "[aaecd466a9bf718969228839c987f65c7a598576](https://github.com/sagemath/sagetrac-mirror/commit/aaecd466a9bf718969228839c987f65c7a598576)".



---

archive/issue_comments_635660.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aaecd466a9bf718969228839c987f65c7a598576\">aaecd46</a></td><td><code>31944: cleaned up code added comments</code></td></tr></table>\n",
    "created_at": "2021-06-24T16:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635660",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aaecd466a9bf718969228839c987f65c7a598576">aaecd46</a></td><td><code>31944: cleaned up code added comments</code></td></tr></table>




---

archive/issue_comments_635661.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-06-24T16:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635661",
    "user": "https://github.com/EnderWannabe"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_635662.json:
```json
{
    "body": "**Changing dependencies** from \"#31954\" to \"#31954, #31906\".",
    "created_at": "2021-06-24T16:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635662",
    "user": "https://github.com/EnderWannabe"
}
```

**Changing dependencies** from "#31954" to "#31954, #31906".



---

archive/issue_comments_635663.json:
```json
{
    "body": "<a id='comment:10'></a>\nI feel like I'm starting to repeat the same errors over and over again, so here is what I have so far.\n\n- A non-minimal point appears\n\n```\nP.<x,y,z>=ProjectiveSpace(QQ,2)\nf=DynamicalSystem([x^2-z^2,y^2-21/16*z^2,z^2])\nfor Q in f.preperiodic_points(1,2,minimal=True,formal=False):\n    print(Q, Q.is_preperiodic(f,return_period=True))\n```\n\n- line 4221: perhaps add the same comment as on 3897 as this looks redundant at first glance\n\n```\nR = f.base_ring()\n```\n\n- KeyError\n\n```\nP.<x,y>=ProjectiveSpace(QQ,1)\nX=P.subscheme([x-y])\nF=DynamicalSystem([x^2-1*y^2,y^2],domain=X)\nF.periodic_points(2,formal=True)\n```\n\n- This is wrong:\n\n```\nP.<x,y>=ProjectiveSpace(QQ,1)\nX=P.subscheme([x-y])\nF=DynamicalSystem([x^2-3/4*y^2,y^2],domain=X)\nF.periodic_points(2,minimal=True,formal=False,return_scheme=True)\n```\n\nAlso wrong\n\n```\nP.<x,y,z>=ProjectiveSpace(QQ,2)\nX=P.subscheme([x-y])\nF=DynamicalSystem([x^2+3/4*y^2,y^2,z^2],X)\nF.periodic_points(2,minimal=True,formal=False,return_scheme=True).rational_points()\n```\n\nAlso wrong:\n\n```\nP.<x,y,z>=ProjectiveSpace(GF(3),2)\nX=P.subscheme([x-y])\nF=DynamicalSystem([x^2-2*y^2,y^2,z^2],domain=X)\nF.periodic_points(2,minimal=True,formal=False,return_scheme=True).rational_points()\n```\n\n- TypeError\n\n```\nP.<x,y,z>=ProjectiveSpace(GF(3),2)\nX=P.subscheme([x-y])\nF=DynamicalSystem([x^2-2*y^2,y^2,z^2],X)\nF.periodic_points(1,minimal=True,formal=True,return_scheme=True).rational_points()\n```\n\n- This gives a TypeError, perhaps catch the good fields and give a more informative error message\n\n```\nP.<x,y,z>=ProjectiveSpace(RR,2)\nX=P.subscheme([x-y])\nF=DynamicalSystem([x^2-2*y^2,y^2,z^2],domain=X)\nF.periodic_points(2,minimal=True,formal=False,return_scheme=True).rational_points()\n```\n\n- Shouldn't this work?\n\n```\nR.<c>=QQ[]\nP.<x,y,z>=ProjectiveSpace(FractionField(R),2)\nX=P.subscheme([x-y])\nF=DynamicalSystem([x^2-2*y^2,y^2,z^2],domain=X)\nF.periodic_points(2,minimal=True,formal=False,return_scheme=True)\n```\n\n- Why is there no 'c' in this?\n\n```\nR.<c>=QQ[]\nP.<x,y,z>=ProjectiveSpace(FractionField(R),2)\nX=P.subscheme([x-y])\nF=DynamicalSystem([x^2-c*y^2,y^2,z^2],domain=X)\nF.periodic_points(2,minimal=False,formal=False,return_scheme=True)\n```\n\nBut there is here\n\n```\nR.<c>=QQ[]\nP.<x,y,z>=ProjectiveSpace(FractionField(R),2)\nX=P.subscheme([x-y])\nF=DynamicalSystem([x^2-c*y^2,y^2,z^2])\nF.periodic_points(2,minimal=False,formal=False,return_scheme=True)\n```",
    "created_at": "2021-06-25T18:20:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635663",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:10'></a>
I feel like I'm starting to repeat the same errors over and over again, so here is what I have so far.

- A non-minimal point appears

```
P.<x,y,z>=ProjectiveSpace(QQ,2)
f=DynamicalSystem([x^2-z^2,y^2-21/16*z^2,z^2])
for Q in f.preperiodic_points(1,2,minimal=True,formal=False):
    print(Q, Q.is_preperiodic(f,return_period=True))
```

- line 4221: perhaps add the same comment as on 3897 as this looks redundant at first glance

```
R = f.base_ring()
```

- KeyError

```
P.<x,y>=ProjectiveSpace(QQ,1)
X=P.subscheme([x-y])
F=DynamicalSystem([x^2-1*y^2,y^2],domain=X)
F.periodic_points(2,formal=True)
```

- This is wrong:

```
P.<x,y>=ProjectiveSpace(QQ,1)
X=P.subscheme([x-y])
F=DynamicalSystem([x^2-3/4*y^2,y^2],domain=X)
F.periodic_points(2,minimal=True,formal=False,return_scheme=True)
```

Also wrong

```
P.<x,y,z>=ProjectiveSpace(QQ,2)
X=P.subscheme([x-y])
F=DynamicalSystem([x^2+3/4*y^2,y^2,z^2],X)
F.periodic_points(2,minimal=True,formal=False,return_scheme=True).rational_points()
```

Also wrong:

```
P.<x,y,z>=ProjectiveSpace(GF(3),2)
X=P.subscheme([x-y])
F=DynamicalSystem([x^2-2*y^2,y^2,z^2],domain=X)
F.periodic_points(2,minimal=True,formal=False,return_scheme=True).rational_points()
```

- TypeError

```
P.<x,y,z>=ProjectiveSpace(GF(3),2)
X=P.subscheme([x-y])
F=DynamicalSystem([x^2-2*y^2,y^2,z^2],X)
F.periodic_points(1,minimal=True,formal=True,return_scheme=True).rational_points()
```

- This gives a TypeError, perhaps catch the good fields and give a more informative error message

```
P.<x,y,z>=ProjectiveSpace(RR,2)
X=P.subscheme([x-y])
F=DynamicalSystem([x^2-2*y^2,y^2,z^2],domain=X)
F.periodic_points(2,minimal=True,formal=False,return_scheme=True).rational_points()
```

- Shouldn't this work?

```
R.<c>=QQ[]
P.<x,y,z>=ProjectiveSpace(FractionField(R),2)
X=P.subscheme([x-y])
F=DynamicalSystem([x^2-2*y^2,y^2,z^2],domain=X)
F.periodic_points(2,minimal=True,formal=False,return_scheme=True)
```

- Why is there no 'c' in this?

```
R.<c>=QQ[]
P.<x,y,z>=ProjectiveSpace(FractionField(R),2)
X=P.subscheme([x-y])
F=DynamicalSystem([x^2-c*y^2,y^2,z^2],domain=X)
F.periodic_points(2,minimal=False,formal=False,return_scheme=True)
```

But there is here

```
R.<c>=QQ[]
P.<x,y,z>=ProjectiveSpace(FractionField(R),2)
X=P.subscheme([x-y])
F=DynamicalSystem([x^2-c*y^2,y^2,z^2])
F.periodic_points(2,minimal=False,formal=False,return_scheme=True)
```



---

archive/issue_comments_635664.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2021-06-25T18:20:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635664",
    "user": "https://github.com/bhutz"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_635665.json:
```json
{
    "body": "**Changing commit** from \"[aaecd466a9bf718969228839c987f65c7a598576](https://github.com/sagemath/sagetrac-mirror/commit/aaecd466a9bf718969228839c987f65c7a598576)\" to \"[a6656ca91e84478cef2b2c015ea68150e3ce5084](https://github.com/sagemath/sagetrac-mirror/commit/a6656ca91e84478cef2b2c015ea68150e3ce5084)\".",
    "created_at": "2021-06-25T21:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635665",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[aaecd466a9bf718969228839c987f65c7a598576](https://github.com/sagemath/sagetrac-mirror/commit/aaecd466a9bf718969228839c987f65c7a598576)" to "[a6656ca91e84478cef2b2c015ea68150e3ce5084](https://github.com/sagemath/sagetrac-mirror/commit/a6656ca91e84478cef2b2c015ea68150e3ce5084)".



---

archive/issue_comments_635666.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a6656ca91e84478cef2b2c015ea68150e3ce5084\">a6656ca</a></td><td><code>31944: fix for subschemes, added function field error message</code></td></tr></table>\n",
    "created_at": "2021-06-25T21:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635666",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a6656ca91e84478cef2b2c015ea68150e3ce5084">a6656ca</a></td><td><code>31944: fix for subschemes, added function field error message</code></td></tr></table>




---

archive/issue_comments_635667.json:
```json
{
    "body": "<a id='comment:12'></a>\nSubschemes were very broken, I think because the nth iterate calculated for the subscheme might be very different. I pushed a fix that forgets about the subscheme, then adds the equations back in later. Hopefully that works better.\n\nFunction fields aren't implemented, as I don't think there is a flatening morphism for function fields. I added a nice error message.",
    "created_at": "2021-06-25T21:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635667",
    "user": "https://github.com/EnderWannabe"
}
```

<a id='comment:12'></a>
Subschemes were very broken, I think because the nth iterate calculated for the subscheme might be very different. I pushed a fix that forgets about the subscheme, then adds the equations back in later. Hopefully that works better.

Function fields aren't implemented, as I don't think there is a flatening morphism for function fields. I added a nice error message.



---

archive/issue_comments_635668.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-06-25T21:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635668",
    "user": "https://github.com/EnderWannabe"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_635669.json:
```json
{
    "body": "<a id='comment:14'></a>\nYou fixed most of the subscheme issues, but my first three comments are unaddressed.\n\nSome additional comments on the new code:\n\n- add `domain=PS` to be clear line 3906\n\n```\nf = DynamicalSystem(f.defining_polynomials())\n```\n\n- I don't understand why dom.defining_polynomials() is on this (3911-3912)\n\n```\nif formal and N == 2 and dom == PS:\n    X = PS.subscheme([f.dynatomic_polynomial([m,n])] + list(dom.defining_polynomials()))\n```\n\n- Why are you using\n\n```\nlist(X.defining_ideal().gens()\n```\nrather than\n\n```\nlist(X.defining_polynomials())\n```",
    "created_at": "2021-06-28T20:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635669",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:14'></a>
You fixed most of the subscheme issues, but my first three comments are unaddressed.

Some additional comments on the new code:

- add `domain=PS` to be clear line 3906

```
f = DynamicalSystem(f.defining_polynomials())
```

- I don't understand why dom.defining_polynomials() is on this (3911-3912)

```
if formal and N == 2 and dom == PS:
    X = PS.subscheme([f.dynatomic_polynomial([m,n])] + list(dom.defining_polynomials()))
```

- Why are you using

```
list(X.defining_ideal().gens()
```
rather than

```
list(X.defining_polynomials())
```



---

archive/issue_comments_635670.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4ec7c1069e24ebedfd68ac45d804e7cb840c17f\">b4ec7c1</a></td><td><code>31944: minor fixes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b810a20b359ab0f460f2a2a9241063de12b74c1\">6b810a2</a></td><td><code>31944: fixed periodic typo and added test</code></td></tr></table>\n",
    "created_at": "2021-06-29T16:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635670",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4ec7c1069e24ebedfd68ac45d804e7cb840c17f">b4ec7c1</a></td><td><code>31944: minor fixes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b810a20b359ab0f460f2a2a9241063de12b74c1">6b810a2</a></td><td><code>31944: fixed periodic typo and added test</code></td></tr></table>




---

archive/issue_comments_635671.json:
```json
{
    "body": "**Changing commit** from \"[a6656ca91e84478cef2b2c015ea68150e3ce5084](https://github.com/sagemath/sagetrac-mirror/commit/a6656ca91e84478cef2b2c015ea68150e3ce5084)\" to \"[6b810a20b359ab0f460f2a2a9241063de12b74c1](https://github.com/sagemath/sagetrac-mirror/commit/6b810a20b359ab0f460f2a2a9241063de12b74c1)\".",
    "created_at": "2021-06-29T16:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635671",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a6656ca91e84478cef2b2c015ea68150e3ce5084](https://github.com/sagemath/sagetrac-mirror/commit/a6656ca91e84478cef2b2c015ea68150e3ce5084)" to "[6b810a20b359ab0f460f2a2a9241063de12b74c1](https://github.com/sagemath/sagetrac-mirror/commit/6b810a20b359ab0f460f2a2a9241063de12b74c1)".



---

archive/issue_comments_635672.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [bhutz](#comment%3A14):\n> You fixed most of the subscheme issues, but my first three comments are unaddressed.\n\n\nLatest push should address those, as well as the latest comments.",
    "created_at": "2021-06-29T16:19:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635672",
    "user": "https://github.com/EnderWannabe"
}
```

<a id='comment:16'></a>
Replying to [bhutz](#comment%3A14):
> You fixed most of the subscheme issues, but my first three comments are unaddressed.


Latest push should address those, as well as the latest comments.



---

archive/issue_comments_635673.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b8ce4b7d83d24e58a3524f924077a90921707759\">b8ce4b7</a></td><td><code>31906: actual fix for warning message</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc36d1997650d6d5772027933d98717468731b67\">dc36d19</a></td><td><code>Merge branch 'u/gh-EnderWannabe/point_matrix_improvement' of trac.sagemath.org:sage into point_transformation_improvement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e7e893071ac99e3d9cd76e5ebf01395b922c198c\">e7e8930</a></td><td><code>31906: fixed denominator bug</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e49e34c47fbf846ca6b0bc9e21c2c09470676f0c\">e49e34c</a></td><td><code>Merge branch 'point_transformation_improvement' into periodic_points_improvement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a04a8d01c6b646273b9d26c192dcb9d4999aeab\">3a04a8d</a></td><td><code>31944: fixed bug with formal=True over ring</code></td></tr></table>\n",
    "created_at": "2021-07-06T17:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635673",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b8ce4b7d83d24e58a3524f924077a90921707759">b8ce4b7</a></td><td><code>31906: actual fix for warning message</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc36d1997650d6d5772027933d98717468731b67">dc36d19</a></td><td><code>Merge branch 'u/gh-EnderWannabe/point_matrix_improvement' of trac.sagemath.org:sage into point_transformation_improvement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e7e893071ac99e3d9cd76e5ebf01395b922c198c">e7e8930</a></td><td><code>31906: fixed denominator bug</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e49e34c47fbf846ca6b0bc9e21c2c09470676f0c">e49e34c</a></td><td><code>Merge branch 'point_transformation_improvement' into periodic_points_improvement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a04a8d01c6b646273b9d26c192dcb9d4999aeab">3a04a8d</a></td><td><code>31944: fixed bug with formal=True over ring</code></td></tr></table>




---

archive/issue_comments_635674.json:
```json
{
    "body": "**Changing commit** from \"[6b810a20b359ab0f460f2a2a9241063de12b74c1](https://github.com/sagemath/sagetrac-mirror/commit/6b810a20b359ab0f460f2a2a9241063de12b74c1)\" to \"[3a04a8d01c6b646273b9d26c192dcb9d4999aeab](https://github.com/sagemath/sagetrac-mirror/commit/3a04a8d01c6b646273b9d26c192dcb9d4999aeab)\".",
    "created_at": "2021-07-06T17:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635674",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6b810a20b359ab0f460f2a2a9241063de12b74c1](https://github.com/sagemath/sagetrac-mirror/commit/6b810a20b359ab0f460f2a2a9241063de12b74c1)" to "[3a04a8d01c6b646273b9d26c192dcb9d4999aeab](https://github.com/sagemath/sagetrac-mirror/commit/3a04a8d01c6b646273b9d26c192dcb9d4999aeab)".



---

archive/issue_comments_635675.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a627426e159b6b887328d7702362f9522560632\">4a62742</a></td><td><code>Merge branch 'develop' into periodic_points_improvement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e3693f0d675c8ba5b52007837910e0a7cd3158ec\">e3693f0</a></td><td><code>31944: added error message for fraction fields of m polynomial rings</code></td></tr></table>\n",
    "created_at": "2021-07-06T22:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635675",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a627426e159b6b887328d7702362f9522560632">4a62742</a></td><td><code>Merge branch 'develop' into periodic_points_improvement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e3693f0d675c8ba5b52007837910e0a7cd3158ec">e3693f0</a></td><td><code>31944: added error message for fraction fields of m polynomial rings</code></td></tr></table>




---

archive/issue_comments_635676.json:
```json
{
    "body": "**Changing commit** from \"[3a04a8d01c6b646273b9d26c192dcb9d4999aeab](https://github.com/sagemath/sagetrac-mirror/commit/3a04a8d01c6b646273b9d26c192dcb9d4999aeab)\" to \"[e3693f0d675c8ba5b52007837910e0a7cd3158ec](https://github.com/sagemath/sagetrac-mirror/commit/e3693f0d675c8ba5b52007837910e0a7cd3158ec)\".",
    "created_at": "2021-07-06T22:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635676",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3a04a8d01c6b646273b9d26c192dcb9d4999aeab](https://github.com/sagemath/sagetrac-mirror/commit/3a04a8d01c6b646273b9d26c192dcb9d4999aeab)" to "[e3693f0d675c8ba5b52007837910e0a7cd3158ec](https://github.com/sagemath/sagetrac-mirror/commit/e3693f0d675c8ba5b52007837910e0a7cd3158ec)".



---

archive/issue_comments_635677.json:
```json
{
    "body": "<a id='comment:19'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6a31bebb1b8efc8a11aad705c6877841dd50d2aa\">6a31beb</a></td><td><code>Merge branch 'u/gh-EnderWannabe/hyperplane_transform' of git://trac.sagemath.org/sage into hyperplane_transform</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65dcfcbc82c9ef8ab699c7a45fe9aae5cb2d24b9\">65dcfcb</a></td><td><code>Added documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8e786706989db83c452ae2f88a5eeb9dcaf2aa79\">8e78670</a></td><td><code>32166: initial commit with code and tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/efec402639bc08b195fa4459043f6d768c3cdcef\">efec402</a></td><td><code>Merge branch 'affine_preperiodic_points' into periodic_point_improvement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5927b209d26cba8e8e5c8f77f083c9c3c5e7c9cb\">5927b20</a></td><td><code>32166: added return_conjugation parameter</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ccecca9656a98f91e8985cc8528281c7f0daa1d1\">ccecca9</a></td><td><code>Merge branch 'affine_preperiodic_points' into periodic_point_improvement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5c889f72b0b1a6d9231c4c00c874619faf04b422\">5c889f7</a></td><td><code>31944: switched periodic points to affine preperiodic model</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6125b6eb40b2002eac029bf9ef412996e3f64958\">6125b6e</a></td><td><code>31944: updated preperiodic points to affine preperiodic model</code></td></tr></table>\n",
    "created_at": "2021-07-09T16:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635677",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6a31bebb1b8efc8a11aad705c6877841dd50d2aa">6a31beb</a></td><td><code>Merge branch 'u/gh-EnderWannabe/hyperplane_transform' of git://trac.sagemath.org/sage into hyperplane_transform</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65dcfcbc82c9ef8ab699c7a45fe9aae5cb2d24b9">65dcfcb</a></td><td><code>Added documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8e786706989db83c452ae2f88a5eeb9dcaf2aa79">8e78670</a></td><td><code>32166: initial commit with code and tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/efec402639bc08b195fa4459043f6d768c3cdcef">efec402</a></td><td><code>Merge branch 'affine_preperiodic_points' into periodic_point_improvement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5927b209d26cba8e8e5c8f77f083c9c3c5e7c9cb">5927b20</a></td><td><code>32166: added return_conjugation parameter</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ccecca9656a98f91e8985cc8528281c7f0daa1d1">ccecca9</a></td><td><code>Merge branch 'affine_preperiodic_points' into periodic_point_improvement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5c889f72b0b1a6d9231c4c00c874619faf04b422">5c889f7</a></td><td><code>31944: switched periodic points to affine preperiodic model</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6125b6eb40b2002eac029bf9ef412996e3f64958">6125b6e</a></td><td><code>31944: updated preperiodic points to affine preperiodic model</code></td></tr></table>




---

archive/issue_comments_635678.json:
```json
{
    "body": "**Changing commit** from \"[e3693f0d675c8ba5b52007837910e0a7cd3158ec](https://github.com/sagemath/sagetrac-mirror/commit/e3693f0d675c8ba5b52007837910e0a7cd3158ec)\" to \"[6125b6eb40b2002eac029bf9ef412996e3f64958](https://github.com/sagemath/sagetrac-mirror/commit/6125b6eb40b2002eac029bf9ef412996e3f64958)\".",
    "created_at": "2021-07-09T16:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635678",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e3693f0d675c8ba5b52007837910e0a7cd3158ec](https://github.com/sagemath/sagetrac-mirror/commit/e3693f0d675c8ba5b52007837910e0a7cd3158ec)" to "[6125b6eb40b2002eac029bf9ef412996e3f64958](https://github.com/sagemath/sagetrac-mirror/commit/6125b6eb40b2002eac029bf9ef412996e3f64958)".



---

archive/issue_comments_635679.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2021-07-09T16:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635679",
    "user": "https://github.com/EnderWannabe"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_635680.json:
```json
{
    "body": "<a id='comment:20'></a>\nMinimal seems to be broken for preperiodic points:\n\n```\nP.<x,y,z> = ProjectiveSpace(QQ, 2)\nf = DynamicalSystem_projective([x^2 - y^2, 2*(x^2 - y^2), y^2 - z^2])\nK = f.preperiodic_points(1, 1, minimal=True, return_scheme=True)\nK(P(0,0,1))\n(0: 0: 1)\n```\n\nBut (0:0:1) is a periodic point of period 1 (so it shouldn't be minimal of preperiod (1,1), right?). I'm not sure how to fix this, since\n\n```\nK2 = f.preperiodic_points(0, 1, minimal=False, return_scheme=True)\nideal = K.defining_ideal()\nideal2 = K2.defining_ideal()\nideal.saturation(ideal2)[0] == ideal\nTrue\n```\n\nSaturation of ideals isn't removing the periodic point.",
    "created_at": "2021-07-09T16:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635680",
    "user": "https://github.com/EnderWannabe"
}
```

<a id='comment:20'></a>
Minimal seems to be broken for preperiodic points:

```
P.<x,y,z> = ProjectiveSpace(QQ, 2)
f = DynamicalSystem_projective([x^2 - y^2, 2*(x^2 - y^2), y^2 - z^2])
K = f.preperiodic_points(1, 1, minimal=True, return_scheme=True)
K(P(0,0,1))
(0: 0: 1)
```

But (0:0:1) is a periodic point of period 1 (so it shouldn't be minimal of preperiod (1,1), right?). I'm not sure how to fix this, since

```
K2 = f.preperiodic_points(0, 1, minimal=False, return_scheme=True)
ideal = K.defining_ideal()
ideal2 = K2.defining_ideal()
ideal.saturation(ideal2)[0] == ideal
True
```

Saturation of ideals isn't removing the periodic point.



---

archive/issue_comments_635681.json:
```json
{
    "body": "**Changing dependencies** from \"#31954, #31906\" to \"#31954, #31906, #32166\".",
    "created_at": "2021-07-09T16:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635681",
    "user": "https://github.com/EnderWannabe"
}
```

**Changing dependencies** from "#31954, #31906" to "#31954, #31906, #32166".



---

archive/issue_comments_635682.json:
```json
{
    "body": "**Changing commit** from \"[6125b6eb40b2002eac029bf9ef412996e3f64958](https://github.com/sagemath/sagetrac-mirror/commit/6125b6eb40b2002eac029bf9ef412996e3f64958)\" to \"[9b5e74f70efaf1af0f32945f1bee255e3e7e41da](https://github.com/sagemath/sagetrac-mirror/commit/9b5e74f70efaf1af0f32945f1bee255e3e7e41da)\".",
    "created_at": "2021-07-09T19:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635682",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6125b6eb40b2002eac029bf9ef412996e3f64958](https://github.com/sagemath/sagetrac-mirror/commit/6125b6eb40b2002eac029bf9ef412996e3f64958)" to "[9b5e74f70efaf1af0f32945f1bee255e3e7e41da](https://github.com/sagemath/sagetrac-mirror/commit/9b5e74f70efaf1af0f32945f1bee255e3e7e41da)".



---

archive/issue_comments_635683.json:
```json
{
    "body": "<a id='comment:21'></a>\n**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/75d877163b34c4cfae33e0220584c2b0fa79a97e\">75d8771</a></td><td><code>Merge branch 'u/bhutz/point_matrix_improvement' of trac.sagemath.org:sage into point_transformation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b82de340fdc4cc7426ef3532996fa3ac3dbe9326\">b82de34</a></td><td><code>Merge branch 'u/gh-EnderWannabe/hyperplane_transform' of trac.sagemath.org:sage into hyperplane_transform</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/379a732ea87c23f0e0413ad91189d97f8d1bf4cf\">379a732</a></td><td><code>Merge branch 'hyperplane_transform' into affine_preperiodic</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15f206ca46a25ecd9c4e1ba860136403f1d48f65\">15f206c</a></td><td><code>32166: fixed typos, added subscheme example</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4246d29fac9a64050db5ce912a075627f8185c5\">b4246d2</a></td><td><code>32166: fixed identity matrix return</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eaebd3389e484c51c2abd6fff0b03f508e736ee4\">eaebd33</a></td><td><code>32166: added test for identity</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57a4b399c7a97c2cd6a8552b2674dd9767c4e2af\">57a4b39</a></td><td><code>Merge branch 'affine_preperiodic' into periodic_points_improvement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/81d7c97aeab927df89b324cb3fb2c68bbdd0620a\">81d7c97</a></td><td><code>32166: fixed documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a63927eea4cfb70ec08d4c0f346ef6ad309cdbe8\">a63927e</a></td><td><code>Merge branch 'affine_preperiodic' into periodic_points_improvement</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b5e74f70efaf1af0f32945f1bee255e3e7e41da\">9b5e74f</a></td><td><code>31944: fixed calls to affine preperiodic model</code></td></tr></table>\n",
    "created_at": "2021-07-09T19:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635683",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>
**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/75d877163b34c4cfae33e0220584c2b0fa79a97e">75d8771</a></td><td><code>Merge branch 'u/bhutz/point_matrix_improvement' of trac.sagemath.org:sage into point_transformation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b82de340fdc4cc7426ef3532996fa3ac3dbe9326">b82de34</a></td><td><code>Merge branch 'u/gh-EnderWannabe/hyperplane_transform' of trac.sagemath.org:sage into hyperplane_transform</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/379a732ea87c23f0e0413ad91189d97f8d1bf4cf">379a732</a></td><td><code>Merge branch 'hyperplane_transform' into affine_preperiodic</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15f206ca46a25ecd9c4e1ba860136403f1d48f65">15f206c</a></td><td><code>32166: fixed typos, added subscheme example</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4246d29fac9a64050db5ce912a075627f8185c5">b4246d2</a></td><td><code>32166: fixed identity matrix return</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eaebd3389e484c51c2abd6fff0b03f508e736ee4">eaebd33</a></td><td><code>32166: added test for identity</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57a4b399c7a97c2cd6a8552b2674dd9767c4e2af">57a4b39</a></td><td><code>Merge branch 'affine_preperiodic' into periodic_points_improvement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/81d7c97aeab927df89b324cb3fb2c68bbdd0620a">81d7c97</a></td><td><code>32166: fixed documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a63927eea4cfb70ec08d4c0f346ef6ad309cdbe8">a63927e</a></td><td><code>Merge branch 'affine_preperiodic' into periodic_points_improvement</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b5e74f70efaf1af0f32945f1bee255e3e7e41da">9b5e74f</a></td><td><code>31944: fixed calls to affine preperiodic model</code></td></tr></table>




---

archive/issue_comments_635684.json:
```json
{
    "body": "<a id='comment:22'></a>\nThe example:\n\n```\nP.<x,y,z> = ProjectiveSpace(QQ, 2)\nf = DynamicalSystem_projective([x^2 - y^2, 2*(x^2 - y^2), y^2 - z^2])\n```\nis not a morphism, so the theorem for the algorithm don't apply (because the variety of preperiodic points is not simply a finite union of points).\n\nDo you have an example that is failing which is a morphism?",
    "created_at": "2021-07-12T19:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635684",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:22'></a>
The example:

```
P.<x,y,z> = ProjectiveSpace(QQ, 2)
f = DynamicalSystem_projective([x^2 - y^2, 2*(x^2 - y^2), y^2 - z^2])
```
is not a morphism, so the theorem for the algorithm don't apply (because the variety of preperiodic points is not simply a finite union of points).

Do you have an example that is failing which is a morphism?



---

archive/issue_comments_635685.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-07-12T19:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635685",
    "user": "https://github.com/EnderWannabe"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_635686.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [bhutz](#comment%3A22):\n> Do you have an example that is failing which is a morphism?\n\n\nNone that I can find. Good catch, thanks for pointing that out. This should be ready for review now.",
    "created_at": "2021-07-12T19:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635686",
    "user": "https://github.com/EnderWannabe"
}
```

<a id='comment:23'></a>
Replying to [bhutz](#comment%3A22):
> Do you have an example that is failing which is a morphism?


None that I can find. Good catch, thanks for pointing that out. This should be ready for review now.



---

archive/issue_comments_635687.json:
```json
{
    "body": "**Changing commit** from \"[9b5e74f70efaf1af0f32945f1bee255e3e7e41da](https://github.com/sagemath/sagetrac-mirror/commit/9b5e74f70efaf1af0f32945f1bee255e3e7e41da)\" to \"[f1e19586fc1715c36679d4029d629bc88b8555fa](https://github.com/sagemath/sagetrac-mirror/commit/f1e19586fc1715c36679d4029d629bc88b8555fa)\".",
    "created_at": "2021-07-12T19:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635687",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[9b5e74f70efaf1af0f32945f1bee255e3e7e41da](https://github.com/sagemath/sagetrac-mirror/commit/9b5e74f70efaf1af0f32945f1bee255e3e7e41da)" to "[f1e19586fc1715c36679d4029d629bc88b8555fa](https://github.com/sagemath/sagetrac-mirror/commit/f1e19586fc1715c36679d4029d629bc88b8555fa)".



---

archive/issue_comments_635688.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1e19586fc1715c36679d4029d629bc88b8555fa\">f1e1958</a></td><td><code>31944: fix for subscheme issue</code></td></tr></table>\n",
    "created_at": "2021-07-12T19:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635688",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1e19586fc1715c36679d4029d629bc88b8555fa">f1e1958</a></td><td><code>31944: fix for subscheme issue</code></td></tr></table>




---

archive/issue_comments_635689.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-07-13T14:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635689",
    "user": "https://github.com/bhutz"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_635690.json:
```json
{
    "body": "<a id='comment:25'></a>\nThis looks good to me now.",
    "created_at": "2021-07-13T14:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635690",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:25'></a>
This looks good to me now.



---

archive/issue_comments_635691.json:
```json
{
    "body": "<a id='comment:26'></a>\nSecond thought. Since the non-morphism case is giving wrong answers, it should be error checked. It does give right answers if minimal=False, formal=False and return_scheme=True",
    "created_at": "2021-07-13T15:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635691",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:26'></a>
Second thought. Since the non-morphism case is giving wrong answers, it should be error checked. It does give right answers if minimal=False, formal=False and return_scheme=True



---

archive/issue_comments_635692.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2021-07-13T15:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635692",
    "user": "https://github.com/bhutz"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_635693.json:
```json
{
    "body": "<a id='comment:27'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3ea2beb5182055bc25028e7278499f0f112fc04\">d3ea2be</a></td><td><code>31944: added check for morphisms</code></td></tr></table>\n",
    "created_at": "2021-07-13T16:02:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635693",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3ea2beb5182055bc25028e7278499f0f112fc04">d3ea2be</a></td><td><code>31944: added check for morphisms</code></td></tr></table>




---

archive/issue_comments_635694.json:
```json
{
    "body": "**Changing commit** from \"[f1e19586fc1715c36679d4029d629bc88b8555fa](https://github.com/sagemath/sagetrac-mirror/commit/f1e19586fc1715c36679d4029d629bc88b8555fa)\" to \"[d3ea2beb5182055bc25028e7278499f0f112fc04](https://github.com/sagemath/sagetrac-mirror/commit/d3ea2beb5182055bc25028e7278499f0f112fc04)\".",
    "created_at": "2021-07-13T16:02:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635694",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f1e19586fc1715c36679d4029d629bc88b8555fa](https://github.com/sagemath/sagetrac-mirror/commit/f1e19586fc1715c36679d4029d629bc88b8555fa)" to "[d3ea2beb5182055bc25028e7278499f0f112fc04](https://github.com/sagemath/sagetrac-mirror/commit/d3ea2beb5182055bc25028e7278499f0f112fc04)".



---

archive/issue_comments_635695.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-07-13T16:02:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635695",
    "user": "https://github.com/EnderWannabe"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_635696.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [bhutz](#comment%3A26):\n> Second thought. Since the non-morphism case is giving wrong answers, it should be error checked. It does give right answers if minimal=False, formal=False and return_scheme=True\n\n\nAdded",
    "created_at": "2021-07-13T16:02:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635696",
    "user": "https://github.com/EnderWannabe"
}
```

<a id='comment:28'></a>
Replying to [bhutz](#comment%3A26):
> Second thought. Since the non-morphism case is giving wrong answers, it should be error checked. It does give right answers if minimal=False, formal=False and return_scheme=True


Added



---

archive/issue_comments_635697.json:
```json
{
    "body": "<a id='comment:29'></a>\nThe non-morphism check is missed in this case\n\n```\nP.<x,y,z>=ProjectiveSpace(QQ,2)\nF=DynamicalSystem([x^2-y^2,z^2-y^2,x^2-z^2])\nF.preperiodic_points(0,2,minimal=False,formal=True,return_scheme=True)\n```\n\nAlso, found another weird case giving back the wrong answers\n\nHere are the periods. It's not necessarily wrong that there are lower periods as there are many high multiplicity points here.\n\n```\nK=QQ\nP.<x,y,z>=ProjectiveSpace(QQ,2)\nF=DynamicalSystem([x^2-2*y^2,y^2,z^2],domain=P)\nfor Q in F.preperiodic_points(2,1,minimal=False,formal=True,return_scheme=False):\n    print(Q,F._is_preperiodic(Q,return_period=True))\n```\n\nChecking the multiplicities, we see that nothing is being subtracted out despite there being (1,1) points.\n\n```\nP.<x,y,z>=ProjectiveSpace(K,2)\nF=DynamicalSystem([x^2-2*y^2,y^2,z^2],domain=P)\nfor Q in F.preperiodic_points(2,1,minimal=False,formal=True,return_scheme=True).rational_points():\n    print(Q,Q.multiplicity())\n\n\nP.<x,y,z>=ProjectiveSpace(K,2)\nF=DynamicalSystem([x^2-2*y^2,y^2,z^2],domain=P)\nfor Q in F.preperiodic_points(2,1,minimal=False,formal=False,return_scheme=True).rational_points():\n    print(Q,Q.multiplicity())\n\nP.<x,y,z>=ProjectiveSpace(K,2)\nF=DynamicalSystem([x^2-2*y^2,y^2,z^2],domain=P)\nfor Q in F.preperiodic_points(1,1,minimal=False,formal=False,return_scheme=True).rational_points():\n    print(Q,Q.multiplicity())\n```\n\n\n- Perhaps there is just something weird when minimal=False and formal=True?",
    "created_at": "2021-07-14T16:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635697",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:29'></a>
The non-morphism check is missed in this case

```
P.<x,y,z>=ProjectiveSpace(QQ,2)
F=DynamicalSystem([x^2-y^2,z^2-y^2,x^2-z^2])
F.preperiodic_points(0,2,minimal=False,formal=True,return_scheme=True)
```

Also, found another weird case giving back the wrong answers

Here are the periods. It's not necessarily wrong that there are lower periods as there are many high multiplicity points here.

```
K=QQ
P.<x,y,z>=ProjectiveSpace(QQ,2)
F=DynamicalSystem([x^2-2*y^2,y^2,z^2],domain=P)
for Q in F.preperiodic_points(2,1,minimal=False,formal=True,return_scheme=False):
    print(Q,F._is_preperiodic(Q,return_period=True))
```

Checking the multiplicities, we see that nothing is being subtracted out despite there being (1,1) points.

```
P.<x,y,z>=ProjectiveSpace(K,2)
F=DynamicalSystem([x^2-2*y^2,y^2,z^2],domain=P)
for Q in F.preperiodic_points(2,1,minimal=False,formal=True,return_scheme=True).rational_points():
    print(Q,Q.multiplicity())


P.<x,y,z>=ProjectiveSpace(K,2)
F=DynamicalSystem([x^2-2*y^2,y^2,z^2],domain=P)
for Q in F.preperiodic_points(2,1,minimal=False,formal=False,return_scheme=True).rational_points():
    print(Q,Q.multiplicity())

P.<x,y,z>=ProjectiveSpace(K,2)
F=DynamicalSystem([x^2-2*y^2,y^2,z^2],domain=P)
for Q in F.preperiodic_points(1,1,minimal=False,formal=False,return_scheme=True).rational_points():
    print(Q,Q.multiplicity())
```


- Perhaps there is just something weird when minimal=False and formal=True?



---

archive/issue_comments_635698.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2021-07-14T16:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635698",
    "user": "https://github.com/bhutz"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_635699.json:
```json
{
    "body": "<a id='comment:30'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/268bc837c24cc0fcb6bad1c84d5ad00b1ec54676\">268bc83</a></td><td><code>31944: fixed if statement</code></td></tr></table>\n",
    "created_at": "2021-07-14T16:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635699",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/268bc837c24cc0fcb6bad1c84d5ad00b1ec54676">268bc83</a></td><td><code>31944: fixed if statement</code></td></tr></table>




---

archive/issue_comments_635700.json:
```json
{
    "body": "**Changing commit** from \"[d3ea2beb5182055bc25028e7278499f0f112fc04](https://github.com/sagemath/sagetrac-mirror/commit/d3ea2beb5182055bc25028e7278499f0f112fc04)\" to \"[268bc837c24cc0fcb6bad1c84d5ad00b1ec54676](https://github.com/sagemath/sagetrac-mirror/commit/268bc837c24cc0fcb6bad1c84d5ad00b1ec54676)\".",
    "created_at": "2021-07-14T16:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635700",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d3ea2beb5182055bc25028e7278499f0f112fc04](https://github.com/sagemath/sagetrac-mirror/commit/d3ea2beb5182055bc25028e7278499f0f112fc04)" to "[268bc837c24cc0fcb6bad1c84d5ad00b1ec54676](https://github.com/sagemath/sagetrac-mirror/commit/268bc837c24cc0fcb6bad1c84d5ad00b1ec54676)".



---

archive/issue_comments_635701.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [bhutz](#comment%3A29):\n> Also, found another weird case giving back the wrong answers\n\n\nI updated the logic around minimal and formal, adding a check for if (m,n) != (0,1). But, I coded it as m != 0 and n != 1, so minimal and formal were being ignored when n = 1 or when m = 0.\n\nChanged to m != 0 or n != 1.\n\nI think the example you gave should work now, however, it hasn't finished running yet. It may never will, since it is actually doing the computations to find the formal scheme now",
    "created_at": "2021-07-14T16:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635701",
    "user": "https://github.com/EnderWannabe"
}
```

<a id='comment:31'></a>
Replying to [bhutz](#comment%3A29):
> Also, found another weird case giving back the wrong answers


I updated the logic around minimal and formal, adding a check for if (m,n) != (0,1). But, I coded it as m != 0 and n != 1, so minimal and formal were being ignored when n = 1 or when m = 0.

Changed to m != 0 or n != 1.

I think the example you gave should work now, however, it hasn't finished running yet. It may never will, since it is actually doing the computations to find the formal scheme now



---

archive/issue_comments_635702.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-07-14T16:39:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635702",
    "user": "https://github.com/EnderWannabe"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_635703.json:
```json
{
    "body": "<a id='comment:33'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6f2857f21394f0c242f9180f57f45ac565b618ed\">6f2857f</a></td><td><code>31944: added example for formal preperiodic</code></td></tr></table>\n",
    "created_at": "2021-07-14T18:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635703",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6f2857f21394f0c242f9180f57f45ac565b618ed">6f2857f</a></td><td><code>31944: added example for formal preperiodic</code></td></tr></table>




---

archive/issue_comments_635704.json:
```json
{
    "body": "**Changing commit** from \"[268bc837c24cc0fcb6bad1c84d5ad00b1ec54676](https://github.com/sagemath/sagetrac-mirror/commit/268bc837c24cc0fcb6bad1c84d5ad00b1ec54676)\" to \"[6f2857f21394f0c242f9180f57f45ac565b618ed](https://github.com/sagemath/sagetrac-mirror/commit/6f2857f21394f0c242f9180f57f45ac565b618ed)\".",
    "created_at": "2021-07-14T18:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635704",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[268bc837c24cc0fcb6bad1c84d5ad00b1ec54676](https://github.com/sagemath/sagetrac-mirror/commit/268bc837c24cc0fcb6bad1c84d5ad00b1ec54676)" to "[6f2857f21394f0c242f9180f57f45ac565b618ed](https://github.com/sagemath/sagetrac-mirror/commit/6f2857f21394f0c242f9180f57f45ac565b618ed)".



---

archive/issue_comments_635705.json:
```json
{
    "body": "<a id='comment:34'></a>\nYes, the formal=True is running now. The original example is not finishing, but I ran a shorter one with the same type of properties to check.",
    "created_at": "2021-07-15T15:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635705",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:34'></a>
Yes, the formal=True is running now. The original example is not finishing, but I ran a shorter one with the same type of properties to check.



---

archive/issue_comments_635706.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-07-15T15:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635706",
    "user": "https://github.com/bhutz"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_635707.json:
```json
{
    "body": "**Changing branch** from \"[u/gh-EnderWannabe/periodic_points_improvement](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-EnderWannabe/periodic_points_improvement)\" to \"[6f2857f21394f0c242f9180f57f45ac565b618ed](https://github.com/sagemath/sagetrac-mirror/commit/6f2857f21394f0c242f9180f57f45ac565b618ed)\".",
    "created_at": "2021-07-25T18:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635707",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/gh-EnderWannabe/periodic_points_improvement](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-EnderWannabe/periodic_points_improvement)" to "[6f2857f21394f0c242f9180f57f45ac565b618ed](https://github.com/sagemath/sagetrac-mirror/commit/6f2857f21394f0c242f9180f57f45ac565b618ed)".



---

archive/issue_events_094990.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-25T18:51:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31944#event-94990"
}
```



---

archive/issue_comments_635708.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2021-07-25T18:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635708",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_comments_635709.json:
```json
{
    "body": "<a id='comment:36'></a>\nThis is creating random failures, I've created #32322",
    "created_at": "2021-08-01T08:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635709",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:36'></a>
This is creating random failures, I've created #32322



---

archive/issue_comments_635710.json:
```json
{
    "body": "**Changing commit** from \"[6f2857f21394f0c242f9180f57f45ac565b618ed](https://github.com/sagemath/sagetrac-mirror/commit/6f2857f21394f0c242f9180f57f45ac565b618ed)\" to \"\".",
    "created_at": "2021-08-01T08:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-635710",
    "user": "https://github.com/vbraun"
}
```

**Changing commit** from "[6f2857f21394f0c242f9180f57f45ac565b618ed](https://github.com/sagemath/sagetrac-mirror/commit/6f2857f21394f0c242f9180f57f45ac565b618ed)" to "".
