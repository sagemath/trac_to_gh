# Issue 31228: The "-march=native" flag vs. the compiler used when Python extensions are built

archive/issues_030991.json:
```json
{
    "body": "(from #31132)\n\n#27122 determines whether `CC` accepts `-march=native` and then adds it globally to `CFLAGS` in `build/bin/sage-build-env`.\n\nHowever, Python extension modules are compiled with the compiler listed in sysconfig. On macOS with homebrew, using `/usr/bin/python3`, this could be `clang`, which does not accept `-march=native`.\n\n**CC:**  @kliem @zlscherr @jhpalmieri\n\n**Reviewer:** Jonathan Kliem\n\n**Dependencies:** #3113, #30725\n\n**Resolution:** invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/31228\n\n",
    "closed_at": "2021-03-26T20:28:26Z",
    "created_at": "2021-01-13T01:51:14Z",
    "labels": [
        "component: build: configure",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "The \"-march=native\" flag vs. the compiler used when Python extensions are built",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31228",
    "user": "https://github.com/mkoeppe"
}
```
(from #31132)

#27122 determines whether `CC` accepts `-march=native` and then adds it globally to `CFLAGS` in `build/bin/sage-build-env`.

However, Python extension modules are compiled with the compiler listed in sysconfig. On macOS with homebrew, using `/usr/bin/python3`, this could be `clang`, which does not accept `-march=native`.

**CC:**  @kliem @zlscherr @jhpalmieri

**Reviewer:** Jonathan Kliem

**Dependencies:** #3113, #30725

**Resolution:** invalid

Issue created by migration from https://trac.sagemath.org/ticket/31228





---

archive/issue_comments_619907.json:
```json
{
    "body": "<a id='comment:2'></a>\nDo we manually set the Compiler to be different somewhere vor is this enforced by using system python? If not, is there a reasonable place to check this?\n\nCan this happen to python modules only?",
    "created_at": "2021-01-13T07:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619907",
    "user": "https://github.com/kliem"
}
```

<a id='comment:2'></a>
Do we manually set the Compiler to be different somewhere vor is this enforced by using system python? If not, is there a reasonable place to check this?

Can this happen to python modules only?



---

archive/issue_comments_619908.json:
```json
{
    "body": "<a id='comment:3'></a>\nThere is `CFLAGS_NON_NATIVE` etc that should be used in case the compiler changes.",
    "created_at": "2021-01-13T07:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619908",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>
There is `CFLAGS_NON_NATIVE` etc that should be used in case the compiler changes.



---

archive/issue_comments_619909.json:
```json
{
    "body": "<a id='comment:4'></a>\nThis is the standard behavior of python's distutils. Only Python extension modules are affected.\n\n`m4/sage_check_python_for_venv` defines a macro used by `build/pkgs/python3/spkg-configure.m4` to check the suitability of distutils.\n\nThese are probably the best places to put additional checks.",
    "created_at": "2021-01-13T20:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619909",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
This is the standard behavior of python's distutils. Only Python extension modules are affected.

`m4/sage_check_python_for_venv` defines a macro used by `build/pkgs/python3/spkg-configure.m4` to check the suitability of distutils.

These are probably the best places to put additional checks.



---

archive/issue_comments_619910.json:
```json
{
    "body": "<a id='comment:5'></a>\nI see. I can add a file compiling with `-march=native` in `m4/sage_check_python_for_venv`. In case of failure, I have to export something.\n\nIf this fails, I have to build extension modules with `export CFLAGS=CFLAGS_NON_NATIVE` and `export CXXFLAGS=CXXFLAGS_NON_NATIVE` somehow.",
    "created_at": "2021-01-13T20:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619910",
    "user": "https://github.com/kliem"
}
```

<a id='comment:5'></a>
I see. I can add a file compiling with `-march=native` in `m4/sage_check_python_for_venv`. In case of failure, I have to export something.

If this fails, I have to build extension modules with `export CFLAGS=CFLAGS_NON_NATIVE` and `export CXXFLAGS=CXXFLAGS_NON_NATIVE` somehow.



---

archive/issue_comments_619911.json:
```json
{
    "body": "<a id='comment:6'></a>\nMuch easier would be to give completely up on `march=native` in this case.",
    "created_at": "2021-01-13T20:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619911",
    "user": "https://github.com/kliem"
}
```

<a id='comment:6'></a>
Much easier would be to give completely up on `march=native` in this case.



---

archive/issue_comments_619912.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [gh-kliem](#comment%3A6):\n> Much easier would be to give completely up on `march=native` in this case.\n\n\nYes, I think that would be better. Otherwise too many `spkg-install` files would have to be changed. I don't see a clean way of implementing this in the helper functions `sdh_pip_install` and `sdh_setup_bdist_wheel`.",
    "created_at": "2021-01-13T21:04:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619912",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Replying to [gh-kliem](#comment%3A6):
> Much easier would be to give completely up on `march=native` in this case.


Yes, I think that would be better. Otherwise too many `spkg-install` files would have to be changed. I don't see a clean way of implementing this in the helper functions `sdh_pip_install` and `sdh_setup_bdist_wheel`.



---

archive/issue_events_091937.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31228#event-91937"
}
```



---

archive/issue_comments_619913.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built)",
    "created_at": "2021-01-14T04:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619913",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built)



---

archive/issue_comments_619914.json:
```json
{
    "body": "**Commit:** [289b1629ab8e93a65249176f893f0dd54ae2111d](https://github.com/sagemath/sagetrac-mirror/commit/289b1629ab8e93a65249176f893f0dd54ae2111d)",
    "created_at": "2021-01-14T04:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619914",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [289b1629ab8e93a65249176f893f0dd54ae2111d](https://github.com/sagemath/sagetrac-mirror/commit/289b1629ab8e93a65249176f893f0dd54ae2111d)



---

archive/issue_comments_619915.json:
```json
{
    "body": "<a id='comment:10'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2c6002555d21e242ab5d1e25e4d1f3851e246532\">2c60025</a></td><td><code>m4/sage_check_python_for_venv.m4: Warn if python3 is misconfigured like it is currently in homebrew</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ee679bd57302d8e422e76b422d73f83ab87a4293\">ee679bd</a></td><td><code>build/pkgs/python3/spkg-configure.m4: Do not check sysconfig CPPFLAGS so that /usr/bin/python3 is accepted on macOS; reject broken homebrew python3 unless requested explicitly with configgure --with-python=...</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29aee87fc01f6fce3cc4356c98f27c44e4ce2b5b\">29aee87</a></td><td><code>build/pkgs/python3: Update to 3.9.0rc2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e61d464292262d80c43895c64fce4f48a6895822\">e61d464</a></td><td><code>build/pkgs/python3: Update to 3.9.0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f8bb56d16600c8cfe1bab1d127f3931ca280dff0\">f8bb56d</a></td><td><code>build/pkgs/python3: Update to 3.9.1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0e3513fcb3e2efa1832db8bd7957a93ad75b215c\">0e3513f</a></td><td><code>build/pkgs/pip: Update to 20.3.3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/41d7e7a74441e5f9deb3e7a93adfccf486dde417\">41d7e7a</a></td><td><code>Merge branch 'u/jhpalmieri/new_wheel' of git://trac.sagemath.org/sage into t/30589/upgrade-python-3.9</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/76d5fd15f9bcc50a478471182f70ba8d46bf4319\">76d5fd1</a></td><td><code>Merge branch 't/30589/upgrade-python-3.9' into t/31132/homebrew__unused_packages__singular__pari_______in__usr_local_leak_into_build_when_using_homebrew_s_python3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/289b1629ab8e93a65249176f893f0dd54ae2111d\">289b162</a></td><td><code>m4/sage_check_python_for_venv.m4: Factor out macros SAGE_PYTHON_DISTUTILS_C_CONFTEST, SAGE_PYTHON_DISTUTILS_CXX_CONFTEST</code></td></tr></table>\n",
    "created_at": "2021-01-14T04:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619915",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2c6002555d21e242ab5d1e25e4d1f3851e246532">2c60025</a></td><td><code>m4/sage_check_python_for_venv.m4: Warn if python3 is misconfigured like it is currently in homebrew</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ee679bd57302d8e422e76b422d73f83ab87a4293">ee679bd</a></td><td><code>build/pkgs/python3/spkg-configure.m4: Do not check sysconfig CPPFLAGS so that /usr/bin/python3 is accepted on macOS; reject broken homebrew python3 unless requested explicitly with configgure --with-python=...</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29aee87fc01f6fce3cc4356c98f27c44e4ce2b5b">29aee87</a></td><td><code>build/pkgs/python3: Update to 3.9.0rc2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e61d464292262d80c43895c64fce4f48a6895822">e61d464</a></td><td><code>build/pkgs/python3: Update to 3.9.0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f8bb56d16600c8cfe1bab1d127f3931ca280dff0">f8bb56d</a></td><td><code>build/pkgs/python3: Update to 3.9.1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0e3513fcb3e2efa1832db8bd7957a93ad75b215c">0e3513f</a></td><td><code>build/pkgs/pip: Update to 20.3.3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/41d7e7a74441e5f9deb3e7a93adfccf486dde417">41d7e7a</a></td><td><code>Merge branch 'u/jhpalmieri/new_wheel' of git://trac.sagemath.org/sage into t/30589/upgrade-python-3.9</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/76d5fd15f9bcc50a478471182f70ba8d46bf4319">76d5fd1</a></td><td><code>Merge branch 't/30589/upgrade-python-3.9' into t/31132/homebrew__unused_packages__singular__pari_______in__usr_local_leak_into_build_when_using_homebrew_s_python3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/289b1629ab8e93a65249176f893f0dd54ae2111d">289b162</a></td><td><code>m4/sage_check_python_for_venv.m4: Factor out macros SAGE_PYTHON_DISTUTILS_C_CONFTEST, SAGE_PYTHON_DISTUTILS_CXX_CONFTEST</code></td></tr></table>




---

archive/issue_comments_619916.json:
```json
{
    "body": "**Dependencies:** #31132",
    "created_at": "2021-01-14T04:30:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619916",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #31132



---

archive/issue_comments_619917.json:
```json
{
    "body": "<a id='comment:11'></a>\nLet's do this on top of #31132, which has modified the same files.\n\nI have added one commit that refactors `m4/sage_check_python_for_venv.m4` as preparation.",
    "created_at": "2021-01-14T04:30:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619917",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
Let's do this on top of #31132, which has modified the same files.

I have added one commit that refactors `m4/sage_check_python_for_venv.m4` as preparation.



---

archive/issue_comments_619918.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e38057efbb87ac563350d48a1d34498d49d10403\">e38057e</a></td><td><code>build/pkgs/python3/spkg-configure.m4: If '-march' has been set, check if it works with the compilers used for extension buildings</code></td></tr></table>\n",
    "created_at": "2021-01-14T04:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619918",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e38057efbb87ac563350d48a1d34498d49d10403">e38057e</a></td><td><code>build/pkgs/python3/spkg-configure.m4: If '-march' has been set, check if it works with the compilers used for extension buildings</code></td></tr></table>




---

archive/issue_comments_619919.json:
```json
{
    "body": "**Changing commit** from \"[289b1629ab8e93a65249176f893f0dd54ae2111d](https://github.com/sagemath/sagetrac-mirror/commit/289b1629ab8e93a65249176f893f0dd54ae2111d)\" to \"[e38057efbb87ac563350d48a1d34498d49d10403](https://github.com/sagemath/sagetrac-mirror/commit/e38057efbb87ac563350d48a1d34498d49d10403)\".",
    "created_at": "2021-01-14T04:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619919",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[289b1629ab8e93a65249176f893f0dd54ae2111d](https://github.com/sagemath/sagetrac-mirror/commit/289b1629ab8e93a65249176f893f0dd54ae2111d)" to "[e38057efbb87ac563350d48a1d34498d49d10403](https://github.com/sagemath/sagetrac-mirror/commit/e38057efbb87ac563350d48a1d34498d49d10403)".



---

archive/issue_comments_619920.json:
```json
{
    "body": "<a id='comment:13'></a>\nHere's an attempt",
    "created_at": "2021-01-14T04:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619920",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
Here's an attempt



---

archive/issue_comments_619921.json:
```json
{
    "body": "<a id='comment:14'></a>\nLooks plausible, however I don't see exactly, where `-march=native` was added such that this command fails.\n\n```\n            AS_IF([CC=\"$CC\" CXX=\"$CXX\" conftest_venv/bin/python3 conftest.py --verbose build --build-base=conftest.dir >& AS_MESSAGE_LOG_FD 2>&1 ], [\n```\n\nMaybe we need to add `-march=native` yet:\n\n```\n            AS_IF([CC=\"$CC\" CXX=\"$CXX\" CFLAGS=\"-march=native\" CXXFLAGS=\"-march=native\" conftest_venv/bin/python3 conftest.py --verbose build --build-base=conftest.dir >& AS_MESSAGE_LOG_FD 2>&1 ], [\n```\n\nBut I'm just hoping they are respected.",
    "created_at": "2021-01-14T08:15:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619921",
    "user": "https://github.com/kliem"
}
```

<a id='comment:14'></a>
Looks plausible, however I don't see exactly, where `-march=native` was added such that this command fails.

```
            AS_IF([CC="$CC" CXX="$CXX" conftest_venv/bin/python3 conftest.py --verbose build --build-base=conftest.dir >& AS_MESSAGE_LOG_FD 2>&1 ], [
```

Maybe we need to add `-march=native` yet:

```
            AS_IF([CC="$CC" CXX="$CXX" CFLAGS="-march=native" CXXFLAGS="-march=native" conftest_venv/bin/python3 conftest.py --verbose build --build-base=conftest.dir >& AS_MESSAGE_LOG_FD 2>&1 ], [
```

But I'm just hoping they are respected.



---

archive/issue_comments_619922.json:
```json
{
    "body": "<a id='comment:15'></a>\nYes, I meant to add `CFLAGS=\"$CFLAGS_MARCH\"` in these places",
    "created_at": "2021-01-14T17:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619922",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
Yes, I meant to add `CFLAGS="$CFLAGS_MARCH"` in these places



---

archive/issue_comments_619923.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2021-01-15T21:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619923",
    "user": "https://github.com/kliem"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_619924.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built)\" to \"[u/gh-kliem/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built)\".",
    "created_at": "2021-01-15T21:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619924",
    "user": "https://github.com/kliem"
}
```

**Changing branch** from "[u/mkoeppe/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built)" to "[u/gh-kliem/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built)".



---

archive/issue_comments_619925.json:
```json
{
    "body": "<a id='comment:16'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a86a18f345a1c98411aa05254bff58ac02c3180\">3a86a18</a></td><td><code>add CFLAGS and CXXFLAGS</code></td></tr></table>\n",
    "created_at": "2021-01-15T21:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619925",
    "user": "https://github.com/kliem"
}
```

<a id='comment:16'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a86a18f345a1c98411aa05254bff58ac02c3180">3a86a18</a></td><td><code>add CFLAGS and CXXFLAGS</code></td></tr></table>




---

archive/issue_comments_619926.json:
```json
{
    "body": "**Changing commit** from \"[e38057efbb87ac563350d48a1d34498d49d10403](https://github.com/sagemath/sagetrac-mirror/commit/e38057efbb87ac563350d48a1d34498d49d10403)\" to \"[3a86a18f345a1c98411aa05254bff58ac02c3180](https://github.com/sagemath/sagetrac-mirror/commit/3a86a18f345a1c98411aa05254bff58ac02c3180)\".",
    "created_at": "2021-01-15T21:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619926",
    "user": "https://github.com/kliem"
}
```

**Changing commit** from "[e38057efbb87ac563350d48a1d34498d49d10403](https://github.com/sagemath/sagetrac-mirror/commit/e38057efbb87ac563350d48a1d34498d49d10403)" to "[3a86a18f345a1c98411aa05254bff58ac02c3180](https://github.com/sagemath/sagetrac-mirror/commit/3a86a18f345a1c98411aa05254bff58ac02c3180)".



---

archive/issue_comments_619927.json:
```json
{
    "body": "<a id='comment:17'></a>\nOn homebrew, this will have to be tested together with #31227 if a current XCode version is in use",
    "created_at": "2021-01-16T04:21:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619927",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
On homebrew, this will have to be tested together with #31227 if a current XCode version is in use



---

archive/issue_comments_619928.json:
```json
{
    "body": "<a id='comment:18'></a>\nThere is a merge conflict with #31227.\n\nDoes the problem show up during github workflows? (If so, I can fix the merge conflict and test whether the problem goes away.)",
    "created_at": "2021-01-16T08:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619928",
    "user": "https://github.com/kliem"
}
```

<a id='comment:18'></a>
There is a merge conflict with #31227.

Does the problem show up during github workflows? (If so, I can fix the merge conflict and test whether the problem goes away.)



---

archive/issue_events_091938.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31228#event-91938"
}
```



---

archive/issue_comments_619929.json:
```json
{
    "body": "<a id='comment:19'></a>\nIt showed up when I tried in on my local machine. \nBut now I think the observed failures are actually caused by some outdated code in install scripts of some packages, which explicitly set `CC=clang` - see #30725.",
    "created_at": "2021-01-16T17:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619929",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
It showed up when I tried in on my local machine. 
But now I think the observed failures are actually caused by some outdated code in install scripts of some packages, which explicitly set `CC=clang` - see #30725.



---

archive/issue_comments_619930.json:
```json
{
    "body": "<a id='comment:20'></a>\nInstead of disabling `-march=native` alltogether, one might get away with just disabling it in `sdh_pip_install`.",
    "created_at": "2021-01-22T22:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619930",
    "user": "https://github.com/kliem"
}
```

<a id='comment:20'></a>
Instead of disabling `-march=native` alltogether, one might get away with just disabling it in `sdh_pip_install`.



---

archive/issue_comments_619931.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2021-01-23T04:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619931",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_619932.json:
```json
{
    "body": "<a id='comment:21'></a>\nI prefer the easy solution as currently implemented, see comment 7 above",
    "created_at": "2021-01-23T04:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619932",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
I prefer the easy solution as currently implemented, see comment 7 above



---

archive/issue_comments_619933.json:
```json
{
    "body": "**Changing branch** from \"[u/gh-kliem/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built)\" to \"[u/mkoeppe/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built)\".",
    "created_at": "2021-01-23T04:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619933",
    "user": "https://github.com/mkoeppe"
}
```

**Changing branch** from "[u/gh-kliem/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built)" to "[u/mkoeppe/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built)".



---

archive/issue_comments_619934.json:
```json
{
    "body": "**Changing commit** from \"[3a86a18f345a1c98411aa05254bff58ac02c3180](https://github.com/sagemath/sagetrac-mirror/commit/3a86a18f345a1c98411aa05254bff58ac02c3180)\" to \"[09b03d2dbf209d705cb882edd5987d9096cb80ef](https://github.com/sagemath/sagetrac-mirror/commit/09b03d2dbf209d705cb882edd5987d9096cb80ef)\".",
    "created_at": "2021-01-23T04:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619934",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3a86a18f345a1c98411aa05254bff58ac02c3180](https://github.com/sagemath/sagetrac-mirror/commit/3a86a18f345a1c98411aa05254bff58ac02c3180)" to "[09b03d2dbf209d705cb882edd5987d9096cb80ef](https://github.com/sagemath/sagetrac-mirror/commit/09b03d2dbf209d705cb882edd5987d9096cb80ef)".



---

archive/issue_comments_619935.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/02c268457164b76ddd97bece691111725dddf6c0\">02c2684</a></td><td><code>R is already compiled without -march=native</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/24b4fcca7179e0b857d3599d7ccf086e37c1d464\">24b4fcc</a></td><td><code>set EXTRACFLAGS instead of CFLAGS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/44be9671b85348db09046fa0c720812bfe7393a1\">44be967</a></td><td><code>make code a bit more stable against future changes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f56e65e25f23e69aee0d37080c046d36d7f349ed\">f56e65e</a></td><td><code>fix CFLAGS for python3/spkg-build.in by running testcflags.sh after determination of the compiler</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/09b03d2dbf209d705cb882edd5987d9096cb80ef\">09b03d2</a></td><td><code>Merge branch 'u/gh-kliem/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_' of git://trac.sagemath.org/sage into t/31228/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built</code></td></tr></table>\n",
    "created_at": "2021-01-23T04:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619935",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/02c268457164b76ddd97bece691111725dddf6c0">02c2684</a></td><td><code>R is already compiled without -march=native</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/24b4fcca7179e0b857d3599d7ccf086e37c1d464">24b4fcc</a></td><td><code>set EXTRACFLAGS instead of CFLAGS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/44be9671b85348db09046fa0c720812bfe7393a1">44be967</a></td><td><code>make code a bit more stable against future changes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f56e65e25f23e69aee0d37080c046d36d7f349ed">f56e65e</a></td><td><code>fix CFLAGS for python3/spkg-build.in by running testcflags.sh after determination of the compiler</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/09b03d2dbf209d705cb882edd5987d9096cb80ef">09b03d2</a></td><td><code>Merge branch 'u/gh-kliem/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_' of git://trac.sagemath.org/sage into t/31228/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built</code></td></tr></table>




---

archive/issue_comments_619936.json:
```json
{
    "body": "**Changing dependencies** from \"#31132\" to \"#31132, #30725\".",
    "created_at": "2021-01-23T04:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619936",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#31132" to "#31132, #30725".



---

archive/issue_comments_619937.json:
```json
{
    "body": "<a id='comment:26'></a>\nUpgrading this to blocker, because this ticket is needed to get cython installation to work again (when python uses clang instead of gcc):\n\nhttps://trac.sagemath.org/ticket/30725#comment:50",
    "created_at": "2021-01-23T10:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619937",
    "user": "https://github.com/kliem"
}
```

<a id='comment:26'></a>
Upgrading this to blocker, because this ticket is needed to get cython installation to work again (when python uses clang instead of gcc):

https://trac.sagemath.org/ticket/30725#comment:50



---

archive/issue_comments_619938.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [gh-kliem](#comment%3A16):\n> New commits:\n> |                                                                                                                                          |                         |\n> |------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|\n> |[3a86a18](https://github.com/sagemath/sagetrac-mirror/commit/3a86a18f345a1c98411aa05254bff58ac02c3180)|`add CFLAGS and CXXFLAGS`|\n\n\nI think this commit is needed, isn't it?",
    "created_at": "2021-01-23T10:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619938",
    "user": "https://github.com/kliem"
}
```

<a id='comment:27'></a>
Replying to [gh-kliem](#comment%3A16):
> New commits:
> |                                                                                                                                          |                         |
> |------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|
> |[3a86a18](https://github.com/sagemath/sagetrac-mirror/commit/3a86a18f345a1c98411aa05254bff58ac02c3180)|`add CFLAGS and CXXFLAGS`|


I think this commit is needed, isn't it?



---

archive/issue_comments_619939.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2021-01-23T10:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619939",
    "user": "https://github.com/kliem"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_619940.json:
```json
{
    "body": "**Reviewer:** Jonathan Kliem, https://github.com/kliem/sage/pull/35/checks",
    "created_at": "2021-01-23T10:39:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619940",
    "user": "https://github.com/kliem"
}
```

**Reviewer:** Jonathan Kliem, https://github.com/kliem/sage/pull/35/checks



---

archive/issue_comments_619941.json:
```json
{
    "body": "<a id='comment:29'></a>\nI just started github actions along with commit `3a86a18f345a1c98411aa05254bff58ac02c3180`.\n\nPlease tell me, if I need to pull other tickets yet as mentioned in:\n\nhttps://trac.sagemath.org/ticket/30725#comment:42\n\nBtw, I personally would find it useful, those tickets needed to fix github actions on top of the current beta are collected somewhere.",
    "created_at": "2021-01-23T10:39:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619941",
    "user": "https://github.com/kliem"
}
```

<a id='comment:29'></a>
I just started github actions along with commit `3a86a18f345a1c98411aa05254bff58ac02c3180`.

Please tell me, if I need to pull other tickets yet as mentioned in:

https://trac.sagemath.org/ticket/30725#comment:42

Btw, I personally would find it useful, those tickets needed to fix github actions on top of the current beta are collected somewhere.



---

archive/issue_comments_619942.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [gh-kliem](#comment%3A27):\n> Replying to [gh-kliem](#comment%3A16):\n> > New commits:\n> > |                                                                                                                                          |                         |\n> > |------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|\n> > |[3a86a18](https://github.com/sagemath/sagetrac-mirror/commit/3a86a18f345a1c98411aa05254bff58ac02c3180)|`add CFLAGS and CXXFLAGS`|\n\n> \n> I think this commit is needed, isn't it?\n\n\nRight, something like this. I'll try to dig out the commits that I was using",
    "created_at": "2021-01-23T18:35:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619942",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
Replying to [gh-kliem](#comment%3A27):
> Replying to [gh-kliem](#comment%3A16):
> > New commits:
> > |                                                                                                                                          |                         |
> > |------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|
> > |[3a86a18](https://github.com/sagemath/sagetrac-mirror/commit/3a86a18f345a1c98411aa05254bff58ac02c3180)|`add CFLAGS and CXXFLAGS`|

> 
> I think this commit is needed, isn't it?


Right, something like this. I'll try to dig out the commits that I was using



---

archive/issue_comments_619943.json:
```json
{
    "body": "<a id='comment:31'></a>\nI have pushed the branch to #31227. Maybe we can skip the present ticket and do everything in #31227.",
    "created_at": "2021-01-23T20:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619943",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
I have pushed the branch to #31227. Maybe we can skip the present ticket and do everything in #31227.



---

archive/issue_events_091939.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-25T19:21:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31228#event-91939"
}
```



---

archive/issue_comments_619944.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-01-25T19:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619944",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_619945.json:
```json
{
    "body": "**Changing author** from \"Matthias Koeppe\" to \"\".",
    "created_at": "2021-01-25T19:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619945",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "Matthias Koeppe" to "".



---

archive/issue_comments_619946.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built)\" to \"\".",
    "created_at": "2021-01-25T21:28:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619946",
    "user": "https://github.com/kliem"
}
```

**Changing branch** from "[u/mkoeppe/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/the___march_native__flag_vs__the_compiler_used_when_python_extensions_are_built)" to "".



---

archive/issue_comments_619947.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-01-25T21:28:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619947",
    "user": "https://github.com/kliem"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_619948.json:
```json
{
    "body": "**Changing dependencies** from \"#31132, #30725\" to \"#3113, #30725\".",
    "created_at": "2021-01-25T21:28:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619948",
    "user": "https://github.com/kliem"
}
```

**Changing dependencies** from "#31132, #30725" to "#3113, #30725".



---

archive/issue_comments_619949.json:
```json
{
    "body": "**Changing reviewer** from \"Jonathan Kliem, https://github.com/kliem/sage/pull/35/checks\" to \"Jonathan Kliem\".",
    "created_at": "2021-01-25T21:28:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619949",
    "user": "https://github.com/kliem"
}
```

**Changing reviewer** from "Jonathan Kliem, https://github.com/kliem/sage/pull/35/checks" to "Jonathan Kliem".



---

archive/issue_comments_619950.json:
```json
{
    "body": "**Changing commit** from \"[09b03d2dbf209d705cb882edd5987d9096cb80ef](https://github.com/sagemath/sagetrac-mirror/commit/09b03d2dbf209d705cb882edd5987d9096cb80ef)\" to \"\".",
    "created_at": "2021-01-25T21:28:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619950",
    "user": "https://github.com/kliem"
}
```

**Changing commit** from "[09b03d2dbf209d705cb882edd5987d9096cb80ef](https://github.com/sagemath/sagetrac-mirror/commit/09b03d2dbf209d705cb882edd5987d9096cb80ef)" to "".



---

archive/issue_comments_619951.json:
```json
{
    "body": "<a id='comment:33'></a>\nAgreed.",
    "created_at": "2021-01-25T21:28:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619951",
    "user": "https://github.com/kliem"
}
```

<a id='comment:33'></a>
Agreed.



---

archive/issue_events_091940.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-26T20:28:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31228#event-91940"
}
```



---

archive/issue_comments_619952.json:
```json
{
    "body": "**Resolution:** invalid",
    "created_at": "2021-03-26T20:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-619952",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** invalid
