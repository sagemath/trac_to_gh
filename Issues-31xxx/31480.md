# Issue 31480: Fix incorrect lazy imports at startup

archive/issues_031243.json:
```json
{
    "assignees": [],
    "body": "Hitting tab completion after\n\n```\nsage: P = polytopes.cube()\nsage: P.f_vector(\n```\n\nexposes incorrect lazy imports. We fix them. This will lead to hard crash of sage in ipython <7.20.0. In #31476 we will downgrade ipython again to recover Python 3.6 support.\n\n\n\nUpgrading ipython would resolve the hard #31373\n\nCC:  @mkoeppe\n\nKeywords: **lazy import, tab completion**\n\nBranch/Commit: **[b713cc1](https://github.com/sagemath/sagetrac-mirror/commit/b713cc1fe9183c4ba559faaabada38cc6de779a0)**\n\nReviewer: **Matthias Koeppe**\n\nAuthor: **Jonathan Kliem**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31480_\n\n",
    "closed_at": "2021-03-14T23:27:16Z",
    "created_at": "2021-03-10T10:00:40Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20interact",
        "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix incorrect lazy imports at startup",
    "type": "issue",
    "updated_at": "2021-03-14T23:27:16Z",
    "url": "https://github.com/sagemath/sage/issues/31480",
    "user": "https://github.com/kliem"
}
```
Hitting tab completion after

```
sage: P = polytopes.cube()
sage: P.f_vector(
```

exposes incorrect lazy imports. We fix them. This will lead to hard crash of sage in ipython <7.20.0. In #31476 we will downgrade ipython again to recover Python 3.6 support.



Upgrading ipython would resolve the hard #31373

CC:  @mkoeppe

Keywords: **lazy import, tab completion**

Branch/Commit: **[b713cc1](https://github.com/sagemath/sagetrac-mirror/commit/b713cc1fe9183c4ba559faaabada38cc6de779a0)**

Reviewer: **Matthias Koeppe**

Author: **Jonathan Kliem**

_Issue created by migration from https://trac.sagemath.org/ticket/31480_





---

archive/issue_events_401710.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-10T10:00:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31480#event-401710"
}
```



---

archive/issue_events_401711.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-10T10:00:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20interact",
    "label_color": "0000ff",
    "label_name": "component: interact",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31480#event-401711"
}
```



---

archive/issue_events_401712.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-10T10:00:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31480#event-401712"
}
```



---

archive/issue_events_401713.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-10T10:00:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31480#event-401713"
}
```



---

archive/issue_comments_508523.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nI decided to move this up to blocker, because it has a super easy and unproblematic fix and it is very annoying when sage crashes hard.",
    "created_at": "2021-03-10T10:02:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31480#issuecomment-508523",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'>Comment 1:</a>
I decided to move this up to blocker, because it has a super easy and unproblematic fix and it is very annoying when sage crashes hard.



---

archive/issue_events_401714.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-10T10:02:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31480#event-401714"
}
```



---

archive/issue_events_401715.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-10T10:03:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31480#event-401715"
}
```



---

archive/issue_events_401716.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-10T10:03:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31480#event-401716"
}
```



---

archive/issue_comments_508524.json:
```json
{
    "body": "Changed commit from **[44cacd2](https://github.com/sagemath/sagetrac-mirror/commit/44cacd27e04015750d97216b9d9dfb9f12538425)** to **[b713cc1](https://github.com/sagemath/sagetrac-mirror/commit/b713cc1fe9183c4ba559faaabada38cc6de779a0)**",
    "created_at": "2021-03-10T10:06:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31480#issuecomment-508524",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[44cacd2](https://github.com/sagemath/sagetrac-mirror/commit/44cacd27e04015750d97216b9d9dfb9f12538425)** to **[b713cc1](https://github.com/sagemath/sagetrac-mirror/commit/b713cc1fe9183c4ba559faaabada38cc6de779a0)**



---

archive/issue_comments_508525.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b713cc1fe9183c4ba559faaabada38cc6de779a0\">b713cc1</a></td><td><code>correct module for lazy import</code></td></tr></table>\n",
    "created_at": "2021-03-10T10:06:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31480#issuecomment-508525",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:3'>Comment 3:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b713cc1fe9183c4ba559faaabada38cc6de779a0">b713cc1</a></td><td><code>correct module for lazy import</code></td></tr></table>




---

archive/issue_events_401717.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-10T10:06:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31480#event-401717"
}
```



---

archive/issue_events_401718.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-10T10:06:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31480#event-401718"
}
```



---

archive/issue_comments_508526.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\n`sage.misc.cython.cython_create_local_so` has been removed.",
    "created_at": "2021-03-10T10:07:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31480#issuecomment-508526",
    "user": "https://github.com/kliem"
}
```

<a id='comment:5'>Comment 5:</a>
`sage.misc.cython.cython_create_local_so` has been removed.



---

archive/issue_events_401719.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-10T18:43:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31480#event-401719"
}
```



---

archive/issue_events_401720.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-10T18:43:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31480#event-401720"
}
```



---

archive/issue_comments_508527.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe**",
    "created_at": "2021-03-10T18:43:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31480#issuecomment-508527",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe**



---

archive/issue_comments_508528.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nThank you. I realized this is much easier (and stable) then an ipython upgrade.",
    "created_at": "2021-03-10T18:45:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31480#issuecomment-508528",
    "user": "https://github.com/kliem"
}
```

<a id='comment:7'>Comment 7:</a>
Thank you. I realized this is much easier (and stable) then an ipython upgrade.



---

archive/issue_comments_508529.json:
```json
{
    "body": "Changed branch from **[u/gh-kliem/fix_lazy_import_at_startup](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/fix_lazy_import_at_startup)** to **[b713cc1](https://github.com/sagemath/sagetrac-mirror/commit/b713cc1fe9183c4ba559faaabada38cc6de779a0)**",
    "created_at": "2021-03-14T23:27:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31480#issuecomment-508529",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gh-kliem/fix_lazy_import_at_startup](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/fix_lazy_import_at_startup)** to **[b713cc1](https://github.com/sagemath/sagetrac-mirror/commit/b713cc1fe9183c4ba559faaabada38cc6de779a0)**



---

archive/issue_events_401721.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-14T23:27:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31480#event-401721"
}
```



---

archive/issue_events_401722.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "070a0d6c6ca020b91e7120225b501ec667996014",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-03-14T23:27:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31480",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31480#event-401722"
}
```
