# Issue 31306: sage.repl: Replace use of SAGE_EXTCODE by importlib.resources

archive/issues_031069.json:
```json
{
    "assignees": [],
    "body": "We eliminate direct reading of files from the package directories of sagelib by using `importlib.resources` (available since python 3.7) \n- `git grep 'SAGE_EXTCODE' src/sage`\n- `git grep '__file__' src/sage`\n\nThis will help make sagelib `zip_safe` (https://setuptools.readthedocs.io/en/latest/userguide/miscellaneous.html#setting-the-zip-safe-flag)\n\nIn this ticket, we take care of `sage.repl`, moving data needed by its doctests from `SAGE_EXTCODE` (= `src/sage/ext_data`) into the package directory. (Thus, we avoid a dependency on support for resources in namespace packages brought by Python 3.10(?) or the backport package `importlib-resources`, see https://github.com/python/importlib_resources/pull/196)\n\nFollow-up tickets will deal with other parts of the library. In the end, the directory `src/sage/ext_data` will be eliminated.\n\nReferences:\n- https://docs.python.org/3/library/importlib.html#module-importlib.resources\n- https://importlib-resources.readthedocs.io/en/latest/migration.html\n- https://importlib-resources.readthedocs.io/en/latest/using.html\n\n\n\nCC:  @tobiasdiez @fchapoton @kiwifb @dimpase @soehms @tscrim\n\nBranch/Commit: **[`d925cd2`](https://github.com/sagemath/sagetrac-mirror/commit/d925cd2f322cf8230a6e9f86bef03ce020fc12bf)**\n\nReviewer: **Dima Pasechnik**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **refactoring**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31306_\n\n",
    "closed_at": "2022-01-31T23:31:37Z",
    "created_at": "2021-01-30T18:16:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/refactoring",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "sage.repl: Replace use of SAGE_EXTCODE by importlib.resources",
    "type": "issue",
    "updated_at": "2022-01-31T23:31:37Z",
    "url": "https://github.com/sagemath/sage/issues/31306",
    "user": "https://github.com/mkoeppe"
}
```
We eliminate direct reading of files from the package directories of sagelib by using `importlib.resources` (available since python 3.7) 
- `git grep 'SAGE_EXTCODE' src/sage`
- `git grep '__file__' src/sage`

This will help make sagelib `zip_safe` (https://setuptools.readthedocs.io/en/latest/userguide/miscellaneous.html#setting-the-zip-safe-flag)

In this ticket, we take care of `sage.repl`, moving data needed by its doctests from `SAGE_EXTCODE` (= `src/sage/ext_data`) into the package directory. (Thus, we avoid a dependency on support for resources in namespace packages brought by Python 3.10(?) or the backport package `importlib-resources`, see https://github.com/python/importlib_resources/pull/196)

Follow-up tickets will deal with other parts of the library. In the end, the directory `src/sage/ext_data` will be eliminated.

References:
- https://docs.python.org/3/library/importlib.html#module-importlib.resources
- https://importlib-resources.readthedocs.io/en/latest/migration.html
- https://importlib-resources.readthedocs.io/en/latest/using.html



CC:  @tobiasdiez @fchapoton @kiwifb @dimpase @soehms @tscrim

Branch/Commit: **[`d925cd2`](https://github.com/sagemath/sagetrac-mirror/commit/d925cd2f322cf8230a6e9f86bef03ce020fc12bf)**

Reviewer: **Dima Pasechnik**

Author: **Matthias Koeppe**

Component: **refactoring**

_Issue created by migration from https://trac.sagemath.org/ticket/31306_





---

archive/issue_events_428333.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-30T18:16:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428333"
}
```



---

archive/issue_events_428334.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-30T18:16:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "label": "https://github.com/sagemath/sage/labels/refactoring",
    "label_color": "696969",
    "label_name": "refactoring",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428334"
}
```



---

archive/issue_events_428335.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-30T18:16:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428335"
}
```



---

archive/issue_events_428336.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-30T18:16:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428336"
}
```



---

archive/issue_events_428337.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:43:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428337"
}
```



---

archive/issue_events_428338.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:43:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428338"
}
```



---

archive/issue_comments_501747.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,8 @@\n-We eliminate direct reading of files from the package directories of sagelib by using `importlib.resources`. \n+We eliminate direct reading of files from the package directories of sagelib by using `importlib.resources` (available since python 3.7) \n - `git grep 'SAGE_EXTCODE' src/sage`\n - `git grep '__file__' src/sage`\n \n This will help make sagelib `zip_safe` (https://setuptools.readthedocs.io/en/latest/userguide/miscellaneous.html#setting-the-zip-safe-flag)\n-\n-(requires python 3.7 (hence the dependency on #30551) or add the backport package `importlib_resources` if we want to support 3.6 - but that does not support resources within native namespace packages)\n \n References:\n - https://docs.python.org/3/library/importlib.html#module-importlib.resources\n``````\n",
    "created_at": "2021-12-06T02:04:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501747",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,8 @@
-We eliminate direct reading of files from the package directories of sagelib by using `importlib.resources`. 
+We eliminate direct reading of files from the package directories of sagelib by using `importlib.resources` (available since python 3.7) 
 - `git grep 'SAGE_EXTCODE' src/sage`
 - `git grep '__file__' src/sage`
 
 This will help make sagelib `zip_safe` (https://setuptools.readthedocs.io/en/latest/userguide/miscellaneous.html#setting-the-zip-safe-flag)
-
-(requires python 3.7 (hence the dependency on #30551) or add the backport package `importlib_resources` if we want to support 3.6 - but that does not support resources within native namespace packages)
 
 References:
 - https://docs.python.org/3/library/importlib.html#module-importlib.resources
``````




---

archive/issue_comments_501748.json:
```json
{
    "body": "Changed dependencies from **#30551** to **#30551, #31386**",
    "created_at": "2021-12-06T02:04:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501748",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30551** to **#30551, #31386**



---

archive/issue_comments_501749.json:
```json
{
    "body": "Branch: **[u/mkoeppe/replace_use_of_sage_extcode_by_importlib_resources](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/replace_use_of_sage_extcode_by_importlib_resources)**",
    "created_at": "2021-12-06T02:57:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501749",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/replace_use_of_sage_extcode_by_importlib_resources](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/replace_use_of_sage_extcode_by_importlib_resources)**



---

archive/issue_comments_501750.json:
```json
{
    "body": "Commit: **[`b2cb173`](https://github.com/sagemath/sagetrac-mirror/commit/b2cb173ba4080b77d80e845313ed0cc325d13e92)**",
    "created_at": "2021-12-06T03:31:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501750",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`b2cb173`](https://github.com/sagemath/sagetrac-mirror/commit/b2cb173ba4080b77d80e845313ed0cc325d13e92)**



---

archive/issue_events_428339.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-06T03:31:03Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "title_is": "sage.repl: Replace use of SAGE_EXTCODE by importlib.resources",
    "title_was": "Replace use of SAGE_EXTCODE by importlib.resources",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428339"
}
```



---

archive/issue_comments_501751.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/77c957f44881baa2f9b9c9a41a94098d9b9a0d7d\"><code>77c957f</code></a></td><td><code>src/doc/en/developer/packaging_sage_library.rst: Put hierarchy section one level higher</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9375ef85a66d83c62fe9658c7e99beff873db651\"><code>9375ef8</code></a></td><td><code>pkgs/sagemath-standard/tox.ini: Use SAGE_VENV or venv symlink to find wheels</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c6fc11169fb777a699b6c0dd7d99c6197eb9a1f9\"><code>c6fc111</code></a></td><td><code>Prettier diagram</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7d6a44ce9551bfcdde44897c9676281028bafbdb\"><code>7d6a44c</code></a></td><td><code>Use :mod: as markup for packages/modules</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f83d424d1270d03643d41c47d697c0931b0627dc\"><code>f83d424</code></a></td><td><code>Improve ABC example</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/817a8d0ccc1b65d7bd2d38b2e4b8bcb572ced84f\"><code>817a8d0</code></a></td><td><code>src/doc/en/developer/packaging_sage_library.rst: More :mod: and :class: markup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b555735c504a86cb0f465afad5daee82db69d77f\"><code>b555735</code></a></td><td><code>src/doc/en/developer/packaging_sage_library.rst: Link to pypi.org and to documentation of packaging metadata</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/81e9c9a2f3ecad50854d98fe541869b64b4ea2f4\"><code>81e9c9a</code></a></td><td><code>Merge #32899</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af47b5f535ba4199128a3575732aaadc92252558\"><code>af47b5f</code></a></td><td><code>Merge #31386</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b2cb173ba4080b77d80e845313ed0cc325d13e92\"><code>b2cb173</code></a></td><td><code>src/sage/repl/rich_output/: Move example files here from src/sage/ext_data, use importlib.resources</code></td></tr></table>\n",
    "created_at": "2021-12-06T03:31:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501751",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:4" align="right">comment:4</div>

Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/77c957f44881baa2f9b9c9a41a94098d9b9a0d7d"><code>77c957f</code></a></td><td><code>src/doc/en/developer/packaging_sage_library.rst: Put hierarchy section one level higher</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9375ef85a66d83c62fe9658c7e99beff873db651"><code>9375ef8</code></a></td><td><code>pkgs/sagemath-standard/tox.ini: Use SAGE_VENV or venv symlink to find wheels</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c6fc11169fb777a699b6c0dd7d99c6197eb9a1f9"><code>c6fc111</code></a></td><td><code>Prettier diagram</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7d6a44ce9551bfcdde44897c9676281028bafbdb"><code>7d6a44c</code></a></td><td><code>Use :mod: as markup for packages/modules</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f83d424d1270d03643d41c47d697c0931b0627dc"><code>f83d424</code></a></td><td><code>Improve ABC example</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/817a8d0ccc1b65d7bd2d38b2e4b8bcb572ced84f"><code>817a8d0</code></a></td><td><code>src/doc/en/developer/packaging_sage_library.rst: More :mod: and :class: markup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b555735c504a86cb0f465afad5daee82db69d77f"><code>b555735</code></a></td><td><code>src/doc/en/developer/packaging_sage_library.rst: Link to pypi.org and to documentation of packaging metadata</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/81e9c9a2f3ecad50854d98fe541869b64b4ea2f4"><code>81e9c9a</code></a></td><td><code>Merge #32899</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af47b5f535ba4199128a3575732aaadc92252558"><code>af47b5f</code></a></td><td><code>Merge #31386</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b2cb173ba4080b77d80e845313ed0cc325d13e92"><code>b2cb173</code></a></td><td><code>src/sage/repl/rich_output/: Move example files here from src/sage/ext_data, use importlib.resources</code></td></tr></table>




---

archive/issue_comments_501752.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0f63cce4ed14254a74ebf5627f88495db3896576\"><code>0f63cce</code></a></td><td><code>src/sage/repl/display/formatter.py: Replace use of SAGE_EXTCODE in doctest by importlib.resources</code></td></tr></table>\n",
    "created_at": "2021-12-06T03:55:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501752",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0f63cce4ed14254a74ebf5627f88495db3896576"><code>0f63cce</code></a></td><td><code>src/sage/repl/display/formatter.py: Replace use of SAGE_EXTCODE in doctest by importlib.resources</code></td></tr></table>




---

archive/issue_comments_501753.json:
```json
{
    "body": "Changed commit from **[`b2cb173`](https://github.com/sagemath/sagetrac-mirror/commit/b2cb173ba4080b77d80e845313ed0cc325d13e92)** to **[`0f63cce`](https://github.com/sagemath/sagetrac-mirror/commit/0f63cce4ed14254a74ebf5627f88495db3896576)**",
    "created_at": "2021-12-06T03:55:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501753",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b2cb173`](https://github.com/sagemath/sagetrac-mirror/commit/b2cb173ba4080b77d80e845313ed0cc325d13e92)** to **[`0f63cce`](https://github.com/sagemath/sagetrac-mirror/commit/0f63cce4ed14254a74ebf5627f88495db3896576)**



---

archive/issue_comments_501754.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2021-12-06T03:56:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501754",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_events_428340.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-06T03:56:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428340"
}
```



---

archive/issue_comments_501755.json:
```json
{
    "body": "Changed dependencies from **#30551, #31386** to **#31386**",
    "created_at": "2021-12-06T03:56:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501755",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30551, #31386** to **#31386**



---

archive/issue_comments_501756.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,6 +3,8 @@\n - `git grep '__file__' src/sage`\n \n This will help make sagelib `zip_safe` (https://setuptools.readthedocs.io/en/latest/userguide/miscellaneous.html#setting-the-zip-safe-flag)\n+\n+In this ticket, we take care of `sage.repl`. Follow-up tickets will deal with other parts of the library.\n \n References:\n - https://docs.python.org/3/library/importlib.html#module-importlib.resources\n``````\n",
    "created_at": "2021-12-06T17:58:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501756",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,6 +3,8 @@
 - `git grep '__file__' src/sage`
 
 This will help make sagelib `zip_safe` (https://setuptools.readthedocs.io/en/latest/userguide/miscellaneous.html#setting-the-zip-safe-flag)
+
+In this ticket, we take care of `sage.repl`. Follow-up tickets will deal with other parts of the library.
 
 References:
 - https://docs.python.org/3/library/importlib.html#module-importlib.resources
``````




---

archive/issue_comments_501757.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/09787af8a65445158522c07c8e76b01eacd5fdbe\"><code>09787af</code></a></td><td><code>Merge tag '9.5.beta8' into t/31306/replace_use_of_sage_extcode_by_importlib_resources</code></td></tr></table>\n",
    "created_at": "2021-12-12T18:16:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501757",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/09787af8a65445158522c07c8e76b01eacd5fdbe"><code>09787af</code></a></td><td><code>Merge tag '9.5.beta8' into t/31306/replace_use_of_sage_extcode_by_importlib_resources</code></td></tr></table>




---

archive/issue_comments_501758.json:
```json
{
    "body": "Changed commit from **[`0f63cce`](https://github.com/sagemath/sagetrac-mirror/commit/0f63cce4ed14254a74ebf5627f88495db3896576)** to **[`09787af`](https://github.com/sagemath/sagetrac-mirror/commit/09787af8a65445158522c07c8e76b01eacd5fdbe)**",
    "created_at": "2021-12-12T18:16:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501758",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0f63cce`](https://github.com/sagemath/sagetrac-mirror/commit/0f63cce4ed14254a74ebf5627f88495db3896576)** to **[`09787af`](https://github.com/sagemath/sagetrac-mirror/commit/09787af8a65445158522c07c8e76b01eacd5fdbe)**



---

archive/issue_comments_501759.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,6 +10,6 @@\n - https://docs.python.org/3/library/importlib.html#module-importlib.resources\n - https://importlib-resources.readthedocs.io/en/latest/migration.html\n - https://importlib-resources.readthedocs.io/en/latest/using.html\n+- https://github.com/python/importlib_resources/pull/196 - Add support for resources in namespace packages\n \n \n-\n``````\n",
    "created_at": "2021-12-17T03:36:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501759",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,6 +10,6 @@
 - https://docs.python.org/3/library/importlib.html#module-importlib.resources
 - https://importlib-resources.readthedocs.io/en/latest/migration.html
 - https://importlib-resources.readthedocs.io/en/latest/using.html
+- https://github.com/python/importlib_resources/pull/196 - Add support for resources in namespace packages
 
 
-
``````




---

archive/issue_comments_501760.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,12 +4,13 @@\n \n This will help make sagelib `zip_safe` (https://setuptools.readthedocs.io/en/latest/userguide/miscellaneous.html#setting-the-zip-safe-flag)\n \n-In this ticket, we take care of `sage.repl`. Follow-up tickets will deal with other parts of the library.\n+In this ticket, we take care of `sage.repl`, moving data needed by its doctests from `SAGE_EXTCODE` (= `src/sage/ext_data`) into the package directory. (Thus, we avoid a dependency on support for resources in namespace packages brought by Python 3.10(?) or the backport package `importlib-resources`, see https://github.com/python/importlib_resources/pull/196)\n+\n+Follow-up tickets will deal with other parts of the library. In the end, the directory `src/sage/ext_data` will be eliminated.\n \n References:\n - https://docs.python.org/3/library/importlib.html#module-importlib.resources\n - https://importlib-resources.readthedocs.io/en/latest/migration.html\n - https://importlib-resources.readthedocs.io/en/latest/using.html\n-- https://github.com/python/importlib_resources/pull/196 - Add support for resources in namespace packages\n \n \n``````\n",
    "created_at": "2021-12-17T16:35:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501760",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,12 +4,13 @@
 
 This will help make sagelib `zip_safe` (https://setuptools.readthedocs.io/en/latest/userguide/miscellaneous.html#setting-the-zip-safe-flag)
 
-In this ticket, we take care of `sage.repl`. Follow-up tickets will deal with other parts of the library.
+In this ticket, we take care of `sage.repl`, moving data needed by its doctests from `SAGE_EXTCODE` (= `src/sage/ext_data`) into the package directory. (Thus, we avoid a dependency on support for resources in namespace packages brought by Python 3.10(?) or the backport package `importlib-resources`, see https://github.com/python/importlib_resources/pull/196)
+
+Follow-up tickets will deal with other parts of the library. In the end, the directory `src/sage/ext_data` will be eliminated.
 
 References:
 - https://docs.python.org/3/library/importlib.html#module-importlib.resources
 - https://importlib-resources.readthedocs.io/en/latest/migration.html
 - https://importlib-resources.readthedocs.io/en/latest/using.html
-- https://github.com/python/importlib_resources/pull/196 - Add support for resources in namespace packages
 
 
``````




---

archive/issue_comments_501761.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThe testsuite failures are unrelated",
    "created_at": "2021-12-17T16:37:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501761",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">comment:13</div>

The testsuite failures are unrelated



---

archive/issue_comments_501762.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nlgtm",
    "created_at": "2021-12-18T00:04:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501762",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:14" align="right">comment:14</div>

lgtm



---

archive/issue_events_428341.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-12-18T00:04:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428341"
}
```



---

archive/issue_events_428342.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-12-18T00:04:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428342"
}
```



---

archive/issue_comments_501763.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2021-12-18T00:04:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501763",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_501764.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThanks!",
    "created_at": "2021-12-18T00:57:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501764",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

Thanks!



---

archive/issue_comments_501765.json:
```json
{
    "body": "Changed commit from **[`09787af`](https://github.com/sagemath/sagetrac-mirror/commit/09787af8a65445158522c07c8e76b01eacd5fdbe)** to **[`9873958`](https://github.com/sagemath/sagetrac-mirror/commit/9873958f9f942637116a8742b8a179117c95b20e)**",
    "created_at": "2021-12-23T21:25:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501765",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`09787af`](https://github.com/sagemath/sagetrac-mirror/commit/09787af8a65445158522c07c8e76b01eacd5fdbe)** to **[`9873958`](https://github.com/sagemath/sagetrac-mirror/commit/9873958f9f942637116a8742b8a179117c95b20e)**



---

archive/issue_comments_501766.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9873958f9f942637116a8742b8a179117c95b20e\"><code>9873958</code></a></td><td><code>Merge tag '9.5.beta9' into t/31306/replace_use_of_sage_extcode_by_importlib_resources</code></td></tr></table>\n",
    "created_at": "2021-12-23T21:25:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501766",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9873958f9f942637116a8742b8a179117c95b20e"><code>9873958</code></a></td><td><code>Merge tag '9.5.beta9' into t/31306/replace_use_of_sage_extcode_by_importlib_resources</code></td></tr></table>




---

archive/issue_events_428343.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2021-12-23T21:25:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428343"
}
```



---

archive/issue_events_428344.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2021-12-23T21:25:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428344"
}
```



---

archive/issue_events_428345.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-23T21:25:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428345"
}
```



---

archive/issue_events_428346.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-23T21:25:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428346"
}
```



---

archive/issue_comments_501767.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\ntrivial merge",
    "created_at": "2021-12-23T21:25:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501767",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">comment:17</div>

trivial merge



---

archive/issue_events_428347.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-10T00:37:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428347"
}
```



---

archive/issue_events_428348.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-10T00:37:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428348"
}
```



---

archive/issue_events_428349.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2022-01-23T01:57:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428349"
}
```



---

archive/issue_events_428350.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2022-01-23T01:57:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428350"
}
```



---

archive/issue_comments_501768.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d925cd2f322cf8230a6e9f86bef03ce020fc12bf\"><code>d925cd2</code></a></td><td><code>Merge tag '9.5.rc3' into t/31306/replace_use_of_sage_extcode_by_importlib_resources</code></td></tr></table>\n",
    "created_at": "2022-01-23T01:57:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501768",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d925cd2f322cf8230a6e9f86bef03ce020fc12bf"><code>d925cd2</code></a></td><td><code>Merge tag '9.5.rc3' into t/31306/replace_use_of_sage_extcode_by_importlib_resources</code></td></tr></table>




---

archive/issue_comments_501769.json:
```json
{
    "body": "Changed commit from **[`9873958`](https://github.com/sagemath/sagetrac-mirror/commit/9873958f9f942637116a8742b8a179117c95b20e)** to **[`d925cd2`](https://github.com/sagemath/sagetrac-mirror/commit/d925cd2f322cf8230a6e9f86bef03ce020fc12bf)**",
    "created_at": "2022-01-23T01:57:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501769",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9873958`](https://github.com/sagemath/sagetrac-mirror/commit/9873958f9f942637116a8742b8a179117c95b20e)** to **[`d925cd2`](https://github.com/sagemath/sagetrac-mirror/commit/d925cd2f322cf8230a6e9f86bef03ce020fc12bf)**



---

archive/issue_comments_501770.json:
```json
{
    "body": "Changed dependencies from **#31386** to none",
    "created_at": "2022-01-23T01:58:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501770",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#31386** to none



---

archive/issue_events_428351.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-23T01:58:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428351"
}
```



---

archive/issue_events_428352.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-23T01:58:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428352"
}
```



---

archive/issue_comments_501771.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nOK, Volker has started merging stuff for 9.6 including this. And I get \n\n```\n$ sage -t --long --random-seed=241985268132368173591124256826068888319 /usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2022-01-31-20-37-00-111581fe.\nUsing --optional=pip,sage\nFeatures to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,graphviz,imagemagick,jupymake,kenzo,latte_int,lrslib,mcqd,meataxe,pandoc,pdf2svg,plantri,pynormaliz,python_igraph,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.groups,sage.plot,sage.rings.number_field,sage.rings.padics,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,sagemath_doc_html,sphinx,tdlib\nDoctesting 1 file.\nsage -t --long --random-seed=241985268132368173591124256826068888319 /usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py\", line 248, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate\nFailed example:\n    backend.validate(dm.types.OutputSceneWavefront.example())\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[15]>\", line 1, in <module>\n        backend.validate(dm.types.OutputSceneWavefront.example())\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_graphics3d.py\", line 354, in example\n        scene_obj = OutputBuffer.from_file(filename)\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 114, in from_file\n        buf._chmod_readonly(buf._filename)\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 146, in _chmod_readonly\n        os.chmod(filename, mode)\n    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example_wavefront_scene.obj'\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py\", line 249, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate\nFailed example:\n    backend.validate(dm.types.OutputSceneCanvas3d.example())\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[16]>\", line 1, in <module>\n        backend.validate(dm.types.OutputSceneCanvas3d.example())\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_graphics3d.py\", line 161, in example\n        return cls(OutputBuffer.from_file(filename))\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 114, in from_file\n        buf._chmod_readonly(buf._filename)\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 146, in _chmod_readonly\n        os.chmod(filename, mode)\n    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example.canvas3d'\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py\", line 250, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate\nFailed example:\n    backend.validate(dm.types.OutputVideoOgg.example())\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[17]>\", line 1, in <module>\n        backend.validate(dm.types.OutputVideoOgg.example())\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_video.py\", line 75, in example\n        return cls(OutputBuffer.from_file(filename),\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 114, in from_file\n        buf._chmod_readonly(buf._filename)\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 146, in _chmod_readonly\n        os.chmod(filename, mode)\n    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example.ogv'\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py\", line 251, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate\nFailed example:\n    backend.validate(dm.types.OutputVideoWebM.example())\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[18]>\", line 1, in <module>\n        backend.validate(dm.types.OutputVideoWebM.example())\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_video.py\", line 75, in example\n        return cls(OutputBuffer.from_file(filename),\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 114, in from_file\n        buf._chmod_readonly(buf._filename)\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 146, in _chmod_readonly\n        os.chmod(filename, mode)\n    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example.webm'\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py\", line 252, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate\nFailed example:\n    backend.validate(dm.types.OutputVideoMp4.example())\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[19]>\", line 1, in <module>\n        backend.validate(dm.types.OutputVideoMp4.example())\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_video.py\", line 75, in example\n        return cls(OutputBuffer.from_file(filename),\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 114, in from_file\n        buf._chmod_readonly(buf._filename)\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 146, in _chmod_readonly\n        os.chmod(filename, mode)\n    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example.mp4'\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py\", line 253, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate\nFailed example:\n    backend.validate(dm.types.OutputVideoFlash.example())\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[20]>\", line 1, in <module>\n        backend.validate(dm.types.OutputVideoFlash.example())\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_video.py\", line 75, in example\n        return cls(OutputBuffer.from_file(filename),\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 114, in from_file\n        buf._chmod_readonly(buf._filename)\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 146, in _chmod_readonly\n        os.chmod(filename, mode)\n    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example.flv'\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py\", line 254, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate\nFailed example:\n    backend.validate(dm.types.OutputVideoMatroska.example())\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[21]>\", line 1, in <module>\n        backend.validate(dm.types.OutputVideoMatroska.example())\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_video.py\", line 75, in example\n        return cls(OutputBuffer.from_file(filename),\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 114, in from_file\n        buf._chmod_readonly(buf._filename)\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 146, in _chmod_readonly\n        os.chmod(filename, mode)\n    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example.mkv'\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py\", line 255, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate\nFailed example:\n    backend.validate(dm.types.OutputVideoAvi.example())\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[22]>\", line 1, in <module>\n        backend.validate(dm.types.OutputVideoAvi.example())\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_video.py\", line 75, in example\n        return cls(OutputBuffer.from_file(filename),\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 114, in from_file\n        buf._chmod_readonly(buf._filename)\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 146, in _chmod_readonly\n        os.chmod(filename, mode)\n    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example.avi'\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py\", line 256, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate\nFailed example:\n    backend.validate(dm.types.OutputVideoWmv.example())\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[23]>\", line 1, in <module>\n        backend.validate(dm.types.OutputVideoWmv.example())\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_video.py\", line 75, in example\n        return cls(OutputBuffer.from_file(filename),\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 114, in from_file\n        buf._chmod_readonly(buf._filename)\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 146, in _chmod_readonly\n        os.chmod(filename, mode)\n    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example.wmv'\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py\", line 257, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate\nFailed example:\n    backend.validate(dm.types.OutputVideoQuicktime.example())\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[24]>\", line 1, in <module>\n        backend.validate(dm.types.OutputVideoQuicktime.example())\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_video.py\", line 75, in example\n        return cls(OutputBuffer.from_file(filename),\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 114, in from_file\n        buf._chmod_readonly(buf._filename)\n      File \"/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py\", line 146, in _chmod_readonly\n        os.chmod(filename, mode)\n    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example.mov'\n**********************************************************************\n```\nAnd it comes down to that block https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/buffer.py#L139 - `chmod` is not done if the file is in the `SAGE_EXTCODE` folder but executed otherwise. Of course all those files have been moved out of `SAGE_EXTCODE`.",
    "created_at": "2022-01-31T08:02:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501771",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:21" align="right">comment:21</div>

OK, Volker has started merging stuff for 9.6 including this. And I get 

```
$ sage -t --long --random-seed=241985268132368173591124256826068888319 /usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py
too many failed tests, not using stored timings
Running doctests with ID 2022-01-31-20-37-00-111581fe.
Using --optional=pip,sage
Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,graphviz,imagemagick,jupymake,kenzo,latte_int,lrslib,mcqd,meataxe,pandoc,pdf2svg,plantri,pynormaliz,python_igraph,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.groups,sage.plot,sage.rings.number_field,sage.rings.padics,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,sagemath_doc_html,sphinx,tdlib
Doctesting 1 file.
sage -t --long --random-seed=241985268132368173591124256826068888319 /usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py", line 248, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate
Failed example:
    backend.validate(dm.types.OutputSceneWavefront.example())
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[15]>", line 1, in <module>
        backend.validate(dm.types.OutputSceneWavefront.example())
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_graphics3d.py", line 354, in example
        scene_obj = OutputBuffer.from_file(filename)
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 114, in from_file
        buf._chmod_readonly(buf._filename)
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 146, in _chmod_readonly
        os.chmod(filename, mode)
    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example_wavefront_scene.obj'
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py", line 249, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate
Failed example:
    backend.validate(dm.types.OutputSceneCanvas3d.example())
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[16]>", line 1, in <module>
        backend.validate(dm.types.OutputSceneCanvas3d.example())
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_graphics3d.py", line 161, in example
        return cls(OutputBuffer.from_file(filename))
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 114, in from_file
        buf._chmod_readonly(buf._filename)
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 146, in _chmod_readonly
        os.chmod(filename, mode)
    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example.canvas3d'
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py", line 250, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate
Failed example:
    backend.validate(dm.types.OutputVideoOgg.example())
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[17]>", line 1, in <module>
        backend.validate(dm.types.OutputVideoOgg.example())
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_video.py", line 75, in example
        return cls(OutputBuffer.from_file(filename),
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 114, in from_file
        buf._chmod_readonly(buf._filename)
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 146, in _chmod_readonly
        os.chmod(filename, mode)
    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example.ogv'
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py", line 251, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate
Failed example:
    backend.validate(dm.types.OutputVideoWebM.example())
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[18]>", line 1, in <module>
        backend.validate(dm.types.OutputVideoWebM.example())
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_video.py", line 75, in example
        return cls(OutputBuffer.from_file(filename),
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 114, in from_file
        buf._chmod_readonly(buf._filename)
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 146, in _chmod_readonly
        os.chmod(filename, mode)
    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example.webm'
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py", line 252, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate
Failed example:
    backend.validate(dm.types.OutputVideoMp4.example())
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[19]>", line 1, in <module>
        backend.validate(dm.types.OutputVideoMp4.example())
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_video.py", line 75, in example
        return cls(OutputBuffer.from_file(filename),
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 114, in from_file
        buf._chmod_readonly(buf._filename)
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 146, in _chmod_readonly
        os.chmod(filename, mode)
    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example.mp4'
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py", line 253, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate
Failed example:
    backend.validate(dm.types.OutputVideoFlash.example())
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[20]>", line 1, in <module>
        backend.validate(dm.types.OutputVideoFlash.example())
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_video.py", line 75, in example
        return cls(OutputBuffer.from_file(filename),
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 114, in from_file
        buf._chmod_readonly(buf._filename)
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 146, in _chmod_readonly
        os.chmod(filename, mode)
    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example.flv'
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py", line 254, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate
Failed example:
    backend.validate(dm.types.OutputVideoMatroska.example())
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[21]>", line 1, in <module>
        backend.validate(dm.types.OutputVideoMatroska.example())
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_video.py", line 75, in example
        return cls(OutputBuffer.from_file(filename),
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 114, in from_file
        buf._chmod_readonly(buf._filename)
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 146, in _chmod_readonly
        os.chmod(filename, mode)
    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example.mkv'
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py", line 255, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate
Failed example:
    backend.validate(dm.types.OutputVideoAvi.example())
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[22]>", line 1, in <module>
        backend.validate(dm.types.OutputVideoAvi.example())
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_video.py", line 75, in example
        return cls(OutputBuffer.from_file(filename),
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 114, in from_file
        buf._chmod_readonly(buf._filename)
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 146, in _chmod_readonly
        os.chmod(filename, mode)
    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example.avi'
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py", line 256, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate
Failed example:
    backend.validate(dm.types.OutputVideoWmv.example())
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[23]>", line 1, in <module>
        backend.validate(dm.types.OutputVideoWmv.example())
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_video.py", line 75, in example
        return cls(OutputBuffer.from_file(filename),
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 114, in from_file
        buf._chmod_readonly(buf._filename)
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 146, in _chmod_readonly
        os.chmod(filename, mode)
    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example.wmv'
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/backend_doctest.py", line 257, in sage.repl.rich_output.backend_doctest.BackendDoctest.validate
Failed example:
    backend.validate(dm.types.OutputVideoQuicktime.example())
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.repl.rich_output.backend_doctest.BackendDoctest.validate[24]>", line 1, in <module>
        backend.validate(dm.types.OutputVideoQuicktime.example())
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/output_video.py", line 75, in example
        return cls(OutputBuffer.from_file(filename),
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 114, in from_file
        buf._chmod_readonly(buf._filename)
      File "/usr/lib/python3.10/site-packages/sage/repl/rich_output/buffer.py", line 146, in _chmod_readonly
        os.chmod(filename, mode)
    PermissionError: [Errno 1] Operation not permitted: '/usr/lib/python3.10/site-packages/sage/repl/rich_output/example.mov'
**********************************************************************
```
And it comes down to that block https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/buffer.py#L139 - `chmod` is not done if the file is in the `SAGE_EXTCODE` folder but executed otherwise. Of course all those files have been moved out of `SAGE_EXTCODE`.



---

archive/issue_comments_501772.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI also have\n\n```\nsage -t --long --random-seed=241985268132368173591124256826068888319 /usr/lib/python3.10/site-packages/sage/repl/rich_output/output_graphics3d.py  # 25 doctests failed\nsage -t --long --random-seed=241985268132368173591124256826068888319 /usr/lib/python3.10/site-packages/sage/repl/rich_output/output_video.py  # 14 doctests failed\n```\nbecause of the same thing. I guess it doesn't fail on user space build because you can safely `chmod` anything.",
    "created_at": "2022-01-31T08:05:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501772",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:22" align="right">comment:22</div>

I also have

```
sage -t --long --random-seed=241985268132368173591124256826068888319 /usr/lib/python3.10/site-packages/sage/repl/rich_output/output_graphics3d.py  # 25 doctests failed
sage -t --long --random-seed=241985268132368173591124256826068888319 /usr/lib/python3.10/site-packages/sage/repl/rich_output/output_video.py  # 14 doctests failed
```
because of the same thing. I guess it doesn't fail on user space build because you can safely `chmod` anything.



---

archive/issue_comments_501773.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nFollow up at #33256.",
    "created_at": "2022-01-31T09:17:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501773",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:23" align="right">comment:23</div>

Follow up at #33256.



---

archive/issue_comments_501774.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nWow, doctesting of `/usr/lib/python3.10/site-packages/sage/`...",
    "created_at": "2022-01-31T12:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501774",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:24" align="right">comment:24</div>

Wow, doctesting of `/usr/lib/python3.10/site-packages/sage/`...



---

archive/issue_comments_501775.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@dimpase](#comment%3A24):\n> Wow, doctesting of `/usr/lib/python3.10/site-packages/sage/`...\n\nIs it the `python3.10` or the `/usr/lib/` that makes you go \"wow\"? I can do the `python3.9` flavor too if you want. I have been doctesting system installed sage and reporting from those tests for the last 10 years so I may be a bit blaz\u00e9 about it.",
    "created_at": "2022-01-31T18:37:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501775",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@dimpase](#comment%3A24):
> Wow, doctesting of `/usr/lib/python3.10/site-packages/sage/`...

Is it the `python3.10` or the `/usr/lib/` that makes you go "wow"? I can do the `python3.9` flavor too if you want. I have been doctesting system installed sage and reporting from those tests for the last 10 years so I may be a bit blazé about it.



---

archive/issue_comments_501776.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nit's about /usr/lib",
    "created_at": "2022-01-31T21:12:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501776",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

it's about /usr/lib



---

archive/issue_comments_501777.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/replace_use_of_sage_extcode_by_importlib_resources](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/replace_use_of_sage_extcode_by_importlib_resources)** to **[`d925cd2`](https://github.com/sagemath/sagetrac-mirror/commit/d925cd2f322cf8230a6e9f86bef03ce020fc12bf)**",
    "created_at": "2022-01-31T23:31:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31306#issuecomment-501777",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/replace_use_of_sage_extcode_by_importlib_resources](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/replace_use_of_sage_extcode_by_importlib_resources)** to **[`d925cd2`](https://github.com/sagemath/sagetrac-mirror/commit/d925cd2f322cf8230a6e9f86bef03ce020fc12bf)**



---

archive/issue_events_428353.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-31T23:31:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428353"
}
```



---

archive/issue_events_428354.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "ddf44d8b4971a33b27f7ceedafc247976a3e6b16",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-01-31T23:31:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31306",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31306#event-428354"
}
```
