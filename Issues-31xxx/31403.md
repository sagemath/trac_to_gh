# Issue 31403: giac: Make cliquer a dependency, libnauty an optional dependency

archive/issues_031166.json:
```json
{
    "assignees": [],
    "body": "giac uses `libnauty` if it finds it, so it should be an optional dependency.\n\nAlso, giac uses `cliquer` if it finds it, see https://groups.google.com/g/sage-release/c/R-8gvElDIUo/m/tHvIEdaQAAAJ\n\nWe add these missing dependencies.\n\nFollow up: if `libnauty` is not configured to be installed (nor present as a system package), then we should disable its use by `giac`. The corresponding test in `giac`'s configure script is not robust - it explicitly checks in `/usr/local`; which may be disabled on macOS using `-isysroot`.\n\n\nCC:  @kiwifb @dimpase @wdjoyner @sagetrac-parisse @jamesjer\n\nComponent: **packages: standard**\n\nAuthor: **Matthias Koeppe**\n\nBranch/Commit: **[`06c4df1`](https://github.com/sagemath/sagetrac-mirror/commit/06c4df159874b6cb8acbfbf77ff9526b788f093a)**\n\nReviewer: **Dima Pasechnik**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31403_\n\n",
    "closed_at": "2022-07-09T22:34:00Z",
    "created_at": "2021-02-16T01:11:24Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "giac: Make cliquer a dependency, libnauty an optional dependency",
    "type": "issue",
    "updated_at": "2022-07-09T22:34:00Z",
    "url": "https://github.com/sagemath/sage/issues/31403",
    "user": "https://github.com/mkoeppe"
}
```
giac uses `libnauty` if it finds it, so it should be an optional dependency.

Also, giac uses `cliquer` if it finds it, see https://groups.google.com/g/sage-release/c/R-8gvElDIUo/m/tHvIEdaQAAAJ

We add these missing dependencies.

Follow up: if `libnauty` is not configured to be installed (nor present as a system package), then we should disable its use by `giac`. The corresponding test in `giac`'s configure script is not robust - it explicitly checks in `/usr/local`; which may be disabled on macOS using `-isysroot`.


CC:  @kiwifb @dimpase @wdjoyner @sagetrac-parisse @jamesjer

Component: **packages: standard**

Author: **Matthias Koeppe**

Branch/Commit: **[`06c4df1`](https://github.com/sagemath/sagetrac-mirror/commit/06c4df159874b6cb8acbfbf77ff9526b788f093a)**

Reviewer: **Dima Pasechnik**

_Issue created by migration from https://trac.sagemath.org/ticket/31403_





---

archive/issue_events_429675.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-16T01:11:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429675"
}
```



---

archive/issue_events_429676.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-16T01:11:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429676"
}
```



---

archive/issue_events_429677.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-16T01:11:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429677"
}
```



---

archive/issue_events_429678.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-16T01:11:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429678"
}
```



---

archive/issue_events_429679.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429679"
}
```



---

archive/issue_events_429680.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429680"
}
```



---

archive/issue_comments_504065.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nSage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504065",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:1" align="right">comment:1</div>

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_429681.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T02:58:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429681"
}
```



---

archive/issue_events_429682.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T02:58:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429682"
}
```



---

archive/issue_events_429683.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429683"
}
```



---

archive/issue_events_429684.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429684"
}
```



---

archive/issue_events_429685.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429685"
}
```



---

archive/issue_events_429686.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429686"
}
```



---

archive/issue_events_429687.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-27T20:20:47Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "title_is": "giac: Make cliquer a dependency, libnauty an optional dependency",
    "title_was": "giac: Make libnauty an optional dependency",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429687"
}
```



---

archive/issue_events_429688.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-27T20:20:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429688"
}
```



---

archive/issue_events_429689.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-27T20:20:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429689"
}
```



---

archive/issue_events_429690.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-27T20:20:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429690"
}
```



---

archive/issue_events_429691.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-27T20:20:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429691"
}
```



---

archive/issue_comments_504066.json:
```json
{
    "body": "Branch: **[u/mkoeppe/giac__make_cliquer_a_dependency__libnauty_an_optional_dependency](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/giac__make_cliquer_a_dependency__libnauty_an_optional_dependency)**",
    "created_at": "2022-04-27T20:53:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504066",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/giac__make_cliquer_a_dependency__libnauty_an_optional_dependency](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/giac__make_cliquer_a_dependency__libnauty_an_optional_dependency)**



---

archive/issue_comments_504067.json:
```json
{
    "body": "Commit: **[`06c4df1`](https://github.com/sagemath/sagetrac-mirror/commit/06c4df159874b6cb8acbfbf77ff9526b788f093a)**",
    "created_at": "2022-04-27T20:53:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504067",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`06c4df1`](https://github.com/sagemath/sagetrac-mirror/commit/06c4df159874b6cb8acbfbf77ff9526b788f093a)**



---

archive/issue_comments_504068.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2022-04-27T20:53:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504068",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_504069.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06c4df159874b6cb8acbfbf77ff9526b788f093a\"><code>06c4df1</code></a></td><td><code>build/pkgs/giac/dependencies: Add cliquer, add libnauty as an optional dep</code></td></tr></table>\n",
    "created_at": "2022-04-27T20:53:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504069",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06c4df159874b6cb8acbfbf77ff9526b788f093a"><code>06c4df1</code></a></td><td><code>build/pkgs/giac/dependencies: Add cliquer, add libnauty as an optional dep</code></td></tr></table>




---

archive/issue_comments_504070.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,8 @@\n giac uses `libnauty` if it finds it, so it should be an optional dependency.\n \n-Also, if `libnauty` is not configured to be installed (nor present as a system package), then we should disable its use by `giac`. The corresponding test in `giac`'s configure script is not robust - it explicitly checks in `/usr/local`; which may be disabled on macOS using `-isysroot`.\n+Also, giac uses `cliquer` if it finds it, see https://groups.google.com/g/sage-release/c/R-8gvElDIUo/m/tHvIEdaQAAAJ\n \n+We add these missing dependencies.\n+\n+Follow up: if `libnauty` is not configured to be installed (nor present as a system package), then we should disable its use by `giac`. The corresponding test in `giac`'s configure script is not robust - it explicitly checks in `/usr/local`; which may be disabled on macOS using `-isysroot`.\n+\n``````\n",
    "created_at": "2022-04-27T20:57:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504070",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,8 @@
 giac uses `libnauty` if it finds it, so it should be an optional dependency.
 
-Also, if `libnauty` is not configured to be installed (nor present as a system package), then we should disable its use by `giac`. The corresponding test in `giac`'s configure script is not robust - it explicitly checks in `/usr/local`; which may be disabled on macOS using `-isysroot`.
+Also, giac uses `cliquer` if it finds it, see https://groups.google.com/g/sage-release/c/R-8gvElDIUo/m/tHvIEdaQAAAJ
 
+We add these missing dependencies.
+
+Follow up: if `libnauty` is not configured to be installed (nor present as a system package), then we should disable its use by `giac`. The corresponding test in `giac`'s configure script is not robust - it explicitly checks in `/usr/local`; which may be disabled on macOS using `-isysroot`.
+
``````




---

archive/issue_events_429692.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-27T21:01:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429692"
}
```



---

archive/issue_comments_504071.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThis is just wrong. `libcliquer` is not a direct dependency of `giac`, it only depends on it through `nauty`.\n\n```\n$ readelf -d /usr/lib64/libgiac.so\n\nDynamic section at offset 0x1377818 contains 42 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libntl.so.43]\n 0x0000000000000001 (NEEDED)             Shared library: [libpari-gmp-tls.so.7]\n 0x0000000000000001 (NEEDED)             Shared library: [libgsl.so.27]\n 0x0000000000000001 (NEEDED)             Shared library: [liblapack.so.3]\n 0x0000000000000001 (NEEDED)             Shared library: [libblas.so.3]\n 0x0000000000000001 (NEEDED)             Shared library: [libnauty.so.2]\n 0x0000000000000001 (NEEDED)             Shared library: [libcurl.so.4]\n 0x0000000000000001 (NEEDED)             Shared library: [libglpk.so.40]\n 0x0000000000000001 (NEEDED)             Shared library: [libpng16.so.16]\n 0x0000000000000001 (NEEDED)             Shared library: [libecm.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [libmpfi.so.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libmpfr.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]\n 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libm.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [ld-linux-x86-64.so.2]\n 0x0000000000000001 (NEEDED)             Shared library: [libgcc_s.so.1]\n 0x000000000000000e (SONAME)             Library soname: [libgiac.so.0]\n```\nNo `libcliquer` above. But\n\n```\n$ readelf -d /usr/lib64/libnauty.so\n\nDynamic section at offset 0x76d08 contains 29 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libcliquer.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [ld-linux-x86-64.so.2]\n 0x000000000000000e (SONAME)             Library soname: [libnauty.so.2]\n```\n`libcliquer` is present here. Of course when you look at `ldd`'s output you see all the libraries that are needed in a transitive fashion, so `libcliquer` shows up there. But `libcliquer` doesn't appear to be directly linked to `libgiac` or `giac` for that matter.",
    "created_at": "2022-04-27T21:03:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504071",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:10" align="right">comment:10</div>

This is just wrong. `libcliquer` is not a direct dependency of `giac`, it only depends on it through `nauty`.

```
$ readelf -d /usr/lib64/libgiac.so

Dynamic section at offset 0x1377818 contains 42 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libntl.so.43]
 0x0000000000000001 (NEEDED)             Shared library: [libpari-gmp-tls.so.7]
 0x0000000000000001 (NEEDED)             Shared library: [libgsl.so.27]
 0x0000000000000001 (NEEDED)             Shared library: [liblapack.so.3]
 0x0000000000000001 (NEEDED)             Shared library: [libblas.so.3]
 0x0000000000000001 (NEEDED)             Shared library: [libnauty.so.2]
 0x0000000000000001 (NEEDED)             Shared library: [libcurl.so.4]
 0x0000000000000001 (NEEDED)             Shared library: [libglpk.so.40]
 0x0000000000000001 (NEEDED)             Shared library: [libpng16.so.16]
 0x0000000000000001 (NEEDED)             Shared library: [libecm.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libmpfi.so.0]
 0x0000000000000001 (NEEDED)             Shared library: [libmpfr.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]
 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libm.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [ld-linux-x86-64.so.2]
 0x0000000000000001 (NEEDED)             Shared library: [libgcc_s.so.1]
 0x000000000000000e (SONAME)             Library soname: [libgiac.so.0]
```
No `libcliquer` above. But

```
$ readelf -d /usr/lib64/libnauty.so

Dynamic section at offset 0x76d08 contains 29 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libcliquer.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [ld-linux-x86-64.so.2]
 0x000000000000000e (SONAME)             Library soname: [libnauty.so.2]
```
`libcliquer` is present here. Of course when you look at `ldd`'s output you see all the libraries that are needed in a transitive fashion, so `libcliquer` shows up there. But `libcliquer` doesn't appear to be directly linked to `libgiac` or `giac` for that matter.



---

archive/issue_comments_504072.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nBut giac's configure script checks for it, as you can see in David's log file - https://06677265663247414541.googlegroups.com/attach/90d611c87bb4/giac-1.6.0.47p3.p0.log?part=0.1&view=1&vt=ANaJVrGLaLydupV_kOaooQ8utUp20bny9N8_ERIh8lxI5JIpJksif7pfvvxlCWp667Mh0l22SddAo_Dtwb0WEJnPhTnzx-6oedhUoxLfNsIYiz-YAzemBrQ",
    "created_at": "2022-04-27T21:05:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504072",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:11" align="right">comment:11</div>

But giac's configure script checks for it, as you can see in David's log file - https://06677265663247414541.googlegroups.com/attach/90d611c87bb4/giac-1.6.0.47p3.p0.log?part=0.1&view=1&vt=ANaJVrGLaLydupV_kOaooQ8utUp20bny9N8_ERIh8lxI5JIpJksif7pfvvxlCWp667Mh0l22SddAo_Dtwb0WEJnPhTnzx-6oedhUoxLfNsIYiz-YAzemBrQ



---

archive/issue_comments_504073.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI am just looking at the configure script for `giac`\n\n```\nAC_CHECK_LIB(cliquer,main) \nAC_CHECK_LIB(nauty,main)\nAC_CHECK_HEADERS(nauty/naututil.h)\n```\nIt is all automagic. I am fairly sure the `libcliquer` detection is there so that when nauty is found the `libcliquer` flags are properly included too. Notice how no headers are checked for `cliquer`, just adding the library for linking.",
    "created_at": "2022-04-27T21:07:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504073",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:12" align="right">comment:12</div>

I am just looking at the configure script for `giac`

```
AC_CHECK_LIB(cliquer,main) 
AC_CHECK_LIB(nauty,main)
AC_CHECK_HEADERS(nauty/naututil.h)
```
It is all automagic. I am fairly sure the `libcliquer` detection is there so that when nauty is found the `libcliquer` flags are properly included too. Notice how no headers are checked for `cliquer`, just adding the library for linking.



---

archive/issue_comments_504074.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAnother point is that the `giac` actively uses `HAVE_LIBNAUTY` in some code but `HAVE_LIBCLIQUER` is only present in configure objects. So `nauty` is optional and `cliquer` is just its dependency.",
    "created_at": "2022-04-27T21:13:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504074",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:13" align="right">comment:13</div>

Another point is that the `giac` actively uses `HAVE_LIBNAUTY` in some code but `HAVE_LIBCLIQUER` is only present in configure objects. So `nauty` is optional and `cliquer` is just its dependency.



---

archive/issue_comments_504075.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nOur nauty package also does not declare a dependency on cliquer. The dependency has to go somewhere",
    "created_at": "2022-04-27T21:28:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504075",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:14" align="right">comment:14</div>

Our nauty package also does not declare a dependency on cliquer. The dependency has to go somewhere



---

archive/issue_comments_504076.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nWe definitely need to add `cliquer` to `nauty` then.",
    "created_at": "2022-04-27T21:32:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504076",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:15" align="right">comment:15</div>

We definitely need to add `cliquer` to `nauty` then.



---

archive/issue_comments_504077.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@kiwifb](#comment%3A13):\n> Another point is that the `giac` actively uses `HAVE_LIBNAUTY` in some code but `HAVE_LIBCLIQUER` is only present in configure objects. So `nauty` is optional and `cliquer` is just its dependency.\n\nThis certainly makes sense, given upstream nauty's inadequate build system.",
    "created_at": "2022-04-27T21:32:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504077",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@kiwifb](#comment%3A13):
> Another point is that the `giac` actively uses `HAVE_LIBNAUTY` in some code but `HAVE_LIBCLIQUER` is only present in configure objects. So `nauty` is optional and `cliquer` is just its dependency.

This certainly makes sense, given upstream nauty's inadequate build system.



---

archive/issue_comments_504078.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@kiwifb](#comment%3A15):\n> We definitely need to add `cliquer` to `nauty` then.\n\nActually it looks like upstream nauty (and thus our package) uses a vendored copy of cliquer.",
    "created_at": "2022-04-27T21:34:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504078",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@kiwifb](#comment%3A15):
> We definitely need to add `cliquer` to `nauty` then.

Actually it looks like upstream nauty (and thus our package) uses a vendored copy of cliquer.



---

archive/issue_comments_504079.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nSo on systems with nauty linking to an unvendored cliquer (Debian?), I think it will be nondeterministic whether the GIAC build picks up our libcliquer or system libcliquer.",
    "created_at": "2022-04-27T21:38:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504079",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

So on systems with nauty linking to an unvendored cliquer (Debian?), I think it will be nondeterministic whether the GIAC build picks up our libcliquer or system libcliquer.



---

archive/issue_comments_504080.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nAdding the dependency will remove this nondeterminism.",
    "created_at": "2022-04-27T21:39:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504080",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

Adding the dependency will remove this nondeterminism.



---

archive/issue_comments_504081.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nYou are posting too fast for me to make coherent answers :) I guess removing the non-deterministic behavior is the best course of action. debian, gentoo, probably fedora and arch, are unvendoring. I don't know about others or anaconda and brew.",
    "created_at": "2022-04-27T21:43:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504081",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:20" align="right">comment:20</div>

You are posting too fast for me to make coherent answers :) I guess removing the non-deterministic behavior is the best course of action. debian, gentoo, probably fedora and arch, are unvendoring. I don't know about others or anaconda and brew.



---

archive/issue_comments_504082.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nSorry - I should take a break",
    "created_at": "2022-04-27T21:47:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504082",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

Sorry - I should take a break



---

archive/issue_comments_504083.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nIt doesn't help that it is 9:50am here and I am in the middle of meetings and trying to help people with my \"day job\" at the same time.",
    "created_at": "2022-04-27T21:50:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504083",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:22" align="right">comment:22</div>

It doesn't help that it is 9:50am here and I am in the middle of meetings and trying to help people with my "day job" at the same time.



---

archive/issue_events_429693.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-28T03:43:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429693"
}
```



---

archive/issue_events_429694.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-28T03:43:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429694"
}
```



---

archive/issue_comments_504084.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThis misses the issue of system-wide nauty, which should only be used if it's linked to libcliquer, no?\nE.g. on Debian stable I see\n\n```\n$ ldd /usr/lib/x86_64-linux-gnu/libnauty.so\n        linux-vdso.so.1 (0x00007ffe223f8000)\n        libcliquer.so.1 => /lib/libcliquer.so.1 (0x00007e4c9cd43000)\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007e4c9cb7e000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007e4c9cfe4000)\n```\nbut apparently this is not the case on Ubuntu 21.",
    "created_at": "2022-04-28T09:16:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504084",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:24" align="right">comment:24</div>

This misses the issue of system-wide nauty, which should only be used if it's linked to libcliquer, no?
E.g. on Debian stable I see

```
$ ldd /usr/lib/x86_64-linux-gnu/libnauty.so
        linux-vdso.so.1 (0x00007ffe223f8000)
        libcliquer.so.1 => /lib/libcliquer.so.1 (0x00007e4c9cd43000)
        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007e4c9cb7e000)
        /lib64/ld-linux-x86-64.so.2 (0x00007e4c9cfe4000)
```
but apparently this is not the case on Ubuntu 21.



---

archive/issue_comments_504085.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nIf ubuntu 21 uses a vendored version of cliquer, it doesn't have to be linked to an external library.\n\nThat's one of the issue we have here. Some distribution will use external cliquer while some other will not. That's why the branch is just going with \"let's just make sure it is always present\".",
    "created_at": "2022-04-28T09:20:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504085",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:25" align="right">comment:25</div>

If ubuntu 21 uses a vendored version of cliquer, it doesn't have to be linked to an external library.

That's one of the issue we have here. Some distribution will use external cliquer while some other will not. That's why the branch is just going with "let's just make sure it is always present".



---

archive/issue_comments_504086.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@kiwifb](#comment%3A25):\n> If ubuntu 21 uses a vendored version of cliquer, it doesn't have to be linked to an external library.\n\nHuh? The problem is that nauty must be linked to libcliquer (vendored or nor), not the other way around.",
    "created_at": "2022-04-28T09:25:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504086",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@kiwifb](#comment%3A25):
> If ubuntu 21 uses a vendored version of cliquer, it doesn't have to be linked to an external library.

Huh? The problem is that nauty must be linked to libcliquer (vendored or nor), not the other way around.



---

archive/issue_comments_504087.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nOK my phrasing may not have been the best. If ubuntu 21's nauty uses a vendored libcliquer - like the sage optional package does - it may not need libcliquer. \n\nIf ubuntu 21's nauty does use an external libcliquer and it isn't installed along nauty then it is a bug in that version of ubuntu.",
    "created_at": "2022-04-28T09:28:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504087",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:27" align="right">comment:27</div>

OK my phrasing may not have been the best. If ubuntu 21's nauty uses a vendored libcliquer - like the sage optional package does - it may not need libcliquer. 

If ubuntu 21's nauty does use an external libcliquer and it isn't installed along nauty then it is a bug in that version of ubuntu.



---

archive/issue_comments_504088.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@kiwifb](#comment%3A27):\n> OK my phrasing may not have been the best. If ubuntu 21's nauty uses a vendored libcliquer - like the sage optional package does - it may not need libcliquer. \n\nIf it used a vendored libcliquer we won't be seeing this bug reported.\nAccording to https://ubuntu.pkgs.org/21.10/ubuntu-universe-amd64/libnauty2_2.7r1+ds-2_amd64.deb.html `libcliquer` is \"Required\".\n\n\n> \n> If ubuntu 21's nauty does use an external libcliquer and it isn't installed along nauty then it is a bug in that version of ubuntu.\n\ncc-ing Fedora's people.",
    "created_at": "2022-04-28T09:47:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504088",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@kiwifb](#comment%3A27):
> OK my phrasing may not have been the best. If ubuntu 21's nauty uses a vendored libcliquer - like the sage optional package does - it may not need libcliquer. 

If it used a vendored libcliquer we won't be seeing this bug reported.
According to https://ubuntu.pkgs.org/21.10/ubuntu-universe-amd64/libnauty2_2.7r1+ds-2_amd64.deb.html `libcliquer` is "Required".


> 
> If ubuntu 21's nauty does use an external libcliquer and it isn't installed along nauty then it is a bug in that version of ubuntu.

cc-ing Fedora's people.



---

archive/issue_events_429695.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429695"
}
```



---

archive/issue_events_429696.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429696"
}
```



---

archive/issue_comments_504089.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nhttps://groups.google.com/g/sage-support/c/YfyNeyKupH4",
    "created_at": "2022-07-07T20:06:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504089",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">comment:30</div>

https://groups.google.com/g/sage-support/c/YfyNeyKupH4



---

archive/issue_comments_504090.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nlgtm",
    "created_at": "2022-07-08T12:17:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504090",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:31" align="right">comment:31</div>

lgtm



---

archive/issue_comments_504091.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2022-07-08T12:17:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504091",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_events_429697.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-07-08T12:17:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429697"
}
```



---

archive/issue_events_429698.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-07-08T12:17:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429698"
}
```



---

archive/issue_comments_504092.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nThanks!",
    "created_at": "2022-07-08T18:14:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504092",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

Thanks!



---

archive/issue_comments_504093.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/giac__make_cliquer_a_dependency__libnauty_an_optional_dependency](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/giac__make_cliquer_a_dependency__libnauty_an_optional_dependency)** to **[`06c4df1`](https://github.com/sagemath/sagetrac-mirror/commit/06c4df159874b6cb8acbfbf77ff9526b788f093a)**",
    "created_at": "2022-07-09T22:34:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31403#issuecomment-504093",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/giac__make_cliquer_a_dependency__libnauty_an_optional_dependency](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/giac__make_cliquer_a_dependency__libnauty_an_optional_dependency)** to **[`06c4df1`](https://github.com/sagemath/sagetrac-mirror/commit/06c4df159874b6cb8acbfbf77ff9526b788f093a)**



---

archive/issue_events_429699.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-07-09T22:34:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429699"
}
```



---

archive/issue_events_429700.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "55d05c97cb4f64af83d0a978526adec8bf0cc6eb",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-07-09T22:34:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31403",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31403#event-429700"
}
```
