# Issue 31403: giac: Make cliquer a dependency, libnauty an optional dependency

archive/issues_031166.json:
```json
{
    "body": "giac uses `libnauty` if it finds it, so it should be an optional dependency.\n\nAlso, giac uses `cliquer` if it finds it, see https://groups.google.com/g/sage-release/c/R-8gvElDIUo/m/tHvIEdaQAAAJ\n\nWe add these missing dependencies.\n\nFollow up: if `libnauty` is not configured to be installed (nor present as a system package), then we should disable its use by `giac`. The corresponding test in `giac`'s configure script is not robust - it explicitly checks in `/usr/local`; which may be disabled on macOS using `-isysroot`.\n\n\nCC:  @kiwifb @dimpase @wdjoyner parisse @jamesjer\n\nBranch/Commit: [06c4df159874b6cb8acbfbf77ff9526b788f093a](https://github.com/sagemath/sagetrac-mirror/commit/06c4df159874b6cb8acbfbf77ff9526b788f093a)\n\nReviewer: Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31403\n\n",
    "closed_at": "2022-07-09T22:34:00Z",
    "created_at": "2021-02-16T01:11:24Z",
    "labels": [
        "component: packages: standard",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "giac: Make cliquer a dependency, libnauty an optional dependency",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31403",
    "user": "https://github.com/mkoeppe"
}
```
giac uses `libnauty` if it finds it, so it should be an optional dependency.

Also, giac uses `cliquer` if it finds it, see https://groups.google.com/g/sage-release/c/R-8gvElDIUo/m/tHvIEdaQAAAJ

We add these missing dependencies.

Follow up: if `libnauty` is not configured to be installed (nor present as a system package), then we should disable its use by `giac`. The corresponding test in `giac`'s configure script is not robust - it explicitly checks in `/usr/local`; which may be disabled on macOS using `-isysroot`.


CC:  @kiwifb @dimpase @wdjoyner parisse @jamesjer

Branch/Commit: [06c4df159874b6cb8acbfbf77ff9526b788f093a](https://github.com/sagemath/sagetrac-mirror/commit/06c4df159874b6cb8acbfbf77ff9526b788f093a)

Reviewer: Dima Pasechnik

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31403





---

archive/issue_events_092650.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31403#event-92650"
}
```



---

archive/issue_comments_624245.json:
```json
{
    "body": "<a id='comment:1'></a>\nSage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624245",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>
Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_092651.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T02:58:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31403#event-92651"
}
```



---

archive/issue_events_092652.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T02:58:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31403#event-92652"
}
```



---

archive/issue_events_092653.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31403#event-92653"
}
```



---

archive/issue_events_092654.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31403#event-92654"
}
```



---

archive/issue_events_092655.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31403#event-92655"
}
```



---

archive/issue_events_092656.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31403#event-92656"
}
```



---

archive/issue_events_092657.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "rename": {
        "from": "giac: Make libnauty an optional dependency",
        "to": "giac: Make cliquer a dependency, libnauty an optional dependency"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31403#event-92657"
}
```



---

archive/issue_events_092658.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-27T20:20:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31403#event-92658"
}
```



---

archive/issue_events_092659.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-27T20:20:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31403#event-92659"
}
```



---

archive/issue_events_092660.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31403#event-92660"
}
```



---

archive/issue_comments_624246.json:
```json
{
    "body": "Branch: [u/mkoeppe/giac__make_cliquer_a_dependency__libnauty_an_optional_dependency](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/giac__make_cliquer_a_dependency__libnauty_an_optional_dependency)",
    "created_at": "2022-04-27T20:53:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624246",
    "user": "https://github.com/mkoeppe"
}
```

Branch: [u/mkoeppe/giac__make_cliquer_a_dependency__libnauty_an_optional_dependency](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/giac__make_cliquer_a_dependency__libnauty_an_optional_dependency)



---

archive/issue_comments_624247.json:
```json
{
    "body": "Commit: [06c4df159874b6cb8acbfbf77ff9526b788f093a](https://github.com/sagemath/sagetrac-mirror/commit/06c4df159874b6cb8acbfbf77ff9526b788f093a)",
    "created_at": "2022-04-27T20:53:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624247",
    "user": "https://github.com/mkoeppe"
}
```

Commit: [06c4df159874b6cb8acbfbf77ff9526b788f093a](https://github.com/sagemath/sagetrac-mirror/commit/06c4df159874b6cb8acbfbf77ff9526b788f093a)



---

archive/issue_comments_624248.json:
```json
{
    "body": "Author: Matthias Koeppe",
    "created_at": "2022-04-27T20:53:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624248",
    "user": "https://github.com/mkoeppe"
}
```

Author: Matthias Koeppe



---

archive/issue_comments_624249.json:
```json
{
    "body": "<a id='comment:7'></a>\nNew commits:\n|                                                                                                                                          |                                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|\n|[06c4df1](https://github.com/sagemath/sagetrac-mirror/commit/06c4df159874b6cb8acbfbf77ff9526b788f093a)|`build/pkgs/giac/dependencies: Add cliquer, add libnauty as an optional dep`|",
    "created_at": "2022-04-27T20:53:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624249",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
New commits:
|                                                                                                                                          |                                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|
|[06c4df1](https://github.com/sagemath/sagetrac-mirror/commit/06c4df159874b6cb8acbfbf77ff9526b788f093a)|`build/pkgs/giac/dependencies: Add cliquer, add libnauty as an optional dep`|



---

archive/issue_comments_624250.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,8 @@\n giac uses `libnauty` if it finds it, so it should be an optional dependency.\n \n-Also, if `libnauty` is not configured to be installed (nor present as a system package), then we should disable its use by `giac`. The corresponding test in `giac`'s configure script is not robust - it explicitly checks in `/usr/local`; which may be disabled on macOS using `-isysroot`.\n+Also, giac uses `cliquer` if it finds it, see https://groups.google.com/g/sage-release/c/R-8gvElDIUo/m/tHvIEdaQAAAJ\n \n+We add these missing dependencies.\n+\n+Follow up: if `libnauty` is not configured to be installed (nor present as a system package), then we should disable its use by `giac`. The corresponding test in `giac`'s configure script is not robust - it explicitly checks in `/usr/local`; which may be disabled on macOS using `-isysroot`.\n+\n``````\n",
    "created_at": "2022-04-27T20:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624250",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,8 @@
 giac uses `libnauty` if it finds it, so it should be an optional dependency.
 
-Also, if `libnauty` is not configured to be installed (nor present as a system package), then we should disable its use by `giac`. The corresponding test in `giac`'s configure script is not robust - it explicitly checks in `/usr/local`; which may be disabled on macOS using `-isysroot`.
+Also, giac uses `cliquer` if it finds it, see https://groups.google.com/g/sage-release/c/R-8gvElDIUo/m/tHvIEdaQAAAJ
 
+We add these missing dependencies.
+
+Follow up: if `libnauty` is not configured to be installed (nor present as a system package), then we should disable its use by `giac`. The corresponding test in `giac`'s configure script is not robust - it explicitly checks in `/usr/local`; which may be disabled on macOS using `-isysroot`.
+
``````




---

archive/issue_comments_624251.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-04-27T21:01:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624251",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_624252.json:
```json
{
    "body": "<a id='comment:10'></a>\nThis is just wrong. `libcliquer` is not a direct dependency of `giac`, it only depends on it through `nauty`.\n\n```\n$ readelf -d /usr/lib64/libgiac.so\n\nDynamic section at offset 0x1377818 contains 42 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libntl.so.43]\n 0x0000000000000001 (NEEDED)             Shared library: [libpari-gmp-tls.so.7]\n 0x0000000000000001 (NEEDED)             Shared library: [libgsl.so.27]\n 0x0000000000000001 (NEEDED)             Shared library: [liblapack.so.3]\n 0x0000000000000001 (NEEDED)             Shared library: [libblas.so.3]\n 0x0000000000000001 (NEEDED)             Shared library: [libnauty.so.2]\n 0x0000000000000001 (NEEDED)             Shared library: [libcurl.so.4]\n 0x0000000000000001 (NEEDED)             Shared library: [libglpk.so.40]\n 0x0000000000000001 (NEEDED)             Shared library: [libpng16.so.16]\n 0x0000000000000001 (NEEDED)             Shared library: [libecm.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [libmpfi.so.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libmpfr.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]\n 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libm.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [ld-linux-x86-64.so.2]\n 0x0000000000000001 (NEEDED)             Shared library: [libgcc_s.so.1]\n 0x000000000000000e (SONAME)             Library soname: [libgiac.so.0]\n```\nNo `libcliquer` above. But\n\n```\n$ readelf -d /usr/lib64/libnauty.so\n\nDynamic section at offset 0x76d08 contains 29 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libcliquer.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [ld-linux-x86-64.so.2]\n 0x000000000000000e (SONAME)             Library soname: [libnauty.so.2]\n```\n`libcliquer` is present here. Of course when you look at `ldd`'s output you see all the libraries that are needed in a transitive fashion, so `libcliquer` shows up there. But `libcliquer` doesn't appear to be directly linked to `libgiac` or `giac` for that matter.",
    "created_at": "2022-04-27T21:03:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624252",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
This is just wrong. `libcliquer` is not a direct dependency of `giac`, it only depends on it through `nauty`.

```
$ readelf -d /usr/lib64/libgiac.so

Dynamic section at offset 0x1377818 contains 42 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libntl.so.43]
 0x0000000000000001 (NEEDED)             Shared library: [libpari-gmp-tls.so.7]
 0x0000000000000001 (NEEDED)             Shared library: [libgsl.so.27]
 0x0000000000000001 (NEEDED)             Shared library: [liblapack.so.3]
 0x0000000000000001 (NEEDED)             Shared library: [libblas.so.3]
 0x0000000000000001 (NEEDED)             Shared library: [libnauty.so.2]
 0x0000000000000001 (NEEDED)             Shared library: [libcurl.so.4]
 0x0000000000000001 (NEEDED)             Shared library: [libglpk.so.40]
 0x0000000000000001 (NEEDED)             Shared library: [libpng16.so.16]
 0x0000000000000001 (NEEDED)             Shared library: [libecm.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libmpfi.so.0]
 0x0000000000000001 (NEEDED)             Shared library: [libmpfr.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]
 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libm.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [ld-linux-x86-64.so.2]
 0x0000000000000001 (NEEDED)             Shared library: [libgcc_s.so.1]
 0x000000000000000e (SONAME)             Library soname: [libgiac.so.0]
```
No `libcliquer` above. But

```
$ readelf -d /usr/lib64/libnauty.so

Dynamic section at offset 0x76d08 contains 29 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libcliquer.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [ld-linux-x86-64.so.2]
 0x000000000000000e (SONAME)             Library soname: [libnauty.so.2]
```
`libcliquer` is present here. Of course when you look at `ldd`'s output you see all the libraries that are needed in a transitive fashion, so `libcliquer` shows up there. But `libcliquer` doesn't appear to be directly linked to `libgiac` or `giac` for that matter.



---

archive/issue_comments_624253.json:
```json
{
    "body": "<a id='comment:11'></a>\nBut giac's configure script checks for it, as you can see in David's log file - https://06677265663247414541.googlegroups.com/attach/90d611c87bb4/giac-1.6.0.47p3.p0.log?part=0.1&view=1&vt=ANaJVrGLaLydupV_kOaooQ8utUp20bny9N8_ERIh8lxI5JIpJksif7pfvvxlCWp667Mh0l22SddAo_Dtwb0WEJnPhTnzx-6oedhUoxLfNsIYiz-YAzemBrQ",
    "created_at": "2022-04-27T21:05:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624253",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
But giac's configure script checks for it, as you can see in David's log file - https://06677265663247414541.googlegroups.com/attach/90d611c87bb4/giac-1.6.0.47p3.p0.log?part=0.1&view=1&vt=ANaJVrGLaLydupV_kOaooQ8utUp20bny9N8_ERIh8lxI5JIpJksif7pfvvxlCWp667Mh0l22SddAo_Dtwb0WEJnPhTnzx-6oedhUoxLfNsIYiz-YAzemBrQ



---

archive/issue_comments_624254.json:
```json
{
    "body": "<a id='comment:12'></a>\nI am just looking at the configure script for `giac`\n\n```\nAC_CHECK_LIB(cliquer,main) \nAC_CHECK_LIB(nauty,main)\nAC_CHECK_HEADERS(nauty/naututil.h)\n```\nIt is all automagic. I am fairly sure the `libcliquer` detection is there so that when nauty is found the `libcliquer` flags are properly included too. Notice how no headers are checked for `cliquer`, just adding the library for linking.",
    "created_at": "2022-04-27T21:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624254",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>
I am just looking at the configure script for `giac`

```
AC_CHECK_LIB(cliquer,main) 
AC_CHECK_LIB(nauty,main)
AC_CHECK_HEADERS(nauty/naututil.h)
```
It is all automagic. I am fairly sure the `libcliquer` detection is there so that when nauty is found the `libcliquer` flags are properly included too. Notice how no headers are checked for `cliquer`, just adding the library for linking.



---

archive/issue_comments_624255.json:
```json
{
    "body": "<a id='comment:13'></a>\nAnother point is that the `giac` actively uses `HAVE_LIBNAUTY` in some code but `HAVE_LIBCLIQUER` is only present in configure objects. So `nauty` is optional and `cliquer` is just its dependency.",
    "created_at": "2022-04-27T21:13:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624255",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>
Another point is that the `giac` actively uses `HAVE_LIBNAUTY` in some code but `HAVE_LIBCLIQUER` is only present in configure objects. So `nauty` is optional and `cliquer` is just its dependency.



---

archive/issue_comments_624256.json:
```json
{
    "body": "<a id='comment:14'></a>\nOur nauty package also does not declare a dependency on cliquer. The dependency has to go somewhere",
    "created_at": "2022-04-27T21:28:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624256",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
Our nauty package also does not declare a dependency on cliquer. The dependency has to go somewhere



---

archive/issue_comments_624257.json:
```json
{
    "body": "<a id='comment:15'></a>\nWe definitely need to add `cliquer` to `nauty` then.",
    "created_at": "2022-04-27T21:32:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624257",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>
We definitely need to add `cliquer` to `nauty` then.



---

archive/issue_comments_624258.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [fbissey](#comment%3A13):\n> Another point is that the `giac` actively uses `HAVE_LIBNAUTY` in some code but `HAVE_LIBCLIQUER` is only present in configure objects. So `nauty` is optional and `cliquer` is just its dependency.\n\n\nThis certainly makes sense, given upstream nauty's inadequate build system.",
    "created_at": "2022-04-27T21:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624258",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
Replying to [fbissey](#comment%3A13):
> Another point is that the `giac` actively uses `HAVE_LIBNAUTY` in some code but `HAVE_LIBCLIQUER` is only present in configure objects. So `nauty` is optional and `cliquer` is just its dependency.


This certainly makes sense, given upstream nauty's inadequate build system.



---

archive/issue_comments_624259.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [fbissey](#comment%3A15):\n> We definitely need to add `cliquer` to `nauty` then.\n\n\nActually it looks like upstream nauty (and thus our package) uses a vendored copy of cliquer.",
    "created_at": "2022-04-27T21:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624259",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Replying to [fbissey](#comment%3A15):
> We definitely need to add `cliquer` to `nauty` then.


Actually it looks like upstream nauty (and thus our package) uses a vendored copy of cliquer.



---

archive/issue_comments_624260.json:
```json
{
    "body": "<a id='comment:18'></a>\nSo on systems with nauty linking to an unvendored cliquer (Debian?), I think it will be nondeterministic whether the GIAC build picks up our libcliquer or system libcliquer.",
    "created_at": "2022-04-27T21:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624260",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
So on systems with nauty linking to an unvendored cliquer (Debian?), I think it will be nondeterministic whether the GIAC build picks up our libcliquer or system libcliquer.



---

archive/issue_comments_624261.json:
```json
{
    "body": "<a id='comment:19'></a>\nAdding the dependency will remove this nondeterminism.",
    "created_at": "2022-04-27T21:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624261",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
Adding the dependency will remove this nondeterminism.



---

archive/issue_comments_624262.json:
```json
{
    "body": "<a id='comment:20'></a>\nYou are posting too fast for me to make coherent answers :) I guess removing the non-deterministic behavior is the best course of action. debian, gentoo, probably fedora and arch, are unvendoring. I don't know about others or anaconda and brew.",
    "created_at": "2022-04-27T21:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624262",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:20'></a>
You are posting too fast for me to make coherent answers :) I guess removing the non-deterministic behavior is the best course of action. debian, gentoo, probably fedora and arch, are unvendoring. I don't know about others or anaconda and brew.



---

archive/issue_comments_624263.json:
```json
{
    "body": "<a id='comment:21'></a>\nSorry - I should take a break",
    "created_at": "2022-04-27T21:47:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624263",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
Sorry - I should take a break



---

archive/issue_comments_624264.json:
```json
{
    "body": "<a id='comment:22'></a>\nIt doesn't help that it is 9:50am here and I am in the middle of meetings and trying to help people with my \"day job\" at the same time.",
    "created_at": "2022-04-27T21:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624264",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:22'></a>
It doesn't help that it is 9:50am here and I am in the middle of meetings and trying to help people with my "day job" at the same time.



---

archive/issue_events_092661.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31403#event-92661"
}
```



---

archive/issue_comments_624265.json:
```json
{
    "body": "<a id='comment:24'></a>\nThis misses the issue of system-wide nauty, which should only be used if it's linked to libcliquer, no?\nE.g. on Debian stable I see\n\n```\n$ ldd /usr/lib/x86_64-linux-gnu/libnauty.so\n        linux-vdso.so.1 (0x00007ffe223f8000)\n        libcliquer.so.1 => /lib/libcliquer.so.1 (0x00007e4c9cd43000)\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007e4c9cb7e000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007e4c9cfe4000)\n```\nbut apparently this is not the case on Ubuntu 21.",
    "created_at": "2022-04-28T09:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624265",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>
This misses the issue of system-wide nauty, which should only be used if it's linked to libcliquer, no?
E.g. on Debian stable I see

```
$ ldd /usr/lib/x86_64-linux-gnu/libnauty.so
        linux-vdso.so.1 (0x00007ffe223f8000)
        libcliquer.so.1 => /lib/libcliquer.so.1 (0x00007e4c9cd43000)
        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007e4c9cb7e000)
        /lib64/ld-linux-x86-64.so.2 (0x00007e4c9cfe4000)
```
but apparently this is not the case on Ubuntu 21.



---

archive/issue_comments_624266.json:
```json
{
    "body": "<a id='comment:25'></a>\nIf ubuntu 21 uses a vendored version of cliquer, it doesn't have to be linked to an external library.\n\nThat's one of the issue we have here. Some distribution will use external cliquer while some other will not. That's why the branch is just going with \"let's just make sure it is always present\".",
    "created_at": "2022-04-28T09:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624266",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:25'></a>
If ubuntu 21 uses a vendored version of cliquer, it doesn't have to be linked to an external library.

That's one of the issue we have here. Some distribution will use external cliquer while some other will not. That's why the branch is just going with "let's just make sure it is always present".



---

archive/issue_comments_624267.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [fbissey](#comment%3A25):\n> If ubuntu 21 uses a vendored version of cliquer, it doesn't have to be linked to an external library.\n\n\nHuh? The problem is that nauty must be linked to libcliquer (vendored or nor), not the other way around.",
    "created_at": "2022-04-28T09:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624267",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'></a>
Replying to [fbissey](#comment%3A25):
> If ubuntu 21 uses a vendored version of cliquer, it doesn't have to be linked to an external library.


Huh? The problem is that nauty must be linked to libcliquer (vendored or nor), not the other way around.



---

archive/issue_comments_624268.json:
```json
{
    "body": "<a id='comment:27'></a>\nOK my phrasing may not have been the best. If ubuntu 21's nauty uses a vendored libcliquer - like the sage optional package does - it may not need libcliquer. \n\nIf ubuntu 21's nauty does use an external libcliquer and it isn't installed along nauty then it is a bug in that version of ubuntu.",
    "created_at": "2022-04-28T09:28:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624268",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:27'></a>
OK my phrasing may not have been the best. If ubuntu 21's nauty uses a vendored libcliquer - like the sage optional package does - it may not need libcliquer. 

If ubuntu 21's nauty does use an external libcliquer and it isn't installed along nauty then it is a bug in that version of ubuntu.



---

archive/issue_comments_624269.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [fbissey](#comment%3A27):\n> OK my phrasing may not have been the best. If ubuntu 21's nauty uses a vendored libcliquer - like the sage optional package does - it may not need libcliquer. \n\n\nIf it used a vendored libcliquer we won't be seeing this bug reported.\nAccording to https://ubuntu.pkgs.org/21.10/ubuntu-universe-amd64/libnauty2_2.7r1+ds-2_amd64.deb.html `libcliquer` is \"Required\".\n\n\n> \n> If ubuntu 21's nauty does use an external libcliquer and it isn't installed along nauty then it is a bug in that version of ubuntu.\n\n\ncc-ing Fedora's people.",
    "created_at": "2022-04-28T09:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624269",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:28'></a>
Replying to [fbissey](#comment%3A27):
> OK my phrasing may not have been the best. If ubuntu 21's nauty uses a vendored libcliquer - like the sage optional package does - it may not need libcliquer. 


If it used a vendored libcliquer we won't be seeing this bug reported.
According to https://ubuntu.pkgs.org/21.10/ubuntu-universe-amd64/libnauty2_2.7r1+ds-2_amd64.deb.html `libcliquer` is "Required".


> 
> If ubuntu 21's nauty does use an external libcliquer and it isn't installed along nauty then it is a bug in that version of ubuntu.


cc-ing Fedora's people.



---

archive/issue_events_092662.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31403#event-92662"
}
```



---

archive/issue_events_092663.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31403#event-92663"
}
```



---

archive/issue_comments_624270.json:
```json
{
    "body": "<a id='comment:30'></a>\nhttps://groups.google.com/g/sage-support/c/YfyNeyKupH4",
    "created_at": "2022-07-07T20:06:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624270",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
https://groups.google.com/g/sage-support/c/YfyNeyKupH4



---

archive/issue_comments_624271.json:
```json
{
    "body": "<a id='comment:31'></a>\nlgtm",
    "created_at": "2022-07-08T12:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624271",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:31'></a>
lgtm



---

archive/issue_comments_624272.json:
```json
{
    "body": "Reviewer: Dima Pasechnik",
    "created_at": "2022-07-08T12:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624272",
    "user": "https://github.com/dimpase"
}
```

Reviewer: Dima Pasechnik



---

archive/issue_comments_624273.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-07-08T12:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624273",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_624274.json:
```json
{
    "body": "<a id='comment:32'></a>\nThanks!",
    "created_at": "2022-07-08T18:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624274",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>
Thanks!



---

archive/issue_comments_624275.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-07-09T22:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624275",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_624276.json:
```json
{
    "body": "Changing branch from \"[u/mkoeppe/giac__make_cliquer_a_dependency__libnauty_an_optional_dependency](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/giac__make_cliquer_a_dependency__libnauty_an_optional_dependency)\" to \"[06c4df159874b6cb8acbfbf77ff9526b788f093a](https://github.com/sagemath/sagetrac-mirror/commit/06c4df159874b6cb8acbfbf77ff9526b788f093a)\"",
    "created_at": "2022-07-09T22:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31403#issuecomment-624276",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[u/mkoeppe/giac__make_cliquer_a_dependency__libnauty_an_optional_dependency](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/giac__make_cliquer_a_dependency__libnauty_an_optional_dependency)" to "[06c4df159874b6cb8acbfbf77ff9526b788f093a](https://github.com/sagemath/sagetrac-mirror/commit/06c4df159874b6cb8acbfbf77ff9526b788f093a)"



---

archive/issue_events_092664.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-07-09T22:34:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31403",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31403#event-92664"
}
```
