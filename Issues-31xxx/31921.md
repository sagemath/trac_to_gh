# Issue 31921: Knotinfo db interface looks for the wrong python module

archive/issues_031684.json:
```json
{
    "body": "Ticket #30352 included a new optional database and its interface in sage. As all new optional package of this kind, whether to use it or not is detected at runtime by the feature framework.\n\nIn #30352 presence was implemented by looking if the sage interface python module is installed. Which is always true since this interface is shipped in the standard sagelib. Instead it should have searched for the module installed by the `database_knotinfo` package itself.\n\nFurthermore, it sets user writable cache under `SAGE_SHARE` which is a system location for any system wide installation of sage. \n\nThe problem is not clearly visible in vanilla sage as there are no direct consequence for a private user installation. But for system installation or distro installation which are sandboxed, there are consequences as sage will try to create files in system location.\nSee https://github.com/cschwan/sage-on-gentoo/issues/639 for example.\n\nCC:  @soehms @tscrim @antonio-rojas\n\nReviewer: Sebastian Oehms\n\nAuthor: Fran\u00e7ois Bissey\n\nBranch: 99070951e1888e5a0bafd19cd1d88215536b67e3\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31921\n\n",
    "closed_at": "2021-06-19T20:58:49Z",
    "created_at": "2021-06-07T03:55:18Z",
    "labels": [
        "component: packages: optional",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Knotinfo db interface looks for the wrong python module",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31921",
    "user": "https://github.com/kiwifb"
}
```
Ticket #30352 included a new optional database and its interface in sage. As all new optional package of this kind, whether to use it or not is detected at runtime by the feature framework.

In #30352 presence was implemented by looking if the sage interface python module is installed. Which is always true since this interface is shipped in the standard sagelib. Instead it should have searched for the module installed by the `database_knotinfo` package itself.

Furthermore, it sets user writable cache under `SAGE_SHARE` which is a system location for any system wide installation of sage. 

The problem is not clearly visible in vanilla sage as there are no direct consequence for a private user installation. But for system installation or distro installation which are sandboxed, there are consequences as sage will try to create files in system location.
See https://github.com/cschwan/sage-on-gentoo/issues/639 for example.

CC:  @soehms @tscrim @antonio-rojas

Reviewer: Sebastian Oehms

Author: François Bissey

Branch: 99070951e1888e5a0bafd19cd1d88215536b67e3

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31921





---

archive/issue_comments_626883.json:
```json
{
    "body": "<a id='comment:2'></a>\nAttach branch with patch currently tested in sage-on-gentoo. That allows documentation to be built, I am currently running doctests. The next test would be to make sure it behaves properly with the knotinfo package installed.\n\n---\nNew commits:\n|                                                                                                                                          |                                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|\n|[7fe6cf9](https://github.com/sagemath/sagetrac-mirror/commit/7fe6cf9eba3c30bc6157ce3de897eb2f6363cb26)|`Replace PythonModule feature by StaticFile feature.`|",
    "created_at": "2021-06-07T04:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626883",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
Attach branch with patch currently tested in sage-on-gentoo. That allows documentation to be built, I am currently running doctests. The next test would be to make sure it behaves properly with the knotinfo package installed.

---
New commits:
|                                                                                                                                          |                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
|[7fe6cf9](https://github.com/sagemath/sagetrac-mirror/commit/7fe6cf9eba3c30bc6157ce3de897eb2f6363cb26)|`Replace PythonModule feature by StaticFile feature.`|



---

archive/issue_comments_626884.json:
```json
{
    "body": "Changing branch from \"\" to \"u/fbissey/knotinfo_feature\"",
    "created_at": "2021-06-07T04:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626884",
    "user": "https://github.com/kiwifb"
}
```

Changing branch from "" to "u/fbissey/knotinfo_feature"



---

archive/issue_comments_626885.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-07T04:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626885",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_626886.json:
```json
{
    "body": "Changing author from \"\" to \"Fran\u00e7ois Bissey\"",
    "created_at": "2021-06-07T04:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626886",
    "user": "https://github.com/kiwifb"
}
```

Changing author from "" to "François Bissey"



---

archive/issue_comments_626887.json:
```json
{
    "body": "Changing commit from \"\" to \"7fe6cf9eba3c30bc6157ce3de897eb2f6363cb26\"",
    "created_at": "2021-06-07T04:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626887",
    "user": "https://github.com/kiwifb"
}
```

Changing commit from "" to "7fe6cf9eba3c30bc6157ce3de897eb2f6363cb26"



---

archive/issue_comments_626888.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis is not the right fix. The database is provided by a Python package so it should be looked up via import machinery.\n\nJust change:\n\n```\n #!diff\n- PythonModule.__init__(self, 'sage.knots.knotinfo', spkg='database_knotinfo',)\n+ PythonModule.__init__(self, 'database_knotinfo', spkg='database_knotinfo')\n```\n\nand set `self._sobj_path` to something like `database_knotinfo.__file__`",
    "created_at": "2021-06-07T04:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626888",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
This is not the right fix. The database is provided by a Python package so it should be looked up via import machinery.

Just change:

```
 #!diff
- PythonModule.__init__(self, 'sage.knots.knotinfo', spkg='database_knotinfo',)
+ PythonModule.__init__(self, 'database_knotinfo', spkg='database_knotinfo')
```

and set `self._sobj_path` to something like `database_knotinfo.__file__`



---

archive/issue_comments_626889.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [mkoeppe](#comment%3A3):\n> This is not the right fix. The database is provided by a Python package so it should be looked up via import machinery.\n> \n> Just change:\n> \n> ```\n>  #!diff\n> - PythonModule.__init__(self, 'sage.knots.knotinfo', spkg='database_knotinfo',)\n> + PythonModule.__init__(self, 'database_knotinfo', spkg='database_knotinfo')\n> ```\n> \n\n\nI understand, the wrong python module was looked up. Of course you cannot know that without installing the package or reading the ticket very, very, carefully.\n\nI will put up a corrected branch later today.",
    "created_at": "2021-06-07T04:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626889",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>
Replying to [mkoeppe](#comment%3A3):
> This is not the right fix. The database is provided by a Python package so it should be looked up via import machinery.
> 
> Just change:
> 
> ```
>  #!diff
> - PythonModule.__init__(self, 'sage.knots.knotinfo', spkg='database_knotinfo',)
> + PythonModule.__init__(self, 'database_knotinfo', spkg='database_knotinfo')
> ```
> 


I understand, the wrong python module was looked up. Of course you cannot know that without installing the package or reading the ticket very, very, carefully.

I will put up a corrected branch later today.



---

archive/issue_comments_626890.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [mkoeppe](#comment%3A3):\n> and set `self._sobj_path` to something like `database_knotinfo.__file__`\n\n\nPython detail, do you need to import `database_knotinfo` before being able to query that path?",
    "created_at": "2021-06-07T04:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626890",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
Replying to [mkoeppe](#comment%3A3):
> and set `self._sobj_path` to something like `database_knotinfo.__file__`


Python detail, do you need to import `database_knotinfo` before being able to query that path?



---

archive/issue_comments_626891.json:
```json
{
    "body": "<a id='comment:6'></a>\nyes, it needs to be imported",
    "created_at": "2021-06-07T05:00:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626891",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
yes, it needs to be imported



---

archive/issue_comments_626892.json:
```json
{
    "body": "<a id='comment:7'></a>\nHum, I have to package this to make sure I understand, but it looks to me that the current location of `_sobj_path` and what you suggest to do with `.__file__` will be a quite different location. One should go under `site-packages` while the other will be under `share`.",
    "created_at": "2021-06-07T05:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626892",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
Hum, I have to package this to make sure I understand, but it looks to me that the current location of `_sobj_path` and what you suggest to do with `.__file__` will be a quite different location. One should go under `site-packages` while the other will be under `share`.



---

archive/issue_comments_626893.json:
```json
{
    "body": "<a id='comment:8'></a>\nOK, the `_sobj_path` is actually something else. It is a location of a cache that is created from the csv files distributed in the Python package. It's probably best to move this to a different location that is writable by users (somewhere in ~/.sage?)",
    "created_at": "2021-06-07T05:26:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626893",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
OK, the `_sobj_path` is actually something else. It is a location of a cache that is created from the csv files distributed in the Python package. It's probably best to move this to a different location that is writable by users (somewhere in ~/.sage?)



---

archive/issue_comments_626894.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [mkoeppe](#comment%3A8):\n> OK, the `_sobj_path` is actually something else. It is a location of a cache that is created from the csv files distributed in the Python package. It's probably best to move this to a different location that is writable by users (somewhere in ~/.sage?)\n\n\nUnder `~/.sage` should be the default for that kind of things yes. Should we put it in its own subfolder? I don't think it is necessary, as there seems to be only one object.",
    "created_at": "2021-06-07T06:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626894",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
Replying to [mkoeppe](#comment%3A8):
> OK, the `_sobj_path` is actually something else. It is a location of a cache that is created from the csv files distributed in the Python package. It's probably best to move this to a different location that is writable by users (somewhere in ~/.sage?)


Under `~/.sage` should be the default for that kind of things yes. Should we put it in its own subfolder? I don't think it is necessary, as there seems to be only one object.



---

archive/issue_comments_626895.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [fbissey](#comment%3A9):\n> Replying to [mkoeppe](#comment%3A8):\n> > OK, the `_sobj_path` is actually something else. It is a location of a cache that is created from the csv files distributed in the Python package. It's probably best to move this to a different location that is writable by users (somewhere in ~/.sage?)\n\n> \n> Under `~/.sage` should be the default for that kind of things yes. Should we put it in its own subfolder? I don't think it is necessary, as there seems to be only one object.\n\n\nThere are more files, so that should be a separate folder.\n\nSorry for causing this trouble. I already had `SAGE_DB` (`.sage/db`) in mind instead of `SAGE_SHARE` when I did the last change in #30352. But since everything worked fine for me I let it as is.\n\nI can do the tests but maybe not today!",
    "created_at": "2021-06-07T06:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626895",
    "user": "https://github.com/soehms"
}
```

<a id='comment:11'></a>
Replying to [fbissey](#comment%3A9):
> Replying to [mkoeppe](#comment%3A8):
> > OK, the `_sobj_path` is actually something else. It is a location of a cache that is created from the csv files distributed in the Python package. It's probably best to move this to a different location that is writable by users (somewhere in ~/.sage?)

> 
> Under `~/.sage` should be the default for that kind of things yes. Should we put it in its own subfolder? I don't think it is necessary, as there seems to be only one object.


There are more files, so that should be a separate folder.

Sorry for causing this trouble. I already had `SAGE_DB` (`.sage/db`) in mind instead of `SAGE_SHARE` when I did the last change in #30352. But since everything worked fine for me I let it as is.

I can do the tests but maybe not today!



---

archive/issue_comments_626896.json:
```json
{
    "body": "Changing commit from \"7fe6cf9eba3c30bc6157ce3de897eb2f6363cb26\" to \"0091a4e879a1c10e7eb0feb4f0408337ab7ad04f\"",
    "created_at": "2021-06-07T07:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626896",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7fe6cf9eba3c30bc6157ce3de897eb2f6363cb26" to "0091a4e879a1c10e7eb0feb4f0408337ab7ad04f"



---

archive/issue_comments_626897.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|\n|[0091a4e](https://github.com/sagemath/sagetrac-mirror/commit/0091a4e879a1c10e7eb0feb4f0408337ab7ad04f)|`Use PythonModule, but this time the right one`|",
    "created_at": "2021-06-07T07:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626897",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|
|[0091a4e](https://github.com/sagemath/sagetrac-mirror/commit/0091a4e879a1c10e7eb0feb4f0408337ab7ad04f)|`Use PythonModule, but this time the right one`|



---

archive/issue_comments_626898.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-06-07T07:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626898",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_626899.json:
```json
{
    "body": "<a id='comment:13'></a>\nI am now understanding my confusion in full. All the other databases test for `StaticFile` and there was a file defined there in a \"system location\".\n\nI'll add that since it is a user location, it doesn't really belongs to `feature`. Ideally, it would be defined in the package `database_knotinfo` itself. Let's find a location in sage for it for now, but we should keep it in mind next time the package is upgraded.",
    "created_at": "2021-06-07T07:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626899",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>
I am now understanding my confusion in full. All the other databases test for `StaticFile` and there was a file defined there in a "system location".

I'll add that since it is a user location, it doesn't really belongs to `feature`. Ideally, it would be defined in the package `database_knotinfo` itself. Let's find a location in sage for it for now, but we should keep it in mind next time the package is upgraded.



---

archive/issue_comments_626900.json:
```json
{
    "body": "<a id='comment:14'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|\n|[9907095](https://github.com/sagemath/sagetrac-mirror/commit/99070951e1888e5a0bafd19cd1d88215536b67e3)|`Define _sobj_path in knotinfo_db.py itself`|",
    "created_at": "2021-06-07T07:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626900",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|
|[9907095](https://github.com/sagemath/sagetrac-mirror/commit/99070951e1888e5a0bafd19cd1d88215536b67e3)|`Define _sobj_path in knotinfo_db.py itself`|



---

archive/issue_comments_626901.json:
```json
{
    "body": "Changing commit from \"0091a4e879a1c10e7eb0feb4f0408337ab7ad04f\" to \"99070951e1888e5a0bafd19cd1d88215536b67e3\"",
    "created_at": "2021-06-07T07:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626901",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0091a4e879a1c10e7eb0feb4f0408337ab7ad04f" to "99070951e1888e5a0bafd19cd1d88215536b67e3"



---

archive/issue_comments_626902.json:
```json
{
    "body": "<a id='comment:15'></a>\nNeed to rewrite the description but it should be a testable state now.",
    "created_at": "2021-06-07T07:30:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626902",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>
Need to rewrite the description but it should be a testable state now.



---

archive/issue_comments_626903.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-06-07T08:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626903",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_626904.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,8 @@\n Ticket #30352 included a new optional database and its interface in sage. As all new optional package of this kind, whether to use it or not is detected at runtime by the feature framework.\n \n-In #30352 presence was implemented by looking if the sage interface python module is installed. Which is always true since this interface is shipped in the standard sagelib. Instead it should have detected whether the database file was present.\n+In #30352 presence was implemented by looking if the sage interface python module is installed. Which is always true since this interface is shipped in the standard sagelib. Instead it should have searched for the module installed by the `database_knotinfo` package itself.\n \n-The problem is not clearly visible in vanilla sage as there are no direct consequence for a private user installation. But for system installation or distro installation which are sandboxed there are consequences as sage will try to create files in system location.\n+Furthermore, it sets user writable cache under `SAGE_SHARE` which is a system location for any system wide installation of sage. \n+\n+The problem is not clearly visible in vanilla sage as there are no direct consequence for a private user installation. But for system installation or distro installation which are sandboxed, there are consequences as sage will try to create files in system location.\n See https://github.com/cschwan/sage-on-gentoo/issues/639 for example.\n``````\n",
    "created_at": "2021-06-07T08:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626904",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,8 @@
 Ticket #30352 included a new optional database and its interface in sage. As all new optional package of this kind, whether to use it or not is detected at runtime by the feature framework.
 
-In #30352 presence was implemented by looking if the sage interface python module is installed. Which is always true since this interface is shipped in the standard sagelib. Instead it should have detected whether the database file was present.
+In #30352 presence was implemented by looking if the sage interface python module is installed. Which is always true since this interface is shipped in the standard sagelib. Instead it should have searched for the module installed by the `database_knotinfo` package itself.
 
-The problem is not clearly visible in vanilla sage as there are no direct consequence for a private user installation. But for system installation or distro installation which are sandboxed there are consequences as sage will try to create files in system location.
+Furthermore, it sets user writable cache under `SAGE_SHARE` which is a system location for any system wide installation of sage. 
+
+The problem is not clearly visible in vanilla sage as there are no direct consequence for a private user installation. But for system installation or distro installation which are sandboxed, there are consequences as sage will try to create files in system location.
 See https://github.com/cschwan/sage-on-gentoo/issues/639 for example.
``````




---

archive/issue_events_102810.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "rename": {
        "from": "The knotinfo db should use the StaticFile feature, not PythonModule",
        "to": "Knotinfo db interface looks for the wrong python module"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31921#event-102810"
}
```



---

archive/issue_comments_626905.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-07T16:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626905",
    "user": "https://github.com/soehms"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_626906.json:
```json
{
    "body": "<a id='comment:18'></a>\nThe patch looks good to me!\n\nAnother question: It seems that we have a new feature within our doctests, right now, which produces the following failure (independent on this branch):\n\n```bash\nsage -t --random-seed=0 src/sage/databases/knotinfo_db.py\n    [90 tests, 0.06 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 0.2 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.1 seconds\n================================================================================================================================== test session starts ===================================================================================================================================\nplatform linux -- Python 3.9.2, pytest-6.2.4, py-1.10.0, pluggy-0.13.1\nrootdir: /home/sebastian/devel/sage/src, configfile: tox.ini\ncollected 0 items / 1 error\n\n========================================================================================================================================= ERRORS =========================================================================================================================================\n_____________________________________________________________________________________________________________________ ERROR collecting sage/databases/knotinfo_db.py _____________________________________________________________________________________________________________________\nsrc/sage/databases/knotinfo_db.py:330: in <module>\n    class KnotInfoDataBase(SageObject, UniqueRepresentation):\nsage/misc/nested_class.pyx:318: in sage.misc.nested_class.NestedClassMetaclass.__init__ (build/cythonized/sage/misc/nested_class.c:2327)\n    ???\nE   KeyError: 'knotinfo_db'\n================================================================================================================================ short test summary info =================================================================================================================================\nERROR src/sage/databases/knotinfo_db.py - KeyError: 'knotinfo_db'\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n==================================================================================================================================== 1 error in 0.73s ====================================================================================================================================\n```\n\nWhat is the reason for this? How can I fix it? Any hints are welcome!",
    "created_at": "2021-06-07T16:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626906",
    "user": "https://github.com/soehms"
}
```

<a id='comment:18'></a>
The patch looks good to me!

Another question: It seems that we have a new feature within our doctests, right now, which produces the following failure (independent on this branch):

```bash
sage -t --random-seed=0 src/sage/databases/knotinfo_db.py
    [90 tests, 0.06 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 0.2 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.1 seconds
================================================================================================================================== test session starts ===================================================================================================================================
platform linux -- Python 3.9.2, pytest-6.2.4, py-1.10.0, pluggy-0.13.1
rootdir: /home/sebastian/devel/sage/src, configfile: tox.ini
collected 0 items / 1 error

========================================================================================================================================= ERRORS =========================================================================================================================================
_____________________________________________________________________________________________________________________ ERROR collecting sage/databases/knotinfo_db.py _____________________________________________________________________________________________________________________
src/sage/databases/knotinfo_db.py:330: in <module>
    class KnotInfoDataBase(SageObject, UniqueRepresentation):
sage/misc/nested_class.pyx:318: in sage.misc.nested_class.NestedClassMetaclass.__init__ (build/cythonized/sage/misc/nested_class.c:2327)
    ???
E   KeyError: 'knotinfo_db'
================================================================================================================================ short test summary info =================================================================================================================================
ERROR src/sage/databases/knotinfo_db.py - KeyError: 'knotinfo_db'
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
==================================================================================================================================== 1 error in 0.73s ====================================================================================================================================
```

What is the reason for this? How can I fix it? Any hints are welcome!



---

archive/issue_comments_626907.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Sebastian Oehms\"",
    "created_at": "2021-06-07T16:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626907",
    "user": "https://github.com/soehms"
}
```

Changing reviewer from "" to "Sebastian Oehms"



---

archive/issue_comments_626908.json:
```json
{
    "body": "<a id='comment:19'></a>\nI also see this error after installing `pytest`.",
    "created_at": "2021-06-07T17:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626908",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
I also see this error after installing `pytest`.



---

archive/issue_comments_626909.json:
```json
{
    "body": "<a id='comment:20'></a>\nThis defect is not specific to `knotinfo_db`; we will address it in #31924 (sage -t: Do not run pytest on individual files)",
    "created_at": "2021-06-07T18:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626909",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>
This defect is not specific to `knotinfo_db`; we will address it in #31924 (sage -t: Do not run pytest on individual files)



---

archive/issue_comments_626910.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [mkoeppe](#comment%3A20):\n> This defect is not specific to `knotinfo_db`; we will address it in #31924 (sage -t: Do not run pytest on individual files)\n\n\nMany Thanks!",
    "created_at": "2021-06-07T22:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626910",
    "user": "https://github.com/soehms"
}
```

<a id='comment:21'></a>
Replying to [mkoeppe](#comment%3A20):
> This defect is not specific to `knotinfo_db`; we will address it in #31924 (sage -t: Do not run pytest on individual files)


Many Thanks!



---

archive/issue_comments_626911.json:
```json
{
    "body": "Changing branch from \"u/fbissey/knotinfo_feature\" to \"99070951e1888e5a0bafd19cd1d88215536b67e3\"",
    "created_at": "2021-06-19T20:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626911",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/fbissey/knotinfo_feature" to "99070951e1888e5a0bafd19cd1d88215536b67e3"



---

archive/issue_comments_626912.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-06-19T20:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626912",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_102811.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-19T20:58:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31921#event-102811"
}
```



---

archive/issue_comments_626913.json:
```json
{
    "body": "<a id='comment:23'></a>\nThere is another piece of code that should be adapted to the change of file-cache location. I've opened ticket #32099 for that!",
    "created_at": "2021-07-02T16:37:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626913",
    "user": "https://github.com/soehms"
}
```

<a id='comment:23'></a>
There is another piece of code that should be adapted to the change of file-cache location. I've opened ticket #32099 for that!



---

archive/issue_comments_626914.json:
```json
{
    "body": "Changing commit from \"99070951e1888e5a0bafd19cd1d88215536b67e3\" to \"\"",
    "created_at": "2021-07-02T16:37:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-626914",
    "user": "https://github.com/soehms"
}
```

Changing commit from "99070951e1888e5a0bafd19cd1d88215536b67e3" to ""
