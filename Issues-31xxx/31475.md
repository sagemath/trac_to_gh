# Issue 31475: 1 internet doctest failing in src/sage/tests/cmdline.py - ore_algebra version

archive/issues_031238.json:
```json
{
    "body": "CC:  @slel tmonteil @mkauers @mezzarobba\n\nOn Ubuntu 18.04, running `SageMath version 9.3.beta8, Release Date: 2021-03-07`, the command\n\n```\nsage -t --optional=sage,internet src/sage/tests/cmdline.py\n```\ngives\n\n```\nsage -t --warn-long 74.8 --random-seed=0 src/sage/tests/cmdline.py\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 606, in sage.tests.cmdline.test_executable\nFailed example:\n    err  # optional - internet\nExpected:\n    ''\nGot:\n    '/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/misc\n/package.py:114: UserWarning: failed to fetch the version of \npkg=\\'ore_algebra\\' at https://pypi.org/pypi/ore_algebra/json\\n  \nwarnings.warn(\"failed to fetch the version of pkg={!r} at {}\".format(pkg,\n url))\\n'\n**********************************************************************\n1 item had failures:\n   1 of 229 in sage.tests.cmdline.test_executable\n    [228 tests, 1 failure, 28.69 s]\n----------------------------------------------------------------------\nsage -t --warn-long 74.8 --random-seed=0 src/sage/tests/cmdline.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n\nThe complete failing example block is:\n\n```\n        sage: (out, err, ret) = test_executable([\"sage\", \"--optional\"])  # optional - internet\n        sage: out.find(\"database_cremona_ellcurve\") >= 0  # optional - internet\n        True\n        sage: err  # optional - internet\n        ''\n        sage: ret  # optional - internet\n        0\n```\n\nI can reproduce the problem as follows:\n\n```\nsage: from sage.tests.cmdline import test_executable                                                 \nsage: (out, err, ret) = test_executable([\"sage\", \"--optional\"])                                      \nsage: out.find(\"database_cremona_ellcurve\") >= 0                                                     \nTrue\nsage: err                                                                                            \n'/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/misc\n/package.py:114: UserWarning: failed to fetch the version of \npkg=\\'ore_algebra\\' at https://pypi.org/pypi/ore_algebra/json\\n  \nwarnings.warn(\"failed to fetch the version of pkg={!r} at {}\".format(pkg, \nurl))\\n'\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/31475\n\n",
    "created_at": "2021-03-09T16:22:47Z",
    "labels": [
        "component: doctest coverage",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "1 internet doctest failing in src/sage/tests/cmdline.py - ore_algebra version",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31475",
    "user": "https://github.com/seblabbe"
}
```
CC:  @slel tmonteil @mkauers @mezzarobba

On Ubuntu 18.04, running `SageMath version 9.3.beta8, Release Date: 2021-03-07`, the command

```
sage -t --optional=sage,internet src/sage/tests/cmdline.py
```
gives

```
sage -t --warn-long 74.8 --random-seed=0 src/sage/tests/cmdline.py
**********************************************************************
File "src/sage/tests/cmdline.py", line 606, in sage.tests.cmdline.test_executable
Failed example:
    err  # optional - internet
Expected:
    ''
Got:
    '/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/misc
/package.py:114: UserWarning: failed to fetch the version of 
pkg=\'ore_algebra\' at https://pypi.org/pypi/ore_algebra/json\n  
warnings.warn("failed to fetch the version of pkg={!r} at {}".format(pkg,
 url))\n'
**********************************************************************
1 item had failures:
   1 of 229 in sage.tests.cmdline.test_executable
    [228 tests, 1 failure, 28.69 s]
----------------------------------------------------------------------
sage -t --warn-long 74.8 --random-seed=0 src/sage/tests/cmdline.py  # 1 doctest failed
----------------------------------------------------------------------
```

The complete failing example block is:

```
        sage: (out, err, ret) = test_executable(["sage", "--optional"])  # optional - internet
        sage: out.find("database_cremona_ellcurve") >= 0  # optional - internet
        True
        sage: err  # optional - internet
        ''
        sage: ret  # optional - internet
        0
```

I can reproduce the problem as follows:

```
sage: from sage.tests.cmdline import test_executable                                                 
sage: (out, err, ret) = test_executable(["sage", "--optional"])                                      
sage: out.find("database_cremona_ellcurve") >= 0                                                     
True
sage: err                                                                                            
'/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/misc
/package.py:114: UserWarning: failed to fetch the version of 
pkg=\'ore_algebra\' at https://pypi.org/pypi/ore_algebra/json\n  
warnings.warn("failed to fetch the version of pkg={!r} at {}".format(pkg, 
url))\n'
```

Issue created by migration from https://trac.sagemath.org/ticket/31475





---

archive/issue_comments_445980.json:
```json
{
    "body": "Salut Samuel, \u00e7a ressemble \u00e0 du code qu'on avait chang\u00e9 dans un autre ticket. \u00c7a te dit quelque chose?",
    "created_at": "2021-03-09T16:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31475#issuecomment-445980",
    "user": "https://github.com/seblabbe"
}
```

Salut Samuel, ça ressemble à du code qu'on avait changé dans un autre ticket. Ça te dit quelque chose?



---

archive/issue_comments_445981.json:
```json
{
    "body": "This can be fixed by convincing the author of the `ore_algebra` package to make a proper release on PyPI and then updating `build/pkgs/ore_algebra/requirements.txt`",
    "created_at": "2021-03-09T17:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31475#issuecomment-445981",
    "user": "https://github.com/mkoeppe"
}
```

This can be fixed by convincing the author of the `ore_algebra` package to make a proper release on PyPI and then updating `build/pkgs/ore_algebra/requirements.txt`



---

archive/issue_comments_445982.json:
```json
{
    "body": "Replying to [comment:5 mkoeppe]:\n> This can be fixed by convincing the author of the `ore_algebra` package to make a proper release on PyPI and then updating `build/pkgs/ore_algebra/requirements.txt`\n\n\nLet me add them in CC.\n\nWe could also stop assuming that pip installed package come from PyPI, which offers more flexibility to downstream.",
    "created_at": "2021-03-09T18:28:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31475#issuecomment-445982",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Replying to [comment:5 mkoeppe]:
> This can be fixed by convincing the author of the `ore_algebra` package to make a proper release on PyPI and then updating `build/pkgs/ore_algebra/requirements.txt`


Let me add them in CC.

We could also stop assuming that pip installed package come from PyPI, which offers more flexibility to downstream.



---

archive/issue_comments_445983.json:
```json
{
    "body": "Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31475#issuecomment-445983",
    "user": "https://github.com/mkoeppe"
}
```

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_082634.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31475",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31475#event-82634"
}
```



---

archive/issue_events_082635.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31475",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31475#event-82635"
}
```



---

archive/issue_events_082636.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31475",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31475#event-82636"
}
```



---

archive/issue_events_082637.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T20:12:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31475",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31475#event-82637"
}
```



---

archive/issue_events_082638.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T20:12:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31475",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31475#event-82638"
}
```



---

archive/issue_events_082639.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31475",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31475#event-82639"
}
```



---

archive/issue_events_082640.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31475",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31475#event-82640"
}
```



---

archive/issue_events_082641.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31475",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31475#event-82641"
}
```



---

archive/issue_events_082642.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31475",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31475#event-82642"
}
```
