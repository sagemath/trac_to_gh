# Issue 31739: Doctest exp(2*f(x)) with f in {atanh, acoth, asinh, acosh, asech, acsch}

archive/issues_031502.json:
```json
{
    "body": "In Sage 9.3.rc4, we get the incorrect\n\n```\nsage: exp(2*atanh(x))\n(x + 1)/(x - 1)\n```\n\nThe correct answer is (1 + x)/(1 - x) so we expect:\n\n```\nsage: exp(2*atanh(x))\n-(x + 1)/(x - 1)\n```\n\nSimilarly, we get the incorrect\n\n```\nsage: exp(2*acoth(x))\n(x - 1)/(x + 1)\n```\n\nwhile we expect:\n\n```\nsage: exp(2*acoth(x))\n(x + 1)/(x - 1)\n```\n\nThe bug is in Pynac. A fix is provided at\n\n- [Pynac pull request 374: Fix exp of inverse hyperbolic functions](https://github.com/pynac/pynac/pull/374)\n\nThe upgrade to Pynac 0.7.29, which has the change,\nis done in #31694, merged in Sage 9.4.beta5.\n\nThis ticket adds doctests as examples.\n\n\nCC:  @dimpase @slel @orlitzky\n\nUpstream: Fixed upstream, in a later stable release.\n\nReviewer: Dima Pasechnik, Michael Orlitzky\n\nAuthor: Samuel Leli\u00e8vre\n\nBranch: c3ab10ea5c1ccf67611ef950192942e8cb0afa9d\n\nCommit: c3ab10ea5c1ccf67611ef950192942e8cb0afa9d\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31739\n\n",
    "closed_at": "2021-09-25T23:18:15Z",
    "created_at": "2021-04-27T09:17:06Z",
    "labels": [
        "component: calculus",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Doctest exp(2*f(x)) with f in {atanh, acoth, asinh, acosh, asech, acsch}",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31739",
    "user": "https://github.com/Yapadcoi"
}
```
In Sage 9.3.rc4, we get the incorrect

```
sage: exp(2*atanh(x))
(x + 1)/(x - 1)
```

The correct answer is (1 + x)/(1 - x) so we expect:

```
sage: exp(2*atanh(x))
-(x + 1)/(x - 1)
```

Similarly, we get the incorrect

```
sage: exp(2*acoth(x))
(x - 1)/(x + 1)
```

while we expect:

```
sage: exp(2*acoth(x))
(x + 1)/(x - 1)
```

The bug is in Pynac. A fix is provided at

- [Pynac pull request 374: Fix exp of inverse hyperbolic functions](https://github.com/pynac/pynac/pull/374)

The upgrade to Pynac 0.7.29, which has the change,
is done in #31694, merged in Sage 9.4.beta5.

This ticket adds doctests as examples.


CC:  @dimpase @slel @orlitzky

Upstream: Fixed upstream, in a later stable release.

Reviewer: Dima Pasechnik, Michael Orlitzky

Author: Samuel Leli√®vre

Branch: c3ab10ea5c1ccf67611ef950192942e8cb0afa9d

Commit: c3ab10ea5c1ccf67611ef950192942e8cb0afa9d

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31739





---

archive/issue_comments_449937.json:
```json
{
    "body": "<a id='comment:1'></a>This is likely a Pynac bug. Please report at\n\n- https://github.com/pynac/pynac",
    "created_at": "2021-04-27T14:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31739#issuecomment-449937",
    "user": "https://github.com/slel"
}
```

<a id='comment:1'></a>This is likely a Pynac bug. Please report at

- https://github.com/pynac/pynac



---

archive/issue_comments_449938.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2021-04-27T15:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31739#issuecomment-449938",
    "user": "https://github.com/slel"
}
```

Changing priority from major to critical.



---

archive/issue_comments_449939.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2021-04-27T15:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31739#issuecomment-449939",
    "user": "https://github.com/slel"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_449940.json:
```json
{
    "body": "<a id='comment:2'></a>I proposed a fix to Pynac, see link in ticket description.\n\nWe should either apply it here as a patch\nor wait for a new Pynac release with the fix.\n\nWe should also add doctests.",
    "created_at": "2021-04-27T15:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31739#issuecomment-449940",
    "user": "https://github.com/slel"
}
```

<a id='comment:2'></a>I proposed a fix to Pynac, see link in ticket description.

We should either apply it here as a patch
or wait for a new Pynac release with the fix.

We should also add doctests.



---

archive/issue_comments_449941.json:
```json
{
    "body": "<a id='comment:4'></a>OK, I've tested the pynac patch, it seems to work. Now the full doctest...",
    "created_at": "2021-06-24T12:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31739#issuecomment-449941",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>OK, I've tested the pynac patch, it seems to work. Now the full doctest...



---

archive/issue_comments_449942.json:
```json
{
    "body": "<a id='comment:5'></a>OK, this works. I'm merging this upstream.",
    "created_at": "2021-06-25T08:59:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31739#issuecomment-449942",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>OK, this works. I'm merging this upstream.



---

archive/issue_comments_449943.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-25T09:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31739#issuecomment-449943",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_449944.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-25T09:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31739#issuecomment-449944",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_449945.json:
```json
{
    "body": "<a id='comment:8'></a>Should we add doctests though?",
    "created_at": "2021-06-25T09:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31739#issuecomment-449945",
    "user": "https://github.com/slel"
}
```

<a id='comment:8'></a>Should we add doctests though?



---

archive/issue_comments_449946.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-06-25T11:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31739#issuecomment-449946",
    "user": "https://github.com/dimpase"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_449947.json:
```json
{
    "body": "<a id='comment:9'></a>Could you add doctests here, on top of #31694?",
    "created_at": "2021-06-25T11:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31739#issuecomment-449947",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>Could you add doctests here, on top of #31694?



---

archive/issue_comments_449948.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-07-25T23:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31739#issuecomment-449948",
    "user": "https://github.com/slel"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_449949.json:
```json
{
    "body": "<a id='comment:10'></a>Thanks Dima for merging my pull request in Pynac.\n\nI'm adding examples in `src/sage/functions/hyperbolic.py`.\nHaving added the examples in the file's main docstring,\nI skipped mentioning the ticket number, which I would\nhave done if I had put the doctests in TESTS blocks.\nHope that's okay.\n\nFollow-up Pynac issue for the case c = 1 at\n\n- https://github.com/pynac/pynac/issues/381\n \n---\nNew commits:",
    "created_at": "2021-07-25T23:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31739#issuecomment-449949",
    "user": "https://github.com/slel"
}
```

<a id='comment:10'></a>Thanks Dima for merging my pull request in Pynac.

I'm adding examples in `src/sage/functions/hyperbolic.py`.
Having added the examples in the file's main docstring,
I skipped mentioning the ticket number, which I would
have done if I had put the doctests in TESTS blocks.
Hope that's okay.

Follow-up Pynac issue for the case c = 1 at

- https://github.com/pynac/pynac/issues/381
 
---
New commits:



---

archive/issue_comments_449950.json:
```json
{
    "body": "<a id='comment:11'></a>Lowering priority as the fix is in\nand we merely add doctests here.",
    "created_at": "2021-07-26T00:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31739#issuecomment-449950",
    "user": "https://github.com/slel"
}
```

<a id='comment:11'></a>Lowering priority as the fix is in
and we merely add doctests here.



---

archive/issue_events_083706.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:07:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31739",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31739#event-83706"
}
```



---

archive/issue_comments_449951.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-18T11:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31739#issuecomment-449951",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_449952.json:
```json
{
    "body": "<a id='comment:13'></a>For robust test cases, something like\n\n```\nsage: bool(exp(2*atanh(x)) == -(x + 1)/(x - 1))\nTrue\n```\n\nwould be preferable as it does not depend on an exact string representation. But with *examples*, it's hard to avoid. And now that we've officially adopted pynac I guess it's OK to doctest this here, rather than in pynac \"upstream.\"",
    "created_at": "2021-09-18T11:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31739#issuecomment-449952",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:13'></a>For robust test cases, something like

```
sage: bool(exp(2*atanh(x)) == -(x + 1)/(x - 1))
True
```

would be preferable as it does not depend on an exact string representation. But with *examples*, it's hard to avoid. And now that we've officially adopted pynac I guess it's OK to doctest this here, rather than in pynac "upstream."



---

archive/issue_comments_449953.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-09-25T23:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31739",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31739#issuecomment-449953",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_083707.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-09-25T23:18:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31739",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31739#event-83707"
}
```
