# Issue 31034: Fix sage -package download --allow-upstream, add option --on-error=warn, add filtering to sage -package upload

archive/issues_030797.json:
```json
{
    "assignees": [],
    "body": "After the fix from this ticket, we should be able to automate syncing upstream packages to the Sage server by using\n\n```\n./sage -package download --allow-upstream --on-error=warn :all:\n```\nfollowed by \n\n```\n./sage -package upload :all:\n```\n... if someone is able to set up the necessary credentials for the workflow.\n\nWe also add a mechanism to exclude non-distributable tarballs:  If a tarball name includes the pattern `do-not-distribute`, `sage -package upload` now skips it and logs a message.  We change the name of the tarball of `scipoptsuite` accordingly - this is our only non-distributable tarball.\n\n\n\nCC:  @vbraun @kliem @tobiasdiez @dimpase @jplab @slel @seblabbe\n\nBranch/Commit: **[274db61](https://github.com/sagemath/sagetrac-mirror/commit/274db614ef204d682e15cebdf76c0df648c7c7e5)**\n\nReviewer: **Jonathan Kliem, Volker Braun**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **distribution**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31034_\n\n",
    "closed_at": "2020-12-27T23:25:48Z",
    "created_at": "2020-12-10T00:41:22Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20distribution",
        "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix sage -package download --allow-upstream, add option --on-error=warn, add filtering to sage -package upload",
    "type": "issue",
    "updated_at": "2020-12-27T23:25:48Z",
    "url": "https://github.com/sagemath/sage/issues/31034",
    "user": "https://github.com/mkoeppe"
}
```
After the fix from this ticket, we should be able to automate syncing upstream packages to the Sage server by using

```
./sage -package download --allow-upstream --on-error=warn :all:
```
followed by 

```
./sage -package upload :all:
```
... if someone is able to set up the necessary credentials for the workflow.

We also add a mechanism to exclude non-distributable tarballs:  If a tarball name includes the pattern `do-not-distribute`, `sage -package upload` now skips it and logs a message.  We change the name of the tarball of `scipoptsuite` accordingly - this is our only non-distributable tarball.



CC:  @vbraun @kliem @tobiasdiez @dimpase @jplab @slel @seblabbe

Branch/Commit: **[274db61](https://github.com/sagemath/sagetrac-mirror/commit/274db614ef204d682e15cebdf76c0df648c7c7e5)**

Reviewer: **Jonathan Kliem, Volker Braun**

Author: **Matthias Koeppe**

Component: **distribution**

_Issue created by migration from https://trac.sagemath.org/ticket/31034_





---

archive/issue_events_427982.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-10T00:41:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-427982"
}
```



---

archive/issue_events_427983.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-10T00:41:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20distribution",
    "label_color": "000080",
    "label_name": "c: distribution",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-427983"
}
```



---

archive/issue_events_427984.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-10T00:41:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-427984"
}
```



---

archive/issue_events_427985.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-10T00:41:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-427985"
}
```



---

archive/issue_comments_497444.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,5 +10,6 @@\n ```\n ... if someone is able to set up the necessary credentials for the workflow.\n \n+(We may want to use a mechanism to exclude non-distributable tarballs -- in case an upgrade ticket for `scipoptsuite` adds `upstream_url`. For example we could include a pattern such as `-do-not-distribute` as part of the tarball name for such packages.)\n \n \n``````\n",
    "created_at": "2020-12-10T03:24:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497444",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,5 +10,6 @@
 ```
 ... if someone is able to set up the necessary credentials for the workflow.
 
+(We may want to use a mechanism to exclude non-distributable tarballs -- in case an upgrade ticket for `scipoptsuite` adds `upstream_url`. For example we could include a pattern such as `-do-not-distribute` as part of the tarball name for such packages.)
 
 
``````




---

archive/issue_comments_497445.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nit might be more reasonable to do this with a special GH action.\nThen it can be run on e.g. Volker's repo by him, e.g. while making a beta.",
    "created_at": "2020-12-10T13:55:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497445",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:2" align="right">comment:2</div>

it might be more reasonable to do this with a special GH action.
Then it can be run on e.g. Volker's repo by him, e.g. while making a beta.



---

archive/issue_comments_497446.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI tried to put it into my release management script but it doesn't actually try to download from the `upstream_url`:\n\n```\n$ cat build/pkgs/pynormaliz/checksums.ini \ntarball=PyNormaliz-VERSION.tar.gz\nsha1=c01c7a734deeb09e1dd236fb53575b152b99657b\nmd5=6ff9ccc61592190fdb88fe08a50e062c\ncksum=3111232777\nupstream_url=https://pypi.io/packages/source/p/pynormaliz/PyNormaliz-VERSION.tar.gz\n\n$ ./sage -package download --allow-upstream pynormaliz\n[...]\nhttp://sagepad.org/spkg/upstream/pynormaliz/PyNormaliz-2.13.tar.gz\n[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\nERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/pynormaliz/PyNormaliz-2.13.tar.gz'\nTraceback (most recent call last):\n  File \"/home/release/Sage/build/bin/sage-package\", line 42, in <module>\n    run()\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/cmdline.py\", line 339, in run\n    app.download_cls(args.package_name, args.allow_upstream)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/app.py\", line 177, in download_cls\n    pc.apply(self.download)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/expand_class.py\", line 71, in apply\n    function(package_name, *args, **kwds)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/app.py\", line 167, in download\n    package.tarball.download(allow_upstream=allow_upstream)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/tarball.py\", line 177, in download\n    raise FileNotMirroredError('tarball does not exist on mirror network')\nsage_bootstrap.tarball.FileNotMirroredError: tarball does not exist on mirror network\n```\nIs there anything that I'm doing wrong?",
    "created_at": "2020-12-20T11:01:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497446",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:3" align="right">comment:3</div>

I tried to put it into my release management script but it doesn't actually try to download from the `upstream_url`:

```
$ cat build/pkgs/pynormaliz/checksums.ini 
tarball=PyNormaliz-VERSION.tar.gz
sha1=c01c7a734deeb09e1dd236fb53575b152b99657b
md5=6ff9ccc61592190fdb88fe08a50e062c
cksum=3111232777
upstream_url=https://pypi.io/packages/source/p/pynormaliz/PyNormaliz-VERSION.tar.gz

$ ./sage -package download --allow-upstream pynormaliz
[...]
http://sagepad.org/spkg/upstream/pynormaliz/PyNormaliz-2.13.tar.gz
[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
ERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/pynormaliz/PyNormaliz-2.13.tar.gz'
Traceback (most recent call last):
  File "/home/release/Sage/build/bin/sage-package", line 42, in <module>
    run()
  File "/home/release/Sage/build/bin/../sage_bootstrap/cmdline.py", line 339, in run
    app.download_cls(args.package_name, args.allow_upstream)
  File "/home/release/Sage/build/bin/../sage_bootstrap/app.py", line 177, in download_cls
    pc.apply(self.download)
  File "/home/release/Sage/build/bin/../sage_bootstrap/expand_class.py", line 71, in apply
    function(package_name, *args, **kwds)
  File "/home/release/Sage/build/bin/../sage_bootstrap/app.py", line 167, in download
    package.tarball.download(allow_upstream=allow_upstream)
  File "/home/release/Sage/build/bin/../sage_bootstrap/tarball.py", line 177, in download
    raise FileNotMirroredError('tarball does not exist on mirror network')
sage_bootstrap.tarball.FileNotMirroredError: tarball does not exist on mirror network
```
Is there anything that I'm doing wrong?



---

archive/issue_comments_497447.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\n./configure must be run with\n`--enable-download-from-upstream-url`",
    "created_at": "2020-12-20T12:24:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497447",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">comment:4</div>

./configure must be run with
`--enable-download-from-upstream-url`



---

archive/issue_comments_497448.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nIs the `--allow-upstream` actually doing anything or is only the configure switch relevant?",
    "created_at": "2020-12-20T14:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497448",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:5" align="right">comment:5</div>

Is the `--allow-upstream` actually doing anything or is only the configure switch relevant?



---

archive/issue_comments_497449.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n`./sage -package` does NOT respect the configure switch, it only handles `--allow-upstream`... which, however, was indeed broken",
    "created_at": "2020-12-20T19:38:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497449",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">comment:6</div>

`./sage -package` does NOT respect the configure switch, it only handles `--allow-upstream`... which, however, was indeed broken



---

archive/issue_comments_497450.json:
```json
{
    "body": "Branch: **[u/mkoeppe/gh_actions_workflow_to_sync_upstream_packages_to_the_sage_server](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions_workflow_to_sync_upstream_packages_to_the_sage_server)**",
    "created_at": "2020-12-20T19:40:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497450",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/gh_actions_workflow_to_sync_upstream_packages_to_the_sage_server](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions_workflow_to_sync_upstream_packages_to_the_sage_server)**



---

archive/issue_comments_497451.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-12-20T19:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497451",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_497452.json:
```json
{
    "body": "Commit: **[0e18239](https://github.com/sagemath/sagetrac-mirror/commit/0e18239948db03964ce5a81fbba86e74084a86ce)**",
    "created_at": "2020-12-20T19:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497452",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[0e18239](https://github.com/sagemath/sagetrac-mirror/commit/0e18239948db03964ce5a81fbba86e74084a86ce)**



---

archive/issue_comments_497453.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0e18239948db03964ce5a81fbba86e74084a86ce\">0e18239</a></td><td><code>sage --package download: Fix --allow-upstream</code></td></tr></table>\n",
    "created_at": "2020-12-20T19:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497453",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0e18239948db03964ce5a81fbba86e74084a86ce">0e18239</a></td><td><code>sage --package download: Fix --allow-upstream</code></td></tr></table>




---

archive/issue_events_427986.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-20T19:47:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-427986"
}
```



---

archive/issue_events_427987.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-22T16:06:11Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "title_is": "Fix sage -package download --allow-upstream",
    "title_was": "GH Actions workflow to sync upstream packages to the Sage server",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-427987"
}
```



---

archive/issue_comments_497454.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-We should be able to automate this using\n+After the fix from this ticket, we should be able to automate syncing upstream packages to the Sage server by using\n \n ```\n ./sage -package download --allow-upstream :all:\n``````\n",
    "created_at": "2020-12-22T16:06:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497454",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-We should be able to automate this using
+After the fix from this ticket, we should be able to automate syncing upstream packages to the Sage server by using
 
 ```
 ./sage -package download --allow-upstream :all:
``````




---

archive/issue_comments_497455.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nWhy did you update pynormaliz to 7.77?",
    "created_at": "2020-12-22T16:22:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497455",
    "user": "https://github.com/kliem"
}
```

<div id="comment:11" align="right">comment:11</div>

Why did you update pynormaliz to 7.77?



---

archive/issue_comments_497456.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nSorry...",
    "created_at": "2020-12-22T16:23:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497456",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

Sorry...



---

archive/issue_comments_497457.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/34335ca0765c0b68cfc36bec81bc4b626e810fd2\">34335ca</a></td><td><code>sage --package download: Fix --allow-upstream</code></td></tr></table>\n",
    "created_at": "2020-12-22T16:24:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497457",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/34335ca0765c0b68cfc36bec81bc4b626e810fd2">34335ca</a></td><td><code>sage --package download: Fix --allow-upstream</code></td></tr></table>




---

archive/issue_comments_497458.json:
```json
{
    "body": "Changed commit from **[0e18239](https://github.com/sagemath/sagetrac-mirror/commit/0e18239948db03964ce5a81fbba86e74084a86ce)** to **[34335ca](https://github.com/sagemath/sagetrac-mirror/commit/34335ca0765c0b68cfc36bec81bc4b626e810fd2)**",
    "created_at": "2020-12-22T16:24:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497458",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0e18239](https://github.com/sagemath/sagetrac-mirror/commit/0e18239948db03964ce5a81fbba86e74084a86ce)** to **[34335ca](https://github.com/sagemath/sagetrac-mirror/commit/34335ca0765c0b68cfc36bec81bc4b626e810fd2)**



---

archive/issue_comments_497459.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThis ticket looks like a left over from somewhere else.\n\nI mean, why was `download_with_args` defined but never used?",
    "created_at": "2020-12-22T16:29:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497459",
    "user": "https://github.com/kliem"
}
```

<div id="comment:14" align="right">comment:14</div>

This ticket looks like a left over from somewhere else.

I mean, why was `download_with_args` defined but never used?



---

archive/issue_comments_497460.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nProbably I messed it up in a merge.",
    "created_at": "2020-12-22T16:31:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497460",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

Probably I messed it up in a merge.



---

archive/issue_events_427988.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-22T16:40:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-427988"
}
```



---

archive/issue_events_427989.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-22T16:40:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-427989"
}
```



---

archive/issue_comments_497461.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nLGTM.",
    "created_at": "2020-12-22T16:40:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497461",
    "user": "https://github.com/kliem"
}
```

<div id="comment:16" align="right">comment:16</div>

LGTM.



---

archive/issue_comments_497462.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nBtw, pynormaliz still isn't on the mirrors, this is how I tested it. It was convenient for this purpose, but isn't otherwise.",
    "created_at": "2020-12-22T16:41:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497462",
    "user": "https://github.com/kliem"
}
```

<div id="comment:17" align="right">comment:17</div>

Btw, pynormaliz still isn't on the mirrors, this is how I tested it. It was convenient for this purpose, but isn't otherwise.



---

archive/issue_comments_497463.json:
```json
{
    "body": "Reviewer: **Jonathan Kliem**",
    "created_at": "2020-12-22T16:45:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497463",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Jonathan Kliem**



---

archive/issue_comments_497464.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThank you!",
    "created_at": "2020-12-22T16:45:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497464",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

Thank you!



---

archive/issue_comments_497465.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@kliem](#comment:17):\n> Btw, pynormaliz still isn't on the mirrors, this is how I tested it.\n> It was convenient for this purpose, but isn't otherwise.\n\nFixed now. Thanks Volker!",
    "created_at": "2020-12-23T13:54:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497465",
    "user": "https://github.com/slel"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@kliem](#comment:17):
> Btw, pynormaliz still isn't on the mirrors, this is how I tested it.
> It was convenient for this purpose, but isn't otherwise.

Fixed now. Thanks Volker!



---

archive/issue_comments_497466.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nTo run this unattended we also need to ignore tarballs that we are not allowed to distribute for licensing reasons:\n\n```\n$ echo sage -package download --allow-upstream :all:\n[...]\nhttp://sagepad.org/spkg/upstream/scipoptsuite/scipoptsuite-5.0.1.tgz\n[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\nERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/scipoptsuite/scipoptsuite-5.0.1.tgz'\nTraceback (most recent call last):\n  File \"/home/release/Sage/build/bin/sage-package\", line 42, in <module>\n    run()\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/cmdline.py\", line 339, in run\n    app.download_cls(args.package_name, args.allow_upstream)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/app.py\", line 177, in download_cls\n    pc.apply(download_with_args)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/expand_class.py\", line 71, in apply\n    function(package_name, *args, **kwds)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/app.py\", line 176, in download_with_args\n    return self.download(package, allow_upstream=allow_upstream)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/app.py\", line 167, in download\n    package.tarball.download(allow_upstream=allow_upstream)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/tarball.py\", line 177, in download\n    raise FileNotMirroredError('tarball does not exist on mirror network')\nsage_bootstrap.tarball.FileNotMirroredError: tarball does not exist on mirror network\n```",
    "created_at": "2020-12-23T15:13:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497466",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:20" align="right">comment:20</div>

To run this unattended we also need to ignore tarballs that we are not allowed to distribute for licensing reasons:

```
$ echo sage -package download --allow-upstream :all:
[...]
http://sagepad.org/spkg/upstream/scipoptsuite/scipoptsuite-5.0.1.tgz
[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
ERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/scipoptsuite/scipoptsuite-5.0.1.tgz'
Traceback (most recent call last):
  File "/home/release/Sage/build/bin/sage-package", line 42, in <module>
    run()
  File "/home/release/Sage/build/bin/../sage_bootstrap/cmdline.py", line 339, in run
    app.download_cls(args.package_name, args.allow_upstream)
  File "/home/release/Sage/build/bin/../sage_bootstrap/app.py", line 177, in download_cls
    pc.apply(download_with_args)
  File "/home/release/Sage/build/bin/../sage_bootstrap/expand_class.py", line 71, in apply
    function(package_name, *args, **kwds)
  File "/home/release/Sage/build/bin/../sage_bootstrap/app.py", line 176, in download_with_args
    return self.download(package, allow_upstream=allow_upstream)
  File "/home/release/Sage/build/bin/../sage_bootstrap/app.py", line 167, in download
    package.tarball.download(allow_upstream=allow_upstream)
  File "/home/release/Sage/build/bin/../sage_bootstrap/tarball.py", line 177, in download
    raise FileNotMirroredError('tarball does not exist on mirror network')
sage_bootstrap.tarball.FileNotMirroredError: tarball does not exist on mirror network
```



---

archive/issue_events_427990.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-23T15:13:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-427990"
}
```



---

archive/issue_events_427991.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-23T15:13:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-427991"
}
```



---

archive/issue_comments_497467.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI think this ticket is fine. It fixes\n\n```\n./sage -package download --allow-upstream :all:\n```\nas claimed.\n\n```\n./sage -package upload :all:\n```\nneeds work yet, which is a seperate issue, I would say.\n\nOf course, both things can be taken care of in this ticket. But one might as well open a seperate ticket.",
    "created_at": "2020-12-23T15:17:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497467",
    "user": "https://github.com/kliem"
}
```

<div id="comment:22" align="right">comment:22</div>

I think this ticket is fine. It fixes

```
./sage -package download --allow-upstream :all:
```
as claimed.

```
./sage -package upload :all:
```
needs work yet, which is a seperate issue, I would say.

Of course, both things can be taken care of in this ticket. But one might as well open a seperate ticket.



---

archive/issue_events_427992.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-23T17:40:21Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "title_is": "Fix sage -package download --allow-upstream, add filtering to sage -package upload",
    "title_was": "Fix sage -package download --allow-upstream",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-427992"
}
```



---

archive/issue_comments_497468.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\n`needs_work` is just shorthand for \"Could you please prepare the mechanism to exclude non-distributable tarballs as you suggested on the ticket description\". I'm working on it.",
    "created_at": "2020-12-23T17:52:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497468",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

`needs_work` is just shorthand for "Could you please prepare the mechanism to exclude non-distributable tarballs as you suggested on the ticket description". I'm working on it.



---

archive/issue_comments_497469.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a45caed2fdad29d4c4e87138370bfe6a79419690\">a45caed</a></td><td><code>build/pkgs/scipoptsuite: Rename tarball to include tag '-do-not-distribute'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1bad6b4174593c5a1f0dd04a0ce6b8c71f3cbc02\">1bad6b4</a></td><td><code>sage -package upload: Add more logging</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fefaec192f7af080f0778044867c2ad7943498e3\">fefaec1</a></td><td><code>sage -package upload: Skip non-distributable tarballs</code></td></tr></table>\n",
    "created_at": "2020-12-23T18:16:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497469",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a45caed2fdad29d4c4e87138370bfe6a79419690">a45caed</a></td><td><code>build/pkgs/scipoptsuite: Rename tarball to include tag '-do-not-distribute'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1bad6b4174593c5a1f0dd04a0ce6b8c71f3cbc02">1bad6b4</a></td><td><code>sage -package upload: Add more logging</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fefaec192f7af080f0778044867c2ad7943498e3">fefaec1</a></td><td><code>sage -package upload: Skip non-distributable tarballs</code></td></tr></table>




---

archive/issue_comments_497470.json:
```json
{
    "body": "Changed commit from **[34335ca](https://github.com/sagemath/sagetrac-mirror/commit/34335ca0765c0b68cfc36bec81bc4b626e810fd2)** to **[fefaec1](https://github.com/sagemath/sagetrac-mirror/commit/fefaec192f7af080f0778044867c2ad7943498e3)**",
    "created_at": "2020-12-23T18:16:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497470",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[34335ca](https://github.com/sagemath/sagetrac-mirror/commit/34335ca0765c0b68cfc36bec81bc4b626e810fd2)** to **[fefaec1](https://github.com/sagemath/sagetrac-mirror/commit/fefaec192f7af080f0778044867c2ad7943498e3)**



---

archive/issue_events_427993.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-23T18:19:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-427993"
}
```



---

archive/issue_events_427994.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-23T18:19:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-427994"
}
```



---

archive/issue_comments_497471.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nHere's a version with this new feature",
    "created_at": "2020-12-23T18:19:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497471",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:26" align="right">comment:26</div>

Here's a version with this new feature



---

archive/issue_comments_497472.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,6 +10,6 @@\n ```\n ... if someone is able to set up the necessary credentials for the workflow.\n \n-(We may want to use a mechanism to exclude non-distributable tarballs -- in case an upgrade ticket for `scipoptsuite` adds `upstream_url`. For example we could include a pattern such as `-do-not-distribute` as part of the tarball name for such packages.)\n+We also add a mechanism to exclude non-distributable tarballs:  If a tarball name includes the pattern `do-not-distribute`, `sage -package upload` now skips it and logs a message.  We change the name of the tarball of `scipoptsuite` accordingly - this is our only non-distributable tarball.\n \n \n``````\n",
    "created_at": "2020-12-23T18:19:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497472",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,6 +10,6 @@
 ```
 ... if someone is able to set up the necessary credentials for the workflow.
 
-(We may want to use a mechanism to exclude non-distributable tarballs -- in case an upgrade ticket for `scipoptsuite` adds `upstream_url`. For example we could include a pattern such as `-do-not-distribute` as part of the tarball name for such packages.)
+We also add a mechanism to exclude non-distributable tarballs:  If a tarball name includes the pattern `do-not-distribute`, `sage -package upload` now skips it and logs a message.  We change the name of the tarball of `scipoptsuite` accordingly - this is our only non-distributable tarball.
 
 
``````




---

archive/issue_comments_497473.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nThere is at least an info section missing here https://doc.sagemath.org/html/en/developer/packaging.html, so that people are warned when adding new packages.\n\nHowever, I would prefer it the other way around, even though it is annoying: Have a small sentence in SPKG.rst that we may redistribute. This would be more fool-proof.",
    "created_at": "2020-12-23T18:43:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497473",
    "user": "https://github.com/kliem"
}
```

<div id="comment:27" align="right">comment:27</div>

There is at least an info section missing here https://doc.sagemath.org/html/en/developer/packaging.html, so that people are warned when adding new packages.

However, I would prefer it the other way around, even though it is annoying: Have a small sentence in SPKG.rst that we may redistribute. This would be more fool-proof.



---

archive/issue_comments_497474.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@kliem](#comment:27):\n> There is at least an info section missing here https://doc.sagemath.org/html/en/developer/packaging.html, so that people are warned when adding new packages.\n\nGood idea.\n\n> However, I would prefer it the other way around, even though it is annoying: Have a small sentence in SPKG.rst that we may redistribute. This would be more fool-proof.\n\nI disagree. We make free software here; the non-distributable case is an exception for rare cases.\n\nIt does not have to be foolproof. We have the review process that so far seems to have successfully stopped people from adding proprietary packages.\n\nIf you are interested in adding structured license info to `build/pkgs/`... see #21571.",
    "created_at": "2020-12-23T19:08:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497474",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@kliem](#comment:27):
> There is at least an info section missing here https://doc.sagemath.org/html/en/developer/packaging.html, so that people are warned when adding new packages.

Good idea.

> However, I would prefer it the other way around, even though it is annoying: Have a small sentence in SPKG.rst that we may redistribute. This would be more fool-proof.

I disagree. We make free software here; the non-distributable case is an exception for rare cases.

It does not have to be foolproof. We have the review process that so far seems to have successfully stopped people from adding proprietary packages.

If you are interested in adding structured license info to `build/pkgs/`... see #21571.



---

archive/issue_comments_497475.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nFine.",
    "created_at": "2020-12-23T19:11:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497475",
    "user": "https://github.com/kliem"
}
```

<div id="comment:29" align="right">comment:29</div>

Fine.



---

archive/issue_comments_497476.json:
```json
{
    "body": "Changed commit from **[fefaec1](https://github.com/sagemath/sagetrac-mirror/commit/fefaec192f7af080f0778044867c2ad7943498e3)** to **[6ee9a33](https://github.com/sagemath/sagetrac-mirror/commit/6ee9a337e91a782637cac18acb9ad712c7accaac)**",
    "created_at": "2020-12-23T19:15:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497476",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[fefaec1](https://github.com/sagemath/sagetrac-mirror/commit/fefaec192f7af080f0778044867c2ad7943498e3)** to **[6ee9a33](https://github.com/sagemath/sagetrac-mirror/commit/6ee9a337e91a782637cac18acb9ad712c7accaac)**



---

archive/issue_comments_497477.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6ee9a337e91a782637cac18acb9ad712c7accaac\">6ee9a33</a></td><td><code>src/doc/en/developer/packaging.rst: Document procedure for non-distributable tarballs</code></td></tr></table>\n",
    "created_at": "2020-12-23T19:15:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497477",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6ee9a337e91a782637cac18acb9ad712c7accaac">6ee9a33</a></td><td><code>src/doc/en/developer/packaging.rst: Document procedure for non-distributable tarballs</code></td></tr></table>




---

archive/issue_comments_497478.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nOk, seems fine.\n\nHave you tested that this actually works and skips scipoptsuite?",
    "created_at": "2020-12-23T20:15:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497478",
    "user": "https://github.com/kliem"
}
```

<div id="comment:31" align="right">comment:31</div>

Ok, seems fine.

Have you tested that this actually works and skips scipoptsuite?



---

archive/issue_events_427995.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-23T20:32:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-427995"
}
```



---

archive/issue_events_427996.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-23T20:32:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-427996"
}
```



---

archive/issue_comments_497479.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nNever mind, I tested it with a dummy file and it works fine.",
    "created_at": "2020-12-23T20:32:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497479",
    "user": "https://github.com/kliem"
}
```

<div id="comment:32" align="right">comment:32</div>

Never mind, I tested it with a dummy file and it works fine.



---

archive/issue_comments_497480.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nThanks!",
    "created_at": "2020-12-23T20:45:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497480",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:33" align="right">comment:33</div>

Thanks!



---

archive/issue_comments_497481.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nDownloading still fails tho:\n\n```\n$ sage -package download --allow-upstream :all:\n[...]\nhttp://sagepad.org/spkg/upstream/scipoptsuite/scipoptsuite-5.0.1-do-not-distribute.tgz\n[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\nERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/scipoptsuite/scipoptsuite-5.0.1-do-not-distribute.tgz'\nTraceback (most recent call last):\n  File \"/home/release/Sage/build/bin/sage-package\", line 42, in <module>\n    run()\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/cmdline.py\", line 339, in run\n    app.download_cls(args.package_name, args.allow_upstream)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/app.py\", line 177, in download_cls\n    pc.apply(download_with_args)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/expand_class.py\", line 71, in apply\n    function(package_name, *args, **kwds)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/app.py\", line 176, in download_with_args\n    return self.download(package, allow_upstream=allow_upstream)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/app.py\", line 167, in download\n    package.tarball.download(allow_upstream=allow_upstream)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/tarball.py\", line 180, in download\n    raise FileNotMirroredError('tarball does not exist on mirror network')\nsage_bootstrap.tarball.FileNotMirroredError: tarball does not exist on mirror network\n```",
    "created_at": "2020-12-25T15:49:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497481",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:34" align="right">comment:34</div>

Downloading still fails tho:

```
$ sage -package download --allow-upstream :all:
[...]
http://sagepad.org/spkg/upstream/scipoptsuite/scipoptsuite-5.0.1-do-not-distribute.tgz
[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
ERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/scipoptsuite/scipoptsuite-5.0.1-do-not-distribute.tgz'
Traceback (most recent call last):
  File "/home/release/Sage/build/bin/sage-package", line 42, in <module>
    run()
  File "/home/release/Sage/build/bin/../sage_bootstrap/cmdline.py", line 339, in run
    app.download_cls(args.package_name, args.allow_upstream)
  File "/home/release/Sage/build/bin/../sage_bootstrap/app.py", line 177, in download_cls
    pc.apply(download_with_args)
  File "/home/release/Sage/build/bin/../sage_bootstrap/expand_class.py", line 71, in apply
    function(package_name, *args, **kwds)
  File "/home/release/Sage/build/bin/../sage_bootstrap/app.py", line 176, in download_with_args
    return self.download(package, allow_upstream=allow_upstream)
  File "/home/release/Sage/build/bin/../sage_bootstrap/app.py", line 167, in download
    package.tarball.download(allow_upstream=allow_upstream)
  File "/home/release/Sage/build/bin/../sage_bootstrap/tarball.py", line 180, in download
    raise FileNotMirroredError('tarball does not exist on mirror network')
sage_bootstrap.tarball.FileNotMirroredError: tarball does not exist on mirror network
```



---

archive/issue_events_427997.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-25T15:49:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-427997"
}
```



---

archive/issue_events_427998.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-25T15:49:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-427998"
}
```



---

archive/issue_comments_497482.json:
```json
{
    "body": "Changed commit from **[6ee9a33](https://github.com/sagemath/sagetrac-mirror/commit/6ee9a337e91a782637cac18acb9ad712c7accaac)** to **[274db61](https://github.com/sagemath/sagetrac-mirror/commit/274db614ef204d682e15cebdf76c0df648c7c7e5)**",
    "created_at": "2020-12-25T19:01:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497482",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6ee9a33](https://github.com/sagemath/sagetrac-mirror/commit/6ee9a337e91a782637cac18acb9ad712c7accaac)** to **[274db61](https://github.com/sagemath/sagetrac-mirror/commit/274db614ef204d682e15cebdf76c0df648c7c7e5)**



---

archive/issue_comments_497483.json:
```json
{
    "body": "<div id=\"comment:35\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/274db614ef204d682e15cebdf76c0df648c7c7e5\">274db61</a></td><td><code>sage --package download: Add option --on-error=warn</code></td></tr></table>\n",
    "created_at": "2020-12-25T19:01:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497483",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:35"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/274db614ef204d682e15cebdf76c0df648c7c7e5">274db61</a></td><td><code>sage --package download: Add option --on-error=warn</code></td></tr></table>




---

archive/issue_events_427999.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-25T19:02:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-427999"
}
```



---

archive/issue_events_428000.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-25T19:02:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-428000"
}
```



---

archive/issue_comments_497484.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n After the fix from this ticket, we should be able to automate syncing upstream packages to the Sage server by using\n \n ```\n-./sage -package download --allow-upstream :all:\n+./sage -package download --allow-upstream --on-error=warn :all:\n ```\n followed by \n \n``````\n",
    "created_at": "2020-12-25T19:02:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497484",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 After the fix from this ticket, we should be able to automate syncing upstream packages to the Sage server by using
 
 ```
-./sage -package download --allow-upstream :all:
+./sage -package download --allow-upstream --on-error=warn :all:
 ```
 followed by 
 
``````




---

archive/issue_events_428001.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-25T19:02:20Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "title_is": "Fix sage -package download --allow-upstream, add option --on-error=warn, add filtering to sage -package upload",
    "title_was": "Fix sage -package download --allow-upstream, add filtering to sage -package upload",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-428001"
}
```



---

archive/issue_comments_497485.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nHere you go",
    "created_at": "2020-12-25T19:02:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497485",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">comment:37</div>

Here you go



---

archive/issue_events_428002.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-27T00:26:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-428002"
}
```



---

archive/issue_events_428003.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-27T00:26:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-428003"
}
```



---

archive/issue_comments_497486.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nThanks.",
    "created_at": "2020-12-27T03:24:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497486",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:39" align="right">comment:39</div>

Thanks.



---

archive/issue_comments_497487.json:
```json
{
    "body": "Changed reviewer from **Jonathan Kliem** to **Jonathan Kliem, Volker Braun**",
    "created_at": "2020-12-27T03:25:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497487",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Jonathan Kliem** to **Jonathan Kliem, Volker Braun**



---

archive/issue_comments_497488.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/gh_actions_workflow_to_sync_upstream_packages_to_the_sage_server](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions_workflow_to_sync_upstream_packages_to_the_sage_server)** to **[274db61](https://github.com/sagemath/sagetrac-mirror/commit/274db614ef204d682e15cebdf76c0df648c7c7e5)**",
    "created_at": "2020-12-27T23:25:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-497488",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/gh_actions_workflow_to_sync_upstream_packages_to_the_sage_server](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions_workflow_to_sync_upstream_packages_to_the_sage_server)** to **[274db61](https://github.com/sagemath/sagetrac-mirror/commit/274db614ef204d682e15cebdf76c0df648c7c7e5)**



---

archive/issue_events_428004.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-27T23:25:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-428004"
}
```



---

archive/issue_events_428005.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "89351e77c63f5cd8af51e3ab4f7669772f21bea7",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-12-27T23:25:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-428005"
}
```
