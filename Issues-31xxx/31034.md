# Issue 31034: Fix sage -package download --allow-upstream, add option --on-error=warn, add filtering to sage -package upload

archive/issues_030797.json:
```json
{
    "assignees": [],
    "body": "After the fix from this ticket, we should be able to automate syncing upstream packages to the Sage server by using\n\n```\n./sage -package download --allow-upstream --on-error=warn :all:\n```\nfollowed by \n\n```\n./sage -package upload :all:\n```\n... if someone is able to set up the necessary credentials for the workflow.\n\nWe also add a mechanism to exclude non-distributable tarballs:  If a tarball name includes the pattern `do-not-distribute`, `sage -package upload` now skips it and logs a message.  We change the name of the tarball of `scipoptsuite` accordingly - this is our only non-distributable tarball.\n\n\n\nCC:  @vbraun @kliem @tobiasdiez @dimpase @jplab @slel @seblabbe\n\nBranch/Commit: **[274db61](https://github.com/sagemath/sagetrac-mirror/commit/274db614ef204d682e15cebdf76c0df648c7c7e5)**\n\nReviewer: **Jonathan Kliem, Volker Braun**\n\nAuthor: **Matthias Koeppe**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31034_\n\n",
    "closed_at": "2020-12-27T23:25:48Z",
    "created_at": "2020-12-10T00:41:22Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20distribution",
        "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix sage -package download --allow-upstream, add option --on-error=warn, add filtering to sage -package upload",
    "type": "issue",
    "updated_at": "2020-12-27T23:25:48Z",
    "url": "https://github.com/sagemath/sage/issues/31034",
    "user": "https://github.com/mkoeppe"
}
```
After the fix from this ticket, we should be able to automate syncing upstream packages to the Sage server by using

```
./sage -package download --allow-upstream --on-error=warn :all:
```
followed by 

```
./sage -package upload :all:
```
... if someone is able to set up the necessary credentials for the workflow.

We also add a mechanism to exclude non-distributable tarballs:  If a tarball name includes the pattern `do-not-distribute`, `sage -package upload` now skips it and logs a message.  We change the name of the tarball of `scipoptsuite` accordingly - this is our only non-distributable tarball.



CC:  @vbraun @kliem @tobiasdiez @dimpase @jplab @slel @seblabbe

Branch/Commit: **[274db61](https://github.com/sagemath/sagetrac-mirror/commit/274db614ef204d682e15cebdf76c0df648c7c7e5)**

Reviewer: **Jonathan Kliem, Volker Braun**

Author: **Matthias Koeppe**

_Issue created by migration from https://trac.sagemath.org/ticket/31034_





---

archive/issue_events_395831.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-10T00:41:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395831"
}
```



---

archive/issue_events_395832.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-10T00:41:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20distribution",
    "label_color": "000080",
    "label_name": "component: distribution",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395832"
}
```



---

archive/issue_events_395833.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-10T00:41:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395833"
}
```



---

archive/issue_events_395834.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-10T00:41:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395834"
}
```



---

archive/issue_comments_500354.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,5 +10,6 @@\n ```\n ... if someone is able to set up the necessary credentials for the workflow.\n \n+(We may want to use a mechanism to exclude non-distributable tarballs -- in case an upgrade ticket for `scipoptsuite` adds `upstream_url`. For example we could include a pattern such as `-do-not-distribute` as part of the tarball name for such packages.)\n \n \n``````\n",
    "created_at": "2020-12-10T03:24:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500354",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,5 +10,6 @@
 ```
 ... if someone is able to set up the necessary credentials for the workflow.
 
+(We may want to use a mechanism to exclude non-distributable tarballs -- in case an upgrade ticket for `scipoptsuite` adds `upstream_url`. For example we could include a pattern such as `-do-not-distribute` as part of the tarball name for such packages.)
 
 
``````




---

archive/issue_comments_500355.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nit might be more reasonable to do this with a special GH action.\nThen it can be run on e.g. Volker's repo by him, e.g. while making a beta.",
    "created_at": "2020-12-10T13:55:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500355",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'>Comment 2:</a>
it might be more reasonable to do this with a special GH action.
Then it can be run on e.g. Volker's repo by him, e.g. while making a beta.



---

archive/issue_comments_500356.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nI tried to put it into my release management script but it doesn't actually try to download from the `upstream_url`:\n\n```\n$ cat build/pkgs/pynormaliz/checksums.ini \ntarball=PyNormaliz-VERSION.tar.gz\nsha1=c01c7a734deeb09e1dd236fb53575b152b99657b\nmd5=6ff9ccc61592190fdb88fe08a50e062c\ncksum=3111232777\nupstream_url=https://pypi.io/packages/source/p/pynormaliz/PyNormaliz-VERSION.tar.gz\n\n$ ./sage -package download --allow-upstream pynormaliz\n[...]\nhttp://sagepad.org/spkg/upstream/pynormaliz/PyNormaliz-2.13.tar.gz\n[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\nERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/pynormaliz/PyNormaliz-2.13.tar.gz'\nTraceback (most recent call last):\n  File \"/home/release/Sage/build/bin/sage-package\", line 42, in <module>\n    run()\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/cmdline.py\", line 339, in run\n    app.download_cls(args.package_name, args.allow_upstream)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/app.py\", line 177, in download_cls\n    pc.apply(self.download)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/expand_class.py\", line 71, in apply\n    function(package_name, *args, **kwds)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/app.py\", line 167, in download\n    package.tarball.download(allow_upstream=allow_upstream)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/tarball.py\", line 177, in download\n    raise FileNotMirroredError('tarball does not exist on mirror network')\nsage_bootstrap.tarball.FileNotMirroredError: tarball does not exist on mirror network\n```\nIs there anything that I'm doing wrong?",
    "created_at": "2020-12-20T11:01:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500356",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'>Comment 3:</a>
I tried to put it into my release management script but it doesn't actually try to download from the `upstream_url`:

```
$ cat build/pkgs/pynormaliz/checksums.ini 
tarball=PyNormaliz-VERSION.tar.gz
sha1=c01c7a734deeb09e1dd236fb53575b152b99657b
md5=6ff9ccc61592190fdb88fe08a50e062c
cksum=3111232777
upstream_url=https://pypi.io/packages/source/p/pynormaliz/PyNormaliz-VERSION.tar.gz

$ ./sage -package download --allow-upstream pynormaliz
[...]
http://sagepad.org/spkg/upstream/pynormaliz/PyNormaliz-2.13.tar.gz
[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
ERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/pynormaliz/PyNormaliz-2.13.tar.gz'
Traceback (most recent call last):
  File "/home/release/Sage/build/bin/sage-package", line 42, in <module>
    run()
  File "/home/release/Sage/build/bin/../sage_bootstrap/cmdline.py", line 339, in run
    app.download_cls(args.package_name, args.allow_upstream)
  File "/home/release/Sage/build/bin/../sage_bootstrap/app.py", line 177, in download_cls
    pc.apply(self.download)
  File "/home/release/Sage/build/bin/../sage_bootstrap/expand_class.py", line 71, in apply
    function(package_name, *args, **kwds)
  File "/home/release/Sage/build/bin/../sage_bootstrap/app.py", line 167, in download
    package.tarball.download(allow_upstream=allow_upstream)
  File "/home/release/Sage/build/bin/../sage_bootstrap/tarball.py", line 177, in download
    raise FileNotMirroredError('tarball does not exist on mirror network')
sage_bootstrap.tarball.FileNotMirroredError: tarball does not exist on mirror network
```
Is there anything that I'm doing wrong?



---

archive/issue_comments_500357.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\n./configure must be run with\n`--enable-download-from-upstream-url`",
    "created_at": "2020-12-20T12:24:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500357",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'>Comment 4:</a>
./configure must be run with
`--enable-download-from-upstream-url`



---

archive/issue_comments_500358.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nIs the `--allow-upstream` actually doing anything or is only the configure switch relevant?",
    "created_at": "2020-12-20T14:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500358",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'>Comment 5:</a>
Is the `--allow-upstream` actually doing anything or is only the configure switch relevant?



---

archive/issue_comments_500359.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\n`./sage -package` does NOT respect the configure switch, it only handles `--allow-upstream`... which, however, was indeed broken",
    "created_at": "2020-12-20T19:38:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500359",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'>Comment 6:</a>
`./sage -package` does NOT respect the configure switch, it only handles `--allow-upstream`... which, however, was indeed broken



---

archive/issue_comments_500360.json:
```json
{
    "body": "Branch: **[u/mkoeppe/gh_actions_workflow_to_sync_upstream_packages_to_the_sage_server](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions_workflow_to_sync_upstream_packages_to_the_sage_server)**",
    "created_at": "2020-12-20T19:40:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500360",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/gh_actions_workflow_to_sync_upstream_packages_to_the_sage_server](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions_workflow_to_sync_upstream_packages_to_the_sage_server)**



---

archive/issue_comments_500361.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-12-20T19:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500361",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_500362.json:
```json
{
    "body": "Commit: **[0e18239](https://github.com/sagemath/sagetrac-mirror/commit/0e18239948db03964ce5a81fbba86e74084a86ce)**",
    "created_at": "2020-12-20T19:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500362",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[0e18239](https://github.com/sagemath/sagetrac-mirror/commit/0e18239948db03964ce5a81fbba86e74084a86ce)**



---

archive/issue_comments_500363.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0e18239948db03964ce5a81fbba86e74084a86ce\">0e18239</a></td><td><code>sage --package download: Fix --allow-upstream</code></td></tr></table>\n",
    "created_at": "2020-12-20T19:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500363",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'>Comment 8:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0e18239948db03964ce5a81fbba86e74084a86ce">0e18239</a></td><td><code>sage --package download: Fix --allow-upstream</code></td></tr></table>




---

archive/issue_events_395835.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-20T19:47:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395835"
}
```



---

archive/issue_events_395836.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-22T16:06:11Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "title_is": "Fix sage -package download --allow-upstream",
    "title_was": "GH Actions workflow to sync upstream packages to the Sage server",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395836"
}
```



---

archive/issue_comments_500364.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-We should be able to automate this using\n+After the fix from this ticket, we should be able to automate syncing upstream packages to the Sage server by using\n \n ```\n ./sage -package download --allow-upstream :all:\n``````\n",
    "created_at": "2020-12-22T16:06:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500364",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-We should be able to automate this using
+After the fix from this ticket, we should be able to automate syncing upstream packages to the Sage server by using
 
 ```
 ./sage -package download --allow-upstream :all:
``````




---

archive/issue_comments_500365.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nWhy did you update pynormaliz to 7.77?",
    "created_at": "2020-12-22T16:22:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500365",
    "user": "https://github.com/kliem"
}
```

<a id='comment:11'>Comment 11:</a>
Why did you update pynormaliz to 7.77?



---

archive/issue_comments_500366.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nSorry...",
    "created_at": "2020-12-22T16:23:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500366",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'>Comment 12:</a>
Sorry...



---

archive/issue_comments_500367.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/34335ca0765c0b68cfc36bec81bc4b626e810fd2\">34335ca</a></td><td><code>sage --package download: Fix --allow-upstream</code></td></tr></table>\n",
    "created_at": "2020-12-22T16:24:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500367",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:13'>Comment 13:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/34335ca0765c0b68cfc36bec81bc4b626e810fd2">34335ca</a></td><td><code>sage --package download: Fix --allow-upstream</code></td></tr></table>




---

archive/issue_comments_500368.json:
```json
{
    "body": "Changed commit from **[0e18239](https://github.com/sagemath/sagetrac-mirror/commit/0e18239948db03964ce5a81fbba86e74084a86ce)** to **[34335ca](https://github.com/sagemath/sagetrac-mirror/commit/34335ca0765c0b68cfc36bec81bc4b626e810fd2)**",
    "created_at": "2020-12-22T16:24:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500368",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0e18239](https://github.com/sagemath/sagetrac-mirror/commit/0e18239948db03964ce5a81fbba86e74084a86ce)** to **[34335ca](https://github.com/sagemath/sagetrac-mirror/commit/34335ca0765c0b68cfc36bec81bc4b626e810fd2)**



---

archive/issue_comments_500369.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nThis ticket looks like a left over from somewhere else.\n\nI mean, why was `download_with_args` defined but never used?",
    "created_at": "2020-12-22T16:29:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500369",
    "user": "https://github.com/kliem"
}
```

<a id='comment:14'>Comment 14:</a>
This ticket looks like a left over from somewhere else.

I mean, why was `download_with_args` defined but never used?



---

archive/issue_comments_500370.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nProbably I messed it up in a merge.",
    "created_at": "2020-12-22T16:31:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500370",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'>Comment 15:</a>
Probably I messed it up in a merge.



---

archive/issue_events_395837.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-22T16:40:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395837"
}
```



---

archive/issue_events_395838.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-22T16:40:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395838"
}
```



---

archive/issue_comments_500371.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nLGTM.",
    "created_at": "2020-12-22T16:40:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500371",
    "user": "https://github.com/kliem"
}
```

<a id='comment:16'>Comment 16:</a>
LGTM.



---

archive/issue_comments_500372.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nBtw, pynormaliz still isn't on the mirrors, this is how I tested it. It was convenient for this purpose, but isn't otherwise.",
    "created_at": "2020-12-22T16:41:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500372",
    "user": "https://github.com/kliem"
}
```

<a id='comment:17'>Comment 17:</a>
Btw, pynormaliz still isn't on the mirrors, this is how I tested it. It was convenient for this purpose, but isn't otherwise.



---

archive/issue_comments_500373.json:
```json
{
    "body": "Reviewer: **Jonathan Kliem**",
    "created_at": "2020-12-22T16:45:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500373",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Jonathan Kliem**



---

archive/issue_comments_500374.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nThank you!",
    "created_at": "2020-12-22T16:45:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500374",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'>Comment 18:</a>
Thank you!



---

archive/issue_comments_500375.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nReplying to [@kliem](#comment%3A17):\n> Btw, pynormaliz still isn't on the mirrors, this is how I tested it.\n> It was convenient for this purpose, but isn't otherwise.\n\nFixed now. Thanks Volker!",
    "created_at": "2020-12-23T13:54:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500375",
    "user": "https://github.com/slel"
}
```

<a id='comment:19'>Comment 19:</a>
Replying to [@kliem](#comment%3A17):
> Btw, pynormaliz still isn't on the mirrors, this is how I tested it.
> It was convenient for this purpose, but isn't otherwise.

Fixed now. Thanks Volker!



---

archive/issue_comments_500376.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nTo run this unattended we also need to ignore tarballs that we are not allowed to distribute for licensing reasons:\n\n```\n$ echo sage -package download --allow-upstream :all:\n[...]\nhttp://sagepad.org/spkg/upstream/scipoptsuite/scipoptsuite-5.0.1.tgz\n[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\nERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/scipoptsuite/scipoptsuite-5.0.1.tgz'\nTraceback (most recent call last):\n  File \"/home/release/Sage/build/bin/sage-package\", line 42, in <module>\n    run()\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/cmdline.py\", line 339, in run\n    app.download_cls(args.package_name, args.allow_upstream)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/app.py\", line 177, in download_cls\n    pc.apply(download_with_args)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/expand_class.py\", line 71, in apply\n    function(package_name, *args, **kwds)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/app.py\", line 176, in download_with_args\n    return self.download(package, allow_upstream=allow_upstream)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/app.py\", line 167, in download\n    package.tarball.download(allow_upstream=allow_upstream)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/tarball.py\", line 177, in download\n    raise FileNotMirroredError('tarball does not exist on mirror network')\nsage_bootstrap.tarball.FileNotMirroredError: tarball does not exist on mirror network\n```",
    "created_at": "2020-12-23T15:13:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500376",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:20'>Comment 20:</a>
To run this unattended we also need to ignore tarballs that we are not allowed to distribute for licensing reasons:

```
$ echo sage -package download --allow-upstream :all:
[...]
http://sagepad.org/spkg/upstream/scipoptsuite/scipoptsuite-5.0.1.tgz
[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
ERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/scipoptsuite/scipoptsuite-5.0.1.tgz'
Traceback (most recent call last):
  File "/home/release/Sage/build/bin/sage-package", line 42, in <module>
    run()
  File "/home/release/Sage/build/bin/../sage_bootstrap/cmdline.py", line 339, in run
    app.download_cls(args.package_name, args.allow_upstream)
  File "/home/release/Sage/build/bin/../sage_bootstrap/app.py", line 177, in download_cls
    pc.apply(download_with_args)
  File "/home/release/Sage/build/bin/../sage_bootstrap/expand_class.py", line 71, in apply
    function(package_name, *args, **kwds)
  File "/home/release/Sage/build/bin/../sage_bootstrap/app.py", line 176, in download_with_args
    return self.download(package, allow_upstream=allow_upstream)
  File "/home/release/Sage/build/bin/../sage_bootstrap/app.py", line 167, in download
    package.tarball.download(allow_upstream=allow_upstream)
  File "/home/release/Sage/build/bin/../sage_bootstrap/tarball.py", line 177, in download
    raise FileNotMirroredError('tarball does not exist on mirror network')
sage_bootstrap.tarball.FileNotMirroredError: tarball does not exist on mirror network
```



---

archive/issue_events_395839.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-23T15:13:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395839"
}
```



---

archive/issue_events_395840.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-23T15:13:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395840"
}
```



---

archive/issue_comments_500377.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nI think this ticket is fine. It fixes\n\n```\n./sage -package download --allow-upstream :all:\n```\nas claimed.\n\n```\n./sage -package upload :all:\n```\nneeds work yet, which is a seperate issue, I would say.\n\nOf course, both things can be taken care of in this ticket. But one might as well open a seperate ticket.",
    "created_at": "2020-12-23T15:17:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500377",
    "user": "https://github.com/kliem"
}
```

<a id='comment:22'>Comment 22:</a>
I think this ticket is fine. It fixes

```
./sage -package download --allow-upstream :all:
```
as claimed.

```
./sage -package upload :all:
```
needs work yet, which is a seperate issue, I would say.

Of course, both things can be taken care of in this ticket. But one might as well open a seperate ticket.



---

archive/issue_events_395841.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-23T17:40:21Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "title_is": "Fix sage -package download --allow-upstream, add filtering to sage -package upload",
    "title_was": "Fix sage -package download --allow-upstream",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395841"
}
```



---

archive/issue_comments_500378.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\n`needs_work` is just shorthand for \"Could you please prepare the mechanism to exclude non-distributable tarballs as you suggested on the ticket description\". I'm working on it.",
    "created_at": "2020-12-23T17:52:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500378",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'>Comment 24:</a>
`needs_work` is just shorthand for "Could you please prepare the mechanism to exclude non-distributable tarballs as you suggested on the ticket description". I'm working on it.



---

archive/issue_comments_500379.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a45caed2fdad29d4c4e87138370bfe6a79419690\">a45caed</a></td><td><code>build/pkgs/scipoptsuite: Rename tarball to include tag '-do-not-distribute'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1bad6b4174593c5a1f0dd04a0ce6b8c71f3cbc02\">1bad6b4</a></td><td><code>sage -package upload: Add more logging</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fefaec192f7af080f0778044867c2ad7943498e3\">fefaec1</a></td><td><code>sage -package upload: Skip non-distributable tarballs</code></td></tr></table>\n",
    "created_at": "2020-12-23T18:16:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500379",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:25'>Comment 25:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a45caed2fdad29d4c4e87138370bfe6a79419690">a45caed</a></td><td><code>build/pkgs/scipoptsuite: Rename tarball to include tag '-do-not-distribute'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1bad6b4174593c5a1f0dd04a0ce6b8c71f3cbc02">1bad6b4</a></td><td><code>sage -package upload: Add more logging</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fefaec192f7af080f0778044867c2ad7943498e3">fefaec1</a></td><td><code>sage -package upload: Skip non-distributable tarballs</code></td></tr></table>




---

archive/issue_comments_500380.json:
```json
{
    "body": "Changed commit from **[34335ca](https://github.com/sagemath/sagetrac-mirror/commit/34335ca0765c0b68cfc36bec81bc4b626e810fd2)** to **[fefaec1](https://github.com/sagemath/sagetrac-mirror/commit/fefaec192f7af080f0778044867c2ad7943498e3)**",
    "created_at": "2020-12-23T18:16:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500380",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[34335ca](https://github.com/sagemath/sagetrac-mirror/commit/34335ca0765c0b68cfc36bec81bc4b626e810fd2)** to **[fefaec1](https://github.com/sagemath/sagetrac-mirror/commit/fefaec192f7af080f0778044867c2ad7943498e3)**



---

archive/issue_events_395842.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-23T18:19:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395842"
}
```



---

archive/issue_events_395843.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-23T18:19:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395843"
}
```



---

archive/issue_comments_500381.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nHere's a version with this new feature",
    "created_at": "2020-12-23T18:19:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500381",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'>Comment 26:</a>
Here's a version with this new feature



---

archive/issue_comments_500382.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,6 +10,6 @@\n ```\n ... if someone is able to set up the necessary credentials for the workflow.\n \n-(We may want to use a mechanism to exclude non-distributable tarballs -- in case an upgrade ticket for `scipoptsuite` adds `upstream_url`. For example we could include a pattern such as `-do-not-distribute` as part of the tarball name for such packages.)\n+We also add a mechanism to exclude non-distributable tarballs:  If a tarball name includes the pattern `do-not-distribute`, `sage -package upload` now skips it and logs a message.  We change the name of the tarball of `scipoptsuite` accordingly - this is our only non-distributable tarball.\n \n \n``````\n",
    "created_at": "2020-12-23T18:19:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500382",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,6 +10,6 @@
 ```
 ... if someone is able to set up the necessary credentials for the workflow.
 
-(We may want to use a mechanism to exclude non-distributable tarballs -- in case an upgrade ticket for `scipoptsuite` adds `upstream_url`. For example we could include a pattern such as `-do-not-distribute` as part of the tarball name for such packages.)
+We also add a mechanism to exclude non-distributable tarballs:  If a tarball name includes the pattern `do-not-distribute`, `sage -package upload` now skips it and logs a message.  We change the name of the tarball of `scipoptsuite` accordingly - this is our only non-distributable tarball.
 
 
``````




---

archive/issue_comments_500383.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nThere is at least an info section missing here https://doc.sagemath.org/html/en/developer/packaging.html, so that people are warned when adding new packages.\n\nHowever, I would prefer it the other way around, even though it is annoying: Have a small sentence in SPKG.rst that we may redistribute. This would be more fool-proof.",
    "created_at": "2020-12-23T18:43:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500383",
    "user": "https://github.com/kliem"
}
```

<a id='comment:27'>Comment 27:</a>
There is at least an info section missing here https://doc.sagemath.org/html/en/developer/packaging.html, so that people are warned when adding new packages.

However, I would prefer it the other way around, even though it is annoying: Have a small sentence in SPKG.rst that we may redistribute. This would be more fool-proof.



---

archive/issue_comments_500384.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nReplying to [@kliem](#comment%3A27):\n> There is at least an info section missing here https://doc.sagemath.org/html/en/developer/packaging.html, so that people are warned when adding new packages.\n\nGood idea.\n\n> However, I would prefer it the other way around, even though it is annoying: Have a small sentence in SPKG.rst that we may redistribute. This would be more fool-proof.\n\nI disagree. We make free software here; the non-distributable case is an exception for rare cases.\n\nIt does not have to be foolproof. We have the review process that so far seems to have successfully stopped people from adding proprietary packages.\n\nIf you are interested in adding structured license info to `build/pkgs/`... see #21571.",
    "created_at": "2020-12-23T19:08:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500384",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'>Comment 28:</a>
Replying to [@kliem](#comment%3A27):
> There is at least an info section missing here https://doc.sagemath.org/html/en/developer/packaging.html, so that people are warned when adding new packages.

Good idea.

> However, I would prefer it the other way around, even though it is annoying: Have a small sentence in SPKG.rst that we may redistribute. This would be more fool-proof.

I disagree. We make free software here; the non-distributable case is an exception for rare cases.

It does not have to be foolproof. We have the review process that so far seems to have successfully stopped people from adding proprietary packages.

If you are interested in adding structured license info to `build/pkgs/`... see #21571.



---

archive/issue_comments_500385.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nFine.",
    "created_at": "2020-12-23T19:11:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500385",
    "user": "https://github.com/kliem"
}
```

<a id='comment:29'>Comment 29:</a>
Fine.



---

archive/issue_comments_500386.json:
```json
{
    "body": "Changed commit from **[fefaec1](https://github.com/sagemath/sagetrac-mirror/commit/fefaec192f7af080f0778044867c2ad7943498e3)** to **[6ee9a33](https://github.com/sagemath/sagetrac-mirror/commit/6ee9a337e91a782637cac18acb9ad712c7accaac)**",
    "created_at": "2020-12-23T19:15:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500386",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[fefaec1](https://github.com/sagemath/sagetrac-mirror/commit/fefaec192f7af080f0778044867c2ad7943498e3)** to **[6ee9a33](https://github.com/sagemath/sagetrac-mirror/commit/6ee9a337e91a782637cac18acb9ad712c7accaac)**



---

archive/issue_comments_500387.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6ee9a337e91a782637cac18acb9ad712c7accaac\">6ee9a33</a></td><td><code>src/doc/en/developer/packaging.rst: Document procedure for non-distributable tarballs</code></td></tr></table>\n",
    "created_at": "2020-12-23T19:15:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500387",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:30'>Comment 30:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6ee9a337e91a782637cac18acb9ad712c7accaac">6ee9a33</a></td><td><code>src/doc/en/developer/packaging.rst: Document procedure for non-distributable tarballs</code></td></tr></table>




---

archive/issue_comments_500388.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nOk, seems fine.\n\nHave you tested that this actually works and skips scipoptsuite?",
    "created_at": "2020-12-23T20:15:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500388",
    "user": "https://github.com/kliem"
}
```

<a id='comment:31'>Comment 31:</a>
Ok, seems fine.

Have you tested that this actually works and skips scipoptsuite?



---

archive/issue_events_395844.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-23T20:32:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395844"
}
```



---

archive/issue_events_395845.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-23T20:32:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395845"
}
```



---

archive/issue_comments_500389.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nNever mind, I tested it with a dummy file and it works fine.",
    "created_at": "2020-12-23T20:32:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500389",
    "user": "https://github.com/kliem"
}
```

<a id='comment:32'>Comment 32:</a>
Never mind, I tested it with a dummy file and it works fine.



---

archive/issue_comments_500390.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nThanks!",
    "created_at": "2020-12-23T20:45:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500390",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'>Comment 33:</a>
Thanks!



---

archive/issue_comments_500391.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nDownloading still fails tho:\n\n```\n$ sage -package download --allow-upstream :all:\n[...]\nhttp://sagepad.org/spkg/upstream/scipoptsuite/scipoptsuite-5.0.1-do-not-distribute.tgz\n[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\nERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/scipoptsuite/scipoptsuite-5.0.1-do-not-distribute.tgz'\nTraceback (most recent call last):\n  File \"/home/release/Sage/build/bin/sage-package\", line 42, in <module>\n    run()\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/cmdline.py\", line 339, in run\n    app.download_cls(args.package_name, args.allow_upstream)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/app.py\", line 177, in download_cls\n    pc.apply(download_with_args)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/expand_class.py\", line 71, in apply\n    function(package_name, *args, **kwds)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/app.py\", line 176, in download_with_args\n    return self.download(package, allow_upstream=allow_upstream)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/app.py\", line 167, in download\n    package.tarball.download(allow_upstream=allow_upstream)\n  File \"/home/release/Sage/build/bin/../sage_bootstrap/tarball.py\", line 180, in download\n    raise FileNotMirroredError('tarball does not exist on mirror network')\nsage_bootstrap.tarball.FileNotMirroredError: tarball does not exist on mirror network\n```",
    "created_at": "2020-12-25T15:49:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500391",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:34'>Comment 34:</a>
Downloading still fails tho:

```
$ sage -package download --allow-upstream :all:
[...]
http://sagepad.org/spkg/upstream/scipoptsuite/scipoptsuite-5.0.1-do-not-distribute.tgz
[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
ERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/scipoptsuite/scipoptsuite-5.0.1-do-not-distribute.tgz'
Traceback (most recent call last):
  File "/home/release/Sage/build/bin/sage-package", line 42, in <module>
    run()
  File "/home/release/Sage/build/bin/../sage_bootstrap/cmdline.py", line 339, in run
    app.download_cls(args.package_name, args.allow_upstream)
  File "/home/release/Sage/build/bin/../sage_bootstrap/app.py", line 177, in download_cls
    pc.apply(download_with_args)
  File "/home/release/Sage/build/bin/../sage_bootstrap/expand_class.py", line 71, in apply
    function(package_name, *args, **kwds)
  File "/home/release/Sage/build/bin/../sage_bootstrap/app.py", line 176, in download_with_args
    return self.download(package, allow_upstream=allow_upstream)
  File "/home/release/Sage/build/bin/../sage_bootstrap/app.py", line 167, in download
    package.tarball.download(allow_upstream=allow_upstream)
  File "/home/release/Sage/build/bin/../sage_bootstrap/tarball.py", line 180, in download
    raise FileNotMirroredError('tarball does not exist on mirror network')
sage_bootstrap.tarball.FileNotMirroredError: tarball does not exist on mirror network
```



---

archive/issue_events_395846.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-25T15:49:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395846"
}
```



---

archive/issue_events_395847.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-25T15:49:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395847"
}
```



---

archive/issue_comments_500392.json:
```json
{
    "body": "Changed commit from **[6ee9a33](https://github.com/sagemath/sagetrac-mirror/commit/6ee9a337e91a782637cac18acb9ad712c7accaac)** to **[274db61](https://github.com/sagemath/sagetrac-mirror/commit/274db614ef204d682e15cebdf76c0df648c7c7e5)**",
    "created_at": "2020-12-25T19:01:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500392",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6ee9a33](https://github.com/sagemath/sagetrac-mirror/commit/6ee9a337e91a782637cac18acb9ad712c7accaac)** to **[274db61](https://github.com/sagemath/sagetrac-mirror/commit/274db614ef204d682e15cebdf76c0df648c7c7e5)**



---

archive/issue_comments_500393.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/274db614ef204d682e15cebdf76c0df648c7c7e5\">274db61</a></td><td><code>sage --package download: Add option --on-error=warn</code></td></tr></table>\n",
    "created_at": "2020-12-25T19:01:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500393",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:35'>Comment 35:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/274db614ef204d682e15cebdf76c0df648c7c7e5">274db61</a></td><td><code>sage --package download: Add option --on-error=warn</code></td></tr></table>




---

archive/issue_events_395848.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-25T19:02:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395848"
}
```



---

archive/issue_events_395849.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-25T19:02:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395849"
}
```



---

archive/issue_comments_500394.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n After the fix from this ticket, we should be able to automate syncing upstream packages to the Sage server by using\n \n ```\n-./sage -package download --allow-upstream :all:\n+./sage -package download --allow-upstream --on-error=warn :all:\n ```\n followed by \n \n``````\n",
    "created_at": "2020-12-25T19:02:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500394",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 After the fix from this ticket, we should be able to automate syncing upstream packages to the Sage server by using
 
 ```
-./sage -package download --allow-upstream :all:
+./sage -package download --allow-upstream --on-error=warn :all:
 ```
 followed by 
 
``````




---

archive/issue_events_395850.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-25T19:02:20Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "title_is": "Fix sage -package download --allow-upstream, add option --on-error=warn, add filtering to sage -package upload",
    "title_was": "Fix sage -package download --allow-upstream, add filtering to sage -package upload",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395850"
}
```



---

archive/issue_comments_500395.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nHere you go",
    "created_at": "2020-12-25T19:02:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500395",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'>Comment 37:</a>
Here you go



---

archive/issue_events_395851.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-27T00:26:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395851"
}
```



---

archive/issue_events_395852.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-27T00:26:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395852"
}
```



---

archive/issue_comments_500396.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nThanks.",
    "created_at": "2020-12-27T03:24:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500396",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'>Comment 39:</a>
Thanks.



---

archive/issue_comments_500397.json:
```json
{
    "body": "Changed reviewer from **Jonathan Kliem** to **Jonathan Kliem, Volker Braun**",
    "created_at": "2020-12-27T03:25:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500397",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Jonathan Kliem** to **Jonathan Kliem, Volker Braun**



---

archive/issue_comments_500398.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/gh_actions_workflow_to_sync_upstream_packages_to_the_sage_server](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions_workflow_to_sync_upstream_packages_to_the_sage_server)** to **[274db61](https://github.com/sagemath/sagetrac-mirror/commit/274db614ef204d682e15cebdf76c0df648c7c7e5)**",
    "created_at": "2020-12-27T23:25:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31034#issuecomment-500398",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/gh_actions_workflow_to_sync_upstream_packages_to_the_sage_server](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gh_actions_workflow_to_sync_upstream_packages_to_the_sage_server)** to **[274db61](https://github.com/sagemath/sagetrac-mirror/commit/274db614ef204d682e15cebdf76c0df648c7c7e5)**



---

archive/issue_events_395853.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-27T23:25:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395853"
}
```



---

archive/issue_events_395854.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "89351e77c63f5cd8af51e3ab4f7669772f21bea7",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-12-27T23:25:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31034",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31034#event-395854"
}
```
