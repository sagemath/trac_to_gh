# Issue 31003: Add minimal pytest configuration

archive/issues_030766.json:
```json
{
    "body": "Add a minimal pytest configuration, so that calling `pytest` from `src` passes without any errors (and without finding any tests for the moment). \n\nThis is a preparation for future usages of pytest, such as #30362 or #30738, and is in the general spirit of #28936 (since pytest is perhaps *the* testing framework for python). For example, one could imagine using `pytest doctest_modules` to run all sage doctests as well.\n\nCC:  @mkoeppe\n\nBranch/Commit: 462f071cbb7823cf1ac59a016fd71d4ff7ab4522\n\nReviewer: Matthias Koeppe\n\nAuthor: Tobias Diez\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31003\n\n",
    "closed_at": "2021-03-07T17:06:08Z",
    "created_at": "2020-12-04T11:43:13Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Add minimal pytest configuration",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31003",
    "user": "https://github.com/tobiasdiez"
}
```
Add a minimal pytest configuration, so that calling `pytest` from `src` passes without any errors (and without finding any tests for the moment). 

This is a preparation for future usages of pytest, such as #30362 or #30738, and is in the general spirit of #28936 (since pytest is perhaps *the* testing framework for python). For example, one could imagine using `pytest doctest_modules` to run all sage doctests as well.

CC:  @mkoeppe

Branch/Commit: 462f071cbb7823cf1ac59a016fd71d4ff7ab4522

Reviewer: Matthias Koeppe

Author: Tobias Diez

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31003





---

archive/issue_comments_469143.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-12-04T11:43:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469143",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_469144.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-04T11:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469144",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_469145.json:
```json
{
    "body": "<a id='comment:3'></a>This file would need comments at the top that explain its purpose",
    "created_at": "2020-12-04T18:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469145",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>This file would need comments at the top that explain its purpose



---

archive/issue_comments_469146.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-05T15:06:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469146",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_469147.json:
```json
{
    "body": "<a id='comment:5'></a>I've now added documentation, also in the `tools.rst`.",
    "created_at": "2020-12-05T15:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469147",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:5'></a>I've now added documentation, also in the `tools.rst`.



---

archive/issue_comments_469148.json:
```json
{
    "body": "<a id='comment:6'></a>Does this really need the line `from __future__ import annotations`?",
    "created_at": "2020-12-05T18:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469148",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Does this really need the line `from __future__ import annotations`?



---

archive/issue_comments_469149.json:
```json
{
    "body": "<a id='comment:7'></a>Also, should this not be hooked into tox?",
    "created_at": "2020-12-05T18:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469149",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>Also, should this not be hooked into tox?



---

archive/issue_comments_469150.json:
```json
{
    "body": "<a id='comment:8'></a>I think it should be said explicitly in the file comments (and the documentation) that this is a no-op and we do not offer ANY tests tested by pytest.\n\n(similar to the wording in the ticket description: \"Add a minimal pytest configuration, so that calling pytest from src passes without any errors (and without finding any tests for the moment).\")",
    "created_at": "2020-12-05T18:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469150",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>I think it should be said explicitly in the file comments (and the documentation) that this is a no-op and we do not offer ANY tests tested by pytest.

(similar to the wording in the ticket description: "Add a minimal pytest configuration, so that calling pytest from src passes without any errors (and without finding any tests for the moment).")



---

archive/issue_comments_469151.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:6 mkoeppe]:\n> Does this really need the line `from __future__ import annotations`? \n\n\nYes, for `dict[str, Any]`.",
    "created_at": "2020-12-05T19:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469151",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:9'></a>Replying to [comment:6 mkoeppe]:
> Does this really need the line `from __future__ import annotations`? 


Yes, for `dict[str, Any]`.



---

archive/issue_comments_469152.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:7 mkoeppe]:\n> Also, should this not be hooked into tox?\n\n\nThat would be the way to go, but I wanted to keep the ticket small (for a change ;-)).",
    "created_at": "2020-12-05T19:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469152",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:10'></a>Replying to [comment:7 mkoeppe]:
> Also, should this not be hooked into tox?


That would be the way to go, but I wanted to keep the ticket small (for a change ;-)).



---

archive/issue_comments_469153.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-05T19:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469153",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_469154.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:8 mkoeppe]:\n> I think it should be said explicitly in the file comments (and the documentation) that this is a no-op and we do not offer ANY tests tested by pytest.\n> \n\n\nDone!",
    "created_at": "2020-12-05T19:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469154",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:12'></a>Replying to [comment:8 mkoeppe]:
> I think it should be said explicitly in the file comments (and the documentation) that this is a no-op and we do not offer ANY tests tested by pytest.
> 


Done!



---

archive/issue_comments_469155.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:10 gh-tobiasdiez]:\n> Replying to [comment:7 mkoeppe]:\n> > Also, should this not be hooked into tox?\n\n> \n> That would be the way to go, but I wanted to keep the ticket small (for a change ;-)).\n\n\nI agree. (Given that it's a no-op, there's no point to hook it into tox now.)",
    "created_at": "2020-12-05T19:42:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469155",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>Replying to [comment:10 gh-tobiasdiez]:
> Replying to [comment:7 mkoeppe]:
> > Also, should this not be hooked into tox?

> 
> That would be the way to go, but I wanted to keep the ticket small (for a change ;-)).


I agree. (Given that it's a no-op, there's no point to hook it into tox now.)



---

archive/issue_comments_469156.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:9 gh-tobiasdiez]:\n> Replying to [comment:6 mkoeppe]:\n> > Does this really need the line `from __future__ import annotations`? \n\n> \n> Yes, for `dict[str, Any]`.\n\n\nThanks. So it won't be compatible with Python 3.6, but I guess that's OK because we don't really use pytest for anything.",
    "created_at": "2020-12-05T19:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469156",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>Replying to [comment:9 gh-tobiasdiez]:
> Replying to [comment:6 mkoeppe]:
> > Does this really need the line `from __future__ import annotations`? 

> 
> Yes, for `dict[str, Any]`.


Thanks. So it won't be compatible with Python 3.6, but I guess that's OK because we don't really use pytest for anything.



---

archive/issue_comments_469157.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-12-06T00:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469157",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_469158.json:
```json
{
    "body": "<a id='comment:15'></a>I am getting the following:\n\n```\n$ sage -sh\n$ (cd src && pytest)\n=========================================================== test session starts ===========================================================\nplatform darwin -- Python 3.8.6, pytest-6.1.2, py-1.9.0, pluggy-0.13.1\nrootdir: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src\ncollected 0 items / 1 error                                                                                                               \n\n================================================================= ERRORS ==================================================================\n_____________________________________________ ERROR collecting sage/tests/deprecation_test.py _____________________________________________\nImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/tests/deprecation_test.py'.\nHint: make sure your test modules/packages have valid Python names.\nTraceback:\n/usr/local/Cellar/python@3.8/3.8.6/Frameworks/Python.framework/Versions/3.8/lib/python3.8/importlib/__init__.py:127: in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\nsage/tests/deprecation_test.py:12: in <module>\n    from sage.misc.superseded import deprecated_function_alias\nsage/misc/superseded.py:30: in <module>\n    from sage.misc.lazy_attribute import lazy_attribute\nE   ModuleNotFoundError: No module named 'sage.misc.lazy_attribute'\n========================================================= short test summary info =========================================================\nERROR sage/tests/deprecation_test.py\n```",
    "created_at": "2020-12-06T00:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469158",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>I am getting the following:

```
$ sage -sh
$ (cd src && pytest)
=========================================================== test session starts ===========================================================
platform darwin -- Python 3.8.6, pytest-6.1.2, py-1.9.0, pluggy-0.13.1
rootdir: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src
collected 0 items / 1 error                                                                                                               

================================================================= ERRORS ==================================================================
_____________________________________________ ERROR collecting sage/tests/deprecation_test.py _____________________________________________
ImportError while importing test module '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/tests/deprecation_test.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/usr/local/Cellar/python@3.8/3.8.6/Frameworks/Python.framework/Versions/3.8/lib/python3.8/importlib/__init__.py:127: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
sage/tests/deprecation_test.py:12: in <module>
    from sage.misc.superseded import deprecated_function_alias
sage/misc/superseded.py:30: in <module>
    from sage.misc.lazy_attribute import lazy_attribute
E   ModuleNotFoundError: No module named 'sage.misc.lazy_attribute'
========================================================= short test summary info =========================================================
ERROR sage/tests/deprecation_test.py
```



---

archive/issue_comments_469159.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-07T21:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469159",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_469160.json:
```json
{
    "body": "<a id='comment:17'></a>You need to run pytest from a virtual environment where Sage has been installed (e.g. using the editable install), since otherwise the imports to cython modules are not resolved. I've clarified this point in the documentation.",
    "created_at": "2020-12-07T21:17:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469160",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:17'></a>You need to run pytest from a virtual environment where Sage has been installed (e.g. using the editable install), since otherwise the imports to cython modules are not resolved. I've clarified this point in the documentation.



---

archive/issue_comments_469161.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-12-07T21:17:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469161",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_469162.json:
```json
{
    "body": "<a id='comment:18'></a>Does it work for you now?",
    "created_at": "2020-12-20T22:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469162",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:18'></a>Does it work for you now?



---

archive/issue_comments_469163.json:
```json
{
    "body": "<a id='comment:19'></a>`sage -sh` does set up an environment in which `python3` is Sage's python (and `pytest` is from this environment too when it is installed).",
    "created_at": "2020-12-21T01:23:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469163",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>`sage -sh` does set up an environment in which `python3` is Sage's python (and `pytest` is from this environment too when it is installed).



---

archive/issue_comments_469164.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-12-21T01:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469164",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_469165.json:
```json
{
    "body": "<a id='comment:21'></a>The same code/steps is working for me and correctly reports `collected 0 items`. I think there is a problem with your setup that cythonized sage modules cannot be found. Can you manually import `from sage.misc.lazy_attribute import lazy_attribute`?",
    "created_at": "2020-12-21T08:21:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469165",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:21'></a>The same code/steps is working for me and correctly reports `collected 0 items`. I think there is a problem with your setup that cythonized sage modules cannot be found. Can you manually import `from sage.misc.lazy_attribute import lazy_attribute`?



---

archive/issue_comments_469166.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-21T08:22:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469166",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_469167.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:21 gh-tobiasdiez]:\n> The same code/steps is working for me\n\n\n... in your custom setup from #30371, I assume...\n\n> and correctly reports `collected 0 items`. I think there is a problem with your setup that cythonized sage modules cannot be found. Can you manually import `from sage.misc.lazy_attribute import lazy_attribute`?\n\n\nYes.",
    "created_at": "2020-12-21T17:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469167",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>Replying to [comment:21 gh-tobiasdiez]:
> The same code/steps is working for me


... in your custom setup from #30371, I assume...

> and correctly reports `collected 0 items`. I think there is a problem with your setup that cythonized sage modules cannot be found. Can you manually import `from sage.misc.lazy_attribute import lazy_attribute`?


Yes.



---

archive/issue_comments_469168.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:23 mkoeppe]:\n> Replying to [comment:21 gh-tobiasdiez]:\n> > The same code/steps is working for me\n\n> \n> ... in your custom setup from #30371, I assume...\n\n\nNo, with `sage -sh` as you did above...",
    "created_at": "2020-12-21T20:05:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469168",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:24'></a>Replying to [comment:23 mkoeppe]:
> Replying to [comment:21 gh-tobiasdiez]:
> > The same code/steps is working for me

> 
> ... in your custom setup from #30371, I assume...


No, with `sage -sh` as you did above...



---

archive/issue_comments_469169.json:
```json
{
    "body": "<a id='comment:25'></a>So you have a working standard installation of sage now?",
    "created_at": "2020-12-21T20:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469169",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>So you have a working standard installation of sage now?



---

archive/issue_comments_469170.json:
```json
{
    "body": "<a id='comment:26'></a>Yes, after a PC upgrade and with Ubuntu 20.10 in WSL 2 and as many system packages installed it works now. I still prefer my setup from #30371 for testing things though (because of the editable install and the nice integration with vscode).",
    "created_at": "2020-12-21T20:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469170",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:26'></a>Yes, after a PC upgrade and with Ubuntu 20.10 in WSL 2 and as many system packages installed it works now. I still prefer my setup from #30371 for testing things though (because of the editable install and the nice integration with vscode).



---

archive/issue_comments_469171.json:
```json
{
    "body": "<a id='comment:27'></a>I did a bit of googling, and found essentially nothing. The closest was https://stackoverflow.com/questions/49068162/pytest-cannot-find-module-on-import-but-code-runs-just-fine/49068163#49068163 but that doesn't suggest a clear solution.",
    "created_at": "2020-12-21T20:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469171",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:27'></a>I did a bit of googling, and found essentially nothing. The closest was https://stackoverflow.com/questions/49068162/pytest-cannot-find-module-on-import-but-code-runs-just-fine/49068163#49068163 but that doesn't suggest a clear solution.



---

archive/issue_comments_469172.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:26 gh-tobiasdiez]:\n> Yes, after a PC upgrade and with Ubuntu 20.10 in WSL 2 and as many system packages installed it works now. I still prefer my setup from #30371 for testing things though (because of the editable install and the nice integration with vscode).\nGreat. So how about reducing #30371 then, finally, to something that makes the editable install work on top of the normal installation via the distribution?",
    "created_at": "2020-12-21T22:31:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469172",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>Replying to [comment:26 gh-tobiasdiez]:
> Yes, after a PC upgrade and with Ubuntu 20.10 in WSL 2 and as many system packages installed it works now. I still prefer my setup from #30371 for testing things though (because of the editable install and the nice integration with vscode).
Great. So how about reducing #30371 then, finally, to something that makes the editable install work on top of the normal installation via the distribution?



---

archive/issue_comments_469173.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-27T18:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469173",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_469174.json:
```json
{
    "body": "<a id='comment:30'></a>As discussed in #31103, `src/bin/sage-coverage`, `src/bin/sage-coverageall` will need updating so that they do not complain about `..._test.py` files.\n(They are also used by the patchbot.)",
    "created_at": "2020-12-27T18:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469174",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>As discussed in #31103, `src/bin/sage-coverage`, `src/bin/sage-coverageall` will need updating so that they do not complain about `..._test.py` files.
(They are also used by the patchbot.)



---

archive/issue_comments_469175.json:
```json
{
    "body": "<a id='comment:31'></a>Developer's guide (src/doc/en/developer/) would need updates in \n- coding_basics.rst\n- reviewer_checklist.rst",
    "created_at": "2020-12-27T18:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469175",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>Developer's guide (src/doc/en/developer/) would need updates in 
- coding_basics.rst
- reviewer_checklist.rst



---

archive/issue_comments_469176.json:
```json
{
    "body": "<a id='comment:32'></a>Can I do this as follow-up tickets? The purpose of this one here was to provide a minimal test configuration that works for sage. Using pytest in an effective way definitely needs more changes in various areas.",
    "created_at": "2020-12-27T22:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469176",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:32'></a>Can I do this as follow-up tickets? The purpose of this one here was to provide a minimal test configuration that works for sage. Using pytest in an effective way definitely needs more changes in various areas.



---

archive/issue_comments_469177.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [comment:32 gh-tobiasdiez]:\n> Can I do this as follow-up tickets?\n\nSure",
    "created_at": "2020-12-28T02:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469177",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>Replying to [comment:32 gh-tobiasdiez]:
> Can I do this as follow-up tickets?

Sure



---

archive/issue_comments_469178.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-12-28T10:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469178",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_469179.json:
```json
{
    "body": "<a id='comment:34'></a>Ok, this is now #31123.\n\nCan you please retry if it works for you? For me `sage -sh` followed by `pip install pytest` and `pytest` works. You need to run pytest from a python installation in which sage is installed including the Cython modules.",
    "created_at": "2020-12-28T10:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469179",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:34'></a>Ok, this is now #31123.

Can you please retry if it works for you? For me `sage -sh` followed by `pip install pytest` and `pytest` works. You need to run pytest from a python installation in which sage is installed including the Cython modules.



---

archive/issue_comments_469180.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-28T10:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469180",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_469181.json:
```json
{
    "body": "<a id='comment:36'></a>Still needs review.",
    "created_at": "2021-01-23T18:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469181",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:36'></a>Still needs review.



---

archive/issue_comments_469182.json:
```json
{
    "body": "<a id='comment:37'></a>The issue persists. I think the problem is that, when executing `pytest` from the `src` directory, the subdirectory `sage` (which does not have the compiled modules) shadows the installed `sage` package. So I think you need to set some option for `pytest` so that `.` is not in the path.",
    "created_at": "2021-01-23T19:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469182",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>The issue persists. I think the problem is that, when executing `pytest` from the `src` directory, the subdirectory `sage` (which does not have the compiled modules) shadows the installed `sage` package. So I think you need to set some option for `pytest` so that `.` is not in the path.



---

archive/issue_comments_469183.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-01-23T19:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469183",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_469184.json:
```json
{
    "body": "<a id='comment:38'></a>I read a bit more about it, and in order for pytest to find cython modules you need to use an editable install (that's why it was always working for me, regardless of how I started pytest). For now, I've added deprecation_test.py to the ignored list, so the issue should be fixed.",
    "created_at": "2021-01-23T21:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469184",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:38'></a>I read a bit more about it, and in order for pytest to find cython modules you need to use an editable install (that's why it was always working for me, regardless of how I started pytest). For now, I've added deprecation_test.py to the ignored list, so the issue should be fixed.



---

archive/issue_comments_469185.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-01-23T21:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469185",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_469186.json:
```json
{
    "body": "<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-23T21:21:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469186",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_469187.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-01-23T22:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469187",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_469188.json:
```json
{
    "body": "<a id='comment:40'></a>OK this looks like a nice clean no-op now.",
    "created_at": "2021-01-23T22:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469188",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>OK this looks like a nice clean no-op now.



---

archive/issue_comments_469189.json:
```json
{
    "body": "<a id='comment:41'></a>Thanks!",
    "created_at": "2021-01-23T22:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469189",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:41'></a>Thanks!



---

archive/issue_comments_469190.json:
```json
{
    "body": "<a id='comment:42'></a>Documentation doesn't build",
    "created_at": "2021-01-24T23:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469190",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:42'></a>Documentation doesn't build



---

archive/issue_comments_469191.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-01-24T23:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469191",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_469192.json:
```json
{
    "body": "<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-28T16:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469192",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_469193.json:
```json
{
    "body": "<a id='comment:44'></a>Sorry overlooked this. Since the fix was trivial, I'll put it back to \"positive review\".",
    "created_at": "2021-01-28T16:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469193",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:44'></a>Sorry overlooked this. Since the fix was trivial, I'll put it back to "positive review".



---

archive/issue_comments_469194.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-01-28T16:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469194",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_469195.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-03-07T17:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31003#issuecomment-469195",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_080965.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-07T17:06:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31003",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31003#event-80965"
}
```
