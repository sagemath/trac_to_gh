# Issue 31699: setuptools/pip/pkgconfig/packaging/importlib-metadata upgrade for Sage 9.4

archive/issues_031462.json:
```json
{
    "assignees": [],
    "body": "https://repology.org/projects/p/?inrepo=sagemath\n\n- https://setuptools.readthedocs.io/en/latest/history.html\n\n- https://pip.pypa.io/en/stable/news/\n  - Add a feature `--use-feature=in-tree-build` to build local projects in-place when installing. This is expected to become the default behavior in pip 21.3\n\nWe add two new packages that have become dependencies in the new versions: `toml`, `typing_extensions`.\n\n\n\nCC:  @kiwifb @jhpalmieri\n\nBranch: **[7a6d0b6](https://github.com/sagemath/sagetrac-mirror/commit/7a6d0b61e5fc52cd1e7dc37c03b1d370da1c8595)**\n\nReviewer: **Fran\u00e7ois Bissey, Dima Pasechnik**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31699_\n\n",
    "closed_at": "2021-06-19T20:58:22Z",
    "created_at": "2021-04-19T20:02:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "setuptools/pip/pkgconfig/packaging/importlib-metadata upgrade for Sage 9.4",
    "type": "issue",
    "updated_at": "2021-06-21T15:20:27Z",
    "url": "https://github.com/sagemath/sage/issues/31699",
    "user": "https://github.com/mkoeppe"
}
```
https://repology.org/projects/p/?inrepo=sagemath

- https://setuptools.readthedocs.io/en/latest/history.html

- https://pip.pypa.io/en/stable/news/
  - Add a feature `--use-feature=in-tree-build` to build local projects in-place when installing. This is expected to become the default behavior in pip 21.3

We add two new packages that have become dependencies in the new versions: `toml`, `typing_extensions`.



CC:  @kiwifb @jhpalmieri

Branch: **[7a6d0b6](https://github.com/sagemath/sagetrac-mirror/commit/7a6d0b61e5fc52cd1e7dc37c03b1d370da1c8595)**

Reviewer: **François Bissey, Dima Pasechnik**

Author: **Matthias Koeppe**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/31699_





---

archive/issue_events_437298.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-19T20:02:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31699#event-437298"
}
```



---

archive/issue_events_437299.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-19T20:02:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31699#event-437299"
}
```



---

archive/issue_events_437300.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-19T20:02:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31699#event-437300"
}
```



---

archive/issue_events_437301.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-19T20:02:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31699#event-437301"
}
```



---

archive/issue_comments_510044.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,2 @@\n https://repology.org/projects/p/?inrepo=sagemath\n+\n``````\n",
    "created_at": "2021-04-19T20:06:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510044",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,2 @@
 https://repology.org/projects/p/?inrepo=sagemath
+
``````




---

archive/issue_events_437302.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-19T20:06:57Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "title_is": "setuptools/pip/pkgconfig/packaging/importlib-metadata upgrade for Sage 9.4",
    "title_was": "setuptools/pip/pkgconfig upgrade for Sage 9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31699#event-437302"
}
```



---

archive/issue_comments_510045.json:
```json
{
    "body": "Branch: **[u/mkoeppe/setuptools_pip_pkgconfig_packaging_importlib_metadata_upgrade_for_sage_9_4](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/setuptools_pip_pkgconfig_packaging_importlib_metadata_upgrade_for_sage_9_4)**",
    "created_at": "2021-04-20T16:57:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510045",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/setuptools_pip_pkgconfig_packaging_importlib_metadata_upgrade_for_sage_9_4](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/setuptools_pip_pkgconfig_packaging_importlib_metadata_upgrade_for_sage_9_4)**



---

archive/issue_comments_510046.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b560ad2518dcd4f2a96bc19975ac695d607d15aa\">b560ad2</a></td><td><code>build/pkgs/setuptools: Update to 56.2.0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/20062123bce97f985c34200fd0406a7433bed7fd\">2006212</a></td><td><code>build/pkgs/pkgconfig: Update to 1.5.2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/012774f5f914574764e9d2845f9cbb1a25d141e6\">012774f</a></td><td><code>build/pkgs/packaging: Update to 20.9</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fff89bc2ff73d2261dcb04af334d0e392933898d\">fff89bc</a></td><td><code>build/pkgs/importlib_metadata: Update to 4.0.1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e14a5ede8ae98330caea1b9ffa54e115e0a0acce\">e14a5ed</a></td><td><code>build/pkgs/pip: Update to 21.1.1</code></td></tr></table>\n",
    "created_at": "2021-05-11T23:04:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510046",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b560ad2518dcd4f2a96bc19975ac695d607d15aa">b560ad2</a></td><td><code>build/pkgs/setuptools: Update to 56.2.0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/20062123bce97f985c34200fd0406a7433bed7fd">2006212</a></td><td><code>build/pkgs/pkgconfig: Update to 1.5.2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/012774f5f914574764e9d2845f9cbb1a25d141e6">012774f</a></td><td><code>build/pkgs/packaging: Update to 20.9</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fff89bc2ff73d2261dcb04af334d0e392933898d">fff89bc</a></td><td><code>build/pkgs/importlib_metadata: Update to 4.0.1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e14a5ede8ae98330caea1b9ffa54e115e0a0acce">e14a5ed</a></td><td><code>build/pkgs/pip: Update to 21.1.1</code></td></tr></table>




---

archive/issue_comments_510047.json:
```json
{
    "body": "Commit: **[e14a5ed](https://github.com/sagemath/sagetrac-mirror/commit/e14a5ede8ae98330caea1b9ffa54e115e0a0acce)**",
    "created_at": "2021-05-11T23:04:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510047",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[e14a5ed](https://github.com/sagemath/sagetrac-mirror/commit/e14a5ede8ae98330caea1b9ffa54e115e0a0acce)**



---

archive/issue_comments_510048.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2021-05-11T23:21:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510048",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_events_437303.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-11T23:21:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31699#event-437303"
}
```



---

archive/issue_comments_510049.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,7 @@\n https://repology.org/projects/p/?inrepo=sagemath\n \n+- https://setuptools.readthedocs.io/en/latest/history.html\n+\n+- https://pip.pypa.io/en/stable/news/\n+  - Add a feature `--use-feature=in-tree-build` to build local projects in-place when installing. This is expected to become the default behavior in pip 21.3\n+\n``````\n",
    "created_at": "2021-05-11T23:21:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510049",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,7 @@
 https://repology.org/projects/p/?inrepo=sagemath
 
+- https://setuptools.readthedocs.io/en/latest/history.html
+
+- https://pip.pypa.io/en/stable/news/
+  - Add a feature `--use-feature=in-tree-build` to build local projects in-place when installing. This is expected to become the default behavior in pip 21.3
+
``````




---

archive/issue_comments_510050.json:
```json
{
    "body": "Changed dependencies from **#31612** to none",
    "created_at": "2021-05-11T23:21:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510050",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#31612** to none



---

archive/issue_events_437304.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-11T23:28:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31699#event-437304"
}
```



---

archive/issue_events_437305.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-11T23:28:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31699#event-437305"
}
```



---

archive/issue_comments_510051.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThis looks like just a package update ticket right. \n\nI guess the way `pip` is usually used, building in place probably doesn't matter. However, that's bucking the trend of every other build system that are going through extra effort to let you keep your source clean.",
    "created_at": "2021-05-11T23:28:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510051",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:6" align="right">comment:6</div>

This looks like just a package update ticket right. 

I guess the way `pip` is usually used, building in place probably doesn't matter. However, that's bucking the trend of every other build system that are going through extra effort to let you keep your source clean.



---

archive/issue_comments_510052.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\n`importlib_metadata` has a \"build-system requires\": `setuptools_scm[toml]`",
    "created_at": "2021-05-11T23:30:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510052",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">comment:7</div>

`importlib_metadata` has a "build-system requires": `setuptools_scm[toml]`



---

archive/issue_comments_510053.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@kiwifb](#comment:6):\n> I guess the way `pip` is usually used, building in place probably doesn't matter. However, that's bucking the trend of every other build system that are going through extra effort to let you keep your source clean.\n\nActually it's quite relevant for us in the context of the modularized trees. We currently cannot use pip for building wheels because it does not handle our symlinks correctly. This new feature has the potential for fixing this -- but I have not checked it.",
    "created_at": "2021-05-11T23:32:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510053",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@kiwifb](#comment:6):
> I guess the way `pip` is usually used, building in place probably doesn't matter. However, that's bucking the trend of every other build system that are going through extra effort to let you keep your source clean.

Actually it's quite relevant for us in the context of the modularized trees. We currently cannot use pip for building wheels because it does not handle our symlinks correctly. This new feature has the potential for fixing this -- but I have not checked it.



---

archive/issue_comments_510054.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@mkoeppe](#comment:7):\n> `importlib_metadata` has a \"build-system requires\": `setuptools_scm[toml]`\n\nand also an \"install-requires\": `typing-extensions`",
    "created_at": "2021-05-11T23:40:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510054",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@mkoeppe](#comment:7):
> `importlib_metadata` has a "build-system requires": `setuptools_scm[toml]`

and also an "install-requires": `typing-extensions`



---

archive/issue_comments_510055.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nOK, that's a new package. I am not sure what the implication for `setuptools_scm` is. Does it need an extra plugin? Does it mean it needs to be installed a certain way? In which case why isn't it just a different package altogether?",
    "created_at": "2021-05-11T23:43:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510055",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:10" align="right">comment:10</div>

OK, that's a new package. I am not sure what the implication for `setuptools_scm` is. Does it need an extra plugin? Does it mean it needs to be installed a certain way? In which case why isn't it just a different package altogether?



---

archive/issue_comments_510056.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nOK, I get it. We need to add a new package for `toml` so it can use it. Could as well put it directly in `build-system requires`. Never mind.",
    "created_at": "2021-05-11T23:48:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510056",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:11" align="right">comment:11</div>

OK, I get it. We need to add a new package for `toml` so it can use it. Could as well put it directly in `build-system requires`. Never mind.



---

archive/issue_comments_510057.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3386fa12fa5e377d79f17f96bbed9c2479308b36\">3386fa1</a></td><td><code>build/pkgs/toml: New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/71aeec7be29d04c90ef8c1ccaff06d1feff35b1e\">71aeec7</a></td><td><code>build/pkgs/typing_extensions: New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ecdf3e17bf79246065033531d95181a96cacdd86\">ecdf3e1</a></td><td><code>build/pkgs/importlib_metadata/dependencies: Update</code></td></tr></table>\n",
    "created_at": "2021-05-11T23:50:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510057",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3386fa12fa5e377d79f17f96bbed9c2479308b36">3386fa1</a></td><td><code>build/pkgs/toml: New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/71aeec7be29d04c90ef8c1ccaff06d1feff35b1e">71aeec7</a></td><td><code>build/pkgs/typing_extensions: New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ecdf3e17bf79246065033531d95181a96cacdd86">ecdf3e1</a></td><td><code>build/pkgs/importlib_metadata/dependencies: Update</code></td></tr></table>




---

archive/issue_comments_510058.json:
```json
{
    "body": "Changed commit from **[e14a5ed](https://github.com/sagemath/sagetrac-mirror/commit/e14a5ede8ae98330caea1b9ffa54e115e0a0acce)** to **[ecdf3e1](https://github.com/sagemath/sagetrac-mirror/commit/ecdf3e17bf79246065033531d95181a96cacdd86)**",
    "created_at": "2021-05-11T23:50:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510058",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e14a5ed](https://github.com/sagemath/sagetrac-mirror/commit/e14a5ede8ae98330caea1b9ffa54e115e0a0acce)** to **[ecdf3e1](https://github.com/sagemath/sagetrac-mirror/commit/ecdf3e17bf79246065033531d95181a96cacdd86)**



---

archive/issue_events_437306.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-12T00:02:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31699#event-437306"
}
```



---

archive/issue_events_437307.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-12T00:02:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31699#event-437307"
}
```



---

archive/issue_comments_510059.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,3 +5,6 @@\n - https://pip.pypa.io/en/stable/news/\n   - Add a feature `--use-feature=in-tree-build` to build local projects in-place when installing. This is expected to become the default behavior in pip 21.3\n \n+We add two new packages that have become dependencies in the new versions: `toml`, `typing_extensions`.\n+\n+\n``````\n",
    "created_at": "2021-05-12T00:02:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510059",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,3 +5,6 @@
 - https://pip.pypa.io/en/stable/news/
   - Add a feature `--use-feature=in-tree-build` to build local projects in-place when installing. This is expected to become the default behavior in pip 21.3
 
+We add two new packages that have become dependencies in the new versions: `toml`, `typing_extensions`.
+
+
``````




---

archive/issue_comments_510060.json:
```json
{
    "body": "Reviewer: **Fran\u00e7ois Bissey**",
    "created_at": "2021-05-12T00:08:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510060",
    "user": "https://github.com/kiwifb"
}
```

Reviewer: **François Bissey**



---

archive/issue_comments_510061.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nLGTM.",
    "created_at": "2021-05-12T00:08:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510061",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:14" align="right">comment:14</div>

LGTM.



---

archive/issue_events_437308.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2021-05-12T00:08:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31699#event-437308"
}
```



---

archive/issue_events_437309.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2021-05-12T00:08:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31699#event-437309"
}
```



---

archive/issue_comments_510062.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThanks!",
    "created_at": "2021-05-12T00:23:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510062",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

Thanks!



---

archive/issue_comments_510063.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nWhere is the tarball for the new version of pkgconfig?",
    "created_at": "2021-05-28T05:24:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510063",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

Where is the tarball for the new version of pkgconfig?



---

archive/issue_comments_510064.json:
```json
{
    "body": "Changed commit from **[ecdf3e1](https://github.com/sagemath/sagetrac-mirror/commit/ecdf3e17bf79246065033531d95181a96cacdd86)** to **[ef12a3e](https://github.com/sagemath/sagetrac-mirror/commit/ef12a3e489273a6c82c8629ab61b8032a82850a6)**",
    "created_at": "2021-05-28T05:29:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510064",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ecdf3e1](https://github.com/sagemath/sagetrac-mirror/commit/ecdf3e17bf79246065033531d95181a96cacdd86)** to **[ef12a3e](https://github.com/sagemath/sagetrac-mirror/commit/ef12a3e489273a6c82c8629ab61b8032a82850a6)**



---

archive/issue_comments_510065.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef12a3e489273a6c82c8629ab61b8032a82850a6\">ef12a3e</a></td><td><code>build/pkgs/pkgconfig/checksums.ini: Add upstream_url</code></td></tr></table>\n",
    "created_at": "2021-05-28T05:29:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510065",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef12a3e489273a6c82c8629ab61b8032a82850a6">ef12a3e</a></td><td><code>build/pkgs/pkgconfig/checksums.ini: Add upstream_url</code></td></tr></table>




---

archive/issue_events_437310.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2021-05-28T05:29:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31699#event-437310"
}
```



---

archive/issue_events_437311.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2021-05-28T05:29:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31699#event-437311"
}
```



---

archive/issue_comments_510066.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a6d0b61e5fc52cd1e7dc37c03b1d370da1c8595\">7a6d0b6</a></td><td><code>build/pkgs/packaging/checksums.ini: Add upstream_url</code></td></tr></table>\n",
    "created_at": "2021-05-28T05:30:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510066",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a6d0b61e5fc52cd1e7dc37c03b1d370da1c8595">7a6d0b6</a></td><td><code>build/pkgs/packaging/checksums.ini: Add upstream_url</code></td></tr></table>




---

archive/issue_comments_510067.json:
```json
{
    "body": "Changed commit from **[ef12a3e](https://github.com/sagemath/sagetrac-mirror/commit/ef12a3e489273a6c82c8629ab61b8032a82850a6)** to **[7a6d0b6](https://github.com/sagemath/sagetrac-mirror/commit/7a6d0b61e5fc52cd1e7dc37c03b1d370da1c8595)**",
    "created_at": "2021-05-28T05:30:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510067",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ef12a3e](https://github.com/sagemath/sagetrac-mirror/commit/ef12a3e489273a6c82c8629ab61b8032a82850a6)** to **[7a6d0b6](https://github.com/sagemath/sagetrac-mirror/commit/7a6d0b61e5fc52cd1e7dc37c03b1d370da1c8595)**



---

archive/issue_comments_510068.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThanks for catching this!",
    "created_at": "2021-05-28T05:31:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510068",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

Thanks for catching this!



---

archive/issue_comments_510069.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nlgtm",
    "created_at": "2021-05-29T00:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510069",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">comment:20</div>

lgtm



---

archive/issue_comments_510070.json:
```json
{
    "body": "Changed reviewer from **Fran\u00e7ois Bissey** to **Fran\u00e7ois Bissey, Dima Pasechnik**",
    "created_at": "2021-05-29T00:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510070",
    "user": "https://github.com/dimpase"
}
```

Changed reviewer from **François Bissey** to **François Bissey, Dima Pasechnik**



---

archive/issue_events_437312.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-05-29T00:09:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31699#event-437312"
}
```



---

archive/issue_events_437313.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-05-29T00:09:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31699#event-437313"
}
```



---

archive/issue_comments_510071.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThanks!",
    "created_at": "2021-05-29T00:15:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510071",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

Thanks!



---

archive/issue_comments_510072.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/setuptools_pip_pkgconfig_packaging_importlib_metadata_upgrade_for_sage_9_4](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/setuptools_pip_pkgconfig_packaging_importlib_metadata_upgrade_for_sage_9_4)** to **[7a6d0b6](https://github.com/sagemath/sagetrac-mirror/commit/7a6d0b61e5fc52cd1e7dc37c03b1d370da1c8595)**",
    "created_at": "2021-06-19T20:58:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510072",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/setuptools_pip_pkgconfig_packaging_importlib_metadata_upgrade_for_sage_9_4](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/setuptools_pip_pkgconfig_packaging_importlib_metadata_upgrade_for_sage_9_4)** to **[7a6d0b6](https://github.com/sagemath/sagetrac-mirror/commit/7a6d0b61e5fc52cd1e7dc37c03b1d370da1c8595)**



---

archive/issue_events_437314.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-19T20:58:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31699#event-437314"
}
```



---

archive/issue_events_437315.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "89289d09dd8e835c64b4b09db5c602b33927b0a8",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-06-19T20:58:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31699#event-437315"
}
```



---

archive/issue_comments_510073.json:
```json
{
    "body": "Changed commit from **[7a6d0b6](https://github.com/sagemath/sagetrac-mirror/commit/7a6d0b61e5fc52cd1e7dc37c03b1d370da1c8595)** to none",
    "created_at": "2021-06-21T14:19:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510073",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[7a6d0b6](https://github.com/sagemath/sagetrac-mirror/commit/7a6d0b61e5fc52cd1e7dc37c03b1d370da1c8595)** to none



---

archive/issue_comments_510074.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nIt seems that the upgrade of pip broke something. Pip does not build with system python 3.8.2 on ubuntu 20.04, complaining about tornado missing gen. Undoing the upgrade fixes that.",
    "created_at": "2021-06-21T14:19:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510074",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:23" align="right">comment:23</div>

It seems that the upgrade of pip broke something. Pip does not build with system python 3.8.2 on ubuntu 20.04, complaining about tornado missing gen. Undoing the upgrade fixes that.



---

archive/issue_comments_510075.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nfull log please",
    "created_at": "2021-06-21T15:03:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510075",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:24" align="right">comment:24</div>

full log please



---

archive/issue_comments_510076.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nYes, there seems to be a weird interaction with our `tornado` installation in incremental builds. Removing the `tornado` installation in `site-packages` breaks the vicious cycle.",
    "created_at": "2021-06-21T15:04:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510076",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

Yes, there seems to be a weird interaction with our `tornado` installation in incremental builds. Removing the `tornado` installation in `site-packages` breaks the vicious cycle.



---

archive/issue_comments_510077.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nLet's see if a further upgrade of pip fixes the issues.\n\nThis item looks promising:\nhttps://pip.pypa.io/en/stable/news/#v21-1\n\"Prevent packages already-installed alongside with pip to be injected into an isolated build environment during build-time dependency population.\"",
    "created_at": "2021-06-21T15:15:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510077",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:26" align="right">comment:26</div>

Let's see if a further upgrade of pip fixes the issues.

This item looks promising:
https://pip.pypa.io/en/stable/news/#v21-1
"Prevent packages already-installed alongside with pip to be injected into an isolated build environment during build-time dependency population."



---

archive/issue_comments_510078.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI've opened #32022 for the pip upgrade, haven't tried yet",
    "created_at": "2021-06-21T15:20:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31699#issuecomment-510078",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

I've opened #32022 for the pip upgrade, haven't tried yet
