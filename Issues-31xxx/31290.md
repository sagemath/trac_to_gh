# Issue 31290: Improve error message for ecl

archive/issues_031053.json:
```json
{
    "assignees": [],
    "body": "In case the ecl evaluation results in an error, now the command string is displayed in the error message as well. Should make debugging easier if one knows which command fails.\n\n\n\n**CC:**  @dimpase @orlitzky @spaghettisalat @jhpalmieri @isuruf @kiwifb @antonio-rojas @mkoeppe\n\n**Branch:** [public/build/ecl_error](https://github.com/sagemath/sagetrac-mirror/tree/public/build/ecl_error)\n\n**Commit:** [764325f51db2327693adf60680fb0e833caa26eb](https://github.com/sagemath/sagetrac-mirror/commit/764325f51db2327693adf60680fb0e833caa26eb)\n\n**Author:** Tobias Diez\n\nIssue created by migration from https://trac.sagemath.org/ticket/31290\n\n",
    "created_at": "2021-01-25T11:44:48Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/minor",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Improve error message for ecl",
    "type": "issue",
    "updated_at": "2022-09-19T18:58:47Z",
    "url": "https://github.com/sagemath/sage/issues/31290",
    "user": "https://github.com/tobiasdiez"
}
```
In case the ecl evaluation results in an error, now the command string is displayed in the error message as well. Should make debugging easier if one knows which command fails.



**CC:**  @dimpase @orlitzky @spaghettisalat @jhpalmieri @isuruf @kiwifb @antonio-rojas @mkoeppe

**Branch:** [public/build/ecl_error](https://github.com/sagemath/sagetrac-mirror/tree/public/build/ecl_error)

**Commit:** [764325f51db2327693adf60680fb0e833caa26eb](https://github.com/sagemath/sagetrac-mirror/commit/764325f51db2327693adf60680fb0e833caa26eb)

**Author:** Tobias Diez

Issue created by migration from https://trac.sagemath.org/ticket/31290





---

archive/issue_events_379358.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-25T11:44:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-379358"
}
```



---

archive/issue_events_379359.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-25T11:44:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "08517b",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-379359"
}
```



---

archive/issue_events_379360.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-25T11:44:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "label": "https://github.com/sagemath/sage/labels/minor",
    "label_color": "ff0000",
    "label_name": "minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-379360"
}
```



---

archive/issue_events_379361.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-25T11:44:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-379361"
}
```



---

archive/issue_events_379362.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-25T11:44:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-379362"
}
```



---

archive/issue_comments_504341.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\nPlease add doctests that illustrate this",
    "created_at": "2021-01-25T19:09:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-504341",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'>**Comment 2:**</a>
Please add doctests that illustrate this



---

archive/issue_comments_504342.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/764325f51db2327693adf60680fb0e833caa26eb\">764325f</a></td><td><code>Add test</code></td></tr></table>\n",
    "created_at": "2021-01-28T16:17:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-504342",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:3'>**Comment 3:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/764325f51db2327693adf60680fb0e833caa26eb">764325f</a></td><td><code>Add test</code></td></tr></table>




---

archive/issue_comments_504343.json:
```json
{
    "body": "**Changing commit** from \"[4334f8e91bb2c526cd887d19f4239420735fa538](https://github.com/sagemath/sagetrac-mirror/commit/4334f8e91bb2c526cd887d19f4239420735fa538)\" to \"[764325f51db2327693adf60680fb0e833caa26eb](https://github.com/sagemath/sagetrac-mirror/commit/764325f51db2327693adf60680fb0e833caa26eb)\".",
    "created_at": "2021-01-28T16:17:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-504343",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[4334f8e91bb2c526cd887d19f4239420735fa538](https://github.com/sagemath/sagetrac-mirror/commit/4334f8e91bb2c526cd887d19f4239420735fa538)" to "[764325f51db2327693adf60680fb0e833caa26eb](https://github.com/sagemath/sagetrac-mirror/commit/764325f51db2327693adf60680fb0e833caa26eb)".



---

archive/issue_comments_504344.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\nDone",
    "created_at": "2021-01-28T16:17:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-504344",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:4'>**Comment 4:**</a>
Done



---

archive/issue_comments_504345.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nThere seems to be another codepath that is not covered by doctests yet",
    "created_at": "2021-01-30T01:22:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-504345",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'>**Comment 5:**</a>
There seems to be another codepath that is not covered by doctests yet



---

archive/issue_comments_504346.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\nWhich code do you mean?",
    "created_at": "2021-01-30T10:28:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-504346",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:6'>**Comment 6:**</a>
Which code do you mean?



---

archive/issue_comments_504347.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\n3 `raise` statements are changed, 1 is tested",
    "created_at": "2021-01-30T17:16:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-504347",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'>**Comment 7:**</a>
3 `raise` statements are changed, 1 is tested



---

archive/issue_events_379363.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2021-01-30T19:59:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-379363"
}
```



---

archive/issue_events_379364.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2021-01-30T19:59:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-379364"
}
```



---

archive/issue_comments_504348.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\nThis is not safe: the new code causes `str(<EclObject>)`, which requires a string conversion from ecl (which has just raised an error!). We have no info on what `EclObject` is; it could be a recursive, and therefore unprintable, data structure. Admittedly, we'd hope the object is evaluable, because that's what we just tried to do with it, and evaluable objects are usually printable (but don't have to be!!), but evaluation just went wrong, so should be careful.\n\nIn any case, you'd be catching an error that has just been constructed in `ecl_safe_eval`. If you want to improve the message, it would be better to change the raised message there. Note that the message constructed there just includes whatever ECL reported as error message. There may be a reason why ECL limits what it includes in the error message. If you want to include more ECL traceback information, then perhaps extracting it from ECL might be better.",
    "created_at": "2021-01-30T19:59:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-504348",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:8'>**Comment 8:**</a>
This is not safe: the new code causes `str(<EclObject>)`, which requires a string conversion from ecl (which has just raised an error!). We have no info on what `EclObject` is; it could be a recursive, and therefore unprintable, data structure. Admittedly, we'd hope the object is evaluable, because that's what we just tried to do with it, and evaluable objects are usually printable (but don't have to be!!), but evaluation just went wrong, so should be careful.

In any case, you'd be catching an error that has just been constructed in `ecl_safe_eval`. If you want to improve the message, it would be better to change the raised message there. Note that the message constructed there just includes whatever ECL reported as error message. There may be a reason why ECL limits what it includes in the error message. If you want to include more ECL traceback information, then perhaps extracting it from ECL might be better.



---

archive/issue_comments_504349.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nThanks for the feedback!\n\nReplying to [@nbruin](#comment%3A8):\n> In any case, you'd be catching an error that has just been constructed in `ecl_safe_eval`.\n> If you want to include more ECL traceback information, then perhaps extracting it from ECL might be better. \n\nI agree! I didn't put it in `ecl_safe_eval` as I couldn't figure out a way to convert the argument `cl_object form` to a python string.\nAs I have absolutely zero experience with ECL, I have to leave it to somebody else to convince ECL to include a full traceback in its error message.\n\nWould it be ok for now, if I print the initial (python) string passed as the constructor argument?",
    "created_at": "2021-01-30T21:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-504349",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:9'>**Comment 9:**</a>
Thanks for the feedback!

Replying to [@nbruin](#comment%3A8):
> In any case, you'd be catching an error that has just been constructed in `ecl_safe_eval`.
> If you want to include more ECL traceback information, then perhaps extracting it from ECL might be better. 

I agree! I didn't put it in `ecl_safe_eval` as I couldn't figure out a way to convert the argument `cl_object form` to a python string.
As I have absolutely zero experience with ECL, I have to leave it to somebody else to convince ECL to include a full traceback in its error message.

Would it be ok for now, if I print the initial (python) string passed as the constructor argument?



---

archive/issue_comments_504350.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-504350",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'>**Comment 10:**</a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_379365.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-379365"
}
```



---

archive/issue_events_379366.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-379366"
}
```



---

archive/issue_comments_504351.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\n@nbruin, I would appreciate your feedback and recommendation on the above idea. Thanks!",
    "created_at": "2021-05-18T07:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-504351",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:11'>**Comment 11:**</a>
@nbruin, I would appreciate your feedback and recommendation on the above idea. Thanks!



---

archive/issue_comments_504352.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31290#issuecomment-504352",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'>**Comment 12:**</a>
Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_379367.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-379367"
}
```



---

archive/issue_events_379368.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-379368"
}
```



---

archive/issue_events_379369.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-379369"
}
```



---

archive/issue_events_379370.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-379370"
}
```



---

archive/issue_events_379371.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-17T19:59:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-379371"
}
```



---

archive/issue_events_379372.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-17T19:59:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-379372"
}
```



---

archive/issue_events_379373.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-379373"
}
```



---

archive/issue_events_379374.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31290",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31290#event-379374"
}
```
