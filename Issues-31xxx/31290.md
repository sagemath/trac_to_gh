# Issue 31290: Improve error message for ecl

archive/issues_031053.json:
```json
{
    "body": "In case the ecl evaluation results in an error, now the command string is displayed in the error message as well. Should make debugging easier if one knows which command fails.\n\n\n\nCC:  @dimpase @orlitzky @spaghettisalat @jhpalmieri @isuruf @kiwifb @antonio-rojas @mkoeppe\n\nAuthor: Tobias Diez\n\nBranch: public/build/ecl_error\n\nStatus: needs_work\n\nCommit: 764325f51db2327693adf60680fb0e833caa26eb\n\nIssue created by migration from https://trac.sagemath.org/ticket/31290\n\n",
    "created_at": "2021-01-25T11:44:48Z",
    "labels": [
        "component: build",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Improve error message for ecl",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31290",
    "user": "https://github.com/tobiasdiez"
}
```
In case the ecl evaluation results in an error, now the command string is displayed in the error message as well. Should make debugging easier if one knows which command fails.



CC:  @dimpase @orlitzky @spaghettisalat @jhpalmieri @isuruf @kiwifb @antonio-rojas @mkoeppe

Author: Tobias Diez

Branch: public/build/ecl_error

Status: needs_work

Commit: 764325f51db2327693adf60680fb0e833caa26eb

Issue created by migration from https://trac.sagemath.org/ticket/31290





---

archive/issue_comments_443017.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-01-25T11:44:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-443017",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_443018.json:
```json
{
    "body": "<a id='comment:2'></a>Please add doctests that illustrate this",
    "created_at": "2021-01-25T19:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-443018",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>Please add doctests that illustrate this



---

archive/issue_comments_443019.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-28T16:17:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-443019",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_443020.json:
```json
{
    "body": "<a id='comment:4'></a>Done",
    "created_at": "2021-01-28T16:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-443020",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:4'></a>Done



---

archive/issue_comments_443021.json:
```json
{
    "body": "<a id='comment:5'></a>There seems to be another codepath that is not covered by doctests yet",
    "created_at": "2021-01-30T01:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-443021",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>There seems to be another codepath that is not covered by doctests yet



---

archive/issue_comments_443022.json:
```json
{
    "body": "<a id='comment:6'></a>Which code do you mean?",
    "created_at": "2021-01-30T10:28:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-443022",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:6'></a>Which code do you mean?



---

archive/issue_comments_443023.json:
```json
{
    "body": "<a id='comment:7'></a>3 `raise` statements are changed, 1 is tested",
    "created_at": "2021-01-30T17:16:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-443023",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>3 `raise` statements are changed, 1 is tested



---

archive/issue_comments_443024.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-01-30T19:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-443024",
    "user": "https://github.com/nbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_443025.json:
```json
{
    "body": "<a id='comment:8'></a>This is not safe: the new code causes `str(<EclObject>)`, which requires a string conversion from ecl (which has just raised an error!). We have no info on what `EclObject` is; it could be a recursive, and therefore unprintable, data structure. Admittedly, we'd hope the object is evaluable, because that's what we just tried to do with it, and evaluable objects are usually printable (but don't have to be!!), but evaluation just went wrong, so should be careful.\n\nIn any case, you'd be catching an error that has just been constructed in `ecl_safe_eval`. If you want to improve the message, it would be better to change the raised message there. Note that the message constructed there just includes whatever ECL reported as error message. There may be a reason why ECL limits what it includes in the error message. If you want to include more ECL traceback information, then perhaps extracting it from ECL might be better.",
    "created_at": "2021-01-30T19:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-443025",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:8'></a>This is not safe: the new code causes `str(<EclObject>)`, which requires a string conversion from ecl (which has just raised an error!). We have no info on what `EclObject` is; it could be a recursive, and therefore unprintable, data structure. Admittedly, we'd hope the object is evaluable, because that's what we just tried to do with it, and evaluable objects are usually printable (but don't have to be!!), but evaluation just went wrong, so should be careful.

In any case, you'd be catching an error that has just been constructed in `ecl_safe_eval`. If you want to improve the message, it would be better to change the raised message there. Note that the message constructed there just includes whatever ECL reported as error message. There may be a reason why ECL limits what it includes in the error message. If you want to include more ECL traceback information, then perhaps extracting it from ECL might be better.



---

archive/issue_comments_443026.json:
```json
{
    "body": "<a id='comment:9'></a>Thanks for the feedback!\n\nReplying to [comment:8 nbruin]:\n> In any case, you'd be catching an error that has just been constructed in `ecl_safe_eval`.\n> If you want to include more ECL traceback information, then perhaps extracting it from ECL might be better. \n\n\nI agree! I didn't put it in `ecl_safe_eval` as I couldn't figure out a way to convert the argument `cl_object form` to a python string.\nAs I have absolutely zero experience with ECL, I have to leave it to somebody else to convince ECL to include a full traceback in its error message.\n\nWould it be ok for now, if I print the initial (python) string passed as the constructor argument?",
    "created_at": "2021-01-30T21:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-443026",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:9'></a>Thanks for the feedback!

Replying to [comment:8 nbruin]:
> In any case, you'd be catching an error that has just been constructed in `ecl_safe_eval`.
> If you want to include more ECL traceback information, then perhaps extracting it from ECL might be better. 


I agree! I didn't put it in `ecl_safe_eval` as I couldn't figure out a way to convert the argument `cl_object form` to a python string.
As I have absolutely zero experience with ECL, I have to leave it to somebody else to convince ECL to include a full traceback in its error message.

Would it be ok for now, if I print the initial (python) string passed as the constructor argument?



---

archive/issue_comments_443027.json:
```json
{
    "body": "<a id='comment:10'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-443027",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_081850.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31290#event-81850"
}
```



---

archive/issue_comments_443028.json:
```json
{
    "body": "<a id='comment:11'></a>`@`nbruin, I would appreciate your feedback and recommendation on the above idea. Thanks!",
    "created_at": "2021-05-18T07:37:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-443028",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:11'></a>`@`nbruin, I would appreciate your feedback and recommendation on the above idea. Thanks!



---

archive/issue_comments_443029.json:
```json
{
    "body": "<a id='comment:12'></a>Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-443029",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_081851.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31290#event-81851"
}
```



---

archive/issue_events_081852.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31290#event-81852"
}
```



---

archive/issue_events_081853.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31290#event-81853"
}
```



---

archive/issue_events_081854.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31290#event-81854"
}
```



---

archive/issue_events_081855.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-17T19:59:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31290#event-81855"
}
```



---

archive/issue_events_081856.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-17T19:59:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31290#event-81856"
}
```



---

archive/issue_events_081857.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31290#event-81857"
}
```



---

archive/issue_events_081858.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31290#event-81858"
}
```
