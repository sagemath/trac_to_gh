# Issue 31420: Remove some monkey patching in src/sage/__init__.py

archive/issues_031183.json:
```json
{
    "body": "To make `sage` a namespace package, we need to get rid of `src/sage/__init__.py`.\n\nIt currently contains:\n- definition of `__all__` (no longer needed; has no effect on completion, neither in plain python3 nor IPython)\n- definition of `__version__` (unused)\n- preloading of `zlib` (introduced in #23122)\n- #32489: `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work\n- #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)\n- monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681); the quest to get an upstream fix merged was apparently abandoned - https://github.com/python/cpython/pull/6653\n- monkey patching of sqlite on Cygwin (introduced in #30157)\n\nIn this ticket we remove the ones that are not needed any more, and some others to another module init. #32479 and #32489 will take care of the leftovers.\n\n\n\nCC:  @kiwifb @jhpalmieri @embray\n\nBranch/Commit: af6642f9b5a8448c92f87f65da9f78d7c619f1cd\n\nReviewer: Fran\u00e7ois Bissey\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31420\n\n",
    "closed_at": "2021-09-15T22:06:13Z",
    "created_at": "2021-02-20T22:14:32Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Remove some monkey patching in src/sage/__init__.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31420",
    "user": "https://github.com/mkoeppe"
}
```
To make `sage` a namespace package, we need to get rid of `src/sage/__init__.py`.

It currently contains:
- definition of `__all__` (no longer needed; has no effect on completion, neither in plain python3 nor IPython)
- definition of `__version__` (unused)
- preloading of `zlib` (introduced in #23122)
- #32489: `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work
- #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)
- monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681); the quest to get an upstream fix merged was apparently abandoned - https://github.com/python/cpython/pull/6653
- monkey patching of sqlite on Cygwin (introduced in #30157)

In this ticket we remove the ones that are not needed any more, and some others to another module init. #32479 and #32489 will take care of the leftovers.



CC:  @kiwifb @jhpalmieri @embray

Branch/Commit: af6642f9b5a8448c92f87f65da9f78d7c619f1cd

Reviewer: François Bissey

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31420





---

archive/issue_comments_624278.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,9 +1,9 @@\n To make `sage` a namespace package, we need to get rid of `src/sage/__init__.py`.\n \n It currently contains:\n-- definition of __all__\n-- definition of __version__\n-- preloading of zlib\n+- definition of `__all__`\n+- definition of `__version__`\n+- preloading of `zlib`\n - `load_ipython_extension`\n - monkey patching of `inspect.isfunction` to support Cython functions\n - monkey patching of sqlite on Cygwin\n``````\n",
    "created_at": "2021-02-20T22:14:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624278",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,9 +1,9 @@
 To make `sage` a namespace package, we need to get rid of `src/sage/__init__.py`.
 
 It currently contains:
-- definition of __all__
-- definition of __version__
-- preloading of zlib
+- definition of `__all__`
+- definition of `__version__`
+- preloading of `zlib`
 - `load_ipython_extension`
 - monkey patching of `inspect.isfunction` to support Cython functions
 - monkey patching of sqlite on Cygwin
``````




---

archive/issue_events_082404.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31420#event-82404"
}
```



---

archive/issue_comments_624279.json:
```json
{
    "body": "<a id='comment:2'></a>Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624279",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_082405.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31420#event-82405"
}
```



---

archive/issue_events_082406.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31420#event-82406"
}
```



---

archive/issue_comments_624280.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n - definition of `__version__`\n - preloading of `zlib`\n - `load_ipython_extension`\n-- monkey patching of `inspect.isfunction` to support Cython functions\n+- #32479: monkey patching of `inspect.isfunction` to support Cython functions\n - monkey patching of sqlite on Cygwin\n \n We should review all of them, remove anything that is not needed any more, and move the rest to other module inits if possible.\n``````\n",
    "created_at": "2021-09-05T23:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624280",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 - definition of `__version__`
 - preloading of `zlib`
 - `load_ipython_extension`
-- monkey patching of `inspect.isfunction` to support Cython functions
+- #32479: monkey patching of `inspect.isfunction` to support Cython functions
 - monkey patching of sqlite on Cygwin
 
 We should review all of them, remove anything that is not needed any more, and move the rest to other module inits if possible.
``````




---

archive/issue_comments_624281.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,10 +3,11 @@\n It currently contains:\n - definition of `__all__`\n - definition of `__version__`\n-- preloading of `zlib`\n-- `load_ipython_extension`\n-- #32479: monkey patching of `inspect.isfunction` to support Cython functions\n-- monkey patching of sqlite on Cygwin\n+- preloading of `zlib` (introduced in #23122)\n+- `load_ipython_extension` (introduced in #18726)\n+- #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)\n+- monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681)\n+- monkey patching of sqlite on Cygwin (introduced in #30157)\n \n We should review all of them, remove anything that is not needed any more, and move the rest to other module inits if possible.\n \n``````\n",
    "created_at": "2021-09-07T06:03:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624281",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,10 +3,11 @@
 It currently contains:
 - definition of `__all__`
 - definition of `__version__`
-- preloading of `zlib`
-- `load_ipython_extension`
-- #32479: monkey patching of `inspect.isfunction` to support Cython functions
-- monkey patching of sqlite on Cygwin
+- preloading of `zlib` (introduced in #23122)
+- `load_ipython_extension` (introduced in #18726)
+- #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)
+- monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681)
+- monkey patching of sqlite on Cygwin (introduced in #30157)
 
 We should review all of them, remove anything that is not needed any more, and move the rest to other module inits if possible.
 
``````




---

archive/issue_comments_624282.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n - definition of `__all__`\n - definition of `__version__`\n - preloading of `zlib` (introduced in #23122)\n-- `load_ipython_extension` (introduced in #18726)\n+- `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding method that makes `%unload_ext sage` work\n - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)\n - monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681)\n - monkey patching of sqlite on Cygwin (introduced in #30157)\n``````\n",
    "created_at": "2021-09-07T06:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624282",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 - definition of `__all__`
 - definition of `__version__`
 - preloading of `zlib` (introduced in #23122)
-- `load_ipython_extension` (introduced in #18726)
+- `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding method that makes `%unload_ext sage` work
 - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)
 - monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681)
 - monkey patching of sqlite on Cygwin (introduced in #30157)
``````




---

archive/issue_comments_624283.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n - definition of `__all__`\n - definition of `__version__`\n - preloading of `zlib` (introduced in #23122)\n-- `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding method that makes `%unload_ext sage` work\n+- `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work\n - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)\n - monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681)\n - monkey patching of sqlite on Cygwin (introduced in #30157)\n``````\n",
    "created_at": "2021-09-07T06:26:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624283",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 - definition of `__all__`
 - definition of `__version__`
 - preloading of `zlib` (introduced in #23122)
-- `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding method that makes `%unload_ext sage` work
+- `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work
 - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)
 - monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681)
 - monkey patching of sqlite on Cygwin (introduced in #30157)
``````




---

archive/issue_comments_624284.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,7 +6,7 @@\n - preloading of `zlib` (introduced in #23122)\n - `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work\n - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)\n-- monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681)\n+- monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681); the quest to get an upstream fix merged was apparently abandoned - https://github.com/python/cpython/pull/6653\n - monkey patching of sqlite on Cygwin (introduced in #30157)\n \n We should review all of them, remove anything that is not needed any more, and move the rest to other module inits if possible.\n``````\n",
    "created_at": "2021-09-07T06:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624284",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,7 +6,7 @@
 - preloading of `zlib` (introduced in #23122)
 - `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work
 - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)
-- monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681)
+- monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681); the quest to get an upstream fix merged was apparently abandoned - https://github.com/python/cpython/pull/6653
 - monkey patching of sqlite on Cygwin (introduced in #30157)
 
 We should review all of them, remove anything that is not needed any more, and move the rest to other module inits if possible.
``````




---

archive/issue_comments_624285.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n It currently contains:\n - definition of `__all__`\n-- definition of `__version__`\n+- definition of `__version__` (unused)\n - preloading of `zlib` (introduced in #23122)\n - `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work\n - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)\n``````\n",
    "created_at": "2021-09-07T06:58:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624285",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 It currently contains:
 - definition of `__all__`
-- definition of `__version__`
+- definition of `__version__` (unused)
 - preloading of `zlib` (introduced in #23122)
 - `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work
 - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)
``````




---

archive/issue_comments_624286.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n To make `sage` a namespace package, we need to get rid of `src/sage/__init__.py`.\n \n It currently contains:\n-- definition of `__all__`\n+- definition of `__all__` (no longer needed; has no effect on completion, neither in plain python3 nor IPython)\n - definition of `__version__` (unused)\n - preloading of `zlib` (introduced in #23122)\n - `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work\n``````\n",
    "created_at": "2021-09-07T07:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624286",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 To make `sage` a namespace package, we need to get rid of `src/sage/__init__.py`.
 
 It currently contains:
-- definition of `__all__`
+- definition of `__all__` (no longer needed; has no effect on completion, neither in plain python3 nor IPython)
 - definition of `__version__` (unused)
 - preloading of `zlib` (introduced in #23122)
 - `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work
``````




---

archive/issue_comments_624287.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n - definition of `__all__` (no longer needed; has no effect on completion, neither in plain python3 nor IPython)\n - definition of `__version__` (unused)\n - preloading of `zlib` (introduced in #23122)\n-- `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work\n+- #32489: `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work\n - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)\n - monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681); the quest to get an upstream fix merged was apparently abandoned - https://github.com/python/cpython/pull/6653\n - monkey patching of sqlite on Cygwin (introduced in #30157)\n``````\n",
    "created_at": "2021-09-07T23:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624287",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 - definition of `__all__` (no longer needed; has no effect on completion, neither in plain python3 nor IPython)
 - definition of `__version__` (unused)
 - preloading of `zlib` (introduced in #23122)
-- `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work
+- #32489: `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work
 - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)
 - monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681); the quest to get an upstream fix merged was apparently abandoned - https://github.com/python/cpython/pull/6653
 - monkey patching of sqlite on Cygwin (introduced in #30157)
``````




---

archive/issue_comments_624288.json:
```json
{
    "body": "<a id='comment:12'></a>It seems that removing `__version__` and `__all__` is harmless. I don't know about the `zlib` issue: I tried moving the import to `all.py` and everything worked, but that's hardly an exhaustive test.",
    "created_at": "2021-09-08T20:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624288",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>It seems that removing `__version__` and `__all__` is harmless. I don't know about the `zlib` issue: I tried moving the import to `all.py` and everything worked, but that's hardly an exhaustive test.



---

archive/issue_comments_624289.json:
```json
{
    "body": "<a id='comment:13'></a>We can probably move it (and also the `sqlite` monkey-patching on cygwin) to a module that is loaded very early such as `sage.cpython.__init__`.",
    "created_at": "2021-09-08T21:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624289",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>We can probably move it (and also the `sqlite` monkey-patching on cygwin) to a module that is loaded very early such as `sage.cpython.__init__`.



---

archive/issue_comments_624290.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/meta_ticket__review_remove_monkey_patching_in_src_sage___init___py\"",
    "created_at": "2021-09-08T21:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624290",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/meta_ticket__review_remove_monkey_patching_in_src_sage___init___py"



---

archive/issue_comments_624291.json:
```json
{
    "body": "Changing commit from \"\" to \"ad587cfd90e0a06a86e1297e470a775106ea7da8\"",
    "created_at": "2021-09-08T22:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624291",
    "user": "https://github.com/jhpalmieri"
}
```

Changing commit from "" to "ad587cfd90e0a06a86e1297e470a775106ea7da8"



---

archive/issue_comments_624292.json:
```json
{
    "body": "<a id='comment:15'></a>Do you also want `del _sys`?\n\n---\nNew commits:",
    "created_at": "2021-09-08T22:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624292",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>Do you also want `del _sys`?

---
New commits:



---

archive/issue_comments_624293.json:
```json
{
    "body": "Changing commit from \"ad587cfd90e0a06a86e1297e470a775106ea7da8\" to \"af6642f9b5a8448c92f87f65da9f78d7c619f1cd\"",
    "created_at": "2021-09-08T23:03:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624293",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ad587cfd90e0a06a86e1297e470a775106ea7da8" to "af6642f9b5a8448c92f87f65da9f78d7c619f1cd"



---

archive/issue_comments_624294.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-08T23:03:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624294",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_624295.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2021-09-08T23:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624295",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_624296.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,5 +9,6 @@\n - monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681); the quest to get an upstream fix merged was apparently abandoned - https://github.com/python/cpython/pull/6653\n - monkey patching of sqlite on Cygwin (introduced in #30157)\n \n-We should review all of them, remove anything that is not needed any more, and move the rest to other module inits if possible.\n+In this ticket we remove the ones that are not needed any more, and some others to another module init. #32479 and #32489 will take care of the leftovers.\n \n+\n``````\n",
    "created_at": "2021-09-08T23:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624296",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,5 +9,6 @@
 - monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681); the quest to get an upstream fix merged was apparently abandoned - https://github.com/python/cpython/pull/6653
 - monkey patching of sqlite on Cygwin (introduced in #30157)
 
-We should review all of them, remove anything that is not needed any more, and move the rest to other module inits if possible.
+In this ticket we remove the ones that are not needed any more, and some others to another module init. #32479 and #32489 will take care of the leftovers.
 
+
``````




---

archive/issue_comments_624297.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-09-08T23:23:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624297",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_624298.json:
```json
{
    "body": "<a id='comment:19'></a>Where does the `del _zlib` come from in `sage/cpython/__init__.py`? It wasn't present in `sage/__init__.py` and the ticket above that group only talks about `import zlib`. Is mentioning that ticket obsolete? Is the whole block obsolete when we favor system zlib whenever possible?",
    "created_at": "2021-09-08T23:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624298",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>Where does the `del _zlib` come from in `sage/cpython/__init__.py`? It wasn't present in `sage/__init__.py` and the ticket above that group only talks about `import zlib`. Is mentioning that ticket obsolete? Is the whole block obsolete when we favor system zlib whenever possible?



---

archive/issue_comments_624299.json:
```json
{
    "body": "<a id='comment:20'></a>The `del` introduced in `af6642f` just removes the binding of the name `_zlib` created by the `import` statement from the `sage.cpython` module. Likewise the other `del`s in this commit.",
    "created_at": "2021-09-09T00:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624299",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>The `del` introduced in `af6642f` just removes the binding of the name `_zlib` created by the `import` statement from the `sage.cpython` module. Likewise the other `del`s in this commit.



---

archive/issue_comments_624300.json:
```json
{
    "body": "<a id='comment:21'></a>Call me obtuse, why do you import and then delete straight away? Is it a cleaner way to make sure that the right library is loaded while you may not want it around in this particular unit?",
    "created_at": "2021-09-09T00:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624300",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:21'></a>Call me obtuse, why do you import and then delete straight away? Is it a cleaner way to make sure that the right library is loaded while you may not want it around in this particular unit?



---

archive/issue_comments_624301.json:
```json
{
    "body": "<a id='comment:22'></a>The importing there is just to trigger loading some shared library.\nOne could use a function from `importlib` instead of using `import` but that's a tiny bit more obscure",
    "created_at": "2021-09-09T00:38:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624301",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>The importing there is just to trigger loading some shared library.
One could use a function from `importlib` instead of using `import` but that's a tiny bit more obscure



---

archive/issue_comments_624302.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-09T00:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624302",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_624303.json:
```json
{
    "body": "<a id='comment:23'></a>Thank you for taking the time to answer my questions. It looks good to go.",
    "created_at": "2021-09-09T00:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624303",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:23'></a>Thank you for taking the time to answer my questions. It looks good to go.



---

archive/issue_comments_624304.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fran\u00e7ois Bissey\"",
    "created_at": "2021-09-09T00:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624304",
    "user": "https://github.com/kiwifb"
}
```

Changing reviewer from "" to "François Bissey"



---

archive/issue_comments_624305.json:
```json
{
    "body": "<a id='comment:24'></a>Thanks for reviewing!",
    "created_at": "2021-09-09T00:56:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624305",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>Thanks for reviewing!



---

archive/issue_comments_624306.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/meta_ticket__review_remove_monkey_patching_in_src_sage___init___py\" to \"af6642f9b5a8448c92f87f65da9f78d7c619f1cd\"",
    "created_at": "2021-09-15T22:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624306",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/meta_ticket__review_remove_monkey_patching_in_src_sage___init___py" to "af6642f9b5a8448c92f87f65da9f78d7c619f1cd"



---

archive/issue_events_082407.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-09-15T22:06:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31420#event-82407"
}
```



---

archive/issue_comments_624307.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-09-15T22:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31420#issuecomment-624307",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
