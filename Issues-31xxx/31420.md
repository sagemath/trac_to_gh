# Issue 31420: Remove some monkey patching in src/sage/__init__.py

archive/issues_031183.json:
```json
{
    "assignees": [],
    "body": "To make `sage` a namespace package, we need to get rid of `src/sage/__init__.py`.\n\nIt currently contains:\n- definition of `__all__` (no longer needed; has no effect on completion, neither in plain python3 nor IPython)\n- definition of `__version__` (unused)\n- preloading of `zlib` (introduced in #23122)\n- #32489: `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work\n- #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)\n- monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681); the quest to get an upstream fix merged was apparently abandoned - https://github.com/python/cpython/pull/6653\n- monkey patching of sqlite on Cygwin (introduced in #30157)\n\nIn this ticket we remove the ones that are not needed any more, and some others to another module init. #32479 and #32489 will take care of the leftovers.\n\n\n\nCC:  @kiwifb @jhpalmieri @embray\n\nBranch/Commit: **[`af6642f`](https://github.com/sagemath/sagetrac-mirror/commit/af6642f9b5a8448c92f87f65da9f78d7c619f1cd)**\n\nReviewer: **Fran\u00e7ois Bissey**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **refactoring**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31420_\n\n",
    "closed_at": "2021-09-15T22:06:13Z",
    "created_at": "2021-02-20T22:14:32Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/refactoring",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Remove some monkey patching in src/sage/__init__.py",
    "type": "issue",
    "updated_at": "2021-09-15T22:06:13Z",
    "url": "https://github.com/sagemath/sage/issues/31420",
    "user": "https://github.com/mkoeppe"
}
```
To make `sage` a namespace package, we need to get rid of `src/sage/__init__.py`.

It currently contains:
- definition of `__all__` (no longer needed; has no effect on completion, neither in plain python3 nor IPython)
- definition of `__version__` (unused)
- preloading of `zlib` (introduced in #23122)
- #32489: `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work
- #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)
- monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681); the quest to get an upstream fix merged was apparently abandoned - https://github.com/python/cpython/pull/6653
- monkey patching of sqlite on Cygwin (introduced in #30157)

In this ticket we remove the ones that are not needed any more, and some others to another module init. #32479 and #32489 will take care of the leftovers.



CC:  @kiwifb @jhpalmieri @embray

Branch/Commit: **[`af6642f`](https://github.com/sagemath/sagetrac-mirror/commit/af6642f9b5a8448c92f87f65da9f78d7c619f1cd)**

Reviewer: **François Bissey**

Author: **Matthias Koeppe**

Component: **refactoring**

_Issue created by migration from https://trac.sagemath.org/ticket/31420_





---

archive/issue_events_435270.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-20T22:14:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31420#event-435270"
}
```



---

archive/issue_events_435271.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-20T22:14:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "label": "https://github.com/sagemath/sage/labels/refactoring",
    "label_color": "696969",
    "label_name": "refactoring",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31420#event-435271"
}
```



---

archive/issue_events_435272.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-20T22:14:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31420#event-435272"
}
```



---

archive/issue_events_435273.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-20T22:14:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31420#event-435273"
}
```



---

archive/issue_comments_504464.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,7 +3,7 @@\n It currently contains:\n - definition of `__all__`\n - definition of `__version__`\n-- preloading of zlib\n+- preloading of `zlib`\n - `load_ipython_extension`\n - monkey patching of `inspect.isfunction` to support Cython functions\n - monkey patching of sqlite on Cygwin\n``````\n",
    "created_at": "2021-02-20T22:14:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504464",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,7 +3,7 @@
 It currently contains:
 - definition of `__all__`
 - definition of `__version__`
-- preloading of zlib
+- preloading of `zlib`
 - `load_ipython_extension`
 - monkey patching of `inspect.isfunction` to support Cython functions
 - monkey patching of sqlite on Cygwin
``````




---

archive/issue_events_435274.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31420#event-435274"
}
```



---

archive/issue_events_435275.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31420#event-435275"
}
```



---

archive/issue_comments_504465.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nSage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504465",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">comment:2</div>

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_435276.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31420#event-435276"
}
```



---

archive/issue_events_435277.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31420#event-435277"
}
```



---

archive/issue_events_435278.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-05T23:54:06Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "title_is": "Meta-ticket: Review/remove monkey patching in src/sage/__init__.py",
    "title_was": "Review/remove monkey patching in src/sage/__init__.py",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31420#event-435278"
}
```



---

archive/issue_comments_504466.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n - definition of `__version__`\n - preloading of `zlib`\n - `load_ipython_extension`\n-- monkey patching of `inspect.isfunction` to support Cython functions\n+- #32479: monkey patching of `inspect.isfunction` to support Cython functions\n - monkey patching of sqlite on Cygwin\n \n We should review all of them, remove anything that is not needed any more, and move the rest to other module inits if possible.\n``````\n",
    "created_at": "2021-09-05T23:54:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504466",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 - definition of `__version__`
 - preloading of `zlib`
 - `load_ipython_extension`
-- monkey patching of `inspect.isfunction` to support Cython functions
+- #32479: monkey patching of `inspect.isfunction` to support Cython functions
 - monkey patching of sqlite on Cygwin
 
 We should review all of them, remove anything that is not needed any more, and move the rest to other module inits if possible.
``````




---

archive/issue_comments_504467.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,10 +3,11 @@\n It currently contains:\n - definition of `__all__`\n - definition of `__version__`\n-- preloading of `zlib`\n-- `load_ipython_extension`\n-- #32479: monkey patching of `inspect.isfunction` to support Cython functions\n-- monkey patching of sqlite on Cygwin\n+- preloading of `zlib` (introduced in #23122)\n+- `load_ipython_extension` (introduced in #18726)\n+- #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)\n+- monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681)\n+- monkey patching of sqlite on Cygwin (introduced in #30157)\n \n We should review all of them, remove anything that is not needed any more, and move the rest to other module inits if possible.\n \n``````\n",
    "created_at": "2021-09-07T06:03:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504467",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,10 +3,11 @@
 It currently contains:
 - definition of `__all__`
 - definition of `__version__`
-- preloading of `zlib`
-- `load_ipython_extension`
-- #32479: monkey patching of `inspect.isfunction` to support Cython functions
-- monkey patching of sqlite on Cygwin
+- preloading of `zlib` (introduced in #23122)
+- `load_ipython_extension` (introduced in #18726)
+- #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)
+- monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681)
+- monkey patching of sqlite on Cygwin (introduced in #30157)
 
 We should review all of them, remove anything that is not needed any more, and move the rest to other module inits if possible.
 
``````




---

archive/issue_comments_504468.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n - definition of `__all__`\n - definition of `__version__`\n - preloading of `zlib` (introduced in #23122)\n-- `load_ipython_extension` (introduced in #18726)\n+- `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding method that makes `%unload_ext sage` work\n - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)\n - monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681)\n - monkey patching of sqlite on Cygwin (introduced in #30157)\n``````\n",
    "created_at": "2021-09-07T06:25:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504468",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 - definition of `__all__`
 - definition of `__version__`
 - preloading of `zlib` (introduced in #23122)
-- `load_ipython_extension` (introduced in #18726)
+- `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding method that makes `%unload_ext sage` work
 - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)
 - monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681)
 - monkey patching of sqlite on Cygwin (introduced in #30157)
``````




---

archive/issue_comments_504469.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n - definition of `__all__`\n - definition of `__version__`\n - preloading of `zlib` (introduced in #23122)\n-- `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding method that makes `%unload_ext sage` work\n+- `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work\n - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)\n - monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681)\n - monkey patching of sqlite on Cygwin (introduced in #30157)\n``````\n",
    "created_at": "2021-09-07T06:26:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504469",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 - definition of `__all__`
 - definition of `__version__`
 - preloading of `zlib` (introduced in #23122)
-- `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding method that makes `%unload_ext sage` work
+- `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work
 - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)
 - monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681)
 - monkey patching of sqlite on Cygwin (introduced in #30157)
``````




---

archive/issue_comments_504470.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,7 +6,7 @@\n - preloading of `zlib` (introduced in #23122)\n - `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work\n - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)\n-- monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681)\n+- monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681); the quest to get an upstream fix merged was apparently abandoned - https://github.com/python/cpython/pull/6653\n - monkey patching of sqlite on Cygwin (introduced in #30157)\n \n We should review all of them, remove anything that is not needed any more, and move the rest to other module inits if possible.\n``````\n",
    "created_at": "2021-09-07T06:55:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504470",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,7 +6,7 @@
 - preloading of `zlib` (introduced in #23122)
 - `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work
 - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)
-- monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681)
+- monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681); the quest to get an upstream fix merged was apparently abandoned - https://github.com/python/cpython/pull/6653
 - monkey patching of sqlite on Cygwin (introduced in #30157)
 
 We should review all of them, remove anything that is not needed any more, and move the rest to other module inits if possible.
``````




---

archive/issue_comments_504471.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n It currently contains:\n - definition of `__all__`\n-- definition of `__version__`\n+- definition of `__version__` (unused)\n - preloading of `zlib` (introduced in #23122)\n - `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work\n - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)\n``````\n",
    "created_at": "2021-09-07T06:58:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504471",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 It currently contains:
 - definition of `__all__`
-- definition of `__version__`
+- definition of `__version__` (unused)
 - preloading of `zlib` (introduced in #23122)
 - `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work
 - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)
``````




---

archive/issue_comments_504472.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n To make `sage` a namespace package, we need to get rid of `src/sage/__init__.py`.\n \n It currently contains:\n-- definition of `__all__`\n+- definition of `__all__` (no longer needed; has no effect on completion, neither in plain python3 nor IPython)\n - definition of `__version__` (unused)\n - preloading of `zlib` (introduced in #23122)\n - `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work\n``````\n",
    "created_at": "2021-09-07T07:03:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504472",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 To make `sage` a namespace package, we need to get rid of `src/sage/__init__.py`.
 
 It currently contains:
-- definition of `__all__`
+- definition of `__all__` (no longer needed; has no effect on completion, neither in plain python3 nor IPython)
 - definition of `__version__` (unused)
 - preloading of `zlib` (introduced in #23122)
 - `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work
``````




---

archive/issue_comments_504473.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n - definition of `__all__` (no longer needed; has no effect on completion, neither in plain python3 nor IPython)\n - definition of `__version__` (unused)\n - preloading of `zlib` (introduced in #23122)\n-- `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work\n+- #32489: `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work\n - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)\n - monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681); the quest to get an upstream fix merged was apparently abandoned - https://github.com/python/cpython/pull/6653\n - monkey patching of sqlite on Cygwin (introduced in #30157)\n``````\n",
    "created_at": "2021-09-07T23:21:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504473",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 - definition of `__all__` (no longer needed; has no effect on completion, neither in plain python3 nor IPython)
 - definition of `__version__` (unused)
 - preloading of `zlib` (introduced in #23122)
-- `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work
+- #32489: `load_ipython_extension` (introduced in #18726): This function is defined in module `sage` so that `%load_ext sage` works (see http://www.slabbe.org/blogue/categorie/ipython/); we forgot to define the corresponding function that would make `%unload_ext sage` work
 - #32479: monkey patching of `inspect.isfunction` to support Cython functions (introduced in #25373)
 - monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681); the quest to get an upstream fix merged was apparently abandoned - https://github.com/python/cpython/pull/6653
 - monkey patching of sqlite on Cygwin (introduced in #30157)
``````




---

archive/issue_comments_504474.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nIt seems that removing `__version__` and `__all__` is harmless. I don't know about the `zlib` issue: I tried moving the import to `all.py` and everything worked, but that's hardly an exhaustive test.",
    "created_at": "2021-09-08T20:48:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504474",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

It seems that removing `__version__` and `__all__` is harmless. I don't know about the `zlib` issue: I tried moving the import to `all.py` and everything worked, but that's hardly an exhaustive test.



---

archive/issue_comments_504475.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nWe can probably move it (and also the `sqlite` monkey-patching on cygwin) to a module that is loaded very early such as `sage.cpython.__init__`.",
    "created_at": "2021-09-08T21:17:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504475",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">comment:13</div>

We can probably move it (and also the `sqlite` monkey-patching on cygwin) to a module that is loaded very early such as `sage.cpython.__init__`.



---

archive/issue_comments_504476.json:
```json
{
    "body": "Branch: **[u/mkoeppe/meta_ticket__review_remove_monkey_patching_in_src_sage___init___py](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/meta_ticket__review_remove_monkey_patching_in_src_sage___init___py)**",
    "created_at": "2021-09-08T21:41:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504476",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/meta_ticket__review_remove_monkey_patching_in_src_sage___init___py](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/meta_ticket__review_remove_monkey_patching_in_src_sage___init___py)**



---

archive/issue_comments_504477.json:
```json
{
    "body": "Commit: **[`ad587cf`](https://github.com/sagemath/sagetrac-mirror/commit/ad587cfd90e0a06a86e1297e470a775106ea7da8)**",
    "created_at": "2021-09-08T22:54:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504477",
    "user": "https://github.com/jhpalmieri"
}
```

Commit: **[`ad587cf`](https://github.com/sagemath/sagetrac-mirror/commit/ad587cfd90e0a06a86e1297e470a775106ea7da8)**



---

archive/issue_comments_504478.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nDo you also want `del _sys`?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/91ec0f2afe7ac22cb9af91da5121109fec92d1ca\"><code>91ec0f2</code></a></td><td><code>src/sage/__init__.py: Remove __all__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/949d787041a94b812cd76faced705fed83e5594c\"><code>949d787</code></a></td><td><code>src/sage/__init__.py: Remove __version__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f77a98e4429616ec293e632a2ebba880181858ea\"><code>f77a98e</code></a></td><td><code>src/sage/__init__.py: Move 'import zlib' to src/sage/cpython/__init__.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e9ea5682c04214c3bfcb8ca3cee1e1ba6e5150c\"><code>2e9ea56</code></a></td><td><code>src/sage/__init__.py: Move monkey-patch of ExtensionFileLoader to src/sage/cpython/__init__.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ad587cfd90e0a06a86e1297e470a775106ea7da8\"><code>ad587cf</code></a></td><td><code>src/sage/__init__.py [Cygwin]: Move monkey-patch of sqlite to src/sage/cpython/__init__.py</code></td></tr></table>\n",
    "created_at": "2021-09-08T22:54:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504478",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:15" align="right">comment:15</div>

Do you also want `del _sys`?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/91ec0f2afe7ac22cb9af91da5121109fec92d1ca"><code>91ec0f2</code></a></td><td><code>src/sage/__init__.py: Remove __all__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/949d787041a94b812cd76faced705fed83e5594c"><code>949d787</code></a></td><td><code>src/sage/__init__.py: Remove __version__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f77a98e4429616ec293e632a2ebba880181858ea"><code>f77a98e</code></a></td><td><code>src/sage/__init__.py: Move 'import zlib' to src/sage/cpython/__init__.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e9ea5682c04214c3bfcb8ca3cee1e1ba6e5150c"><code>2e9ea56</code></a></td><td><code>src/sage/__init__.py: Move monkey-patch of ExtensionFileLoader to src/sage/cpython/__init__.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ad587cfd90e0a06a86e1297e470a775106ea7da8"><code>ad587cf</code></a></td><td><code>src/sage/__init__.py [Cygwin]: Move monkey-patch of sqlite to src/sage/cpython/__init__.py</code></td></tr></table>




---

archive/issue_comments_504479.json:
```json
{
    "body": "Changed commit from **[`ad587cf`](https://github.com/sagemath/sagetrac-mirror/commit/ad587cfd90e0a06a86e1297e470a775106ea7da8)** to **[`af6642f`](https://github.com/sagemath/sagetrac-mirror/commit/af6642f9b5a8448c92f87f65da9f78d7c619f1cd)**",
    "created_at": "2021-09-08T23:03:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504479",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ad587cf`](https://github.com/sagemath/sagetrac-mirror/commit/ad587cfd90e0a06a86e1297e470a775106ea7da8)** to **[`af6642f`](https://github.com/sagemath/sagetrac-mirror/commit/af6642f9b5a8448c92f87f65da9f78d7c619f1cd)**



---

archive/issue_comments_504480.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af6642f9b5a8448c92f87f65da9f78d7c619f1cd\"><code>af6642f</code></a></td><td><code>src/sage/cpython/__init__.py: Clean up sage.cpython module</code></td></tr></table>\n",
    "created_at": "2021-09-08T23:03:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504480",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af6642f9b5a8448c92f87f65da9f78d7c619f1cd"><code>af6642f</code></a></td><td><code>src/sage/cpython/__init__.py: Clean up sage.cpython module</code></td></tr></table>




---

archive/issue_comments_504481.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2021-09-08T23:23:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504481",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_504482.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,5 +9,6 @@\n - monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681); the quest to get an upstream fix merged was apparently abandoned - https://github.com/python/cpython/pull/6653\n - monkey patching of sqlite on Cygwin (introduced in #30157)\n \n-We should review all of them, remove anything that is not needed any more, and move the rest to other module inits if possible.\n+In this ticket we remove the ones that are not needed any more, and some others to another module init. #32479 and #32489 will take care of the leftovers.\n \n+\n``````\n",
    "created_at": "2021-09-08T23:23:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504482",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,5 +9,6 @@
 - monkey patching of `importlib.machinery.ExtensionFileLoader` (introduced in #24681); the quest to get an upstream fix merged was apparently abandoned - https://github.com/python/cpython/pull/6653
 - monkey patching of sqlite on Cygwin (introduced in #30157)
 
-We should review all of them, remove anything that is not needed any more, and move the rest to other module inits if possible.
+In this ticket we remove the ones that are not needed any more, and some others to another module init. #32479 and #32489 will take care of the leftovers.
 
+
``````




---

archive/issue_events_435279.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-08T23:23:50Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "title_is": "Remove some monkey patching in src/sage/__init__.py",
    "title_was": "Meta-ticket: Review/remove monkey patching in src/sage/__init__.py",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31420#event-435279"
}
```



---

archive/issue_events_435280.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-08T23:23:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31420#event-435280"
}
```



---

archive/issue_comments_504483.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nWhere does the `del _zlib` come from in `sage/cpython/__init__.py`? It wasn't present in `sage/__init__.py` and the ticket above that group only talks about `import zlib`. Is mentioning that ticket obsolete? Is the whole block obsolete when we favor system zlib whenever possible?",
    "created_at": "2021-09-08T23:33:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504483",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:19" align="right">comment:19</div>

Where does the `del _zlib` come from in `sage/cpython/__init__.py`? It wasn't present in `sage/__init__.py` and the ticket above that group only talks about `import zlib`. Is mentioning that ticket obsolete? Is the whole block obsolete when we favor system zlib whenever possible?



---

archive/issue_comments_504484.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThe `del` introduced in `af6642f` just removes the binding of the name `_zlib` created by the `import` statement from the `sage.cpython` module. Likewise the other `del`s in this commit.",
    "created_at": "2021-09-09T00:25:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504484",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

The `del` introduced in `af6642f` just removes the binding of the name `_zlib` created by the `import` statement from the `sage.cpython` module. Likewise the other `del`s in this commit.



---

archive/issue_comments_504485.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nCall me obtuse, why do you import and then delete straight away? Is it a cleaner way to make sure that the right library is loaded while you may not want it around in this particular unit?",
    "created_at": "2021-09-09T00:32:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504485",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:21" align="right">comment:21</div>

Call me obtuse, why do you import and then delete straight away? Is it a cleaner way to make sure that the right library is loaded while you may not want it around in this particular unit?



---

archive/issue_comments_504486.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThe importing there is just to trigger loading some shared library.\nOne could use a function from `importlib` instead of using `import` but that's a tiny bit more obscure",
    "created_at": "2021-09-09T00:38:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504486",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

The importing there is just to trigger loading some shared library.
One could use a function from `importlib` instead of using `import` but that's a tiny bit more obscure



---

archive/issue_events_435281.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2021-09-09T00:41:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31420#event-435281"
}
```



---

archive/issue_events_435282.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2021-09-09T00:41:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31420#event-435282"
}
```



---

archive/issue_comments_504487.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThank you for taking the time to answer my questions. It looks good to go.",
    "created_at": "2021-09-09T00:41:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504487",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:23" align="right">comment:23</div>

Thank you for taking the time to answer my questions. It looks good to go.



---

archive/issue_comments_504488.json:
```json
{
    "body": "Reviewer: **Fran\u00e7ois Bissey**",
    "created_at": "2021-09-09T00:41:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504488",
    "user": "https://github.com/kiwifb"
}
```

Reviewer: **François Bissey**



---

archive/issue_comments_504489.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThanks for reviewing!",
    "created_at": "2021-09-09T00:56:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504489",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

Thanks for reviewing!



---

archive/issue_comments_504490.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/meta_ticket__review_remove_monkey_patching_in_src_sage___init___py](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/meta_ticket__review_remove_monkey_patching_in_src_sage___init___py)** to **[`af6642f`](https://github.com/sagemath/sagetrac-mirror/commit/af6642f9b5a8448c92f87f65da9f78d7c619f1cd)**",
    "created_at": "2021-09-15T22:06:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31420#issuecomment-504490",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/meta_ticket__review_remove_monkey_patching_in_src_sage___init___py](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/meta_ticket__review_remove_monkey_patching_in_src_sage___init___py)** to **[`af6642f`](https://github.com/sagemath/sagetrac-mirror/commit/af6642f9b5a8448c92f87f65da9f78d7c619f1cd)**



---

archive/issue_events_435283.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-09-15T22:06:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31420#event-435283"
}
```



---

archive/issue_events_435284.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "fe82bc50e736b3ff88067f3506a99e2e7ba9f3bb",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-09-15T22:06:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31420",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31420#event-435284"
}
```
