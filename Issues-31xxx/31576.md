# Issue 31576: Projective points over rings with zero divisors

archive/issues_031339.json:
```json
{
    "body": "Currently, creating a point in a projective space\nover a ring accepts any tuple of the correct length\nas input, unless all coordinates are zero.\n\nFor instance,\n\n```\nsage: P2 = ProjectiveSpace(Integers(15), 2)\nsage: P2(3, 3, 3)\n(3 : 3 : 3)\n```\nis allowed.\n\nThat is a bad convention as they should only be allowed\nif they generate the ring. Here, at least one entry\nmust be a unit.\n\nThe equality between points is tested by the equations\n`x[i] * y[j] = x[j] * y[i]`.\n\nWith the troublesome entries above, this results in errors like\n\n```\nsage: a = P2(3, 3, 3)\nsage: a2 = P2(1, 1, 1)\nsage: b = P2(5, -5, 5)\nsage: b2 = P2(1, -1, 1)\nsage: [a2 == a, a == b, b == b2, b2 == a2]\n[True, True, True, False]\n```\n\nAuthors of #17433, where the relevant code\nwas last modified, are added in cc here.\n\n\nCC:  @bhutz jdefaria @slel\n\nKeywords: projective points\n\nBranch/Commit: f09dae941dc1dfe784c877c78e655013c6a22d0b\n\nReviewer: Samuel Leli\u00e8vre, Travis Scrimshaw\n\nAuthor: Lorenz Panny\n\nDependencies: #33237\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31576\n\n",
    "closed_at": "2022-02-27T22:00:45Z",
    "created_at": "2021-03-28T21:02:14Z",
    "labels": [
        "component: algebraic geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Projective points over rings with zero divisors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31576",
    "user": "https://github.com/categorie"
}
```
Currently, creating a point in a projective space
over a ring accepts any tuple of the correct length
as input, unless all coordinates are zero.

For instance,

```
sage: P2 = ProjectiveSpace(Integers(15), 2)
sage: P2(3, 3, 3)
(3 : 3 : 3)
```
is allowed.

That is a bad convention as they should only be allowed
if they generate the ring. Here, at least one entry
must be a unit.

The equality between points is tested by the equations
`x[i] * y[j] = x[j] * y[i]`.

With the troublesome entries above, this results in errors like

```
sage: a = P2(3, 3, 3)
sage: a2 = P2(1, 1, 1)
sage: b = P2(5, -5, 5)
sage: b2 = P2(1, -1, 1)
sage: [a2 == a, a == b, b == b2, b2 == a2]
[True, True, True, False]
```

Authors of #17433, where the relevant code
was last modified, are added in cc here.


CC:  @bhutz jdefaria @slel

Keywords: projective points

Branch/Commit: f09dae941dc1dfe784c877c78e655013c6a22d0b

Reviewer: Samuel Leli√®vre, Travis Scrimshaw

Author: Lorenz Panny

Dependencies: #33237

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31576





---

archive/issue_events_083027.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-10T17:30:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31576",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31576#event-83027"
}
```



---

archive/issue_events_083028.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31576",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31576#event-83028"
}
```



---

archive/issue_events_083029.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31576",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31576#event-83029"
}
```



---

archive/issue_comments_478365.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-01-28T08:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31576#issuecomment-478365",
    "user": "https://github.com/yyyyx4"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_478366.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2022-01-28T08:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31576#issuecomment-478366",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_478367.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,26 +1,37 @@\n-Currently a point of a projective space over a ring is an accepted input unless all coordinates are zero. For instance,\n+Currently, creating a point in a projective space\n+over a ring accepts any tuple of the correct length\n+as input, unless all coordinates are zero.\n+\n+For instance,\n \n ```\n-sage: P2 = ProjectiveSpace(Integers(15),2)      \n-sage: P2(3,3,3)                                                                                                                                        \n+sage: P2 = ProjectiveSpace(Integers(15), 2)\n+sage: P2(3, 3, 3)\n (3 : 3 : 3)\n ```\n is allowed.\n-That is a bad convention as they should only be allowed if they generate the ring. Here, at least one entry must be a unit.\n \n-The equality between points is tested by the equations `x[i]*y[j]=x[j]*y[i]`\n-With the troublesome entries above this results in errors like\n+That is a bad convention as they should only be allowed\n+if they generate the ring. Here, at least one entry\n+must be a unit.\n+\n+The equality between points is tested by the equations\n+`x[i] * y[j] = x[j] * y[i]`.\n+\n+With the troublesome entries above, this results in errors like\n \n ```\n-sage: a = P2(3,3,3)\n-sage: a2 = P2(1,1,1)                                                                                                                                   \n-sage: b = P2(5,-5,5)                                                                                                                                   \n-sage: b2 = P2(1,-1,1)\n-sage: [a2==a,a==b,b==b2,b2==a2]    \n+sage: a = P2(3, 3, 3)\n+sage: a2 = P2(1, 1, 1)\n+sage: b = P2(5, -5, 5)\n+sage: b2 = P2(1, -1, 1)\n+sage: [a2 == a, a == b, b == b2, b2 == a2]\n [True, True, True, False]\n ```\n-    \n-It seems this code was last modified in #17433, so I CC these authors there.\n+\n+Authors of #17433, where the relevant code\n+was last modified, are added in cc here.\n+\n \n Comment: 1\n \n``````\n",
    "created_at": "2022-01-28T08:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31576#issuecomment-478367",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,26 +1,37 @@
-Currently a point of a projective space over a ring is an accepted input unless all coordinates are zero. For instance,
+Currently, creating a point in a projective space
+over a ring accepts any tuple of the correct length
+as input, unless all coordinates are zero.
+
+For instance,
 
 ```
-sage: P2 = ProjectiveSpace(Integers(15),2)      
-sage: P2(3,3,3)                                                                                                                                        
+sage: P2 = ProjectiveSpace(Integers(15), 2)
+sage: P2(3, 3, 3)
 (3 : 3 : 3)
 ```
 is allowed.
-That is a bad convention as they should only be allowed if they generate the ring. Here, at least one entry must be a unit.
 
-The equality between points is tested by the equations `x[i]*y[j]=x[j]*y[i]`
-With the troublesome entries above this results in errors like
+That is a bad convention as they should only be allowed
+if they generate the ring. Here, at least one entry
+must be a unit.
+
+The equality between points is tested by the equations
+`x[i] * y[j] = x[j] * y[i]`.
+
+With the troublesome entries above, this results in errors like
 
 ```
-sage: a = P2(3,3,3)
-sage: a2 = P2(1,1,1)                                                                                                                                   
-sage: b = P2(5,-5,5)                                                                                                                                   
-sage: b2 = P2(1,-1,1)
-sage: [a2==a,a==b,b==b2,b2==a2]    
+sage: a = P2(3, 3, 3)
+sage: a2 = P2(1, 1, 1)
+sage: b = P2(5, -5, 5)
+sage: b2 = P2(1, -1, 1)
+sage: [a2 == a, a == b, b == b2, b2 == a2]
 [True, True, True, False]
 ```
-    
-It seems this code was last modified in #17433, so I CC these authors there.
+
+Authors of #17433, where the relevant code
+was last modified, are added in cc here.
+
 
 Comment: 1
 
``````




---

archive/issue_comments_478368.json:
```json
{
    "body": "<a id='comment:5'></a>I disagree with the ticket's summary.\n\nThe projective space over `Z/m`, with m composite,\nhas two types of points:\n\n- points whose coordinates generate the ring\n- points whose coordinates do not generate the ring\n\nBoth types of points are valid. See\n\n- [Wikipedia: Projective line over a ring](https://en.wikipedia.org/wiki/Projective_line_over_a_ring)\n\nPhrased otherwise, not all lines in `(Z/m)^n`\nhave the same number of points.\n\nSometimes only points of the first type matter,\nother times both types are useful.",
    "created_at": "2022-01-28T09:43:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31576#issuecomment-478368",
    "user": "https://github.com/slel"
}
```

<a id='comment:5'></a>I disagree with the ticket's summary.

The projective space over `Z/m`, with m composite,
has two types of points:

- points whose coordinates generate the ring
- points whose coordinates do not generate the ring

Both types of points are valid. See

- [Wikipedia: Projective line over a ring](https://en.wikipedia.org/wiki/Projective_line_over_a_ring)

Phrased otherwise, not all lines in `(Z/m)^n`
have the same number of points.

Sometimes only points of the first type matter,
other times both types are useful.



---

archive/issue_comments_478369.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 slelievre]:\n> The projective space over `Z/m`, with m composite,\n> has two types of points:\n> \n> - points whose coordinates generate the ring\n> - points whose coordinates do not generate the ring\n\n\nNo, I disagree and the linked page as well! A point in `P^n` over a ring `R` is `(x_0:..x_n)` with `x_0R+...+x_nR = R` quotient by the equivalence relation which is scaling by units in `R`.\nYour second kind is not a point. This agrees with viewing `P^n` as a scheme over R and taking its `R`-valued points. It follows that `P^1(Z/pq)` is `P^1(Z/p) x P^1(Z/q)`, that it is the union of affine patches as usual, etc.\n\nYour confusion may stem from the following: Not every equivalence class has the same number of elements in `R^(n+1)`. But that is not the issue here (or ever when dealing projective geometry, I believe).",
    "created_at": "2022-01-28T10:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31576#issuecomment-478369",
    "user": "https://github.com/categorie"
}
```

<a id='comment:6'></a>Replying to [comment:5 slelievre]:
> The projective space over `Z/m`, with m composite,
> has two types of points:
> 
> - points whose coordinates generate the ring
> - points whose coordinates do not generate the ring


No, I disagree and the linked page as well! A point in `P^n` over a ring `R` is `(x_0:..x_n)` with `x_0R+...+x_nR = R` quotient by the equivalence relation which is scaling by units in `R`.
Your second kind is not a point. This agrees with viewing `P^n` as a scheme over R and taking its `R`-valued points. It follows that `P^1(Z/pq)` is `P^1(Z/p) x P^1(Z/q)`, that it is the union of affine patches as usual, etc.

Your confusion may stem from the following: Not every equivalence class has the same number of elements in `R^(n+1)`. But that is not the issue here (or ever when dealing projective geometry, I believe).



---

archive/issue_comments_478370.json:
```json
{
    "body": "<a id='comment:7'></a>You are of course right. Thanks for unconfusing me.\n\nDoes the documentation have examples such as the following?\n\n```\nsage: P1 = ProjectiveSpace(Zmod(6), 1)\nsage: P1(2, 3)\n```",
    "created_at": "2022-01-29T11:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31576#issuecomment-478370",
    "user": "https://github.com/slel"
}
```

<a id='comment:7'></a>You are of course right. Thanks for unconfusing me.

Does the documentation have examples such as the following?

```
sage: P1 = ProjectiveSpace(Zmod(6), 1)
sage: P1(2, 3)
```



---

archive/issue_comments_478371.json:
```json
{
    "body": "<a id='comment:8'></a>Looks good.\n\nOptionally, wrap long lines, e.g. as follows.\n\n```diff\n-                    raise ValueError(f\"{v} does not define a point in {X.codomain()} since all entries are zero\")\n+                    raise ValueError(f\"{v} does not define a point \"\n+                                     f\"in {X.codomain()} \"\n+                                     \"since all entries are zero\")\n```\n\n```diff\n-                    raise ValueError(f\"{v} does not define a point in {X.codomain()} since it is a multiple of a zero divisor\")\n+                    raise ValueError(f\"{v} does not define a point \"\n+                                     f\"in {X.codomain()} since it is \"\n+                                     \"a multiple of a zero divisor\")\n```",
    "created_at": "2022-01-29T11:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31576#issuecomment-478371",
    "user": "https://github.com/slel"
}
```

<a id='comment:8'></a>Looks good.

Optionally, wrap long lines, e.g. as follows.

```diff
-                    raise ValueError(f"{v} does not define a point in {X.codomain()} since all entries are zero")
+                    raise ValueError(f"{v} does not define a point "
+                                     f"in {X.codomain()} "
+                                     "since all entries are zero")
```

```diff
-                    raise ValueError(f"{v} does not define a point in {X.codomain()} since it is a multiple of a zero divisor")
+                    raise ValueError(f"{v} does not define a point "
+                                     f"in {X.codomain()} since it is "
+                                     "a multiple of a zero divisor")
```



---

archive/issue_comments_478372.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-29T17:05:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31576#issuecomment-478372",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478373.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-29T17:13:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31576#issuecomment-478373",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478374.json:
```json
{
    "body": "<a id='comment:11'></a>Done, and also fixed some more doctests. The remaining failures should disappear with #33237.",
    "created_at": "2022-01-29T17:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31576#issuecomment-478374",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:11'></a>Done, and also fixed some more doctests. The remaining failures should disappear with #33237.



---

archive/issue_comments_478375.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-21T05:51:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31576#issuecomment-478375",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478376.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-22T05:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31576#issuecomment-478376",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_478377.json:
```json
{
    "body": "<a id='comment:13'></a>The latest changes LGTM. Given comment:8, I am setting a positive review.",
    "created_at": "2022-02-22T05:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31576#issuecomment-478377",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>The latest changes LGTM. Given comment:8, I am setting a positive review.



---

archive/issue_events_083030.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-27T22:00:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31576",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31576#event-83030"
}
```



---

archive/issue_comments_478378.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-27T22:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31576#issuecomment-478378",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
