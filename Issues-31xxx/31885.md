# Issue 31885: Allow cross compiling

archive/issues_031648.json:
```json
{
    "assignees": [],
    "body": "one make use of the `AC_RUN_IFELSE` feature to skip tests if cross-compiling.\n\nCC:  @kiwifb @mkoeppe @dimpase\n\nBranch/Commit: **[a089bf7](https://github.com/sagemath/sagetrac-mirror/commit/a089bf7954dfd24446279ce5f9ab77c838f062e7)**\n\nReviewer: **Dima Pasechnik**\n\nAuthor: **Isuru Fernando**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31885_\n\n",
    "closed_at": "2021-06-29T17:40:45Z",
    "created_at": "2021-05-31T06:56:15Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Allow cross compiling",
    "type": "issue",
    "updated_at": "2021-06-29T17:40:45Z",
    "url": "https://github.com/sagemath/sage/issues/31885",
    "user": "https://github.com/isuruf"
}
```
one make use of the `AC_RUN_IFELSE` feature to skip tests if cross-compiling.

CC:  @kiwifb @mkoeppe @dimpase

Branch/Commit: **[a089bf7](https://github.com/sagemath/sagetrac-mirror/commit/a089bf7954dfd24446279ce5f9ab77c838f062e7)**

Reviewer: **Dima Pasechnik**

Author: **Isuru Fernando**

_Issue created by migration from https://trac.sagemath.org/ticket/31885_





---

archive/issue_events_421376.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2021-05-31T06:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31885#event-421376"
}
```



---

archive/issue_events_421377.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2021-05-31T06:56:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build%3A%20configure",
    "label_color": "000080",
    "label_name": "component: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31885#event-421377"
}
```



---

archive/issue_events_421378.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2021-05-31T06:56:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31885#event-421378"
}
```



---

archive/issue_events_421379.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2021-05-31T06:56:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31885#event-421379"
}
```



---

archive/issue_events_421380.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2021-05-31T07:00:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31885#event-421380"
}
```



---

archive/issue_comments_515553.json:
```json
{
    "body": "Changed commit from **[7e7c762](https://github.com/sagemath/sagetrac-mirror/commit/7e7c7627820e9abdf1abbd7c96a988f29169ac0e)** to **[57a5e2a](https://github.com/sagemath/sagetrac-mirror/commit/57a5e2a22ec023bff68ad5fcaa6bda9590fd6c46)**",
    "created_at": "2021-05-31T07:11:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515553",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7e7c762](https://github.com/sagemath/sagetrac-mirror/commit/7e7c7627820e9abdf1abbd7c96a988f29169ac0e)** to **[57a5e2a](https://github.com/sagemath/sagetrac-mirror/commit/57a5e2a22ec023bff68ad5fcaa6bda9590fd6c46)**



---

archive/issue_comments_515554.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57a5e2a22ec023bff68ad5fcaa6bda9590fd6c46\">57a5e2a</a></td><td><code>allow cross compiling</code></td></tr></table>\n",
    "created_at": "2021-05-31T07:11:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515554",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:2'>Comment 2:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57a5e2a22ec023bff68ad5fcaa6bda9590fd6c46">57a5e2a</a></td><td><code>allow cross compiling</code></td></tr></table>




---

archive/issue_comments_515555.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nWhy is trac automerging failing? Are you basing it on 9.3 or 9.4.beta0?\n\nIt otherwise looks OK but I would not know if it is complete or need more changes.",
    "created_at": "2021-05-31T07:22:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515555",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'>Comment 3:</a>
Why is trac automerging failing? Are you basing it on 9.3 or 9.4.beta0?

It otherwise looks OK but I would not know if it is complete or need more changes.



---

archive/issue_comments_515556.json:
```json
{
    "body": "Changed commit from **[57a5e2a](https://github.com/sagemath/sagetrac-mirror/commit/57a5e2a22ec023bff68ad5fcaa6bda9590fd6c46)** to **[f9e8d59](https://github.com/sagemath/sagetrac-mirror/commit/f9e8d5999a98ed454f79d428ff245d19cae18fdc)**",
    "created_at": "2021-05-31T07:31:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515556",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[57a5e2a](https://github.com/sagemath/sagetrac-mirror/commit/57a5e2a22ec023bff68ad5fcaa6bda9590fd6c46)** to **[f9e8d59](https://github.com/sagemath/sagetrac-mirror/commit/f9e8d5999a98ed454f79d428ff245d19cae18fdc)**



---

archive/issue_comments_515557.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9e8d5999a98ed454f79d428ff245d19cae18fdc\">f9e8d59</a></td><td><code>allow cross compiling</code></td></tr></table>\n",
    "created_at": "2021-05-31T07:31:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515557",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:4'>Comment 4:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9e8d5999a98ed454f79d428ff245d19cae18fdc">f9e8d59</a></td><td><code>allow cross compiling</code></td></tr></table>




---

archive/issue_comments_515558.json:
```json
{
    "body": "Changed commit from **[f9e8d59](https://github.com/sagemath/sagetrac-mirror/commit/f9e8d5999a98ed454f79d428ff245d19cae18fdc)** to **[a089bf7](https://github.com/sagemath/sagetrac-mirror/commit/a089bf7954dfd24446279ce5f9ab77c838f062e7)**",
    "created_at": "2021-05-31T07:36:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515558",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f9e8d59](https://github.com/sagemath/sagetrac-mirror/commit/f9e8d5999a98ed454f79d428ff245d19cae18fdc)** to **[a089bf7](https://github.com/sagemath/sagetrac-mirror/commit/a089bf7954dfd24446279ce5f9ab77c838f062e7)**



---

archive/issue_comments_515559.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a089bf7954dfd24446279ce5f9ab77c838f062e7\">a089bf7</a></td><td><code>allow cross compiling</code></td></tr></table>\n",
    "created_at": "2021-05-31T07:36:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515559",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:5'>Comment 5:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a089bf7954dfd24446279ce5f9ab77c838f062e7">a089bf7</a></td><td><code>allow cross compiling</code></td></tr></table>




---

archive/issue_comments_515560.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nReplying to [@kiwifb](#comment%3A3):\n> Why is trac automerging failing? Are you basing it on 9.3 or 9.4.beta0?\n\nYes, that was it. I was basing it off of 9.3. Fixed now\n\n> It otherwise looks OK but I would not know if it is complete or need more changes.\n\nThanks. I'm cross compiling for Apple silicon. With this patch I can compile sage-the-library. Got a couple more dependencies to build before I can start sage",
    "created_at": "2021-05-31T16:14:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515560",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:6'>Comment 6:</a>
Replying to [@kiwifb](#comment%3A3):
> Why is trac automerging failing? Are you basing it on 9.3 or 9.4.beta0?

Yes, that was it. I was basing it off of 9.3. Fixed now

> It otherwise looks OK but I would not know if it is complete or need more changes.

Thanks. I'm cross compiling for Apple silicon. With this patch I can compile sage-the-library. Got a couple more dependencies to build before I can start sage



---

archive/issue_comments_515561.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nWhat's the procedure to test this? My guess is that you're not building any of the Python dependencies of sagelib - the installation procedure wouldn't allow to install the built wheels of the wrong architecture",
    "created_at": "2021-05-31T17:13:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515561",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'>Comment 7:</a>
What's the procedure to test this? My guess is that you're not building any of the Python dependencies of sagelib - the installation procedure wouldn't allow to install the built wheels of the wrong architecture



---

archive/issue_comments_515562.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nIt's complicated to test this. I'm using https://github.com/benfogle/crossenv/ in conda-forge to setup an osx-x86_64 -> osx-arm64 cross compiling setup.",
    "created_at": "2021-05-31T18:09:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515562",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:8'>Comment 8:</a>
It's complicated to test this. I'm using https://github.com/benfogle/crossenv/ in conda-forge to setup an osx-x86_64 -> osx-arm64 cross compiling setup.



---

archive/issue_comments_515563.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nI was able to cross compile most of sagelib dependencies including python extensions. Only holdouts were NTL, pari and maxima.",
    "created_at": "2021-05-31T18:14:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515563",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:9'>Comment 9:</a>
I was able to cross compile most of sagelib dependencies including python extensions. Only holdouts were NTL, pari and maxima.



---

archive/issue_comments_515564.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nReplying to [@mkoeppe](#comment%3A7):\n> What's the procedure to test this? My guess is that you're not building any of the Python dependencies of sagelib - the installation procedure wouldn't allow to install the built wheels of the wrong architecture\n\nI am tempted to agree to include it if\n 1) it doesn't have side effects on normal setup\n\n 2) it is not a bloat bomb\n\nThis is experimental level of support. If and when it becomes more mainstream we will need to devise formal ways of testing it.",
    "created_at": "2021-05-31T21:43:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515564",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'>Comment 10:</a>
Replying to [@mkoeppe](#comment%3A7):
> What's the procedure to test this? My guess is that you're not building any of the Python dependencies of sagelib - the installation procedure wouldn't allow to install the built wheels of the wrong architecture

I am tempted to agree to include it if
 1) it doesn't have side effects on normal setup

 2) it is not a bloat bomb

This is experimental level of support. If and when it becomes more mainstream we will need to devise formal ways of testing it.



---

archive/issue_comments_515565.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\n> 1) it doesn't have side effects on normal setup\n\nIt doesn't. This only modifies cross compile actions of `AC_TRY_RUN`, `AC_RUN_IFELSE`, etc.",
    "created_at": "2021-05-31T22:06:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515565",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:11'>Comment 11:</a>
> 1) it doesn't have side effects on normal setup

It doesn't. This only modifies cross compile actions of `AC_TRY_RUN`, `AC_RUN_IFELSE`, etc.



---

archive/issue_comments_515566.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nisn't this fixed in #30668",
    "created_at": "2021-06-01T16:26:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515566",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'>Comment 12:</a>
isn't this fixed in #30668



---

archive/issue_comments_515567.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nthese are deprecated autoconf macros we replaced in #30668",
    "created_at": "2021-06-01T16:27:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515567",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'>Comment 13:</a>
these are deprecated autoconf macros we replaced in #30668



---

archive/issue_comments_515568.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nIt's not. That ticket only touches ppl, but there are more packages that need support.",
    "created_at": "2021-06-01T16:47:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515568",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:14'>Comment 14:</a>
It's not. That ticket only touches ppl, but there are more packages that need support.



---

archive/issue_comments_515569.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nanyhow, could you rebase on #30668 ?",
    "created_at": "2021-06-01T20:41:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515569",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'>Comment 15:</a>
anyhow, could you rebase on #30668 ?



---

archive/issue_events_421381.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-06-03T09:59:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31885#event-421381"
}
```



---

archive/issue_events_421382.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-06-03T09:59:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31885#event-421382"
}
```



---

archive/issue_comments_515570.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2021-06-03T09:59:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515570",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_515571.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nit looks OK to me, but I didn't check the actual cross-compiling.",
    "created_at": "2021-06-03T09:59:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515571",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'>Comment 16:</a>
it looks OK to me, but I didn't check the actual cross-compiling.



---

archive/issue_comments_515572.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+one make use of the `AC_RUN_IFELSE` feature to skip tests if cross-compiling.\n``````\n",
    "created_at": "2021-06-03T10:02:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515572",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+one make use of the `AC_RUN_IFELSE` feature to skip tests if cross-compiling.
``````




---

archive/issue_comments_515573.json:
```json
{
    "body": "Changed branch from **[u/isuruf/cross](https://github.com/sagemath/sagetrac-mirror/tree/u/isuruf/cross)** to **[a089bf7](https://github.com/sagemath/sagetrac-mirror/commit/a089bf7954dfd24446279ce5f9ab77c838f062e7)**",
    "created_at": "2021-06-29T17:40:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31885#issuecomment-515573",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/isuruf/cross](https://github.com/sagemath/sagetrac-mirror/tree/u/isuruf/cross)** to **[a089bf7](https://github.com/sagemath/sagetrac-mirror/commit/a089bf7954dfd24446279ce5f9ab77c838f062e7)**



---

archive/issue_events_421383.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-29T17:40:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31885#event-421383"
}
```



---

archive/issue_events_421384.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "abd31ad81d7723d4144b7c9d486d92358da34532",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-06-29T17:40:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31885",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31885#event-421384"
}
```
