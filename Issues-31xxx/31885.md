# Issue 31885: Allow cross compiling

archive/issues_031648.json:
```json
{
    "body": "one make use of the `AC_RUN_IFELSE` feature to skip tests if cross-compiling.\n\nCC:  @kiwifb @mkoeppe @dimpase\n\nBranch/Commit: a089bf7954dfd24446279ce5f9ab77c838f062e7\n\nReviewer: Dima Pasechnik\n\nAuthor: Isuru Fernando\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31885\n\n",
    "closed_at": "2021-06-29T17:40:45Z",
    "created_at": "2021-05-31T06:56:15Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Allow cross compiling",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31885",
    "user": "https://github.com/isuruf"
}
```
one make use of the `AC_RUN_IFELSE` feature to skip tests if cross-compiling.

CC:  @kiwifb @mkoeppe @dimpase

Branch/Commit: a089bf7954dfd24446279ce5f9ab77c838f062e7

Reviewer: Dima Pasechnik

Author: Isuru Fernando

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31885





---

archive/issue_comments_633737.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-05-31T07:00:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633737",
    "user": "https://github.com/isuruf"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_633738.json:
```json
{
    "body": "Changing commit from \"7e7c7627820e9abdf1abbd7c96a988f29169ac0e\" to \"57a5e2a22ec023bff68ad5fcaa6bda9590fd6c46\"",
    "created_at": "2021-05-31T07:11:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633738",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7e7c7627820e9abdf1abbd7c96a988f29169ac0e" to "57a5e2a22ec023bff68ad5fcaa6bda9590fd6c46"



---

archive/issue_comments_633739.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-05-31T07:11:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633739",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_633740.json:
```json
{
    "body": "<a id='comment:3'></a>Why is trac automerging failing? Are you basing it on 9.3 or 9.4.beta0?\n\nIt otherwise looks OK but I would not know if it is complete or need more changes.",
    "created_at": "2021-05-31T07:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633740",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>Why is trac automerging failing? Are you basing it on 9.3 or 9.4.beta0?

It otherwise looks OK but I would not know if it is complete or need more changes.



---

archive/issue_comments_633741.json:
```json
{
    "body": "Changing commit from \"57a5e2a22ec023bff68ad5fcaa6bda9590fd6c46\" to \"f9e8d5999a98ed454f79d428ff245d19cae18fdc\"",
    "created_at": "2021-05-31T07:31:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633741",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "57a5e2a22ec023bff68ad5fcaa6bda9590fd6c46" to "f9e8d5999a98ed454f79d428ff245d19cae18fdc"



---

archive/issue_comments_633742.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-05-31T07:31:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633742",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_633743.json:
```json
{
    "body": "Changing commit from \"f9e8d5999a98ed454f79d428ff245d19cae18fdc\" to \"a089bf7954dfd24446279ce5f9ab77c838f062e7\"",
    "created_at": "2021-05-31T07:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633743",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f9e8d5999a98ed454f79d428ff245d19cae18fdc" to "a089bf7954dfd24446279ce5f9ab77c838f062e7"



---

archive/issue_comments_633744.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-05-31T07:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633744",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_633745.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:3 fbissey]:\n> Why is trac automerging failing? Are you basing it on 9.3 or 9.4.beta0?\n\n\nYes, that was it. I was basing it off of 9.3. Fixed now\n\n> It otherwise looks OK but I would not know if it is complete or need more changes.\n\n\nThanks. I'm cross compiling for Apple silicon. With this patch I can compile sage-the-library. Got a couple more dependencies to build before I can start sage",
    "created_at": "2021-05-31T16:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633745",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:6'></a>Replying to [comment:3 fbissey]:
> Why is trac automerging failing? Are you basing it on 9.3 or 9.4.beta0?


Yes, that was it. I was basing it off of 9.3. Fixed now

> It otherwise looks OK but I would not know if it is complete or need more changes.


Thanks. I'm cross compiling for Apple silicon. With this patch I can compile sage-the-library. Got a couple more dependencies to build before I can start sage



---

archive/issue_comments_633746.json:
```json
{
    "body": "<a id='comment:7'></a>What's the procedure to test this? My guess is that you're not building any of the Python dependencies of sagelib - the installation procedure wouldn't allow to install the built wheels of the wrong architecture",
    "created_at": "2021-05-31T17:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633746",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>What's the procedure to test this? My guess is that you're not building any of the Python dependencies of sagelib - the installation procedure wouldn't allow to install the built wheels of the wrong architecture



---

archive/issue_comments_633747.json:
```json
{
    "body": "<a id='comment:8'></a>It's complicated to test this. I'm using https://github.com/benfogle/crossenv/ in conda-forge to setup an osx-x86_64 -> osx-arm64 cross compiling setup.",
    "created_at": "2021-05-31T18:09:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633747",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:8'></a>It's complicated to test this. I'm using https://github.com/benfogle/crossenv/ in conda-forge to setup an osx-x86_64 -> osx-arm64 cross compiling setup.



---

archive/issue_comments_633748.json:
```json
{
    "body": "<a id='comment:9'></a>I was able to cross compile most of sagelib dependencies including python extensions. Only holdouts were NTL, pari and maxima.",
    "created_at": "2021-05-31T18:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633748",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:9'></a>I was able to cross compile most of sagelib dependencies including python extensions. Only holdouts were NTL, pari and maxima.



---

archive/issue_comments_633749.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:7 mkoeppe]:\n> What's the procedure to test this? My guess is that you're not building any of the Python dependencies of sagelib - the installation procedure wouldn't allow to install the built wheels of the wrong architecture\n\n\nI am tempted to agree to include it if\n 1) it doesn't have side effects on normal setup\n\n 2) it is not a bloat bomb\n\nThis is experimental level of support. If and when it becomes more mainstream we will need to devise formal ways of testing it.",
    "created_at": "2021-05-31T21:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633749",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>Replying to [comment:7 mkoeppe]:
> What's the procedure to test this? My guess is that you're not building any of the Python dependencies of sagelib - the installation procedure wouldn't allow to install the built wheels of the wrong architecture


I am tempted to agree to include it if
 1) it doesn't have side effects on normal setup

 2) it is not a bloat bomb

This is experimental level of support. If and when it becomes more mainstream we will need to devise formal ways of testing it.



---

archive/issue_comments_633750.json:
```json
{
    "body": "<a id='comment:11'></a>> 1) it doesn't have side effects on normal setup\n\n\nIt doesn't. This only modifies cross compile actions of `AC_TRY_RUN`, `AC_RUN_IFELSE`, etc.",
    "created_at": "2021-05-31T22:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633750",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:11'></a>> 1) it doesn't have side effects on normal setup


It doesn't. This only modifies cross compile actions of `AC_TRY_RUN`, `AC_RUN_IFELSE`, etc.



---

archive/issue_comments_633751.json:
```json
{
    "body": "<a id='comment:12'></a>isn't this fixed in #30668",
    "created_at": "2021-06-01T16:26:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633751",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>isn't this fixed in #30668



---

archive/issue_comments_633752.json:
```json
{
    "body": "<a id='comment:13'></a>these are deprecated autoconf macros we replaced in #30668",
    "created_at": "2021-06-01T16:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633752",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>these are deprecated autoconf macros we replaced in #30668



---

archive/issue_comments_633753.json:
```json
{
    "body": "<a id='comment:14'></a>It's not. That ticket only touches ppl, but there are more packages that need support.",
    "created_at": "2021-06-01T16:47:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633753",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:14'></a>It's not. That ticket only touches ppl, but there are more packages that need support.



---

archive/issue_comments_633754.json:
```json
{
    "body": "<a id='comment:15'></a>anyhow, could you rebase on #30668 ?",
    "created_at": "2021-06-01T20:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633754",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>anyhow, could you rebase on #30668 ?



---

archive/issue_comments_633755.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-03T09:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633755",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_633756.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2021-06-03T09:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633756",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_633757.json:
```json
{
    "body": "<a id='comment:16'></a>it looks OK to me, but I didn't check the actual cross-compiling.",
    "created_at": "2021-06-03T09:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633757",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>it looks OK to me, but I didn't check the actual cross-compiling.



---

archive/issue_comments_633758.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+one make use of the `AC_RUN_IFELSE` feature to skip tests if cross-compiling.\n \n Author: Isuru Fernando\n \n``````\n",
    "created_at": "2021-06-03T10:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633758",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+one make use of the `AC_RUN_IFELSE` feature to skip tests if cross-compiling.
 
 Author: Isuru Fernando
 
``````




---

archive/issue_comments_633759.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-06-29T17:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633759",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_633760.json:
```json
{
    "body": "Changing branch from \"u/isuruf/cross\" to \"a089bf7954dfd24446279ce5f9ab77c838f062e7\"",
    "created_at": "2021-06-29T17:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31885#issuecomment-633760",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/isuruf/cross" to "a089bf7954dfd24446279ce5f9ab77c838f062e7"



---

archive/issue_events_084219.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-29T17:40:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31885",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31885#event-84219"
}
```
