# Issue 31333: sage.env.sage_include_directories: Remove hard dependency on numpy

archive/issues_031096.json:
```json
{
    "body": "(extracted from and needed for #29865)\n\n`sage_include_directories` returns the basic list of include directories for compiling extensions, not including directories obtained through pkgconfig etc.  This basic list includes directories supplied by numpy. This is fine for the monolithic Sage library because `numpy` is a standard package; but in the course of modularization, we will have various distributions that do not need the dependency on numpy. \nWe use try/expect around the import and call to numpy.\n\n\n\nCC:  @kiwifb @tobiasdiez\n\nBranch/Commit: 4550eb6a753930c5818b63049f2eec197470ed1f\n\nReviewer: Fran\u00e7ois Bissey\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/31333\n\n",
    "closed_at": "2021-06-29T23:08:49Z",
    "created_at": "2021-02-03T22:57:29Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "sage.env.sage_include_directories: Remove hard dependency on numpy",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31333",
    "user": "https://github.com/mkoeppe"
}
```
(extracted from and needed for #29865)

`sage_include_directories` returns the basic list of include directories for compiling extensions, not including directories obtained through pkgconfig etc.  This basic list includes directories supplied by numpy. This is fine for the monolithic Sage library because `numpy` is a standard package; but in the course of modularization, we will have various distributions that do not need the dependency on numpy. 
We use try/expect around the import and call to numpy.



CC:  @kiwifb @tobiasdiez

Branch/Commit: 4550eb6a753930c5818b63049f2eec197470ed1f

Reviewer: François Bissey

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/31333





---

archive/issue_comments_622242.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/sage_env_sage_include_directories__remove_hard_dependency_on_numpy\"",
    "created_at": "2021-02-04T00:03:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622242",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/sage_env_sage_include_directories__remove_hard_dependency_on_numpy"



---

archive/issue_comments_622243.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2021-02-04T00:04:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622243",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_622244.json:
```json
{
    "body": "Changing commit from \"\" to \"19776a3b5de2e534cb3a4abc51c2826e02108779\"",
    "created_at": "2021-02-04T00:04:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622244",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "19776a3b5de2e534cb3a4abc51c2826e02108779"



---

archive/issue_comments_622245.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|\n|[19776a3](https://github.com/sagemath/sagetrac-mirror/commit/19776a3b5de2e534cb3a4abc51c2826e02108779)|`sage.env.sage_include_directories: Do not fail if numpy cannot be imported`|",
    "created_at": "2021-02-04T00:04:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622245",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|
|[19776a3](https://github.com/sagemath/sagetrac-mirror/commit/19776a3b5de2e534cb3a4abc51c2826e02108779)|`sage.env.sage_include_directories: Do not fail if numpy cannot be imported`|



---

archive/issue_comments_622246.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-02-04T00:04:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622246",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_622247.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+(extracted from #29865)\n``````\n",
    "created_at": "2021-02-04T00:04:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622247",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+(extracted from #29865)
``````




---

archive/issue_comments_622248.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------|\n|[e16ba2d](https://github.com/sagemath/sagetrac-mirror/commit/e16ba2d93ed0c7df263e0b5f2976938c9373223e)|`src/sage/doctest/control.py: Do not fail if sage.libs.arb cannot be imported`|",
    "created_at": "2021-02-04T00:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622248",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                              |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------|
|[e16ba2d](https://github.com/sagemath/sagetrac-mirror/commit/e16ba2d93ed0c7df263e0b5f2976938c9373223e)|`src/sage/doctest/control.py: Do not fail if sage.libs.arb cannot be imported`|



---

archive/issue_comments_622249.json:
```json
{
    "body": "Changing commit from \"19776a3b5de2e534cb3a4abc51c2826e02108779\" to \"e16ba2d93ed0c7df263e0b5f2976938c9373223e\"",
    "created_at": "2021-02-04T00:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622249",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "19776a3b5de2e534cb3a4abc51c2826e02108779" to "e16ba2d93ed0c7df263e0b5f2976938c9373223e"



---

archive/issue_comments_622250.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-02-04T00:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622250",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_622251.json:
```json
{
    "body": "Changing commit from \"e16ba2d93ed0c7df263e0b5f2976938c9373223e\" to \"19776a3b5de2e534cb3a4abc51c2826e02108779\"",
    "created_at": "2021-02-04T00:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622251",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e16ba2d93ed0c7df263e0b5f2976938c9373223e" to "19776a3b5de2e534cb3a4abc51c2826e02108779"



---

archive/issue_comments_622252.json:
```json
{
    "body": "<a id='comment:5'></a>\nI think there should still be a log message if numpy couldn't be found, since otherwise errors further down the compile chain might be hard to track down.",
    "created_at": "2021-02-13T13:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622252",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:5'></a>
I think there should still be a log message if numpy couldn't be found, since otherwise errors further down the compile chain might be hard to track down.



---

archive/issue_events_092405.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-14T20:20:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31333#event-92405"
}
```



---

archive/issue_comments_622253.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|\n|[4550eb6](https://github.com/sagemath/sagetrac-mirror/commit/4550eb6a753930c5818b63049f2eec197470ed1f)|`sage.env.sage_include_directories: Do not fail if numpy cannot be imported`|",
    "created_at": "2021-06-25T22:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622253",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|
|[4550eb6](https://github.com/sagemath/sagetrac-mirror/commit/4550eb6a753930c5818b63049f2eec197470ed1f)|`sage.env.sage_include_directories: Do not fail if numpy cannot be imported`|



---

archive/issue_comments_622254.json:
```json
{
    "body": "Changing commit from \"19776a3b5de2e534cb3a4abc51c2826e02108779\" to \"4550eb6a753930c5818b63049f2eec197470ed1f\"",
    "created_at": "2021-06-25T22:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622254",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "19776a3b5de2e534cb3a4abc51c2826e02108779" to "4550eb6a753930c5818b63049f2eec197470ed1f"



---

archive/issue_comments_622255.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,2 @@\n-(extracted from #29865)\n+(extracted from and needed for #29865)\n+\n``````\n",
    "created_at": "2021-06-25T22:14:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622255",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,2 @@
-(extracted from #29865)
+(extracted from and needed for #29865)
+
``````




---

archive/issue_comments_622256.json:
```json
{
    "body": "<a id='comment:9'></a>\nThe branch looks fine. Can the description be a bit more verbose on what this change will achieve? Obviously it makes the thing touched more resilient but for what purpose.",
    "created_at": "2021-06-26T01:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622256",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
The branch looks fine. Can the description be a bit more verbose on what this change will achieve? Obviously it makes the thing touched more resilient but for what purpose.



---

archive/issue_comments_622257.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,6 @@\n (extracted from and needed for #29865)\n \n+`sage_include_directories` returns the basic list of include directories for compiling extensions, not including directories obtained through pkgconfig etc.  This basic list includes directories supplied by numpy. This is fine for the monolithic Sage library because `numpy` is a standard package; but in the course of modularization, we will have various distributions that do not need the dependency on numpy. \n+We use try/expect around the import and call to numpy.\n+\n+\n``````\n",
    "created_at": "2021-06-26T01:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622257",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,6 @@
 (extracted from and needed for #29865)
 
+`sage_include_directories` returns the basic list of include directories for compiling extensions, not including directories obtained through pkgconfig etc.  This basic list includes directories supplied by numpy. This is fine for the monolithic Sage library because `numpy` is a standard package; but in the course of modularization, we will have various distributions that do not need the dependency on numpy. 
+We use try/expect around the import and call to numpy.
+
+
``````




---

archive/issue_comments_622258.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-26T01:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622258",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_622259.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fran\u00e7ois Bissey\"",
    "created_at": "2021-06-26T01:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622259",
    "user": "https://github.com/kiwifb"
}
```

Changing reviewer from "" to "François Bissey"



---

archive/issue_comments_622260.json:
```json
{
    "body": "<a id='comment:11'></a>\nLGTM.",
    "created_at": "2021-06-26T01:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622260",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>
LGTM.



---

archive/issue_comments_622261.json:
```json
{
    "body": "<a id='comment:12'></a>\nThanks!",
    "created_at": "2021-06-26T01:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622261",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
Thanks!



---

archive/issue_comments_622262.json:
```json
{
    "body": "<a id='comment:13'></a>\n\n```\n+    try:\n+        import numpy\n+        dirs.append(numpy.get_include())\n+    except ModuleNotFoundError:\n+        pass\n```\n\nShould this not better print an error message in case numpy is not found?",
    "created_at": "2021-06-26T05:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622262",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:13'></a>

```
+    try:
+        import numpy
+        dirs.append(numpy.get_include())
+    except ModuleNotFoundError:
+        pass
```

Should this not better print an error message in case numpy is not found?



---

archive/issue_comments_622263.json:
```json
{
    "body": "<a id='comment:14'></a>\nNo, the whole point of this ticket is that it's not an error.",
    "created_at": "2021-06-26T05:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622263",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
No, the whole point of this ticket is that it's not an error.



---

archive/issue_events_092406.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-29T23:08:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31333#event-92406"
}
```



---

archive/issue_comments_622264.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/sage_env_sage_include_directories__remove_hard_dependency_on_numpy\" to \"4550eb6a753930c5818b63049f2eec197470ed1f\"",
    "created_at": "2021-06-29T23:08:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622264",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/sage_env_sage_include_directories__remove_hard_dependency_on_numpy" to "4550eb6a753930c5818b63049f2eec197470ed1f"



---

archive/issue_comments_622265.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-06-29T23:08:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31333#issuecomment-622265",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
