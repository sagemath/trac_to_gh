# Issue 31381: Fix the handling of the orientation of edges provided by the edge_option of G.graphviz_string

archive/issues_031144.json:
```json
{
    "assignees": [],
    "body": "The documentation of `G.graphviz_string` says:\n\n```\nsage: f(x) = -1 / x\nsage: g(x) = 1 / (x + 1)\nsage: G = DiGraph()\nsage: G.add_edges((i, f(i), f) for i in (1, 2, 1/2, 1/4))\nsage: G.add_edges((i, g(i), g) for i in (1, 2, 1/2, 1/4))\n\n[...]\n\nsage: def edge_options(data):\n....:     u, v, label = data\n....:     options = {\"color\": {f: \"red\", g: \"blue\"}[label]}\n....:     if (u,v) == (1/2, -2): options[\"label\"]       = \"coucou\"; options[\"label_style\"] = \"string\"\n....:     if (u,v) == (1/2,2/3): options[\"dot\"]         = \"x=1,y=2\"\n....:     if (u,v) == (1,   -1): options[\"label_style\"] = \"latex\"\n....:     if (u,v) == (1,  1/2): options[\"edge_string\"] = \"<-\"\n....:     if (u,v) == (1/2,  1): options[\"backward\"]    = True\n....:     return options\nsage: print(G.graphviz_string(edge_options=edge_options))  # random\ndigraph {                                                                                           \n  node_0  [label=\"-1\"];                      \n  node_1  [label=\"-1/2\"];          \n  node_2  [label=\"1/2\"];            \n  node_3  [label=\"-2\"];                                                                             \n  node_4  [label=\"1/4\"];            \n  node_5  [label=\"-4\"];             \n  node_6  [label=\"1/3\"];             \n  node_7  [label=\"2/3\"];\n  node_8  [label=\"4/5\"];                          \n  node_9  [label=\"1\"];                            \n  node_10  [label=\"2\"];                                                                             \n                                                  \n  node_2 -> node_3 [label=\"coucou\", color = \"red\"];                  \n  node_2 -> node_7 [x=1,y=2, color = \"blue\"];     \n  node_4 -> node_5 [color = \"red\"];               \n  node_4 -> node_8 [color = \"blue\"];              \n  node_9 -> node_0 [label=\" \", texlbl=\"$x \\ {\\mapsto}\\ -\\frac{1}{x}$\", color = \"red\"];\n  node_9 <- node_2 [color = \"blue\"];\n  node_10 -> node_1 [color = \"red\"];\n  node_10 -> node_6 [color = \"blue\"];\n}\n```\n\nThe above output is invalid according to the dot language because `<-` is not allowed (http://www.graphviz.org/doc/info/lang.html). Processing it with graphviz + dot2tex, for example using the `TikzPicture` module of the slabbe package, we obtain a broken image:\n\n```\nsage: from slabbe import TikzPicture\nsage: TikzPicture.from_graph(G, edge_options=edge_options).pdf()\n```\n\n![](https://github.com/sagemath/sage/files/ticket31381/28a6c9371d3d3c9223b25362e865bf57.png\u200b)\n\nCompared to:\n\n```\nsage: TikzPicture.from_graph(G).pdf()\n```\n\n![](https://github.com/sagemath/sage/files/ticket31381/0734ee56819e63534f4eb2c5e3b4da96.png\u200b)\n\nIn this ticket, we fix the above by returning a ValueError if the `edge_string` is invalid with respect to the dot language.\n\nWe also improve the code by allowing the user to choose the direction of each edge to be none, forward, backward or both as explained here http://www.graphviz.org/doc/info/attrs.html#k:dirType:\n\n```\nsage: edges = [(0,1,'a'), (1,2,'b'), (2,3,'c'), (3,4,'d')]                             \nsage: G = DiGraph(edges)          \nsage: def edge_options(data): \n....:     u,v,label = data \n....:     if label == 'a': return {'dir':'forward'} \n....:     if label == 'b': return {'dir':'back'} \n....:     if label == 'c': return {'dir':'none'} \n....:     if label == 'd': return {'dir':'both'} \nsage: print(G.graphviz_string(edge_options=edge_options))                          \ndigraph {\n  node_0  [label=\"0\"];\n  node_1  [label=\"1\"];\n  node_2  [label=\"2\"];\n  node_3  [label=\"3\"];\n  node_4  [label=\"4\"];\n\n  node_0 -> node_1;\n  node_1 -> node_2 [dir=back];\n  node_2 -> node_3 [dir=none];\n  node_3 -> node_4 [dir=both];\n}\nsage: TikzPicture.from_graph(G, edge_options=edge_options).pdf()                                         \n```\n\n![](https://github.com/sagemath/sage/files/ticket31381/ce19c6046f04e0e662a1cdf3554395d0.png\u200b)\n\nAs a consequence, we deprecate `{'backward':True}` in favor of the more versatile `{'dir':'back'}`.\n\nBranch: **[`4cfdde3`](https://github.com/sagemath/sagetrac-mirror/commit/4cfdde3859985728d45497d1459b99d29ddafb04)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton**\n\nAuthor: **S\u00e9bastien Labb\u00e9**\n\nComponent: **graph theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/31381_\n\n",
    "closed_at": "2021-03-09T00:01:31Z",
    "created_at": "2021-02-11T11:33:11Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix the handling of the orientation of edges provided by the edge_option of G.graphviz_string",
    "type": "issue",
    "updated_at": "2021-08-30T22:25:26Z",
    "url": "https://github.com/sagemath/sage/issues/31381",
    "user": "https://github.com/seblabbe"
}
```
The documentation of `G.graphviz_string` says:

```
sage: f(x) = -1 / x
sage: g(x) = 1 / (x + 1)
sage: G = DiGraph()
sage: G.add_edges((i, f(i), f) for i in (1, 2, 1/2, 1/4))
sage: G.add_edges((i, g(i), g) for i in (1, 2, 1/2, 1/4))

[...]

sage: def edge_options(data):
....:     u, v, label = data
....:     options = {"color": {f: "red", g: "blue"}[label]}
....:     if (u,v) == (1/2, -2): options["label"]       = "coucou"; options["label_style"] = "string"
....:     if (u,v) == (1/2,2/3): options["dot"]         = "x=1,y=2"
....:     if (u,v) == (1,   -1): options["label_style"] = "latex"
....:     if (u,v) == (1,  1/2): options["edge_string"] = "<-"
....:     if (u,v) == (1/2,  1): options["backward"]    = True
....:     return options
sage: print(G.graphviz_string(edge_options=edge_options))  # random
digraph {                                                                                           
  node_0  [label="-1"];                      
  node_1  [label="-1/2"];          
  node_2  [label="1/2"];            
  node_3  [label="-2"];                                                                             
  node_4  [label="1/4"];            
  node_5  [label="-4"];             
  node_6  [label="1/3"];             
  node_7  [label="2/3"];
  node_8  [label="4/5"];                          
  node_9  [label="1"];                            
  node_10  [label="2"];                                                                             
                                                  
  node_2 -> node_3 [label="coucou", color = "red"];                  
  node_2 -> node_7 [x=1,y=2, color = "blue"];     
  node_4 -> node_5 [color = "red"];               
  node_4 -> node_8 [color = "blue"];              
  node_9 -> node_0 [label=" ", texlbl="$x \ {\mapsto}\ -\frac{1}{x}$", color = "red"];
  node_9 <- node_2 [color = "blue"];
  node_10 -> node_1 [color = "red"];
  node_10 -> node_6 [color = "blue"];
}
```

The above output is invalid according to the dot language because `<-` is not allowed (http://www.graphviz.org/doc/info/lang.html). Processing it with graphviz + dot2tex, for example using the `TikzPicture` module of the slabbe package, we obtain a broken image:

```
sage: from slabbe import TikzPicture
sage: TikzPicture.from_graph(G, edge_options=edge_options).pdf()
```

![](https://github.com/sagemath/sage/files/ticket31381/28a6c9371d3d3c9223b25362e865bf57.png​)

Compared to:

```
sage: TikzPicture.from_graph(G).pdf()
```

![](https://github.com/sagemath/sage/files/ticket31381/0734ee56819e63534f4eb2c5e3b4da96.png​)

In this ticket, we fix the above by returning a ValueError if the `edge_string` is invalid with respect to the dot language.

We also improve the code by allowing the user to choose the direction of each edge to be none, forward, backward or both as explained here http://www.graphviz.org/doc/info/attrs.html#k:dirType:

```
sage: edges = [(0,1,'a'), (1,2,'b'), (2,3,'c'), (3,4,'d')]                             
sage: G = DiGraph(edges)          
sage: def edge_options(data): 
....:     u,v,label = data 
....:     if label == 'a': return {'dir':'forward'} 
....:     if label == 'b': return {'dir':'back'} 
....:     if label == 'c': return {'dir':'none'} 
....:     if label == 'd': return {'dir':'both'} 
sage: print(G.graphviz_string(edge_options=edge_options))                          
digraph {
  node_0  [label="0"];
  node_1  [label="1"];
  node_2  [label="2"];
  node_3  [label="3"];
  node_4  [label="4"];

  node_0 -> node_1;
  node_1 -> node_2 [dir=back];
  node_2 -> node_3 [dir=none];
  node_3 -> node_4 [dir=both];
}
sage: TikzPicture.from_graph(G, edge_options=edge_options).pdf()                                         
```

![](https://github.com/sagemath/sage/files/ticket31381/ce19c6046f04e0e662a1cdf3554395d0.png​)

As a consequence, we deprecate `{'backward':True}` in favor of the more versatile `{'dir':'back'}`.

Branch: **[`4cfdde3`](https://github.com/sagemath/sagetrac-mirror/commit/4cfdde3859985728d45497d1459b99d29ddafb04)**

Reviewer: **Frédéric Chapoton**

Author: **Sébastien Labbé**

Component: **graph theory**

_Issue created by migration from https://trac.sagemath.org/ticket/31381_





---

archive/issue_events_432526.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2021-02-11T11:33:11Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31381#event-432526"
}
```



---

archive/issue_events_432527.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2021-02-11T11:33:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31381#event-432527"
}
```



---

archive/issue_events_432528.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2021-02-11T11:33:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31381#event-432528"
}
```



---

archive/issue_events_432529.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2021-02-11T11:33:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31381#event-432529"
}
```



---

archive/issue_comments_503553.json:
```json
{
    "body": "Attachment: **[example1.png](https://github.com/sagemath/sage/files/ticket31381/example1.png)**",
    "created_at": "2021-02-11T11:34:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503553",
    "user": "https://github.com/seblabbe"
}
```

Attachment: **[example1.png](https://github.com/sagemath/sage/files/ticket31381/example1.png)**



---

archive/issue_comments_503554.json:
```json
{
    "body": "Attachment: **[example2.png](https://github.com/sagemath/sage/files/ticket31381/example2.png)**",
    "created_at": "2021-02-11T11:34:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503554",
    "user": "https://github.com/seblabbe"
}
```

Attachment: **[example2.png](https://github.com/sagemath/sage/files/ticket31381/example2.png)**



---

archive/issue_comments_503555.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[example3.png](https://github.com/sagemath/sage/files/ticket31381/example3.png)**",
    "created_at": "2021-02-11T11:36:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503555",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[example3.png](https://github.com/sagemath/sage/files/ticket31381/example3.png)**



---

archive/issue_comments_503556.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -33,8 +33,11 @@\n Indeed, it works:\n \n ```\n+sage: from slabbe import TikzPicture\n sage: TikzPicture.from_graph(G).pdf()\n ```\n+\n+![](https://github.com/sagemath/sage/files/ticket31381/0734ee56819e63534f4eb2c5e3b4da96.png\u200b)\n \n At the end of `G.graphviz_string` documentation, the following is suggested:\n \n@@ -82,6 +85,8 @@\n sage: TikzPicture.from_graph(G, edge_options=edge_options).pdf()\n ```\n \n+![](https://github.com/sagemath/sage/files/ticket31381/28a6c9371d3d3c9223b25362e865bf57.png\u200b)\n+\n If we replace `'<-'` by `--`, it is not as bad, but the option is ignored:\n \n ```\n@@ -128,3 +133,5 @@\n sage: TikzPicture.from_graph(G, edge_options=edge_options).pdf()\n ```\n \n+![](https://github.com/sagemath/sage/files/ticket31381/6cde622c0c1e7b1cc4368986901938ff.png\u200b)\n+\n``````\n",
    "created_at": "2021-02-11T11:36:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503556",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -33,8 +33,11 @@
 Indeed, it works:
 
 ```
+sage: from slabbe import TikzPicture
 sage: TikzPicture.from_graph(G).pdf()
 ```
+
+![](https://github.com/sagemath/sage/files/ticket31381/0734ee56819e63534f4eb2c5e3b4da96.png​)
 
 At the end of `G.graphviz_string` documentation, the following is suggested:
 
@@ -82,6 +85,8 @@
 sage: TikzPicture.from_graph(G, edge_options=edge_options).pdf()
 ```
 
+![](https://github.com/sagemath/sage/files/ticket31381/28a6c9371d3d3c9223b25362e865bf57.png​)
+
 If we replace `'<-'` by `--`, it is not as bad, but the option is ignored:
 
 ```
@@ -128,3 +133,5 @@
 sage: TikzPicture.from_graph(G, edge_options=edge_options).pdf()
 ```
 
+![](https://github.com/sagemath/sage/files/ticket31381/6cde622c0c1e7b1cc4368986901938ff.png​)
+
``````




---

archive/issue_comments_503557.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -54,29 +54,29 @@\n     ....:     if (u,v) == (1/2,  1): options[\"backward\"]    = True\n     ....:     return options\n     sage: print(G.graphviz_string(edge_options=edge_options))  # random\n-    digraph {\n-    node_10  [label=\"1\"];\n-    node_11  [label=\"2\"];\n-    node_3  [label=\"-1/2\"];\n-    node_6  [label=\"1/2\"];\n-    node_7  [label=\"1/2\"];\n-    node_5  [label=\"1/3\"];\n-    node_8  [label=\"2/3\"];\n-    node_4  [label=\"1/4\"];\n-    node_1  [label=\"-2\"];\n-    node_9  [label=\"4/5\"];\n-    node_0  [label=\"-4\"];\n-    node_2  [label=\"-1\"];\n+digraph {                                                                                           \n+  node_0  [label=\"-1\"];                      \n+  node_1  [label=\"-1/2\"];          \n+  node_2  [label=\"1/2\"];            \n+  node_3  [label=\"-2\"];                                                                             \n+  node_4  [label=\"1/4\"];            \n+  node_5  [label=\"-4\"];             \n+  node_6  [label=\"1/3\"];             \n+  node_7  [label=\"2/3\"];\n+  node_8  [label=\"4/5\"];                          \n+  node_9  [label=\"1\"];                            \n+  node_10  [label=\"2\"];                                                                             \n+                                                  \n+  node_2 -> node_3 [label=\"coucou\", color = \"red\"];                  \n+  node_2 -> node_7 [x=1,y=2, color = \"blue\"];     \n+  node_4 -> node_5 [color = \"red\"];               \n+  node_4 -> node_8 [color = \"blue\"];              \n+  node_9 -> node_0 [label=\" \", texlbl=\"$x \\ {\\mapsto}\\ -\\frac{1}{x}$\", color = \"red\"];\n+  node_9 <- node_2 [color = \"blue\"];\n+  node_10 -> node_1 [color = \"red\"];\n+  node_10 -> node_6 [color = \"blue\"];\n+}\n \n-    node_10 -> node_2 [label=\" \", texlbl=\"$x \\ { |--> }\\ -\\frac{1}{x}$\", color = \"red\"];\n-    node_10 <- node_6 [color = \"blue\"];\n-    node_11 -> node_3 [color = \"red\"];\n-    node_11 -> node_5 [color = \"blue\"];\n-    node_7 -> node_1 [label=\"coucou\", color = \"red\"];\n-    node_7 -> node_8 [x=1,y=2, color = \"blue\"];\n-    node_4 -> node_0 [color = \"red\"];\n-    node_4 -> node_9 [color = \"blue\"];\n-    }\n ```\n \n Unfortunately, it does not work:\n@@ -102,29 +102,29 @@\n     ....:     if (u,v) == (1/2,  1): options[\"backward\"]    = True\n     ....:     return options\n     sage: print(G.graphviz_string(edge_options=edge_options))  # random\n-    digraph {\n-    node_10  [label=\"1\"];\n-    node_11  [label=\"2\"];\n-    node_3  [label=\"-1/2\"];\n-    node_6  [label=\"1/2\"];\n-    node_7  [label=\"1/2\"];\n-    node_5  [label=\"1/3\"];\n-    node_8  [label=\"2/3\"];\n-    node_4  [label=\"1/4\"];\n-    node_1  [label=\"-2\"];\n-    node_9  [label=\"4/5\"];\n-    node_0  [label=\"-4\"];\n-    node_2  [label=\"-1\"];\n+digraph {                                                                                           \n+  node_0  [label=\"-1\"];                      \n+  node_1  [label=\"-1/2\"];          \n+  node_2  [label=\"1/2\"];            \n+  node_3  [label=\"-2\"];                                                                             \n+  node_4  [label=\"1/4\"];            \n+  node_5  [label=\"-4\"];             \n+  node_6  [label=\"1/3\"];             \n+  node_7  [label=\"2/3\"];\n+  node_8  [label=\"4/5\"];                          \n+  node_9  [label=\"1\"];                            \n+  node_10  [label=\"2\"];                                                                             \n+                                                  \n+  node_2 -> node_3 [label=\"coucou\", color = \"red\"];                  \n+  node_2 -> node_7 [x=1,y=2, color = \"blue\"];     \n+  node_4 -> node_5 [color = \"red\"];               \n+  node_4 -> node_8 [color = \"blue\"];              \n+  node_9 -> node_0 [label=\" \", texlbl=\"$x \\ {\\mapsto}\\ -\\frac{1}{x}$\", color = \"red\"];\n+  node_9 -- node_2 [color = \"blue\"];\n+  node_10 -> node_1 [color = \"red\"];\n+  node_10 -> node_6 [color = \"blue\"];\n+}\n \n-    node_10 -> node_2 [label=\" \", texlbl=\"$x \\ { |--> }\\ -\\frac{1}{x}$\", color = \"red\"];\n-    node_10 <- node_6 [color = \"blue\"];\n-    node_11 -> node_3 [color = \"red\"];\n-    node_11 -> node_5 [color = \"blue\"];\n-    node_7 -> node_1 [label=\"coucou\", color = \"red\"];\n-    node_7 -> node_8 [x=1,y=2, color = \"blue\"];\n-    node_4 -> node_0 [color = \"red\"];\n-    node_4 -> node_9 [color = \"blue\"];\n-    }\n ```\n \n Unfortunately, the option `'--'` is ignored:\n``````\n",
    "created_at": "2021-02-11T11:38:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503557",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -54,29 +54,29 @@
     ....:     if (u,v) == (1/2,  1): options["backward"]    = True
     ....:     return options
     sage: print(G.graphviz_string(edge_options=edge_options))  # random
-    digraph {
-    node_10  [label="1"];
-    node_11  [label="2"];
-    node_3  [label="-1/2"];
-    node_6  [label="1/2"];
-    node_7  [label="1/2"];
-    node_5  [label="1/3"];
-    node_8  [label="2/3"];
-    node_4  [label="1/4"];
-    node_1  [label="-2"];
-    node_9  [label="4/5"];
-    node_0  [label="-4"];
-    node_2  [label="-1"];
+digraph {                                                                                           
+  node_0  [label="-1"];                      
+  node_1  [label="-1/2"];          
+  node_2  [label="1/2"];            
+  node_3  [label="-2"];                                                                             
+  node_4  [label="1/4"];            
+  node_5  [label="-4"];             
+  node_6  [label="1/3"];             
+  node_7  [label="2/3"];
+  node_8  [label="4/5"];                          
+  node_9  [label="1"];                            
+  node_10  [label="2"];                                                                             
+                                                  
+  node_2 -> node_3 [label="coucou", color = "red"];                  
+  node_2 -> node_7 [x=1,y=2, color = "blue"];     
+  node_4 -> node_5 [color = "red"];               
+  node_4 -> node_8 [color = "blue"];              
+  node_9 -> node_0 [label=" ", texlbl="$x \ {\mapsto}\ -\frac{1}{x}$", color = "red"];
+  node_9 <- node_2 [color = "blue"];
+  node_10 -> node_1 [color = "red"];
+  node_10 -> node_6 [color = "blue"];
+}
 
-    node_10 -> node_2 [label=" ", texlbl="$x \ { |--> }\ -\frac{1}{x}$", color = "red"];
-    node_10 <- node_6 [color = "blue"];
-    node_11 -> node_3 [color = "red"];
-    node_11 -> node_5 [color = "blue"];
-    node_7 -> node_1 [label="coucou", color = "red"];
-    node_7 -> node_8 [x=1,y=2, color = "blue"];
-    node_4 -> node_0 [color = "red"];
-    node_4 -> node_9 [color = "blue"];
-    }
 ```
 
 Unfortunately, it does not work:
@@ -102,29 +102,29 @@
     ....:     if (u,v) == (1/2,  1): options["backward"]    = True
     ....:     return options
     sage: print(G.graphviz_string(edge_options=edge_options))  # random
-    digraph {
-    node_10  [label="1"];
-    node_11  [label="2"];
-    node_3  [label="-1/2"];
-    node_6  [label="1/2"];
-    node_7  [label="1/2"];
-    node_5  [label="1/3"];
-    node_8  [label="2/3"];
-    node_4  [label="1/4"];
-    node_1  [label="-2"];
-    node_9  [label="4/5"];
-    node_0  [label="-4"];
-    node_2  [label="-1"];
+digraph {                                                                                           
+  node_0  [label="-1"];                      
+  node_1  [label="-1/2"];          
+  node_2  [label="1/2"];            
+  node_3  [label="-2"];                                                                             
+  node_4  [label="1/4"];            
+  node_5  [label="-4"];             
+  node_6  [label="1/3"];             
+  node_7  [label="2/3"];
+  node_8  [label="4/5"];                          
+  node_9  [label="1"];                            
+  node_10  [label="2"];                                                                             
+                                                  
+  node_2 -> node_3 [label="coucou", color = "red"];                  
+  node_2 -> node_7 [x=1,y=2, color = "blue"];     
+  node_4 -> node_5 [color = "red"];               
+  node_4 -> node_8 [color = "blue"];              
+  node_9 -> node_0 [label=" ", texlbl="$x \ {\mapsto}\ -\frac{1}{x}$", color = "red"];
+  node_9 -- node_2 [color = "blue"];
+  node_10 -> node_1 [color = "red"];
+  node_10 -> node_6 [color = "blue"];
+}
 
-    node_10 -> node_2 [label=" ", texlbl="$x \ { |--> }\ -\frac{1}{x}$", color = "red"];
-    node_10 <- node_6 [color = "blue"];
-    node_11 -> node_3 [color = "red"];
-    node_11 -> node_5 [color = "blue"];
-    node_7 -> node_1 [label="coucou", color = "red"];
-    node_7 -> node_8 [x=1,y=2, color = "blue"];
-    node_4 -> node_0 [color = "red"];
-    node_4 -> node_9 [color = "blue"];
-    }
 ```
 
 Unfortunately, the option `'--'` is ignored:
``````




---

archive/issue_comments_503558.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAccording to the [DOT language description](http://www.graphviz.org/doc/info/lang.html), `--` is the format for an edge of a `graph` and `->` is the format for an edge of a `digraph` and nothing else.\n\nTherefore, it is a bug in the documentation to suggest `<-` or `--` for digraph.\n\nMoreover, according to the thread [Graphviz Dot, mix directed and undirected](https://stackoverflow.com/questions/13236975/graphviz-dot-mix-directed-and-undirected) on stackoverflow, it seems that the proper way to remove the headarrow for one edge of a digraph to set `dir=none`.\n\nTherefore, the `edge_option` should allow one to set `dir=none`.",
    "created_at": "2021-02-11T20:12:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503558",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:3" align="right">comment:3</div>

According to the [DOT language description](http://www.graphviz.org/doc/info/lang.html), `--` is the format for an edge of a `graph` and `->` is the format for an edge of a `digraph` and nothing else.

Therefore, it is a bug in the documentation to suggest `<-` or `--` for digraph.

Moreover, according to the thread [Graphviz Dot, mix directed and undirected](https://stackoverflow.com/questions/13236975/graphviz-dot-mix-directed-and-undirected) on stackoverflow, it seems that the proper way to remove the headarrow for one edge of a digraph to set `dir=none`.

Therefore, the `edge_option` should allow one to set `dir=none`.



---

archive/issue_comments_503559.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nMoreover, according to http://www.graphviz.org/doc/info/attrs.html#k:dirType, the possible values for the direction of an edge are `none`, `forward`, `back` and `both`. The default for a graph is `none` and the default for a digraph is `forward`.",
    "created_at": "2021-02-11T22:34:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503559",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:4" align="right">comment:4</div>

Moreover, according to http://www.graphviz.org/doc/info/attrs.html#k:dirType, the possible values for the direction of an edge are `none`, `forward`, `back` and `both`. The default for a graph is `none` and the default for a digraph is `forward`.



---

archive/issue_comments_503560.json:
```json
{
    "body": "Commit: **[`f492947`](https://github.com/sagemath/sagetrac-mirror/commit/f492947f87de8cbe41a17080fad0dab162f1fd48)**",
    "created_at": "2021-02-11T22:34:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503560",
    "user": "https://github.com/seblabbe"
}
```

Commit: **[`f492947`](https://github.com/sagemath/sagetrac-mirror/commit/f492947f87de8cbe41a17080fad0dab162f1fd48)**



---

archive/issue_comments_503561.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f492947f87de8cbe41a17080fad0dab162f1fd48\">f492947</a></td><td><code>31381: better handling of the backward orientation drawing of an edge in graphviz string</code></td></tr></table>\n",
    "created_at": "2021-02-11T22:34:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503561",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:5"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f492947f87de8cbe41a17080fad0dab162f1fd48">f492947</a></td><td><code>31381: better handling of the backward orientation drawing of an edge in graphviz string</code></td></tr></table>




---

archive/issue_comments_503562.json:
```json
{
    "body": "Branch: **[u/slabbe/31381](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/31381)**",
    "created_at": "2021-02-11T22:34:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503562",
    "user": "https://github.com/seblabbe"
}
```

Branch: **[u/slabbe/31381](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/31381)**



---

archive/issue_comments_503563.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-If `G` is a digraph, the documentation of `G.graphviz_string` says the following work:\n+The documentation of `G.graphviz_string` says the following work:\n \n ```\n sage: f(x) = -1 / x\n@@ -6,43 +6,8 @@\n sage: G = DiGraph()\n sage: G.add_edges((i, f(i), f) for i in (1, 2, 1/2, 1/4))\n sage: G.add_edges((i, g(i), g) for i in (1, 2, 1/2, 1/4))\n-sage: print(G.graphviz_string())\n-digraph {\n-  node_0  [label=\"-1\"];\n-  node_1  [label=\"-1/2\"];\n-  node_2  [label=\"1/2\"];\n-  node_3  [label=\"-2\"];\n-  node_4  [label=\"1/4\"];\n-  node_5  [label=\"-4\"];\n-  node_6  [label=\"1/3\"];\n-  node_7  [label=\"2/3\"];\n-  node_8  [label=\"4/5\"];\n-  node_9  [label=\"1\"];\n-  node_10  [label=\"2\"];\n \n-  node_2 -> node_3;\n-  node_2 -> node_7;\n-  node_4 -> node_5;\n-  node_4 -> node_8;\n-  node_9 -> node_0;\n-  node_9 -> node_2;\n-  node_10 -> node_1;\n-  node_10 -> node_6;\n-}\n-```\n-Indeed, it works:\n-\n-```\n-sage: from slabbe import TikzPicture\n-sage: TikzPicture.from_graph(G).pdf()\n-```\n-\n-![](https://github.com/sagemath/sage/files/ticket31381/0734ee56819e63534f4eb2c5e3b4da96.png\u200b)\n-\n-At the end of `G.graphviz_string` documentation, the following is suggested:\n-\n-```\n-We now test all options:\n+[...]\n \n     sage: def edge_options(data):\n     ....:     u, v, label = data\n@@ -76,10 +41,9 @@\n   node_10 -> node_1 [color = \"red\"];\n   node_10 -> node_6 [color = \"blue\"];\n }\n-\n ```\n \n-Unfortunately, it does not work:\n+The above output is invalid according to the dot language because `<-` is not allowed. Processing it with graphviz we obtain a broken image:\n \n ```\n sage: TikzPicture.from_graph(G, edge_options=edge_options).pdf()\n@@ -87,51 +51,4 @@\n \n ![](https://github.com/sagemath/sage/files/ticket31381/28a6c9371d3d3c9223b25362e865bf57.png\u200b)\n \n-If we replace `'<-'` by `--`, it is not as bad, but the option is ignored:\n \n-```\n-We now test all options:\n-\n-    sage: def edge_options(data):\n-    ....:     u, v, label = data\n-    ....:     options = {\"color\": {f: \"red\", g: \"blue\"}[label]}\n-    ....:     if (u,v) == (1/2, -2): options[\"label\"]       = \"coucou\"; options[\"label_style\"] = \"string\"\n-    ....:     if (u,v) == (1/2,2/3): options[\"dot\"]         = \"x=1,y=2\"\n-    ....:     if (u,v) == (1,   -1): options[\"label_style\"] = \"latex\"\n-    ....:     if (u,v) == (1,  1/2): options[\"edge_string\"] = \"--\"\n-    ....:     if (u,v) == (1/2,  1): options[\"backward\"]    = True\n-    ....:     return options\n-    sage: print(G.graphviz_string(edge_options=edge_options))  # random\n-digraph {                                                                                           \n-  node_0  [label=\"-1\"];                      \n-  node_1  [label=\"-1/2\"];          \n-  node_2  [label=\"1/2\"];            \n-  node_3  [label=\"-2\"];                                                                             \n-  node_4  [label=\"1/4\"];            \n-  node_5  [label=\"-4\"];             \n-  node_6  [label=\"1/3\"];             \n-  node_7  [label=\"2/3\"];\n-  node_8  [label=\"4/5\"];                          \n-  node_9  [label=\"1\"];                            \n-  node_10  [label=\"2\"];                                                                             \n-                                                  \n-  node_2 -> node_3 [label=\"coucou\", color = \"red\"];                  \n-  node_2 -> node_7 [x=1,y=2, color = \"blue\"];     \n-  node_4 -> node_5 [color = \"red\"];               \n-  node_4 -> node_8 [color = \"blue\"];              \n-  node_9 -> node_0 [label=\" \", texlbl=\"$x \\ {\\mapsto}\\ -\\frac{1}{x}$\", color = \"red\"];\n-  node_9 -- node_2 [color = \"blue\"];\n-  node_10 -> node_1 [color = \"red\"];\n-  node_10 -> node_6 [color = \"blue\"];\n-}\n-\n-```\n-\n-Unfortunately, the option `'--'` is ignored:\n-\n-```\n-sage: TikzPicture.from_graph(G, edge_options=edge_options).pdf()\n-```\n-\n-![](https://github.com/sagemath/sage/files/ticket31381/6cde622c0c1e7b1cc4368986901938ff.png\u200b)\n-\n``````\n",
    "created_at": "2021-02-11T22:39:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503563",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-If `G` is a digraph, the documentation of `G.graphviz_string` says the following work:
+The documentation of `G.graphviz_string` says the following work:
 
 ```
 sage: f(x) = -1 / x
@@ -6,43 +6,8 @@
 sage: G = DiGraph()
 sage: G.add_edges((i, f(i), f) for i in (1, 2, 1/2, 1/4))
 sage: G.add_edges((i, g(i), g) for i in (1, 2, 1/2, 1/4))
-sage: print(G.graphviz_string())
-digraph {
-  node_0  [label="-1"];
-  node_1  [label="-1/2"];
-  node_2  [label="1/2"];
-  node_3  [label="-2"];
-  node_4  [label="1/4"];
-  node_5  [label="-4"];
-  node_6  [label="1/3"];
-  node_7  [label="2/3"];
-  node_8  [label="4/5"];
-  node_9  [label="1"];
-  node_10  [label="2"];
 
-  node_2 -> node_3;
-  node_2 -> node_7;
-  node_4 -> node_5;
-  node_4 -> node_8;
-  node_9 -> node_0;
-  node_9 -> node_2;
-  node_10 -> node_1;
-  node_10 -> node_6;
-}
-```
-Indeed, it works:
-
-```
-sage: from slabbe import TikzPicture
-sage: TikzPicture.from_graph(G).pdf()
-```
-
-![](https://github.com/sagemath/sage/files/ticket31381/0734ee56819e63534f4eb2c5e3b4da96.png​)
-
-At the end of `G.graphviz_string` documentation, the following is suggested:
-
-```
-We now test all options:
+[...]
 
     sage: def edge_options(data):
     ....:     u, v, label = data
@@ -76,10 +41,9 @@
   node_10 -> node_1 [color = "red"];
   node_10 -> node_6 [color = "blue"];
 }
-
 ```
 
-Unfortunately, it does not work:
+The above output is invalid according to the dot language because `<-` is not allowed. Processing it with graphviz we obtain a broken image:
 
 ```
 sage: TikzPicture.from_graph(G, edge_options=edge_options).pdf()
@@ -87,51 +51,4 @@
 
 ![](https://github.com/sagemath/sage/files/ticket31381/28a6c9371d3d3c9223b25362e865bf57.png​)
 
-If we replace `'<-'` by `--`, it is not as bad, but the option is ignored:
 
-```
-We now test all options:
-
-    sage: def edge_options(data):
-    ....:     u, v, label = data
-    ....:     options = {"color": {f: "red", g: "blue"}[label]}
-    ....:     if (u,v) == (1/2, -2): options["label"]       = "coucou"; options["label_style"] = "string"
-    ....:     if (u,v) == (1/2,2/3): options["dot"]         = "x=1,y=2"
-    ....:     if (u,v) == (1,   -1): options["label_style"] = "latex"
-    ....:     if (u,v) == (1,  1/2): options["edge_string"] = "--"
-    ....:     if (u,v) == (1/2,  1): options["backward"]    = True
-    ....:     return options
-    sage: print(G.graphviz_string(edge_options=edge_options))  # random
-digraph {                                                                                           
-  node_0  [label="-1"];                      
-  node_1  [label="-1/2"];          
-  node_2  [label="1/2"];            
-  node_3  [label="-2"];                                                                             
-  node_4  [label="1/4"];            
-  node_5  [label="-4"];             
-  node_6  [label="1/3"];             
-  node_7  [label="2/3"];
-  node_8  [label="4/5"];                          
-  node_9  [label="1"];                            
-  node_10  [label="2"];                                                                             
-                                                  
-  node_2 -> node_3 [label="coucou", color = "red"];                  
-  node_2 -> node_7 [x=1,y=2, color = "blue"];     
-  node_4 -> node_5 [color = "red"];               
-  node_4 -> node_8 [color = "blue"];              
-  node_9 -> node_0 [label=" ", texlbl="$x \ {\mapsto}\ -\frac{1}{x}$", color = "red"];
-  node_9 -- node_2 [color = "blue"];
-  node_10 -> node_1 [color = "red"];
-  node_10 -> node_6 [color = "blue"];
-}
-
-```
-
-Unfortunately, the option `'--'` is ignored:
-
-```
-sage: TikzPicture.from_graph(G, edge_options=edge_options).pdf()
-```
-
-![](https://github.com/sagemath/sage/files/ticket31381/6cde622c0c1e7b1cc4368986901938ff.png​)
-
``````




---

archive/issue_comments_503564.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -43,7 +43,7 @@\n }\n ```\n \n-The above output is invalid according to the dot language because `<-` is not allowed. Processing it with graphviz we obtain a broken image:\n+The above output is invalid according to the dot language because `<-` is not allowed. Processing it with graphviz + dot2tex we obtain a broken image:\n \n ```\n sage: TikzPicture.from_graph(G, edge_options=edge_options).pdf()\n@@ -51,4 +51,10 @@\n \n ![](https://github.com/sagemath/sage/files/ticket31381/28a6c9371d3d3c9223b25362e865bf57.png\u200b)\n \n+Compared to:\n \n+```\n+sage: TikzPicture.from_graph(G).pdf()\n+```\n+\n+![](https://github.com/sagemath/sage/files/ticket31381/0734ee56819e63534f4eb2c5e3b4da96.png\u200b)\n``````\n",
    "created_at": "2021-02-11T22:40:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503564",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -43,7 +43,7 @@
 }
 ```
 
-The above output is invalid according to the dot language because `<-` is not allowed. Processing it with graphviz we obtain a broken image:
+The above output is invalid according to the dot language because `<-` is not allowed. Processing it with graphviz + dot2tex we obtain a broken image:
 
 ```
 sage: TikzPicture.from_graph(G, edge_options=edge_options).pdf()
@@ -51,4 +51,10 @@
 
 ![](https://github.com/sagemath/sage/files/ticket31381/28a6c9371d3d3c9223b25362e865bf57.png​)
 
+Compared to:
 
+```
+sage: TikzPicture.from_graph(G).pdf()
+```
+
+![](https://github.com/sagemath/sage/files/ticket31381/0734ee56819e63534f4eb2c5e3b4da96.png​)
``````




---

archive/issue_comments_503565.json:
```json
{
    "body": "Attachment: **[example4.png](https://github.com/sagemath/sage/files/ticket31381/example4.png)**",
    "created_at": "2021-02-11T22:43:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503565",
    "user": "https://github.com/seblabbe"
}
```

Attachment: **[example4.png](https://github.com/sagemath/sage/files/ticket31381/example4.png)**



---

archive/issue_comments_503566.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -58,3 +58,36 @@\n ```\n \n ![](https://github.com/sagemath/sage/files/ticket31381/0734ee56819e63534f4eb2c5e3b4da96.png\u200b)\n+\n+In this ticket, we fix the above by returning a ValueError if the `edge_string` is invalid with respect to the dot language.\n+\n+We also improve the code by allowing the user to choose the direction of each edge to be none, forward, backward or both as explained here http://www.graphviz.org/doc/info/attrs.html#k:dirType:\n+\n+```\n+sage: edges = [(0,1,'a'), (1,2,'b'), (2,3,'c'), (3,4,'d')]                             \n+sage: G = DiGraph(edges)          \n+sage: def edge_options(data): \n+....:     u,v,label = data \n+....:     if label == 'a': return {'dir':'forward'} \n+....:     if label == 'b': return {'dir':'back'} \n+....:     if label == 'c': return {'dir':'none'} \n+....:     if label == 'd': return {'dir':'both'} \n+sage: print(G.graphviz_string(edge_options=edge_options))                          \n+digraph {\n+  node_0  [label=\"0\"];\n+  node_1  [label=\"1\"];\n+  node_2  [label=\"2\"];\n+  node_3  [label=\"3\"];\n+  node_4  [label=\"4\"];\n+\n+  node_0 -> node_1;\n+  node_1 -> node_2 [dir=back];\n+  node_2 -> node_3 [dir=none];\n+  node_3 -> node_4 [dir=both];\n+}\n+sage: TikzPicture.from_graph(G, edge_options=edge_options).pdf()                                         \n+```\n+\n+![](https://github.com/sagemath/sage/files/ticket31381/ce19c6046f04e0e662a1cdf3554395d0.png\u200b)\n+\n+As a consequence, we deprecate `{'backward':True}` in favor of the more versatile `{'dir':'back'}`.\n``````\n",
    "created_at": "2021-02-11T22:49:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503566",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -58,3 +58,36 @@
 ```
 
 ![](https://github.com/sagemath/sage/files/ticket31381/0734ee56819e63534f4eb2c5e3b4da96.png​)
+
+In this ticket, we fix the above by returning a ValueError if the `edge_string` is invalid with respect to the dot language.
+
+We also improve the code by allowing the user to choose the direction of each edge to be none, forward, backward or both as explained here http://www.graphviz.org/doc/info/attrs.html#k:dirType:
+
+```
+sage: edges = [(0,1,'a'), (1,2,'b'), (2,3,'c'), (3,4,'d')]                             
+sage: G = DiGraph(edges)          
+sage: def edge_options(data): 
+....:     u,v,label = data 
+....:     if label == 'a': return {'dir':'forward'} 
+....:     if label == 'b': return {'dir':'back'} 
+....:     if label == 'c': return {'dir':'none'} 
+....:     if label == 'd': return {'dir':'both'} 
+sage: print(G.graphviz_string(edge_options=edge_options))                          
+digraph {
+  node_0  [label="0"];
+  node_1  [label="1"];
+  node_2  [label="2"];
+  node_3  [label="3"];
+  node_4  [label="4"];
+
+  node_0 -> node_1;
+  node_1 -> node_2 [dir=back];
+  node_2 -> node_3 [dir=none];
+  node_3 -> node_4 [dir=both];
+}
+sage: TikzPicture.from_graph(G, edge_options=edge_options).pdf()                                         
+```
+
+![](https://github.com/sagemath/sage/files/ticket31381/ce19c6046f04e0e662a1cdf3554395d0.png​)
+
+As a consequence, we deprecate `{'backward':True}` in favor of the more versatile `{'dir':'back'}`.
``````




---

archive/issue_events_432530.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2021-02-11T22:49:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31381#event-432530"
}
```



---

archive/issue_comments_503567.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The documentation of `G.graphviz_string` says the following work:\n+The documentation of `G.graphviz_string` says:\n \n ```\n sage: f(x) = -1 / x\n@@ -9,16 +9,16 @@\n \n [...]\n \n-    sage: def edge_options(data):\n-    ....:     u, v, label = data\n-    ....:     options = {\"color\": {f: \"red\", g: \"blue\"}[label]}\n-    ....:     if (u,v) == (1/2, -2): options[\"label\"]       = \"coucou\"; options[\"label_style\"] = \"string\"\n-    ....:     if (u,v) == (1/2,2/3): options[\"dot\"]         = \"x=1,y=2\"\n-    ....:     if (u,v) == (1,   -1): options[\"label_style\"] = \"latex\"\n-    ....:     if (u,v) == (1,  1/2): options[\"edge_string\"] = \"<-\"\n-    ....:     if (u,v) == (1/2,  1): options[\"backward\"]    = True\n-    ....:     return options\n-    sage: print(G.graphviz_string(edge_options=edge_options))  # random\n+sage: def edge_options(data):\n+....:     u, v, label = data\n+....:     options = {\"color\": {f: \"red\", g: \"blue\"}[label]}\n+....:     if (u,v) == (1/2, -2): options[\"label\"]       = \"coucou\"; options[\"label_style\"] = \"string\"\n+....:     if (u,v) == (1/2,2/3): options[\"dot\"]         = \"x=1,y=2\"\n+....:     if (u,v) == (1,   -1): options[\"label_style\"] = \"latex\"\n+....:     if (u,v) == (1,  1/2): options[\"edge_string\"] = \"<-\"\n+....:     if (u,v) == (1/2,  1): options[\"backward\"]    = True\n+....:     return options\n+sage: print(G.graphviz_string(edge_options=edge_options))  # random\n digraph {                                                                                           \n   node_0  [label=\"-1\"];                      \n   node_1  [label=\"-1/2\"];          \n``````\n",
    "created_at": "2021-02-11T22:56:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503567",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The documentation of `G.graphviz_string` says the following work:
+The documentation of `G.graphviz_string` says:
 
 ```
 sage: f(x) = -1 / x
@@ -9,16 +9,16 @@
 
 [...]
 
-    sage: def edge_options(data):
-    ....:     u, v, label = data
-    ....:     options = {"color": {f: "red", g: "blue"}[label]}
-    ....:     if (u,v) == (1/2, -2): options["label"]       = "coucou"; options["label_style"] = "string"
-    ....:     if (u,v) == (1/2,2/3): options["dot"]         = "x=1,y=2"
-    ....:     if (u,v) == (1,   -1): options["label_style"] = "latex"
-    ....:     if (u,v) == (1,  1/2): options["edge_string"] = "<-"
-    ....:     if (u,v) == (1/2,  1): options["backward"]    = True
-    ....:     return options
-    sage: print(G.graphviz_string(edge_options=edge_options))  # random
+sage: def edge_options(data):
+....:     u, v, label = data
+....:     options = {"color": {f: "red", g: "blue"}[label]}
+....:     if (u,v) == (1/2, -2): options["label"]       = "coucou"; options["label_style"] = "string"
+....:     if (u,v) == (1/2,2/3): options["dot"]         = "x=1,y=2"
+....:     if (u,v) == (1,   -1): options["label_style"] = "latex"
+....:     if (u,v) == (1,  1/2): options["edge_string"] = "<-"
+....:     if (u,v) == (1/2,  1): options["backward"]    = True
+....:     return options
+sage: print(G.graphviz_string(edge_options=edge_options))  # random
 digraph {                                                                                           
   node_0  [label="-1"];                      
   node_1  [label="-1/2"];          
``````




---

archive/issue_events_432531.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2021-02-11T22:56:01Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "title_is": "Fix the handling of the orientation of edges provided by the edge_option of G.graphviz_string",
    "title_was": "Edge option \"--\" of G.graphviz_string method output is ignored",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31381#event-432531"
}
```



---

archive/issue_comments_503568.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -43,9 +43,10 @@\n }\n ```\n \n-The above output is invalid according to the dot language because `<-` is not allowed. Processing it with graphviz + dot2tex we obtain a broken image:\n+The above output is invalid according to the dot language because `<-` is not allowed. Processing it with graphviz + dot2tex, for example using the `TikzPicture` module of the slabbe package, we obtain a broken image:\n \n ```\n+sage: from slabbe import TikzPicture\n sage: TikzPicture.from_graph(G, edge_options=edge_options).pdf()\n ```\n \n``````\n",
    "created_at": "2021-02-11T23:00:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503568",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -43,9 +43,10 @@
 }
 ```
 
-The above output is invalid according to the dot language because `<-` is not allowed. Processing it with graphviz + dot2tex we obtain a broken image:
+The above output is invalid according to the dot language because `<-` is not allowed. Processing it with graphviz + dot2tex, for example using the `TikzPicture` module of the slabbe package, we obtain a broken image:
 
 ```
+sage: from slabbe import TikzPicture
 sage: TikzPicture.from_graph(G, edge_options=edge_options).pdf()
 ```
 
``````




---

archive/issue_comments_503569.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -43,7 +43,7 @@\n }\n ```\n \n-The above output is invalid according to the dot language because `<-` is not allowed. Processing it with graphviz + dot2tex, for example using the `TikzPicture` module of the slabbe package, we obtain a broken image:\n+The above output is invalid according to the dot language because `<-` is not allowed (http://www.graphviz.org/doc/info/lang.html). Processing it with graphviz + dot2tex, for example using the `TikzPicture` module of the slabbe package, we obtain a broken image:\n \n ```\n sage: from slabbe import TikzPicture\n``````\n",
    "created_at": "2021-02-11T23:01:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503569",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -43,7 +43,7 @@
 }
 ```
 
-The above output is invalid according to the dot language because `<-` is not allowed. Processing it with graphviz + dot2tex, for example using the `TikzPicture` module of the slabbe package, we obtain a broken image:
+The above output is invalid according to the dot language because `<-` is not allowed (http://www.graphviz.org/doc/info/lang.html). Processing it with graphviz + dot2tex, for example using the `TikzPicture` module of the slabbe package, we obtain a broken image:
 
 ```
 sage: from slabbe import TikzPicture
``````




---

archive/issue_comments_503570.json:
```json
{
    "body": "Author: **S\u00e9bastien Labb\u00e9**",
    "created_at": "2021-02-11T23:03:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503570",
    "user": "https://github.com/seblabbe"
}
```

Author: **Sébastien Labbé**



---

archive/issue_comments_503571.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\ndoc does not build, see patchbot",
    "created_at": "2021-02-12T11:03:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503571",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:13" align="right">comment:13</div>

doc does not build, see patchbot



---

archive/issue_comments_503572.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e42fa043a9fc567d308e151128e4d59ab56b8a47\">e42fa04</a></td><td><code>31381: better handling of the backward orientation drawing of an edge in graphviz string</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/996f29beb45ff506eedb1847b832df2c2866c746\">996f29b</a></td><td><code>31381: fixing docstring : -> :: at one place</code></td></tr></table>\n",
    "created_at": "2021-02-12T12:33:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503572",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e42fa043a9fc567d308e151128e4d59ab56b8a47">e42fa04</a></td><td><code>31381: better handling of the backward orientation drawing of an edge in graphviz string</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/996f29beb45ff506eedb1847b832df2c2866c746">996f29b</a></td><td><code>31381: fixing docstring : -> :: at one place</code></td></tr></table>




---

archive/issue_comments_503573.json:
```json
{
    "body": "Changed commit from **[`f492947`](https://github.com/sagemath/sagetrac-mirror/commit/f492947f87de8cbe41a17080fad0dab162f1fd48)** to **[`996f29b`](https://github.com/sagemath/sagetrac-mirror/commit/996f29beb45ff506eedb1847b832df2c2866c746)**",
    "created_at": "2021-02-12T12:33:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503573",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f492947`](https://github.com/sagemath/sagetrac-mirror/commit/f492947f87de8cbe41a17080fad0dab162f1fd48)** to **[`996f29b`](https://github.com/sagemath/sagetrac-mirror/commit/996f29beb45ff506eedb1847b832df2c2866c746)**



---

archive/issue_comments_503574.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI rebased the branch on top of the most recent development version and replaced one `:` by `::`.",
    "created_at": "2021-02-12T12:41:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503574",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:15" align="right">comment:15</div>

I rebased the branch on top of the most recent development version and replaced one `:` by `::`.



---

archive/issue_comments_503575.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@fchapoton](#comment:13):\n> doc does not build, see patchbot\n\nlooks good now",
    "created_at": "2021-02-12T18:34:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503575",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@fchapoton](#comment:13):
> doc does not build, see patchbot

looks good now



---

archive/issue_comments_503576.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nok, good, but \"misspelled\" takes 2 s",
    "created_at": "2021-02-13T09:24:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503576",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:17" align="right">comment:17</div>

ok, good, but "misspelled" takes 2 s



---

archive/issue_comments_503577.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4cfdde3859985728d45497d1459b99d29ddafb04\">4cfdde3</a></td><td><code>31381: misspelled 'misspelled'</code></td></tr></table>\n",
    "created_at": "2021-02-15T08:10:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503577",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4cfdde3859985728d45497d1459b99d29ddafb04">4cfdde3</a></td><td><code>31381: misspelled 'misspelled'</code></td></tr></table>




---

archive/issue_comments_503578.json:
```json
{
    "body": "Changed commit from **[`996f29b`](https://github.com/sagemath/sagetrac-mirror/commit/996f29beb45ff506eedb1847b832df2c2866c746)** to **[`4cfdde3`](https://github.com/sagemath/sagetrac-mirror/commit/4cfdde3859985728d45497d1459b99d29ddafb04)**",
    "created_at": "2021-02-15T08:10:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503578",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`996f29b`](https://github.com/sagemath/sagetrac-mirror/commit/996f29beb45ff506eedb1847b832df2c2866c746)** to **[`4cfdde3`](https://github.com/sagemath/sagetrac-mirror/commit/4cfdde3859985728d45497d1459b99d29ddafb04)**



---

archive/issue_events_432532.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-02-16T12:48:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31381#event-432532"
}
```



---

archive/issue_events_432533.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-02-16T12:48:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31381#event-432533"
}
```



---

archive/issue_comments_503579.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2021-02-16T12:48:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503579",
    "user": "https://github.com/fchapoton"
}
```

Reviewer: **Frédéric Chapoton**



---

archive/issue_comments_503580.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nok.\n\nPour info, juste pousser une branche git n'envoie pas de mail, donc ne pr\u00e9vient pas les participants au ticket.",
    "created_at": "2021-02-16T12:48:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503580",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:19" align="right">comment:19</div>

ok.

Pour info, juste pousser une branche git n'envoie pas de mail, donc ne prévient pas les participants au ticket.



---

archive/issue_comments_503581.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nok\n\nMerci Fr\u00e9d\u00e9ric!",
    "created_at": "2021-02-17T21:17:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503581",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:20" align="right">comment:20</div>

ok

Merci Frédéric!



---

archive/issue_comments_503582.json:
```json
{
    "body": "Changed branch from **[u/slabbe/31381](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/31381)** to **[`4cfdde3`](https://github.com/sagemath/sagetrac-mirror/commit/4cfdde3859985728d45497d1459b99d29ddafb04)**",
    "created_at": "2021-03-09T00:01:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503582",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/slabbe/31381](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/31381)** to **[`4cfdde3`](https://github.com/sagemath/sagetrac-mirror/commit/4cfdde3859985728d45497d1459b99d29ddafb04)**



---

archive/issue_events_432534.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-09T00:01:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31381#event-432534"
}
```



---

archive/issue_events_432535.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "e656f39e31c000ef76150c7f006aebecdca64bce",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-03-09T00:01:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/31381#event-432535"
}
```



---

archive/issue_comments_503583.json:
```json
{
    "body": "Changed commit from **[`4cfdde3`](https://github.com/sagemath/sagetrac-mirror/commit/4cfdde3859985728d45497d1459b99d29ddafb04)** to none",
    "created_at": "2021-08-25T23:54:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503583",
    "user": "https://github.com/tscrim"
}
```

Changed commit from **[`4cfdde3`](https://github.com/sagemath/sagetrac-mirror/commit/4cfdde3859985728d45497d1459b99d29ddafb04)** to none



---

archive/issue_comments_503584.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI was not paying enough attention in #31719. The result is now that the arrows are backwards rather than being an indication that the arrows should be considered as moving in the opposite direction for the layout. The key change was not adding back in this line:\n\n```python\nif edge_options['backward']:\n    v,u = u,v    # <------------------------------\n    dot_options.append('dir=back')\n```\nSo implementing the deprecation message is actually giving a change in the behavior. This feature is really useful in having nicer layout for KR crystals.\n\n---\n\nThe question is what to do going forward. Should we have `dir='back'` implement the old behavior or add back in the `backward` input for what will be distinct behavior?",
    "created_at": "2021-08-25T23:54:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503584",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:22" align="right">comment:22</div>

I was not paying enough attention in #31719. The result is now that the arrows are backwards rather than being an indication that the arrows should be considered as moving in the opposite direction for the layout. The key change was not adding back in this line:

```python
if edge_options['backward']:
    v,u = u,v    # <------------------------------
    dot_options.append('dir=back')
```
So implementing the deprecation message is actually giving a change in the behavior. This feature is really useful in having nicer layout for KR crystals.

---

The question is what to do going forward. Should we have `dir='back'` implement the old behavior or add back in the `backward` input for what will be distinct behavior?



---

archive/issue_comments_503585.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nWhile working on this ticket, I spent a lot of time thinking about all cases and tested all of them. To me, there was a bug in the `backward=True` code. To my opinion, the line `u,v=v,u` is changing the graph  and should not be done inside a method which just draws it. I think if the user really want to change the graph, the user should do this before drawing it.\n\nIf I well remember (it is too bad I did not copy pasted an example here), the option `backward=True` was not working at all. Because swapping u and v and setting `dir=back` was like doing nothing for showing a digraph. After this ticket, writting `dir=back` really does `dir=back` as understood by the dot language.\n\nWhat happens if in #31719 you instead just removed the `backward=True` as follows?\n\n```diff\n             G = Crystals().parent_class.digraph(self, subset, index_set)\n-            if have_dot2tex():\n-                f = lambda u_v_label: ({\"backward\": u_v_label[2] == 0})\n-                G.set_latex_options(edge_options=f)\n             return G\n```",
    "created_at": "2021-08-28T20:07:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503585",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:23" align="right">comment:23</div>

While working on this ticket, I spent a lot of time thinking about all cases and tested all of them. To me, there was a bug in the `backward=True` code. To my opinion, the line `u,v=v,u` is changing the graph  and should not be done inside a method which just draws it. I think if the user really want to change the graph, the user should do this before drawing it.

If I well remember (it is too bad I did not copy pasted an example here), the option `backward=True` was not working at all. Because swapping u and v and setting `dir=back` was like doing nothing for showing a digraph. After this ticket, writting `dir=back` really does `dir=back` as understood by the dot language.

What happens if in #31719 you instead just removed the `backward=True` as follows?

```diff
             G = Crystals().parent_class.digraph(self, subset, index_set)
-            if have_dot2tex():
-                f = lambda u_v_label: ({"backward": u_v_label[2] == 0})
-                G.set_latex_options(edge_options=f)
             return G
```



---

archive/issue_comments_503586.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nIt was not a bug at all. The major effect was the layout, and it was something that was documented. When drawing the digraphs, it tries to make all of the arrows pointing downward. The classical crystals are posets, so it is okay. Now the KR crystals are those posets plus some extra arrows that go in the wrong direction. With that option, it would basically just add them in without altering the layout. If we remove that option, then what happens is those special backwards arrows are no longer special, so the layout is much more difficult to read.\n\nWe do *not* want to change the digraph either because the arrows carry mathematical meaning. So it would need to be done locally within the latex construction. Hence we arrive at what the code was doing before.",
    "created_at": "2021-08-28T20:34:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503586",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">comment:24</div>

It was not a bug at all. The major effect was the layout, and it was something that was documented. When drawing the digraphs, it tries to make all of the arrows pointing downward. The classical crystals are posets, so it is okay. Now the KR crystals are those posets plus some extra arrows that go in the wrong direction. With that option, it would basically just add them in without altering the layout. If we remove that option, then what happens is those special backwards arrows are no longer special, so the layout is much more difficult to read.

We do *not* want to change the digraph either because the arrows carry mathematical meaning. So it would need to be done locally within the latex construction. Hence we arrive at what the code was doing before.



---

archive/issue_comments_503587.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nOk, I see. Then, it was a mistake from me. I am sorry. I think we should then add back the `backward` option.",
    "created_at": "2021-08-29T19:47:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503587",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:25" align="right">comment:25</div>

Ok, I see. Then, it was a mistake from me. I am sorry. I think we should then add back the `backward` option.



---

archive/issue_comments_503588.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nNo problem. I should have caught it when I was doing #31719. This is now #32438.",
    "created_at": "2021-08-30T22:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/31381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/31381#issuecomment-503588",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:26" align="right">comment:26</div>

No problem. I should have caught it when I was doing #31719. This is now #32438.
