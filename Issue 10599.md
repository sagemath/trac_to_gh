# Issue 10599: Add support for uploading static html doc page as a worksheet in the notebook

archive/issues_010599.json:
```json
{
    "body": "Assignee: jason, mpatel, was\n\nCC:  jason hivert slabbe\n\nKeywords: Sphinx, upload, static html documentation\n\nThis patch adds (experimental) support for uploading a static html doc\npage as a worksheet in the notebook. As a side effect, it:\n\n- allows for uploading a .txt file from a URL (was broken)\n- allows for uploading a zip file containing .txt and .html files\n\nThis little feature would give a very simple workflow for distributing\ntutorial worksheets during our Sage(-Combinat) workshops, saving a lot\nof hassle and time to both us and the participants (more detail upon\nrequest). It would be great if this feature could be in the sage\nstable release by early May for the next Sage-Combinat workshop in\nAcadia.\n\nI wrote the attached small patch as a proof of concept; however this\nis the first time I am touching the notebook code and I am not\nplanning to invest in this direction in the short term. So I would be\nextremely glad if some notebook expert could take over this patch,\nclean it up (look for TODO/FIXME), and rebase it upon #10521 with whom\nit probably conflicts lightly (this should be a breeze).\n\nRelated tickets:\n\n- #7441: notebook: make it possible to upload from the url of a published worksheet\n- #9875: Can't upload from a notebook link, only from a .sws file\n- #10521: notebook upload of zipped worksheets can't deal with multiple worksheets with the same name\n\nThanks so much in advance!!!\n\t\t\t\t\tNicolas\n\nIssue created by migration from https://trac.sagemath.org/ticket/10652\n\n",
    "created_at": "2011-01-18T13:15:49Z",
    "labels": [
        "notebook",
        "major",
        "enhancement"
    ],
    "title": "Add support for uploading static html doc page as a worksheet in the notebook",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10599",
    "user": "nthiery"
}
```
Assignee: jason, mpatel, was

CC:  jason hivert slabbe

Keywords: Sphinx, upload, static html documentation

This patch adds (experimental) support for uploading a static html doc
page as a worksheet in the notebook. As a side effect, it:

- allows for uploading a .txt file from a URL (was broken)
- allows for uploading a zip file containing .txt and .html files

This little feature would give a very simple workflow for distributing
tutorial worksheets during our Sage(-Combinat) workshops, saving a lot
of hassle and time to both us and the participants (more detail upon
request). It would be great if this feature could be in the sage
stable release by early May for the next Sage-Combinat workshop in
Acadia.

I wrote the attached small patch as a proof of concept; however this
is the first time I am touching the notebook code and I am not
planning to invest in this direction in the short term. So I would be
extremely glad if some notebook expert could take over this patch,
clean it up (look for TODO/FIXME), and rebase it upon #10521 with whom
it probably conflicts lightly (this should be a breeze).

Related tickets:

- #7441: notebook: make it possible to upload from the url of a published worksheet
- #9875: Can't upload from a notebook link, only from a .sws file
- #10521: notebook upload of zipped worksheets can't deal with multiple worksheets with the same name

Thanks so much in advance!!!
					Nicolas

Issue created by migration from https://trac.sagemath.org/ticket/10652





---

archive/issue_comments_110990.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-01-18T13:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-110990",
    "user": "nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_110991.json:
```json
{
    "body": "Added #4825 to the list of related tickets.  That ticket proposes that uploading pdf files with attached .sws files would extract the .sws file and put it in the users list of worksheets.  I could see this also being useful for tutorials, books, articles, etc.",
    "created_at": "2011-01-18T13:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-110991",
    "user": "jason"
}
```

Added #4825 to the list of related tickets.  That ticket proposes that uploading pdf files with attached .sws files would extract the .sws file and put it in the users list of worksheets.  I could see this also being useful for tutorials, books, articles, etc.



---

archive/issue_comments_110992.json:
```json
{
    "body": "> This little feature would give a very simple workflow for distributing tutorial worksheets during our Sage(-Combinat) workshops, saving a lot of hassle and time to both us and the participants (more detail upon request).\n\nI'm curious about how you plan on using this.  I'd love an easy way to distribute lots of tutorials.",
    "created_at": "2011-01-18T13:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-110992",
    "user": "jason"
}
```

> This little feature would give a very simple workflow for distributing tutorial worksheets during our Sage(-Combinat) workshops, saving a lot of hassle and time to both us and the participants (more detail upon request).

I'm curious about how you plan on using this.  I'd love an easy way to distribute lots of tutorials.



---

archive/issue_comments_110993.json:
```json
{
    "body": "+1 !!! We badly need it !!!\n\nFlorent",
    "created_at": "2011-01-18T13:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-110993",
    "user": "hivert"
}
```

+1 !!! We badly need it !!!

Florent



---

archive/issue_comments_110994.json:
```json
{
    "body": "Hi Jason!\n\n> I'm curious about how you plan on using this.  I'd love an easy way to distribute lots of tutorials.\n\nSo much for being lazy :-) Here it is!\n\nWe write our tutorials as rst files in the reference manual (exact location under discussion), and share them using our Sage-Combinat patch server ([1]). On any server, we compile the html documentation, and make it available to the participants ([2]).\n\nFinaly, we point the participants to [3]. They can then click on any of the static tutorials; if they like it, they can just copy paste the url [4] from their brower into the \"Upload\" field of their notebook.\n\nNote: in case the server runs a notebook server, or if one has the sage-combinat patches installed, then one can directly use the live documentation.\n\nCheers,\n\t\t\t\tNicolas\n\n[1] http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/sage-demos-and-tutorials-nt.patch\n[2] http://combinat.sagemath.org/doc/reference/demos/\n[3] http://combinat.sagemath.org/doc/reference/demos/2011-01-17-SageDays28.html\n[4] http://combinat.sagemath.org/doc/reference/demos/demo-algebraic-combinatorics-short.html",
    "created_at": "2011-01-18T14:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-110994",
    "user": "nthiery"
}
```

Hi Jason!

> I'm curious about how you plan on using this.  I'd love an easy way to distribute lots of tutorials.

So much for being lazy :-) Here it is!

We write our tutorials as rst files in the reference manual (exact location under discussion), and share them using our Sage-Combinat patch server ([1]). On any server, we compile the html documentation, and make it available to the participants ([2]).

Finaly, we point the participants to [3]. They can then click on any of the static tutorials; if they like it, they can just copy paste the url [4] from their brower into the "Upload" field of their notebook.

Note: in case the server runs a notebook server, or if one has the sage-combinat patches installed, then one can directly use the live documentation.

Cheers,
				Nicolas

[1] http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/sage-demos-and-tutorials-nt.patch
[2] http://combinat.sagemath.org/doc/reference/demos/
[3] http://combinat.sagemath.org/doc/reference/demos/2011-01-17-SageDays28.html
[4] http://combinat.sagemath.org/doc/reference/demos/demo-algebraic-combinatorics-short.html



---

archive/issue_comments_110995.json:
```json
{
    "body": "Changing assignee from jason, mpatel, was to nthiery.",
    "created_at": "2011-01-18T14:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-110995",
    "user": "nthiery"
}
```

Changing assignee from jason, mpatel, was to nthiery.



---

archive/issue_comments_110996.json:
```json
{
    "body": "Changing keywords from \"Sphinx, upload, static html documentation\" to \"days28, Sphinx, upload, static html documentation\".",
    "created_at": "2011-01-18T15:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-110996",
    "user": "slelievre"
}
```

Changing keywords from "Sphinx, upload, static html documentation" to "days28, Sphinx, upload, static html documentation".



---

archive/issue_comments_110997.json:
```json
{
    "body": "This is great work. It should definitely be possible to upload anything sensible to the notebook and have it give you a worksheet.\n\nGiven the upcoming changes in the notebook, perhaps this ticket should be viewed as a feature request for the new Flask-based notebook.",
    "created_at": "2011-01-21T04:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-110997",
    "user": "ddrake"
}
```

This is great work. It should definitely be possible to upload anything sensible to the notebook and have it give you a worksheet.

Given the upcoming changes in the notebook, perhaps this ticket should be viewed as a feature request for the new Flask-based notebook.



---

archive/issue_comments_110998.json:
```json
{
    "body": "Hi Dan!\n\nReplying to [comment:10 ddrake]:\n> This is great work.\n\n:-)\n\n> Given the upcoming changes in the notebook, perhaps this ticket should be viewed as a feature request for the new Flask-based notebook.\n\nThis sounds natural indeed!\n\nHowever, since the feature is needed very soon, and the change minor, I still would appreciate if this patch (or some improved version) was merged in soon in the current notebook.",
    "created_at": "2011-01-21T08:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-110998",
    "user": "nthiery"
}
```

Hi Dan!

Replying to [comment:10 ddrake]:
> This is great work.

:-)

> Given the upcoming changes in the notebook, perhaps this ticket should be viewed as a feature request for the new Flask-based notebook.

This sounds natural indeed!

However, since the feature is needed very soon, and the change minor, I still would appreciate if this patch (or some improved version) was merged in soon in the current notebook.



---

archive/issue_comments_110999.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2011-01-21T08:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-110999",
    "user": "nthiery"
}
```

Changing priority from major to critical.



---

archive/issue_comments_111000.json:
```json
{
    "body": "Hi nthiery,\n\nThis would be a nice change.  See also [sws2tex](https://bitbucket.org/whuss/sws2tex/) and [tex2sws](https://bitbucket.org/rbeezer/tex2sws/) for related projects.\n\nI am sorry that I can't review this and test it properly right now, though the code seems ok in the main.  What does the \"assert False\" do - I know what assert usually does, but I assume this is some special use of that statement?\n\nAlso, it would perhaps be better to us os.path or something like that \n\n```\nsage: a = \"http://www.me.com/mysheet.sws\"\nsage: os.path.splitext(a)\n('http://www.me.com/mysheet', '.sws')\n```\n\nin twist.py and then just check the `result[1]` for the extensions that are allowed all at once, keeping that for glueing on later, also with os.path?\n\nBy the way, you could perhaps just use this on your combinat server - sometimes people put custom patches on servers, it's not hard to do if you're the admin.  That would keep it from being quite as critical to the rest of Sage.",
    "created_at": "2011-04-05T13:26:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111000",
    "user": "kcrisman"
}
```

Hi nthiery,

This would be a nice change.  See also [sws2tex](https://bitbucket.org/whuss/sws2tex/) and [tex2sws](https://bitbucket.org/rbeezer/tex2sws/) for related projects.

I am sorry that I can't review this and test it properly right now, though the code seems ok in the main.  What does the "assert False" do - I know what assert usually does, but I assume this is some special use of that statement?

Also, it would perhaps be better to us os.path or something like that 

```
sage: a = "http://www.me.com/mysheet.sws"
sage: os.path.splitext(a)
('http://www.me.com/mysheet', '.sws')
```

in twist.py and then just check the `result[1]` for the extensions that are allowed all at once, keeping that for glueing on later, also with os.path?

By the way, you could perhaps just use this on your combinat server - sometimes people put custom patches on servers, it's not hard to do if you're the admin.  That would keep it from being quite as critical to the rest of Sage.



---

archive/issue_comments_111001.json:
```json
{
    "body": "Replying to [comment:13 kcrisman]:\n> This would be a nice change.  See also [sws2tex](https://bitbucket.org/whuss/sws2tex/) and [tex2sws](https://bitbucket.org/rbeezer/tex2sws/) for related projects.\n> \n> I am sorry that I can't review this and test it properly right now, though the code seems ok in the main.  What does the \"assert False\" do - I know what assert usually does, but I assume this is some special use of that statement?\n\nJust a big fat advertisement that the execution flow is not supposed\nto get there :-)\n\nA proper assertion should be raised instead, but as the comment\nstates, I would need to have some feed back from the notebook people\nto know which assertion would be most appropriate here.\n\nOk, I guess I'll just raise an RunTimeError for the moment.\n\n> Also, it would perhaps be better to us os.path or something like that \n> {{{\n> sage: a = \"http://www.me.com/mysheet.sws\"\n> sage: os.path.splitext(a)\n> ('http://www.me.com/mysheet', '.sws')\n> }}}\n> in twist.py and then just check the `result[1]` for the extensions that are allowed all at once, keeping that for glueing on later, also with os.path?\n\nWill do now.\n\n> By the way, you could perhaps just use this on your combinat\n> server - sometimes people put custom patches on servers, it's not\n> hard to do if you're the admin.  That would keep it from being quite\n> as critical to the rest of Sage.\n\nThe point is that we want to use this feature with the very first\ntutorials. In particuliar with complete newbies. If using Sage starts\nby having to apply a patch, we are going to scare them away :-) And\nmany of them won't have the required development tools to install the\nSage-Combinat queue, etc.\n\nThanks for your comments,\n\nCheers,\n                    Nicolas",
    "created_at": "2011-04-05T13:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111001",
    "user": "nthiery"
}
```

Replying to [comment:13 kcrisman]:
> This would be a nice change.  See also [sws2tex](https://bitbucket.org/whuss/sws2tex/) and [tex2sws](https://bitbucket.org/rbeezer/tex2sws/) for related projects.
> 
> I am sorry that I can't review this and test it properly right now, though the code seems ok in the main.  What does the "assert False" do - I know what assert usually does, but I assume this is some special use of that statement?

Just a big fat advertisement that the execution flow is not supposed
to get there :-)

A proper assertion should be raised instead, but as the comment
states, I would need to have some feed back from the notebook people
to know which assertion would be most appropriate here.

Ok, I guess I'll just raise an RunTimeError for the moment.

> Also, it would perhaps be better to us os.path or something like that 
> {{{
> sage: a = "http://www.me.com/mysheet.sws"
> sage: os.path.splitext(a)
> ('http://www.me.com/mysheet', '.sws')
> }}}
> in twist.py and then just check the `result[1]` for the extensions that are allowed all at once, keeping that for glueing on later, also with os.path?

Will do now.

> By the way, you could perhaps just use this on your combinat
> server - sometimes people put custom patches on servers, it's not
> hard to do if you're the admin.  That would keep it from being quite
> as critical to the rest of Sage.

The point is that we want to use this feature with the very first
tutorials. In particuliar with complete newbies. If using Sage starts
by having to apply a patch, we are going to scare them away :-) And
many of them won't have the required development tools to install the
Sage-Combinat queue, etc.

Thanks for your comments,

Cheers,
                    Nicolas



---

archive/issue_comments_111002.json:
```json
{
    "body": "I see, you mean you want them to be able to upload them to their own local Sage installations or servers.  I understand.  \n\nI'd raise some sort of input error or value error myself, with message about the URL file ending not one that we support (perhaps with a list?  though such lists can get long as we support more and more extensions...).  \n\nAgain, sorry I can't do a full review.  Can any of the other sage-combinat people do it?    Of course, even if we made a new sagenb spkg (perhaps with jmol and a couple other things that are about ready) there is no guarantee that Jeroen will put it in 4.7, since he already has made four alphas.",
    "created_at": "2011-04-05T13:46:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111002",
    "user": "kcrisman"
}
```

I see, you mean you want them to be able to upload them to their own local Sage installations or servers.  I understand.  

I'd raise some sort of input error or value error myself, with message about the URL file ending not one that we support (perhaps with a list?  though such lists can get long as we support more and more extensions...).  

Again, sorry I can't do a full review.  Can any of the other sage-combinat people do it?    Of course, even if we made a new sagenb spkg (perhaps with jmol and a couple other things that are about ready) there is no guarantee that Jeroen will put it in 4.7, since he already has made four alphas.



---

archive/issue_comments_111003.json:
```json
{
    "body": "The code mainly looks okay to me, but here are a few points that worry me.  I haven't tested this, so this is not a full review (yet).\n\n1. We of course don't want the notebook to crash if someone uploads a file other than the right type.  The assert statement in checking this worries me.  I'd say a ValueError would be appropriate (we got something that was the wrong value).\n\n2. In the _import_worksheet_html function, there is a return statement, but then there are two more lines of code.  What are those two lines doing after the return statement?",
    "created_at": "2011-04-05T14:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111003",
    "user": "jason"
}
```

The code mainly looks okay to me, but here are a few points that worry me.  I haven't tested this, so this is not a full review (yet).

1. We of course don't want the notebook to crash if someone uploads a file other than the right type.  The assert statement in checking this worries me.  I'd say a ValueError would be appropriate (we got something that was the wrong value).

2. In the _import_worksheet_html function, there is a return statement, but then there are two more lines of code.  What are those two lines doing after the return statement?



---

archive/issue_comments_111004.json:
```json
{
    "body": "Replying to [comment:16 jason]:\n> The code mainly looks okay to me, but here are a few points that worry me.  I haven't tested this, so this is not a full review (yet).\n> \n> 1. We of course don't want the notebook to crash if someone uploads a file other than the right type.  The assert statement in checking this worries me.  I'd say a ValueError would be appropriate (we got something that was the wrong value).\n\nSo that's what assert False would do?  Okay, then I definitely would raise an error.  Jason's suggestion sounds fine.",
    "created_at": "2011-04-05T14:09:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111004",
    "user": "kcrisman"
}
```

Replying to [comment:16 jason]:
> The code mainly looks okay to me, but here are a few points that worry me.  I haven't tested this, so this is not a full review (yet).
> 
> 1. We of course don't want the notebook to crash if someone uploads a file other than the right type.  The assert statement in checking this worries me.  I'd say a ValueError would be appropriate (we got something that was the wrong value).

So that's what assert False would do?  Okay, then I definitely would raise an error.  Jason's suggestion sounds fine.



---

archive/issue_comments_111005.json:
```json
{
    "body": "Attachment [trac_10652-upload-static-documentation-as-worksheet-nt.patch](tarball://root/attachments/some-uuid/ticket10652/trac_10652-upload-static-documentation-as-worksheet-nt.patch) by nthiery created at 2011-04-05 15:36:04",
    "created_at": "2011-04-05T15:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111005",
    "user": "nthiery"
}
```

Attachment [trac_10652-upload-static-documentation-as-worksheet-nt.patch](tarball://root/attachments/some-uuid/ticket10652/trac_10652-upload-static-documentation-as-worksheet-nt.patch) by nthiery created at 2011-04-05 15:36:04



---

archive/issue_comments_111006.json:
```json
{
    "body": "Hi!\n\nThanks for your further comments.\n\nIn the updated patch, the ``assert false`` is replaced by an\nHTMLResponse; please check that the message is meaningful enough. The\nextension guessins is now done with urlparse + splitext to get the\nextension (though there are comments on the web that we should use the\nContent-Type answer of the web server; but that was not very practical\nhere). The two lines after the ``return`` are removed; they were just\naccidental residue of some former experimentation. Finally, I wrote\nthe missing doctest for _import_worksheet_html. I still have a problem\nthere, since the doctest does not pass (there is a single garbled\ncell, instead of several), whereas running it by hand in the sage\ninterpreter just works fine. Help welcome!\n\nCheers,\n                Nicolas",
    "created_at": "2011-04-05T15:47:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111006",
    "user": "nthiery"
}
```

Hi!

Thanks for your further comments.

In the updated patch, the ``assert false`` is replaced by an
HTMLResponse; please check that the message is meaningful enough. The
extension guessins is now done with urlparse + splitext to get the
extension (though there are comments on the web that we should use the
Content-Type answer of the web server; but that was not very practical
here). The two lines after the ``return`` are removed; they were just
accidental residue of some former experimentation. Finally, I wrote
the missing doctest for _import_worksheet_html. I still have a problem
there, since the doctest does not pass (there is a single garbled
cell, instead of several), whereas running it by hand in the sage
interpreter just works fine. Help welcome!

Cheers,
                Nicolas



---

archive/issue_comments_111007.json:
```json
{
    "body": "Replying to [comment:19 nthiery]:\n> \tHi!\n> \n> Thanks for your further comments.\n> \n> In the updated patch, the ``assert false`` is replaced by an\n> HTMLResponse; please check that the message is meaningful enough. The\n> extension guessins is now done with urlparse + splitext to get the\n> extension (though there are comments on the web that we should use the\n> Content-Type answer of the web server; but that was not very practical\n> here). The two lines after the ``return`` are removed; they were just\n> accidental residue of some former experimentation. Finally, I wrote\n> the missing doctest for _import_worksheet_html. I still have a problem\n> there, since the doctest does not pass (there is a single garbled\n> cell, instead of several), whereas running it by hand in the sage\n> interpreter just works fine. Help welcome!\n> \n\nThis is what I got when I ran the doctest by hand:\n\n\n```\nsage: nb = sagenb.notebook.notebook.Notebook(tmp_dir()+'.sagenb')\nsage: name = tmp_filename() + '.html'\nsage: fd = open(name,'w')\nsage: fd.write('\\n'.join(\n....: ['<html><head><title>Test Notebook</title></head>',\n....: '<body>',\n....: '<div class=\"highlight-python\"><div class=\"highlight\"><pre>',\n....: '<span class=\"gp\">sage: </span><span class=\"mi\">1</span><span class=\"o\">+</span><span class=\"mi\">1</span>',\n....: '<span class=\"go\">2</span>',\n....: '</pre></div></div>',\n....: '</body></html>']))\nsage: fd.close()\nsage: W = nb._import_worksheet_html(name, 'admin')\nsage: W.name()\nu'Test Notebook'\nsage: \nsage: W.owner()\n'admin'\nsage: W.cell_list()\n[TextCell 1: Test Notebook\nsystem:sage\n\n<div class=\"highlight-python\">, Cell 0; in=1+1, out=\n2\n, TextCell 2: </div]\nsage: cell = W.cell_list()[1]\nsage: cell.input_text()\nu'1+1'\nsage: cell.output_text()\nu'<pre class=\"shrunk\">2</pre>'\n```\n\n\n\n\n> Cheers,\n>                 Nicolas",
    "created_at": "2011-04-05T19:21:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111007",
    "user": "jason"
}
```

Replying to [comment:19 nthiery]:
> 	Hi!
> 
> Thanks for your further comments.
> 
> In the updated patch, the ``assert false`` is replaced by an
> HTMLResponse; please check that the message is meaningful enough. The
> extension guessins is now done with urlparse + splitext to get the
> extension (though there are comments on the web that we should use the
> Content-Type answer of the web server; but that was not very practical
> here). The two lines after the ``return`` are removed; they were just
> accidental residue of some former experimentation. Finally, I wrote
> the missing doctest for _import_worksheet_html. I still have a problem
> there, since the doctest does not pass (there is a single garbled
> cell, instead of several), whereas running it by hand in the sage
> interpreter just works fine. Help welcome!
> 

This is what I got when I ran the doctest by hand:


```
sage: nb = sagenb.notebook.notebook.Notebook(tmp_dir()+'.sagenb')
sage: name = tmp_filename() + '.html'
sage: fd = open(name,'w')
sage: fd.write('\n'.join(
....: ['<html><head><title>Test Notebook</title></head>',
....: '<body>',
....: '<div class="highlight-python"><div class="highlight"><pre>',
....: '<span class="gp">sage: </span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span>',
....: '<span class="go">2</span>',
....: '</pre></div></div>',
....: '</body></html>']))
sage: fd.close()
sage: W = nb._import_worksheet_html(name, 'admin')
sage: W.name()
u'Test Notebook'
sage: 
sage: W.owner()
'admin'
sage: W.cell_list()
[TextCell 1: Test Notebook
system:sage

<div class="highlight-python">, Cell 0; in=1+1, out=
2
, TextCell 2: </div]
sage: cell = W.cell_list()[1]
sage: cell.input_text()
u'1+1'
sage: cell.output_text()
u'<pre class="shrunk">2</pre>'
```




> Cheers,
>                 Nicolas



---

archive/issue_comments_111008.json:
```json
{
    "body": "Replying to [comment:19 nthiery]:\n> \tHi!\n> \n> Thanks for your further comments.\n> \n> In the updated patch, the ``assert false`` is replaced by an\n> HTMLResponse; please check that the message is meaningful enough. The\n> extension guessins is now done with urlparse + splitext to get the\n> extension (though there are comments on the web that we should use the\n> Content-Type answer of the web server; but that was not very practical\n> here). The two lines after the ``return`` are removed; they were just\n> accidental residue of some former experimentation. Finally, I wrote\n> the missing doctest for _import_worksheet_html. I still have a problem\n> there, since the doctest does not pass (there is a single garbled\n> cell, instead of several), whereas running it by hand in the sage\n> interpreter just works fine. Help welcome!\n> \n\nThe problem is that the doctesting system replaces the \"sage: \" *inside* your html file with \">>>\", which of course messes everything up.\n\nI have a patch coming up.",
    "created_at": "2011-04-05T21:56:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111008",
    "user": "jason"
}
```

Replying to [comment:19 nthiery]:
> 	Hi!
> 
> Thanks for your further comments.
> 
> In the updated patch, the ``assert false`` is replaced by an
> HTMLResponse; please check that the message is meaningful enough. The
> extension guessins is now done with urlparse + splitext to get the
> extension (though there are comments on the web that we should use the
> Content-Type answer of the web server; but that was not very practical
> here). The two lines after the ``return`` are removed; they were just
> accidental residue of some former experimentation. Finally, I wrote
> the missing doctest for _import_worksheet_html. I still have a problem
> there, since the doctest does not pass (there is a single garbled
> cell, instead of several), whereas running it by hand in the sage
> interpreter just works fine. Help welcome!
> 

The problem is that the doctesting system replaces the "sage: " *inside* your html file with ">>>", which of course messes everything up.

I have a patch coming up.



---

archive/issue_comments_111009.json:
```json
{
    "body": "Attachment [trac-10652-reviewer.patch](tarball://root/attachments/some-uuid/ticket10652/trac-10652-reviewer.patch) by jason created at 2011-04-05 22:22:59\n\napply on top of previous patches",
    "created_at": "2011-04-05T22:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111009",
    "user": "jason"
}
```

Attachment [trac-10652-reviewer.patch](tarball://root/attachments/some-uuid/ticket10652/trac-10652-reviewer.patch) by jason created at 2011-04-05 22:22:59

apply on top of previous patches



---

archive/issue_comments_111010.json:
```json
{
    "body": "nthiery: positive review on your patch, modulo the changes in my patch.  Can you review my patch?\n\nThree substantial changes: \n\n1. I changed the doctest to use a bit more of the actual generated documentation file structure.\n\n2. I changed the linebreaks in the doctest so that the string \"sage: \" did not appear as consecutive characters in input (this works around the bug in the doctesting system which replaces \"sage:\" with \">>>\")\n\n3. I deleted the line which prepended the title and system to the text of the worksheet.  Those don't do anything but show up as the first part of the first text cell, which is silly.  The default system is already 'sage', and the title is set when the worksheet is created.\n\nCan you review my reviewer patch?  If you think it's good, set this ticket to positive review.",
    "created_at": "2011-04-05T22:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111010",
    "user": "jason"
}
```

nthiery: positive review on your patch, modulo the changes in my patch.  Can you review my patch?

Three substantial changes: 

1. I changed the doctest to use a bit more of the actual generated documentation file structure.

2. I changed the linebreaks in the doctest so that the string "sage: " did not appear as consecutive characters in input (this works around the bug in the doctesting system which replaces "sage:" with ">>>")

3. I deleted the line which prepended the title and system to the text of the worksheet.  Those don't do anything but show up as the first part of the first text cell, which is silly.  The default system is already 'sage', and the title is set when the worksheet is created.

Can you review my reviewer patch?  If you think it's good, set this ticket to positive review.



---

archive/issue_comments_111011.json:
```json
{
    "body": "This looks good. We should somehow document or advertise this functionality. Perhaps something should be added to the upload page? That could be a separate ticket; we don't want to bog this one down.",
    "created_at": "2011-04-06T00:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111011",
    "user": "ddrake"
}
```

This looks good. We should somehow document or advertise this functionality. Perhaps something should be added to the upload page? That could be a separate ticket; we don't want to bog this one down.



---

archive/issue_comments_111012.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-04-06T05:48:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111012",
    "user": "nthiery"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_111013.json:
```json
{
    "body": "Replying to [comment:22 jason]:\n> nthiery: positive review on your patch, modulo the changes in my patch.  Can you review my patch?\n> \n> Three substantial changes: \n> \n> 1. I changed the doctest to use a bit more of the actual generated documentation file structure.\n> \n> 2. I changed the linebreaks in the doctest so that the string \"sage: \" did not appear as consecutive characters in input (this works around the bug in the doctesting system which replaces \"sage:\" with \">>>\")\n\nAh ah! Good catch.\n\n> 3. I deleted the line which prepended the title and system to the text of the worksheet.  Those don't do anything but show up as the first part of the first text cell, which is silly.  The default system is already 'sage', and the title is set when the worksheet is created.\n> \n> Can you review my reviewer patch?  If you think it's good, set this ticket to positive review.\n\nIt's all good. Thanks much for the review (on behalf of the Sage Days 30 participants)!\n\nCheers,\n                     Nicolas",
    "created_at": "2011-04-06T05:50:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111013",
    "user": "nthiery"
}
```

Replying to [comment:22 jason]:
> nthiery: positive review on your patch, modulo the changes in my patch.  Can you review my patch?
> 
> Three substantial changes: 
> 
> 1. I changed the doctest to use a bit more of the actual generated documentation file structure.
> 
> 2. I changed the linebreaks in the doctest so that the string "sage: " did not appear as consecutive characters in input (this works around the bug in the doctesting system which replaces "sage:" with ">>>")

Ah ah! Good catch.

> 3. I deleted the line which prepended the title and system to the text of the worksheet.  Those don't do anything but show up as the first part of the first text cell, which is silly.  The default system is already 'sage', and the title is set when the worksheet is created.
> 
> Can you review my reviewer patch?  If you think it's good, set this ticket to positive review.

It's all good. Thanks much for the review (on behalf of the Sage Days 30 participants)!

Cheers,
                     Nicolas



---

archive/issue_comments_111014.json:
```json
{
    "body": "Replying to [comment:24 ddrake]:\n> This looks good. We should somehow document or advertise this functionality. Perhaps something should be added to the upload page? That could be a separate ticket; we don't want to bog this one down.\n\nI uploaded an extra mini patch doing that. Please add it to the Apply list if you are happy with it. I left the positive review so as not to prevent Jeroen to merge the two first patches in the mean time. If this happens, we will just open a new ticket.",
    "created_at": "2011-04-06T06:12:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111014",
    "user": "nthiery"
}
```

Replying to [comment:24 ddrake]:
> This looks good. We should somehow document or advertise this functionality. Perhaps something should be added to the upload page? That could be a separate ticket; we don't want to bog this one down.

I uploaded an extra mini patch doing that. Please add it to the Apply list if you are happy with it. I left the positive review so as not to prevent Jeroen to merge the two first patches in the mean time. If this happens, we will just open a new ticket.



---

archive/issue_comments_111015.json:
```json
{
    "body": "Wouldn't a new sagenb package need to be produced first for Jeroen to merge it?  Or is it okay for the release manager to just do hg_sagenb.apply or whatever and be done with it?",
    "created_at": "2011-04-06T11:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111015",
    "user": "kcrisman"
}
```

Wouldn't a new sagenb package need to be produced first for Jeroen to merge it?  Or is it okay for the release manager to just do hg_sagenb.apply or whatever and be done with it?



---

archive/issue_comments_111016.json:
```json
{
    "body": "Replying to [comment:29 kcrisman]:\n> Wouldn't a new sagenb package need to be produced first for Jeroen to merge it?\n\nI consider `sagenb` to be part of Sage; hence I merge patches just like I merge `extcode` patches for example.  So you don't need to produce any `sagenb` spkg.",
    "created_at": "2011-04-07T08:44:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111016",
    "user": "jdemeyer"
}
```

Replying to [comment:29 kcrisman]:
> Wouldn't a new sagenb package need to be produced first for Jeroen to merge it?

I consider `sagenb` to be part of Sage; hence I merge patches just like I merge `extcode` patches for example.  So you don't need to produce any `sagenb` spkg.



---

archive/issue_comments_111017.json:
```json
{
    "body": "Replying to [comment:31 jdemeyer]:\n\n> I consider `sagenb` to be part of Sage; hence I merge patches just like I merge `extcode` patches for example.  So you don't need to produce any `sagenb` spkg.\n\nThanks!",
    "created_at": "2011-04-07T08:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111017",
    "user": "jason"
}
```

Replying to [comment:31 jdemeyer]:

> I consider `sagenb` to be part of Sage; hence I merge patches just like I merge `extcode` patches for example.  So you don't need to produce any `sagenb` spkg.

Thanks!



---

archive/issue_comments_111018.json:
```json
{
    "body": "Replying to [comment:32 jason]:\n> Replying to [comment:31 jdemeyer]:\n> \n> > I consider `sagenb` to be part of Sage; hence I merge patches just like I merge `extcode` patches for example.  So you don't need to produce any `sagenb` spkg.\n> \nAs my daughter would say, \"I love that a googol!\"  \n\n+oo\n\nIn that case I will definitely get to work on other sagenb stuff pronto.  What great news!",
    "created_at": "2011-04-07T13:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111018",
    "user": "kcrisman"
}
```

Replying to [comment:32 jason]:
> Replying to [comment:31 jdemeyer]:
> 
> > I consider `sagenb` to be part of Sage; hence I merge patches just like I merge `extcode` patches for example.  So you don't need to produce any `sagenb` spkg.
> 
As my daughter would say, "I love that a googol!"  

+oo

In that case I will definitely get to work on other sagenb stuff pronto.  What great news!



---

archive/issue_comments_111019.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-04-07T19:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111019",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_111020.json:
```json
{
    "body": "Patch [attachment:trac_10652-upload-static-documentation-as-worksheet-advertise-nt.patch] needs a proper commit message (use `hg qrefresh -e` for that, keep in mind that the ticket number should be on the first line)>",
    "created_at": "2011-04-07T19:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111020",
    "user": "jdemeyer"
}
```

Patch [attachment:trac_10652-upload-static-documentation-as-worksheet-advertise-nt.patch] needs a proper commit message (use `hg qrefresh -e` for that, keep in mind that the ticket number should be on the first line)>



---

archive/issue_comments_111021.json:
```json
{
    "body": "Attachment [trac_10652-upload-static-documentation-as-worksheet-advertise-nt.patch](tarball://root/attachments/some-uuid/ticket10652/trac_10652-upload-static-documentation-as-worksheet-advertise-nt.patch) by nthiery created at 2011-04-07 20:58:51",
    "created_at": "2011-04-07T20:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111021",
    "user": "nthiery"
}
```

Attachment [trac_10652-upload-static-documentation-as-worksheet-advertise-nt.patch](tarball://root/attachments/some-uuid/ticket10652/trac_10652-upload-static-documentation-as-worksheet-advertise-nt.patch) by nthiery created at 2011-04-07 20:58:51



---

archive/issue_comments_111022.json:
```json
{
    "body": "Replying to [comment:34 jdemeyer]:\n> Patch [attachment:trac_10652-upload-static-documentation-as-worksheet-advertise-nt.patch] needs a proper commit message (use `hg qrefresh -e` for that, keep in mind that the ticket number should be on the first line)>\n\nDone!",
    "created_at": "2011-04-07T20:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111022",
    "user": "nthiery"
}
```

Replying to [comment:34 jdemeyer]:
> Patch [attachment:trac_10652-upload-static-documentation-as-worksheet-advertise-nt.patch] needs a proper commit message (use `hg qrefresh -e` for that, keep in mind that the ticket number should be on the first line)>

Done!



---

archive/issue_comments_111023.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2011-04-07T20:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111023",
    "user": "nthiery"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_111024.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-04-08T08:43:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111024",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_111025.json:
```json
{
    "body": "Yippee! Thanks Jeroen!",
    "created_at": "2011-04-08T08:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10599#issuecomment-111025",
    "user": "nthiery"
}
```

Yippee! Thanks Jeroen!
