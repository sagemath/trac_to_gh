# Issue 26002: QQ not isomorphic to itself

Issue created by migration from https://trac.sagemath.org/ticket/26239

Original creator: cremona

Original creation time: 2018-09-11 11:32:14

CC:  jdemeyer

Keywords: field isomorphism, pari interface


```
sage: Qx = PolynomialRing(QQ,'x')
sage: F1 = NumberField(Qx([0,1]),'a1'); F1
Number Field in a1 with defining polynomial x
sage: F2 = NumberField(Qx([0,1]),'a2'); F2
Number Field in a2 with defining polynomial x
sage: F1.is_isomorphic(F2)
False
```


The bug is because of this:


```
sage: f1=F1.pari_polynomial(); f1
x
sage: f2=F2.pari_polynomial(); f2
x
sage: f1.nfisisom(f2)
[0]
sage: f1.nfisisom(f2) ==0
True
```


As far as I can see this problem will only arise when both fields are QQ, with defining polynomial 'x'.
So pari correctly finds an isomorphism but Sage thinks that paris's [0] is the same as pari's 0, the latter being what is returned when the fields are not isomorphic.


---

Comment by cremona created at 2018-12-14 09:36:45

Working on it.  I am also changing the return type of the maps (which are not returned by default) since currently what is returned is a pari list of pari polynomials.  As far as I can tell the is_isomorphism() method with isomorphism_maps=True is not used anywhere in the sage library.


---

Comment by cremona created at 2018-12-14 09:36:45

Changing component from interfaces to number fields.


---

Comment by cremona created at 2018-12-14 10:03:31

Changing keywords from "field isomorphism, pari interface" to "number field isomorphism".


---

Comment by cremona created at 2018-12-14 10:03:31

New commits:


---

Comment by cremona created at 2018-12-14 10:03:31

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-12-14 10:26:50

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2018-12-14 10:26:50

doc is not formatted correctly (missing `::`)


---

Comment by git created at 2018-12-14 11:05:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cremona created at 2018-12-14 11:06:02

Replying to [comment:3 chapoton]:
> doc is not formatted correctly (missing `::`)

Sorry --fixed.


---

Comment by jdemeyer created at 2018-12-14 11:55:26

And this is kind of strange also (double "see"):

```
See (see :trac:`26239`)::
```



---

Comment by jdemeyer created at 2018-12-14 11:56:02

The code looks good though, although it's abusing `length()` a bit :-)


---

Comment by git created at 2018-12-14 12:04:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cremona created at 2018-12-14 12:05:43

sorry again, fixed again.
JD: I am using t.length() to find the length of the pari list t, so why do you call that an abuse?


---

Comment by cremona created at 2018-12-14 12:05:43

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2018-12-14 12:57:38

Replying to [comment:9 cremona]:
> I am using t.length() to find the length of the pari list t, so why do you call that an abuse?

You are also calling it on the integer `0` which happens to have length 0.


---

Comment by cremona created at 2018-12-14 14:56:30

Replying to [comment:10 jdemeyer]:
> Replying to [comment:9 cremona]:
> > I am using t.length() to find the length of the pari list t, so why do you call that an abuse?
> 
> You are also calling it on the integer `0` which happens to have length 0.

OK, I see. I forgot that when fields are not isomorphic pari returns 0 and not the empty list.   Feel free to suggest an alternative fix which tests for 0 in a way which does not also match [0].


---

Comment by jdemeyer created at 2018-12-14 15:07:50

Replying to [comment:11 cremona]:
> I forgot that when fields are not isomorphic pari returns 0 and not the empty list.

That's the underlying reason for the bug that we're trying to fix.

> Feel free to suggest an alternative fix which tests for 0 in a way which does not also match [0].

Checking the length is partially a hack and partially elegant at the same time. I would have checked the type (`t.type() == "t_VEC"`) but I'm fine your proposal.


---

Comment by jdemeyer created at 2018-12-14 15:08:40

Changing status from needs_review to positive_review.


---

Comment by cremona created at 2018-12-14 16:25:03

Thanks!


---

Comment by cremona created at 2018-12-15 12:27:35

Replying to [comment:15 chapoton]:

Why not 8.5 as it's a tiny change which fixes a mathematically incorrect output?


---

Comment by chapoton created at 2018-12-15 13:30:47

oh, well. I am pretty sure it will not make it.


---

Comment by vbraun created at 2018-12-23 23:40:59

Resolution: fixed


---

Comment by embray created at 2018-12-28 14:06:38

This tickets were closed as fixed after the Sage 8.5 release.


---

Comment by cremona created at 2019-01-03 12:36:22

(comment added in error, I see taht this has been merged, just not in 8.5)


---

Comment by cremona created at 2019-01-03 12:36:22

Set assignee to cremona.
