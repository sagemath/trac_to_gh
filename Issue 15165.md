# Issue 15165: PARI: add patch for exponential_integral_1() precision

archive/issues_015165.json:
```json
{
    "body": "There is a bug in PARI where the precision of the `eint1()` function (exponential integral) is quite bad. This is fixed upstream and we should take the patch into the PARI spkg. See also #15299.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15402\n\n",
    "created_at": "2013-11-12T11:35:15Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "title": "PARI: add patch for exponential_integral_1() precision",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15165",
    "user": "jdemeyer"
}
```
There is a bug in PARI where the precision of the `eint1()` function (exponential integral) is quite bad. This is fixed upstream and we should take the patch into the PARI spkg. See also #15299.

Issue created by migration from https://trac.sagemath.org/ticket/15402





---

archive/issue_comments_194730.json:
```json
{
    "body": "Patch seems to work fine, modulo adding doctests.",
    "created_at": "2013-11-12T23:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15165#issuecomment-194730",
    "user": "jdemeyer"
}
```

Patch seems to work fine, modulo adding doctests.



---

archive/issue_comments_194731.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-11-13T16:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15165#issuecomment-194731",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_194732.json:
```json
{
    "body": "Fails to install with `SAGE_CHECK=yes` on 32-bit systems.",
    "created_at": "2013-11-13T16:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15165#issuecomment-194732",
    "user": "jdemeyer"
}
```

Fails to install with `SAGE_CHECK=yes` on 32-bit systems.



---

archive/issue_comments_194733.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-11-13T16:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15165#issuecomment-194733",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_194734.json:
```json
{
    "body": "Just to check if I understand correctly, is the situation as follows?\n1. PARI's `eint1()` had potentially large errors both for a single argument and for the vector version;\n2. the single argument version is fixed upstream;\n3. for the vector version `y = eint1(x, n)` with `n > 15`, the entries `y[i]` with `i >= 15` can still have large errors;\n4. the patch fixes (1) by backporting the upstream fix (2), and fixes (3) by increasing the precision depending on *n*.\nA small observation about where to look for the cause of (3): it could be related to the fact that `mpveceint1()` (in `basemath/trans3.c`) apparently computes the `y[i]` with `i >= 15` via a recursive formula going from `i = n` downwards.  I guess any detailed discussion of this should continue on the `pari-dev` mailing list.",
    "created_at": "2013-11-13T20:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15165#issuecomment-194734",
    "user": "pbruin"
}
```

Just to check if I understand correctly, is the situation as follows?
1. PARI's `eint1()` had potentially large errors both for a single argument and for the vector version;
2. the single argument version is fixed upstream;
3. for the vector version `y = eint1(x, n)` with `n > 15`, the entries `y[i]` with `i >= 15` can still have large errors;
4. the patch fixes (1) by backporting the upstream fix (2), and fixes (3) by increasing the precision depending on *n*.
A small observation about where to look for the cause of (3): it could be related to the fact that `mpveceint1()` (in `basemath/trans3.c`) apparently computes the `y[i]` with `i >= 15` via a recursive formula going from `i = n` downwards.  I guess any detailed discussion of this should continue on the `pari-dev` mailing list.



---

archive/issue_comments_194735.json:
```json
{
    "body": "Replying to [comment:7 pbruin]:\n> Just to check if I understand correctly, is the situation as follows?\n> 1. PARI's `eint1()` had potentially large errors both for a single argument and for the vector version;\n> 2. the single argument version is fixed upstream;\n> 3. for the vector version `y = eint1(x, n)` with `n > 15`, the entries `y[i]` with `i >= 15` can still have large errors;\n> 4. the patch fixes (1) by backporting the upstream fix (2), and fixes (3) by increasing the precision depending on *n*.\n> A small observation about where to look for the cause of (3): it could be related to the fact that `mpveceint1()` (in `basemath/trans3.c`) apparently computes the `y[i]` with `i >= 15` via a recursive formula going from `i = n` downwards.  I guess any detailed discussion of this should continue on the `pari-dev` mailing list.\n\nYou're mostly right, except that the vector version is also much better in the PARI git version. That algorithm was completely rewritten and I also backported that.\n\nI found the extra number of bits needed experimentally.",
    "created_at": "2013-11-13T20:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15165#issuecomment-194735",
    "user": "jdemeyer"
}
```

Replying to [comment:7 pbruin]:
> Just to check if I understand correctly, is the situation as follows?
> 1. PARI's `eint1()` had potentially large errors both for a single argument and for the vector version;
> 2. the single argument version is fixed upstream;
> 3. for the vector version `y = eint1(x, n)` with `n > 15`, the entries `y[i]` with `i >= 15` can still have large errors;
> 4. the patch fixes (1) by backporting the upstream fix (2), and fixes (3) by increasing the precision depending on *n*.
> A small observation about where to look for the cause of (3): it could be related to the fact that `mpveceint1()` (in `basemath/trans3.c`) apparently computes the `y[i]` with `i >= 15` via a recursive formula going from `i = n` downwards.  I guess any detailed discussion of this should continue on the `pari-dev` mailing list.

You're mostly right, except that the vector version is also much better in the PARI git version. That algorithm was completely rewritten and I also backported that.

I found the extra number of bits needed experimentally.



---

archive/issue_comments_194736.json:
```json
{
    "body": "Attachment [15402_exponential_integral.patch](tarball://root/attachments/some-uuid/ticket15402/15402_exponential_integral.patch) by jdemeyer created at 2013-11-13 20:38:46",
    "created_at": "2013-11-13T20:38:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15165#issuecomment-194736",
    "user": "jdemeyer"
}
```

Attachment [15402_exponential_integral.patch](tarball://root/attachments/some-uuid/ticket15402/15402_exponential_integral.patch) by jdemeyer created at 2013-11-13 20:38:46



---

archive/issue_comments_194737.json:
```json
{
    "body": "Attachment [pari-2.5.5.p1.diff](tarball://root/attachments/some-uuid/ticket15402/pari-2.5.5.p1.diff) by pbruin created at 2013-11-13 20:40:01\n\nReplying to [comment:8 jdemeyer]:\n> You're mostly right, except that the vector version is also much better in the PARI git version. That algorithm was completely rewritten and I also backported that.\nI see, this new implementation was not in Karim Belabas's recent patch, but was written by Henri Cohen and was already in PARI 2.6.1, before #15299 existed.",
    "created_at": "2013-11-13T20:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15165#issuecomment-194737",
    "user": "pbruin"
}
```

Attachment [pari-2.5.5.p1.diff](tarball://root/attachments/some-uuid/ticket15402/pari-2.5.5.p1.diff) by pbruin created at 2013-11-13 20:40:01

Replying to [comment:8 jdemeyer]:
> You're mostly right, except that the vector version is also much better in the PARI git version. That algorithm was completely rewritten and I also backported that.
I see, this new implementation was not in Karim Belabas's recent patch, but was written by Henri Cohen and was already in PARI 2.6.1, before #15299 existed.



---

archive/issue_comments_194738.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-11-14T07:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15165#issuecomment-194738",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_194739.json:
```json
{
    "body": "Tested on 32-bit and 64-bit.",
    "created_at": "2013-11-14T07:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15165#issuecomment-194739",
    "user": "jdemeyer"
}
```

Tested on 32-bit and 64-bit.



---

archive/issue_comments_194740.json:
```json
{
    "body": "omit page number (editions of Cohen's book differ)",
    "created_at": "2013-11-19T17:51:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15165#issuecomment-194740",
    "user": "pbruin"
}
```

omit page number (editions of Cohen's book differ)



---

archive/issue_comments_194741.json:
```json
{
    "body": "Attachment [15402_reviewer.patch](tarball://root/attachments/some-uuid/ticket15402/15402_reviewer.patch) by pbruin created at 2013-11-19 17:59:15\n\nLooks good, works as documented, and the new doctests appear to be very thorough and as good as you can possibly get, apart from proving the error bound from the PARI source code.\n\nJust a trivial reviewer patch to fix the reference to Cohen (even though you didn't touch this): the page number of Prop. 5.6.12 in my edition is different, so I just removed the page number.",
    "created_at": "2013-11-19T17:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15165#issuecomment-194741",
    "user": "pbruin"
}
```

Attachment [15402_reviewer.patch](tarball://root/attachments/some-uuid/ticket15402/15402_reviewer.patch) by pbruin created at 2013-11-19 17:59:15

Looks good, works as documented, and the new doctests appear to be very thorough and as good as you can possibly get, apart from proving the error bound from the PARI source code.

Just a trivial reviewer patch to fix the reference to Cohen (even though you didn't touch this): the page number of Prop. 5.6.12 in my edition is different, so I just removed the page number.



---

archive/issue_comments_194742.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-11-19T17:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15165#issuecomment-194742",
    "user": "pbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_194743.json:
```json
{
    "body": "Replying to [comment:11 pbruin]:\n> Looks good, works as documented, and the new doctests appear to be very thorough and as good as you can possibly get, apart from proving the error bound from the PARI source code.\n\nExactly. The errors bounds that I get are a combination of reading the PARI source code and experiments, they are not proven.",
    "created_at": "2013-11-21T13:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15165#issuecomment-194743",
    "user": "jdemeyer"
}
```

Replying to [comment:11 pbruin]:
> Looks good, works as documented, and the new doctests appear to be very thorough and as good as you can possibly get, apart from proving the error bound from the PARI source code.

Exactly. The errors bounds that I get are a combination of reading the PARI source code and experiments, they are not proven.



---

archive/issue_comments_194744.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-11-22T15:49:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15165#issuecomment-194744",
    "user": "jdemeyer"
}
```

Resolution: fixed
