# Issue 15165: PARI: add patch for exponential_integral_1() precision

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2013-11-12 11:35:15

There is a bug in PARI where the precision of the `eint1()` function (exponential integral) is quite bad. This is fixed upstream and we should take the patch into the PARI spkg. See also #15299.


---

Comment by jdemeyer created at 2013-11-12 23:48:02

Patch seems to work fine, modulo adding doctests.


---

Comment by jdemeyer created at 2013-11-13 16:44:33

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2013-11-13 16:53:57

Fails to install with `SAGE_CHECK=yes` on 32-bit systems.


---

Comment by jdemeyer created at 2013-11-13 16:53:57

Changing status from needs_review to needs_work.


---

Comment by pbruin created at 2013-11-13 20:12:46

Just to check if I understand correctly, is the situation as follows?
1. PARI's `eint1()` had potentially large errors both for a single argument and for the vector version;
2. the single argument version is fixed upstream;
3. for the vector version `y = eint1(x, n)` with `n > 15`, the entries `y[i]` with `i >= 15` can still have large errors;
4. the patch fixes (1) by backporting the upstream fix (2), and fixes (3) by increasing the precision depending on _n_.
A small observation about where to look for the cause of (3): it could be related to the fact that `mpveceint1()` (in `basemath/trans3.c`) apparently computes the `y[i]` with `i >= 15` via a recursive formula going from `i = n` downwards.  I guess any detailed discussion of this should continue on the `pari-dev` mailing list.


---

Comment by jdemeyer created at 2013-11-13 20:19:00

Replying to [comment:7 pbruin]:
> Just to check if I understand correctly, is the situation as follows?
> 1. PARI's `eint1()` had potentially large errors both for a single argument and for the vector version;
> 2. the single argument version is fixed upstream;
> 3. for the vector version `y = eint1(x, n)` with `n > 15`, the entries `y[i]` with `i >= 15` can still have large errors;
> 4. the patch fixes (1) by backporting the upstream fix (2), and fixes (3) by increasing the precision depending on _n_.
> A small observation about where to look for the cause of (3): it could be related to the fact that `mpveceint1()` (in `basemath/trans3.c`) apparently computes the `y[i]` with `i >= 15` via a recursive formula going from `i = n` downwards.  I guess any detailed discussion of this should continue on the `pari-dev` mailing list.

You're mostly right, except that the vector version is also much better in the PARI git version. That algorithm was completely rewritten and I also backported that.

I found the extra number of bits needed experimentally.


---

Attachment


---

Attachment

Replying to [comment:8 jdemeyer]:
> You're mostly right, except that the vector version is also much better in the PARI git version. That algorithm was completely rewritten and I also backported that.
I see, this new implementation was not in Karim Belabas's recent patch, but was written by Henri Cohen and was already in PARI 2.6.1, before #15299 existed.


---

Comment by jdemeyer created at 2013-11-14 07:36:49

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2013-11-14 07:36:49

Tested on 32-bit and 64-bit.


---

Comment by pbruin created at 2013-11-19 17:51:24

omit page number (editions of Cohen's book differ)


---

Attachment

Looks good, works as documented, and the new doctests appear to be very thorough and as good as you can possibly get, apart from proving the error bound from the PARI source code.

Just a trivial reviewer patch to fix the reference to Cohen (even though you didn't touch this): the page number of Prop. 5.6.12 in my edition is different, so I just removed the page number.


---

Comment by pbruin created at 2013-11-19 17:59:15

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-11-21 13:16:49

Replying to [comment:11 pbruin]:
> Looks good, works as documented, and the new doctests appear to be very thorough and as good as you can possibly get, apart from proving the error bound from the PARI source code.

Exactly. The errors bounds that I get are a combination of reading the PARI source code and experiments, they are not proven.


---

Comment by jdemeyer created at 2013-11-22 15:49:41

Resolution: fixed
