# Issue 27605: Symbolic eigenvector computation gives unexpected results

Issue created by migration from https://trac.sagemath.org/ticket/27842

Original creator: @mwageringel

Original creation time: 2019-05-16 19:51:38

Keywords: maxima

In the following example, computing the eigenmatrix of a symbolic 3×3 matrix results in a 5×3 eigenmatrix.


```
sage: A = matrix(SR, [(225/548, 0, -175/274*sqrt(193/1446)), (0, 1/2, 0), (-63/548*sqrt(723/386), 0, 49/548)])
sage: D, P = A.eigenmatrix_left()
sage: P.dimensions() # there should only be 3 eigenvectors
(5, 3)
```


Although all 5 rows are indeed eigenvectors, the result should be a 3×3 matrix. Computing the eigenvectors helps explain this:


```
sage: A.eigenvectors_left()
[(-1/50978248*sqrt(341870550*sqrt(1446)*sqrt(723)*sqrt(386)*sqrt(193) + 67015311218944) + 1/4,
  [(1, 0, 1/4237241274*sqrt(723)*sqrt(386)*sqrt(341870550*sqrt(1446)*sqrt(723)*sqrt(386)*sqrt(193) + 67015311218944) + 88/45549*sqrt(723)*sqrt(386))],
  1),
 (1/50978248*sqrt(341870550*sqrt(1446)*sqrt(723)*sqrt(386)*sqrt(193) + 67015311218944) + 1/4,
  [(1, 0, -1/4237241274*sqrt(723)*sqrt(386)*sqrt(341870550*sqrt(1446)*sqrt(723)*sqrt(386)*sqrt(193) + 67015311218944) + 88/45549*sqrt(723)*sqrt(386)),
   (0, 1, 0)],
  1),
 (1/2, [(1, 0, -7/6507*sqrt(1446)*sqrt(193)), (0, 1, 0)], 1)]
```


The 2nd and 3rd eigenvalue are listed with algebraic multiplicity 1, but the corresponding eigenspaces are two-dimensional which causes the 5 rows in the eigenmatrix above. The underlying problem seems to be that the 2nd and 3rd eigenvalue are actually the same:


```
sage: [x.canonicalize_radical() for x in A.eigenvalues()]
[0, 1/2, 1/2]
```


The implementation relies on Maxima which seems to get confused by this.

In the following example, Maxima returns an empty list of eigenvectors for the first 3 eigenvalues, while returning two eigenvectors for the last one. When computing the eigenvectors for this matrix in a Maxima REPL, Maxima actually prints a warning about the missing eigenvectors, but this is not the case in Sage.


```
sage: B = matrix(SR, [(1/2, -7/2*sqrt(1/386), 0, 49/2*sqrt(1/279078)), (-7/2*sqrt(1/386), 211/772, 0, -8425/772*sqrt(1/723)), (0, 0, 1/2, 0), (49/2*sqrt(1/279078), -8425/772*sqrt(1/723), 0, 561/772)])
sage: B.eigenvectors_left()
[(-1/1544*(1/522729)^(1/3)*(2889775*sqrt(279078)*sqrt(723)*sqrt(386) + 279078*sqrt(-8350799550625/139539*sqrt(279078)*sqrt(723)*sqrt(386) - 1239282252073546/3) - 806472627450)^(1/3)*(I*sqrt(3) + 1) - 33628899/2*(1/522729)^(2/3)*(-I*sqrt(3) + 1)/(2889775*sqrt(279078)*sqrt(723)*sqrt(386) + 279078*sqrt(-8350799550625/139539*sqrt(279078)*sqrt(723)*sqrt(386) - 1239282252073546/3) - 806472627450)^(1/3) + 1/2,
  [],
  1),
 (-1/1544*(1/522729)^(1/3)*(2889775*sqrt(279078)*sqrt(723)*sqrt(386) + 279078*sqrt(-8350799550625/139539*sqrt(279078)*sqrt(723)*sqrt(386) - 1239282252073546/3) - 806472627450)^(1/3)*(-I*sqrt(3) + 1) - 33628899/2*(1/522729)^(2/3)*(I*sqrt(3) + 1)/(2889775*sqrt(279078)*sqrt(723)*sqrt(386) + 279078*sqrt(-8350799550625/139539*sqrt(279078)*sqrt(723)*sqrt(386) - 1239282252073546/3) - 806472627450)^(1/3) + 1/2,
  [],
  1),
 (1/772*(1/522729)^(1/3)*(2889775*sqrt(279078)*sqrt(723)*sqrt(386) + 279078*sqrt(-8350799550625/139539*sqrt(279078)*sqrt(723)*sqrt(386) - 1239282252073546/3) - 806472627450)^(1/3) + 33628899*(1/522729)^(2/3)/(2889775*sqrt(279078)*sqrt(723)*sqrt(386) + 279078*sqrt(-8350799550625/139539*sqrt(279078)*sqrt(723)*sqrt(386) - 1239282252073546/3) - 806472627450)^(1/3) + 1/2,
  [],
  1),
 (1/2,
  [(1, -16513/7395567000*sqrt(279078)*sqrt(723) - 35427/10229000*sqrt(386), 0, -2359/10229000*sqrt(723)*sqrt(386) - 5061/10229000*sqrt(279078)),
   (0, 0, 1, 0)],
  1)]
```


As a consequence, `B.eigenmatrix_left()` throws an `IndexError`.

In this ticket, I want to fix `eigenmatrix_left` so that it does not return a matrix that is too large and also does not throw an `IndexError`. Instead, a `RuntimeError` will be raised which is more helpful in explaining the problem.

(Making Maxima return better results is out of reach for me. Also, the strange output of `eigenvectors_left` as shown above may be helpful in some cases, so I will not touch that code either.)

--------------------

For anyone having a similar problem, there are alternatives for computing the eigenvectors. Switching to `QQbar` gives the correct results in this case:


```
sage: A.change_ring(QQbar).eigenmatrix_left()
(
[  0   0   0]
[  0 1/2   0]
[  0   0 1/2],

[                   1                    0   2.609555106344745?]
[                   1                    0 -0.5683031120484112?]
[                   0                    1                    0]
)
sage: B.change_ring(QQbar).eigenmatrix_left()
(
[  1   0   0   0]  [   1.000000000000000?   -1.992318971503498?                     0    3.128221084994406?]
[  0   0   0   0]  [   1.000000000000000?    3.264785467901716?                     0    1.759624360309353?]
[  0   0 1/2   0]  [   1.000000000000000? -0.09976137331762037?                     0  -0.3832070829118147?]
[  0   0   0 1/2], [                    0                     0                     1                     0]
)
```


Switching to Sympy works as well:


```
sage: import sympy
sage: sympy.Matrix(A).eigenvals()
{0: 1, 1/2: 2}
sage: sympy_eig = lambda A: [(l,n,[vector(SR, v) for v in vs]) for l,n,vs in sympy.Matrix(A).eigenvects()]
sage: sympy_eig(A)
[(0, 1, [(7/6507*sqrt(279078), 0, 1)]),
 (1/2, 2, [(0, 1, 0), (-25/5061*sqrt(279078), 0, 1)])]
sage: sympy_eig(B)
[(0, 1, [(7/6507*sqrt(279078), 449/6507*sqrt(723), 0, 1)]),
 (1/2, 2, [(0, 0, 1, 0), (-25/5061*sqrt(279078), 7/723*sqrt(723), 0, 1)]),
 (1, 1, [(7/11568*sqrt(279078), -137/5784*sqrt(723), 0, 1)])]
```


Perhaps, in the future, the implementation of symbolic eigenvector computations could (optionally) use Sympy instead of Maxima.



---

Comment by @mwageringel created at 2019-05-16 20:06:26

New commits:


---

Comment by @mwageringel created at 2019-05-16 20:06:26

Changing status from new to needs_review.


---

Comment by embray created at 2019-07-03 11:37:56

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-05-01 04:28:42

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.


---

Comment by mkoeppe created at 2020-08-15 21:46:18

This is a nice improvement.


---

Comment by mkoeppe created at 2020-08-15 21:46:18

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-08-20 22:23:24

Resolution: fixed
