# Issue 15369: Further integration of prereq

archive/issues_015369.json:
```json
{
    "body": "CC:  ohanar vbraun\n\nFollow-up after #15580.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15606\n\n",
    "created_at": "2013-12-29T11:23:09Z",
    "labels": [
        "build",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "Further integration of prereq",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15369",
    "user": "jdemeyer"
}
```
CC:  ohanar vbraun

Follow-up after #15580.

Issue created by migration from https://trac.sagemath.org/ticket/15606





---

archive/issue_comments_198213.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Recent commits:",
    "created_at": "2013-12-29T16:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198213",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Recent commits:



---

archive/issue_comments_198214.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-01T17:37:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198214",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_198215.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-01-05T10:19:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198215",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_198216.json:
```json
{
    "body": "Is goal to have the actual version written into the autoconf output or is there a way to keep it unexpandend and only set a variable when you run `./configure`?",
    "created_at": "2014-01-06T22:12:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198216",
    "user": "vbraun"
}
```

Is goal to have the actual version written into the autoconf output or is there a way to keep it unexpandend and only set a variable when you run `./configure`?



---

archive/issue_comments_198217.json:
```json
{
    "body": "Replying to [comment:7 vbraun]:\n> Is goal to have the actual version written into the autoconf output\nThat's the current approach and that surely works.\n\n> or is there a way to keep it unexpandend and only set a variable when you run `./configure`?\nNo idea, I have not checked.",
    "created_at": "2014-01-08T19:36:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198217",
    "user": "jdemeyer"
}
```

Replying to [comment:7 vbraun]:
> Is goal to have the actual version written into the autoconf output
That's the current approach and that surely works.

> or is there a way to keep it unexpandend and only set a variable when you run `./configure`?
No idea, I have not checked.



---

archive/issue_comments_198218.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2014-01-13T14:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198218",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_198219.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-13T14:39:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198219",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_198220.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-14T08:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198220",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_198221.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-15T22:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198221",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_198222.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-16T12:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198222",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_198223.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-01-16T12:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198223",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_198224.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-21T14:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198224",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_198225.json:
```json
{
    "body": "needs version bump for confball since configure uses additional macros...\n----\nNew commits:",
    "created_at": "2014-01-21T15:03:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198225",
    "user": "vbraun"
}
```

needs version bump for confball since configure uses additional macros...
----
New commits:



---

archive/issue_comments_198226.json:
```json
{
    "body": "Still fails on bsd and mod:\n\n```\n./bootstrap -d\nmake[1]: Entering directory `/mnt/SSD1/mod_buildslave/sage_git/build'\nrm -rf config configure build/Makefile-auto.in\nmake[1]: Leaving directory `/mnt/SSD1/mod_buildslave/sage_git/build'\nconfigure.ac:19: error: m4_defn: undefined macro: _m4_divert_diversion\nconfigure.ac:19: the top level\nautom4te: /usr/bin/m4 failed with exit status: 1\naclocal: autom4te failed with exit status: 1\nmake: *** [configure] Error 1\nmake: Target `start' not remade because of errors.\n```\n\nHow about catching any non-zero exit status in bootstrap?",
    "created_at": "2014-01-21T15:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198226",
    "user": "vbraun"
}
```

Still fails on bsd and mod:

```
./bootstrap -d
make[1]: Entering directory `/mnt/SSD1/mod_buildslave/sage_git/build'
rm -rf config configure build/Makefile-auto.in
make[1]: Leaving directory `/mnt/SSD1/mod_buildslave/sage_git/build'
configure.ac:19: error: m4_defn: undefined macro: _m4_divert_diversion
configure.ac:19: the top level
autom4te: /usr/bin/m4 failed with exit status: 1
aclocal: autom4te failed with exit status: 1
make: *** [configure] Error 1
make: Target `start' not remade because of errors.
```

How about catching any non-zero exit status in bootstrap?



---

archive/issue_comments_198227.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-01-21T15:09:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198227",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_198228.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-01-23T10:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198228",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_198229.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-01-23T10:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198229",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_198230.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2014-01-23T10:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198230",
    "user": "jdemeyer"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_198231.json:
```json
{
    "body": "Fails with\n\n```\n$ ./bootstrap \nrm -rf config configure build/Makefile-auto.in\nconfigure.ac:22: error: m4_divert_push: cannot change diversion to `GROW' inside m4_expand\nconfigure.ac:22: the top level\nautom4te: /usr/bin/m4 failed with exit status: 1\naclocal: error: echo failed with exit status: 1\n```\n",
    "created_at": "2014-01-23T12:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198231",
    "user": "vbraun"
}
```

Fails with

```
$ ./bootstrap 
rm -rf config configure build/Makefile-auto.in
configure.ac:22: error: m4_divert_push: cannot change diversion to `GROW' inside m4_expand
configure.ac:22: the top level
autom4te: /usr/bin/m4 failed with exit status: 1
aclocal: error: echo failed with exit status: 1
```




---

archive/issue_comments_198232.json:
```json
{
    "body": "Verbose output:\n\n```\n[...]\naclocal: running echo 'm4_define([m4_require_silent_probe], [-])' | /usr/bin/autom4te --language Autoconf-without-aclocal-m4  - /usr/share/aclocal-1.13/internal/ac-config-macro-dirs.m4 '/usr/share/aclocal-1.13/amversion.m4' '/usr/share/aclocal-1.13/auxdir.m4' '/usr/share/aclocal-1.13/cond.m4' '/usr/share/aclocal-1.13/depend.m4' '/usr/share/aclocal-1.13/depout.m4' '/usr/share/aclocal-1.13/init.m4' '/usr/share/aclocal-1.13/install-sh.m4' '/usr/share/aclocal-1.13/lead-dot.m4' '/usr/share/aclocal-1.13/maintainer.m4' '/usr/share/aclocal-1.13/make.m4' '/usr/share/aclocal-1.13/missing.m4' '/usr/share/aclocal-1.13/options.m4' '/usr/share/aclocal-1.13/runlog.m4' '/usr/share/aclocal-1.13/sanity.m4' '/usr/share/aclocal-1.13/silent.m4' '/usr/share/aclocal-1.13/strip.m4' '/usr/share/aclocal-1.13/substnot.m4' '/usr/share/aclocal-1.13/tar.m4' --trace='AC_DEFUN:$f::$n::${::}%' --trace='AC_DEFUN_ONCE:$f::$n::${::}%' --trace='AU_DEFUN:$f::$n::${::}%' --trace='_AM_AUTOCONF_VERSION:$f::$n::${::}%' --trace='AC_CONFIG_MACRO_DIR_TRACE:$f::$n::${::}%' --trace='AC_CONFIG_MACRO_DIR:$f::$n::${::}%' --trace='_AM_CONFIG_MACRO_DIRS:$f::$n::${::}%' --trace='_AM_SUBST_NOTMAKE:$f::$n' --trace='_AM_IF_OPTION:$f::$n' --trace='AM_OUTPUT_DEPENDENCY_COMMANDS:$f::$n' --trace='AM_SET_DEPDIR:$f::$n' --trace='AM_PROG_INSTALL_SH:$f::$n' --trace='_AM_SET_OPTIONS:$f::$n' --trace='AM_SET_LEADING_DOT:$f::$n' --trace='AM_SUBST_NOTMAKE:$f::$n' --trace='_AM_MANGLE_OPTION:$f::$n' --trace='_AM_PROG_TAR:$f::$n' --trace='AM_DEP_TRACK:$f::$n' --trace='AM_MAKE_INCLUDE:$f::$n' --trace='AM_INIT_AUTOMAKE:$f::$n' --trace='AM_SET_CURRENT_AUTOMAKE_VERSION:$f::$n' --trace='AM_AUX_DIR_EXPAND:$f::$n' --trace='_AM_OUTPUT_DEPENDENCY_COMMANDS:$f::$n' --trace='AM_CONDITIONAL:$f::$n' --trace='AM_MAINTAINER_MODE:$f::$n' --trace='AM_MISSING_HAS_RUN:$f::$n' --trace='_AM_DEPENDENCIES:$f::$n' --trace='_AM_SET_OPTION:$f::$n' --trace='AM_PROG_INSTALL_STRIP:$f::$n' --trace='AM_SILENT_RULES:$f::$n' --trace='SAGE_VERSION:$f::$n' --trace='AM_RUN_LOG:$f::$n' --trace='AM_SANITY_CHECK:$f::$n' --trace='AM_AUTOMAKE_VERSION:$f::$n' --trace='_AC_AM_CONFIG_HEADER_HOOK:$f::$n' --trace='AM_MISSING_PROG:$f::$n' configure.ac\nconfigure.ac:22: error: m4_divert_push: cannot change diversion to `GROW' inside m4_expand\nconfigure.ac:22: the top level\n[...]\n```\n",
    "created_at": "2014-01-23T12:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198232",
    "user": "vbraun"
}
```

Verbose output:

```
[...]
aclocal: running echo 'm4_define([m4_require_silent_probe], [-])' | /usr/bin/autom4te --language Autoconf-without-aclocal-m4  - /usr/share/aclocal-1.13/internal/ac-config-macro-dirs.m4 '/usr/share/aclocal-1.13/amversion.m4' '/usr/share/aclocal-1.13/auxdir.m4' '/usr/share/aclocal-1.13/cond.m4' '/usr/share/aclocal-1.13/depend.m4' '/usr/share/aclocal-1.13/depout.m4' '/usr/share/aclocal-1.13/init.m4' '/usr/share/aclocal-1.13/install-sh.m4' '/usr/share/aclocal-1.13/lead-dot.m4' '/usr/share/aclocal-1.13/maintainer.m4' '/usr/share/aclocal-1.13/make.m4' '/usr/share/aclocal-1.13/missing.m4' '/usr/share/aclocal-1.13/options.m4' '/usr/share/aclocal-1.13/runlog.m4' '/usr/share/aclocal-1.13/sanity.m4' '/usr/share/aclocal-1.13/silent.m4' '/usr/share/aclocal-1.13/strip.m4' '/usr/share/aclocal-1.13/substnot.m4' '/usr/share/aclocal-1.13/tar.m4' --trace='AC_DEFUN:$f::$n::${::}%' --trace='AC_DEFUN_ONCE:$f::$n::${::}%' --trace='AU_DEFUN:$f::$n::${::}%' --trace='_AM_AUTOCONF_VERSION:$f::$n::${::}%' --trace='AC_CONFIG_MACRO_DIR_TRACE:$f::$n::${::}%' --trace='AC_CONFIG_MACRO_DIR:$f::$n::${::}%' --trace='_AM_CONFIG_MACRO_DIRS:$f::$n::${::}%' --trace='_AM_SUBST_NOTMAKE:$f::$n' --trace='_AM_IF_OPTION:$f::$n' --trace='AM_OUTPUT_DEPENDENCY_COMMANDS:$f::$n' --trace='AM_SET_DEPDIR:$f::$n' --trace='AM_PROG_INSTALL_SH:$f::$n' --trace='_AM_SET_OPTIONS:$f::$n' --trace='AM_SET_LEADING_DOT:$f::$n' --trace='AM_SUBST_NOTMAKE:$f::$n' --trace='_AM_MANGLE_OPTION:$f::$n' --trace='_AM_PROG_TAR:$f::$n' --trace='AM_DEP_TRACK:$f::$n' --trace='AM_MAKE_INCLUDE:$f::$n' --trace='AM_INIT_AUTOMAKE:$f::$n' --trace='AM_SET_CURRENT_AUTOMAKE_VERSION:$f::$n' --trace='AM_AUX_DIR_EXPAND:$f::$n' --trace='_AM_OUTPUT_DEPENDENCY_COMMANDS:$f::$n' --trace='AM_CONDITIONAL:$f::$n' --trace='AM_MAINTAINER_MODE:$f::$n' --trace='AM_MISSING_HAS_RUN:$f::$n' --trace='_AM_DEPENDENCIES:$f::$n' --trace='_AM_SET_OPTION:$f::$n' --trace='AM_PROG_INSTALL_STRIP:$f::$n' --trace='AM_SILENT_RULES:$f::$n' --trace='SAGE_VERSION:$f::$n' --trace='AM_RUN_LOG:$f::$n' --trace='AM_SANITY_CHECK:$f::$n' --trace='AM_AUTOMAKE_VERSION:$f::$n' --trace='_AC_AM_CONFIG_HEADER_HOOK:$f::$n' --trace='AM_MISSING_PROG:$f::$n' configure.ac
configure.ac:22: error: m4_divert_push: cannot change diversion to `GROW' inside m4_expand
configure.ac:22: the top level
[...]
```




---

archive/issue_comments_198233.json:
```json
{
    "body": "Which system and `autoconf`/`automake` versions?",
    "created_at": "2014-01-23T12:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198233",
    "user": "jdemeyer"
}
```

Which system and `autoconf`/`automake` versions?



---

archive/issue_comments_198234.json:
```json
{
    "body": "* autoconf 2.69\n* automake 1.13.4",
    "created_at": "2014-01-23T12:35:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198234",
    "user": "vbraun"
}
```

* autoconf 2.69
* automake 1.13.4



---

archive/issue_comments_198235.json:
```json
{
    "body": "no square brackets in the middle AC_INIT argument seems to fix it\n----\nNew commits:",
    "created_at": "2014-01-23T12:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198235",
    "user": "vbraun"
}
```

no square brackets in the middle AC_INIT argument seems to fix it
----
New commits:



---

archive/issue_comments_198236.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-23T13:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198236",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_198237.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-25T01:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198237",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_198238.json:
```json
{
    "body": "Confball is saved under the not-yet-incremented name...",
    "created_at": "2014-01-25T01:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198238",
    "user": "vbraun"
}
```

Confball is saved under the not-yet-incremented name...



---

archive/issue_comments_198239.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2014-01-25T01:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198239",
    "user": "vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_198240.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2014-01-25T01:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198240",
    "user": "vbraun"
}
```

Changing status from closed to new.



---

archive/issue_comments_198241.json:
```json
{
    "body": "lets move it to #15700...",
    "created_at": "2014-01-25T01:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198241",
    "user": "vbraun"
}
```

lets move it to #15700...



---

archive/issue_comments_198242.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-25T01:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15369",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15369#issuecomment-198242",
    "user": "vbraun"
}
```

Resolution: fixed
