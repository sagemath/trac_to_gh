# Issue 15369: Further integration of prereq

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2013-12-29 11:23:09

CC:  ohanar vbraun

Follow-up after #15580.


---

Comment by git created at 2013-12-29 16:48:16

Branch pushed to git repo; I updated commit sha1. This was a forced push. Recent commits:


---

Comment by jdemeyer created at 2014-01-01 17:37:07

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2014-01-05 10:19:41

Changing status from needs_review to needs_work.


---

Comment by vbraun created at 2014-01-06 22:12:11

Is goal to have the actual version written into the autoconf output or is there a way to keep it unexpandend and only set a variable when you run `./configure`?


---

Comment by jdemeyer created at 2014-01-08 19:36:12

Replying to [comment:7 vbraun]:
> Is goal to have the actual version written into the autoconf output
That's the current approach and that surely works.

> or is there a way to keep it unexpandend and only set a variable when you run `./configure`?
No idea, I have not checked.


---

Comment by git created at 2014-01-13 14:33:12

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2014-01-13 14:39:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-01-14 08:21:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-01-15 22:58:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-01-16 12:37:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2014-01-16 12:37:41

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2014-01-21 14:42:58

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-01-21 15:03:06

needs version bump for confball since configure uses additional macros...
----
New commits:


---

Comment by vbraun created at 2014-01-21 15:09:41

Still fails on bsd and mod:

```
./bootstrap -d
make[1]: Entering directory `/mnt/SSD1/mod_buildslave/sage_git/build'
rm -rf config configure build/Makefile-auto.in
make[1]: Leaving directory `/mnt/SSD1/mod_buildslave/sage_git/build'
configure.ac:19: error: m4_defn: undefined macro: _m4_divert_diversion
configure.ac:19: the top level
autom4te: /usr/bin/m4 failed with exit status: 1
aclocal: autom4te failed with exit status: 1
make: *** [configure] Error 1
make: Target `start' not remade because of errors.
```

How about catching any non-zero exit status in bootstrap?


---

Comment by vbraun created at 2014-01-21 15:09:48

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2014-01-23 10:10:52

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2014-01-23 10:10:52

New commits:


---

Comment by jdemeyer created at 2014-01-23 10:11:09

Changing priority from major to blocker.


---

Comment by vbraun created at 2014-01-23 12:28:18

Fails with

```
$ ./bootstrap 
rm -rf config configure build/Makefile-auto.in
configure.ac:22: error: m4_divert_push: cannot change diversion to `GROW' inside m4_expand
configure.ac:22: the top level
autom4te: /usr/bin/m4 failed with exit status: 1
aclocal: error: echo failed with exit status: 1
```



---

Comment by vbraun created at 2014-01-23 12:32:00

Verbose output:

```
[...]
aclocal: running echo 'm4_define([m4_require_silent_probe], [-])' | /usr/bin/autom4te --language Autoconf-without-aclocal-m4  - /usr/share/aclocal-1.13/internal/ac-config-macro-dirs.m4 '/usr/share/aclocal-1.13/amversion.m4' '/usr/share/aclocal-1.13/auxdir.m4' '/usr/share/aclocal-1.13/cond.m4' '/usr/share/aclocal-1.13/depend.m4' '/usr/share/aclocal-1.13/depout.m4' '/usr/share/aclocal-1.13/init.m4' '/usr/share/aclocal-1.13/install-sh.m4' '/usr/share/aclocal-1.13/lead-dot.m4' '/usr/share/aclocal-1.13/maintainer.m4' '/usr/share/aclocal-1.13/make.m4' '/usr/share/aclocal-1.13/missing.m4' '/usr/share/aclocal-1.13/options.m4' '/usr/share/aclocal-1.13/runlog.m4' '/usr/share/aclocal-1.13/sanity.m4' '/usr/share/aclocal-1.13/silent.m4' '/usr/share/aclocal-1.13/strip.m4' '/usr/share/aclocal-1.13/substnot.m4' '/usr/share/aclocal-1.13/tar.m4' --trace='AC_DEFUN:$f::$n::${::}%' --trace='AC_DEFUN_ONCE:$f::$n::${::}%' --trace='AU_DEFUN:$f::$n::${::}%' --trace='_AM_AUTOCONF_VERSION:$f::$n::${::}%' --trace='AC_CONFIG_MACRO_DIR_TRACE:$f::$n::${::}%' --trace='AC_CONFIG_MACRO_DIR:$f::$n::${::}%' --trace='_AM_CONFIG_MACRO_DIRS:$f::$n::${::}%' --trace='_AM_SUBST_NOTMAKE:$f::$n' --trace='_AM_IF_OPTION:$f::$n' --trace='AM_OUTPUT_DEPENDENCY_COMMANDS:$f::$n' --trace='AM_SET_DEPDIR:$f::$n' --trace='AM_PROG_INSTALL_SH:$f::$n' --trace='_AM_SET_OPTIONS:$f::$n' --trace='AM_SET_LEADING_DOT:$f::$n' --trace='AM_SUBST_NOTMAKE:$f::$n' --trace='_AM_MANGLE_OPTION:$f::$n' --trace='_AM_PROG_TAR:$f::$n' --trace='AM_DEP_TRACK:$f::$n' --trace='AM_MAKE_INCLUDE:$f::$n' --trace='AM_INIT_AUTOMAKE:$f::$n' --trace='AM_SET_CURRENT_AUTOMAKE_VERSION:$f::$n' --trace='AM_AUX_DIR_EXPAND:$f::$n' --trace='_AM_OUTPUT_DEPENDENCY_COMMANDS:$f::$n' --trace='AM_CONDITIONAL:$f::$n' --trace='AM_MAINTAINER_MODE:$f::$n' --trace='AM_MISSING_HAS_RUN:$f::$n' --trace='_AM_DEPENDENCIES:$f::$n' --trace='_AM_SET_OPTION:$f::$n' --trace='AM_PROG_INSTALL_STRIP:$f::$n' --trace='AM_SILENT_RULES:$f::$n' --trace='SAGE_VERSION:$f::$n' --trace='AM_RUN_LOG:$f::$n' --trace='AM_SANITY_CHECK:$f::$n' --trace='AM_AUTOMAKE_VERSION:$f::$n' --trace='_AC_AM_CONFIG_HEADER_HOOK:$f::$n' --trace='AM_MISSING_PROG:$f::$n' configure.ac
configure.ac:22: error: m4_divert_push: cannot change diversion to `GROW' inside m4_expand
configure.ac:22: the top level
[...]
```



---

Comment by jdemeyer created at 2014-01-23 12:35:01

Which system and `autoconf`/`automake` versions?


---

Comment by vbraun created at 2014-01-23 12:35:53

* autoconf 2.69
* automake 1.13.4


---

Comment by vbraun created at 2014-01-23 12:39:17

no square brackets in the middle AC_INIT argument seems to fix it
----
New commits:


---

Comment by jdemeyer created at 2014-01-23 13:05:34

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-01-25 01:09:57

Resolution: fixed


---

Comment by vbraun created at 2014-01-25 01:30:59

Confball is saved under the not-yet-incremented name...


---

Comment by vbraun created at 2014-01-25 01:30:59

Resolution changed from fixed to 


---

Comment by vbraun created at 2014-01-25 01:30:59

Changing status from closed to new.


---

Comment by vbraun created at 2014-01-25 01:32:14

lets move it to #15700...


---

Comment by vbraun created at 2014-01-25 01:32:14

Resolution: fixed
