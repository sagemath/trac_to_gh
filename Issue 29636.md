# Issue 29636: sage.categories: Remove module-level imports of sage.rings, sage.algebras, sage.matrix

archive/issues_029636.json:
```json
{
    "body": "CC:  vdelecroix tscrim mjo nthiery @timokau chapoton\n\nThis is for a cleaner, filtered structure of our Python modules, at least regarding their load time.  This is preparation for #29865 (`sage-objects`).\n\nThe idea is that `sage.categories` should be more abstract than any of the implemented algebraic structures in `sage.rings`, `sage.algebras`, `sage.modules`, ... Therefore it should only have a (module load time) dependence on `sage.structure` and `sage.misc`.\n\nAt run time, of course, there are additional dependencies. For example, as noted in #29705, the output of `.cardinality()` must be an integer (ZZ).\n\nThe present ticket changes module-level imports to method-level imports so that they are resolved later than at module load time.\n\nAlso, obviously the doctests need a larger part of the library.\n\n(split out from #29865)\n\nIssue created by migration from https://trac.sagemath.org/ticket/29873\n\n",
    "created_at": "2020-06-16T18:45:28Z",
    "labels": [
        "refactoring",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "sage.categories: Remove module-level imports of sage.rings, sage.algebras, sage.matrix",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29636",
    "user": "mkoeppe"
}
```
CC:  vdelecroix tscrim mjo nthiery @timokau chapoton

This is for a cleaner, filtered structure of our Python modules, at least regarding their load time.  This is preparation for #29865 (`sage-objects`).

The idea is that `sage.categories` should be more abstract than any of the implemented algebraic structures in `sage.rings`, `sage.algebras`, `sage.modules`, ... Therefore it should only have a (module load time) dependence on `sage.structure` and `sage.misc`.

At run time, of course, there are additional dependencies. For example, as noted in #29705, the output of `.cardinality()` must be an integer (ZZ).

The present ticket changes module-level imports to method-level imports so that they are resolved later than at module load time.

Also, obviously the doctests need a larger part of the library.

(split out from #29865)

Issue created by migration from https://trac.sagemath.org/ticket/29873





---

archive/issue_comments_420945.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-16T18:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420945",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_420946.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-06-16T18:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420946",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_420947.json:
```json
{
    "body": "Branch is on top of #29869.",
    "created_at": "2020-06-16T18:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420947",
    "user": "mkoeppe"
}
```

Branch is on top of #29869.



---

archive/issue_comments_420948.json:
```json
{
    "body": "In this code, these extra imports at the method level will not have a meaningful effect on the run time, so I am giving this a positive review based on that. However, this is something to be aware of as there can be functions in the category framework that are used in tighter loops.",
    "created_at": "2020-06-16T23:42:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420948",
    "user": "tscrim"
}
```

In this code, these extra imports at the method level will not have a meaningful effect on the run time, so I am giving this a positive review based on that. However, this is something to be aware of as there can be functions in the category framework that are used in tighter loops.



---

archive/issue_comments_420949.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-16T23:42:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420949",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_420950.json:
```json
{
    "body": "Thanks! Yes, let's watch out for performance impacts of some of the upcoming changes.",
    "created_at": "2020-06-17T00:17:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420950",
    "user": "mkoeppe"
}
```

Thanks! Yes, let's watch out for performance impacts of some of the upcoming changes.



---

archive/issue_comments_420951.json:
```json
{
    "body": "Actually now I see\n\n```\n  File \"/local/sage-patchbot/sage/local/lib/python3.7/site-packages/sage/combinat/backtrack.py\", line 76, in <module>\n    from sage.sets.recursively_enumerated_set import RecursivelyEnumeratedSet_generic\n  File \"sage/sets/recursively_enumerated_set.pyx\", line 179, in init sage.sets.recursively_enumerated_set (build/cythonized/sage/sets/recursively_enumerated_set.c:12654)\nImportError: cannot import name SearchForest\n```\n",
    "created_at": "2020-06-17T04:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420951",
    "user": "mkoeppe"
}
```

Actually now I see

```
  File "/local/sage-patchbot/sage/local/lib/python3.7/site-packages/sage/combinat/backtrack.py", line 76, in <module>
    from sage.sets.recursively_enumerated_set import RecursivelyEnumeratedSet_generic
  File "sage/sets/recursively_enumerated_set.pyx", line 179, in init sage.sets.recursively_enumerated_set (build/cythonized/sage/sets/recursively_enumerated_set.c:12654)
ImportError: cannot import name SearchForest
```




---

archive/issue_comments_420952.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-06-17T04:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420952",
    "user": "mkoeppe"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_420953.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-17T04:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420953",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_420954.json:
```json
{
    "body": "rebased on top of newer #29869",
    "created_at": "2020-06-17T04:19:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420954",
    "user": "mkoeppe"
}
```

rebased on top of newer #29869



---

archive/issue_comments_420955.json:
```json
{
    "body": "cyclic import, it seems",
    "created_at": "2020-06-17T04:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420955",
    "user": "mkoeppe"
}
```

cyclic import, it seems



---

archive/issue_comments_420956.json:
```json
{
    "body": "`sage.combinat.backtrack` notes a relevant todo:\n\n```\n    - For now the code of :class:`SearchForest` is still in\n      ``sage/combinat/backtrack.py``.  It should be moved in\n      ``sage/sets/recursively_enumerated_set.pyx`` into a class named\n      :class:`RecursivelyEnumeratedSet_forest` in a later ticket.\n```\n",
    "created_at": "2020-06-17T04:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420956",
    "user": "mkoeppe"
}
```

`sage.combinat.backtrack` notes a relevant todo:

```
    - For now the code of :class:`SearchForest` is still in
      ``sage/combinat/backtrack.py``.  It should be moved in
      ``sage/sets/recursively_enumerated_set.pyx`` into a class named
      :class:`RecursivelyEnumeratedSet_forest` in a later ticket.
```




---

archive/issue_comments_420957.json:
```json
{
    "body": "that's apparently #16351.",
    "created_at": "2020-06-17T04:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420957",
    "user": "mkoeppe"
}
```

that's apparently #16351.



---

archive/issue_comments_420958.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-17T06:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420958",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420959.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-17T06:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420959",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_420960.json:
```json
{
    "body": "Merging #16351 fixed the `ImportError`.\nReady for review",
    "created_at": "2020-06-17T06:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420960",
    "user": "mkoeppe"
}
```

Merging #16351 fixed the `ImportError`.
Ready for review



---

archive/issue_comments_420961.json:
```json
{
    "body": "One last little trivial thing, please add\n\n```\n# -*- coding: utf-8 -*-\n```\n\nas the first line to `call.py`. Once done, you can set a positive review.",
    "created_at": "2020-06-17T23:08:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420961",
    "user": "tscrim"
}
```

One last little trivial thing, please add

```
# -*- coding: utf-8 -*-
```

as the first line to `call.py`. Once done, you can set a positive review.



---

archive/issue_comments_420962.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-18T00:01:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420962",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420963.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-06-18T00:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420963",
    "user": "mkoeppe"
}
```

Thanks!



---

archive/issue_comments_420964.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-18T00:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420964",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_420965.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-02T21:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29636#issuecomment-420965",
    "user": "vbraun"
}
```

Resolution: fixed
