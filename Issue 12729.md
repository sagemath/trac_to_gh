# Issue 12729: permutation_automorphism_group fails in optional doctest of coding/linear_code.py

archive/issues_012729.json:
```json
{
    "body": "Assignee: @wdjoyner\n\nKeywords: linear code gap\n\nThere is a bug in the `permutation_automorphism_group(algorithm=\"gap\")` method of `LinearCode`. It was discovered when doctests were added to `coding/linear_code.py` in #12893. \n\n```\nwstein@sage:sage-5.0.beta15-boxen-x86_64-Linux$ ./sage -t --optional devel/sage/sage/coding/linear_code.py sage -t --optional \"devel/sage/sage/coding/linear_code.py\"  \n**********************************************************************\nFile \"/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/devel/sage/sage/coding/linear_code.py\", line 1992:\n    sage: C.permutation_automorphism_group(algorithm=\"gap\")  # requires optional GAP package Guava\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_49[21]>\", line 1, in <module>\n        C.permutation_automorphism_group(algorithm=\"gap\")  # requires optional GAP package Guava###line 1992:\n    sage: C.permutation_automorphism_group(algorithm=\"gap\")  # requires optional GAP package Guava\n      File \"/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/misc/decorators.py\", line 687, in wrapper\n        return func(*args, **kwds)\n      File \"/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/coding/linear_code.py\", line 2033, in permutation_automorphism_group\n        A = gap(\"MatrixAutomorphisms(matCwt)\")\n      File \"/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/interface.py\", line 198, in __call__\n        return cls(self, x, name=name)\n      File \"/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/expect.py\", line 1331, in __init__\n        raise TypeError, x\n    TypeError: Gap produced error output\n    Error, no 1st choice method found for `MatrixAutomorphisms' on 1 arguments\n\n       executing $sage24:=MatrixAutomorphisms(matCwt);;\n**********************************************************************\nFile \"/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/devel/sage/sage/coding/linear_code.py\", line 1995:\n    sage: C.permutation_automorphism_group(algorithm=\"gap\")  # requires optional GAP package Guava\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_49[23]>\", line 1, in <module>\n        C.permutation_automorphism_group(algorithm=\"gap\")  # requires optional GAP package Guava###line 1995:\n    sage: C.permutation_automorphism_group(algorithm=\"gap\")  # requires optional GAP package Guava\n      File \"/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/misc/decorators.py\", line 687, in wrapper\n        return func(*args, **kwds)\n      File \"/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/coding/linear_code.py\", line 2033, in permutation_automorphism_group\n        A = gap(\"MatrixAutomorphisms(matCwt)\")\n      File \"/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/interface.py\", line 198, in __call__\n        return cls(self, x, name=name)\n      File \"/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/expect.py\", line 1331, in __init__\n        raise TypeError, x\n    TypeError: Gap produced error output\n    Error, no 1st choice method found for `MatrixAutomorphisms' on 1 arguments\n\n       executing $sage26:=MatrixAutomorphisms(matCwt);;\n**********************************************************************\n1 items had failures:\n   2 of  25 in __main__.example_49\n***Test Failed*** 2 failures.\nFor whitespace errors, see the file /home/wstein/.sage//tmp/linear_code_4858.py\n         [14.8 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n        sage -t --optional \"devel/sage/sage/coding/linear_code.py\"\nTotal time for all tests: 14.9 seconds\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/12901\n\n",
    "created_at": "2012-05-02T17:49:12Z",
    "labels": [
        "component: coding theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "permutation_automorphism_group fails in optional doctest of coding/linear_code.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12729",
    "user": "https://github.com/benjaminfjones"
}
```
Assignee: @wdjoyner

Keywords: linear code gap

There is a bug in the `permutation_automorphism_group(algorithm="gap")` method of `LinearCode`. It was discovered when doctests were added to `coding/linear_code.py` in #12893. 

```
wstein@sage:sage-5.0.beta15-boxen-x86_64-Linux$ ./sage -t --optional devel/sage/sage/coding/linear_code.py sage -t --optional "devel/sage/sage/coding/linear_code.py"  
**********************************************************************
File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/devel/sage/sage/coding/linear_code.py", line 1992:
    sage: C.permutation_automorphism_group(algorithm="gap")  # requires optional GAP package Guava
Exception raised:
    Traceback (most recent call last):
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_49[21]>", line 1, in <module>
        C.permutation_automorphism_group(algorithm="gap")  # requires optional GAP package Guava###line 1992:
    sage: C.permutation_automorphism_group(algorithm="gap")  # requires optional GAP package Guava
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/misc/decorators.py", line 687, in wrapper
        return func(*args, **kwds)
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/coding/linear_code.py", line 2033, in permutation_automorphism_group
        A = gap("MatrixAutomorphisms(matCwt)")
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/interface.py", line 198, in __call__
        return cls(self, x, name=name)
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/expect.py", line 1331, in __init__
        raise TypeError, x
    TypeError: Gap produced error output
    Error, no 1st choice method found for `MatrixAutomorphisms' on 1 arguments

       executing $sage24:=MatrixAutomorphisms(matCwt);;
**********************************************************************
File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/devel/sage/sage/coding/linear_code.py", line 1995:
    sage: C.permutation_automorphism_group(algorithm="gap")  # requires optional GAP package Guava
Exception raised:
    Traceback (most recent call last):
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_49[23]>", line 1, in <module>
        C.permutation_automorphism_group(algorithm="gap")  # requires optional GAP package Guava###line 1995:
    sage: C.permutation_automorphism_group(algorithm="gap")  # requires optional GAP package Guava
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/misc/decorators.py", line 687, in wrapper
        return func(*args, **kwds)
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/coding/linear_code.py", line 2033, in permutation_automorphism_group
        A = gap("MatrixAutomorphisms(matCwt)")
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/interface.py", line 198, in __call__
        return cls(self, x, name=name)
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/expect.py", line 1331, in __init__
        raise TypeError, x
    TypeError: Gap produced error output
    Error, no 1st choice method found for `MatrixAutomorphisms' on 1 arguments

       executing $sage26:=MatrixAutomorphisms(matCwt);;
**********************************************************************
1 items had failures:
   2 of  25 in __main__.example_49
***Test Failed*** 2 failures.
For whitespace errors, see the file /home/wstein/.sage//tmp/linear_code_4858.py
         [14.8 s]
 
----------------------------------------------------------------------
The following tests failed:


        sage -t --optional "devel/sage/sage/coding/linear_code.py"
Total time for all tests: 14.9 seconds
```

Issue created by migration from https://trac.sagemath.org/ticket/12901





---

archive/issue_comments_152257.json:
```json
{
    "body": "From my initial investigation is seems that the failure occurs when the GAP function `MatrixAutomorphisms` is called with an empty matrix `[ ]` as it's argument.\n\nAn example where the problem occurs,\n\n```\nsage: C = HammingCode(2,GF(4,\"z\")); C                                        \nLinear code of length 5, dimension 3 over Finite Field in z of size 2^2      \nsage: C.permutation_automorphism_group(algorithm=\"partition\")                \nPermutation Group with generators [(1,3)(4,5), (1,4)(3,5)]                   \nsage: C.permutation_automorphism_group(algorithm=\"gap\")                                  \n...\nTypeError: Gap produced error output\nError, no 1st choice method found for `MatrixAutomorphisms' on 1 arguments\n\nexecuting $sage26:=MatrixAutomorphisms(matCwt);;\n```\n\nWhen I trace `C.permutation_automorphism_group(algorithm=\"gap\")` in this example, I see that \n\n```\n   1922                 gap.eval(\"matCwt:=List(Cwt,c->VectorCodeword(c))\")            #        for each i until stop = 1) \n-> 1923                 A = gap(\"MatrixAutomorphisms(matCwt)\")\n   1924                 #print \"A = \",A, \"\\n Gp = \", Gp, \"\\n strGp = \", str(Gp)\n\nipdb> print wt\n3\nipdb> print nonzerowts\n[0, 3, 4, 5]\nipdb> gap(\"Cwt\")\n[  ]\nipdb> gap(\"List(eltsC, c->WeightCodeword(c))\")\n[ 0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4 ]\n```\n\nso it looks to me like we're expecting to find vectors of weight 3, 4, and 5, but according to GAP there are only vectors of weight 0 or 4 in the code.",
    "created_at": "2012-05-02T18:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12729#issuecomment-152257",
    "user": "https://github.com/benjaminfjones"
}
```

From my initial investigation is seems that the failure occurs when the GAP function `MatrixAutomorphisms` is called with an empty matrix `[ ]` as it's argument.

An example where the problem occurs,

```
sage: C = HammingCode(2,GF(4,"z")); C                                        
Linear code of length 5, dimension 3 over Finite Field in z of size 2^2      
sage: C.permutation_automorphism_group(algorithm="partition")                
Permutation Group with generators [(1,3)(4,5), (1,4)(3,5)]                   
sage: C.permutation_automorphism_group(algorithm="gap")                                  
...
TypeError: Gap produced error output
Error, no 1st choice method found for `MatrixAutomorphisms' on 1 arguments

executing $sage26:=MatrixAutomorphisms(matCwt);;
```

When I trace `C.permutation_automorphism_group(algorithm="gap")` in this example, I see that 

```
   1922                 gap.eval("matCwt:=List(Cwt,c->VectorCodeword(c))")            #        for each i until stop = 1) 
-> 1923                 A = gap("MatrixAutomorphisms(matCwt)")
   1924                 #print "A = ",A, "\n Gp = ", Gp, "\n strGp = ", str(Gp)

ipdb> print wt
3
ipdb> print nonzerowts
[0, 3, 4, 5]
ipdb> gap("Cwt")
[  ]
ipdb> gap("List(eltsC, c->WeightCodeword(c))")
[ 0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4 ]
```

so it looks to me like we're expecting to find vectors of weight 3, 4, and 5, but according to GAP there are only vectors of weight 0 or 4 in the code.



---

archive/issue_events_035239.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12729",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12729#event-35239"
}
```



---

archive/issue_events_035240.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12729",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12729#event-35240"
}
```



---

archive/issue_events_035241.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12729",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12729#event-35241"
}
```



---

archive/issue_events_035242.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12729",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12729#event-35242"
}
```



---

archive/issue_events_035243.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12729",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12729#event-35243"
}
```



---

archive/issue_events_035244.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12729",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12729#event-35244"
}
```



---

archive/issue_events_035245.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12729",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12729#event-35245"
}
```



---

archive/issue_comments_152258.json:
```json
{
    "body": "Changing keywords from \"linear code gap\" to \"gap\".",
    "created_at": "2017-05-19T12:57:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12729#issuecomment-152258",
    "user": "https://github.com/johanrosenkilde"
}
```

Changing keywords from "linear code gap" to "gap".



---

archive/issue_comments_152259.json:
```json
{
    "body": "Running the Sage test suite with `--optional=sage,gap_packages` no longer produces such an error, nor does the example given in comment 1. I'm closing this as invalid.",
    "created_at": "2017-05-19T12:57:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12729#issuecomment-152259",
    "user": "https://github.com/johanrosenkilde"
}
```

Running the Sage test suite with `--optional=sage,gap_packages` no longer produces such an error, nor does the example given in comment 1. I'm closing this as invalid.



---

archive/issue_comments_152260.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-05-19T12:57:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12729#issuecomment-152260",
    "user": "https://github.com/johanrosenkilde"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_152261.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-05-19T12:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12729#issuecomment-152261",
    "user": "https://github.com/johanrosenkilde"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_035246.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2017-05-19T12:57:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12729",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12729#event-35246"
}
```



---

archive/issue_events_035247.json:
```json
{
    "actor": "https://github.com/johanrosenkilde",
    "created_at": "2017-05-19T12:57:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12729",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12729#event-35247"
}
```



---

archive/issue_comments_152262.json:
```json
{
    "body": "Closing tickets in the sage-duplicate/invalid/wontfix module with positive_review (i.e. someone has confirmed they should be closed).",
    "created_at": "2017-07-13T07:54:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12729#issuecomment-152262",
    "user": "https://github.com/embray"
}
```

Closing tickets in the sage-duplicate/invalid/wontfix module with positive_review (i.e. someone has confirmed they should be closed).



---

archive/issue_events_035248.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-13T07:54:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12729",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12729#event-35248"
}
```



---

archive/issue_comments_152263.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2017-07-13T07:54:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12729#issuecomment-152263",
    "user": "https://github.com/embray"
}
```

Resolution: wontfix
