# Issue 12729: permutation_automorphism_group fails in optional doctest of coding/linear_code.py

Issue created by migration from https://trac.sagemath.org/ticket/12901

Original creator: benjaminfjones

Original creation time: 2012-05-02 17:49:12

Assignee: wdj

Keywords: linear code gap

There is a bug in the `permutation_automorphism_group(algorithm="gap")` method of `LinearCode`. It was discovered when doctests were added to `coding/linear_code.py` in #12893. 


```
wstein@sage:sage-5.0.beta15-boxen-x86_64-Linux$ ./sage -t --optional devel/sage/sage/coding/linear_code.py sage -t --optional "devel/sage/sage/coding/linear_code.py"  
**********************************************************************
File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/devel/sage/sage/coding/linear_code.py", line 1992:
    sage: C.permutation_automorphism_group(algorithm="gap")  # requires optional GAP package Guava
Exception raised:
    Traceback (most recent call last):
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_49[21]>", line 1, in <module>
        C.permutation_automorphism_group(algorithm="gap")  # requires optional GAP package Guava###line 1992:
    sage: C.permutation_automorphism_group(algorithm="gap")  # requires optional GAP package Guava
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/misc/decorators.py", line 687, in wrapper
        return func(*args, **kwds)
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/coding/linear_code.py", line 2033, in permutation_automorphism_group
        A = gap("MatrixAutomorphisms(matCwt)")
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/interface.py", line 198, in __call__
        return cls(self, x, name=name)
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/expect.py", line 1331, in __init__
        raise TypeError, x
    TypeError: Gap produced error output
    Error, no 1st choice method found for `MatrixAutomorphisms' on 1 arguments

       executing $sage24:=MatrixAutomorphisms(matCwt);;
**********************************************************************
File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/devel/sage/sage/coding/linear_code.py", line 1995:
    sage: C.permutation_automorphism_group(algorithm="gap")  # requires optional GAP package Guava
Exception raised:
    Traceback (most recent call last):
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_49[23]>", line 1, in <module>
        C.permutation_automorphism_group(algorithm="gap")  # requires optional GAP package Guava###line 1995:
    sage: C.permutation_automorphism_group(algorithm="gap")  # requires optional GAP package Guava
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/misc/decorators.py", line 687, in wrapper
        return func(*args, **kwds)
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/coding/linear_code.py", line 2033, in permutation_automorphism_group
        A = gap("MatrixAutomorphisms(matCwt)")
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/interface.py", line 198, in __call__
        return cls(self, x, name=name)
      File "/scratch/wstein/ref/sage-5.0.beta15-boxen-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/expect.py", line 1331, in __init__
        raise TypeError, x
    TypeError: Gap produced error output
    Error, no 1st choice method found for `MatrixAutomorphisms' on 1 arguments

       executing $sage26:=MatrixAutomorphisms(matCwt);;
**********************************************************************
1 items had failures:
   2 of  25 in __main__.example_49
***Test Failed*** 2 failures.
For whitespace errors, see the file /home/wstein/.sage//tmp/linear_code_4858.py
         [14.8 s]
 
----------------------------------------------------------------------
The following tests failed:


        sage -t --optional "devel/sage/sage/coding/linear_code.py"
Total time for all tests: 14.9 seconds
```



---

Comment by benjaminfjones created at 2012-05-02 18:35:39

From my initial investigation is seems that the failure occurs when the GAP function `MatrixAutomorphisms` is called with an empty matrix `[ ]` as it's argument.

An example where the problem occurs,


```
sage: C = HammingCode(2,GF(4,"z")); C                                        
Linear code of length 5, dimension 3 over Finite Field in z of size 2^2      
sage: C.permutation_automorphism_group(algorithm="partition")                
Permutation Group with generators [(1,3)(4,5), (1,4)(3,5)]                   
sage: C.permutation_automorphism_group(algorithm="gap")                                  
...
TypeError: Gap produced error output
Error, no 1st choice method found for `MatrixAutomorphisms' on 1 arguments

executing $sage26:=MatrixAutomorphisms(matCwt);;
```


When I trace `C.permutation_automorphism_group(algorithm="gap")` in this example, I see that 


```
   1922                 gap.eval("matCwt:=List(Cwt,c->VectorCodeword(c))")            #        for each i until stop = 1) 
-> 1923                 A = gap("MatrixAutomorphisms(matCwt)")
   1924                 #print "A = ",A, "\n Gp = ", Gp, "\n strGp = ", str(Gp)

ipdb> print wt
3
ipdb> print nonzerowts
[0, 3, 4, 5]
ipdb> gap("Cwt")
[  ]
ipdb> gap("List(eltsC, c->WeightCodeword(c))")
[ 0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4 ]
```


so it looks to me like we're expecting to find vectors of weight 3, 4, and 5, but according to GAP there are only vectors of weight 0 or 4 in the code.


---

Comment by jsrn created at 2017-05-19 12:57:23

Changing keywords from "linear code gap" to "gap".


---

Comment by jsrn created at 2017-05-19 12:57:23

Running the Sage test suite with `--optional=sage,gap_packages` no longer produces such an error, nor does the example given in comment 1. I'm closing this as invalid.


---

Comment by jsrn created at 2017-05-19 12:57:23

Changing status from new to needs_review.


---

Comment by jsrn created at 2017-05-19 12:57:38

Changing status from needs_review to positive_review.


---

Comment by embray created at 2017-07-13 07:54:31

Closing tickets in the sage-duplicate/invalid/wontfix module with positive_review (i.e. someone has confirmed they should be closed).


---

Comment by embray created at 2017-07-13 07:54:31

Resolution: wontfix
