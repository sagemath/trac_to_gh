# Issue 12732: colors from rainbow don't work in 3d plots

Issue created by migration from https://trac.sagemath.org/ticket/12904

Original creator: kcrisman

Original creation time: 2012-05-04 00:51:54

Assignee: jason, was


```

----------------------------------------------------------------------
----------------------------------------------------------------------
sage: R = rainbow(1)
sage: R[0]
'#ff0000'
sage: P = plot(x,color=R[0])
sage: P  # all is well
sage: P = plot3d(x,(0,1),(0,1),color=R[0])
ValueError: unknown color '#ff0000'
sage: P = plot3d(x,(0,1),(0,1),color=Color(R[0]))
sage: P # all is well
```



---

Comment by aapitzsch created at 2012-05-04 18:11:19

Changing status from new to needs_review.


---

Attachment

The necessary change to solve the problem is

```diff

--- a/sage/plot/plot3d/texture.py
+++ b/sage/plot/plot3d/texture.py
@@ -211,9 +212,9 @@
         return info.rgb()
     elif isinstance(info, str):
         try:
-            return colors[info]
+            return Color(info)
         except KeyError:
```



---

Comment by kcrisman created at 2012-05-05 02:15:49

This is great diagnosis and a nice terse doctest.   I've looked through this a fair amount and the only obvious problem (other than the doctest failure below) I can find is that 

```
sage: timeit('colors.has_key("blue")')
625 loops, best of 3: 205 ns per loop
sage: timeit('"blue" in colors')
625 loops, best of 3: 230 ns per loop
```

and more or less this is true all the time.  I don't know if there is any documentation on which is uniformly faster?  In some sense the second seems more "Pythonic" but OO syntax is nice too...

I also wonder why the switch to the new Python error raising but not the new formatting :) but that is really totally unimportant.

But did you run tests?

```

sage -t  "devel/sage-main/sage/plot/plot3d/texture.py"      
**********************************************************************
File "/Users/.../sage-5.0.beta14/devel/sage-main/sage/plot/plot3d/texture.py", line 19:
    sage: [t for t in G.texture_set() if t.color == colors.red] # we should have two red textures
Expected:
    [Texture(texture..., red, ff0000), Texture(texture..., red, ff0000)]
Got:
    []
**********************************************************************
File "/Users/.../sage-5.0.beta14/devel/sage-main/sage/plot/plot3d/texture.py", line 21:
    sage: [t for t in G.texture_set() if t.color == colors.yellow] # ...and one yellow
Expected:
    [Texture(texture..., yellow, ffff00)]
Got:
    []
**********************************************************************
1 items had failures:
   2 of  11 in __main__.example_0
***Test Failed*** 2 failures.
For whitespace errors, see the file /Users/karl-dietercrisman/.sage//tmp/texture_43616.py
	 [10.8 s]
```

I have a feeling that this is also indicative:

```
sage: colors['blue']
RGB color (0.0, 0.0, 1.0)
sage: Color('blue')
RGB color (0.0, 0.0, 1.0)
sage: type(colors['blue'])
<class 'sage.plot.colors.Color'>
sage: type(Color('blue'))
<class 'sage.plot.colors.Color'>
sage: colors['blue'] == Color('blue')
False
```

Anyway, I'm a little surprised because `colors` has a constructor from `Color`... but needs work.


---

Comment by kcrisman created at 2012-05-05 02:15:49

Changing status from needs_review to needs_work.


---

Comment by aapitzsch created at 2012-05-05 10:48:12

Changing status from needs_work to needs_review.


---

Comment by aapitzsch created at 2012-05-05 10:48:12

Replying to [comment:2 kcrisman]:
> This is great diagnosis and a nice terse doctest.   I've looked through this a fair amount and the only obvious problem (other than the doctest failure below) I can find is that 
> {{{
> sage: timeit('colors.has_key("blue")')
> 625 loops, best of 3: 205 ns per loop
> sage: timeit('"blue" in colors')
> 625 loops, best of 3: 230 ns per loop
> }}}
> and more or less this is true all the time.  I don't know if there is any documentation on which is uniformly faster?  In some sense the second seems more "Pythonic" but OO syntax is nice too...
> 
> I also wonder why the switch to the new Python error raising but not the new formatting :) but that is really totally unimportant.

What do you mean by _new formatting_?

`has_key` is deprecated, see [docs.python](http://docs.python.org/library/stdtypes.html?highlight=has_key#dict.has_key), that's why I replaced it.
BTW, I got

```
sage: timeit('colors.has_key("blue")') 
625 loops, best of 3: 186 ns per loop
sage: timeit('"blue" in colors')      
625 loops, best of 3: 187 ns per loop
```


> 
> But did you run tests?
> {{{
> 
> sage -t  "devel/sage-main/sage/plot/plot3d/texture.py"      
> **********************************************************************
> File "/Users/.../sage-5.0.beta14/devel/sage-main/sage/plot/plot3d/texture.py", line 19:
>     sage: [t for t in G.texture_set() if t.color == colors.red] # we should have two red textures
> Expected:
>     [Texture(texture..., red, ff0000), Texture(texture..., red, ff0000)]
> Got:
>     []
> **********************************************************************
> File "/Users/.../sage-5.0.beta14/devel/sage-main/sage/plot/plot3d/texture.py", line 21:
>     sage: [t for t in G.texture_set() if t.color == colors.yellow] # ...and one yellow
> Expected:
>     [Texture(texture..., yellow, ffff00)]
> Got:
>     []
> **********************************************************************
> 1 items had failures:
>    2 of  11 in __main__.example_0
> ***Test Failed*** 2 failures.
> For whitespace errors, see the file /Users/karl-dietercrisman/.sage//tmp/texture_43616.py
> 	 [10.8 s]
> }}}

You have to apply the patch for #11383 first, see dependencies.

I'm setting this back to needs review because of the reasons mentioned above.


---

Comment by kcrisman created at 2012-05-05 20:57:23

Oh, I had no idea about the dependency.  Love the link about the `in`, very useful.   By new formatting I mean things like [this Python doc](http://docs.python.org/library/stdtypes.html#str.format).

I don't have time to do finish this off right now but I'm sure that this will be fine once I apply #11383.  Good work.


---

Comment by kcrisman created at 2012-05-06 01:25:21

I don't see any other problems here.  Doesn't mean they aren't there, but this seems good.


---

Comment by kcrisman created at 2012-05-06 01:25:21

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-06-18 10:24:45

Resolution: fixed
