# Issue 20111: p-adic floating point rings

Issue created by migration from Trac.

Original creator: roed

Original creation time: 2016-04-02 00:55:20

CC:  caruso saraedum

Sage should include an implementation of p-adics that does not implement precision tracking.  It will be useful for implementing polynomials, matrices and power series rings that want to do their own precision tracking.


---

Comment by jdemeyer created at 2016-06-24 07:58:14

This doesn't look like the right branch.

Anyway, I'm curious what you mean precisely with "p-adic floating point rings".


---

Comment by caruso created at 2016-08-26 14:32:19

David, have you written some code for p-adic floating point arithmetics? (As noticed by Jeroen the branch you attached is not the correct one.)


---

Comment by roed created at 2016-08-26 15:36:37

Oops.  I do have some code; I'll upload it when I'm back in Pittsburgh this weekend.


---

Comment by caruso created at 2016-09-05 14:06:55

A kind reminder :-)


---

Comment by git created at 2016-11-29 22:17:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-12-24 07:01:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2016-12-24 07:04:21

It builds and most tests pass (there are only a few failures in `sage.rings.padics.padic_base_leaves`).  I'm marking it as needs review to get feedback, though there's still a bit of work to do.


---

Comment by roed created at 2016-12-24 07:04:21

Changing status from new to needs_review.


---

Comment by git created at 2016-12-29 23:55:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2016-12-29 23:56:25

Alright, I fixed the `TestSuite` issues and updated to Sage 7.5. I think this is now legitimately Needs Review.


---

Attachment

review chat log


---

Comment by saraedum created at 2017-01-11 03:58:01

Last 10 new commits:


---

Comment by saraedum created at 2017-01-11 03:59:36

David, I made the changes we discussed. The only potentially controversial change is that I do now allow circular coercions. It is my understanding that (at least in theory) there should be nothing wrong with circular coercion structures. What do you think?


---

Comment by git created at 2017-01-11 04:06:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-01-11 04:21:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-01-11 05:38:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-01-11 05:40:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2017-01-11 05:57:20

Changing status from needs_review to positive_review.


---

Comment by roed created at 2017-01-11 06:03:55

For the record, I'm happy with Julian's changes.  Yay!


---

Comment by saraedum created at 2017-01-12 01:13:52

The patchbot was not happy but I think that we did not cause that. Let's wait for another one to check.


---

Comment by roed created at 2017-01-12 01:58:11

Yeah, many of the errors there look like timeouts; the few that don't look pretty unrelated to what we changed.


---

Comment by vbraun created at 2017-01-16 22:53:55

I can reproduce the patchbot failure in src/sage/misc/session.pyx


---

Comment by vbraun created at 2017-01-16 22:53:55

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2017-01-16 22:56:36

PS: On 32-bit there are a bunch of valuation overflows, see http://build.sagedev.org/#/builders/21/builds/2/steps/9/logs/stdio


---

Comment by jdemeyer created at 2017-01-17 08:12:46

Also: to be compatible with a future splitting of `sage.libs.cypari2`, please use

```
from sage.libs.pari.all import pari
```

to import `pari`.


---

Comment by roed created at 2017-02-09 07:55:06

Replying to [comment:28 vbraun]:
> PS: On 32-bit there are a bunch of valuation overflows, see http://build.sagedev.org/#/builders/21/builds/2/steps/9/logs/stdio

The link seems to not work anymore (presumably it was overwritten by a more recent run of the buildbot).  Is the log saved anywhere else?
----
Last 10 new commits:


---

Comment by roed created at 2017-03-01 05:21:46

Changing status from needs_work to needs_review.


---

Comment by roed created at 2017-03-01 05:21:46

Checking what the patchbot says....
----
New commits:


---

Comment by caruso created at 2017-05-12 23:38:58

I fixed the building issues (`cypari2.gen` was not imported correctly).

However, there are still failing doctests in `sage/rings/padics/padic_floating_point_element.pxd`.


---

Comment by caruso created at 2017-05-12 23:38:58

Changing status from needs_review to needs_work.


---

Comment by roed created at 2017-05-19 19:46:13

Changing status from needs_work to needs_review.


---

Comment by roed created at 2017-05-19 19:46:13

I fixed a doctest error.  Handing it over to the patchbot....
----
New commits:


---

Comment by caruso created at 2017-05-25 06:27:44

Seems good to me.

However the patchbot is not entirely happy, it says


```
========== python3 ==========
git checkout patchbot/ticket_merged
Bereits auf 'patchbot/ticket_merged'
inside file:  b/src/sage/rings/padics/FP_template.pxi
`@``@` -0,0 +1,1798 `@``@`
+    def __nonzero__(self):
Python 3 incompatible code inserted on 1 non-empty lines
Traceback (most recent call last):
  File "/local/sage-patchbot/.local/lib/python2.7/site-packages/sage_patchbot/patchbot.py", line 1118, in test_a_ticket
    baseline=baseline, **kwds)
  File "/local/sage-patchbot/.local/lib/python2.7/site-packages/sage_patchbot/plugins.py", line 401, in python3
    msg="Python 3 incompatible code", **kwds)
  File "/local/sage-patchbot/.local/lib/python2.7/site-packages/sage_patchbot/plugins.py", line 262, in exclude_new
    raise ValueError(full_msg)
ValueError: Python 3 incompatible code inserted on 1 non-empty lines
python3 -- 0 seconds
========== end python3 ==========
```


Should we fix it?


---

Comment by git created at 2017-06-01 15:06:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2017-06-01 15:12:38

As for python3, we should leave it as `__nonzero__` since Cython extension types are fine with both `__nonzero__` and `__bool__`.  See the discussion at #21887.


---

Comment by roed created at 2017-06-04 14:00:08

Patchbot succeeded!  I think both of the plugin failures should be ignored.  Ready for review from my perspective.


---

Comment by saraedum created at 2017-06-05 16:03:45

Changing status from needs_review to needs_work.


---

Comment by saraedum created at 2017-06-05 16:03:45

Looks good. The only thing I stumbled upon: In https://git.sagemath.org/sage.git/commit/?id=8195327f6709a45a0942692dabf153fc6f4cb28e you write `Zq` instead of `\ZZ_q` and you use `\ZZ_q` with an incorrect number of backticks once.

Apart from that, positive review.


---

Comment by saraedum created at 2017-06-05 16:04:59

Oh, but that's actually fixed already.


---

Comment by saraedum created at 2017-06-05 16:04:59

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2017-06-07 20:13:28

Resolution: fixed
