# Issue 20111: p-adic floating point rings

archive/issues_020111.json:
```json
{
    "body": "CC:  caruso saraedum\n\nSage should include an implementation of p-adics that does not implement precision tracking.  It will be useful for implementing polynomials, matrices and power series rings that want to do their own precision tracking.\n\nIssue created by migration from https://trac.sagemath.org/ticket/20348\n\n",
    "created_at": "2016-04-02T00:55:20Z",
    "labels": [
        "padics",
        "major",
        "enhancement"
    ],
    "title": "p-adic floating point rings",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20111",
    "user": "roed"
}
```
CC:  caruso saraedum

Sage should include an implementation of p-adics that does not implement precision tracking.  It will be useful for implementing polynomials, matrices and power series rings that want to do their own precision tracking.

Issue created by migration from https://trac.sagemath.org/ticket/20348





---

archive/issue_comments_277218.json:
```json
{
    "body": "This doesn't look like the right branch.\n\nAnyway, I'm curious what you mean precisely with \"p-adic floating point rings\".",
    "created_at": "2016-06-24T07:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277218",
    "user": "jdemeyer"
}
```

This doesn't look like the right branch.

Anyway, I'm curious what you mean precisely with "p-adic floating point rings".



---

archive/issue_comments_277219.json:
```json
{
    "body": "David, have you written some code for p-adic floating point arithmetics? (As noticed by Jeroen the branch you attached is not the correct one.)",
    "created_at": "2016-08-26T14:32:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277219",
    "user": "caruso"
}
```

David, have you written some code for p-adic floating point arithmetics? (As noticed by Jeroen the branch you attached is not the correct one.)



---

archive/issue_comments_277220.json:
```json
{
    "body": "Oops.  I do have some code; I'll upload it when I'm back in Pittsburgh this weekend.",
    "created_at": "2016-08-26T15:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277220",
    "user": "roed"
}
```

Oops.  I do have some code; I'll upload it when I'm back in Pittsburgh this weekend.



---

archive/issue_comments_277221.json:
```json
{
    "body": "A kind reminder :-)",
    "created_at": "2016-09-05T14:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277221",
    "user": "caruso"
}
```

A kind reminder :-)



---

archive/issue_comments_277222.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-29T22:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277222",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277223.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-24T07:01:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277223",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277224.json:
```json
{
    "body": "It builds and most tests pass (there are only a few failures in `sage.rings.padics.padic_base_leaves`).  I'm marking it as needs review to get feedback, though there's still a bit of work to do.",
    "created_at": "2016-12-24T07:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277224",
    "user": "roed"
}
```

It builds and most tests pass (there are only a few failures in `sage.rings.padics.padic_base_leaves`).  I'm marking it as needs review to get feedback, though there's still a bit of work to do.



---

archive/issue_comments_277225.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-12-24T07:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277225",
    "user": "roed"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_277226.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-29T23:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277226",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277227.json:
```json
{
    "body": "Alright, I fixed the `TestSuite` issues and updated to Sage 7.5. I think this is now legitimately Needs Review.",
    "created_at": "2016-12-29T23:56:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277227",
    "user": "roed"
}
```

Alright, I fixed the `TestSuite` issues and updated to Sage 7.5. I think this is now legitimately Needs Review.



---

archive/issue_comments_277228.json:
```json
{
    "body": "Attachment [irc.log](tarball://root/attachments/some-uuid/ticket20348/irc.log) by saraedum created at 2017-01-11 00:19:50\n\nreview chat log",
    "created_at": "2017-01-11T00:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277228",
    "user": "saraedum"
}
```

Attachment [irc.log](tarball://root/attachments/some-uuid/ticket20348/irc.log) by saraedum created at 2017-01-11 00:19:50

review chat log



---

archive/issue_comments_277229.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2017-01-11T03:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277229",
    "user": "saraedum"
}
```

Last 10 new commits:



---

archive/issue_comments_277230.json:
```json
{
    "body": "David, I made the changes we discussed. The only potentially controversial change is that I do now allow circular coercions. It is my understanding that (at least in theory) there should be nothing wrong with circular coercion structures. What do you think?",
    "created_at": "2017-01-11T03:59:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277230",
    "user": "saraedum"
}
```

David, I made the changes we discussed. The only potentially controversial change is that I do now allow circular coercions. It is my understanding that (at least in theory) there should be nothing wrong with circular coercion structures. What do you think?



---

archive/issue_comments_277231.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-11T04:06:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277231",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277232.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-11T04:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277232",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277233.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-11T05:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277233",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277234.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-11T05:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277234",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277235.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-11T05:57:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277235",
    "user": "saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_277236.json:
```json
{
    "body": "For the record, I'm happy with Julian's changes.  Yay!",
    "created_at": "2017-01-11T06:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277236",
    "user": "roed"
}
```

For the record, I'm happy with Julian's changes.  Yay!



---

archive/issue_comments_277237.json:
```json
{
    "body": "The patchbot was not happy but I think that we did not cause that. Let's wait for another one to check.",
    "created_at": "2017-01-12T01:13:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277237",
    "user": "saraedum"
}
```

The patchbot was not happy but I think that we did not cause that. Let's wait for another one to check.



---

archive/issue_comments_277238.json:
```json
{
    "body": "Yeah, many of the errors there look like timeouts; the few that don't look pretty unrelated to what we changed.",
    "created_at": "2017-01-12T01:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277238",
    "user": "roed"
}
```

Yeah, many of the errors there look like timeouts; the few that don't look pretty unrelated to what we changed.



---

archive/issue_comments_277239.json:
```json
{
    "body": "I can reproduce the patchbot failure in src/sage/misc/session.pyx",
    "created_at": "2017-01-16T22:53:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277239",
    "user": "vbraun"
}
```

I can reproduce the patchbot failure in src/sage/misc/session.pyx



---

archive/issue_comments_277240.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-01-16T22:53:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277240",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_277241.json:
```json
{
    "body": "PS: On 32-bit there are a bunch of valuation overflows, see http://build.sagedev.org/#/builders/21/builds/2/steps/9/logs/stdio",
    "created_at": "2017-01-16T22:56:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277241",
    "user": "vbraun"
}
```

PS: On 32-bit there are a bunch of valuation overflows, see http://build.sagedev.org/#/builders/21/builds/2/steps/9/logs/stdio



---

archive/issue_comments_277242.json:
```json
{
    "body": "Also: to be compatible with a future splitting of `sage.libs.cypari2`, please use\n\n```\nfrom sage.libs.pari.all import pari\n```\n\nto import `pari`.",
    "created_at": "2017-01-17T08:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277242",
    "user": "jdemeyer"
}
```

Also: to be compatible with a future splitting of `sage.libs.cypari2`, please use

```
from sage.libs.pari.all import pari
```

to import `pari`.



---

archive/issue_comments_277243.json:
```json
{
    "body": "Replying to [comment:28 vbraun]:\n> PS: On 32-bit there are a bunch of valuation overflows, see http://build.sagedev.org/#/builders/21/builds/2/steps/9/logs/stdio\n\nThe link seems to not work anymore (presumably it was overwritten by a more recent run of the buildbot).  Is the log saved anywhere else?\n----\nLast 10 new commits:",
    "created_at": "2017-02-09T07:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277243",
    "user": "roed"
}
```

Replying to [comment:28 vbraun]:
> PS: On 32-bit there are a bunch of valuation overflows, see http://build.sagedev.org/#/builders/21/builds/2/steps/9/logs/stdio

The link seems to not work anymore (presumably it was overwritten by a more recent run of the buildbot).  Is the log saved anywhere else?
----
Last 10 new commits:



---

archive/issue_comments_277244.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-01T05:21:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277244",
    "user": "roed"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_277245.json:
```json
{
    "body": "Checking what the patchbot says....\n----\nNew commits:",
    "created_at": "2017-03-01T05:21:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277245",
    "user": "roed"
}
```

Checking what the patchbot says....
----
New commits:



---

archive/issue_comments_277246.json:
```json
{
    "body": "I fixed the building issues (`cypari2.gen` was not imported correctly).\n\nHowever, there are still failing doctests in `sage/rings/padics/padic_floating_point_element.pxd`.",
    "created_at": "2017-05-12T23:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277246",
    "user": "caruso"
}
```

I fixed the building issues (`cypari2.gen` was not imported correctly).

However, there are still failing doctests in `sage/rings/padics/padic_floating_point_element.pxd`.



---

archive/issue_comments_277247.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-05-12T23:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277247",
    "user": "caruso"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_277248.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-05-19T19:46:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277248",
    "user": "roed"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_277249.json:
```json
{
    "body": "I fixed a doctest error.  Handing it over to the patchbot....\n----\nNew commits:",
    "created_at": "2017-05-19T19:46:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277249",
    "user": "roed"
}
```

I fixed a doctest error.  Handing it over to the patchbot....
----
New commits:



---

archive/issue_comments_277250.json:
```json
{
    "body": "Seems good to me.\n\nHowever the patchbot is not entirely happy, it says\n\n\n```\n========== python3 ==========\ngit checkout patchbot/ticket_merged\nBereits auf 'patchbot/ticket_merged'\ninside file:  b/src/sage/rings/padics/FP_template.pxi\n@@ -0,0 +1,1798 @@\n+    def __nonzero__(self):\nPython 3 incompatible code inserted on 1 non-empty lines\nTraceback (most recent call last):\n  File \"/local/sage-patchbot/.local/lib/python2.7/site-packages/sage_patchbot/patchbot.py\", line 1118, in test_a_ticket\n    baseline=baseline, **kwds)\n  File \"/local/sage-patchbot/.local/lib/python2.7/site-packages/sage_patchbot/plugins.py\", line 401, in python3\n    msg=\"Python 3 incompatible code\", **kwds)\n  File \"/local/sage-patchbot/.local/lib/python2.7/site-packages/sage_patchbot/plugins.py\", line 262, in exclude_new\n    raise ValueError(full_msg)\nValueError: Python 3 incompatible code inserted on 1 non-empty lines\npython3 -- 0 seconds\n========== end python3 ==========\n```\n\n\nShould we fix it?",
    "created_at": "2017-05-25T06:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277250",
    "user": "caruso"
}
```

Seems good to me.

However the patchbot is not entirely happy, it says


```
========== python3 ==========
git checkout patchbot/ticket_merged
Bereits auf 'patchbot/ticket_merged'
inside file:  b/src/sage/rings/padics/FP_template.pxi
@@ -0,0 +1,1798 @@
+    def __nonzero__(self):
Python 3 incompatible code inserted on 1 non-empty lines
Traceback (most recent call last):
  File "/local/sage-patchbot/.local/lib/python2.7/site-packages/sage_patchbot/patchbot.py", line 1118, in test_a_ticket
    baseline=baseline, **kwds)
  File "/local/sage-patchbot/.local/lib/python2.7/site-packages/sage_patchbot/plugins.py", line 401, in python3
    msg="Python 3 incompatible code", **kwds)
  File "/local/sage-patchbot/.local/lib/python2.7/site-packages/sage_patchbot/plugins.py", line 262, in exclude_new
    raise ValueError(full_msg)
ValueError: Python 3 incompatible code inserted on 1 non-empty lines
python3 -- 0 seconds
========== end python3 ==========
```


Should we fix it?



---

archive/issue_comments_277251.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-01T15:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277251",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277252.json:
```json
{
    "body": "As for python3, we should leave it as `__nonzero__` since Cython extension types are fine with both `__nonzero__` and `__bool__`.  See the discussion at #21887.",
    "created_at": "2017-06-01T15:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277252",
    "user": "roed"
}
```

As for python3, we should leave it as `__nonzero__` since Cython extension types are fine with both `__nonzero__` and `__bool__`.  See the discussion at #21887.



---

archive/issue_comments_277253.json:
```json
{
    "body": "Patchbot succeeded!  I think both of the plugin failures should be ignored.  Ready for review from my perspective.",
    "created_at": "2017-06-04T14:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277253",
    "user": "roed"
}
```

Patchbot succeeded!  I think both of the plugin failures should be ignored.  Ready for review from my perspective.



---

archive/issue_comments_277254.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-06-05T16:03:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277254",
    "user": "saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_277255.json:
```json
{
    "body": "Looks good. The only thing I stumbled upon: In https://git.sagemath.org/sage.git/commit/?id=8195327f6709a45a0942692dabf153fc6f4cb28e you write `Zq` instead of `\\ZZ_q` and you use `\\ZZ_q` with an incorrect number of backticks once.\n\nApart from that, positive review.",
    "created_at": "2017-06-05T16:03:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277255",
    "user": "saraedum"
}
```

Looks good. The only thing I stumbled upon: In https://git.sagemath.org/sage.git/commit/?id=8195327f6709a45a0942692dabf153fc6f4cb28e you write `Zq` instead of `\ZZ_q` and you use `\ZZ_q` with an incorrect number of backticks once.

Apart from that, positive review.



---

archive/issue_comments_277256.json:
```json
{
    "body": "Oh, but that's actually fixed already.",
    "created_at": "2017-06-05T16:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277256",
    "user": "saraedum"
}
```

Oh, but that's actually fixed already.



---

archive/issue_comments_277257.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-06-05T16:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277257",
    "user": "saraedum"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_277258.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-07T20:13:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20111",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20111#issuecomment-277258",
    "user": "vbraun"
}
```

Resolution: fixed
