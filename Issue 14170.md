# Issue 14170: recover from doctest timings cache corruption

Issue created by migration from https://trac.sagemath.org/ticket/14374

Original creator: vbraun

Original creation time: 2013-03-28 12:31:27

Assignee: mvngu

CC:  roed

Caches can be corrupted as you doctest stuff, you never know when things die. The new doctest framework does not recover gracefully:

```
[vbraun@volker-desktop hg]$ echo foobar > ~/.sage/timings_dt_test.json 
[vbraun@volker-desktop hg]$ sage -tp sage/doctest/
Running doctests with ID 2013-03-28-12-29-46-c1280e16.
Doctesting 9 files using 10 threads.
sage -t sage/doctest/reporting.py
**********************************************************************
File "sage/doctest/reporting.py", line 103, in sage.doctest.reporting.DocTestReporter.__init__
Failed example:
    DC = DocTestController(DocTestDefaults(),[filename])
Expected nothing
Got:
    Error loading stats from /home/vbraun/.sage/timings_dt_test.json
**********************************************************************
File "sage/doctest/reporting.py", line 130, in sage.doctest.reporting.DocTestReporter.report_head
Failed example:
    DC = DocTestController(DD, [filename])
Expected nothing
Got:
    Error loading stats from /home/vbraun/.sage/timings_dt_test.json
```



---

Comment by jdemeyer created at 2013-03-28 22:24:22

Volker, #14292 (I have a patch but it's on sage.math which is currently offline) should ensure that the JSON file cannot be corrupted anymore. So, _if_ we get an error loading the JSON file, it should be a genuine error and we want to get a doctest failure.

So we could close this one as duplicate of #14292.


---

Comment by vbraun created at 2013-03-28 22:33:07

There is also the issue of changing JSON fields (try pushing/popping #13278, this is the problem that I originally had).


---

Comment by jdemeyer created at 2013-03-28 22:47:09

Replying to [comment:2 vbraun]:
> There is also the issue of changing JSON fields (try pushing/popping #13278, this is the problem that I originally had).
Does it cause the JSON stats to fail to load?


---

Comment by roed created at 2013-03-28 22:48:28

Changing assignee from mvngu to roed.


---

Comment by roed created at 2013-03-28 22:48:28

Changing component from doctest to doctest framework.


---

Comment by vbraun created at 2013-03-28 22:56:42

Yes, all doctests failed for me after first pushing #13278


---

Comment by jdemeyer created at 2013-03-28 23:06:13

Strange, I haven't seen this error while working on #13278. But I'll test it now.


---

Comment by jdemeyer created at 2013-03-29 01:09:08

I cannot reproduce the problem with #13278.


---

Comment by jdemeyer created at 2013-04-11 13:10:59

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2013-04-11 13:10:59

Do we agree that this is fixed by #14292 and that it can be closed?


---

Comment by vbraun created at 2013-04-11 15:36:54

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2013-04-11 15:36:54

I guess its good enough. Somebody will fall into that trap but at least I'll know how to fix it on my machine.


---

Comment by jdemeyer created at 2013-04-11 16:21:26

Replying to [comment:9 vbraun]:
> Somebody will fall into that trap
If they do, they might have found a genuine error in Sage.


---

Comment by jdemeyer created at 2013-04-11 16:21:26

Resolution: wontfix
