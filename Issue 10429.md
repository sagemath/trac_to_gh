# Issue 10429: Add Weisfeiler-Leman algorithm to sage.graphs

Issue created by migration from https://trac.sagemath.org/ticket/10482

Original creator: kini

Original creation time: 2010-12-16 11:40:35

Assignee: kini

Keywords: weisfeiler-leman algorithm, graphs, coherent configurations, refinement

See [this sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/aae6ee93b11715c8).

Adding an implementation of the Weisfeiler-Leman algorithm for partition / graph refinement.


---

Attachment

patch to be applied to sage-main repository


---

Comment by kini created at 2010-12-16 11:48:14

Sorry, here it is with a ".patch" extension. To be applied to sage-main.


---

Attachment

this  all works OK (on sage 4.6.1.alpha3);
what I do not know is whether GraphWL should be installed as a method for graphs.

Dima


---

Comment by kini created at 2010-12-23 10:14:32

Sorry, didn't realize I should have marked this as "needs review".

By the way, something I wasn't able to figure out - why (with this patch applied) does `sage.graphs.wlrefine.sage` alias to `sage` (the top-level module)? Why does `sage.graphs.wlrefine.sage` even appear in the first place?


---

Comment by kini created at 2010-12-23 10:14:32

Changing status from new to needs_review.


---

Comment by dimpase created at 2011-02-02 06:03:33

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2011-02-02 06:03:33

Can we have a mildly interesting example in the doctest, i.e. refining which does not produce an orbital-induced refinement?
The smallest non-directed example like this is the [Shrikhande strongly regular graph](http://en.wikipedia.org/wiki/Shrikhande_graph) on 16 vertices; a the smallest directed example a certain tournament on 15 vertices.

Shrikhande graph is mentioned on #9136.
Maybe you can contribute its Sage implementation along the way!


---

Comment by dimpase created at 2011-05-18 21:32:40

just a reminder that this must be fixed soon...


---

Comment by kini created at 2011-05-19 07:34:20

Sorry about that - I was planning to rebase on 4.7 after it comes out (as this is clearly not getting into Sage by then). Is that OK? If not I'll rebase on 4.7.rc2 (there have been some changes to the patch since I created this ticket).


---

Comment by dimpase created at 2011-05-19 08:54:45

Replying to [comment:6 kini]:
> Sorry about that - I was planning to rebase on 4.7 after it comes out (as this is clearly not getting into Sage by then). Is that OK? If not I'll rebase on 4.7.rc2 (there have been some changes to the patch since I created this ticket).

it works on 4.7.rc1, I didn't check rc2.


---

Attachment

64x64 matrix with automorphisms (16 of them), which WL does not see - returns all the 64^2 colours


---

Comment by dimpase created at 2011-05-25 11:36:43

I attached an example of 64x64 matrix with nontrivial automorphisms, which WL does not see, and colours every matrix entry in its own colour.


---

Comment by dimpase created at 2013-08-08 20:25:17

an optimal canonical labellling algorithm is described here: http://www.automata.rwth-aachen.de/~grohe/pub/berbongro13.pdf
It runs in O((n+m)log n) time, with n, resp. m, being #of vertices (resp. edges). (that's not the problem on this ticket though, it's a coarser classification of vertices)


---

Comment by dimpase created at 2013-10-13 22:01:17

rebased for Sage 5.12 (the bug not fixed...)


---

Attachment


---

Comment by kini created at 2013-10-14 00:41:21

I'm not sure what to do with this now. As I recall, I did try stepping carefully through the code back in 2011, and it was doing what I expected it to do, and as far as I could tell it also matched what's written in the paper I based the code on. Yet the answer is wrong for the `wl-bug` case.

So either the code doesn't do what I thought it did after all (certainly possible), or I misread the paper or other resources in some subtle way, or the algorithm in the paper is wrong in some subtle way (I wrote `STABIL.c` more or less completely based on the description of the algorithm in the paper and not on the original code, which _does_ work on `wl-bug`). I'm not sure which of these is the case, and now I don't any longer remember the code I wrote or the contents of the paper well enough to try to find out which of these is the case.

Perhaps at this point the better solution is to just use the old code (which is what you originally suggested in 2010). My code was supposed to allow for a wider variety of input and more memory usage than made sense back in the 80s, but all of that is worthless if the output is not correct... :(


---

Comment by dimpase created at 2013-10-14 07:45:21

Replying to [comment:12 kini]:
> I'm not sure what to do with this now. As I recall, I did try stepping carefully through the code back in 2011, and it was doing what I expected it to do, and as far as I could tell it also matched what's written in the paper I based the code on. Yet the answer is wrong for the `wl-bug` case.

The strategy for debugging is obvious: what happens, mathematically, is that a basis of 0-1 matrices for a matrix algebra is built incrementally. One just has to trace this carefully: at some point instead of creating a minimal 0-1 basis, the procedure breaks.
This might need a bit of extra code, allowing outputting the current basis in some "dumb" machine-readable form at any iteration. Then you can compare what happens in the implementation (it computes the product A_i A_j of two (presumed-)basis elements {A_k}, each of them represented as a linked list, and tries to decompose it into a Z-linear combination of the A_k's. When it fails, this means that it has to locate an A_k that needs to be spit into a number of 0-1 matrices, do this splitting, etc).


---

Comment by dimpase created at 2013-10-14 21:19:08

By the way, what about `STABIL-tests.h`, mentioned in `STABIL.c`? Is it available anywhere?


---

Comment by kini created at 2013-10-14 22:06:23

There was at one point a repository containing this code and the original files from stabprogs.tgz. I think it was on www1.spms.ntu.edu.sg, but my directory there has been cleaned out by now... I found an old clone of it on banana just now, though. I put it up at http://github.com/kini/stabprogs and gave you access to it. I added a testing script, and formatted the wl-bug adjacency matrix like the other input files and added that too. `STABIL-tests.h` is there as well and as you can see, it does something like what you described in comment 13. Well, not that machine-readable, I suppose...


---

Comment by chapoton created at 2018-12-17 20:59:20

Changing keywords from "weisfeiler-leman algorithm, graphs, coherent configurations, refinement" to "weisfeiler-lehman algorithm, graphs, coherent configurations, refinement".


---

Comment by dimpase created at 2018-12-18 16:30:43

The bug is not going to be fixed by the author. This is superseded by #25802, with a much better implementation.


---

Comment by dimpase created at 2018-12-18 16:30:43

Changing status from needs_work to positive_review.


---

Comment by embray created at 2019-02-26 13:58:00

Presuming these are all correctly reviewed as either duplicate, invalid, or wontfix.


---

Comment by embray created at 2019-02-26 13:58:00

Resolution: invalid
