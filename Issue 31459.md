# Issue 31459: Sphinx update for Sage 9.4

archive/issues_031459.json:
```json
{
    "body": "CC:  fbissey arojas jhpalmieri slelievre\n\nWe are at 3.1.2, current is 3.5.4\n\nhttps://repology.org/projects/p/?inrepo=sagemath\n\nIssue created by migration from https://trac.sagemath.org/ticket/31696\n\n",
    "created_at": "2021-04-19T19:56:29Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Sphinx update for Sage 9.4",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31459",
    "user": "mkoeppe"
}
```
CC:  fbissey arojas jhpalmieri slelievre

We are at 3.1.2, current is 3.5.4

https://repology.org/projects/p/?inrepo=sagemath

Issue created by migration from https://trac.sagemath.org/ticket/31696





---

archive/issue_comments_449983.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-10T18:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31459#issuecomment-449983",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449984.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-10T18:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31459#issuecomment-449984",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449985.json:
```json
{
    "body": "Pushed the sphinx 4 update, with the usual batch of deprecation fixes. We should really try to get rid of the custom autodoc fork, most of the breakage comes from it getting out of sync with upstream.",
    "created_at": "2021-05-10T18:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31459#issuecomment-449985",
    "user": "arojas"
}
```

Pushed the sphinx 4 update, with the usual batch of deprecation fixes. We should really try to get rid of the custom autodoc fork, most of the breakage comes from it getting out of sync with upstream.



---

archive/issue_comments_449986.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-11T15:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31459#issuecomment-449986",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449987.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-11T16:03:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31459#issuecomment-449987",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449988.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-05T07:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31459#issuecomment-449988",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449989.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-05T07:04:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31459#issuecomment-449989",
    "user": "arojas"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_449990.json:
```json
{
    "body": "Replying to [comment:5 arojas]:\n> Pushed the sphinx 4 update, with the usual batch of deprecation fixes. We should really try to get rid of the custom autodoc fork, most of the breakage comes from it getting out of sync with upstream.\n\nFor the custom autodoc fork, we should just open a ticket and see what needs fixing when we remove it. May be not for 9.4, but we need to work on this.",
    "created_at": "2021-06-05T07:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31459#issuecomment-449990",
    "user": "fbissey"
}
```

Replying to [comment:5 arojas]:
> Pushed the sphinx 4 update, with the usual batch of deprecation fixes. We should really try to get rid of the custom autodoc fork, most of the breakage comes from it getting out of sync with upstream.

For the custom autodoc fork, we should just open a ticket and see what needs fixing when we remove it. May be not for 9.4, but we need to work on this.



---

archive/issue_comments_449991.json:
```json
{
    "body": "Building the documentation fails for me with `WARNING: rST localisation for language \"hu\" not found.`",
    "created_at": "2021-06-08T18:26:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31459#issuecomment-449991",
    "user": "jhpalmieri"
}
```

Building the documentation fails for me with `WARNING: rST localisation for language "hu" not found.`



---

archive/issue_comments_449992.json:
```json
{
    "body": "Replying to [comment:10 fbissey]:\n> Replying to [comment:5 arojas]:\n> > Pushed the sphinx 4 update, with the usual batch of deprecation fixes. We should really try to get rid of the custom autodoc fork, most of the breakage comes from it getting out of sync with upstream.\n> \n> For the custom autodoc fork, we should just open a ticket and see what needs fixing when we remove it. May be not for 9.4, but we need to work on this.\n\nHow about #30893?",
    "created_at": "2021-06-08T19:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31459#issuecomment-449992",
    "user": "jhpalmieri"
}
```

Replying to [comment:10 fbissey]:
> Replying to [comment:5 arojas]:
> > Pushed the sphinx 4 update, with the usual batch of deprecation fixes. We should really try to get rid of the custom autodoc fork, most of the breakage comes from it getting out of sync with upstream.
> 
> For the custom autodoc fork, we should just open a ticket and see what needs fixing when we remove it. May be not for 9.4, but we need to work on this.

How about #30893?



---

archive/issue_comments_449993.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-12T12:24:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31459#issuecomment-449993",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449994.json:
```json
{
    "body": "Thank you, that fixes the html build problems. The PDF documentation doesn't build though: the Japanese documents fail with\n\n```\n\n! Class jsbook Error: You are running upLaTeX.\n(jsbook)              Please use pLaTeX instead, or add 'uplatex' to\n(jsbook)              the class option list.\n\nSee the jsbook class documentation for explanation.\nType  H <return>  for immediate help.\n ...                                              \n                                                  \nl.229       {\\@ehc}\n                   \n? \n! Emergency stop.\n ...                                              \n                                                  \nl.229       {\\@ehc}\n```\n",
    "created_at": "2021-06-15T00:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31459#issuecomment-449994",
    "user": "jhpalmieri"
}
```

Thank you, that fixes the html build problems. The PDF documentation doesn't build though: the Japanese documents fail with

```

! Class jsbook Error: You are running upLaTeX.
(jsbook)              Please use pLaTeX instead, or add 'uplatex' to
(jsbook)              the class option list.

See the jsbook class documentation for explanation.
Type  H <return>  for immediate help.
 ...                                              
                                                  
l.229       {\@ehc}
                   
? 
! Emergency stop.
 ...                                              
                                                  
l.229       {\@ehc}
```




---

archive/issue_comments_449995.json:
```json
{
    "body": "Looks like https://github.com/sphinx-doc/sphinx/commit/1d9eeedde306cfb013850b4621c32cdd47e46bff\n\nAnyway, this is where I give up. I never build PDF docs myself so I'm not really motivated to keep digging into this.",
    "created_at": "2021-06-18T18:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31459#issuecomment-449995",
    "user": "arojas"
}
```

Looks like https://github.com/sphinx-doc/sphinx/commit/1d9eeedde306cfb013850b4621c32cdd47e46bff

Anyway, this is where I give up. I never build PDF docs myself so I'm not really motivated to keep digging into this.



---

archive/issue_comments_449996.json:
```json
{
    "body": "This works for me. Please test. I am happy to positively review everything but my own contribution.\n----\nNew commits:",
    "created_at": "2021-06-18T21:39:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31459#issuecomment-449996",
    "user": "jhpalmieri"
}
```

This works for me. Please test. I am happy to positively review everything but my own contribution.
----
New commits:



---

archive/issue_comments_449997.json:
```json
{
    "body": "In fact I don't think all of my changes were necessary, but we don't need to include stuff about the French documentation in `doc/ja/...`.",
    "created_at": "2021-06-18T21:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31459#issuecomment-449997",
    "user": "jhpalmieri"
}
```

In fact I don't think all of my changes were necessary, but we don't need to include stuff about the French documentation in `doc/ja/...`.



---

archive/issue_comments_449998.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-22T21:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31459#issuecomment-449998",
    "user": "arojas"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_449999.json:
```json
{
    "body": "PDF build works for me, setting to positive review as per comment:17",
    "created_at": "2021-06-22T21:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31459#issuecomment-449999",
    "user": "arojas"
}
```

PDF build works for me, setting to positive review as per comment:17



---

archive/issue_comments_450000.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-06-29T23:08:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31459#issuecomment-450000",
    "user": "vbraun"
}
```

Resolution: fixed
