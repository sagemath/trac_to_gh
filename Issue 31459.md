# Issue 31459: Sphinx update for Sage 9.4

Issue created by migration from https://trac.sagemath.org/ticket/31696

Original creator: mkoeppe

Original creation time: 2021-04-19 19:56:29

CC:  fbissey arojas jhpalmieri slelievre

We are at 3.1.2, current is 3.5.4

https://repology.org/projects/p/?inrepo=sagemath


---

Comment by git created at 2021-05-10 18:18:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-05-10 18:22:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by arojas created at 2021-05-10 18:24:05

Pushed the sphinx 4 update, with the usual batch of deprecation fixes. We should really try to get rid of the custom autodoc fork, most of the breakage comes from it getting out of sync with upstream.


---

Comment by git created at 2021-05-11 15:34:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-05-11 16:03:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-06-05 07:03:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by arojas created at 2021-06-05 07:04:22

Changing status from new to needs_review.


---

Comment by fbissey created at 2021-06-05 07:34:18

Replying to [comment:5 arojas]:
> Pushed the sphinx 4 update, with the usual batch of deprecation fixes. We should really try to get rid of the custom autodoc fork, most of the breakage comes from it getting out of sync with upstream.

For the custom autodoc fork, we should just open a ticket and see what needs fixing when we remove it. May be not for 9.4, but we need to work on this.


---

Comment by jhpalmieri created at 2021-06-08 18:26:33

Building the documentation fails for me with `WARNING: rST localisation for language "hu" not found.`


---

Comment by jhpalmieri created at 2021-06-08 19:02:55

Replying to [comment:10 fbissey]:
> Replying to [comment:5 arojas]:
> > Pushed the sphinx 4 update, with the usual batch of deprecation fixes. We should really try to get rid of the custom autodoc fork, most of the breakage comes from it getting out of sync with upstream.
> 
> For the custom autodoc fork, we should just open a ticket and see what needs fixing when we remove it. May be not for 9.4, but we need to work on this.

How about #30893?


---

Comment by git created at 2021-06-12 12:24:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2021-06-15 00:49:20

Thank you, that fixes the html build problems. The PDF documentation doesn't build though: the Japanese documents fail with

```

! Class jsbook Error: You are running upLaTeX.
(jsbook)              Please use pLaTeX instead, or add 'uplatex' to
(jsbook)              the class option list.

See the jsbook class documentation for explanation.
Type  H <return>  for immediate help.
 ...                                              
                                                  
l.229       {\@ehc}
                   
? 
! Emergency stop.
 ...                                              
                                                  
l.229       {\@ehc}
```



---

Comment by arojas created at 2021-06-18 18:41:17

Looks like https://github.com/sphinx-doc/sphinx/commit/1d9eeedde306cfb013850b4621c32cdd47e46bff

Anyway, this is where I give up. I never build PDF docs myself so I'm not really motivated to keep digging into this.


---

Comment by jhpalmieri created at 2021-06-18 21:39:43

This works for me. Please test. I am happy to positively review everything but my own contribution.
----
New commits:


---

Comment by jhpalmieri created at 2021-06-18 21:42:26

In fact I don't think all of my changes were necessary, but we don't need to include stuff about the French documentation in `doc/ja/...`.


---

Comment by arojas created at 2021-06-22 21:03:29

Changing status from needs_review to positive_review.


---

Comment by arojas created at 2021-06-22 21:03:29

PDF build works for me, setting to positive review as per comment:17


---

Comment by vbraun created at 2021-06-29 23:08:40

Resolution: fixed
