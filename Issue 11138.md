# Issue 11138: Get rid of some bare "except:" statements

archive/issues_011138.json:
```json
{
    "body": "Assignee: @jasongrout\n\nCC:  @kini\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/11310\n\n",
    "created_at": "2011-05-07T10:10:30Z",
    "labels": [
        "misc",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.3",
    "title": "Get rid of some bare \"except:\" statements",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11138",
    "user": "@jdemeyer"
}
```
Assignee: @jasongrout

CC:  @kini



Issue created by migration from https://trac.sagemath.org/ticket/11310





---

archive/issue_comments_121906.json:
```json
{
    "body": "What's the problem with this ticket? I think it is a small enough change that it can be at least set for review.",
    "created_at": "2012-05-15T09:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121906",
    "user": "@ppurka"
}
```

What's the problem with this ticket? I think it is a small enough change that it can be at least set for review.



---

archive/issue_comments_121907.json:
```json
{
    "body": "Tests pass on 5.0. Jeroen, is this ready for review, or do you want to add more stuff?",
    "created_at": "2012-05-16T05:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121907",
    "user": "@kini"
}
```

Tests pass on 5.0. Jeroen, is this ready for review, or do you want to add more stuff?



---

archive/issue_comments_121908.json:
```json
{
    "body": "I would like to fix the following from `devel/sage/sage/structure/parent.pyx`, starting at line 2577:\n\n```\n        try:\n            return super(Parent, self)._an_element_()\n        except EmptySetError:\n            raise\n        except:\n            _record_exception()\n            pass\n\n        try:\n            return self.gen(0)\n        except:\n            _record_exception()\n            pass\n\n        try:\n            return self.gen()\n        except:\n            _record_exception()\n            pass\n```\n",
    "created_at": "2012-05-16T07:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121908",
    "user": "@jdemeyer"
}
```

I would like to fix the following from `devel/sage/sage/structure/parent.pyx`, starting at line 2577:

```
        try:
            return super(Parent, self)._an_element_()
        except EmptySetError:
            raise
        except:
            _record_exception()
            pass

        try:
            return self.gen(0)
        except:
            _record_exception()
            pass

        try:
            return self.gen()
        except:
            _record_exception()
            pass
```




---

archive/issue_comments_121909.json:
```json
{
    "body": "Changing these bare except statements to `except StandardError` seems like not enough, don't you think? Except statements should always be written to accept the narrowest possible expected exception class only.",
    "created_at": "2012-06-21T08:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121909",
    "user": "@kini"
}
```

Changing these bare except statements to `except StandardError` seems like not enough, don't you think? Except statements should always be written to accept the narrowest possible expected exception class only.



---

archive/issue_comments_121910.json:
```json
{
    "body": "Replying to [comment:7 kini]:\n> Changing these bare except statements to `except StandardError` seems like not enough, don't you think? Except statements should always be written to accept the narrowest possible expected exception class only.\n\nThen what should it be? According to the [hierarchy of exceptions](http://docs.python.org/library/exceptions.html#exception-hierarchy) I think `StandardError` encapsulates most of what can go wrong. It is at least better than a blank `except:`.\n\nAbout the `RuntimeError`s I think some of them should be `ValueError` and I spotted one which should be an `AttributeError`.",
    "created_at": "2012-06-21T08:26:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121910",
    "user": "@ppurka"
}
```

Replying to [comment:7 kini]:
> Changing these bare except statements to `except StandardError` seems like not enough, don't you think? Except statements should always be written to accept the narrowest possible expected exception class only.

Then what should it be? According to the [hierarchy of exceptions](http://docs.python.org/library/exceptions.html#exception-hierarchy) I think `StandardError` encapsulates most of what can go wrong. It is at least better than a blank `except:`.

About the `RuntimeError`s I think some of them should be `ValueError` and I spotted one which should be an `AttributeError`.



---

archive/issue_comments_121911.json:
```json
{
    "body": "I mean that the code should be inspected and the appropriate exception class should be used in each case. Of course, this is not easy, considering that the autogenerated patch is more than 100 KB. But still, it should be done.",
    "created_at": "2012-06-21T08:32:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121911",
    "user": "@kini"
}
```

I mean that the code should be inspected and the appropriate exception class should be used in each case. Of course, this is not easy, considering that the autogenerated patch is more than 100 KB. But still, it should be done.



---

archive/issue_comments_121912.json:
```json
{
    "body": "I'm currently going though the auto-generated patch and fixing the obvious things by hand.  Note that the title of this ticket isn't \"totally fix all exceptions inside Sage\".\n\nThe main point is to not catch `KeyboardInterrupt` errors.",
    "created_at": "2012-06-21T08:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121912",
    "user": "@jdemeyer"
}
```

I'm currently going though the auto-generated patch and fixing the obvious things by hand.  Note that the title of this ticket isn't "totally fix all exceptions inside Sage".

The main point is to not catch `KeyboardInterrupt` errors.



---

archive/issue_comments_121913.json:
```json
{
    "body": "Replying to [comment:10 jdemeyer]:\n> The main point is to not catch `KeyboardInterrupt` errors.\n\nOther than some of the `RuntimeError`s, I think the patch is fine, if the objective was this.",
    "created_at": "2012-06-21T08:40:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121913",
    "user": "@ppurka"
}
```

Replying to [comment:10 jdemeyer]:
> The main point is to not catch `KeyboardInterrupt` errors.

Other than some of the `RuntimeError`s, I think the patch is fine, if the objective was this.



---

archive/issue_comments_121914.json:
```json
{
    "body": "Replying to [comment:10 jdemeyer]:\n> I'm currently going though the auto-generated patch and fixing the obvious things by hand.  Note that the title of this ticket isn't \"totally fix all exceptions inside Sage\".\n> \n> The main point is to not catch `KeyboardInterrupt` errors.\n\nWell, the title is a bit misleading I guess. Sure, it's not \"totally fix all exceptions inside Sage\", but it does seem like \"totally fix some exceptions inside Sage\" :)",
    "created_at": "2012-06-21T08:46:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121914",
    "user": "@kini"
}
```

Replying to [comment:10 jdemeyer]:
> I'm currently going though the auto-generated patch and fixing the obvious things by hand.  Note that the title of this ticket isn't "totally fix all exceptions inside Sage".
> 
> The main point is to not catch `KeyboardInterrupt` errors.

Well, the title is a bit misleading I guess. Sure, it's not "totally fix all exceptions inside Sage", but it does seem like "totally fix some exceptions inside Sage" :)



---

archive/issue_comments_121915.json:
```json
{
    "body": "Okay, I changed a lot of things by hand, needs_review.",
    "created_at": "2012-06-21T13:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121915",
    "user": "@jdemeyer"
}
```

Okay, I changed a lot of things by hand, needs_review.



---

archive/issue_comments_121916.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-06-21T13:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121916",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_121917.json:
```json
{
    "body": "Patchbot says trailing whitespace :P",
    "created_at": "2012-06-21T15:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121917",
    "user": "@kini"
}
```

Patchbot says trailing whitespace :P



---

archive/issue_comments_121918.json:
```json
{
    "body": "Hmm.. a lot of doctests are failing:\n\n```\nThe following tests failed:\n                           \n\tsage -t  --long -force_lib devel/sage/doc/en/thematic_tutorials/lie/weight_ring.rst # 2 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/rings/polynomial/pbori.pyx # 3 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/combinat/free_module.py # 3 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/combinat/posets/poset_examples.py # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/combinat/root_system/weyl_characters.py # 11 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/matrix/matrix_double_dense.pyx # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/modules/vector_double_dense.pyx # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/graphs/isgci.py # 2 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/graphs/generic_graph.py # 3 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/graphs/graph_decompositions/rankwidth.pyx # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/graphs/graph_generators.py # 2 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/interfaces/chomp.py # 3 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/interfaces/expect.py # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/interfaces/psage.py # Time out\n\tsage -t  --long -force_lib devel/sage/sage/homology/simplicial_complex_morphism.py # 8 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/homology/delta_complex.py # 5 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/homology/cell_complex.py # 5 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/homology/simplicial_complex_homset.py # 7 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/homology/simplicial_complex.py # 33 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/homology/examples.py # 8 doctests failed\n```\n",
    "created_at": "2012-06-22T04:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121918",
    "user": "@ppurka"
}
```

Hmm.. a lot of doctests are failing:

```
The following tests failed:
                           
	sage -t  --long -force_lib devel/sage/doc/en/thematic_tutorials/lie/weight_ring.rst # 2 doctests failed
	sage -t  --long -force_lib devel/sage/sage/rings/polynomial/pbori.pyx # 3 doctests failed
	sage -t  --long -force_lib devel/sage/sage/combinat/free_module.py # 3 doctests failed
	sage -t  --long -force_lib devel/sage/sage/combinat/posets/poset_examples.py # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/combinat/root_system/weyl_characters.py # 11 doctests failed
	sage -t  --long -force_lib devel/sage/sage/matrix/matrix_double_dense.pyx # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/modules/vector_double_dense.pyx # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/graphs/isgci.py # 2 doctests failed
	sage -t  --long -force_lib devel/sage/sage/graphs/generic_graph.py # 3 doctests failed
	sage -t  --long -force_lib devel/sage/sage/graphs/graph_decompositions/rankwidth.pyx # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/graphs/graph_generators.py # 2 doctests failed
	sage -t  --long -force_lib devel/sage/sage/interfaces/chomp.py # 3 doctests failed
	sage -t  --long -force_lib devel/sage/sage/interfaces/expect.py # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/interfaces/psage.py # Time out
	sage -t  --long -force_lib devel/sage/sage/homology/simplicial_complex_morphism.py # 8 doctests failed
	sage -t  --long -force_lib devel/sage/sage/homology/delta_complex.py # 5 doctests failed
	sage -t  --long -force_lib devel/sage/sage/homology/cell_complex.py # 5 doctests failed
	sage -t  --long -force_lib devel/sage/sage/homology/simplicial_complex_homset.py # 7 doctests failed
	sage -t  --long -force_lib devel/sage/sage/homology/simplicial_complex.py # 33 doctests failed
	sage -t  --long -force_lib devel/sage/sage/homology/examples.py # 8 doctests failed
```




---

archive/issue_comments_121919.json:
```json
{
    "body": "I think something changed in the patches between the last time I ran `make ptestlong` (I had to leave it running and go home) and the new patches uploaded 12h ago. At present, running the doctest on only these few files gives no errors.",
    "created_at": "2012-06-22T05:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121919",
    "user": "@ppurka"
}
```

I think something changed in the patches between the last time I ran `make ptestlong` (I had to leave it running and go home) and the new patches uploaded 12h ago. At present, running the doctest on only these few files gives no errors.



---

archive/issue_comments_121920.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-06-22T05:32:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121920",
    "user": "@kini"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_121921.json:
```json
{
    "body": "Patchbot says it's fine over the whole library. Looks good to me.",
    "created_at": "2012-06-22T05:32:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121921",
    "user": "@kini"
}
```

Patchbot says it's fine over the whole library. Looks good to me.



---

archive/issue_comments_121922.json:
```json
{
    "body": "Attachment [11310_auto.patch](tarball://root/attachments/some-uuid/ticket11310/11310_auto.patch) by @jdemeyer created at 2012-06-29 12:11:53",
    "created_at": "2012-06-29T12:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121922",
    "user": "@jdemeyer"
}
```

Attachment [11310_auto.patch](tarball://root/attachments/some-uuid/ticket11310/11310_auto.patch) by @jdemeyer created at 2012-06-29 12:11:53



---

archive/issue_comments_121923.json:
```json
{
    "body": "Rebased to #11143 (where one of the `except:` statements was removed).",
    "created_at": "2012-06-29T12:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121923",
    "user": "@jdemeyer"
}
```

Rebased to #11143 (where one of the `except:` statements was removed).



---

archive/issue_comments_121924.json:
```json
{
    "body": "Not really, I just *removed* a hunk to resolve the conflict.",
    "created_at": "2012-06-29T21:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121924",
    "user": "@jdemeyer"
}
```

Not really, I just *removed* a hunk to resolve the conflict.



---

archive/issue_comments_121925.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-06-30T18:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121925",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_121926.json:
```json
{
    "body": "Rediffed patch",
    "created_at": "2012-06-30T18:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121926",
    "user": "@vbraun"
}
```

Rediffed patch



---

archive/issue_comments_121927.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2012-06-30T18:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121927",
    "user": "@vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_121928.json:
```json
{
    "body": "Attachment [trac_11310.patch](tarball://root/attachments/some-uuid/ticket11310/trac_11310.patch) by @vbraun created at 2012-06-30 18:45:01\n\nThe new patch just fixes some fuzz 2 with #13109, back to positive review.",
    "created_at": "2012-06-30T18:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121928",
    "user": "@vbraun"
}
```

Attachment [trac_11310.patch](tarball://root/attachments/some-uuid/ticket11310/trac_11310.patch) by @vbraun created at 2012-06-30 18:45:01

The new patch just fixes some fuzz 2 with #13109, back to positive review.



---

archive/issue_comments_121929.json:
```json
{
    "body": "Additional patch",
    "created_at": "2012-08-02T12:57:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121929",
    "user": "@jdemeyer"
}
```

Additional patch



---

archive/issue_comments_121930.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-08-02T12:58:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121930",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_121931.json:
```json
{
    "body": "Attachment [11310_psage.patch](tarball://root/attachments/some-uuid/ticket11310/11310_psage.patch) by @jdemeyer created at 2012-08-02 12:58:25\n\nAdditional patch [attachment:11310_psage.patch] needs review (there were sporadic doctest failures in `psage.py`).",
    "created_at": "2012-08-02T12:58:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121931",
    "user": "@jdemeyer"
}
```

Attachment [11310_psage.patch](tarball://root/attachments/some-uuid/ticket11310/11310_psage.patch) by @jdemeyer created at 2012-08-02 12:58:25

Additional patch [attachment:11310_psage.patch] needs review (there were sporadic doctest failures in `psage.py`).



---

archive/issue_comments_121932.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-08-02T12:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121932",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_121933.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-08-02T13:05:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121933",
    "user": "@vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_121934.json:
```json
{
    "body": "Looks good! \n\nIn a perfect world `ExceptionPexpect` would derive from `StandardError` and not the raw exceptions, but oh well.",
    "created_at": "2012-08-02T13:05:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121934",
    "user": "@vbraun"
}
```

Looks good! 

In a perfect world `ExceptionPexpect` would derive from `StandardError` and not the raw exceptions, but oh well.



---

archive/issue_comments_121935.json:
```json
{
    "body": "psage is a weird beast. I have seen doctest errors in psage which change from version to version. I couldn't explain it, nor do I know the fix. See #12061.",
    "created_at": "2012-08-02T13:13:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121935",
    "user": "@ppurka"
}
```

psage is a weird beast. I have seen doctest errors in psage which change from version to version. I couldn't explain it, nor do I know the fix. See #12061.



---

archive/issue_comments_121936.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-08-12T18:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121936",
    "user": "@jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_121937.json:
```json
{
    "body": "This causes issues with Python 3. See #15620.",
    "created_at": "2014-01-02T15:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11138#issuecomment-121937",
    "user": "@ohanar"
}
```

This causes issues with Python 3. See #15620.
