# Issue 11138: Get rid of some bare "except:" statements

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2011-05-07 10:10:30

Assignee: jason

CC:  kini




---

Comment by ppurka created at 2012-05-15 09:08:58

What's the problem with this ticket? I think it is a small enough change that it can be at least set for review.


---

Comment by kini created at 2012-05-16 05:22:50

Tests pass on 5.0. Jeroen, is this ready for review, or do you want to add more stuff?


---

Comment by jdemeyer created at 2012-05-16 07:21:57

I would like to fix the following from `devel/sage/sage/structure/parent.pyx`, starting at line 2577:

```
        try:
            return super(Parent, self)._an_element_()
        except EmptySetError:
            raise
        except:
            _record_exception()
            pass

        try:
            return self.gen(0)
        except:
            _record_exception()
            pass

        try:
            return self.gen()
        except:
            _record_exception()
            pass
```



---

Comment by kini created at 2012-06-21 08:08:51

Changing these bare except statements to `except StandardError` seems like not enough, don't you think? Except statements should always be written to accept the narrowest possible expected exception class only.


---

Comment by ppurka created at 2012-06-21 08:26:20

Replying to [comment:7 kini]:
> Changing these bare except statements to `except StandardError` seems like not enough, don't you think? Except statements should always be written to accept the narrowest possible expected exception class only.

Then what should it be? According to the [hierarchy of exceptions](http://docs.python.org/library/exceptions.html#exception-hierarchy) I think `StandardError` encapsulates most of what can go wrong. It is at least better than a blank `except:`.

About the `RuntimeError`s I think some of them should be `ValueError` and I spotted one which should be an `AttributeError`.


---

Comment by kini created at 2012-06-21 08:32:50

I mean that the code should be inspected and the appropriate exception class should be used in each case. Of course, this is not easy, considering that the autogenerated patch is more than 100 KB. But still, it should be done.


---

Comment by jdemeyer created at 2012-06-21 08:34:37

I'm currently going though the auto-generated patch and fixing the obvious things by hand.  Note that the title of this ticket isn't "totally fix all exceptions inside Sage".

The main point is to not catch `KeyboardInterrupt` errors.


---

Comment by ppurka created at 2012-06-21 08:40:00

Replying to [comment:10 jdemeyer]:
> The main point is to not catch `KeyboardInterrupt` errors.

Other than some of the `RuntimeError`s, I think the patch is fine, if the objective was this.


---

Comment by kini created at 2012-06-21 08:46:55

Replying to [comment:10 jdemeyer]:
> I'm currently going though the auto-generated patch and fixing the obvious things by hand.  Note that the title of this ticket isn't "totally fix all exceptions inside Sage".
> 
> The main point is to not catch `KeyboardInterrupt` errors.

Well, the title is a bit misleading I guess. Sure, it's not "totally fix all exceptions inside Sage", but it does seem like "totally fix some exceptions inside Sage" :)


---

Comment by jdemeyer created at 2012-06-21 13:56:07

Okay, I changed a lot of things by hand, needs_review.


---

Comment by jdemeyer created at 2012-06-21 13:56:07

Changing status from new to needs_review.


---

Comment by kini created at 2012-06-21 15:51:14

Patchbot says trailing whitespace :P


---

Comment by ppurka created at 2012-06-22 04:18:11

Hmm.. a lot of doctests are failing:

```
The following tests failed:
                           
	sage -t  --long -force_lib devel/sage/doc/en/thematic_tutorials/lie/weight_ring.rst # 2 doctests failed
	sage -t  --long -force_lib devel/sage/sage/rings/polynomial/pbori.pyx # 3 doctests failed
	sage -t  --long -force_lib devel/sage/sage/combinat/free_module.py # 3 doctests failed
	sage -t  --long -force_lib devel/sage/sage/combinat/posets/poset_examples.py # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/combinat/root_system/weyl_characters.py # 11 doctests failed
	sage -t  --long -force_lib devel/sage/sage/matrix/matrix_double_dense.pyx # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/modules/vector_double_dense.pyx # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/graphs/isgci.py # 2 doctests failed
	sage -t  --long -force_lib devel/sage/sage/graphs/generic_graph.py # 3 doctests failed
	sage -t  --long -force_lib devel/sage/sage/graphs/graph_decompositions/rankwidth.pyx # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/graphs/graph_generators.py # 2 doctests failed
	sage -t  --long -force_lib devel/sage/sage/interfaces/chomp.py # 3 doctests failed
	sage -t  --long -force_lib devel/sage/sage/interfaces/expect.py # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/interfaces/psage.py # Time out
	sage -t  --long -force_lib devel/sage/sage/homology/simplicial_complex_morphism.py # 8 doctests failed
	sage -t  --long -force_lib devel/sage/sage/homology/delta_complex.py # 5 doctests failed
	sage -t  --long -force_lib devel/sage/sage/homology/cell_complex.py # 5 doctests failed
	sage -t  --long -force_lib devel/sage/sage/homology/simplicial_complex_homset.py # 7 doctests failed
	sage -t  --long -force_lib devel/sage/sage/homology/simplicial_complex.py # 33 doctests failed
	sage -t  --long -force_lib devel/sage/sage/homology/examples.py # 8 doctests failed
```



---

Comment by ppurka created at 2012-06-22 05:30:35

I think something changed in the patches between the last time I ran `make ptestlong` (I had to leave it running and go home) and the new patches uploaded 12h ago. At present, running the doctest on only these few files gives no errors.


---

Comment by kini created at 2012-06-22 05:32:59

Changing status from needs_review to positive_review.


---

Comment by kini created at 2012-06-22 05:32:59

Patchbot says it's fine over the whole library. Looks good to me.


---

Attachment


---

Comment by jdemeyer created at 2012-06-29 12:12:33

Rebased to #11143 (where one of the `except:` statements was removed).


---

Comment by jdemeyer created at 2012-06-29 21:13:39

Not really, I just _removed_ a hunk to resolve the conflict.


---

Comment by vbraun created at 2012-06-30 18:41:15

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2012-06-30 18:44:10

Rediffed patch


---

Comment by vbraun created at 2012-06-30 18:45:01

Changing status from needs_work to positive_review.


---

Attachment

The new patch just fixes some fuzz 2 with #13109, back to positive review.


---

Comment by jdemeyer created at 2012-08-02 12:57:18

Additional patch


---

Comment by jdemeyer created at 2012-08-02 12:58:25

Changing status from positive_review to needs_work.


---

Attachment

Additional patch [attachment:11310_psage.patch] needs review (there were sporadic doctest failures in `psage.py`).


---

Comment by jdemeyer created at 2012-08-02 12:58:30

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2012-08-02 13:05:10

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2012-08-02 13:05:10

Looks good! 

In a perfect world `ExceptionPexpect` would derive from `StandardError` and not the raw exceptions, but oh well.


---

Comment by ppurka created at 2012-08-02 13:13:09

psage is a weird beast. I have seen doctest errors in psage which change from version to version. I couldn't explain it, nor do I know the fix. See #12061.


---

Comment by jdemeyer created at 2012-08-12 18:58:35

Resolution: fixed


---

Comment by ohanar created at 2014-01-02 15:58:42

This causes issues with Python 3. See #15620.
