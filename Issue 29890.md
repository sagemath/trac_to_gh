# Issue 29890: cygwin-minimal: pip-20.1.1 fails to install

Issue created by migration from https://trac.sagemath.org/ticket/30127

Original creator: mkoeppe

Original creation time: 2020-07-12 21:40:23

CC:  embray slelievre dimpase

https://github.com/sagemath/sage/runs/862451271

```
  [pip-20.1.1]     File "/cygdrive/d/a/sage/sage/local/var/tmp/sage/build/pip-20.1.1/src/src/pip/_vendor/urllib3/__init__.py", line 7, in <module>
  [pip-20.1.1]       from .connectionpool import HTTPConnectionPool, HTTPSConnectionPool, connection_from_url
  [pip-20.1.1]     File "/cygdrive/d/a/sage/sage/local/var/tmp/sage/build/pip-20.1.1/src/src/pip/_vendor/urllib3/connectionpool.py", line 29, in <module>
  [pip-20.1.1]       from .connection import (
  [pip-20.1.1]     File "/cygdrive/d/a/sage/sage/local/var/tmp/sage/build/pip-20.1.1/src/src/pip/_vendor/urllib3/connection.py", line 68, in <module>
  [pip-20.1.1]       class HTTPConnection(_HTTPConnection, object):
  [pip-20.1.1]     File "/cygdrive/d/a/sage/sage/local/var/tmp/sage/build/pip-20.1.1/src/src/pip/_vendor/urllib3/connection.py", line 96, in HTTPConnection
  [pip-20.1.1]       default_socket_options = [(socket.IPPROTO_TCP, socket.TCP_NODELAY, 1)]
  [pip-20.1.1]   AttributeError: module 'socket' has no attribute 'TCP_NODELAY'
```


The install on `cygwin-standard` works fine.



---

Comment by slelievre created at 2020-08-01 03:32:31

Note that pip 20.2 was released.


---

Comment by mkoeppe created at 2020-08-07 17:12:59

Let's try with the following updates:

- https://pypi.org/project/pip/ 20.2.1 update (https://pip.pypa.io/en/stable/news/)

- https://pypi.org/project/setuptools/ 49.2.1


---

Comment by mkoeppe created at 2020-08-07 17:19:06

Tests at https://github.com/mkoeppe/sage/actions/runs/199487278


---

Comment by mkoeppe created at 2020-08-07 17:19:24

New commits:


---

Comment by mkoeppe created at 2020-08-07 20:29:09

Same with pip 20.2.1 - https://github.com/mkoeppe/sage/runs/959258905


---

Comment by mkoeppe created at 2020-08-07 20:31:32

Should probably look at the `python3` build log on this system.


---

Comment by mkoeppe created at 2020-08-07 20:35:22

The same error also with pip 20.1.1 and python3 3.8.5 from #27754.


---

Comment by mkoeppe created at 2020-08-07 20:51:37

Apparently caused by a recent change in the Cygwin headers: https://bugs.python.org/issue41374


---

Comment by git created at 2020-08-07 20:59:51

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2020-08-07 21:03:47

Tests at https://github.com/mkoeppe/sage/actions/runs/199703638


---

Comment by mkoeppe created at 2020-08-07 21:08:47

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-08-08 18:59:56

This worked, as can be seen in https://github.com/mkoeppe/sage/runs/959927471

Needs review


---

Comment by mkoeppe created at 2020-08-13 22:13:59

Let's get this in please


---

Comment by dimpase created at 2020-08-14 11:07:47

lgtm


---

Comment by dimpase created at 2020-08-14 11:07:47

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-08-14 11:38:27

Thanks!


---

Comment by vbraun created at 2020-08-15 09:41:55

Resolution: fixed
