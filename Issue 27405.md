# Issue 27405: Re-run configure+make after installing an SPKG with sage -i

archive/issues_027405.json:
```json
{
    "body": "CC:  @dimpase\n\nThis is an idea for fixing #27373.\n\nAs explained in [comment:73:ticket:27373 comment#73] on that ticket, after installing a new package it is really necessary to re-run `configure` after installing a new package, whether it was an optional package that was not previously installed, or a standard package that was not previously installed (due to a configure-time check determining that it was not needed).\n\nThis is to ensure that files generated by `configure` reflect the new system configuration, in terms of what SPKGs are installed.\n\nFurther, it is advisable to re-run `make all-build` in case the `sage -i` installed packages whose dependents need to be rebuilt.\n\nThis also needs to ensure that if an SPKG is installed for some standard package, that we account for that when re-running `configure`: It must not try again to check the system for that dependency, and just reflect that the SPKG is installed.  For example, from #27373, if Sage is first built using GMP/MPIR from the system, then we run `sage -i mpir`, the system configuration must be updated to reflect that we are now using the mpir SPKG instead of GMP/MPIR from the system.  It's also necessary to rebuilt any of its dependent packages.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27642\n\n",
    "created_at": "2019-04-11T10:49:22Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Re-run configure+make after installing an SPKG with sage -i",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27405",
    "user": "https://github.com/embray"
}
```
CC:  @dimpase

This is an idea for fixing #27373.

As explained in [comment:73:ticket:27373 comment#73] on that ticket, after installing a new package it is really necessary to re-run `configure` after installing a new package, whether it was an optional package that was not previously installed, or a standard package that was not previously installed (due to a configure-time check determining that it was not needed).

This is to ensure that files generated by `configure` reflect the new system configuration, in terms of what SPKGs are installed.

Further, it is advisable to re-run `make all-build` in case the `sage -i` installed packages whose dependents need to be rebuilt.

This also needs to ensure that if an SPKG is installed for some standard package, that we account for that when re-running `configure`: It must not try again to check the system for that dependency, and just reflect that the SPKG is installed.  For example, from #27373, if Sage is first built using GMP/MPIR from the system, then we run `sage -i mpir`, the system configuration must be updated to reflect that we are now using the mpir SPKG instead of GMP/MPIR from the system.  It's also necessary to rebuilt any of its dependent packages.

Issue created by migration from https://trac.sagemath.org/ticket/27642





---

archive/issue_comments_385953.json:
```json
{
    "body": "This branch mostly fixes the bug in #27373 for me.\n\nAs noted in the commit message this does not yet preserve arguments previously passed to `configure`.  I think we can fix that by running `./config.status --config` but I need to test that a bit more.\n\n---\nLast 10 new commits:",
    "created_at": "2019-04-11T10:56:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385953",
    "user": "https://github.com/embray"
}
```

This branch mostly fixes the bug in #27373 for me.

As noted in the commit message this does not yet preserve arguments previously passed to `configure`.  I think we can fix that by running `./config.status --config` but I need to test that a bit more.

---
Last 10 new commits:



---

archive/issue_comments_385954.json:
```json
{
    "body": "could you rebase it?",
    "created_at": "2019-04-24T13:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385954",
    "user": "https://github.com/dimpase"
}
```

could you rebase it?



---

archive/issue_comments_385955.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-05-03T14:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385955",
    "user": "https://github.com/dimpase"
}
```

New commits:



---

archive/issue_comments_385956.json:
```json
{
    "body": "Trying this with `./configure` leaves gmp not marked as an not to be installed, while mpir is marked as not to be installed. (to be fixed on #27641).",
    "created_at": "2019-05-03T14:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385956",
    "user": "https://github.com/dimpase"
}
```

Trying this with `./configure` leaves gmp not marked as an not to be installed, while mpir is marked as not to be installed. (to be fixed on #27641).



---

archive/issue_comments_385957.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-03T14:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385957",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_385958.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-05-03T17:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385958",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_385959.json:
```json
{
    "body": "rebased over updated  #27641",
    "created_at": "2019-05-03T17:14:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385959",
    "user": "https://github.com/dimpase"
}
```

rebased over updated  #27641



---

archive/issue_comments_385960.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-05-03T17:20:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385960",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_385961.json:
```json
{
    "body": "now this branch leaves gmp not marked as an not to be installed, while mpir is marked as not to be installed, despite being fixed on #27641...",
    "created_at": "2019-05-03T17:20:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385961",
    "user": "https://github.com/dimpase"
}
```

now this branch leaves gmp not marked as an not to be installed, while mpir is marked as not to be installed, despite being fixed on #27641...



---

archive/issue_comments_385962.json:
```json
{
    "body": "Your rebasing did not apparently include the fixes I made to #27641 (compare gmp/spkg-configure.m4)",
    "created_at": "2019-05-06T16:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385962",
    "user": "https://github.com/embray"
}
```

Your rebasing did not apparently include the fixes I made to #27641 (compare gmp/spkg-configure.m4)



---

archive/issue_comments_385963.json:
```json
{
    "body": "`gmp/spkg-configure.m4` was not touched on #27641, have a look at `git show 1c24df1`.\n`",
    "created_at": "2019-05-06T17:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385963",
    "user": "https://github.com/dimpase"
}
```

`gmp/spkg-configure.m4` was not touched on #27641, have a look at `git show 1c24df1`.
`



---

archive/issue_comments_385964.json:
```json
{
    "body": "More precisely, you overwrote this change in #27641#comment:15",
    "created_at": "2019-05-06T17:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385964",
    "user": "https://github.com/dimpase"
}
```

More precisely, you overwrote this change in #27641#comment:15



---

archive/issue_comments_385965.json:
```json
{
    "body": "Right. That was intentional.  It should *not* be changed.",
    "created_at": "2019-05-07T16:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385965",
    "user": "https://github.com/embray"
}
```

Right. That was intentional.  It should *not* be changed.



---

archive/issue_comments_385966.json:
```json
{
    "body": "Replying to [comment:11 embray]:\n> Right. That was intentional.  It should *not* be changed.\n\n\nShould I re-create the un-rebased branch and try again, or it's simply removing the changes to `gmp/spkg-configure.m4` that would do?",
    "created_at": "2019-05-07T16:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385966",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:11 embray]:
> Right. That was intentional.  It should *not* be changed.


Should I re-create the un-rebased branch and try again, or it's simply removing the changes to `gmp/spkg-configure.m4` that would do?



---

archive/issue_comments_385967.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-08T10:07:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385967",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385968.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2019-05-08T10:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385968",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_385969.json:
```json
{
    "body": "This is a bit of a mess.  I just need to rebase on top of the final version of #27641, not add spurious new commits.",
    "created_at": "2019-05-10T11:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385969",
    "user": "https://github.com/embray"
}
```

This is a bit of a mess.  I just need to rebase on top of the final version of #27641, not add spurious new commits.



---

archive/issue_comments_385970.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-05-10T11:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385970",
    "user": "https://github.com/embray"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_385971.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-05-10T11:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385971",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_385972.json:
```json
{
    "body": "Updated to the final version of #27641.  Still need to kick around a bit with making sure it can preserve previous configure flags.",
    "created_at": "2019-05-10T11:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385972",
    "user": "https://github.com/embray"
}
```

Updated to the final version of #27641.  Still need to kick around a bit with making sure it can preserve previous configure flags.



---

archive/issue_events_068600.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-05-12T21:31:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27405#event-68600"
}
```



---

archive/issue_comments_385973.json:
```json
{
    "body": "Too late, a previous version of this branch was released in 8.8.beta5",
    "created_at": "2019-05-12T21:31:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385973",
    "user": "https://github.com/vbraun"
}
```

Too late, a previous version of this branch was released in 8.8.beta5



---

archive/issue_comments_385974.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-05-12T21:31:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385974",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_385975.json:
```json
{
    "body": "I am afraid it has to be reverted. It's not good as it is now.",
    "created_at": "2019-05-12T21:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385975",
    "user": "https://github.com/dimpase"
}
```

I am afraid it has to be reverted. It's not good as it is now.



---

archive/issue_comments_385976.json:
```json
{
    "body": "See #27820",
    "created_at": "2019-05-13T09:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385976",
    "user": "https://github.com/dimpase"
}
```

See #27820



---

archive/issue_comments_385977.json:
```json
{
    "body": "I'm confused.  How was it merged?  It was not set to positive review, and you never replaced the branch with the merge commit as in your usual process?",
    "created_at": "2019-05-13T09:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385977",
    "user": "https://github.com/embray"
}
```

I'm confused.  How was it merged?  It was not set to positive review, and you never replaced the branch with the merge commit as in your usual process?



---

archive/issue_comments_385978.json:
```json
{
    "body": "Replying to [comment:21 embray]:\n> I'm confused.  How was it merged?  It was not set to positive review,\n\n\nit was, see comment:14 \n\nI gather it wasn't merged in the usual way as it didn't come with a (formally) needed configure bump",
    "created_at": "2019-05-13T10:01:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385978",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:21 embray]:
> I'm confused.  How was it merged?  It was not set to positive review,


it was, see comment:14 

I gather it wasn't merged in the usual way as it didn't come with a (formally) needed configure bump



---

archive/issue_comments_385979.json:
```json
{
    "body": "I can confirm that this branch is merged in 8.8.rc0.\nSo this is done and dusted.",
    "created_at": "2019-06-11T10:46:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27405#issuecomment-385979",
    "user": "https://github.com/dimpase"
}
```

I can confirm that this branch is merged in 8.8.rc0.
So this is done and dusted.
