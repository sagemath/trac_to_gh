# Issue 30181: Missing PDF icons in the Sage documentation website

archive/issues_030181.json:
```json
{
    "body": "CC:  jhpalmieri\n\nIn `local/share/doc/sage/html/en/index.html`, there are supposed to be PDF icons next to each document, as links leading to the PDF builds. Those are missing, because the file `_static/pdf.png` is missing. For some reason, it is not copied from `src/doc/en/website/static` to `local/share/doc/sage/html/en/_static`.\n\nTo see the problem, check that:\n\nRunning `make doc-clean; sage --docbuild all html` does not install the PDF icon to the right place, that is under `local/share/doc/sage/html/en/website/_static`.\n\nBut running `make doc-clean; sage --docbuild website html` does install the PDF icon to the right place.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30418\n\n",
    "created_at": "2020-08-22T00:46:20Z",
    "labels": [
        "documentation",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Missing PDF icons in the Sage documentation website",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30181",
    "user": "klee"
}
```
CC:  jhpalmieri

In `local/share/doc/sage/html/en/index.html`, there are supposed to be PDF icons next to each document, as links leading to the PDF builds. Those are missing, because the file `_static/pdf.png` is missing. For some reason, it is not copied from `src/doc/en/website/static` to `local/share/doc/sage/html/en/_static`.

To see the problem, check that:

Running `make doc-clean; sage --docbuild all html` does not install the PDF icon to the right place, that is under `local/share/doc/sage/html/en/website/_static`.

But running `make doc-clean; sage --docbuild website html` does install the PDF icon to the right place.

Issue created by migration from https://trac.sagemath.org/ticket/30418





---

archive/issue_comments_430171.json:
```json
{
    "body": "This change works:\n\n```diff\ndiff --git a/src/sage_setup/docbuild/__init__.py b/src/sage_setup/docbuild/__init__.py\nindex 0841f429e7..9c2e6ed4e2 100644\n--- a/src/sage_setup/docbuild/__init__.py\n+++ b/src/sage_setup/docbuild/__init__.py\n@@ -580,9 +580,6 @@ class ReferenceBuilder(AllBuilder):\n             # of the PDF file.  So we create an html file, based on\n             # the file index.html from the \"website\" target.\n             if format == 'pdf':\n-                # First build the website page. This only takes a few seconds.\n-                getattr(get_builder('website'), 'html')()\n-\n                 website_dir = os.path.join(SAGE_DOC, 'html', 'en', 'website')\n                 output_dir = self._output_dir(format, lang)\n \n@@ -1726,5 +1723,8 @@ def main():\n     # Set up Intersphinx cache\n     C = IntersphinxCache()\n \n+    if type == 'pdf':\n+        # First build the website page. This only takes a few seconds.\n+        getattr(get_builder('website'), 'html')()\n     builder = getattr(get_builder(name), type)\n     builder()\n```\n\nThis moves the test to the top-level `main`. We could certainly test for more than `if type == 'pdf`, for example also `name == 'all' or name == 'reference'`. Or maybe it's just a good idea to always build the website html page and get the pdf icon there.",
    "created_at": "2020-09-05T23:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30181#issuecomment-430171",
    "user": "jhpalmieri"
}
```

This change works:

```diff
diff --git a/src/sage_setup/docbuild/__init__.py b/src/sage_setup/docbuild/__init__.py
index 0841f429e7..9c2e6ed4e2 100644
--- a/src/sage_setup/docbuild/__init__.py
+++ b/src/sage_setup/docbuild/__init__.py
@@ -580,9 +580,6 @@ class ReferenceBuilder(AllBuilder):
             # of the PDF file.  So we create an html file, based on
             # the file index.html from the "website" target.
             if format == 'pdf':
-                # First build the website page. This only takes a few seconds.
-                getattr(get_builder('website'), 'html')()
-
                 website_dir = os.path.join(SAGE_DOC, 'html', 'en', 'website')
                 output_dir = self._output_dir(format, lang)
 
@@ -1726,5 +1723,8 @@ def main():
     # Set up Intersphinx cache
     C = IntersphinxCache()
 
+    if type == 'pdf':
+        # First build the website page. This only takes a few seconds.
+        getattr(get_builder('website'), 'html')()
     builder = getattr(get_builder(name), type)
     builder()
```

This moves the test to the top-level `main`. We could certainly test for more than `if type == 'pdf`, for example also `name == 'all' or name == 'reference'`. Or maybe it's just a good idea to always build the website html page and get the pdf icon there.



---

archive/issue_comments_430172.json:
```json
{
    "body": "Replying to [comment:3 jhpalmieri]:\n\nThe code in lines 583--585 has nothing to do with the current issue. It should not be removed.\n\nYour code in lines 1726--1728 is effectively the same with running `sage --docbuild website html`. This just covers the issue.\n\nThe issue of this ticket is to see why `sage --docbuild all html` does not install the pdf icon. The pdf icon is not installed because the website builder does not copy its static files folder. I checked this problem is also with the developer manual builder.",
    "created_at": "2020-09-07T08:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30181#issuecomment-430172",
    "user": "klee"
}
```

Replying to [comment:3 jhpalmieri]:

The code in lines 583--585 has nothing to do with the current issue. It should not be removed.

Your code in lines 1726--1728 is effectively the same with running `sage --docbuild website html`. This just covers the issue.

The issue of this ticket is to see why `sage --docbuild all html` does not install the pdf icon. The pdf icon is not installed because the website builder does not copy its static files folder. I checked this problem is also with the developer manual builder.



---

archive/issue_comments_430173.json:
```json
{
    "body": "Replying to [comment:4 klee]:\n> Replying to [comment:3 jhpalmieri]:\n> \n> The code in lines 583--585 has nothing to do with the current issue.\n\nI think that code is intended to build the basic website framework for the PDF documentation. It appears to matter when `getattr(get_builder('website'), 'html')()` is executed, as far as installing the appropriate static files. Can you explain why?\n\n> It should not be removed.\n\nOf course I didn't remove it, I moved it.\n\n> Your code in lines 1726--1728 is effectively the same with running `sage --docbuild website html`. This just covers the issue.\n\nI know that. The question is why it works and why running `getattr(get_builder('website'), 'html')()` at a different stage does not.\n\n> The issue of this ticket is to see why `sage --docbuild all html` does not install the pdf icon.\n\nI disagree: you don't want the PDF icon if you haven't built the PDF documentation. So `sage --docbuild all html` should ideally not install the PDF icon.\n\n> The pdf icon is not installed because the website builder does not copy its static files folder. I checked this problem is also with the developer manual builder.",
    "created_at": "2020-09-07T16:37:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30181#issuecomment-430173",
    "user": "jhpalmieri"
}
```

Replying to [comment:4 klee]:
> Replying to [comment:3 jhpalmieri]:
> 
> The code in lines 583--585 has nothing to do with the current issue.

I think that code is intended to build the basic website framework for the PDF documentation. It appears to matter when `getattr(get_builder('website'), 'html')()` is executed, as far as installing the appropriate static files. Can you explain why?

> It should not be removed.

Of course I didn't remove it, I moved it.

> Your code in lines 1726--1728 is effectively the same with running `sage --docbuild website html`. This just covers the issue.

I know that. The question is why it works and why running `getattr(get_builder('website'), 'html')()` at a different stage does not.

> The issue of this ticket is to see why `sage --docbuild all html` does not install the pdf icon.

I disagree: you don't want the PDF icon if you haven't built the PDF documentation. So `sage --docbuild all html` should ideally not install the PDF icon.

> The pdf icon is not installed because the website builder does not copy its static files folder. I checked this problem is also with the developer manual builder.



---

archive/issue_comments_430174.json:
```json
{
    "body": "Replying to [comment:5 jhpalmieri]:\n> Replying to [comment:4 klee]:\n> > Replying to [comment:3 jhpalmieri]:\n> > \n> > The code in lines 583--585 has nothing to do with the current issue.\n> \n> I think that code is intended to build the basic website framework for the PDF documentation. It appears to matter when `getattr(get_builder('website'), 'html')()` is executed, as far as installing the appropriate static files. Can you explain why?\n\nThe main purpose of the code is to provide the htmls for the basic website framework. The other code following it assumes that the htmls are in place. If you remove the code from the place where it is, the assumption is broken. \n\n> > Your code in lines 1726--1728 is effectively the same with running `sage --docbuild website html`. This just covers the issue.\n> \n> I know that. The question is why it works and why running `getattr(get_builder('website'), 'html')()` at a different stage does not.\n\nThe question must be solved before we think of any cure.\n\n> > The issue of this ticket is to see why `sage --docbuild all html` does not install the pdf icon.\n> \n> I disagree: you don't want the PDF icon if you haven't built the PDF documentation. So `sage --docbuild all html` should ideally not install the PDF icon.\n\nThe PDF icon problem is just a consequence of the bigger problem of `sage --docbuild all html` not copying the static files (of `website` and `developer` documentations.)",
    "created_at": "2020-09-07T19:28:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30181#issuecomment-430174",
    "user": "klee"
}
```

Replying to [comment:5 jhpalmieri]:
> Replying to [comment:4 klee]:
> > Replying to [comment:3 jhpalmieri]:
> > 
> > The code in lines 583--585 has nothing to do with the current issue.
> 
> I think that code is intended to build the basic website framework for the PDF documentation. It appears to matter when `getattr(get_builder('website'), 'html')()` is executed, as far as installing the appropriate static files. Can you explain why?

The main purpose of the code is to provide the htmls for the basic website framework. The other code following it assumes that the htmls are in place. If you remove the code from the place where it is, the assumption is broken. 

> > Your code in lines 1726--1728 is effectively the same with running `sage --docbuild website html`. This just covers the issue.
> 
> I know that. The question is why it works and why running `getattr(get_builder('website'), 'html')()` at a different stage does not.

The question must be solved before we think of any cure.

> > The issue of this ticket is to see why `sage --docbuild all html` does not install the pdf icon.
> 
> I disagree: you don't want the PDF icon if you haven't built the PDF documentation. So `sage --docbuild all html` should ideally not install the PDF icon.

The PDF icon problem is just a consequence of the bigger problem of `sage --docbuild all html` not copying the static files (of `website` and `developer` documentations.)



---

archive/issue_comments_430175.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-12T03:01:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30181#issuecomment-430175",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430176.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-12T03:01:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30181#issuecomment-430176",
    "user": "klee"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_430177.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-13T04:52:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30181#issuecomment-430177",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430178.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-09-13T05:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30181#issuecomment-430178",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_430179.json:
```json
{
    "body": "It would be nice for this ticket to get reviewed for sage 9.2.",
    "created_at": "2020-09-29T02:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30181#issuecomment-430179",
    "user": "klee"
}
```

It would be nice for this ticket to get reviewed for sage 9.2.



---

archive/issue_comments_430180.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-29T21:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30181#issuecomment-430180",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_430181.json:
```json
{
    "body": "Looks okay to me.",
    "created_at": "2020-09-29T21:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30181#issuecomment-430181",
    "user": "jhpalmieri"
}
```

Looks okay to me.



---

archive/issue_comments_430182.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-11-07T16:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30181#issuecomment-430182",
    "user": "vbraun"
}
```

Resolution: fixed
