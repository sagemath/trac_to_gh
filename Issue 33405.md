# Issue 33405: Update build/pkgs/matplotlib/install-requires.txt

Issue created by migration from https://trac.sagemath.org/ticket/33642

Original creator: mkoeppe

Original creation time: 2022-04-04 19:18:27

CC:  davidlowry @tobiasdiez @mwageringel tscrim dimpase isuruf




---

Comment by mkoeppe created at 2022-04-04 20:03:56

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-04-04 20:03:56

New commits:


---

Comment by git created at 2022-04-04 20:37:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2022-04-05 17:38:45

The conda distribution file probably needs to be changed as well. However, requiring `matplotlib >=3.5.1` with python < 3.10 doesn't seem to work with conda, or at least in my initial tests the python version always got upgraded as well (might be easy to fix, but I don't have the time right now to look closer at this).


---

Comment by mkoeppe created at 2022-04-05 17:59:02

For now with conda, the updated install-requires will ensure that the upgraded package is installed with pip until conda packaging is updated


---

Comment by mkoeppe created at 2022-04-06 17:39:16

Let's get this in please.


---

Comment by dimpase created at 2022-04-06 22:54:03

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2022-04-06 22:54:03

lgtm - just a version bump


---

Comment by mkoeppe created at 2022-04-06 23:05:42

Thanks!


---

Comment by @tobiasdiez created at 2022-04-07 15:33:18

Changing status from positive_review to needs_work.


---

Comment by @tobiasdiez created at 2022-04-07 15:33:18

This is not really fixing the version conda picks. Conda still uses v3.3.2 on linux, see https://github.com/sagemath/sagetrac-mirror/runs/5871183030?check_suite_focus=true

So there should at least be a proper version requirement for conda, so that the environment file correctly setups up the conda environment.


---

Comment by mkoeppe created at 2022-04-07 18:10:24

Didn't you say in comment:6 that setting the version with conda does not work with python 3.10?


---

Comment by mkoeppe created at 2022-04-07 18:15:33

In the log of this run, pip correctly upgrades matplotlib:

```
2022-04-07T15:34:47.1650744Z   Attempting uninstall: matplotlib
2022-04-07T15:34:47.1663600Z     Found existing installation: matplotlib 3.3.2
2022-04-07T15:34:47.2697535Z     Uninstalling matplotlib-3.3.2:
...
2022-04-07T15:34:47.4717483Z       Successfully uninstalled matplotlib-3.3.2
2022-04-07T15:34:48.6427961Z 
...
2022-04-07T15:56:41.3898229Z     Installed /home/runner/work/sagetrac-mirror/sagetrac-mirror/src
2022-04-07T15:56:42.1172970Z Successfully installed fonttools-4.31.2 iniconfig-1.1.1 matplotlib-3.5.1 ptyprocess-0.5.1 pytest-7.1.1 rpy2-3.3.6 sagemath-standard-9.6b7 sphinx-4.4.0
```



---

Comment by mkoeppe created at 2022-04-07 18:15:33

Changing status from needs_work to positive_review.


---

Comment by isuruf created at 2022-04-07 18:20:39

Can you give some small reproducer for this? When I install sage=9.5 conda package I always get matplotlib 3.5.1 regardless of the python version


---

Comment by isuruf created at 2022-04-07 18:27:25

Nvm, I can reproduce


---

Comment by isuruf created at 2022-04-07 18:34:48

Not sure exactly why this happens.
A workaround is to have `matplotlib>=3.5.1` in `build/pkgs/matploitlib/distros/conda.txt`


---

Comment by @tobiasdiez created at 2022-04-07 20:01:03

Replying to [comment:13 mkoeppe]:
> In the log of this run, pip correctly upgrades matplotlib:
> {{{
> 2022-04-07T15:34:47.1650744Z   Attempting uninstall: matplotlib
> 2022-04-07T15:34:47.1663600Z     Found existing installation: matplotlib 3.3.2
> 2022-04-07T15:34:47.2697535Z     Uninstalling matplotlib-3.3.2:
> ...
> 2022-04-07T15:34:47.4717483Z       Successfully uninstalled matplotlib-3.3.2
> 2022-04-07T15:34:48.6427961Z 
> ...
> 2022-04-07T15:56:41.3898229Z     Installed /home/runner/work/sagetrac-mirror/sagetrac-mirror/src
> 2022-04-07T15:56:42.1172970Z Successfully installed fonttools-4.31.2 iniconfig-1.1.1 matplotlib-3.5.1 ptyprocess-0.5.1 pytest-7.1.1 rpy2-3.3.6 sagemath-standard-9.6b7 sphinx-4.4.0
> }}}
> 

But we want to use conda for managing the environment, otherwise wouldn't need to list the python packages as dependencies (since they would be installed by pip as well otherwise). So please add the version constraint that isuruf mentions above. Thanks


---

Comment by @tobiasdiez created at 2022-04-07 20:01:03

Changing status from positive_review to needs_work.


---

Comment by git created at 2022-04-07 20:12:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-04-07 20:13:19

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2022-04-07 20:15:35

Replying to [comment:18 gh-tobiasdiez]:
> But we want to use conda for managing the environment

This is what we *prefer*, but it does work correctly to install dependencies with pip. Anyway, here it is.


---

Comment by dimpase created at 2022-04-07 21:06:18

ok


---

Comment by dimpase created at 2022-04-07 21:06:18

Changing status from needs_review to positive_review.


---

Comment by @tobiasdiez created at 2022-04-07 22:39:57

Thanks! Looks good to me and seems to work well: https://github.com/sagemath/sagetrac-mirror/runs/5876791740?check_suite_focus=true

By the way, there are more conda-installed packages that are later replaced by pip: ptyprocess, iniconfig, sphinx, pytest, rpy2. I'll add them to #33331.


---

Comment by @mwageringel created at 2022-04-08 08:37:13

Thanks for resolving this problem.


---

Comment by vbraun created at 2022-04-10 13:12:52

Resolution: fixed
