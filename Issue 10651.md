# Issue 10651: Mark doctests # long time

archive/issues_010651.json:
```json
{
    "body": "Assignee: mvngu\n\nSome doctests take a long time, but are not marked `# long time`.  This ticket will fix the worst offenders (as a goal, all tests exceeding 5 seconds).\n\nIssue created by migration from https://trac.sagemath.org/ticket/10712\n\n",
    "created_at": "2011-01-29T20:53:24Z",
    "labels": [
        "component: doctest coverage",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.2",
    "title": "Mark doctests # long time",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10651",
    "user": "https://github.com/jdemeyer"
}
```
Assignee: mvngu

Some doctests take a long time, but are not marked `# long time`.  This ticket will fix the worst offenders (as a goal, all tests exceeding 5 seconds).

Issue created by migration from https://trac.sagemath.org/ticket/10712





---

archive/issue_comments_111599.json:
```json
{
    "body": "Changing status from new to needs_work.",
    "created_at": "2011-01-29T20:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10651#issuecomment-111599",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_work.



---

archive/issue_comments_111600.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-02-15T13:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10651#issuecomment-111600",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_111601.json:
```json
{
    "body": "Hi Jeroen,\n\nThese look good to me in principle and execution.  I can't vouch for all the mathematics affected, but maybe no one reviewer could?  I'll run tests overnight.  In the meantime two questions/comments:\n\n* I can see the times given being meaningless to anybody a few years in the future.  8 seconds?  When and where?  (Especially if in 3 years Moore's Law has it running in 2 seconds on new hardware.)  Would it be easy to say \"# longtime (8s on sage.math, 2011)\"?  Could you do that to the patch with a bit of grep/sed magic?\n\n* `sage/schemes/elliptic_curves/sha_tate.py` had two changes I was unsure about.  First, a test related to #10096 is deleted.  Is there a reason?  Second, some tests (\"supersingular cases\") are claimed to be the \"easiest\" possible and a comment to that effect is being deleted.  I'd even suggest with al the time savings, the rank 1 test could be sent to the \"short time\" category?  Not everybody runs long tests, so it'd be good to catch as much possible with the standard suite, and this sounds like a good candidate.\n\nGreat job cleaning up the tests, and the code in places!  I'm amazed none of my tests got caught up in this.\n\nYou didn't like \"oyoyoy a bug\" for an assert statement??  ;-)\n\nRob",
    "created_at": "2011-02-21T00:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10651#issuecomment-111601",
    "user": "https://github.com/rbeezer"
}
```

Hi Jeroen,

These look good to me in principle and execution.  I can't vouch for all the mathematics affected, but maybe no one reviewer could?  I'll run tests overnight.  In the meantime two questions/comments:

* I can see the times given being meaningless to anybody a few years in the future.  8 seconds?  When and where?  (Especially if in 3 years Moore's Law has it running in 2 seconds on new hardware.)  Would it be easy to say "# longtime (8s on sage.math, 2011)"?  Could you do that to the patch with a bit of grep/sed magic?

* `sage/schemes/elliptic_curves/sha_tate.py` had two changes I was unsure about.  First, a test related to #10096 is deleted.  Is there a reason?  Second, some tests ("supersingular cases") are claimed to be the "easiest" possible and a comment to that effect is being deleted.  I'd even suggest with al the time savings, the rank 1 test could be sent to the "short time" category?  Not everybody runs long tests, so it'd be good to catch as much possible with the standard suite, and this sounds like a good candidate.

Great job cleaning up the tests, and the code in places!  I'm amazed none of my tests got caught up in this.

You didn't like "oyoyoy a bug" for an assert statement??  ;-)

Rob



---

archive/issue_comments_111602.json:
```json
{
    "body": "Replying to [comment:4 rbeezer]:\n>  * I can see the times given being meaningless to anybody a few years in the future.  8 seconds?  When and where?  (Especially if in 3 years Moore's Law has it running in 2 seconds on new hardware.)  Would it be easy to say \"# longtime (8s on sage.math, 2011)\"?  Could you do that to the patch with a bit of grep/sed magic?\n\n\nI could, yes.\n\n>  * `sage/schemes/elliptic_curves/sha_tate.py` had two changes I was unsure about.  First, a test related to #10096 is deleted.  Is there a reason?\n\n\nThe same test appears twice in the same file, exactly the same.\n\n> Second, some tests (\"supersingular cases\") are claimed to be the \"easiest\" possible and a comment to that effect is being deleted.\n\nYou mean this:\n\n```\n# note on the doctests (cw 2010) \n# these tests are among the easiest test possible,  \n# so even if the rank 1 case in supersingular that \n# takes more than 20 sec, should not be excluded. \n```\nWell, that comment doesn't make any sense to me and it's also grammatically wrong.  If you think you understand what it means, feel free to rewrite it.\n\n> I'd even suggest with al the time savings, the rank 1 test could be sent to the \"short time\" category?  Not everybody runs long tests, so it'd be good to catch as much possible with the standard suite, and this sounds like a good candidate.\n\nFine.",
    "created_at": "2011-02-21T08:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10651#issuecomment-111602",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:4 rbeezer]:
>  * I can see the times given being meaningless to anybody a few years in the future.  8 seconds?  When and where?  (Especially if in 3 years Moore's Law has it running in 2 seconds on new hardware.)  Would it be easy to say "# longtime (8s on sage.math, 2011)"?  Could you do that to the patch with a bit of grep/sed magic?


I could, yes.

>  * `sage/schemes/elliptic_curves/sha_tate.py` had two changes I was unsure about.  First, a test related to #10096 is deleted.  Is there a reason?


The same test appears twice in the same file, exactly the same.

> Second, some tests ("supersingular cases") are claimed to be the "easiest" possible and a comment to that effect is being deleted.

You mean this:

```
# note on the doctests (cw 2010) 
# these tests are among the easiest test possible,  
# so even if the rank 1 case in supersingular that 
# takes more than 20 sec, should not be excluded. 
```
Well, that comment doesn't make any sense to me and it's also grammatically wrong.  If you think you understand what it means, feel free to rewrite it.

> I'd even suggest with al the time savings, the rank 1 test could be sent to the "short time" category?  Not everybody runs long tests, so it'd be good to catch as much possible with the standard suite, and this sounds like a good candidate.

Fine.



---

archive/issue_comments_111603.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-02-21T08:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10651#issuecomment-111603",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_111604.json:
```json
{
    "body": "Replying to [comment:5 jdemeyer]:\n> The same test appears twice in the same file, exactly the same.\n\n\nThanks - didn't look carefully enough to see that.\n\n> Well, that comment doesn't make any sense to me and it's also grammatically wrong.  If you think you understand what it means, feel free to rewrite it.\n\n\nI understood this to mean the \"rank 1 supersingular\" case was the minimum non-trivial example to fully exercise the code, even if it ran for a long time.  Thus the plea not to delete it.  I'll craft a rewrite in the morning.\n\nAll tests passed (long and \"short\") and gained a significant speed-up.\n\nRob",
    "created_at": "2011-02-21T09:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10651#issuecomment-111604",
    "user": "https://github.com/rbeezer"
}
```

Replying to [comment:5 jdemeyer]:
> The same test appears twice in the same file, exactly the same.


Thanks - didn't look carefully enough to see that.

> Well, that comment doesn't make any sense to me and it's also grammatically wrong.  If you think you understand what it means, feel free to rewrite it.


I understood this to mean the "rank 1 supersingular" case was the minimum non-trivial example to fully exercise the code, even if it ran for a long time.  Thus the plea not to delete it.  I'll craft a rewrite in the morning.

All tests passed (long and "short") and gained a significant speed-up.

Rob



---

archive/issue_comments_111605.json:
```json
{
    "body": "Here's a rewrite on those comments.  I thought it would be easier to just post it here for your use rather than mucking around with a patch.  Let me know if a patch would be better for you.\n\n```\n# note on the doctests (cw 2010)\n# These tests are among the simplest possible.\n# So even if the supersingular rank 1 test may\n# need to run for a long time, it should not\n# be excluded.\n```\n\nI got about a 7% speedup running long tests - maybe due to some really long tests that got shortened?  And short-test-time to long-test-time is now about a 3:4 ratio on my machine, which sounds good to me.\n\nIf you are willing to expand the description of actual times on tests (as suggested above), then I'm ready to give this a positive review.",
    "created_at": "2011-02-21T20:45:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10651#issuecomment-111605",
    "user": "https://github.com/rbeezer"
}
```

Here's a rewrite on those comments.  I thought it would be easier to just post it here for your use rather than mucking around with a patch.  Let me know if a patch would be better for you.

```
# note on the doctests (cw 2010)
# These tests are among the simplest possible.
# So even if the supersingular rank 1 test may
# need to run for a long time, it should not
# be excluded.
```

I got about a 7% speedup running long tests - maybe due to some really long tests that got shortened?  And short-test-time to long-test-time is now about a 3:4 ratio on my machine, which sounds good to me.

If you are willing to expand the description of actual times on tests (as suggested above), then I'm ready to give this a positive review.



---

archive/issue_comments_111606.json:
```json
{
    "body": "I'm still not convinced by the usefulness of the \"note on the doctests\".  I mean, such a note could be added to every doctest: \"don't delete this test\".  I think it's obvious that a test is there for a reason and that it should not simply be deleted.  The test also doesn't take an unusually long time, 10 to 20 seconds is fine for a \"# long time\" test.",
    "created_at": "2011-02-22T09:43:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10651#issuecomment-111606",
    "user": "https://github.com/jdemeyer"
}
```

I'm still not convinced by the usefulness of the "note on the doctests".  I mean, such a note could be added to every doctest: "don't delete this test".  I think it's obvious that a test is there for a reason and that it should not simply be deleted.  The test also doesn't take an unusually long time, 10 to 20 seconds is fine for a "# long time" test.



---

archive/issue_comments_111607.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-02-22T10:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10651#issuecomment-111607",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_111608.json:
```json
{
    "body": "Attachment [10712_long_time.patch](tarball://root/attachments/some-uuid/ticket10712/10712_long_time.patch) by @jdemeyer created at 2011-02-22 10:03:35\n\nUpdated version.  I removed \"# long time\" from a few doctests in `devel/sage/sage/schemes/elliptic_curves/sha_tate.py`.",
    "created_at": "2011-02-22T10:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10651#issuecomment-111608",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [10712_long_time.patch](tarball://root/attachments/some-uuid/ticket10712/10712_long_time.patch) by @jdemeyer created at 2011-02-22 10:03:35

Updated version.  I removed "# long time" from a few doctests in `devel/sage/sage/schemes/elliptic_curves/sha_tate.py`.



---

archive/issue_comments_111609.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-02-22T18:42:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10651#issuecomment-111609",
    "user": "https://github.com/rbeezer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_111610.json:
```json
{
    "body": "Replying to [comment:8 jdemeyer]:\n> I'm still not convinced by the usefulness of the \"note on the doctests\".\n\n\nOK, point taken.\n\nUpdated patch passes all long tests.  Thanks for taking the time to improve all this!",
    "created_at": "2011-02-22T18:42:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10651#issuecomment-111610",
    "user": "https://github.com/rbeezer"
}
```

Replying to [comment:8 jdemeyer]:
> I'm still not convinced by the usefulness of the "note on the doctests".


OK, point taken.

Updated patch passes all long tests.  Thanks for taking the time to improve all this!



---

archive/issue_comments_111611.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-02-25T08:06:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10651#issuecomment-111611",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_027584.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-02-25T08:06:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10651",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10651#event-27584"
}
```
