# Issue 21057: Fix fork() after InlineFortran.eval on Cygwin

Issue created by migration from Trac.

Original creator: embray

Original creation time: 2016-08-19 10:02:22

Keywords: windows cygwin fork

Because of the way `fork()` works in Cygwin, it is necessary after forking a process for the child process to manually re-load (using the Windows API `LoadModule`) all DLLs that were dynamically loaded in the parent process.

This means that if the actually DLL file of a DLL loaded by the parent is missing, re-loading the module in the child process fails.  Cygwin's `fork()` is very sensitive to this, and treats it as a failure, returning with a "Resource temporarily unavailable" error.

This occurs after evaluating an `InlineFortran` call, because it compiles a Python module around the given fortran code, imports that module, and then immediately deletes the actual library file once it's been imported.  Thus any subsequent attempt to `fork()` that process will fail on Cygwin.

This fix simply prevents the immediate deletion of the temporary DLL.  Instead it sticks around for the lifetime of the process, at the end of which it (should) be deleted by the atexit handler for cleaning up temp dirs--at this point it is generally safe to delete the DLL.


---

Comment by embray created at 2016-08-19 10:02:58

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-03-16 19:08:36

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2017-03-16 19:08:36

Does not apply.


---

Comment by git created at 2017-03-16 19:48:50

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2017-03-16 19:49:06

I rebased it on develop.


---

Comment by embray created at 2017-03-16 21:17:47

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2017-03-17 08:58:54

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-03-17 09:02:44

Changing keywords from "windows cygwin fork" to "windows cygwin fork, days85".


---

Comment by vbraun created at 2017-03-27 20:42:51

Resolution: fixed
