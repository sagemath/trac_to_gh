# Issue 33331: is_integral_domain_for_quotients

Issue created by migration from https://trac.sagemath.org/ticket/33568

Original creator: @schmittj

Original creation time: 2022-03-26 14:46:52

CC:  slelievre




---

Comment by @schmittj created at 2022-03-26 14:55:43

Changing component from PLEASE CHANGE to algebra.


---

Comment by @schmittj created at 2022-03-26 14:55:43

Changing type from PLEASE CHANGE to enhancement.


---

Comment by @schmittj created at 2022-03-26 14:55:43

New commits:


---

Comment by @schmittj created at 2022-03-26 14:55:43

Changing priority from major to minor.


---

Comment by git created at 2022-03-26 19:44:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slelievre created at 2022-03-26 21:45:12

Changing priority from minor to major.


---

Comment by slelievre created at 2022-03-26 21:45:12

Remember to add your name in the "authors" field
and to set to "needs review" when ready.


---

Comment by git created at 2022-03-27 12:55:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2022-03-27 16:35:44

With respect to the documentation. Anything after a `::` must be indented. The correct syntax for a `TESTS` or `EXAMPLES` block starting with a sentence is

```
        TESTS:

        Here is an example of a quotient ring which is not an integral
        domain, even though the base ring is integral and the modulus is
        irreducible::

            sage: B = ZZ.extension(x^2 - 5, 'a')
```


Instead of `if IntegralDomains() in self.categories()` you might want to do `if self in IntegralDomains()`.

The test `if self.base_ring() in GcdDomains` would better be `if self.base_ring() in GcdDomains()`. I am surprised that it works the way you wrote it (as `GcdDomains` is a class).

When `proof=False` I am not sure that the shortcut `NotImplementedError => False` is desirable

```
            except NotImplementedError:
                if proof:
                    raise
                else:
                    ret = False
```

You indeed catch the `raise NotImplementedError` that could be raised few lines above but also any `NotImplementedError` that would come from `irr = self.modulus().is_irreducible()`.


---

Comment by @schmittj created at 2022-03-28 15:28:54

Thanks for taking a close look!
> With respect to the documentation. Anything after a `::` must be indented. 
I'll change this.

> Instead of `if IntegralDomains() in self.categories()` you might want to do `if self in IntegralDomains()`.

Ok, I can do that, though one small comment: I believe in most cases this will mean that `is_integral_domain` will go into an infinite loop alternating with `IntegralDomains().__contains__` until an exception is raised and the `__contains__` method returns `False`. But maybe this is ok? 

I only added this check since otherwise doctests about splitting algebras broke. There the problem was: one of these algebras was initialized knowing it is an integral domain, but then later it was also initialized as a quotient ring, and its previous `is_integral_domain` method (which just returned `True`) was overwritten with my method which couldn't find a proof and raised an exception. (See the doctest failures in 3dc50ed for reference)

> The test `if self.base_ring() in GcdDomains` would better be `if self.base_ring() in GcdDomains()`. I am surprised that it works the way you wrote it (as `GcdDomains` is a class).
Yes, in retrospect I am also surprised - I'll change this.

> When `proof=False` I am not sure that the shortcut `NotImplementedError => False` is desirable
> {{{
>             except NotImplementedError:
>                 if proof:
>                     raise
>                 else:
>                     ret = False
> }}}
> You indeed catch the `raise NotImplementedError` that could be raised few lines above but also any `NotImplementedError` that would come from `irr = self.modulus().is_irreducible()`.

It's true that there are two sources where the `NotImplementedError` could come from, but I think in both cases there is nothing we can do mathematically - to confirm that we are an integral domain, the only path leading to `True` right now is that we can verify that `self.modulus()` is irreducible AND that the base ring is a GCD. If you know another sufficient condition, I am happy to include it.

In fact the previous method `PolynomialQuotientRing.is_field`, which I tried to emulate, specifically uses such a `try: ... except NotImplementedError` to catch a missing implementation of `is_irreducible`.


---

Comment by vdelecroix created at 2022-03-28 15:56:01

Replying to [comment:7 gh-schmittj]:
> Thanks for taking a close look!
> > With respect to the documentation. Anything after a `::` must be indented. 
> I'll change this.
> 
> > Instead of `if IntegralDomains() in self.categories()` you might want to do `if self in IntegralDomains()`.
> 
> Ok, I can do that, though one small comment: I believe in most cases this will mean that `is_integral_domain` will go into an infinite loop alternating with `IntegralDomains().__contains__` until an exception is raised and the `__contains__` method returns `False`. But maybe this is ok? 

The method `self in IntegralDomains()` ought to be a faster equivalent of `IntegralDomains() in self.categories()`... which is not the case. Could you simply add a comment in the code? There is a note at the end of the documentation of `IntegralDomains.__contains__` mentionning that this method should disappear (in favour of the generic one being equivalent to `IntegralDomains() in self.categories()`).

> > When `proof=False` I am not sure that the shortcut `NotImplementedError => False` is desirable
> > {{{
> >             except NotImplementedError:
> >                 if proof:
> >                     raise
> >                 else:
> >                     ret = False
> > }}}
> > You indeed catch the `raise NotImplementedError` that could be raised few lines above but also any `NotImplementedError` that would come from `irr = self.modulus().is_irreducible()`.
> 
> It's true that there are two sources where the `NotImplementedError` could come from, but I think in both cases there is nothing we can do mathematically - to confirm that we are an integral domain, the only path leading to `True` right now is that we can verify that `self.modulus()` is irreducible AND that the base ring is a GCD. If you know another sufficient condition, I am happy to include it.
> 
> In fact the previous method `PolynomialQuotientRing.is_field`, which I tried to emulate, specifically uses such a `try: ... except NotImplementedError` to catch a missing implementation of `is_irreducible`.

I think my misunderstanding comes from the weird semantic of the keyword `proof=True`/`proof=False`. I thought that `proof=False` meant "the answer assumes some standard conjecture such as the generalized Riemann hypothesis" (as in https://doc.sagemath.org/html/en/reference/structure/sage/structure/proof/proof.html). What your `proof=False` means is rather "do not raise NotImplementedError but return False instead".


---

Comment by vdelecroix created at 2022-03-28 16:00:06

Replying to [comment:8 vdelecroix]:
> Replying to [comment:7 gh-schmittj]:
> > Thanks for taking a close look!
> > > With respect to the documentation. Anything after a `::` must be indented. 
> > I'll change this.
> > 
> > > Instead of `if IntegralDomains() in self.categories()` you might want to do `if self in IntegralDomains()`.
> > 
> > Ok, I can do that, though one small comment: I believe in most cases this will mean that `is_integral_domain` will go into an infinite loop alternating with `IntegralDomains().__contains__` until an exception is raised and the `__contains__` method returns `False`. But maybe this is ok? 
> 
> The method `self in IntegralDomains()` ought to be a faster equivalent of `IntegralDomains() in self.categories()`... which is not the case. Could you simply add a comment in the code? There is a note at the end of the documentation of `IntegralDomains.__contains__` mentionning that this method should disappear (in favour of the generic one being equivalent to `IntegralDomains() in self.categories()`).

You might want to use what the generic `__contains__` does

```
self.category().is_subcategory(IntegralDomains())
```

(see `sage/categories/category.py`).


---

Comment by git created at 2022-03-28 16:12:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @schmittj created at 2022-03-28 16:16:21

I really like the proposal with `self.category().is_subcategory(IntegralDomains())`. I made all corresponding changes


---

Comment by @schmittj created at 2022-03-28 16:16:21

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2022-03-28 17:13:16

Are you sure about the semantic of `proof=False` that I mentioned in my [This is the Trac macro *comment:8* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:8-macro)? For `Zmod(n)` this does turns on/off random primality tests (which is very different from `NotImplementedError` becomes `False`). See the file in [sage/rings/finite_rings/integer_mod_ring.py](https://github.com/sagemath/sage/blob/develop/src/sage/rings/finite_rings/integer_mod_ring.py). To my mind, the method should always raise `NotImplementedError` when it is not able to decide.


---

Comment by @schmittj created at 2022-03-29 06:28:34

In the documentation of `Ring.is_integral_domain` it says

```
   Return "True" if this ring is an integral domain.

   INPUT:

   * "proof" -- (default: "True") Determines what to do in unknown
     cases

   ALGORITHM:

   If the parameter "proof" is set to "True", the returned value is
   correct but the method might throw an error.  Otherwise, if it is
   set to "False", the method returns "True" if it can establish that
   self is an integral domain and "False" otherwise.
```

My impression is: if the primality tests have a nonzero chance of returning a false positive, then the implementation in `Zmod(n)` is not strictly speaking conforming to this specification in `Ring.is_integral_domain`.


---

Comment by vdelecroix created at 2022-03-29 07:32:06

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2022-03-29 07:32:06

Thanks for the reference. I don't like very much this specification but changing it is definitely not the goal of this ticket.


---

Comment by vbraun created at 2022-04-02 10:52:57

Resolution: fixed
