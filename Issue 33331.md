# Issue 33331: is_integral_domain_for_quotients

archive/issues_033331.json:
```json
{
    "body": "CC:  @slel\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33568\n\n",
    "created_at": "2022-03-26T14:46:52Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "is_integral_domain_for_quotients",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33331",
    "user": "@schmittj"
}
```
CC:  @slel



Issue created by migration from https://trac.sagemath.org/ticket/33568





---

archive/issue_comments_474511.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to algebra.",
    "created_at": "2022-03-26T14:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474511",
    "user": "@schmittj"
}
```

Changing component from PLEASE CHANGE to algebra.



---

archive/issue_comments_474512.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2022-03-26T14:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474512",
    "user": "@schmittj"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_474513.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-03-26T14:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474513",
    "user": "@schmittj"
}
```

New commits:



---

archive/issue_comments_474514.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2022-03-26T14:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474514",
    "user": "@schmittj"
}
```

Changing priority from major to minor.



---

archive/issue_comments_474515.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-26T19:44:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474515",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474516.json:
```json
{
    "body": "Changing priority from minor to major.",
    "created_at": "2022-03-26T21:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474516",
    "user": "@slel"
}
```

Changing priority from minor to major.



---

archive/issue_comments_474517.json:
```json
{
    "body": "Remember to add your name in the \"authors\" field\nand to set to \"needs review\" when ready.",
    "created_at": "2022-03-26T21:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474517",
    "user": "@slel"
}
```

Remember to add your name in the "authors" field
and to set to "needs review" when ready.



---

archive/issue_comments_474518.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-27T12:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474518",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474519.json:
```json
{
    "body": "With respect to the documentation. Anything after a `::` must be indented. The correct syntax for a `TESTS` or `EXAMPLES` block starting with a sentence is\n\n```\n        TESTS:\n\n        Here is an example of a quotient ring which is not an integral\n        domain, even though the base ring is integral and the modulus is\n        irreducible::\n\n            sage: B = ZZ.extension(x^2 - 5, 'a')\n```\n\n\nInstead of `if IntegralDomains() in self.categories()` you might want to do `if self in IntegralDomains()`.\n\nThe test `if self.base_ring() in GcdDomains` would better be `if self.base_ring() in GcdDomains()`. I am surprised that it works the way you wrote it (as `GcdDomains` is a class).\n\nWhen `proof=False` I am not sure that the shortcut `NotImplementedError => False` is desirable\n\n```\n            except NotImplementedError:\n                if proof:\n                    raise\n                else:\n                    ret = False\n```\n\nYou indeed catch the `raise NotImplementedError` that could be raised few lines above but also any `NotImplementedError` that would come from `irr = self.modulus().is_irreducible()`.",
    "created_at": "2022-03-27T16:35:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474519",
    "user": "@videlec"
}
```

With respect to the documentation. Anything after a `::` must be indented. The correct syntax for a `TESTS` or `EXAMPLES` block starting with a sentence is

```
        TESTS:

        Here is an example of a quotient ring which is not an integral
        domain, even though the base ring is integral and the modulus is
        irreducible::

            sage: B = ZZ.extension(x^2 - 5, 'a')
```


Instead of `if IntegralDomains() in self.categories()` you might want to do `if self in IntegralDomains()`.

The test `if self.base_ring() in GcdDomains` would better be `if self.base_ring() in GcdDomains()`. I am surprised that it works the way you wrote it (as `GcdDomains` is a class).

When `proof=False` I am not sure that the shortcut `NotImplementedError => False` is desirable

```
            except NotImplementedError:
                if proof:
                    raise
                else:
                    ret = False
```

You indeed catch the `raise NotImplementedError` that could be raised few lines above but also any `NotImplementedError` that would come from `irr = self.modulus().is_irreducible()`.



---

archive/issue_comments_474520.json:
```json
{
    "body": "Thanks for taking a close look!\n> With respect to the documentation. Anything after a `::` must be indented. \nI'll change this.\n\n> Instead of `if IntegralDomains() in self.categories()` you might want to do `if self in IntegralDomains()`.\n\nOk, I can do that, though one small comment: I believe in most cases this will mean that `is_integral_domain` will go into an infinite loop alternating with `IntegralDomains().__contains__` until an exception is raised and the `__contains__` method returns `False`. But maybe this is ok? \n\nI only added this check since otherwise doctests about splitting algebras broke. There the problem was: one of these algebras was initialized knowing it is an integral domain, but then later it was also initialized as a quotient ring, and its previous `is_integral_domain` method (which just returned `True`) was overwritten with my method which couldn't find a proof and raised an exception. (See the doctest failures in 3dc50ed for reference)\n\n> The test `if self.base_ring() in GcdDomains` would better be `if self.base_ring() in GcdDomains()`. I am surprised that it works the way you wrote it (as `GcdDomains` is a class).\nYes, in retrospect I am also surprised - I'll change this.\n\n> When `proof=False` I am not sure that the shortcut `NotImplementedError => False` is desirable\n> {{{\n>             except NotImplementedError:\n>                 if proof:\n>                     raise\n>                 else:\n>                     ret = False\n> }}}\n> You indeed catch the `raise NotImplementedError` that could be raised few lines above but also any `NotImplementedError` that would come from `irr = self.modulus().is_irreducible()`.\n\nIt's true that there are two sources where the `NotImplementedError` could come from, but I think in both cases there is nothing we can do mathematically - to confirm that we are an integral domain, the only path leading to `True` right now is that we can verify that `self.modulus()` is irreducible AND that the base ring is a GCD. If you know another sufficient condition, I am happy to include it.\n\nIn fact the previous method `PolynomialQuotientRing.is_field`, which I tried to emulate, specifically uses such a `try: ... except NotImplementedError` to catch a missing implementation of `is_irreducible`.",
    "created_at": "2022-03-28T15:28:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474520",
    "user": "@schmittj"
}
```

Thanks for taking a close look!
> With respect to the documentation. Anything after a `::` must be indented. 
I'll change this.

> Instead of `if IntegralDomains() in self.categories()` you might want to do `if self in IntegralDomains()`.

Ok, I can do that, though one small comment: I believe in most cases this will mean that `is_integral_domain` will go into an infinite loop alternating with `IntegralDomains().__contains__` until an exception is raised and the `__contains__` method returns `False`. But maybe this is ok? 

I only added this check since otherwise doctests about splitting algebras broke. There the problem was: one of these algebras was initialized knowing it is an integral domain, but then later it was also initialized as a quotient ring, and its previous `is_integral_domain` method (which just returned `True`) was overwritten with my method which couldn't find a proof and raised an exception. (See the doctest failures in 3dc50ed for reference)

> The test `if self.base_ring() in GcdDomains` would better be `if self.base_ring() in GcdDomains()`. I am surprised that it works the way you wrote it (as `GcdDomains` is a class).
Yes, in retrospect I am also surprised - I'll change this.

> When `proof=False` I am not sure that the shortcut `NotImplementedError => False` is desirable
> {{{
>             except NotImplementedError:
>                 if proof:
>                     raise
>                 else:
>                     ret = False
> }}}
> You indeed catch the `raise NotImplementedError` that could be raised few lines above but also any `NotImplementedError` that would come from `irr = self.modulus().is_irreducible()`.

It's true that there are two sources where the `NotImplementedError` could come from, but I think in both cases there is nothing we can do mathematically - to confirm that we are an integral domain, the only path leading to `True` right now is that we can verify that `self.modulus()` is irreducible AND that the base ring is a GCD. If you know another sufficient condition, I am happy to include it.

In fact the previous method `PolynomialQuotientRing.is_field`, which I tried to emulate, specifically uses such a `try: ... except NotImplementedError` to catch a missing implementation of `is_irreducible`.



---

archive/issue_comments_474521.json:
```json
{
    "body": "Replying to [comment:7 gh-schmittj]:\n> Thanks for taking a close look!\n> > With respect to the documentation. Anything after a `::` must be indented. \n> I'll change this.\n> \n> > Instead of `if IntegralDomains() in self.categories()` you might want to do `if self in IntegralDomains()`.\n> \n> Ok, I can do that, though one small comment: I believe in most cases this will mean that `is_integral_domain` will go into an infinite loop alternating with `IntegralDomains().__contains__` until an exception is raised and the `__contains__` method returns `False`. But maybe this is ok? \n\nThe method `self in IntegralDomains()` ought to be a faster equivalent of `IntegralDomains() in self.categories()`... which is not the case. Could you simply add a comment in the code? There is a note at the end of the documentation of `IntegralDomains.__contains__` mentionning that this method should disappear (in favour of the generic one being equivalent to `IntegralDomains() in self.categories()`).\n\n> > When `proof=False` I am not sure that the shortcut `NotImplementedError => False` is desirable\n> > {{{\n> >             except NotImplementedError:\n> >                 if proof:\n> >                     raise\n> >                 else:\n> >                     ret = False\n> > }}}\n> > You indeed catch the `raise NotImplementedError` that could be raised few lines above but also any `NotImplementedError` that would come from `irr = self.modulus().is_irreducible()`.\n> \n> It's true that there are two sources where the `NotImplementedError` could come from, but I think in both cases there is nothing we can do mathematically - to confirm that we are an integral domain, the only path leading to `True` right now is that we can verify that `self.modulus()` is irreducible AND that the base ring is a GCD. If you know another sufficient condition, I am happy to include it.\n> \n> In fact the previous method `PolynomialQuotientRing.is_field`, which I tried to emulate, specifically uses such a `try: ... except NotImplementedError` to catch a missing implementation of `is_irreducible`.\n\nI think my misunderstanding comes from the weird semantic of the keyword `proof=True`/`proof=False`. I thought that `proof=False` meant \"the answer assumes some standard conjecture such as the generalized Riemann hypothesis\" (as in https://doc.sagemath.org/html/en/reference/structure/sage/structure/proof/proof.html). What your `proof=False` means is rather \"do not raise NotImplementedError but return False instead\".",
    "created_at": "2022-03-28T15:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474521",
    "user": "@videlec"
}
```

Replying to [comment:7 gh-schmittj]:
> Thanks for taking a close look!
> > With respect to the documentation. Anything after a `::` must be indented. 
> I'll change this.
> 
> > Instead of `if IntegralDomains() in self.categories()` you might want to do `if self in IntegralDomains()`.
> 
> Ok, I can do that, though one small comment: I believe in most cases this will mean that `is_integral_domain` will go into an infinite loop alternating with `IntegralDomains().__contains__` until an exception is raised and the `__contains__` method returns `False`. But maybe this is ok? 

The method `self in IntegralDomains()` ought to be a faster equivalent of `IntegralDomains() in self.categories()`... which is not the case. Could you simply add a comment in the code? There is a note at the end of the documentation of `IntegralDomains.__contains__` mentionning that this method should disappear (in favour of the generic one being equivalent to `IntegralDomains() in self.categories()`).

> > When `proof=False` I am not sure that the shortcut `NotImplementedError => False` is desirable
> > {{{
> >             except NotImplementedError:
> >                 if proof:
> >                     raise
> >                 else:
> >                     ret = False
> > }}}
> > You indeed catch the `raise NotImplementedError` that could be raised few lines above but also any `NotImplementedError` that would come from `irr = self.modulus().is_irreducible()`.
> 
> It's true that there are two sources where the `NotImplementedError` could come from, but I think in both cases there is nothing we can do mathematically - to confirm that we are an integral domain, the only path leading to `True` right now is that we can verify that `self.modulus()` is irreducible AND that the base ring is a GCD. If you know another sufficient condition, I am happy to include it.
> 
> In fact the previous method `PolynomialQuotientRing.is_field`, which I tried to emulate, specifically uses such a `try: ... except NotImplementedError` to catch a missing implementation of `is_irreducible`.

I think my misunderstanding comes from the weird semantic of the keyword `proof=True`/`proof=False`. I thought that `proof=False` meant "the answer assumes some standard conjecture such as the generalized Riemann hypothesis" (as in https://doc.sagemath.org/html/en/reference/structure/sage/structure/proof/proof.html). What your `proof=False` means is rather "do not raise NotImplementedError but return False instead".



---

archive/issue_comments_474522.json:
```json
{
    "body": "Replying to [comment:8 vdelecroix]:\n> Replying to [comment:7 gh-schmittj]:\n> > Thanks for taking a close look!\n> > > With respect to the documentation. Anything after a `::` must be indented. \n> > I'll change this.\n> > \n> > > Instead of `if IntegralDomains() in self.categories()` you might want to do `if self in IntegralDomains()`.\n> > \n> > Ok, I can do that, though one small comment: I believe in most cases this will mean that `is_integral_domain` will go into an infinite loop alternating with `IntegralDomains().__contains__` until an exception is raised and the `__contains__` method returns `False`. But maybe this is ok? \n> \n> The method `self in IntegralDomains()` ought to be a faster equivalent of `IntegralDomains() in self.categories()`... which is not the case. Could you simply add a comment in the code? There is a note at the end of the documentation of `IntegralDomains.__contains__` mentionning that this method should disappear (in favour of the generic one being equivalent to `IntegralDomains() in self.categories()`).\n\nYou might want to use what the generic `__contains__` does\n\n```\nself.category().is_subcategory(IntegralDomains())\n```\n\n(see `sage/categories/category.py`).",
    "created_at": "2022-03-28T16:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474522",
    "user": "@videlec"
}
```

Replying to [comment:8 vdelecroix]:
> Replying to [comment:7 gh-schmittj]:
> > Thanks for taking a close look!
> > > With respect to the documentation. Anything after a `::` must be indented. 
> > I'll change this.
> > 
> > > Instead of `if IntegralDomains() in self.categories()` you might want to do `if self in IntegralDomains()`.
> > 
> > Ok, I can do that, though one small comment: I believe in most cases this will mean that `is_integral_domain` will go into an infinite loop alternating with `IntegralDomains().__contains__` until an exception is raised and the `__contains__` method returns `False`. But maybe this is ok? 
> 
> The method `self in IntegralDomains()` ought to be a faster equivalent of `IntegralDomains() in self.categories()`... which is not the case. Could you simply add a comment in the code? There is a note at the end of the documentation of `IntegralDomains.__contains__` mentionning that this method should disappear (in favour of the generic one being equivalent to `IntegralDomains() in self.categories()`).

You might want to use what the generic `__contains__` does

```
self.category().is_subcategory(IntegralDomains())
```

(see `sage/categories/category.py`).



---

archive/issue_comments_474523.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-28T16:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474523",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474524.json:
```json
{
    "body": "I really like the proposal with `self.category().is_subcategory(IntegralDomains())`. I made all corresponding changes",
    "created_at": "2022-03-28T16:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474524",
    "user": "@schmittj"
}
```

I really like the proposal with `self.category().is_subcategory(IntegralDomains())`. I made all corresponding changes



---

archive/issue_comments_474525.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-03-28T16:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474525",
    "user": "@schmittj"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_474526.json:
```json
{
    "body": "Are you sure about the semantic of `proof=False` that I mentioned in my [This is the Trac macro *comment:8* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:8-macro)? For `Zmod(n)` this does turns on/off random primality tests (which is very different from `NotImplementedError` becomes `False`). See the file in [sage/rings/finite_rings/integer_mod_ring.py](https://github.com/sagemath/sage/blob/develop/src/sage/rings/finite_rings/integer_mod_ring.py). To my mind, the method should always raise `NotImplementedError` when it is not able to decide.",
    "created_at": "2022-03-28T17:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474526",
    "user": "@videlec"
}
```

Are you sure about the semantic of `proof=False` that I mentioned in my [This is the Trac macro *comment:8* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:8-macro)? For `Zmod(n)` this does turns on/off random primality tests (which is very different from `NotImplementedError` becomes `False`). See the file in [sage/rings/finite_rings/integer_mod_ring.py](https://github.com/sagemath/sage/blob/develop/src/sage/rings/finite_rings/integer_mod_ring.py). To my mind, the method should always raise `NotImplementedError` when it is not able to decide.



---

archive/issue_comments_474527.json:
```json
{
    "body": "In the documentation of `Ring.is_integral_domain` it says\n\n```\n   Return \"True\" if this ring is an integral domain.\n\n   INPUT:\n\n   * \"proof\" -- (default: \"True\") Determines what to do in unknown\n     cases\n\n   ALGORITHM:\n\n   If the parameter \"proof\" is set to \"True\", the returned value is\n   correct but the method might throw an error.  Otherwise, if it is\n   set to \"False\", the method returns \"True\" if it can establish that\n   self is an integral domain and \"False\" otherwise.\n```\n\nMy impression is: if the primality tests have a nonzero chance of returning a false positive, then the implementation in `Zmod(n)` is not strictly speaking conforming to this specification in `Ring.is_integral_domain`.",
    "created_at": "2022-03-29T06:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474527",
    "user": "@schmittj"
}
```

In the documentation of `Ring.is_integral_domain` it says

```
   Return "True" if this ring is an integral domain.

   INPUT:

   * "proof" -- (default: "True") Determines what to do in unknown
     cases

   ALGORITHM:

   If the parameter "proof" is set to "True", the returned value is
   correct but the method might throw an error.  Otherwise, if it is
   set to "False", the method returns "True" if it can establish that
   self is an integral domain and "False" otherwise.
```

My impression is: if the primality tests have a nonzero chance of returning a false positive, then the implementation in `Zmod(n)` is not strictly speaking conforming to this specification in `Ring.is_integral_domain`.



---

archive/issue_comments_474528.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-29T07:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474528",
    "user": "@videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_474529.json:
```json
{
    "body": "Thanks for the reference. I don't like very much this specification but changing it is definitely not the goal of this ticket.",
    "created_at": "2022-03-29T07:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474529",
    "user": "@videlec"
}
```

Thanks for the reference. I don't like very much this specification but changing it is definitely not the goal of this ticket.



---

archive/issue_comments_474530.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-04-02T10:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33331",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33331#issuecomment-474530",
    "user": "@vbraun"
}
```

Resolution: fixed
