# Issue 11063: Make the ipython edit magic command edit the right file and show both files when doing ??

Issue created by migration from Trac.

Original creator: mderickx

Original creation time: 2011-04-21 21:59:37

Assignee: jason

All is really said in the title.


---

Comment by mderickx created at 2011-04-21 22:19:54

Here is the spkg which patches IPython http://www.math.leidenuniv.nl/~mderickx/ipython-0.9.1.p1.spkg. Since there is no ipython hook you really need the patch here to show both files.


---

Attachment


---

Comment by mderickx created at 2011-04-21 22:27:19

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2011-04-22 02:10:34

Have you looked at sage/misc/edit_module.py?  Would it be better to plug into that functionality when you type "%edit"?


---

Comment by mderickx created at 2011-04-22 09:30:58

Yeah I looked at it, but I think that following the arguments of least surprise it would be good to just keep the IPython behavior as much as possible . People might already know the exact behaviour of %edit because they have used IPython. And since typing % in front of something is really an IPython thing, so I think we should keep their implementation and not our custom one (at least when doing %edit, you can always use the edit() function if you want the sage behaviour.


---

Comment by mderickx created at 2011-04-22 09:32:49

Note that before the patch %edit also worked, but it opened the wrong file, all that the patch does is change the file it opens.


---

Comment by mstreng created at 2011-12-17 15:56:13

new ipython


---

Comment by mstreng created at 2011-12-17 15:56:13

Changing status from needs_review to needs_work.


---

Comment by mderickx created at 2011-12-18 14:52:17

I added a new spkg http://www.math.leidenuniv.nl/~mderickx/ipython-0.10.2.p1.spkg


---

Comment by mderickx created at 2011-12-18 14:52:17

Changing status from needs_work to needs_review.


---

Comment by mstreng created at 2011-12-19 09:57:52


```
09:56:43:~$ tar -xf ipython-0.10.2.p1.spkg 
ipython-0.10.2.p1/src/docs/examples/kernel/davinci2.txt: Truncated tar archive
tar: Error exit delayed from previous errors.
```

???


---

Comment by mstreng created at 2011-12-19 10:02:29

Replying to [comment:10 mstreng]:
> {{{
> 09:56:43:~$ tar -xf ipython-0.10.2.p1.spkg 
> ipython-0.10.2.p1/src/docs/examples/kernel/davinci2.txt: Truncated tar archive
> tar: Error exit delayed from previous errors.
> }}}
> ???

Never mind that, I downloaded a partial file apparently. Got the right one now.


---

Comment by mstreng created at 2011-12-19 10:13:34

Which Sage version did you test this on? I installed the spkg, then the patch, and the patch gave me:

```
10:10:22:~/sage-4.8.alpha4/devel/sage$ hg qpush
applying IPython-edit.patch
patching file sage/misc/edit_module.py
Hunk #1 FAILED at 39
1 out of 3 hunks FAILED -- saving rejects to file sage/misc/edit_module.py.rej
patch failed, unable to continue (try -v)
patch failed, rejects left in working dir
errors during apply, please fix and refresh IPython-edit.patch
10:10:54:~/sage-4.8.alpha4/devel/sage$ cat sage/misc/edit_module.py.rej
--- edit_module.py
+++ edit_module.py
`@``@` -40,6 +40,8 `@``@`
 import inspect
 import os
 import sys
+import re
+import IPython
 
 from string import Template
```



---

Comment by mstreng created at 2011-12-19 10:13:34

Changing keywords from "" to "sd35 ipython source file location".


---

Comment by mstreng created at 2011-12-19 10:15:50

Changing status from needs_review to needs_work.


---

Comment by mstreng created at 2011-12-19 10:15:50

And it is not because I installed the spkg first: on a Sage 4.8.alpha4 without the spkg, I get the same problem.


---

Attachment


---

Comment by mderickx created at 2011-12-22 16:31:36

Ok I updated the patch.


---

Comment by mderickx created at 2011-12-22 16:31:36

Changing status from needs_work to needs_review.


---

Comment by mstreng created at 2012-01-05 10:36:13

Changing status from needs_review to needs_work.


---

Comment by mstreng created at 2012-01-05 10:36:13

Sorry I missed the trac update. I'm reviewing right now. Like it very much.

Mild reasons for needs_work:

 * incorrect spelling of diffrent
 * I guess you can't doctest `edit_devel`, but it would be good to get rid of the following warning:
  {{{
  sage -coverage devel/sage/sage/misc/edit_module.py
  ----------------------------------------------------------------------
  devel/sage/sage/misc/edit_module.py
  SCORE devel/sage/sage/misc/edit_module.py: 100% (6 of 6) 
  
  Possibly wrong (function name doesn't occur in doctests):
  	 * edit_devel(self, filename, linenum):
  
  ----------------------------------------------------------------------
  }}}

Suggestions for the patch (these things aren't regressions, they were like this always, so if you don't want to spend time on it, that's fine with me):

 * After %ed, the file is reloaded, which is not the correct thing to do. It should be imported, otherwise doing %ed doesn't make sense. Example:
    {{{
    sage: EllipticCurve([1,2,3,4,6])
    Elliptic Curve defined by y^2 + x*y + 3*y = x^3 + 2*x^2 + 4*x + 6 over Rational Field
    sage: %ed EllipticCurve
    Editing... done. Executing edited code...
    sage: EllipticCurve([1,2,3,4,6])
    ImportError: No module named ell_generic
    }}}
 * when the `.sub` is successful and `filename` ends with `".sage"`, it would be easy to afterwards overwrite the site-packages file with the source file. Then the user only has to `sage: from sage.all import *` (which you can tell the user to do, or maybe program Sage to do)


---

Comment by mstreng created at 2012-01-05 10:54:50

There are no changes to the notebook, right?


---

Comment by mstreng created at 2012-01-05 11:19:33

(all tests pass on 4.8.alpha4)


---

Comment by mstreng created at 2012-01-12 16:54:33

I thought I'd fix the typo and put up a reviewer patch, but found out that there is something duplicate about your patch.

The functionality that your patch provides in `sage.misc.edit_module.edit_devel` is already in `sage.misc.edit_module.edit`. See [http://www.sagemath.org/doc/reference/sage/misc/edit_module.html](http://www.sagemath.org/doc/reference/sage/misc/edit_module.html). See also #7961.

On an unpatched sage-4.8.alpha4, I get the correct file with `sage: edit(EllipticCurve)`, but the incorrect file with `sage: %ed EllipticCurve`


---

Comment by mstreng created at 2012-01-12 16:59:40

Replying to [comment:18 mstreng]:
> I thought I'd fix the typo and put up a reviewer patch, but found out that there is something duplicate about your patch.

But I guess you know all that. This is about `%ed`, not `edit`


---

Attachment

reST formatting, spelling, clarity


---

Comment by mstreng created at 2012-01-12 20:34:58

Changing status from needs_work to needs_review.


---

Comment by mstreng created at 2012-01-12 20:34:58

Positive review for everything but the reviewer patch. Please review the reviewer patch!


---

Comment by mderickx created at 2012-01-20 17:45:50

Replying to [comment:19 mstreng]:
> Replying to [comment:18 mstreng]:
> > I thought I'd fix the typo and put up a reviewer patch, but found out that there is something duplicate about your patch.
> 
> But I guess you know all that. This is about `%ed`, not `edit`

Yes this is exactly the reason. 
I would like to review your review patch, and at least I agree with the documentation changes. But I'm terrible at spelling so it can have positive review as soon as someone  just can guarente to me that the English is correct


---

Comment by jhpalmieri created at 2012-01-20 18:44:45

The English in the reviewer patch looks fine to me (although I would have said "the Sage library" instead of "the sage library").  So feel free to switch this to a positive review.


---

Comment by mderickx created at 2012-01-21 14:16:08

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-01-24 14:28:00

There is a small problem with the documentation:

```
/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta2/local/lib/python2.7/site-packages/sage/misc/edit_module.py:docstring of sage.misc.edit_module.edit_devel:14: WARNING: Inline interpreted text or phrase reference start-string without end-string.
```



---

Comment by mstreng created at 2012-01-24 21:15:13

Replying to [comment:25 jdemeyer]:

What causes this? Is it the ```%edit``` in the docstring?


---

Comment by jhpalmieri created at 2012-01-24 21:33:00

No, it's the dollar sign.  Try this:

```diff
diff --git a/sage/misc/edit_module.py b/sage/misc/edit_module.py
--- a/sage/misc/edit_module.py
+++ b/sage/misc/edit_module.py
`@``@` -299,7 +299,7 `@``@` def edit_devel(self, filename, linenum):
         sage: %ed gcd           # indirect doctest, not tested
 
     The above should open your favorite editor (as stored in the environment
-    variable $EDITOR) with the file in which gcd is defined, and when your
+    variable \$EDITOR) with the file in which gcd is defined, and when your
     editor supports it, also at the line in wich gcd is defined.
     """
     sageroot = sage.misc.sageinspect.SAGE_ROOT+'/'
```



---

Attachment


---

Comment by jdemeyer created at 2012-01-29 13:03:39

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2012-01-29 13:03:45

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2012-01-29 23:35:41

[attachment:11235_doc.patch] needs review.


---

Comment by mstreng created at 2012-01-30 10:27:42

Thanks Jeroen


---

Comment by mstreng created at 2012-01-30 10:27:42

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-02-02 12:53:09

Resolution: fixed


---

Comment by jdemeyer created at 2012-03-04 20:43:20

spkg contains garbage:

```
jdemeyer`@`sage:~/spkg/ipython-0.10.2.p1$ hg status
? .spkg-install.swp
```


Fixed at [http://boxen.math.washington.edu/home/jdemeyer/spkg/ipython-0.10.2.p1.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/ipython-0.10.2.p1.spkg)


---

Comment by jdemeyer created at 2012-03-06 08:13:41

The spkg wasn't `qfinish`ed, fixed this also.
