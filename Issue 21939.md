# Issue 21939: Add towncrier.ini file

Issue created by migration from https://trac.sagemath.org/ticket/22176

Original creator: rws

Original creation time: 2017-01-12 07:58:55

CC:  embray slelievre egourgoulhon mkoeppe

As suggested in https://groups.google.com/forum/?hl=en#!topic/sage-devel/81qsOpoOKMM towncrier could be used by the release manager to generate a nice NEWS file. The ticket will add a suitable configuration file.


---

Comment by rws created at 2017-01-12 08:17:09

New commits:


---

Comment by rws created at 2017-01-12 08:17:09

Changing status from new to needs_review.


---

Comment by slelievre created at 2018-05-12 06:56:50

Changing keywords from "" to "changelog, towncrier".


---

Comment by jdemeyer created at 2018-05-12 12:14:21

Do you really want `Sage` with the capital letter? Having both `sage` and `Sage` in the same directory looks like a recipe for trouble.

More importantly, this ticket only solves a trivial technical aspect of release notes. Who will ensure that those news fragments get written? I can already see the 8.3 release with just one item in the changelog: `Towncrier is used to produce NEWS`.


---

Comment by rws created at 2018-05-12 12:29:36

Replying to [comment:5 jdemeyer]:
> More importantly, this ticket only solves a trivial technical aspect of release notes. Who will ensure that those news fragments get written? I can already see the 8.3 release with just one item in the changelog: `Towncrier is used to produce NEWS`.

This ticket solves the problem of those authors that want to have such a line. If you are not such an author, well. Why would you want to enforce it? How can a ticket enforce a policy? Your ticket criticisms are sometimes not thought out and have the appearance of being only for the sake of it, I have the impression.


---

Comment by jdemeyer created at 2018-05-12 12:52:06

Replying to [comment:6 rws]:
> This ticket solves the problem of those authors that want to have such a line. If you are not such an author, well.

I don't see the point of having a very incomplete `NEWS` file. We currently have a "changelog" in Sage which lists the titles of the merged tickets. This is already somewhat helpful, but there is room for improvement.

So if you want to propose something new, like towncrier, it should at least improve on the existing functionality. So you need to convince me why towncrier, listing just a few tickets, is better than the changelog which lists at least every ticket.

> How can a ticket enforce a policy?

It cannot. Only the release manager (or by extension his scripts) can do that.

> have the appearance of being only for the sake of it

I can assure you that this is not the case. It's not that I enjoy complaining. It's more that I feel forced to point out these obvious flaws with your proposal, because nobody else has done that.

For the record: I am absolutely in favour of using something like towncrier. But this Trac ticket by itself does nothing: there needs to be a consensus on sage-devel on how to handle this. There should be a policy about it. Most importantly, the release manager must get involved: his scripts must be updated to enforce whatever policy we decide.


---

Comment by embray created at 2018-05-14 15:16:12

Thanks, I had forgotten about this ticket.  I'm definitely in favor, though we also need to agree on and document (in the developer docs) some policy for using it, and update the release scripts to generate a NEWS file.


---

Comment by embray created at 2018-05-14 15:21:28

Replying to [comment:6 rws]:
> Replying to [comment:5 jdemeyer]:
> > More importantly, this ticket only solves a trivial technical aspect of release notes. Who will ensure that those news fragments get written? I can already see the 8.3 release with just one item in the changelog: `Towncrier is used to produce NEWS`.
> 
> This ticket solves the problem of those authors that want to have such a line. If you are not such an author, well. Why would you want to enforce it? How can a ticket enforce a policy?

In fact there is a checklist the release manager goes through before reviewing a ticket.  Unfortunately that checklist is hard to find and not well published on tickets (it should be).
There should be a note (perhaps in the keywords field, or elsewhere on the ticket) specifying whether or not a NEWS entry should be required for the ticket.  There are cases where it is not needed; e.g. fixing bugs that only occur between development releases.  I would only bother with things that changed between major releases, personally.

Ultimately it's up to the release manager to make this determination, but the author of the ticket, if they know well-enough, can and should help with this.  (To give a concrete example, cpython uses a [skip news](https://github.com/python/cpython/pull/4147) label for issues that don't require a news entry; personally I prefer the opposite--a flag explicitly indicating that a news entry is needed--but that's a bikeshed.)


---

Comment by embray created at 2018-05-14 15:28:07

Replying to [comment:7 jdemeyer]:
> For the record: I am absolutely in favour of using something like towncrier. But this Trac ticket by itself does nothing: there needs to be a consensus on sage-devel on how to handle this. There should be a policy about it. Most importantly, the release manager must get involved: his scripts must be updated to enforce whatever policy we decide.

The "updating scripts" aspect of this should probably be as simple as updating `src/bin/sage-update-version` to run towncrier, output the appropriate NEWS file, and add it to the files to commit along with the release commit (and perhaps clean up the old news fragments).

I also agree that `src/Sage` is asking for trouble.  Plus, I believe there is cause for news items for both sage-the-distribution and sage-the-library.  I would prefer to keep those separate personally, so I think it makes sense to have both a top-level `NEWS` file and a `src/NEWS` file for changes specifically to Sage (thus separate config files and fragment directories for each).

It would also probably be good to output an rst-formatted version of this file to somewhere that can be included by the Sphinx docs.  It's very nice to have HTML-formatted changelogs with a table of contents for releases.


---

Comment by jdemeyer created at 2018-05-14 17:07:41

Can we re-use Trac for the `NEWS` entries? Given that every issue goes through Trac, having a "Changelog:" field on Trac which is then scraped by the release scripts would be awesome. I think it would work better than a file in the git repo because it would be so easy to edit: a reviewer could easily fix the changelog if it would be on Trac. Plus, you get the bijection between changelog entries and Trac tickets for free.


---

Comment by embray created at 2018-05-14 17:46:02

Replying to [comment:11 jdemeyer]:
> Can we re-use Trac for the `NEWS` entries? Given that every issue goes through Trac, having a "Changelog:" field on Trac which is then scraped by the release scripts would be awesome. I think it would work better than a file in the git repo because it would be so easy to edit: a reviewer could easily fix the changelog if it would be on Trac. Plus, you get the bijection between changelog entries and Trac tickets for free.

Yes, that is another option.  I'd be happy with that.  The script can simply get all closed (as fixed) tickets for the milestone of the release and generate a report from that.  That also has the advantage that classification (e.g. bugs, features) can also be gleaned from the Trac ticket.  I could write such a script very easily.


---

Comment by rws created at 2018-05-15 03:17:33

Fine. Please go ahead.


---

Comment by jdemeyer created at 2018-05-15 13:47:43

We still need a policy about that changelog-on-Trac. I would propose the following (also for backwards compatibility):

- By default, every ticket has a changelog entry.

- If there is a changelog on Trac, use that.

- If there is no changelog on Trac, use the ticket title instead (which is what we've been doing so far for the release notes).

- We define a special reserved value for the Trac changelog (say `none`) to indicate that a ticket should not be in the changelog at all.


---

Comment by embray created at 2018-05-15 14:10:36

Replying to [comment:14 jdemeyer]:
> We still need a policy about that changelog-on-Trac. I would propose the following (also for backwards compatibility):
> 
> - By default, every ticket has a changelog entry.
> 
> - If there is a changelog on Trac, use that.
> 
> - If there is no changelog on Trac, use the ticket title instead (which is what we've been doing so far for the release notes).
> 
> - We define a special reserved value for the Trac changelog (say `none`) to indicate that a ticket should not be in the changelog at all.

I think that's reasonable.  I would prefer that instead of "If there is no changelog on Trac, use the ticket title instead" that writing a changelog message is actually enforced.  The ticket title is _sometimes_ useful but often not.  I fear this would lead to laziness about writing changelog entries (something I am personally just as susceptible to if I don't force myself).  Fortunately, when the ticket title is nearly appropriate I've often found myself just copy/pasting it and perhaps reformatting it slightly as a sentence.

I can even update the Trac ticket workflow to require setting a changelog entry in order to move the ticket to positive_review, for example (it can also require setting Reviewer; something we should have always done).  Not every ticket requires a changelog entry.  In that case the reviewer may either fill in a special dummy value like "none" or "skip" as you suggested.  Or there can be a checkbox or label indicating that changelog can be skipped.


---

Comment by jdemeyer created at 2018-05-15 14:17:46

Yes, I fully agree with your last comment. The main point is that "no changelog" should _not_ be the default.


---

Comment by embray created at 2018-05-15 14:23:50

Whether or not it's the default I don't have strong opinions on because I think there are arguments either way, but I'm certainly good with having it required by default.

Another thing that needs to be decided is how frequently the changelog would be updated.  On _every beta_ or every final release?  Personally, I believe that between every beta is too much noise.  In my mind the intended audience of this is "casual" users who are not following Sage development closely.  For a list of changes between betas I think the list of included tickets that Volker already provides is sufficient.

However, if you publish a new changelog between final releases it can sometimes become a slightly difficult question whether or not to include a changelog entry for some change.  For new features this is obvious.  But for bug fixes you really have to determine whether or not that bug affected previous releases.  The good news is that with things like Docker and Binder we can easily go back to old releases and check things like this if we're unsure.  But sometimes it does at least require checking.


---

Comment by jdemeyer created at 2018-05-15 14:32:29

Replying to [comment:17 embray]:
> Personally, I believe that between every beta is too much noise.

On the other hand, updating it with every beta allows "beta-testing" the changelog itself. Suppose that I see a typo or something unclear in the changelog of some beta, I could change the changelog entry before the final release.


---

Comment by embray created at 2018-05-15 14:55:28

Replying to [comment:18 jdemeyer]:
> Replying to [comment:17 embray]:
> > Personally, I believe that between every beta is too much noise.
> 
> On the other hand, updating it with every beta allows "beta-testing" the changelog itself. Suppose that I see a typo or something unclear in the changelog of some beta, I could change the changelog entry before the final release.

Well, it would be good to _generate_ the changelog for every beta.  I just mean it would be too much noise to add entries to the changelog for every change between beta versions (particularly bug fixes that never affected a final release).


---

Comment by vdelecroix created at 2018-08-03 19:20:18

update milestone 8.3 -> 8.4


---

Comment by slelievre created at 2020-09-11 02:02:35

Changing status from needs_review to needs_work.
