# Issue 11031: Point users of solve() to the to_poly_solve option

archive/issues_011031.json:
```json
{
    "body": "Assignee: was\n\nCC:  kcrisman\n\nKeywords: solve, maxima, to_poly_solve\n\nMany users of of the solve() function complain that Sage can't solve some simple equations, when in fact it can if the `to_poly_solve=True` option is passed. See, for example:\n\n[http://ask.sagemath.org/question/506/solving-complex-equation](http://ask.sagemath.org/question/506/solving-complex-equation)\n\n\n```\nsage: z = var('z')\nsage: solve(sin(z) + cos(z) == 2, z)\n[sin(z) == -cos(z) + 2]\n```\n\n\nI propose that when Maxima returns an implicit solution, solve() should display an informative message to the user about the existence of the `to_poly_solve` parameter.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/11201\n\n",
    "created_at": "2011-04-14T19:20:07Z",
    "labels": [
        "interfaces",
        "minor",
        "enhancement"
    ],
    "title": "Point users of solve() to the to_poly_solve option",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11031",
    "user": "benjaminfjones"
}
```
Assignee: was

CC:  kcrisman

Keywords: solve, maxima, to_poly_solve

Many users of of the solve() function complain that Sage can't solve some simple equations, when in fact it can if the `to_poly_solve=True` option is passed. See, for example:

[http://ask.sagemath.org/question/506/solving-complex-equation](http://ask.sagemath.org/question/506/solving-complex-equation)


```
sage: z = var('z')
sage: solve(sin(z) + cos(z) == 2, z)
[sin(z) == -cos(z) + 2]
```


I propose that when Maxima returns an implicit solution, solve() should display an informative message to the user about the existence of the `to_poly_solve` parameter.


Issue created by migration from https://trac.sagemath.org/ticket/11201





---

archive/issue_comments_120197.json:
```json
{
    "body": "I further propose that this ticket should clarify all the options involved - I still don't get the !use_grobner one.",
    "created_at": "2011-04-14T19:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11031#issuecomment-120197",
    "user": "kcrisman"
}
```

I further propose that this ticket should clarify all the options involved - I still don't get the !use_grobner one.



---

archive/issue_comments_120198.json:
```json
{
    "body": "Changing keywords from \"solve, maxima, to_poly_solve\" to \"solve, maxima, to_poly_solve, beginner\".",
    "created_at": "2011-04-14T19:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11031#issuecomment-120198",
    "user": "kcrisman"
}
```

Changing keywords from "solve, maxima, to_poly_solve" to "solve, maxima, to_poly_solve, beginner".



---

archive/issue_comments_120199.json:
```json
{
    "body": "solve documentation fix",
    "created_at": "2012-04-01T19:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11031#issuecomment-120199",
    "user": "afleckenstein"
}
```

solve documentation fix



---

archive/issue_comments_120200.json:
```json
{
    "body": "Attachment [trac_11201_solve_documentation_enhancements.patch](tarball://root/attachments/some-uuid/ticket11201/trac_11201_solve_documentation_enhancements.patch) by afleckenstein created at 2012-04-01 19:38:50\n\nThe patch I have created does two main things. First, it modifies the documentation in sage.symbolic.expression.Expression.solve and sage.symbolic.relation.solve to convey mostly the same information, as well as include all of the options (including 'use_grobner'.) Second, \nit gives the user a clue when explicit results are not found. Specifically, it points the user to the to_poly_solve option, per benjaminfjones's request. I don't know if this should be included, as it gets monotonous to see the message over and over again very quickly.",
    "created_at": "2012-04-01T19:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11031#issuecomment-120200",
    "user": "afleckenstein"
}
```

Attachment [trac_11201_solve_documentation_enhancements.patch](tarball://root/attachments/some-uuid/ticket11201/trac_11201_solve_documentation_enhancements.patch) by afleckenstein created at 2012-04-01 19:38:50

The patch I have created does two main things. First, it modifies the documentation in sage.symbolic.expression.Expression.solve and sage.symbolic.relation.solve to convey mostly the same information, as well as include all of the options (including 'use_grobner'.) Second, 
it gives the user a clue when explicit results are not found. Specifically, it points the user to the to_poly_solve option, per benjaminfjones's request. I don't know if this should be included, as it gets monotonous to see the message over and over again very quickly.



---

archive/issue_comments_120201.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-04-02T15:16:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11031#issuecomment-120201",
    "user": "kcrisman"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_120202.json:
```json
{
    "body": "A few comments.\n* One of the examples is over-indented\n* The examples in the global `solve` should be somehow marked as only applying to single expressions, not lists of expressions (and in particular `multiplicities` only does, I think)\n* The error message or whatever you call it should be doctested\n\nBut this is well on the way to a great addition, thank you for taking the time to do something tedious but necessary.  Please feel free to add yourself to the main list of Trac users, and please put your name as you desire it in Authors below.",
    "created_at": "2012-04-02T15:16:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11031#issuecomment-120202",
    "user": "kcrisman"
}
```

A few comments.
* One of the examples is over-indented
* The examples in the global `solve` should be somehow marked as only applying to single expressions, not lists of expressions (and in particular `multiplicities` only does, I think)
* The error message or whatever you call it should be doctested

But this is well on the way to a great addition, thank you for taking the time to do something tedious but necessary.  Please feel free to add yourself to the main list of Trac users, and please put your name as you desire it in Authors below.



---

archive/issue_comments_120203.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-04-02T15:16:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11031#issuecomment-120203",
    "user": "kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_120204.json:
```json
{
    "body": "That's a good start. Thanks for the contribution!\n\nI started looking at the patch and I have a couple of comments. First, I tried running doctests on `sage/symbolic/expression.pyx` and there are a lot of new failures due to the unexpected info message that's been added. For example,\n\n\n```\njonesbe@macbook ~/sage/latest/devel/sage> ../../sage -t sage/symbolic/expression.pyx\nsage -t  \"devel/sage-test/sage/symbolic/expression.pyx\"     \n**********************************************************************\nFile \"/Users/jonesbe/sage/sage-5.0.beta12/devel/sage-test/sage/symbolic/expression.pyx\", line 7761:\n    sage: f.roots(x)\nExpected:\n    [(a, 1), (-I, 1), (I, 1), (1, 3), (-1, 3)]\nGot:\n    For explicit results, try setting the 'to_poly_solve' keyword to True.\n    [(a, 1), (-I, 1), (I, 1), (1, 3), (-1, 3)]\n```\n\n\nThere might be other doctest failures besides ones related to the new message, I don't have time to look through them all right now.\n\n-----\n\nI'm still not sure what exactly setting `to_poly_solve='use_grobner=true'` does. Consider the following Sage-5.0.beta12 session (with your patch applied):\n\nHere is what Maxima (5.26.0) does:\n\n```\nsage: maxima('load(to_poly_solver)')\n\"/Users/jonesbe/sage/sage-5.0.beta12/local/share/maxima/5.26.0/share/contrib/to_poly_solver.mac\"\nsage: maxima('to_poly_solve([x^2+y^2=2^2,(x-1)^2+(y-1)^2=2^2],[x,y]);')\n%union()\nsage: maxima('to_poly_solve([x^2+y^2=2^2,(x-1)^2+(y-1)^2=2^2],[x,y],use_grobner=true);')\n%union([x=-(sqrt(7)-1)/2,y=(sqrt(7)+1)/2],[x=(sqrt(7)+1)/2,y=-(sqrt(7)-1)/2])\n```\n\n\nHere is what Sage does (same system of equations, same options):\n\n```\nsage: solve(x == sqrt(x+1), x)\nFor explicit results, try setting the 'to_poly_solve' keyword to True.\n[x == sqrt(x + 1)]\nsage: solve(x == sqrt(x+1), x, to_poly_solve=True)\nFor explicit results, try setting the 'to_poly_solve' keyword to True.\n[x == 1/2*sqrt(5) + 1/2]\nsage: solve(x == sqrt(x+1), x, to_poly_solve='use_grobner=true')\nFor explicit results, try setting the 'to_poly_solve' keyword to True.\n[x == 1/2*sqrt(5) + 1/2]\n```\n\n\nSo it seems like `use_grobner` has no effect, despite it having an effect in Maxima. Is it always set to true when `to_poly_solve=True` is specified? If so, we should really get rid of this confusing solve option. If there is a good example where it actually has an effect, that should be added to the EXAMPLES:: section in the solve docs. The example illustrating it right now doesn't change if you set `to_poly_solve=True` instead of `to_poly_solve='use_grobner=true'`:\n\n\n```\nsage: solve(x == sqrt(x+1), x)\nFor explicit results, try setting the 'to_poly_solve' keyword to True.\n[x == sqrt(x + 1)]\nsage: solve(x == sqrt(x+1), x, to_poly_solve=True)\nFor explicit results, try setting the 'to_poly_solve' keyword to True.\n[x == 1/2*sqrt(5) + 1/2]\nsage: solve(x == sqrt(x+1), x, to_poly_solve='use_grobner=true')\nFor explicit results, try setting the 'to_poly_solve' keyword to True.\n[x == 1/2*sqrt(5) + 1/2]\n```\n\n\nLast comment: I think the info message should not be printed when I do give `to_poly_solve=` a value (see last two commands in the last session).",
    "created_at": "2012-04-06T18:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11031#issuecomment-120204",
    "user": "benjaminfjones"
}
```

That's a good start. Thanks for the contribution!

I started looking at the patch and I have a couple of comments. First, I tried running doctests on `sage/symbolic/expression.pyx` and there are a lot of new failures due to the unexpected info message that's been added. For example,


```
jonesbe@macbook ~/sage/latest/devel/sage> ../../sage -t sage/symbolic/expression.pyx
sage -t  "devel/sage-test/sage/symbolic/expression.pyx"     
**********************************************************************
File "/Users/jonesbe/sage/sage-5.0.beta12/devel/sage-test/sage/symbolic/expression.pyx", line 7761:
    sage: f.roots(x)
Expected:
    [(a, 1), (-I, 1), (I, 1), (1, 3), (-1, 3)]
Got:
    For explicit results, try setting the 'to_poly_solve' keyword to True.
    [(a, 1), (-I, 1), (I, 1), (1, 3), (-1, 3)]
```


There might be other doctest failures besides ones related to the new message, I don't have time to look through them all right now.

-----

I'm still not sure what exactly setting `to_poly_solve='use_grobner=true'` does. Consider the following Sage-5.0.beta12 session (with your patch applied):

Here is what Maxima (5.26.0) does:

```
sage: maxima('load(to_poly_solver)')
"/Users/jonesbe/sage/sage-5.0.beta12/local/share/maxima/5.26.0/share/contrib/to_poly_solver.mac"
sage: maxima('to_poly_solve([x^2+y^2=2^2,(x-1)^2+(y-1)^2=2^2],[x,y]);')
%union()
sage: maxima('to_poly_solve([x^2+y^2=2^2,(x-1)^2+(y-1)^2=2^2],[x,y],use_grobner=true);')
%union([x=-(sqrt(7)-1)/2,y=(sqrt(7)+1)/2],[x=(sqrt(7)+1)/2,y=-(sqrt(7)-1)/2])
```


Here is what Sage does (same system of equations, same options):

```
sage: solve(x == sqrt(x+1), x)
For explicit results, try setting the 'to_poly_solve' keyword to True.
[x == sqrt(x + 1)]
sage: solve(x == sqrt(x+1), x, to_poly_solve=True)
For explicit results, try setting the 'to_poly_solve' keyword to True.
[x == 1/2*sqrt(5) + 1/2]
sage: solve(x == sqrt(x+1), x, to_poly_solve='use_grobner=true')
For explicit results, try setting the 'to_poly_solve' keyword to True.
[x == 1/2*sqrt(5) + 1/2]
```


So it seems like `use_grobner` has no effect, despite it having an effect in Maxima. Is it always set to true when `to_poly_solve=True` is specified? If so, we should really get rid of this confusing solve option. If there is a good example where it actually has an effect, that should be added to the EXAMPLES:: section in the solve docs. The example illustrating it right now doesn't change if you set `to_poly_solve=True` instead of `to_poly_solve='use_grobner=true'`:


```
sage: solve(x == sqrt(x+1), x)
For explicit results, try setting the 'to_poly_solve' keyword to True.
[x == sqrt(x + 1)]
sage: solve(x == sqrt(x+1), x, to_poly_solve=True)
For explicit results, try setting the 'to_poly_solve' keyword to True.
[x == 1/2*sqrt(5) + 1/2]
sage: solve(x == sqrt(x+1), x, to_poly_solve='use_grobner=true')
For explicit results, try setting the 'to_poly_solve' keyword to True.
[x == 1/2*sqrt(5) + 1/2]
```


Last comment: I think the info message should not be printed when I do give `to_poly_solve=` a value (see last two commands in the last session).



---

archive/issue_comments_120205.json:
```json
{
    "body": "Changing component from interfaces to documentation.",
    "created_at": "2012-07-07T04:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11031#issuecomment-120205",
    "user": "kcrisman"
}
```

Changing component from interfaces to documentation.



---

archive/issue_comments_120206.json:
```json
{
    "body": "Replying to [comment:6 benjaminfjones]:\n> Here is what Sage does (same system of equations, same options):\nUsing the same system of equations in sage does this:\n\n\n```\nsage: y=var('y')\nsage: solve([x^2+y^2==2^2, (x-1)^2+(y-1)^2==2^2], [x, y], to_poly_solve=True)\n[[x == -1/2*sqrt(7) + 1/2, y == 1/2*sqrt(7) + 1/2], [x == 1/2*sqrt(7) + 1/2, y == -1/2*sqrt(7) + 1/2]]\n```\n\n\nI'm sure this is what you meant :-)\n\nWhich makes is seem that use_grobner *is* set to true automatically if to_poly_solve is set to true.\nI think we should forget about printing a message and just focus on fixing the documentation, but I ran into a bit of a dead end with #12809. I guess the failing doctests could be rewritten, or a shorter message could be added in the documentation (e.g. \"If you don't get explicit results, try setting to_poly_solve to True.\")",
    "created_at": "2012-12-13T13:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11031#issuecomment-120206",
    "user": "afleckenstein"
}
```

Replying to [comment:6 benjaminfjones]:
> Here is what Sage does (same system of equations, same options):
Using the same system of equations in sage does this:


```
sage: y=var('y')
sage: solve([x^2+y^2==2^2, (x-1)^2+(y-1)^2==2^2], [x, y], to_poly_solve=True)
[[x == -1/2*sqrt(7) + 1/2, y == 1/2*sqrt(7) + 1/2], [x == 1/2*sqrt(7) + 1/2, y == -1/2*sqrt(7) + 1/2]]
```


I'm sure this is what you meant :-)

Which makes is seem that use_grobner *is* set to true automatically if to_poly_solve is set to true.
I think we should forget about printing a message and just focus on fixing the documentation, but I ran into a bit of a dead end with #12809. I guess the failing doctests could be rewritten, or a shorter message could be added in the documentation (e.g. "If you don't get explicit results, try setting to_poly_solve to True.")



---

archive/issue_comments_120207.json:
```json
{
    "body": "Removing the \"beginner\" tag from old tickets. Some could be returned to beginner-friendly status by adding a comment about what needs to be done. Some others might be easy for an experienced developer to finish.",
    "created_at": "2020-05-27T02:57:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11031#issuecomment-120207",
    "user": "@DaveWitteMorris"
}
```

Removing the "beginner" tag from old tickets. Some could be returned to beginner-friendly status by adding a comment about what needs to be done. Some others might be easy for an experienced developer to finish.



---

archive/issue_comments_120208.json:
```json
{
    "body": "Changing keywords from \"solve, maxima, to_poly_solve, beginner\" to \"solve, maxima, to_poly_solve\".",
    "created_at": "2020-05-27T02:57:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11031#issuecomment-120208",
    "user": "@DaveWitteMorris"
}
```

Changing keywords from "solve, maxima, to_poly_solve, beginner" to "solve, maxima, to_poly_solve".
