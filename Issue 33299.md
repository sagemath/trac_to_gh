# Issue 33299: some changes suggested by lgtm

Issue created by migration from https://trac.sagemath.org/ticket/33536

Original creator: chapoton

Original creation time: 2022-03-20 19:54:10

CC:  tscrim slelievre @kliem

namely, caution about arguments with default value `{}`


---

Comment by chapoton created at 2022-03-20 19:54:46

New commits:


---

Comment by chapoton created at 2022-03-20 19:54:46

Changing status from new to needs_review.


---

Comment by chapoton created at 2022-03-21 07:30:22

we have a green bot, so please review (easy one, I think)


---

Comment by klee created at 2022-03-21 07:56:53

I don't understand how this improves the situation

```diff
-        check = kwds.pop('check', True)
-        if args or kwds:
+        check = kwds.get('check', True)
+        if args or any(key != 'check' for key in kwds):
```

Would you explain?


---

Comment by klee created at 2022-03-21 07:59:58

I didn't mean to delete cc's. Sorry.


---

Comment by chapoton created at 2022-03-21 08:07:07

One should not pop from the default value of `kwds`, because this modifies this default value.


---

Comment by klee created at 2022-03-21 08:21:23

Replying to [comment:5 chapoton]:
> One should not pop from the default value of `kwds`, because this modifies this default value.

I see. But in this case, the default is an empty dict and there actually occurs no pop to the default. On the other hand, the condition check on the second line is more complicated than the original. So we lose a tiny bit while fixing nothing. No?


---

Comment by chapoton created at 2022-03-21 08:33:13

indeed. But in my opinion, it is a safe idea to never ever modify the default argument.

The idea is to fix the warning issued by "lgtm":

https://lgtm.com/projects/g/sagemath/sage/alerts/?mode=tree&severity=error&ruleFocus=4840097

One could argue that the case of "empty dict" and "pop" needs no correction, but it seems to me that one can fix this little issue, despite its trivial nature.


---

Comment by klee created at 2022-03-21 08:44:58

Okay. I guess the tiny bit lost is really tiny, and we get cleaner code instead.

I would let others have time to review.


---

Comment by slelievre created at 2022-03-21 21:50:28

In `src/sage/rings/fraction_field.py`, maybe change:


```diff
-    def _call_with_args(self, x, args=(), kwds={}):
+    def _call_with_args(self, x, args=(), kwds=None):
         r"""
-        Evaluation this map at ``x``.
+        Evaluate this map at ``x``.

         INPUT:

         - ``check`` -- whether or not to check

         EXAMPLES::

             sage: R.<x> = QQ[]
             sage: K = R.fraction_field()
             sage: R(K.gen(), check=True)
             x
-
         """
+        if kwds is None:
+            kwds = {}
         check = kwds.get('check', True)
         if args or any(key != 'check' for key in kwds):
             raise NotImplementedError("__call__ cannot be called with additional arguments other than check=True/False")
         return self._call_(x, check=check)
```



---

Comment by git created at 2022-03-22 07:20:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-03-22 07:22:59

Changing to `kwds=None` here is not compatible with the C type declaration. And this C-type cannot be changed without changing many things in many files. So, not for here.


---

Comment by chapoton created at 2022-03-24 14:53:47

review please


---

Comment by klee created at 2022-03-24 21:26:37

LGTM.


---

Comment by klee created at 2022-03-24 21:26:37

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-04-02 10:53:15

Resolution: fixed
