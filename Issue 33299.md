# Issue 33299: some changes suggested by lgtm

archive/issues_033299.json:
```json
{
    "body": "CC:  @tscrim @slel @kliem\n\nnamely, caution about arguments with default value `{}`\n\nIssue created by migration from https://trac.sagemath.org/ticket/33536\n\n",
    "created_at": "2022-03-20T19:54:10Z",
    "labels": [
        "refactoring",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "some changes suggested by lgtm",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33299",
    "user": "@fchapoton"
}
```
CC:  @tscrim @slel @kliem

namely, caution about arguments with default value `{}`

Issue created by migration from https://trac.sagemath.org/ticket/33536





---

archive/issue_comments_474072.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-03-20T19:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33299#issuecomment-474072",
    "user": "@fchapoton"
}
```

New commits:



---

archive/issue_comments_474073.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-03-20T19:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33299#issuecomment-474073",
    "user": "@fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_474074.json:
```json
{
    "body": "we have a green bot, so please review (easy one, I think)",
    "created_at": "2022-03-21T07:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33299#issuecomment-474074",
    "user": "@fchapoton"
}
```

we have a green bot, so please review (easy one, I think)



---

archive/issue_comments_474075.json:
```json
{
    "body": "I don't understand how this improves the situation\n\n```diff\n-        check = kwds.pop('check', True)\n-        if args or kwds:\n+        check = kwds.get('check', True)\n+        if args or any(key != 'check' for key in kwds):\n```\n\nWould you explain?",
    "created_at": "2022-03-21T07:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33299#issuecomment-474075",
    "user": "@kwankyu"
}
```

I don't understand how this improves the situation

```diff
-        check = kwds.pop('check', True)
-        if args or kwds:
+        check = kwds.get('check', True)
+        if args or any(key != 'check' for key in kwds):
```

Would you explain?



---

archive/issue_comments_474076.json:
```json
{
    "body": "I didn't mean to delete cc's. Sorry.",
    "created_at": "2022-03-21T07:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33299#issuecomment-474076",
    "user": "@kwankyu"
}
```

I didn't mean to delete cc's. Sorry.



---

archive/issue_comments_474077.json:
```json
{
    "body": "One should not pop from the default value of `kwds`, because this modifies this default value.",
    "created_at": "2022-03-21T08:07:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33299#issuecomment-474077",
    "user": "@fchapoton"
}
```

One should not pop from the default value of `kwds`, because this modifies this default value.



---

archive/issue_comments_474078.json:
```json
{
    "body": "Replying to [comment:5 chapoton]:\n> One should not pop from the default value of `kwds`, because this modifies this default value.\n\nI see. But in this case, the default is an empty dict and there actually occurs no pop to the default. On the other hand, the condition check on the second line is more complicated than the original. So we lose a tiny bit while fixing nothing. No?",
    "created_at": "2022-03-21T08:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33299#issuecomment-474078",
    "user": "@kwankyu"
}
```

Replying to [comment:5 chapoton]:
> One should not pop from the default value of `kwds`, because this modifies this default value.

I see. But in this case, the default is an empty dict and there actually occurs no pop to the default. On the other hand, the condition check on the second line is more complicated than the original. So we lose a tiny bit while fixing nothing. No?



---

archive/issue_comments_474079.json:
```json
{
    "body": "indeed. But in my opinion, it is a safe idea to never ever modify the default argument.\n\nThe idea is to fix the warning issued by \"lgtm\":\n\nhttps://lgtm.com/projects/g/sagemath/sage/alerts/?mode=tree&severity=error&ruleFocus=4840097\n\nOne could argue that the case of \"empty dict\" and \"pop\" needs no correction, but it seems to me that one can fix this little issue, despite its trivial nature.",
    "created_at": "2022-03-21T08:33:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33299#issuecomment-474079",
    "user": "@fchapoton"
}
```

indeed. But in my opinion, it is a safe idea to never ever modify the default argument.

The idea is to fix the warning issued by "lgtm":

https://lgtm.com/projects/g/sagemath/sage/alerts/?mode=tree&severity=error&ruleFocus=4840097

One could argue that the case of "empty dict" and "pop" needs no correction, but it seems to me that one can fix this little issue, despite its trivial nature.



---

archive/issue_comments_474080.json:
```json
{
    "body": "Okay. I guess the tiny bit lost is really tiny, and we get cleaner code instead.\n\nI would let others have time to review.",
    "created_at": "2022-03-21T08:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33299#issuecomment-474080",
    "user": "@kwankyu"
}
```

Okay. I guess the tiny bit lost is really tiny, and we get cleaner code instead.

I would let others have time to review.



---

archive/issue_comments_474081.json:
```json
{
    "body": "In `src/sage/rings/fraction_field.py`, maybe change:\n\n\n```diff\n-    def _call_with_args(self, x, args=(), kwds={}):\n+    def _call_with_args(self, x, args=(), kwds=None):\n         r\"\"\"\n-        Evaluation this map at ``x``.\n+        Evaluate this map at ``x``.\n\n         INPUT:\n\n         - ``check`` -- whether or not to check\n\n         EXAMPLES::\n\n             sage: R.<x> = QQ[]\n             sage: K = R.fraction_field()\n             sage: R(K.gen(), check=True)\n             x\n-\n         \"\"\"\n+        if kwds is None:\n+            kwds = {}\n         check = kwds.get('check', True)\n         if args or any(key != 'check' for key in kwds):\n             raise NotImplementedError(\"__call__ cannot be called with additional arguments other than check=True/False\")\n         return self._call_(x, check=check)\n```\n",
    "created_at": "2022-03-21T21:50:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33299#issuecomment-474081",
    "user": "@slel"
}
```

In `src/sage/rings/fraction_field.py`, maybe change:


```diff
-    def _call_with_args(self, x, args=(), kwds={}):
+    def _call_with_args(self, x, args=(), kwds=None):
         r"""
-        Evaluation this map at ``x``.
+        Evaluate this map at ``x``.

         INPUT:

         - ``check`` -- whether or not to check

         EXAMPLES::

             sage: R.<x> = QQ[]
             sage: K = R.fraction_field()
             sage: R(K.gen(), check=True)
             x
-
         """
+        if kwds is None:
+            kwds = {}
         check = kwds.get('check', True)
         if args or any(key != 'check' for key in kwds):
             raise NotImplementedError("__call__ cannot be called with additional arguments other than check=True/False")
         return self._call_(x, check=check)
```




---

archive/issue_comments_474082.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-22T07:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33299#issuecomment-474082",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474083.json:
```json
{
    "body": "Changing to `kwds=None` here is not compatible with the C type declaration. And this C-type cannot be changed without changing many things in many files. So, not for here.",
    "created_at": "2022-03-22T07:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33299#issuecomment-474083",
    "user": "@fchapoton"
}
```

Changing to `kwds=None` here is not compatible with the C type declaration. And this C-type cannot be changed without changing many things in many files. So, not for here.



---

archive/issue_comments_474084.json:
```json
{
    "body": "review please",
    "created_at": "2022-03-24T14:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33299#issuecomment-474084",
    "user": "@fchapoton"
}
```

review please



---

archive/issue_comments_474085.json:
```json
{
    "body": "LGTM.",
    "created_at": "2022-03-24T21:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33299#issuecomment-474085",
    "user": "@kwankyu"
}
```

LGTM.



---

archive/issue_comments_474086.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-24T21:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33299#issuecomment-474086",
    "user": "@kwankyu"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_474087.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-04-02T10:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33299#issuecomment-474087",
    "user": "@vbraun"
}
```

Resolution: fixed
