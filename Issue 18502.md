# Issue 18502: Wrap PARI functions for converting relative number field elements

Issue created by migration from Trac.

Original creator: pbruin

Original creation time: 2015-06-19 19:21:49

Keywords: pari

Wrap the PARI library functions `nf_rnfeq`, `eltabstorel`, `eltabstorel_lift` and `eltreltoabs`.  These provide a slightly lower-level interface to `rnfeltabstorel` and `rnfeltreltoabs`, and have the advantage that one can avoid initialising a full PARI `rnf` structure.  This functionality will be used in a follow-up ticket.


---

Comment by pbruin created at 2015-06-19 19:46:22

Changing status from new to needs_review.


---

Comment by chapoton created at 2015-06-25 07:39:42

Looks good to me.

I have used this opportunity to
- correct one typo in the doc (missing `::`)
- put all `raise` statements into python3 syntax.

I you agree with these cosmetic changes, you can set a positive review on my behalf.
----
New commits:


---

Comment by jdemeyer created at 2015-06-25 07:46:05

I think you can remove `__xor__` completely, since it's inherited from `Element`.


---

Comment by jdemeyer created at 2015-06-25 07:46:05

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2015-06-25 07:51:10

Those functions you are adding should not be part of the public interface of `gen`, they are unsafe:

```
sage: pari(0).eltabstorel(0)
...
SignalError: Segmentation fault
```


If you really want to add them to `gen`, add an underscore (`_eltabstorel` instead of `eltabstorel`) to the method name and add a `WARNING` in the documentation that these are unsafe.


---

Comment by pbruin created at 2015-06-25 08:23:28

Replying to [comment:4 jdemeyer]:
> Those functions you are adding should not be part of the public interface of `gen`, they are unsafe:
> {{{
> sage: pari(0).eltabstorel(0)
> ...
> SignalError: Segmentation fault
> }}}
I can change this, but there are more methods like this:

```
sage: pari(0).pr_get_e()
...
SignalError: Segmentation fault
```

Maybe we should at some point make a better separation between functions that are also in GP (and do extra input checking) and PARI library functions (that crash when given wrong input).


---

Comment by jdemeyer created at 2015-06-25 08:42:43

Replying to [comment:5 pbruin]:
> {{{
> sage: pari(0).pr_get_e()
> ...
> SignalError: Segmentation fault
> }}}
I consider this a bug.

I think adding an underscore to all non-safe methods is an easy and good solution.


---

Comment by git created at 2015-07-01 22:00:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pbruin created at 2015-07-01 22:00:56

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2015-07-02 08:54:39

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2015-07-02 08:54:39

Please replace

```
This method may raise errors or
return undefined results if called with invalid arguments.
```

by

```
This method may segfault or
return undefined results if called with invalid arguments.
```


Modulo this, I give the ticket positive_review.


---

Comment by pbruin created at 2015-07-02 20:31:54

Replying to [comment:9 jdemeyer]:
> Please replace
> {{{
> This method may raise errors or
> return undefined results if called with invalid arguments.
> }}}
> by
> {{{
> This method may segfault or
> return undefined results if called with invalid arguments.
> }}}
I thought about phrasing it like that, but to me "segfault" (besides perhaps being somewhat cryptic to many users) makes it sound like Sage crashes if this is called with the wrong arguments.  In fact, the segmentation fault is caught and a `SignalError` is raised.  Also, it is entirely possible that PARI will throw other kinds of errors for certain inputs.


---

Comment by pbruin created at 2015-07-03 07:52:52

Changing status from needs_work to needs_review.


---

Comment by pbruin created at 2015-07-03 07:52:52

After some further thought, I still think "raise errors" is better than "segfault".  We could write a longer warning to explain what could happen on bad input, but I don't think it is worth the effort...


---

Comment by jdemeyer created at 2015-07-03 08:04:20

I still don't agree (whether or not Sage catches the segfault, it's still a segfault which should be avoided at all costs), but I won't obstruct...


---

Comment by jdemeyer created at 2015-07-03 08:04:20

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-07-03 22:14:21

Resolution: fixed
