# Issue 21848: Don't include gslcblas in gsl.pc

archive/issues_021848.json:
```json
{
    "body": "CC:  strogdon mjo\n\nWe should patch the default gsl.pc so it doesn't include `gslcblas`. Two main reasons:\n* It is distro friendly. We have to remove it from the output of gsl.pc is `module_list.py`. In distro (Gentoo for example) can ship gsl.pc without gslcblas. The current setup will fail in if gslcblas cannot be removed.\n* If someone really want to use gslcblas (possibly an external one) the current setup may strip it completely. \n\nIssue created by migration from https://trac.sagemath.org/ticket/22085\n\n",
    "created_at": "2016-12-21T01:41:18Z",
    "labels": [
        "build",
        "major",
        "bug"
    ],
    "title": "Don't include gslcblas in gsl.pc",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21848",
    "user": "fbissey"
}
```
CC:  strogdon mjo

We should patch the default gsl.pc so it doesn't include `gslcblas`. Two main reasons:
* It is distro friendly. We have to remove it from the output of gsl.pc is `module_list.py`. In distro (Gentoo for example) can ship gsl.pc without gslcblas. The current setup will fail in if gslcblas cannot be removed.
* If someone really want to use gslcblas (possibly an external one) the current setup may strip it completely. 

Issue created by migration from https://trac.sagemath.org/ticket/22085





---

archive/issue_comments_303339.json:
```json
{
    "body": "Not sure that will be included in 7.5. but it is a consequence of multiple things I have authored in the current release cycle including #20646 and #21625. It probably should have gone as QA in #20646 really and then I would done things slightly differently in #21625.\n----\nNew commits:",
    "created_at": "2016-12-21T01:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303339",
    "user": "fbissey"
}
```

Not sure that will be included in 7.5. but it is a consequence of multiple things I have authored in the current release cycle including #20646 and #21625. It probably should have gone as QA in #20646 really and then I would done things slightly differently in #21625.
----
New commits:



---

archive/issue_comments_303340.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-12-21T03:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303340",
    "user": "fbissey"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_303341.json:
```json
{
    "body": "What should be the correct output of pkg-config? Here, with this branch\n\n\n```\npkg-config --libs gsl\n-L/64bitdev/storage/sage-git_develop/sage/local/lib -lgsl -lm -lcblas -lm\n```\n\n\nSo it looks like its using `atlas` for `cblas`? I thought `openblas` was being used. Or is there a way to disable `atlas`?",
    "created_at": "2016-12-22T18:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303341",
    "user": "strogdon"
}
```

What should be the correct output of pkg-config? Here, with this branch


```
pkg-config --libs gsl
-L/64bitdev/storage/sage-git_develop/sage/local/lib -lgsl -lm -lcblas -lm
```


So it looks like its using `atlas` for `cblas`? I thought `openblas` was being used. Or is there a way to disable `atlas`?



---

archive/issue_comments_303342.json:
```json
{
    "body": "This ticket shouldn't make a difference in the cblas used. Indeed it looks like ATLAS, and the one I recently changed at that. Is this a building from scratch or an incremental build from an install that already had ATLAS? Do you have libopenblas* in local/lib?\n\nIn any case that's a valid output if ATLAS was selected, check local/lib/pkgconfig/cblas.pc to confirm that's the cblas you have installed.",
    "created_at": "2016-12-22T19:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303342",
    "user": "fbissey"
}
```

This ticket shouldn't make a difference in the cblas used. Indeed it looks like ATLAS, and the one I recently changed at that. Is this a building from scratch or an incremental build from an install that already had ATLAS? Do you have libopenblas* in local/lib?

In any case that's a valid output if ATLAS was selected, check local/lib/pkgconfig/cblas.pc to confirm that's the cblas you have installed.



---

archive/issue_comments_303343.json:
```json
{
    "body": "Replying to [comment:4 fbissey]:\n> This ticket shouldn't make a difference in the cblas used. Indeed it looks like ATLAS, and the one I recently changed at that. Is this a building from scratch or an incremental build from an install that already had ATLAS? Do you have libopenblas* in local/lib?\n> \nThis was an incremental build. I do have `libopenblas` in /local/lib.\n> In any case that's a valid output if ATLAS was selected, check local/lib/pkgconfig/cblas.pc to confirm that's the cblas you have installed.\nYes, `cblas.pc` is from ATLAS. So, do I have to build from scratch to get rid of ATLAS? This is a bit off-topic. This ticket looks OK and I believe to be necessary.",
    "created_at": "2016-12-22T19:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303343",
    "user": "strogdon"
}
```

Replying to [comment:4 fbissey]:
> This ticket shouldn't make a difference in the cblas used. Indeed it looks like ATLAS, and the one I recently changed at that. Is this a building from scratch or an incremental build from an install that already had ATLAS? Do you have libopenblas* in local/lib?
> 
This was an incremental build. I do have `libopenblas` in /local/lib.
> In any case that's a valid output if ATLAS was selected, check local/lib/pkgconfig/cblas.pc to confirm that's the cblas you have installed.
Yes, `cblas.pc` is from ATLAS. So, do I have to build from scratch to get rid of ATLAS? This is a bit off-topic. This ticket looks OK and I believe to be necessary.



---

archive/issue_comments_303344.json:
```json
{
    "body": "\n```\n./configure --blas=openblas\nmake\n```\n\nI am afraid that will re-build all blas dependencies - or at least it should, if it doesn't that's a new ticket. `configure` will be re-run by `make` but with the configuration options from the previous run of configure (before running make).",
    "created_at": "2016-12-22T19:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303344",
    "user": "fbissey"
}
```


```
./configure --blas=openblas
make
```

I am afraid that will re-build all blas dependencies - or at least it should, if it doesn't that's a new ticket. `configure` will be re-run by `make` but with the configuration options from the previous run of configure (before running make).



---

archive/issue_comments_303345.json:
```json
{
    "body": "Replying to [comment:6 fbissey]:\n> \n> {{{\n> ./configure --blas=openblas\n> make\n> }}}\n> I am afraid that will re-build all blas dependencies - or at least it should, if it doesn't that's a new ticket. `configure` will be re-run by `make` but with the configuration options from the previous run of configure (before running make).\nWhen I first noticed the ATLAS business that's what I tried, but I'm still left with cblas from atlas.",
    "created_at": "2016-12-22T19:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303345",
    "user": "strogdon"
}
```

Replying to [comment:6 fbissey]:
> 
> {{{
> ./configure --blas=openblas
> make
> }}}
> I am afraid that will re-build all blas dependencies - or at least it should, if it doesn't that's a new ticket. `configure` will be re-run by `make` but with the configuration options from the previous run of configure (before running make).
When I first noticed the ATLAS business that's what I tried, but I'm still left with cblas from atlas.



---

archive/issue_comments_303346.json:
```json
{
    "body": "Actually, I tried\n\n```\n./configure --with-blas=openblas\nmake\n```\n",
    "created_at": "2016-12-22T19:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303346",
    "user": "strogdon"
}
```

Actually, I tried

```
./configure --with-blas=openblas
make
```




---

archive/issue_comments_303347.json:
```json
{
    "body": "Should this\n\n```\n# GNU Scientific Library\n# Note we remove the built-in gslcblas\n# The above cblas should already be in the list thanks to #20646\n```\n\nbe modified in `src/module_list.py`?",
    "created_at": "2016-12-22T19:57:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303347",
    "user": "strogdon"
}
```

Should this

```
# GNU Scientific Library
# Note we remove the built-in gslcblas
# The above cblas should already be in the list thanks to #20646
```

be modified in `src/module_list.py`?



---

archive/issue_comments_303348.json:
```json
{
    "body": "Replying to [comment:9 strogdon]:\n> Should this\n> {{{\n> # GNU Scientific Library\n> # Note we remove the built-in gslcblas\n> # The above cblas should already be in the list thanks to #20646\n> }}}\n> be modified in `src/module_list.py`?\n\nIndeed I should make my comments appropriate.",
    "created_at": "2016-12-22T21:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303348",
    "user": "fbissey"
}
```

Replying to [comment:9 strogdon]:
> Should this
> {{{
> # GNU Scientific Library
> # Note we remove the built-in gslcblas
> # The above cblas should already be in the list thanks to #20646
> }}}
> be modified in `src/module_list.py`?

Indeed I should make my comments appropriate.



---

archive/issue_comments_303349.json:
```json
{
    "body": "Interesting, even after\n\n```\n./configure --with-blas=openblas\nmake\n```\n\nI still have atlas generated `.pc` files\n\n```\ngrep ATLAS local/lib/pkgconfig/*\n\nlocal/lib/pkgconfig/blas.pc:Description: blas for sage, set up by the ATLAS spkg.\nlocal/lib/pkgconfig/cblas.pc:Description: cblas for sage, set up by the ATLAS spkg.\nlocal/lib/pkgconfig/lapack.pc:Description: lapack for sage, set up by the ATLAS spkg.\n```\n\n\nAnd for example\n\n```\npkg-config --libs fflas-ffpack\n-L/64bitdev/storage/sage-git_develop/sage/local/lib -lfflas -lffpack -lcblas -lgivaro -lgmpxx -lgmp\n```\n\nwhich links to atlas cblas. I'm thinking things are not right or else I'm doing something really stupid.",
    "created_at": "2016-12-22T22:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303349",
    "user": "strogdon"
}
```

Interesting, even after

```
./configure --with-blas=openblas
make
```

I still have atlas generated `.pc` files

```
grep ATLAS local/lib/pkgconfig/*

local/lib/pkgconfig/blas.pc:Description: blas for sage, set up by the ATLAS spkg.
local/lib/pkgconfig/cblas.pc:Description: cblas for sage, set up by the ATLAS spkg.
local/lib/pkgconfig/lapack.pc:Description: lapack for sage, set up by the ATLAS spkg.
```


And for example

```
pkg-config --libs fflas-ffpack
-L/64bitdev/storage/sage-git_develop/sage/local/lib -lfflas -lffpack -lcblas -lgivaro -lgmpxx -lgmp
```

which links to atlas cblas. I'm thinking things are not right or else I'm doing something really stupid.



---

archive/issue_comments_303350.json:
```json
{
    "body": "Are the .pc files changed after `./sage -f openblas`?",
    "created_at": "2016-12-22T22:38:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303350",
    "user": "fbissey"
}
```

Are the .pc files changed after `./sage -f openblas`?



---

archive/issue_comments_303351.json:
```json
{
    "body": "Replying to [comment:12 fbissey]:\n> Are the .pc files changed after `./sage -f openblas`?\nYes. So what's up? I had `openblas` installed.",
    "created_at": "2016-12-22T22:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303351",
    "user": "strogdon"
}
```

Replying to [comment:12 fbissey]:
> Are the .pc files changed after `./sage -f openblas`?
Yes. So what's up? I had `openblas` installed.



---

archive/issue_comments_303352.json:
```json
{
    "body": "I don't know. It looks like you may have installed ATLAS after openblas somehow. And now that the .pc file show openblas, all the blas dependencies have to be rebuilt - including gsl.",
    "created_at": "2016-12-22T23:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303352",
    "user": "fbissey"
}
```

I don't know. It looks like you may have installed ATLAS after openblas somehow. And now that the .pc file show openblas, all the blas dependencies have to be rebuilt - including gsl.



---

archive/issue_comments_303353.json:
```json
{
    "body": "I'm wondering if since `atlas` is installed because it was used before `openblas`, then a newer atlas package will trigger a rebuild of atlas and thus produce the problem. If so, then maybe `atlas` and `openblas` should not be present together.",
    "created_at": "2016-12-23T02:17:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303353",
    "user": "strogdon"
}
```

I'm wondering if since `atlas` is installed because it was used before `openblas`, then a newer atlas package will trigger a rebuild of atlas and thus produce the problem. If so, then maybe `atlas` and `openblas` should not be present together.



---

archive/issue_comments_303354.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-12-23T02:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303354",
    "user": "strogdon"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_303355.json:
```json
{
    "body": "Things are good now\n\n```\npkg-config --libs gsl\n-L/64bitdev/storage/sage-git_develop/sage/local/lib -lgsl -lm -lopenblas -lm\n```\n\nChanging action for the updated comments.",
    "created_at": "2016-12-23T02:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303355",
    "user": "strogdon"
}
```

Things are good now

```
pkg-config --libs gsl
-L/64bitdev/storage/sage-git_develop/sage/local/lib -lgsl -lm -lopenblas -lm
```

Changing action for the updated comments.



---

archive/issue_comments_303356.json:
```json
{
    "body": "When you test sage what do you see. Here\n\n```\nUsing --optional=atlas,mpir,python2,sage\nDoctesting entire Sage library.\n```\n\nIs the presence of `atlas` a problem if `openblas` is to be used? The test command was\n\n```\n./sage -tp 5 --all --long 2>&1 | tee -a ../test.log-7.4.rc0\n```\n",
    "created_at": "2016-12-23T03:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303356",
    "user": "strogdon"
}
```

When you test sage what do you see. Here

```
Using --optional=atlas,mpir,python2,sage
Doctesting entire Sage library.
```

Is the presence of `atlas` a problem if `openblas` is to be used? The test command was

```
./sage -tp 5 --all --long 2>&1 | tee -a ../test.log-7.4.rc0
```




---

archive/issue_comments_303357.json:
```json
{
    "body": "Replying to [comment:17 strogdon]:\n> When you test sage what do you see. Here\n> {{{\n> Using --optional=atlas,mpir,python2,sage\n> Doctesting entire Sage library.\n> }}}\n> Is the presence of `atlas` a problem if `openblas` is to be used? The test command was\n> {{{\n> ./sage -tp 5 --all --long 2>&1 | tee -a ../test.log-7.4.rc0\n> }}}\n\nNot a real problem. It reflects the fact that atlas has been installed. The doctesting framework (a part removed from sage-on-gentoo) look at all the optionally installed packages and check they are up to date. This is enabled with `--all` (again not in sage-on-gentoo). In any case there are no atlas specific test in the sage library.",
    "created_at": "2016-12-23T06:38:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303357",
    "user": "fbissey"
}
```

Replying to [comment:17 strogdon]:
> When you test sage what do you see. Here
> {{{
> Using --optional=atlas,mpir,python2,sage
> Doctesting entire Sage library.
> }}}
> Is the presence of `atlas` a problem if `openblas` is to be used? The test command was
> {{{
> ./sage -tp 5 --all --long 2>&1 | tee -a ../test.log-7.4.rc0
> }}}

Not a real problem. It reflects the fact that atlas has been installed. The doctesting framework (a part removed from sage-on-gentoo) look at all the optionally installed packages and check they are up to date. This is enabled with `--all` (again not in sage-on-gentoo). In any case there are no atlas specific test in the sage library.



---

archive/issue_comments_303358.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-23T09:38:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303358",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303359.json:
```json
{
    "body": "Finally fixed.",
    "created_at": "2016-12-23T09:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303359",
    "user": "fbissey"
}
```

Finally fixed.



---

archive/issue_comments_303360.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-12-23T09:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303360",
    "user": "fbissey"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_303361.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-12-23T15:39:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303361",
    "user": "strogdon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_303362.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-01-21T16:34:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21848#issuecomment-303362",
    "user": "vbraun"
}
```

Resolution: fixed
