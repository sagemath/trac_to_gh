# Issue 27554: Py3: Fix doctests in rings.polynomial.multi_polynomial.pyx

archive/issues_027554.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/27791\n\n",
    "created_at": "2019-05-07T08:43:50Z",
    "labels": [
        "python3",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Py3: Fix doctests in rings.polynomial.multi_polynomial.pyx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27554",
    "user": "vklein"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/27791





---

archive/issue_comments_388772.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-05-07T12:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27554#issuecomment-388772",
    "user": "vklein"
}
```

New commits:



---

archive/issue_comments_388773.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-07T12:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27554#issuecomment-388773",
    "user": "vklein"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_388774.json:
```json
{
    "body": "I'm not sure it makes sense to sort `list(ff)`. In principle, you could reconstruct the function from this list, but not if you sort it. In particular, once you sort, the previous comment \"Currently, we use a fairly unoptimized method that evaluates one monomial at a time, with no sharing of repeated computations and with useless additions of 0 and multiplications by 1\" is hard to make sense of.",
    "created_at": "2019-05-07T22:13:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27554#issuecomment-388774",
    "user": "jhpalmieri"
}
```

I'm not sure it makes sense to sort `list(ff)`. In principle, you could reconstruct the function from this list, but not if you sort it. In particular, once you sort, the previous comment "Currently, we use a fairly unoptimized method that evaluates one monomial at a time, with no sharing of repeated computations and with useless additions of 0 and multiplications by 1" is hard to make sense of.



---

archive/issue_comments_388775.json:
```json
{
    "body": "Replying to [comment:3 jhpalmieri]:\n> I'm not sure it makes sense to sort `list(ff)`. In principle, you could reconstruct the function from this list, but not if you sort it.\n\nDoes that mean even if the list comes in a different order in py2 and py3 you will get an equivalent function by reconstruction ?\n\nIf this is the case what do you think is the best fix ? `#py2` `#py3` tags.",
    "created_at": "2019-05-09T07:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27554#issuecomment-388775",
    "user": "vklein"
}
```

Replying to [comment:3 jhpalmieri]:
> I'm not sure it makes sense to sort `list(ff)`. In principle, you could reconstruct the function from this list, but not if you sort it.

Does that mean even if the list comes in a different order in py2 and py3 you will get an equivalent function by reconstruction ?

If this is the case what do you think is the best fix ? `#py2` `#py3` tags.



---

archive/issue_comments_388776.json:
```json
{
    "body": "Replying to [comment:4 vklein]:\n> Replying to [comment:3 jhpalmieri]:\n> > I'm not sure it makes sense to sort `list(ff)`. In principle, you could reconstruct the function from this list, but not if you sort it.\n> \n> Does that mean even if the list comes in a different order in py2 and py3 you will get an equivalent function by reconstruction ?\n\nThis all guesswork on my part, but I think so. The list is just giving the summands in two different orders. \n\n```\n'push 0.0', 'push 12.0', 'load 1', 'load 2', 'dup', 'mul', 'mul', 'mul', 'add',\n```\n\nsays to store 0, then store 12, take a factor of y (\"load 1\"), take a factor of z (\"load 2\"), duplicate it to get two factors of z, multiply (so you have `z^2`), multiply again (so you have `y z^2`), multiply again (to incorporate the factor of 12), then add to the 0 from the start.\n\nWith Python 3, it starts with the summand `9z^4` instead. The ordering in Python 3 seems to match the order in which the polynomial is actually printed, for what that's worth.\n\n> If this is the case what do you think is the best fix ? `#py2` `#py3` tags.\n\nHow about a new doctest: instead of `list(ff)`, do something like this after the comment:\n\n```\nsage: g = (x*y**2*z)._fast_float_()\nsage: list(g)\n[ insert output here ]\n```\n\nSince there is only one summand, there should be no issues with orderings, and I think it still illustrates the same issue.",
    "created_at": "2019-05-09T15:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27554#issuecomment-388776",
    "user": "jhpalmieri"
}
```

Replying to [comment:4 vklein]:
> Replying to [comment:3 jhpalmieri]:
> > I'm not sure it makes sense to sort `list(ff)`. In principle, you could reconstruct the function from this list, but not if you sort it.
> 
> Does that mean even if the list comes in a different order in py2 and py3 you will get an equivalent function by reconstruction ?

This all guesswork on my part, but I think so. The list is just giving the summands in two different orders. 

```
'push 0.0', 'push 12.0', 'load 1', 'load 2', 'dup', 'mul', 'mul', 'mul', 'add',
```

says to store 0, then store 12, take a factor of y ("load 1"), take a factor of z ("load 2"), duplicate it to get two factors of z, multiply (so you have `z^2`), multiply again (so you have `y z^2`), multiply again (to incorporate the factor of 12), then add to the 0 from the start.

With Python 3, it starts with the summand `9z^4` instead. The ordering in Python 3 seems to match the order in which the polynomial is actually printed, for what that's worth.

> If this is the case what do you think is the best fix ? `#py2` `#py3` tags.

How about a new doctest: instead of `list(ff)`, do something like this after the comment:

```
sage: g = (x*y**2*z)._fast_float_()
sage: list(g)
[ insert output here ]
```

Since there is only one summand, there should be no issues with orderings, and I think it still illustrates the same issue.



---

archive/issue_comments_388777.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-10T07:17:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27554#issuecomment-388777",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388778.json:
```json
{
    "body": "It works ! Thanks for your help.",
    "created_at": "2019-05-10T07:19:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27554#issuecomment-388778",
    "user": "vklein"
}
```

It works ! Thanks for your help.



---

archive/issue_comments_388779.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-05-13T09:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27554#issuecomment-388779",
    "user": "vklein"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_388780.json:
```json
{
    "body": "Merge failed with 8.8.beta5",
    "created_at": "2019-05-13T09:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27554#issuecomment-388780",
    "user": "vklein"
}
```

Merge failed with 8.8.beta5



---

archive/issue_comments_388781.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-05-13T12:47:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27554#issuecomment-388781",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_388782.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-05-13T12:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27554#issuecomment-388782",
    "user": "vklein"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_388783.json:
```json
{
    "body": "Rebased with 8.8.beta5 which already fix the py3 doctests.",
    "created_at": "2019-05-13T12:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27554#issuecomment-388783",
    "user": "vklein"
}
```

Rebased with 8.8.beta5 which already fix the py3 doctests.



---

archive/issue_comments_388784.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2019-05-13T12:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27554#issuecomment-388784",
    "user": "vklein"
}
```

Changing priority from major to minor.



---

archive/issue_comments_388785.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2019-05-13T18:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27554#issuecomment-388785",
    "user": "jhpalmieri"
}
```

Looks good to me.



---

archive/issue_comments_388786.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-13T18:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27554#issuecomment-388786",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_388787.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-05-24T18:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27554#issuecomment-388787",
    "user": "vbraun"
}
```

Resolution: fixed
