# Issue 27554: Py3: Fix doctests in rings.polynomial.multi_polynomial.pyx

Issue created by migration from https://trac.sagemath.org/ticket/27791

Original creator: vklein

Original creation time: 2019-05-07 08:43:50




---

Comment by vklein created at 2019-05-07 12:46:00

New commits:


---

Comment by vklein created at 2019-05-07 12:46:00

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2019-05-07 22:13:48

I'm not sure it makes sense to sort `list(ff)`. In principle, you could reconstruct the function from this list, but not if you sort it. In particular, once you sort, the previous comment "Currently, we use a fairly unoptimized method that evaluates one monomial at a time, with no sharing of repeated computations and with useless additions of 0 and multiplications by 1" is hard to make sense of.


---

Comment by vklein created at 2019-05-09 07:14:39

Replying to [comment:3 jhpalmieri]:
> I'm not sure it makes sense to sort `list(ff)`. In principle, you could reconstruct the function from this list, but not if you sort it.

Does that mean even if the list comes in a different order in py2 and py3 you will get an equivalent function by reconstruction ?

If this is the case what do you think is the best fix ? `#py2` `#py3` tags.


---

Comment by jhpalmieri created at 2019-05-09 15:20:04

Replying to [comment:4 vklein]:
> Replying to [comment:3 jhpalmieri]:
> > I'm not sure it makes sense to sort `list(ff)`. In principle, you could reconstruct the function from this list, but not if you sort it.
> 
> Does that mean even if the list comes in a different order in py2 and py3 you will get an equivalent function by reconstruction ?

This all guesswork on my part, but I think so. The list is just giving the summands in two different orders. 

```
'push 0.0', 'push 12.0', 'load 1', 'load 2', 'dup', 'mul', 'mul', 'mul', 'add',
```

says to store 0, then store 12, take a factor of y ("load 1"), take a factor of z ("load 2"), duplicate it to get two factors of z, multiply (so you have `z^2`), multiply again (so you have `y z^2`), multiply again (to incorporate the factor of 12), then add to the 0 from the start.

With Python 3, it starts with the summand `9z^4` instead. The ordering in Python 3 seems to match the order in which the polynomial is actually printed, for what that's worth.

> If this is the case what do you think is the best fix ? `#py2` `#py3` tags.

How about a new doctest: instead of `list(ff)`, do something like this after the comment:

```
sage: g = (x*y**2*z)._fast_float_()
sage: list(g)
[ insert output here ]
```

Since there is only one summand, there should be no issues with orderings, and I think it still illustrates the same issue.


---

Comment by git created at 2019-05-10 07:17:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vklein created at 2019-05-10 07:19:29

It works ! Thanks for your help.


---

Comment by vklein created at 2019-05-13 09:43:17

Changing status from needs_review to needs_work.


---

Comment by vklein created at 2019-05-13 09:43:17

Merge failed with 8.8.beta5


---

Comment by git created at 2019-05-13 12:47:12

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vklein created at 2019-05-13 12:51:59

Changing status from needs_work to needs_review.


---

Comment by vklein created at 2019-05-13 12:51:59

Rebased with 8.8.beta5 which already fix the py3 doctests.


---

Comment by vklein created at 2019-05-13 12:51:59

Changing priority from major to minor.


---

Comment by jhpalmieri created at 2019-05-13 18:52:18

Looks good to me.


---

Comment by jhpalmieri created at 2019-05-13 18:52:18

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-05-24 18:29:41

Resolution: fixed
