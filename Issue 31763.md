# Issue 31763: Package Rtree

Issue created by migration from https://trac.sagemath.org/ticket/32000

Original creator: @DRKWang

Original creation time: 2021-06-17 23:33:37

CC:  mkoeppe

Keywords: Rtree, spatial index,

Rtree is a ctypes Python wrapper of libspatialindex that provides a number of advanced spatial indexing features for the spatially curious Python user. These features include:

Nearest neighbor search

Intersection search

Multi-dimensional indexes

Clustered indexes (store Python pickles directly with index entries)

Bulk loading

Deletion

Disk serialization

Custom storage implementation (to implement spatial indexing in ZODB, for example).

Although it is named as Rtree, it also provides options for its variants in terms of splitting. There are 3 ways for it, that is, linear, quadratic, and R* tree splitting. The difference of them can be found here https://en.wikipedia.org/wiki/R-tree.


We create a normal package for `Rtree`.

- PyPI package: ​https://pypi.org/project/Rtree/
- points to... ​https://github.com/Toblerity/Rtree
- latest documentation: https://rtree.readthedocs.io/en/latest/
- `libspatialindex` library: https://libspatialindex.org/en/latest/


---

Comment by @DRKWang created at 2021-06-18 00:12:38

Changing type from PLEASE CHANGE to enhancement.


---

Comment by mkoeppe created at 2021-06-18 17:47:18

The branch does not exist - did you push it?


---

Comment by git created at 2021-06-23 18:05:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-06-23 18:16:17

This branch does not have your new files.


---

Comment by git created at 2021-06-25 01:30:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-06-25 17:28:22

the .txt files - the file names should all be lowercase. See the files for the existing packages. You can see the names that we use by typing `grep SYSTEM= tox.ini`
We do not distinguish the various Debian variants (there should be no separate file for ubuntu, devuan, etc.)

First line of `SPKG.rst` should have a brief description, see format for other packages


---

Comment by mkoeppe created at 2021-06-25 17:29:52

checksums.ini - please add a line `upstream_url` as explained here https://doc.sagemath.org/html/en/developer/packaging.html#upstream-urls


---

Comment by mkoeppe created at 2021-06-25 17:31:11

build/pkgs/rtree/SPKG.rst is referring to "AABBTree", that's probably a copy-paste error


---

Comment by git created at 2021-06-25 17:43:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-06-25 17:44:10

I've added full packaging as a normal package to libspatialindex because homebrew does not provide a package for it


---

Comment by mkoeppe created at 2021-06-25 17:46:31

The file `build/pkgs/rtree/requirements.txt` needs to be removed because it makes the package a "pip package", so checksums.ini is being ignored


---

Comment by mkoeppe created at 2021-06-25 17:55:19

Does rtree use the executables `mvrtree` from libspatialindex, or does it link to library? In the latter case, the spkg-configure.m4 should be changed to use `AC_LINK_IFELSE`. You can see a usage example in `build/pkgs/ntl/spkg-configure.m4`


---

Comment by git created at 2021-06-25 18:13:51

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @DRKWang created at 2021-06-30 01:22:05

Replying to [comment:12 mkoeppe]:
> I've added full packaging as a normal package to libspatialindex because homebrew does not provide a package for it
>> I just found that homebrew provides a package for libspatialindex but it is in a different name: spatialindex, which is why I did not add it in `.distros`. You may check it from here https://repology.org/project/spatialindex/versions#homebrew


---

Comment by git created at 2021-06-30 17:31:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DRKWang created at 2021-06-30 17:34:35

Replying to [comment:13 mkoeppe]:
> The file `build/pkgs/rtree/requirements.txt` needs to be removed because it makes the package a "pip package", so checksums.ini is being ignored
I have deleted it.


---

Comment by @DRKWang created at 2021-06-30 17:37:23

Replying to [comment:8 mkoeppe]:
> the .txt files - the file names should all be lowercase. See the files for the existing packages. You can see the names that we use by typing `grep SYSTEM= tox.ini`
> We do not distinguish the various Debian variants (there should be no separate file for ubuntu, devuan, etc.)
> 
> First line of `SPKG.rst` should have a brief description, see format for other packages
The names of those files in `.distros` have been changed following this format.


---

Comment by @DRKWang created at 2021-06-30 17:38:59

Replying to [comment:9 mkoeppe]:
> checksums.ini - please add a line `upstream_url` as explained here https://doc.sagemath.org/html/en/developer/packaging.html#upstream-urls
A downloading link from github release has been added into checksums.ini.


---

Comment by @DRKWang created at 2021-06-30 17:41:48

Replying to [comment:14 mkoeppe]:
> Does rtree use the executables `mvrtree` from libspatialindex, or does it link to library? In the latter case, the spkg-configure.m4 should be changed to use `AC_LINK_IFELSE`. You can see a usage example in `build/pkgs/ntl/spkg-configure.m4`
The spkg-configure.m4 has been revised following reference.


---

Comment by mkoeppe created at 2021-06-30 17:55:03

Replying to [comment:19 gh-DRKWang]:
> Replying to [comment:8 mkoeppe]:
> > the .txt files - the file names should all be lowercase. See the files for the existing packages. You can see the names that we use by typing `grep SYSTEM= tox.ini`
> > We do not distinguish the various Debian variants (there should be no separate file for ubuntu, devuan, etc.)
> > 
> > First line of `SPKG.rst` should have a brief description, see format for other packages
> The names of those files in `.distros` have been changed following this format.

lowercase file names please. It matters on case-sensitive file systems...


---

Comment by @DRKWang created at 2021-06-30 18:07:10

Replying to [comment:22 mkoeppe]:
> Replying to [comment:19 gh-DRKWang]:
> > Replying to [comment:8 mkoeppe]:
> > > the .txt files - the file names should all be lowercase. See the files for the existing packages. You can see the names that we use by typing `grep SYSTEM= tox.ini`
> > > We do not distinguish the various Debian variants (there should be no separate file for ubuntu, devuan, etc.)
> > > 
> > > First line of `SPKG.rst` should have a brief description, see format for other packages
> > The names of those files in `.distros` have been changed following this format.
> 
> lowercase file names please. It matters on case-sensitive file systems...
The names of files have also been modified for lowercase. But I forgot to mention it.


---

Comment by mkoeppe created at 2021-06-30 19:14:43

Replying to [comment:23 gh-DRKWang]:
> > lowercase file names please. It matters on case-sensitive file systems...
> The names of files have also been modified for lowercase. But I forgot to mention it.

This change is not on the branch - please push it


---

Comment by git created at 2021-07-01 04:31:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DRKWang created at 2021-07-01 05:00:13

Replying to [comment:24 mkoeppe]:
> Replying to [comment:23 gh-DRKWang]:
> > > lowercase file names please. It matters on case-sensitive file systems...
> > The names of files have also been modified for lowercase. But I forgot to mention it.
> 
> This change is not on the branch - please push it.
The lastest pushed branch has been changed for lowercase. Because the git is not case-sensitive, it still kept the same capital letters of those distribution files, even though I had changed them on my computer. After I realized the reason for that, I followed this solution https://stackoverflow.com/questions/17683458/how-do-i-commit-case-sensitive-only-filename-changes-in-git#1 and so that committed the code twice. Somehow, it is sort of not smart, but I did not figure out a better method for that.


---

Comment by mkoeppe created at 2021-07-01 05:09:40

Thanks for fixing this - that was a tricky one.


---

Comment by @DRKWang created at 2021-07-01 14:44:08

Replying to [comment:27 mkoeppe]:
> Thanks for fixing this - that was a tricky one.
No problem, thanks for your encouragement.


---

Comment by git created at 2021-09-11 18:28:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DRKWang created at 2021-09-11 18:34:50

I just made a wrong commit, which is 674d982, for this ticket. Is there any way to retract it?


---

Comment by mkoeppe created at 2021-09-11 19:46:30

`git reset --hard HEAD~` takes away the top commit on your branch.

Using `git push --force` you can send the updated branch to the remote.


---

Comment by git created at 2021-09-11 19:55:28

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @DRKWang created at 2021-09-11 19:57:12

Replying to [comment:32 mkoeppe]:
> `git reset --hard HEAD~` takes away the top commit on your branch.
> 
> Using `git push --force` you can send the updated branch to the remote.
I see. Thanks!


---

Comment by mkoeppe created at 2021-12-03 18:13:07

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-02-01 16:03:40

Docbuild fails

```
OSError: /sage/local/var/lib/sage/venv-python3.10.2/lib/python3.10/site-packages/sage/geometry/cone.py:docstring of sage.geometry.cone.ConvexRationalPolyhedralCone.polar:6: WARNING: Bullet list ends without a blank line; unexpected unindent.
```



---

Comment by mkoeppe created at 2022-02-01 16:03:40

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2022-02-01 16:06:33

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2022-02-01 16:06:33

actually #32170
