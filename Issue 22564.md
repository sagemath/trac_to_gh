# Issue 22564: SymPy as optional symbolic method for manifolds

archive/issues_022564.json:
```json
{
    "body": "CC:  egourgoulhon\n\nThe symbolic method used for manifolds and differentiable manifolds is \"symbolic\", the default in [SageMath](SageMath).\nIn this ticket we introduce the use of SymPy as an option when the Chart in the manifold is created.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22801\n\n",
    "created_at": "2017-04-13T09:13:12Z",
    "labels": [
        "symbolics",
        "major",
        "enhancement"
    ],
    "title": "SymPy as optional symbolic method for manifolds",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22564",
    "user": "mmancini"
}
```
CC:  egourgoulhon

The symbolic method used for manifolds and differentiable manifolds is "symbolic", the default in [SageMath](SageMath).
In this ticket we introduce the use of SymPy as an option when the Chart in the manifold is created.

Issue created by migration from https://trac.sagemath.org/ticket/22801





---

archive/issue_comments_314561.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-04-13T11:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314561",
    "user": "mmancini"
}
```

New commits:



---

archive/issue_comments_314562.json:
```json
{
    "body": "Changing component from symbolics to geometry.",
    "created_at": "2017-05-12T08:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314562",
    "user": "rws"
}
```

Changing component from symbolics to geometry.



---

archive/issue_comments_314563.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-01T15:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314563",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314564.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-01T16:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314564",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314565.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-08T13:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314565",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314566.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-27T14:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314566",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314567.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-19T12:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314567",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314568.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2017-09-08T14:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314568",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_314569.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-13T09:28:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314569",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314570.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-13T12:08:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314570",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314571.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-13T12:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314571",
    "user": "mmancini"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_314572.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-14T11:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314572",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314573.json:
```json
{
    "body": "There are a few things that need fixing.\n\n- Not all methods have docstrings/tests\n- There are a number of tests where the line before is informational, but it needs a blankline, e.g.:\n  {{{#!diff\n`@``@` -1641,6 +1641,19 `@``@` class TopologicalManifold(ManifoldSubset):\n             F: U --> R\n                (x, y, z) |--> cos(y)*sin(x) + z\n \n+\n+        Same tests with ``sympy``::\n+            sage: c_xyz.set_calculus_method('sympy')\n+            sage: f = U.scalar_field(sin(x)*cos(y) + z, name='F'); f\n+            Scalar field F on the Open subset U of the 3-dimensional topological manifold M\n+            sage: f.display()\n+            F: U --> R\n+               (x, y, z) |--> cos(y)*sin(x) + z\n+\n+            sage: type(f.coord_function(c_xyz).expr())\n+               <class 'sympy.core.add.Add'>\n+\n+\n}}}\n- IMO, you are too liberal with your blanklines spacing things out that makes the code a little uneven to read.",
    "created_at": "2017-09-15T20:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314573",
    "user": "tscrim"
}
```

There are a few things that need fixing.

- Not all methods have docstrings/tests
- There are a number of tests where the line before is informational, but it needs a blankline, e.g.:
  {{{#!diff
`@``@` -1641,6 +1641,19 `@``@` class TopologicalManifold(ManifoldSubset):
             F: U --> R
                (x, y, z) |--> cos(y)*sin(x) + z
 
+
+        Same tests with ``sympy``::
+            sage: c_xyz.set_calculus_method('sympy')
+            sage: f = U.scalar_field(sin(x)*cos(y) + z, name='F'); f
+            Scalar field F on the Open subset U of the 3-dimensional topological manifold M
+            sage: f.display()
+            F: U --> R
+               (x, y, z) |--> cos(y)*sin(x) + z
+
+            sage: type(f.coord_function(c_xyz).expr())
+               <class 'sympy.core.add.Add'>
+
+
}}}
- IMO, you are too liberal with your blanklines spacing things out that makes the code a little uneven to read.



---

archive/issue_comments_314574.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-09-15T20:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314574",
    "user": "tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_314575.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-21T13:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314575",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314576.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-21T13:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314576",
    "user": "mmancini"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_314577.json:
```json
{
    "body": "I hope that now the docstring is better (and less liberal)",
    "created_at": "2017-09-21T13:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314577",
    "user": "mmancini"
}
```

I hope that now the docstring is better (and less liberal)



---

archive/issue_comments_314578.json:
```json
{
    "body": "Replying to [comment:19 mmancini]:\n> I hope that now the docstring is better (and less liberal) \n\nThanks a lot for these improvements! I'll have a look at the code next week. Just a quick comment: as revealed by the patchbot, there are still some coverage issue, as well as a problem with `sage/manifolds/chart_func.py` when building the documentation. There are also some doctest failures.",
    "created_at": "2017-09-21T19:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314578",
    "user": "egourgoulhon"
}
```

Replying to [comment:19 mmancini]:
> I hope that now the docstring is better (and less liberal) 

Thanks a lot for these improvements! I'll have a look at the code next week. Just a quick comment: as revealed by the patchbot, there are still some coverage issue, as well as a problem with `sage/manifolds/chart_func.py` when building the documentation. There are also some doctest failures.



---

archive/issue_comments_314579.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-22T14:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314579",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314580.json:
```json
{
    "body": "According to the patchbots, there are still failing doctests in `tensorfield.py` and the doc does not build.",
    "created_at": "2017-10-02T09:17:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314580",
    "user": "egourgoulhon"
}
```

According to the patchbots, there are still failing doctests in `tensorfield.py` and the doc does not build.



---

archive/issue_comments_314581.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-02T09:17:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314581",
    "user": "egourgoulhon"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_314582.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-02T19:52:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314582",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314583.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-02T19:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314583",
    "user": "mmancini"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_314584.json:
```json
{
    "body": "The last commit fixes the doc build, but not the doctest failures in `tensorfield.py`.",
    "created_at": "2017-10-03T16:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314584",
    "user": "egourgoulhon"
}
```

The last commit fixes the doc build, but not the doctest failures in `tensorfield.py`.



---

archive/issue_comments_314585.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-03T16:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314585",
    "user": "egourgoulhon"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_314586.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-04T14:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314586",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314587.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-05T06:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314587",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314588.json:
```json
{
    "body": "Display for ``ChartFunction`` has been changed: now the result is different for  ``Sympy`` and ``SR``. All test results have been modified.",
    "created_at": "2017-10-05T07:02:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314588",
    "user": "mmancini"
}
```

Display for ``ChartFunction`` has been changed: now the result is different for  ``Sympy`` and ``SR``. All test results have been modified.



---

archive/issue_comments_314589.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-05T07:02:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314589",
    "user": "mmancini"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_314590.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-06T16:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314590",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314591.json:
```json
{
    "body": "Replying to [comment:29 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[fb0fb7e](https://git.sagemath.org/sage.git/commit/?id=fb0fb7e66395268a1c3e7d9abbf8b5613bf813bf)||`SymPy on manifolds: first reviewer tweaks (more to come)`||\n\nI see in the difference the following one:\n\n\n```\n@@ -231,7 +225,7 @@ class DiffForm(TensorField):\n         sage: a.display(eU)\n         a = x*(y**2 + 2) dx/\\dy\n         sage: a.display(eV)\n-        a = (-u**3/16 + u**2*v/16 + u*v**2/16 - u/2 - v**3/16 - v/2) du/\\dv\n+        a = (-u**3/16 + u*v**2/16 - u/2 - v**3/16 + v*(u**2 - 8)/16) du/\\dv\n```\n\n\nI found is surprising : do you know where this difference comes from?",
    "created_at": "2017-10-06T20:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314591",
    "user": "mmancini"
}
```

Replying to [comment:29 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[fb0fb7e](https://git.sagemath.org/sage.git/commit/?id=fb0fb7e66395268a1c3e7d9abbf8b5613bf813bf)||`SymPy on manifolds: first reviewer tweaks (more to come)`||

I see in the difference the following one:


```
@@ -231,7 +225,7 @@ class DiffForm(TensorField):
         sage: a.display(eU)
         a = x*(y**2 + 2) dx/\dy
         sage: a.display(eV)
-        a = (-u**3/16 + u**2*v/16 + u*v**2/16 - u/2 - v**3/16 - v/2) du/\dv
+        a = (-u**3/16 + u*v**2/16 - u/2 - v**3/16 + v*(u**2 - 8)/16) du/\dv
```


I found is surprising : do you know where this difference comes from?



---

archive/issue_comments_314592.json:
```json
{
    "body": "Replying to [comment:30 mmancini]:\n> \n> I see in the difference the following one:\n> \n> {{{\n> `@``@` -231,7 +225,7 `@``@` class DiffForm(TensorField):\n>          sage: a.display(eU)\n>          a = x*(y**2 + 2) dx/\\dy\n>          sage: a.display(eV)\n> -        a = (-u**3/16 + u**2*v/16 + u*v**2/16 - u/2 - v**3/16 - v/2) du/\\dv\n> +        a = (-u**3/16 + u*v**2/16 - u/2 - v**3/16 + v*(u**2 - 8)/16) du/\\dv\n> }}}\n> \n> I found is surprising : do you know where this difference comes from? \nIt is due to a different setting: in the previous version, the transition map `xy_to_uv` was redefined, thereby causing a different handling of computations between `SR` and `sympy`. Note that the two expressions of `a` are mathematically equivalent, which is satisfactory.",
    "created_at": "2017-10-07T12:12:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314592",
    "user": "egourgoulhon"
}
```

Replying to [comment:30 mmancini]:
> 
> I see in the difference the following one:
> 
> {{{
> `@``@` -231,7 +225,7 `@``@` class DiffForm(TensorField):
>          sage: a.display(eU)
>          a = x*(y**2 + 2) dx/\dy
>          sage: a.display(eV)
> -        a = (-u**3/16 + u**2*v/16 + u*v**2/16 - u/2 - v**3/16 - v/2) du/\dv
> +        a = (-u**3/16 + u*v**2/16 - u/2 - v**3/16 + v*(u**2 - 8)/16) du/\dv
> }}}
> 
> I found is surprising : do you know where this difference comes from? 
It is due to a different setting: in the previous version, the transition map `xy_to_uv` was redefined, thereby causing a different handling of computations between `SR` and `sympy`. Note that the two expressions of `a` are mathematically equivalent, which is satisfactory.



---

archive/issue_comments_314593.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-08T21:25:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314593",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314594.json:
```json
{
    "body": "The above commit contains some polishing of the code (mostly layout) and improvements in the documentation. In particular, it restores the section the rubric *Differences between chart fucntions and callable symbolic expressions* of the previous class `CoordFunctionSymb`. \n\nTwo questions: \n\n- Why is there an argument `expression` in method `ChartFunction._simplify`? I mean, if `expression` is not `self.expr(method=calc_method)`, why not calling directly the `simplify` method of `CalculusMethod` on it?\n\n- In the docstring of `ChartFunctionRing._coerce_map_from_`, there is a TODO section with *There is a problem with coercion with rationals*. What is that?",
    "created_at": "2017-10-08T21:39:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314594",
    "user": "egourgoulhon"
}
```

The above commit contains some polishing of the code (mostly layout) and improvements in the documentation. In particular, it restores the section the rubric *Differences between chart fucntions and callable symbolic expressions* of the previous class `CoordFunctionSymb`. 

Two questions: 

- Why is there an argument `expression` in method `ChartFunction._simplify`? I mean, if `expression` is not `self.expr(method=calc_method)`, why not calling directly the `simplify` method of `CalculusMethod` on it?

- In the docstring of `ChartFunctionRing._coerce_map_from_`, there is a TODO section with *There is a problem with coercion with rationals*. What is that?



---

archive/issue_comments_314595.json:
```json
{
    "body": "Replying to [comment:33 egourgoulhon]:\n> The above commit contains some polishing of the code (mostly layout) and improvements in the documentation. In particular, it restores the section the rubric *Differences between chart fucntions and callable symbolic expressions* of the previous class `CoordFunctionSymb`. \n\nThanks\n\n> \n> Two questions: \n> \n> - Why is there an argument `expression` in method `ChartFunction._simplify`? I mean, if `expression` is not `self.expr(method=calc_method)`, why not calling directly the `simplify` method of `CalculusMethod` on it?\n\nAt a particular moment during development I introduced it but I don't remember its functionality. As it is used only internally to `ChartFunction` I will remove this argument. \n \n> - In the docstring of `ChartFunctionRing._coerce_map_from_`, there is a TODO section with *There is a problem with coercion with rationals*. What is that?\nLook at this example:\n\n```\nM = Manifold(2, 'M', structure='topological')\nX.<x,y> = M.chart()\nf = X.function(x^2+3*y+1)\ng = f+1/2\n\nTypeError                                 Traceback (most recent call last)\n<ipython-input-5-83503284e242> in <module>()\n----> 1 g=f+Integer(1)/Integer(2)\n\n/home/mmancini/Sage-last/sage/src/sage/structure/element.pyx in sage.structure.element.Element.__add__ (build/cythonized/sage/structure/element.c:10823)()\n   1240         # Left and right are Sage elements => use coercion model\n   1241         if BOTH_ARE_ELEMENT(cl):\n-> 1242             return coercion_model.bin_op(left, right, add)\n   1243 \n   1244         try:\n\n...\n...\n...\n```\n",
    "created_at": "2017-10-09T08:56:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314595",
    "user": "mmancini"
}
```

Replying to [comment:33 egourgoulhon]:
> The above commit contains some polishing of the code (mostly layout) and improvements in the documentation. In particular, it restores the section the rubric *Differences between chart fucntions and callable symbolic expressions* of the previous class `CoordFunctionSymb`. 

Thanks

> 
> Two questions: 
> 
> - Why is there an argument `expression` in method `ChartFunction._simplify`? I mean, if `expression` is not `self.expr(method=calc_method)`, why not calling directly the `simplify` method of `CalculusMethod` on it?

At a particular moment during development I introduced it but I don't remember its functionality. As it is used only internally to `ChartFunction` I will remove this argument. 
 
> - In the docstring of `ChartFunctionRing._coerce_map_from_`, there is a TODO section with *There is a problem with coercion with rationals*. What is that?
Look at this example:

```
M = Manifold(2, 'M', structure='topological')
X.<x,y> = M.chart()
f = X.function(x^2+3*y+1)
g = f+1/2

TypeError                                 Traceback (most recent call last)
<ipython-input-5-83503284e242> in <module>()
----> 1 g=f+Integer(1)/Integer(2)

/home/mmancini/Sage-last/sage/src/sage/structure/element.pyx in sage.structure.element.Element.__add__ (build/cythonized/sage/structure/element.c:10823)()
   1240         # Left and right are Sage elements => use coercion model
   1241         if BOTH_ARE_ELEMENT(cl):
-> 1242             return coercion_model.bin_op(left, right, add)
   1243 
   1244         try:

...
...
...
```




---

archive/issue_comments_314596.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-09T09:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314596",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314597.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-09T15:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314597",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314598.json:
```json
{
    "body": "The above commit\n\n- makes `_simplify` a mere shortcut to `CalculusMethod.simplify` in `ChartFunction`\n- introduces the data member `._chart` in class `ChartFunction`\n- uses SymPy substitutions (instead of forcing a conversion to `SR`) in `ChartFunction.__call__` when dealing with SymPy expressions\n- makes sure that `simplify_chain_real_sympy` returns a SymPy object\n- fixes the issue of coercion of `QQ` to `ChartFunctionRing`",
    "created_at": "2017-10-09T19:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314598",
    "user": "egourgoulhon"
}
```

The above commit

- makes `_simplify` a mere shortcut to `CalculusMethod.simplify` in `ChartFunction`
- introduces the data member `._chart` in class `ChartFunction`
- uses SymPy substitutions (instead of forcing a conversion to `SR`) in `ChartFunction.__call__` when dealing with SymPy expressions
- makes sure that `simplify_chain_real_sympy` returns a SymPy object
- fixes the issue of coercion of `QQ` to `ChartFunctionRing`



---

archive/issue_comments_314599.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-09T21:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314599",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314600.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-10T13:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314600",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314601.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-11T14:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314601",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314602.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-16T09:37:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314602",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314603.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-17T15:30:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314603",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314604.json:
```json
{
    "body": "Better base everything on #20204 as it contains all SymPy Interface improvements, ie abstract functions.",
    "created_at": "2017-10-17T16:38:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314604",
    "user": "rws"
}
```

Better base everything on #20204 as it contains all SymPy Interface improvements, ie abstract functions.



---

archive/issue_comments_314605.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-17T17:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314605",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314606.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-18T14:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314606",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314607.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-20T19:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314607",
    "user": "mmancini"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_314608.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-20T19:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314608",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314609.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-23T11:19:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314609",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314610.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-23T11:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314610",
    "user": "mmancini"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_314611.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-24T06:31:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314611",
    "user": "rws"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_314612.json:
```json
{
    "body": "I cannot confirm the one patchbot failure. Most of this was reviewed by Eric, and the rest by me, LGTM.",
    "created_at": "2017-10-24T06:31:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314612",
    "user": "rws"
}
```

I cannot confirm the one patchbot failure. Most of this was reviewed by Eric, and the rest by me, LGTM.



---

archive/issue_comments_314613.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2017-10-24T08:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314613",
    "user": "egourgoulhon"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_314614.json:
```json
{
    "body": "Thank you Ralf but I would like to check a few more things before the final positive review",
    "created_at": "2017-10-24T12:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314614",
    "user": "egourgoulhon"
}
```

Thank you Ralf but I would like to check a few more things before the final positive review



---

archive/issue_comments_314615.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-26T12:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314615",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314616.json:
```json
{
    "body": "The above commit fixes the computation of metric determinants when sympy is the calculus method. With it, most of the manifold tutorial passes with all calculations performed with SymPy: http://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Worksheets/v1.1/SM_tutorial_sympy.ipynb.\n\nI have still to check a few extra things to complete the review.",
    "created_at": "2017-10-26T12:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314616",
    "user": "egourgoulhon"
}
```

The above commit fixes the computation of metric determinants when sympy is the calculus method. With it, most of the manifold tutorial passes with all calculations performed with SymPy: http://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Worksheets/v1.1/SM_tutorial_sympy.ipynb.

I have still to check a few extra things to complete the review.



---

archive/issue_comments_314617.json:
```json
{
    "body": "Grep finds a few mentions of 'manifolds.coord_func' in commentary:\n\ndifferentiable/scalarfield.py:    :class:`~sage.manifolds.coord_func.CoordFunction`::\ndifferentiable/affine_connection.py:    :class:`~sage.manifolds.coord_func.CoordFunction` (of the subclass\ndifferentiable/affine_connection.py:    :class:`~sage.manifolds.coord_func_symb.CoordFunctionSymb` in the current\ndifferentiable/affine_connection.py:          :class:`~sage.manifolds.coord_func.CoordFunction`\ndifferentiable/chart.py:          (cf. :class:`~sage.manifolds.coord_func.CoordFunction`)\ndifferentiable/chart.py:          (cf. :class:`~sage.manifolds.coord_func.CoordFunction`)\ndifferentiable/diff_map.py:          :class:`~sage.manifolds.coord_func.CoordFunction`",
    "created_at": "2017-10-26T18:59:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314617",
    "user": "rllozes"
}
```

Grep finds a few mentions of 'manifolds.coord_func' in commentary:

differentiable/scalarfield.py:    :class:`~sage.manifolds.coord_func.CoordFunction`::
differentiable/affine_connection.py:    :class:`~sage.manifolds.coord_func.CoordFunction` (of the subclass
differentiable/affine_connection.py:    :class:`~sage.manifolds.coord_func_symb.CoordFunctionSymb` in the current
differentiable/affine_connection.py:          :class:`~sage.manifolds.coord_func.CoordFunction`
differentiable/chart.py:          (cf. :class:`~sage.manifolds.coord_func.CoordFunction`)
differentiable/chart.py:          (cf. :class:`~sage.manifolds.coord_func.CoordFunction`)
differentiable/diff_map.py:          :class:`~sage.manifolds.coord_func.CoordFunction`



---

archive/issue_comments_314618.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-27T09:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314618",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314619.json:
```json
{
    "body": "Replying to [comment:57 rllozes]:\n\nI removed the old references, thanks\n\n> Grep finds a few mentions of 'manifolds.coord_func' in commentary:\n> \n> differentiable/scalarfield.py:    :class:`~sage.manifolds.coord_func.CoordFunction`::\n> differentiable/affine_connection.py:    :class:`~sage.manifolds.coord_func.CoordFunction` (of the subclass\n> differentiable/affine_connection.py:    :class:`~sage.manifolds.coord_func_symb.CoordFunctionSymb` in the current\n> differentiable/affine_connection.py:          :class:`~sage.manifolds.coord_func.CoordFunction`\n> differentiable/chart.py:          (cf. :class:`~sage.manifolds.coord_func.CoordFunction`)\n> differentiable/chart.py:          (cf. :class:`~sage.manifolds.coord_func.CoordFunction`)\n> differentiable/diff_map.py:          :class:`~sage.manifolds.coord_func.CoordFunction`\n>",
    "created_at": "2017-10-27T09:53:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314619",
    "user": "mmancini"
}
```

Replying to [comment:57 rllozes]:

I removed the old references, thanks

> Grep finds a few mentions of 'manifolds.coord_func' in commentary:
> 
> differentiable/scalarfield.py:    :class:`~sage.manifolds.coord_func.CoordFunction`::
> differentiable/affine_connection.py:    :class:`~sage.manifolds.coord_func.CoordFunction` (of the subclass
> differentiable/affine_connection.py:    :class:`~sage.manifolds.coord_func_symb.CoordFunctionSymb` in the current
> differentiable/affine_connection.py:          :class:`~sage.manifolds.coord_func.CoordFunction`
> differentiable/chart.py:          (cf. :class:`~sage.manifolds.coord_func.CoordFunction`)
> differentiable/chart.py:          (cf. :class:`~sage.manifolds.coord_func.CoordFunction`)
> differentiable/diff_map.py:          :class:`~sage.manifolds.coord_func.CoordFunction`
>



---

archive/issue_comments_314620.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-27T22:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314620",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314621.json:
```json
{
    "body": "With the above two commits, all the S<sup>2</sup> notebook passes with SymPy:\nhttp://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Worksheets/v1.1/SM_sphere_S2_sympy.ipynb\nexcept for the 3D graphics of the tangent vector field to the loxodrome (commented cell 193); this is because Sage's matrix constructor (`sage.matrix.constructor.prepare`) cannot take SymPy numbers (`sympy.core.numbers.Float`) as elements: it generates the error\n\n```\nTypeError: unable to find a common ring for all elements\n```\n \nThe need for such a matrix arises from a change of basis in some tangent space to the sphere, where all tensor components are expressed in terms of SymPy floats (because of the sampling for the drawing). Probably some workaround can be found.\n\nBesides, I am still checking a few other things...",
    "created_at": "2017-10-27T22:34:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314621",
    "user": "egourgoulhon"
}
```

With the above two commits, all the S<sup>2</sup> notebook passes with SymPy:
http://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Worksheets/v1.1/SM_sphere_S2_sympy.ipynb
except for the 3D graphics of the tangent vector field to the loxodrome (commented cell 193); this is because Sage's matrix constructor (`sage.matrix.constructor.prepare`) cannot take SymPy numbers (`sympy.core.numbers.Float`) as elements: it generates the error

```
TypeError: unable to find a common ring for all elements
```
 
The need for such a matrix arises from a change of basis in some tangent space to the sphere, where all tensor components are expressed in terms of SymPy floats (because of the sampling for the drawing). Probably some workaround can be found.

Besides, I am still checking a few other things...



---

archive/issue_comments_314622.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-28T16:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314622",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314623.json:
```json
{
    "body": "The above commit mostly improves the documentation. In particular, it adds the missing item `calc_method` in some `INPUT` sections and slightly improves some doctests.",
    "created_at": "2017-10-28T17:02:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314623",
    "user": "egourgoulhon"
}
```

The above commit mostly improves the documentation. In particular, it adds the missing item `calc_method` in some `INPUT` sections and slightly improves some doctests.



---

archive/issue_comments_314624.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-29T22:26:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314624",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314625.json:
```json
{
    "body": "I am almost done checking the documentation; shall finish tomorrow...",
    "created_at": "2017-10-29T22:30:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314625",
    "user": "egourgoulhon"
}
```

I am almost done checking the documentation; shall finish tomorrow...



---

archive/issue_comments_314626.json:
```json
{
    "body": "On my 3-manifold, I observe the following timings:\n\n# One thread takes 317s in Sage, 9311s in SymPy!\\\\\n\nnabla = g.connection()\n\n# One thread takes 95s in Sage, 1134s in SymPy!\\\\\n\nLBpsi = nabla(nabla(psi).up(g)).trace(); LBpsi;\n\n# One thread takes 872s in Sage, 36221s in SymPy!\\\\\n\nRic_g = g.ricci_scalar()\n\n# One thread takes 482s in Sage, 24220s in SymPy!\\\\\n\nCot_g = g.cotton(); Cot_g.parent(); Cot_g.display()\n\nI suggest we take a deeper look *after* getting the functionality released.",
    "created_at": "2017-10-30T15:32:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314626",
    "user": "rllozes"
}
```

On my 3-manifold, I observe the following timings:

# One thread takes 317s in Sage, 9311s in SymPy!\\

nabla = g.connection()

# One thread takes 95s in Sage, 1134s in SymPy!\\

LBpsi = nabla(nabla(psi).up(g)).trace(); LBpsi;

# One thread takes 872s in Sage, 36221s in SymPy!\\

Ric_g = g.ricci_scalar()

# One thread takes 482s in Sage, 24220s in SymPy!\\

Cot_g = g.cotton(); Cot_g.parent(); Cot_g.display()

I suggest we take a deeper look *after* getting the functionality released.



---

archive/issue_comments_314627.json:
```json
{
    "body": "Replying to [comment:66 rllozes]:\n\nI also noticed that SymPy is slower than Sage's symbolic (in particular in the tutorial and S<sup>2</sup> notebooks mentioned in comment:56 and comment:61).\n\n> \n> I suggest we take a deeper look *after* getting the functionality released.\n\nI agree.",
    "created_at": "2017-10-30T16:12:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314627",
    "user": "egourgoulhon"
}
```

Replying to [comment:66 rllozes]:

I also noticed that SymPy is slower than Sage's symbolic (in particular in the tutorial and S<sup>2</sup> notebooks mentioned in comment:56 and comment:61).

> 
> I suggest we take a deeper look *after* getting the functionality released.

I agree.



---

archive/issue_comments_314628.json:
```json
{
    "body": "Attachment",
    "created_at": "2017-10-30T22:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314628",
    "user": "rllozes"
}
```

Attachment



---

archive/issue_comments_314629.json:
```json
{
    "body": "The above attached notebook shows a failure when run with the multiprocessing directive \n\n```\nParallelism().set(nproc=4)\n```\n\nwhile computing the Laplace-Beltrami operator acting on a scalar field\n\n```\nnabla(nabla(psi).up(g)).trace()\n```\n \ndefined on a manifold having the 'sympy' option set\n\n```\nM.set_calculus_method('sympy')\n```\n\nWhen multiprocessing is turned off (nproc=1), this notebook completes without error.\n\nI will try to find a quicker-running example.",
    "created_at": "2017-10-30T22:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314629",
    "user": "rllozes"
}
```

The above attached notebook shows a failure when run with the multiprocessing directive 

```
Parallelism().set(nproc=4)
```

while computing the Laplace-Beltrami operator acting on a scalar field

```
nabla(nabla(psi).up(g)).trace()
```
 
defined on a manifold having the 'sympy' option set

```
M.set_calculus_method('sympy')
```

When multiprocessing is turned off (nproc=1), this notebook completes without error.

I will try to find a quicker-running example.



---

archive/issue_comments_314630.json:
```json
{
    "body": "Replying to [comment:68 rllozes]:\n> The above attached notebook shows a failure when run with the multiprocessing directive \n\nCan you resend the notebook? When I try to open it, I get the error\n\n```\nUnreadable Notebook: /home/eric/sage/8.1.beta8/22801_4threads_failure.ipynb NotJSONError(\"Notebook does not appear to be JSON:u'\\\\n{{{id=44|\\\\n# trac 22801 on top of .....\",)\n```\n",
    "created_at": "2017-10-31T09:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314630",
    "user": "egourgoulhon"
}
```

Replying to [comment:68 rllozes]:
> The above attached notebook shows a failure when run with the multiprocessing directive 

Can you resend the notebook? When I try to open it, I get the error

```
Unreadable Notebook: /home/eric/sage/8.1.beta8/22801_4threads_failure.ipynb NotJSONError("Notebook does not appear to be JSON:u'\\n{{{id=44|\\n# trac 22801 on top of .....",)
```




---

archive/issue_comments_314631.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-31T12:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314631",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314632.json:
```json
{
    "body": "I've finished to review the ticket. Marco, Ralf or Richard, if you agree with my changes, please set the ticket back to positive review (the parallelization issue raised in comment:68, if confirmed, could be dealt with in a separate ticket).\n\nThank you very much Marco for your work on this; it will be great to have the SymPy functionaly for manifolds in Sage 8.1!",
    "created_at": "2017-10-31T12:19:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314632",
    "user": "egourgoulhon"
}
```

I've finished to review the ticket. Marco, Ralf or Richard, if you agree with my changes, please set the ticket back to positive review (the parallelization issue raised in comment:68, if confirmed, could be dealt with in a separate ticket).

Thank you very much Marco for your work on this; it will be great to have the SymPy functionaly for manifolds in Sage 8.1!



---

archive/issue_comments_314633.json:
```json
{
    "body": "I will abstain, having not read through all the changes. \nI can say that I am able to successfully build and run all the doctests (ptestlong).",
    "created_at": "2017-10-31T15:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314633",
    "user": "rllozes"
}
```

I will abstain, having not read through all the changes. 
I can say that I am able to successfully build and run all the doctests (ptestlong).



---

archive/issue_comments_314634.json:
```json
{
    "body": "Thanks to all for the review. \nI am going to treat the issue of parallelization (comment:68) which it seems not connencted to sympy.",
    "created_at": "2017-11-02T08:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314634",
    "user": "mmancini"
}
```

Thanks to all for the review. 
I am going to treat the issue of parallelization (comment:68) which it seems not connencted to sympy.



---

archive/issue_comments_314635.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-02T09:42:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314635",
    "user": "mmancini"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_314636.json:
```json
{
    "body": "Attachment\n\nShowing failure with computations using sympy and parallelism (proc>1)",
    "created_at": "2017-11-02T17:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314636",
    "user": "rllozes"
}
```

Attachment

Showing failure with computations using sympy and parallelism (proc>1)



---

archive/issue_comments_314637.json:
```json
{
    "body": "Replying to [comment:69 egourgoulhon]:\n> Replying to [comment:68 rllozes]:\n> > The above attached notebook shows a failure when run with the multiprocessing directive \n> \n> Can you resend the notebook? When I try to open it, I get the error\n> {{{\n> Unreadable Notebook: /home/eric/sage/8.1.beta8/22801_4threads_failure.ipynb NotJSONError(\"Notebook does not appear to be JSON:u'\\\\n{{{id=44|\\\\n# trac 22801 on top of .....\",)\n> }}}\n\nSorry - Please see second attachment. I will still try to find a simpler case.",
    "created_at": "2017-11-02T17:41:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314637",
    "user": "rllozes"
}
```

Replying to [comment:69 egourgoulhon]:
> Replying to [comment:68 rllozes]:
> > The above attached notebook shows a failure when run with the multiprocessing directive 
> 
> Can you resend the notebook? When I try to open it, I get the error
> {{{
> Unreadable Notebook: /home/eric/sage/8.1.beta8/22801_4threads_failure.ipynb NotJSONError("Notebook does not appear to be JSON:u'\\n{{{id=44|\\n# trac 22801 on top of .....",)
> }}}

Sorry - Please see second attachment. I will still try to find a simpler case.



---

archive/issue_comments_314638.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-11-02T21:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314638",
    "user": "rllozes"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_314639.json:
```json
{
    "body": "1) Please remove redundant word \"curve\" which occurs within the documentation of curve.py and integrated_curve.py.\n2) Are we letting the TODO's remain undone for this release?\n3) In vectorfield_module.py, two occurrences each of \"from the North pole\" and \"from the South pole\" were changed to \"from North pole\" and \"from South pole\", respectively, resulting in non-standard English.",
    "created_at": "2017-11-02T21:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314639",
    "user": "rllozes"
}
```

1) Please remove redundant word "curve" which occurs within the documentation of curve.py and integrated_curve.py.
2) Are we letting the TODO's remain undone for this release?
3) In vectorfield_module.py, two occurrences each of "from the North pole" and "from the South pole" were changed to "from North pole" and "from South pole", respectively, resulting in non-standard English.



---

archive/issue_comments_314640.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-03T09:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314640",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314641.json:
```json
{
    "body": "Replying to [comment:75 rllozes]:\n> \n> Sorry - Please see second attachment. I will still try to find a simpler case.\n\nSorry I still cannot read this file: when I run `sage -n sagenb` and try to open it, I get \"500: internal server error\".",
    "created_at": "2017-11-03T09:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314641",
    "user": "egourgoulhon"
}
```

Replying to [comment:75 rllozes]:
> 
> Sorry - Please see second attachment. I will still try to find a simpler case.

Sorry I still cannot read this file: when I run `sage -n sagenb` and try to open it, I get "500: internal server error".



---

archive/issue_comments_314642.json:
```json
{
    "body": "Replying to [comment:76 rllozes]:\n> 1) Please remove redundant word \"curve\" which occurs within the documentation of curve.py and integrated_curve.py.\n\nDone in the above commit.\n\n> 2) Are we letting the TODO's remain undone for this release?\n\nIMHO yes, because they require substantial work and do not hinder the functionality implemented here.\n\n> 3) In vectorfield_module.py, two occurrences each of \"from the North pole\" and \"from the South pole\" were changed to \"from North pole\" and \"from South pole\", respectively, resulting in non-standard English.\n\nCorrected in the above commit; thanks.\n\nBesides the above typos, the last commit restores the trig simplification that was commented out in `simplify_chain_generic_sympy` and `simplify_chain_real_sympy`. On general grounds, the SymPy simplification chain should be improved in another ticket.",
    "created_at": "2017-11-03T09:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314642",
    "user": "egourgoulhon"
}
```

Replying to [comment:76 rllozes]:
> 1) Please remove redundant word "curve" which occurs within the documentation of curve.py and integrated_curve.py.

Done in the above commit.

> 2) Are we letting the TODO's remain undone for this release?

IMHO yes, because they require substantial work and do not hinder the functionality implemented here.

> 3) In vectorfield_module.py, two occurrences each of "from the North pole" and "from the South pole" were changed to "from North pole" and "from South pole", respectively, resulting in non-standard English.

Corrected in the above commit; thanks.

Besides the above typos, the last commit restores the trig simplification that was commented out in `simplify_chain_generic_sympy` and `simplify_chain_real_sympy`. On general grounds, the SymPy simplification chain should be improved in another ticket.



---

archive/issue_comments_314643.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-11-03T09:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314643",
    "user": "egourgoulhon"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_314644.json:
```json
{
    "body": "Finished review of all changed code and docs. \nI concur with status of positive_review.",
    "created_at": "2017-11-04T01:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314644",
    "user": "rllozes"
}
```

Finished review of all changed code and docs. 
I concur with status of positive_review.



---

archive/issue_comments_314645.json:
```json
{
    "body": "Attachment\n\nReplying to [comment:78 egourgoulhon]:\n> Replying to [comment:75 rllozes]:\n> > \n> > Sorry - Please see second attachment. I will still try to find a simpler case.\n> \n> Sorry I still cannot read this file: when I run `sage -n sagenb` and try to open it, I get \"500: internal server error\".\n\nI have just uploaded another copy, with a new name, after stripping the output and a few commented-out cells. It should open with the standard upload link in the Sage Notebook. It should run as is, and it should fail after changing Parallelism().set(nproc=1) from 1 to 2.",
    "created_at": "2017-11-04T01:54:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314645",
    "user": "rllozes"
}
```

Attachment

Replying to [comment:78 egourgoulhon]:
> Replying to [comment:75 rllozes]:
> > 
> > Sorry - Please see second attachment. I will still try to find a simpler case.
> 
> Sorry I still cannot read this file: when I run `sage -n sagenb` and try to open it, I get "500: internal server error".

I have just uploaded another copy, with a new name, after stripping the output and a few commented-out cells. It should open with the standard upload link in the Sage Notebook. It should run as is, and it should fail after changing Parallelism().set(nproc=1) from 1 to 2.



---

archive/issue_comments_314646.json:
```json
{
    "body": "I have the same error,\nlooking into the file I don't see any sage command.",
    "created_at": "2017-11-04T05:53:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314646",
    "user": "mmancini"
}
```

I have the same error,
looking into the file I don't see any sage command.



---

archive/issue_comments_314647.json:
```json
{
    "body": "Replying to [comment:82 rllozes]:\n> \n> I have just uploaded another copy, with a new name, after stripping the output and a few commented-out cells. It should open with the standard upload link in the Sage Notebook. It should run as is, and it should fail after changing Parallelism().set(nproc=1) from 1 to 2.\n\nThis time, I can open the worksheet. Thank you. I am just running it.",
    "created_at": "2017-11-04T08:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314647",
    "user": "egourgoulhon"
}
```

Replying to [comment:82 rllozes]:
> 
> I have just uploaded another copy, with a new name, after stripping the output and a few commented-out cells. It should open with the standard upload link in the Sage Notebook. It should run as is, and it should fail after changing Parallelism().set(nproc=1) from 1 to 2.

This time, I can open the worksheet. Thank you. I am just running it.



---

archive/issue_comments_314648.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-11-04T23:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314648",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_314649.json:
```json
{
    "body": "Merge conflict with #24062",
    "created_at": "2017-11-04T23:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314649",
    "user": "vbraun"
}
```

Merge conflict with #24062



---

archive/issue_comments_314650.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-06T10:15:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314650",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314651.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-11-06T10:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314651",
    "user": "mmancini"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_314652.json:
```json
{
    "body": "The merge with #24062 done in the last commit. \nNo problem for me",
    "created_at": "2017-11-06T10:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314652",
    "user": "mmancini"
}
```

The merge with #24062 done in the last commit. 
No problem for me



---

archive/issue_comments_314653.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-06T14:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314653",
    "user": "rws"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_314654.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2017-11-12T13:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314654",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_314655.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2017-11-12T13:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314655",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_314656.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-12T13:47:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314656",
    "user": "egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_314657.json:
```json
{
    "body": "The above commit simply fixes a conflict with #24199. So I am setting the ticket back to \"positive review\".",
    "created_at": "2017-11-12T13:47:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314657",
    "user": "egourgoulhon"
}
```

The above commit simply fixes a conflict with #24199. So I am setting the ticket back to "positive review".



---

archive/issue_comments_314658.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2017-11-23T16:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314658",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_314659.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2017-11-23T16:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314659",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_314660.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-23T16:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314660",
    "user": "egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_314661.json:
```json
{
    "body": "The above commit simply solves a new merge conflict that appeared after the replacement of #24199 by #24232 in the dependencies.",
    "created_at": "2017-11-23T16:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314661",
    "user": "egourgoulhon"
}
```

The above commit simply solves a new merge conflict that appeared after the replacement of #24199 by #24232 in the dependencies.



---

archive/issue_comments_314662.json:
```json
{
    "body": "See the following bug report, in case\nhttps://groups.google.com/d/msg/sage-devel/3sN7gVTdNuY/U9v70LoDAwAJ\n\nBy the way, I wonder why you prefer using pexpect interface to maxima, instead of much faster maxima_calcuclus loadable library interface?",
    "created_at": "2017-11-26T10:22:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314662",
    "user": "dimpase"
}
```

See the following bug report, in case
https://groups.google.com/d/msg/sage-devel/3sN7gVTdNuY/U9v70LoDAwAJ

By the way, I wonder why you prefer using pexpect interface to maxima, instead of much faster maxima_calcuclus loadable library interface?



---

archive/issue_comments_314663.json:
```json
{
    "body": "Replying to [comment:94 dimpase]:\n> See the following bug report, in case\n> https://groups.google.com/d/msg/sage-devel/3sN7gVTdNuY/U9v70LoDAwAJ\n> \n\nAs you pointed out in https://groups.google.com/d/msg/sage-devel/3sN7gVTdNuY/U9v70LoDAwAJ , this bug is not related to this ticket.\n\n> By the way, I wonder why you prefer using pexpect interface to maxima, instead of much faster maxima_calcuclus loadable library interface?\n\nCertainly by lack of knowledge... Thanks for your feedback! Can you elaborate a little bit though? Do you mean it is bad to use `expr._maxima_()` for `expr` in `SR`?",
    "created_at": "2017-11-26T14:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314663",
    "user": "egourgoulhon"
}
```

Replying to [comment:94 dimpase]:
> See the following bug report, in case
> https://groups.google.com/d/msg/sage-devel/3sN7gVTdNuY/U9v70LoDAwAJ
> 

As you pointed out in https://groups.google.com/d/msg/sage-devel/3sN7gVTdNuY/U9v70LoDAwAJ , this bug is not related to this ticket.

> By the way, I wonder why you prefer using pexpect interface to maxima, instead of much faster maxima_calcuclus loadable library interface?

Certainly by lack of knowledge... Thanks for your feedback! Can you elaborate a little bit though? Do you mean it is bad to use `expr._maxima_()` for `expr` in `SR`?



---

archive/issue_comments_314664.json:
```json
{
    "body": "Replying to [comment:95 egourgoulhon]:\n> Certainly by lack of knowledge... Thanks for your feedback! Can you elaborate a little bit though? Do you mean it is bad to use `expr._maxima_()` for `expr` in `SR`?\n\nThis uses `sage/interfaces/interfaces.py` which is pexpect. The libmaxima functionality can be found in `sage/interfaces/maxima_lib.py`.",
    "created_at": "2017-11-26T14:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314664",
    "user": "rws"
}
```

Replying to [comment:95 egourgoulhon]:
> Certainly by lack of knowledge... Thanks for your feedback! Can you elaborate a little bit though? Do you mean it is bad to use `expr._maxima_()` for `expr` in `SR`?

This uses `sage/interfaces/interfaces.py` which is pexpect. The libmaxima functionality can be found in `sage/interfaces/maxima_lib.py`.



---

archive/issue_comments_314665.json:
```json
{
    "body": "I wonder why `_maxima_lib_()` is used only in few places in the library code, as opposed to `_maxima_()`. Should one open a ticket to modify all these places? \n\nCertainly `maxima_lib` is more robust and ought to be faster on large data of certain type, at least. It runs Maxima in a Python extension module rather than talks to Maxima run as an external process.",
    "created_at": "2017-11-26T15:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314665",
    "user": "dimpase"
}
```

I wonder why `_maxima_lib_()` is used only in few places in the library code, as opposed to `_maxima_()`. Should one open a ticket to modify all these places? 

Certainly `maxima_lib` is more robust and ought to be faster on large data of certain type, at least. It runs Maxima in a Python extension module rather than talks to Maxima run as an external process.



---

archive/issue_comments_314666.json:
```json
{
    "body": "Replying to [comment:97 dimpase]:\n> I wonder why `_maxima_lib_()` is used only in few places in the library code, as opposed to `_maxima_()`. Should one open a ticket to modify all these places? \n> \n\nFrom what you say about `maxima_lib`, I would say yes. In particular, `_maxima_()` is used in various methods of `sage.symbolic.expression.Expression`, like `simplify()`, `simplify_factorial()` and `simplify_trig()`.",
    "created_at": "2017-11-26T16:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314666",
    "user": "egourgoulhon"
}
```

Replying to [comment:97 dimpase]:
> I wonder why `_maxima_lib_()` is used only in few places in the library code, as opposed to `_maxima_()`. Should one open a ticket to modify all these places? 
> 

From what you say about `maxima_lib`, I would say yes. In particular, `_maxima_()` is used in various methods of `sage.symbolic.expression.Expression`, like `simplify()`, `simplify_factorial()` and `simplify_trig()`.



---

archive/issue_comments_314667.json:
```json
{
    "body": "See #17753 and https://trac.sagemath.org/wiki/symbolics/maxima for a summary.",
    "created_at": "2017-11-26T16:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314667",
    "user": "rws"
}
```

See #17753 and https://trac.sagemath.org/wiki/symbolics/maxima for a summary.



---

archive/issue_comments_314668.json:
```json
{
    "body": "In the code at https://groups.google.com/d/msg/sage-devel/3sN7gVTdNuY/U9v70LoDAwAJ, if we change the computation method from 'SR' to 'sympy', the same Maxima/ECL bug occurs when computing g.inverse(), where 'g' is the Riemannian metric. Why does the code call the same simplification logic, disregarding the computation method setting as 'sympy'?",
    "created_at": "2017-11-28T02:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314668",
    "user": "rllozes"
}
```

In the code at https://groups.google.com/d/msg/sage-devel/3sN7gVTdNuY/U9v70LoDAwAJ, if we change the computation method from 'SR' to 'sympy', the same Maxima/ECL bug occurs when computing g.inverse(), where 'g' is the Riemannian metric. Why does the code call the same simplification logic, disregarding the computation method setting as 'sympy'?



---

archive/issue_comments_314669.json:
```json
{
    "body": "Please open a new ticket.",
    "created_at": "2017-11-28T06:51:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314669",
    "user": "rws"
}
```

Please open a new ticket.



---

archive/issue_comments_314670.json:
```json
{
    "body": "Replying to [comment:101 rws]:\n> Please open a new ticket.\n\nThis is #24290. It was on the todo list anyway (cf. the TODO statement in line 794 of https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/manifolds/utilities.py?id=780e1a477fe81c46d32286174fcb58d53e8cbe4c ).",
    "created_at": "2017-11-28T08:43:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314670",
    "user": "egourgoulhon"
}
```

Replying to [comment:101 rws]:
> Please open a new ticket.

This is #24290. It was on the todo list anyway (cf. the TODO statement in line 794 of https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/manifolds/utilities.py?id=780e1a477fe81c46d32286174fcb58d53e8cbe4c ).



---

archive/issue_comments_314671.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-12-13T17:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22564#issuecomment-314671",
    "user": "vbraun"
}
```

Resolution: fixed
