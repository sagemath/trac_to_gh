# Issue 26203: Fusion algebras from Weyl Character Rings

Issue created by migration from https://trac.sagemath.org/ticket/26440

Original creator: bump

Original creation time: 2018-10-09 13:53:02

CC:  tscrim sage-combinat bump

Fusion algebras for WZW conformal field theories can be computed easily as instances of WeylCharacterRings. The `WeylCharacterRing` code is modified with an optional parameter k, the level. If `k==None` the behavior is unchanged. However if k is a positive integer the corresponding fusion ring is created. The reason this works is that the Kac-Walton algorithm for computing the fusion products is closely similar to the Brauer-Klimyk (aka Racah-Speiser) algorithm that is already used by the `WeylCharacterRing`. One has only to add an affine reflection to make the algorithm compute the fusion product.


---

Comment by bump created at 2018-10-09 14:04:20

Changing type from PLEASE CHANGE to enhancement.


---

Comment by bump created at 2018-10-09 14:04:20

Set assignee to bump.


---

Comment by bump created at 2018-10-09 14:26:29

New commits:


---

Comment by git created at 2018-10-10 01:07:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-10 01:09:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bump created at 2018-10-10 03:58:40

For fusion rings, we should have a method that returns the (finite) canonical basis as a list or an iterator. Actually `WeylCharacterRing` has a basis method that it inherits from `CombinatorialFreeModule`. 

To avoid confusion with this basis method, the method that returns the basis as a list could then be called `fusion_basis`.

So, what is the best way to enumerate all dominant weights of level `<= k`?


---

Comment by tscrim created at 2018-10-10 04:07:29

Replying to [comment:5 bump]:
> For fusion rings, we should have a method that returns the (finite) canonical basis as a list or an iterator. Actually `WeylCharacterRing` has a basis method that it inherits from `CombinatorialFreeModule`. 
> 
> To avoid confusion with this basis method, the method that returns the basis as a list could then be called `fusion_basis`.

I am not sure I like the basis for the fusion ring being anything other than what you want to call the `fusion_basis`. More generally, I am not sure I like that the basis for `WeylCharacterRing` is not the set of dominant integral weights. Since the fusion algebra is finite-dimensional, I definite would rather have `basis` correspond to the dominant weights of level `<= k` (which we would give in the `__init__` to `CombinatorialFreeModule`).

> So, what is the best way to enumerate all dominant weights of level `<= k`?

I just constructed this as a `RecursivelyEnumeratedSet`, but we could also use `WeightedIntegerVectors`. Between those two, I have not run timings to determine which is faster. Both should take 2 lines to construct (one to get the levels, one to construct the parent to iterate over).


---

Comment by bump created at 2018-10-10 04:18:08

> I am not sure I like the basis for the fusion ring being anything other than what you want to call the fusion_basis.

Does this mean we should overwrite the existing basis method (which, you are pointing out is already not correct)?

> I just constructed this as a RecursivelyEnumeratedSet, but we could also use WeightedIntegerVectors. Between those two, I have not run timings to determine which is faster. Both should take 2 lines to construct (one to get the levels, one to construct the parent to iterate over).

I doubt whether speed is an issue for this. The user will run it once. So you could choose on the basis of elegance rather than timing.


---

Comment by tscrim created at 2018-10-10 05:00:56

Replying to [comment:7 bump]:
> > I am not sure I like the basis for the fusion ring being anything other than what you want to call the fusion_basis.
> 
> Does this mean we should overwrite the existing basis method (which, you are pointing out is already not correct)?

Well, sort of. What I think should be done is the correct indices needs to be passed to `CombinatorialFreeModule.__init__` (instead of `self._space`). This will also automatically put it into the category of `FiniteDimensionalModulesWithBasis` and give it extra methods.

With the existing basis method, the actual basis is too big as it says that, e.g., -\Lambda<sub>1</sub> is a basis elements. However, this is not allowed through more standard constructions. For simplicity of the implementation, this is nice. Although for the `style='coroots'`, you can get a fair bit of speed by using weights expressed as linear combinations of fundamental weights rather than in the ambient basis (I have some really hacked together code to get some computations at a reasonable speed and memory usage I need in E<sub>7</sub> that I need to cleanup to get into Sage). Although it means some code duplication and added complexity. However, this makes it more ameable to the "correct" basis. Unless I am misunderstanding something about what this should be able to compute.

> > I just constructed this as a RecursivelyEnumeratedSet, but we could also use WeightedIntegerVectors. Between those two, I have not run timings to determine which is faster. Both should take 2 lines to construct (one to get the levels, one to construct the parent to iterate over).
> 
> I doubt whether speed is an issue for this. The user will run it once. So you could choose on the basis of elegance rather than timing.

Timing might matter if someone wants to construct a "large" rank and level example. In terms of elegance, I would say `WeightedIntegerVectors` is better and more inline with the output as sums of fundamental weights (as dense vectors).


---

Comment by git created at 2018-10-10 16:54:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-10 17:05:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bump created at 2018-10-10 17:08:59

I implemented `fusion_basis` method using `RecursivelyEnumeratedSet`. Travis, feel free to change basis per comments 6 and 8.

I also fixed a bug that broke WeylCharacterRing for reducible types.


---

Comment by bump created at 2018-10-11 12:53:15

Changing keywords from "" to "Fusion Ring, Verlinde Algebra".


---

Comment by bump created at 2018-10-11 12:53:15

Changing status from new to needs_review.


---

Comment by git created at 2018-10-19 21:58:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-20 15:05:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-24 02:56:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-24 02:58:34

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2018-10-24 03:00:14

I made the `FusionRing` explicitly construct and set its basis on initialization. One small drawback to this is that a basis has to be constructed at initialization, but it should be relatively quick to compute since it is just adding weights.

One issue I did find and fix is with type A and the ambient space not having a well-defined normalization for the fundamental weights. So I instead converted the ambient weights to be expressed in terms of the fundamental weights (i.e., how `style="coroots"` prints) to match up with the `fusion_labels`.


---

Comment by tscrim created at 2018-10-24 03:02:09

So I think all we need to do at this point to set this to a positive review is to add the appropriate documentation and tests.


---

Comment by git created at 2018-10-24 05:45:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bump created at 2018-10-24 05:49:45

> So I think all we need to do at this point to set this to a positive review is to add the appropriate documentation and tests.

Most of the new methods have doctests.

I just made a minor change which is to make dual a method of the element, not the ring.

I'm a little dissatisfied that the S-matrix has not been implemented but that can be another patch.


---

Comment by git created at 2018-10-25 14:54:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-25 20:09:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-25 20:50:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-26 02:20:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-10-26 02:21:59

I added some additional doctests, which led me to finding a bug with `some_elements` returning elements that are not basis elements of the fusion ring because the level of the fundamental weight is too large. I also moved the references to the masted reference file (and added a bit more details to them). If my changes are good, then you can set a positive review.


---

Comment by bump created at 2018-10-27 01:44:31

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-10-27 22:56:21

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2018-10-27 22:56:21

Test failures (see patchbot)


---

Comment by git created at 2018-10-27 23:21:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-10-27 23:22:17

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-10-27 23:22:17

The failures come from the difference between `is_atomic` and `is_irreducible`. I changed this to the appropriate tests. Please check.


---

Comment by git created at 2018-10-27 23:23:21

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2018-10-27 23:23:59

I also did some small tweaks for speed.


---

Comment by bump created at 2018-10-28 19:37:29

This passes the tests in weyl_characters.py and I am also able to build the documentation. May I change the status back to positive_review?


---

Comment by tscrim created at 2018-10-28 19:43:03

Thank you. They also pass for me.


---

Comment by tscrim created at 2018-10-28 19:43:03

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-10-29 22:46:36

Resolution: fixed
