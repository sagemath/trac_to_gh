# Issue 29343: homebrew-macos-standard-gcc_spkg: library not found for -lmpc while building gcc

Issue created by migration from https://trac.sagemath.org/ticket/29580

Original creator: mkoeppe

Original creation time: 2020-04-25 18:12:46

CC:  jhpalmieri slelievre dimpase

On macOS with a bunch of homebrew packages installed and with `./configure --with-system-gcc=no`:


```
[gcc-9.2.0]   	  cc1-checksum.o libbackend.a main.o libcommon-target.a libcommon.a ../libcpp/libcpp.a ../libdecnumber/libdecnumber.a libcommon.a ../libcpp/libcpp.a  -liconv ../libbacktrace/.libs/libbacktrace.a ../libiberty/libiberty.a ../libdecnumber/libdecnumber.a   -lmpc -lmpfr -lgmp   -lz
  [gcc-9.2.0]   ld: library not found for -lmpc
  [gcc-9.2.0]   collect2: error: ld returned 1 exit status
  [gcc-9.2.0]   ld: library not found for -lmpc
  [gcc-9.2.0]   collect2: error: ld returned 1 exit status
  [gcc-9.2.0]   make[6]: *** [cc1plus] Error 1
  [gcc-9.2.0]   make[6]: *** [cc1] Error 1
  [gcc-9.2.0]   make[6]: Target `all' not remade because of errors.
  [gcc-9.2.0]   rm gfortran.pod gcc.pod
  [gcc-9.2.0]   make[5]: *** [all-stage2-gcc] Error 2
  [gcc-9.2.0]   make[5]: Target `all-stage2' not remade because of errors.
  [gcc-9.2.0]   make[4]: *** [stage2-bubble] Error 2
  [gcc-9.2.0]   make[4]: Target `stage3-bubble' not remade because of errors.
  [gcc-9.2.0]   make[3]: *** [all] Error 2
  [gcc-9.2.0]   ********************************************************************************
  [gcc-9.2.0]   Error building gcc-9.2.0
  [gcc-9.2.0]   ********************************************************************************
  [gcc-9.2.0]   
  [gcc-9.2.0]   real	29m43.664s
  [gcc-9.2.0]   user	215m9.194s
  [gcc-9.2.0]   sys	11m33.054s
  [gcc-9.2.0]   ************************************************************************
  [gcc-9.2.0]   Error building package gcc-9.2.0
  [gcc-9.2.0]   ************************************************************************
  [gcc-9.2.0] Full log file: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/logs/pkgs/gcc-9.2.0.log
```


To test: `tox -e local-homebrew-macos-standard-gcc_spkg`

(from #26426)



---

Comment by dimpase created at 2020-04-26 08:28:10

What's the point of building gcc on MacOS? One cannot build Sage without Apple's or Conda's clang, anyway, as Apple polluted its system headers with blocks, which are not understood by unpatched gcc.


---

Comment by jhpalmieri created at 2020-04-26 19:39:59

That's a good question. The Sage `gfortran` package builds, unlike `gcc`, although it seems to lead to some doctest failures.


---

Comment by mkoeppe created at 2020-04-26 19:46:32

Replying to [comment:1 dimpase]:
>  One cannot build Sage without Apple's or Conda's clang, anyway, as Apple polluted its system headers with blocks, which are not understood by unpatched gcc.

Do we know if this is still true with current gcc versions? It's not like macOS is some obscure platform.

Anyway, it's not important to fix for 9.1.


---

Comment by dimpase created at 2020-04-27 01:44:14

Replying to [comment:3 mkoeppe]:
> Replying to [comment:1 dimpase]:
> >  One cannot build Sage without Apple's or Conda's clang, anyway, as Apple polluted its system headers with blocks, which are not understood by unpatched gcc.
> 
> Do we know if this is still true with current gcc versions? It's not like macOS is some obscure platform.

You can try with Homebrew's gcc, but note that https://gcc.gnu.org/bugzilla/show_bug.cgi?id=78352
is still open.


---

Comment by mkoeppe created at 2020-04-28 13:41:30

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-04-28 13:41:30

I think this may just have been a problem caused by a bad `.homebrew-build-env`. With #29607, `gcc` installs correctly and in the build so far I only see a failing `givaro`.


---

Comment by mkoeppe created at 2020-04-28 14:51:31

The givaro build failure is now #29613.


---

Comment by jhpalmieri created at 2020-04-28 16:38:46

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2020-04-28 16:38:46

I agree, `gcc` builds with #29607.


---

Comment by chapoton created at 2020-06-04 18:51:29

Resolution: invalid
