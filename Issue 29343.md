# Issue 29343: homebrew-macos-standard-gcc_spkg: library not found for -lmpc while building gcc

archive/issues_029343.json:
```json
{
    "body": "CC:  jhpalmieri slelievre dimpase\n\nOn macOS with a bunch of homebrew packages installed and with `./configure --with-system-gcc=no`:\n\n\n```\n[gcc-9.2.0]   \t  cc1-checksum.o libbackend.a main.o libcommon-target.a libcommon.a ../libcpp/libcpp.a ../libdecnumber/libdecnumber.a libcommon.a ../libcpp/libcpp.a  -liconv ../libbacktrace/.libs/libbacktrace.a ../libiberty/libiberty.a ../libdecnumber/libdecnumber.a   -lmpc -lmpfr -lgmp   -lz\n  [gcc-9.2.0]   ld: library not found for -lmpc\n  [gcc-9.2.0]   collect2: error: ld returned 1 exit status\n  [gcc-9.2.0]   ld: library not found for -lmpc\n  [gcc-9.2.0]   collect2: error: ld returned 1 exit status\n  [gcc-9.2.0]   make[6]: *** [cc1plus] Error 1\n  [gcc-9.2.0]   make[6]: *** [cc1] Error 1\n  [gcc-9.2.0]   make[6]: Target `all' not remade because of errors.\n  [gcc-9.2.0]   rm gfortran.pod gcc.pod\n  [gcc-9.2.0]   make[5]: *** [all-stage2-gcc] Error 2\n  [gcc-9.2.0]   make[5]: Target `all-stage2' not remade because of errors.\n  [gcc-9.2.0]   make[4]: *** [stage2-bubble] Error 2\n  [gcc-9.2.0]   make[4]: Target `stage3-bubble' not remade because of errors.\n  [gcc-9.2.0]   make[3]: *** [all] Error 2\n  [gcc-9.2.0]   ********************************************************************************\n  [gcc-9.2.0]   Error building gcc-9.2.0\n  [gcc-9.2.0]   ********************************************************************************\n  [gcc-9.2.0]   \n  [gcc-9.2.0]   real\t29m43.664s\n  [gcc-9.2.0]   user\t215m9.194s\n  [gcc-9.2.0]   sys\t11m33.054s\n  [gcc-9.2.0]   ************************************************************************\n  [gcc-9.2.0]   Error building package gcc-9.2.0\n  [gcc-9.2.0]   ************************************************************************\n  [gcc-9.2.0] Full log file: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/logs/pkgs/gcc-9.2.0.log\n```\n\n\nTo test: `tox -e local-homebrew-macos-standard-gcc_spkg`\n\n(from #26426)\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/29580\n\n",
    "created_at": "2020-04-25T18:12:46Z",
    "labels": [
        "packages: standard",
        "critical",
        "bug"
    ],
    "title": "homebrew-macos-standard-gcc_spkg: library not found for -lmpc while building gcc",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29343",
    "user": "mkoeppe"
}
```
CC:  jhpalmieri slelievre dimpase

On macOS with a bunch of homebrew packages installed and with `./configure --with-system-gcc=no`:


```
[gcc-9.2.0]   	  cc1-checksum.o libbackend.a main.o libcommon-target.a libcommon.a ../libcpp/libcpp.a ../libdecnumber/libdecnumber.a libcommon.a ../libcpp/libcpp.a  -liconv ../libbacktrace/.libs/libbacktrace.a ../libiberty/libiberty.a ../libdecnumber/libdecnumber.a   -lmpc -lmpfr -lgmp   -lz
  [gcc-9.2.0]   ld: library not found for -lmpc
  [gcc-9.2.0]   collect2: error: ld returned 1 exit status
  [gcc-9.2.0]   ld: library not found for -lmpc
  [gcc-9.2.0]   collect2: error: ld returned 1 exit status
  [gcc-9.2.0]   make[6]: *** [cc1plus] Error 1
  [gcc-9.2.0]   make[6]: *** [cc1] Error 1
  [gcc-9.2.0]   make[6]: Target `all' not remade because of errors.
  [gcc-9.2.0]   rm gfortran.pod gcc.pod
  [gcc-9.2.0]   make[5]: *** [all-stage2-gcc] Error 2
  [gcc-9.2.0]   make[5]: Target `all-stage2' not remade because of errors.
  [gcc-9.2.0]   make[4]: *** [stage2-bubble] Error 2
  [gcc-9.2.0]   make[4]: Target `stage3-bubble' not remade because of errors.
  [gcc-9.2.0]   make[3]: *** [all] Error 2
  [gcc-9.2.0]   ********************************************************************************
  [gcc-9.2.0]   Error building gcc-9.2.0
  [gcc-9.2.0]   ********************************************************************************
  [gcc-9.2.0]   
  [gcc-9.2.0]   real	29m43.664s
  [gcc-9.2.0]   user	215m9.194s
  [gcc-9.2.0]   sys	11m33.054s
  [gcc-9.2.0]   ************************************************************************
  [gcc-9.2.0]   Error building package gcc-9.2.0
  [gcc-9.2.0]   ************************************************************************
  [gcc-9.2.0] Full log file: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/logs/pkgs/gcc-9.2.0.log
```


To test: `tox -e local-homebrew-macos-standard-gcc_spkg`

(from #26426)


Issue created by migration from https://trac.sagemath.org/ticket/29580





---

archive/issue_comments_416054.json:
```json
{
    "body": "What's the point of building gcc on MacOS? One cannot build Sage without Apple's or Conda's clang, anyway, as Apple polluted its system headers with blocks, which are not understood by unpatched gcc.",
    "created_at": "2020-04-26T08:28:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29343#issuecomment-416054",
    "user": "dimpase"
}
```

What's the point of building gcc on MacOS? One cannot build Sage without Apple's or Conda's clang, anyway, as Apple polluted its system headers with blocks, which are not understood by unpatched gcc.



---

archive/issue_comments_416055.json:
```json
{
    "body": "That's a good question. The Sage `gfortran` package builds, unlike `gcc`, although it seems to lead to some doctest failures.",
    "created_at": "2020-04-26T19:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29343#issuecomment-416055",
    "user": "jhpalmieri"
}
```

That's a good question. The Sage `gfortran` package builds, unlike `gcc`, although it seems to lead to some doctest failures.



---

archive/issue_comments_416056.json:
```json
{
    "body": "Replying to [comment:1 dimpase]:\n>  One cannot build Sage without Apple's or Conda's clang, anyway, as Apple polluted its system headers with blocks, which are not understood by unpatched gcc.\n\nDo we know if this is still true with current gcc versions? It's not like macOS is some obscure platform.\n\nAnyway, it's not important to fix for 9.1.",
    "created_at": "2020-04-26T19:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29343#issuecomment-416056",
    "user": "mkoeppe"
}
```

Replying to [comment:1 dimpase]:
>  One cannot build Sage without Apple's or Conda's clang, anyway, as Apple polluted its system headers with blocks, which are not understood by unpatched gcc.

Do we know if this is still true with current gcc versions? It's not like macOS is some obscure platform.

Anyway, it's not important to fix for 9.1.



---

archive/issue_comments_416057.json:
```json
{
    "body": "Replying to [comment:3 mkoeppe]:\n> Replying to [comment:1 dimpase]:\n> >  One cannot build Sage without Apple's or Conda's clang, anyway, as Apple polluted its system headers with blocks, which are not understood by unpatched gcc.\n> \n> Do we know if this is still true with current gcc versions? It's not like macOS is some obscure platform.\n\nYou can try with Homebrew's gcc, but note that https://gcc.gnu.org/bugzilla/show_bug.cgi?id=78352\nis still open.",
    "created_at": "2020-04-27T01:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29343#issuecomment-416057",
    "user": "dimpase"
}
```

Replying to [comment:3 mkoeppe]:
> Replying to [comment:1 dimpase]:
> >  One cannot build Sage without Apple's or Conda's clang, anyway, as Apple polluted its system headers with blocks, which are not understood by unpatched gcc.
> 
> Do we know if this is still true with current gcc versions? It's not like macOS is some obscure platform.

You can try with Homebrew's gcc, but note that https://gcc.gnu.org/bugzilla/show_bug.cgi?id=78352
is still open.



---

archive/issue_comments_416058.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-04-28T13:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29343#issuecomment-416058",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_416059.json:
```json
{
    "body": "I think this may just have been a problem caused by a bad `.homebrew-build-env`. With #29607, `gcc` installs correctly and in the build so far I only see a failing `givaro`.",
    "created_at": "2020-04-28T13:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29343#issuecomment-416059",
    "user": "mkoeppe"
}
```

I think this may just have been a problem caused by a bad `.homebrew-build-env`. With #29607, `gcc` installs correctly and in the build so far I only see a failing `givaro`.



---

archive/issue_comments_416060.json:
```json
{
    "body": "The givaro build failure is now #29613.",
    "created_at": "2020-04-28T14:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29343#issuecomment-416060",
    "user": "mkoeppe"
}
```

The givaro build failure is now #29613.



---

archive/issue_comments_416061.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-28T16:38:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29343#issuecomment-416061",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_416062.json:
```json
{
    "body": "I agree, `gcc` builds with #29607.",
    "created_at": "2020-04-28T16:38:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29343#issuecomment-416062",
    "user": "jhpalmieri"
}
```

I agree, `gcc` builds with #29607.



---

archive/issue_comments_416063.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2020-06-04T18:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29343#issuecomment-416063",
    "user": "chapoton"
}
```

Resolution: invalid
