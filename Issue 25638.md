# Issue 25638: Make genera immutable and add a reasonable constructor

Issue created by migration from Trac.

Original creator: sbrandhorst

Original creation time: 2018-07-18 11:26:07

CC:  annahaensch tscrim

Currently a genus is constructed from a matrix. 
This is inconvenient if one knows the genus but not a representative. 
This ticket changes the constructor in order to accept a list of symbols instead.

The symbols are lists of lists of intergers. 
It seems better to make them tuples of tuples of integers 
as they are not mutated after construction.


---

Comment by git created at 2018-07-18 14:48:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-19 10:30:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-08-29 07:44:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-20 09:14:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-09-20 09:22:44

Changing status from new to needs_review.


---

Comment by git created at 2018-09-20 11:38:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-03 13:50:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-03 15:49:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-10-03 17:03:03

Doc builds and seems to look OK.

./sage -t src/sage/quadratic_forms/genera/genus.py

passes. Let's see what the bots say


---

Comment by sbrandhorst created at 2018-10-07 18:15:12

mhhh


---

Comment by tscrim created at 2018-10-07 22:33:09

Some little things:

```
-all([type(sym)==Genus_Symbol_p_adic_ring for sym in local_symbols]):
+all(isinstance(sym, Genus_Symbol_p_adic_ring) for sym in local_symbols):
```

(unless you really specifically only want that one type. Also note the lack of list comprehension (there is another `all` test that should remove it as well).

Generally, we do alignment like this:

```
    - ``factored_determinant`` -- (default: ``None``) a factorization object
      the factored determinant of ``A``
```


You're also responsible should any complaints arise about the changes to the interface (although I do think it is highly unlikely) since you are changing it without deprecation.


---

Comment by git created at 2018-10-08 09:18:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-10-08 09:22:28

Replying to [comment:19 tscrim]:
> You're also responsible should any complaints arise about the changes to the interface (although I do think it is highly unlikely) since you are changing it without deprecation.

Okay. I agree that it is highly unlikely. 
Indeed, there are three entry points that remain unchanged:
`sage.quadratic_forms.genera.genus`
`sage.quadratic_forms.quadratic_form.global_genus_symbol`
`sage.modules.free_quadratic_module_integer_symmetric.genus`


---

Comment by tscrim created at 2018-10-08 22:34:14

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-10-08 22:34:14

Thanks. LGTM.


---

Comment by tscrim created at 2018-10-08 22:35:42

Whoops, your `isinstance` is backwards.


---

Comment by tscrim created at 2018-10-08 22:35:42

Changing status from positive_review to needs_work.


---

Comment by git created at 2018-10-09 07:39:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-09 07:56:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-10-09 08:04:23

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-10-09 13:13:13

From the patchbot:

```
File "src/sage/quadratic_forms/genera/genus.py", line 59, in sage.quadratic_forms.genera.genus.Genus
Failed example:
    Genus(A, A.det().factor())
Expected:
    Genus of
    [2 1]
    [1 2]
    Genus symbol at 2:    1^-2
    Genus symbol at 3:     1^-1 3^-1
Got:
    Genus of
    [2 1]
    [1 2]
    Signature:  (2, 0)
    Genus symbol at 2:    1^-2
    Genus symbol at 3:     1^-1 3^-1
**********************************************************************
1 item had failures:
   1 of   5 in sage.quadratic_forms.genera.genus.Genus
    [364 tests, 1 failure, 1.53 s]
```

Looks like just a missed doctest from when you added the signature to the output. Once fixed, you can set a positive review.


---

Comment by git created at 2018-10-09 16:57:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-10-09 16:59:09

The signature was added in 8.4.rc0. Merged that to fix the doctests.


---

Comment by sbrandhorst created at 2018-10-09 17:01:51

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-10-20 11:58:55

Resolution: fixed


---

Comment by embray created at 2018-10-28 14:52:23

This should be re-targeted for 8.5.
