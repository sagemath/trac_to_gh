# Issue 25638: Make genera immutable and add a reasonable constructor

archive/issues_025638.json:
```json
{
    "body": "CC:  annahaensch tscrim\n\nCurrently a genus is constructed from a matrix. \nThis is inconvenient if one knows the genus but not a representative. \nThis ticket changes the constructor in order to accept a list of symbols instead.\n\nThe symbols are lists of lists of intergers. \nIt seems better to make them tuples of tuples of integers \nas they are not mutated after construction.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25875\n\n",
    "created_at": "2018-07-18T11:26:07Z",
    "labels": [
        "quadratic forms",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "Make genera immutable and add a reasonable constructor",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25638",
    "user": "sbrandhorst"
}
```
CC:  annahaensch tscrim

Currently a genus is constructed from a matrix. 
This is inconvenient if one knows the genus but not a representative. 
This ticket changes the constructor in order to accept a list of symbols instead.

The symbols are lists of lists of intergers. 
It seems better to make them tuples of tuples of integers 
as they are not mutated after construction.

Issue created by migration from https://trac.sagemath.org/ticket/25875





---

archive/issue_comments_361638.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-18T14:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361638",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361639.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-19T10:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361639",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361640.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-29T07:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361640",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361641.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-20T09:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361641",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361642.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-09-20T09:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361642",
    "user": "sbrandhorst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_361643.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-20T11:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361643",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361644.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-03T13:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361644",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361645.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-03T15:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361645",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361646.json:
```json
{
    "body": "Doc builds and seems to look OK.\n\n./sage -t src/sage/quadratic_forms/genera/genus.py\n\npasses. Let's see what the bots say",
    "created_at": "2018-10-03T17:03:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361646",
    "user": "sbrandhorst"
}
```

Doc builds and seems to look OK.

./sage -t src/sage/quadratic_forms/genera/genus.py

passes. Let's see what the bots say



---

archive/issue_comments_361647.json:
```json
{
    "body": "mhhh",
    "created_at": "2018-10-07T18:15:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361647",
    "user": "sbrandhorst"
}
```

mhhh



---

archive/issue_comments_361648.json:
```json
{
    "body": "Some little things:\n\n```\n-all([type(sym)==Genus_Symbol_p_adic_ring for sym in local_symbols]):\n+all(isinstance(sym, Genus_Symbol_p_adic_ring) for sym in local_symbols):\n```\n\n(unless you really specifically only want that one type. Also note the lack of list comprehension (there is another `all` test that should remove it as well).\n\nGenerally, we do alignment like this:\n\n```\n    - ``factored_determinant`` -- (default: ``None``) a factorization object\n      the factored determinant of ``A``\n```\n\n\nYou're also responsible should any complaints arise about the changes to the interface (although I do think it is highly unlikely) since you are changing it without deprecation.",
    "created_at": "2018-10-07T22:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361648",
    "user": "tscrim"
}
```

Some little things:

```
-all([type(sym)==Genus_Symbol_p_adic_ring for sym in local_symbols]):
+all(isinstance(sym, Genus_Symbol_p_adic_ring) for sym in local_symbols):
```

(unless you really specifically only want that one type. Also note the lack of list comprehension (there is another `all` test that should remove it as well).

Generally, we do alignment like this:

```
    - ``factored_determinant`` -- (default: ``None``) a factorization object
      the factored determinant of ``A``
```


You're also responsible should any complaints arise about the changes to the interface (although I do think it is highly unlikely) since you are changing it without deprecation.



---

archive/issue_comments_361649.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-08T09:18:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361649",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361650.json:
```json
{
    "body": "Replying to [comment:19 tscrim]:\n> You're also responsible should any complaints arise about the changes to the interface (although I do think it is highly unlikely) since you are changing it without deprecation.\n\nOkay. I agree that it is highly unlikely. \nIndeed, there are three entry points that remain unchanged:\n`sage.quadratic_forms.genera.genus`\n`sage.quadratic_forms.quadratic_form.global_genus_symbol`\n`sage.modules.free_quadratic_module_integer_symmetric.genus`",
    "created_at": "2018-10-08T09:22:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361650",
    "user": "sbrandhorst"
}
```

Replying to [comment:19 tscrim]:
> You're also responsible should any complaints arise about the changes to the interface (although I do think it is highly unlikely) since you are changing it without deprecation.

Okay. I agree that it is highly unlikely. 
Indeed, there are three entry points that remain unchanged:
`sage.quadratic_forms.genera.genus`
`sage.quadratic_forms.quadratic_form.global_genus_symbol`
`sage.modules.free_quadratic_module_integer_symmetric.genus`



---

archive/issue_comments_361651.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-08T22:34:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361651",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_361652.json:
```json
{
    "body": "Thanks. LGTM.",
    "created_at": "2018-10-08T22:34:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361652",
    "user": "tscrim"
}
```

Thanks. LGTM.



---

archive/issue_comments_361653.json:
```json
{
    "body": "Whoops, your `isinstance` is backwards.",
    "created_at": "2018-10-08T22:35:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361653",
    "user": "tscrim"
}
```

Whoops, your `isinstance` is backwards.



---

archive/issue_comments_361654.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-10-08T22:35:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361654",
    "user": "tscrim"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_361655.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-09T07:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361655",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361656.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-09T07:56:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361656",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361657.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-10-09T08:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361657",
    "user": "sbrandhorst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_361658.json:
```json
{
    "body": "From the patchbot:\n\n```\nFile \"src/sage/quadratic_forms/genera/genus.py\", line 59, in sage.quadratic_forms.genera.genus.Genus\nFailed example:\n    Genus(A, A.det().factor())\nExpected:\n    Genus of\n    [2 1]\n    [1 2]\n    Genus symbol at 2:    1^-2\n    Genus symbol at 3:     1^-1 3^-1\nGot:\n    Genus of\n    [2 1]\n    [1 2]\n    Signature:  (2, 0)\n    Genus symbol at 2:    1^-2\n    Genus symbol at 3:     1^-1 3^-1\n**********************************************************************\n1 item had failures:\n   1 of   5 in sage.quadratic_forms.genera.genus.Genus\n    [364 tests, 1 failure, 1.53 s]\n```\n\nLooks like just a missed doctest from when you added the signature to the output. Once fixed, you can set a positive review.",
    "created_at": "2018-10-09T13:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361658",
    "user": "tscrim"
}
```

From the patchbot:

```
File "src/sage/quadratic_forms/genera/genus.py", line 59, in sage.quadratic_forms.genera.genus.Genus
Failed example:
    Genus(A, A.det().factor())
Expected:
    Genus of
    [2 1]
    [1 2]
    Genus symbol at 2:    1^-2
    Genus symbol at 3:     1^-1 3^-1
Got:
    Genus of
    [2 1]
    [1 2]
    Signature:  (2, 0)
    Genus symbol at 2:    1^-2
    Genus symbol at 3:     1^-1 3^-1
**********************************************************************
1 item had failures:
   1 of   5 in sage.quadratic_forms.genera.genus.Genus
    [364 tests, 1 failure, 1.53 s]
```

Looks like just a missed doctest from when you added the signature to the output. Once fixed, you can set a positive review.



---

archive/issue_comments_361659.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-09T16:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361659",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361660.json:
```json
{
    "body": "The signature was added in 8.4.rc0. Merged that to fix the doctests.",
    "created_at": "2018-10-09T16:59:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361660",
    "user": "sbrandhorst"
}
```

The signature was added in 8.4.rc0. Merged that to fix the doctests.



---

archive/issue_comments_361661.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-09T17:01:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361661",
    "user": "sbrandhorst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_361662.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-20T11:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361662",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_361663.json:
```json
{
    "body": "This should be re-targeted for 8.5.",
    "created_at": "2018-10-28T14:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25638",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25638#issuecomment-361663",
    "user": "embray"
}
```

This should be re-targeted for 8.5.
