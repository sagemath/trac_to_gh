# Issue 26619: update gap_packages and database_gap to GAP 4.10

Issue created by migration from Trac.

Original creator: dimpase

Original creation time: 2018-12-08 08:04:53

CC:  alexk arojas dimpase embray fbissey mantepse mmarco slelievre tscrim vbraun

now everything needed is already in GAP's tarball.

There is also no more copyright-induced hassle of having database_gap
separate and optional, although gap_packages still need a look at the respective copyrights (if we wish to make it standard)


---

Comment by dimpase created at 2018-12-08 13:52:58

Last 10 new commits:


---

Comment by embray created at 2018-12-10 12:53:37

Is there a particular reason to merge `database_gap` into `gap_packages`?


---

Comment by dimpase created at 2018-12-10 13:50:19

historically, there were several reasons to have separate gap, database_gap and gap_packages, and do not install all the possible GAP packages

* largish sizes of downloads
* licensing issues---stuff in database_gap is not GPL-compatible before GAP 4.9 or 4.10
* non-working with libgap GAP kernel extensions

the 1st one, if we decide not to re-package original GAP tarball (and I am very much for not re-packaging), would be gone.

the 2nd one is (completely, from the point of view of GAP's LICENCE file) fixed since GAP 4.10 (or even 4.9).

the 3rd one is fixed by #22626, although this has to be verified.


---

Comment by embray created at 2018-12-10 17:16:16

Replying to [comment:4 dimpase]:
> the 3rd one is fixed by #22626, although this has to be verified.

Last I checked this is broken actually, but it's mostly a problem with my install script I think.  I need to tinker with that a bit more.


---

Comment by git created at 2018-12-10 17:22:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2018-12-11 11:59:14

Note that most of database_gap is already in our new gap (4.10) package, with exception of tomlib. 

I'll add tomlib to gap 4.10, and get rid of database_gap.


---

Comment by dimpase created at 2018-12-13 05:41:11

I am checking whether `database_gap` is already in the branch on #22626, running

```
./sage -tp  --optional=dochtml,memlimit,mpir,python2,database_gap,sage src/sage/groups/perm_gps/permgroup.py 
```

(that is, adding `database_gap` to the `optional` list) and get the following weird error:

```
Using --optional=database_gap,dochtml,memlimit,mpir,python2,sage
Doctesting 1 file using 4 threads.
sage -t src/sage/groups/perm_gps/permgroup.py
**********************************************************************
File "src/sage/groups/perm_gps/permgroup.py", line 733, in sage.groups.perm_gps.permgroup.PermutationGroup_generic._coerce_map_from_
Failed example:
    p = f(mg); p
Exception raised:
    Traceback (most recent call last):
      File "/home/dimpase/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/dimpase/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.groups.perm_gps.permgroup.PermutationGroup_generic._coerce_map_from_[19]>", line 1, in <module>
        p = f(mg); p
    TypeError: 'NoneType' object is not callable
**********************************************************************
File "src/sage/groups/perm_gps/permgroup.py", line 735, in sage.groups.perm_gps.permgroup.PermutationGroup_generic._coerce_map_from_
Failed example:
    PG(p._gap_()) == p
Exception raised:
    Traceback (most recent call last):
      File "/home/dimpase/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/dimpase/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.groups.perm_gps.permgroup.PermutationGroup_generic._coerce_map_from_[20]>", line 1, in <module>
        PG(p._gap_()) == p
    NameError: name 'p' is not defined
**********************************************************************
1 item had failures:
   2 of  27 in sage.groups.perm_gps.permgroup.PermutationGroup_generic._coerce_map_from_
    [862 tests, 2 failures, 18.36 s]
----------------------------------------------------------------------
sage -t src/sage/groups/perm_gps/permgroup.py  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 18.6 seconds
```


Without `database_gap` in optional, everything passes. The trouble is that the failing tests are not tagged as optional, i.e. it should not matter whether `database_gap` is passed or not. 

Needless to say, these tests work at the Sage prompt just fine.

My hunch is that it might be related to the recent #25706, which unfortunately mixes `libgap` and `gap`. (Even if this were true, it would not take away the general flakiness of Sage's doctesting framework...)


---

Comment by jdemeyer created at 2018-12-13 10:37:53

Replying to [comment:8 dimpase]:
> it would not take away the general flakiness of Sage's doctesting framework...

The "doctest framework" is not flaky. Code in Sage or its tests is flaky.


---

Comment by dimpase created at 2018-12-13 11:04:57

One way or another, I have no idea where to even start looking, and what kind of side effects might cause this, and whether it's side-effects in Sage alone, or in Sage interacting with the doctest framework---in the latter case this means it's not possible to reproduce on "standalone" Sage.


---

Comment by dimpase created at 2018-12-13 14:05:51

The issue in comment 8 disappears (I dare not call this a fix, cause the only proof I have is that tests pass!) with the [latest commit](https://git.sagemath.org/sage.git/commit?id=ef2230a3c98cb6d8b500e5ba6b925199c30a5647) on this branch,
which reduces insanity in `src/sage/groups/matrix_gps/finitely_generated.py`, see #26889,
where it should be posted as an independent thing.

At least I can say that my hunch seems to have been right...
----
Last 10 new commits:


---

Comment by dimpase created at 2018-12-13 14:05:51

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-12-13 16:25:50

Replying to [comment:10 dimpase]:
> One way or another, I have no idea where to even start looking, and what kind of side effects might cause this

In many cases, the mysterious failure of doctests is due to some changing interaction with the Python garbage collector. For example, adding an extra test might change the time when the garbage collector kicks in, causing these strange failures. This is especially true when weak references are involved. And the failing test involves the coercion model, which is using weak references.


---

Comment by git created at 2018-12-14 09:40:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2018-12-14 09:45:30

All that is needed to have the doctests pass with `database_gap` in `--optional` is the latest commit. 

We still need to make sure that tables of marks (GAP 4.8 tomlib package) are there, and then remove `#optional : database_gap` tags and `database_gap` package.


---

Comment by dimpase created at 2018-12-14 11:09:02

OK, I'll make our default GAP, without `gap_packages` installed, to be the same as vanilla GAP 4.10, which is, package-wise, as follows:

```
$ ./gap
 ┌───────┐   GAP 4.10.0 of 01-Nov-2018
 │  GAP  │   https://www.gap-system.org
 └───────┘   Architecture: x86_64-pc-linux-gnu-default64
 Configuration:  gmp 6.1.2, readline
 Loading the library and packages ...
 Packages:   AClib 1.3.1, Alnuth 3.1.0, AtlasRep 1.5.1, AutoDoc 2018.09.20, AutPGrp 1.10, CRISP 1.4.4, Cryst 4.1.18, CrystCat 1.1.8, CTblLib 1.2.2, 
             FactInt 1.6.2, FGA 1.4.0, GAPDoc 1.6.2, IRREDSOL 1.4, LAGUNA 3.9.0, Polenta 1.3.8, Polycyclic 2.14, PrimGrp 3.3.2, RadiRoot 2.8, 
             ResClasses 4.7.1, SmallGrp 1.3, Sophus 1.24, SpinSym 1.5, TomLib 1.2.7, TransGrp 2.0.4, utils 0.59 
```


This covers everything that is in `database_gap`, and more - so we'll move some things out of `gap_packages` into the main `gap` package.


---

Comment by dimpase created at 2018-12-14 14:35:22

I thought that we should remove `build/pkgs/gap/patches/nodefaultpackages.patch`, but this breaks pexpect interface to GAP. Note that `database_gap` and `gap_packages` do not not attempt to change the GAP package autoloading settings, so we should leave them as they are (it does not seem to be easy to fix).

It does not really matter. We can modify stripts starting `gap_console()` to enable autoloading (or not)...


---

Comment by git created at 2018-12-14 18:57:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-12-14 23:29:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2018-12-14 23:34:20

done getting rid of database_gap

Now on to gap_packages...


---

Comment by dimpase created at 2018-12-15 12:42:41

opened #26901 to deal with changes in the only (apart from gap_packages) package of Sage dependent on database_gap.


---

Comment by git created at 2018-12-16 09:21:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-12-18 13:33:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-12-18 15:20:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-12-18 17:42:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-12-18 19:11:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-12-18 23:54:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2018-12-19 00:00:46

The latest bit does not work, as I don't know how to build GAP packages in the current setup. We have built them in place before, so this needs some work.


---

Comment by dimpase created at 2018-12-19 00:01:40

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2018-12-19 08:00:00

Certainly, we can keep the present arrangement, where binaries of GAP packages are installed in place, into package's bin/ subdirectories.


---

Comment by git created at 2018-12-19 21:40:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-12-19 22:57:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-12-20 10:34:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2018-12-20 12:46:48

It turns out that most of the changes so far here should go to #22626. Once this is done I'll update the branch accordingly.


---

Comment by embray created at 2018-12-20 13:14:45

Is there any reason the IO package isn't installed here?  It seems to be mentioned quite often, but we don't provide a means to install it.


---

Comment by git created at 2018-12-20 13:23:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2018-12-20 13:32:14

Replying to [comment:35 embray]:
> Is there any reason the IO package isn't installed here?  It seems to be mentioned quite often, but we don't provide a means to install it.

I'm currently going for the minimal thing: get gap_packages spkg working the way it was.
We never had io package there, as it was breaking libgap in a bad way.
(there are open tickets about io package).

Does this sound like a good plan to you? We can postpone io package, it's not needed to be ready by the Debian freeze deadline.


---

Comment by dimpase created at 2018-12-20 13:33:47

I need to adjust formatting in a dozen of tests, after that should be ready for review.


---

Comment by embray created at 2018-12-20 13:37:15

OK regarding the IO package.  If we weren't installing it in the first place I'm fine just sticking to the minimum set of packages that we were always installing in the first place.

I am also making some updates to this: In particular I'm not happy with the way the compiled packages are installed.  Let me know when you're done your changes (set needs_review) and I'll add my changes on top of that.


---

Comment by dimpase created at 2018-12-20 14:17:46

I'm getting an unpleasant surprise from the doctest framework here - it mangles long lines in this file, e.g. here:

```
File "src/sage/algebras/quantum_groups/quantum_group_gap.py", line 757, in sage.algebras.quantum_groups.quantum_group_gap.QuantumGroup.coproduct
Failed example:
    [Q.coproduct(f, 2)._latex_() for f in Q.F_simple()]  # optional - gap_packages
Expected:
    ['1 {(1<x>1<x>F_{\\alpha_{1}})}+-q^{2}+q^{-2} {(1<x>F_{\\alpha_{1}}<x>[ K_{1} ; 1 ])}+1 {(1<x>F_{\\alpha_{1}}<x>K_{1})}+q^{4}-2+q^{-4} {(F_{\\alpha_{1}}<x>[ K_{1} ; 1 ]<x>[ K_{1} ; 1 ])}+-q^{2}+q^{-2} {(F_{\\alpha_{1}}<x>[ K_{1} ; 1 ]<x>K_{1})}+-q^{2}+q^{-2} {(F_{\\alpha_{1}}<x>K_{1}<x>[ K_{1} ; 1 ])}+1 {(F_{\\alpha_{1}}<x>K_{1}<x>K_{1})}',
     '1 {(1<x>1<x>F_{\\alpha_{2}})}+-q+q^{-1} {(1<x>F_{\\alpha_{2}}<x>[ K_{2} ; 1 ])}+1 {(1<x>F_{\\alpha_{2}}<x>K_{2})}+q^{2}-2+q^{-2} {(F_{\\alpha_{2}}<x>[ K_{2} ; 1 ]<x>[ K_{2} ; 1 ])}+-q+q^{-1} {(F_{\\alpha_{2}}<x>[ K_{2} ; 1 ]<x>K_{2})}+-q+q^{-1} {(F_{\\alpha_{2}}<x>K_{2}<x>[ K_{2} ; 1 ])}+1 {(F_{\\alpha_{2}}<x>K_{2}<x>K_{2})}']
Got:
    ['1 {(1<x>1<x>F_{\\alpha_{1}})}+-q^{2}+q^{-2} {(1<x>F_{\\alpha_{1}}<x>[ K_{1} ; 1 ])}+1 {(1<x>F_{\\alpha_{1}}<x>K_{1})}+q^{4}-2+q^{-4} {(F\n1<x>[ K_{1} ; 1 ]<x>[ K_{1} ; 1 ])}+-q^{2}+q^{-2} {(F_{\\alpha_{1}}<x>[ K_{1} ; 1 ]<x>K_{1})}+-q^{2}+q^{-2} {(F\n1<x>K_{1}<x>[ K_{1} ; 1 ])}+1 {(F_{\\alpha_{1}}<x>K_{1}<x>K_{1})}',
     '1 {(1<x>1<x>F_{\\alpha_{2}})}+-q+q^{-1} {(1<x>F_{\\alpha_{2}}<x>[ K_{2} ; 1 ])}+1 {(1<x>F_{\\alpha_{2}}<x>K_{2})}+q^{2}-2+q^{-2} {(F\n4<x>[ K_{2} ; 1 ]<x>[ K_{2} ; 1 ])}+-q+q^{-1} {(F_{\\alpha_{2}}<x>[ K_{2} ; 1 ]<x>K_{2})}+-q+q^{-1} {(F_{\\alpha_{2}}<x>K\n2<x>[ K_{2} ; 1 ])}+1 {(F_{\\alpha_{2}}<x>K_{2}<x>K_{2})}']
```

and instead of `F_{\\alpha_{1}}` at few places it outputs `F\n1` - probably some unfortunate combination of escape sequences, dunno... (needless to say, the output at the sage prompt is fine).

I'm inclined to mark these as `# known bug` and deal with them later...


---

Comment by embray created at 2018-12-20 14:19:20

In the case of the "grape" package, ISTM the only actual "compiled" part is not technically part of the package at all, but rather it builds its own copy of nauty.  It ought to be able to use the nauty that's already included in Sage.

I probably won't stress about it too much in the short time that we have, but this should probably be fixed later.


---

Comment by dimpase created at 2018-12-20 14:23:55

I agree about nauty/grape - see #26923


---

Comment by embray created at 2018-12-20 14:25:01

Replying to [comment:40 dimpase]:
> I'm getting an unpleasant surprise from the doctest framework here - it mangles long lines in this file, e.g. here:
> and instead of `F_{\\alpha_{1}}` at few places it outputs `F\n1` - probably some unfortunate combination of escape sequences, dunno... (needless to say, the output at the sage prompt is fine).

I'm not so sure about that.  I don't think the doctest framework is doing that, but I'll look into it later.


---

Comment by dimpase created at 2018-12-20 14:34:39

Replying to [comment:43 embray]:
> Replying to [comment:40 dimpase]:
> > I'm getting an unpleasant surprise from the doctest framework here - it mangles long lines in this file, e.g. here:
> > and instead of `F_{\\alpha_{1}}` at few places it outputs `F\n1` - probably some unfortunate combination of escape sequences, dunno... (needless to say, the output at the sage prompt is fine).
> 
> I'm not so sure about that.  I don't think the doctest framework is doing that, but I'll look into it later.

Might be a "noisy line" thing - but why only while doctesting? Anyhow I have opened #26924 to deal with it.


---

Comment by embray created at 2018-12-20 14:36:04

I'm running the tests for some of these packages.  A bunch of tests fail for guava: I'm not sure whether or not this is expected.


---

Comment by embray created at 2018-12-20 14:48:11

A new failure I'm getting is:


```
File "src/sage/graphs/strongly_regular_db.pyx", line 2445, in sage.graphs.strongly_regular_db.SRG_416_100_36_20
Failed example:
    g = SRG_416_100_36_20()                # optional - gap_packages # long time
Expected nothing
Got:
    #I  io package is not available. Check that the name is correct
    #I  and it is present in one of the GAP root directories (see '??RootPaths')
    #I  io package is not available. Check that the name is correct
    #I  and it is present in one of the GAP root directories (see '??RootPaths')
**********************************************************************
1 item had failures:
   1 of   4 in sage.graphs.strongly_regular_db.SRG_416_100_36_20
    [334 tests, 1 failure, 61.16 s]
```


So perhaps one of these packages at least tries to load the IO package if available, though doesn't strictly need it.  In that case we should at least be silencing this message.


---

Comment by embray created at 2018-12-20 14:51:03

Another one that's a bit troubling is:


```
sage -t --long src/sage/tests/gap_packages.py
**********************************************************************
File "src/sage/tests/gap_packages.py", line 8, in sage.tests.gap_packages
Failed example:
    test_packages(pkgs, only_failures=True)    # optional - gap_packages
Expected:
      Status   Package   GAP Output
    +--------+---------+------------+
Got:
    #I  polymake command not found. Please set POLYMAKE_COMMAND by hand
    #I  HAP warning: Set POLYMAKE_PATH manually if needed.
    #I  HAP warning: Set BROWSER_PATH manually if needed.
    #I  HAP warning: Set ASY_PATH manually if needed.
    #I  You may wish to install the xgap package
    #I  and enjoy the graphic capabilities of SONATA.
    #I  qpa-version package is not available. Check that the name is correct
    #I  and it is present in one of the GAP root directories (see '??RootPaths')
      Status    Package       GAP Output
    +---------+-------------+------------+
      Failure   polenta       fail
      Failure   qpa-version   fail
      Failure   resclasses    fail
**********************************************************************
1 item had failures:
   1 of   5 in sage.tests.gap_packages
    [10 tests, 1 failure, 3.98 s]
```


I get these warnings when loading the relevant GAP packages in a vanilla GAP source tree, so I suppose they're normal and/or expected, or at least not indicative of any specific bug on our part.  But we probably need to at least temporarily silence them for the purposes of the code and tests they affect.

The one exception being the error about "qpa-version".  The name of the package is just "qpa", but its source directory is unusually named "qpa-version-<x.y>", so there's some code that's making an invalid assumption about GAP package names :sigh:


---

Comment by dimpase created at 2018-12-20 14:59:53

Replying to [comment:46 embray]:
> A new failure I'm getting is:
> 
> {{{
> File "src/sage/graphs/strongly_regular_db.pyx", line 2445, in sage.graphs.strongly_regular_db.SRG_416_100_36_20
> Failed example:
>     g = SRG_416_100_36_20()                # optional - gap_packages # long time
> Expected nothing
> Got:
>     #I  io package is not available. Check that the name is correct
>     #I  and it is present in one of the GAP root directories (see '??RootPaths')
>     #I  io package is not available. Check that the name is correct
>     #I  and it is present in one of the GAP root directories (see '??RootPaths')
> **********************************************************************
> 1 item had failures:
>    1 of   4 in sage.graphs.strongly_regular_db.SRG_416_100_36_20
>     [334 tests, 1 failure, 61.16 s]
> }}}
> 
> So perhaps one of these packages at least tries to load the IO package if available, though doesn't strictly need it.  In that case we should at least be silencing this message.

Yes, atlasrep does this.
However, you might have a stale libgap workspace. I saw this warning, and then went away after I wiped the workspaces out.


---

Comment by dimpase created at 2018-12-20 15:01:31

Replying to [comment:47 embray]:
> Another one that's a bit troubling is:
> 
> {{{
> sage -t --long src/sage/tests/gap_packages.py
> **********************************************************************
> File "src/sage/tests/gap_packages.py", line 8, in sage.tests.gap_packages
> Failed example:
>     test_packages(pkgs, only_failures=True)    # optional - gap_packages
> Expected:
>       Status   Package   GAP Output
>     +--------+---------+------------+
> Got:
>     #I  polymake command not found. Please set POLYMAKE_COMMAND by hand
>     #I  HAP warning: Set POLYMAKE_PATH manually if needed.
>     #I  HAP warning: Set BROWSER_PATH manually if needed.
>     #I  HAP warning: Set ASY_PATH manually if needed.
>     #I  You may wish to install the xgap package
>     #I  and enjoy the graphic capabilities of SONATA.
>     #I  qpa-version package is not available. Check that the name is correct
>     #I  and it is present in one of the GAP root directories (see '??RootPaths')
>       Status    Package       GAP Output
>     +---------+-------------+------------+
>       Failure   polenta       fail
>       Failure   qpa-version   fail
>       Failure   resclasses    fail
> **********************************************************************
> 1 item had failures:
>    1 of   5 in sage.tests.gap_packages
>     [10 tests, 1 failure, 3.98 s]
> }}}
> 
> I get these warnings when loading the relevant GAP packages in a vanilla GAP source tree, so I suppose they're normal and/or expected, or at least not indicative of any specific bug on our part.  But we probably need to at least temporarily silence them for the purposes of the code and tests they affect.
> 
> The one exception being the error about "qpa-version".  The name of the package is just "qpa", but its source directory is unusually named "qpa-version-<x.y>", so there's some code that's making an invalid assumption about GAP package names :sigh:

Yes, that's where I am now too. I'll need to step away for an hour, I'll push what I have in a second.


---

Comment by git created at 2018-12-20 15:02:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2018-12-20 15:02:34

OK, over to you now.


---

Comment by embray created at 2018-12-20 15:17:56

I think this change


```diff
diff --git a/src/sage/algebras/quantum_groups/quantum_group_gap.py b/src/sage/algebras/quantum_groups/quantum_group_gap.py
index 4ce98f4..0e4549b 100644
--- a/src/sage/algebras/quantum_groups/quantum_group_gap.py
+++ b/src/sage/algebras/quantum_groups/quantum_group_gap.py
`@``@` -1566,8 +1564,8 `@``@` class QuantumGroupModule(Parent, UniqueRepresentation):
             sage: Q = QuantumGroup(['A',2])           # optional - gap_packages
             sage: V = Q.highest_weight_module([1,1])  # optional - gap_packages
             sage: V.gap()                             # optional - gap_packages
-            <8-dimensional left-module over QuantumUEA( <root system of type A2>,
-             Qpar = q )>
+            <8-dimensional left-module over QuantumUEA( <root system of type A
+            2>, Qpar = q )>
         """
         return self._libgap
```


This one feels like a bug in the GAP and/or the QuaGroup package to me, but I confirmed that this is in fact the output provided by GAP and not a bug on our end, so for the time being there's nothing to be done (other than possibly report it upstream)

This is one of the problems with GAP objects not having a real string representation that isn't tied to how exactly they're printed to the screen :|


---

Comment by embray created at 2018-12-20 15:39:05

The problem here, accounting for all these test failures including the test above that was modified, is that the QuaGroups package seems (I have not looked for the exact code) to insert linebreaks into the representations of its types in different places depending on the terminal width.  Not exactly sure if that's a GAP thing in general or something specific to this package, but this is the first place it's come up.  In any case we apparently aren't dealing well with those unnecessary line breaks.


---

Comment by dimpase created at 2018-12-20 15:47:16

linebreaks are inserted by GAP, it was always the case.


---

Comment by embray created at 2018-12-20 16:09:06

I see now, the output splitting is indeed done by default by GAP.  Again, this is no good, especially since it can depend on terminal width.  I haven't found yet exactly where GAP determines this, but I need to figure out a way to force it to just not do this at all, if possible.  That might be something to do as part of #22626 or as a follow-up.


---

Comment by git created at 2018-12-21 00:34:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2018-12-21 00:38:24

Replying to [comment:47 embray]:
> Another one that's a bit troubling is:
> 
> {{{
> sage -t --long src/sage/tests/gap_packages.py
> [.....]
>      +---------+-------------+------------+
>       Failure   polenta       fail
>       Failure   qpa-version   fail
>       Failure   resclasses    fail
> **********************************************************************
> 1 item had failures:
>    1 of   5 in sage.tests.gap_packages
>     [10 tests, 1 failure, 3.98 s]
> }}}
> 
> I get these warnings when loading the relevant GAP packages in a vanilla GAP source tree, so I suppose they're normal and/or expected, or at least not indicative of any specific bug on our part.  But we probably need to at least temporarily silence them for the purposes of the code and tests they affect.

> The one exception being the error about "qpa-version".  The name of the package is just "qpa", but its source directory is unusually named "qpa-version-<x.y>", so there's some code that's making an invalid assumption about GAP package names :sigh:

the latest commit fixes these failures, which are two-fold:
missing dependencies and weird `-version`-part which one should strip.

I should still figure out how to suppress these `#I ...` lines...


---

Comment by git created at 2018-12-21 01:04:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-12-21 10:15:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2018-12-21 10:39:20

By the way, I tried installing IO package in the same way as this ticket builds packages needing compilation, but this fails due to a "missing" header (not sure what goes wrong):

```
[gap_packages-4.10.0] configure: creating ./config.status
[gap_packages-4.10.0] config.status: creating Makefile
[gap_packages-4.10.0] config.status: creating src/pkgconfig.h
[gap_packages-4.10.0] config.status: executing depfiles commands
[gap_packages-4.10.0] config.status: executing libtool commands
[gap_packages-4.10.0] make[2]: Entering directory '/mnt/opt/Sage/sage-dev/local/share/gap/pkg/io-4.5.4'
[gap_packages-4.10.0] /bin/sh ./libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H -I. -I./src  -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0/src/gen -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0/src/src -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0/src -DHAVE_CONFIG_H -I/mnt/opt/Sage/sage-dev/local/include        -O2 -g   -g -O2 -MT src/io_la-io.lo -MD -MP -MF src/.deps/io_la-io.Tpo -c -o src/io_la-io.lo `test -f 'src/io.c' || echo './'`src/io.c
[gap_packages-4.10.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -I./src -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0/src/gen -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0/src/src -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0/src -DHAVE_CONFIG_H -I/mnt/opt/Sage/sage-dev/local/include -O2 -g -g -O2 -MT src/io_la-io.lo -MD -MP -MF src/.deps/io_la-io.Tpo -c src/io.c  -fPIC -DPIC -o src/.libs/io_la-io.o
[gap_packages-4.10.0] src/io.c:14:10: fatal error: src/compiled.h: No such file or directory
[gap_packages-4.10.0]  #include "src/compiled.h"          /* GAP headers                */
[gap_packages-4.10.0]           ^~~~~~~~~~~~~~~~
```

looks like the corresponding `-I` arguments all have an extra `/src` suffix, something that prevents this header to be found.


---

Comment by dimpase created at 2018-12-21 10:40:45

..."thanks" to Gatwick drone operators, I can do this work now, and not sit on a plane off to Singapore...


---

Comment by dimpase created at 2018-12-21 11:34:12

GAP's IO is on #26930


---

Comment by git created at 2018-12-21 12:07:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2018-12-21 12:07:50

OK, seems to be ready now


---

Comment by dimpase created at 2018-12-21 12:07:50

Changing status from needs_work to needs_review.


---

Comment by embray created at 2018-12-21 13:50:28


```diff

diff --git a/src/sage/graphs/strongly_regular_db.pyx b/src/sage/graphs/strongly_regular_db.pyx
index 8df9bf5..06a0780 100644
--- a/src/sage/graphs/strongly_regular_db.pyx
+++ b/src/sage/graphs/strongly_regular_db.pyx
`@``@` -2442,7 +2442,9 `@``@` def SRG_416_100_36_20():
     EXAMPLES::
 
         sage: from sage.graphs.strongly_regular_db import SRG_416_100_36_20
+        sage: libgap.eval("SetInfoLevel(InfoWarning,0)") # silence #I warnings
         sage: g = SRG_416_100_36_20()                # optional - gap_packages # long time
+        sage: libgap.eval("SetInfoLevel(InfoWarning,1)") # silence #I warnings
         sage: g.is_strongly_regular(parameters=True) # optional - gap_packages # long time
         (416, 100, 36, 20)
     """
```


I don't like that this is done in the doctest; it distracts from the actual documentation.  I think this should go in the function itself.  We've already seen the warning in question, decided it is not important to us, and can go ahead and silence it.


---

Comment by embray created at 2018-12-21 14:19:15

Replying to [comment:59 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[08ffb33](https://git.sagemath.org/sage.git/commit/?id=08ffb3396308b4643cfcbed1c56c0272c39f6a17)||`more doctest fixes`||

This change doesn't seem to work for me.  Those tests passed before this commit, and fail after.  I tried clearing my existing workspaces but it still fails.  That's troubling--it may still be some badly managed random state somewhere.  Unless I'm missing something else.


---

Comment by embray created at 2018-12-21 14:20:03

Replying to [comment:61 dimpase]:
> ..."thanks" to Gatwick drone operators, I can do this work now, and not sit on a plane off to Singapore...

Huh?? What happened?  :(


---

Comment by dimpase created at 2018-12-21 14:27:44

Replying to [comment:67 embray]:
> Replying to [comment:61 dimpase]:
> > ..."thanks" to Gatwick drone operators, I can do this work now, and not sit on a plane off to Singapore...
> 
> Huh?? What happened?  :(
Lucky you, you don't read news. :-)
Gatwick was shut down for ~36 hours due to some not yet caught folks flying a largish drone over it several times, 700+ flights cancelled, 100s diverted. We were able to book an even cheaper flight, via Berlin, and get a full refund. They are open since this morning, and in fact the airline rebooked us for tonight, but we were in the full panic mode and got the other flight already...


---

Comment by dimpase created at 2018-12-21 14:38:35

Replying to [comment:66 embray]:
> Replying to [comment:59 git]:
> > Branch pushed to git repo; I updated commit sha1. New commits:
> > ||[08ffb33](https://git.sagemath.org/sage.git/commit/?id=08ffb3396308b4643cfcbed1c56c0272c39f6a17)||`more doctest fixes`||
> 
> This change doesn't seem to work for me.  Those tests passed before this commit, and fail after.  I tried clearing my existing workspaces but it still fails.  That's troubling--it may still be some badly managed random state somewhere.  Unless I'm missing something else.

they pass for me, both with and without `--long`, on Linux and on OSX.

I'd try `rm -rf local/share/gap local/include/gap` followed by `./sage -f gap gap_packages` followed up by `make build`, and then testing...

(and wiping out `~/.sage/gap/` too)


---

Comment by git created at 2018-12-21 14:55:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2018-12-21 14:56:44

Replying to [comment:70 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[1e5f679](https://git.sagemath.org/sage.git/commit/?id=1e5f679c41a7b27088ed330f986df91d03099a71)||`move silencing into the function body`||

this addresses comment 65.


---

Comment by embray created at 2018-12-21 14:59:55

Replying to [comment:66 embray]:
> Replying to [comment:59 git]:
> > Branch pushed to git repo; I updated commit sha1. New commits:
> > ||[08ffb33](https://git.sagemath.org/sage.git/commit/?id=08ffb3396308b4643cfcbed1c56c0272c39f6a17)||`more doctest fixes`||
> 
> This change doesn't seem to work for me.  Those tests passed before this commit, and fail after.  I tried clearing my existing workspaces but it still fails.  That's troubling--it may still be some badly managed random state somewhere.  Unless I'm missing something else.

Nevermind, that was my fault.  Nevertheless, this still won't work: The outcomes of these tests depend on whether or not `gap_packages` is installed, so if it isn't then these will give different results.  I'm not sure what to do: Maybe these tests should be rewritten to be more flexible, or the code that's being tested needs to be rewritten to be less sensitive to what GAP packages are installed (if that's even possible...)


---

Comment by dimpase created at 2018-12-21 15:11:19

Let's just make gap_packages standard, as planned anyway. This will alleviate this problem.


---

Comment by embray created at 2018-12-21 15:17:29

I don't think we should do that.  It's bad enough that we're adding all the "default" packages, but that does seem defensible.

Otherwise there's no point in even having a separate spkg.

Meanwhile, I don't like that merely having some random package installed can cause actually different (even if not substantively) results, in ways that are very difficult to trace.  This is a really annoying problem with GAP...


---

Comment by embray created at 2018-12-21 15:24:37

Let's see... For the test that's failing in `sage.libs.gap.element` it should suffice to just put ellipses after `ValueError: libGAP: Error, no method found!`.  That's the only part that's important; the rest are details.

The other two look like they might result from different PRNG states, so it might suffice for those two to explicitly re-seed the PRNG before them; let me try.


---

Comment by dimpase created at 2018-12-21 15:30:57

Replying to [comment:74 embray]:
> I don't think we should do that.  It's bad enough that we're adding all the "default" packages, but that does seem defensible.
> 
> Otherwise there's no point in even having a separate spkg.

for transition from several to one package it's OK, I think.
We can merge them later on another ticket.
 
> 
> Meanwhile, I don't like that merely having some random package installed can cause actually different (even if not substantively) results, in ways that are very difficult to trace.  This is a really annoying problem with GAP...


---

Comment by embray created at 2018-12-21 15:41:49

I'm definitely -1 on making it a standard package, especially in the short time that we have.  These have always been an optional add-on, and for the time being I don't want to add any more footprint to the default installation than we already are (keep in mind, this also increases the possibility of bugs in user code for which we don't have test cases).


---

Comment by embray created at 2018-12-21 15:43:19

In the cases of the test we have failing currently, it appears that loading some of these packages just modifies the PRNG state, so the best solution for now is to explicitly re-seed them before the affected tests (not ideal, but it will ensure consistent results).


---

Comment by embray created at 2018-12-21 15:45:36

Changing status from needs_review to needs_work.


---

Comment by embray created at 2018-12-21 15:45:36

Public branch for this ticket.  It is up-to-date with Dima's branch minus the last two commits that are contentious.


---

Comment by dimpase created at 2018-12-21 15:47:19

your branch does not merge cleanly...


---

Comment by dimpase created at 2018-12-21 15:54:20

How about tagging the previously untagged tests that differ if gap_packages are installed with `# optional - gap_packages`, and be done with it? It's not that many tests, right?


---

Comment by embray created at 2018-12-21 16:00:37

~~It might need to be rebased again already; I don't know what Volker has been doing.~~ I just didn't push it yet.

I already have another solution for these tests that is less fragile.


---

Comment by git created at 2018-12-21 16:02:19

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by embray created at 2018-12-21 16:15:58

For the remaining problematic tests I was able to fix them by manually calling (with some explanation in the prose) `libgap.set_seed(0)` before them (and modifying the expected output to correspond to that random seed).

It's unfortunate but possibly necessary, since the state of the PRNG can seem to depend on which packages were loaded and when, and for whatever reason those tests just happened to be very sensitive to this.

I'm re-running the full test suite now to see if any other examples like this turn up.


---

Comment by git created at 2018-12-21 16:37:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-12-21 16:55:36

Oops, forgot to finish the tests for libgap.set_seed.


---

Comment by git created at 2018-12-21 16:57:52

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2018-12-21 17:22:08

your branch does not have 8.5.rc1 merged, by the way. Just testing it might show wrong test faults...


---

Comment by embray created at 2018-12-21 17:40:33

Replying to [comment:8 dimpase]:
> I am checking whether `database_gap` is already in the branch on #22626, running
> {{{
> ./sage -tp  --optional=dochtml,memlimit,mpir,python2,database_gap,sage src/sage/groups/perm_gps/permgroup.py 
> }}}

I don't suppose you ever found a solution and/or explanation for this failure?  I have some workarounds for most everything else but this.


---

Comment by git created at 2018-12-21 17:41:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-12-21 17:42:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2018-12-21 18:12:27

Replying to [comment:89 embray]:
> Replying to [comment:8 dimpase]:
> > I am checking whether `database_gap` is already in the branch on #22626, running
> > {{{
> > ./sage -tp  --optional=dochtml,memlimit,mpir,python2,database_gap,sage src/sage/groups/perm_gps/permgroup.py 
> > }}}
> 
> I don't suppose you ever found a solution and/or explanation for this failure?  I have some workarounds for most everything else but this.

see comment:11. Have you merged the corresponding commit? (from the ticket it refers to)

that's why #26889 is a dependence of this ticket.


---

Comment by embray created at 2018-12-21 18:46:48

Ah, right, I had forgotten about that.  That makes sense.

The issue here again seems to have something in part to do with the random number generator state in GAP.  In the case of:


```
sage: MG = GU(3,2).as_matrix_group()
sage: PG = MG.as_permutation_group()
sage: PG2 = MG._permutation_group_()
```


_usually_ `PG` and `PG2` will be the same, but on rare occasion they will be different, and that just happened to be the case in this test.  Could that be a bug in GAP, or expected behavior?  That I don't know.

That code is still a mess on the Sage end too as well, so any effort to clean it up can't hurt.


---

Comment by dimpase created at 2018-12-21 19:39:30

Replying to [comment:93 embray]:
> Ah, right, I had forgotten about that.  That makes sense.
> 
> The issue here again seems to have something in part to do with the random number generator state in GAP.  In the case of:
> 
> {{{
> sage: MG = GU(3,2).as_matrix_group()
> sage: PG = MG.as_permutation_group()
> sage: PG2 = MG._permutation_group_()
> }}}
> 
> _usually_ `PG` and `PG2` will be the same, but on rare occasion they will be different, and that just happened to be the case in this test.  Could that be a bug in GAP, or expected behavior?  That I don't know.

We have two instances of GAP talking to each other, how their RNGs are syncronised is
an interesting question. Are they?


---

Comment by git created at 2018-12-22 00:00:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2018-12-22 00:22:05

new gap_packages installation does not work, breaks at cohomolo GAP package:

```
[gap_packages-4.10.0] cp calcpres.gap ..//..//bin/x86_64-pc-linux-gnu-default64/calcpres.gap
[gap_packages-4.10.0] chmod +x ..//..//bin/x86_64-pc-linux-gnu-default64/calcpres.gap
[gap_packages-4.10.0] make[3]: Leaving directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/gap_packages-4.10.0/src/pkg/cohomolo-1.6.7/standalone/progs.d'
[gap_packages-4.10.0] make[2]: Leaving directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/gap_packages-4.10.0/src/pkg/cohomolo-1.6.7'
[gap_packages-4.10.0] bin/ -> /home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/gap_packages-4.10.0/inst/home/scratch2/dimpase/sage/sage/local/lib/gap/pkg/cohomolo-1.6.7
[gap_packages-4.10.0] make[2]: Entering directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/gap_packages-4.10.0/src/pkg/cohomolo-1.6.7'
[gap_packages-4.10.0] cd standalone/progs.d; make clean
[gap_packages-4.10.0] make[3]: Entering directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/gap_packages-4.10.0/src/pkg/cohomolo-1.6.7/standalone/progs.d'
[gap_packages-4.10.0] /bin/rm -f *.o
[gap_packages-4.10.0] make[3]: Leaving directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/gap_packages-4.10.0/src/pkg/cohomolo-1.6.7/standalone/progs.d'
[gap_packages-4.10.0] make[2]: Leaving directory '/home/scratch2/dimpase/sage/sage/local/var/tmp/sage/build/gap_packages-4.10.0/src/pkg/cohomolo-1.6.7'
[gap_packages-4.10.0] ********************************************************************************
[gap_packages-4.10.0] Error: source file/directory bin does not exist
[gap_packages-4.10.0] ********************************************************************************
```

(this is on Fedora 26, in case it matters)


---

Comment by vbraun created at 2018-12-23 10:19:43

#22626 breaks some of the `# optional - database_gap` doctests. I'll ignore that failure for now but please fix asap.


---

Comment by git created at 2018-12-24 02:24:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2018-12-24 02:26:40

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2018-12-24 02:28:45

Replying to [comment:97 vbraun]:
> #22626 breaks some of the `# optional - database_gap` doctests. I'll ignore that failure for now but please fix asap.

Yes, this ticket gets rid of database_gap (everything there will be a part of gap package), so this is taken care of here.

I've also fixed the build failure here, so it's ready for review, I think.


---

Comment by dimpase created at 2018-12-24 02:30:58

So the current scheme is that gap_packages remains optional spkg, for the time being at least. I'd rather make it standard too, and then merge into gap package,
but Erik thinks it's too big a change (I don't think so---I think the change between what we have in Sage 8.4 (and 8.5) is already very big, not the least due to GAP 4.10 being quite a big change from GAP 4.8, and forcing people to adjust their code several times is worse than asking to do so once--- but OK).


---

Comment by git created at 2018-12-24 21:33:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2018-12-24 21:34:37

this commit went AWOL from the current branch. With it in, all tests pass


---

Comment by git created at 2018-12-26 02:26:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2018-12-26 02:27:58

One more AWOL commit.


---

Comment by git created at 2018-12-26 03:13:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-12-28 11:08:52

Replying to [comment:71 dimpase]:
> Replying to [comment:70 git]:
> > Branch pushed to git repo; I updated commit sha1. New commits:
> > ||[1e5f679](https://git.sagemath.org/sage.git/commit/?id=1e5f679c41a7b27088ed330f986df91d03099a71)||`move silencing into the function body`||
> 
> this addresses comment 65.

This should probably use `InfoLevel(InfoWarning)` to get the previous level, not just assume to restore it to 1.  Probably unlikely to matter usually but it is still a bug waiting to happen.


---

Comment by embray created at 2018-12-28 11:10:52

Replying to [comment:106 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[37e2329](https://git.sagemath.org/sage.git/commit/?id=37e23290bad2ee4d36463647f4c058c500b81eba)||`tagged # random - answer is always mathematically OK, outputs differ`||

I'm going to double-check but this shouldn't be necessary.  This is what #26874 was fixing.


---

Comment by embray created at 2018-12-28 11:22:36

Yes, merging in #26874 guarantees that test always works the same way, as the RNG state is consistent.

I'll deal with comment:107 and then do a couple final checks before setting positive_review.


---

Comment by embray created at 2018-12-28 11:25:17

Replying to [comment:98 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[bd849fb](https://git.sagemath.org/sage.git/commit/?id=bd849fbe2b32a6cc8d4b56b334e4293846061a6b)||`don't clean too early`||

This "fix" is a problem as well.  The "cleanup" commands that were moved were deliberately _before_ `sdh_install *` so that files that shouldn't be installed aren't installed.  I'll see if I can reproduce the problem you had; I did not have the same problem on Ubuntu.


---

Comment by embray created at 2018-12-28 11:25:24

Changing status from needs_review to needs_work.


---

Comment by embray created at 2018-12-28 11:34:59

Replying to [comment:94 dimpase]:
> Replying to [comment:93 embray]:
> > Ah, right, I had forgotten about that.  That makes sense.
> > 
> > The issue here again seems to have something in part to do with the random number generator state in GAP.  In the case of:
> > 
> > {{{
> > sage: MG = GU(3,2).as_matrix_group()
> > sage: PG = MG.as_permutation_group()
> > sage: PG2 = MG._permutation_group_()
> > }}}
> > 
> > _usually_ `PG` and `PG2` will be the same, but on rare occasion they will be different, and that just happened to be the case in this test.  Could that be a bug in GAP, or expected behavior?  That I don't know.
> 
> We have two instances of GAP talking to each other, how their RNGs are syncronised is
> an interesting question. Are they?

Nope.  I do have an experimental branch where I modified `Randstate.set_seed_gap()` to seed both libgap and the pexpect GAP simultaneously, but I haven't decided whether or not to use it yet.


---

Comment by git created at 2018-12-28 15:02:28

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-12-28 15:18:27

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2018-12-28 15:19:18

Can you check if the latest commit fixes the issue from comment:96 ?  I can't reproduce that so I'm not really sure what's going on there (seeing more of the log might help too, if it's not fixed...)


---

Comment by slelievre created at 2018-12-28 15:37:42

Changing keywords from "" to "GAP".


---

Comment by slelievre created at 2018-12-28 15:37:42

Does this also fix #23054?


---

Attachment


---

Comment by mantepse created at 2018-12-28 15:59:03

I also have the problem from comment:96, on ubuntu 17.10, sage 8.6.beta0.  I attached the log.


---

Comment by embray created at 2018-12-28 17:07:48

Thanks--I was able to reproduce the problem in a docker container.  My attempted fix doesn't seem to help.  Not sure what the problem is though; it's an odd one...


---

Comment by dimpase created at 2018-12-28 17:40:26

Replying to [comment:118 embray]:
> Thanks--I was able to reproduce the problem in a docker container.  My attempted fix doesn't seem to help.  Not sure what the problem is though; it's an odd one...

IMHO it should not hold up this ticket - open a follow-up ticket to fix it.


---

Comment by git created at 2018-12-28 17:44:11

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-12-28 17:55:26

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by embray created at 2018-12-28 17:56:01

Rebased on 8.6.beta0


---

Comment by git created at 2018-12-28 17:56:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-12-28 17:57:10

Merged fix from #26965 so that this branch can be built successfully from a fresh install.


---

Comment by embray created at 2018-12-28 17:57:10

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2018-12-28 18:17:45

comment in the commit 293e79a	is a bit off, as altlasrep has a cache of files downloaded from the net, not generated.


---

Comment by dimpase created at 2018-12-28 18:24:54

I am getting timeouts in these iffy parts of libgap:

```
sage -t --warn-long 109.1 src/sage/libs/gap/all_documented_functions.py
    Timed out
sage -t --warn-long 109.1 src/sage/libs/gap/assigned_names.py
    Timed out
```

something these should be tagged `# long time` ?


---

Comment by embray created at 2018-12-28 18:26:27

Wherever the files come from I just mean that they are created by the package at runtime and are not "installed".


---

Comment by embray created at 2018-12-28 18:28:32

Replying to [comment:127 dimpase]:
> I am getting timeouts in these iffy parts of libgap:
> {{{
> sage -t --warn-long 109.1 src/sage/libs/gap/all_documented_functions.py
>     Timed out
> sage -t --warn-long 109.1 src/sage/libs/gap/assigned_names.py
>     Timed out
> }}}
> something these should be tagged `# long time` ?


I think they are.  I originally meant, as part of #22626 to deprecate these modules and disable their tests, but I forgot to add that to the work items.

While we're at it I'll go ahead and mark the tests to be skipped, and will handle the deprecation later, perhaps as part of #26959.


---

Comment by dimpase created at 2018-12-28 18:36:17

OK, tests are running, I'll have a look in the morning (I'm on UTC+8 now, sorry :-))


---

Comment by embray created at 2018-12-28 18:46:45

I did a fresh test run earlier today and everything looked good, but it will be good to get a second opinion.  I'm about to push one more change to disable skip those problematic tests.


---

Comment by git created at 2018-12-28 20:04:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2018-12-28 23:07:47

seems to work here!  (same timeouts, because I didn't have the final commit yet)

Thank you!


---

Comment by dimpase created at 2018-12-29 02:18:36

OK, great, all works. 
----
New commits:


---

Comment by dimpase created at 2018-12-29 02:18:36

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2018-12-29 03:59:10

Replying to [comment:116 slelievre]:
> Does this also fix #23054?
yes it does, thanks for pointing this out.


---

Comment by vbraun created at 2018-12-31 10:37:12

Resolution: fixed
