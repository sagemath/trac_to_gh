# Issue 10227: optimize computation of Delta modulo an integer

archive/issues_010227.json:
```json
{
    "body": "Assignee: craigcitro\n\nCC:  mraum was\n\nAt the moment, computing the q-expansion of Delta modulo an integer N is done by first computing the q-expansion over the integers and then reducing it modulo N.  This is fine for getting a moderate number of coefficients, but wastes memory and becomes unnecessarily slow for large number of coefficients:\n\n\n```\nsage: time f = delta_qexp(10^6, K=GF(1009))\nCPU times: user 12.01 s, sys: 0.49 s, total: 12.50 s\nWall time: 12.50 s\nsage: time f = delta_qexp(10^7, K=GF(1009))\nCPU times: user 473.93 s, sys: 4.56 s, total: 478.49 s\nWall time: 478.59 s\n```\n\n\nThe patch coming up implements the computation of `delta_qexp` directly modulo N:\n\n\n```\nsage: time f = delta_qexp(10^6, K=GF(1009))\nCPU times: user 2.12 s, sys: 0.11 s, total: 2.23 s\nWall time: 2.23 s\nsage: time f = delta_qexp(10^7, K=GF(1009))\nCPU times: user 23.13 s, sys: 1.18 s, total: 24.31 s\nWall time: 24.32 s\n```\n\n\nComputing things directly mod N seems to only pay off for more than about 150 coefficients, so for smaller precisions we use the old code.\n\nThe motivation for implementing this is of course #8282, and the ability to work with modular forms (mod p) in very high weights.\n\nI don't see myself ever needing to work with Delta modulo non-primes, but I also don't see any reason to restrict to prime moduli.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/10228\n\n",
    "created_at": "2010-11-06T04:58:52Z",
    "labels": [
        "modular forms",
        "major",
        "enhancement"
    ],
    "title": "optimize computation of Delta modulo an integer",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10227",
    "user": "AlexGhitza"
}
```
Assignee: craigcitro

CC:  mraum was

At the moment, computing the q-expansion of Delta modulo an integer N is done by first computing the q-expansion over the integers and then reducing it modulo N.  This is fine for getting a moderate number of coefficients, but wastes memory and becomes unnecessarily slow for large number of coefficients:


```
sage: time f = delta_qexp(10^6, K=GF(1009))
CPU times: user 12.01 s, sys: 0.49 s, total: 12.50 s
Wall time: 12.50 s
sage: time f = delta_qexp(10^7, K=GF(1009))
CPU times: user 473.93 s, sys: 4.56 s, total: 478.49 s
Wall time: 478.59 s
```


The patch coming up implements the computation of `delta_qexp` directly modulo N:


```
sage: time f = delta_qexp(10^6, K=GF(1009))
CPU times: user 2.12 s, sys: 0.11 s, total: 2.23 s
Wall time: 2.23 s
sage: time f = delta_qexp(10^7, K=GF(1009))
CPU times: user 23.13 s, sys: 1.18 s, total: 24.31 s
Wall time: 24.32 s
```


Computing things directly mod N seems to only pay off for more than about 150 coefficients, so for smaller precisions we use the old code.

The motivation for implementing this is of course #8282, and the ability to work with modular forms (mod p) in very high weights.

I don't see myself ever needing to work with Delta modulo non-primes, but I also don't see any reason to restrict to prime moduli.


Issue created by migration from https://trac.sagemath.org/ticket/10228





---

archive/issue_comments_104212.json:
```json
{
    "body": "apply after ticket at #10209",
    "created_at": "2010-11-06T05:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10227#issuecomment-104212",
    "user": "AlexGhitza"
}
```

apply after ticket at #10209



---

archive/issue_comments_104213.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-11-06T05:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10227#issuecomment-104213",
    "user": "AlexGhitza"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_104214.json:
```json
{
    "body": "Attachment\n\nI have attached the patch.  I took the liberty to base it on top of the small patch at #10209, since that already has a positive review and is likely to be merged quickly.\n\nHowever, I am happy to make it independent if that makes the review easier.\n\nCc-ing people who might be interested in this.",
    "created_at": "2010-11-06T05:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10227#issuecomment-104214",
    "user": "AlexGhitza"
}
```

Attachment

I have attached the patch.  I took the liberty to base it on top of the small patch at #10209, since that already has a positive review and is likely to be merged quickly.

However, I am happy to make it independent if that makes the review easier.

Cc-ing people who might be interested in this.



---

archive/issue_comments_104215.json:
```json
{
    "body": "Changing keywords from \"\" to \"delta finite field\".",
    "created_at": "2010-11-06T05:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10227#issuecomment-104215",
    "user": "AlexGhitza"
}
```

Changing keywords from "" to "delta finite field".



---

archive/issue_comments_104216.json:
```json
{
    "body": "Attachment\n\nEverything passes fine. I only adapted the documentation (adding missing ') and I changed the exception to by Python 3 compatible. If your are fine with all these minor changes, give this a positive review.",
    "created_at": "2010-11-06T09:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10227#issuecomment-104216",
    "user": "mraum"
}
```

Attachment

Everything passes fine. I only adapted the documentation (adding missing ') and I changed the exception to by Python 3 compatible. If your are fine with all these minor changes, give this a positive review.



---

archive/issue_comments_104217.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-11-06T13:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10227#issuecomment-104217",
    "user": "AlexGhitza"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_104218.json:
```json
{
    "body": "Looks good to me.\n\nNote to the release manager: apply only `trac_10228-review-optimize_delta.patch`, after #10209 is merged.",
    "created_at": "2010-11-06T13:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10227#issuecomment-104218",
    "user": "AlexGhitza"
}
```

Looks good to me.

Note to the release manager: apply only `trac_10228-review-optimize_delta.patch`, after #10209 is merged.



---

archive/issue_comments_104219.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-11-10T22:22:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10227#issuecomment-104219",
    "user": "jdemeyer"
}
```

Resolution: fixed
