# Issue 34354: Multivariate polynomial variable substition has a bug

archive/issues_034354.json:
```json
{
    "body": "CC:  @videlec @yyyyx4\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/34591\n\n",
    "created_at": "2022-09-27T14:00:55Z",
    "labels": [],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Multivariate polynomial variable substition has a bug",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34354",
    "user": "https://github.com/kwankyu"
}
```
CC:  @videlec @yyyyx4



Issue created by migration from https://trac.sagemath.org/ticket/34591





---

archive/issue_comments_486532.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to basic arithmetic.",
    "created_at": "2022-09-27T14:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34354#issuecomment-486532",
    "user": "https://github.com/kwankyu"
}
```

Changing component from PLEASE CHANGE to basic arithmetic.



---

archive/issue_comments_486533.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2022-09-27T14:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34354#issuecomment-486533",
    "user": "https://github.com/kwankyu"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_486534.json:
```json
{
    "body": "This bug is related with these lines\n\n```diff\ndiff --git a/src/sage/rings/polynomial/multi_polynomial_libsingular.pyx b/src/sage/rings/polynomial/multi_polynomial_libsingular.pyx\nindex 2109c516a1..35a011174a 100644\n--- a/src/sage/rings/polynomial/multi_polynomial_libsingular.pyx\n+++ b/src/sage/rings/polynomial/multi_polynomial_libsingular.pyx\n@@ -3556,7 +3556,7 @@ cdef class MPolynomial_libsingular(MPolynomial):\n \n                 if _p == NULL:\n                     # polynomial becomes 0 after some substitution\n-                    try_symbolic = 1\n+                    try_symbolic = 1  # Why?\n                     break\n \n         cdef dict gd\n```\n\n\nAt line 3557, the substituted polynomial becomes 0 correctly. But then it goes on \"try_symbolic\". Why?\n\nThese lines were introduced in #17785.",
    "created_at": "2022-09-27T14:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34354#issuecomment-486534",
    "user": "https://github.com/kwankyu"
}
```

This bug is related with these lines

```diff
diff --git a/src/sage/rings/polynomial/multi_polynomial_libsingular.pyx b/src/sage/rings/polynomial/multi_polynomial_libsingular.pyx
index 2109c516a1..35a011174a 100644
--- a/src/sage/rings/polynomial/multi_polynomial_libsingular.pyx
+++ b/src/sage/rings/polynomial/multi_polynomial_libsingular.pyx
@@ -3556,7 +3556,7 @@ cdef class MPolynomial_libsingular(MPolynomial):
 
                 if _p == NULL:
                     # polynomial becomes 0 after some substitution
-                    try_symbolic = 1
+                    try_symbolic = 1  # Why?
                     break
 
         cdef dict gd
```


At line 3557, the substituted polynomial becomes 0 correctly. But then it goes on "try_symbolic". Why?

These lines were introduced in #17785.



---

archive/issue_comments_486535.json:
```json
{
    "body": "I think this is a duplicate of #34417.",
    "created_at": "2022-09-27T23:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34354#issuecomment-486535",
    "user": "https://github.com/DaveWitteMorris"
}
```

I think this is a duplicate of #34417.



---

archive/issue_comments_486536.json:
```json
{
    "body": "Replying to [comment:6 Dave Morris]:\n> I think this is a duplicate of #34417.\n\nYes. But as I analyzed the bug, there is no problem with Singular. So I suggest to close #34417 as a duplicate, and let us focus on fixing the problem in comment:3.",
    "created_at": "2022-09-27T23:17:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34354#issuecomment-486536",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:6 Dave Morris]:
> I think this is a duplicate of #34417.

Yes. But as I analyzed the bug, there is no problem with Singular. So I suggest to close #34417 as a duplicate, and let us focus on fixing the problem in comment:3.



---

archive/issue_comments_486537.json:
```json
{
    "body": "I don't know why you say there is no problem with singular. As pointed out in ticket:34417#comment:1, the problem seems to arise in `singular_polynomial_call`.  \n\nI don't think the line in comment:3 is actually the bug (but I may be wrong). My understanding is that it is just setting a flag to say that something has gone wrong, so singular should be used to do the substitution. But it seems that singular gives the wrong answer (or the interface makes a mistake). It may be possible to solve this particular bug report by avoiding the call to singular, but it does seem to have uncovered a problem with singular (or its interface).",
    "created_at": "2022-09-27T23:41:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34354#issuecomment-486537",
    "user": "https://github.com/DaveWitteMorris"
}
```

I don't know why you say there is no problem with singular. As pointed out in ticket:34417#comment:1, the problem seems to arise in `singular_polynomial_call`.  

I don't think the line in comment:3 is actually the bug (but I may be wrong). My understanding is that it is just setting a flag to say that something has gone wrong, so singular should be used to do the substitution. But it seems that singular gives the wrong answer (or the interface makes a mistake). It may be possible to solve this particular bug report by avoiding the call to singular, but it does seem to have uncovered a problem with singular (or its interface).



---

archive/issue_comments_486538.json:
```json
{
    "body": "Replying to [comment:8 Dave Morris]:\n> I don't know why you say there is no problem with singular. As pointed out in ticket:34417#comment:1, the problem seems to arise in `singular_polynomial_call`.  \n\nYou are right.\n\nBut there still seems to be a different issue with `.subs()`. I am investigating.",
    "created_at": "2022-09-28T22:13:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34354#issuecomment-486538",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:8 Dave Morris]:
> I don't know why you say there is no problem with singular. As pointed out in ticket:34417#comment:1, the problem seems to arise in `singular_polynomial_call`.  

You are right.

But there still seems to be a different issue with `.subs()`. I am investigating.



---

archive/issue_comments_486539.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2022-09-29T07:24:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34354#issuecomment-486539",
    "user": "https://github.com/kwankyu"
}
```

Changing priority from major to minor.



---

archive/issue_comments_486540.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-09-29T07:24:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34354#issuecomment-486540",
    "user": "https://github.com/kwankyu"
}
```

New commits:



---

archive/issue_comments_486541.json:
```json
{
    "body": "Changing type from defect to enhancement.",
    "created_at": "2022-09-29T07:24:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34354#issuecomment-486541",
    "user": "https://github.com/kwankyu"
}
```

Changing type from defect to enhancement.



---

archive/issue_comments_486542.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-09-29T07:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34354#issuecomment-486542",
    "user": "https://github.com/kwankyu"
}
```

Changing status from new to needs_review.
