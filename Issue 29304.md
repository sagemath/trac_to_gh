# Issue 29304: spkg-configure.m4 for giac

Issue created by migration from https://trac.sagemath.org/ticket/29541

Original creator: @thierry-FreeBSD

Original creation time: 2020-04-21 16:26:50

CC:  dimpase mjo fbissey frederichan parisse @sheerluck arojas @kliem thansen

Keywords: spkg-configure giac

This ticket adds an spkg-configure.m4 for giac, in order to use it from a system package if possible.


---

Comment by @thierry-FreeBSD created at 2020-04-21 16:28:30

spkg-configure.m4 to be put under build/pkgs/giac/


---

Attachment


---

Comment by mkoeppe created at 2020-08-10 17:37:45

Do we know which versions of system giac are acceptable? According to our update tickets (see #29552) >= 1.5.0-63 and < 1.6 are fine.

What does the check for `ConvertUTF16toUTF8` in the proposed `spkg-configure.m4` test? Does this test for a minimum version? 

Is there a way to test the patchlevel of giac? `giac --version` does not include this information.


---

Comment by git created at 2020-08-10 23:38:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-08-12 03:46:55

`ubuntu-focal-standard` (https://github.com/mkoeppe/sage/runs/969005184), `debian-bullseye-standard`: `pexpect.exceptions.ExceptionPexpect: The command was not found or was not executable: giac.`
So some package is still missing


---

Comment by mkoeppe created at 2020-08-12 03:52:26

`fedora-32-standard` (https://github.com/mkoeppe/sage/runs/969005556):

```
Checking whether SageMath should install SPKG giac...
checking whether any of pari is installed as or will be installed as SPKG... no
checking giac/giac.h usability... no
checking giac/giac.h presence... no
checking for giac/giac.h... no
configure: no suitable system package found for SPKG giac
```



---

Comment by mkoeppe created at 2020-08-12 03:56:33

`archlinux-latest-standard` (https://github.com/mkoeppe/sage/runs/969005637): 

```
   TypeError: unable to start giac because the command 'giac --sage' failed: The command was not found or was not executable: giac.
```



---

Comment by mkoeppe created at 2020-08-12 04:01:52

Replying to [comment:9 mkoeppe]:
> `ubuntu-focal-standard` (https://github.com/mkoeppe/sage/runs/969005184), `debian-bullseye-standard`: `pexpect.exceptions.ExceptionPexpect: The command was not found or was not executable: giac.`
> So some package is still missing

debian has the `giac` executable in package `xcas`, which pulls in a lot of dependencies


---

Comment by mkoeppe created at 2020-08-12 04:11:34

Replying to [comment:10 mkoeppe]:
> `fedora-32-standard` (https://github.com/mkoeppe/sage/runs/969005556):
... missing giac-devel


---

Comment by mkoeppe created at 2020-08-12 04:31:12

Replying to [comment:12 mkoeppe]:
> `archlinux-latest-standard` (https://github.com/mkoeppe/sage/runs/969005637): 

need package `giac`


---

Comment by git created at 2020-08-12 04:48:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-08-12 04:49:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-08-12 17:19:24

This fixed `ubuntu-focal-standard` (https://github.com/mkoeppe/sage/runs/974323603); waiting for other runs to finish.


---

Comment by mkoeppe created at 2020-08-13 02:44:56

`archlinux-latest-standard` (https://github.com/mkoeppe/sage/runs/974324005) now finds system giac 1.6.0.7 and reproduces the doctest errors reported in #29552#comment:2


---

Comment by mkoeppe created at 2020-08-13 02:46:32

`fedora-32-standard` (https://github.com/mkoeppe/sage/runs/974323894) now finds system giac 1.5.0.85, all tests pass


---

Comment by git created at 2020-08-13 02:50:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-08-13 02:52:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-08-13 03:00:15

Changing status from new to needs_review.


---

Comment by git created at 2020-08-14 17:10:14

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2020-08-14 17:10:43

Rebased, dropping the merge with the upgrade ticket #29552


---

Comment by git created at 2020-08-15 21:24:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-08-15 21:28:04

Replying to [comment:21 mkoeppe]:
> `archlinux-latest-standard` (https://github.com/mkoeppe/sage/runs/974324005) now finds system giac 1.6.0.7 and reproduces the doctest errors reported in #29552#comment:2

ec95752 has changed it so it rejects giac >= 1.6, as can be seen in https://github.com/mkoeppe/sage/runs/985886420

The latest commit, 5efb0d7, fixes the doctest error.


Ready for review


---

Comment by git created at 2020-08-19 23:36:11

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2020-08-24 17:13:08

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2020-08-24 17:13:48

Rebased, needs review


---

Comment by charpent created at 2020-09-04 10:04:05

Changing status from needs_review to needs_work.


---

Comment by charpent created at 2020-09-04 10:04:05

On Debian testing, installing `xcas`, `libgiac` (and their dependencies) is not detected by `./configure`. From `config.log` :


```
configure:35644: result: giac-1.5.0.87p0:                             does not support check for system package; will be installed as an SPKG
```


==>`needs_work`


---

Comment by dimpase created at 2020-09-04 10:31:14

I suppose you  need `libgiac-dev`, not just `libgiac`.

https://packages.debian.org/sid/libgiac-dev


---

Comment by charpent created at 2020-09-04 14:50:52

Replying to [comment:40 dimpase]:
> I suppose you  need `libgiac-dev`, not just `libgiac`.

That's what I installed (and typoed when typing my answer... ;-).

So, still `needs_work`...


---

Comment by mkoeppe created at 2020-09-04 15:26:04

> does not support check for system package

If you want to test this ticket, you need to use `./bootstrap`


---

Comment by mkoeppe created at 2020-09-04 15:26:04

Changing status from needs_work to needs_review.


---

Comment by isuruf created at 2020-09-10 17:25:54

This looks good to me. Can you add `giac` to `distros/conda.txt`? You can set it to positive review afterwards.


---

Comment by git created at 2020-09-10 17:36:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-09-10 17:36:39

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-09-10 17:36:39

Thanks!


---

Comment by vbraun created at 2020-09-15 21:58:46

Resolution: fixed
