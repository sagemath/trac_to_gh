# Issue 17968: mistune buggers up sage install

Issue created by migration from https://trac.sagemath.org/ticket/18205

Original creator: darij

Original creation time: 2015-04-15 14:27:29

CC:  vbraun fbissey

Keywords: install, packages, mistune

Logfile:

```
Found local metadata for mistune-0.5.1
Found local sources at /home/skraeling/sage/upstream/mistune-0.5.1.tar.gz
Checksum: 21f0c7bf9bad7fac2e34355ed2c50e48557e2c8d vs 21f0c7bf9bad7fac2e34355ed2c50e48557e2c8d
mistune-0.5.1
====================================================
Setting up build directory for mistune-0.5.1
Finished set up
****************************************************
Host system:
Linux angband 3.13.0-37-generic #64-Ubuntu SMP Mon Sep 22 21:30:01 UTC 2014 i686 i686 i686 GNU/Linux
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/home/skraeling/sage/local/libexec/gcc/i686-pc-linux-gnu/4.9.2/lto-wrapper
Target: i686-pc-linux-gnu
Configured with: ../src/configure --prefix=/home/skraeling/sage/local --with-local-prefix=/home/skraeling/sage/local --with-gmp=/home/skraeling/sage/local --with-mpfr=/home/skraeling/sage/local --with-mpc=/home/skraeling/sage/local --with-system-zlib --disable-multilib --disable-nls --enable-languages=c,c++,fortran --disable-libitm  
Thread model: posix
gcc version 4.9.2 (GCC) 
****************************************************
Traceback (most recent call last):
  File "/home/skraeling/sage/local/bin/pip", line 9, in <module>
    load_entry_point('pip==6.1.1', 'console_scripts', 'pip')()
  File "build/bdist.linux-i686/egg/pkg_resources/__init__.py", line 521, in load_entry_point
  File "build/bdist.linux-i686/egg/pkg_resources/__init__.py", line 2632, in load_entry_point
  File "build/bdist.linux-i686/egg/pkg_resources/__init__.py", line 2312, in load
  File "build/bdist.linux-i686/egg/pkg_resources/__init__.py", line 2318, in resolve
  File "/home/skraeling/sage/local/lib/python2.7/site-packages/pip-6.1.1-py2.7.egg/pip/__init__.py", line 15, in <module>
    from pip.vcs import git, mercurial, subversion, bazaar  # noqa
  File "/home/skraeling/sage/local/lib/python2.7/site-packages/pip-6.1.1-py2.7.egg/pip/vcs/mercurial.py", line 10, in <module>
    from pip.download import path_to_url
  File "/home/skraeling/sage/local/lib/python2.7/site-packages/pip-6.1.1-py2.7.egg/pip/download.py", line 32, in <module>
    from pip._vendor import requests, six
  File "/home/skraeling/sage/local/lib/python2.7/site-packages/pip-6.1.1-py2.7.egg/pip/_vendor/__init__.py", line 92, in load_module
    raise ImportError("No module named '%s'" % (name,))
ImportError: No module named 'pip._vendor.requests'
Error installing mistune ... exiting

real	0m0.545s
user	0m0.232s
sys	0m0.076s
************************************************************************
Error installing package mistune-0.5.1
************************************************************************
Please email sage-devel (http://groups.google.com/group/sage-devel)
explaining the problem and including the relevant part of the log file
  /home/skraeling/sage/logs/pkgs/mistune-0.5.1.log
Describe your computer, operating system, etc.
If you want to try to fix the problem yourself, *don't* just cd to
/home/skraeling/sage/local/var/tmp/sage/build/mistune-0.5.1 and type 'make' or whatever is appropriate.
Instead, the following commands setup all environment variables
correctly and load a subshell for you to debug the error:
  (cd '/home/skraeling/sage/local/var/tmp/sage/build/mistune-0.5.1' && '/home/skraeling/sage/sage' --sh)
When you are done debugging, you can type "exit" to leave the subshell.
************************************************************************
```

This happened both before and after distclean.


---

Comment by darij created at 2015-04-15 14:35:47

This is caused by the last commit on #18080.

I have made myself a branch u/darij/rm_mistune that reverts it, but I guess it breaks the IPython notebook.


---

Comment by vbraun created at 2015-04-15 14:36:24

Ah yes thats the pip issue again, forgot about that
----
New commits:


---

Comment by vbraun created at 2015-04-15 14:36:24

Changing status from new to needs_review.


---

Comment by vbraun created at 2015-04-15 14:36:25

Changing status from new to needs_review.


---

Comment by vbraun created at 2015-04-15 14:36:25

Ah yes thats the pip issue again, forgot about that
----
New commits:


---

Comment by darij created at 2015-04-15 15:02:53

Can't review a makefile, but can confirm that it compiles. Thank you!


---

Comment by vbraun created at 2015-04-15 16:13:37

I guess it'll stay broken, then


---

Comment by darij created at 2015-04-15 18:35:53

OK, I'm assuming the things after the colon in build/deps are the dependencies of the thing before. And the spkg-install change is similar to what we have in other such files.

Positive_review then!


---

Comment by darij created at 2015-04-15 18:36:06

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2015-04-15 21:01:45

Stupid question: have you check if there is any call to `pip` left anywhere?


---

Comment by vbraun created at 2015-04-15 21:04:52

Yes, I checked.


---

Comment by vbraun created at 2015-04-15 21:11:32

Resolution: fixed
