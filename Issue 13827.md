# Issue 13827: provide proper cygwin rebasing scripts

archive/issues_013827.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  kcrisman jpflori\n\nKeywords: rebaseall, rebase\n\nRebasing half-built, or fully built, Sage Cygwin installation currently\nneeds manual labour. This patch provides a modified dash script, and an MSDOS batch file, to make this more automatic. One will only needs to adjust `SAGE_ROOT` in the batch file once (per Sage install). \n\nApply to sage_scripts:\n\nIssue created by migration from https://trac.sagemath.org/ticket/14031\n\n",
    "created_at": "2013-01-29T05:42:09Z",
    "labels": [
        "porting: Cygwin",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.9",
    "title": "provide proper cygwin rebasing scripts",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13827",
    "user": "dimpase"
}
```
Assignee: tbd

CC:  kcrisman jpflori

Keywords: rebaseall, rebase

Rebasing half-built, or fully built, Sage Cygwin installation currently
needs manual labour. This patch provides a modified dash script, and an MSDOS batch file, to make this more automatic. One will only needs to adjust `SAGE_ROOT` in the batch file once (per Sage install). 

Apply to sage_scripts:

Issue created by migration from https://trac.sagemath.org/ticket/14031





---

archive/issue_comments_171852.json:
```json
{
    "body": "Attachment [trac_14031.patch](tarball://root/attachments/some-uuid/ticket14031/trac_14031.patch) by dimpase created at 2013-01-29 05:43:22",
    "created_at": "2013-01-29T05:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171852",
    "user": "dimpase"
}
```

Attachment [trac_14031.patch](tarball://root/attachments/some-uuid/ticket14031/trac_14031.patch) by dimpase created at 2013-01-29 05:43:22



---

archive/issue_comments_171853.json:
```json
{
    "body": "Is this the right way to provide patches for `sage_scripts`?",
    "created_at": "2013-01-29T05:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171853",
    "user": "dimpase"
}
```

Is this the right way to provide patches for `sage_scripts`?



---

archive/issue_comments_171854.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-01-29T05:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171854",
    "user": "dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_171855.json:
```json
{
    "body": "I don't know what you mean by \"right way\".  I usually go into `$SAGE_LOCAL/bin` and do hg commands from that repository...\n\n\n```\nrem dash %SAGE_ROOT%\\local\\bin\\s.sh \n```\n\nBut the script isn't called `s.sh`?  I know nothing about DOS so maybe this is obviously right.\n\nAn additional remark in the script about just using `C:\\cygwin\\bin\\dash.exe` in the command prompt would not be amiss, since one could imagine people helping who don't know how to set paths in Windows, or even how to make env vars in Windows (e.g., I have no idea how to set `SAGE_ROOT` in the Windows command line).",
    "created_at": "2013-01-29T17:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171855",
    "user": "kcrisman"
}
```

I don't know what you mean by "right way".  I usually go into `$SAGE_LOCAL/bin` and do hg commands from that repository...


```
rem dash %SAGE_ROOT%\local\bin\s.sh 
```

But the script isn't called `s.sh`?  I know nothing about DOS so maybe this is obviously right.

An additional remark in the script about just using `C:\cygwin\bin\dash.exe` in the command prompt would not be amiss, since one could imagine people helping who don't know how to set paths in Windows, or even how to make env vars in Windows (e.g., I have no idea how to set `SAGE_ROOT` in the Windows command line).



---

archive/issue_comments_171856.json:
```json
{
    "body": "Replying to [comment:2 kcrisman]:\n> I don't know what you mean by \"right way\".  I usually go into `$SAGE_LOCAL/bin` and do hg commands from that repository...\nI was wondering whether I need to wrap it up in an spkg...\n\n> \n> {{{\n> rem dash %SAGE_ROOT%\\local\\bin\\s.sh \n> }}}\n> But the script isn't called `s.sh`?  I know nothing about DOS so maybe this is obviously right.\n`rem` means that the whole line is commented out, same as `#` for Unix shells.\nIndeed, this line can be deleted (a debugging leftover).\n\n> \n> An additional remark in the script about just using `C:\\cygwin\\bin\\dash.exe` in the command prompt would not be amiss, \nthe batch file does the right thing, if your Cygwin is in `C:\\cygwin`. Otherwise the corr. line there needs to be changed.\n\n>since one could imagine people helping who don't know how to set paths in Windows, or even how to make env vars in Windows (e.g., I have no idea how to set `SAGE_ROOT` in the Windows command line).\n\nno, it is meant to be changed in the batch file body. Perhaps I should mention that it is meant to call the dash script from the batch file, and not directly. \n\n\nBy the way, setting `BLAH` to `foo` in the Windows command line is just\n\n```\nset BLAH=foo\n```\n\nAnd if you need to evaluate `BLAH` you do `%BLAH%`, e.g.\n\n```\necho %BLAH%\n```\n\nwill print `BLAH`'s value. You might also want to know that if you call dash after setting `BLAH`, it will be known to dash, and can be evaluated as usual, i.e. as `$BLAH`. dash will also treat `PATH` in a special way, by trying to translate it into Cygwin's PATH in some cases. But I digressed. :-)",
    "created_at": "2013-01-29T22:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171856",
    "user": "dimpase"
}
```

Replying to [comment:2 kcrisman]:
> I don't know what you mean by "right way".  I usually go into `$SAGE_LOCAL/bin` and do hg commands from that repository...
I was wondering whether I need to wrap it up in an spkg...

> 
> {{{
> rem dash %SAGE_ROOT%\local\bin\s.sh 
> }}}
> But the script isn't called `s.sh`?  I know nothing about DOS so maybe this is obviously right.
`rem` means that the whole line is commented out, same as `#` for Unix shells.
Indeed, this line can be deleted (a debugging leftover).

> 
> An additional remark in the script about just using `C:\cygwin\bin\dash.exe` in the command prompt would not be amiss, 
the batch file does the right thing, if your Cygwin is in `C:\cygwin`. Otherwise the corr. line there needs to be changed.

>since one could imagine people helping who don't know how to set paths in Windows, or even how to make env vars in Windows (e.g., I have no idea how to set `SAGE_ROOT` in the Windows command line).

no, it is meant to be changed in the batch file body. Perhaps I should mention that it is meant to call the dash script from the batch file, and not directly. 


By the way, setting `BLAH` to `foo` in the Windows command line is just

```
set BLAH=foo
```

And if you need to evaluate `BLAH` you do `%BLAH%`, e.g.

```
echo %BLAH%
```

will print `BLAH`'s value. You might also want to know that if you call dash after setting `BLAH`, it will be known to dash, and can be evaluated as usual, i.e. as `$BLAH`. dash will also treat `PATH` in a special way, by trying to translate it into Cygwin's PATH in some cases. But I digressed. :-)



---

archive/issue_comments_171857.json:
```json
{
    "body": "> > I don't know what you mean by \"right way\".  I usually go into `$SAGE_LOCAL/bin` and do hg commands from that repository...\n> I was wondering whether I need to wrap it up in an spkg...\nNo, one can just do the usual hg thing.\n> > But the script isn't called `s.sh`?  I know nothing about DOS so maybe this is obviously right.\n> `rem` means that the whole line is commented out, same as `#` for Unix shells.\nI did figure that out eventually by staring at it :)\n> Indeed, this line can be deleted (a debugging leftover).\nGood.  \n> no, it is meant to be changed in the batch file body. Perhaps I should mention that it is meant to call the dash script from the batch file, and not directly. \nSure.  I would have just called it directly somehow.\n> But I digressed. :-) \nUseful info, though!",
    "created_at": "2013-01-30T01:45:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171857",
    "user": "kcrisman"
}
```

> > I don't know what you mean by "right way".  I usually go into `$SAGE_LOCAL/bin` and do hg commands from that repository...
> I was wondering whether I need to wrap it up in an spkg...
No, one can just do the usual hg thing.
> > But the script isn't called `s.sh`?  I know nothing about DOS so maybe this is obviously right.
> `rem` means that the whole line is commented out, same as `#` for Unix shells.
I did figure that out eventually by staring at it :)
> Indeed, this line can be deleted (a debugging leftover).
Good.  
> no, it is meant to be changed in the batch file body. Perhaps I should mention that it is meant to call the dash script from the batch file, and not directly. 
Sure.  I would have just called it directly somehow.
> But I digressed. :-) 
Useful info, though!



---

archive/issue_comments_171858.json:
```json
{
    "body": "We should also/instead provide a bash script using rebase -O as Dima suggested on #6743.",
    "created_at": "2013-02-13T15:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171858",
    "user": "jpflori"
}
```

We should also/instead provide a bash script using rebase -O as Dima suggested on #6743.



---

archive/issue_comments_171859.json:
```json
{
    "body": "Please add your real name as Author.",
    "created_at": "2013-03-13T14:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171859",
    "user": "jdemeyer"
}
```

Please add your real name as Author.



---

archive/issue_comments_171860.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-03-13T15:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171860",
    "user": "dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_171861.json:
```json
{
    "body": "> We should also/instead provide a bash script using rebase -O as Dima suggested on #6743.\n+1 - this worked very nicely for me recently.  I don't see why one couldn't replace the current one with that.",
    "created_at": "2013-03-13T15:54:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171861",
    "user": "kcrisman"
}
```

> We should also/instead provide a bash script using rebase -O as Dima suggested on #6743.
+1 - this worked very nicely for me recently.  I don't see why one couldn't replace the current one with that.



---

archive/issue_comments_171862.json:
```json
{
    "body": "It would also be nice to mention the /etc/rebase.db.i386 file, its use and the potential need to clean it up (or at least it seems that at some point deleting it was useful for some of us, Dima could you confirm that?).",
    "created_at": "2013-03-14T10:41:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171862",
    "user": "jpflori"
}
```

It would also be nice to mention the /etc/rebase.db.i386 file, its use and the potential need to clean it up (or at least it seems that at some point deleting it was useful for some of us, Dima could you confirm that?).



---

archive/issue_comments_171863.json:
```json
{
    "body": "There is also a tiny typo.\n\n```\nC:\\cygin\\bin)\n```\n\nIt doesn't affect things because it's in a comment, but could affect users.",
    "created_at": "2013-04-10T02:40:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171863",
    "user": "kcrisman"
}
```

There is also a tiny typo.

```
C:\cygin\bin)
```

It doesn't affect things because it's in a comment, but could affect users.



---

archive/issue_comments_171864.json:
```json
{
    "body": "Attachment [trac_14031-scripts.patch](tarball://root/attachments/some-uuid/ticket14031/trac_14031-scripts.patch) by jpflori created at 2013-04-16 09:41:19\n\nUpdated scripts, using rebaseall or rebase -O.",
    "created_at": "2013-04-16T09:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171864",
    "user": "jpflori"
}
```

Attachment [trac_14031-scripts.patch](tarball://root/attachments/some-uuid/ticket14031/trac_14031-scripts.patch) by jpflori created at 2013-04-16 09:41:19

Updated scripts, using rebaseall or rebase -O.



---

archive/issue_comments_171865.json:
```json
{
    "body": "Changing keywords from \"rebaseall, rebase\" to \"rebaseall, rebase, cygwin\".",
    "created_at": "2013-04-16T09:46:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171865",
    "user": "jpflori"
}
```

Changing keywords from "rebaseall, rebase" to "rebaseall, rebase, cygwin".



---

archive/issue_comments_171866.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-04-16T09:46:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171866",
    "user": "jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_171867.json:
```json
{
    "body": "I'm not sure #14465 should be an explicit dependency.\nThe script are already self documented, so we could merge this even without #14465.",
    "created_at": "2013-04-18T13:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171867",
    "user": "jpflori"
}
```

I'm not sure #14465 should be an explicit dependency.
The script are already self documented, so we could merge this even without #14465.



---

archive/issue_comments_171868.json:
```json
{
    "body": "> The script are already self documented, so we could merge this even without #14465.\nFair enough.\n\nBy the way, I give positive review to the actual commands, as does no doubt J-P.    But I haven't (and won't have) had the chance to try out the actual scripts \"in production\" as my Cygwin is not available currently, and someone should try them in such a situation just to make sure we didn't miss a typo or something, or that the extreme minimality of the shells in Windows doesn't cause one of them to hiccup (`dash` doesn't even have an `ls` command!).",
    "created_at": "2013-04-18T14:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171868",
    "user": "kcrisman"
}
```

> The script are already self documented, so we could merge this even without #14465.
Fair enough.

By the way, I give positive review to the actual commands, as does no doubt J-P.    But I haven't (and won't have) had the chance to try out the actual scripts "in production" as my Cygwin is not available currently, and someone should try them in such a situation just to make sure we didn't miss a typo or something, or that the extreme minimality of the shells in Windows doesn't cause one of them to hiccup (`dash` doesn't even have an `ls` command!).



---

archive/issue_comments_171869.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-04-27T13:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171869",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_171870.json:
```json
{
    "body": "Replying to [comment:14 kcrisman]:\n> I give positive review to the actual commands\nGreat! We can still fix bugs later.",
    "created_at": "2013-04-27T13:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171870",
    "user": "jdemeyer"
}
```

Replying to [comment:14 kcrisman]:
> I give positive review to the actual commands
Great! We can still fix bugs later.



---

archive/issue_comments_171871.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-04-29T08:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171871",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_171872.json:
```json
{
    "body": "I had a situation when I needed to rebase before sage_scripts spkg was installed (while building python spkg), so sage-rebase was not installed.\n\nThis is a kind of bug I don't know how to address properly (although installing the spkg with ./sage -f did help).\nAt least this got to be documented.",
    "created_at": "2013-05-31T02:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171872",
    "user": "dimpase"
}
```

I had a situation when I needed to rebase before sage_scripts spkg was installed (while building python spkg), so sage-rebase was not installed.

This is a kind of bug I don't know how to address properly (although installing the spkg with ./sage -f did help).
At least this got to be documented.



---

archive/issue_comments_171873.json:
```json
{
    "body": "Replying to [comment:17 dimpase]:\n> This is a kind of bug I don't know how to address properly\nMove the scripts to `$SAGE_ROOT/spkg/bin`. That's really the place for scripts which are needed at build-time.",
    "created_at": "2013-05-31T06:41:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171873",
    "user": "jdemeyer"
}
```

Replying to [comment:17 dimpase]:
> This is a kind of bug I don't know how to address properly
Move the scripts to `$SAGE_ROOT/spkg/bin`. That's really the place for scripts which are needed at build-time.



---

archive/issue_comments_171874.json:
```json
{
    "body": "Replying to [comment:18 jdemeyer]:\n> Replying to [comment:17 dimpase]:\n> > This is a kind of bug I don't know how to address properly\n> Move the scripts to `$SAGE_ROOT/spkg/bin`. That's really the place for scripts which are needed at build-time.\n\nI've opened #14742 to deal with this.",
    "created_at": "2013-06-14T20:07:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13827#issuecomment-171874",
    "user": "dimpase"
}
```

Replying to [comment:18 jdemeyer]:
> Replying to [comment:17 dimpase]:
> > This is a kind of bug I don't know how to address properly
> Move the scripts to `$SAGE_ROOT/spkg/bin`. That's really the place for scripts which are needed at build-time.

I've opened #14742 to deal with this.
