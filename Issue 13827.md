# Issue 13827: provide proper cygwin rebasing scripts

Issue created by migration from Trac.

Original creator: dimpase

Original creation time: 2013-01-29 05:42:09

Assignee: tbd

CC:  kcrisman jpflori

Keywords: rebaseall, rebase

Rebasing half-built, or fully built, Sage Cygwin installation currently
needs manual labour. This patch provides a modified dash script, and an MSDOS batch file, to make this more automatic. One will only needs to adjust `SAGE_ROOT` in the batch file once (per Sage install). 

Apply to sage_scripts:


---

Attachment


---

Comment by dimpase created at 2013-01-29 05:49:00

Is this the right way to provide patches for `sage_scripts`?


---

Comment by dimpase created at 2013-01-29 05:49:00

Changing status from new to needs_review.


---

Comment by kcrisman created at 2013-01-29 17:47:42

I don't know what you mean by "right way".  I usually go into `$SAGE_LOCAL/bin` and do hg commands from that repository...


```
rem dash %SAGE_ROOT%\local\bin\s.sh 
```

But the script isn't called `s.sh`?  I know nothing about DOS so maybe this is obviously right.

An additional remark in the script about just using `C:\cygwin\bin\dash.exe` in the command prompt would not be amiss, since one could imagine people helping who don't know how to set paths in Windows, or even how to make env vars in Windows (e.g., I have no idea how to set `SAGE_ROOT` in the Windows command line).


---

Comment by dimpase created at 2013-01-29 22:25:03

Replying to [comment:2 kcrisman]:
> I don't know what you mean by "right way".  I usually go into `$SAGE_LOCAL/bin` and do hg commands from that repository...
I was wondering whether I need to wrap it up in an spkg...

> 
> {{{
> rem dash %SAGE_ROOT%\local\bin\s.sh 
> }}}
> But the script isn't called `s.sh`?  I know nothing about DOS so maybe this is obviously right.
`rem` means that the whole line is commented out, same as `#` for Unix shells.
Indeed, this line can be deleted (a debugging leftover).

> 
> An additional remark in the script about just using `C:\cygwin\bin\dash.exe` in the command prompt would not be amiss, 
the batch file does the right thing, if your Cygwin is in `C:\cygwin`. Otherwise the corr. line there needs to be changed.

>since one could imagine people helping who don't know how to set paths in Windows, or even how to make env vars in Windows (e.g., I have no idea how to set `SAGE_ROOT` in the Windows command line).

no, it is meant to be changed in the batch file body. Perhaps I should mention that it is meant to call the dash script from the batch file, and not directly. 


By the way, setting `BLAH` to `foo` in the Windows command line is just

```
set BLAH=foo
```

And if you need to evaluate `BLAH` you do `%BLAH%`, e.g.

```
echo %BLAH%
```

will print `BLAH`'s value. You might also want to know that if you call dash after setting `BLAH`, it will be known to dash, and can be evaluated as usual, i.e. as `$BLAH`. dash will also treat `PATH` in a special way, by trying to translate it into Cygwin's PATH in some cases. But I digressed. :-)


---

Comment by kcrisman created at 2013-01-30 01:45:45

> > I don't know what you mean by "right way".  I usually go into `$SAGE_LOCAL/bin` and do hg commands from that repository...
> I was wondering whether I need to wrap it up in an spkg...
No, one can just do the usual hg thing.
> > But the script isn't called `s.sh`?  I know nothing about DOS so maybe this is obviously right.
> `rem` means that the whole line is commented out, same as `#` for Unix shells.
I did figure that out eventually by staring at it :)
> Indeed, this line can be deleted (a debugging leftover).
Good.  
> no, it is meant to be changed in the batch file body. Perhaps I should mention that it is meant to call the dash script from the batch file, and not directly. 
Sure.  I would have just called it directly somehow.
> But I digressed. :-) 
Useful info, though!


---

Comment by jpflori created at 2013-02-13 15:58:27

We should also/instead provide a bash script using rebase -O as Dima suggested on #6743.


---

Comment by jdemeyer created at 2013-03-13 14:41:22

Please add your real name as Author.


---

Comment by dimpase created at 2013-03-13 15:02:15

Changing status from needs_review to needs_work.


---

Comment by kcrisman created at 2013-03-13 15:54:03

> We should also/instead provide a bash script using rebase -O as Dima suggested on #6743.
+1 - this worked very nicely for me recently.  I don't see why one couldn't replace the current one with that.


---

Comment by jpflori created at 2013-03-14 10:41:31

It would also be nice to mention the /etc/rebase.db.i386 file, its use and the potential need to clean it up (or at least it seems that at some point deleting it was useful for some of us, Dima could you confirm that?).


---

Comment by kcrisman created at 2013-04-10 02:40:39

There is also a tiny typo.

```
C:\cygin\bin)
```

It doesn't affect things because it's in a comment, but could affect users.


---

Attachment

Updated scripts, using rebaseall or rebase -O.


---

Comment by jpflori created at 2013-04-16 09:46:16

Changing keywords from "rebaseall, rebase" to "rebaseall, rebase, cygwin".


---

Comment by jpflori created at 2013-04-16 09:46:16

Changing status from needs_work to needs_review.


---

Comment by jpflori created at 2013-04-18 13:13:23

I'm not sure #14465 should be an explicit dependency.
The script are already self documented, so we could merge this even without #14465.


---

Comment by kcrisman created at 2013-04-18 14:30:20

> The script are already self documented, so we could merge this even without #14465.
Fair enough.

By the way, I give positive review to the actual commands, as does no doubt J-P.    But I haven't (and won't have) had the chance to try out the actual scripts "in production" as my Cygwin is not available currently, and someone should try them in such a situation just to make sure we didn't miss a typo or something, or that the extreme minimality of the shells in Windows doesn't cause one of them to hiccup (`dash` doesn't even have an `ls` command!).


---

Comment by jdemeyer created at 2013-04-27 13:59:41

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-04-27 13:59:41

Replying to [comment:14 kcrisman]:
> I give positive review to the actual commands
Great! We can still fix bugs later.


---

Comment by jdemeyer created at 2013-04-29 08:16:34

Resolution: fixed


---

Comment by dimpase created at 2013-05-31 02:25:35

I had a situation when I needed to rebase before sage_scripts spkg was installed (while building python spkg), so sage-rebase was not installed.

This is a kind of bug I don't know how to address properly (although installing the spkg with ./sage -f did help).
At least this got to be documented.


---

Comment by jdemeyer created at 2013-05-31 06:41:06

Replying to [comment:17 dimpase]:
> This is a kind of bug I don't know how to address properly
Move the scripts to `$SAGE_ROOT/spkg/bin`. That's really the place for scripts which are needed at build-time.


---

Comment by dimpase created at 2013-06-14 20:07:30

Replying to [comment:18 jdemeyer]:
> Replying to [comment:17 dimpase]:
> > This is a kind of bug I don't know how to address properly
> Move the scripts to `$SAGE_ROOT/spkg/bin`. That's really the place for scripts which are needed at build-time.

I've opened #14742 to deal with this.
