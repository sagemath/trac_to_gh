# Issue 21875: OpenBLAS fails to build on macOS Sierra

Issue created by migration from Trac.

Original creator: dunfield

Original creation time: 2016-12-30 20:33:27

CC:  vbraun fbissey jpflori

Keywords: OpenBLAS

The package openblas-0.2.19.p0 in [SageMath](SageMath) 7.5rc1 fails to compile on a Mac Pro running macOS Sierra with Xcode 8.2.1.  See attached log for details.


---

Attachment

Hum... Curious, I have re-tested on my macbook running the latest sierra and xcode (8.2.1 here too) and I don't have that problem. The only real obvious difference is sandybridge for you and halswell for me. 
Was it a build from scratch or an incremental upgrade from an older sage? From the fact you are downloading openblas I would say the later.
Could you find the file `osx.def` in the build folder and post it please.


---

Attachment


---

Attachment

Replying to [comment:1 fbissey]:
> Was it a build from scratch or an incremental upgrade from an older sage? 

It was build from scratch in a brand new clone of the development branch from the git repo. I have uploaded the file you requested, as well as the global `config.log` in case that is helpful.  The CPU on this machine is a Xeon E5-1680 v2.


---

Comment by fbissey created at 2016-12-30 21:18:06

Ouch, you have brew on your system. It seems that you have things set up to use clang from the system and gfortran from brew, but usually the presence of brew in its default location brings trouble.
I now that brew recommends installing itself in `/usr/local` so it just works out of the box. But the reality of it, is that installing it there means that it will interfere with competing systems or stuff that doesn't expect it.


---

Comment by dunfield created at 2016-12-30 21:40:36

Replying to [comment:3 fbissey]:
> Ouch, you have brew on your system. It seems that you have things set up to use clang from the system and gfortran from brew.

So I removed brew's copy of gfortran (in fact, it's entire copy of gcc) and now openblas builds!  I'm not sure why openblas was finding the wrong gfortran since even during the initial build I had:


```
% ./sage -sh
Note: SAGE_ROOT=/pkgs/sage-git
> which gfortran
/pkgs/sage-git/local/bin/gfortran
```


Regardless, many thanks.  What's the right was of closing this ticket in this situation?


---

Comment by fbissey created at 2016-12-30 23:45:27

Put your name in the reviewer field and give it a positive review now.


---

Comment by fbissey created at 2016-12-30 23:45:27

Changing status from new to needs_review.


---

Comment by dunfield created at 2016-12-31 01:40:33

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-01-03 21:53:01

Resolution: invalid
