# Issue 21875: OpenBLAS fails to build on macOS Sierra

archive/issues_021875.json:
```json
{
    "body": "CC:  @vbraun @kiwifb jpflori\n\nKeywords: OpenBLAS\n\nThe package openblas-0.2.19.p0 in [SageMath](SageMath) 7.5rc1 fails to compile on a Mac Pro running macOS Sierra with Xcode 8.2.1.  See attached log for details.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22112\n\n",
    "created_at": "2016-12-30T20:33:27Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "OpenBLAS fails to build on macOS Sierra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21875",
    "user": "https://github.com/NathanDunfield"
}
```
CC:  @vbraun @kiwifb jpflori

Keywords: OpenBLAS

The package openblas-0.2.19.p0 in [SageMath](SageMath) 7.5rc1 fails to compile on a Mac Pro running macOS Sierra with Xcode 8.2.1.  See attached log for details.

Issue created by migration from https://trac.sagemath.org/ticket/22112





---

archive/issue_comments_303351.json:
```json
{
    "body": "Attachment [openblas-0.2.19.p0.log](tarball://root/attachments/some-uuid/ticket22112/openblas-0.2.19.p0.log) by @kiwifb created at 2016-12-30 21:02:55\n\nHum... Curious, I have re-tested on my macbook running the latest sierra and xcode (8.2.1 here too) and I don't have that problem. The only real obvious difference is sandybridge for you and halswell for me. \nWas it a build from scratch or an incremental upgrade from an older sage? From the fact you are downloading openblas I would say the later.\nCould you find the file `osx.def` in the build folder and post it please.",
    "created_at": "2016-12-30T21:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21875#issuecomment-303351",
    "user": "https://github.com/kiwifb"
}
```

Attachment [openblas-0.2.19.p0.log](tarball://root/attachments/some-uuid/ticket22112/openblas-0.2.19.p0.log) by @kiwifb created at 2016-12-30 21:02:55

Hum... Curious, I have re-tested on my macbook running the latest sierra and xcode (8.2.1 here too) and I don't have that problem. The only real obvious difference is sandybridge for you and halswell for me. 
Was it a build from scratch or an incremental upgrade from an older sage? From the fact you are downloading openblas I would say the later.
Could you find the file `osx.def` in the build folder and post it please.



---

archive/issue_comments_303352.json:
```json
{
    "body": "Attachment [osx.def](tarball://root/attachments/some-uuid/ticket22112/osx.def) by @NathanDunfield created at 2016-12-30 21:08:37",
    "created_at": "2016-12-30T21:08:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21875#issuecomment-303352",
    "user": "https://github.com/NathanDunfield"
}
```

Attachment [osx.def](tarball://root/attachments/some-uuid/ticket22112/osx.def) by @NathanDunfield created at 2016-12-30 21:08:37



---

archive/issue_comments_303353.json:
```json
{
    "body": "Attachment [config.log](tarball://root/attachments/some-uuid/ticket22112/config.log) by @NathanDunfield created at 2016-12-30 21:11:46\n\nReplying to [comment:1 fbissey]:\n> Was it a build from scratch or an incremental upgrade from an older sage? \n\nIt was build from scratch in a brand new clone of the development branch from the git repo. I have uploaded the file you requested, as well as the global `config.log` in case that is helpful.  The CPU on this machine is a Xeon E5-1680 v2.",
    "created_at": "2016-12-30T21:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21875#issuecomment-303353",
    "user": "https://github.com/NathanDunfield"
}
```

Attachment [config.log](tarball://root/attachments/some-uuid/ticket22112/config.log) by @NathanDunfield created at 2016-12-30 21:11:46

Replying to [comment:1 fbissey]:
> Was it a build from scratch or an incremental upgrade from an older sage? 

It was build from scratch in a brand new clone of the development branch from the git repo. I have uploaded the file you requested, as well as the global `config.log` in case that is helpful.  The CPU on this machine is a Xeon E5-1680 v2.



---

archive/issue_comments_303354.json:
```json
{
    "body": "Ouch, you have brew on your system. It seems that you have things set up to use clang from the system and gfortran from brew, but usually the presence of brew in its default location brings trouble.\nI now that brew recommends installing itself in `/usr/local` so it just works out of the box. But the reality of it, is that installing it there means that it will interfere with competing systems or stuff that doesn't expect it.",
    "created_at": "2016-12-30T21:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21875#issuecomment-303354",
    "user": "https://github.com/kiwifb"
}
```

Ouch, you have brew on your system. It seems that you have things set up to use clang from the system and gfortran from brew, but usually the presence of brew in its default location brings trouble.
I now that brew recommends installing itself in `/usr/local` so it just works out of the box. But the reality of it, is that installing it there means that it will interfere with competing systems or stuff that doesn't expect it.



---

archive/issue_comments_303355.json:
```json
{
    "body": "Replying to [comment:3 fbissey]:\n> Ouch, you have brew on your system. It seems that you have things set up to use clang from the system and gfortran from brew.\n\nSo I removed brew's copy of gfortran (in fact, it's entire copy of gcc) and now openblas builds!  I'm not sure why openblas was finding the wrong gfortran since even during the initial build I had:\n\n\n```\n% ./sage -sh\nNote: SAGE_ROOT=/pkgs/sage-git\n> which gfortran\n/pkgs/sage-git/local/bin/gfortran\n```\n\n\nRegardless, many thanks.  What's the right was of closing this ticket in this situation?",
    "created_at": "2016-12-30T21:40:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21875#issuecomment-303355",
    "user": "https://github.com/NathanDunfield"
}
```

Replying to [comment:3 fbissey]:
> Ouch, you have brew on your system. It seems that you have things set up to use clang from the system and gfortran from brew.

So I removed brew's copy of gfortran (in fact, it's entire copy of gcc) and now openblas builds!  I'm not sure why openblas was finding the wrong gfortran since even during the initial build I had:


```
% ./sage -sh
Note: SAGE_ROOT=/pkgs/sage-git
> which gfortran
/pkgs/sage-git/local/bin/gfortran
```


Regardless, many thanks.  What's the right was of closing this ticket in this situation?



---

archive/issue_comments_303356.json:
```json
{
    "body": "Put your name in the reviewer field and give it a positive review now.",
    "created_at": "2016-12-30T23:45:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21875#issuecomment-303356",
    "user": "https://github.com/kiwifb"
}
```

Put your name in the reviewer field and give it a positive review now.



---

archive/issue_comments_303357.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-12-30T23:45:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21875#issuecomment-303357",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_303358.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-12-31T01:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21875#issuecomment-303358",
    "user": "https://github.com/NathanDunfield"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_020627.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2017-01-03T21:53:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21875",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21875#event-20627"
}
```



---

archive/issue_comments_303359.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2017-01-03T21:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21875#issuecomment-303359",
    "user": "https://github.com/vbraun"
}
```

Resolution: invalid
