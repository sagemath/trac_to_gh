# Issue 34020: Add missing cdef method declarations (for Cython 3)

Issue created by migration from https://trac.sagemath.org/ticket/34257

Original creator: mkoeppe

Original creation time: 2022-07-31 19:31:07

CC:  tscrim klee @tobiasdiez

from #29863#comment:15


---

Comment by mkoeppe created at 2022-07-31 19:33:10

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-07-31 19:33:10

Changing component from refactoring to cython.


---

Comment by mkoeppe created at 2022-07-31 19:33:10

New commits:


---

Comment by tscrim created at 2022-07-31 23:51:58

I am very surprised that Cython will require subclasses to redeclare things in the base class with the same signature. This seems quite pointless and likely to have a number of changes in the Sage library. Well, if it is what it is, then we will have to do it, but it is a departure from C++. You think you got every one here?


---

Comment by mkoeppe created at 2022-07-31 23:56:38

Replying to [comment:3 tscrim]:
> You think you got every one here?

Yes, as tested with #29863


---

Comment by tscrim created at 2022-08-02 03:58:58

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2022-08-02 03:58:58

Build failure; see patchbot.


---

Comment by mkoeppe created at 2022-08-02 04:01:49

Indeed

```
[sagelib-9.7.beta6] Error compiling Cython file:
[sagelib-9.7.beta6] ------------------------------------------------------------
[sagelib-9.7.beta6] ...
[sagelib-9.7.beta6]             tmpi=Integer(dirichlet_coeff[i])
[sagelib-9.7.beta6]             coeffs[i+1] = mpz_get_si(tmpi.value)
[sagelib-9.7.beta6]         self.thisptr=new_c_Lfunction_I(NAME, what_type,  N, coeffs, Period, q,  w,  A, g, l, n_poles, p, r)
[sagelib-9.7.beta6]         del_ints(coeffs)
[sagelib-9.7.beta6] 
[sagelib-9.7.beta6]     cdef inline c_Complex __value(self,c_Complex s,int derivative):
[sagelib-9.7.beta6]         ^
[sagelib-9.7.beta6] ------------------------------------------------------------
[sagelib-9.7.beta6] 
[sagelib-9.7.beta6] sage/libs/lcalc/lcalc_Lfunction.pyx:510:9: Overriding final methods is not allowed
[sagelib-9.7.beta6] 
```



---

Comment by mkoeppe created at 2022-08-08 16:02:14

Help by Cython experts is needed to find a solution that works with both Cython 0.29.x and Cython 3
