# Issue 16135: Intermittent test failures with IPython history

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2014-05-17 14:30:33

Happens sometimes. IPython still doesn't know how to do atomic changes to the history, I guess:

```
sage -t --long src/sage/misc/displayhook.py
**********************************************************************
File "src/sage/misc/displayhook.py", line 23, in sage.misc.displayhook
Failed example:
    shell = get_test_shell()
Expected nothing
Got:
    ERROR! History file wasn't a valid SQLite database. It was moved to /home/buildslave-sage/slave/sage_git/dot_sage/ipython-1.2.1/profile_default/history-corrupt.sqlite and a new file created.
    ERROR! History file wasn't a valid SQLite database. It was moved to /home/buildslave-sage/slave/sage_git/dot_sage/ipython-1.2.1/profile_default/history-corrupt.sqlite and a new file created.
```




---

Comment by vbraun created at 2014-05-17 15:05:34

Until the last IPython update we silenced that error in a Sage patch.

Upstream bug: https://github.com/ipython/ipython/issues/2845


---

Comment by jhpalmieri created at 2014-05-17 16:38:43

By the way, I don't know if this is related or can be fixed at the same time, but would it be possible for Sage doctesting to not add to the IPython history? I find it disconcerting to start a new session and to have odd commands appear in my history, due to doctesting.


---

Comment by jdemeyer created at 2015-03-13 10:04:47

Is this still relevant after #16745 and #17826?


---

Comment by mkoeppe created at 2021-09-07 08:31:53

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-09-07 08:31:53

outdated, should close


---

Comment by jhpalmieri created at 2021-09-07 15:41:30

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-09-10 04:50:10

Resolution: invalid
