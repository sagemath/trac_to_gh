# Issue 10081: Python spkg: ImportError: No module named math

Issue created by migration from Trac.

Original creator: mpatel

Original creation time: 2010-10-06 05:14:58

Assignee: tbd

CC:  drkirkby jhpalmieri leif

On the Skynet hosts flavius (x86_64-Linux-k8-f12), iras (ia64-Linux-suse), and menas (x86_64-Linux-core2-suse), installing the Python package sometimes fails with

```python
[...]
Sleeping for three seconds before testing python
'import site' failed; use -v for traceback
Traceback (most recent call last):
  File "<string>", line 1, in <module>
ImportError: No module named math
math module failed to import
```

This is with 4.6.alpha2.  Running `./sage -python` and doing `import math` works.

From near the end of `spkg-install`:

```sh
[...]
# Sleeping for three seconds so that parallel 'make install' catches up
# with the following test.
echo "Sleeping for three seconds before testing python"
sleep 3

# Make sure extension modules were built correctly.
python -c "import math"

if [ $? -eq 0 -a -f "$SAGE_LOCAL/bin/python" ]; then
    echo "math module OK"
else
    echo "math module failed to import"
    exit 1
fi
[...]
```



---

Comment by mpatel created at 2010-10-06 05:16:07

Has anyone else seen this problem, possibly on other machines?


---

Comment by mpatel created at 2010-10-06 05:29:36

Logs are [here](http://sage.math.washington.edu/home/mpatel/trac/10082).

Actually, the error on menas (x86_64-Linux-core2-suse) is different:

```
[...]
gcc  -pthread -L/home/buildbot/build/sage/menas-1/menas_full/build/sage-4.6.alpha3pre2/local/lib  -Xlinker -export-dynamic -o python \
			Modules/python.o \
			-L. -lpython2.6 -lpthread -ldl  -lutil   -lm  
/home/buildbot/build/sage/menas-1/menas_full/build/sage-4.6.alpha3pre2/spkg/build/python-2.6.4.p9/src/Modules/cPickle.c: In function ‘Unpickler_noload’:
/home/buildbot/build/sage/menas-1/menas_full/build/sage-4.6.alpha3pre2/spkg/build/python-2.6.4.p9/src/Modules/cPickle.c:202:5: warning: assuming signed overflow does not occur when assuming that (X - c) > X is always false
In file included from /home/buildbot/build/sage/menas-1/menas_full/build/sage-4.6.alpha3pre2/local/include/readline/readline.h:36:0,
                 from /home/buildbot/build/sage/menas-1/menas_full/build/sage-4.6.alpha3pre2/spkg/build/python-2.6.4.p9/src/Modules/readline.c:31:
/home/buildbot/build/sage/menas-1/menas_full/build/sage-4.6.alpha3pre2/local/include/readline/rltypedefs.h:34:1: warning: function declaration isn’t a prototype
/home/buildbot/build/sage/menas-1/menas_full/build/sage-4.6.alpha3pre2/local/include/readline/rltypedefs.h:35:1: warning: function declaration isn’t a prototype
/home/buildbot/build/sage/menas-1/menas_full/build/sage-4.6.alpha3pre2/local/include/readline/rltypedefs.h:36:1: warning: function declaration isn’t a prototype
/home/buildbot/build/sage/menas-1/menas_full/build/sage-4.6.alpha3pre2/local/include/readline/rltypedefs.h:37:1: warning: function declaration isn’t a prototype
In file included from /home/buildbot/build/sage/menas-1/menas_full/build/sage-4.6.alpha3pre2/spkg/build/python-2.6.4.p9/src/Modules/readline.c:31:0:
/home/buildbot/build/sage/menas-1/menas_full/build/sage-4.6.alpha3pre2/local/include/readline/readline.h:378:1: warning: function declaration isn’t a prototype
/bin/sh: line 1: 22203 Segmentation fault      LD_LIBRARY_PATH=/home/buildbot/build/sage/menas-1/menas_full/build/sage-4.6.alpha3pre2/spkg/build/python-2.6.4.p9/src:/home/buildbot/build/sage/menas-1/menas_full/build/sage-4.6.alpha3pre2/local/lib/R/lib:/home/buildbot/build/sage/menas-1/menas_full/build/sage-4.6.alpha3pre2/local/lib/openmpi:/home/buildbot/build/sage/menas-1/menas_full/build/sage-4.6.alpha3pre2/local/lib/:/usr/local/gcc-4.5.1/x86_64-Linux-core2-suse/lib64 CC='gcc  -pthread' LDSHARED='gcc  -pthread -shared' LDFLAGS='-L/home/buildbot/build/sage/menas-1/menas_full/build/sage-4.6.alpha3pre2/local/lib ' OPT='-DNDEBUG -g  -O3 -Wall -Wstrict-prototypes' ./python -E ./setup.py -q build
make[2]: *** [sharedmods] Error 139
make[2]: Leaving directory `/home/buildbot/build/sage/menas-1/menas_full/build/sage-4.6.alpha3pre2/spkg/build/python-2.6.4.p9/src'
Error building Python.
```



---

Comment by drkirkby created at 2010-10-06 07:53:15

Replying to [comment:1 mpatel]:
> Has anyone else seen this problem, possibly on other machines?

Yes, I have seen this problem once on IBM's AIX operating system. This ticket prompted me to open #10083 where the failure of Python to build the `math` module on AIX 5.3 is shown. 

Clearly it has happened before on other systems too, which prompted someone to add the check that the `math` module had installed. However, I can't see who did this, or on what ticket, as SPKG.txt does not show it and neither did a quick glance at the output from `hg log`

Dave


---

Comment by mpatel created at 2010-10-07 22:48:21

I've now also seen the problem in the description on menas.  For me, it seems the `math` module is installed, since I can run `./sage -python` and `import` it, at least, without problems.

Is this a parallel build problem?  Reinstalling the package serially works.

Could we do better than sleep for an arbitrary three seconds?


---

Comment by mpatel created at 2010-10-16 22:24:32

Resolution: worksforme


---

Comment by mpatel created at 2010-10-16 22:24:32

I believed I've solved the problems above on flavius, iras, and menas by not setting the unnecessary `PYTHONHOME` and `PYTHONPATH` environment variables.  It was on each of these machines that I compiled the buildbot user's own Python distribution, in order to work around missing Python development packages and/or missing zlib support, both of which are required for `buildbot-slave`.  It appears sufficient just to add the directory containing `python` to the `PATH`.

With this fix, the main remaining problems with compiling 4.6.alpha3 on Skynet are #9897 and the file locking problems (building GD, MPFI, and accessing the SQLite database `graphs.db`) on most of the Fedora 13 machines.

I'm closing this ticket, but feel free to reopen it, if you have the same problem.  See #10083 for a similar problem on AIX.
