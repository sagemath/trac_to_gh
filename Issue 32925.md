# Issue 32925: installation of pycryprosat/cryptominisat is broken

archive/issues_032925.json:
```json
{
    "body": "CC:  mkoeppe slelievre vbraun\n\npycryptosat is meant to be installed as a part of cryptominisat,\nbut it does not happen.\n\nThis is because it's installing the Python module in SAGE_ROOT/local/\nFrom the log:\n\n\n```\n-- Found python interpreter, libs and header files\n-- Building python interface\n-- Python CFLAGS:  '-Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -ffile-prefix-map=/build/python3.9-RNBry6/python3.9-3.9.2=.  -fstack-protector-strong -Wformat -Werror=format-security  -g -fwrapv -O2   '\n-- Python LDFLAGS: '-lcrypt -lpthread -ldl  -lutil -lm'\n-- Python LINKFORSHARED flags: '-Xlinker -export-dynamic -Wl,-O1 -Wl,-Bsymbolic-functions'\n-- Python module will be installed to : '/home/dimpase/work/sage/local'\n-- Configuring done\n```\n\n\nSee\n https://groups.google.com/d/msgid/sage-release/cc134257-34d8-4c26-8719-24a994dc42dan%40googlegroups.com\n\n\n```\n./sage --pip install pycryptosat\n```\n\ncan be used as a workaround\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33162\n\n",
    "created_at": "2022-01-13T19:07:18Z",
    "labels": [
        "packages: optional",
        "critical",
        "bug"
    ],
    "title": "installation of pycryprosat/cryptominisat is broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32925",
    "user": "dimpase"
}
```
CC:  mkoeppe slelievre vbraun

pycryptosat is meant to be installed as a part of cryptominisat,
but it does not happen.

This is because it's installing the Python module in SAGE_ROOT/local/
From the log:


```
-- Found python interpreter, libs and header files
-- Building python interface
-- Python CFLAGS:  '-Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -ffile-prefix-map=/build/python3.9-RNBry6/python3.9-3.9.2=.  -fstack-protector-strong -Wformat -Werror=format-security  -g -fwrapv -O2   '
-- Python LDFLAGS: '-lcrypt -lpthread -ldl  -lutil -lm'
-- Python LINKFORSHARED flags: '-Xlinker -export-dynamic -Wl,-O1 -Wl,-Bsymbolic-functions'
-- Python module will be installed to : '/home/dimpase/work/sage/local'
-- Configuring done
```


See
 https://groups.google.com/d/msgid/sage-release/cc134257-34d8-4c26-8719-24a994dc42dan%40googlegroups.com


```
./sage --pip install pycryptosat
```

can be used as a workaround


Issue created by migration from https://trac.sagemath.org/ticket/33162





---

archive/issue_comments_469650.json:
```json
{
    "body": "in cmake [config of cryptominisat](https://github.com/msoos/cryptominisat/blob/master/python/CMakeLists.txt) on sees\n\n```\nif(DEFINED ENV{PYCRYPTOSAT_INSTALL_PATH})\n    set(PY_INSTALL_PREFIX \"--prefix=$ENV{PYCRYPTOSAT_INSTALL_PATH}\")\nelseif(DEFINED ENV{VIRTUAL_ENV})\n    set(PY_INSTALL_PREFIX \"\")\nelse()\n    set(PY_INSTALL_PREFIX \"--prefix=${CMAKE_INSTALL_PREFIX}\")\nendif()\n```\n\n\nso one can explicitly set the path for the module. But to what value?",
    "created_at": "2022-01-13T19:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469650",
    "user": "dimpase"
}
```

in cmake [config of cryptominisat](https://github.com/msoos/cryptominisat/blob/master/python/CMakeLists.txt) on sees

```
if(DEFINED ENV{PYCRYPTOSAT_INSTALL_PATH})
    set(PY_INSTALL_PREFIX "--prefix=$ENV{PYCRYPTOSAT_INSTALL_PATH}")
elseif(DEFINED ENV{VIRTUAL_ENV})
    set(PY_INSTALL_PREFIX "")
else()
    set(PY_INSTALL_PREFIX "--prefix=${CMAKE_INSTALL_PREFIX}")
endif()
```


so one can explicitly set the path for the module. But to what value?



---

archive/issue_comments_469651.json:
```json
{
    "body": "See also\n\n- #25374: Upgrade cryptominisat to fix cryptominisat build on Cygwin",
    "created_at": "2022-01-13T20:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469651",
    "user": "slelievre"
}
```

See also

- #25374: Upgrade cryptominisat to fix cryptominisat build on Cygwin



---

archive/issue_comments_469652.json:
```json
{
    "body": "Changing keywords from \"\" to \"cryptominisat\".",
    "created_at": "2022-01-13T20:09:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469652",
    "user": "slelievre"
}
```

Changing keywords from "" to "cryptominisat".



---

archive/issue_comments_469653.json:
```json
{
    "body": "In principle, it would be set to ${SAGE_VENV}. \nBut it is not a correct solution, as explained in #25374#comment:39",
    "created_at": "2022-01-13T20:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469653",
    "user": "mkoeppe"
}
```

In principle, it would be set to ${SAGE_VENV}. 
But it is not a correct solution, as explained in #25374#comment:39



---

archive/issue_comments_469654.json:
```json
{
    "body": "Replying to [comment:4 mkoeppe]:\n> In principle, it would be set to ${SAGE_VENV}. \n> But it is not a correct solution, as explained in #25374#comment:39\n\nI don't see why it's not OK. Passing `PYCRYPTOSAT_INSTALL_PATH=$SAGE_VENV`\nwould make sure the python package installs in the correct venv, while the rest goes where it should.",
    "created_at": "2022-01-13T20:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469654",
    "user": "dimpase"
}
```

Replying to [comment:4 mkoeppe]:
> In principle, it would be set to ${SAGE_VENV}. 
> But it is not a correct solution, as explained in #25374#comment:39

I don't see why it's not OK. Passing `PYCRYPTOSAT_INSTALL_PATH=$SAGE_VENV`
would make sure the python package installs in the correct venv, while the rest goes where it should.



---

archive/issue_comments_469655.json:
```json
{
    "body": "Because of our installation records in SAGE_LOCAL/var/lib/sage/installed/ and SAGE_VENV/var/lib/sage/installed.",
    "created_at": "2022-01-13T20:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469655",
    "user": "mkoeppe"
}
```

Because of our installation records in SAGE_LOCAL/var/lib/sage/installed/ and SAGE_VENV/var/lib/sage/installed.



---

archive/issue_comments_469656.json:
```json
{
    "body": "Replying to [comment:6 mkoeppe]:\n> Because of our installation records in SAGE_LOCAL/var/lib/sage/installed/ and SAGE_VENV/var/lib/sage/installed.\n> \n\ncan we allow Python modules in SAGE_LOCAL, too? As a temporary fix, at least.",
    "created_at": "2022-01-13T21:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469656",
    "user": "dimpase"
}
```

Replying to [comment:6 mkoeppe]:
> Because of our installation records in SAGE_LOCAL/var/lib/sage/installed/ and SAGE_VENV/var/lib/sage/installed.
> 

can we allow Python modules in SAGE_LOCAL, too? As a temporary fix, at least.



---

archive/issue_comments_469657.json:
```json
{
    "body": "no, they won't be in the load path.",
    "created_at": "2022-01-14T03:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469657",
    "user": "mkoeppe"
}
```

no, they won't be in the load path.



---

archive/issue_comments_469658.json:
```json
{
    "body": "Solution is as I said in #25374#comment:48",
    "created_at": "2022-01-14T03:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469658",
    "user": "mkoeppe"
}
```

Solution is as I said in #25374#comment:48



---

archive/issue_comments_469659.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-01-14T10:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469659",
    "user": "dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_469660.json:
```json
{
    "body": "here is an easier fix. \n\nMade it blocker, as this fixes an otherwise totally broken optional package.\n----\nNew commits:",
    "created_at": "2022-01-14T10:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469660",
    "user": "dimpase"
}
```

here is an easier fix. 

Made it blocker, as this fixes an otherwise totally broken optional package.
----
New commits:



---

archive/issue_comments_469661.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2022-01-14T10:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469661",
    "user": "dimpase"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_469662.json:
```json
{
    "body": "This is not enough because it will break when you switch to a different Python.",
    "created_at": "2022-01-14T15:56:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469662",
    "user": "mkoeppe"
}
```

This is not enough because it will break when you switch to a different Python.



---

archive/issue_comments_469663.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-01-14T15:56:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469663",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_469664.json:
```json
{
    "body": "cryptominisat depends on\n$(PYTHON), thus such a switch will trigger a rebuild.",
    "created_at": "2022-01-14T17:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469664",
    "user": "dimpase"
}
```

cryptominisat depends on
$(PYTHON), thus such a switch will trigger a rebuild.



---

archive/issue_comments_469665.json:
```json
{
    "body": "Nope",
    "created_at": "2022-01-14T17:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469665",
    "user": "mkoeppe"
}
```

Nope



---

archive/issue_comments_469666.json:
```json
{
    "body": "then I don't understand what \"switch\" means.",
    "created_at": "2022-01-14T18:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469666",
    "user": "dimpase"
}
```

then I don't understand what "switch" means.



---

archive/issue_comments_469667.json:
```json
{
    "body": "When a system python is in use, `$(PYTHON)` is the path to `$(SAGE_VENV)/pyvenv.cfg`. This file is created on creation of the venv for the configured python and is never updated.\n\nSwitching between pythons = Re-running `configure`, with or without `--with-python=....`, which selects different system python versions.",
    "created_at": "2022-01-14T18:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469667",
    "user": "mkoeppe"
}
```

When a system python is in use, `$(PYTHON)` is the path to `$(SAGE_VENV)/pyvenv.cfg`. This file is created on creation of the venv for the configured python and is never updated.

Switching between pythons = Re-running `configure`, with or without `--with-python=....`, which selects different system python versions.



---

archive/issue_comments_469668.json:
```json
{
    "body": "and how does one trigger rebuild of a Pyhton package in such a case?",
    "created_at": "2022-01-14T18:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469668",
    "user": "dimpase"
}
```

and how does one trigger rebuild of a Pyhton package in such a case?



---

archive/issue_comments_469669.json:
```json
{
    "body": "Installation records for Python packages are kept in $(SAGE_VENV)/var/lib/sage/installed.\nDifferent Python version -> Different SAGE_VENV -> different installation records.",
    "created_at": "2022-01-14T18:10:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469669",
    "user": "mkoeppe"
}
```

Installation records for Python packages are kept in $(SAGE_VENV)/var/lib/sage/installed.
Different Python version -> Different SAGE_VENV -> different installation records.



---

archive/issue_comments_469670.json:
```json
{
    "body": "this does not answer my question.",
    "created_at": "2022-01-14T18:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469670",
    "user": "dimpase"
}
```

this does not answer my question.



---

archive/issue_comments_469671.json:
```json
{
    "body": "Then I don't understand your question - what should trigger a rebuild of what?",
    "created_at": "2022-01-14T18:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469671",
    "user": "mkoeppe"
}
```

Then I don't understand your question - what should trigger a rebuild of what?



---

archive/issue_comments_469672.json:
```json
{
    "body": "how does using another Python in a configure run sets up rebuilt of python packages? Suppose you have \n\n```\n./configure --with-python=foo\nmake\n./configure --with-python=bar\nmake\n```\n\nWhat is triggering building Python packages for `bar` ?",
    "created_at": "2022-01-14T19:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469672",
    "user": "dimpase"
}
```

how does using another Python in a configure run sets up rebuilt of python packages? Suppose you have 

```
./configure --with-python=foo
make
./configure --with-python=bar
make
```

What is triggering building Python packages for `bar` ?



---

archive/issue_comments_469673.json:
```json
{
    "body": "If foo is python3.8 and bar is python3.9, \nthen first, `SAGE_VENV=$SAGE_LOCAL/var/lib/sage/venv-python3.8`\nand after reconfiguration, `SAGE_VENV=$SAGE_LOCAL/var/lib/sage/venv-python3.9`.\n\nInstallation records for Python packages are kept in `$SAGE_VENV/var/lib/sage/installed`.\nAfter reconfiguration, no Python package will have installation records. So all Python packages are built.",
    "created_at": "2022-01-14T19:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469673",
    "user": "mkoeppe"
}
```

If foo is python3.8 and bar is python3.9, 
then first, `SAGE_VENV=$SAGE_LOCAL/var/lib/sage/venv-python3.8`
and after reconfiguration, `SAGE_VENV=$SAGE_LOCAL/var/lib/sage/venv-python3.9`.

Installation records for Python packages are kept in `$SAGE_VENV/var/lib/sage/installed`.
After reconfiguration, no Python package will have installation records. So all Python packages are built.



---

archive/issue_comments_469674.json:
```json
{
    "body": "I've added some explanation of this in https://wiki.sagemath.org/ReleaseTours/sage-9.5#Separate_virtual_environment_for_Python_packages",
    "created_at": "2022-01-14T19:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469674",
    "user": "mkoeppe"
}
```

I've added some explanation of this in https://wiki.sagemath.org/ReleaseTours/sage-9.5#Separate_virtual_environment_for_Python_packages



---

archive/issue_comments_469675.json:
```json
{
    "body": "can we set up a \"dummy\" Python package pycryptosat, a dependency of cryptominisat, which sole purpose is to trigger rebuild of cryptominisat ?",
    "created_at": "2022-01-14T19:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469675",
    "user": "dimpase"
}
```

can we set up a "dummy" Python package pycryptosat, a dependency of cryptominisat, which sole purpose is to trigger rebuild of cryptominisat ?



---

archive/issue_comments_469676.json:
```json
{
    "body": "Why not just make it an ordinary package?",
    "created_at": "2022-01-14T19:40:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469676",
    "user": "mkoeppe"
}
```

Why not just make it an ordinary package?



---

archive/issue_comments_469677.json:
```json
{
    "body": "because I have no idea how to decouple pycryptosat from cryptominisat.\n\nthe former is generated on the fly from templates, by the latter.",
    "created_at": "2022-01-14T20:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469677",
    "user": "dimpase"
}
```

because I have no idea how to decouple pycryptosat from cryptominisat.

the former is generated on the fly from templates, by the latter.



---

archive/issue_comments_469678.json:
```json
{
    "body": "There is not a separate Makefile target for just installing the Python package?\nOK to build the C library twice; but we should avoid to install it twice.",
    "created_at": "2022-01-14T20:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469678",
    "user": "mkoeppe"
}
```

There is not a separate Makefile target for just installing the Python package?
OK to build the C library twice; but we should avoid to install it twice.



---

archive/issue_comments_469679.json:
```json
{
    "body": "makefiles generated by cmake are usually a mess.",
    "created_at": "2022-01-14T20:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469679",
    "user": "dimpase"
}
```

makefiles generated by cmake are usually a mess.



---

archive/issue_comments_469680.json:
```json
{
    "body": "I would be surprised if so built python module was linked correctly, against the already installed library, and not the one built by this 2nd round.\n\nHow about just renaming cryptominisat spkg to pycryptosat ?",
    "created_at": "2022-01-14T21:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469680",
    "user": "dimpase"
}
```

I would be surprised if so built python module was linked correctly, against the already installed library, and not the one built by this 2nd round.

How about just renaming cryptominisat spkg to pycryptosat ?



---

archive/issue_comments_469681.json:
```json
{
    "body": "Replying to [comment:28 dimpase]:\n> I would be surprised if so built python module was linked correctly, against the already installed library, and not the one built by this 2nd round.\n\nI don't see how it could fail. All the rpaths are set correctly by the build system.",
    "created_at": "2022-01-14T21:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469681",
    "user": "mkoeppe"
}
```

Replying to [comment:28 dimpase]:
> I would be surprised if so built python module was linked correctly, against the already installed library, and not the one built by this 2nd round.

I don't see how it could fail. All the rpaths are set correctly by the build system.



---

archive/issue_comments_469682.json:
```json
{
    "body": "Replying to [comment:28 dimpase]:\n> How about just renaming cryptominisat spkg to pycryptosat ?\n\nFine with me; then you could add an `install-requires.txt`, which will ensure installation will go into SAGE_VENV.",
    "created_at": "2022-01-14T21:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469682",
    "user": "mkoeppe"
}
```

Replying to [comment:28 dimpase]:
> How about just renaming cryptominisat spkg to pycryptosat ?

Fine with me; then you could add an `install-requires.txt`, which will ensure installation will go into SAGE_VENV.



---

archive/issue_comments_469683.json:
```json
{
    "body": "imho using `sdh_pip_install` already makes sure it goes to SAGE_VENV, no?",
    "created_at": "2022-01-14T21:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469683",
    "user": "dimpase"
}
```

imho using `sdh_pip_install` already makes sure it goes to SAGE_VENV, no?



---

archive/issue_comments_469684.json:
```json
{
    "body": "The installation of the Python package yes, but not the library and not the installation record!",
    "created_at": "2022-01-14T22:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469684",
    "user": "mkoeppe"
}
```

The installation of the Python package yes, but not the library and not the installation record!



---

archive/issue_comments_469685.json:
```json
{
    "body": "But the present branch is certainly an improvement, so let's consider it a hotfix for Sage 9.5",
    "created_at": "2022-01-14T23:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469685",
    "user": "mkoeppe"
}
```

But the present branch is certainly an improvement, so let's consider it a hotfix for Sage 9.5



---

archive/issue_comments_469686.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-01-14T23:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469686",
    "user": "mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_469687.json:
```json
{
    "body": "Replying to [comment:32 mkoeppe]:\n> The installation of the Python package yes, but not the library and not the installation record!\n\n\nthe library still goes to SAGE_LOCAL.\n\nImho all the sdh_ - scripts correctly set installation records of Sage.",
    "created_at": "2022-01-15T09:09:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469687",
    "user": "dimpase"
}
```

Replying to [comment:32 mkoeppe]:
> The installation of the Python package yes, but not the library and not the installation record!


the library still goes to SAGE_LOCAL.

Imho all the sdh_ - scripts correctly set installation records of Sage.



---

archive/issue_comments_469688.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2022-01-15T14:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469688",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_469689.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2022-01-15T14:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469689",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_469690.json:
```json
{
    "body": "Is this what you kept in mind? Turns out one just needs to run cmake to get pycryptosat set up, no need to build the library twice.",
    "created_at": "2022-01-15T14:30:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469690",
    "user": "dimpase"
}
```

Is this what you kept in mind? Turns out one just needs to run cmake to get pycryptosat set up, no need to build the library twice.



---

archive/issue_comments_469691.json:
```json
{
    "body": "Replying to [comment:35 dimpase]:\n> Imho all the sdh_ - scripts correctly set installation records of Sage. \n\nThe installation records are set by `sage-spkg`, not by `sdh_...`.\nOne record for one package.",
    "created_at": "2022-01-15T16:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469691",
    "user": "mkoeppe"
}
```

Replying to [comment:35 dimpase]:
> Imho all the sdh_ - scripts correctly set installation records of Sage. 

The installation records are set by `sage-spkg`, not by `sdh_...`.
One record for one package.



---

archive/issue_comments_469692.json:
```json
{
    "body": "Replying to [comment:37 dimpase]:\n> Is this what you kept in mind? Turns out one just needs to run cmake to get pycryptosat set up, no need to build the library twice.\n\nAlmost. Still need `build/pkgs/pycryptosat/install-requires.txt` so that the installation record goes into SAGE_VENV, not in SAGE_LOCAL",
    "created_at": "2022-01-15T16:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469692",
    "user": "mkoeppe"
}
```

Replying to [comment:37 dimpase]:
> Is this what you kept in mind? Turns out one just needs to run cmake to get pycryptosat set up, no need to build the library twice.

Almost. Still need `build/pkgs/pycryptosat/install-requires.txt` so that the installation record goes into SAGE_VENV, not in SAGE_LOCAL



---

archive/issue_comments_469693.json:
```json
{
    "body": "And `build/pkgs/pycryptosat/checksums.ini` should be a symlink, not a copy, of `cryptominisat`'s.\n(Like it is done for `gcc`/`gfortran`)",
    "created_at": "2022-01-15T16:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469693",
    "user": "mkoeppe"
}
```

And `build/pkgs/pycryptosat/checksums.ini` should be a symlink, not a copy, of `cryptominisat`'s.
(Like it is done for `gcc`/`gfortran`)



---

archive/issue_comments_469694.json:
```json
{
    "body": "Are the `pycryptosat` `distros` correct? Do the \"cryptominisat\" distro packages really install the Python bindings?",
    "created_at": "2022-01-15T16:29:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469694",
    "user": "mkoeppe"
}
```

Are the `pycryptosat` `distros` correct? Do the "cryptominisat" distro packages really install the Python bindings?



---

archive/issue_comments_469695.json:
```json
{
    "body": "Also a good moment to add `upstream_url` in `checksums.ini`",
    "created_at": "2022-01-15T16:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469695",
    "user": "mkoeppe"
}
```

Also a good moment to add `upstream_url` in `checksums.ini`



---

archive/issue_comments_469696.json:
```json
{
    "body": "Also note that the positively reviewed version of this ticket is already on Volker's branch, so best to reset to that and continue on a follow-up ticket",
    "created_at": "2022-01-15T16:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469696",
    "user": "mkoeppe"
}
```

Also note that the positively reviewed version of this ticket is already on Volker's branch, so best to reset to that and continue on a follow-up ticket



---

archive/issue_comments_469697.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-01-15T17:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469697",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_469698.json:
```json
{
    "body": "ok, this is the old fix",
    "created_at": "2022-01-15T17:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469698",
    "user": "dimpase"
}
```

ok, this is the old fix



---

archive/issue_comments_469699.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-01-15T17:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469699",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_469700.json:
```json
{
    "body": "followup on #33183",
    "created_at": "2022-01-15T17:16:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469700",
    "user": "dimpase"
}
```

followup on #33183



---

archive/issue_comments_469701.json:
```json
{
    "body": "Replying to [comment:41 mkoeppe]:\n> Are the `pycryptosat` `distros` correct? Do the \"cryptominisat\" distro packages really install the Python bindings?\n\nI don't know - as spkg-configure is not yet there, it can be left as such for the time being.",
    "created_at": "2022-01-15T17:21:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469701",
    "user": "dimpase"
}
```

Replying to [comment:41 mkoeppe]:
> Are the `pycryptosat` `distros` correct? Do the "cryptominisat" distro packages really install the Python bindings?

I don't know - as spkg-configure is not yet there, it can be left as such for the time being.



---

archive/issue_comments_469702.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-01-15T18:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469702",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_469703.json:
```json
{
    "body": "It seems something is missing (maybe a dependency) as it is now broken on my machine, see https://groups.google.com/g/sage-release/c/1YV0dNtEZz4/m/Tm7RSWINAgAJ\n\nIs there a ticket for it already? I think I have seen a report of the failure earlier this week by someone else, I don't remember where.",
    "created_at": "2022-01-21T16:28:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469703",
    "user": "slabbe"
}
```

It seems something is missing (maybe a dependency) as it is now broken on my machine, see https://groups.google.com/g/sage-release/c/1YV0dNtEZz4/m/Tm7RSWINAgAJ

Is there a ticket for it already? I think I have seen a report of the failure earlier this week by someone else, I don't remember where.



---

archive/issue_comments_469704.json:
```json
{
    "body": "missing python toolchain in deps of cryptominisat.\n\nsee #33183",
    "created_at": "2022-01-21T21:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32925#issuecomment-469704",
    "user": "dimpase"
}
```

missing python toolchain in deps of cryptominisat.

see #33183
