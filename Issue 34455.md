# Issue 34455: Frobenius endomorphism creation fail for infinite ring extension

Issue created by migration from https://trac.sagemath.org/ticket/34692

Original creator: antoine-leudiere

Original creation time: 2022-10-24 16:50:53

CC:  @davidayotte caruso

I wish to instantiate the Frobenius endomorphism of the field `Fq(X)` seen as a ring over `Fq[X]`. The following raises an exception:


```
sage: Fq = GF(11)
sage: FqX.<X> = Fq[]
sage: k = Frac(FqX)
sage: i = Hom(FqX, k).natural_map()
sage: K = k.over(i)
sage: K.frobenius_endomorphism()
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
Input In [43], in <cell line: 6>()
      4 i = Hom(FqX, k).natural_map()
      5 K = k.over(i)
----> 6 K.frobenius_endomorphism()

File $SAGE_ROOT/sage/src/sage/rings/ring.pyx:1428, in sage.rings.ring.CommutativeRing.frobenius_endomorphism()
   1426     """
   1427     from .morphism import FrobeniusEndomorphism_generic
-> 1428     return FrobeniusEndomorphism_generic(self, n)
   1429 
   1430 def derivation_module(self, codomain=None, twist=None):

File $SAGE_ROOT/sage/src/sage/rings/morphism.pyx:2929, in sage.rings.morphism.FrobeniusEndomorphism_generic.__init__()
   2927 if not isinstance(domain, CommutativeRing):
   2928     raise TypeError("The base ring must be a commutative ring")
-> 2929 self._p = domain.characteristic()
   2930 if not self._p.is_prime():
   2931     raise TypeError("the characteristic of the base ring must be prime")

File $SAGE_ROOT/sage/src/sage/categories/rings.py:588, in Rings.ParentMethods.characteristic(self)
    586 from sage.rings.infinity import infinity
    587 from sage.rings.integer_ring import ZZ
--> 588 order_1 = self.one().additive_order()
    589 return ZZ.zero() if order_1 is infinity else order_1

File $SAGE_ROOT/sage/src/sage/rings/ring_extension_element.pyx:415, in sage.rings.ring_extension_element.RingExtensionElement.additive_order()
    413         5
    414     """
--> 415     return self._backend.additive_order()
    416 
    417 def multiplicative_order(self):

File $SAGE_ROOT/sage/src/sage/structure/element.pyx:2818, in sage.structure.element.RingElement.additive_order()
   2816     Return the additive order of ``self``.
   2817     """
-> 2818     raise NotImplementedError
   2819 
   2820 def multiplicative_order(self):

NotImplementedError:
```



Best,

Antoine LeudiÃ¨re


---

Comment by @DavidAyotte created at 2022-10-27 15:13:38

Hi Antoine! I think that to make this works, you need to implement the `characteristic` method of a ring over a base.


---

Comment by @DavidAyotte created at 2022-10-27 15:13:38

Changing type from PLEASE CHANGE to enhancement.


---

Comment by @DavidAyotte created at 2022-10-27 15:13:38

Changing component from PLEASE CHANGE to algebra.


---

Comment by @DavidAyotte created at 2022-10-27 15:35:06

I investigated a bit further and, to make your above code work, I think that you simply need to implement the characteristic method for the class `sage.rings.ring_extensions.RingExtension_generic`:


```python
    def characteristic(self):
        return self._backend.characteristic()
```


I cc'ed Xavier here because he implemented extensions of rings and therefore he might know a better way to solve this.


---

Comment by antoine-leudiere created at 2022-10-28 09:18:20

Thank you David for the input. I am happy to do it!

A.


---

Comment by antoine-leudiere created at 2022-11-14 15:26:52

Here is a proposal. Let me know what you think.

Best,
Antoine
----
New commits:


---

Comment by @DavidAyotte created at 2022-11-14 15:44:02

Very minor detail: in the output field you could write instead

```
A prime number or zero.
```

Also, I think that sometimes it is acceptable to omit the output field in the documentation when the output is relatively straightforward (but you can keep it like that, it's perfectly fine too).

If you are happy with your changes you can put your ticket in "need review". The next step would be to wait for the build actions to finish.


---

Comment by git created at 2022-11-14 16:23:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by antoine-leudiere created at 2022-11-14 16:30:09

Replying to [comment:5 David Ayotte]:
> Very minor detail: in the output field you could write instead
> {{{
> A prime number or zero.
> }}}

I am so stupid.

> Also, I think that sometimes it is acceptable to omit the output field in the documentation when the output is relatively straightforward (but you can keep it like that, it's perfectly fine too).

I think this can help resolve any ambiguities.

> 
> If you are happy with your changes you can put your ticket in "need review". The next step would be to wait for the build actions to finish.

Thanks a lot; it was mostly your work (comment [comment:2]).

Best,

Antoine
----
New commits:


---

Comment by antoine-leudiere created at 2022-11-14 16:39:36

Changing status from new to needs_review.


---

Comment by caruso created at 2022-11-14 16:48:08

Maybe, you should also have an example `B.over(A)` where `A` and `B` have different characteristic.
For example, I suggest to replace your last example by


```
    sage: E = Fp(7).over(ZZ)
    sage: E.characteristic()
    7
```


Also you should add a doctest (in the section TESTS) demonstrating that the bug noticed in this ticket is fixed.


---

Comment by git created at 2022-11-14 17:04:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by caruso created at 2022-11-14 17:35:44

For the last example, you don't need to create `i`. The following code works well:

```
sage: Fq = GF(11)
sage: FqX.<X> = Fq[]
sage: k = Frac(FqX)
sage: K = k.over(FqX)
sage: K.frobenius_endomorphism()
```



---

Comment by git created at 2022-11-14 17:53:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by caruso created at 2022-11-14 18:11:47

Looks good to me. Waiting for the patchbot.


---

Comment by @DavidAyotte created at 2022-11-15 01:01:24

Looks good to me too! The failed doctest of the patchbot is definitely not related to this ticket and all the Github actions passed.


---

Comment by @DavidAyotte created at 2022-11-15 01:01:24

Changing status from needs_review to positive_review.


---

Comment by antoine-leudiere created at 2022-11-15 10:07:13

Copy that! Thank you for the review.

Does that mean I can merge this branch into that of Drinfeld modules? I need the patch to fix some bugs. Or should I wait for something else?

Best,

Antoine


---

Comment by @DavidAyotte created at 2022-11-15 12:47:42

You can merge it an add this ticket number in the "dependencies" field of your ticket on Drinfeld modules. For more info, see https://doc.sagemath.org/html/en/developer/trac.html#the-ticket-fields


---

Comment by vbraun created at 2022-11-20 12:13:33

Resolution: fixed
